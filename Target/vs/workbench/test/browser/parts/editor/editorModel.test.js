import t from"assert";import{TestInstantiationService as u}from"../../../../../platform/instantiation/test/common/instantiationServiceMock.js";import{BaseTextEditorModel as l}from"../../../../common/editor/textEditorModel.js";import"../../../../../editor/common/services/model.js";import{ILanguageService as p}from"../../../../../editor/common/languages/language.js";import{LanguageService as v}from"../../../../../editor/common/services/languageService.js";import{IConfigurationService as d}from"../../../../../platform/configuration/common/configuration.js";import{TestConfigurationService as S}from"../../../../../platform/configuration/test/common/testConfigurationService.js";import{ModelService as T}from"../../../../../editor/common/services/modelService.js";import"../../../../../editor/common/model.js";import"../../../../../base/common/uri.js";import{createTextBufferFactory as g}from"../../../../../editor/common/model/textModel.js";import{ITextResourcePropertiesService as I}from"../../../../../editor/common/services/textResourceConfiguration.js";import{IUndoRedoService as b}from"../../../../../platform/undoRedo/common/undoRedo.js";import{UndoRedoService as E}from"../../../../../platform/undoRedo/common/undoRedoService.js";import{TestDialogService as w}from"../../../../../platform/dialogs/test/common/testDialogService.js";import{IDialogService as M}from"../../../../../platform/dialogs/common/dialogs.js";import{TestNotificationService as x}from"../../../../../platform/notification/test/common/testNotificationService.js";import{INotificationService as R}from"../../../../../platform/notification/common/notification.js";import{TestStorageService as y,TestTextResourcePropertiesService as D}from"../../../common/workbenchTestServices.js";import{IThemeService as L}from"../../../../../platform/theme/common/themeService.js";import{TestThemeService as C}from"../../../../../platform/theme/test/common/testThemeService.js";import{EditorModel as q}from"../../../../common/editor/editorModel.js";import{Mimes as B}from"../../../../../base/common/mime.js";import{LanguageDetectionService as U}from"../../../../services/languageDetection/browser/languageDetectionWorkerServiceImpl.js";import{IWorkbenchEnvironmentService as h}from"../../../../services/environment/common/environmentService.js";import{TestEditorService as F,TestEnvironmentService as N}from"../../workbenchTestServices.js";import{TestLanguageConfigurationService as k}from"../../../../../editor/test/common/modes/testLanguageConfigurationService.js";import{ILanguageConfigurationService as A}from"../../../../../editor/common/languages/languageConfigurationRegistry.js";import{TestAccessibilityService as P}from"../../../../../platform/accessibility/test/common/testAccessibilityService.js";import{IEditorService as W}from"../../../../services/editor/common/editorService.js";import{IStorageService as j}from"../../../../../platform/storage/common/storage.js";import{DisposableStore as z}from"../../../../../base/common/lifecycle.js";import{ensureNoDisposablesAreLeakedInTestSuite as G}from"../../../../../base/test/common/utils.js";suite("EditorModel",()=>{class a extends q{}class n extends l{testCreateTextEditorModel(r,s,m){return super.createTextEditorModel(r,s,m)}isReadonly(){return!1}}function f(e){const r=new w,s=new x,m=new E(r,s);return e.stub(h,N),e.stub(d,new S),e.stub(I,new D(e.get(d))),e.stub(M,r),e.stub(R,s),e.stub(b,m),e.stub(W,o.add(new F)),e.stub(L,new C),e.stub(A,o.add(new k)),e.stub(j,o.add(new y)),o.add(e.createInstance(T))}let i,c;const o=new z;setup(()=>{i=o.add(new u),c=i.stub(p,v)}),teardown(()=>{o.clear()}),test("basics",async()=>{let e=0;const r=o.add(new a);o.add(r.onWillDispose(()=>{t(!0),e++})),await r.resolve(),t.strictEqual(r.isDisposed(),!1),t.strictEqual(r.isResolved(),!0),r.dispose(),t.strictEqual(e,1),t.strictEqual(r.isDisposed(),!0)}),test("BaseTextEditorModel",async()=>{const e=f(i),r=o.add(new n(e,c,o.add(i.createInstance(U)),i.createInstance(P)));await r.resolve(),o.add(r.testCreateTextEditorModel(g("foo"),null,B.text)),t.strictEqual(r.isResolved(),!0)}),G()});
