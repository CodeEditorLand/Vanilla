import{IConfigurationService as v}from"../../../../platform/configuration/common/configuration.js";import{EditorActivation as l}from"../../../../platform/editor/common/editor.js";import"../../../../platform/instantiation/common/instantiation.js";import{isEditorInputWithOptions as O,isEditorInput as P,EditorInputCapabilities as U}from"../../../common/editor.js";import"../../../common/editor/editorInput.js";import{GroupsOrder as E,preferredSideBySideGroupDirection as I,IEditorGroupsService as m}from"./editorGroupsService.js";import{AUX_WINDOW_GROUP as W,SIDE_GROUP as a}from"./editorService.js";function V(o,t,i){const u=o.get(m),r=o.get(v),d=_(t,i,u,r);return d instanceof Promise?d.then(p=>G(p,t,i,u)):G(d,t,i,u)}function G(o,t,i,u){let r;return u.activeGroup!==o&&t.options&&!t.options.inactive&&t.options.preserveFocus&&typeof t.options.activation!="number"&&i!==a&&(r=l.ACTIVATE),[o,r]}function _(o,t,i,u){let r;const d=O(o)?o.editor:o,p=o.options;if(t&&typeof t!="number")r=t;else if(typeof t=="number"&&t>=0)r=i.getGroup(t);else if(t===a){const n=I(u);let e=i.findGroup({direction:n});(!e||c(e,d))&&(e=i.addGroup(i.activeGroup,n)),r=e}else if(t===W)r=i.createAuxiliaryEditorPart().then(n=>n.activeGroup);else if(!p||typeof p.index!="number"){const n=i.getGroups(E.MOST_RECENTLY_ACTIVE);if(p?.revealIfVisible){for(const e of n)if(y(e,d)){r=e;break}}if(!r&&(p?.revealIfOpened||u.getValue("workbench.editor.revealIfOpen")||P(d)&&d.hasCapability(U.Singleton))){let e,s;for(const f of n)if(A(f,d)&&(s||(s=f),!e&&f.isActive(d)&&(e=f)),s&&e)break;r=e||s}}if(!r){let n=i.activeGroup;if(c(n,d)){for(const e of i.getGroups(E.MOST_RECENTLY_ACTIVE))if(!c(e,d)){n=e;break}c(n,d)?r=i.addGroup(n,I(u)):r=n}else r=n}return r}function c(o,t){return!(!o.isLocked||A(o,t))}function y(o,t){return o.activeEditor?o.activeEditor.matches(t):!1}function A(o,t){for(const i of o.editors)if(i.matches(t))return!0;return!1}export{V as findGroup};
