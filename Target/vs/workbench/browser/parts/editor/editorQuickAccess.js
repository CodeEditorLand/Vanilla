var x=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var m=(g,i,r,t)=>{for(var e=t>1?void 0:t?z(i,r):i,o=g.length-1,a;o>=0;o--)(a=g[o])&&(e=(t?a(i,r,e):a(e))||e);return t&&e&&x(i,r,e),e},s=(g,i)=>(r,t)=>i(r,t,g);import"./media/editorquickaccess.css";import{localize as f}from"../../../../nls.js";import{quickPickItemScorerAccessor as P}from"../../../../platform/quickinput/common/quickInput.js";import{PickerQuickAccessProvider as F,TriggerAction as b}from"../../../../platform/quickinput/browser/pickerQuickAccess.js";import{IEditorGroupsService as E,GroupsOrder as C}from"../../../services/editor/common/editorGroupsService.js";import{EditorsOrder as k,EditorResourceAccessor as O,SideBySideEditor as R}from"../../../common/editor.js";import{IEditorService as v}from"../../../services/editor/common/editorService.js";import{IModelService as h}from"../../../../editor/common/services/model.js";import{ILanguageService as G}from"../../../../editor/common/languages/language.js";import{getIconClasses as D}from"../../../../editor/common/services/getIconClasses.js";import{prepareQuery as y,scoreItemFuzzy as M,compareItemsByFuzzyScore as X}from"../../../../base/common/fuzzyScorer.js";import"../../../../base/common/cancellation.js";import"../../../../base/common/lifecycle.js";import{Codicon as L}from"../../../../base/common/codicons.js";import{ThemeIcon as N}from"../../../../base/common/themables.js";let u=class extends F{constructor(r,t,e,o,a){super(r,{canAcceptInBackground:!0,noResultsPick:{label:f("noViewResults","No matching editors"),groupId:-1}});this.editorGroupService=t;this.editorService=e;this.modelService=o;this.languageService=a}pickState=new class{scorerCache=Object.create(null);isQuickNavigating=void 0;reset(r){r||(this.scorerCache=Object.create(null)),this.isQuickNavigating=r}};provide(r,t){return this.pickState.reset(!!r.quickNavigate),super.provide(r,t)}_getPicks(r){const t=y(r),e=this.doGetEditorPickItems().filter(a=>{if(!t.normalized)return!0;const c=M(a,t,!0,P,this.pickState.scorerCache);return c.score?(a.highlights={label:c.labelMatch,description:c.descriptionMatch},!0):!1});if(t.normalized){const a=this.editorGroupService.getGroups(C.GRID_APPEARANCE).map(c=>c.id);e.sort((c,n)=>c.groupId!==n.groupId?a.indexOf(c.groupId)-a.indexOf(n.groupId):X(c,n,t,!0,P,this.pickState.scorerCache))}const o=[];if(this.editorGroupService.count>1){let a;for(const c of e){if(typeof a!="number"||a!==c.groupId){const n=this.editorGroupService.getGroup(c.groupId);n&&o.push({type:"separator",label:n.label}),a=c.groupId}o.push(c)}}else o.push(...e);return o}doGetEditorPickItems(){const r=this.doGetEditors(),t=new Map;for(const{groupId:e}of r)if(!t.has(e)){const o=this.editorGroupService.getGroup(e);o&&t.set(e,o.ariaLabel)}return this.doGetEditors().map(({editor:e,groupId:o})=>{const a=O.getOriginalUri(e,{supportSideBySide:R.PRIMARY}),c=e.isDirty()&&!e.isSaving(),n=e.getDescription(),S=n?`${e.getName()} ${n}`:e.getName();return{groupId:o,resource:a,label:e.getName(),ariaLabel:t.size>1?c?f("entryAriaLabelWithGroupDirty","{0}, unsaved changes, {1}",S,t.get(o)):f("entryAriaLabelWithGroup","{0}, {1}",S,t.get(o)):c?f("entryAriaLabelDirty","{0}, unsaved changes",S):S,description:n,iconClasses:D(this.modelService,this.languageService,a,void 0,e.getIcon()).concat(e.getLabelExtraClasses()),italic:!this.editorGroupService.getGroup(o)?.isPinned(e),buttons:[{iconClass:c?"dirty-editor "+N.asClassName(L.closeDirty):N.asClassName(L.close),tooltip:f("closeEditor","Close Editor"),alwaysVisible:c}],trigger:async()=>{const l=this.editorGroupService.getGroup(o);return l&&(await l.closeEditor(e,{preserveFocus:!0}),!l.contains(e))?b.REMOVE_ITEM:b.NO_ACTION},accept:(l,T)=>this.editorGroupService.getGroup(o)?.openEditor(e,{preserveFocus:T.inBackground})}})}};u=m([s(1,E),s(2,v),s(3,h),s(4,G)],u);let d=class extends u{static PREFIX="edt active ";constructor(i,r,t,e){super(d.PREFIX,i,r,t,e)}doGetEditors(){const i=this.editorGroupService.activeGroup;return i.getEditors(k.MOST_RECENTLY_ACTIVE).map(r=>({editor:r,groupId:i.id}))}};d=m([s(0,E),s(1,v),s(2,h),s(3,G)],d);let p=class extends u{static PREFIX="edt ";constructor(i,r,t,e){super(p.PREFIX,i,r,t,e)}doGetEditors(){const i=[];for(const r of this.editorGroupService.getGroups(C.GRID_APPEARANCE))for(const t of r.getEditors(k.SEQUENTIAL))i.push({editor:t,groupId:r.id});return i}};p=m([s(0,E),s(1,v),s(2,h),s(3,G)],p);let I=class extends u{static PREFIX="edt mru ";constructor(i,r,t,e){super(I.PREFIX,i,r,t,e)}doGetEditors(){const i=[];for(const r of this.editorService.getEditors(k.MOST_RECENTLY_ACTIVE))i.push(r);return i}};I=m([s(0,E),s(1,v),s(2,h),s(3,G)],I);export{d as ActiveGroupEditorsByMostRecentlyUsedQuickAccess,p as AllEditorsByAppearanceQuickAccess,I as AllEditorsByMostRecentlyUsedQuickAccess,u as BaseEditorQuickAccessProvider};
