var y=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var g=(n,e,t,a)=>{for(var r=a>1?void 0:a?I(e,t):e,l=n.length-1,o;l>=0;l--)(o=n[l])&&(r=(a?o(e,t,r):o(r))||r);return a&&r&&y(e,t,r),r},f=(n,e)=>(t,a)=>e(t,a,n);import*as i from"../../../../nls.js";import*as R from"../../../../base/common/path.js";import{DEFAULT_TERMINAL_OSX as b}from"../../../../platform/externalTerminal/common/externalTerminal.js";import{MenuId as w,MenuRegistry as v}from"../../../../platform/actions/common/actions.js";import{KeyMod as u,KeyCode as S}from"../../../../base/common/keyCodes.js";import{IHistoryService as T}from"../../../services/history/common/history.js";import{KeybindingsRegistry as E,KeybindingWeight as K}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{Schemas as s}from"../../../../base/common/network.js";import{Extensions as z,ConfigurationScope as d}from"../../../../platform/configuration/common/configurationRegistry.js";import{Registry as h}from"../../../../platform/registry/common/platform.js";import{Extensions as A}from"../../../common/contributions.js";import{IExternalTerminalService as x}from"../../../../platform/externalTerminal/electron-sandbox/externalTerminalService.js";import{IConfigurationService as P}from"../../../../platform/configuration/common/configuration.js";import{TerminalContextKeys as k}from"../../terminal/common/terminalContextKey.js";import{IRemoteAuthorityResolverService as W}from"../../../../platform/remote/common/remoteAuthorityResolver.js";import{LifecyclePhase as U}from"../../../services/lifecycle/common/lifecycle.js";const C="workbench.action.terminal.openNativeConsole";E.registerCommandAndKeybindingRule({id:C,primary:u.CtrlCmd|u.Shift|S.KeyC,when:k.notFocus,weight:K.WorkbenchContrib,handler:async n=>{const e=n.get(T),t=n.get(x),a=n.get(P),r=n.get(W),l=e.getLastActiveWorkspaceRoot(),o=a.getValue("terminal.external");if(l?.scheme===s.file){t.openTerminal(o,l.fsPath);return}try{if(l?.scheme===s.vscodeRemote){const c=await r.getCanonicalURI(l);if(c.scheme===s.file){t.openTerminal(o,c.fsPath);return}}}catch{}const p=e.getLastActiveFile(s.file);if(p?.scheme===s.file){t.openTerminal(o,R.dirname(p.fsPath));return}try{if(p?.scheme===s.vscodeRemote){const c=await r.getCanonicalURI(p);if(c.scheme===s.file){t.openTerminal(o,c.fsPath);return}}}catch{}t.openTerminal(o,void 0)}}),v.appendMenuItem(w.CommandPalette,{command:{id:C,title:i.localize2("globalConsoleAction","Open New External Terminal")}});let m=class{constructor(e){this._externalTerminalService=e;this._updateConfiguration()}_serviceBrand;async _updateConfiguration(){const e=await this._externalTerminalService.getDefaultTerminalForPlatforms();h.as(z.Configuration).registerConfiguration({id:"externalTerminal",order:100,title:i.localize("terminalConfigurationTitle","External Terminal"),type:"object",properties:{"terminal.explorerKind":{type:"string",enum:["integrated","external","both"],enumDescriptions:[i.localize("terminal.explorerKind.integrated","Use VS Code's integrated terminal."),i.localize("terminal.explorerKind.external","Use the configured external terminal."),i.localize("terminal.explorerKind.both","Use the other two together.")],description:i.localize("explorer.openInTerminalKind","When opening a file from the Explorer in a terminal, determines what kind of terminal will be launched"),default:"integrated"},"terminal.sourceControlRepositoriesKind":{type:"string",enum:["integrated","external","both"],enumDescriptions:[i.localize("terminal.sourceControlRepositoriesKind.integrated","Use VS Code's integrated terminal."),i.localize("terminal.sourceControlRepositoriesKind.external","Use the configured external terminal."),i.localize("terminal.sourceControlRepositoriesKind.both","Use the other two together.")],description:i.localize("sourceControlRepositories.openInTerminalKind","When opening a repository from the Source Control Repositories view in a terminal, determines what kind of terminal will be launched"),default:"integrated"},"terminal.external.windowsExec":{type:"string",description:i.localize("terminal.external.windowsExec","Customizes which terminal to run on Windows."),default:e.windows,scope:d.APPLICATION},"terminal.external.osxExec":{type:"string",description:i.localize("terminal.external.osxExec","Customizes which terminal application to run on macOS."),default:b,scope:d.APPLICATION},"terminal.external.linuxExec":{type:"string",description:i.localize("terminal.external.linuxExec","Customizes which terminal to run on Linux."),default:e.linux,scope:d.APPLICATION}}})}};m=g([f(0,x)],m);const _=h.as(A.Workbench);_.registerWorkbenchContribution(m,U.Restored);export{m as ExternalTerminalContribution};
