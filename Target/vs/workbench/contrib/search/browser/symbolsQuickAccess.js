var D=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var R=(p,s,e,o)=>{for(var i=o>1?void 0:o?F(s,e):s,r=p.length-1,t;r>=0;r--)(t=p[r])&&(i=(o?t(s,e,i):t(i))||i);return o&&i&&D(s,e,i),i},d=(p,s)=>(e,o)=>s(e,o,p);import{localize as P}from"../../../../nls.js";import{PickerQuickAccessProvider as N,TriggerAction as A}from"../../../../platform/quickinput/browser/pickerQuickAccess.js";import"../../../../base/common/cancellation.js";import"../../../../base/common/lifecycle.js";import{ThrottledDelayer as G}from"../../../../base/common/async.js";import{getWorkspaceSymbols as K}from"../common/search.js";import{SymbolKinds as v,SymbolTag as Y,SymbolKind as l}from"../../../../editor/common/languages.js";import{ILabelService as x}from"../../../../platform/label/common/label.js";import{Schemas as w}from"../../../../base/common/network.js";import{IOpenerService as U}from"../../../../platform/opener/common/opener.js";import{IEditorService as $,SIDE_GROUP as z,ACTIVE_GROUP as V}from"../../../services/editor/common/editorService.js";import{Range as H}from"../../../../editor/common/core/range.js";import{IConfigurationService as X}from"../../../../platform/configuration/common/configuration.js";import"../../../common/editor.js";import"../../../../platform/quickinput/common/quickInput.js";import{ICodeEditorService as j}from"../../../../editor/browser/services/codeEditorService.js";import{getSelectionSearchString as J}from"../../../../editor/contrib/find/browser/findController.js";import{prepareQuery as Z,scoreFuzzy2 as C,pieceToQuery as M}from"../../../../base/common/fuzzyScorer.js";import"../../../../base/common/filters.js";import{Codicon as _}from"../../../../base/common/codicons.js";import{ThemeIcon as W}from"../../../../base/common/themables.js";let c=class extends N{constructor(e,o,i,r,t){super(c.PREFIX,{canAcceptInBackground:!0,noResultsPick:{label:P("noSymbolResults","No matching workspace symbols")}});this.labelService=e;this.openerService=o;this.editorService=i;this.configurationService=r;this.codeEditorService=t}static PREFIX="#";static TYPING_SEARCH_DELAY=200;static TREAT_AS_GLOBAL_SYMBOL_TYPES=new Set([l.Class,l.Enum,l.File,l.Interface,l.Namespace,l.Package,l.Module]);delayer=this._register(new G(c.TYPING_SEARCH_DELAY));get defaultFilterValue(){const e=this.codeEditorService.getFocusedCodeEditor();if(e)return J(e)??void 0}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview,openSideBySideDirection:e?.openSideBySideDirection}}_getPicks(e,o,i){return this.getSymbolPicks(e,void 0,i)}async getSymbolPicks(e,o,i){return this.delayer.trigger(async()=>i.isCancellationRequested?[]:this.doGetSymbolPicks(Z(e),o,i),o?.delay)}async doGetSymbolPicks(e,o,i){let r,t;e.values&&e.values.length>1?(r=M(e.values[0]),t=M(e.values.slice(1))):r=e;const B=await K(r.original,i);if(i.isCancellationRequested)return[];const b=[],E=this.configuration.openSideBySideDirection;for(const{symbol:n,provider:f}of B){if(o?.skipLocal&&!c.TREAT_AS_GLOBAL_SYMBOL_TYPES.has(n.kind)&&n.containerName)continue;const I=n.name,S=`$(${v.toIcon(n.kind).id}) ${I}`,T=S.length-I.length;let a,k,L=!1;if(r.original.length>0&&(r!==e&&([a,k]=C(S,{...e,values:void 0},0,T),typeof a=="number"&&(L=!0)),typeof a!="number"&&([a,k]=C(S,r,0,T),typeof a!="number")))continue;const g=n.location.uri;let m;if(g){const u=this.labelService.getUriLabel(g,{relative:!0});n.containerName?m=`${n.containerName} \u2022 ${u}`:m=u}let h,O;if(!L&&t&&t.original.length>0){if(m&&([h,O]=C(m,t)),typeof h!="number")continue;typeof a=="number"&&(a+=h)}const Q=n.tags?n.tags.indexOf(Y.Deprecated)>=0:!1;b.push({symbol:n,resource:g,score:a,label:S,ariaLabel:I,highlights:Q?void 0:{label:k,description:O},description:m,strikethrough:Q,buttons:[{iconClass:E==="right"?W.asClassName(_.splitHorizontal):W.asClassName(_.splitVertical),tooltip:E==="right"?P("openToSide","Open to the Side"):P("openToBottom","Open to the Bottom")}],trigger:(u,y)=>(this.openSymbol(f,n,i,{keyMods:y,forceOpenSideBySide:!0}),A.CLOSE_PICKER),accept:async(u,y)=>this.openSymbol(f,n,i,{keyMods:u,preserveFocus:y.inBackground,forcePinned:y.inBackground})})}return o?.skipSorting||b.sort((n,f)=>this.compareSymbols(n,f)),b}async openSymbol(e,o,i,r){let t=o;typeof e.resolveWorkspaceSymbol=="function"&&(t=await e.resolveWorkspaceSymbol(o,i)||o,i.isCancellationRequested)||(t.location.uri.scheme===w.http||t.location.uri.scheme===w.https?await this.openerService.open(t.location.uri,{fromUserGesture:!0,allowContributedOpeners:!0}):await this.editorService.openEditor({resource:t.location.uri,options:{preserveFocus:r?.preserveFocus,pinned:r.keyMods.ctrlCmd||r.forcePinned||this.configuration.openEditorPinned,selection:t.location.range?H.collapseToStart(t.location.range):void 0}},r.keyMods.alt||this.configuration.openEditorPinned&&r.keyMods.ctrlCmd||r?.forceOpenSideBySide?z:V))}compareSymbols(e,o){if(typeof e.score=="number"&&typeof o.score=="number"){if(e.score>o.score)return-1;if(e.score<o.score)return 1}if(e.symbol&&o.symbol){const i=e.symbol.name.toLowerCase(),r=o.symbol.name.toLowerCase(),t=i.localeCompare(r);if(t!==0)return t}if(e.symbol&&o.symbol){const i=v.toIcon(e.symbol.kind).id,r=v.toIcon(o.symbol.kind).id;return i.localeCompare(r)}return 0}};c=R([d(0,x),d(1,U),d(2,$),d(3,X),d(4,j)],c);export{c as SymbolsQuickAccessProvider};
