var rt=Object.defineProperty;var st=Object.getOwnPropertyDescriptor;var b=(m,t,e,i)=>{for(var o=i>1?void 0:i?st(t,e):t,a=m.length-1,d;a>=0;a--)(d=m[a])&&(o=(i?d(t,e,o):d(o))||o);return i&&o&&rt(t,e,o),o},s=(m,t)=>(e,i)=>t(e,i,m);import*as n from"../../../../../base/browser/dom.js";import{Disposable as I,DisposableStore as v}from"../../../../../base/common/lifecycle.js";import{Schemas as N}from"../../../../../base/common/network.js";import{IInstantiationService as W}from"../../../../../platform/instantiation/common/instantiation.js";import{getFormattedOutputJSON as M,OutputComparison as q,outputEqual as lt,OUTPUT_EDITOR_HEIGHT_MAGIC as B,PropertyFoldingState as f,SideBySideDiffElementViewModel as ht}from"./diffElementViewModel.js";import{DiffSide as g,DIFF_CELL_MARGIN as X,NOTEBOOK_DIFF_CELL_INPUT as ut,NOTEBOOK_DIFF_CELL_PROPERTY as ct,NOTEBOOK_DIFF_CELL_PROPERTY_EXPANDED as pt,NOTEBOOK_DIFF_CELL_IGNORE_WHITESPACE as ft}from"./notebookDiffEditorBrowser.js";import{CodeEditorWidget as Q}from"../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import{IModelService as $}from"../../../../../editor/common/services/model.js";import{ILanguageService as A}from"../../../../../editor/common/languages/language.js";import{CellEditType as gt,CellUri as K}from"../../common/notebookCommon.js";import"../../../../../base/browser/ui/toolbar/toolbar.js";import{IContextMenuService as H}from"../../../../../platform/contextview/browser/contextView.js";import{IMenuService as w,MenuId as S,MenuItemAction as mt}from"../../../../../platform/actions/common/actions.js";import{IKeybindingService as D}from"../../../../../platform/keybinding/common/keybinding.js";import{INotificationService as O}from"../../../../../platform/notification/common/notification.js";import"../../../../../base/common/actions.js";import{createAndFillInActionBarActions as Z}from"../../../../../platform/actions/browser/menuEntryActionViewItem.js";import{IContextKeyService as x}from"../../../../../platform/contextkey/common/contextkey.js";import{CodiconActionViewItem as _t}from"../view/cellParts/cellActionView.js";import{collapsedIcon as Ct,expandedIcon as yt}from"../notebookIcons.js";import{OutputContainer as k}from"./diffElementOutputs.js";import{EditorExtensionsRegistry as St}from"../../../../../editor/browser/editorExtensions.js";import{ContextMenuController as Et}from"../../../../../editor/contrib/contextmenu/browser/contextmenu.js";import{SnippetController2 as bt}from"../../../../../editor/contrib/snippet/browser/snippetController2.js";import{SuggestController as It}from"../../../../../editor/contrib/suggest/browser/suggestController.js";import{MenuPreventer as vt}from"../../../codeEditor/browser/menuPreventer.js";import{SelectionClipboardContributionID as Mt}from"../../../codeEditor/browser/selectionClipboard.js";import{TabCompletionController as Ht}from"../../../snippets/browser/tabCompletion.js";import{renderIcon as tt,renderLabelWithIcons as et}from"../../../../../base/browser/ui/iconLabel/iconLabels.js";import"../../../../../editor/common/editorCommon.js";import{ITextModelService as P}from"../../../../../editor/common/services/resolverService.js";import{IConfigurationService as z}from"../../../../../platform/configuration/common/configuration.js";import{IThemeService as wt}from"../../../../../platform/theme/common/themeService.js";import{WorkbenchToolBar as Dt}from"../../../../../platform/actions/browser/toolbar.js";import{ITelemetryService as Ot}from"../../../../../platform/telemetry/common/telemetry.js";import{fixedDiffEditorOptions as U,fixedEditorOptions as it,fixedEditorPadding as L,fixedEditorPaddingSingleLineCells as xt}from"./diffCellEditorOptions.js";import{AccessibilityVerbositySettingId as kt}from"../../../accessibility/browser/accessibilityConfiguration.js";import{IAccessibilityService as Lt}from"../../../../../platform/accessibility/common/accessibility.js";import{DiffEditorWidget as j}from"../../../../../editor/browser/widget/diffEditor/diffEditorWidget.js";import{ICommandService as Tt}from"../../../../../platform/commands/common/commands.js";import"./diffNestedCellViewModel.js";import{localize as T}from"../../../../../nls.js";import{Emitter as ot}from"../../../../../base/common/event.js";import{ITextResourceConfigurationService as J}from"../../../../../editor/common/services/textResourceConfiguration.js";import{getFormattedMetadataJSON as at}from"../../common/model/notebookCellTextModel.js";function E(){return{isSimpleWidget:!1,contributions:St.getSomeEditorContributions([vt.ID,Mt,Et.ID,It.ID,bt.ID,Ht.ID])}}class Ae extends I{constructor(t,e){super(),e.body.classList.remove("left","right","full");const i=t.hiddenCells.length===1?T("hiddenCell","{0} hidden cell",t.hiddenCells.length):T("hiddenCells","{0} hidden cells",t.hiddenCells.length);e.placeholder.innerText=i,this._register(n.addDisposableListener(e.placeholder,"dblclick",o=>{o.button===0&&(o.preventDefault(),t.showHiddenCells())})),this._register(e.marginOverlay.onAction(()=>t.showHiddenCells())),e.marginOverlay.show()}}let _=class extends I{constructor(e,i,o,a,d,l,r,h,c,u,p,C,y){super();this.cell=e;this.propertyHeaderContainer=i;this.notebookEditor=o;this.accessor=a;this.contextMenuService=d;this.keybindingService=l;this.commandService=r;this.notificationService=h;this.menuService=c;this.contextKeyService=u;this.themeService=p;this.telemetryService=C;this.accessibilityService=y}_foldingIndicator;_statusSpan;_description;_toolbar;_menu;_propertyExpanded;_propertyChanged;buildHeader(){this._foldingIndicator=n.append(this.propertyHeaderContainer,n.$(".property-folding-indicator")),this._foldingIndicator.classList.add(this.accessor.prefix);const e=n.append(this.propertyHeaderContainer,n.$("div.property-status"));this._statusSpan=n.append(e,n.$("span")),this._description=n.append(e,n.$("span.property-description"));const i=n.append(this.propertyHeaderContainer,n.$("div.property-toolbar"));this._toolbar=this._register(new Dt(i,{actionViewItemProvider:(a,d)=>{if(a instanceof mt)return new _t(a,{hoverDelegate:d.hoverDelegate},this.keybindingService,this.notificationService,this.contextKeyService,this.themeService,this.contextMenuService,this.accessibilityService)}},this.menuService,this.contextKeyService,this.contextMenuService,this.keybindingService,this.commandService,this.telemetryService)),this._toolbar.context={cell:this.cell};const o=this.contextKeyService.createScoped(i);this._register(o),this._propertyChanged=ct.bindTo(o),this._propertyExpanded=pt.bindTo(o),this._menu=this._register(this.menuService.createMenu(this.accessor.menuId,o)),this._register(this._menu.onDidChange(()=>this.updateMenu())),this._register(this.notebookEditor.onMouseUp(a=>{if(!a.event.target||a.target!==this.cell)return;const d=a.event.target;if(d===this.propertyHeaderContainer||d===this._foldingIndicator||this._foldingIndicator.contains(d)||d===e||e.contains(d)){const l=this.accessor.getFoldingState(this.cell);this.accessor.updateFoldingState(this.cell,l===f.Expanded?f.Collapsed:f.Expanded),this._updateFoldingIcon(),this.accessor.updateInfoRendering(this.cell.renderOutput)}})),this.refresh(),this.accessor.updateInfoRendering(this.cell.renderOutput)}refresh(){this.updateMenu(),this._updateFoldingIcon();const e=this.accessor.checkIfModified(this.cell);this._propertyChanged&&this._propertyChanged.set(!!e),e?(this._statusSpan.textContent=this.accessor.changedLabel,this._statusSpan.style.fontWeight="bold",e.reason&&(this._description.textContent=e.reason),this.propertyHeaderContainer.classList.add("modified")):(this._statusSpan.textContent=this.accessor.unChangedLabel,this._statusSpan.style.fontWeight="normal",this._description.textContent="",this.propertyHeaderContainer.classList.remove("modified"))}updateMenu(){if(this.accessor.checkIfModified(this.cell)){const i=[];Z(this._menu,{shouldForwardArgs:!0},i),this._toolbar.setActions(i)}else this._toolbar.setActions([])}_updateFoldingIcon(){this.accessor.getFoldingState(this.cell)===f.Collapsed?(n.reset(this._foldingIndicator,tt(Ct)),this._propertyExpanded?.set(!1)):(n.reset(this._foldingIndicator,tt(yt)),this._propertyExpanded?.set(!0))}};_=b([s(4,H),s(5,D),s(6,Tt),s(7,O),s(8,w),s(9,x),s(10,wt),s(11,Ot),s(12,Lt)],_);class nt extends I{constructor(e,i,o,a,d,l,r,h,c,u,p,C,y,G,Vt){super();this.notebookEditor=e;this.cell=i;this.templateData=o;this.style=a;this.instantiationService=d;this.languageService=l;this.modelService=r;this.textModelService=h;this.contextMenuService=c;this.keybindingService=u;this.notificationService=p;this.menuService=C;this.contextKeyService=y;this.configurationService=G;this.textConfigurationService=Vt;this._isDisposed=!1,this._metadataEditorDisposeStore=this._register(new v),this._outputEditorDisposeStore=this._register(new v),this._register(i.onDidLayoutChange(Y=>{this.layout(Y)})),this._register(i.onDidLayoutChange(Y=>this.updateBorders())),this.init(),this.buildBody(),this._register(i.onDidStateChange(()=>{this.updateOutputRendering(this.cell.renderOutput)}))}_metadataLocalDisposable=this._register(new v);_outputLocalDisposable=this._register(new v);_ignoreMetadata=!1;_ignoreOutputs=!1;_cellHeaderContainer;_editorContainer;_cellHeader;_metadataHeaderContainer;_metadataHeader;_metadataInfoContainer;_metadataEditorContainer;_metadataEditorDisposeStore;_metadataEditor;_outputHeaderContainer;_outputHeader;_outputInfoContainer;_outputEditorContainer;_outputViewContainer;_outputLeftContainer;_outputRightContainer;_outputMetadataContainer;_outputEmptyElement;_outputLeftView;_outputRightView;_outputEditorDisposeStore;_outputEditor;_outputMetadataEditor;_diffEditorContainer;_diagonalFill;_isDisposed;buildBody(){const e=this.templateData.body;switch(this._diffEditorContainer=this.templateData.diffEditorContainer,e.classList.remove("left","right","full"),this.style){case"left":e.classList.add("left");break;case"right":e.classList.add("right");break;default:e.classList.add("full");break}this.styleContainer(this._diffEditorContainer),this.updateSourceEditor(),this.cell.modified&&this._register(this.cell.modified.textModel.onDidChangeContent(()=>this._cellHeader.refresh())),this._ignoreMetadata=this.configurationService.getValue("notebook.diff.ignoreMetadata"),this._ignoreMetadata?this._disposeMetadata():this._buildMetadata(),this._ignoreOutputs=this.configurationService.getValue("notebook.diff.ignoreOutputs")||!!this.notebookEditor.textModel?.transientOptions.transientOutputs,this._ignoreOutputs?this._disposeOutput():this._buildOutput(),this._register(this.configurationService.onDidChangeConfiguration(i=>{let o=!1,a=!1;if(i.affectsConfiguration("notebook.diff.ignoreMetadata")){const d=this.configurationService.getValue("notebook.diff.ignoreMetadata");d!==void 0&&this._ignoreMetadata!==d&&(this._ignoreMetadata=d,this._metadataLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():(this.cell.metadataStatusHeight=25,this._buildMetadata(),this.updateMetadataRendering(),o=!0))}if(i.affectsConfiguration("notebook.diff.ignoreOutputs")){const d=this.configurationService.getValue("notebook.diff.ignoreOutputs");d!==void 0&&this._ignoreOutputs!==(d||this.notebookEditor.textModel?.transientOptions.transientOutputs)&&(this._ignoreOutputs=d||!!this.notebookEditor.textModel?.transientOptions.transientOutputs,this._outputLocalDisposable.clear(),this._ignoreOutputs?(this._disposeOutput(),this.cell.layoutChange()):(this.cell.outputStatusHeight=25,this._buildOutput(),a=!0))}(o||a)&&this.layout({metadataHeight:o,outputTotalHeight:a})}))}updateMetadataRendering(){this.cell.metadataFoldingState===f.Expanded?(this._metadataInfoContainer.style.display="block",!this._metadataEditorContainer||!this._metadataEditor?(this._metadataEditorContainer=n.append(this._metadataInfoContainer,n.$(".metadata-editor-container")),this._buildMetadataEditor()):this.cell.metadataHeight=this._metadataEditor.getContentHeight()):(this._metadataInfoContainer.style.display="none",this.cell.metadataHeight=0)}updateOutputRendering(e){this.cell.outputFoldingState===f.Expanded?(this._outputInfoContainer.style.display="block",e?(this._hideOutputsRaw(),this._buildOutputRendererContainer(),this._showOutputsRenderer(),this._showOutputsEmptyView()):(this._hideOutputsRenderer(),this._buildOutputRawContainer(),this._showOutputsRaw())):(this._outputInfoContainer.style.display="none",this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView())}_buildOutputRawContainer(){this._outputEditorContainer||(this._outputEditorContainer=n.append(this._outputInfoContainer,n.$(".output-editor-container")),this._buildOutputEditor())}_showOutputsRaw(){this._outputEditorContainer&&(this._outputEditorContainer.style.display="block",this.cell.rawOutputHeight=this._outputEditor.getContentHeight())}_showOutputsEmptyView(){this.cell.layoutChange()}_hideOutputsRaw(){this._outputEditorContainer&&(this._outputEditorContainer.style.display="none",this.cell.rawOutputHeight=0)}_hideOutputsEmptyView(){this.cell.layoutChange()}_applySanitizedMetadataChanges(e,i){const o={};try{const a=JSON.parse(i),d=new Set([...Object.keys(a)]);for(const r of d)switch(r){case"inputCollapsed":case"outputCollapsed":typeof a[r]=="boolean"?o[r]=a[r]:o[r]=e[r];break;default:o[r]=a[r];break}const l=this.notebookEditor.textModel.cells.indexOf(this.cell.modified.textModel);if(l<0)return;this.notebookEditor.textModel.applyEdits([{editType:gt.Metadata,index:l,metadata:o}],!0,void 0,()=>{},void 0,!0)}catch{}}async _buildMetadataEditor(){if(this._metadataEditorDisposeStore.clear(),this.cell instanceof ht){this._metadataEditor=this.instantiationService.createInstance(j,this._metadataEditorContainer,{...U,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!1,originalEditable:!1,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:this.cell.layoutInfo.metadataHeight,width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!0,!0)}},{originalEditor:E(),modifiedEditor:E()}),this.layout({metadataHeight:!0}),this._metadataEditorDisposeStore.add(this._metadataEditor),this._metadataEditorContainer?.classList.add("diff");const e=await this.textModelService.createModelReference(K.generateCellPropertyUri(this.cell.originalDocument.uri,this.cell.original.handle,N.vscodeNotebookCellMetadata)),i=await this.textModelService.createModelReference(K.generateCellPropertyUri(this.cell.modifiedDocument.uri,this.cell.modified.handle,N.vscodeNotebookCellMetadata));this._metadataEditor.setModel({original:e.object.textEditorModel,modified:i.object.textEditorModel}),this._metadataEditorDisposeStore.add(e),this._metadataEditorDisposeStore.add(i),this.cell.metadataHeight=this._metadataEditor.getContentHeight(),this._metadataEditorDisposeStore.add(this._metadataEditor.onDidContentSizeChange(a=>{a.contentHeightChanged&&this.cell.metadataFoldingState===f.Expanded&&(this.cell.metadataHeight=a.contentHeight)}));let o=!1;this._metadataEditorDisposeStore.add(i.object.textEditorModel.onDidChangeContent(()=>{o=!0;const a=i.object.textEditorModel.getValue();this._applySanitizedMetadataChanges(this.cell.modified.metadata,a),this._metadataHeader.refresh(),o=!1})),this._metadataEditorDisposeStore.add(this.cell.modified.textModel.onDidChangeMetadata(()=>{if(o)return;const a=at(this.notebookEditor.textModel?.transientOptions.transientCellMetadata,this.cell.modified?.metadata||{},this.cell.modified?.language);i.object.textEditorModel.setValue(a)}));return}else{this._metadataEditor=this.instantiationService.createInstance(Q,this._metadataEditorContainer,{...it,dimension:{width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight},overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!1},{}),this.layout({metadataHeight:!0}),this._metadataEditorDisposeStore.add(this._metadataEditor);const e=this.languageService.createById("jsonc"),i=at(this.notebookEditor.textModel?.transientOptions.transientCellMetadata,this.cell.type==="insert"?this.cell.modified.metadata||{}:this.cell.original.metadata||{}),o=this.cell.type==="insert"?this.cell.modified.uri:this.cell.original.uri,a=this.cell.type==="insert"?this.cell.modified.handle:this.cell.original.handle,d=K.generateCellPropertyUri(o,a,N.vscodeNotebookCellMetadata),l=this.modelService.createModel(i,e,d,!1);this._metadataEditor.setModel(l),this._metadataEditorDisposeStore.add(l),this.cell.metadataHeight=this._metadataEditor.getContentHeight(),this._metadataEditorDisposeStore.add(this._metadataEditor.onDidContentSizeChange(r=>{r.contentHeightChanged&&this.cell.metadataFoldingState===f.Expanded&&(this.cell.metadataHeight=r.contentHeight)}))}}_buildOutputEditor(){if(this._outputEditorDisposeStore.clear(),(this.cell.type==="modified"||this.cell.type==="unchanged")&&!this.notebookEditor.textModel.transientOptions.transientOutputs){const a=M(this.cell.original?.outputs||[]),d=M(this.cell.modified?.outputs||[]);if(a!==d){const l=this.languageService.createById("json"),r=this.modelService.createModel(a,l,void 0,!0),h=this.modelService.createModel(d,l,void 0,!0);this._outputEditorDisposeStore.add(r),this._outputEditorDisposeStore.add(h);const c=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,u=Math.max(r.getLineCount(),h.getLineCount());this._outputEditor=this.instantiationService.createInstance(j,this._outputEditorContainer,{...U,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!0,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:Math.min(B,this.cell.layoutInfo.rawOutputHeight||c*u),width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0)},accessibilityVerbose:this.configurationService.getValue(kt.DiffEditor)??!1},{originalEditor:E(),modifiedEditor:E()}),this._outputEditorDisposeStore.add(this._outputEditor),this._outputEditorContainer?.classList.add("diff"),this._outputEditor.setModel({original:r,modified:h}),this._outputEditor.restoreViewState(this.cell.getOutputEditorViewState()),this.cell.rawOutputHeight=this._outputEditor.getContentHeight(),this._outputEditorDisposeStore.add(this._outputEditor.onDidContentSizeChange(p=>{p.contentHeightChanged&&this.cell.outputFoldingState===f.Expanded&&(this.cell.rawOutputHeight=p.contentHeight)})),this._outputEditorDisposeStore.add(this.cell.modified.textModel.onDidChangeOutputs(()=>{const p=M(this.cell.modified?.outputs||[]);h.setValue(p),this._outputHeader.refresh()}));return}}this._outputEditor=this.instantiationService.createInstance(Q,this._outputEditorContainer,{...it,dimension:{width:Math.min(B,this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,this.cell.type==="unchanged"||this.cell.type==="modified")-32),height:this.cell.layoutInfo.rawOutputHeight},overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode()},{}),this._outputEditorDisposeStore.add(this._outputEditor);const e=this.languageService.createById("json"),i=M(this.notebookEditor.textModel.transientOptions.transientOutputs?[]:this.cell.type==="insert"?this.cell.modified?.outputs||[]:this.cell.original?.outputs||[]),o=this.modelService.createModel(i,e,void 0,!0);this._outputEditorDisposeStore.add(o),this._outputEditor.setModel(o),this._outputEditor.restoreViewState(this.cell.getOutputEditorViewState()),this.cell.rawOutputHeight=this._outputEditor.getContentHeight(),this._outputEditorDisposeStore.add(this._outputEditor.onDidContentSizeChange(a=>{a.contentHeightChanged&&this.cell.outputFoldingState===f.Expanded&&(this.cell.rawOutputHeight=a.contentHeight)}))}layoutNotebookCell(){this.notebookEditor.layoutNotebookCell(this.cell,this.cell.layoutInfo.totalHeight)}updateBorders(){this.templateData.leftBorder.style.height=`${this.cell.layoutInfo.totalHeight-32}px`,this.templateData.rightBorder.style.height=`${this.cell.layoutInfo.totalHeight-32}px`,this.templateData.bottomBorder.style.top=`${this.cell.layoutInfo.totalHeight-32}px`}dispose(){this._outputEditor&&this.cell.saveOutputEditorViewState(this._outputEditor.saveViewState()),this._metadataEditor&&this.cell.saveMetadataEditorViewState(this._metadataEditor.saveViewState()),this._metadataEditorDisposeStore.dispose(),this._outputEditorDisposeStore.dispose(),this._isDisposed=!0,super.dispose()}}class dt extends nt{_editor;cell;templateData;constructor(t,e,i,o,a,d,l,r,h,c,u,p,C,y,G){super(t,e,i,o,a,d,l,r,h,c,u,p,C,y,G),this.cell=e,this.templateData=i,this.updateBorders()}init(){this._diagonalFill=this.templateData.diagonalFill}buildBody(){const t=this.templateData.body;switch(this._diffEditorContainer=this.templateData.diffEditorContainer,t.classList.remove("left","right","full"),this.style){case"left":t.classList.add("left");break;case"right":t.classList.add("right");break;default:t.classList.add("full");break}this.styleContainer(this._diffEditorContainer),this.updateSourceEditor(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():this._buildMetadata(),this.configurationService.getValue("notebook.diff.ignoreOutputs")||this.notebookEditor.textModel?.transientOptions.transientOutputs?this._disposeOutput():this._buildOutput(),this._register(this.configurationService.onDidChangeConfiguration(e=>{let i=!1,o=!1;e.affectsConfiguration("notebook.diff.ignoreMetadata")&&(this._metadataLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():(this.cell.metadataStatusHeight=25,this._buildMetadata(),this.updateMetadataRendering(),i=!0)),e.affectsConfiguration("notebook.diff.ignoreOutputs")&&(this._outputLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreOutputs")||this.notebookEditor.textModel?.transientOptions.transientOutputs?this._disposeOutput():(this.cell.outputStatusHeight=25,this._buildOutput(),o=!0)),(i||o)&&this.layout({metadataHeight:i,outputTotalHeight:o})}))}updateSourceEditor(){this._cellHeaderContainer=this.templateData.cellHeaderContainer,this._cellHeaderContainer.style.display="flex",this._cellHeaderContainer.innerText="",this._editorContainer=this.templateData.editorContainer,this._editorContainer.classList.add("diff");const t=()=>{if(this.cell.cellFoldingState===f.Collapsed){this._editorContainer.style.display="none",this.cell.editorHeight=0;return}const e=this.nestedCellViewModel.textModel.textBuffer.getLineCount(),i=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,o=e*i+L.top+L.bottom;if(this._editorContainer.style.height=`${o}px`,this._editorContainer.style.display="block",this._editor){const a=this._editor.getContentHeight();a>=0&&(this.cell.editorHeight=a);return}this._editor=this.templateData.sourceEditor,this._editor.layout({width:(this.notebookEditor.getLayoutInfo().width-2*X)/2-18,height:o}),this._editor.updateOptions({readOnly:this.readonly}),this.cell.editorHeight=o,this._register(this._editor.onDidContentSizeChange(a=>{this.cell.cellFoldingState===f.Expanded&&a.contentHeightChanged&&this.cell.layoutInfo.editorHeight!==a.contentHeight&&(this.cell.editorHeight=a.contentHeight)})),this._initializeSourceDiffEditor(this.nestedCellViewModel)};this._cellHeader=this._register(this.instantiationService.createInstance(_,this.cell,this._cellHeaderContainer,this.notebookEditor,{updateInfoRendering:()=>t(),checkIfModified:e=>({reason:void 0}),getFoldingState:e=>e.cellFoldingState,updateFoldingState:(e,i)=>e.cellFoldingState=i,unChangedLabel:"Input",changedLabel:"Input",prefix:"input",menuId:S.NotebookDiffCellInputTitle})),this._cellHeader.buildHeader(),t(),this._initializeSourceDiffEditor(this.nestedCellViewModel)}calculateDiagonalFillHeight(){return this.cell.layoutInfo.cellStatusHeight+this.cell.layoutInfo.editorHeight+this.cell.layoutInfo.editorMargin+this.cell.layoutInfo.metadataStatusHeight+this.cell.layoutInfo.metadataHeight+this.cell.layoutInfo.outputTotalHeight+this.cell.layoutInfo.outputStatusHeight}async _initializeSourceDiffEditor(t){const e=await this.textModelService.createModelReference(t.uri);if(this._isDisposed)return;const i=e.object.textEditorModel;this._register(e),this._editor.setModel(i);const o=this.cell.getSourceEditorViewState();o&&this._editor.restoreViewState(o);const a=this._editor.getContentHeight();this.cell.editorHeight=a;const d=`${this.calculateDiagonalFillHeight()}px`;this._diagonalFill.style.height!==d&&(this._diagonalFill.style.height=d)}_disposeMetadata(){this.cell.metadataStatusHeight=0,this.cell.metadataHeight=0,this.templateData.cellHeaderContainer.style.display="none",this.templateData.metadataHeaderContainer.style.display="none",this.templateData.metadataInfoContainer.style.display="none",this._metadataEditor=void 0}_buildMetadata(){this._metadataHeaderContainer=this.templateData.metadataHeaderContainer,this._metadataInfoContainer=this.templateData.metadataInfoContainer,this._metadataHeaderContainer.style.display="flex",this._metadataInfoContainer.style.display="block",this._metadataHeaderContainer.innerText="",this._metadataInfoContainer.innerText="",this._metadataHeader=this.instantiationService.createInstance(_,this.cell,this._metadataHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateMetadataRendering.bind(this),checkIfModified:t=>t.checkMetadataIfModified(),getFoldingState:t=>t.metadataFoldingState,updateFoldingState:(t,e)=>{t.metadataFoldingState=e},unChangedLabel:"Metadata",changedLabel:"Metadata changed",prefix:"metadata",menuId:S.NotebookDiffCellMetadataTitle}),this._metadataLocalDisposable.add(this._metadataHeader),this._metadataHeader.buildHeader()}_buildOutput(){this.templateData.outputHeaderContainer.style.display="flex",this.templateData.outputInfoContainer.style.display="block",this._outputHeaderContainer=this.templateData.outputHeaderContainer,this._outputInfoContainer=this.templateData.outputInfoContainer,this._outputHeaderContainer.innerText="",this._outputInfoContainer.innerText="",this._outputHeader=this.instantiationService.createInstance(_,this.cell,this._outputHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateOutputRendering.bind(this),checkIfModified:t=>t.checkIfOutputsModified(),getFoldingState:t=>t.outputFoldingState,updateFoldingState:(t,e)=>{t.outputFoldingState=e},unChangedLabel:"Outputs",changedLabel:"Outputs changed",prefix:"output",menuId:S.NotebookDiffCellOutputsTitle}),this._outputLocalDisposable.add(this._outputHeader),this._outputHeader.buildHeader()}_disposeOutput(){this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView(),this.cell.rawOutputHeight=0,this.cell.outputMetadataHeight=0,this.cell.outputStatusHeight=0,this.templateData.outputHeaderContainer.style.display="none",this.templateData.outputInfoContainer.style.display="none",this._outputViewContainer=void 0}}let V=class extends dt{constructor(t,e,i,o,a,d,l,r,h,c,u,p,C,y){super(t,e,i,"left",l,o,a,d,r,h,c,u,p,C,y)}get nestedCellViewModel(){return this.cell.original}get readonly(){return!0}styleContainer(t){t.classList.remove("inserted"),t.classList.add("removed")}layout(t){n.scheduleAtNextAnimationFrame(n.getWindow(this._diffEditorContainer),()=>{(t.editorHeight||t.outerWidth)&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.metadataHeight}),(t.outputTotalHeight||t.outerWidth)&&this._outputEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.outputTotalHeight}),this._diagonalFill&&(this._diagonalFill.style.height=`${this.calculateDiagonalFillHeight()}px`),this.layoutNotebookCell()})}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=n.append(this._outputInfoContainer,n.$(".output-view-container")),this._outputEmptyElement=n.append(this._outputViewContainer,n.$(".output-empty-view"));const t=n.append(this._outputEmptyElement,n.$("span"));t.innerText="No outputs to render",this.cell.original?.outputs.length?this._outputEmptyElement.style.display="none":this._outputEmptyElement.style.display="block",this.cell.layoutChange(),this._outputLeftView=this.instantiationService.createInstance(k,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.original,g.Original,this._outputViewContainer),this._register(this._outputLeftView),this._outputLeftView.render();const e=this.notebookEditor.onDidDynamicOutputRendered(i=>{i.cell.uri.toString()===this.cell.original.uri.toString()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),e.dispose())});this._register(e)}this._outputViewContainer.style.display="block"}_decorate(){this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[])}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputLeftView?.showOutputs(),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputLeftView?.hideOutputs())}dispose(){this._editor&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};V=b([s(3,A),s(4,$),s(5,P),s(6,W),s(7,H),s(8,D),s(9,O),s(10,w),s(11,x),s(12,z),s(13,J)],V);let R=class extends dt{constructor(t,e,i,o,a,d,l,r,h,c,u,p,C,y){super(t,e,i,"right",o,a,d,l,r,h,c,u,p,C,y)}get nestedCellViewModel(){return this.cell.modified}get readonly(){return!1}styleContainer(t){t.classList.remove("removed"),t.classList.add("inserted")}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=n.append(this._outputInfoContainer,n.$(".output-view-container")),this._outputEmptyElement=n.append(this._outputViewContainer,n.$(".output-empty-view")),this._outputEmptyElement.innerText="No outputs to render",this.cell.modified?.outputs.length?this._outputEmptyElement.style.display="none":this._outputEmptyElement.style.display="block",this.cell.layoutChange(),this._outputRightView=this.instantiationService.createInstance(k,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.modified,g.Modified,this._outputViewContainer),this._register(this._outputRightView),this._outputRightView.render();const t=this.notebookEditor.onDidDynamicOutputRendered(e=>{e.cell.uri.toString()===this.cell.modified.uri.toString()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[]),t.dispose())});this._register(t)}this._outputViewContainer.style.display="block"}_decorate(){this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[])}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputRightView?.showOutputs(),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputRightView?.hideOutputs())}layout(t){n.scheduleAtNextAnimationFrame(n.getWindow(this._diffEditorContainer),()=>{(t.editorHeight||t.outerWidth)&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight}),(t.outputTotalHeight||t.outerWidth)&&this._outputEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.outputTotalHeight}),this.layoutNotebookCell(),this._diagonalFill&&(this._diagonalFill.style.height=`${this.calculateDiagonalFillHeight()}px`)})}dispose(){this._editor&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};R=b([s(3,W),s(4,A),s(5,$),s(6,P),s(7,H),s(8,D),s(9,O),s(10,w),s(11,x),s(12,z),s(13,J)],R);let F=class extends nt{_editor;_editorViewStateChanged;_toolbar;_menu;cell;templateData;constructor(t,e,i,o,a,d,l,r,h,c,u,p,C,y){super(t,e,i,"full",o,a,d,l,r,h,c,u,p,C,y),this.cell=e,this.templateData=i,this._editorViewStateChanged=!1,this.updateBorders()}init(){}styleContainer(t){t.classList.remove("inserted","removed")}buildBody(){super.buildBody(),this.cell.displayIconToHideUnmodifiedCells?(this._register(this.templateData.marginOverlay.onAction(()=>this.cell.hideUnchangedCells())),this.templateData.marginOverlay.show()):this.templateData.marginOverlay.hide()}_disposeMetadata(){this.cell.metadataStatusHeight=0,this.cell.metadataHeight=0,this.templateData.metadataHeaderContainer.style.display="none",this.templateData.metadataInfoContainer.style.display="none",this._metadataEditor=void 0}_buildMetadata(){this._metadataHeaderContainer=this.templateData.metadataHeaderContainer,this._metadataInfoContainer=this.templateData.metadataInfoContainer,this._metadataHeaderContainer.style.display="flex",this._metadataInfoContainer.style.display="block",this._metadataHeaderContainer.innerText="",this._metadataInfoContainer.innerText="",this._metadataHeader=this.instantiationService.createInstance(_,this.cell,this._metadataHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateMetadataRendering.bind(this),checkIfModified:t=>t.checkMetadataIfModified(),getFoldingState:t=>t.metadataFoldingState,updateFoldingState:(t,e)=>{t.metadataFoldingState=e},unChangedLabel:"Metadata",changedLabel:"Metadata changed",prefix:"metadata",menuId:S.NotebookDiffCellMetadataTitle}),this._metadataLocalDisposable.add(this._metadataHeader),this._metadataHeader.buildHeader()}_disposeOutput(){this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView(),this.cell.rawOutputHeight=0,this.cell.outputMetadataHeight=0,this.cell.outputStatusHeight=0,this.templateData.outputHeaderContainer.style.display="none",this.templateData.outputInfoContainer.style.display="none",this._outputViewContainer=void 0}_buildOutput(){this.templateData.outputHeaderContainer.style.display="flex",this.templateData.outputInfoContainer.style.display="block",this._outputHeaderContainer=this.templateData.outputHeaderContainer,this._outputInfoContainer=this.templateData.outputInfoContainer,this._outputHeaderContainer.innerText="",this._outputInfoContainer.innerText="",this.cell.checkIfOutputsModified()?this._outputInfoContainer.classList.add("modified"):this._outputInfoContainer.classList.remove("modified"),this._outputHeader=this.instantiationService.createInstance(_,this.cell,this._outputHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateOutputRendering.bind(this),checkIfModified:t=>t.checkIfOutputsModified(),getFoldingState:t=>t.outputFoldingState,updateFoldingState:(t,e)=>{t.outputFoldingState=e},unChangedLabel:"Outputs",changedLabel:"Outputs changed",prefix:"output",menuId:S.NotebookDiffCellOutputsTitle}),this._outputLocalDisposable.add(this._outputHeader),this._outputHeader.buildHeader()}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=n.append(this._outputInfoContainer,n.$(".output-view-container")),this._outputEmptyElement=n.append(this._outputViewContainer,n.$(".output-empty-view")),this._outputEmptyElement.innerText="No outputs to render",!this.cell.checkIfOutputsModified()&&this.cell.modified.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this.cell.layoutChange(),this._register(this.cell.modified.textModel.onDidChangeOutputs(()=>{!this.cell.checkIfOutputsModified()&&this.cell.modified.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this._decorate()})),this._outputLeftContainer=n.append(this._outputViewContainer,n.$(".output-view-container-left")),this._outputRightContainer=n.append(this._outputViewContainer,n.$(".output-view-container-right")),this._outputMetadataContainer=n.append(this._outputViewContainer,n.$(".output-view-container-metadata"));const t=this.cell.checkIfOutputsModified(),e=t&&t.kind===q.Metadata&&this.cell.original.outputs.length===1&&this.cell.modified.outputs.length===1&&lt(this.cell.original.outputs[0],this.cell.modified.outputs[0])===q.Metadata;if(t&&!e){const i=this.notebookEditor.onDidDynamicOutputRendered(a=>{a.cell.uri.toString()===this.cell.original.uri.toString()&&this.cell.checkIfOutputsModified()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),i.dispose())}),o=this.notebookEditor.onDidDynamicOutputRendered(a=>{a.cell.uri.toString()===this.cell.modified.uri.toString()&&this.cell.checkIfOutputsModified()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[]),o.dispose())});this._register(i),this._register(o)}if(this._outputLeftView=this.instantiationService.createInstance(k,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.original,g.Original,this._outputLeftContainer),this._outputLeftView.render(),this._register(this._outputLeftView),this._outputRightView=this.instantiationService.createInstance(k,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.modified,g.Modified,this._outputRightContainer),this._outputRightView.render(),this._register(this._outputRightView),t&&!e&&this._decorate(),e){this._outputMetadataContainer.style.top=`${this.cell.layoutInfo.rawOutputHeight}px`,this._outputMetadataEditor=this.instantiationService.createInstance(j,this._outputMetadataContainer,{...U,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!0,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:B,width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0)}},{originalEditor:E(),modifiedEditor:E()}),this._register(this._outputMetadataEditor);const i=JSON.stringify(this.cell.original.outputs[0].metadata??{},void 0,"	"),o=JSON.stringify(this.cell.modified.outputs[0].metadata??{},void 0,"	"),a=this.languageService.createById("json"),d=this.modelService.createModel(i,a,void 0,!0),l=this.modelService.createModel(o,a,void 0,!0);this._outputMetadataEditor.setModel({original:d,modified:l}),this.cell.outputMetadataHeight=this._outputMetadataEditor.getContentHeight(),this._register(this._outputMetadataEditor.onDidContentSizeChange(r=>{this.cell.outputMetadataHeight=r.contentHeight}))}}this._outputViewContainer.style.display="block"}_decorate(){this.cell.checkIfOutputsModified()?(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[])):(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,[],["nb-cellDeleted"]),this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,[],["nb-cellAdded"]))}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputLeftView?.showOutputs(),this._outputRightView?.showOutputs(),this._outputMetadataEditor?.layout({width:this._editor?.getViewWidth()||this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.outputMetadataHeight}),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputLeftView?.hideOutputs(),this._outputRightView?.hideOutputs())}updateSourceEditor(){this._cellHeaderContainer=this.templateData.cellHeaderContainer,this._cellHeaderContainer.style.display="flex",this._cellHeaderContainer.innerText="";const t=this.cell.modified;this._editorContainer=this.templateData.editorContainer,this._editorContainer.classList.add("diff");const e=()=>{if(this.cell.cellFoldingState===f.Collapsed){this._editorContainer.style.display="none",this.cell.editorHeight=0;return}const r=t.textModel.textBuffer.getLineCount(),h=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,c=this.cell.layoutInfo.editorHeight!==0?this.cell.layoutInfo.editorHeight:r*h+L.top+L.bottom;if(this._editorContainer.style.height=`${c}px`,this._editorContainer.style.display="block",this._editor){const u=this._editor.getContentHeight();u>=0&&(this.cell.editorHeight=u);return}this._editor=this.templateData.sourceEditor,r===1&&this._editor.updateOptions({padding:xt}),this._editor.layout({width:this.notebookEditor.getLayoutInfo().width-2*X,height:c}),this._register(this._editor.onDidContentSizeChange(u=>{this.cell.cellFoldingState===f.Expanded&&u.contentHeightChanged&&this.cell.layoutInfo.editorHeight!==u.contentHeight&&(this.cell.editorHeight=u.contentHeight)})),this._initializeSourceDiffEditor()};this._cellHeader=this._register(this.instantiationService.createInstance(_,this.cell,this._cellHeaderContainer,this.notebookEditor,{updateInfoRendering:()=>e(),checkIfModified:r=>r.modified?.textModel.getTextBufferHash()!==r.original?.textModel.getTextBufferHash()?{reason:void 0}:!1,getFoldingState:r=>r.cellFoldingState,updateFoldingState:(r,h)=>r.cellFoldingState=h,unChangedLabel:"Input",changedLabel:"Input changed",prefix:"input",menuId:S.NotebookDiffCellInputTitle})),this._cellHeader.buildHeader(),e();const i=this.contextKeyService.createScoped(this.templateData.inputToolbarContainer);this._register(i);const o=ut.bindTo(i);o.set(this.cell.modified.textModel.getTextBufferHash()!==this.cell.original.textModel.getTextBufferHash());const a=ft.bindTo(i),d=this.textConfigurationService.getValue(this.cell.modified.uri,"diffEditor.ignoreTrimWhitespace");a.set(d),this._toolbar=this.templateData.toolbar,this._toolbar.context={cell:this.cell};const l=()=>{const r=this.textConfigurationService.getValue(this.cell.modified.uri,"diffEditor.ignoreTrimWhitespace");a.set(r);const h=this.cell.modified.textModel.getTextBufferHash()!==this.cell.original.textModel.getTextBufferHash();if(o.set(h),h){const c=[],u=this.menuService.getMenuActions(S.NotebookDiffCellInputTitle,i,{shouldForwardArgs:!0});Z(u,c),this._toolbar.setActions(c)}else this._toolbar.setActions([])};this._register(this.cell.modified.textModel.onDidChangeContent(()=>l())),this._register(this.textConfigurationService.onDidChangeConfiguration(r=>{r.affectsConfiguration(this.cell.modified.uri,"diffEditor")&&r.affectedKeys.has("diffEditor.ignoreTrimWhitespace")&&l()})),l()}async _initializeSourceDiffEditor(){const t=this.cell.original,e=this.cell.modified,i=await this.textModelService.createModelReference(t.uri),o=await this.textModelService.createModelReference(e.uri);if(this._isDisposed)return;const a=i.object.textEditorModel,d=o.object.textEditorModel;this._register(i),this._register(o),this._editor.setModel({original:a,modified:d});const l=()=>{this._editorViewStateChanged=!0},r=u=>{(u.scrollTopChanged||u.scrollLeftChanged)&&(this._editorViewStateChanged=!0)};this.updateEditorOptionsForWhitespace(),this._register(this._editor.getOriginalEditor().onDidChangeCursorSelection(l)),this._register(this._editor.getOriginalEditor().onDidScrollChange(r)),this._register(this._editor.getModifiedEditor().onDidChangeCursorSelection(l)),this._register(this._editor.getModifiedEditor().onDidScrollChange(r));const h=this.cell.getSourceEditorViewState();h&&this._editor.restoreViewState(h);const c=this._editor.getContentHeight();this.cell.editorHeight=c}updateEditorOptionsForWhitespace(){const t=this._editor;if(!t)return;const e=t.getModel()?.modified.uri||t.getModel()?.original.uri;if(!e)return;const i=this.textConfigurationService.getValue(e,"diffEditor.ignoreTrimWhitespace");t.updateOptions({ignoreTrimWhitespace:i}),this._register(this.textConfigurationService.onDidChangeConfiguration(o=>{if(o.affectsConfiguration(e,"diffEditor")&&o.affectedKeys.has("diffEditor.ignoreTrimWhitespace")){const a=this.textConfigurationService.getValue(e,"diffEditor.ignoreTrimWhitespace");t.updateOptions({ignoreTrimWhitespace:a})}}))}layout(t){n.scheduleAtNextAnimationFrame(n.getWindow(this._diffEditorContainer),()=>{t.editorHeight&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this._editor.getViewWidth(),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditorContainer&&(this._metadataEditorContainer.style.height=`${this.cell.layoutInfo.metadataHeight}px`,this._metadataEditor?.layout({width:this._editor?.getViewWidth()||this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight})),(t.outputTotalHeight||t.outerWidth)&&(this._outputEditorContainer&&(this._outputEditorContainer.style.height=`${this.cell.layoutInfo.outputTotalHeight}px`,this._outputEditor?.layout({width:this._editor?.getViewWidth()||this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.outputTotalHeight})),this._outputMetadataContainer&&(this._outputMetadataContainer.style.height=`${this.cell.layoutInfo.outputMetadataHeight}px`,this._outputMetadataContainer.style.top=`${this.cell.layoutInfo.outputTotalHeight-this.cell.layoutInfo.outputMetadataHeight}px`,this._outputMetadataEditor?.layout({width:this._editor?.getViewWidth()||this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.outputMetadataHeight}))),this.layoutNotebookCell()})}dispose(){this._editor&&this._editor.setModel(null),this._editor&&this._editorViewStateChanged&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};F=b([s(3,W),s(4,A),s(5,$),s(6,P),s(7,H),s(8,D),s(9,O),s(10,w),s(11,x),s(12,z),s(13,J)],F);class Ke extends I{constructor(e){super();this.container=e;this._nodes.root.style.display="none",e.appendChild(this._nodes.root)}_nodes=n.h("div.diff-hidden-cells",[n.h("div.center@content",{style:{display:"flex"}},[n.$("a",{title:T("showUnchangedCells","Show Unchanged Cells"),role:"button",onclick:()=>{this._action.fire()}},...et("$(unfold)"))])]);_action=this._register(new ot);onAction=this._action.event;show(){this._nodes.root.style.display="block"}hide(){this._nodes.root.style.display="none"}dispose(){this.hide(),this.container.removeChild(this._nodes.root),n.reset(this._nodes.root),super.dispose()}}class Pe extends I{constructor(e){super();this.container=e;this._nodes.root.style.display="none",e.appendChild(this._nodes.root)}_nodes=n.h("div.diff-hidden-cells",[n.h("div.center@content",{style:{display:"flex"}},[n.$("a",{title:T("hideUnchangedCells","Hide Unchanged Cells"),role:"button",onclick:()=>{this._action.fire()}},...et("$(fold)"))])]);_action=this._register(new ot);onAction=this._action.event;show(){this._nodes.root.style.display="block"}hide(){this._nodes.root.style.display="none"}dispose(){this.hide(),this.container.removeChild(this._nodes.root),n.reset(this._nodes.root),super.dispose()}}export{Ae as CellDiffPlaceholderElement,Ke as CollapsedCellOverlayWidget,V as DeletedElement,R as InsertElement,F as ModifiedElement,Pe as UnchangedCellOverlayWidget,E as getOptimizedNestedCodeEditorWidgetOptions};
