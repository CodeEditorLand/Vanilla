var le=Object.defineProperty;var ge=Object.getOwnPropertyDescriptor;var U=(p,y,d,i)=>{for(var t=i>1?void 0:i?ge(y,d):y,e=p.length-1,r;e>=0;e--)(r=p[e])&&(t=(i?r(y,d,t):r(t))||t);return i&&t&&le(y,d,t),t},O=(p,y)=>(d,i)=>y(d,i,p);import{KeyChord as P,KeyCode as l,KeyMod as f}from"../../../../base/common/keyCodes.js";import{Disposable as V,DisposableStore as ue,MutableDisposable as Se}from"../../../../base/common/lifecycle.js";import{Schemas as pe}from"../../../../base/common/network.js";import{isBoolean as Ee,isObject as me,isString as $}from"../../../../base/common/types.js";import{URI as fe}from"../../../../base/common/uri.js";import"./media/preferences.css";import{EditorContributionInstantiation as he,registerEditorContribution as ye}from"../../../../editor/browser/editorExtensions.js";import{Context as M}from"../../../../editor/contrib/suggest/browser/suggest.js";import*as o from"../../../../nls.js";import{Action2 as s,MenuId as g,MenuRegistry as F,registerAction2 as c}from"../../../../platform/actions/common/actions.js";import{CommandsRegistry as W,ICommandService as B}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr as a}from"../../../../platform/contextkey/common/contextkey.js";import{InputFocusedContext as Ie,IsMacNativeContext as _e}from"../../../../platform/contextkey/common/contextkeys.js";import{SyncDescriptor as Q}from"../../../../platform/instantiation/common/descriptors.js";import{IInstantiationService as Ce}from"../../../../platform/instantiation/common/instantiation.js";import{KeybindingsRegistry as _,KeybindingWeight as u}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{ILabelService as be}from"../../../../platform/label/common/label.js";import{Registry as R}from"../../../../platform/registry/common/platform.js";import{IWorkspaceContextService as Oe,WorkbenchState as Z}from"../../../../platform/workspace/common/workspace.js";import{PICK_WORKSPACE_FOLDER_COMMAND_ID as L}from"../../../browser/actions/workspaceCommands.js";import{EditorPaneDescriptor as ee}from"../../../browser/editor.js";import{Extensions as ve,WorkbenchPhase as te,registerWorkbenchContribution2 as ne}from"../../../common/contributions.js";import{EditorExtensions as x}from"../../../common/editor.js";import"../../../common/editor/editorInput.js";import{ResourceContextKey as N,RemoteNameContext as ie,WorkbenchStateContext as D}from"../../../common/contextkeys.js";import{ExplorerFolderContext as Te,ExplorerRootContext as Ne}from"../../files/common/files.js";import{KeybindingsEditor as m}from"./keybindingsEditor.js";import{ConfigureLanguageBasedSettingsAction as K}from"./preferencesActions.js";import{SettingsEditorContribution as re}from"./preferencesEditor.js";import{preferencesOpenSettingsIcon as A}from"./preferencesIcons.js";import{SettingsEditor2 as b,SettingsFocusContext as Y}from"./settingsEditor2.js";import{CONTEXT_KEYBINDINGS_EDITOR as h,CONTEXT_KEYBINDINGS_SEARCH_FOCUS as J,CONTEXT_KEYBINDING_FOCUS as v,CONTEXT_SETTINGS_EDITOR as T,CONTEXT_SETTINGS_JSON_EDITOR as oe,CONTEXT_SETTINGS_ROW_FOCUS as se,CONTEXT_SETTINGS_SEARCH_FOCUS as G,CONTEXT_TOC_ROW_FOCUS as De,CONTEXT_WHEN_FOCUS as z,KEYBINDINGS_EDITOR_COMMAND_ACCEPT_WHEN as Ae,KEYBINDINGS_EDITOR_COMMAND_ADD as we,KEYBINDINGS_EDITOR_COMMAND_CLEAR_SEARCH_HISTORY as Re,KEYBINDINGS_EDITOR_COMMAND_CLEAR_SEARCH_RESULTS as Ke,KEYBINDINGS_EDITOR_COMMAND_COPY as ke,KEYBINDINGS_EDITOR_COMMAND_COPY_COMMAND as Pe,KEYBINDINGS_EDITOR_COMMAND_COPY_COMMAND_TITLE as Me,KEYBINDINGS_EDITOR_COMMAND_DEFINE as Fe,KEYBINDINGS_EDITOR_COMMAND_DEFINE_WHEN as We,KEYBINDINGS_EDITOR_COMMAND_FOCUS_KEYBINDINGS as xe,KEYBINDINGS_EDITOR_COMMAND_RECORD_SEARCH_KEYS as Ge,KEYBINDINGS_EDITOR_COMMAND_REJECT_WHEN as ze,KEYBINDINGS_EDITOR_COMMAND_REMOVE as Ue,KEYBINDINGS_EDITOR_COMMAND_RESET as Be,KEYBINDINGS_EDITOR_COMMAND_SEARCH as Le,KEYBINDINGS_EDITOR_COMMAND_SHOW_SIMILAR as Ye,KEYBINDINGS_EDITOR_COMMAND_SORTBY_PRECEDENCE as Je,KEYBINDINGS_EDITOR_SHOW_DEFAULT_KEYBINDINGS as qe,KEYBINDINGS_EDITOR_SHOW_EXTENSION_KEYBINDINGS as He,KEYBINDINGS_EDITOR_SHOW_USER_KEYBINDINGS as je,REQUIRE_TRUSTED_WORKSPACE_SETTING_TAG as Xe,SETTINGS_EDITOR_COMMAND_CLEAR_SEARCH_RESULTS as Ve,SETTINGS_EDITOR_COMMAND_SHOW_CONTEXT_MENU as $e}from"../common/preferences.js";import{PreferencesContribution as ce}from"../common/preferencesContribution.js";import{IEditorService as S}from"../../../services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as Qe}from"../../../services/environment/common/environmentService.js";import{IExtensionService as Ze}from"../../../services/extensions/common/extensions.js";import{LifecyclePhase as et}from"../../../services/lifecycle/common/lifecycle.js";import{KeybindingsEditorInput as q}from"../../../services/preferences/browser/keybindingsEditorInput.js";import{DEFINE_KEYBINDING_EDITOR_CONTRIB_ID as tt,IPreferencesService as E}from"../../../services/preferences/common/preferences.js";import{SettingsEditor2Input as H}from"../../../services/preferences/common/preferencesEditorInput.js";import{IUserDataProfileService as ae,CURRENT_PROFILE_CONTEXT as nt}from"../../../services/userDataProfile/common/userDataProfile.js";import{IUserDataProfilesService as de}from"../../../../platform/userDataProfile/common/userDataProfile.js";import{isCodeEditor as it}from"../../../../editor/browser/editorBrowser.js";import{Categories as rt}from"../../../../platform/action/common/actionCommonCategories.js";const ot="settings.action.search",st="settings.action.focusSettingsFile",ct="settings.action.focusSettingsFromSearch",at="settings.action.focusSettingsList",dt="settings.action.focusTOC",lt="settings.action.focusSettingControl",gt="settings.action.focusLevelUp",ut="settings.switchToJSON",St="settings.filterByOnline",pt="settings.filterUntrusted",Et="workbench.action.openSettings",mt="settings.filterByTelemetry";R.as(x.EditorPane).registerEditorPane(ee.create(b,b.ID,o.localize("settingsEditor2","Settings Editor 2")),[new Q(H)]),R.as(x.EditorPane).registerEditorPane(ee.create(m,m.ID,o.localize("keybindingsEditor","Keybindings Editor")),[new Q(q)]);class ft{canSerialize(y){return!0}serialize(y){return""}deserialize(y){return y.createInstance(q)}}class ht{canSerialize(y){return!0}serialize(y){return""}deserialize(y){return y.createInstance(H)}}R.as(x.EditorFactory).registerEditorSerializer(q.ID,ft),R.as(x.EditorFactory).registerEditorSerializer(H.ID,ht);const j=o.localize2("openSettings2","Open Settings (UI)"),yt=o.localize2("openUserSettingsJson","Open User Settings (JSON)"),It=o.localize2("openApplicationSettingsJson","Open Application Settings (JSON)"),I=rt.Preferences;function X(p){return Ee(p)?p:void 0}function _t(p){return $(p)?p:void 0}function C(p){me(p)||(p={});let y={focusSearch:X(p?.focusSearch),openToSide:X(p?.openToSide),query:_t(p?.query)};return $(p?.revealSetting?.key)&&(y={...y,revealSetting:{key:p.revealSetting.key,edit:X(p.revealSetting?.edit)}}),y}let w=class extends V{constructor(d,i,t,e,r,n,bt){super();this.environmentService=d;this.userDataProfileService=i;this.preferencesService=t;this.workspaceContextService=e;this.labelService=r;this.extensionService=n;this.userDataProfilesService=bt;this.registerSettingsActions(),this.registerKeybindingsActions(),this.updatePreferencesEditorMenuItem(),this._register(e.onDidChangeWorkbenchState(()=>this.updatePreferencesEditorMenuItem())),this._register(e.onDidChangeWorkspaceFolders(()=>this.updatePreferencesEditorMenuItemForWorkspaceFolders()))}static ID="workbench.contrib.preferencesActions";registerSettingsActions(){this._register(c(class extends s{constructor(){super({id:Et,title:{...o.localize2("settings","Settings"),mnemonicTitle:o.localize({key:"miOpenSettings",comment:["&& denotes a mnemonic"]},"&&Settings")},keybinding:{weight:u.WorkbenchContrib,when:null,primary:f.CtrlCmd|l.Comma},menu:[{id:g.GlobalActivity,group:"2_configuration",order:2},{id:g.MenubarPreferencesMenu,group:"2_configuration",order:2}]})}run(i,t){const e=typeof t=="string"?{query:t}:C(t);return i.get(E).openSettings(e)}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openSettings2",title:o.localize2("openSettings2","Open Settings (UI)"),category:I,f1:!0})}run(i,t){return t=C(t),i.get(E).openSettings({jsonEditor:!1,...t})}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openSettingsJson",title:yt,metadata:{description:o.localize2("workbench.action.openSettingsJson.description","Opens the JSON file containing the current user profile settings")},category:I,f1:!0})}run(i,t){return t=C(t),i.get(E).openSettings({jsonEditor:!0,...t})}}));const d=this;this._register(c(class extends s{constructor(){super({id:"workbench.action.openApplicationSettingsJson",title:It,category:I,menu:{id:g.CommandPalette,when:a.notEquals(nt.key,d.userDataProfilesService.defaultProfile.id)}})}run(i,t){return t=C(t),i.get(E).openApplicationSettings({jsonEditor:!0,...t})}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openGlobalSettings",title:o.localize2("openGlobalSettings","Open User Settings"),category:I,f1:!0})}run(i,t){return t=C(t),i.get(E).openUserSettings(t)}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openRawDefaultSettings",title:o.localize2("openRawDefaultSettings","Open Default Settings (JSON)"),category:I,f1:!0})}run(i){return i.get(E).openRawDefaultSettings()}})),this._register(c(class extends s{constructor(){super({id:K.ID,title:K.LABEL,category:I,f1:!0})}run(i){return i.get(Ce).createInstance(K,K.ID,K.LABEL.value).run()}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openWorkspaceSettings",title:o.localize2("openWorkspaceSettings","Open Workspace Settings"),category:I,menu:{id:g.CommandPalette,when:D.notEqualsTo("empty")}})}run(i,t){return t=typeof t=="string"?{query:t}:C(t),i.get(E).openWorkspaceSettings(t)}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openAccessibilitySettings",title:o.localize2("openAccessibilitySettings","Open Accessibility Settings"),category:I,menu:{id:g.CommandPalette,when:D.notEqualsTo("empty")}})}async run(i){await i.get(E).openSettings({jsonEditor:!1,query:"@tag:accessibility"})}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openWorkspaceSettingsFile",title:o.localize2("openWorkspaceSettingsFile","Open Workspace Settings (JSON)"),category:I,menu:{id:g.CommandPalette,when:D.notEqualsTo("empty")}})}run(i,t){return t=C(t),i.get(E).openWorkspaceSettings({jsonEditor:!0,...t})}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openFolderSettings",title:o.localize2("openFolderSettings","Open Folder Settings"),category:I,menu:{id:g.CommandPalette,when:D.isEqualTo("workspace")}})}async run(i,t){const e=i.get(B),r=i.get(E),n=await e.executeCommand(L);n&&(t=C(t),await r.openFolderSettings({folderUri:n.uri,...t}))}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openFolderSettingsFile",title:o.localize2("openFolderSettingsFile","Open Folder Settings (JSON)"),category:I,menu:{id:g.CommandPalette,when:D.isEqualTo("workspace")}})}async run(i,t){const e=i.get(B),r=i.get(E),n=await e.executeCommand(L);n&&(t=C(t),await r.openFolderSettings({folderUri:n.uri,jsonEditor:!0,...t}))}})),this._register(c(class extends s{constructor(){super({id:"_workbench.action.openFolderSettings",title:o.localize("openFolderSettings","Open Folder Settings"),category:I,menu:{id:g.ExplorerContext,group:"2_workspace",order:20,when:a.and(Ne,Te)}})}async run(i,t){if(fe.isUri(t))await i.get(E).openFolderSettings({folderUri:t});else{const e=i.get(B),r=i.get(E),n=await e.executeCommand(L);n&&await r.openFolderSettings({folderUri:n.uri})}}})),this._register(c(class extends s{constructor(){super({id:St,title:o.localize({key:"miOpenOnlineSettings",comment:["&& denotes a mnemonic"]},"&&Online Services Settings"),menu:{id:g.MenubarPreferencesMenu,group:"3_settings",order:1}})}run(i){const t=i.get(S).activeEditorPane;t instanceof b?t.focusSearch("@tag:usesOnlineServices"):i.get(E).openSettings({jsonEditor:!1,query:"@tag:usesOnlineServices"})}})),this._register(c(class extends s{constructor(){super({id:pt,title:o.localize2("filterUntrusted","Show untrusted workspace settings")})}run(i){i.get(E).openWorkspaceSettings({jsonEditor:!1,query:`@tag:${Xe}`})}})),this._register(c(class extends s{constructor(){super({id:mt,title:o.localize({key:"miOpenTelemetrySettings",comment:["&& denotes a mnemonic"]},"&&Telemetry Settings")})}run(i){const t=i.get(S).activeEditorPane;t instanceof b?t.focusSearch("@tag:telemetry"):i.get(E).openSettings({jsonEditor:!1,query:"@tag:telemetry"})}})),this.registerSettingsEditorActions(),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{const i=this.environmentService.remoteAuthority,t=this.labelService.getHostLabel(pe.vscodeRemote,i)||i;this._register(c(class extends s{constructor(){super({id:"workbench.action.openRemoteSettings",title:o.localize2("openRemoteSettings","Open Remote Settings ({0})",t),category:I,menu:{id:g.CommandPalette,when:ie.notEqualsTo("")}})}run(e,r){return r=C(r),e.get(E).openRemoteSettings(r)}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openRemoteSettingsFile",title:o.localize2("openRemoteSettingsJSON","Open Remote Settings (JSON) ({0})",t),category:I,menu:{id:g.CommandPalette,when:ie.notEqualsTo("")}})}run(e,r){return r=C(r),e.get(E).openRemoteSettings({jsonEditor:!0,...r})}}))})}registerSettingsEditorActions(){function d(t){const e=t.get(S).activeEditorPane;return e instanceof b?e:null}function i(t){d(t)?.focusSearch()}this._register(c(class extends s{constructor(){super({id:ot,precondition:T,keybinding:{primary:f.CtrlCmd|l.KeyF,weight:u.EditorContrib,when:null},category:I,f1:!0,title:o.localize2("settings.focusSearch","Focus Settings Search")})}run(t){i(t)}})),this._register(c(class extends s{constructor(){super({id:Ve,precondition:T,keybinding:{primary:l.Escape,weight:u.EditorContrib,when:G},category:I,f1:!0,title:o.localize2("settings.clearResults","Clear Settings Search Results")})}run(t){d(t)?.clearSearchResults()}})),this._register(c(class extends s{constructor(){super({id:st,precondition:a.and(G,M.Visible.toNegated()),keybinding:{primary:l.DownArrow,weight:u.EditorContrib,when:null},title:o.localize("settings.focusFile","Focus settings file")})}run(t,e){d(t)?.focusSettings()}})),this._register(c(class extends s{constructor(){super({id:ct,precondition:a.and(G,M.Visible.toNegated()),keybinding:{primary:l.DownArrow,weight:u.WorkbenchContrib,when:null},title:o.localize("settings.focusFile","Focus settings file")})}run(t,e){d(t)?.focusSettings()}})),this._register(c(class extends s{constructor(){super({id:at,precondition:a.and(T,De),keybinding:{primary:l.Enter,weight:u.WorkbenchContrib,when:null},title:o.localize("settings.focusSettingsList","Focus settings list")})}run(t){const e=d(t);e instanceof b&&e.focusSettings()}})),this._register(c(class extends s{constructor(){super({id:dt,precondition:T,f1:!0,keybinding:[{primary:l.LeftArrow,weight:u.WorkbenchContrib,when:se}],category:I,title:o.localize2("settings.focusSettingsTOC","Focus Settings Table of Contents")})}run(t){const e=d(t);e instanceof b&&e.focusTOC()}})),this._register(c(class extends s{constructor(){super({id:lt,precondition:a.and(T,se),keybinding:{primary:l.Enter,weight:u.WorkbenchContrib},title:o.localize("settings.focusSettingControl","Focus Setting Control")})}run(t){const e=d(t);if(!(e instanceof b))return;e.getContainer()?.ownerDocument.activeElement?.classList.contains("monaco-list")&&e.focusSettings(!0)}})),this._register(c(class extends s{constructor(){super({id:$e,precondition:T,keybinding:{primary:f.Shift|l.F9,weight:u.WorkbenchContrib,when:null},f1:!0,category:I,title:o.localize2("settings.showContextMenu","Show Setting Context Menu")})}run(t){const e=d(t);e instanceof b&&e.showContextMenu()}})),this._register(c(class extends s{constructor(){super({id:gt,precondition:a.and(T,G.toNegated(),oe.toNegated()),keybinding:{primary:l.Escape,weight:u.WorkbenchContrib,when:null},f1:!0,category:I,title:o.localize2("settings.focusLevelUp","Move Focus Up One Level")})}run(t){const e=d(t);e instanceof b&&(e.currentFocusContext===Y.SettingControl?e.focusSettings():e.currentFocusContext===Y.SettingTree?e.focusTOC():e.currentFocusContext===Y.TableOfContents&&e.focusSearch())}}))}registerKeybindingsActions(){const d=this,i=o.localize2("preferences","Preferences"),t="workbench.action.openGlobalKeybindings";this._register(c(class extends s{constructor(){super({id:t,title:o.localize2("openGlobalKeybindings","Open Keyboard Shortcuts"),shortTitle:o.localize("keyboardShortcuts","Keyboard Shortcuts"),category:i,icon:A,keybinding:{when:null,weight:u.WorkbenchContrib,primary:P(f.CtrlCmd|l.KeyK,f.CtrlCmd|l.KeyS)},menu:[{id:g.CommandPalette},{id:g.EditorTitle,when:N.Resource.isEqualTo(d.userDataProfileService.currentProfile.keybindingsResource.toString()),group:"navigation",order:1},{id:g.GlobalActivity,group:"2_configuration",order:4}]})}run(e,r){const n=typeof r=="string"?r:void 0;return e.get(E).openGlobalKeybindingSettings(!1,{query:n})}})),this._register(F.appendMenuItem(g.MenubarPreferencesMenu,{command:{id:t,title:o.localize("keyboardShortcuts","Keyboard Shortcuts")},group:"2_configuration",order:4})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openDefaultKeybindingsFile",title:o.localize2("openDefaultKeybindingsFile","Open Default Keyboard Shortcuts (JSON)"),category:i,menu:{id:g.CommandPalette}})}run(e){return e.get(E).openDefaultKeybindingsFile()}})),this._register(c(class extends s{constructor(){super({id:"workbench.action.openGlobalKeybindingsFile",title:o.localize2("openGlobalKeybindingsFile","Open Keyboard Shortcuts (JSON)"),category:i,icon:A,menu:[{id:g.CommandPalette},{id:g.EditorTitle,when:a.and(h),group:"navigation"}]})}run(e){return e.get(E).openGlobalKeybindingSettings(!0)}})),this._register(c(class extends s{constructor(){super({id:qe,title:o.localize2("showDefaultKeybindings","Show System Keybindings"),menu:[{id:g.EditorTitle,when:a.and(h),group:"1_keyboard_preferences_actions"}]})}run(e){const r=e.get(S).activeEditorPane;r instanceof m&&r.search("@source:system")}})),this._register(c(class extends s{constructor(){super({id:He,title:o.localize2("showExtensionKeybindings","Show Extension Keybindings"),menu:[{id:g.EditorTitle,when:a.and(h),group:"1_keyboard_preferences_actions"}]})}run(e){const r=e.get(S).activeEditorPane;r instanceof m&&r.search("@source:extension")}})),this._register(c(class extends s{constructor(){super({id:je,title:o.localize2("showUserKeybindings","Show User Keybindings"),menu:[{id:g.EditorTitle,when:a.and(h),group:"1_keyboard_preferences_actions"}]})}run(e){const r=e.get(S).activeEditorPane;r instanceof m&&r.search("@source:user")}})),this._register(c(class extends s{constructor(){super({id:Ke,title:o.localize("clear","Clear Search Results"),keybinding:{weight:u.WorkbenchContrib,when:a.and(h,J),primary:l.Escape}})}run(e){const r=e.get(S).activeEditorPane;r instanceof m&&r.clearSearchResults()}})),this._register(c(class extends s{constructor(){super({id:Re,title:o.localize("clearHistory","Clear Keyboard Shortcuts Search History"),category:i,menu:[{id:g.CommandPalette,when:a.and(h)}]})}run(e){const r=e.get(S).activeEditorPane;r instanceof m&&r.clearKeyboardShortcutSearchHistory()}})),this.registerKeybindingEditorActions()}registerKeybindingEditorActions(){const d=this;_.registerCommandAndKeybindingRule({id:Fe,weight:u.WorkbenchContrib,when:a.and(h,v,z.toNegated()),primary:l.Enter,handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.defineKeybinding(n.activeKeybindingEntry,!1)}}),_.registerCommandAndKeybindingRule({id:we,weight:u.WorkbenchContrib,when:a.and(h,v),primary:P(f.CtrlCmd|l.KeyK,f.CtrlCmd|l.KeyA),handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.defineKeybinding(n.activeKeybindingEntry,!0)}}),_.registerCommandAndKeybindingRule({id:We,weight:u.WorkbenchContrib,when:a.and(h,v),primary:P(f.CtrlCmd|l.KeyK,f.CtrlCmd|l.KeyE),handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.activeKeybindingEntry.keybindingItem.keybinding&&n.defineWhenExpression(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Ue,weight:u.WorkbenchContrib,when:a.and(h,v,Ie.toNegated()),primary:l.Delete,mac:{primary:f.CtrlCmd|l.Backspace},handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.removeKeybinding(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Be,weight:u.WorkbenchContrib,when:a.and(h,v),primary:0,handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.resetKeybinding(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Le,weight:u.WorkbenchContrib,when:a.and(h),primary:f.CtrlCmd|l.KeyF,handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.focusSearch()}}),_.registerCommandAndKeybindingRule({id:Ge,weight:u.WorkbenchContrib,when:a.and(h,J),primary:f.Alt|l.KeyK,mac:{primary:f.CtrlCmd|f.Alt|l.KeyK},handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.recordSearchKeys()}}),_.registerCommandAndKeybindingRule({id:Je,weight:u.WorkbenchContrib,when:a.and(h),primary:f.Alt|l.KeyP,mac:{primary:f.CtrlCmd|f.Alt|l.KeyP},handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.toggleSortByPrecedence()}}),_.registerCommandAndKeybindingRule({id:Ye,weight:u.WorkbenchContrib,when:a.and(h,v),primary:0,handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.showSimilarKeybindings(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:ke,weight:u.WorkbenchContrib,when:a.and(h,v,z.negate()),primary:f.CtrlCmd|l.KeyC,handler:async(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&await n.copyKeybinding(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Pe,weight:u.WorkbenchContrib,when:a.and(h,v),primary:0,handler:async(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&await n.copyKeybindingCommand(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Me,weight:u.WorkbenchContrib,when:a.and(h,v),primary:0,handler:async(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&await n.copyKeybindingCommandTitle(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:xe,weight:u.WorkbenchContrib,when:a.and(h,J),primary:f.CtrlCmd|l.DownArrow,handler:(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.focusKeybindings()}}),_.registerCommandAndKeybindingRule({id:ze,weight:u.WorkbenchContrib,when:a.and(h,z,M.Visible.toNegated()),primary:l.Escape,handler:async(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.rejectWhenExpression(n.activeKeybindingEntry)}}),_.registerCommandAndKeybindingRule({id:Ae,weight:u.WorkbenchContrib,when:a.and(h,z,M.Visible.toNegated()),primary:l.Enter,handler:async(e,r)=>{const n=e.get(S).activeEditorPane;n instanceof m&&n.acceptWhenExpression(n.activeKeybindingEntry)}});const i=this._register(new ue),t=()=>{i.clear(),i.add(c(class extends s{constructor(){const r=N.Resource.isEqualTo(d.userDataProfileService.currentProfile.keybindingsResource.toString());super({id:"editor.action.defineKeybinding",title:o.localize2("defineKeybinding.start","Define Keybinding"),f1:!0,precondition:r,keybinding:{weight:u.WorkbenchContrib,when:r,primary:P(f.CtrlCmd|l.KeyK,f.CtrlCmd|l.KeyK)},menu:{id:g.EditorContent,when:r}})}async run(r){const n=r.get(S).activeTextEditorControl;it(n)&&n.getContribution(tt)?.showDefineKeybindingWidget()}}))};t(),this._register(this.userDataProfileService.onDidChangeCurrentProfile(()=>t()))}updatePreferencesEditorMenuItem(){const d="_workbench.openWorkspaceSettingsEditor";this.workspaceContextService.getWorkbenchState()===Z.WORKSPACE&&!W.getCommand(d)&&(W.registerCommand(d,()=>this.preferencesService.openWorkspaceSettings({jsonEditor:!1})),F.appendMenuItem(g.EditorTitle,{command:{id:d,title:j,icon:A},when:a.and(N.Resource.isEqualTo(this.preferencesService.workspaceSettingsResource.toString()),D.isEqualTo("workspace"),a.not("isInDiffEditor")),group:"navigation",order:1})),this.updatePreferencesEditorMenuItemForWorkspaceFolders()}updatePreferencesEditorMenuItemForWorkspaceFolders(){for(const d of this.workspaceContextService.getWorkspace().folders){const i=`_workbench.openFolderSettings.${d.uri.toString()}`;W.getCommand(i)||(W.registerCommand(i,()=>this.workspaceContextService.getWorkbenchState()===Z.FOLDER?this.preferencesService.openWorkspaceSettings({jsonEditor:!1}):this.preferencesService.openFolderSettings({folderUri:d.uri,jsonEditor:!1})),F.appendMenuItem(g.EditorTitle,{command:{id:i,title:j,icon:A},when:a.and(N.Resource.isEqualTo(this.preferencesService.getFolderSettingsResource(d.uri).toString()),a.not("isInDiffEditor")),group:"navigation",order:1}))}}};w=U([O(0,Qe),O(1,ae),O(2,E),O(3,Oe),O(4,be),O(5,Ze),O(6,de)],w);let k=class extends V{constructor(d,i){super();this.userDataProfileService=d;this.userDataProfilesService=i;this.registerSettingsEditorTitleActions()}registerSettingsEditorTitleActions(){const d=this._register(new Se),i=a.and(a.or(N.Resource.isEqualTo(this.userDataProfileService.currentProfile.settingsResource.toString()),N.Resource.isEqualTo(this.userDataProfilesService.defaultProfile.settingsResource.toString())),a.not("isInDiffEditor")),t=()=>{d.value=void 0,d.value=c(class extends s{constructor(){super({id:"_workbench.openUserSettingsEditor",title:j,icon:A,menu:[{id:g.EditorTitle,when:i,group:"navigation",order:1}]})}run(r,n){return n=C(n),r.get(E).openUserSettings({jsonEditor:!1,...n})}})};t(),this._register(this.userDataProfileService.onDidChangeCurrentProfile(()=>{t()}));const e=a.and(T,oe.toNegated());this._register(c(class extends s{constructor(){super({id:ut,title:o.localize2("openSettingsJson","Open Settings (JSON)"),icon:A,menu:[{id:g.EditorTitle,when:e,group:"navigation",order:1}]})}run(r){const n=r.get(S).activeEditorPane;return n instanceof b?n.switchToSettingsFile():null}}))}};k=U([O(0,ae),O(1,de)],k);const Ct=R.as(ve.Workbench);ne(w.ID,w,te.BlockStartup),ne(ce.ID,ce,te.BlockStartup),Ct.registerWorkbenchContribution(k,et.Restored),ye(re.ID,re,he.AfterFirstRender),F.appendMenuItem(g.MenubarFileMenu,{title:o.localize({key:"miPreferences",comment:["&& denotes a mnemonic"]},"&&Preferences"),submenu:g.MenubarPreferencesMenu,group:"5_autosave",order:2,when:_e.toNegated()});
