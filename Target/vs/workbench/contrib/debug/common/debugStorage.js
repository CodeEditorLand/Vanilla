var f=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var v=(p,s,t,e)=>{for(var r=e>1?void 0:e?m(s,t):s,o=p.length-1,n;o>=0;o--)(n=p[o])&&(r=(e?n(s,t,r):n(r))||r);return e&&r&&f(s,t,r),r},c=(p,s)=>(t,e)=>s(t,e,p);import{Disposable as A}from"../../../../base/common/lifecycle.js";import{observableValue as S}from"../../../../base/common/observable.js";import{URI as I}from"../../../../base/common/uri.js";import{ILogService as N}from"../../../../platform/log/common/log.js";import{IStorageService as C,StorageScope as i,StorageTarget as a}from"../../../../platform/storage/common/storage.js";import{IUriIdentityService as x}from"../../../../platform/uriIdentity/common/uriIdentity.js";import"./debug.js";import{Breakpoint as y,DataBreakpoint as K,ExceptionBreakpoint as R,Expression as P,FunctionBreakpoint as W}from"./debugModel.js";import{ITextFileService as _}from"../../../services/textfile/common/textfiles.js";const d="debug.breakpoint",E="debug.functionbreakpoint",u="debug.databreakpoint",l="debug.exceptionbreakpoint",h="debug.watchexpressions",B="debug.chosenenvironment",k="debug.uxstate";let g=class extends A{constructor(t,e,r,o){super();this.storageService=t;this.textFileService=e;this.uriIdentityService=r;this.logService=o;this._register(t.onDidChangeValue(i.WORKSPACE,void 0,this._store)(n=>{if(n.external)switch(n.key){case d:return this.breakpoints.set(this.loadBreakpoints(),void 0);case E:return this.functionBreakpoints.set(this.loadFunctionBreakpoints(),void 0);case l:return this.exceptionBreakpoints.set(this.loadExceptionBreakpoints(),void 0);case u:return this.dataBreakpoints.set(this.loadDataBreakpoints(),void 0);case h:return this.watchExpressions.set(this.loadWatchExpressions(),void 0)}}))}breakpoints=S(this,this.loadBreakpoints());functionBreakpoints=S(this,this.loadFunctionBreakpoints());exceptionBreakpoints=S(this,this.loadExceptionBreakpoints());dataBreakpoints=S(this,this.loadDataBreakpoints());watchExpressions=S(this,this.loadWatchExpressions());loadDebugUxState(){return this.storageService.get(k,i.WORKSPACE,"default")}storeDebugUxState(t){this.storageService.store(k,t,i.WORKSPACE,a.MACHINE)}loadBreakpoints(){let t;try{t=JSON.parse(this.storageService.get(d,i.WORKSPACE,"[]")).map(e=>(e.uri=I.revive(e.uri),new y(e,this.textFileService,this.uriIdentityService,this.logService,e.id)))}catch{}return t||[]}loadFunctionBreakpoints(){let t;try{t=JSON.parse(this.storageService.get(E,i.WORKSPACE,"[]")).map(e=>new W(e,e.id))}catch{}return t||[]}loadExceptionBreakpoints(){let t;try{t=JSON.parse(this.storageService.get(l,i.WORKSPACE,"[]")).map(e=>new R(e,e.id))}catch{}return t||[]}loadDataBreakpoints(){let t;try{t=JSON.parse(this.storageService.get(u,i.WORKSPACE,"[]")).map(e=>new K(e,e.id))}catch{}return t||[]}loadWatchExpressions(){let t;try{t=JSON.parse(this.storageService.get(h,i.WORKSPACE,"[]")).map(e=>new P(e.name,e.id))}catch{}return t||[]}loadChosenEnvironments(){return JSON.parse(this.storageService.get(B,i.WORKSPACE,"{}"))}storeChosenEnvironments(t){this.storageService.store(B,JSON.stringify(t),i.WORKSPACE,a.MACHINE)}storeWatchExpressions(t){t.length?this.storageService.store(h,JSON.stringify(t.map(e=>({name:e.name,id:e.getId()}))),i.WORKSPACE,a.MACHINE):this.storageService.remove(h,i.WORKSPACE)}storeBreakpoints(t){const e=t.getBreakpoints();e.length?this.storageService.store(d,JSON.stringify(e),i.WORKSPACE,a.MACHINE):this.storageService.remove(d,i.WORKSPACE);const r=t.getFunctionBreakpoints();r.length?this.storageService.store(E,JSON.stringify(r),i.WORKSPACE,a.MACHINE):this.storageService.remove(E,i.WORKSPACE);const o=t.getDataBreakpoints().filter(O=>O.canPersist);o.length?this.storageService.store(u,JSON.stringify(o),i.WORKSPACE,a.MACHINE):this.storageService.remove(u,i.WORKSPACE);const n=t.getExceptionBreakpoints();n.length?this.storageService.store(l,JSON.stringify(n),i.WORKSPACE,a.MACHINE):this.storageService.remove(l,i.WORKSPACE)}};g=v([c(0,C),c(1,_),c(2,x),c(3,N)],g);export{g as DebugStorage};
