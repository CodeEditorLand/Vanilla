import t from"assert";import{DisposableStore as g}from"../../../../base/common/lifecycle.js";import{generateUuid as p}from"../../../../base/common/uuid.js";import{ensureNoDisposablesAreLeakedInTestSuite as f}from"../../../../base/test/common/utils.js";import{isIMenuItem as M,MenuId as c,MenuRegistry as i}from"../../common/actions.js";import{MenuService as E}from"../../common/menuService.js";import{NullCommandService as I}from"../../../commands/test/common/nullCommandService.js";import{MockContextKeyService as q,MockKeybindingService as h}from"../../../keybinding/test/common/mockKeybindingService.js";import{InMemoryStorageService as v}from"../../../storage/common/storage.js";const s=new class extends q{contextMatchesRules(){return!0}};suite("MenuService",function(){let l;const e=new g;let n;setup(function(){l=new E(I,new h,new v),n=new c(`testo/${p()}`),e.clear()}),teardown(function(){e.clear()}),f(),test("group sorting",function(){e.add(i.appendMenuItem(n,{command:{id:"one",title:"FOO"},group:"0_hello"})),e.add(i.appendMenuItem(n,{command:{id:"two",title:"FOO"},group:"hello"})),e.add(i.appendMenuItem(n,{command:{id:"three",title:"FOO"},group:"Hello"})),e.add(i.appendMenuItem(n,{command:{id:"four",title:"FOO"},group:""})),e.add(i.appendMenuItem(n,{command:{id:"five",title:"FOO"},group:"navigation"}));const o=e.add(l.createMenu(n,s)).getActions();t.strictEqual(o.length,5);const[a,d,r,u,m]=o;t.strictEqual(a[0],"navigation"),t.strictEqual(d[0],"0_hello"),t.strictEqual(r[0],"hello"),t.strictEqual(u[0],"Hello"),t.strictEqual(m[0],"")}),test("in group sorting, by title",function(){e.add(i.appendMenuItem(n,{command:{id:"a",title:"aaa"},group:"Hello"})),e.add(i.appendMenuItem(n,{command:{id:"b",title:"fff"},group:"Hello"})),e.add(i.appendMenuItem(n,{command:{id:"c",title:"zzz"},group:"Hello"}));const o=e.add(l.createMenu(n,s)).getActions();t.strictEqual(o.length,1);const[,a]=o[0];t.strictEqual(a.length,3);const[d,r,u]=a;t.strictEqual(d.id,"a"),t.strictEqual(r.id,"b"),t.strictEqual(u.id,"c")}),test("in group sorting, by title and order",function(){e.add(i.appendMenuItem(n,{command:{id:"a",title:"aaa"},group:"Hello",order:10})),e.add(i.appendMenuItem(n,{command:{id:"b",title:"fff"},group:"Hello"})),e.add(i.appendMenuItem(n,{command:{id:"c",title:"zzz"},group:"Hello",order:-1})),e.add(i.appendMenuItem(n,{command:{id:"d",title:"yyy"},group:"Hello",order:-1}));const o=e.add(l.createMenu(n,s)).getActions();t.strictEqual(o.length,1);const[,a]=o[0];t.strictEqual(a.length,4);const[d,r,u,m]=a;t.strictEqual(d.id,"d"),t.strictEqual(r.id,"c"),t.strictEqual(u.id,"b"),t.strictEqual(m.id,"a")}),test("in group sorting, special: navigation",function(){e.add(i.appendMenuItem(n,{command:{id:"a",title:"aaa"},group:"navigation",order:1.3})),e.add(i.appendMenuItem(n,{command:{id:"b",title:"fff"},group:"navigation",order:1.2})),e.add(i.appendMenuItem(n,{command:{id:"c",title:"zzz"},group:"navigation",order:1.1}));const o=e.add(l.createMenu(n,s)).getActions();t.strictEqual(o.length,1);const[[,a]]=o;t.strictEqual(a.length,3);const[d,r,u]=a;t.strictEqual(d.id,"c"),t.strictEqual(r.id,"b"),t.strictEqual(u.id,"a")}),test("special MenuId palette",function(){e.add(i.appendMenuItem(c.CommandPalette,{command:{id:"a",title:"Explicit"}})),e.add(i.addCommand({id:"b",title:"Implicit"}));let o=!1,a=!1;for(const d of i.getMenuItems(c.CommandPalette))M(d)&&(d.command.id==="a"&&(t.strictEqual(d.command.title,"Explicit"),o=!0),d.command.id==="b"&&(t.strictEqual(d.command.title,"Implicit"),a=!0));t.strictEqual(o,!0),t.strictEqual(a,!0)}),test("Extension contributed submenus missing with errors in output #155030",function(){const o=p(),a=new c(o);t.throws(()=>new c(o)),t.ok(a===c.for(o))})});
