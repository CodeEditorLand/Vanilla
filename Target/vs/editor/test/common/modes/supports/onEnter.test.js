import s from"assert";import{IndentAction as n}from"../../../../common/languages/languageConfiguration.js";import{OnEnterSupport as g}from"../../../../common/languages/supports/onEnter.js";import{javascriptOnEnterRules as N}from"./onEnterRules.js";import{EditorAutoIndentStrategy as c}from"../../../../common/config/editorOptions.js";import{ensureNoDisposablesAreLeakedInTestSuite as f}from"../../../../../base/test/common/utils.js";suite("OnEnter",()=>{f(),test("uses brackets",()=>{const d=[["(",")"],["begin","end"]],t=new g({brackets:d}),l=(e,i,o)=>{const a=t.onEnter(c.Advanced,"",e,i);o===n.None?s.strictEqual(a,null):s.strictEqual(a.indentAction,o)};l("a","",n.None),l("","b",n.None),l("(","b",n.Indent),l("a",")",n.None),l("begin","ending",n.Indent),l("abegin","end",n.None),l("begin",")",n.Indent),l("begin","end",n.IndentOutdent),l("begin "," end",n.IndentOutdent),l(" begin","end//as",n.IndentOutdent),l("(",")",n.IndentOutdent),l("( ",")",n.IndentOutdent),l("a(",")b",n.IndentOutdent),l("(","",n.Indent),l("(","foo",n.Indent),l("begin","foo",n.Indent),l("begin","",n.Indent)}),test("Issue #121125: onEnterRules with global modifier",()=>{const d=new g({onEnterRules:[{action:{appendText:"/// ",indentAction:n.Outdent},beforeText:/^\s*\/{3}.*$/gm}]}),t=(l,e,i,o,a,r=0)=>{const u=d.onEnter(c.Advanced,l,e,i);o===null?s.strictEqual(u,null,"isNull:"+e):(s.strictEqual(u!==null,!0,"isNotNull:"+e),s.strictEqual(u.indentAction,o,"indentAction:"+e),a!==null&&s.strictEqual(u.appendText,a,"appendText:"+e),r!==0&&s.strictEqual(u.removeText,r,"removeText:"+e))};t("/// line","/// line","",n.Outdent,"/// "),t("/// line","/// line","",n.Outdent,"/// ")}),test("uses regExpRules",()=>{const d=new g({onEnterRules:N}),t=(l,e,i,o,a,r=0)=>{const u=d.onEnter(c.Advanced,l,e,i);o===null?s.strictEqual(u,null,"isNull:"+e):(s.strictEqual(u!==null,!0,"isNotNull:"+e),s.strictEqual(u.indentAction,o,"indentAction:"+e),a!==null&&s.strictEqual(u.appendText,a,"appendText:"+e),r!==0&&s.strictEqual(u.removeText,r,"removeText:"+e))};t("","	/**"," */",n.IndentOutdent," * "),t("","	/**","",n.None," * "),t("","	/** * / * / * /","",n.None," * "),t("","	/** /*","",n.None," * "),t("","/**","",n.None," * "),t("","	/**/","",null,null),t("","	/***/","",null,null),t("","	/*******/","",null,null),t("","	/** * * * * */","",null,null),t("","	/** */","",null,null),t("","	/** asdfg */","",null,null),t("","	/* asdfg */","",null,null),t("","	/* asdfg */","",null,null),t("","	/** asdfg */","",null,null),t("","*/","",null,null),t("","	/*","",null,null),t("","	*","",null,null),t("	/**","	 *","",n.None,"* "),t("	 * something","	 *","",n.None,"* "),t("	 *","	 *","",n.None,"* "),t("","	 */","",n.None,null,1),t("","	 * */","",n.None,null,1),t("","	 * * / * / * / */","",null,null),t("	/**","	 * ","",n.None,"* "),t("	 * something","	 * ","",n.None,"* "),t("	 *","	 * ","",n.None,"* "),t("/**"," * ","",n.None,"* "),t(" * something"," * ","",n.None,"* "),t(" *"," * asdfsfagadfg","",n.None,"* "),t("/**"," * asdfsfagadfg * * * ","",n.None,"* "),t(" * something"," * asdfsfagadfg * * * ","",n.None,"* "),t(" *"," * asdfsfagadfg * * * ","",n.None,"* "),t("/**"," * /*","",n.None,"* "),t(" * something"," * /*","",n.None,"* "),t(" *"," * /*","",n.None,"* "),t("/**"," * asdfsfagadfg * / * / * /","",n.None,"* "),t(" * something"," * asdfsfagadfg * / * / * /","",n.None,"* "),t(" *"," * asdfsfagadfg * / * / * /","",n.None,"* "),t("/**"," * asdfsfagadfg * / * / * /*","",n.None,"* "),t(" * something"," * asdfsfagadfg * / * / * /*","",n.None,"* "),t(" *"," * asdfsfagadfg * / * / * /*","",n.None,"* "),t(""," */","",n.None,null,1),t(" */"," * test() {","",n.Indent,null,0),t("","	 */","",n.None,null,1),t("","		 */","",n.None,null,1),t("","   */","",n.None,null,1),t("","     */","",n.None,null,1),t("","	     */","",n.None,null,1),t(""," *--------------------------------------------------------------------------------------------*/","",n.None,null,1),t("class A {","    * test() {","",n.Indent,null,0),t("","    * test() {","",n.Indent,null,0),t("    ","    * test() {","",n.Indent,null,0),t("class A {","  * test() {","",n.Indent,null,0),t("","  * test() {","",n.Indent,null,0),t("  ","  * test() {","",n.Indent,null,0)}),test("issue #141816",()=>{const d=new g({onEnterRules:N}),t=(l,e,i)=>{const o=d.onEnter(c.Advanced,"",l,e);i===n.None?s.strictEqual(o,null):s.strictEqual(o.indentAction,i)};t("const r = /{/;","",n.None),t("const r = /{[0-9]/;","",n.None),t("const r = /[a-zA-Z]{/;","",n.None)})});
