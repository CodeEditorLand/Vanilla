import i from"assert";import{Emitter as y,Event as d}from"../../../../base/common/event.js";import{Disposable as C,DisposableStore as S}from"../../../../base/common/lifecycle.js";import{OperatingSystem as s}from"../../../../base/common/platform.js";import{ensureNoDisposablesAreLeakedInTestSuite as K}from"../../../../base/test/common/utils.js";import"../../../common/core/position.js";import"./imeRecordedTypes.js";import{TestAccessibilityService as h}from"../../../../platform/accessibility/test/common/testAccessibilityService.js";import{NullLogService as v}from"../../../../platform/log/common/log.js";import{TextAreaInput as E}from"../../../browser/controller/editContext/textArea/textAreaEditContextInput.js";import"../../../browser/controller/editContext/clipboardUtils.js";import{TextAreaState as D}from"../../../browser/controller/editContext/textArea/textAreaEditContextState.js";suite("TextAreaInput",()=>{K();function u(){return new Promise((e,t)=>{queueMicrotask(e)})}async function l(e){const t=new S,o={getDataToCopy:function(){throw new Error("Function not implemented.")},getScreenReaderContent:function(){return new D("",0,0,null,void 0)},deduceModelPosition:function(a,n,f){throw new Error("Function not implemented.")}},m=t.add(new class extends C{_onKeyDown=this._register(new y);onKeyDown=this._onKeyDown.event;_onKeyPress=this._register(new y);onKeyPress=this._onKeyPress.event;_onKeyUp=this._register(new y);onKeyUp=this._onKeyUp.event;_onCompositionStart=this._register(new y);onCompositionStart=this._onCompositionStart.event;_onCompositionUpdate=this._register(new y);onCompositionUpdate=this._onCompositionUpdate.event;_onCompositionEnd=this._register(new y);onCompositionEnd=this._onCompositionEnd.event;_onBeforeInput=this._register(new y);onBeforeInput=this._onBeforeInput.event;_onInput=this._register(new y);onInput=this._onInput.event;onCut=d.None;onCopy=d.None;onPaste=d.None;onFocus=d.None;onBlur=d.None;onSyntheticTap=d.None;_state;_currDispatchingEvent;ownerDocument=document;constructor(){super(),this._state={selectionDirection:"none",selectionEnd:0,selectionStart:0,value:""},this._currDispatchingEvent=null}_initialize(a){this._state.value=a.value,this._state.selectionStart=a.selectionStart,this._state.selectionEnd=a.selectionEnd}_dispatchRecordedEvent(a){if(this._currDispatchingEvent=a,this._state.value=a.state.value,this._state.selectionStart=a.state.selectionStart,this._state.selectionEnd=a.state.selectionEnd,this._state.selectionDirection=a.state.selectionDirection,a.type==="keydown"||a.type==="keypress"||a.type==="keyup"){const n={timeStamp:a.timeStamp,type:a.type,altKey:a.altKey,charCode:a.charCode,code:a.code,ctrlKey:a.ctrlKey,isComposing:a.isComposing,key:a.key,keyCode:a.keyCode,location:a.location,metaKey:a.metaKey,repeat:a.repeat,shiftKey:a.shiftKey,getModifierState:f=>!1};a.type==="keydown"?this._onKeyDown.fire(n):a.type==="keypress"?this._onKeyPress.fire(n):this._onKeyUp.fire(n)}else if(a.type==="compositionstart"||a.type==="compositionupdate"||a.type==="compositionend"){const n={timeStamp:a.timeStamp,type:a.type,data:a.data};a.type==="compositionstart"?this._onCompositionStart.fire(n):a.type==="compositionupdate"?this._onCompositionUpdate.fire(n):this._onCompositionEnd.fire(n)}else if(a.type==="beforeinput"||a.type==="input"){const n={timeStamp:a.timeStamp,type:a.type,data:a.data,inputType:a.inputType,isComposing:a.isComposing};a.type==="beforeinput"?this._onBeforeInput.fire(n):this._onInput.fire(n)}else throw new Error("Not Implemented");this._currDispatchingEvent=null}getValue(){return this._state.value}setValue(a,n){this._currDispatchingEvent?.type==="compositionstart"&&i.fail("should not change the state of the textarea in a compositionstart"),this._state.value=n}getSelectionStart(){return this._state.selectionDirection==="backward"?this._state.selectionEnd:this._state.selectionStart}getSelectionEnd(){return this._state.selectionDirection==="backward"?this._state.selectionStart:this._state.selectionEnd}setSelectionRange(a,n,f){this._currDispatchingEvent?.type==="compositionstart"&&i.fail("should not change the state of the textarea in a compositionstart"),this._state.selectionStart=n,this._state.selectionEnd=f,this._state.selectionDirection=n!==f?"forward":"none"}setIgnoreSelectionChangeTime(a){}getIgnoreSelectionChangeTime(){return Date.now()}resetSelectionChangeTime(){}hasFocus(){return!0}}),p=t.add(new E(o,m,e.env.OS,e.env.browser,new h,new v));m._initialize(e.initial),p._initializeFromTest();const c=[];t.add(p.onType(a=>c.push({type:"type",text:a.text,replacePrevCharCnt:a.replacePrevCharCnt,replaceNextCharCnt:a.replaceNextCharCnt,positionDelta:a.positionDelta}))),t.add(p.onCompositionStart(a=>c.push({type:"compositionStart",data:a.data}))),t.add(p.onCompositionUpdate(a=>c.push({type:"compositionUpdate",data:a.data}))),t.add(p.onCompositionEnd(a=>c.push({type:"compositionEnd"})));for(const a of e.events)m._dispatchRecordedEvent(a),await u();return t.dispose(),c}function r(e,t,o,m){let p=o.value,c=o.selectionStart,a=o.selectionEnd;for(const n of m)n.type==="type"&&(p=p.substring(0,c-n.replacePrevCharCnt)+n.text+p.substring(a+n.replaceNextCharCnt),c=c-n.replacePrevCharCnt+n.text.length,a=c,n.positionDelta&&(c+=n.positionDelta,a+=n.positionDelta));return{value:p,selectionStart:c,selectionEnd:a,selectionDirection:t.isFirefox||e===s.Windows||e===s.Linux?"forward":"none"}}test("macOS - Chrome - Korean using 2-Set Korean (1)",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!1,key:"\u3147",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6.2,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:6.4,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:6.5,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"\u3147"},{timeStamp:6.9,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:136.1,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"\u3147",keyCode:68,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:288.1,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"\u314F",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:296,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:296,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uC544"},{timeStamp:296.4,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:368,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"\u314F",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:536.1,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"\u3131",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:543.2,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:543.3,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uC545"},{timeStamp:543.6,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:632,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"\u3131",keyCode:82,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:783.9,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"\u314F",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:790.7,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:790.8,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uC544"},{timeStamp:791.2,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:791.2,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"\uC544"},{timeStamp:791.3,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:791.3,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:791.3,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uAC00"},{timeStamp:791.5,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:880.1,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"\u314F",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2209,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"compositionend",data:"\uAC00"}],final:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u3147",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3147"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC545",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC545"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"\uAC00",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAC00"},{type:"type",text:"\uAC00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - Korean using 2-Set Korean (2)",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyQ",ctrlKey:!1,isComposing:!1,key:"\u3142",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:7.4,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:7.6,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"\u3142",inputType:"insertCompositionText",isComposing:!0},{timeStamp:7.6,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"\u3142"},{timeStamp:8.2,state:{value:"aa\u3142aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\u3142",inputType:"insertCompositionText",isComposing:!0},{timeStamp:136.1,state:{value:"aa\u3142aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyQ",ctrlKey:!1,isComposing:!0,key:"\u3142",keyCode:81,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:680.1,state:{value:"aa\u3142aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyU",ctrlKey:!1,isComposing:!0,key:"\u3155",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:687.2,state:{value:"aa\u3142aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uBCBC",inputType:"insertCompositionText",isComposing:!0},{timeStamp:687.4,state:{value:"aa\u3142aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uBCBC"},{timeStamp:688.8,state:{value:"aa\uBCBCaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uBCBC",inputType:"insertCompositionText",isComposing:!0},{timeStamp:768.1,state:{value:"aa\uBCBCaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyU",ctrlKey:!1,isComposing:!0,key:"\u3155",keyCode:85,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1768,state:{value:"aa\uBCBCaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"\u3147",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1775,state:{value:"aa\uBCBCaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\uBCD1",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1775.1,state:{value:"aa\uBCBCaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\uBCD1"},{timeStamp:1775.6,state:{value:"aa\uBCD1aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uBCD1",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1928.1,state:{value:"aa\uBCD1aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"\u3147",keyCode:68,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6565.7,state:{value:"aa\uBCD1aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"\uBCD1"}],final:{value:"aa\uBCD1aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u3142",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3142"},{type:"type",text:"\uBCBC",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uBCBC"},{type:"type",text:"\uBCD1",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uBCD1"},{type:"type",text:"\uBCD1",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - Japanese using Hiragana (Google)",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!1,key:"s",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:8.5,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:8.7,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:8.7,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"\uFF53"},{timeStamp:9.3,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:111.7,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:439.8,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:444.5,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:444.6,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\u305B"},{timeStamp:445.2,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:559.9,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1943.9,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1949.3,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1949.4,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\uFF4E"},{timeStamp:1949.9,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2039.9,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2207.8,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2215.7,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"beforeinput",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2215.8,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\u3093"},{timeStamp:2216.1,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2311.9,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2551.9,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2557,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"beforeinput",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2557,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\u3093\uFF53"},{timeStamp:2557.4,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"input",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2671.7,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2903.8,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2912.3,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"none"},type:"beforeinput",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2912.5,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\u3093\u305B"},{timeStamp:2912.9,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"input",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3023.9,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3519.9,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3537.1,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"none"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3537.1,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:3537.6,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3639.9,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:73,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4887.8,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!0,key:"Enter",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4892.8,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"none"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4892.9,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"none"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:4893,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4893,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"compositionend",data:"\u305B\u3093\u305B\u3044"},{timeStamp:4967.8,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\uFF53",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uFF53"},{type:"type",text:"\u305B",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B"},{type:"type",text:"\u305B\uFF4E",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\uFF4E"},{type:"type",text:"\u305B\u3093",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093"},{type:"type",text:"\u305B\u3093\uFF53",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\uFF53"},{type:"type",text:"\u305B\u3093\u305B",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - Chinese using Pinyin - Traditional",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyX",ctrlKey:!1,isComposing:!1,key:"x",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:48.7,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:48.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"x",inputType:"insertCompositionText",isComposing:!0},{timeStamp:48.9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"x"},{timeStamp:49.2,state:{value:"aaxaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"x",inputType:"insertCompositionText",isComposing:!0},{timeStamp:127.8,state:{value:"aaxaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyX",ctrlKey:!1,isComposing:!0,key:"x",keyCode:88,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:480,state:{value:"aaxaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyU",ctrlKey:!1,isComposing:!0,key:"u",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:535.6,state:{value:"aaxaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"xu",inputType:"insertCompositionText",isComposing:!0},{timeStamp:535.7,state:{value:"aaxaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"xu"},{timeStamp:535.9,state:{value:"aaxuaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"xu",inputType:"insertCompositionText",isComposing:!0},{timeStamp:575.8,state:{value:"aaxuaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyU",ctrlKey:!1,isComposing:!0,key:"u",keyCode:85,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1055.9,state:{value:"aaxuaa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Digit1",ctrlKey:!1,isComposing:!0,key:"1",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1061.7,state:{value:"aaxuaa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"beforeinput",data:"\u9700",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1061.8,state:{value:"aaxuaa",selectionStart:2,selectionEnd:4,selectionDirection:"none"},type:"compositionupdate",data:"\u9700"},{timeStamp:1063.2,state:{value:"aa\u9700aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\u9700",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1063.3,state:{value:"aa\u9700aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"\u9700"},{timeStamp:1207.9,state:{value:"aa\u9700aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Digit1",ctrlKey:!1,isComposing:!1,key:"1",keyCode:49,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u9700aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"x",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"x"},{type:"type",text:"xu",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"xu"},{type:"type",text:"\u9700",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u9700"},{type:"type",text:"\u9700",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - long press with arrow keys",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keypress",altKey:!1,charCode:111,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:111,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"o",inputType:"insertText",isComposing:!1},{timeStamp:3.4,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"o",inputType:"insertText",isComposing:!1},{timeStamp:500.5,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:583.9,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:667.6,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:750.9,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:835,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:856.1,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!1,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1952.1,state:{value:"aaoaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"ArrowRight",ctrlKey:!1,isComposing:!1,key:"ArrowRight",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1956.5,state:{value:"aaoaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionstart",data:"o"},{timeStamp:1956.8,state:{value:"aaoaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\xF4",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1956.9,state:{value:"aaoaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\xF4"},{timeStamp:1960.6,state:{value:"aa\xF4aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\xF4",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2088.1,state:{value:"aa\xF4aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"ArrowRight",ctrlKey:!1,isComposing:!0,key:"ArrowRight",keyCode:39,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2480.1,state:{value:"aa\xF4aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"ArrowRight",ctrlKey:!1,isComposing:!0,key:"ArrowRight",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2484.3,state:{value:"aa\xF4aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\xF6",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2484.4,state:{value:"aa\xF4aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\xF6"},{timeStamp:2484.7,state:{value:"aa\xF6aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\xF6",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2584.2,state:{value:"aa\xF6aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"ArrowRight",ctrlKey:!1,isComposing:!0,key:"ArrowRight",keyCode:39,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6424.2,state:{value:"aa\xF6aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!0,key:"Enter",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6431.7,state:{value:"aa\xF6aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"\xF6",inputType:"insertCompositionText",isComposing:!0},{timeStamp:6431.7,state:{value:"aa\xF6aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"\xF6"},{timeStamp:6431.8,state:{value:"aa\xF6aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"\xF6",inputType:"insertCompositionText",isComposing:!0},{timeStamp:6431.9,state:{value:"aa\xF6aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"\xF6"},{timeStamp:6496.2,state:{value:"aa\xF6aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\xF6aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"type",text:"o",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionStart",data:"o"},{type:"type",text:"\xF4",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\xF4"},{type:"type",text:"\xF6",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\xF6"},{type:"type",text:"\xF6",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\xF6"},{type:"type",text:"\xF6",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - pressing quotes on US Intl",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Quote",ctrlKey:!1,isComposing:!1,key:"Dead",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:3.1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3.2,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"'"},{timeStamp:3.7,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:71.9,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Quote",ctrlKey:!1,isComposing:!0,key:"Dead",keyCode:222,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:144,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Quote",ctrlKey:!1,isComposing:!0,key:"Dead",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:146.2,state:{value:"aa'aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:146.4,state:{value:"aa'aa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"'"},{timeStamp:146.7,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:146.8,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"'"},{timeStamp:147.2,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:147.2,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:147.7,state:{value:"aa'aa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionupdate",data:"'"},{timeStamp:148.2,state:{value:"aa''aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"'",inputType:"insertCompositionText",isComposing:!0},{timeStamp:208.1,state:{value:"aa''aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Quote",ctrlKey:!1,isComposing:!0,key:"Dead",keyCode:222,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:323.7,state:{value:"aa''aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Semicolon",ctrlKey:!1,isComposing:!0,key:";",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:325.7,state:{value:"aa''aa",selectionStart:3,selectionEnd:4,selectionDirection:"none"},type:"beforeinput",data:"';",inputType:"insertCompositionText",isComposing:!0},{timeStamp:325.8,state:{value:"aa''aa",selectionStart:3,selectionEnd:4,selectionDirection:"none"},type:"compositionupdate",data:"';"},{timeStamp:326.3,state:{value:"aa'';aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"input",data:"';",inputType:"insertCompositionText",isComposing:!0},{timeStamp:326.3,state:{value:"aa'';aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"compositionend",data:"';"},{timeStamp:428,state:{value:"aa'';aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Semicolon",ctrlKey:!1,isComposing:!1,key:";",keyCode:186,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa'';aa",selectionStart:5,selectionEnd:5,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"'",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"'"},{type:"type",text:"'",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"'"},{type:"type",text:"'",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"'",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"'"},{type:"type",text:"';",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"';"},{type:"type",text:"';",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Chrome - inserting emoji using ctrl+cmd+space",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"ControlLeft",ctrlKey:!0,isComposing:!1,key:"Control",keyCode:17,location:1,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:600,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"MetaLeft",ctrlKey:!0,isComposing:!1,key:"Meta",keyCode:91,location:1,metaKey:!0,repeat:!1,shiftKey:!1},{timeStamp:1080.1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!0,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!0,repeat:!1,shiftKey:!1},{timeStamp:1247.9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"MetaLeft",ctrlKey:!0,isComposing:!1,key:"Meta",keyCode:91,location:1,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1263.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!0,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1367.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"ControlLeft",ctrlKey:!1,isComposing:!1,key:"Control",keyCode:17,location:1,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:17962.9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"\u{1F973}",inputType:"insertText",isComposing:!1},{timeStamp:17966.6,state:{value:"aa\u{1F973}aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:"\u{1F973}",inputType:"insertText",isComposing:!1}],final:{value:"aa\u{1F973}aa",selectionStart:4,selectionEnd:4,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"type",text:"\u{1F973}",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Firefox - long press with mouse",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!0,isChrome:!1,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keypress",altKey:!1,charCode:101,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:101,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:7,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"e",inputType:"insertText",isComposing:!1},{timeStamp:7,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"e",inputType:"insertText",isComposing:!1},{timeStamp:500,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:667,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:750,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:834,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:917,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:1001,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!0,shiftKey:!1},{timeStamp:1024,state:{value:"aaeaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!1,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2988,state:{value:"aaeaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\xE8",inputType:"insertText",isComposing:!1},{timeStamp:2988,state:{value:"aa\xE8aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\xE8",inputType:"insertText",isComposing:!1}],final:{value:"aa\xE8aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"type",text:"e",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"type",text:"\xE8",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Firefox - inserting emojis",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!0,isChrome:!1,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u{1F60D}",inputType:"insertText",isComposing:!1},{timeStamp:1,state:{value:"aa\u{1F60D}aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u{1F60D}",inputType:"insertText",isComposing:!1}],final:{value:"aa\u{1F60D}aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"type",text:"\u{1F60D}",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("macOS - Safari - Chinese - issue #119469",async()=>{const e={env:{OS:s.Macintosh,browser:{isAndroid:!1,isFirefox:!1,isChrome:!1,isSafari:!0}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionstart",data:""},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"compositionupdate",data:"f"},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"f",inputType:"insertCompositionText",isComposing:void 0},{timeStamp:2,state:{value:"aafaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"input",data:"f",inputType:"insertCompositionText",isComposing:void 0},{timeStamp:-30,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"f",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:106,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"f",keyCode:70,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:721,state:{value:"aafaa",selectionStart:2,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:null,inputType:"deleteCompositionText",isComposing:void 0},{timeStamp:723,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"input",data:null,inputType:"deleteCompositionText",isComposing:void 0},{timeStamp:723,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"none"},type:"beforeinput",data:"f",inputType:"insertFromComposition",isComposing:void 0},{timeStamp:723,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"input",data:"f",inputType:"insertFromComposition",isComposing:void 0},{timeStamp:723,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"compositionend",data:"f"},{timeStamp:698,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:826,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1114,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1114,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"keypress",altKey:!1,charCode:13,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1137,state:{value:"aafaa",selectionStart:3,selectionEnd:3,selectionDirection:"none"},type:"beforeinput",data:null,inputType:"insertLineBreak",isComposing:void 0},{timeStamp:1138,state:{value:`aaf
aa`,selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"input",data:null,inputType:"insertLineBreak",isComposing:void 0},{timeStamp:1250,state:{value:`aaf
aa`,selectionStart:4,selectionEnd:4,selectionDirection:"none"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Enter",keyCode:13,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:`aaf
aa`,selectionStart:4,selectionEnd:4,selectionDirection:"none"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"f",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"f"},{type:"type",text:"f",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"type",text:`
`,replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows - Chrome - Japanese using Hiragana",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:.9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\uFF53"},{timeStamp:9.3,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:97.5,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:99.1,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:615.9,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:619.8,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:619.8,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B"},{timeStamp:627.7,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:719.9,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:723.6,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1816.1,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1828.3,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1828.4,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\uFF4E"},{timeStamp:1828.7,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1903.7,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1904.7,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2111.7,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2123.4,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2123.4,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093"},{timeStamp:2123.7,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2215.8,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2217.1,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2968,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2970,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2970,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\uFF53"},{timeStamp:2970.2,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3079.7,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3080.7,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3295.2,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3297.1,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3297.2,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B"},{timeStamp:3297.4,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3408,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3409,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3880.8,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3882.8,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3882.9,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:3883.3,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3976.3,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3977.5,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:73,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6364.9,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6367.4,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:6367.4,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:6367.6,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:6367.6,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"compositionend",data:"\u305B\u3093\u305B\u3044"},{timeStamp:6479.6,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\uFF53",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uFF53"},{type:"type",text:"\u305B",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B"},{type:"type",text:"\u305B\uFF4E",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\uFF4E"},{type:"type",text:"\u305B\u3093",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093"},{type:"type",text:"\u305B\u3093\uFF53",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\uFF53"},{type:"type",text:"\u305B\u3093\u305B",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows 11 - Chrome - Japanese using Hiragana",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:15,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:15,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:15,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\uFF53"},{timeStamp:20,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:111,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:111,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:832,state:{value:"aa\uFF53aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:839,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:839,state:{value:"aa\uFF53aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B"},{timeStamp:890,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:936,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:937,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1456,state:{value:"aa\u305Baa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1460,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1460,state:{value:"aa\u305Baa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\uFF4E"},{timeStamp:1461,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u305B\uFF4E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1522,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1522,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1684,state:{value:"aa\u305B\uFF4Eaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1694,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1694,state:{value:"aa\u305B\uFF4Eaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093"},{timeStamp:1694,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u305B\u3093",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1763,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1763,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1873,state:{value:"aa\u305B\u3093aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1878,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1878,state:{value:"aa\u305B\u3093aa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\uFF53"},{timeStamp:1878,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\uFF53",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1969,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1969,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2094,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2111,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2111,state:{value:"aa\u305B\u3093\uFF53aa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B"},{timeStamp:2111,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2222,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2222,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyE",ctrlKey:!1,isComposing:!0,key:"e",keyCode:69,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2356,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2367,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2367,state:{value:"aa\u305B\u3093\u305Baa",selectionStart:2,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:2367,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2456,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2456,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:73,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3776,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3776,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"forward"},type:"beforeinput",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3776,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:2,selectionEnd:6,selectionDirection:"forward"},type:"compositionupdate",data:"\u305B\u3093\u305B\u3044"},{timeStamp:3785,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"\u305B\u3093\u305B\u3044",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3785,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"compositionend",data:"\u305B\u3093\u305B\u3044"},{timeStamp:3886,state:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Enter",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u305B\u3093\u305B\u3044aa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\uFF53",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uFF53"},{type:"type",text:"\u305B",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B"},{type:"type",text:"\u305B\uFF4E",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\uFF4E"},{type:"type",text:"\u305B\u3093",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093"},{type:"type",text:"\u305B\u3093\uFF53",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\uFF53"},{type:"type",text:"\u305B\u3093\u305B",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u305B\u3093\u305B\u3044"},{type:"type",text:"\u305B\u3093\u305B\u3044",replacePrevCharCnt:4,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows - Chrome - Korean (1)",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:23.1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:23.1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:23.2,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\u3147"},{timeStamp:23.6,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:119.3,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:215,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:215.4,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:215.4,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC544"},{timeStamp:215.9,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:303.2,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:511.1,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:511.7,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:511.7,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC545"},{timeStamp:512.1,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:598.2,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:791,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:791.5,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:791.5,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC544"},{timeStamp:791.8,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:791.9,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\uC544"},{timeStamp:792,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:792,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:792,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uAC00"},{timeStamp:792.3,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:919,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2721.5,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\uAC00"}],final:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u3147",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3147"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC545",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC545"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"\uAC00",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAC00"},{type:"type",text:"\uAC00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows 11 - Chrome - Korean (1)",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:10,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:10,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\u3147"},{timeStamp:26,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u3147",inputType:"insertCompositionText",isComposing:!0},{timeStamp:119,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:134,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyD",ctrlKey:!1,isComposing:!0,key:"d",keyCode:68,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:442,state:{value:"aa\u3147aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:442,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:442,state:{value:"aa\u3147aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC544"},{timeStamp:451,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:535,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:535,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"k",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:879,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:879,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:879,state:{value:"aa\uC544aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC545"},{timeStamp:881,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC545",inputType:"insertCompositionText",isComposing:!0},{timeStamp:980,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:992,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"r",keyCode:82,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1230,state:{value:"aa\uC545aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1230,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1230,state:{value:"aa\uC545aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uC544"},{timeStamp:1242,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uC544",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1242,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\uC544"},{timeStamp:1242,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1242,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1242,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uAC00"},{timeStamp:1243,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1375,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1375,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"k",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3412,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\uAC00"},{timeStamp:3412,state:{value:"aa\uC544\uAC00aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:null,inputType:"deleteContentBackward",isComposing:!1},{timeStamp:3413,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:null,inputType:"deleteContentBackward",isComposing:!1},{timeStamp:3413,state:{value:"aa\uC544aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAC00",inputType:"insertText",isComposing:!1},{timeStamp:3414,state:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAC00",inputType:"insertText",isComposing:!1}],final:{value:"aa\uC544\uAC00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u3147",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3147"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC545",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC545"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uC544"},{type:"type",text:"\uC544",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"\uAC00",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAC00"},{type:"type",text:"\uAC00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"type",text:"",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"type",text:"\uAC00",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows - Chrome - Korean (2)",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyG",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:23.3,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:23.5,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u314E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:23.5,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\u314E"},{timeStamp:27.3,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u314E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:111.8,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyG",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:606.8,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:607.4,state:{value:"aa\u314Eaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD558",inputType:"insertCompositionText",isComposing:!0},{timeStamp:607.4,state:{value:"aa\u314Eaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD558"},{timeStamp:607.8,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD558",inputType:"insertCompositionText",isComposing:!0},{timeStamp:705.2,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1455.8,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1456.4,state:{value:"aa\uD558aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1456.5,state:{value:"aa\uD558aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD55C"},{timeStamp:1456.9,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1567.4,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1963.1,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1963.7,state:{value:"aa\uD55Caa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1963.8,state:{value:"aa\uD55Caa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD55C"},{timeStamp:1963.8,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1963.9,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\uD55C"},{timeStamp:1964.1,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1964.1,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1964.1,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u3131"},{timeStamp:1964.4,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2063.6,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2823.6,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyM",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2824,state:{value:"aa\uD55C\u3131aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\uADF8",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2824.1,state:{value:"aa\uD55C\u3131aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\uADF8"},{timeStamp:2824.4,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uADF8",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2935.3,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyM",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3187.5,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3188,state:{value:"aa\uD55C\uADF8aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3188,state:{value:"aa\uD55C\uADF8aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\uAE00"},{timeStamp:3188.4,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3319.2,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3847.3,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3847.8,state:{value:"aa\uD55C\uAE00aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3847.8,state:{value:"aa\uD55C\uAE00aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\uAE00"},{timeStamp:3847.9,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3848.1,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\uAE00"},{timeStamp:3847.7,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3847.8,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keypress",altKey:!1,charCode:32,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3848.3,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:" ",inputType:"insertText",isComposing:!1},{timeStamp:3848.6,state:{value:"aa\uD55C\uAE00 aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:" ",inputType:"insertText",isComposing:!1},{timeStamp:3919.2,state:{value:"aa\uD55C\uAE00 aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3919.5,state:{value:"aa\uD55C\uAE00 aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\uD55C\uAE00 aa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u314E",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u314E"},{type:"type",text:"\uD558",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD558"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD55C"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD55C"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"\u3131",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3131"},{type:"type",text:"\uADF8",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uADF8"},{type:"type",text:"\uAE00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAE00"},{type:"type",text:"\uAE00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAE00"},{type:"type",text:"\uAE00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"type",text:" ",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows 11 - Chrome - Korean (2)",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"ControlLeft",ctrlKey:!1,isComposing:!1,key:"Control",keyCode:17,location:1,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1561,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyG",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1566,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1566,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u314E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1566,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\u314E"},{timeStamp:1567,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u314E",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1681,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyG",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1681,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyG",ctrlKey:!1,isComposing:!0,key:"g",keyCode:71,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2013,state:{value:"aa\u314Eaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2013,state:{value:"aa\u314Eaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD558",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2013,state:{value:"aa\u314Eaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD558"},{timeStamp:2013,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD558",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2096,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2096,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"k",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2457,state:{value:"aa\uD558aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2457,state:{value:"aa\uD558aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2457,state:{value:"aa\uD558aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD55C"},{timeStamp:2457,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2568,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2568,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyS",ctrlKey:!1,isComposing:!0,key:"s",keyCode:83,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3066,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3066,state:{value:"aa\uD55Caa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3066,state:{value:"aa\uD55Caa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uD55C"},{timeStamp:3066,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uD55C",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3066,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\uD55C"},{timeStamp:3070,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:3070,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3070,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\u3131"},{timeStamp:3071,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3180,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3180,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"r",keyCode:82,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3650,state:{value:"aa\uD55C\u3131aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyM",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3650,state:{value:"aa\uD55C\u3131aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\uADF8",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3650,state:{value:"aa\uD55C\u3131aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\uADF8"},{timeStamp:3650,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uADF8",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3753,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyM",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3768,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyM",ctrlKey:!1,isComposing:!0,key:"m",keyCode:77,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4554,state:{value:"aa\uD55C\uADF8aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4554,state:{value:"aa\uD55C\uADF8aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4554,state:{value:"aa\uD55C\uADF8aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\uAE00"},{timeStamp:4558,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAE00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4685,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4685,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyF",ctrlKey:!1,isComposing:!0,key:"f",keyCode:70,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:6632,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\uAE00"},{timeStamp:6634,state:{value:"aa\uD55C\uAE00aa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:null,inputType:"deleteContentBackward",isComposing:!1},{timeStamp:6634,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:null,inputType:"deleteContentBackward",isComposing:!1},{timeStamp:6634,state:{value:"aa\uD55Caa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAE00",inputType:"insertText",isComposing:!1},{timeStamp:6634,state:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\uAE00",inputType:"insertText",isComposing:!1}],final:{value:"aa\uD55C\uAE00aa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u314E",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u314E"},{type:"type",text:"\uD558",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD558"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD55C"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uD55C"},{type:"type",text:"\uD55C",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"\u3131",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3131"},{type:"type",text:"\uADF8",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uADF8"},{type:"type",text:"\uAE00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAE00"},{type:"type",text:"\uAE00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"type",text:"",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"type",text:"\uAE00",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows - Chrome - Chinese",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:.8,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:.9,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"n",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"n"},{timeStamp:1.2,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"n",inputType:"insertCompositionText",isComposing:!0},{timeStamp:66.8,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:67.9,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:466.7,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:470.1,state:{value:"aanaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"ni",inputType:"insertCompositionText",isComposing:!0},{timeStamp:470.2,state:{value:"aanaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"ni"},{timeStamp:470.5,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"ni",inputType:"insertCompositionText",isComposing:!0},{timeStamp:563.2,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:564.2,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:73,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1835,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1837.2,state:{value:"aaniaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u4F60",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1837.3,state:{value:"aaniaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u4F60"},{timeStamp:1837.7,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u4F60",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1837.8,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\u4F60"},{timeStamp:1914.9,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1916.1,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3000.4,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3000.8,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:3000.8,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"h",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3000.9,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"h"},{timeStamp:3001.3,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"h",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3091.6,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3092.6,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!0,key:"h",keyCode:72,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3131.5,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3134.8,state:{value:"aa\u4F60haa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"ha",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3134.8,state:{value:"aa\u4F60haa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"ha"},{timeStamp:3135.1,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"ha",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3234.9,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3236.2,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"a",keyCode:65,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3491.7,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3494.8,state:{value:"aa\u4F60haaa",selectionStart:3,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"hao",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3495,state:{value:"aa\u4F60haaa",selectionStart:3,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"hao"},{timeStamp:3495.4,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"hao",inputType:"insertCompositionText",isComposing:!0},{timeStamp:3570.7,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:3572.4,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4739,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4742.1,state:{value:"aa\u4F60haoaa",selectionStart:3,selectionEnd:6,selectionDirection:"forward"},type:"beforeinput",data:"\u597D",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4742.1,state:{value:"aa\u4F60haoaa",selectionStart:3,selectionEnd:6,selectionDirection:"forward"},type:"compositionupdate",data:"\u597D"},{timeStamp:4742.5,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u597D",inputType:"insertCompositionText",isComposing:!0},{timeStamp:4742.6,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\u597D"},{timeStamp:4834.7,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:4836,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"n",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"n"},{type:"type",text:"ni",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"ni"},{type:"type",text:"\u4F60",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u4F60"},{type:"type",text:"\u4F60",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"h",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"h"},{type:"type",text:"ha",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"ha"},{type:"type",text:"hao",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"hao"},{type:"type",text:"\u597D",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u597D"},{type:"type",text:"\u597D",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Windows 11 - Chrome - Chinese",async()=>{const e={env:{OS:s.Windows,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"n",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"n"},{timeStamp:1,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"n",inputType:"insertCompositionText",isComposing:!0},{timeStamp:63,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:63,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyN",ctrlKey:!1,isComposing:!0,key:"n",keyCode:78,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:331,state:{value:"aanaa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:331,state:{value:"aanaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"ni",inputType:"insertCompositionText",isComposing:!0},{timeStamp:331,state:{value:"aanaa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"ni"},{timeStamp:342,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"ni",inputType:"insertCompositionText",isComposing:!0},{timeStamp:403,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:403,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyI",ctrlKey:!1,isComposing:!0,key:"i",keyCode:73,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:614,state:{value:"aaniaa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:617,state:{value:"aaniaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"\u4F60",inputType:"insertCompositionText",isComposing:!0},{timeStamp:617,state:{value:"aaniaa",selectionStart:2,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"\u4F60"},{timeStamp:657,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u4F60",inputType:"insertCompositionText",isComposing:!0},{timeStamp:658,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\u4F60"},{timeStamp:715,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:715,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1117,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1117,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1117,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"h",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1117,state:{value:"aa\u4F60aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"h"},{timeStamp:1117,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"h",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1199,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1199,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyH",ctrlKey:!1,isComposing:!0,key:"h",keyCode:72,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1317,state:{value:"aa\u4F60haa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1322,state:{value:"aa\u4F60haa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"beforeinput",data:"ha",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1322,state:{value:"aa\u4F60haa",selectionStart:3,selectionEnd:4,selectionDirection:"forward"},type:"compositionupdate",data:"ha"},{timeStamp:1328,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"input",data:"ha",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1419,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1419,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyA",ctrlKey:!1,isComposing:!0,key:"a",keyCode:65,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1592,state:{value:"aa\u4F60haaa",selectionStart:5,selectionEnd:5,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1592,state:{value:"aa\u4F60haaa",selectionStart:3,selectionEnd:5,selectionDirection:"forward"},type:"beforeinput",data:"hao",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1592,state:{value:"aa\u4F60haaa",selectionStart:3,selectionEnd:5,selectionDirection:"forward"},type:"compositionupdate",data:"hao"},{timeStamp:1606,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"input",data:"hao",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1666,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1681,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyO",ctrlKey:!1,isComposing:!0,key:"o",keyCode:79,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2187,state:{value:"aa\u4F60haoaa",selectionStart:6,selectionEnd:6,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!0,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2187,state:{value:"aa\u4F60haoaa",selectionStart:3,selectionEnd:6,selectionDirection:"forward"},type:"beforeinput",data:"\u597D",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2187,state:{value:"aa\u4F60haoaa",selectionStart:3,selectionEnd:6,selectionDirection:"forward"},type:"compositionupdate",data:"\u597D"},{timeStamp:2199,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"input",data:"\u597D",inputType:"insertCompositionText",isComposing:!0},{timeStamp:2199,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"compositionend",data:"\u597D"},{timeStamp:2315,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:"Process",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:2323,state:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"Space",ctrlKey:!1,isComposing:!1,key:" ",keyCode:32,location:0,metaKey:!1,repeat:!1,shiftKey:!1}],final:{value:"aa\u4F60\u597Daa",selectionStart:4,selectionEnd:4,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"n",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"n"},{type:"type",text:"ni",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"ni"},{type:"type",text:"\u4F60",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u4F60"},{type:"type",text:"\u4F60",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"},{type:"compositionStart",data:""},{type:"type",text:"h",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"h"},{type:"type",text:"ha",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"ha"},{type:"type",text:"hao",replacePrevCharCnt:2,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"hao"},{type:"type",text:"\u597D",replacePrevCharCnt:3,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u597D"},{type:"type",text:"\u597D",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)}),test("Linux - Chrome - Korean",async()=>{const e={env:{OS:s.Linux,browser:{isAndroid:!1,isFirefox:!1,isChrome:!0,isSafari:!1}},initial:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},events:[{timeStamp:0,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"",ctrlKey:!1,isComposing:!1,key:"Unidentified",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1.2,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionstart",data:""},{timeStamp:1.3,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"beforeinput",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:1.4,state:{value:"aaaa",selectionStart:2,selectionEnd:2,selectionDirection:"forward"},type:"compositionupdate",data:"\u3131"},{timeStamp:1.7,state:{value:"aa\u3131aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\u3131",inputType:"insertCompositionText",isComposing:!0},{timeStamp:104.5,state:{value:"aa\u3131aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"r",keyCode:82,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:150.6,state:{value:"aa\u3131aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"",ctrlKey:!1,isComposing:!0,key:"Unidentified",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:151.3,state:{value:"aa\u3131aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:151.4,state:{value:"aa\u3131aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uAC00"},{timeStamp:151.8,state:{value:"aa\uAC00aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uAC00",inputType:"insertCompositionText",isComposing:!0},{timeStamp:248.5,state:{value:"aa\uAC00aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyK",ctrlKey:!1,isComposing:!0,key:"k",keyCode:75,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:322.9,state:{value:"aa\uAC00aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keydown",altKey:!1,charCode:0,code:"",ctrlKey:!1,isComposing:!0,key:"Unidentified",keyCode:229,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:323.7,state:{value:"aa\uAC00aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"beforeinput",data:"\uAC01",inputType:"insertCompositionText",isComposing:!0},{timeStamp:323.9,state:{value:"aa\uAC00aa",selectionStart:2,selectionEnd:3,selectionDirection:"forward"},type:"compositionupdate",data:"\uAC01"},{timeStamp:324.1,state:{value:"aa\uAC01aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"input",data:"\uAC01",inputType:"insertCompositionText",isComposing:!0},{timeStamp:448.5,state:{value:"aa\uAC01aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"keyup",altKey:!1,charCode:0,code:"KeyR",ctrlKey:!1,isComposing:!0,key:"r",keyCode:82,location:0,metaKey:!1,repeat:!1,shiftKey:!1},{timeStamp:1761,state:{value:"aa\uAC01aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"},type:"compositionend",data:"\uAC01"}],final:{value:"aa\uAC01aa",selectionStart:3,selectionEnd:3,selectionDirection:"forward"}},t=await l(e);i.deepStrictEqual(t,[{type:"compositionStart",data:""},{type:"type",text:"\u3131",replacePrevCharCnt:0,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\u3131"},{type:"type",text:"\uAC00",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAC00"},{type:"type",text:"\uAC01",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionUpdate",data:"\uAC01"},{type:"type",text:"\uAC01",replacePrevCharCnt:1,replaceNextCharCnt:0,positionDelta:0},{type:"compositionEnd"}]);const o=r(e.env.OS,e.env.browser,e.initial,t);i.deepStrictEqual(o,e.final)})});
