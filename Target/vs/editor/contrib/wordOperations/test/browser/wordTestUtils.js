import{Position as d}from"../../../../common/core/position.js";import{withTestCodeEditor as c}from"../../../../test/browser/testCodeEditor.js";function P(s){let t="",i=1,o=0;const n=[];for(let r=0,l=s.length;r<l;r++){const e=s.charAt(r);if(e===`
`){t+=e,i++,o=0;continue}e==="|"?n.push(new d(i,o+1)):(t+=e,o++)}return[t,n]}function g(s,t){t.sort(d.compare);let i="",o=1,n=0;for(let r=0,l=s.length;r<l;r++){const e=s.charAt(r);t.length>0&&t[0].lineNumber===o&&t[0].column===n+1&&(i+="|",t.shift()),i+=e,e===`
`?(o++,n=0):n++}if(t.length>0&&t[0].lineNumber===o&&t[0].column===n+1&&(i+="|",t.shift()),t.length>0)throw new Error("Unexpected left over positions!!!");return i}function m(s,t,i,o,n,r={}){const l=[];return c(s,r,e=>{for(e.setPosition(t);i(e),l.push(o(e)),!n(e);)if(l.length>1e3)throw new Error(`Endless loop detected involving position ${e.getPosition()}!`)}),l}export{P as deserializePipePositions,g as serializePipePositions,m as testRepeatedActionAndExtractPositions};
