import f from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as u}from"../../../../../base/test/common/utils.js";import"../../../../common/languages/languageConfiguration.js";import{computeRanges as c}from"../../browser/indentRangeProvider.js";import{createTextModel as m}from"../../../../test/common/testTextModel.js";function n(o,i,d,a){const g=m(o.join(`
`)),s=c(g,d,a),l=[];for(let r=0;r<s.length;r++)l[r]=e(s.getStartLineNumber(r),s.getEndLineNumber(r),s.getParentIndex(r));f.deepStrictEqual(l,i),g.dispose()}function e(o,i,d,a=!1){return{startLineNumber:o,endLineNumber:i,parentIndex:d}}suite("Indentation Folding",()=>{u(),test("Fold one level",()=>{const o=["A","  A","  A","  A"];n(o,[e(1,4,-1)],!0),n(o,[e(1,4,-1)],!1)}),test("Fold two levels",()=>{const o=["A","  A","  A","    A","    A"];n(o,[e(1,5,-1),e(3,5,0)],!0),n(o,[e(1,5,-1),e(3,5,0)],!1)}),test("Fold three levels",()=>{const o=["A","  A","    A","      A","A"];n(o,[e(1,4,-1),e(2,4,0),e(3,4,1)],!0),n(o,[e(1,4,-1),e(2,4,0),e(3,4,1)],!1)}),test("Fold decreasing indent",()=>{const o=["    A","  A","A"];n(o,[],!0),n(o,[],!1)}),test("Fold Java",()=>{n(["class A {","  void foo() {","    console.log();","    console.log();","  }","","  void bar() {","    console.log();","  }","}","interface B {","  void bar();","}"],[e(1,9,-1),e(2,4,0),e(7,8,0),e(11,12,-1)],!1)}),test("Fold Javadoc",()=>{n(["/**"," * Comment"," */","class A {","  void foo() {","  }","}"],[e(1,3,-1),e(4,6,-1)],!1)}),test("Fold Whitespace Java",()=>{n(["class A {","","  void foo() {","     ","     return 0;","  }","      ","}"],[e(1,7,-1),e(3,5,0)],!1)}),test("Fold Whitespace Python",()=>{n(["def a:","  pass","   ","  def b:","    pass","  ","      ","def c: # since there was a deintent here"],[e(1,5,-1),e(4,5,0)],!0)}),test("Fold Tabs",()=>{n(["class A {","		","	void foo() {","	 	//hello","	    return 0;","  	}","      ","}"],[e(1,7,-1),e(3,5,0)],!1)})});const t={start:/^\s*#region\b/,end:/^\s*#endregion\b/};suite("Folding with regions",()=>{u(),test("Inside region, indented",()=>{n(["class A {","  #region","  void foo() {","     ","     return 0;","  }","  #endregion","}"],[e(1,7,-1),e(2,7,0,!0),e(3,5,1)],!1,t)}),test("Inside region, not indented",()=>{n(["var x;","#region","void foo() {","     ","     return 0;","  }","#endregion",""],[e(2,7,-1,!0),e(3,6,0)],!1,t)}),test("Empty Regions",()=>{n(["var x;","#region","#endregion","#region","","#endregion","var y;"],[e(2,3,-1,!0),e(4,6,-1,!0)],!1,t)}),test("Nested Regions",()=>{n(["var x;","#region","#region","","#endregion","#endregion","var y;"],[e(2,6,-1,!0),e(3,5,0,!0)],!1,t)}),test("Nested Regions 2",()=>{n(["class A {","  #region","","  #region","","  #endregion","  // comment","  #endregion","}"],[e(1,8,-1),e(2,8,0,!0),e(4,6,1,!0)],!1,t)}),test("Incomplete Regions",()=>{n(["class A {","#region","  // comment","}"],[e(2,3,-1)],!1,t)}),test("Incomplete Regions 2",()=>{n(["","#region","#region","#region","  // comment","#endregion","#endregion"," // hello"],[e(3,7,-1,!0),e(4,6,0,!0)],!1,t)}),test("Indented region before",()=>{n(["if (x)","  return;","","#region","  // comment","#endregion"],[e(1,3,-1),e(4,6,-1,!0)],!1,t)}),test("Indented region before 2",()=>{n(["if (x)","  log();","","    #region","      // comment","    #endregion"],[e(1,6,-1),e(2,6,0),e(4,6,1,!0)],!1,t)}),test("Indented region in-between",()=>{n(["#region","  // comment","  if (x)","    return;","","#endregion"],[e(1,6,-1,!0),e(3,5,0)],!1,t)}),test("Indented region after",()=>{n(["#region","  // comment","","#endregion","  if (x)","    return;"],[e(1,4,-1,!0),e(5,6,-1)],!1,t)}),test("With off-side",()=>{n(["#region","  ","","#endregion",""],[e(1,4,-1,!0)],!0,t)}),test("Nested with off-side",()=>{n(["#region","  ","#region","","#endregion","","#endregion",""],[e(1,7,-1,!0),e(3,5,0,!0)],!0,t)}),test("Issue 35981",()=>{n(["function thisFoldsToEndOfPage() {","  const variable = []","    // #region","    .reduce((a, b) => a,[]);","}","","function thisFoldsProperly() {",'  const foo = "bar"',"}"],[e(1,4,-1),e(2,4,0),e(7,8,-1)],!1,t)}),test("Misspelled Markers",()=>{n(["#Region","#endregion","#regionsandmore","#endregion","#region","#end region","#region","#endregionff"],[],!0,t)}),test("Issue 79359",()=>{n(["#region","","class A","  foo","","class A","  foo","","#endregion"],[e(1,9,-1,!0),e(3,4,0),e(6,7,0)],!0,t)})});
