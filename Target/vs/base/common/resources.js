import{CharCode as f}from"./charCode.js";import*as g from"./extpath.js";import{Schemas as p}from"./network.js";import*as s from"./path.js";import{isLinux as b,isWindows as A}from"./platform.js";import{compare as y,equalsIgnoreCase as T}from"./strings.js";import{URI as u,uriToFsPath as E}from"./uri.js";function l(o){return E(o,!0)}class I{constructor(t){this._ignorePathCasing=t}compare(t,e,n=!1){return t===e?0:y(this.getComparisonKey(t,n),this.getComparisonKey(e,n))}isEqual(t,e,n=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,n)===this.getComparisonKey(e,n)}getComparisonKey(t,e=!1){return t.with({path:this._ignorePathCasing(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this._ignorePathCasing(t)}isEqualOrParent(t,e,n=!1){if(t.scheme===e.scheme){if(t.scheme===p.file)return g.isEqualOrParent(l(t),l(e),this._ignorePathCasing(t))&&t.query===e.query&&(n||t.fragment===e.fragment);if(U(t.authority,e.authority))return g.isEqualOrParent(t.path,e.path,this._ignorePathCasing(t),"/")&&t.query===e.query&&(n||t.fragment===e.fragment)}return!1}joinPath(t,...e){return u.joinPath(t,...e)}basenameOrAuthority(t){return S(t)||t.authority}basename(t){return s.posix.basename(t.path)}extname(t){return s.posix.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===p.file?e=u.file(s.dirname(l(t))).path:(e=s.posix.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==f.Slash&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===p.file?e=u.file(s.normalize(l(t))).path:e=s.posix.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!U(t.authority,e.authority))return;if(t.scheme===p.file){const i=s.relative(l(t),l(e));return A?g.toSlashes(i):i}let n=t.path||"/";const a=e.path||"/";if(this._ignorePathCasing(t)){let i=0;for(const h=Math.min(n.length,a.length);i<h&&!(n.charCodeAt(i)!==a.charCodeAt(i)&&n.charAt(i).toLowerCase()!==a.charAt(i).toLowerCase());i++);n=a.substr(0,i)+n.substr(i)}return s.posix.relative(n,a)}resolvePath(t,e){if(t.scheme===p.file){const n=u.file(s.resolve(l(t),e));return t.with({authority:n.authority,path:n.path})}return e=g.toPosixPath(e),t.with({path:s.posix.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&T(t,e)}hasTrailingPathSeparator(t,e=s.sep){if(t.scheme===p.file){const n=l(t);return n.length>g.getRoot(n).length&&n[n.length-1]===e}else{const n=t.path;return n.length>1&&n.charCodeAt(n.length-1)===f.Slash&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=s.sep){return c(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=s.sep){let n=!1;if(t.scheme===p.file){const a=l(t);n=a!==void 0&&a.length===g.getRoot(a).length&&a[a.length-1]===e}else{e="/";const a=t.path;n=a.length===1&&a.charCodeAt(a.length-1)===f.Slash}return!n&&!c(t,e)?t.with({path:t.path+"/"}):t}}const r=new I(()=>!1),K=new I(o=>o.scheme===p.file?!b:!0),L=new I(o=>!0),j=r.isEqual.bind(r),C=r.isEqualOrParent.bind(r),F=r.getComparisonKey.bind(r),$=r.basenameOrAuthority.bind(r),S=r.basename.bind(r),k=r.extname.bind(r),B=r.dirname.bind(r),Z=r.joinPath.bind(r),D=r.normalizePath.bind(r),N=r.relativePath.bind(r),W=r.resolvePath.bind(r),G=r.isAbsolutePath.bind(r),U=r.isEqualAuthority.bind(r),c=r.hasTrailingPathSeparator.bind(r),H=r.removeTrailingPathSeparator.bind(r),J=r.addTrailingPathSeparator.bind(r);function Q(o,t){const e=[];for(let n=0;n<o.length;n++){const a=t(o[n]);o.some((i,h)=>h===n?!1:C(a,t(i)))||e.push(o[n])}return e}var v;(i=>{i.META_DATA_LABEL="label",i.META_DATA_DESCRIPTION="description",i.META_DATA_SIZE="size",i.META_DATA_MIME="mime";function a(h){const m=new Map;h.path.substring(h.path.indexOf(";")+1,h.path.lastIndexOf(";")).split(";").forEach(x=>{const[d,P]=x.split(":");d&&P&&m.set(d,P)});const R=h.path.substring(0,h.path.indexOf(";"));return R&&m.set(i.META_DATA_MIME,R),m}i.parseMetaData=a})(v||={});function V(o,t,e){if(t){let n=o.path;return n&&n[0]!==s.posix.sep&&(n=s.posix.sep+n),o.with({scheme:e,authority:t,path:n})}return o.with({scheme:e})}export{v as DataUri,I as ExtUri,J as addTrailingPathSeparator,S as basename,$ as basenameOrAuthority,B as dirname,Q as distinctParents,r as extUri,K as extUriBiasedIgnorePathCase,L as extUriIgnorePathCase,k as extname,F as getComparisonKey,c as hasTrailingPathSeparator,G as isAbsolutePath,j as isEqual,U as isEqualAuthority,C as isEqualOrParent,Z as joinPath,D as normalizePath,l as originalFSPath,N as relativePath,H as removeTrailingPathSeparator,W as resolvePath,V as toLocalResource};
