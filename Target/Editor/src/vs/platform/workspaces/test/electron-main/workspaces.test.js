import e from"assert";import*as o from"fs";import*as u from"os";import*as a from"../../../../base/common/path.js";import{isWindows as f}from"../../../../base/common/platform.js";import{URI as t}from"../../../../base/common/uri.js";import*as g from"../../../../base/node/pfs.js";import{ensureNoDisposablesAreLeakedInTestSuite as b}from"../../../../base/test/common/utils.js";import{flakySuite as h,getRandomTestPath as E}from"../../../../base/test/node/testUtils.js";import{getSingleFolderWorkspaceIdentifier as i,getWorkspaceIdentifier as c}from"../../node/workspaces.js";h("Workspaces",()=>{let s;const m=u.tmpdir();setup(async()=>(s=E(m,"vsctests","workspacesmanagementmainservice"),o.promises.mkdir(s,{recursive:!0}))),teardown(()=>g.Promises.rm(s)),test("getSingleWorkspaceIdentifier",async function(){const r=t.parse("myscheme://server/work/p/f1"),d=i(r);e.ok(d?.id);const l=t.file(a.join(s,"f1")),p=i(l);e.ok(!p),o.mkdirSync(a.join(s,"f1"));const n=t.file(a.join(s,"f1")),k=i(n,o.statSync(n.fsPath));e.ok(k?.id)}),test("workspace identifiers are stable",function(){e.strictEqual(c(t.file("/hello/test")).id,f?"9f3efb614e2cd7924e4b8076e6c72233":"e36736311be12ff6d695feefe415b3e8");const r={ino:1611312115129,birthtimeMs:1611312115129,birthtime:new Date(1611312115129)};e.strictEqual(i(t.file("/hello/test"),r)?.id,f?"9a8441e897e5174fa388bc7ef8f7a710":"1d726b3d516dc2a6d343abf4797eaaef"),e.strictEqual(c(t.parse("vscode-remote:/hello/test")).id,"786de4f224d57691f218dc7f31ee2ee3"),e.strictEqual(i(t.parse("vscode-remote:/hello/test"))?.id,"786de4f224d57691f218dc7f31ee2ee3")}),b()});
