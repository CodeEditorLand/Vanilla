import e from"assert";import{EnvironmentMainService as t}from"../../electron-main/environmentMainService.js";import _ from"../../../product/common/product.js";import{isLinux as r}from"../../../../base/common/platform.js";import{ensureNoDisposablesAreLeakedInTestSuite as n}from"../../../../base/test/common/utils.js";suite("EnvironmentMainService",()=>{test("can unset and restore snap env variables",()=>{const s=new t({_:[]},{_serviceBrand:void 0,..._});process.env.TEST_ARG1_VSCODE_SNAP_ORIG="original",process.env.TEST_ARG1="modified",process.env.TEST_ARG2_SNAP="test_arg2",process.env.TEST_ARG3_VSCODE_SNAP_ORIG="",process.env.TEST_ARG3="test_arg3_non_empty",s.unsetSnapExportedVariables(),r?(e.strictEqual(process.env.TEST_ARG1,"original"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,void 0)):(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty")),s.restoreSnapExportedVariables(),r?(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty")):(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty"))}),test("can invoke unsetSnapExportedVariables and restoreSnapExportedVariables multiple times",()=>{const s=new t({_:[]},{_serviceBrand:void 0,..._});process.env.SNAP="1",process.env.SNAP_REVISION="test_revision",process.env.TEST_ARG1_VSCODE_SNAP_ORIG="original",process.env.TEST_ARG1="modified",process.env.TEST_ARG2_SNAP="test_arg2",process.env.TEST_ARG3_VSCODE_SNAP_ORIG="",process.env.TEST_ARG3="test_arg3_non_empty",s.unsetSnapExportedVariables(),s.unsetSnapExportedVariables(),s.unsetSnapExportedVariables(),r?(e.strictEqual(process.env.TEST_ARG1,"original"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,void 0)):(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty")),s.restoreSnapExportedVariables(),s.restoreSnapExportedVariables(),r?(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty")):(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty")),s.unsetSnapExportedVariables(),r?(e.strictEqual(process.env.TEST_ARG1,"original"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,void 0)):(e.strictEqual(process.env.TEST_ARG1,"modified"),e.strictEqual(process.env.TEST_ARG2,void 0),e.strictEqual(process.env.TEST_ARG1_VSCODE_SNAP_ORIG,"original"),e.strictEqual(process.env.TEST_ARG2_SNAP,"test_arg2"),e.strictEqual(process.env.TEST_ARG3_VSCODE_SNAP_ORIG,""),e.strictEqual(process.env.TEST_ARG3,"test_arg3_non_empty"))}),n()});
