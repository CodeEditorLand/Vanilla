import e from"assert";import{isMacintosh as a,isWindows as r}from"../../../../base/common/platform.js";import{flakySuite as c}from"../../../../base/test/common/testUtils.js";function o(t){return`Unable to load "${t}" dependency. It was probably not compiled for the right operating system architecture or had missing build tools.`}c("Native Modules (all platforms)",()=>{(a?test.skip:test)("kerberos",async()=>{const{default:t}=await import("kerberos");e.ok(typeof t.initializeClient=="function",o("kerberos"))}),test("minimist",async()=>{const{default:t}=await import("minimist");e.ok(typeof t=="function",o("minimist"))}),test("yauzl",async()=>{const{default:t}=await import("yauzl");e.ok(typeof t.ZipFile=="function",o("yauzl"))}),test("yazl",async()=>{const{default:t}=await import("yazl");e.ok(typeof t.ZipFile=="function",o("yazl"))}),test("v8-inspect-profiler",async()=>{const{default:t}=await import("v8-inspect-profiler");e.ok(typeof t.startProfiling=="function",o("v8-inspect-profiler"))}),test("native-is-elevated",async()=>{const{default:t}=await import("native-is-elevated");e.ok(typeof t=="function",o("native-is-elevated "));const s=t();e.ok(typeof s=="boolean",o("native-is-elevated"))}),test("native-keymap",async()=>{const t=await import("native-keymap");e.ok(typeof t.onDidChangeKeyboardLayout=="function",o("native-keymap")),e.ok(typeof t.getCurrentKeyboardLayout=="function",o("native-keymap"));const s=t.getCurrentKeyboardLayout();e.ok(s,o("native-keymap"))}),test("native-watchdog",async()=>{const t=await import("native-watchdog");e.ok(typeof t.start=="function",o("native-watchdog"))}),test("@vscode/sudo-prompt",async()=>{const t=await import("@vscode/sudo-prompt");e.ok(typeof t.exec=="function",o("@vscode/sudo-prompt"))}),test("@vscode/policy-watcher",async()=>{const t=await import("@vscode/policy-watcher");e.ok(typeof t.createWatcher=="function",o("@vscode/policy-watcher"))}),test("node-pty",async()=>{const t=await import("node-pty");e.ok(typeof t.spawn=="function",o("node-pty"))}),test("open",async()=>{const{default:t}=await import("open");e.ok(typeof t=="function",o("open"))}),test("@vscode/spdlog",async()=>{const t=await import("@vscode/spdlog");e.ok(typeof t.createRotatingLogger=="function",o("@vscode/spdlog")),e.ok(typeof t.version=="number",o("@vscode/spdlog"))}),test("@parcel/watcher",async()=>{const t=await import("@parcel/watcher");e.ok(typeof t.subscribe=="function",o("@parcel/watcher"))}),test("@vscode/deviceid",async()=>{const t=await import("@vscode/deviceid");e.ok(typeof t.getDeviceId=="function",o("@vscode/deviceid"))}),test("@vscode/ripgrep",async()=>{const t=await import("@vscode/ripgrep");e.ok(typeof t.rgPath=="string",o("@vscode/ripgrep"))}),test("vscode-regexpp",async()=>{const t=await import("vscode-regexpp");e.ok(typeof t.RegExpParser=="function",o("vscode-regexpp"))}),test("@vscode/sqlite3",async()=>{const{default:t}=await import("@vscode/sqlite3");e.ok(typeof t.Database=="function",o("@vscode/sqlite3"))}),test("http-proxy-agent",async()=>{const{default:t}=await import("http-proxy-agent");e.ok(typeof t.HttpProxyAgent=="function",o("http-proxy-agent"))}),test("https-proxy-agent",async()=>{const{default:t}=await import("https-proxy-agent");e.ok(typeof t.HttpsProxyAgent=="function",o("https-proxy-agent"))}),test("@vscode/proxy-agent",async()=>{const s=await(await import("@vscode/proxy-agent")).loadSystemCertificates({log:{trace:()=>{},debug:()=>{},info:()=>{},warn:()=>{},error:()=>{}}});e.ok(s.length>0,o("@vscode/proxy-agent"))})}),(r?suite:suite.skip)("Native Modules (Windows)",()=>{test("@vscode/windows-mutex",async()=>{const t=await import("@vscode/windows-mutex");e.ok(t&&typeof t.isActive=="function",o("@vscode/windows-mutex")),e.ok(typeof t.isActive=="function",o("@vscode/windows-mutex")),e.ok(typeof t.Mutex=="function",o("@vscode/windows-mutex"))}),test("windows-foreground-love",async()=>{const t=await import("windows-foreground-love");e.ok(typeof t.allowSetForegroundWindow=="function",o("windows-foreground-love"));const s=t.allowSetForegroundWindow(process.pid);e.ok(typeof s=="boolean",o("windows-foreground-love"))}),test("@vscode/windows-process-tree",async()=>{const t=await import("@vscode/windows-process-tree");return e.ok(typeof t.getProcessTree=="function",o("@vscode/windows-process-tree")),new Promise((s,n)=>{t.getProcessTree(process.pid,i=>{i?s():n(new Error(o("@vscode/windows-process-tree")))})})}),test("@vscode/windows-registry",async()=>{const t=await import("@vscode/windows-registry");e.ok(typeof t.GetStringRegKey=="function",o("@vscode/windows-registry"));const s=t.GetStringRegKey("HKEY_LOCAL_MACHINE","SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion","EditionID");e.ok(typeof s=="string"||typeof s>"u",o("@vscode/windows-registry"))})});
