var d=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var c=(u,i,t,n)=>{for(var e=n>1?void 0:n?p(i,t):i,o=u.length-1,r;o>=0;o--)(r=u[o])&&(e=(n?r(i,t,e):r(e))||e);return n&&e&&d(i,t,e),e},f=(u,i)=>(t,n)=>i(t,n,u);import{URI as g}from"../../../base/common/uri.js";import"../../../base/common/lifecycle.js";import{Registry as m}from"../../../platform/registry/common/platform.js";import{Extensions as l,ConfigurationScope as C,getScopes as v}from"../../../platform/configuration/common/configurationRegistry.js";import{IWorkspaceContextService as I,WorkbenchState as S}from"../../../platform/workspace/common/workspace.js";import{MainContext as h,ExtHostContext as E}from"../common/extHost.protocol.js";import{extHostNamedCustomer as _}from"../../services/extensions/common/extHostCustomers.js";import{ConfigurationTarget as a,IConfigurationService as x}from"../../../platform/configuration/common/configuration.js";import{IEnvironmentService as O}from"../../../platform/environment/common/environment.js";let s=class{constructor(i,t,n,e){this._workspaceContextService=t;this.configurationService=n;this._environmentService=e;const o=i.getProxy(E.ExtHostConfiguration);o.$initializeConfiguration(this._getConfigurationData()),this._configurationListener=n.onDidChangeConfiguration(r=>{o.$acceptConfigurationChanged(this._getConfigurationData(),r.change)})}_configurationListener;_getConfigurationData(){const i={...this.configurationService.getConfigurationData(),configurationScopes:[]};return(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment)&&(i.configurationScopes=v()),i}dispose(){this._configurationListener.dispose()}$updateConfigurationOption(i,t,n,e,o){return e={resource:e?.resource?g.revive(e.resource):void 0,overrideIdentifier:e?.overrideIdentifier},this.writeConfiguration(i,t,n,e,o)}$removeConfigurationOption(i,t,n,e){return n={resource:n?.resource?g.revive(n.resource):void 0,overrideIdentifier:n?.overrideIdentifier},this.writeConfiguration(i,t,void 0,n,e)}writeConfiguration(i,t,n,e,o){i=i??this.deriveConfigurationTarget(t,e);const r=this.configurationService.inspect(t,e);switch(i){case a.MEMORY:return this._updateValue(t,n,i,r?.memory?.override,e,o);case a.WORKSPACE_FOLDER:return this._updateValue(t,n,i,r?.workspaceFolder?.override,e,o);case a.WORKSPACE:return this._updateValue(t,n,i,r?.workspace?.override,e,o);case a.USER_REMOTE:return this._updateValue(t,n,i,r?.userRemote?.override,e,o);default:return this._updateValue(t,n,i,r?.userLocal?.override,e,o)}}_updateValue(i,t,n,e,o,r){return o=r===!0?o:r===!1?{resource:o.resource}:o.overrideIdentifier&&e!==void 0?o:{resource:o.resource},this.configurationService.updateValue(i,t,o,n,{donotNotifyError:!0})}deriveConfigurationTarget(i,t){if(t.resource&&this._workspaceContextService.getWorkbenchState()===S.WORKSPACE){const n=m.as(l.Configuration).getConfigurationProperties();if(n[i]&&(n[i].scope===C.RESOURCE||n[i].scope===C.LANGUAGE_OVERRIDABLE))return a.WORKSPACE_FOLDER}return a.WORKSPACE}};s=c([_(h.MainThreadConfiguration),f(1,I),f(2,x),f(3,O)],s);export{s as MainThreadConfiguration};
