var x=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var c=(a,e,t,o)=>{for(var n=o>1?void 0:o?I(e,t):e,i=a.length-1,r;i>=0;i--)(r=a[i])&&(n=(o?r(e,t,n):r(n))||n);return o&&n&&x(e,t,n),n},s=(a,e)=>(t,o)=>e(t,o,a);import{localize as g}from"../../../../nls.js";import{Schemas as l}from"../../../../base/common/network.js";import{ExtensionInstallLocation as v,IExtensionManagementServerService as E}from"../common/extensionManagement.js";import{IRemoteAgentService as M}from"../../remote/common/remoteAgentService.js";import"../../../../base/parts/ipc/common/ipc.js";import{ISharedProcessService as h}from"../../../../platform/ipc/electron-sandbox/services.js";import{InstantiationType as f,registerSingleton as p}from"../../../../platform/instantiation/common/extensions.js";import{NativeRemoteExtensionManagementService as d}from"./remoteExtensionManagementService.js";import{ILabelService as u}from"../../../../platform/label/common/label.js";import"../../../../platform/extensions/common/extensions.js";import{IInstantiationService as L}from"../../../../platform/instantiation/common/instantiation.js";import{NativeExtensionManagementService as b}from"./nativeExtensionManagementService.js";import{Disposable as y}from"../../../../base/common/lifecycle.js";let m=class extends y{localExtensionManagementServer;remoteExtensionManagementServer=null;webExtensionManagementServer=null;constructor(e,t,o,n){super();const i=this._register(n.createInstance(b,e.getChannel("extensions")));this.localExtensionManagementServer={extensionManagementService:i,id:"local",label:g("local","Local")};const r=t.getConnection();if(r){const S=n.createInstance(d,r.getChannel("extensions"),this.localExtensionManagementServer);this.remoteExtensionManagementServer={id:"remote",extensionManagementService:S,get label(){return o.getHostLabel(l.vscodeRemote,r.remoteAuthority)||g("remote","Remote")}}}}getExtensionManagementServer(e){if(e.location.scheme===l.file)return this.localExtensionManagementServer;if(this.remoteExtensionManagementServer&&e.location.scheme===l.vscodeRemote)return this.remoteExtensionManagementServer;throw new Error(`Invalid Extension ${e.location}`)}getExtensionInstallLocation(e){return this.getExtensionManagementServer(e)===this.remoteExtensionManagementServer?v.Remote:v.Local}};m=c([s(0,h),s(1,M),s(2,u),s(3,L)],m),p(E,m,f.Delayed);export{m as ExtensionManagementServerService};
