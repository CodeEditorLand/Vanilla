var A0=Object.create;var kh=Object.defineProperty;var Uv=Object.getOwnPropertyDescriptor;var O0=Object.getOwnPropertyNames;var M0=Object.getPrototypeOf,N0=Object.prototype.hasOwnProperty;var Xt=(r=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(r,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):r)(function(r){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+r+'" is not supported')});var Tn=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports);var B0=(r,t,e,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of O0(t))!N0.call(r,i)&&i!==e&&kh(r,i,{get:()=>t[i],enumerable:!(n=Uv(t,i))||n.enumerable});return r};var Uh=(r,t,e)=>(e=r!=null?A0(M0(r)):{},B0(t||!r||!r.__esModule?kh(e,"default",{value:r,enumerable:!0}):e,r));var E=(r,t,e,n)=>{for(var i=n>1?void 0:n?Uv(t,e):t,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(t,e,i):s(i))||i);return n&&i&&kh(t,e,i),i},m=(r,t)=>(e,n)=>t(e,n,r);var t0=Tn((XUe,e0)=>{"use strict";function OC(r,t){var e=r;t.slice(0,-1).forEach(function(i){e=e[i]||{}});var n=t[t.length-1];return n in e}function Y1(r){return typeof r=="number"||/^0x[0-9a-f]+$/i.test(r)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(r)}function Z1(r,t){return t==="constructor"&&typeof r[t]=="function"||t==="__proto__"}e0.exports=function(r,t){t||(t={});var e={bools:{},strings:{},unknownFn:null};typeof t.unknown=="function"&&(e.unknownFn=t.unknown),typeof t.boolean=="boolean"&&t.boolean?e.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(w){e.bools[w]=!0});var n={};function i(w){return n[w].some(function(L){return e.bools[L]})}Object.keys(t.alias||{}).forEach(function(w){n[w]=[].concat(t.alias[w]),n[w].forEach(function(L){n[L]=[w].concat(n[w].filter(function(Q){return L!==Q}))})}),[].concat(t.string).filter(Boolean).forEach(function(w){e.strings[w]=!0,n[w]&&[].concat(n[w]).forEach(function(L){e.strings[L]=!0})});var o=t.default||{},s={_:[]};function a(w,L){return e.allBools&&/^--[^=]+$/.test(L)||e.strings[w]||e.bools[w]||n[w]}function l(w,L,Q){for(var K=w,U=0;U<L.length-1;U++){var B=L[U];if(Z1(K,B))return;K[B]===void 0&&(K[B]={}),(K[B]===Object.prototype||K[B]===Number.prototype||K[B]===String.prototype)&&(K[B]={}),K[B]===Array.prototype&&(K[B]=[]),K=K[B]}var Ee=L[L.length-1];Z1(K,Ee)||((K===Object.prototype||K===Number.prototype||K===String.prototype)&&(K={}),K===Array.prototype&&(K=[]),K[Ee]===void 0||e.bools[Ee]||typeof K[Ee]=="boolean"?K[Ee]=Q:Array.isArray(K[Ee])?K[Ee].push(Q):K[Ee]=[K[Ee],Q])}function c(w,L,Q){if(!(Q&&e.unknownFn&&!a(w,Q)&&e.unknownFn(Q)===!1)){var K=!e.strings[w]&&Y1(L)?Number(L):L;l(s,w.split("."),K),(n[w]||[]).forEach(function(U){l(s,U.split("."),K)})}}Object.keys(e.bools).forEach(function(w){c(w,o[w]===void 0?!1:o[w])});var d=[];r.indexOf("--")!==-1&&(d=r.slice(r.indexOf("--")+1),r=r.slice(0,r.indexOf("--")));for(var u=0;u<r.length;u++){var f=r[u],h,v;if(/^--.+=/.test(f)){var y=f.match(/^--([^=]+)=([\s\S]*)$/);h=y[1];var I=y[2];e.bools[h]&&(I=I!=="false"),c(h,I,f)}else if(/^--no-.+/.test(f))h=f.match(/^--no-(.+)/)[1],c(h,!1,f);else if(/^--.+/.test(f))h=f.match(/^--(.+)/)[1],v=r[u+1],v!==void 0&&!/^(-|--)[^-]/.test(v)&&!e.bools[h]&&!e.allBools&&(!n[h]||!i(h))?(c(h,v,f),u+=1):/^(true|false)$/.test(v)?(c(h,v==="true",f),u+=1):c(h,e.strings[h]?"":!0,f);else if(/^-[^-]+/.test(f)){for(var x=f.slice(1,-1).split(""),T=!1,R=0;R<x.length;R++){if(v=f.slice(R+2),v==="-"){c(x[R],v,f);continue}if(/[A-Za-z]/.test(x[R])&&v[0]==="="){c(x[R],v.slice(1),f),T=!0;break}if(/[A-Za-z]/.test(x[R])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(v)){c(x[R],v,f),T=!0;break}if(x[R+1]&&x[R+1].match(/\W/)){c(x[R],f.slice(R+2),f),T=!0;break}else c(x[R],e.strings[x[R]]?"":!0,f)}h=f.slice(-1)[0],!T&&h!=="-"&&(r[u+1]&&!/^(-|--)[^-]/.test(r[u+1])&&!e.bools[h]&&(!n[h]||!i(h))?(c(h,r[u+1],f),u+=1):r[u+1]&&/^(true|false)$/.test(r[u+1])?(c(h,r[u+1]==="true",f),u+=1):c(h,e.strings[h]?"":!0,f))}else if((!e.unknownFn||e.unknownFn(f)!==!1)&&s._.push(e.strings._||!Y1(f)?f:Number(f)),t.stopEarly){s._.push.apply(s._,r.slice(u+1));break}}return Object.keys(o).forEach(function(w){OC(s,w.split("."))||(l(s,w.split("."),o[w]),(n[w]||[]).forEach(function(L){l(s,L.split("."),o[w])}))}),t["--"]?s["--"]=d.slice():d.forEach(function(w){s._.push(w)}),s}});var o0=Tn((_Le,i0)=>{"use strict";var ul=1e3,fl=ul*60,pl=fl*60,Xo=pl*24,VC=Xo*7,KC=Xo*365.25;i0.exports=function(r,t){t=t||{};var e=typeof r;if(e==="string"&&r.length>0)return $C(r);if(e==="number"&&isFinite(r))return t.long?qC(r):zC(r);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(r))};function $C(r){if(r=String(r),!(r.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(t){var e=parseFloat(t[1]),n=(t[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return e*KC;case"weeks":case"week":case"w":return e*VC;case"days":case"day":case"d":return e*Xo;case"hours":case"hour":case"hrs":case"hr":case"h":return e*pl;case"minutes":case"minute":case"mins":case"min":case"m":return e*fl;case"seconds":case"second":case"secs":case"sec":case"s":return e*ul;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function zC(r){var t=Math.abs(r);return t>=Xo?Math.round(r/Xo)+"d":t>=pl?Math.round(r/pl)+"h":t>=fl?Math.round(r/fl)+"m":t>=ul?Math.round(r/ul)+"s":r+"ms"}function qC(r){var t=Math.abs(r);return t>=Xo?vh(r,t,Xo,"day"):t>=pl?vh(r,t,pl,"hour"):t>=fl?vh(r,t,fl,"minute"):t>=ul?vh(r,t,ul,"second"):r+" ms"}function vh(r,t,e,n){var i=t>=e*1.5;return Math.round(r/e)+" "+n+(i?"s":"")}});var xv=Tn((kLe,s0)=>{"use strict";function HC(r){e.debug=e,e.default=e,e.coerce=l,e.disable=o,e.enable=i,e.enabled=s,e.humanize=o0(),e.destroy=c,Object.keys(r).forEach(d=>{e[d]=r[d]}),e.names=[],e.skips=[],e.formatters={};function t(d){let u=0;for(let f=0;f<d.length;f++)u=(u<<5)-u+d.charCodeAt(f),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(d){let u,f=null,h,v;function y(...I){if(!y.enabled)return;let x=y,T=Number(new Date),R=T-(u||T);x.diff=R,x.prev=u,x.curr=T,u=T,I[0]=e.coerce(I[0]),typeof I[0]!="string"&&I.unshift("%O");let w=0;I[0]=I[0].replace(/%([a-zA-Z%])/g,(Q,K)=>{if(Q==="%%")return"%";w++;let U=e.formatters[K];if(typeof U=="function"){let B=I[w];Q=U.call(x,B),I.splice(w,1),w--}return Q}),e.formatArgs.call(x,I),(x.log||e.log).apply(x,I)}return y.namespace=d,y.useColors=e.useColors(),y.color=e.selectColor(d),y.extend=n,y.destroy=e.destroy,Object.defineProperty(y,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(h!==e.namespaces&&(h=e.namespaces,v=e.enabled(d)),v),set:I=>{f=I}}),typeof e.init=="function"&&e.init(y),y}function n(d,u){let f=e(this.namespace+(typeof u>"u"?":":u)+d);return f.log=this.log,f}function i(d){e.save(d),e.namespaces=d,e.names=[],e.skips=[];let u,f=(typeof d=="string"?d:"").split(/[\s,]+/),h=f.length;for(u=0;u<h;u++)f[u]&&(d=f[u].replace(/\*/g,".*?"),d[0]==="-"?e.skips.push(new RegExp("^"+d.slice(1)+"$")):e.names.push(new RegExp("^"+d+"$")))}function o(){let d=[...e.names.map(a),...e.skips.map(a).map(u=>"-"+u)].join(",");return e.enable(""),d}function s(d){if(d[d.length-1]==="*")return!0;let u,f;for(u=0,f=e.skips.length;u<f;u++)if(e.skips[u].test(d))return!1;for(u=0,f=e.names.length;u<f;u++)if(e.names[u].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function l(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}s0.exports=HC});var a0=Tn((Vn,Ih)=>{"use strict";Vn.formatArgs=GC;Vn.save=QC;Vn.load=JC;Vn.useColors=jC;Vn.storage=XC();Vn.destroy=(()=>{let r=!1;return()=>{r||(r=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Vn.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function jC(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let r;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(r=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(r[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function GC(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+Ih.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;r.splice(1,0,t,"color: inherit");let e=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(e++,i==="%c"&&(n=e))}),r.splice(n,0,t)}Vn.log=console.debug||console.log||(()=>{});function QC(r){try{r?Vn.storage.setItem("debug",r):Vn.storage.removeItem("debug")}catch{}}function JC(){let r;try{r=Vn.storage.getItem("debug")}catch{}return!r&&typeof process<"u"&&"env"in process&&(r=process.env.DEBUG),r}function XC(){try{return localStorage}catch{}}Ih.exports=xv()(Vn);var{formatters:YC}=Ih.exports;YC.j=function(r){try{return JSON.stringify(r)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var c0=Tn((ULe,l0)=>{"use strict";l0.exports=(r,t)=>{t=t||process.argv;let e=r.startsWith("-")?"":r.length===1?"-":"--",n=t.indexOf(e+r),i=t.indexOf("--");return n!==-1&&(i===-1?!0:n<i)}});var u0=Tn((LLe,d0)=>{"use strict";var ZC=Xt("os"),xr=c0(),un=process.env,hl;xr("no-color")||xr("no-colors")||xr("color=false")?hl=!1:(xr("color")||xr("colors")||xr("color=true")||xr("color=always"))&&(hl=!0);"FORCE_COLOR"in un&&(hl=un.FORCE_COLOR.length===0||parseInt(un.FORCE_COLOR,10)!==0);function eD(r){return r===0?!1:{level:r,hasBasic:!0,has256:r>=2,has16m:r>=3}}function tD(r){if(hl===!1)return 0;if(xr("color=16m")||xr("color=full")||xr("color=truecolor"))return 3;if(xr("color=256"))return 2;if(r&&!r.isTTY&&hl!==!0)return 0;let t=hl?1:0;if(process.platform==="win32"){let e=ZC.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in un)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(e=>e in un)||un.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in un)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(un.TEAMCITY_VERSION)?1:0;if(un.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in un){let e=parseInt((un.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(un.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(un.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(un.TERM)||"COLORTERM"in un?1:(un.TERM==="dumb",t)}function Ev(r){let t=tD(r);return eD(t)}d0.exports={supportsColor:Ev,stdout:Ev(process.stdout),stderr:Ev(process.stderr)}});var p0=Tn((Gt,bh)=>{"use strict";var nD=Xt("tty"),Sh=Xt("util");Gt.init=cD;Gt.log=sD;Gt.formatArgs=iD;Gt.save=aD;Gt.load=lD;Gt.useColors=rD;Gt.destroy=Sh.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Gt.colors=[6,2,3,4,5,1];try{let r=u0();r&&(r.stderr||r).level>=2&&(Gt.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Gt.inspectOpts=Object.keys(process.env).filter(r=>/^debug_/i.test(r)).reduce((r,t)=>{let e=t.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),n=process.env[t];return/^(yes|on|true|enabled)$/i.test(n)?n=!0:/^(no|off|false|disabled)$/i.test(n)?n=!1:n==="null"?n=null:n=Number(n),r[e]=n,r},{});function rD(){return"colors"in Gt.inspectOpts?!!Gt.inspectOpts.colors:nD.isatty(process.stderr.fd)}function iD(r){let{namespace:t,useColors:e}=this;if(e){let n=this.color,i="\x1B[3"+(n<8?n:"8;5;"+n),o=`  ${i};1m${t} \x1B[0m`;r[0]=o+r[0].split(`
`).join(`
`+o),r.push(i+"m+"+bh.exports.humanize(this.diff)+"\x1B[0m")}else r[0]=oD()+t+" "+r[0]}function oD(){return Gt.inspectOpts.hideDate?"":new Date().toISOString()+" "}function sD(...r){return process.stderr.write(Sh.formatWithOptions(Gt.inspectOpts,...r)+`
`)}function aD(r){r?process.env.DEBUG=r:delete process.env.DEBUG}function lD(){return process.env.DEBUG}function cD(r){r.inspectOpts={};let t=Object.keys(Gt.inspectOpts);for(let e=0;e<t.length;e++)r.inspectOpts[t[e]]=Gt.inspectOpts[t[e]]}bh.exports=xv()(Gt);var{formatters:f0}=bh.exports;f0.o=function(r){return this.inspectOpts.colors=this.useColors,Sh.inspect(r,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};f0.O=function(r){return this.inspectOpts.colors=this.useColors,Sh.inspect(r,this.inspectOpts)}});var xh=Tn((FLe,wv)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?wv.exports=a0():wv.exports=p0()});var m0=Tn(Pn=>{"use strict";var dD=Pn&&Pn.__createBinding||(Object.create?function(r,t,e,n){n===void 0&&(n=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,n,i)}:function(r,t,e,n){n===void 0&&(n=e),r[n]=t[e]}),uD=Pn&&Pn.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),h0=Pn&&Pn.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var e in r)e!=="default"&&Object.prototype.hasOwnProperty.call(r,e)&&dD(t,r,e);return uD(t,r),t};Object.defineProperty(Pn,"__esModule",{value:!0});Pn.req=Pn.json=Pn.toBuffer=void 0;var fD=h0(Xt("http")),pD=h0(Xt("https"));async function g0(r){let t=0,e=[];for await(let n of r)t+=n.length,e.push(n);return Buffer.concat(e,t)}Pn.toBuffer=g0;async function hD(r){let e=(await g0(r)).toString("utf8");try{return JSON.parse(e)}catch(n){let i=n;throw i.message+=` (input: ${e})`,i}}Pn.json=hD;function gD(r,t={}){let n=((typeof r=="string"?r:r.href).startsWith("https:")?pD:fD).request(r,t),i=new Promise((o,s)=>{n.once("response",o).once("error",s).end()});return n.then=i.then.bind(i),n}Pn.req=gD});var Tv=Tn(Kn=>{"use strict";var v0=Kn&&Kn.__createBinding||(Object.create?function(r,t,e,n){n===void 0&&(n=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,n,i)}:function(r,t,e,n){n===void 0&&(n=e),r[n]=t[e]}),mD=Kn&&Kn.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),I0=Kn&&Kn.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var e in r)e!=="default"&&Object.prototype.hasOwnProperty.call(r,e)&&v0(t,r,e);return mD(t,r),t},yD=Kn&&Kn.__exportStar||function(r,t){for(var e in r)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&v0(t,r,e)};Object.defineProperty(Kn,"__esModule",{value:!0});Kn.Agent=void 0;var vD=I0(Xt("net")),y0=I0(Xt("http")),ID=Xt("https");yD(m0(),Kn);var Kr=Symbol("AgentBaseInternalState"),Pv=class extends y0.Agent{constructor(t){super(t),this[Kr]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}let{stack:e}=new Error;return typeof e!="string"?!1:e.split(`
`).some(n=>n.indexOf("(https.js:")!==-1||n.indexOf("node:https:")!==-1)}incrementSockets(t){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[t]||(this.sockets[t]=[]);let e=new vD.Socket({writable:!1});return this.sockets[t].push(e),this.totalSocketCount++,e}decrementSockets(t,e){if(!this.sockets[t]||e===null)return;let n=this.sockets[t],i=n.indexOf(e);i!==-1&&(n.splice(i,1),this.totalSocketCount--,n.length===0&&delete this.sockets[t])}getName(t){return(typeof t.secureEndpoint=="boolean"?t.secureEndpoint:this.isSecureEndpoint(t))?ID.Agent.prototype.getName.call(this,t):super.getName(t)}createSocket(t,e,n){let i={...e,secureEndpoint:this.isSecureEndpoint(e)},o=this.getName(i),s=this.incrementSockets(o);Promise.resolve().then(()=>this.connect(t,i)).then(a=>{if(this.decrementSockets(o,s),a instanceof y0.Agent)return a.addRequest(t,i);this[Kr].currentSocket=a,super.createSocket(t,e,n)},a=>{this.decrementSockets(o,s),n(a)})}createConnection(){let t=this[Kr].currentSocket;if(this[Kr].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[Kr].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[Kr]&&(this[Kr].defaultPort=t)}get protocol(){return this[Kr].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[Kr]&&(this[Kr].protocol=t)}};Kn.Agent=Pv});var x0=Tn(er=>{"use strict";var SD=er&&er.__createBinding||(Object.create?function(r,t,e,n){n===void 0&&(n=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,n,i)}:function(r,t,e,n){n===void 0&&(n=e),r[n]=t[e]}),bD=er&&er.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),b0=er&&er.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var e in r)e!=="default"&&Object.prototype.hasOwnProperty.call(r,e)&&SD(t,r,e);return bD(t,r),t},xD=er&&er.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(er,"__esModule",{value:!0});er.HttpProxyAgent=void 0;var ED=b0(Xt("net")),wD=b0(Xt("tls")),PD=xD(xh()),TD=Xt("events"),RD=Tv(),S0=Xt("url"),gl=(0,PD.default)("http-proxy-agent"),Eh=class extends RD.Agent{constructor(t,e){super(e),this.proxy=typeof t=="string"?new S0.URL(t):t,this.proxyHeaders=e?.headers??{},gl("Creating new HttpProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...e?CD(e,"headers"):null,host:n,port:i}}addRequest(t,e){t._header=null,this.setRequestProps(t,e),super.addRequest(t,e)}setRequestProps(t,e){let{proxy:n}=this,i=e.secureEndpoint?"https:":"http:",o=t.getHeader("host")||"localhost",s=`${i}//${o}`,a=new S0.URL(t.path,s);e.port!==80&&(a.port=String(e.port)),t.path=String(a);let l=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(n.username||n.password){let c=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;l["Proxy-Authorization"]=`Basic ${Buffer.from(c).toString("base64")}`}l["Proxy-Connection"]||(l["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let c of Object.keys(l)){let d=l[c];d&&t.setHeader(c,d)}}async connect(t,e){t._header=null,t.path.includes("://")||this.setRequestProps(t,e);let n,i;gl("Regenerating stored HTTP header string for request"),t._implicitHeader(),t.outputData&&t.outputData.length>0&&(gl("Patching connection write() output buffer with updated header"),n=t.outputData[0].data,i=n.indexOf(`\r
\r
`)+4,t.outputData[0].data=t._header+n.substring(i),gl("Output buffer: %o",t.outputData[0].data));let o;return this.proxy.protocol==="https:"?(gl("Creating `tls.Socket`: %o",this.connectOpts),o=wD.connect(this.connectOpts)):(gl("Creating `net.Socket`: %o",this.connectOpts),o=ED.connect(this.connectOpts)),await(0,TD.once)(o,"connect"),o}};Eh.protocols=["http","https"];er.HttpProxyAgent=Eh;function CD(r,...t){let e={},n;for(n in r)t.includes(n)||(e[n]=r[n]);return e}});var E0=Tn(ml=>{"use strict";var DD=ml&&ml.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(ml,"__esModule",{value:!0});ml.parseProxyResponse=void 0;var _D=DD(xh()),wh=(0,_D.default)("https-proxy-agent:parse-proxy-response");function kD(r){return new Promise((t,e)=>{let n=0,i=[];function o(){let d=r.read();d?c(d):r.once("readable",o)}function s(){r.removeListener("end",a),r.removeListener("error",l),r.removeListener("readable",o)}function a(){s(),wh("onend"),e(new Error("Proxy connection ended before receiving CONNECT response"))}function l(d){s(),wh("onerror %o",d),e(d)}function c(d){i.push(d),n+=d.length;let u=Buffer.concat(i,n),f=u.indexOf(`\r
\r
`);if(f===-1){wh("have not received end of HTTP headers yet..."),o();return}let h=u.slice(0,f).toString("ascii").split(`\r
`),v=h.shift();if(!v)return r.destroy(),e(new Error("No header received from proxy CONNECT response"));let y=v.split(" "),I=+y[1],x=y.slice(2).join(" "),T={};for(let R of h){if(!R)continue;let w=R.indexOf(":");if(w===-1)return r.destroy(),e(new Error(`Invalid header from proxy CONNECT response: "${R}"`));let L=R.slice(0,w).toLowerCase(),Q=R.slice(w+1).trimStart(),K=T[L];typeof K=="string"?T[L]=[K,Q]:Array.isArray(K)?K.push(Q):T[L]=Q}wh("got proxy server response: %o %o",v,T),s(),t({connect:{statusCode:I,statusText:x,headers:T},buffered:u})}r.on("error",l),r.on("end",a),o()})}ml.parseProxyResponse=kD});var C0=Tn(tr=>{"use strict";var UD=tr&&tr.__createBinding||(Object.create?function(r,t,e,n){n===void 0&&(n=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(r,n,i)}:function(r,t,e,n){n===void 0&&(n=e),r[n]=t[e]}),LD=tr&&tr.__setModuleDefault||(Object.create?function(r,t){Object.defineProperty(r,"default",{enumerable:!0,value:t})}:function(r,t){r.default=t}),T0=tr&&tr.__importStar||function(r){if(r&&r.__esModule)return r;var t={};if(r!=null)for(var e in r)e!=="default"&&Object.prototype.hasOwnProperty.call(r,e)&&UD(t,r,e);return LD(t,r),t},R0=tr&&tr.__importDefault||function(r){return r&&r.__esModule?r:{default:r}};Object.defineProperty(tr,"__esModule",{value:!0});tr.HttpsProxyAgent=void 0;var Rv=T0(Xt("net")),w0=T0(Xt("tls")),FD=R0(Xt("assert")),AD=R0(xh()),OD=Tv(),MD=Xt("url"),ND=E0(),Zc=(0,AD.default)("https-proxy-agent"),Ph=class extends OD.Agent{constructor(t,e){super(e),this.options={path:void 0},this.proxy=typeof t=="string"?new MD.URL(t):t,this.proxyHeaders=e?.headers??{},Zc("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let n=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...e?P0(e,"headers"):null,host:n,port:i}}async connect(t,e){let{proxy:n}=this;if(!e.host)throw new TypeError('No "host" provided');let i;if(n.protocol==="https:"){Zc("Creating `tls.Socket`: %o",this.connectOpts);let f=this.connectOpts.servername||this.connectOpts.host;i=w0.connect({...this.connectOpts,servername:f})}else Zc("Creating `net.Socket`: %o",this.connectOpts),i=Rv.connect(this.connectOpts);let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=Rv.isIPv6(e.host)?`[${e.host}]`:e.host,a=`CONNECT ${s}:${e.port} HTTP/1.1\r
`;if(n.username||n.password){let f=`${decodeURIComponent(n.username)}:${decodeURIComponent(n.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(f).toString("base64")}`}o.Host=`${s}:${e.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let f of Object.keys(o))a+=`${f}: ${o[f]}\r
`;let l=(0,ND.parseProxyResponse)(i);i.write(`${a}\r
`);let{connect:c,buffered:d}=await l;if(t.emit("proxyConnect",c),this.emit("proxyConnect",c,t),c.statusCode===200){if(t.once("socket",BD),e.secureEndpoint){Zc("Upgrading socket connection to TLS");let f=e.servername||e.host;return w0.connect({...P0(e,"host","path","port"),socket:i,servername:f})}return i}i.destroy();let u=new Rv.Socket({writable:!1});return u.readable=!0,t.once("socket",f=>{Zc("Replaying proxy buffer for failed request"),(0,FD.default)(f.listenerCount("data")>0),f.push(d),f.push(null)}),u}};Ph.protocols=["http","https"];tr.HttpsProxyAgent=Ph;function BD(r){r.resume()}function P0(r,...t){let e={},n;for(n in r)t.includes(n)||(e[n]=r[n]);return e}});import{hostname as qD,release as HD}from"os";function Lv(r){return!!r.parentPort}var Lh=class{unexpectedErrorHandler;listeners;constructor(){this.listeners=[],this.unexpectedErrorHandler=function(t){setTimeout(()=>{throw t.stack?rr.isErrorNoTelemetry(t)?new rr(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.listeners.push(t),()=>{this._removeListener(t)}}emit(t){this.listeners.forEach(e=>{e(t)})}_removeListener(t){this.listeners.splice(this.listeners.indexOf(t),1)}setUnexpectedErrorHandler(t){this.unexpectedErrorHandler=t}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(t){this.unexpectedErrorHandler(t),this.emit(t)}onUnexpectedExternalError(t){this.unexpectedErrorHandler(t)}},Fh=new Lh;function Fv(r){Fh.setUnexpectedErrorHandler(r)}function es(r){Fh.onUnexpectedError(r)}function ze(r){Rn(r)||Fh.onUnexpectedError(r)}var sd="Canceled";function Rn(r){return r instanceof Ge?!0:r instanceof Error&&r.name===sd&&r.message===sd}var Ge=class extends Error{constructor(){super(sd),this.name=this.message}};function li(){let r=new Error(sd);return r.name=r.message,r}function ad(r){return r?new Error(`Illegal state: ${r}`):new Error("Illegal state")}function me(r){return r?r.message?r.message:r.stack?r.stack.split(`
`)[0]:String(r):"Error"}var rr=class r extends Error{name;constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof r)return t;let e=new r;return e.message=t.message,e.stack=t.stack,e}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},Zo=class r extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,r.prototype)}};function ld(r,t){let e=this,n=!1,i;return function(){if(n)return i;if(n=!0,t)try{i=r.apply(e,arguments)}finally{t()}else i=r.apply(e,arguments);return i}}function Ah(){return globalThis._VSCODE_NLS_MESSAGES}function bl(){return globalThis._VSCODE_NLS_LANGUAGE}var W0=bl()==="pseudo"||typeof document<"u"&&document.location&&document.location.hash.indexOf("pseudo=true")>=0;function cd(r,t){let e;return t.length===0?e=r:e=r.replace(/\{(\d+)\}/g,(n,i)=>{let o=i[0],s=t[o],a=n;return typeof s=="string"?a=s:(typeof s=="number"||typeof s=="boolean"||s===void 0||s===null)&&(a=String(s)),a}),W0&&(e="\uFF3B"+e.replace(/[aouei]/g,"$&$&")+"\uFF3D"),e}function g(r,t,...e){return cd(typeof r=="number"?Ov(r,t):t,e)}function Ov(r,t){let e=Ah()?.[r];if(typeof e!="string"){if(typeof t=="string")return t;throw new Error(`!!! NLS MISSING: ${r} !!!`)}return e}function wr(r,t,...e){let n;typeof r=="number"?n=Ov(r,t):n=t;let i=cd(n,e);return{value:i,original:t===n?i:cd(t,e)}}var ts="en",El=!1,wl=!1,xl=!1,Nv=!1,Bv=!1,Oh=!1,V0=!1,Wv=!1,K0=!1,$0=!1,dd,ud=ts,Mv=ts,Vv,qr,Hr=globalThis,Cn;typeof Hr.vscode<"u"&&typeof Hr.vscode.process<"u"?Cn=Hr.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Cn=process);var Kv=typeof Cn?.versions?.electron=="string",z0=Kv&&Cn?.type==="renderer";if(typeof Cn=="object"){El=Cn.platform==="win32",wl=Cn.platform==="darwin",xl=Cn.platform==="linux",Nv=xl&&!!Cn.env.SNAP&&!!Cn.env.SNAP_REVISION,V0=Kv,K0=!!Cn.env.CI||!!Cn.env.BUILD_ARTIFACTSTAGINGDIRECTORY,dd=ts,ud=ts;let r=Cn.env.VSCODE_NLS_CONFIG;if(r)try{let t=JSON.parse(r);dd=t.userLocale,Mv=t.osLocale,ud=t.resolvedLanguage||ts,Vv=t.languagePack?.translationsConfigFile}catch{}Bv=!0}else typeof navigator=="object"&&!z0?(qr=navigator.userAgent,El=qr.indexOf("Windows")>=0,wl=qr.indexOf("Macintosh")>=0,Wv=(qr.indexOf("Macintosh")>=0||qr.indexOf("iPad")>=0||qr.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,xl=qr.indexOf("Linux")>=0,$0=qr?.indexOf("Mobi")>=0,Oh=!0,ud=bl()||ts,dd=navigator.language.toLowerCase(),Mv=dd):console.error("Unable to resolve platform.");function pd(r){switch(r){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var fd=0;wl?fd=1:El?fd=3:xl&&(fd=2);var be=El,_t=wl,Oe=xl,$v=Nv,Mh=Bv;var qe=Oh,q0=Oh&&typeof Hr.importScripts=="function",zv=q0?Hr.origin:void 0;var Tr=fd,Pr=qr,zn=ud,H0;(n=>{function r(){return zn}n.value=r;function t(){return zn.length===2?zn==="en":zn.length>=3?zn[0]==="e"&&zn[1]==="n"&&zn[2]==="-":!1}n.isDefaultVariant=t;function e(){return zn==="en"}n.isDefault=e})(H0||={});var Nh=Vv,j0=typeof Hr.postMessage=="function"&&!Hr.importScripts,qv=(()=>{if(j0){let r=[];Hr.addEventListener("message",e=>{if(e.data&&e.data.vscodeScheduleAsyncWork)for(let n=0,i=r.length;n<i;n++){let o=r[n];if(o.id===e.data.vscodeScheduleAsyncWork){r.splice(n,1),o.callback();return}}});let t=0;return e=>{let n=++t;r.push({id:n,callback:e}),Hr.postMessage({vscodeScheduleAsyncWork:n},"*")}}return r=>setTimeout(r)})();var ir=wl||Wv?2:El?1:3;var Pl=!!(Pr&&Pr.indexOf("Chrome")>=0),hd=!!(Pr&&Pr.indexOf("Firefox")>=0),gd=!!(!Pl&&Pr&&Pr.indexOf("Safari")>=0),md=!!(Pr&&Pr.indexOf("Edg/")>=0),Hv=!!(Pr&&Pr.indexOf("Android")>=0);var uo,Bh=globalThis.vscode;if(typeof Bh<"u"&&typeof Bh.process<"u"){let r=Bh.process;uo={get platform(){return r.platform},get arch(){return r.arch},get env(){return r.env},cwd(){return r.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?uo={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:uo={get platform(){return be?"win32":_t?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var fo=uo.cwd,Me=uo.env,yd=uo.platform,vd=uo.arch;var G0=65,Q0=97,J0=90,X0=122,ui=46,$t=47,vn=92,ci=58,Y0=63,Id=class extends Error{code;constructor(t,e,n){let i;typeof e=="string"&&e.indexOf("not ")===0?(i="must not be",e=e.replace(/^not /,"")):i="must be";let o=t.indexOf(".")!==-1?"property":"argument",s=`The "${t}" ${o} ${i} of type ${e}`;s+=`. Received type ${typeof n}`,super(s),this.code="ERR_INVALID_ARG_TYPE"}};function Z0(r,t){if(r===null||typeof r!="object")throw new Id(t,"Object",r)}function xt(r,t){if(typeof r!="string")throw new Id(t,"string",r)}var In=yd==="win32";function Re(r){return r===$t||r===vn}function Wh(r){return r===$t}function di(r){return r>=G0&&r<=J0||r>=Q0&&r<=X0}function Sd(r,t,e,n){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=r.length;++c){if(c<r.length)l=r.charCodeAt(c);else{if(n(l))break;l=$t}if(n(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==ui||i.charCodeAt(i.length-2)!==ui){if(i.length>2){let d=i.lastIndexOf(e);d===-1?(i="",o=0):(i=i.slice(0,d),o=i.length-1-i.lastIndexOf(e)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}t&&(i+=i.length>0?`${e}..`:"..",o=2)}else i.length>0?i+=`${e}${r.slice(s+1,c)}`:i=r.slice(s+1,c),o=c-s-1;s=c,a=0}else l===ui&&a!==-1?++a:a=-1}return i}function eE(r){return r?`${r[0]==="."?"":"."}${r}`:""}function Gv(r,t){Z0(t,"pathObject");let e=t.dir||t.root,n=t.base||`${t.name||""}${eE(t.ext)}`;return e?e===t.root?`${e}${n}`:`${e}${r}${n}`:n}var vt={resolve(...r){let t="",e="",n=!1;for(let i=r.length-1;i>=-1;i--){let o;if(i>=0){if(o=r[i],xt(o,`paths[${i}]`),o.length===0)continue}else t.length===0?o=fo():(o=Me[`=${t}`]||fo(),(o===void 0||o.slice(0,2).toLowerCase()!==t.toLowerCase()&&o.charCodeAt(2)===vn)&&(o=`${t}\\`));let s=o.length,a=0,l="",c=!1,d=o.charCodeAt(0);if(s===1)Re(d)&&(a=1,c=!0);else if(Re(d))if(c=!0,Re(o.charCodeAt(1))){let u=2,f=u;for(;u<s&&!Re(o.charCodeAt(u));)u++;if(u<s&&u!==f){let h=o.slice(f,u);for(f=u;u<s&&Re(o.charCodeAt(u));)u++;if(u<s&&u!==f){for(f=u;u<s&&!Re(o.charCodeAt(u));)u++;(u===s||u!==f)&&(l=`\\\\${h}\\${o.slice(f,u)}`,a=u)}}}else a=1;else di(d)&&o.charCodeAt(1)===ci&&(l=o.slice(0,2),a=2,s>2&&Re(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(t.length>0){if(l.toLowerCase()!==t.toLowerCase())continue}else t=l;if(n){if(t.length>0)break}else if(e=`${o.slice(a)}\\${e}`,n=c,c&&t.length>0)break}return e=Sd(e,!n,"\\",Re),n?`${t}\\${e}`:`${t}${e}`||"."},normalize(r){xt(r,"path");let t=r.length;if(t===0)return".";let e=0,n,i=!1,o=r.charCodeAt(0);if(t===1)return Wh(o)?"\\":r;if(Re(o))if(i=!0,Re(r.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Re(r.charCodeAt(a));)a++;if(a<t&&a!==l){let c=r.slice(l,a);for(l=a;a<t&&Re(r.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Re(r.charCodeAt(a));)a++;if(a===t)return`\\\\${c}\\${r.slice(l)}\\`;a!==l&&(n=`\\\\${c}\\${r.slice(l,a)}`,e=a)}}}else e=1;else di(o)&&r.charCodeAt(1)===ci&&(n=r.slice(0,2),e=2,t>2&&Re(r.charCodeAt(2))&&(i=!0,e=3));let s=e<t?Sd(r.slice(e),!i,"\\",Re):"";return s.length===0&&!i&&(s="."),s.length>0&&Re(r.charCodeAt(t-1))&&(s+="\\"),n===void 0?i?`\\${s}`:s:i?`${n}\\${s}`:`${n}${s}`},isAbsolute(r){xt(r,"path");let t=r.length;if(t===0)return!1;let e=r.charCodeAt(0);return Re(e)||t>2&&di(e)&&r.charCodeAt(1)===ci&&Re(r.charCodeAt(2))},join(...r){if(r.length===0)return".";let t,e;for(let o=0;o<r.length;++o){let s=r[o];xt(s,"path"),s.length>0&&(t===void 0?t=e=s:t+=`\\${s}`)}if(t===void 0)return".";let n=!0,i=0;if(typeof e=="string"&&Re(e.charCodeAt(0))){++i;let o=e.length;o>1&&Re(e.charCodeAt(1))&&(++i,o>2&&(Re(e.charCodeAt(2))?++i:n=!1))}if(n){for(;i<t.length&&Re(t.charCodeAt(i));)i++;i>=2&&(t=`\\${t.slice(i)}`)}return vt.normalize(t)},relative(r,t){if(xt(r,"from"),xt(t,"to"),r===t)return"";let e=vt.resolve(r),n=vt.resolve(t);if(e===n||(r=e.toLowerCase(),t=n.toLowerCase(),r===t))return"";let i=0;for(;i<r.length&&r.charCodeAt(i)===vn;)i++;let o=r.length;for(;o-1>i&&r.charCodeAt(o-1)===vn;)o--;let s=o-i,a=0;for(;a<t.length&&t.charCodeAt(a)===vn;)a++;let l=t.length;for(;l-1>a&&t.charCodeAt(l-1)===vn;)l--;let c=l-a,d=s<c?s:c,u=-1,f=0;for(;f<d;f++){let v=r.charCodeAt(i+f);if(v!==t.charCodeAt(a+f))break;v===vn&&(u=f)}if(f!==d){if(u===-1)return n}else{if(c>d){if(t.charCodeAt(a+f)===vn)return n.slice(a+f+1);if(f===2)return n.slice(a+f)}s>d&&(r.charCodeAt(i+f)===vn?u=f:f===2&&(u=3)),u===-1&&(u=0)}let h="";for(f=i+u+1;f<=o;++f)(f===o||r.charCodeAt(f)===vn)&&(h+=h.length===0?"..":"\\..");return a+=u,h.length>0?`${h}${n.slice(a,l)}`:(n.charCodeAt(a)===vn&&++a,n.slice(a,l))},toNamespacedPath(r){if(typeof r!="string"||r.length===0)return r;let t=vt.resolve(r);if(t.length<=2)return r;if(t.charCodeAt(0)===vn){if(t.charCodeAt(1)===vn){let e=t.charCodeAt(2);if(e!==Y0&&e!==ui)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(di(t.charCodeAt(0))&&t.charCodeAt(1)===ci&&t.charCodeAt(2)===vn)return`\\\\?\\${t}`;return r},dirname(r){xt(r,"path");let t=r.length;if(t===0)return".";let e=-1,n=0,i=r.charCodeAt(0);if(t===1)return Re(i)?r:".";if(Re(i)){if(e=n=1,Re(r.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Re(r.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&Re(r.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Re(r.charCodeAt(a));)a++;if(a===t)return r;a!==l&&(e=n=a+1)}}}}else di(i)&&r.charCodeAt(1)===ci&&(e=t>2&&Re(r.charCodeAt(2))?3:2,n=e);let o=-1,s=!0;for(let a=t-1;a>=n;--a)if(Re(r.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(e===-1)return".";o=e}return r.slice(0,o)},basename(r,t){t!==void 0&&xt(t,"suffix"),xt(r,"path");let e=0,n=-1,i=!0,o;if(r.length>=2&&di(r.charCodeAt(0))&&r.charCodeAt(1)===ci&&(e=2),t!==void 0&&t.length>0&&t.length<=r.length){if(t===r)return"";let s=t.length-1,a=-1;for(o=r.length-1;o>=e;--o){let l=r.charCodeAt(o);if(Re(l)){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return e===n?n=a:n===-1&&(n=r.length),r.slice(e,n)}for(o=r.length-1;o>=e;--o)if(Re(r.charCodeAt(o))){if(!i){e=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(e,n)},extname(r){xt(r,"path");let t=0,e=-1,n=0,i=-1,o=!0,s=0;r.length>=2&&r.charCodeAt(1)===ci&&di(r.charCodeAt(0))&&(t=n=2);for(let a=r.length-1;a>=t;--a){let l=r.charCodeAt(a);if(Re(l)){if(!o){n=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===ui?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||i===-1||s===0||s===1&&e===i-1&&e===n+1?"":r.slice(e,i)},format:Gv.bind(null,"\\"),parse(r){xt(r,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;let e=r.length,n=0,i=r.charCodeAt(0);if(e===1)return Re(i)?(t.root=t.dir=r,t):(t.base=t.name=r,t);if(Re(i)){if(n=1,Re(r.charCodeAt(1))){let u=2,f=u;for(;u<e&&!Re(r.charCodeAt(u));)u++;if(u<e&&u!==f){for(f=u;u<e&&Re(r.charCodeAt(u));)u++;if(u<e&&u!==f){for(f=u;u<e&&!Re(r.charCodeAt(u));)u++;u===e?n=u:u!==f&&(n=u+1)}}}}else if(di(i)&&r.charCodeAt(1)===ci){if(e<=2)return t.root=t.dir=r,t;if(n=2,Re(r.charCodeAt(2))){if(e===3)return t.root=t.dir=r,t;n=3}}n>0&&(t.root=r.slice(0,n));let o=-1,s=n,a=-1,l=!0,c=r.length-1,d=0;for(;c>=n;--c){if(i=r.charCodeAt(c),Re(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===ui?o===-1?o=c:d!==1&&(d=1):o!==-1&&(d=-1)}return a!==-1&&(o===-1||d===0||d===1&&o===a-1&&o===s+1?t.base=t.name=r.slice(s,a):(t.name=r.slice(s,o),t.base=r.slice(s,a),t.ext=r.slice(o,a))),s>0&&s!==n?t.dir=r.slice(0,s-1):t.dir=t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},tE=(()=>{if(In){let r=/\\/g;return()=>{let t=fo().replace(r,"/");return t.slice(t.indexOf("/"))}}return()=>fo()})(),_e={resolve(...r){let t="",e=!1;for(let n=r.length-1;n>=-1&&!e;n--){let i=n>=0?r[n]:tE();xt(i,`paths[${n}]`),i.length!==0&&(t=`${i}/${t}`,e=i.charCodeAt(0)===$t)}return t=Sd(t,!e,"/",Wh),e?`/${t}`:t.length>0?t:"."},normalize(r){if(xt(r,"path"),r.length===0)return".";let t=r.charCodeAt(0)===$t,e=r.charCodeAt(r.length-1)===$t;return r=Sd(r,!t,"/",Wh),r.length===0?t?"/":e?"./":".":(e&&(r+="/"),t?`/${r}`:r)},isAbsolute(r){return xt(r,"path"),r.length>0&&r.charCodeAt(0)===$t},join(...r){if(r.length===0)return".";let t;for(let e=0;e<r.length;++e){let n=r[e];xt(n,"path"),n.length>0&&(t===void 0?t=n:t+=`/${n}`)}return t===void 0?".":_e.normalize(t)},relative(r,t){if(xt(r,"from"),xt(t,"to"),r===t||(r=_e.resolve(r),t=_e.resolve(t),r===t))return"";let e=1,n=r.length,i=n-e,o=1,s=t.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let u=r.charCodeAt(e+c);if(u!==t.charCodeAt(o+c))break;u===$t&&(l=c)}if(c===a)if(s>a){if(t.charCodeAt(o+c)===$t)return t.slice(o+c+1);if(c===0)return t.slice(o+c)}else i>a&&(r.charCodeAt(e+c)===$t?l=c:c===0&&(l=0));let d="";for(c=e+l+1;c<=n;++c)(c===n||r.charCodeAt(c)===$t)&&(d+=d.length===0?"..":"/..");return`${d}${t.slice(o+l)}`},toNamespacedPath(r){return r},dirname(r){if(xt(r,"path"),r.length===0)return".";let t=r.charCodeAt(0)===$t,e=-1,n=!0;for(let i=r.length-1;i>=1;--i)if(r.charCodeAt(i)===$t){if(!n){e=i;break}}else n=!1;return e===-1?t?"/":".":t&&e===1?"//":r.slice(0,e)},basename(r,t){t!==void 0&&xt(t,"ext"),xt(r,"path");let e=0,n=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=r.length){if(t===r)return"";let s=t.length-1,a=-1;for(o=r.length-1;o>=0;--o){let l=r.charCodeAt(o);if(l===$t){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(n=o):(s=-1,n=a))}return e===n?n=a:n===-1&&(n=r.length),r.slice(e,n)}for(o=r.length-1;o>=0;--o)if(r.charCodeAt(o)===$t){if(!i){e=o+1;break}}else n===-1&&(i=!1,n=o+1);return n===-1?"":r.slice(e,n)},extname(r){xt(r,"path");let t=-1,e=0,n=-1,i=!0,o=0;for(let s=r.length-1;s>=0;--s){let a=r.charCodeAt(s);if(a===$t){if(!i){e=s+1;break}continue}n===-1&&(i=!1,n=s+1),a===ui?t===-1?t=s:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||n===-1||o===0||o===1&&t===n-1&&t===e+1?"":r.slice(t,n)},format:Gv.bind(null,"/"),parse(r){xt(r,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(r.length===0)return t;let e=r.charCodeAt(0)===$t,n;e?(t.root="/",n=1):n=0;let i=-1,o=0,s=-1,a=!0,l=r.length-1,c=0;for(;l>=n;--l){let d=r.charCodeAt(l);if(d===$t){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),d===ui?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let d=o===0&&e?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?t.base=t.name=r.slice(d,s):(t.name=r.slice(d,i),t.base=r.slice(d,s),t.ext=r.slice(i,s))}return o>0?t.dir=r.slice(0,o-1):e&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};_e.win32=vt.win32=vt;_e.posix=vt.posix=_e;var Dn=In?vt.normalize:_e.normalize,fi=In?vt.isAbsolute:_e.isAbsolute,W=In?vt.join:_e.join,Rr=In?vt.resolve:_e.resolve,bd=In?vt.relative:_e.relative,Et=In?vt.dirname:_e.dirname,at=In?vt.basename:_e.basename,xd=In?vt.extname:_e.extname,c_=In?vt.format:_e.format,d_=In?vt.parse:_e.parse,u_=In?vt.toNamespacedPath:_e.toNamespacedPath,wt=In?vt.sep:_e.sep,Qv=In?vt.delimiter:_e.delimiter;var nE=/^\w[\w\d+.-]*$/,rE=/^\//,iE=/^\/\//;function oE(r,t){if(!r.scheme&&t)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${r.authority}", path: "${r.path}", query: "${r.query}", fragment: "${r.fragment}"}`);if(r.scheme&&!nE.test(r.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(r.path){if(r.authority){if(!rE.test(r.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(iE.test(r.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function sE(r,t){return!r&&!t?"file":r}function aE(r,t){switch(r){case"https":case"http":case"file":t?t[0]!==or&&(t=or+t):t=or;break}return t}var tt="",or="/",lE=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,C=class r{static isUri(t){return t instanceof r?!0:t?typeof t.authority=="string"&&typeof t.fragment=="string"&&typeof t.path=="string"&&typeof t.query=="string"&&typeof t.scheme=="string"&&typeof t.fsPath=="string"&&typeof t.with=="function"&&typeof t.toString=="function":!1}scheme;authority;path;query;fragment;constructor(t,e,n,i,o,s=!1){typeof t=="object"?(this.scheme=t.scheme||tt,this.authority=t.authority||tt,this.path=t.path||tt,this.query=t.query||tt,this.fragment=t.fragment||tt):(this.scheme=sE(t,s),this.authority=e||tt,this.path=aE(this.scheme,n||tt),this.query=i||tt,this.fragment=o||tt,oE(this,s))}get fsPath(){return Tl(this,!1)}with(t){if(!t)return this;let{scheme:e,authority:n,path:i,query:o,fragment:s}=t;return e===void 0?e=this.scheme:e===null&&(e=tt),n===void 0?n=this.authority:n===null&&(n=tt),i===void 0?i=this.path:i===null&&(i=tt),o===void 0?o=this.query:o===null&&(o=tt),s===void 0?s=this.fragment:s===null&&(s=tt),e===this.scheme&&n===this.authority&&i===this.path&&o===this.query&&s===this.fragment?this:new hi(e,n,i,o,s)}static parse(t,e=!1){let n=lE.exec(t);return n?new hi(n[2]||tt,Ed(n[4]||tt),Ed(n[5]||tt),Ed(n[7]||tt),Ed(n[9]||tt),e):new hi(tt,tt,tt,tt,tt)}static file(t){let e=tt;if(be&&(t=t.replace(/\\/g,or)),t[0]===or&&t[1]===or){let n=t.indexOf(or,2);n===-1?(e=t.substring(2),t=or):(e=t.substring(2,n),t=t.substring(n)||or)}return new hi("file",e,t,tt,tt)}static from(t,e){return new hi(t.scheme,t.authority,t.path,t.query,t.fragment,e)}static joinPath(t,...e){if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let n;return be&&t.scheme==="file"?n=r.file(vt.join(Tl(t,!0),...e)).path:n=_e.join(t.path,...e),t.with({path:n})}toString(t=!1){return Vh(this,t)}toJSON(){return this}static revive(t){if(t){if(t instanceof r)return t;{let e=new hi(t);return e._formatted=t.external??null,e._fsPath=t._sep===Zv?t.fsPath??null:null,e}}else return t}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}};var Zv=be?1:void 0,hi=class extends C{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=Tl(this,!1)),this._fsPath}toString(t=!1){return t?Vh(this,!0):(this._formatted||(this._formatted=Vh(this,!1)),this._formatted)}toJSON(){let t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=Zv),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}},eI={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function Jv(r,t,e){let n,i=-1;for(let o=0;o<r.length;o++){let s=r.charCodeAt(o);if(s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||s===45||s===46||s===95||s===126||t&&s===47||e&&s===91||e&&s===93||e&&s===58)i!==-1&&(n+=encodeURIComponent(r.substring(i,o)),i=-1),n!==void 0&&(n+=r.charAt(o));else{n===void 0&&(n=r.substr(0,o));let a=eI[s];a!==void 0?(i!==-1&&(n+=encodeURIComponent(r.substring(i,o)),i=-1),n+=a):i===-1&&(i=o)}}return i!==-1&&(n+=encodeURIComponent(r.substring(i))),n!==void 0?n:r}function cE(r){let t;for(let e=0;e<r.length;e++){let n=r.charCodeAt(e);n===35||n===63?(t===void 0&&(t=r.substr(0,e)),t+=eI[n]):t!==void 0&&(t+=r[e])}return t!==void 0?t:r}function Tl(r,t){let e;return r.authority&&r.path.length>1&&r.scheme==="file"?e=`//${r.authority}${r.path}`:r.path.charCodeAt(0)===47&&(r.path.charCodeAt(1)>=65&&r.path.charCodeAt(1)<=90||r.path.charCodeAt(1)>=97&&r.path.charCodeAt(1)<=122)&&r.path.charCodeAt(2)===58?t?e=r.path.substr(1):e=r.path[1].toLowerCase()+r.path.substr(2):e=r.path,be&&(e=e.replace(/\//g,"\\")),e}function Vh(r,t){let e=t?cE:Jv,n="",{scheme:i,authority:o,path:s,query:a,fragment:l}=r;if(i&&(n+=i,n+=":"),(o||i==="file")&&(n+=or,n+=or),o){let c=o.indexOf("@");if(c!==-1){let d=o.substr(0,c);o=o.substr(c+1),c=d.lastIndexOf(":"),c===-1?n+=e(d,!1,!1):(n+=e(d.substr(0,c),!1,!1),n+=":",n+=e(d.substr(c+1),!1,!0)),n+="@"}o=o.toLowerCase(),c=o.lastIndexOf(":"),c===-1?n+=e(o,!1,!0):(n+=e(o.substr(0,c),!1,!0),n+=o.substr(c))}if(s){if(s.length>=3&&s.charCodeAt(0)===47&&s.charCodeAt(2)===58){let c=s.charCodeAt(1);c>=65&&c<=90&&(s=`/${String.fromCharCode(c+32)}:${s.substr(3)}`)}else if(s.length>=2&&s.charCodeAt(1)===58){let c=s.charCodeAt(0);c>=65&&c<=90&&(s=`${String.fromCharCode(c+32)}:${s.substr(2)}`)}n+=e(s,!0,!1)}return a&&(n+="?",n+=e(a,!1,!1)),l&&(n+="#",n+=t?l:Jv(l,!1,!1)),n}function tI(r){try{return decodeURIComponent(r)}catch{return r.length>3?r.substr(0,3)+tI(r.substr(3)):r}}var Xv=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Ed(r){return r.match(Xv)?r.replace(Xv,t=>tI(t)):r}var Kh=class{constructor(t,e){this.uri=t;this.value=e}};function dE(r){return Array.isArray(r)}var Ye=class r{static defaultToKey=t=>t.toString();[Symbol.toStringTag]="ResourceMap";map;toKey;constructor(t,e){if(t instanceof r)this.map=new Map(t.map),this.toKey=e??r.defaultToKey;else if(dE(t)){this.map=new Map,this.toKey=e??r.defaultToKey;for(let[n,i]of t)this.set(n,i)}else this.map=new Map,this.toKey=t??r.defaultToKey}set(t,e){return this.map.set(this.toKey(t),new Kh(t,e)),this}get(t){return this.map.get(this.toKey(t))?.value}has(t){return this.map.has(this.toKey(t))}get size(){return this.map.size}clear(){this.map.clear()}delete(t){return this.map.delete(this.toKey(t))}forEach(t,e){typeof e<"u"&&(t=t.bind(e));for(let[n,i]of this.map)t(i.value,i.uri,this)}*values(){for(let t of this.map.values())yield t.value}*keys(){for(let t of this.map.values())yield t.uri}*entries(){for(let t of this.map.values())yield[t.uri,t.value]}*[Symbol.iterator](){for(let[,t]of this.map)yield[t.uri,t.value]}},gi=class{[Symbol.toStringTag]="ResourceSet";_map;constructor(t,e){!t||typeof t=="function"?this._map=new Ye(t):(this._map=new Ye(e),t.forEach(this.add,this))}get size(){return this._map.size}add(t){return this._map.set(t,t),this}clear(){this._map.clear()}delete(t){return this._map.delete(t)}forEach(t,e){this._map.forEach((n,i)=>t.call(e,i,i,this))}has(t){return this._map.has(t)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[Symbol.iterator](){return this.keys()}};var $h=class{[Symbol.toStringTag]="LinkedMap";_map;_head;_tail;_size;_state;constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(t){return this._map.has(t)}get(t,e=0){let n=this._map.get(t);if(n)return e!==0&&this.touch(n,e),n.value}set(t,e,n=0){let i=this._map.get(t);if(i)i.value=e,n!==0&&this.touch(i,n);else{switch(i={key:t,value:e,next:void 0,previous:void 0},n){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(t,i),this._size++}return this}delete(t){return!!this.remove(t)}remove(t){let e=this._map.get(t);if(e)return this._map.delete(t),this.removeItem(e),this._size--,e.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,e){let n=this._state,i=this._head;for(;i;){if(e?t.bind(e)(i.value,i.key,this):t(i.value,i.key,this),this._state!==n)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let t=this,e=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.key,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}values(){let t=this,e=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:n.value,done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}entries(){let t=this,e=this._state,n=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(n){let o={value:[n.key,n.value],done:!1};return n=n.next,o}else return{value:void 0,done:!0}}};return i}[Symbol.iterator](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._head,n=this.size;for(;e&&n>t;)this._map.delete(e.key),e=e.next,n--;this._head=e,this._size=n,e&&(e.previous=void 0),this._state++}trimNew(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._tail,n=this.size;for(;e&&n>t;)this._map.delete(e.key),e=e.previous,n--;this._tail=e,this._size=n,e&&(e.next=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{let e=t.next,n=t.previous;if(!e||!n)throw new Error("Invalid list");e.previous=n,n.next=e}t.next=void 0,t.previous=void 0,this._state++}touch(t,e){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(e!==1&&e!==2)){if(e===1){if(t===this._head)return;let n=t.next,i=t.previous;t===this._tail?(i.next=void 0,this._tail=i):(n.previous=i,i.next=n),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(e===2){if(t===this._tail)return;let n=t.next,i=t.previous;t===this._head?(n.previous=void 0,this._head=n):(n.previous=i,i.next=n),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){let t=[];return this.forEach((e,n)=>{t.push([n,e])}),t}fromJSON(t){this.clear();for(let[e,n]of t)this.set(e,n)}},zh=class extends $h{_limit;_ratio;constructor(t,e=1){super(),this._limit=t,this._ratio=Math.min(Math.max(0,e),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,e=2){return super.get(t,e)}peek(t){return super.get(t,0)}set(t,e){return super.set(t,e,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},jr=class extends zh{constructor(t,e=1){super(t,e)}trim(t){this.trimOld(t)}set(t,e){return super.set(t,e),this.checkTrim(),this}};var Cr;(R=>{function r(w){return w&&typeof w=="object"&&typeof w[Symbol.iterator]=="function"}R.is=r;let t=Object.freeze([]);function e(){return t}R.empty=e;function*n(w){yield w}R.single=n;function i(w){return r(w)?w:n(w)}R.wrap=i;function o(w){return w||t}R.from=o;function*s(w){for(let L=w.length-1;L>=0;L--)yield w[L]}R.reverse=s;function a(w){return!w||w[Symbol.iterator]().next().done===!0}R.isEmpty=a;function l(w){return w[Symbol.iterator]().next().value}R.first=l;function c(w,L){let Q=0;for(let K of w)if(L(K,Q++))return!0;return!1}R.some=c;function d(w,L){for(let Q of w)if(L(Q))return Q}R.find=d;function*u(w,L){for(let Q of w)L(Q)&&(yield Q)}R.filter=u;function*f(w,L){let Q=0;for(let K of w)yield L(K,Q++)}R.map=f;function*h(w,L){let Q=0;for(let K of w)yield*L(K,Q++)}R.flatMap=h;function*v(...w){for(let L of w)yield*L}R.concat=v;function y(w,L,Q){let K=Q;for(let U of w)K=L(K,U);return K}R.reduce=y;function*I(w,L,Q=w.length){for(L<0&&(L+=w.length),Q<0?Q+=w.length:Q>w.length&&(Q=w.length);L<Q;L++)yield w[L]}R.slice=I;function x(w,L=Number.POSITIVE_INFINITY){let Q=[];if(L===0)return[Q,w];let K=w[Symbol.iterator]();for(let U=0;U<L;U++){let B=K.next();if(B.done)return[Q,R.empty()];Q.push(B.value)}return[Q,{[Symbol.iterator](){return K}}]}R.consume=x;async function T(w){let L=[];for await(let Q of w)L.push(Q);return Promise.resolve(L)}R.asyncToArray=T})(Cr||={});var uE=!1,rs=null;function fE(r){rs=r}if(uE){let r="__is_disposable_tracked__";fE(new class{trackDisposable(t){let e=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[r]||console.log(e)},3e3)}setParent(t,e){if(t&&t!==_.None)try{t[r]=!0}catch{}}markAsDisposed(t){if(t&&t!==_.None)try{t[r]=!0}catch{}}markAsSingleton(t){}})}function po(r){return rs?.trackDisposable(r),r}function ho(r){rs?.markAsDisposed(r)}function Rl(r,t){rs?.setParent(r,t)}function pE(r,t){if(rs)for(let e of r)rs.setParent(e,t)}function wd(r){return typeof r=="object"&&r!==null&&typeof r.dispose=="function"&&r.dispose.length===0}function qt(r){if(Cr.is(r)){let t=[];for(let e of r)if(e)try{e.dispose()}catch(n){t.push(n)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(r)?[]:r}else if(r)return r.dispose(),r}function mi(...r){let t=J(()=>qt(r));return pE(r,t),t}function J(r){let t=po({dispose:ld(()=>{ho(t),r()})});return t}var te=class r{static DISABLE_DISPOSED_WARNING=!1;_toDispose=new Set;_isDisposed=!1;constructor(){po(this)}dispose(){this._isDisposed||(ho(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{qt(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return Rl(t,this),this._isDisposed?r.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Rl(t,null))}},_=class{static None=Object.freeze({dispose(){}});_store=new te;constructor(){po(this),Rl(this._store,this)}dispose(){ho(this),this._store.dispose()}_register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(t)}},zt=class{_value;_isDisposed=!1;constructor(){po(this)}get value(){return this._isDisposed?void 0:this._value}set value(t){this._isDisposed||t===this._value||(this._value?.dispose(),t&&Rl(t,this),this._value=t)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,ho(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let t=this._value;return this._value=void 0,t&&Rl(t,null),t}};var ar=class{_store=new Map;_isDisposed=!1;constructor(){po(this)}dispose(){ho(this),this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{qt(this._store.values())}finally{this._store.clear()}}has(t){return this._store.has(t)}get size(){return this._store.size}get(t){return this._store.get(t)}set(t,e,n=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),n||this._store.get(t)?.dispose(),this._store.set(t,e)}deleteAndDispose(t){this._store.get(t)?.dispose(),this._store.delete(t)}deleteAndLeak(t){let e=this._store.get(t);return this._store.delete(t),e}keys(){return this._store.keys()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var lt=class r{static Undefined=new r(void 0);element;next;prev;constructor(t){this.element=t,this.next=r.Undefined,this.prev=r.Undefined}},yi=class{_first=lt.Undefined;_last=lt.Undefined;_size=0;get size(){return this._size}isEmpty(){return this._first===lt.Undefined}clear(){let t=this._first;for(;t!==lt.Undefined;){let e=t.next;t.prev=lt.Undefined,t.next=lt.Undefined,t=e}this._first=lt.Undefined,this._last=lt.Undefined,this._size=0}unshift(t){return this._insert(t,!1)}push(t){return this._insert(t,!0)}_insert(t,e){let n=new lt(t);if(this._first===lt.Undefined)this._first=n,this._last=n;else if(e){let o=this._last;this._last=n,n.prev=o,o.next=n}else{let o=this._first;this._first=n,n.next=o,o.prev=n}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(n))}}shift(){if(this._first!==lt.Undefined){let t=this._first.element;return this._remove(this._first),t}}pop(){if(this._last!==lt.Undefined){let t=this._last.element;return this._remove(this._last),t}}_remove(t){if(t.prev!==lt.Undefined&&t.next!==lt.Undefined){let e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===lt.Undefined&&t.next===lt.Undefined?(this._first=lt.Undefined,this._last=lt.Undefined):t.next===lt.Undefined?(this._last=this._last.prev,this._last.next=lt.Undefined):t.prev===lt.Undefined&&(this._first=this._first.next,this._first.prev=lt.Undefined);this._size-=1}*[Symbol.iterator](){let t=this._first;for(;t!==lt.Undefined;)yield t.element,t=t.next}};var go=(r,t)=>r===t;var lr=class{constructor(t,e,n){this.owner=t;this.debugNameSource=e;this.referenceFn=n}getDebugName(t){return oI(t,this)}},nI=new Map,Hh=new WeakMap;function oI(r,t){let e=Hh.get(r);if(e)return e;let n=hE(r,t);if(n){let i=nI.get(n)??0;i++,nI.set(n,i);let o=i===1?n:`${n}#${i}`;return Hh.set(r,o),o}}function hE(r,t){let e=Hh.get(r);if(e)return e;let n=t.owner?mE(t.owner)+".":"",i,o=t.debugNameSource;if(o!==void 0)if(typeof o=="function"){if(i=o(),i!==void 0)return n+i}else return n+o;let s=t.referenceFn;if(s!==void 0&&(i=Pd(s),i!==void 0))return n+i;if(t.owner!==void 0){let a=gE(t.owner,r);if(a!==void 0)return n+a}}function gE(r,t){for(let e in r)if(r[e]===t)return e}var rI=new Map,iI=new WeakMap;function mE(r){let t=iI.get(r);if(t)return t;let e=yE(r),n=rI.get(e)??0;n++,rI.set(e,n);let i=n===1?e:`${e}#${n}`;return iI.set(r,i),i}function yE(r){let t=r.constructor;return t?t.name:"Object"}function Pd(r){let t=r.toString(),n=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(t);return(n?n[1]:void 0)?.trim()}function Td(r,t){if(!r)throw new Error(t?`Assertion failed (${t})`:"Assertion Failed")}function sI(r,t="Unreachable"){throw new Error(t)}function Rd(r){if(!r()){debugger;r(),ze(new Zo("Assertion Failed"))}}function Cl(r){return new Cd(new lr(void 0,void 0,r),r,void 0,void 0)}var Cd=class{constructor(t,e,n,i){this._debugNameData=t;this._runFn=e;this.createChangeSummary=n;this._handleChange=i;this.changeSummary=this.createChangeSummary?.(),_n()?.handleAutorunCreated(this),this._runIfNeeded(),po(this)}state=2;updateCount=0;disposed=!1;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}dispose(){this.disposed=!0;for(let t of this.dependencies)t.removeObserver(this);this.dependencies.clear(),ho(this)}_runIfNeeded(){if(this.state===3)return;let t=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=t,this.state=3;let e=this.disposed;try{if(!e){_n()?.handleAutorunTriggered(this);let n=this.changeSummary;try{this.changeSummary=this.createChangeSummary?.(),this._runFn(this,n)}catch(i){es(i)}}}finally{e||_n()?.handleAutorunFinished(this);for(let n of this.dependenciesToBeRemoved)n.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){try{if(this.updateCount===1)do{if(this.state===1){this.state=3;for(let t of this.dependencies)if(t.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3)}finally{this.updateCount--}Rd(()=>this.updateCount>=0)}handlePossibleChange(t){this.state===3&&this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t)&&(this.state=1)}handleChange(t,e){if(this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t))try{(this._handleChange?this._handleChange({changedObservable:t,change:e,didChange:i=>i===t},this.changeSummary):!0)&&(this.state=2)}catch(n){es(n)}}readObservable(t){if(this.disposed)return t.get();t.addObserver(this);let e=t.get();return this.dependencies.add(t),this.dependenciesToBeRemoved.delete(t),e}};(t=>t.Observer=Cd)(Cl||={});function jh(r,t){return new Dd(new lr(r.owner,r.debugName,r.debugReferenceFn),t,void 0,void 0,r.onLastObserverRemoved,r.equalsFn??go)}aI(jh);var Dd=class extends mo{constructor(e,n,i,o,s=void 0,a){super();this._debugNameData=e;this._computeFn=n;this.createChangeSummary=i;this._handleChange=o;this._handleLastObserverRemoved=s;this._equalityComparator=a;this.changeSummary=this.createChangeSummary?.(),_n()?.handleDerivedCreated(this)}state=0;value=void 0;updateCount=0;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary=void 0;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}onLastObserverRemoved(){this.state=0,this.value=void 0;for(let e of this.dependencies)e.removeObserver(this);this.dependencies.clear(),this._handleLastObserverRemoved?.()}get(){if(this.observers.size===0){let e=this._computeFn(this,this.createChangeSummary?.());return this.onLastObserverRemoved(),e}else{do{if(this.state===1){for(let e of this.dependencies)if(e.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){if(this.state===3)return;let e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e;let n=this.state!==0,i=this.value;this.state=3;let o=!1;try{let s=this.changeSummary;this.changeSummary=this.createChangeSummary?.();try{this.value=this._computeFn(this,s)}finally{for(let a of this.dependenciesToBeRemoved)a.removeObserver(this);this.dependenciesToBeRemoved.clear()}o=n&&!this._equalityComparator(i,this.value),_n()?.handleDerivedRecomputed(this,{oldValue:i,newValue:this.value,change:void 0,didChange:o,hadValue:n})}catch(s){es(s)}if(o)for(let s of this.observers)s.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){this.updateCount++;let n=this.updateCount===1;if(this.state===3&&(this.state=1,!n))for(let i of this.observers)i.handlePossibleChange(this);if(n)for(let i of this.observers)i.beginUpdate(this)}endUpdate(e){if(this.updateCount--,this.updateCount===0){let n=[...this.observers];for(let i of n)i.endUpdate(this)}Rd(()=>this.updateCount>=0)}handlePossibleChange(e){if(this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){this.state=1;for(let n of this.observers)n.handlePossibleChange(this)}}handleChange(e,n){if(this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){let i=!1;try{i=this._handleChange?this._handleChange({changedObservable:e,change:n,didChange:s=>s===e},this.changeSummary):!0}catch(s){es(s)}let o=this.state===3;if(i&&(this.state===1||o)&&(this.state=2,o))for(let s of this.observers)s.handlePossibleChange(this)}}readObservable(e){e.addObserver(this);let n=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),n}addObserver(e){let n=!this.observers.has(e)&&this.updateCount>0;super.addObserver(e),n&&e.beginUpdate(this)}removeObserver(e){let n=this.observers.has(e)&&this.updateCount>0;super.removeObserver(e),n&&e.endUpdate(this)}};function Gh(...r){let t,e,n;return r.length===3?[t,e,n]=r:[e,n]=r,new vi(new lr(t,void 0,n),e,n,()=>vi.globalTransaction,go)}var vi=class extends mo{constructor(e,n,i,o,s){super();this._debugNameData=e;this.event=n;this._getValue=i;this._getTransaction=o;this._equalityComparator=s}static globalTransaction;value;hasValue=!1;subscription;getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){let e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}handleEvent=e=>{let n=this._getValue(e),i=this.value,o=!this.hasValue||!this._equalityComparator(i,n),s=!1;o&&(this.value=n,this.hasValue&&(s=!0,Qh(this._getTransaction(),a=>{_n()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:n,change:void 0,didChange:o,hadValue:this.hasValue});for(let l of this.observers)a.updateObserver(l,this),l.handleChange(this,void 0)},()=>{let a=this.getDebugName();return"Event fired"+(a?`: ${a}`:"")})),this.hasValue=!0),s||_n()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:n,change:void 0,didChange:o,hadValue:this.hasValue})};onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}};(e=>{e.Observer=vi;function t(n,i){let o=!1;vi.globalTransaction===void 0&&(vi.globalTransaction=n,o=!0);try{i()}finally{o&&(vi.globalTransaction=void 0)}}e.batchEventsGlobally=t})(Gh||={});function cI(r){let t=new _d(!1,void 0);return r.addObserver(t),J(()=>{r.removeObserver(t)})}fI(cI);function dI(r,t){let e=new _d(!0,t);return r.addObserver(e),t?t(r.get()):r.reportChanges(),J(()=>{r.removeObserver(e)})}uI(dI);var _d=class{constructor(t,e){this._forceRecompute=t;this._handleValue=e}_counter=0;beginUpdate(t){this._counter++}endUpdate(t){this._counter--,this._counter===0&&this._forceRecompute&&(this._handleValue?this._handleValue(t.get()):t.reportChanges())}handlePossibleChange(t){}handleChange(t,e){}};var hI;function gI(r){hI=r}function _n(){return hI}var Ld=class{indentation=0;textToConsoleArgs(t){return bE([is(wE("|  ",this.indentation)),t])}formatInfo(t){return t.hadValue?t.didChange?[is(" "),cr(_l(t.oldValue,70),{color:"red",strikeThrough:!0}),is(" "),cr(_l(t.newValue,60),{color:"green"})]:[is(" (unchanged)")]:[is(" "),cr(_l(t.newValue,60),{color:"green"}),is(" (initial)")]}handleObservableChanged(t,e){console.log(...this.textToConsoleArgs([Dl("observable value changed"),cr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e)]))}changedObservablesSets=new WeakMap;formatChanges(t){if(t.size!==0)return cr(" (changed deps: "+[...t].map(e=>e.debugName).join(", ")+")",{color:"gray"})}handleDerivedCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(n,i)=>(this.changedObservablesSets.get(t).add(n),e.apply(t,[n,i]))}handleDerivedRecomputed(t,e){let n=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([Dl("derived recomputed"),cr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),this.formatChanges(n),{data:[{fn:t._debugNameData.referenceFn??t._computeFn}]}])),n.clear()}handleFromEventObservableTriggered(t,e){console.log(...this.textToConsoleArgs([Dl("observable from event triggered"),cr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),{data:[{fn:t._getValue}]}]))}handleAutorunCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(n,i)=>(this.changedObservablesSets.get(t).add(n),e.apply(t,[n,i]))}handleAutorunTriggered(t){let e=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([Dl("autorun"),cr(t.debugName,{color:"BlueViolet"}),this.formatChanges(e),{data:[{fn:t._debugNameData.referenceFn??t._runFn}]}])),e.clear(),this.indentation++}handleAutorunFinished(t){this.indentation--}handleBeginTransaction(t){let e=t.getDebugName();e===void 0&&(e=""),console.log(...this.textToConsoleArgs([Dl("transaction"),cr(e,{color:"BlueViolet"}),{data:[{fn:t._fn}]}])),this.indentation++}handleEndTransaction(){this.indentation--}};function bE(r){let t=new Array,e=[],n="";function i(s){if("length"in s)for(let a of s)a&&i(a);else"text"in s?(n+=`%c${s.text}`,t.push(s.style),s.data&&e.push(...s.data)):"data"in s&&e.push(...s.data)}i(r);let o=[n,...t];return o.push(...e),o}function is(r){return cr(r,{color:"black"})}function Dl(r){return cr(PE(`${r}: `,10),{color:"black",bold:!0})}function cr(r,t={color:"black"}){function e(i){return Object.entries(i).reduce((o,[s,a])=>`${o}${s}:${a};`,"")}let n={color:t.color};return t.strikeThrough&&(n["text-decoration"]="line-through"),t.bold&&(n["font-weight"]="bold"),{text:r,style:e(n)}}function _l(r,t){switch(typeof r){case"number":return""+r;case"string":return r.length+2<=t?`"${r}"`:`"${r.substr(0,t-7)}"+...`;case"boolean":return r?"true":"false";case"undefined":return"undefined";case"object":return r===null?"null":Array.isArray(r)?xE(r,t):EE(r,t);case"symbol":return r.toString();case"function":return`[[Function${r.name?" "+r.name:""}]]`;default:return""+r}}function xE(r,t){let e="[ ",n=!0;for(let i of r){if(n||(e+=", "),e.length-5>t){e+="...";break}n=!1,e+=`${_l(i,t-e.length)}`}return e+=" ]",e}function EE(r,t){let e="{ ",n=!0;for(let[i,o]of Object.entries(r)){if(n||(e+=", "),e.length-5>t){e+="...";break}n=!1,e+=`${i}: ${_l(o,t-e.length)}`}return e+=" }",e}function wE(r,t){let e="";for(let n=1;n<=t;n++)e+=r;return e}function PE(r,t){for(;r.length<t;)r+=" ";return r}var mI;function uI(r){mI=r}var yI;function fI(r){yI=r}var Jh;function aI(r){Jh=r}var kd=class{get TChange(){return null}reportChanges(){this.get()}read(t){return t?t.readObservable(this):this.get()}map(t,e){let n=e===void 0?void 0:t,i=e===void 0?t:e;return Jh({owner:n,debugName:()=>{let o=Pd(i);if(o!==void 0)return o;let a=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(i.toString());if(a)return`${this.debugName}.${a[2]}`;if(!n)return`${this.debugName} (mapped)`},debugReferenceFn:i},o=>i(this.read(o),o))}flatten(){return Jh({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},t=>this.read(t).read(t))}recomputeInitiallyAndOnChange(t,e){return t.add(mI(this,e)),this}keepObserved(t){return t.add(yI(this)),this}get debugValue(){return this.get()}},mo=class extends kd{observers=new Set;addObserver(t){let e=this.observers.size;this.observers.add(t),e===0&&this.onFirstObserverAdded()}removeObserver(t){this.observers.delete(t)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}};function Ud(r,t){let e=new Fd(r,t);try{r(e)}finally{e.finish()}}function Qh(r,t,e){r?t(r):Ud(t,e)}var Fd=class{constructor(t,e){this._fn=t;this._getDebugName=e;_n()?.handleBeginTransaction(this)}updatingObservers=[];getDebugName(){return this._getDebugName?this._getDebugName():Pd(this._fn)}updateObserver(t,e){this.updatingObservers.push({observer:t,observable:e}),t.beginUpdate(e)}finish(){let t=this.updatingObservers;for(let e=0;e<t.length;e++){let{observer:n,observable:i}=t[e];n.endUpdate(i)}this.updatingObservers=null,_n()?.handleEndTransaction()}};var TE=!1;TE&&gI(new Ld);var RE=globalThis.performance&&typeof globalThis.performance.now=="function",dr=class r{_startTime;_stopTime;_now;static create(t){return new r(t)}constructor(t){this._now=RE&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}};var vI=Symbol("MicrotaskDelay");var CE=!1,II=!1,DE=!1,O;(st=>{st.None=()=>_.None;function t($){if(DE){let{onDidAddListener:N}=$,q=kl.create(),H=0;$.onDidAddListener=()=>{++H===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),q.print()),N?.()}}}function e($,N){return h($,()=>{},0,void 0,!0,void 0,N)}st.defer=e;function n($){return(N,q=null,H)=>{let ae=!1,Se;return Se=$(Ae=>{if(!ae)return Se?Se.dispose():ae=!0,N.call(q,Ae)},null,H),ae&&Se.dispose(),Se}}st.once=n;function i($,N){return st.once(st.filter($,N))}st.onceIf=i;function o($,N,q){return u((H,ae=null,Se)=>$(Ae=>H.call(ae,N(Ae)),null,Se),q)}st.map=o;function s($,N,q){return u((H,ae=null,Se)=>$(Ae=>{N(Ae),H.call(ae,Ae)},null,Se),q)}st.forEach=s;function a($,N,q){return u((H,ae=null,Se)=>$(Ae=>N(Ae)&&H.call(ae,Ae),null,Se),q)}st.filter=a;function l($){return $}st.signal=l;function c(...$){return(N,q=null,H)=>{let ae=mi(...$.map(Se=>Se(Ae=>N.call(q,Ae))));return f(ae,H)}}st.any=c;function d($,N,q,H){let ae=q;return o($,Se=>(ae=N(ae,Se),ae),H)}st.reduce=d;function u($,N){let q,H={onWillAddFirstListener(){q=$(ae.fire,ae)},onDidRemoveLastListener(){q?.dispose()}};N||t(H);let ae=new P(H);return N?.add(ae),ae.event}function f($,N){return N instanceof Array?N.push($):N&&N.add($),$}function h($,N,q=100,H=!1,ae=!1,Se,Ae){let pt,Ft,fe,si=0,$r,ai={leakWarningThreshold:Se,onWillAddFirstListener(){pt=$(ed=>{si++,Ft=N(Ft,ed),H&&!fe&&(ao.fire(Ft),Ft=void 0),$r=()=>{let td=Ft;Ft=void 0,fe=void 0,(!H||si>1)&&ao.fire(td),si=0},typeof q=="number"?(clearTimeout(fe),fe=setTimeout($r,q)):fe===void 0&&(fe=0,queueMicrotask($r))})},onWillRemoveListener(){ae&&si>0&&$r?.()},onDidRemoveLastListener(){$r=void 0,pt.dispose()}};Ae||t(ai);let ao=new P(ai);return Ae?.add(ao),ao.event}st.debounce=h;function v($,N=0,q){return st.debounce($,(H,ae)=>H?(H.push(ae),H):[ae],N,void 0,!0,void 0,q)}st.accumulate=v;function y($,N=(H,ae)=>H===ae,q){let H=!0,ae;return a($,Se=>{let Ae=H||!N(Se,ae);return H=!1,ae=Se,Ae},q)}st.latch=y;function I($,N,q){return[st.filter($,N,q),st.filter($,H=>!N(H),q)]}st.split=I;function x($,N=!1,q=[],H){let ae=q.slice(),Se=$(Ft=>{ae?ae.push(Ft):pt.fire(Ft)});H&&H.add(Se);let Ae=()=>{ae?.forEach(Ft=>pt.fire(Ft)),ae=null},pt=new P({onWillAddFirstListener(){Se||(Se=$(Ft=>pt.fire(Ft)),H&&H.add(Se))},onDidAddFirstListener(){ae&&(N?setTimeout(Ae):Ae())},onDidRemoveLastListener(){Se&&Se.dispose(),Se=null}});return H&&H.add(pt),pt.event}st.buffer=x;function T($,N){return(H,ae,Se)=>{let Ae=N(new w);return $(function(pt){let Ft=Ae.evaluate(pt);Ft!==R&&H.call(ae,Ft)},void 0,Se)}}st.chain=T;let R=Symbol("HaltChainable");class w{steps=[];map(N){return this.steps.push(N),this}forEach(N){return this.steps.push(q=>(N(q),q)),this}filter(N){return this.steps.push(q=>N(q)?q:R),this}reduce(N,q){let H=q;return this.steps.push(ae=>(H=N(H,ae),H)),this}latch(N=(q,H)=>q===H){let q=!0,H;return this.steps.push(ae=>{let Se=q||!N(ae,H);return q=!1,H=ae,Se?ae:R}),this}evaluate(N){for(let q of this.steps)if(N=q(N),N===R)break;return N}}function L($,N,q=H=>H){let H=(...pt)=>Ae.fire(q(...pt)),ae=()=>$.on(N,H),Se=()=>$.removeListener(N,H),Ae=new P({onWillAddFirstListener:ae,onDidRemoveLastListener:Se});return Ae.event}st.fromNodeEventEmitter=L;function Q($,N,q=H=>H){let H=(...pt)=>Ae.fire(q(...pt)),ae=()=>$.addEventListener(N,H),Se=()=>$.removeEventListener(N,H),Ae=new P({onWillAddFirstListener:ae,onDidRemoveLastListener:Se});return Ae.event}st.fromDOMEventEmitter=Q;function K($){return new Promise(N=>n($)(N))}st.toPromise=K;function U($){let N=new P;return $.then(q=>{N.fire(q)},()=>{N.fire(void 0)}).finally(()=>{N.dispose()}),N.event}st.fromPromise=U;function B($,N){return $(q=>N.fire(q))}st.forward=B;function Ee($,N,q){return N(q),$(H=>N(H))}st.runAndSubscribe=Ee;class se{constructor(N,q){this._observable=N;let H={onWillAddFirstListener:()=>{N.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{N.removeObserver(this)}};q||t(H),this.emitter=new P(H),q&&q.add(this.emitter)}emitter;_counter=0;_hasChanged=!1;beginUpdate(N){this._counter++}handlePossibleChange(N){}handleChange(N,q){this._hasChanged=!0}endUpdate(N){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function ie($,N){return new se($,N).emitter.event}st.fromObservable=ie;function Ve($){return(N,q,H)=>{let ae=0,Se=!1,Ae={beginUpdate(){ae++},endUpdate(){ae--,ae===0&&($.reportChanges(),Se&&(Se=!1,N.call(q)))},handlePossibleChange(){},handleChange(){Se=!0}};$.addObserver(Ae),$.reportChanges();let pt={dispose(){$.removeObserver(Ae)}};return H instanceof te?H.add(pt):Array.isArray(H)&&H.push(pt),pt}}st.fromObservableLight=Ve})(O||={});var Xh=class r{static all=new Set;static _idPool=0;name;listenerCount=0;invocationCount=0;elapsedOverall=0;durations=[];_stopWatch;constructor(t){this.name=`${t}_${r._idPool++}`,r.all.add(this)}start(t){this._stopWatch=new dr,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}},SI=-1;var Yh=class r{constructor(t,e,n=(r._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t;this.threshold=e;this.name=n}static _idPool=1;_stacks;_warnCountdown=0;dispose(){this._stacks?.clear()}check(t,e){let n=this.threshold;if(n<=0||e<n)return;this._stacks||(this._stacks=new Map);let i=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,i+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=n*.5;let[o,s]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${e} listeners already. MOST frequent listener (${s}):`;console.warn(a),console.warn(o);let l=new Zh(a,o);this._errorHandler(l)}return()=>{let o=this._stacks.get(t.value)||0;this._stacks.set(t.value,o-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,e=0;for(let[n,i]of this._stacks)(!t||e<i)&&(t=[n,i],e=i);return t}},kl=class r{constructor(t){this.value=t}static create(){let t=new Error;return new r(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Zh=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},eg=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},_E=0,os=class{constructor(t){this.value=t}stack;id=_E++},kE=2,UE=(r,t)=>{if(r instanceof os)t(r);else for(let e=0;e<r.length;e++){let n=r[e];n&&t(n)}},Ad;if(CE){let r=[];setInterval(()=>{r.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(r.join(`
`)),r.length=0)},3e3),Ad=new FinalizationRegistry(t=>{typeof t=="string"&&r.push(t)})}var P=class{_options;_leakageMon;_perfMon;_disposed;_event;_listeners;_deliveryQueue;_size=0;constructor(t){this._options=t,this._leakageMon=SI>0||this._options?.leakWarningThreshold?new Yh(t?.onListenerError??ze,this._options?.leakWarningThreshold??SI):void 0,this._perfMon=this._options?._profName?new Xh(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(II){let t=this._listeners;queueMicrotask(()=>{UE(t,e=>e.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(t,e,n)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let l=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(l);let c=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],d=new eg(`${l}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this._options?.onListenerError||ze)(d),_.None}if(this._disposed)return _.None;e&&(t=t.bind(e));let i=new os(t),o,s;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(i.stack=kl.create(),o=this._leakageMon.check(i.stack,this._size+1)),II&&(i.stack=s??kl.create()),this._listeners?this._listeners instanceof os?(this._deliveryQueue??=new tg,this._listeners=[this._listeners,i]):this._listeners.push(i):(this._options?.onWillAddFirstListener?.(this),this._listeners=i,this._options?.onDidAddFirstListener?.(this)),this._size++;let a=J(()=>{Ad?.unregister(a),o?.(),this._removeListener(i)});if(n instanceof te?n.add(a):Array.isArray(n)&&n.push(a),Ad){let l=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),c=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(l);Ad.register(a,c?.[2]??l,a)}return a},this._event}_removeListener(t){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let e=this._listeners,n=e.indexOf(t);if(n===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,e[n]=void 0;let i=this._deliveryQueue.current===this;if(this._size*kE<=e.length){let o=0;for(let s=0;s<e.length;s++)e[s]?e[o++]=e[s]:i&&(this._deliveryQueue.end--,o<this._deliveryQueue.i&&this._deliveryQueue.i--);e.length=o}}_deliver(t,e){if(!t)return;let n=this._options?.onListenerError||ze;if(!n){t.value(e);return}try{t.value(e)}catch(i){n(i)}}_deliverQueue(t){let e=t.current._listeners;for(;t.i<t.end;)this._deliver(e[t.i++],t.value);t.reset()}fire(t){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof os)this._deliver(this._listeners,t);else{let e=this._deliveryQueue;e.enqueue(this,t,this._listeners.length),this._deliverQueue(e)}this._perfMon?.stop()}hasListeners(){return this._size>0}};var tg=class{i=-1;end=0;current;value;enqueue(t,e,n){this.i=0,this.end=n,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}};var Ii=class extends P{_isPaused=0;_eventQueue=new yi;_mergeFn;get isPaused(){return this._isPaused!==0}constructor(t){super(t),this._mergeFn=t?.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){let t=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(t))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(t){this._size&&(this._isPaused!==0?this._eventQueue.push(t):super.fire(t))}};var Od=class{emitter;hasListeners=!1;events=[];constructor(){this.emitter=new P({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(t){let e={event:t,listener:null};return this.events.push(e),this.hasListeners&&this.hook(e),J(ld(()=>{this.hasListeners&&this.unhook(e);let i=this.events.indexOf(e);this.events.splice(i,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(t=>this.hook(t))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(t=>this.unhook(t))}hook(t){t.listener=t.event(e=>this.emitter.fire(e))}unhook(t){t.listener?.dispose(),t.listener=null}dispose(){this.emitter.dispose();for(let t of this.events)t.listener?.dispose();this.events=[]}};var Ul=class{listening=!1;inputEvent=O.None;inputEventListener=_.None;emitter=new P({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}});event=this.emitter.event;set input(t){this.inputEvent=t,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=t(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}};var bI=Object.freeze(function(r,t){let e=setTimeout(r.bind(t),0);return{dispose(){clearTimeout(e)}}}),ee;(n=>{function r(i){return i===n.None||i===n.Cancelled||i instanceof ss?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}n.isCancellationToken=r,n.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:O.None}),n.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:bI})})(ee||={});var ss=class{_isCancelled=!1;_emitter=null;cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?bI:(this._emitter||(this._emitter=new P),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},It=class{_token=void 0;_parentListener=void 0;constructor(t){this._parentListener=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new ss),this._token}cancel(){this._token?this._token instanceof ss&&this._token.cancel():this._token=ee.Cancelled}dispose(t=!1){t&&this.cancel(),this._parentListener?.dispose(),this._token?this._token instanceof ss&&this._token.dispose():this._token=ee.None}};function Pt(r,t,e=(n,i)=>n===i){if(r===t)return!0;if(!r||!t||r.length!==t.length)return!1;for(let n=0,i=r.length;n<i;n++)if(!e(r[n],t[n]))return!1;return!0}function qn(r){return r.filter(t=>!!t)}function Si(r){return Array.isArray(r)&&r.length>0}function gt(r,t=e=>e){let e=new Set;return r.filter(n=>{let i=t(n);return e.has(i)?!1:(e.add(i),!0)})}function ng(r,t){return r.push(t),()=>LE(r,t)}function LE(r,t){let e=r.indexOf(t);if(e>-1)return r.splice(e,1),t}function rg(r,t){let e;if(typeof t=="number"){let n=t;e=()=>{let i=Math.sin(n++)*179426549;return i-Math.floor(i)}}else e=Math.random;for(let n=r.length-1;n>0;n-=1){let i=Math.floor(e()*(n+1)),o=r[n];r[n]=r[i],r[i]=o}}function EI(r){return r[Math.floor(Math.random()*r.length)]}var wI;(a=>{function r(l){return l<0}a.isLessThan=r;function t(l){return l<=0}a.isLessThanOrEqual=t;function e(l){return l>0}a.isGreaterThan=e;function n(l){return l===0}a.isNeitherLessOrGreaterThan=n,a.greaterThan=1,a.lessThan=-1,a.neitherLessOrGreaterThan=0})(wI||={});var xI=class r{constructor(t){this.iterate=t}static empty=new r(t=>{});forEach(t){this.iterate(e=>(t(e),!0))}toArray(){let t=[];return this.iterate(e=>(t.push(e),!0)),t}filter(t){return new r(e=>this.iterate(n=>t(n)?e(n):!0))}map(t){return new r(e=>this.iterate(n=>e(t(n))))}some(t){let e=!1;return this.iterate(n=>(e=t(n),!e)),e}findFirst(t){let e;return this.iterate(n=>t(n)?(e=n,!1):!0),e}findLast(t){let e;return this.iterate(n=>(t(n)&&(e=n),!0)),e}findLastMaxBy(t){let e,n=!0;return this.iterate(i=>((n||wI.isGreaterThan(t(i,e)))&&(n=!1,e=i),!0)),e}};function De(r){return typeof r=="string"}function He(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)&&!(r instanceof RegExp)&&!(r instanceof Date)}function PI(r){let t=Object.getPrototypeOf(Uint8Array);return typeof r=="object"&&r instanceof t}function yo(r){return typeof r=="number"&&!isNaN(r)}function pn(r){return r===!0||r===!1}function kt(r){return typeof r>"u"}function TI(r){return!ct(r)}function ct(r){return kt(r)||r===null}function ig(r,t){if(!r)throw new Error(t?`Unexpected type, expected '${t}'`:"Unexpected type")}function kn(r){if(ct(r))throw new Error("Assertion Failed: argument is undefined or null");return r}var FE=Object.prototype.hasOwnProperty;function as(r){if(!He(r))return!1;for(let t in r)if(FE.call(r,t))return!1;return!0}function Md(r){return typeof r=="function"}function RI(r,t){let e=Math.min(r.length,t.length);for(let n=0;n<e;n++)AE(r[n],t[n])}function AE(r,t){if(De(t)){if(typeof r!==t)throw new Error(`argument does not match constraint: typeof ${t}`)}else if(Md(t)){try{if(r instanceof t)return}catch{}if(!ct(r)&&r.constructor===t||t.length===1&&t.call(void 0,r)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}function og(r,t){return t&&(r.stack||r.stacktrace)?g("stackTrace.format","{0}: {1}",DI(r),CI(r.stack)||CI(r.stacktrace)):DI(r)}function CI(r){return Array.isArray(r)?r.join(`
`):r}function DI(r){return r.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${r.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof r.code=="string"&&typeof r.errno=="number"&&typeof r.syscall=="string"?g("nodeExceptionMessage","A system error occurred ({0})",r.message):r.message||g("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function Tt(r=null,t=!1){if(!r)return g("error.defaultMessage","An unknown error occurred. Please consult the log for more details.");if(Array.isArray(r)){let e=qn(r),n=Tt(e[0],t);return e.length>1?g("error.moreErrors","{0} ({1} errors in total)",n,e.length):n}if(De(r))return r;if(r.detail){let e=r.detail;if(e.error)return og(e.error,t);if(e.exception)return og(e.exception,t)}return r.stack?og(r,t):r.message?r.message:g("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function OE(r){return r}var Nd=class{lastCache=void 0;lastArgKey=void 0;_fn;_computeKey;constructor(t,e){typeof t=="function"?(this._fn=t,this._computeKey=OE):(this._fn=e,this._computeKey=t.getCacheKey)}get(t){let e=this._computeKey(t);return this.lastArgKey!==e&&(this.lastArgKey=e,this.lastCache=this._fn(t)),this.lastCache}};var on=class{constructor(t){this.executor=t}_didRun=!1;_value;_error;get hasValue(){return this._didRun}get value(){if(!this._didRun)try{this._value=this.executor()}catch(t){this._error=t}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}};function UI(r){return!r||typeof r!="string"?!0:r.trim().length===0}function ur(r){return r.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function LI(r,t=" "){let e=Bd(r,t);return cs(e,t)}function Bd(r,t){if(!r||!t)return r;let e=t.length;if(e===0||r.length===0)return r;let n=0;for(;r.indexOf(t,n)===n;)n=n+e;return r.substring(n)}function cs(r,t){if(!r||!t)return r;let e=t.length,n=r.length;if(e===0||n===0)return r;let i=n,o=-1;for(;o=r.lastIndexOf(t,i-1),!(o===-1||o+e!==i);){if(o===0)return"";i=o}return r.substring(0,i)}function vo(r,t){return r<t?-1:r>t?1:0}function Wd(r,t,e=0,n=r.length,i=0,o=t.length){for(;e<n&&i<o;e++,i++){let l=r.charCodeAt(e),c=t.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=n-e,a=o-i;return s<a?-1:s>a?1:0}function Ll(r,t){return ds(r,t,0,r.length,0,t.length)}function ds(r,t,e=0,n=r.length,i=0,o=t.length){for(;e<n&&i<o;e++,i++){let l=r.charCodeAt(e),c=t.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return Wd(r.toLowerCase(),t.toLowerCase(),e,n,i,o);_I(l)&&(l-=32),_I(c)&&(c-=32);let d=l-c;if(d!==0)return d}let s=n-e,a=o-i;return s<a?-1:s>a?1:0}function _I(r){return r>=97&&r<=122}function sg(r){return r>=65&&r<=90}function Un(r,t){return r.length===t.length&&ds(r,t)===0}function bi(r,t){let e=t.length;return t.length>r.length?!1:ds(r,t,0,e)===0}function FI(r){return 55296<=r&&r<=56319}function ag(r){return 56320<=r&&r<=57343}function AI(r,t){return(r-55296<<10)+(t-56320)+65536}var oL=String.fromCharCode(65279);function OI(r){return r.charAt(0).toUpperCase()+r.slice(1)}var kI=class r{constructor(t){this.confusableDictionary=t}static ambiguousCharacterData=new on(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'));static cache=new Nd({getCacheKey:JSON.stringify},t=>{function e(d){let u=new Map;for(let f=0;f<d.length;f+=2)u.set(d[f],d[f+1]);return u}function n(d,u){let f=new Map(d);for(let[h,v]of u)f.set(h,v);return f}function i(d,u){if(!d)return u;let f=new Map;for(let[h,v]of d)u.has(h)&&f.set(h,v);return f}let o=this.ambiguousCharacterData.value,s=t.filter(d=>!d.startsWith("_")&&d in o);s.length===0&&(s=["_default"]);let a;for(let d of s){let u=e(o[d]);a=i(a,u)}let l=e(o._common),c=n(l,a);return new r(c)});static getInstance(t){return r.cache.get(Array.from(t))}static _locales=new on(()=>Object.keys(r.ambiguousCharacterData.value).filter(t=>!t.startsWith("_")));static getLocales(){return r._locales.value}isAmbiguous(t){return this.confusableDictionary.has(t)}containsAmbiguousCharacter(t){for(let e=0;e<t.length;e++){let n=t.codePointAt(e);if(typeof n=="number"&&this.isAmbiguous(n))return!0}return!1}getPrimaryConfusable(t){return this.confusableDictionary.get(t)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}};var ne;(fe=>(fe.inMemory="inmemory",fe.vscode="vscode",fe.internal="private",fe.walkThrough="walkThrough",fe.walkThroughSnippet="walkThroughSnippet",fe.http="http",fe.https="https",fe.file="file",fe.mailto="mailto",fe.untitled="untitled",fe.data="data",fe.command="command",fe.vscodeRemote="vscode-remote",fe.vscodeRemoteResource="vscode-remote-resource",fe.vscodeManagedRemoteResource="vscode-managed-remote-resource",fe.vscodeUserData="vscode-userdata",fe.vscodeCustomEditor="vscode-custom-editor",fe.vscodeNotebookCell="vscode-notebook-cell",fe.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",fe.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",fe.vscodeNotebookCellOutput="vscode-notebook-cell-output",fe.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",fe.vscodeNotebookMetadata="vscode-notebook-metadata",fe.vscodeInteractiveInput="vscode-interactive-input",fe.vscodeSettings="vscode-settings",fe.vscodeWorkspaceTrust="vscode-workspace-trust",fe.vscodeTerminal="vscode-terminal",fe.vscodeChatCodeBlock="vscode-chat-code-block",fe.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",fe.vscodeChatSesssion="vscode-chat-editor",fe.webviewPanel="webview-panel",fe.vscodeWebview="vscode-webview",fe.extension="extension",fe.vscodeFileResource="vscode-file",fe.tmp="tmp",fe.vsls="vsls",fe.vscodeSourceControl="vscode-scm",fe.commentsInput="comment",fe.codeSetting="code-setting",fe.outputChannel="output"))(ne||={});var ME="tkn",lg=class{_hosts=Object.create(null);_ports=Object.create(null);_connectionTokens=Object.create(null);_preferredWebSchema="http";_delegate=null;_serverRootPath="/";setPreferredWebSchema(t){this._preferredWebSchema=t}setDelegate(t){this._delegate=t}setServerRootPath(t,e){this._serverRootPath=NE(t,e)}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return _e.join(this._serverRootPath,ne.vscodeRemoteResource)}set(t,e,n){this._hosts[t]=e,this._ports[t]=n}setConnectionToken(t,e){this._connectionTokens[t]=e}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(t){if(this._delegate)try{return this._delegate(t)}catch(a){return ze(a),t}let e=t.authority,n=this._hosts[e];n&&n.indexOf(":")!==-1&&n.indexOf("[")===-1&&(n=`[${n}]`);let i=this._ports[e],o=this._connectionTokens[e],s=`path=${encodeURIComponent(t.path)}`;return typeof o=="string"&&(s+=`&${ME}=${encodeURIComponent(o)}`),C.from({scheme:qe?this._preferredWebSchema:ne.vscodeRemoteResource,authority:`${n}:${i}`,path:this._remoteResourcesPath,query:s})}},dg=new lg;function NE(r,t){return _e.join(t??"/",`${r.quality??"oss"}-${r.commit??"dev"}`)}var MI="vs/../../node_modules",NI="vs/../../node_modules.asar";var ug="vscode-app",cg=class r{static FALLBACK_AUTHORITY=ug;asBrowserUri(t){let e=this.toUri(t);return this.uriToBrowserUri(e)}uriToBrowserUri(t){return t.scheme===ne.vscodeRemote?dg.rewrite(t):t.scheme===ne.file&&(Mh||zv===`${ne.vscodeFileResource}://${r.FALLBACK_AUTHORITY}`)?t.with({scheme:ne.vscodeFileResource,authority:t.authority||r.FALLBACK_AUTHORITY,query:null,fragment:null}):t}asFileUri(t){let e=this.toUri(t);return this.uriToFileUri(e)}uriToFileUri(t){return t.scheme===ne.vscodeFileResource?t.with({scheme:ne.file,authority:t.authority!==r.FALLBACK_AUTHORITY?t.authority:null,query:null,fragment:null}):t}toUri(t,e){if(C.isUri(t))return t;if(globalThis._VSCODE_FILE_ROOT){let n=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(n))return C.joinPath(C.parse(n,!0),t);let i=W(n,t);return C.file(i)}return C.parse(e.toUrl(t))}},Sn=new cg,BE;(o=>{let r=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);o.CoopAndCoep=Object.freeze(r.get("3"));let e="vscode-coi";function n(s){let a;typeof s=="string"?a=new URL(s).searchParams:s instanceof URL?a=s.searchParams:C.isUri(s)&&(a=new URL(s.toString(!0)).searchParams);let l=a?.get(e);if(l)return r.get(l)}o.getHeadersFromQuery=n;function i(s,a,l){if(!globalThis.crossOriginIsolated)return;let c=a&&l?"3":l?"2":"1";s instanceof URLSearchParams?s.set(e,c):s[e]=c}o.addSearchParam=i})(BE||={});function xi(r){return r===47||r===92}function Vd(r){return r.replace(/[\\/]/g,_e.sep)}function BI(r){return r.indexOf("/")===-1&&(r=Vd(r)),/^[a-zA-Z]:(\/|$)/.test(r)&&(r="/"+r),r}function fg(r,t=_e.sep){if(!r)return"";let e=r.length,n=r.charCodeAt(0);if(xi(n)){if(xi(r.charCodeAt(1))&&!xi(r.charCodeAt(2))){let o=3,s=o;for(;o<e&&!xi(r.charCodeAt(o));o++);if(s!==o&&!xi(r.charCodeAt(o+1))){for(o+=1;o<e;o++)if(xi(r.charCodeAt(o)))return r.slice(0,o+1).replace(/[\\/]/g,t)}}return t}else if(WI(n)&&r.charCodeAt(1)===58)return xi(r.charCodeAt(2))?r.slice(0,2)+t:r.slice(0,2);let i=r.indexOf("://");if(i!==-1){for(i+=3;i<e;i++)if(xi(r.charCodeAt(i)))return r.slice(0,i+1)}return""}function Al(r,t,e){let n=r===t;return!e||n?n:!r||!t?!1:Un(r,t)}function Gr(r,t,e,n=wt){if(r===t)return!0;if(!r||!t||t.length>r.length)return!1;if(e){if(!bi(r,t))return!1;if(t.length===r.length)return!0;let o=t.length;return t.charAt(t.length-1)===n&&o--,r.charAt(o)===n}return t.charAt(t.length-1)!==n&&(t+=n),r.indexOf(t)===0}function WI(r){return r>=65&&r<=90||r>=97&&r<=122}function VI(r){return be?(r=cs(r,wt),r.endsWith(":")&&(r+=wt)):(r=cs(r,wt),r||(r=wt)),r}function KI(r){let t=Dn(r);return be?r.length>3?!1:$I(t)&&(r.length===2||t.charCodeAt(2)===92):t===_e.sep}function $I(r,t=be){return t?WI(r.charCodeAt(0))&&r.charCodeAt(1)===58:!1}var WE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",VE="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function zI(r,t,e=8){let n="";for(let o=0;o<e;o++){let s;o===0&&be&&!t&&(e===3||e===4)?s=VE:s=WE,n+=s.charAt(Math.floor(Math.random()*s.length))}let i;return t?i=`${t}-${n}`:i=n,r?W(r,i):i}function Dr(r){return Tl(r,!0)}var Io=class{constructor(t){this._ignorePathCasing=t}compare(t,e,n=!1){return t===e?0:vo(this.getComparisonKey(t,n),this.getComparisonKey(e,n))}isEqual(t,e,n=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,n)===this.getComparisonKey(e,n)}getComparisonKey(t,e=!1){return t.with({path:this._ignorePathCasing(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this._ignorePathCasing(t)}isEqualOrParent(t,e,n=!1){if(t.scheme===e.scheme){if(t.scheme===ne.file)return Gr(Dr(t),Dr(e),this._ignorePathCasing(t))&&t.query===e.query&&(n||t.fragment===e.fragment);if(qI(t.authority,e.authority))return Gr(t.path,e.path,this._ignorePathCasing(t),"/")&&t.query===e.query&&(n||t.fragment===e.fragment)}return!1}joinPath(t,...e){return C.joinPath(t,...e)}basenameOrAuthority(t){return _r(t)||t.authority}basename(t){return _e.basename(t.path)}extname(t){return _e.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===ne.file?e=C.file(Et(Dr(t))).path:(e=_e.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==47&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===ne.file?e=C.file(Dn(Dr(t))).path:e=_e.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!qI(t.authority,e.authority))return;if(t.scheme===ne.file){let o=bd(Dr(t),Dr(e));return be?Vd(o):o}let n=t.path||"/",i=e.path||"/";if(this._ignorePathCasing(t)){let o=0;for(let s=Math.min(n.length,i.length);o<s&&!(n.charCodeAt(o)!==i.charCodeAt(o)&&n.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);n=i.substr(0,o)+n.substr(o)}return _e.relative(n,i)}resolvePath(t,e){if(t.scheme===ne.file){let n=C.file(Rr(Dr(t),e));return t.with({authority:n.authority,path:n.path})}return e=BI(e),t.with({path:_e.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&Un(t,e)}hasTrailingPathSeparator(t,e=wt){if(t.scheme===ne.file){let n=Dr(t);return n.length>fg(n).length&&n[n.length-1]===e}else{let n=t.path;return n.length>1&&n.charCodeAt(n.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=wt){return HI(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=wt){let n=!1;if(t.scheme===ne.file){let i=Dr(t);n=i!==void 0&&i.length===fg(i).length&&i[i.length-1]===e}else{e="/";let i=t.path;n=i.length===1&&i.charCodeAt(i.length-1)===47}return!n&&!HI(t,e)?t.with({path:t.path+"/"}):t}},Le=new Io(()=>!1),So=new Io(r=>r.scheme===ne.file?!Oe:!0),pg=new Io(r=>!0),Ln=Le.isEqual.bind(Le),hg=Le.isEqualOrParent.bind(Le),IL=Le.getComparisonKey.bind(Le),$E=Le.basenameOrAuthority.bind(Le),_r=Le.basename.bind(Le),zE=Le.extname.bind(Le),Kd=Le.dirname.bind(Le),V=Le.joinPath.bind(Le),jI=Le.normalizePath.bind(Le),GI=Le.relativePath.bind(Le),SL=Le.resolvePath.bind(Le),QI=Le.isAbsolutePath.bind(Le),qI=Le.isEqualAuthority.bind(Le),HI=Le.hasTrailingPathSeparator.bind(Le),bL=Le.removeTrailingPathSeparator.bind(Le),xL=Le.addTrailingPathSeparator.bind(Le);var qE;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(d=>{let[u,f]=d.split(":");u&&f&&a.set(u,f)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(qE||={});function Gd(r){return!!r&&typeof r.then=="function"}function nt(r){let t=new It,e=r(t.token),n=new Promise((i,o)=>{let s=t.token.onCancellationRequested(()=>{s.dispose(),o(new Ge)});Promise.resolve(e).then(a=>{s.dispose(),t.dispose(),i(a)},a=>{s.dispose(),t.dispose(),o(a)})});return new class{cancel(){t.cancel(),t.dispose()}then(i,o){return n.then(i,o)}catch(i){return this.then(void 0,i)}finally(i){return n.finally(i)}}}function XI(){let r,t;return{promise:new Promise((n,i)=>{r=n,t=i}),resolve:r,reject:t}}var gg=class{activePromise;queuedPromise;queuedPromiseFactory;isDisposed=!1;constructor(){this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(t){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=t,!this.queuedPromise){let e=()=>{if(this.queuedPromise=null,this.isDisposed)return;let n=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,n};this.queuedPromise=new Promise(n=>{this.activePromise.then(e,e).then(n)})}return new Promise((e,n)=>{this.queuedPromise.then(e,n)})}return this.activePromise=t(),new Promise((e,n)=>{this.activePromise.then(i=>{this.activePromise=null,e(i)},i=>{this.activePromise=null,n(i)})})}dispose(){this.isDisposed=!0}},zd=class{current=Promise.resolve(null);queue(t){return this.current=this.current.then(()=>t(),()=>t())}};var HE=(r,t)=>{let e=!0,n=setTimeout(()=>{e=!1,t()},r);return{isTriggered:()=>e,dispose:()=>{clearTimeout(n),e=!1}}},jE=r=>{let t=!0;return queueMicrotask(()=>{t&&(t=!1,r())}),{isTriggered:()=>t,dispose:()=>{t=!1}}},bo=class{constructor(t){this.defaultDelay=t;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}deferred;completionPromise;doResolve;doReject;task;trigger(t,e=this.defaultDelay){this.task=t,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}));let n=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=e===vI?jE(n):HE(e,n),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new Ge),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}},hn=class{delayer;throttler;constructor(t){this.delayer=new bo(t),this.throttler=new gg}trigger(t,e){return this.delayer.trigger(()=>this.throttler.queue(t),e)}isTriggered(){return this.delayer.isTriggered()}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}},Ei=class{_isOpen;_promise;_completePromise;constructor(){this._isOpen=!1,this._promise=new Promise((t,e)=>{this._completePromise=t})}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}};function pr(r,t){return t?new Promise((e,n)=>{let i=setTimeout(()=>{o.dispose(),e()},r),o=t.onCancellationRequested(()=>{clearTimeout(i),o.dispose(),n(new Ge)})}):nt(e=>pr(r,e))}function Pi(r,t=0,e){let n=setTimeout(()=>{r(),e&&i.dispose()},t),i=J(()=>{clearTimeout(n),e?.deleteAndLeak(i)});return e?.add(i),i}var Ol=class{_size=0;_isDisposed=!1;runningPromises;maxDegreeOfParalellism;outstandingPromises;_onDrained;constructor(t){this.maxDegreeOfParalellism=t,this.outstandingPromises=[],this.runningPromises=0,this._onDrained=new P}whenIdle(){return this.size>0?O.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this._onDrained.event}get size(){return this._size}queue(t){if(this._isDisposed)throw new Error("Object has been disposed");return this._size++,new Promise((e,n)=>{this.outstandingPromises.push({factory:t,c:e,e:n}),this.consume()})}consume(){for(;this.outstandingPromises.length&&this.runningPromises<this.maxDegreeOfParalellism;){let t=this.outstandingPromises.shift();this.runningPromises++;let e=t.factory();e.then(t.c,t.e),e.then(()=>this.consumed(),()=>this.consumed())}}consumed(){this._isDisposed||(this.runningPromises--,--this._size===0&&this._onDrained.fire(),this.outstandingPromises.length>0&&this.consume())}clear(){if(this._isDisposed)throw new Error("Object has been disposed");this.outstandingPromises.length=0,this._size=this.runningPromises}dispose(){this._isDisposed=!0,this.outstandingPromises.length=0,this._size=0,this._onDrained.dispose()}},fr=class extends Ol{constructor(){super(1)}};var us=class{queues=new Map;drainers=new Set;drainListeners=void 0;drainListenerCount=0;async whenDrained(){if(this.isDrained())return;let t=new wi;return this.drainers.add(t),t.p}isDrained(){for(let[,t]of this.queues)if(t.size>0)return!1;return!0}queueSize(t,e=Le){let n=e.getComparisonKey(t);return this.queues.get(n)?.size??0}queueFor(t,e,n=Le){let i=n.getComparisonKey(t),o=this.queues.get(i);if(!o){o=new fr;let s=this.drainListenerCount++,a=O.once(o.onDrained)(()=>{o?.dispose(),this.queues.delete(i),this.onDidQueueDrain(),this.drainListeners?.deleteAndDispose(s),this.drainListeners?.size===0&&(this.drainListeners.dispose(),this.drainListeners=void 0)});this.drainListeners||(this.drainListeners=new ar),this.drainListeners.set(s,a),this.queues.set(i,o)}return o.queue(e)}onDidQueueDrain(){this.isDrained()&&this.releaseDrainers()}releaseDrainers(){for(let t of this.drainers)t.complete();this.drainers.clear()}dispose(){for(let[,t]of this.queues)t.dispose();this.queues.clear(),this.releaseDrainers(),this.drainListeners?.dispose()}};var mt=class{runner;timeoutToken;timeout;timeoutHandler;constructor(t,e){this.timeoutToken=-1,this.runner=t,this.timeout=e,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=-1)}schedule(t=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,t)}get delay(){return this.timeout}set delay(t){this.timeout=t}isScheduled(){return this.timeoutToken!==-1}flush(){this.isScheduled()&&(this.cancel(),this.doRun())}onTimeout(){this.timeoutToken=-1,this.runner&&this.doRun()}doRun(){this.runner?.()}};var qd=class extends mt{units=[];constructor(t,e){super(t,e)}work(t){this.units.push(t),this.isScheduled()||this.schedule()}doRun(){let t=this.units;this.units=[],this.runner?.(t)}dispose(){this.units=[],super.dispose()}},Hd=class extends _{constructor(e,n){super();this.options=e;this.handler=n}pendingWork=[];throttler=this._register(new zt);disposed=!1;get pending(){return this.pendingWork.length}work(e){if(this.disposed)return!1;if(typeof this.options.maxBufferedWork=="number"){if(this.throttler.value){if(this.pending+e.length>this.options.maxBufferedWork)return!1}else if(this.pending+e.length-this.options.maxWorkChunkSize>this.options.maxBufferedWork)return!1}for(let n of e)this.pendingWork.push(n);return this.throttler.value||this.doWork(),!0}doWork(){this.handler(this.pendingWork.splice(0,this.options.maxWorkChunkSize)),this.pendingWork.length>0&&(this.throttler.value=new mt(()=>{this.throttler.clear(),this.doWork()},this.options.throttleDelay),this.throttler.value.schedule())}dispose(){super.dispose(),this.disposed=!0}},yg,$d;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?$d=(r,t)=>{qv(()=>{if(e)return;let n=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,n-Date.now())}}))});let e=!1;return{dispose(){e||(e=!0)}}}:$d=(r,t,e)=>{let n=r.requestIdleCallback(t,typeof e=="number"?{timeout:e}:void 0),i=!1;return{dispose(){i||(i=!0,r.cancelIdleCallback(n))}}},yg=r=>$d(globalThis,r)})();var mg=class{_executor;_handle;_didRun=!1;_value;_error;constructor(t,e){this._executor=()=>{try{this._value=e()}catch(n){this._error=n}finally{this._didRun=!0}},this._handle=$d(t,()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}},jd=class extends mg{constructor(t){super(globalThis,t)}};async function YI(r,t,e){let n;for(let i=0;i<e;i++)try{return await r()}catch(o){n=o,await pr(t)}throw n}var wi=class{completeCallback;errorCallback;outcome;get isRejected(){return this.outcome?.outcome===1}get isResolved(){return this.outcome?.outcome===0}get isSettled(){return!!this.outcome}get value(){return this.outcome?.outcome===0?this.outcome?.value:void 0}p;constructor(){this.p=new Promise((t,e)=>{this.completeCallback=t,this.errorCallback=e})}complete(t){return new Promise(e=>{this.completeCallback(t),this.outcome={outcome:0,value:t},e()})}error(t){return new Promise(e=>{this.errorCallback(t),this.outcome={outcome:1,value:t},e()})}cancel(){return this.error(new Ge)}},Qe;(e=>{async function r(n){let i,o=await Promise.all(n.map(s=>s.then(a=>a,a=>{i||(i=a)})));if(typeof i<"u")throw i;return o}e.settled=r;function t(n){return new Promise(async(i,o)=>{try{await n(i,o)}catch(s){o(s)}})}e.withAsyncBody=t})(Qe||={});var JI=class r{static fromArray(t){return new r(e=>{e.emitMany(t)})}static fromPromise(t){return new r(async e=>{e.emitMany(await t)})}static fromPromises(t){return new r(async e=>{await Promise.all(t.map(async n=>e.emitOne(await n)))})}static merge(t){return new r(async e=>{await Promise.all(t.map(async n=>{for await(let i of n)e.emitOne(i)}))})}static EMPTY=r.fromArray([]);_state;_results;_error;_onReturn;_onStateChanged;constructor(t,e){this._state=0,this._results=[],this._error=null,this._onReturn=e,this._onStateChanged=new P,queueMicrotask(async()=>{let n={emitOne:i=>this.emitOne(i),emitMany:i=>this.emitMany(i),reject:i=>this.reject(i)};try{await Promise.resolve(t(n)),this.resolve()}catch(i){this.reject(i)}finally{n.emitOne=void 0,n.emitMany=void 0,n.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await O.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,e){return new r(async n=>{for await(let i of t)n.emitOne(e(i))})}map(t){return r.map(this,t)}static filter(t,e){return new r(async n=>{for await(let i of t)e(i)&&n.emitOne(i)})}filter(t){return r.filter(this,t)}static coalesce(t){return r.filter(t,e=>!!e)}coalesce(){return r.coalesce(this)}static async toPromise(t){let e=[];for await(let n of t)e.push(n);return e}toPromise(){return r.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};function Ml(r){let t=r;return t?[t.on,t.pause,t.resume,t.destroy].every(e=>typeof e=="function"):!1}function Qd(r){let t=r;return t?Ml(t.stream)&&Array.isArray(t.buffer)&&typeof t.ended=="boolean":!1}function Qr(r,t){return new vg(r,t)}var vg=class{constructor(t,e){this.reducer=t;this.options=e}state={flowing:!1,ended:!1,destroyed:!1};buffer={data:[],error:[]};listeners={data:[],error:[],end:[]};pendingWritePromises=[];pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(t){if(!this.state.destroyed){if(this.state.flowing)this.emitData(t);else if(this.buffer.data.push(t),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(e=>this.pendingWritePromises.push(e))}}error(t){this.state.destroyed||(this.state.flowing?this.emitError(t):this.buffer.error.push(t))}end(t){this.state.destroyed||(typeof t<"u"&&this.write(t),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(t){this.listeners.data.slice(0).forEach(e=>e(t))}emitError(t){this.listeners.error.length===0?ze(t):this.listeners.error.slice(0).forEach(e=>e(t))}emitEnd(){this.listeners.end.slice(0).forEach(t=>t())}on(t,e){if(!this.state.destroyed)switch(t){case"data":this.listeners.data.push(e),this.resume();break;case"end":this.listeners.end.push(e),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(e),this.state.flowing&&this.flowErrors();break}}removeListener(t,e){if(this.state.destroyed)return;let n;switch(t){case"data":n=this.listeners.data;break;case"end":n=this.listeners.end;break;case"error":n=this.listeners.error;break}if(n){let i=n.indexOf(e);i>=0&&n.splice(i,1)}}flowData(){if(this.buffer.data.length>0){let t=this.reducer(this.buffer.data);this.emitData(t),this.buffer.data.length=0;let e=[...this.pendingWritePromises];this.pendingWritePromises.length=0,e.forEach(n=>n())}}flowErrors(){if(this.listeners.error.length>0){for(let t of this.buffer.error)this.emitError(t);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}};function ZI(r,t){let e=[],n;for(;(n=r.read())!==null;)e.push(n);return t(e)}function eS(r,t,e){let n=[],i;for(;(i=r.read())!==null&&n.length<e;)n.push(i);return i===null&&n.length>0?t(n):{read:()=>{if(n.length>0)return n.shift();if(typeof i<"u"){let o=i;return i=void 0,o}return r.read()}}}function Jd(r,t){return new Promise((e,n)=>{let i=[];fs(r,{onData:o=>{t&&i.push(o)},onError:o=>{t?n(o):e(void 0)},onEnd:()=>{e(t?t(i):void 0)}})})}function fs(r,t,e){r.on("error",n=>{e?.isCancellationRequested||t.onError(n)}),r.on("end",()=>{e?.isCancellationRequested||t.onEnd()}),r.on("data",n=>{e?.isCancellationRequested||t.onData(n)})}function tS(r,t){return new Promise((e,n)=>{let i=new te,o=[],s=c=>{if(o.push(c),o.length>t)return i.dispose(),r.pause(),e({stream:r,buffer:o,ended:!1})},a=c=>(i.dispose(),n(c)),l=()=>(i.dispose(),e({stream:r,buffer:o,ended:!0}));i.add(J(()=>r.removeListener("error",a))),r.on("error",a),i.add(J(()=>r.removeListener("end",l))),r.on("end",l),i.add(J(()=>r.removeListener("data",s))),r.on("data",s)})}function nS(r){let t=!1;return{read:()=>t?null:(t=!0,r)}}function Xd(r,t,e){let n=Qr(e);return fs(r,{onData:i=>n.write(t.data(i)),onError:i=>n.error(t.error?t.error(i):i),onEnd:()=>n.end()}),n}var Yd=typeof Buffer<"u",QE=new on(()=>new Uint8Array(256)),Ig,Sg,A=class r{static alloc(t){return Yd?new r(Buffer.allocUnsafe(t)):new r(new Uint8Array(t))}static wrap(t){return Yd&&!Buffer.isBuffer(t)&&(t=Buffer.from(t.buffer,t.byteOffset,t.byteLength)),new r(t)}static fromString(t,e){return!(e?.dontUseNodeBuffer||!1)&&Yd?new r(Buffer.from(t)):(Ig||(Ig=new TextEncoder),new r(Ig.encode(t)))}static fromByteArray(t){let e=r.alloc(t.length);for(let n=0,i=t.length;n<i;n++)e.buffer[n]=t[n];return e}static concat(t,e){if(typeof e>"u"){e=0;for(let o=0,s=t.length;o<s;o++)e+=t[o].byteLength}let n=r.alloc(e),i=0;for(let o=0,s=t.length;o<s;o++){let a=t[o];n.set(a,i),i+=a.byteLength}return n}buffer;byteLength;constructor(t){this.buffer=t,this.byteLength=this.buffer.byteLength}clone(){let t=r.alloc(this.byteLength);return t.set(this),t}toString(){return Yd?this.buffer.toString():(Sg||(Sg=new TextDecoder),Sg.decode(this.buffer))}slice(t,e){return new r(this.buffer.subarray(t,e))}set(t,e){if(t instanceof r)this.buffer.set(t.buffer,e);else if(t instanceof Uint8Array)this.buffer.set(t,e);else if(t instanceof ArrayBuffer)this.buffer.set(new Uint8Array(t),e);else if(ArrayBuffer.isView(t))this.buffer.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e);else throw new Error("Unknown argument 'array'")}readUInt32BE(t){return JE(this.buffer,t)}writeUInt32BE(t,e){XE(this.buffer,t,e)}readUInt32LE(t){return YE(this.buffer,t)}writeUInt32LE(t,e){ZE(this.buffer,t,e)}readUInt8(t){return ew(this.buffer,t)}writeUInt8(t,e){tw(this.buffer,t,e)}indexOf(t,e=0){return bg(this.buffer,t instanceof r?t.buffer:t,e)}};function bg(r,t,e=0){let n=t.byteLength,i=r.byteLength;if(n===0)return 0;if(n===1)return r.indexOf(t[0]);if(n>i-e)return-1;let o=QE.value;o.fill(t.length);for(let c=0;c<t.length;c++)o[t[c]]=t.length-c-1;let s=e+t.length-1,a=s,l=-1;for(;s<i;)if(r[s]===t[a]){if(a===0){l=s;break}s--,a--}else s+=Math.max(t.length-a,o[r[s]]),a=t.length-1;return l}function JE(r,t){return r[t]*2**24+r[t+1]*2**16+r[t+2]*2**8+r[t+3]}function XE(r,t,e){r[e+3]=t,t=t>>>8,r[e+2]=t,t=t>>>8,r[e+1]=t,t=t>>>8,r[e]=t}function YE(r,t){return r[t+0]<<0>>>0|r[t+1]<<8>>>0|r[t+2]<<16>>>0|r[t+3]<<24>>>0}function ZE(r,t,e){r[e+0]=t&255,t=t>>>8,r[e+1]=t&255,t=t>>>8,r[e+2]=t&255,t=t>>>8,r[e+3]=t&255}function ew(r,t){return r[t]}function tw(r,t,e){r[e]=t}function rS(r){return ZI(r,t=>A.concat(t))}function iS(r){return nS(r)}function kr(r){return Jd(r,t=>A.concat(t))}async function oS(r){return r.ended?A.concat(r.buffer):A.concat([...r.buffer,await kr(r.stream)])}function sS(r){return Xd(r,{data:t=>typeof t=="string"?A.fromString(t):A.wrap(t)},t=>A.concat(t))}function aS(r){return Qr(t=>A.concat(t),r)}var nw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function lS({buffer:r},t=!0,e=!1){let n=e?rw:nw,i="",o=r.byteLength%3,s=0;for(;s<r.byteLength-o;s+=3){let a=r[s+0],l=r[s+1],c=r[s+2];i+=n[a>>>2],i+=n[(a<<4|l>>>4)&63],i+=n[(l<<2|c>>>6)&63],i+=n[c&63]}if(o===1){let a=r[s+0];i+=n[a>>>2],i+=n[a<<4&63],t&&(i+="==")}else if(o===2){let a=r[s+0],l=r[s+1];i+=n[a>>>2],i+=n[(a<<4|l>>>4)&63],i+=n[l<<2&63],t&&(i+="=")}return i}function We(r,t,e){let n=null,i=null;if(typeof e.value=="function"?(n="value",i=e.value,i.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof e.get=="function"&&(n="get",i=e.get),!i)throw new Error("not supported");let o=`$memoize$${t}`;e[n]=function(...s){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:i.apply(this,s)}),this[o]}}function cS(r){return JSON.stringify(r,iw)}function dS(r){let t=JSON.parse(r);return t=Ti(t),t}function iw(r,t){return t instanceof RegExp?{$mid:2,source:t.source,flags:t.flags}:t}function Ti(r,t=0){if(!r||t>200)return r;if(typeof r=="object"){switch(r.$mid){case 1:return C.revive(r);case 2:return new RegExp(r.source,r.flags);case 17:return new Date(r.source)}if(r instanceof A||r instanceof Uint8Array)return r;if(Array.isArray(r))for(let e=0;e<r.length;++e)r[e]=Ti(r[e],t+1);else for(let e in r)Object.hasOwnProperty.call(r,e)&&(r[e]=Ti(r[e],t+1))}return r}function gs(r){switch(r){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}function Zd(r){switch(r){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}function ps(r){let t=0;for(let e=0;;e+=7){let n=r.read(1);if(t|=(n.buffer[0]&127)<<e,!(n.buffer[0]&128))return t}}var ow=Ri(0);function hs(r,t){if(t===0){r.write(ow);return}let e=0;for(let i=t;i!==0;i=i>>>7)e++;let n=A.alloc(e);for(let i=0;t!==0;i++)n.buffer[i]=t&127,t=t>>>7,t>0&&(n.buffer[i]|=128);r.write(n)}var Nl=class{constructor(t){this.buffer=t}pos=0;read(t){let e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=e.byteLength,e}},eu=class{buffers=[];get buffer(){return A.concat(this.buffers)}write(t){this.buffers.push(t)}};function Ri(r){let t=A.alloc(1);return t.writeUInt8(r,0),t}var xo={Undefined:Ri(0),String:Ri(1),Buffer:Ri(2),VSBuffer:Ri(3),Array:Ri(4),Object:Ri(5),Uint:Ri(6)},sw=typeof Buffer<"u";function Bl(r,t){if(typeof t>"u")r.write(xo.Undefined);else if(typeof t=="string"){let e=A.fromString(t);r.write(xo.String),hs(r,e.byteLength),r.write(e)}else if(sw&&Buffer.isBuffer(t)){let e=A.wrap(t);r.write(xo.Buffer),hs(r,e.byteLength),r.write(e)}else if(t instanceof A)r.write(xo.VSBuffer),hs(r,t.byteLength),r.write(t);else if(Array.isArray(t)){r.write(xo.Array),hs(r,t.length);for(let e of t)Bl(r,e)}else if(typeof t=="number"&&(t|0)===t)r.write(xo.Uint),hs(r,t);else{let e=A.fromString(JSON.stringify(t));r.write(xo.Object),hs(r,e.byteLength),r.write(e)}}function ys(r){switch(r.read(1).readUInt8(0)){case 0:return;case 1:return r.read(ps(r)).toString();case 2:return r.read(ps(r)).buffer;case 3:return r.read(ps(r));case 4:{let e=ps(r),n=[];for(let i=0;i<e;i++)n.push(ys(r));return n}case 5:return JSON.parse(r.read(ps(r)).toString());case 6:return ps(r)}}var tu=class{constructor(t,e,n=null,i=1e3){this.protocol=t;this.ctx=e;this.logger=n;this.timeoutDelay=i;this.protocolListener=this.protocol.onMessage(o=>this.onRawMessage(o)),this.sendResponse({type:200})}channels=new Map;activeRequests=new Map;protocolListener;pendingRequests=new Map;registerChannel(t,e){this.channels.set(t,e),setTimeout(()=>this.flushPendingRequests(t),0)}sendResponse(t){switch(t.type){case 200:{let e=this.send([t.type]);this.logger?.logOutgoing(e,0,1,Zd(t.type));return}case 201:case 202:case 204:case 203:{let e=this.send([t.type,t.id],t.data);this.logger?.logOutgoing(e,t.id,1,Zd(t.type),t.data);return}}}send(t,e=void 0){let n=new eu;return Bl(n,t),Bl(n,e),this.sendBuffer(n.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onRawMessage(t){let e=new Nl(t),n=ys(e),i=ys(e),o=n[0];switch(o){case 100:return this.logger?.logIncoming(t.byteLength,n[1],1,`${gs(o)}: ${n[2]}.${n[3]}`,i),this.onPromise({type:o,id:n[1],channelName:n[2],name:n[3],arg:i});case 102:return this.logger?.logIncoming(t.byteLength,n[1],1,`${gs(o)}: ${n[2]}.${n[3]}`,i),this.onEventListen({type:o,id:n[1],channelName:n[2],name:n[3],arg:i});case 101:return this.logger?.logIncoming(t.byteLength,n[1],1,`${gs(o)}`),this.disposeActiveRequest({type:o,id:n[1]});case 103:return this.logger?.logIncoming(t.byteLength,n[1],1,`${gs(o)}`),this.disposeActiveRequest({type:o,id:n[1]})}}onPromise(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let n=new It,i;try{i=e.call(this.ctx,t.name,t.arg,n.token)}catch(a){i=Promise.reject(a)}let o=t.id;i.then(a=>{this.sendResponse({id:o,data:a,type:201})},a=>{a instanceof Error?this.sendResponse({id:o,data:{message:a.message,name:a.name,stack:a.stack?a.stack.split(`
`):void 0},type:202}):this.sendResponse({id:o,data:a,type:203})}).finally(()=>{s.dispose(),this.activeRequests.delete(t.id)});let s=J(()=>n.cancel());this.activeRequests.set(t.id,s)}onEventListen(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let n=t.id,o=e.listen(this.ctx,t.name,t.arg)(s=>this.sendResponse({id:n,data:s,type:204}));this.activeRequests.set(t.id,o)}disposeActiveRequest(t){let e=this.activeRequests.get(t.id);e&&(e.dispose(),this.activeRequests.delete(t.id))}collectPendingRequest(t){let e=this.pendingRequests.get(t.channelName);e||(e=[],this.pendingRequests.set(t.channelName,e));let n=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.sendResponse({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);e.push({request:t,timeoutTimer:n})}flushPendingRequests(t){let e=this.pendingRequests.get(t);if(e){for(let n of e)switch(clearTimeout(n.timeoutTimer),n.request.type){case 100:this.onPromise(n.request);break;case 102:this.onEventListen(n.request);break}this.pendingRequests.delete(t)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),qt(this.activeRequests.values()),this.activeRequests.clear()}};var ms=class{constructor(t,e=null){this.protocol=t;this.protocolListener=this.protocol.onMessage(n=>this.onBuffer(n)),this.logger=e}isDisposed=!1;state=0;activeRequests=new Set;handlers=new Map;lastRequestId=0;protocolListener;logger;_onDidInitialize=new P;onDidInitialize=this._onDidInitialize.event;getChannel(t){let e=this;return{call(n,i,o){return e.isDisposed?Promise.reject(new Ge):e.requestPromise(t,n,i,o)},listen(n,i){return e.isDisposed?O.None:e.requestEvent(t,n,i)}}}requestPromise(t,e,n,i=ee.None){let o=this.lastRequestId++,a={id:o,type:100,channelName:t,name:e,arg:n};if(i.isCancellationRequested)return Promise.reject(new Ge);let l;return new Promise((d,u)=>{if(i.isCancellationRequested)return u(new Ge);let f=()=>{let I=x=>{switch(x.type){case 201:this.handlers.delete(o),d(x.data);break;case 202:{this.handlers.delete(o);let T=new Error(x.data.message);T.stack=Array.isArray(x.data.stack)?x.data.stack.join(`
`):x.data.stack,T.name=x.data.name,u(T);break}case 203:this.handlers.delete(o),u(x.data);break}};this.handlers.set(o,I),this.sendRequest(a)},h=null;this.state===1?f():(h=nt(I=>this.whenInitialized()),h.then(()=>{h=null,f()}));let v=()=>{h?(h.cancel(),h=null):this.sendRequest({id:o,type:101}),u(new Ge)},y=i.onCancellationRequested(v);l=mi(J(v),y),this.activeRequests.add(l)}).finally(()=>{l.dispose(),this.activeRequests.delete(l)})}requestEvent(t,e,n){let i=this.lastRequestId++,s={id:i,type:102,channelName:t,name:e,arg:n},a=null,l=new P({onWillAddFirstListener:()=>{a=nt(d=>this.whenInitialized()),a.then(()=>{a=null,this.activeRequests.add(l),this.sendRequest(s)})},onDidRemoveLastListener:()=>{a?(a.cancel(),a=null):(this.activeRequests.delete(l),this.sendRequest({id:i,type:103}))}}),c=d=>l.fire(d.data);return this.handlers.set(i,c),l.event}sendRequest(t){switch(t.type){case 100:case 102:{let e=this.send([t.type,t.id,t.channelName,t.name],t.arg);this.logger?.logOutgoing(e,t.id,0,`${gs(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{let e=this.send([t.type,t.id]);this.logger?.logOutgoing(e,t.id,0,gs(t.type));return}}}send(t,e=void 0){let n=new eu;return Bl(n,t),Bl(n,e),this.sendBuffer(n.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onBuffer(t){let e=new Nl(t),n=ys(e),i=ys(e),o=n[0];switch(o){case 200:return this.logger?.logIncoming(t.byteLength,0,0,Zd(o)),this.onResponse({type:n[0]});case 201:case 202:case 204:case 203:return this.logger?.logIncoming(t.byteLength,n[1],0,Zd(o),i),this.onResponse({type:n[0],id:n[1],data:i})}}onResponse(t){if(t.type===200){this.state=1,this._onDidInitialize.fire();return}this.handlers.get(t.id)?.(t)}get onDidInitializePromise(){return O.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===1?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),qt(this.activeRequests.values()),this.activeRequests.clear()}};E([We],ms.prototype,"onDidInitializePromise",1);var Wl=class{channels=new Map;_connections=new Set;_onDidAddConnection=new P;onDidAddConnection=this._onDidAddConnection.event;_onDidRemoveConnection=new P;onDidRemoveConnection=this._onDidRemoveConnection.event;disposables=new te;get connections(){let t=[];return this._connections.forEach(e=>t.push(e)),t}constructor(t,e,n){this.disposables.add(t(({protocol:i,onDidClientDisconnect:o})=>{let s=O.once(i.onMessage);this.disposables.add(s(a=>{let l=new Nl(a),c=ys(l),d=new tu(i,c,e,n),u=new ms(i,e);this.channels.forEach((h,v)=>d.registerChannel(v,h));let f={channelServer:d,channelClient:u,ctx:c};this._connections.add(f),this._onDidAddConnection.fire(f),this.disposables.add(o(()=>{d.dispose(),u.dispose(),this._connections.delete(f),this._onDidRemoveConnection.fire(f)}))}))}))}getChannel(t,e){let n=this;return{call(i,o,s){let a;if(Md(e)){let c=EI(n.connections.filter(e));a=c?Promise.resolve(c):O.toPromise(O.filter(n.onDidAddConnection,e))}else a=e.routeCall(n,i,o);let l=a.then(c=>c.channelClient.getChannel(t));return uS(l).call(i,o,s)},listen(i,o){if(Md(e))return n.getMulticastEvent(t,e,i,o);let s=e.routeEvent(n,i,o).then(a=>a.channelClient.getChannel(t));return uS(s).listen(i,o)}}}getMulticastEvent(t,e,n,i){let o=this,s,a=new P({onWillAddFirstListener:()=>{s=new te;let l=new Od,c=new Map,d=f=>{let v=f.channelClient.getChannel(t).listen(n,i),y=l.add(v);c.set(f,y)},u=f=>{let h=c.get(f);h&&(h.dispose(),c.delete(f))};o.connections.filter(e).forEach(d),O.filter(o.onDidAddConnection,e)(d,void 0,s),o.onDidRemoveConnection(u,void 0,s),l.event(a.fire,a,s),s.add(l)},onDidRemoveLastListener:()=>{s?.dispose(),s=void 0}});return a.event}registerChannel(t,e){this.channels.set(t,e);for(let n of this._connections)n.channelServer.registerChannel(t,e)}dispose(){this.disposables.dispose();for(let t of this._connections)t.channelClient.dispose(),t.channelServer.dispose();this._connections.clear(),this.channels.clear(),this._onDidAddConnection.dispose(),this._onDidRemoveConnection.dispose()}};function uS(r){return{call(t,e,n){return r.then(i=>i.call(t,e,n))},listen(t,e){let n=new Ul;return r.then(i=>n.input=i.listen(t,e)),n.event}}}function fS(r){let t=!1;return{call(e,n,i){return t?r.call(e,n,i):pr(0).then(()=>t=!0).then(()=>r.call(e,n,i))},listen(e,n){if(t)return r.listen(e,n);let i=new Ul;return pr(0).then(()=>t=!0).then(()=>i.input=r.listen(e,n)),i.event}}}var Vl=class{constructor(t){this.fn=t}routeCall(t){return this.route(t)}routeEvent(t){return this.route(t)}async route(t){for(let e of t.connections)if(await Promise.resolve(this.fn(e.ctx)))return Promise.resolve(e);return await O.toPromise(t.onDidAddConnection),await this.route(t)}},Yt;(i=>{function r(o,s,a){let l=o,c=a&&a.disableMarshalling,d=new Map;for(let u in l)e(u)&&d.set(u,O.buffer(l[u],!0,void 0,s));return new class{listen(u,f,h){let v=d.get(f);if(v)return v;let y=l[f];if(typeof y=="function"){if(n(f))return y.call(l,h);if(e(f))return d.set(f,O.buffer(l[f],!0,void 0,s)),d.get(f)}throw new rr(`Event not found: ${f}`)}call(u,f,h){let v=l[f];if(typeof v=="function"){if(!c&&Array.isArray(h))for(let I=0;I<h.length;I++)h[I]=Ti(h[I]);let y=v.apply(l,h);return y instanceof Promise||(y=Promise.resolve(y)),y}throw new rr(`Method not found: ${f}`)}}}i.fromService=r;function t(o,s){let a=s&&s.disableMarshalling;return new Proxy({},{get(l,c){if(typeof c=="string")return s?.properties?.has(c)?s.properties.get(c):n(c)?function(d){return o.listen(c,d)}:e(c)?o.listen(c):async function(...d){let u;s&&!ct(s.context)?u=[s.context,...d]:u=d;let f=await o.call(c,u);return a?f:Ti(f)};throw new rr(`Property not found: ${String(c)}`)}})}i.toService=t;function e(o){return o[0]==="o"&&o[1]==="n"&&sg(o.charCodeAt(2))}function n(o){return/^onDynamic/.test(o)&&sg(o.charCodeAt(9))}})(Yt||={});var xg=class{constructor(t){this.port=t;t.start()}onMessage=O.fromNodeEventEmitter(this.port,"message",t=>t.data?A.wrap(t.data):A.alloc(0));send(t){this.port.postMessage(t.buffer)}disconnect(){this.port.close()}},nu=class r extends Wl{static getOnDidClientConnect(t){ig(Lv(process),"Electron Utility Process");let e=new P;return process.parentPort.on("message",n=>{if(t?.handledClientConnection(n))return;let i=n.ports.at(0);i&&e.fire(i)}),O.map(e.event,n=>({protocol:new xg(n),onDidClientDisconnect:O.fromNodeEventEmitter(n,"close")}))}constructor(t){super(r.getOnDidClientConnect(t))}};function pS(r,t,e){let n=i=>{i.data===t&&(r.removeListener("message",n),e())};r.on("message",n)}import*as FS from"fs";import*as xe from"fs";import{tmpdir as dw}from"os";import{promisify as ru}from"util";var aw=new jr(1e4);function Kl(r){return cw(r,"NFC",aw)}var R4=new jr(1e4);var lw=/[^\u0000-\u0080]/;function cw(r,t,e){if(!r)return r;let n=e.get(r);if(n)return n;let i;return lw.test(r)?i=r.normalize(t):i=r,e.set(r,i),i}async function gS(r,t=0,e){if(KI(r))throw new Error("rimraf - will refuse to recursively delete root");return t===0?Eg(r):uw(r,e)}async function uw(r,t=zI(dw())){try{try{await xe.promises.rename(r,t)}catch(e){return e.code==="ENOENT"?void 0:Eg(r)}Eg(t).catch(e=>{})}catch(e){if(e.code!=="ENOENT")throw e}}async function Eg(r){return xe.promises.rm(r,{recursive:!0,force:!0,maxRetries:3})}async function iu(r,t){return pw(await(t?fw(r):xe.promises.readdir(r)))}async function fw(r){try{return await xe.promises.readdir(r,{withFileTypes:!0})}catch(n){console.warn("[node.js fs] readdir with filetypes failed with error: ",n)}let t=[],e=await iu(r);for(let n of e){let i=!1,o=!1,s=!1;try{let a=await xe.promises.lstat(W(r,n));i=a.isFile(),o=a.isDirectory(),s=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}t.push({name:n,isFile:()=>i,isDirectory:()=>o,isSymbolicLink:()=>s})}return t}function pw(r){return r.map(t=>typeof t=="string"?_t?Kl(t):t:(t.name=_t?Kl(t.name):t.name,t))}async function hw(r){let t=await iu(r),e=[];for(let n of t)await gn.existsDirectory(W(r,n))&&e.push(n);return e}var gn;(n=>{async function r(i){let o;try{if(o=await xe.promises.lstat(i),!o.isSymbolicLink())return{stat:o}}catch{}try{return{stat:await xe.promises.stat(i),symbolicLink:o?.isSymbolicLink()?{dangling:!1}:void 0}}catch(s){if(s.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};if(be&&s.code==="EACCES")try{return{stat:await xe.promises.stat(await xe.promises.readlink(i)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};throw a}throw s}}n.stat=r;async function t(i){try{let{stat:o,symbolicLink:s}=await n.stat(i);return o.isFile()&&s?.dangling!==!0}catch{}return!1}n.existsFile=t;async function e(i){try{let{stat:o,symbolicLink:s}=await n.stat(i);return o.isDirectory()&&s?.dangling!==!0}catch{}return!1}n.existsDirectory=e})(gn||={});var gw=new us;function mw(r,t,e){return gw.queueFor(C.file(r),()=>{let n=Iw(e);return new Promise((i,o)=>vw(r,t,n,s=>s?o(s):i()))},So)}var mS=!0;function yw(r){mS=r}function vw(r,t,e,n){if(!mS)return xe.writeFile(r,t,{mode:e.mode,flag:e.flag},n);xe.open(r,e.flag,e.mode,(i,o)=>{if(i)return n(i);xe.writeFile(o,t,s=>{if(s)return xe.close(o,()=>n(s));xe.fdatasync(o,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),yw(!1)),xe.close(o,l=>n(l))))})})}function Iw(r){return r?{mode:typeof r.mode=="number"?r.mode:438,flag:typeof r.flag=="string"?r.flag:"w"}:{mode:438,flag:"w"}}async function Sw(r,t,e=6e4){if(r!==t)try{be&&typeof e=="number"?await yS(r,t,Date.now(),e):await xe.promises.rename(r,t)}catch(n){if(r.toLowerCase()!==t.toLowerCase()&&n.code==="EXDEV"||r.endsWith("."))await vS(r,t,{preserveSymlinks:!1}),await gS(r,1);else throw n}}async function yS(r,t,e,n,i=0){try{return await xe.promises.rename(r,t)}catch(o){if(o.code!=="EACCES"&&o.code!=="EPERM"&&o.code!=="EBUSY")throw o;if(Date.now()-e>=n)throw console.error(`[node.js fs] rename failed after ${i} retries with error: ${o}`),o;if(i===0){let s=!1;try{let{stat:a}=await gn.stat(t);a.isFile()||(s=!0)}catch{}if(s)throw o}return await pr(Math.min(100,i*10)),yS(r,t,e,n,i+1)}}async function vS(r,t,e){return IS(r,t,{root:{source:r,target:t},options:e,handledSourcePaths:new Set})}var hS=511;async function IS(r,t,e){if(e.handledSourcePaths.has(r))return;e.handledSourcePaths.add(r);let{stat:n,symbolicLink:i}=await gn.stat(r);if(i){if(e.options.preserveSymlinks)try{return await Ew(r,t,e)}catch{}if(i.dangling)return}return n.isDirectory()?bw(r,t,n.mode&hS,e):xw(r,t,n.mode&hS)}async function bw(r,t,e,n){await xe.promises.mkdir(t,{recursive:!0,mode:e});let i=await iu(r);for(let o of i)await IS(W(r,o),W(t,o),n)}async function xw(r,t,e){await xe.promises.copyFile(r,t),await xe.promises.chmod(t,e)}async function Ew(r,t,e){let n=await xe.promises.readlink(r);Gr(n,e.root.source,!Oe)&&(n=W(e.root.target,n.substr(e.root.source.length+1))),await xe.promises.symlink(n,t)}var ce=new class{get read(){return(r,t,e,n,i)=>new Promise((o,s)=>{xe.read(r,t,e,n,i,(a,l,c)=>a?s(a):o({bytesRead:l,buffer:c}))})}get write(){return(r,t,e,n,i)=>new Promise((o,s)=>{xe.write(r,t,e,n,i,(a,l,c)=>a?s(a):o({bytesWritten:l,buffer:c}))})}get fdatasync(){return ru(xe.fdatasync)}get open(){return ru(xe.open)}get close(){return ru(xe.close)}get realpath(){return ru(xe.realpath)}async exists(r){try{return await xe.promises.access(r),!0}catch{return!1}}get readdir(){return iu}get readDirsInDir(){return hw}get writeFile(){return mw}get rm(){return gS}get rename(){return Sw}get copy(){return vS}};function Ur(r){return Tg(r,0)}function Tg(r,t){switch(typeof r){case"object":return r===null?Jr(349,t):Array.isArray(r)?Pw(r,t):Tw(r,t);case"string":return xS(r,t);case"boolean":return ww(r,t);case"number":return Jr(r,t);case"undefined":return Jr(937,t);default:return Jr(617,t)}}function Jr(r,t){return(t<<5)-t+r|0}function ww(r,t){return Jr(r?433:863,t)}function xS(r,t){t=Jr(149417,t);for(let e=0,n=r.length;e<n;e++)t=Jr(r.charCodeAt(e),t);return t}function Pw(r,t){return t=Jr(104579,t),r.reduce((e,n)=>Tg(n,e),t)}function Tw(r,t){return t=Jr(181387,t),Object.keys(r).sort().reduce((e,n)=>(e=xS(n,e),Tg(r[n],e)),t)}function Pg(r,t,e=32){let n=e-t,i=~((1<<n)-1);return(r<<t|(i&r)>>>n)>>>0}function SS(r,t=0,e=r.byteLength,n=0){for(let i=0;i<e;i++)r[t+i]=n}function Rw(r,t,e="0"){for(;r.length<t;)r=e+r;return r}function $l(r,t=32){return r instanceof ArrayBuffer?Array.from(new Uint8Array(r)).map(e=>e.toString(16).padStart(2,"0")).join(""):Rw((r>>>0).toString(16),t/4)}var bS=class r{static _bigBlock32=new DataView(new ArrayBuffer(320));_h0=1732584193;_h1=4023233417;_h2=2562383102;_h3=271733878;_h4=3285377520;_buff;_buffDV;_buffLen;_totalLen;_leftoverHighSurrogate;_finished;constructor(){this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let e=t.length;if(e===0)return;let n=this._buff,i=this._buffLen,o=this._leftoverHighSurrogate,s,a;for(o!==0?(s=o,a=-1,o=0):(s=t.charCodeAt(0),a=0);;){let l=s;if(FI(s))if(a+1<e){let c=t.charCodeAt(a+1);ag(c)?(a++,l=AI(s,c)):l=65533}else{o=s;break}else ag(s)&&(l=65533);if(i=this._push(n,i,l),a++,a<e)s=t.charCodeAt(a);else break}this._buffLen=i,this._leftoverHighSurrogate=o}_push(t,e,n){return n<128?t[e++]=n:n<2048?(t[e++]=192|(n&1984)>>>6,t[e++]=128|(n&63)>>>0):n<65536?(t[e++]=224|(n&61440)>>>12,t[e++]=128|(n&4032)>>>6,t[e++]=128|(n&63)>>>0):(t[e++]=240|(n&1835008)>>>18,t[e++]=128|(n&258048)>>>12,t[e++]=128|(n&4032)>>>6,t[e++]=128|(n&63)>>>0),e>=64&&(this._step(),e-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),e}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),$l(this._h0)+$l(this._h1)+$l(this._h2)+$l(this._h3)+$l(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,SS(this._buff,this._buffLen),this._buffLen>56&&(this._step(),SS(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=r._bigBlock32,e=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,e.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,Pg(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let n=this._h0,i=this._h1,o=this._h2,s=this._h3,a=this._h4,l,c,d;for(let u=0;u<80;u++)u<20?(l=i&o|~i&s,c=1518500249):u<40?(l=i^o^s,c=1859775393):u<60?(l=i&o|i&s|o&s,c=2400959708):(l=i^o^s,c=3395469782),d=Pg(n,5)+l+a+c+t.getUint32(u*4,!1)&4294967295,a=s,s=o,o=Pg(i,30),i=n,n=d;this._h0=this._h0+n&4294967295,this._h1=this._h1+i&4294967295,this._h2=this._h2+o&4294967295,this._h3=this._h3+s&4294967295,this._h4=this._h4+a&4294967295}};function Rg(...r){switch(r.length){case 1:return g("contextkey.scanner.hint.didYouMean1","Did you mean {0}?",r[0]);case 2:return g("contextkey.scanner.hint.didYouMean2","Did you mean {0} or {1}?",r[0],r[1]);case 3:return g("contextkey.scanner.hint.didYouMean3","Did you mean {0}, {1} or {2}?",r[0],r[1],r[2]);default:return}}var Cw=g("contextkey.scanner.hint.didYouForgetToOpenOrCloseQuote","Did you forget to open or close the quote?"),Dw=g("contextkey.scanner.hint.didYouForgetToEscapeSlash","Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\/'."),Ci=class r{static getLexeme(t){switch(t.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return t.isTripleEq?"===":"==";case 4:return t.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return t.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return t.lexeme;case 18:return t.lexeme;case 19:return t.lexeme;case 20:return"EOF";default:throw ad(`unhandled token type: ${JSON.stringify(t)}; have you forgotten to add a case?`)}}static _regexFlags=new Set(["i","g","s","m","y","u"].map(t=>t.charCodeAt(0)));static _keywords=new Map([["not",14],["in",13],["false",12],["true",11]]);_input="";_start=0;_current=0;_tokens=[];_errors=[];get errors(){return this._errors}reset(t){return this._input=t,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){let e=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:e})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){let e=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:e})}else this._match(126)?this._addToken(9):this._error(Rg("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(Rg("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(Rg("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(t){return this._isAtEnd()||this._input.charCodeAt(this._current)!==t?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(t){this._tokens.push({type:t,offset:this._start})}_error(t){let e=this._start,n=this._input.substring(this._start,this._current),i={type:19,offset:this._start,lexeme:n};this._errors.push({offset:e,lexeme:n,additionalInfo:t}),this._tokens.push(i)}stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy;_string(){this.stringRe.lastIndex=this._start;let t=this.stringRe.exec(this._input);if(t){this._current=this._start+t[0].length;let e=this._input.substring(this._start,this._current),n=r._keywords.get(e);n?this._addToken(n):this._tokens.push({type:17,lexeme:e,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(Cw);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let t=this._current,e=!1,n=!1;for(;;){if(t>=this._input.length){this._current=t,this._error(Dw);return}let o=this._input.charCodeAt(t);if(e)e=!1;else if(o===47&&!n){t++;break}else o===91?n=!0:o===92?e=!0:o===93&&(n=!1);t++}for(;t<this._input.length&&r._regexFlags.has(this._input.charCodeAt(t));)t++;this._current=t;let i=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:i,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}};var Ce=class{ctor;staticArguments;supportsDelayedInstantiation;constructor(t,e=[],n=!1){this.ctor=t,this.staticArguments=e,this.supportsDelayedInstantiation=n}};var Di=class{_entries=new Map;constructor(...t){for(let[e,n]of t)this.set(e,n)}set(t,e){let n=this._entries.get(t);return this._entries.set(t,e),n}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}};var hr;(i=>{i.serviceIds=new Map,i.DI_TARGET="$di$target",i.DI_DEPENDENCIES="$di$dependencies";function n(o){return o[i.DI_DEPENDENCIES]||[]}i.getServiceDependencies=n})(hr||={});var Ot=M("instantiationService");function _w(r,t,e){t[hr.DI_TARGET]===t?t[hr.DI_DEPENDENCIES].push({id:r,index:e}):(t[hr.DI_DEPENDENCIES]=[{id:r,index:e}],t[hr.DI_TARGET]=t)}function M(r){if(hr.serviceIds.has(r))return hr.serviceIds.get(r);let t=function(e,n,i){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");_w(t,e,i)};return t.toString=()=>r,hr.serviceIds.set(r,t),t}var Nt=new Map;Nt.set("false",!1);Nt.set("true",!0);Nt.set("isMac",_t);Nt.set("isLinux",Oe);Nt.set("isWindows",be);Nt.set("isWeb",qe);Nt.set("isMacNative",_t&&!qe);Nt.set("isEdge",md);Nt.set("isFirefox",hd);Nt.set("isChrome",Pl);Nt.set("isSafari",gd);var kw=Object.prototype.hasOwnProperty;var Uw={regexParsingWithErrorRecovery:!0},Lw=g("contextkey.parser.error.emptyString","Empty context key expression"),Fw=g("contextkey.parser.error.emptyString.hint","Did you forget to write an expression? You can also put 'false' or 'true' to always evaluate to false or true, respectively."),Aw=g("contextkey.parser.error.noInAfterNot","'in' after 'not'."),ES=g("contextkey.parser.error.closingParenthesis","closing parenthesis ')'"),Ow=g("contextkey.parser.error.unexpectedToken","Unexpected token"),Mw=g("contextkey.parser.error.unexpectedToken.hint","Did you forget to put && or || before the token?"),Nw=g("contextkey.parser.error.unexpectedEOF","Unexpected end of expression"),Bw=g("contextkey.parser.error.unexpectedEOF.hint","Did you forget to put a context key?"),Cg=class r{constructor(t=Uw){this._config=t}static _parseError=new Error;_scanner=new Ci;_tokens=[];_current=0;_parsingErrors=[];get lexingErrors(){return this._scanner.errors}get parsingErrors(){return this._parsingErrors}parse(t){if(t===""){this._parsingErrors.push({message:Lw,offset:0,lexeme:"",additionalInfo:Fw});return}this._tokens=this._scanner.reset(t).scan(),this._current=0,this._parsingErrors=[];try{let e=this._expr();if(!this._isAtEnd()){let n=this._peek(),i=n.type===17?Mw:void 0;throw this._parsingErrors.push({message:Ow,offset:n.offset,lexeme:Ci.getLexeme(n),additionalInfo:i}),r._parseError}return e}catch(e){if(e!==r._parseError)throw e;return}}_expr(){return this._or()}_or(){let t=[this._and()];for(;this._matchOne(16);){let e=this._and();t.push(e)}return t.length===1?t[0]:Ut.or(...t)}_and(){let t=[this._term()];for(;this._matchOne(15);){let e=this._term();t.push(e)}return t.length===1?t[0]:Ut.and(...t)}_term(){if(this._matchOne(2)){let t=this._peek();switch(t.type){case 11:return this._advance(),Zt.INSTANCE;case 12:return this._advance(),sn.INSTANCE;case 0:{this._advance();let e=this._expr();return this._consume(1,ES),e?.negate()}case 17:return this._advance(),wo.create(t.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",t)}}return this._primary()}_primary(){let t=this._peek();switch(t.type){case 11:return this._advance(),Ut.true();case 12:return this._advance(),Ut.false();case 0:{this._advance();let e=this._expr();return this._consume(1,ES),e}case 17:{let e=t.lexeme;if(this._advance(),this._matchOne(9)){let i=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),i.type!==10)throw this._errExpectedButGot("REGEX",i);let o=i.lexeme,s=o.lastIndexOf("/"),a=s===o.length-1?void 0:this._removeFlagsGY(o.substring(s+1)),l;try{l=new RegExp(o.substring(1,s),a)}catch{throw this._errExpectedButGot("REGEX",i)}return Xl.create(e,l)}switch(i.type){case 10:case 19:{let o=[i.lexeme];this._advance();let s=this._peek(),a=0;for(let f=0;f<i.lexeme.length;f++)i.lexeme.charCodeAt(f)===40?a++:i.lexeme.charCodeAt(f)===41&&a--;for(;!this._isAtEnd()&&s.type!==15&&s.type!==16;){switch(s.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let f=0;f<s.lexeme.length;f++)s.lexeme.charCodeAt(f)===40?a++:i.lexeme.charCodeAt(f)===41&&a--}if(a<0)break;o.push(Ci.getLexeme(s)),this._advance(),s=this._peek()}let l=o.join(""),c=l.lastIndexOf("/"),d=c===l.length-1?void 0:this._removeFlagsGY(l.substring(c+1)),u;try{u=new RegExp(l.substring(1,c),d)}catch{throw this._errExpectedButGot("REGEX",i)}return Ut.regex(e,u)}case 18:{let o=i.lexeme;this._advance();let s=null;if(!UI(o)){let a=o.indexOf("/"),l=o.lastIndexOf("/");if(a!==l&&a>=0){let c=o.slice(a+1,l),d=o[l+1]==="i"?"i":"";try{s=new RegExp(c,d)}catch{throw this._errExpectedButGot("REGEX",i)}}}if(s===null)throw this._errExpectedButGot("REGEX",i);return Xl.create(e,s)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,Aw);let i=this._value();return Ut.notIn(e,i)}switch(this._peek().type){case 3:{this._advance();let i=this._value();if(this._previous().type===18)return Ut.equals(e,i);switch(i){case"true":return Ut.has(e);case"false":return Ut.not(e);default:return Ut.equals(e,i)}}case 4:{this._advance();let i=this._value();if(this._previous().type===18)return Ut.notEquals(e,i);switch(i){case"true":return Ut.not(e);case"false":return Ut.has(e);default:return Ut.notEquals(e,i)}}case 5:return this._advance(),Ql.create(e,this._value());case 6:return this._advance(),Jl.create(e,this._value());case 7:return this._advance(),jl.create(e,this._value());case 8:return this._advance(),Gl.create(e,this._value());case 13:return this._advance(),Ut.in(e,this._value());default:return Ut.has(e)}}case 20:throw this._parsingErrors.push({message:Nw,offset:t.offset,lexeme:"",additionalInfo:Bw}),r._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){let t=this._peek();switch(t.type){case 17:case 18:return this._advance(),t.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_flagsGYRe=/g|y/g;_removeFlagsGY(t){return t.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(t){return this._check(t)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(t,e){if(this._check(t))return this._advance();throw this._errExpectedButGot(e,this._peek())}_errExpectedButGot(t,e,n){let i=g("contextkey.parser.error.expectedButGot",`Expected: {0}
Received: '{1}'.`,t,Ci.getLexeme(e)),o=e.offset,s=Ci.getLexeme(e);return this._parsingErrors.push({message:i,offset:o,lexeme:s,additionalInfo:n}),r._parseError}_check(t){return this._peek().type===t}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}},Ut=class{static false(){return Zt.INSTANCE}static true(){return sn.INSTANCE}static has(t){return Eo.create(t)}static equals(t,e){return ql.create(t,e)}static notEquals(t,e){return Hl.create(t,e)}static regex(t,e){return Xl.create(t,e)}static in(t,e){return ou.create(t,e)}static notIn(t,e){return su.create(t,e)}static not(t){return wo.create(t)}static and(...t){return au.create(t,null,!0)}static or(...t){return Yl.create(t,null,!0)}static greater(t,e){return jl.create(t,e)}static greaterEquals(t,e){return Gl.create(t,e)}static smaller(t,e){return Ql.create(t,e)}static smallerEquals(t,e){return Jl.create(t,e)}static _parser=new Cg({regexParsingWithErrorRecovery:!1});static deserialize(t){return t==null?void 0:this._parser.parse(t)}};function zl(r,t){return r.cmp(t)}var Zt=class r{static INSTANCE=new r;type=0;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!1}serialize(){return"false"}keys(){return[]}map(t){return this}negate(){return sn.INSTANCE}},sn=class r{static INSTANCE=new r;type=1;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!0}serialize(){return"true"}keys(){return[]}map(t){return this}negate(){return Zt.INSTANCE}},Eo=class r{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let n=Nt.get(t);return typeof n=="boolean"?n?sn.INSTANCE:Zt.INSTANCE:new r(t,e)}type=2;cmp(t){return t.type!==this.type?this.type-t.type:RS(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=Nt.get(this.key);return typeof t=="boolean"?t?sn.INSTANCE:Zt.INSTANCE:this}evaluate(t){return!!t.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(t){return t.mapDefined(this.key)}negate(){return this.negated||(this.negated=wo.create(this.key,this)),this.negated}},ql=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){if(typeof e=="boolean")return e?Eo.create(t,n):wo.create(t,n);let i=Nt.get(t);return typeof i=="boolean"?e===(i?"true":"false")?sn.INSTANCE:Zt.INSTANCE:new r(t,e,n)}type=4;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=Nt.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?sn.INSTANCE:Zt.INSTANCE}return this}evaluate(t){return t.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}map(t){return t.mapEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Hl.create(this.key,this.value,this)),this.negated}},ou=class r{constructor(t,e){this.key=t;this.valueKey=e}static create(t,e){return new r(t,e)}type=10;negated=null;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.valueKey,t.key,t.valueKey)}equals(t){return t.type===this.type?this.key===t.key&&this.valueKey===t.valueKey:!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.valueKey),n=t.getValue(this.key);return Array.isArray(e)?e.includes(n):typeof n=="string"&&typeof e=="object"&&e!==null?kw.call(e,n):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}map(t){return t.mapIn(this.key,this.valueKey)}negate(){return this.negated||(this.negated=su.create(this.key,this.valueKey)),this.negated}},su=class r{constructor(t,e){this.key=t;this.valueKey=e;this._negated=ou.create(t,e)}static create(t,e){return new r(t,e)}type=11;_negated;cmp(t){return t.type!==this.type?this.type-t.type:this._negated.cmp(t._negated)}equals(t){return t.type===this.type?this._negated.equals(t._negated):!1}substituteConstants(){return this}evaluate(t){return!this._negated.evaluate(t)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}map(t){return t.mapNotIn(this.key,this.valueKey)}negate(){return this._negated}},Hl=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){if(typeof e=="boolean")return e?wo.create(t,n):Eo.create(t,n);let i=Nt.get(t);return typeof i=="boolean"?e===(i?"true":"false")?Zt.INSTANCE:sn.INSTANCE:new r(t,e,n)}type=5;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=Nt.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?Zt.INSTANCE:sn.INSTANCE}return this}evaluate(t){return t.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}map(t){return t.mapNotEquals(this.key,this.value)}negate(){return this.negated||(this.negated=ql.create(this.key,this.value,this)),this.negated}},wo=class r{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let n=Nt.get(t);return typeof n=="boolean"?n?Zt.INSTANCE:sn.INSTANCE:new r(t,e)}type=3;cmp(t){return t.type!==this.type?this.type-t.type:RS(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=Nt.get(this.key);return typeof t=="boolean"?t?Zt.INSTANCE:sn.INSTANCE:this}evaluate(t){return!t.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}map(t){return t.mapNot(this.key)}negate(){return this.negated||(this.negated=Eo.create(this.key,this)),this.negated}};function cu(r,t){if(typeof r=="string"){let e=parseFloat(r);isNaN(e)||(r=e)}return typeof r=="string"||typeof r=="number"?t(r):Zt.INSTANCE}var jl=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){return cu(e,i=>new r(t,i,n))}type=12;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreater(this.key,this.value)}negate(){return this.negated||(this.negated=Jl.create(this.key,this.value,this)),this.negated}},Gl=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){return cu(e,i=>new r(t,i,n))}type=13;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreaterEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Ql.create(this.key,this.value,this)),this.negated}},Ql=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){return cu(e,i=>new r(t,i,n))}type=14;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmaller(this.key,this.value)}negate(){return this.negated||(this.negated=Gl.create(this.key,this.value,this)),this.negated}},Jl=class r{constructor(t,e,n){this.key=t;this.value=e;this.negated=n}static create(t,e,n=null){return cu(e,i=>new r(t,i,n))}type=15;cmp(t){return t.type!==this.type?this.type-t.type:Po(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmallerEquals(this.key,this.value)}negate(){return this.negated||(this.negated=jl.create(this.key,this.value,this)),this.negated}},Xl=class r{constructor(t,e){this.key=t;this.regexp=e}static create(t,e){return new r(t,e)}type=7;negated=null;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.key<t.key)return-1;if(this.key>t.key)return 1;let e=this.regexp?this.regexp.source:"",n=t.regexp?t.regexp.source:"";return e<n?-1:e>n?1:0}equals(t){if(t.type===this.type){let e=this.regexp?this.regexp.source:"",n=t.regexp?t.regexp.source:"";return this.key===t.key&&e===n}return!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.key);return this.regexp?this.regexp.test(e):!1}serialize(){let t=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${t}`}keys(){return[this.key]}map(t){return t.mapRegex(this.key,this.regexp)}negate(){return this.negated||(this.negated=Dg.create(this)),this.negated}},Dg=class r{constructor(t){this._actual=t}static create(t){return new r(t)}type=8;cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}map(t){return new r(this._actual.map(t))}negate(){return this._actual}};function TS(r){let t=null;for(let e=0,n=r.length;e<n;e++){let i=r[e].substituteConstants();if(r[e]!==i&&t===null){t=[];for(let o=0;o<e;o++)t[o]=r[o]}t!==null&&(t[e]=i)}return t===null?r:t}var au=class r{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,n){return r._normalizeArr(t,e,n)}type=6;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,n=this.expr.length;e<n;e++){let i=zl(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,n=this.expr.length;e<n;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=TS(this.expr);return t===this.expr?this:r.create(t,this.negated,!1)}evaluate(t){for(let e=0,n=this.expr.length;e<n;e++)if(!this.expr[e].evaluate(t))return!1;return!0}static _normalizeArr(t,e,n){let i=[],o=!1;for(let s of t)if(s){if(s.type===1){o=!0;continue}if(s.type===0)return Zt.INSTANCE;if(s.type===6){i.push(...s.expr);continue}i.push(s)}if(i.length===0&&o)return sn.INSTANCE;if(i.length!==0){if(i.length===1)return i[0];i.sort(zl);for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];for(;i.length>1;){let s=i[i.length-1];if(s.type!==9)break;i.pop();let a=i.pop(),l=i.length===0,c=Yl.create(s.expr.map(d=>r.create([d,a],null,n)),null,l);c&&(i.push(c),i.sort(zl))}if(i.length===1)return i[0];if(n){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return Zt.INSTANCE;if(i.length===1)return i[0]}return new r(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" && ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new r(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());this.negated=Yl.create(t,this,!0)}return this.negated}},Yl=class r{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,n){return r._normalizeArr(t,e,n)}type=9;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,n=this.expr.length;e<n;e++){let i=zl(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,n=this.expr.length;e<n;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=TS(this.expr);return t===this.expr?this:r.create(t,this.negated,!1)}evaluate(t){for(let e=0,n=this.expr.length;e<n;e++)if(this.expr[e].evaluate(t))return!0;return!1}static _normalizeArr(t,e,n){let i=[],o=!1;if(t){for(let s=0,a=t.length;s<a;s++){let l=t[s];if(l){if(l.type===0){o=!0;continue}if(l.type===1)return sn.INSTANCE;if(l.type===9){i=i.concat(l.expr);continue}i.push(l)}}if(i.length===0&&o)return Zt.INSTANCE;i.sort(zl)}if(i.length!==0){if(i.length===1)return i[0];for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];if(n){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return sn.INSTANCE;if(i.length===1)return i[0]}return new r(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" || ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new r(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());for(;t.length>1;){let e=t.shift(),n=t.shift(),i=[];for(let o of wS(e))for(let s of wS(n))i.push(au.create([o,s],null,!1));t.unshift(r.create(i,null,!1))}this.negated=r.create(t,this,!0)}return this.negated}},lu=class r extends Eo{static _info=[];static all(){return r._info.values()}_defaultValue;constructor(t,e,n){super(t,null),this._defaultValue=e,typeof n=="object"?r._info.push({...n,key:t}):n!==!0&&r._info.push({key:t,description:n,type:e!=null?typeof e:void 0})}bindTo(t){return t.createKey(this.key,this._defaultValue)}getValue(t){return t.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(t){return ql.create(this.key,t)}notEqualsTo(t){return Hl.create(this.key,t)}},mF=M("contextKeyService");function RS(r,t){return r<t?-1:r>t?1:0}function Po(r,t,e,n){return r<e?-1:r>e?1:t<n?-1:t>n?1:0}function wS(r){return r.type===9?r.expr:[r]}var _g=Object.create(null);function p(r,t){if(De(t)){let e=_g[t];if(e===void 0)throw new Error(`${r} references an unknown codicon: ${t}`);t=e}return _g[r]=t,{id:r}}function CS(){return _g}var DS={add:p("add",6e4),plus:p("plus",6e4),gistNew:p("gist-new",6e4),repoCreate:p("repo-create",6e4),lightbulb:p("lightbulb",60001),lightBulb:p("light-bulb",60001),repo:p("repo",60002),repoDelete:p("repo-delete",60002),gistFork:p("gist-fork",60003),repoForked:p("repo-forked",60003),gitPullRequest:p("git-pull-request",60004),gitPullRequestAbandoned:p("git-pull-request-abandoned",60004),recordKeys:p("record-keys",60005),keyboard:p("keyboard",60005),tag:p("tag",60006),gitPullRequestLabel:p("git-pull-request-label",60006),tagAdd:p("tag-add",60006),tagRemove:p("tag-remove",60006),person:p("person",60007),personFollow:p("person-follow",60007),personOutline:p("person-outline",60007),personFilled:p("person-filled",60007),gitBranch:p("git-branch",60008),gitBranchCreate:p("git-branch-create",60008),gitBranchDelete:p("git-branch-delete",60008),sourceControl:p("source-control",60008),mirror:p("mirror",60009),mirrorPublic:p("mirror-public",60009),star:p("star",60010),starAdd:p("star-add",60010),starDelete:p("star-delete",60010),starEmpty:p("star-empty",60010),comment:p("comment",60011),commentAdd:p("comment-add",60011),alert:p("alert",60012),warning:p("warning",60012),search:p("search",60013),searchSave:p("search-save",60013),logOut:p("log-out",60014),signOut:p("sign-out",60014),logIn:p("log-in",60015),signIn:p("sign-in",60015),eye:p("eye",60016),eyeUnwatch:p("eye-unwatch",60016),eyeWatch:p("eye-watch",60016),circleFilled:p("circle-filled",60017),primitiveDot:p("primitive-dot",60017),closeDirty:p("close-dirty",60017),debugBreakpoint:p("debug-breakpoint",60017),debugBreakpointDisabled:p("debug-breakpoint-disabled",60017),debugHint:p("debug-hint",60017),terminalDecorationSuccess:p("terminal-decoration-success",60017),primitiveSquare:p("primitive-square",60018),edit:p("edit",60019),pencil:p("pencil",60019),info:p("info",60020),issueOpened:p("issue-opened",60020),gistPrivate:p("gist-private",60021),gitForkPrivate:p("git-fork-private",60021),lock:p("lock",60021),mirrorPrivate:p("mirror-private",60021),close:p("close",60022),removeClose:p("remove-close",60022),x:p("x",60022),repoSync:p("repo-sync",60023),sync:p("sync",60023),clone:p("clone",60024),desktopDownload:p("desktop-download",60024),beaker:p("beaker",60025),microscope:p("microscope",60025),vm:p("vm",60026),deviceDesktop:p("device-desktop",60026),file:p("file",60027),fileText:p("file-text",60027),more:p("more",60028),ellipsis:p("ellipsis",60028),kebabHorizontal:p("kebab-horizontal",60028),mailReply:p("mail-reply",60029),reply:p("reply",60029),organization:p("organization",60030),organizationFilled:p("organization-filled",60030),organizationOutline:p("organization-outline",60030),newFile:p("new-file",60031),fileAdd:p("file-add",60031),newFolder:p("new-folder",60032),fileDirectoryCreate:p("file-directory-create",60032),trash:p("trash",60033),trashcan:p("trashcan",60033),history:p("history",60034),clock:p("clock",60034),folder:p("folder",60035),fileDirectory:p("file-directory",60035),symbolFolder:p("symbol-folder",60035),logoGithub:p("logo-github",60036),markGithub:p("mark-github",60036),github:p("github",60036),terminal:p("terminal",60037),console:p("console",60037),repl:p("repl",60037),zap:p("zap",60038),symbolEvent:p("symbol-event",60038),error:p("error",60039),stop:p("stop",60039),variable:p("variable",60040),symbolVariable:p("symbol-variable",60040),array:p("array",60042),symbolArray:p("symbol-array",60042),symbolModule:p("symbol-module",60043),symbolPackage:p("symbol-package",60043),symbolNamespace:p("symbol-namespace",60043),symbolObject:p("symbol-object",60043),symbolMethod:p("symbol-method",60044),symbolFunction:p("symbol-function",60044),symbolConstructor:p("symbol-constructor",60044),symbolBoolean:p("symbol-boolean",60047),symbolNull:p("symbol-null",60047),symbolNumeric:p("symbol-numeric",60048),symbolNumber:p("symbol-number",60048),symbolStructure:p("symbol-structure",60049),symbolStruct:p("symbol-struct",60049),symbolParameter:p("symbol-parameter",60050),symbolTypeParameter:p("symbol-type-parameter",60050),symbolKey:p("symbol-key",60051),symbolText:p("symbol-text",60051),symbolReference:p("symbol-reference",60052),goToFile:p("go-to-file",60052),symbolEnum:p("symbol-enum",60053),symbolValue:p("symbol-value",60053),symbolRuler:p("symbol-ruler",60054),symbolUnit:p("symbol-unit",60054),activateBreakpoints:p("activate-breakpoints",60055),archive:p("archive",60056),arrowBoth:p("arrow-both",60057),arrowDown:p("arrow-down",60058),arrowLeft:p("arrow-left",60059),arrowRight:p("arrow-right",60060),arrowSmallDown:p("arrow-small-down",60061),arrowSmallLeft:p("arrow-small-left",60062),arrowSmallRight:p("arrow-small-right",60063),arrowSmallUp:p("arrow-small-up",60064),arrowUp:p("arrow-up",60065),bell:p("bell",60066),bold:p("bold",60067),book:p("book",60068),bookmark:p("bookmark",60069),debugBreakpointConditionalUnverified:p("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:p("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:p("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:p("debug-breakpoint-data-unverified",60072),debugBreakpointData:p("debug-breakpoint-data",60073),debugBreakpointDataDisabled:p("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:p("debug-breakpoint-log-unverified",60074),debugBreakpointLog:p("debug-breakpoint-log",60075),debugBreakpointLogDisabled:p("debug-breakpoint-log-disabled",60075),briefcase:p("briefcase",60076),broadcast:p("broadcast",60077),browser:p("browser",60078),bug:p("bug",60079),calendar:p("calendar",60080),caseSensitive:p("case-sensitive",60081),check:p("check",60082),checklist:p("checklist",60083),chevronDown:p("chevron-down",60084),chevronLeft:p("chevron-left",60085),chevronRight:p("chevron-right",60086),chevronUp:p("chevron-up",60087),chromeClose:p("chrome-close",60088),chromeMaximize:p("chrome-maximize",60089),chromeMinimize:p("chrome-minimize",60090),chromeRestore:p("chrome-restore",60091),circleOutline:p("circle-outline",60092),circle:p("circle",60092),debugBreakpointUnverified:p("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:p("terminal-decoration-incomplete",60092),circleSlash:p("circle-slash",60093),circuitBoard:p("circuit-board",60094),clearAll:p("clear-all",60095),clippy:p("clippy",60096),closeAll:p("close-all",60097),cloudDownload:p("cloud-download",60098),cloudUpload:p("cloud-upload",60099),code:p("code",60100),collapseAll:p("collapse-all",60101),colorMode:p("color-mode",60102),commentDiscussion:p("comment-discussion",60103),creditCard:p("credit-card",60105),dash:p("dash",60108),dashboard:p("dashboard",60109),database:p("database",60110),debugContinue:p("debug-continue",60111),debugDisconnect:p("debug-disconnect",60112),debugPause:p("debug-pause",60113),debugRestart:p("debug-restart",60114),debugStart:p("debug-start",60115),debugStepInto:p("debug-step-into",60116),debugStepOut:p("debug-step-out",60117),debugStepOver:p("debug-step-over",60118),debugStop:p("debug-stop",60119),debug:p("debug",60120),deviceCameraVideo:p("device-camera-video",60121),deviceCamera:p("device-camera",60122),deviceMobile:p("device-mobile",60123),diffAdded:p("diff-added",60124),diffIgnored:p("diff-ignored",60125),diffModified:p("diff-modified",60126),diffRemoved:p("diff-removed",60127),diffRenamed:p("diff-renamed",60128),diff:p("diff",60129),diffSidebyside:p("diff-sidebyside",60129),discard:p("discard",60130),editorLayout:p("editor-layout",60131),emptyWindow:p("empty-window",60132),exclude:p("exclude",60133),extensions:p("extensions",60134),eyeClosed:p("eye-closed",60135),fileBinary:p("file-binary",60136),fileCode:p("file-code",60137),fileMedia:p("file-media",60138),filePdf:p("file-pdf",60139),fileSubmodule:p("file-submodule",60140),fileSymlinkDirectory:p("file-symlink-directory",60141),fileSymlinkFile:p("file-symlink-file",60142),fileZip:p("file-zip",60143),files:p("files",60144),filter:p("filter",60145),flame:p("flame",60146),foldDown:p("fold-down",60147),foldUp:p("fold-up",60148),fold:p("fold",60149),folderActive:p("folder-active",60150),folderOpened:p("folder-opened",60151),gear:p("gear",60152),gift:p("gift",60153),gistSecret:p("gist-secret",60154),gist:p("gist",60155),gitCommit:p("git-commit",60156),gitCompare:p("git-compare",60157),compareChanges:p("compare-changes",60157),gitMerge:p("git-merge",60158),githubAction:p("github-action",60159),githubAlt:p("github-alt",60160),globe:p("globe",60161),grabber:p("grabber",60162),graph:p("graph",60163),gripper:p("gripper",60164),heart:p("heart",60165),home:p("home",60166),horizontalRule:p("horizontal-rule",60167),hubot:p("hubot",60168),inbox:p("inbox",60169),issueReopened:p("issue-reopened",60171),issues:p("issues",60172),italic:p("italic",60173),jersey:p("jersey",60174),json:p("json",60175),kebabVertical:p("kebab-vertical",60176),key:p("key",60177),law:p("law",60178),lightbulbAutofix:p("lightbulb-autofix",60179),linkExternal:p("link-external",60180),link:p("link",60181),listOrdered:p("list-ordered",60182),listUnordered:p("list-unordered",60183),liveShare:p("live-share",60184),loading:p("loading",60185),location:p("location",60186),mailRead:p("mail-read",60187),mail:p("mail",60188),markdown:p("markdown",60189),megaphone:p("megaphone",60190),mention:p("mention",60191),milestone:p("milestone",60192),gitPullRequestMilestone:p("git-pull-request-milestone",60192),mortarBoard:p("mortar-board",60193),move:p("move",60194),multipleWindows:p("multiple-windows",60195),mute:p("mute",60196),noNewline:p("no-newline",60197),note:p("note",60198),octoface:p("octoface",60199),openPreview:p("open-preview",60200),package:p("package",60201),paintcan:p("paintcan",60202),pin:p("pin",60203),play:p("play",60204),run:p("run",60204),plug:p("plug",60205),preserveCase:p("preserve-case",60206),preview:p("preview",60207),project:p("project",60208),pulse:p("pulse",60209),question:p("question",60210),quote:p("quote",60211),radioTower:p("radio-tower",60212),reactions:p("reactions",60213),references:p("references",60214),refresh:p("refresh",60215),regex:p("regex",60216),remoteExplorer:p("remote-explorer",60217),remote:p("remote",60218),remove:p("remove",60219),replaceAll:p("replace-all",60220),replace:p("replace",60221),repoClone:p("repo-clone",60222),repoForcePush:p("repo-force-push",60223),repoPull:p("repo-pull",60224),repoPush:p("repo-push",60225),report:p("report",60226),requestChanges:p("request-changes",60227),rocket:p("rocket",60228),rootFolderOpened:p("root-folder-opened",60229),rootFolder:p("root-folder",60230),rss:p("rss",60231),ruby:p("ruby",60232),saveAll:p("save-all",60233),saveAs:p("save-as",60234),save:p("save",60235),screenFull:p("screen-full",60236),screenNormal:p("screen-normal",60237),searchStop:p("search-stop",60238),server:p("server",60240),settingsGear:p("settings-gear",60241),settings:p("settings",60242),shield:p("shield",60243),smiley:p("smiley",60244),sortPrecedence:p("sort-precedence",60245),splitHorizontal:p("split-horizontal",60246),splitVertical:p("split-vertical",60247),squirrel:p("squirrel",60248),starFull:p("star-full",60249),starHalf:p("star-half",60250),symbolClass:p("symbol-class",60251),symbolColor:p("symbol-color",60252),symbolConstant:p("symbol-constant",60253),symbolEnumMember:p("symbol-enum-member",60254),symbolField:p("symbol-field",60255),symbolFile:p("symbol-file",60256),symbolInterface:p("symbol-interface",60257),symbolKeyword:p("symbol-keyword",60258),symbolMisc:p("symbol-misc",60259),symbolOperator:p("symbol-operator",60260),symbolProperty:p("symbol-property",60261),wrench:p("wrench",60261),wrenchSubaction:p("wrench-subaction",60261),symbolSnippet:p("symbol-snippet",60262),tasklist:p("tasklist",60263),telescope:p("telescope",60264),textSize:p("text-size",60265),threeBars:p("three-bars",60266),thumbsdown:p("thumbsdown",60267),thumbsup:p("thumbsup",60268),tools:p("tools",60269),triangleDown:p("triangle-down",60270),triangleLeft:p("triangle-left",60271),triangleRight:p("triangle-right",60272),triangleUp:p("triangle-up",60273),twitter:p("twitter",60274),unfold:p("unfold",60275),unlock:p("unlock",60276),unmute:p("unmute",60277),unverified:p("unverified",60278),verified:p("verified",60279),versions:p("versions",60280),vmActive:p("vm-active",60281),vmOutline:p("vm-outline",60282),vmRunning:p("vm-running",60283),watch:p("watch",60284),whitespace:p("whitespace",60285),wholeWord:p("whole-word",60286),window:p("window",60287),wordWrap:p("word-wrap",60288),zoomIn:p("zoom-in",60289),zoomOut:p("zoom-out",60290),listFilter:p("list-filter",60291),listFlat:p("list-flat",60292),listSelection:p("list-selection",60293),selection:p("selection",60293),listTree:p("list-tree",60294),debugBreakpointFunctionUnverified:p("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:p("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:p("debug-breakpoint-function-disabled",60296),debugStackframeActive:p("debug-stackframe-active",60297),circleSmallFilled:p("circle-small-filled",60298),debugStackframeDot:p("debug-stackframe-dot",60298),terminalDecorationMark:p("terminal-decoration-mark",60298),debugStackframe:p("debug-stackframe",60299),debugStackframeFocused:p("debug-stackframe-focused",60299),debugBreakpointUnsupported:p("debug-breakpoint-unsupported",60300),symbolString:p("symbol-string",60301),debugReverseContinue:p("debug-reverse-continue",60302),debugStepBack:p("debug-step-back",60303),debugRestartFrame:p("debug-restart-frame",60304),debugAlt:p("debug-alt",60305),callIncoming:p("call-incoming",60306),callOutgoing:p("call-outgoing",60307),menu:p("menu",60308),expandAll:p("expand-all",60309),feedback:p("feedback",60310),gitPullRequestReviewer:p("git-pull-request-reviewer",60310),groupByRefType:p("group-by-ref-type",60311),ungroupByRefType:p("ungroup-by-ref-type",60312),account:p("account",60313),gitPullRequestAssignee:p("git-pull-request-assignee",60313),bellDot:p("bell-dot",60314),debugConsole:p("debug-console",60315),library:p("library",60316),output:p("output",60317),runAll:p("run-all",60318),syncIgnored:p("sync-ignored",60319),pinned:p("pinned",60320),githubInverted:p("github-inverted",60321),serverProcess:p("server-process",60322),serverEnvironment:p("server-environment",60323),pass:p("pass",60324),issueClosed:p("issue-closed",60324),stopCircle:p("stop-circle",60325),playCircle:p("play-circle",60326),record:p("record",60327),debugAltSmall:p("debug-alt-small",60328),vmConnect:p("vm-connect",60329),cloud:p("cloud",60330),merge:p("merge",60331),export:p("export",60332),graphLeft:p("graph-left",60333),magnet:p("magnet",60334),notebook:p("notebook",60335),redo:p("redo",60336),checkAll:p("check-all",60337),pinnedDirty:p("pinned-dirty",60338),passFilled:p("pass-filled",60339),circleLargeFilled:p("circle-large-filled",60340),circleLarge:p("circle-large",60341),circleLargeOutline:p("circle-large-outline",60341),combine:p("combine",60342),gather:p("gather",60342),table:p("table",60343),variableGroup:p("variable-group",60344),typeHierarchy:p("type-hierarchy",60345),typeHierarchySub:p("type-hierarchy-sub",60346),typeHierarchySuper:p("type-hierarchy-super",60347),gitPullRequestCreate:p("git-pull-request-create",60348),runAbove:p("run-above",60349),runBelow:p("run-below",60350),notebookTemplate:p("notebook-template",60351),debugRerun:p("debug-rerun",60352),workspaceTrusted:p("workspace-trusted",60353),workspaceUntrusted:p("workspace-untrusted",60354),workspaceUnknown:p("workspace-unknown",60355),terminalCmd:p("terminal-cmd",60356),terminalDebian:p("terminal-debian",60357),terminalLinux:p("terminal-linux",60358),terminalPowershell:p("terminal-powershell",60359),terminalTmux:p("terminal-tmux",60360),terminalUbuntu:p("terminal-ubuntu",60361),terminalBash:p("terminal-bash",60362),arrowSwap:p("arrow-swap",60363),copy:p("copy",60364),personAdd:p("person-add",60365),filterFilled:p("filter-filled",60366),wand:p("wand",60367),debugLineByLine:p("debug-line-by-line",60368),inspect:p("inspect",60369),layers:p("layers",60370),layersDot:p("layers-dot",60371),layersActive:p("layers-active",60372),compass:p("compass",60373),compassDot:p("compass-dot",60374),compassActive:p("compass-active",60375),azure:p("azure",60376),issueDraft:p("issue-draft",60377),gitPullRequestClosed:p("git-pull-request-closed",60378),gitPullRequestDraft:p("git-pull-request-draft",60379),debugAll:p("debug-all",60380),debugCoverage:p("debug-coverage",60381),runErrors:p("run-errors",60382),folderLibrary:p("folder-library",60383),debugContinueSmall:p("debug-continue-small",60384),beakerStop:p("beaker-stop",60385),graphLine:p("graph-line",60386),graphScatter:p("graph-scatter",60387),pieChart:p("pie-chart",60388),bracket:p("bracket",60175),bracketDot:p("bracket-dot",60389),bracketError:p("bracket-error",60390),lockSmall:p("lock-small",60391),azureDevops:p("azure-devops",60392),verifiedFilled:p("verified-filled",60393),newline:p("newline",60394),layout:p("layout",60395),layoutActivitybarLeft:p("layout-activitybar-left",60396),layoutActivitybarRight:p("layout-activitybar-right",60397),layoutPanelLeft:p("layout-panel-left",60398),layoutPanelCenter:p("layout-panel-center",60399),layoutPanelJustify:p("layout-panel-justify",60400),layoutPanelRight:p("layout-panel-right",60401),layoutPanel:p("layout-panel",60402),layoutSidebarLeft:p("layout-sidebar-left",60403),layoutSidebarRight:p("layout-sidebar-right",60404),layoutStatusbar:p("layout-statusbar",60405),layoutMenubar:p("layout-menubar",60406),layoutCentered:p("layout-centered",60407),target:p("target",60408),indent:p("indent",60409),recordSmall:p("record-small",60410),errorSmall:p("error-small",60411),terminalDecorationError:p("terminal-decoration-error",60411),arrowCircleDown:p("arrow-circle-down",60412),arrowCircleLeft:p("arrow-circle-left",60413),arrowCircleRight:p("arrow-circle-right",60414),arrowCircleUp:p("arrow-circle-up",60415),layoutSidebarRightOff:p("layout-sidebar-right-off",60416),layoutPanelOff:p("layout-panel-off",60417),layoutSidebarLeftOff:p("layout-sidebar-left-off",60418),blank:p("blank",60419),heartFilled:p("heart-filled",60420),map:p("map",60421),mapHorizontal:p("map-horizontal",60421),foldHorizontal:p("fold-horizontal",60421),mapFilled:p("map-filled",60422),mapHorizontalFilled:p("map-horizontal-filled",60422),foldHorizontalFilled:p("fold-horizontal-filled",60422),circleSmall:p("circle-small",60423),bellSlash:p("bell-slash",60424),bellSlashDot:p("bell-slash-dot",60425),commentUnresolved:p("comment-unresolved",60426),gitPullRequestGoToChanges:p("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:p("git-pull-request-new-changes",60428),searchFuzzy:p("search-fuzzy",60429),commentDraft:p("comment-draft",60430),send:p("send",60431),sparkle:p("sparkle",60432),insert:p("insert",60433),mic:p("mic",60434),thumbsdownFilled:p("thumbsdown-filled",60435),thumbsupFilled:p("thumbsup-filled",60436),coffee:p("coffee",60437),snake:p("snake",60438),game:p("game",60439),vr:p("vr",60440),chip:p("chip",60441),piano:p("piano",60442),music:p("music",60443),micFilled:p("mic-filled",60444),repoFetch:p("repo-fetch",60445),copilot:p("copilot",60446),lightbulbSparkle:p("lightbulb-sparkle",60447),robot:p("robot",60448),sparkleFilled:p("sparkle-filled",60449),diffSingle:p("diff-single",60450),diffMultiple:p("diff-multiple",60451),surroundWith:p("surround-with",60452),share:p("share",60453),gitStash:p("git-stash",60454),gitStashApply:p("git-stash-apply",60455),gitStashPop:p("git-stash-pop",60456),vscode:p("vscode",60457),vscodeInsiders:p("vscode-insiders",60458),codeOss:p("code-oss",60459),runCoverage:p("run-coverage",60460),runAllCoverage:p("run-all-coverage",60461),coverage:p("coverage",60462),githubProject:p("github-project",60463),mapVertical:p("map-vertical",60464),foldVertical:p("fold-vertical",60464),mapVerticalFilled:p("map-vertical-filled",60465),foldVerticalFilled:p("fold-vertical-filled",60465),goToSearch:p("go-to-search",60466),percentage:p("percentage",60467),sortPercentage:p("sort-percentage",60467),attach:p("attach",60468)};var Ww={dialogError:p("dialog-error","error"),dialogWarning:p("dialog-warning","warning"),dialogInfo:p("dialog-info","info"),dialogClose:p("dialog-close","close"),treeItemExpanded:p("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:p("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:p("tree-filter-on-type-off","list-selection"),treeFilterClear:p("tree-filter-clear","close"),treeItemLoading:p("tree-item-loading","loading"),menuSelection:p("menu-selection","check"),menuSubmenu:p("menu-submenu","chevron-right"),menuBarMore:p("menubar-more","more"),scrollbarButtonLeft:p("scrollbar-button-left","triangle-left"),scrollbarButtonRight:p("scrollbar-button-right","triangle-right"),scrollbarButtonUp:p("scrollbar-button-up","triangle-up"),scrollbarButtonDown:p("scrollbar-button-down","triangle-down"),toolBarMore:p("toolbar-more","more"),quickInputBack:p("quick-input-back","arrow-left"),dropDownButton:p("drop-down-button",60084),symbolCustomColor:p("symbol-customcolor",60252),exportIcon:p("export",60332),workspaceUnspecified:p("workspace-unspecified",60355),newLine:p("newline",60394),thumbsDownFilled:p("thumbsdown-filled",60435),thumbsUpFilled:p("thumbsup-filled",60436),gitFetch:p("git-fetch",60445),lightbulbSparkleAutofix:p("lightbulb-sparkle-autofix",60447),debugBreakpointPending:p("debug-breakpoint-pending",60377)},gr={...DS,...Ww};var _S;(t=>{function r(e){return e&&typeof e=="object"&&typeof e.id=="string"}t.isThemeColor=r})(_S||={});var Fn;(y=>{y.iconNameSegment="[A-Za-z0-9]+",y.iconNameExpression="[A-Za-z0-9-]+",y.iconModifierExpression="~[A-Za-z]+",y.iconNameCharacter="[A-Za-z0-9~-]";let i=new RegExp(`^(${y.iconNameExpression})(${y.iconModifierExpression})?$`);function o(I){let x=i.exec(I.id);if(!x)return o(gr.error);let[,T,R]=x,w=["codicon","codicon-"+T];return R&&w.push("codicon-modifier-"+R.substring(1)),w}y.asClassNameArray=o;function s(I){return o(I).join(" ")}y.asClassName=s;function a(I){return"."+o(I).join(".")}y.asCSSSelector=a;function l(I){return I&&typeof I=="object"&&typeof I.id=="string"&&(typeof I.color>"u"||_S.isThemeColor(I.color))}y.isThemeIcon=l;let c=new RegExp(`^\\$\\((${y.iconNameExpression}(?:${y.iconModifierExpression})?)\\)$`);function d(I){let x=c.exec(I);if(!x)return;let[,T]=x;return{id:T}}y.fromString=d;function u(I){return{id:I}}y.fromId=u;function f(I,x){let T=I.id,R=T.lastIndexOf("~");return R!==-1&&(T=T.substring(0,R)),x&&(T=`${T}~${x}`),{id:T}}y.modify=f;function h(I){let x=I.id.lastIndexOf("~");if(x!==-1)return I.id.substring(x+1)}y.getModifier=h;function v(I,x){return I.id===x.id&&I.color?.id===x.color?.id}y.isEqual=v})(Fn||={});var UF=Object.freeze({View:wr("view","View"),Help:wr("help","Help"),Test:wr("test","Test"),File:wr("file","File"),Preferences:wr("preferences","Preferences"),Developer:wr({key:"developer",comment:["A developer on Code itself or someone diagnosing issues in Code"]},"Developer")});function kS(r){let t=!1,e=new Map,n=new Map;if(Vw(r,d=>{if(r===d)return!0;let u=JSON.stringify(d);if(u.length<30)return!0;let f=e.get(u);if(!f){let h={schemas:[d]};return e.set(u,h),n.set(d,h),!0}return f.schemas.push(d),n.set(d,f),t=!0,!1}),e.clear(),!t)return JSON.stringify(r);let o="$defs";for(;r.hasOwnProperty(o);)o+="_";let s=[];function a(d){return JSON.stringify(d,(u,f)=>{if(f!==d){let h=n.get(f);if(h&&h.schemas.length>1)return h.id||(h.id=`_${s.length}`,s.push(h.schemas[0])),{$ref:`#/${o}/${h.id}`}}return f})}let l=a(r),c=[];for(let d=0;d<s.length;d++)c.push(`"_${d}":${a(s[d])}`);return c.length?`${l.substring(0,l.length-1)},"${o}":{${c.join(",")}}}`:l}function vs(r){return typeof r=="object"&&r!==null}function Vw(r,t){if(!r||typeof r!="object")return;let e=(...l)=>{for(let c of l)vs(c)&&s.push(c)},n=(...l)=>{for(let c of l)if(vs(c))for(let d in c){let u=c[d];vs(u)&&s.push(u)}},i=(...l)=>{for(let c of l)if(Array.isArray(c))for(let d of c)vs(d)&&s.push(d)},o=l=>{if(Array.isArray(l))for(let c of l)vs(c)&&s.push(c);else vs(l)&&s.push(l)},s=[r],a=s.pop();for(;a;)t(a)&&(e(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),n(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),i(a.anyOf,a.allOf,a.oneOf,a.prefixItems),o(a.items)),a=s.pop()}var Kw=M("commandService"),US=new class{_commands=new Map;_onDidRegisterCommand=new P;onDidRegisterCommand=this._onDidRegisterCommand.event;registerCommand(r,t){if(!r)throw new Error("invalid command");if(typeof r=="string"){if(!t)throw new Error("invalid command");return this.registerCommand({id:r,handler:t})}if(r.metadata&&Array.isArray(r.metadata.args)){let s=[];for(let l of r.metadata.args)s.push(l.constraint);let a=r.handler;r.handler=function(l,...c){return RI(c,s),a(l,...c)}}let{id:e}=r,n=this._commands.get(e);n||(n=new yi,this._commands.set(e,n));let i=n.unshift(r),o=J(()=>{i(),this._commands.get(e)?.isEmpty()&&this._commands.delete(e)});return this._onDidRegisterCommand.fire(e),o}registerCommandAlias(r,t){return US.registerCommand(r,(e,...n)=>e.get(Kw).executeCommand(t,...n))}getCommand(r){let t=this._commands.get(r);if(!(!t||t.isEmpty()))return Cr.first(t)}getCommands(){let r=new Map;for(let t of this._commands.keys()){let e=this.getCommand(t);e&&r.set(t,e)}return r}};US.registerCommand("noop",()=>{});var oe=M("environmentService"),St=oe;var z=M("logService"),Lr=M("loggerService");function LS(r){return yo(r)}var Ug=3;function Is(r,t=!1){let e="";for(let n=0;n<r.length;n++){let i=r[n];if(i instanceof Error&&(i=Tt(i,t)),typeof i=="object")try{i=JSON.stringify(i)}catch{}e+=(n>0?" ":"")+i}return e}var _i=class extends _{level=Ug;_onDidChangeLogLevel=this._register(new P);onDidChangeLogLevel=this._onDidChangeLogLevel.event;setLevel(t){this.level!==t&&(this.level=t,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(t){return this.level!==0&&this.level<=t}},du=class extends _i{constructor(e){super();this.logAlways=e}checkLogLevel(e){return this.logAlways||super.checkLogLevel(e)}trace(e,...n){this.checkLogLevel(1)&&this.log(1,Is([e,...n],!0))}debug(e,...n){this.checkLogLevel(2)&&this.log(2,Is([e,...n]))}info(e,...n){this.checkLogLevel(3)&&this.log(3,Is([e,...n]))}warn(e,...n){this.checkLogLevel(4)&&this.log(4,Is([e,...n]))}error(e,...n){if(this.checkLogLevel(5))if(e instanceof Error){let i=Array.prototype.slice.call(arguments);i[0]=e.stack,this.log(5,Is(i))}else this.log(5,Is([e,...n]))}flush(){}};var uu=class extends _i{constructor(e=Ug,n=!0){super();this.useColors=n;this.setLevel(e)}trace(e,...n){this.checkLogLevel(1)&&(this.useColors?console.log("%cTRACE","color: #888",e,...n):console.log(e,...n))}debug(e,...n){this.checkLogLevel(2)&&(this.useColors?console.log("%cDEBUG","background: #eee; color: #888",e,...n):console.log(e,...n))}info(e,...n){this.checkLogLevel(3)&&(this.useColors?console.log("%c INFO","color: #33f",e,...n):console.log(e,...n))}warn(e,...n){this.checkLogLevel(4)&&(this.useColors?console.log("%c WARN","color: #993",e,...n):console.log(e,...n))}error(e,...n){this.checkLogLevel(5)&&(this.useColors?console.log("%c  ERR","color: #f33",e,...n):console.error(e,...n))}flush(){}},fu=class extends _i{constructor(e,n=Ug){super();this.adapter=e;this.setLevel(n)}trace(e,...n){this.checkLogLevel(1)&&this.adapter.log(1,[this.extractMessage(e),...n])}debug(e,...n){this.checkLogLevel(2)&&this.adapter.log(2,[this.extractMessage(e),...n])}info(e,...n){this.checkLogLevel(3)&&this.adapter.log(3,[this.extractMessage(e),...n])}warn(e,...n){this.checkLogLevel(4)&&this.adapter.log(4,[this.extractMessage(e),...n])}error(e,...n){this.checkLogLevel(5)&&this.adapter.log(5,[this.extractMessage(e),...n])}extractMessage(e){return typeof e=="string"?e:Tt(e,this.checkLogLevel(1))}flush(){}},pu=class extends _i{constructor(e){super();this.loggers=e;e.length&&this.setLevel(e[0].getLevel())}setLevel(e){for(let n of this.loggers)n.setLevel(e);super.setLevel(e)}trace(e,...n){for(let i of this.loggers)i.trace(e,...n)}debug(e,...n){for(let i of this.loggers)i.debug(e,...n)}info(e,...n){for(let i of this.loggers)i.info(e,...n)}warn(e,...n){for(let i of this.loggers)i.warn(e,...n)}error(e,...n){for(let i of this.loggers)i.error(e,...n)}flush(){for(let e of this.loggers)e.flush()}dispose(){for(let e of this.loggers)e.dispose();super.dispose()}},hu=class extends _{constructor(e,n,i){super();this.logLevel=e;this.logsHome=n;if(i)for(let o of i)this._loggers.set(o.resource,{logger:void 0,info:o})}_loggers=new Ye;_onDidChangeLoggers=this._register(new P);onDidChangeLoggers=this._onDidChangeLoggers.event;_onDidChangeLogLevel=this._register(new P);onDidChangeLogLevel=this._onDidChangeLogLevel.event;_onDidChangeVisibility=this._register(new P);onDidChangeVisibility=this._onDidChangeVisibility.event;getLoggerEntry(e){return De(e)?[...this._loggers.values()].find(n=>n.info.id===e):this._loggers.get(e)}getLogger(e){return this.getLoggerEntry(e)?.logger}createLogger(e,n){let i=this.toResource(e),o=De(e)?e:n?.id??Ur(i.toString()).toString(16),s=this._loggers.get(i)?.logger,a=n?.logLevel==="always"?1:n?.logLevel;s||(s=this.doCreateLogger(i,a??this.getLogLevel(i)??this.logLevel,{...n,id:o}));let l={logger:s,info:{resource:i,id:o,logLevel:a,name:n?.name,hidden:n?.hidden,extensionId:n?.extensionId,when:n?.when}};return this.registerLogger(l.info),this._loggers.set(i,l),s}toResource(e){return De(e)?V(this.logsHome,`${e}.log`):e}setLogLevel(e,n){if(C.isUri(e)){let i=e,o=n,s=this._loggers.get(i);s&&o!==s.info.logLevel&&(s.info.logLevel=o===this.logLevel?void 0:o,s.logger?.setLevel(o),this._loggers.set(s.info.resource,s),this._onDidChangeLogLevel.fire([i,o]))}else{this.logLevel=e;for(let[i,o]of this._loggers.entries())this._loggers.get(i)?.info.logLevel===void 0&&o.logger?.setLevel(this.logLevel);this._onDidChangeLogLevel.fire(this.logLevel)}}setVisibility(e,n){let i=this.getLoggerEntry(e);i&&n!==!i.info.hidden&&(i.info.hidden=!n,this._loggers.set(i.info.resource,i),this._onDidChangeVisibility.fire([i.info.resource,n]))}getLogLevel(e){let n;return e&&(n=this._loggers.get(e)?.info.logLevel),n??this.logLevel}registerLogger(e){let n=this._loggers.get(e.resource);n?n.info.hidden!==e.hidden&&this.setVisibility(e.resource,!e.hidden):(this._loggers.set(e.resource,{info:e,logger:void 0}),this._onDidChangeLoggers.fire({added:[e],removed:[]}))}deregisterLogger(e){let n=this._loggers.get(e);n&&(n.logger&&n.logger.dispose(),this._loggers.delete(e),this._onDidChangeLoggers.fire({added:[],removed:[n.info]}))}*getRegisteredLoggers(){for(let e of this._loggers.values())yield e.info}getRegisteredLogger(e){return this._loggers.get(e)?.info}dispose(){this._loggers.forEach(e=>e.logger?.dispose()),this._loggers.clear(),super.dispose()}},kg=class{onDidChangeLogLevel=new P().event;setLevel(t){}getLevel(){return 3}trace(t,...e){}debug(t,...e){}info(t,...e){}warn(t,...e){}error(t,...e){}critical(t,...e){}dispose(){}flush(){}},gu=class extends kg{};function Zl(r){switch(r){case 1:return"trace";case 2:return"debug";case 3:return"info";case 4:return"warn";case 5:return"error";case 0:return"off"}}var k5=new lu("logLevel",Zl(3));var de=M("productService");var Ss=class extends _{constructor(e,n,i){super();this.productService=n;this.logService=i;e&&this._register(new mt(()=>{this.cleanUpCodeCaches(e)},3e4)).schedule()}_DataMaxAge=this.productService.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3;async cleanUpCodeCaches(e){this.logService.trace("[code cache cleanup]: Starting to clean up old code cache folders.");try{let n=Date.now(),i=Et(e),o=at(e),s=await ce.readdir(i);await Promise.all(s.map(async a=>{if(a===o)return;let l=W(i,a),c=await FS.promises.stat(l);if(c.isDirectory()&&n-c.mtime.getTime()>this._DataMaxAge)return this.logService.trace(`[code cache cleanup]: Removing code cache folder ${a}.`),ce.rm(l)}))}catch(n){ze(n)}}};Ss=E([m(1,de),m(2,z)],Ss);import*as Lg from"fs";var bs=class extends _{constructor(e,n,i){super();this.environmentService=e;this.logService=n;this.productService=i;this.environmentService.isBuilt&&this._register(new mt(()=>{this.cleanUpLanguagePackCache()},4e4)).schedule()}_DataMaxAge=this.productService.quality!=="stable"?1e3*60*60*24*7:1e3*60*60*24*30*3;async cleanUpLanguagePackCache(){this.logService.trace("[language pack cache cleanup]: Starting to clean up unused language packs.");try{let e=Object.create(null),n=JSON.parse(await Lg.promises.readFile(W(this.environmentService.userDataPath,"languagepacks.json"),"utf8"));for(let l of Object.keys(n)){let c=n[l];e[`${c.hash}.${l}`]=!0}let i=W(this.environmentService.userDataPath,"clp");if(!await ce.exists(i))return;let s=await ce.readdir(i);for(let l of s){if(e[l]){this.logService.trace(`[language pack cache cleanup]: Skipping folder ${l}. Language pack still in use.`);continue}this.logService.trace(`[language pack cache cleanup]: Removing unused language pack: ${l}`),await ce.rm(W(i,l))}let a=Date.now();for(let l of Object.keys(e)){let c=W(i,l),d=await ce.readdir(c);for(let u of d){if(u==="tcf.json")continue;let f=W(c,u),h=await Lg.promises.stat(f);h.isDirectory()&&a-h.mtime.getTime()>this._DataMaxAge&&(this.logService.trace(`[language pack cache cleanup]: Removing language pack cache folder: ${W(l,u)}`),await ce.rm(f))}}}catch(e){ze(e)}}};bs=E([m(0,St),m(1,z),m(2,de)],bs);var Fg=class{data=new Map;add(t,e){Td(De(t)),Td(He(e)),Td(!this.data.has(t),"There is already an extension with this id"),this.data.set(t,e)}knows(t){return this.data.has(t)}as(t){return this.data.get(t)||null}},Ne=new Fg;var zw={Quickaccess:"workbench.contributions.quickaccess"},Ag=class{providers=[];defaultProvider=void 0;registerQuickAccessProvider(t){return t.prefix.length===0?this.defaultProvider=t:this.providers.push(t),this.providers.sort((e,n)=>n.prefix.length-e.prefix.length),J(()=>{this.providers.splice(this.providers.indexOf(t),1),this.defaultProvider===t&&(this.defaultProvider=void 0)})}getQuickAccessProviders(){return qn([this.defaultProvider,...this.providers])}getQuickAccessProvider(t){return t&&this.providers.find(n=>t.startsWith(n.prefix))||void 0||this.defaultProvider}clear(){let t=[...this.providers],e=this.defaultProvider;return this.providers=[],this.defaultProvider=void 0,()=>{this.providers=t,this.defaultProvider=e}}};Ne.add(zw.Quickaccess,new Ag);var bA=new Uint32Array(10);var xA=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),EA=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),wA=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),PA=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function AS(...r){return function(t,e){for(let n=0,i=r.length;n<i;n++){let o=r[n](t,e);if(o)return o}return null}}var LA=OS.bind(void 0,!1),Ng=OS.bind(void 0,!0);function OS(r,t,e){if(!e||e.length<t.length)return null;let n;return r?n=bi(e,t):n=e.indexOf(t)===0,n?t.length>0?[{start:0,end:t.length}]:[]:null}function qw(r,t){let e=t.toLowerCase().indexOf(r.toLowerCase());return e===-1?null:[{start:e,end:e+r.length}]}function Hw(r,t){return Og(r.toLowerCase(),t.toLowerCase(),0,0)}function Og(r,t,e,n){if(e===r.length)return[];if(n===t.length)return null;if(r[e]===t[n]){let i=null;return(i=Og(r,t,e+1,n+1))?NS({start:n,end:n+1},i):null}return Og(r,t,e,n+1)}function Bg(r){return 97<=r&&r<=122}function ec(r){return 65<=r&&r<=90}function Wg(r){return 48<=r&&r<=57}function jw(r){return r===32||r===9||r===10||r===13}var Gw=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(r=>Gw.add(r.charCodeAt(0)));function MS(r){return Bg(r)||ec(r)||Wg(r)}function NS(r,t){return t.length===0?t=[r]:r.end===t[0].start?t[0].start=r.start:t.unshift(r),t}function BS(r,t){for(let e=t;e<r.length;e++){let n=r.charCodeAt(e);if(ec(n)||Wg(n)||e>0&&!MS(r.charCodeAt(e-1)))return e}return r.length}function Mg(r,t,e,n){if(e===r.length)return[];if(n===t.length)return null;if(r[e]!==t[n].toLowerCase())return null;{let i=null,o=n+1;for(i=Mg(r,t,e+1,n+1);!i&&(o=BS(t,o))<t.length;)i=Mg(r,t,e+1,o),o++;return i===null?null:NS({start:n,end:n+1},i)}}function Qw(r){let t=0,e=0,n=0,i=0,o=0;for(let d=0;d<r.length;d++)o=r.charCodeAt(d),ec(o)&&t++,Bg(o)&&e++,MS(o)&&n++,Wg(o)&&i++;let s=t/r.length,a=e/r.length,l=n/r.length,c=i/r.length;return{upperPercent:s,lowerPercent:a,alphaPercent:l,numericPercent:c}}function Jw(r){let{upperPercent:t,lowerPercent:e}=r;return e===0&&t>.6}function Xw(r){let{upperPercent:t,lowerPercent:e,alphaPercent:n,numericPercent:i}=r;return e>.2&&t<.8&&n>.6&&i<.2}function Yw(r){let t=0,e=0,n=0,i=0;for(let o=0;o<r.length;o++)n=r.charCodeAt(o),ec(n)&&t++,Bg(n)&&e++,jw(n)&&i++;return(t===0||e===0)&&i===0?r.length<=30:t<=5}function WS(r,t){if(!t||(t=t.trim(),t.length===0)||!Yw(r))return null;t.length>60&&(t=t.substring(0,60));let e=Qw(t);if(!Xw(e)){if(!Jw(e))return null;t=t.toLowerCase()}let n=null,i=0;for(r=r.toLowerCase();i<t.length&&(n=Mg(r,t,0,i))===null;)i=BS(t,i+1);return n}var FA=AS(Ng,WS,qw),AA=AS(Ng,WS,Hw),OA=new jr(1e4);var yu=128;function Vg(){let r=[],t=[];for(let e=0;e<=yu;e++)t[e]=0;for(let e=0;e<=yu;e++)r.push(t.slice(0));return r}function VS(r){let t=[];for(let e=0;e<=r;e++)t[e]=0;return t}var MA=VS(2*yu),NA=VS(2*yu),BA=Vg(),WA=Vg(),VA=Vg();var Zw;(e=>{e.Default=[-100,0];function t(n){return!n||n.length===2&&n[0]===-100&&n[1]===0}e.isDefault=t})(Zw||={});var qA=new on(()=>{let r=new Intl.Collator(void 0,{numeric:!0,sensitivity:"base"});return{collator:r,collatorIsNumeric:r.resolvedOptions().numeric}}),HA=new on(()=>({collator:new Intl.Collator(void 0,{numeric:!0})})),jA=new on(()=>({collator:new Intl.Collator(void 0,{numeric:!0,sensitivity:"accent"})}));var aO=Object.freeze({score:0}),lO=1<<18,cO=1<<17;var tc=class{_keyCodeToStr;_strToKeyCode;constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(t,e){this._keyCodeToStr[t]=e,this._strToKeyCode[e.toLowerCase()]=t}keyCodeToStr(t){return this._keyCodeToStr[t]}strToKeyCode(t){return this._strToKeyCode[t.toLowerCase()]||0}},vu=new tc,Kg=new tc,$g=new tc,eP=new Array(230),tP={},nP=[],rP=Object.create(null),iP=Object.create(null);var KS=[],zg=[];for(let r=0;r<=193;r++)KS[r]=-1;for(let r=0;r<=132;r++)zg[r]=-1;(function(){let r="",t=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN",r,r],[1,1,"Hyper",0,r,0,r,r,r],[1,2,"Super",0,r,0,r,r,r],[1,3,"Fn",0,r,0,r,r,r],[1,4,"FnLock",0,r,0,r,r,r],[1,5,"Suspend",0,r,0,r,r,r],[1,6,"Resume",0,r,0,r,r,r],[1,7,"Turbo",0,r,0,r,r,r],[1,8,"Sleep",0,r,0,"VK_SLEEP",r,r],[1,9,"WakeUp",0,r,0,r,r,r],[0,10,"KeyA",31,"A",65,"VK_A",r,r],[0,11,"KeyB",32,"B",66,"VK_B",r,r],[0,12,"KeyC",33,"C",67,"VK_C",r,r],[0,13,"KeyD",34,"D",68,"VK_D",r,r],[0,14,"KeyE",35,"E",69,"VK_E",r,r],[0,15,"KeyF",36,"F",70,"VK_F",r,r],[0,16,"KeyG",37,"G",71,"VK_G",r,r],[0,17,"KeyH",38,"H",72,"VK_H",r,r],[0,18,"KeyI",39,"I",73,"VK_I",r,r],[0,19,"KeyJ",40,"J",74,"VK_J",r,r],[0,20,"KeyK",41,"K",75,"VK_K",r,r],[0,21,"KeyL",42,"L",76,"VK_L",r,r],[0,22,"KeyM",43,"M",77,"VK_M",r,r],[0,23,"KeyN",44,"N",78,"VK_N",r,r],[0,24,"KeyO",45,"O",79,"VK_O",r,r],[0,25,"KeyP",46,"P",80,"VK_P",r,r],[0,26,"KeyQ",47,"Q",81,"VK_Q",r,r],[0,27,"KeyR",48,"R",82,"VK_R",r,r],[0,28,"KeyS",49,"S",83,"VK_S",r,r],[0,29,"KeyT",50,"T",84,"VK_T",r,r],[0,30,"KeyU",51,"U",85,"VK_U",r,r],[0,31,"KeyV",52,"V",86,"VK_V",r,r],[0,32,"KeyW",53,"W",87,"VK_W",r,r],[0,33,"KeyX",54,"X",88,"VK_X",r,r],[0,34,"KeyY",55,"Y",89,"VK_Y",r,r],[0,35,"KeyZ",56,"Z",90,"VK_Z",r,r],[0,36,"Digit1",22,"1",49,"VK_1",r,r],[0,37,"Digit2",23,"2",50,"VK_2",r,r],[0,38,"Digit3",24,"3",51,"VK_3",r,r],[0,39,"Digit4",25,"4",52,"VK_4",r,r],[0,40,"Digit5",26,"5",53,"VK_5",r,r],[0,41,"Digit6",27,"6",54,"VK_6",r,r],[0,42,"Digit7",28,"7",55,"VK_7",r,r],[0,43,"Digit8",29,"8",56,"VK_8",r,r],[0,44,"Digit9",30,"9",57,"VK_9",r,r],[0,45,"Digit0",21,"0",48,"VK_0",r,r],[1,46,"Enter",3,"Enter",13,"VK_RETURN",r,r],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE",r,r],[1,48,"Backspace",1,"Backspace",8,"VK_BACK",r,r],[1,49,"Tab",2,"Tab",9,"VK_TAB",r,r],[1,50,"Space",10,"Space",32,"VK_SPACE",r,r],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,r,0,r,r,r],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL",r,r],[1,64,"F1",59,"F1",112,"VK_F1",r,r],[1,65,"F2",60,"F2",113,"VK_F2",r,r],[1,66,"F3",61,"F3",114,"VK_F3",r,r],[1,67,"F4",62,"F4",115,"VK_F4",r,r],[1,68,"F5",63,"F5",116,"VK_F5",r,r],[1,69,"F6",64,"F6",117,"VK_F6",r,r],[1,70,"F7",65,"F7",118,"VK_F7",r,r],[1,71,"F8",66,"F8",119,"VK_F8",r,r],[1,72,"F9",67,"F9",120,"VK_F9",r,r],[1,73,"F10",68,"F10",121,"VK_F10",r,r],[1,74,"F11",69,"F11",122,"VK_F11",r,r],[1,75,"F12",70,"F12",123,"VK_F12",r,r],[1,76,"PrintScreen",0,r,0,r,r,r],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL",r,r],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE",r,r],[1,79,"Insert",19,"Insert",45,"VK_INSERT",r,r],[1,80,"Home",14,"Home",36,"VK_HOME",r,r],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR",r,r],[1,82,"Delete",20,"Delete",46,"VK_DELETE",r,r],[1,83,"End",13,"End",35,"VK_END",r,r],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT",r,r],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",r],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",r],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",r],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",r],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK",r,r],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE",r,r],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY",r,r],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT",r,r],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD",r,r],[1,94,"NumpadEnter",3,r,0,r,r,r],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1",r,r],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2",r,r],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3",r,r],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4",r,r],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5",r,r],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6",r,r],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7",r,r],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8",r,r],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9",r,r],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0",r,r],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL",r,r],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102",r,r],[1,107,"ContextMenu",58,"ContextMenu",93,r,r,r],[1,108,"Power",0,r,0,r,r,r],[1,109,"NumpadEqual",0,r,0,r,r,r],[1,110,"F13",71,"F13",124,"VK_F13",r,r],[1,111,"F14",72,"F14",125,"VK_F14",r,r],[1,112,"F15",73,"F15",126,"VK_F15",r,r],[1,113,"F16",74,"F16",127,"VK_F16",r,r],[1,114,"F17",75,"F17",128,"VK_F17",r,r],[1,115,"F18",76,"F18",129,"VK_F18",r,r],[1,116,"F19",77,"F19",130,"VK_F19",r,r],[1,117,"F20",78,"F20",131,"VK_F20",r,r],[1,118,"F21",79,"F21",132,"VK_F21",r,r],[1,119,"F22",80,"F22",133,"VK_F22",r,r],[1,120,"F23",81,"F23",134,"VK_F23",r,r],[1,121,"F24",82,"F24",135,"VK_F24",r,r],[1,122,"Open",0,r,0,r,r,r],[1,123,"Help",0,r,0,r,r,r],[1,124,"Select",0,r,0,r,r,r],[1,125,"Again",0,r,0,r,r,r],[1,126,"Undo",0,r,0,r,r,r],[1,127,"Cut",0,r,0,r,r,r],[1,128,"Copy",0,r,0,r,r,r],[1,129,"Paste",0,r,0,r,r,r],[1,130,"Find",0,r,0,r,r,r],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE",r,r],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP",r,r],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN",r,r],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR",r,r],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1",r,r],[1,136,"KanaMode",0,r,0,r,r,r],[0,137,"IntlYen",0,r,0,r,r,r],[1,138,"Convert",0,r,0,r,r,r],[1,139,"NonConvert",0,r,0,r,r,r],[1,140,"Lang1",0,r,0,r,r,r],[1,141,"Lang2",0,r,0,r,r,r],[1,142,"Lang3",0,r,0,r,r,r],[1,143,"Lang4",0,r,0,r,r,r],[1,144,"Lang5",0,r,0,r,r,r],[1,145,"Abort",0,r,0,r,r,r],[1,146,"Props",0,r,0,r,r,r],[1,147,"NumpadParenLeft",0,r,0,r,r,r],[1,148,"NumpadParenRight",0,r,0,r,r,r],[1,149,"NumpadBackspace",0,r,0,r,r,r],[1,150,"NumpadMemoryStore",0,r,0,r,r,r],[1,151,"NumpadMemoryRecall",0,r,0,r,r,r],[1,152,"NumpadMemoryClear",0,r,0,r,r,r],[1,153,"NumpadMemoryAdd",0,r,0,r,r,r],[1,154,"NumpadMemorySubtract",0,r,0,r,r,r],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR",r,r],[1,156,"NumpadClearEntry",0,r,0,r,r,r],[1,0,r,5,"Ctrl",17,"VK_CONTROL",r,r],[1,0,r,4,"Shift",16,"VK_SHIFT",r,r],[1,0,r,6,"Alt",18,"VK_MENU",r,r],[1,0,r,57,"Meta",91,"VK_COMMAND",r,r],[1,157,"ControlLeft",5,r,0,"VK_LCONTROL",r,r],[1,158,"ShiftLeft",4,r,0,"VK_LSHIFT",r,r],[1,159,"AltLeft",6,r,0,"VK_LMENU",r,r],[1,160,"MetaLeft",57,r,0,"VK_LWIN",r,r],[1,161,"ControlRight",5,r,0,"VK_RCONTROL",r,r],[1,162,"ShiftRight",4,r,0,"VK_RSHIFT",r,r],[1,163,"AltRight",6,r,0,"VK_RMENU",r,r],[1,164,"MetaRight",57,r,0,"VK_RWIN",r,r],[1,165,"BrightnessUp",0,r,0,r,r,r],[1,166,"BrightnessDown",0,r,0,r,r,r],[1,167,"MediaPlay",0,r,0,r,r,r],[1,168,"MediaRecord",0,r,0,r,r,r],[1,169,"MediaFastForward",0,r,0,r,r,r],[1,170,"MediaRewind",0,r,0,r,r,r],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK",r,r],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK",r,r],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP",r,r],[1,174,"Eject",0,r,0,r,r,r],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE",r,r],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT",r,r],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL",r,r],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2",r,r],[1,179,"LaunchApp1",0,r,0,"VK_MEDIA_LAUNCH_APP1",r,r],[1,180,"SelectTask",0,r,0,r,r,r],[1,181,"LaunchScreenSaver",0,r,0,r,r,r],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH",r,r],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME",r,r],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK",r,r],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD",r,r],[1,186,"BrowserStop",0,r,0,"VK_BROWSER_STOP",r,r],[1,187,"BrowserRefresh",0,r,0,"VK_BROWSER_REFRESH",r,r],[1,188,"BrowserFavorites",0,r,0,"VK_BROWSER_FAVORITES",r,r],[1,189,"ZoomToggle",0,r,0,r,r,r],[1,190,"MailReply",0,r,0,r,r,r],[1,191,"MailForward",0,r,0,r,r,r],[1,192,"MailSend",0,r,0,r,r,r],[1,0,r,114,"KeyInComposition",229,r,r,r],[1,0,r,116,"ABNT_C2",194,"VK_ABNT_C2",r,r],[1,0,r,96,"OEM_8",223,"VK_OEM_8",r,r],[1,0,r,0,r,0,"VK_KANA",r,r],[1,0,r,0,r,0,"VK_HANGUL",r,r],[1,0,r,0,r,0,"VK_JUNJA",r,r],[1,0,r,0,r,0,"VK_FINAL",r,r],[1,0,r,0,r,0,"VK_HANJA",r,r],[1,0,r,0,r,0,"VK_KANJI",r,r],[1,0,r,0,r,0,"VK_CONVERT",r,r],[1,0,r,0,r,0,"VK_NONCONVERT",r,r],[1,0,r,0,r,0,"VK_ACCEPT",r,r],[1,0,r,0,r,0,"VK_MODECHANGE",r,r],[1,0,r,0,r,0,"VK_SELECT",r,r],[1,0,r,0,r,0,"VK_PRINT",r,r],[1,0,r,0,r,0,"VK_EXECUTE",r,r],[1,0,r,0,r,0,"VK_SNAPSHOT",r,r],[1,0,r,0,r,0,"VK_HELP",r,r],[1,0,r,0,r,0,"VK_APPS",r,r],[1,0,r,0,r,0,"VK_PROCESSKEY",r,r],[1,0,r,0,r,0,"VK_PACKET",r,r],[1,0,r,0,r,0,"VK_DBE_SBCSCHAR",r,r],[1,0,r,0,r,0,"VK_DBE_DBCSCHAR",r,r],[1,0,r,0,r,0,"VK_ATTN",r,r],[1,0,r,0,r,0,"VK_CRSEL",r,r],[1,0,r,0,r,0,"VK_EXSEL",r,r],[1,0,r,0,r,0,"VK_EREOF",r,r],[1,0,r,0,r,0,"VK_PLAY",r,r],[1,0,r,0,r,0,"VK_ZOOM",r,r],[1,0,r,0,r,0,"VK_NONAME",r,r],[1,0,r,0,r,0,"VK_PA1",r,r],[1,0,r,0,r,0,"VK_OEM_CLEAR",r,r]],e=[],n=[];for(let i of t){let[o,s,a,l,c,d,u,f,h]=i;if(n[s]||(n[s]=!0,nP[s]=a,rP[a]=s,iP[a.toLowerCase()]=s,o&&(KS[s]=l,l!==0&&l!==3&&l!==5&&l!==4&&l!==6&&l!==57&&(zg[l]=s))),!e[l]){if(e[l]=!0,!c)throw new Error(`String representation missing for key code ${l} around scan code ${a}`);vu.define(l,c),Kg.define(l,f||c),$g.define(l,h||f||c)}d&&(eP[d]=l),u&&(tP[u]=l)}zg[3]=46})();var oP;(s=>{function r(a){return vu.keyCodeToStr(a)}s.toString=r;function t(a){return vu.strToKeyCode(a)}s.fromString=t;function e(a){return Kg.keyCodeToStr(a)}s.toUserSettingsUS=e;function n(a){return $g.keyCodeToStr(a)}s.toUserSettingsGeneral=n;function i(a){return Kg.strToKeyCode(a)||$g.strToKeyCode(a)}s.fromUserSettings=i;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return vu.keyCodeToStr(a)}s.toElectronAccelerator=o})(oP||={});var Iu=(i=>(i[i.Ignore=0]="Ignore",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i))(Iu||{});(a=>{let r="error",t="warning",e="warn",n="info",i="ignore";function o(l){return l?Un(r,l)?3:Un(t,l)||Un(e,l)?2:Un(n,l)?1:0:0}a.fromValue=o;function s(l){switch(l){case 3:return r;case 2:return t;case 1:return n;default:return i}}a.toString=s})(Iu||={});var Mt=Iu;var qg=new RegExp(`\\$\\(${Fn.iconNameExpression}(?:${Fn.iconModifierExpression})?\\)`,"g"),wO=new RegExp(`(\\\\)?${qg.source}`,"g");var PO=new RegExp(`\\\\${qg.source}`,"g");var TO=new RegExp(`(\\s)?(\\\\)?${qg.source}(\\s)?`,"g");var RO=new RegExp(`\\$\\(${Fn.iconNameCharacter}+\\)`,"g");var Hg=class{constructor(t){this.options=t}getItemLabel(t){return t.label}getItemDescription(t){if(!this.options?.skipDescription)return t.description}getItemPath(t){if(!this.options?.skipPath)return t.resource?.scheme===ne.file?t.resource.fsPath:t.resource?.path}},o7=new Hg,s7=M("quickInputService");var bu="extensions.user.cache",$S="extensions.builtin.cache",xu="undefined_publisher";var mr=class{value;_lower;constructor(t){this.value=t,this._lower=t.toLowerCase()}static equals(t,e){if(typeof t>"u"||t===null)return typeof e>"u"||e===null;if(typeof e>"u"||e===null)return!1;if(typeof t=="string"||typeof e=="string"){let n=typeof t=="string"?t:t.value,i=typeof e=="string"?e:e.value;return Un(n,i)}return t._lower===e._lower}static toKey(t){return typeof t=="string"?t.toLowerCase():t._lower}};var Su=class{_map=new Map;clear(){this._map.clear()}delete(t){this._map.delete(mr.toKey(t))}get(t){return this._map.get(mr.toKey(t))}has(t){return this._map.has(mr.toKey(t))}set(t,e){this._map.set(mr.toKey(t),e)}values(){return this._map.values()}forEach(t){this._map.forEach(t)}[Symbol.iterator](){return this._map[Symbol.iterator]()}};function rc(r){return aP(r)}function aP(r){return r.contributes&&r.contributes.localizations?r.contributes.localizations.length>0:!1}function zS(r){return r.map(t=>{let[e,n]=t.split("@");return{proposalName:e,version:n?parseInt(n):void 0}})}function qS(r){return r.map(t=>t.split("@")[0])}var C7=M("IBuiltinExtensionsScannerService");var Qg="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",j7=new RegExp(Qg),HS="__web_extension",jS="skipWalkthrough",ic="extensionInstallSource",GS="dependecyOrPackExtensionInstall",QS="clientTargetPlatform";function JS(r){switch(r){case"win32-x64":return"Windows 64 bit";case"win32-arm64":return"Windows ARM";case"linux-x64":return"Linux 64 bit";case"linux-arm64":return"Linux ARM 64";case"linux-armhf":return"Linux ARM";case"alpine-x64":return"Alpine Linux 64 bit";case"alpine-arm64":return"Alpine ARM 64";case"darwin-x64":return"Mac";case"darwin-arm64":return"Mac Silicon";case"web":return"Web";case"universal":return"universal";case"unknown":return"unknown";case"undefined":return"undefined"}}function XS(r){switch(r){case"win32-x64":return"win32-x64";case"win32-arm64":return"win32-arm64";case"linux-x64":return"linux-x64";case"linux-arm64":return"linux-arm64";case"linux-armhf":return"linux-armhf";case"alpine-x64":return"alpine-x64";case"alpine-arm64":return"alpine-arm64";case"darwin-x64":return"darwin-x64";case"darwin-arm64":return"darwin-arm64";case"web":return"web";case"universal":return"universal";default:return"unknown"}}function Eu(r,t){switch(r){case 3:return t==="x64"?"win32-x64":t==="arm64"?"win32-arm64":"unknown";case 2:return t==="x64"?"linux-x64":t==="arm64"?"linux-arm64":t==="arm"?"linux-armhf":"unknown";case"alpine":return t==="x64"?"alpine-x64":t==="arm64"?"alpine-arm64":"unknown";case 1:return t==="x64"?"darwin-x64":t==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}function xs(r,t){return t==="web"&&!r.includes("web")}function Es(r,t,e){return xs(t,e)?!1:r==="undefined"||r==="universal"?!0:r==="unknown"?!1:r===e}function YS(r){return r&&typeof r=="object"&&typeof r.id=="string"&&(!r.uuid||typeof r.uuid=="string")}var Bt=M("extensionGalleryService");var ki=class extends Error{constructor(e,n){super(e);this.code=n;this.name=n}};var Xe=class extends Error{constructor(e,n){super(e);this.code=n;this.name=n}},an=M("extensionManagementService"),oc="extensionsIdentifiers/disabled";var wu=M("IGlobalExtensionEnablementService"),Jg=M("IExtensionTipsService"),G7=wr("extensions","Extensions"),Q7=wr("preferences","Preferences");function lP(r){return r.tags.find(t=>t.startsWith("lp-"))?.split("lp-")[1]}var sc=M("languagePackService"),ws=class extends _{constructor(e){super();this.extensionGalleryService=e}async getAvailableLanguages(){let e=new It;setTimeout(()=>e.cancel(),1e3);let n;try{n=await this.extensionGalleryService.query({text:'category:"language packs"',pageSize:20},e.token)}catch{return[]}let o=n.firstPage.filter(s=>s.properties.localizedLanguages?.length&&s.tags.some(a=>a.startsWith("lp-"))).map(s=>{let a=s.properties.localizedLanguages?.[0],l=lP(s);return{...this.createQuickPickItem(l,a,s),extensionId:s.identifier.id,galleryExtension:s}});return o.push(this.createQuickPickItem("en","English")),o}createQuickPickItem(e,n,i){let o=n??e,s;if(o!==e&&(s=`(${e})`),e.toLowerCase()===zn.toLowerCase()&&(s??="",s+=g("currentDisplayLanguage"," (Current)")),i?.installCount){s??="";let a=i.installCount,l;a>1e6?l=`${Math.floor(a/1e5)/10}M`:a>1e3?l=`${Math.floor(a/1e3)}K`:l=String(a),s+=` $(cloud-download) ${l}`}return{id:e,label:o,description:s}}};ws=E([m(0,Bt)],ws);import*as kb from"fs";import{createHash as LP}from"crypto";var Ps="**",ZS="/",Pu="[/\\\\]",Tu="[^/\\\\]",cP=/\//g;function eb(r,t){switch(r){case 0:return"";case 1:return`${Tu}*?`;default:return`(?:${Pu}|${Tu}+${Pu}${t?`|${Pu}${Tu}+`:""})*?`}}function tb(r,t){if(!r)return[];let e=[],n=!1,i=!1,o="";for(let s of r){switch(s){case t:if(!n&&!i){e.push(o),o="";continue}break;case"{":n=!0;break;case"}":n=!1;break;case"[":i=!0;break;case"]":i=!1;break}o+=s}return o&&e.push(o),e}function sb(r){if(!r)return"";let t="",e=tb(r,ZS);if(e.every(n=>n===Ps))t=".*";else{let n=!1;e.forEach((i,o)=>{if(i===Ps){if(n)return;t+=eb(2,o===e.length-1)}else{let s=!1,a="",l=!1,c="";for(let d of i){if(d!=="}"&&s){a+=d;continue}if(l&&(d!=="]"||!c)){let u;d==="-"?u=d:(d==="^"||d==="!")&&!c?u="^":d===ZS?u="":u=ur(d),c+=u;continue}switch(d){case"{":s=!0;continue;case"[":l=!0;continue;case"}":{let f=`(?:${tb(a,",").map(h=>sb(h)).join("|")})`;t+=f,s=!1,a="";break}case"]":{t+="["+c+"]",l=!1,c="";break}case"?":t+=Tu;continue;case"*":t+=eb(1);continue;default:t+=ur(d)}}o<e.length-1&&(e[o+1]!==Ps||o+2<e.length)&&(t+=Pu)}n=i===Ps})}return t}var dP=/^\*\*\/\*\.[\w\.-]+$/,uP=/^\*\*\/([\w\.-]+)\/?$/,fP=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,pP=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,hP=/^\*\*((\/[\w\.-]+)+)\/?$/,gP=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,nb=new jr(1e4),rb=function(){return!1},Fr=function(){return null};function Yg(r,t){if(!r)return Fr;let e;typeof r!="string"?e=r.pattern:e=r,e=e.trim();let n=`${e}_${!!t.trimForExclusions}`,i=nb.get(n);if(i)return ib(i,r);let o;return dP.test(e)?i=mP(e.substr(4),e):(o=uP.exec(Xg(e,t)))?i=yP(o[1],e):(t.trimForExclusions?pP:fP).test(e)?i=vP(e,t):(o=hP.exec(Xg(e,t)))?i=ob(o[1].substr(1),e,!0):(o=gP.exec(Xg(e,t)))?i=ob(o[1],e,!1):i=IP(e),nb.set(n,i),ib(i,r)}function ib(r,t){if(typeof t=="string")return r;let e=function(n,i){return Gr(n,t.base,!Oe)?r(Bd(n.substr(t.base.length),wt),i):null};return e.allBasenames=r.allBasenames,e.allPaths=r.allPaths,e.basenames=r.basenames,e.patterns=r.patterns,e}function Xg(r,t){return t.trimForExclusions&&r.endsWith("/**")?r.substr(0,r.length-2):r}function mP(r,t){return function(e,n){return typeof e=="string"&&e.endsWith(r)?t:null}}function yP(r,t){let e=`/${r}`,n=`\\${r}`,i=function(s,a){return typeof s!="string"?null:a?a===r?t:null:s===r||s.endsWith(e)||s.endsWith(n)?t:null},o=[r];return i.basenames=o,i.patterns=[t],i.allBasenames=o,i}function vP(r,t){let e=lb(r.slice(1,-1).split(",").map(a=>Yg(a,t)).filter(a=>a!==Fr),r),n=e.length;if(!n)return Fr;if(n===1)return e[0];let i=function(a,l){for(let c=0,d=e.length;c<d;c++)if(e[c](a,l))return r;return null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function ob(r,t,e){let n=wt===_e.sep,i=n?r:r.replace(cP,wt),o=wt+i,s=_e.sep+r,a;return e?a=function(l,c){return typeof l=="string"&&(l===i||l.endsWith(o)||!n&&(l===r||l.endsWith(s)))?t:null}:a=function(l,c){return typeof l=="string"&&(l===i||!n&&l===r)?t:null},a.allPaths=[(e?"*/":"./")+r],a}function IP(r){try{let t=new RegExp(`^${sb(r)}$`);return function(e){return t.lastIndex=0,typeof e=="string"&&t.test(e)?r:null}}catch{return Fr}}function ab(r,t={}){if(!r)return rb;if(typeof r=="string"||SP(r)){let e=Yg(r,t);if(e===Fr)return rb;let n=function(i,o){return!!e(i,o)};return e.allBasenames&&(n.allBasenames=e.allBasenames),e.allPaths&&(n.allPaths=e.allPaths),n}return bP(r,t)}function SP(r){let t=r;return t?typeof t.base=="string"&&typeof t.pattern=="string":!1}function bP(r,t){let e=lb(Object.getOwnPropertyNames(r).map(a=>xP(a,r[a],t)).filter(a=>a!==Fr)),n=e.length;if(!n)return Fr;if(!e.some(a=>!!a.requiresSiblings)){if(n===1)return e[0];let a=function(d,u){let f;for(let h=0,v=e.length;h<v;h++){let y=e[h](d,u);if(typeof y=="string")return y;Gd(y)&&(f||(f=[]),f.push(y))}return f?(async()=>{for(let h of f){let v=await h;if(typeof v=="string")return v}return null})():null},l=e.find(d=>!!d.allBasenames);l&&(a.allBasenames=l.allBasenames);let c=e.reduce((d,u)=>u.allPaths?d.concat(u.allPaths):d,[]);return c.length&&(a.allPaths=c),a}let i=function(a,l,c){let d,u;for(let f=0,h=e.length;f<h;f++){let v=e[f];v.requiresSiblings&&c&&(l||(l=at(a)),d||(d=l.substr(0,l.length-xd(a).length)));let y=v(a,l,d,c);if(typeof y=="string")return y;Gd(y)&&(u||(u=[]),u.push(y))}return u?(async()=>{for(let f of u){let h=await f;if(typeof h=="string")return h}return null})():null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function xP(r,t,e){if(t===!1)return Fr;let n=Yg(r,e);if(n===Fr)return Fr;if(typeof t=="boolean")return n;if(t){let i=t.when;if(typeof i=="string"){let o=(s,a,l,c)=>{if(!c||!n(s,a))return null;let d=i.replace("$(basename)",()=>l),u=c(d);return Gd(u)?u.then(f=>f?r:null):u?r:null};return o.requiresSiblings=!0,o}}return n}function lb(r,t){let e=r.filter(a=>!!a.basenames);if(e.length<2)return r;let n=e.reduce((a,l)=>{let c=l.basenames;return c?a.concat(c):a},[]),i;if(t){i=[];for(let a=0,l=n.length;a<l;a++)i.push(t)}else i=e.reduce((a,l)=>{let c=l.patterns;return c?a.concat(c):a},[]);let o=function(a,l){if(typeof a!="string")return null;if(!l){let d;for(d=a.length;d>0;d--){let u=a.charCodeAt(d-1);if(u===47||u===92)break}l=a.substr(d)}let c=n.indexOf(l);return c!==-1?i[c]:null};o.basenames=n,o.patterns=i,o.allBasenames=n;let s=r.filter(a=>!a.basenames);return s.push(o),s}function Zg(r,t){return Pt(r,t,(e,n)=>typeof e=="string"&&typeof n=="string"?e===n:typeof e!="string"&&typeof n!="string"?e.base===n.base&&e.pattern===n.pattern:!1)}var em=class{_value="";_pos=0;reset(t){return this._value=t,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(t){let e=t.charCodeAt(0),n=this._value.charCodeAt(this._pos);return e-n}value(){return this._value[this._pos]}},tm=class{constructor(t=!0){this._caseSensitive=t}_value;_from;_to;reset(t){return this._value=t,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let t=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(t)this._from++;else break;else t=!1;return this}cmp(t){return this._caseSensitive?Wd(t,this._value,0,t.length,this._from,this._to):ds(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}},Ru=class{constructor(t=!0,e=!0){this._splitOnBackslash=t;this._caseSensitive=e}_value;_valueLen;_from;_to;reset(t){this._from=0,this._to=0,this._value=t,this._valueLen=t.length;for(let e=t.length-1;e>=0;e--,this._valueLen--){let n=this._value.charCodeAt(e);if(!(n===47||this._splitOnBackslash&&n===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let t=!0;for(;this._to<this._valueLen;this._to++){let e=this._value.charCodeAt(this._to);if(e===47||this._splitOnBackslash&&e===92)if(t)this._from++;else break;else t=!1}return this}cmp(t){return this._caseSensitive?Wd(t,this._value,0,t.length,this._from,this._to):ds(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}};var nm=class{constructor(t,e){this._ignorePathCasing=t;this._ignoreQueryAndFragment=e}_pathIterator;_value;_states=[];_stateIdx=0;reset(t){return this._value=t,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new Ru(!1,!this._ignorePathCasing(t)),this._pathIterator.reset(t.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(t)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(t){if(this._states[this._stateIdx]===1)return Ll(t,this._value.scheme);if(this._states[this._stateIdx]===2)return Ll(t,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(t);if(this._states[this._stateIdx]===4)return vo(t,this._value.query);if(this._states[this._stateIdx]===5)return vo(t,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}},Ts=class{height=1;segment;value;key;left;mid;right;isEmpty(){return!this.left&&!this.mid&&!this.right&&!this.value}rotateLeft(){let t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){let t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}};var An=class r{static forUris(t=()=>!1,e=()=>!1){return new r(new nm(t,e))}static forPaths(t=!1){return new r(new Ru(void 0,!t))}static forStrings(){return new r(new em)}static forConfigKeys(){return new r(new tm)}_iter;_root;constructor(t){this._iter=t}clear(){this._root=void 0}fill(t,e){if(e){let n=e.slice(0);rg(n);for(let i of n)this.set(i,t)}else{let n=t.slice(0);rg(n);for(let i of n)this.set(i[0],i[1])}}set(t,e){let n=this._iter.reset(t),i;this._root||(this._root=new Ts,this._root.segment=n.value());let o=[];for(i=this._root;;){let a=n.cmp(i.segment);if(a>0)i.left||(i.left=new Ts,i.left.segment=n.value()),o.push([-1,i]),i=i.left;else if(a<0)i.right||(i.right=new Ts,i.right.segment=n.value()),o.push([1,i]),i=i.right;else if(n.hasNext())n.next(),i.mid||(i.mid=new Ts,i.mid.segment=n.value()),o.push([0,i]),i=i.mid;else break}let s=i.value;i.value=e,i.key=t;for(let a=o.length-1;a>=0;a--){let l=o[a][1];l.updateHeight();let c=l.balanceFactor();if(c<-1||c>1){let d=o[a][0],u=o[a+1][0];if(d===1&&u===1)o[a][1]=l.rotateLeft();else if(d===-1&&u===-1)o[a][1]=l.rotateRight();else if(d===1&&u===-1)l.right=o[a+1][1]=o[a+1][1].rotateRight(),o[a][1]=l.rotateLeft();else if(d===-1&&u===1)l.left=o[a+1][1]=o[a+1][1].rotateLeft(),o[a][1]=l.rotateRight();else throw new Error;if(a>0)switch(o[a-1][0]){case-1:o[a-1][1].left=o[a][1];break;case 1:o[a-1][1].right=o[a][1];break;case 0:o[a-1][1].mid=o[a][1];break}else this._root=o[0][1]}}return s}get(t){return this._getNode(t)?.value}_getNode(t){let e=this._iter.reset(t),n=this._root;for(;n;){let i=e.cmp(n.segment);if(i>0)n=n.left;else if(i<0)n=n.right;else if(e.hasNext())e.next(),n=n.mid;else break}return n}has(t){let e=this._getNode(t);return!(e?.value===void 0&&e?.mid===void 0)}delete(t){return this._delete(t,!1)}deleteSuperstr(t){return this._delete(t,!0)}_delete(t,e){let n=this._iter.reset(t),i=[],o=this._root;for(;o;){let s=n.cmp(o.segment);if(s>0)i.push([-1,o]),o=o.left;else if(s<0)i.push([1,o]),o=o.right;else if(n.hasNext())n.next(),i.push([0,o]),o=o.mid;else break}if(o){if(e?(o.left=void 0,o.mid=void 0,o.right=void 0,o.height=1):(o.key=void 0,o.value=void 0),!o.mid&&!o.value)if(o.left&&o.right){let s=this._min(o.right);if(s.key){let{key:a,value:l,segment:c}=s;this._delete(s.key,!1),o.key=a,o.value=l,o.segment=c}}else{let s=o.left??o.right;if(i.length>0){let[a,l]=i[i.length-1];switch(a){case-1:l.left=s;break;case 0:l.mid=s;break;case 1:l.right=s;break}}else this._root=s}for(let s=i.length-1;s>=0;s--){let a=i[s][1];a.updateHeight();let l=a.balanceFactor();if(l>1?(a.right.balanceFactor()>=0||(a.right=a.right.rotateRight()),i[s][1]=a.rotateLeft()):l<-1&&(a.left.balanceFactor()<=0||(a.left=a.left.rotateLeft()),i[s][1]=a.rotateRight()),s>0)switch(i[s-1][0]){case-1:i[s-1][1].left=i[s][1];break;case 1:i[s-1][1].right=i[s][1];break;case 0:i[s-1][1].mid=i[s][1];break}else this._root=i[0][1]}}}_min(t){for(;t.left;)t=t.left;return t}findSubstr(t){let e=this._iter.reset(t),n=this._root,i;for(;n;){let o=e.cmp(n.segment);if(o>0)n=n.left;else if(o<0)n=n.right;else if(e.hasNext())e.next(),i=n.value||i,n=n.mid;else break}return n&&n.value||i}findSuperstr(t){return this._findSuperstrOrElement(t,!1)}_findSuperstrOrElement(t,e){let n=this._iter.reset(t),i=this._root;for(;i;){let o=n.cmp(i.segment);if(o>0)i=i.left;else if(o<0)i=i.right;else if(n.hasNext())n.next(),i=i.mid;else return i.mid?this._entries(i.mid):e?i.value:void 0}}hasElementOrSubtree(t){return this._findSuperstrOrElement(t,!0)!==void 0}forEach(t){for(let[e,n]of this)t(n,e)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(t){let e=[];return this._dfsEntries(t,e),e[Symbol.iterator]()}_dfsEntries(t,e){t&&(t.left&&this._dfsEntries(t.left,e),t.value&&e.push([t.key,t.value]),t.mid&&this._dfsEntries(t.mid,e),t.right&&this._dfsEntries(t.right,e))}_isBalanced(){let t=e=>{if(!e)return!0;let n=e.balanceFactor();return n<-1||n>1?!1:t(e.left)&&t(e.right)};return t(this._root)}};var G=M("fileService");function _s(r){return r.create===!0}function On(r){return!!(r.capabilities&2)}function ac(r){return!!(r.capabilities&8)}function Du(r){return!!(r.capabilities&131072)}function Yr(r){return!!(r.capabilities&4)}function _u(r){return!!(r.capabilities&16)}function ku(r){return On(r)?!!(r.capabilities&16384):!1}function rm(r){return On(r)?!!(r.capabilities&32768):!1}function cb(r){return!!(r.capabilities&65536)}var Rs=class r extends Error{constructor(e,n){super(e);this.code=n}static create(e,n){let i=new r(e.toString(),n);return EP(i,n),i}};function Mn(r,t){return Rs.create(r,t)}function Zr(r){return r||Mn(g("unknownError","Unknown Error"),"Unknown")}function EP(r,t){return r.name=t?`${t} (FileSystemError)`:"FileSystemError",r}function lc(r){if(!r)return"Unknown";if(r instanceof Rs)return r.code;let t=/^(.+) \(FileSystemError\)$/.exec(r.name);if(!t)return"Unknown";switch(t[1]){case"EntryExists":return"EntryExists";case"EntryIsADirectory":return"EntryIsADirectory";case"EntryNotADirectory":return"EntryNotADirectory";case"EntryNotFound":return"EntryNotFound";case"EntryTooLarge":return"EntryTooLarge";case"EntryWriteLocked":return"EntryWriteLocked";case"NoPermissions":return"NoPermissions";case"Unavailable":return"Unavailable"}return"Unknown"}function rt(r){if(r instanceof ot)return r.fileOperationResult;switch(lc(r)){case"EntryNotFound":return 1;case"EntryIsADirectory":return 0;case"EntryNotADirectory":return 9;case"EntryWriteLocked":return 5;case"NoPermissions":return 6;case"EntryExists":return 4;case"EntryTooLarge":return 7;default:return 10}}var Xr=class{constructor(t,e,n){this.resource=t;this.operation=e;this.target=n}isOperation(t){return this.operation===t}};var Cu=class r{constructor(t,e){this.ignorePathCasing=e;for(let n of t){switch(n.type){case 1:this.rawAdded.push(n.resource);break;case 0:this.rawUpdated.push(n.resource);break;case 2:this.rawDeleted.push(n.resource);break}this.correlationId!==r.MIXED_CORRELATION&&(typeof n.cId=="number"?this.correlationId===void 0?this.correlationId=n.cId:this.correlationId!==n.cId&&(this.correlationId=r.MIXED_CORRELATION):this.correlationId!==void 0&&(this.correlationId=r.MIXED_CORRELATION))}}static MIXED_CORRELATION=null;correlationId=void 0;added=new on(()=>{let t=An.forUris(()=>this.ignorePathCasing);return t.fill(this.rawAdded.map(e=>[e,!0])),t});updated=new on(()=>{let t=An.forUris(()=>this.ignorePathCasing);return t.fill(this.rawUpdated.map(e=>[e,!0])),t});deleted=new on(()=>{let t=An.forUris(()=>this.ignorePathCasing);return t.fill(this.rawDeleted.map(e=>[e,!0])),t});contains(t,...e){return this.doContains(t,{includeChildren:!1},...e)}affects(t,...e){return this.doContains(t,{includeChildren:!0},...e)}doContains(t,e,...n){if(!t)return!1;let i=n.length>0;return!!((!i||n.includes(1))&&(this.added.value.get(t)||e.includeChildren&&this.added.value.findSuperstr(t))||(!i||n.includes(0))&&(this.updated.value.get(t)||e.includeChildren&&this.updated.value.findSuperstr(t))||(!i||n.includes(2))&&(this.deleted.value.findSubstr(t)||e.includeChildren&&this.deleted.value.findSuperstr(t)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(t){return this.correlationId===t}hasCorrelation(){return typeof this.correlationId=="number"}rawAdded=[];rawUpdated=[];rawDeleted=[]};function db(r,t,e){return!r||!t||r===t||t.length>r.length?!1:(t.charAt(t.length-1)!==wt&&(t+=wt),e?bi(r,t):r.indexOf(t)===0)}var ot=class extends Error{constructor(e,n,i){super(e);this.fileOperationResult=n;this.options=i}},Cs=class extends ot{constructor(e,n,i,o){super(e,n,o);this.fileOperationResult=n;this.size=i}},Ds=class extends ot{constructor(e,n,i){super(e,2,i);this.stat=n}};var Uu="";function im(r){if(!(typeof r.size!="number"||typeof r.mtime!="number"))return r.mtime.toString(29)+r.size.toString(31)}var Ui=class r{static KB=1024;static MB=r.KB*r.KB;static GB=r.MB*r.KB;static TB=r.GB*r.KB;static formatSize(t){return yo(t)||(t=0),t<r.KB?g("sizeB","{0}B",t.toFixed(0)):t<r.MB?g("sizeKB","{0}KB",(t/r.KB).toFixed(2)):t<r.GB?g("sizeMB","{0}MB",(t/r.MB).toFixed(2)):t<r.TB?g("sizeGB","{0}GB",(t/r.GB).toFixed(2)):g("sizeTB","{0}TB",(t/r.TB).toFixed(2))}};function Ht(r){if(!r||typeof r!="object"||r instanceof RegExp)return r;let t=Array.isArray(r)?[]:{};return Object.entries(r).forEach(([e,n])=>{t[e]=n&&typeof n=="object"?Ht(n):n}),t}function ub(r){if(!r||typeof r!="object")return r;let t=[r];for(;t.length>0;){let e=t.shift();Object.freeze(e);for(let n in e)if(fb.call(e,n)){let i=e[n];typeof i=="object"&&!Object.isFrozen(i)&&!PI(i)&&t.push(i)}}return r}var fb=Object.prototype.hasOwnProperty;function Lu(r,t){return om(r,t,new Set)}function om(r,t,e){if(ct(r))return r;let n=t(r);if(typeof n<"u")return n;if(Array.isArray(r)){let i=[];for(let o of r)i.push(om(o,t,e));return i}if(He(r)){if(e.has(r))throw new Error("Cannot clone recursive data-structure");e.add(r);let i={};for(let o in r)fb.call(r,o)&&(i[o]=om(r[o],t,e));return e.delete(r),i}return r}function ks(r,t,e=!0){return He(r)?(He(t)&&Object.keys(t).forEach(n=>{n in r?e&&(He(r[n])&&He(t[n])?ks(r[n],t[n],e):r[n]=t[n]):r[n]=t[n]}),r):t}function dt(r,t){if(r===t)return!0;if(r==null||t===null||t===void 0||typeof r!=typeof t||typeof r!="object"||Array.isArray(r)!==Array.isArray(t))return!1;let e,n;if(Array.isArray(r)){if(r.length!==t.length)return!1;for(e=0;e<r.length;e++)if(!dt(r[e],t[e]))return!1}else{let i=[];for(n in r)i.push(n);i.sort();let o=[];for(n in t)o.push(n);if(o.sort(),!dt(i,o))return!1;for(e=0;e<i.length;e++)if(!dt(r[i[e]],t[i[e]]))return!1}return!0}function sm(r){let t=new Set;return JSON.stringify(r,(e,n)=>{if(He(n)||Array.isArray(n)){if(t.has(n))return"[Circular]";t.add(n)}return typeof n=="bigint"?`[BigInt ${n.toString()}]`:n})}var f8=M("contextService");function Fu(r){let t=r;return typeof t?.id=="string"&&C.isUri(t.uri)}var pb={id:"ext-dev"};function Au(r){let t=r;return typeof t?.id=="string"&&C.isUri(t.configPath)}var hb="code-workspace",p8=`.${hb}`,h8=[{name:g("codeWorkspace","Code Workspace"),extensions:[hb]}];var ue=M("configurationService");function Ou(r){return r&&typeof r=="object"&&(!r.overrideIdentifier||typeof r.overrideIdentifier=="string")&&(!r.resource||r.resource instanceof C)}function gb(r){return r&&typeof r=="object"&&(!r.overrideIdentifiers||Array.isArray(r.overrideIdentifiers))&&!r.overrideIdentifier&&(!r.resource||r.resource instanceof C)}function Mu(r,t){let e=Object.create(null);for(let n in r)am(e,n,r[n],t);return e}function am(r,t,e,n){let i=t.split("."),o=i.pop(),s=r;for(let a=0;a<i.length;a++){let l=i[a],c=s[l];switch(typeof c){case"undefined":c=s[l]=Object.create(null);break;case"object":if(c===null){n(`Ignoring ${t} as ${i.slice(0,a+1).join(".")} is null`);return}break;default:n(`Ignoring ${t} as ${i.slice(0,a+1).join(".")} is ${JSON.stringify(c)}`);return}s=c}if(typeof s=="object"&&s!==null)try{s[o]=e}catch{n(`Ignoring ${t} as ${i.join(".")} is ${JSON.stringify(s)}`)}else n(`Ignoring ${t} as ${i.join(".")} is ${JSON.stringify(s)}`)}function mb(r,t){let e=t.split(".");yb(r,e)}function yb(r,t){let e=t.shift();if(t.length===0){delete r[e];return}if(Object.keys(r).indexOf(e)!==-1){let n=r[e];typeof n=="object"&&!Array.isArray(n)&&(yb(n,t),Object.keys(n).length===0&&delete r[e])}}function dc(r,t,e){function n(s,a){let l=s;for(let c of a){if(typeof l!="object"||l===null)return;l=l[c]}return l}let i=t.split("."),o=n(r,i);return typeof o>"u"?e:o}function vb(r){return r.replace(/[\[\]]/g,"")}var wP=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Ib(r){return wP.test(r)}var Fe=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let r;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?r=crypto.getRandomValues.bind(crypto):r=function(n){for(let i=0;i<n.length;i++)n[i]=Math.floor(Math.random()*256);return n};let t=new Uint8Array(16),e=[];for(let n=0;n<256;n++)e.push(n.toString(16).padStart(2,"0"));return function(){r(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let i=0,o="";return o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o}}();var le=M("telemetryService"),lm=M("customEndpointTelemetryService");var cm="telemetry",Us="telemetry.telemetryLevel",Nu="telemetry.enableCrashReporter",uc="telemetry.enableTelemetry";function TP(r){if(Tr===2&&/^penguin(\.|$)/i.test(r))return"chromebook"}function Sb(r,t,e,n,i,o,s,a,l,c){let d=Object.create(null);d["common.machineId"]=o,d["common.sqmId"]=s,d["common.devDeviceId"]=a,d.sessionID=Fe()+Date.now(),d.commitHash=n,d.version=i,d["common.platformVersion"]=(r||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),d["common.platform"]=pd(Tr),d["common.nodePlatform"]=yd,d["common.nodeArch"]=e,d["common.product"]=c||"desktop",l&&(d["common.msftInternal"]=l);let u=0,f=Date.now();Object.defineProperties(d,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-f,enumerable:!0},"common.sequence":{get:()=>u++,enumerable:!0}}),$v&&(d["common.snap"]="true");let h=TP(t);return h&&(d["common.platformDetail"]=h),d}function bb(r){let t=Me.USERDNSDOMAIN;if(!t)return!1;let e=t.toLowerCase();return r.some(n=>e===n)}var Ls=class{constructor(t){this.value=t}isTrustedTelemetryValue=!0},dm=class{telemetryLevel=0;sessionId="someValue.sessionId";machineId="someValue.machineId";sqmId="someValue.sqmId";devDeviceId="someValue.devDeviceId";firstSessionDate="someValue.firstSessionDate";sendErrorTelemetry=!1;publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},Eb=new dm;var Bu="telemetry";var wb={log:()=>null,flush:()=>Promise.resolve(null)};function Fs(r,t){return!t.isBuilt&&!t.disableTelemetry?!0:!(t.disableTelemetry||!r.enableTelemetry)}function Wu(r,t){return t.extensionTestsLocationURI?!0:!(t.isBuilt||t.disableTelemetry||r.enableTelemetry&&r.aiConfig?.ariaKey)}function Vu(r){let t=r.getValue(Us),e=r.getValue(Nu);if(r.getValue(uc)===!1||e===!1)return 0;switch(t??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}function Ku(r){let t={},e={},n={};Pb(r,n);for(let i in n){i=i.length>150?i.substr(i.length-149):i;let o=n[i];typeof o=="number"?e[i]=o:typeof o=="boolean"?e[i]=o?1:0:typeof o=="string"?(o.length>8192&&console.warn(`Telemetry property: ${i} has been trimmed to 8192, the original length is ${o.length}`),t[i]=o.substring(0,8191)):typeof o<"u"&&o!==null&&(t[i]=o)}return{properties:t,measurements:e}}function Pb(r,t,e=0,n){if(r)for(let i of Object.getOwnPropertyNames(r)){let o=r[i],s=n?n+i:i;Array.isArray(o)?t[s]=sm(o):o instanceof Date?t[s]=o.toISOString():He(o)?e<2?Pb(o,t,e+1,s+"."):t[s]=sm(o):t[s]=o}}function Tb(r,t){let e=r.msftInternalDomains||[],n=t.getValue("telemetry.internalTesting");return bb(e)||n}function Rb(r){return[r.appRoot,r.extensionsPath,r.userHome.fsPath,r.tmpDir.fsPath,r.userDataPath]}function CP(r,t){if(!r||!r.includes("/")&&!r.includes("\\"))return r;let e=r,n=[];for(let a of t)for(;;){let l=a.exec(r);if(!l)break;n.push([l.index,a.lastIndex])}let i=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,o=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g,s=0;for(e="";;){let a=o.exec(r);if(!a)break;let l=n.some(([c,d])=>a.index<d&&c<o.lastIndex);!i.test(a[0])&&!l&&(e+=r.substring(s,a.index)+"<REDACTED: user-file-path>",s=o.lastIndex)}return s<r.length&&(e+=r.substr(s)),e}function DP(r){if(!r)return r;let t=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Email",regex:/@[a-zA-Z0-9-]+\.[a-zA-Z0-9-]+/}];for(let e of t)if(e.regex.test(r))return`<REDACTED: ${e.label}>`;return r}function Cb(r,t){return Lu(r,e=>{if(e instanceof Ls||Object.hasOwnProperty.call(e,"isTrustedTelemetryValue"))return e.value;if(typeof e=="string"){let n=e.replaceAll("%20"," ");n=CP(n,t);for(let i of t)n=n.replace(i,"");return n=DP(n),n}})}function Y(r,t){return r.uuid&&t.uuid?r.uuid===t.uuid:r.id===t.id?!0:Ll(r.id,t.id)===0}var _P=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/,Lt=class r{constructor(t,e,n="undefined"){this.identifier=t;this.version=e;this.targetPlatform=n;this.id=t.id}static create(t){let e=t.manifest?t.manifest.version:t.version,n=t.manifest?t.targetPlatform:t.properties.targetPlatform;return new r(t.identifier,e,n)}static parse(t){let e=_P.exec(t);return e&&e[1]&&e[2]?new r({id:e[1]},e[2],e[4]||void 0):null}id;toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(t){return t instanceof r?Y(this,t)&&this.version===t.version&&this.targetPlatform===t.targetPlatform:!1}},kP=/^([^.]+\..+)@((prerelease)|(\d+\.\d+\.\d+(-.*)?))$/;function Db(r){let t=kP.exec(r);return t&&t[1]?[To(t[1]),t[2]]:[To(r),void 0]}function Ro(r,t){return`${r}.${t}`}function To(r){return r.toLowerCase()}function Hn(r,t){return To(Ro(r??xu,t))}function $u(r,t){let e=[],n=i=>{for(let o of e)if(o.some(s=>Y(t(s),t(i))))return o;return null};for(let i of r){let o=n(i);o?o.push(i):e.push([i])}return e}function _b(r){return{id:r.identifier.id,name:r.manifest.name,galleryId:null,publisherId:r.publisherId,publisherName:r.manifest.publisher,publisherDisplayName:r.publisherDisplayName,dependencies:r.manifest.extensionDependencies&&r.manifest.extensionDependencies.length>0}}function fc(r){return{id:new Ls(r.identifier.id),name:new Ls(r.name),version:r.version,galleryId:r.identifier.uuid,publisherId:r.publisherId,publisherName:r.publisher,publisherDisplayName:r.publisherDisplayName,isPreReleaseVersion:r.properties.isPreReleaseVersion,dependencies:!!(r.properties.dependencies&&r.properties.dependencies.length>0),isSigned:r.isSigned,...r.telemetryData}}var f6=new mr("pprice.better-merge");async function UP(r,t){if(!Oe)return!1;let e;try{e=(await r.readFile(C.file("/etc/os-release"))).value.toString()}catch{try{e=(await r.readFile(C.file("/usr/lib/os-release"))).value.toString()}catch(i){t.debug("Error while getting the os-release file.",me(i))}}return!!e&&(e.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}async function zu(r,t){let e=await UP(r,t),n=Eu(e?"alpine":Tr,vd);return t.debug("ComputeTargetPlatform:",n),n}var As=class extends ws{constructor(e,n,i,o){super(i);this.extensionManagementService=e;this.logService=o;this.cache=this._register(new pc(n,o)),this.extensionManagementService.registerParticipant({postInstall:async s=>this.postInstallExtension(s),postUninstall:async s=>this.postUninstallExtension(s)})}cache;async getBuiltInExtensionTranslationsUri(e,n){let o=(await this.cache.getLanguagePacks())[n];if(!o){this.logService.warn(`No language pack found for ${n}`);return}let s=o.translations[e];return s?C.file(s):void 0}async getInstalledLanguages(){let e=await this.cache.getLanguagePacks(),n=Object.keys(e).map(i=>{let o=e[i];return{...this.createQuickPickItem(i,o.label),extensionId:o.extensions[0].extensionIdentifier.id}});return n.push(this.createQuickPickItem("en","English")),n.sort((i,o)=>i.label.localeCompare(o.label)),n}async postInstallExtension(e){e&&e.manifest&&e.manifest.contributes&&e.manifest.contributes.localizations&&e.manifest.contributes.localizations.length&&(this.logService.info("Adding language packs from the extension",e.identifier.id),await this.update())}async postUninstallExtension(e){let n=await this.cache.getLanguagePacks();Object.keys(n).some(i=>n[i]&&n[i].extensions.some(o=>Y(o.extensionIdentifier,e.identifier)))&&(this.logService.info("Removing language packs from the extension",e.identifier.id),await this.update())}async update(){let[e,n]=await Promise.all([this.cache.getLanguagePacks(),this.extensionManagementService.getInstalled()]),i=await this.cache.update(n);return!Pt(Object.keys(e),Object.keys(i))}};As=E([m(0,an),m(1,St),m(2,Bt),m(3,z)],As);var pc=class extends _{constructor(e,n){super();this.logService=n;this.languagePacksFilePath=W(e.userDataPath,"languagepacks.json"),this.languagePacksFileLimiter=new fr}languagePacks={};languagePacksFilePath;languagePacksFileLimiter;initializedCache;getLanguagePacks(){return this.languagePacksFileLimiter.size||!this.initializedCache?this.withLanguagePacks().then(()=>this.languagePacks):Promise.resolve(this.languagePacks)}update(e){return this.withLanguagePacks(n=>{Object.keys(n).forEach(i=>delete n[i]),this.createLanguagePacksFromExtensions(n,...e)}).then(()=>this.languagePacks)}createLanguagePacksFromExtensions(e,...n){for(let i of n)i&&i.manifest&&i.manifest.contributes&&i.manifest.contributes.localizations&&i.manifest.contributes.localizations.length&&this.createLanguagePacksFromExtension(e,i);Object.keys(e).forEach(i=>this.updateHash(e[i]))}createLanguagePacksFromExtension(e,n){let i=n.identifier,o=n.manifest.contributes&&n.manifest.contributes.localizations?n.manifest.contributes.localizations:[];for(let s of o)if(n.location.scheme===ne.file&&FP(s)){let a=e[s.languageId];a||(a={hash:"",extensions:[],translations:{},label:s.localizedLanguageName??s.languageName},e[s.languageId]=a);let l=a.extensions.filter(c=>Y(c.extensionIdentifier,i))[0];l?l.version=n.manifest.version:a.extensions.push({extensionIdentifier:i,version:n.manifest.version});for(let c of s.translations)a.translations[c.id]=W(n.location.fsPath,c.path)}}updateHash(e){if(e){let n=LP("md5");for(let i of e.extensions)n.update(i.extensionIdentifier.uuid||i.extensionIdentifier.id).update(i.version);e.hash=n.digest("hex")}}withLanguagePacks(e=()=>null){return this.languagePacksFileLimiter.queue(()=>{let n=null;return kb.promises.readFile(this.languagePacksFilePath,"utf8").then(void 0,i=>i.code==="ENOENT"?Promise.resolve("{}"):Promise.reject(i)).then(i=>{try{return JSON.parse(i)}catch{return{}}}).then(i=>(n=e(i),i)).then(i=>{for(let s of Object.keys(i))i[s]||delete i[s];this.languagePacks=i,this.initializedCache=!0;let o=JSON.stringify(this.languagePacks);return this.logService.debug("Writing language packs",o),ce.writeFile(this.languagePacksFilePath,o)}).then(()=>n,i=>this.logService.error(i))})}};pc=E([m(0,St),m(1,z)],pc);function FP(r){if(typeof r.languageId!="string"||!Array.isArray(r.translations)||r.translations.length===0)return!1;for(let t of r.translations)if(typeof t.id!="string"||typeof t.path!="string")return!1;return!(r.languageName&&typeof r.languageName!="string"||r.localizedLanguageName&&typeof r.localizedLanguageName!="string")}var Os=class extends _{constructor(e){super();this.localizationsService=e;this.updateLocalizations()}updateLocalizations(){this.localizationsService.update()}};Os=E([m(0,sc)],Os);var Ms=class extends _{constructor(e,n){super();this.environmentService=e;this.logService=n;this._register(new mt(()=>{this.cleanUpOldLogs()},10*1e3)).schedule()}async cleanUpOldLogs(){this.logService.trace("[logs cleanup]: Starting to clean up old logs.");try{let e=_r(this.environmentService.logsHome),n=Kd(this.environmentService.logsHome.with({scheme:ne.file})).fsPath,s=(await ce.readdir(n)).filter(l=>/^\d{8}T\d{6}$/.test(l)).sort().filter(l=>l!==e),a=s.slice(0,Math.max(0,s.length-9));a.length>0&&(this.logService.trace(`[logs cleanup]: Removing log folders '${a.join(", ")}'`),await Promise.all(a.map(l=>ce.rm(W(n,l)))))}catch(e){ze(e)}}};Ms=E([m(0,oe),m(1,z)],Ms);var ei=class r extends _{constructor(e,n=Object.create(null)){super();this.database=e;this.options=n;this.registerListeners()}static DEFAULT_FLUSH_DELAY=100;_onDidChangeStorage=this._register(new Ii);onDidChangeStorage=this._onDidChangeStorage.event;state=0;cache=new Map;flushDelayer=this._register(new hn(r.DEFAULT_FLUSH_DELAY));pendingDeletes=new Set;pendingInserts=new Map;pendingClose=void 0;whenFlushedCallbacks=[];registerListeners(){this._register(this.database.onDidChangeItemsExternal(e=>this.onDidChangeItemsExternal(e)))}onDidChangeItemsExternal(e){this._onDidChangeStorage.pause();try{e.changed?.forEach((n,i)=>this.acceptExternal(i,n)),e.deleted?.forEach(n=>this.acceptExternal(n,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(e,n){if(this.state===2)return;let i=!1;ct(n)?i=this.cache.delete(e):this.cache.get(e)!==n&&(this.cache.set(e,n),i=!0),i&&this._onDidChangeStorage.fire({key:e,external:!0})}get items(){return this.cache}get size(){return this.cache.size}async init(){this.state===0&&(this.state=1,this.options.hint!==0&&(this.cache=await this.database.getItems()))}get(e,n){let i=this.cache.get(e);return ct(i)?n:i}getBoolean(e,n){let i=this.get(e);return ct(i)?n:i==="true"}getNumber(e,n){let i=this.get(e);return ct(i)?n:parseInt(i,10)}getObject(e,n){let i=this.get(e);return ct(i)?n:dS(i)}async set(e,n,i=!1){if(this.state===2)return;if(ct(n))return this.delete(e,i);let o=He(n)||Array.isArray(n)?cS(n):String(n);if(this.cache.get(e)!==o)return this.cache.set(e,o),this.pendingInserts.set(e,o),this.pendingDeletes.delete(e),this._onDidChangeStorage.fire({key:e,external:i}),this.doFlush()}async delete(e,n=!1){if(!(this.state===2||!this.cache.delete(e)))return this.pendingDeletes.has(e)||this.pendingDeletes.add(e),this.pendingInserts.delete(e),this._onDidChangeStorage.fire({key:e,external:n}),this.doFlush()}async optimize(){if(this.state!==2)return await this.flush(0),this.database.optimize()}async close(){return this.pendingClose||(this.pendingClose=this.doClose()),this.pendingClose}async doClose(){this.state=2;try{await this.doFlush(0)}catch{}await this.database.close(()=>this.cache)}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;let e={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(e).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async flush(e){if(!(this.state===2||this.pendingClose))return this.doFlush(e)}async doFlush(e){return this.options.hint===1?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),e)}async whenFlushed(){if(this.hasPending)return new Promise(e=>this.whenFlushedCallbacks.push(e))}isInMemory(){return this.options.hint===1}};var he=M("IUriIdentityService");function ju(r){let t=r;return!!(t&&typeof t=="object"&&typeof t.id=="string"&&typeof t.isDefault=="boolean"&&typeof t.name=="string"&&C.isUri(t.location)&&C.isUri(t.globalStorageHome)&&C.isUri(t.settingsResource)&&C.isUri(t.keybindingsResource)&&C.isUri(t.tasksResource)&&C.isUri(t.snippetsHome)&&C.isUri(t.extensionsResource))}var ge=M("IUserDataProfilesService");function ln(r,t){return{id:r.id,isDefault:r.isDefault,name:r.name,shortName:r.shortName,icon:r.icon,location:C.revive(r.location).with({scheme:t}),globalStorageHome:C.revive(r.globalStorageHome).with({scheme:t}),settingsResource:C.revive(r.settingsResource).with({scheme:t}),keybindingsResource:C.revive(r.keybindingsResource).with({scheme:t}),tasksResource:C.revive(r.tasksResource).with({scheme:t}),snippetsHome:C.revive(r.snippetsHome).with({scheme:t}),extensionsResource:C.revive(r.extensionsResource).with({scheme:t}),cacheHome:C.revive(r.cacheHome).with({scheme:t}),useDefaultFlags:r.useDefaultFlags,isTransient:r.isTransient}}function qu(r,t,e,n,i,o){return{id:r,name:t,location:e,isDefault:!1,shortName:i?.shortName,icon:i?.icon,globalStorageHome:o&&i?.useDefaultFlags?.globalState?o.globalStorageHome:V(e,"globalStorage"),settingsResource:o&&i?.useDefaultFlags?.settings?o.settingsResource:V(e,"settings.json"),keybindingsResource:o&&i?.useDefaultFlags?.keybindings?o.keybindingsResource:V(e,"keybindings.json"),tasksResource:o&&i?.useDefaultFlags?.tasks?o.tasksResource:V(e,"tasks.json"),snippetsHome:o&&i?.useDefaultFlags?.snippets?o.snippetsHome:V(e,"snippets"),extensionsResource:o&&i?.useDefaultFlags?.extensions?o.extensionsResource:V(e,"extensions.json"),cacheHome:V(n,r),useDefaultFlags:i?.useDefaultFlags,isTransient:i?.transient}}var Hu=class extends _{constructor(e,n,i,o){super();this.environmentService=e;this.fileService=n;this.uriIdentityService=i;this.logService=o;this.profilesHome=V(this.environmentService.userRoamingDataHome,"profiles"),this.profilesCacheHome=V(this.environmentService.cacheHome,"CachedProfilesData")}static PROFILES_KEY="userDataProfiles";static PROFILE_ASSOCIATIONS_KEY="profileAssociations";_serviceBrand;enabled=!0;profilesHome;profilesCacheHome;get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.profilesObject.profiles,...this.transientProfilesObject.profiles]}_onDidChangeProfiles=this._register(new P);onDidChangeProfiles=this._onDidChangeProfiles.event;_onWillCreateProfile=this._register(new P);onWillCreateProfile=this._onWillCreateProfile.event;_onWillRemoveProfile=this._register(new P);onWillRemoveProfile=this._onWillRemoveProfile.event;_onDidResetWorkspaces=this._register(new P);onDidResetWorkspaces=this._onDidResetWorkspaces.event;profileCreationPromises=new Map;transientProfilesObject={profiles:[],folders:new Ye,workspaces:new Ye,emptyWindows:new Map};init(){this._profilesObject=void 0}setEnablement(e){this.enabled!==e&&(this._profilesObject=void 0,this.enabled=e)}isEnabled(){return this.enabled}_profilesObject;get profilesObject(){if(!this._profilesObject){let e=this.createDefaultProfile(),n=[e];if(this.enabled)try{for(let s of this.getStoredProfiles()){if(!s.name||!De(s.name)||!s.location){this.logService.warn("Skipping the invalid stored profile",s.location||s.name);continue}n.push(qu(_r(s.location),s.name,s.location,this.profilesCacheHome,{shortName:s.shortName,icon:s.icon,useDefaultFlags:s.useDefaultFlags},e))}}catch(s){this.logService.error(s)}let i=new Ye,o=new Map;if(n.length)try{let s=this.getStoredProfileAssociations();if(s.workspaces)for(let[a,l]of Object.entries(s.workspaces)){let c=C.parse(a),d=n.find(u=>u.id===l);d&&i.set(c,d)}if(s.emptyWindows)for(let[a,l]of Object.entries(s.emptyWindows)){let c=n.find(d=>d.id===l);c&&o.set(a,c)}}catch(s){this.logService.error(s)}this._profilesObject={profiles:n,workspaces:i,emptyWindows:o}}return this._profilesObject}createDefaultProfile(){let e=qu("__default__profile__",g("defaultProfile","Default"),this.environmentService.userRoamingDataHome,this.profilesCacheHome);return{...e,extensionsResource:this.getDefaultProfileExtensionsLocation()??e.extensionsResource,isDefault:!0}}async createTransientProfile(e){let n="Temp",i=new RegExp(`${ur(n)}\\s(\\d+)`),o=0;for(let a of this.profiles){let l=i.exec(a.name),c=l?parseInt(l[1]):0;o=c>o?c:o}let s=`${n} ${o+1}`;return this.createProfile(Ur(Fe()).toString(16),s,{transient:!0},e)}async createNamedProfile(e,n,i){return this.createProfile(Ur(Fe()).toString(16),e,n,i)}async createProfile(e,n,i,o){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let s=await this.doCreateProfile(e,n,i);return o&&await this.setProfileForWorkspace(o,s),s}async doCreateProfile(e,n,i){if(!De(n)||!n)throw new Error("Name of the profile is mandatory and must be of type `string`");let o=this.profileCreationPromises.get(n);return o||(o=(async()=>{try{if(this.profiles.find(c=>c.name===n||c.id===e))throw new Error(`Profile with ${n} name already exists`);let a=qu(e,n,V(this.profilesHome,e),this.profilesCacheHome,i,this.defaultProfile);await this.fileService.createFolder(a.location);let l=[];return this._onWillCreateProfile.fire({profile:a,join(c){l.push(c)}}),await Qe.settled(l),this.updateProfiles([a],[],[]),a}finally{this.profileCreationPromises.delete(n)}})(),this.profileCreationPromises.set(n,o)),o}async updateProfile(e,n){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===e.id);if(!i)throw new Error(`Profile '${e.name}' does not exist`);return i=qu(i.id,n.name??i.name,i.location,this.profilesCacheHome,{shortName:n.shortName??i.shortName,icon:n.icon===null?void 0:n.icon??i.icon,transient:n.transient??i.isTransient,useDefaultFlags:n.useDefaultFlags??i.useDefaultFlags},this.defaultProfile),this.updateProfiles([],[],[i]),i}async removeProfile(e){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");if(e.isDefault)throw new Error("Cannot remove default profile");let n=this.profiles.find(o=>o.id===e.id);if(!n)throw new Error(`Profile '${e.name}' does not exist`);let i=[];this._onWillRemoveProfile.fire({profile:n,join(o){i.push(o)}});try{await Promise.allSettled(i)}catch(o){this.logService.error(o)}for(let o of[...this.profilesObject.emptyWindows.keys()])n.id===this.profilesObject.emptyWindows.get(o)?.id&&this.profilesObject.emptyWindows.delete(o);for(let o of[...this.profilesObject.workspaces.keys()])n.id===this.profilesObject.workspaces.get(o)?.id&&this.profilesObject.workspaces.delete(o);this.updateStoredProfileAssociations(),this.updateProfiles([],[n],[]);try{await this.fileService.del(n.cacheHome,{recursive:!0})}catch(o){rt(o)!==1&&this.logService.error(o)}}async setProfileForWorkspace(e,n){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===n.id);if(!i)throw new Error(`Profile '${n.name}' does not exist`);this.updateWorkspaceAssociation(e,i)}unsetWorkspace(e,n){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");this.updateWorkspaceAssociation(e,void 0,n)}async resetWorkspaces(){this.transientProfilesObject.folders.clear(),this.transientProfilesObject.workspaces.clear(),this.transientProfilesObject.emptyWindows.clear(),this.profilesObject.workspaces.clear(),this.profilesObject.emptyWindows.clear(),this.updateStoredProfileAssociations(),this._onDidResetWorkspaces.fire()}async cleanUp(){if(this.enabled&&await this.fileService.exists(this.profilesHome)){let e=await this.fileService.resolve(this.profilesHome);await Promise.all((e.children||[]).filter(n=>n.isDirectory&&this.profiles.every(i=>!this.uriIdentityService.extUri.isEqual(i.location,n.resource))).map(n=>this.fileService.del(n.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){if(!this.enabled)return;let e=this.transientProfilesObject.profiles.filter(n=>!this.isProfileAssociatedToWorkspace(n));await Promise.allSettled(e.map(n=>this.removeProfile(n)))}getProfileForWorkspace(e){let n=this.getWorkspace(e),i=C.isUri(n)?this.profilesObject.workspaces.get(n):this.profilesObject.emptyWindows.get(n);return i||(Fu(e)?this.transientProfilesObject.folders.get(e.uri):Au(e)?this.transientProfilesObject.workspaces.get(e.configPath):this.transientProfilesObject.emptyWindows.get(e.id))}getWorkspace(e){return Fu(e)?e.uri:Au(e)?e.configPath:e.id}isProfileAssociatedToWorkspace(e){return!!([...this.profilesObject.emptyWindows.values()].some(n=>this.uriIdentityService.extUri.isEqual(n.location,e.location))||[...this.profilesObject.workspaces.values()].some(n=>this.uriIdentityService.extUri.isEqual(n.location,e.location))||[...this.transientProfilesObject.emptyWindows.values()].some(n=>this.uriIdentityService.extUri.isEqual(n.location,e.location))||[...this.transientProfilesObject.workspaces.values()].some(n=>this.uriIdentityService.extUri.isEqual(n.location,e.location))||[...this.transientProfilesObject.folders.values()].some(n=>this.uriIdentityService.extUri.isEqual(n.location,e.location)))}updateProfiles(e,n,i){let o=[...this.profiles,...e],s=[],a=this.transientProfilesObject.profiles;this.transientProfilesObject.profiles=[];for(let l of o){if(l.isDefault||n.some(d=>l.id===d.id))continue;l=i.find(d=>l.id===d.id)??l;let c=a.find(d=>l.id===d.id);if(l.isTransient)this.transientProfilesObject.profiles.push(l);else{if(c){for(let[d,u]of this.transientProfilesObject.emptyWindows.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:d},l);break}for(let[d,u]of this.transientProfilesObject.workspaces.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:"",configPath:d},l);break}for(let[d,u]of this.transientProfilesObject.folders.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:"",uri:d},l);break}}s.push({location:l.location,name:l.name,shortName:l.shortName,icon:l.icon,useDefaultFlags:l.useDefaultFlags})}}this.saveStoredProfiles(s),this._profilesObject=void 0,this.triggerProfilesChanges(e,n,i)}triggerProfilesChanges(e,n,i){this._onDidChangeProfiles.fire({added:e,removed:n,updated:i,all:this.profiles})}updateWorkspaceAssociation(e,n,i){if(i=n?.isTransient?!0:i,i)Fu(e)?(this.transientProfilesObject.folders.delete(e.uri),n&&this.transientProfilesObject.folders.set(e.uri,n)):Au(e)?(this.transientProfilesObject.workspaces.delete(e.configPath),n&&this.transientProfilesObject.workspaces.set(e.configPath,n)):(this.transientProfilesObject.emptyWindows.delete(e.id),n&&this.transientProfilesObject.emptyWindows.set(e.id,n));else{this.updateWorkspaceAssociation(e,void 0,!0);let o=this.getWorkspace(e);C.isUri(o)?(this.profilesObject.workspaces.delete(o),n&&this.profilesObject.workspaces.set(o,n)):(this.profilesObject.emptyWindows.delete(o),n&&this.profilesObject.emptyWindows.set(o,n)),this.updateStoredProfileAssociations()}}updateStoredProfileAssociations(){let e={};for(let[i,o]of this.profilesObject.workspaces.entries())e[i.toString()]=o.id;let n={};for(let[i,o]of this.profilesObject.emptyWindows.entries())n[i.toString()]=o.id;this.saveStoredProfileAssociations({workspaces:e,emptyWindows:n}),this._profilesObject=void 0}migrateStoredProfileAssociations(e){let n={},i=this.createDefaultProfile();if(e.workspaces)for(let[s,a]of Object.entries(e.workspaces)){let l=C.parse(a);n[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}let o={};if(e.emptyWindows)for(let[s,a]of Object.entries(e.emptyWindows)){let l=C.parse(a);o[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}return{workspaces:n,emptyWindows:o}}getStoredProfiles(){return[]}saveStoredProfiles(e){throw new Error("not implemented")}getStoredProfileAssociations(){return{}}saveStoredProfileAssociations(e){throw new Error("not implemented")}getDefaultProfileExtensionsLocation(){}};Hu=E([m(0,oe),m(1,G),m(2,he),m(3,z)],Hu);var Gu=class extends _{constructor(e,n,i){super();this.channel=e;this.profile=n;this.workspace=i}async getItems(){let e={profile:this.profile,workspace:this.workspace},n=await this.channel.call("getItems",e);return new Map(n)}updateItems(e){let n={profile:this.profile,workspace:this.workspace};return e.insert&&(n.insert=Array.from(e.insert.entries())),e.delete&&(n.delete=Array.from(e.delete.values())),this.channel.call("updateItems",n)}optimize(){let e={profile:this.profile,workspace:this.workspace};return this.channel.call("optimize",e)}},Qu=class extends Gu{_onDidChangeItemsExternal=this._register(new P);onDidChangeItemsExternal=this._onDidChangeItemsExternal.event;constructor(t,e){super(t,e,void 0),this.registerListeners()}registerListeners(){this._register(this.channel.listen("onDidChangeStorage",{profile:this.profile})(t=>this.onDidChangeStorage(t)))}onDidChangeStorage(t){(Array.isArray(t.changed)||Array.isArray(t.deleted))&&this._onDidChangeItemsExternal.fire({changed:t.changed?new Map(t.changed):void 0,deleted:t.deleted?new Set(t.deleted):void 0})}},Ns=class extends Qu{constructor(t){super(t,void 0)}async close(){this.dispose()}},Bs=class extends Qu{constructor(t,e){super(t,e)}async close(){this.dispose()}},Ju=class extends Gu{onDidChangeItemsExternal=O.None;constructor(t,e){super(t,void 0,e)}async close(){this.dispose()}},Xu=class{constructor(t){this.channel=t}isUsed(t){let e={payload:t,profile:void 0,workspace:void 0};return this.channel.call("isUsed",e)}};var Ub=128/4;var ON=M("dialogService");var MN=M("fileDialogService");var um=M("IV8InspectProfilingService"),AP;(e=>{function r(n){return!!(n.samples&&n.timeDeltas)}e.isValidProfile=r;function t(n,i="noAbsolutePaths"){for(let o of n.nodes)o.callFrame&&o.callFrame.url&&(fi(o.callFrame.url)||/^\w[\w\d+.-]*:\/\/\/?/.test(o.callFrame.url))&&(o.callFrame.url=W(i,at(o.callFrame.url)));return n}e.rewriteAbsolutePaths=t})(AP||={});var fm="Offline";function Lb(r){return r instanceof pm?!0:r instanceof Error&&r.name===fm&&r.message===fm}var pm=class extends Error{constructor(){super(fm),this.name=this.message}};var ti={JSONContribution:"base.contributions.json"};function OP(r){return r.length>0&&r.charAt(r.length-1)==="#"?r.substring(0,r.length-1):r}var hm=class{schemasById;_onDidChangeSchema=new P;onDidChangeSchema=this._onDidChangeSchema.event;constructor(){this.schemasById={}}registerSchema(t,e){this.schemasById[OP(t)]=e,this._onDidChangeSchema.fire(t)}notifySchemaChanged(t){this._onDidChangeSchema.fire(t)}getSchemaContributions(){return{schemas:this.schemasById}}getSchemaContent(t){let e=this.schemasById[t];return e?kS(e):void 0}hasSchemaContent(t){return!!this.schemasById[t]}},MP=new hm;Ne.add(ti.JSONContribution,MP);var Zu=M("policy"),Yu=class extends _{_serviceBrand;policyDefinitions={};policies=new Map;_onDidChange=this._register(new P);onDidChange=this._onDidChange.event;async updatePolicyDefinitions(t){let e=Object.keys(this.policyDefinitions).length;return this.policyDefinitions={...t,...this.policyDefinitions},e!==Object.keys(this.policyDefinitions).length&&await this._updatePolicyDefinitions(t),Cr.reduce(this.policies.entries(),(n,[i,o])=>({...n,[i]:o}),{})}getPolicyValue(t){return this.policies.get(t)}serialize(){return Cr.reduce(Object.entries(this.policyDefinitions),(t,[e,n])=>({...t,[e]:{definition:n,value:this.policies.get(e)}}),{})}},Ws=class{_serviceBrand;onDidChange=O.None;async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}};var Wt={Configuration:"base.contributions.configuration"};var Vs={properties:{},patternProperties:{}},ef={properties:{},patternProperties:{}},tf={properties:{},patternProperties:{}},nf={properties:{},patternProperties:{}},rf={properties:{},patternProperties:{}},hc={properties:{},patternProperties:{}},Co="vscode://schemas/settings/resourceLanguage";var of=Ne.as(ti.JSONContribution),gm=class{registeredConfigurationDefaults=[];configurationDefaultsOverrides;defaultLanguageConfigurationOverridesNode;configurationContributors;configurationProperties;policyConfigurations;excludedConfigurationProperties;resourceLanguageSettingsSchema;overrideIdentifiers=new Set;_onDidSchemaChange=new P;onDidSchemaChange=this._onDidSchemaChange.event;_onDidUpdateConfiguration=new P;onDidUpdateConfiguration=this._onDidUpdateConfiguration.event;constructor(){this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:g("defaultLanguageConfigurationOverrides.title","Default Language Configuration Overrides"),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},of.registerSchema(Co,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(t,e=!0){this.registerConfigurations([t],e)}registerConfigurations(t,e=!0){let n=new Set;this.doRegisterConfigurations(t,e,n),of.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n})}deregisterConfigurations(t){let e=new Set;this.doDeregisterConfigurations(t,e),of.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e})}updateConfigurations({add:t,remove:e}){let n=new Set;this.doDeregisterConfigurations(e,n),this.doRegisterConfigurations(t,!1,n),of.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n})}registerDefaultConfigurations(t){let e=new Set;this.doRegisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doRegisterDefaultConfigurations(t,e){this.registeredConfigurationDefaults.push(...t);let n=[];for(let{overrides:i,source:o}of t)for(let s in i){e.add(s);let a=this.configurationDefaultsOverrides.get(s)??this.configurationDefaultsOverrides.set(s,{configurationDefaultOverrides:[]}).get(s),l=i[s];if(a.configurationDefaultOverrides.push({value:l,source:o}),Ar.test(s)){let c=this.mergeDefaultConfigurationsForOverrideIdentifier(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c,this.updateDefaultOverrideProperty(s,c,o),n.push(...Ks(s))}else{let c=this.mergeDefaultConfigurationsForConfigurationProperty(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c;let d=this.configurationProperties[s];d&&(this.updatePropertyDefaultValue(s,d),this.updateSchema(s,d))}}this.doRegisterOverrideIdentifiers(n)}deregisterDefaultConfigurations(t){let e=new Set;this.doDeregisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doDeregisterDefaultConfigurations(t,e){for(let n of t){let i=this.registeredConfigurationDefaults.indexOf(n);i!==-1&&this.registeredConfigurationDefaults.splice(i,1)}for(let{overrides:n,source:i}of t)for(let o in n){let s=this.configurationDefaultsOverrides.get(o);if(!s)continue;let a=s.configurationDefaultOverrides.findIndex(l=>i?l.source?.id===i.id:l.value===n[o]);if(a!==-1){if(s.configurationDefaultOverrides.splice(a,1),s.configurationDefaultOverrides.length===0&&this.configurationDefaultsOverrides.delete(o),Ar.test(o)){let l;for(let c of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForOverrideIdentifier(o,c.value,c.source,l);l&&!as(l.value)?(s.configurationDefaultOverrideValue=l,this.updateDefaultOverrideProperty(o,l,i)):(this.configurationDefaultsOverrides.delete(o),delete this.configurationProperties[o],delete this.defaultLanguageConfigurationOverridesNode.properties[o])}else{let l;for(let d of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForConfigurationProperty(o,d.value,d.source,l);s.configurationDefaultOverrideValue=l;let c=this.configurationProperties[o];c&&(this.updatePropertyDefaultValue(o,c),this.updateSchema(o,c))}e.add(o)}}this.updateOverridePropertyPatternKey()}updateDefaultOverrideProperty(t,e,n){let i={type:"object",default:e.value,description:g("defaultLanguageConfiguration.description","Configure settings to be overridden for the {0} language.",vb(t)),$ref:Co,defaultDefaultValue:e.value,source:n,defaultValueSource:n};this.configurationProperties[t]=i,this.defaultLanguageConfigurationOverridesNode.properties[t]=i}mergeDefaultConfigurationsForOverrideIdentifier(t,e,n,i){let o=i?.value||{},s=i?.source??new Map;if(!(s instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(let a of Object.keys(e)){let l=e[a];if(He(l)&&(kt(o[a])||He(o[a]))){if(o[a]={...o[a]??{},...l},n)for(let d in l)s.set(`${a}.${d}`,n)}else o[a]=l,n?s.set(a,n):s.delete(a)}return{value:o,source:s}}mergeDefaultConfigurationsForConfigurationProperty(t,e,n,i){let o=this.configurationProperties[t],s=i?.value??o?.defaultDefaultValue,a=n;if(He(e)&&(o!==void 0&&o.type==="object"||o===void 0&&(kt(s)||He(s)))){if(a=i?.source??new Map,!(a instanceof Map)){console.error("defaultValueSource is not a Map");return}for(let c in e)n&&a.set(`${t}.${c}`,n);e={...He(s)?s:{},...e}}return{value:e,source:a}}deltaConfiguration(t){let e=!1,n=new Set;t.removedDefaults&&(this.doDeregisterDefaultConfigurations(t.removedDefaults,n),e=!0),t.addedDefaults&&(this.doRegisterDefaultConfigurations(t.addedDefaults,n),e=!0),t.removedConfigurations&&this.doDeregisterConfigurations(t.removedConfigurations,n),t.addedConfigurations&&this.doRegisterConfigurations(t.addedConfigurations,!1,n),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:n,defaultsOverrides:e})}notifyConfigurationSchemaUpdated(...t){this._onDidSchemaChange.fire()}registerOverrideIdentifiers(t){this.doRegisterOverrideIdentifiers(t),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(t){for(let e of t)this.overrideIdentifiers.add(e);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(t,e,n){t.forEach(i=>{this.validateAndRegisterProperties(i,e,i.extensionInfo,i.restrictedProperties,void 0,n),this.configurationContributors.push(i),this.registerJSONConfiguration(i)})}doDeregisterConfigurations(t,e){let n=i=>{if(i.properties)for(let o in i.properties){e.add(o);let s=this.configurationProperties[o];s?.policy?.name&&this.policyConfigurations.delete(s.policy.name),delete this.configurationProperties[o],this.removeFromSchema(o,i.properties[o])}i.allOf?.forEach(o=>n(o))};for(let i of t){n(i);let o=this.configurationContributors.indexOf(i);o!==-1&&this.configurationContributors.splice(o,1)}}validateAndRegisterProperties(t,e=!0,n,i,o=3,s){o=ct(t.scope)?o:t.scope;let a=t.properties;if(a)for(let c in a){let d=a[c];if(e&&BP(c,d)){delete a[c];continue}if(d.source=n,d.defaultDefaultValue=a[c].default,this.updatePropertyDefaultValue(c,d),Ar.test(c)?d.scope=void 0:(d.scope=ct(d.scope)?o:d.scope,d.restricted=ct(d.restricted)?!!i?.includes(c):d.restricted),a[c].hasOwnProperty("included")&&!a[c].included){this.excludedConfigurationProperties[c]=a[c],delete a[c];continue}else this.configurationProperties[c]=a[c],a[c].policy?.name&&this.policyConfigurations.set(a[c].policy.name,c);!a[c].deprecationMessage&&a[c].markdownDeprecationMessage&&(a[c].deprecationMessage=a[c].markdownDeprecationMessage),s.add(c)}let l=t.allOf;if(l)for(let c of l)this.validateAndRegisterProperties(c,e,n,i,o,s)}getConfigurations(){return this.configurationContributors}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}getRegisteredDefaultConfigurations(){return[...this.registeredConfigurationDefaults]}getConfigurationDefaultsOverrides(){let t=new Map;for(let[e,n]of this.configurationDefaultsOverrides)n.configurationDefaultOverrideValue&&t.set(e,n.configurationDefaultOverrideValue);return t}registerJSONConfiguration(t){let e=n=>{let i=n.properties;if(i)for(let s in i)this.updateSchema(s,i[s]);n.allOf?.forEach(e)};e(t)}updateSchema(t,e){switch(Vs.properties[t]=e,e.scope){case 1:ef.properties[t]=e;break;case 2:tf.properties[t]=e;break;case 6:nf.properties[t]=e;break;case 3:rf.properties[t]=e;break;case 4:hc.properties[t]=e;break;case 5:hc.properties[t]=e,this.resourceLanguageSettingsSchema.properties[t]=e;break}}removeFromSchema(t,e){switch(delete Vs.properties[t],e.scope){case 1:delete ef.properties[t];break;case 2:delete tf.properties[t];break;case 6:delete nf.properties[t];break;case 3:delete rf.properties[t];break;case 4:case 5:delete hc.properties[t],delete this.resourceLanguageSettingsSchema.properties[t];break}}updateOverridePropertyPatternKey(){for(let t of this.overrideIdentifiers.values()){let e=`[${t}]`,n={type:"object",description:g("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:g("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Co};this.updatePropertyDefaultValue(e,n),Vs.properties[e]=n,ef.properties[e]=n,tf.properties[e]=n,nf.properties[e]=n,rf.properties[e]=n,hc.properties[e]=n}}registerOverridePropertyPatternKey(){let t={type:"object",description:g("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:g("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Co};Vs.patternProperties[Do]=t,ef.patternProperties[Do]=t,tf.patternProperties[Do]=t,nf.patternProperties[Do]=t,rf.patternProperties[Do]=t,hc.patternProperties[Do]=t,this._onDidSchemaChange.fire()}updatePropertyDefaultValue(t,e){let n=this.configurationDefaultsOverrides.get(t)?.configurationDefaultOverrideValue,i,o;n&&(!e.disallowConfigurationDefault||!n.source)&&(i=n.value,o=n.source),kt(i)&&(i=e.defaultDefaultValue,o=void 0),kt(i)&&(i=NP(e.type)),e.default=i,e.defaultValueSource=o}},Ab="\\[([^\\]]+)\\]",Fb=new RegExp(Ab,"g"),Do=`^(${Ab})+$`,Ar=new RegExp(Do);function Ks(r){let t=[];if(Ar.test(r)){let e=Fb.exec(r);for(;e?.length;){let n=e[1].trim();n&&t.push(n),e=Fb.exec(r)}}return gt(t)}function Ob(r){return r.reduce((t,e)=>`${t}[${e}]`,"")}function NP(r){switch(Array.isArray(r)?r[0]:r){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var sf=new gm;Ne.add(Wt.Configuration,sf);function BP(r,t){return r.trim()?Ar.test(r)?g("config.property.languageDefault","Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.",r):sf.getConfigurationProperties()[r]!==void 0?g("config.property.duplicate","Cannot register '{0}'. This property is already registered.",r):t.policy?.name&&sf.getPolicyConfigurations().get(t.policy?.name)!==void 0?g("config.policy.duplicate","Cannot register '{0}'. The associated policy {1} is already registered with {2}.",r,t.policy?.name,sf.getPolicyConfigurations().get(t.policy?.name)):null:g("config.property.empty","Cannot register an empty property")}function mm(r){let t={};for(let e of r){let n=e.properties;if(He(n))for(let i in n)t[i]=n[i];e.allOf&&Object.assign(t,mm(e.allOf))}return t}function Mb(r){switch(r){case"application":return 1;case"machine":return 2;case"resource":return 4;case"machine-overridable":return 6;case"language-overridable":return 5;default:return 3}}var vr=M("requestService"),vm=class{constructor(t){this.original=t}headers;toJSON(){if(!this.headers){let t=Object.create(null);for(let e in this.original)e.toLowerCase()==="authorization"||e.toLowerCase()==="proxy-authorization"?t[e]="*****":t[e]=this.original[e];this.headers=t}return this.headers}},af=class extends _{constructor(e){super();this.logService=e}counter=0;async logAndRequest(e,n){let i=`[network] #${++this.counter}: ${e.url}`;this.logService.trace(`${i} - begin`,e.type,new vm(e.headers??{}));try{let o=await n();return this.logService.trace(`${i} - end`,e.type,o.res.statusCode,o.res.headers),o}catch(o){throw this.logService.error(`${i} - error`,e.type,me(o)),o}}};function Li(r){return r.res.statusCode&&r.res.statusCode>=200&&r.res.statusCode<300||r.res.statusCode===1223}function lf(r){return r.res.statusCode===204}async function Sm(r){return lf(r)?null:(await kr(r.stream)).toString()}async function Nn(r){if(!Li(r))throw new Error("Server returned "+r.res.statusCode);return Sm(r)}async function _o(r){if(!Li(r))throw new Error("Server returned "+r.res.statusCode);if(lf(r))return null;let e=(await kr(r.stream)).toString();try{return JSON.parse(e)}catch(n){throw n.message+=`:
`+e,n}}var ym;function WP(r){let t=Ne.as(Wt.Configuration),e=ym;ym={id:"http",order:15,title:g("httpConfigurationTitle","HTTP"),type:"object",scope:r,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:g("proxy","The proxy setting to use. If not set, will be inherited from the `http_proxy` and `https_proxy` environment variables."),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,description:g("strictSSL","Controls whether the proxy server certificate should be verified against the list of supplied CAs."),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:g("proxyKerberosServicePrincipal","Overrides the principal service name for Kerberos authentication with the HTTP proxy. A default based on the proxy hostname is used when this is not set."),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:g("noProxy","Specifies domain names for which proxy settings should be ignored for HTTP/HTTPS requests."),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:g("proxyAuthorization","The value to send as the `Proxy-Authorization` header for every network request."),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[g("proxySupportOff","Disable proxy support for extensions."),g("proxySupportOn","Enable proxy support for extensions."),g("proxySupportFallback","Enable proxy support for extensions, fall back to request options, when no proxy found."),g("proxySupportOverride","Enable proxy support for extensions, override request options.")],default:"override",description:g("proxySupport","Use the proxy support for extensions."),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,description:g("systemCertificates","Controls whether CA certificates should be loaded from the OS. (On Windows and macOS, a reload of the window is required after turning this off.)"),restricted:!0},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,description:g("systemCertificatesV2","Controls whether experimental loading of CA certificates from the OS should be enabled. This uses a more general approach than the default implemenation."),restricted:!0}}},t.updateConfigurations({add:[ym],remove:e?[e]:[]})}WP(1);function Ai(r,t){let e=Math.pow(10,t);return Math.round(r*e)/e}var ye=class{_rgbaBrand=void 0;r;g;b;a;constructor(t,e,n,i=1){this.r=Math.min(255,Math.max(0,t))|0,this.g=Math.min(255,Math.max(0,e))|0,this.b=Math.min(255,Math.max(0,n))|0,this.a=Ai(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}},Fi=class r{_hslaBrand=void 0;h;s;l;a;constructor(t,e,n,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Ai(Math.max(Math.min(1,e),0),3),this.l=Ai(Math.max(Math.min(1,n),0),3),this.a=Ai(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.l===e.l&&t.a===e.a}static fromRGBA(t){let e=t.r/255,n=t.g/255,i=t.b/255,o=t.a,s=Math.max(e,n,i),a=Math.min(e,n,i),l=0,c=0,d=(a+s)/2,u=s-a;if(u>0){switch(c=Math.min(d<=.5?u/(2*d):u/(2-2*d),1),s){case e:l=(n-i)/u+(n<i?6:0);break;case n:l=(i-e)/u+2;break;case i:l=(e-n)/u+4;break}l*=60,l=Math.round(l)}return new r(l,c,d,o)}static _hue2rgb(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+(e-t)*6*n:n<1/2?e:n<2/3?t+(e-t)*(2/3-n)*6:t}static toRGBA(t){let e=t.h/360,{s:n,l:i,a:o}=t,s,a,l;if(n===0)s=a=l=i;else{let c=i<.5?i*(1+n):i+n-i*n,d=2*i-c;s=r._hue2rgb(d,c,e+1/3),a=r._hue2rgb(d,c,e),l=r._hue2rgb(d,c,e-1/3)}return new ye(Math.round(s*255),Math.round(a*255),Math.round(l*255),o)}},$s=class r{_hsvaBrand=void 0;h;s;v;a;constructor(t,e,n,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Ai(Math.max(Math.min(1,e),0),3),this.v=Ai(Math.max(Math.min(1,n),0),3),this.a=Ai(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.v===e.v&&t.a===e.a}static fromRGBA(t){let e=t.r/255,n=t.g/255,i=t.b/255,o=Math.max(e,n,i),s=Math.min(e,n,i),a=o-s,l=o===0?0:a/o,c;return a===0?c=0:o===e?c=((n-i)/a%6+6)%6:o===n?c=(i-e)/a+2:c=(e-n)/a+4,new r(Math.round(c*60),l,o,t.a)}static toRGBA(t){let{h:e,s:n,v:i,a:o}=t,s=i*n,a=s*(1-Math.abs(e/60%2-1)),l=i-s,[c,d,u]=[0,0,0];return e<60?(c=s,d=a):e<120?(c=a,d=s):e<180?(d=s,u=a):e<240?(d=a,u=s):e<300?(c=a,u=s):e<=360&&(c=s,u=a),c=Math.round((c+l)*255),d=Math.round((d+l)*255),u=Math.round((u+l)*255),new ye(c,d,u,o)}},F=class r{static fromHex(t){return r.Format.CSS.parseHex(t)||r.red}static equals(t,e){return!t&&!e?!0:!t||!e?!1:t.equals(e)}rgba;_hsla;get hsla(){return this._hsla?this._hsla:Fi.fromRGBA(this.rgba)}_hsva;get hsva(){return this._hsva?this._hsva:$s.fromRGBA(this.rgba)}constructor(t){if(t)if(t instanceof ye)this.rgba=t;else if(t instanceof Fi)this._hsla=t,this.rgba=Fi.toRGBA(t);else if(t instanceof $s)this._hsva=t,this.rgba=$s.toRGBA(t);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(t){return!!t&&ye.equals(this.rgba,t.rgba)&&Fi.equals(this.hsla,t.hsla)&&$s.equals(this.hsva,t.hsva)}getRelativeLuminance(){let t=r._relativeLuminanceForComponent(this.rgba.r),e=r._relativeLuminanceForComponent(this.rgba.g),n=r._relativeLuminanceForComponent(this.rgba.b),i=.2126*t+.7152*e+.0722*n;return Ai(i,4)}static _relativeLuminanceForComponent(t){let e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}getContrastRatio(t){let e=this.getRelativeLuminance(),n=t.getRelativeLuminance();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)}isDarker(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3<128}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(t){let e=this.getRelativeLuminance(),n=t.getRelativeLuminance();return e>n}isDarkerThan(t){let e=this.getRelativeLuminance(),n=t.getRelativeLuminance();return e<n}lighten(t){return new r(new Fi(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*t,this.hsla.a))}darken(t){return new r(new Fi(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*t,this.hsla.a))}transparent(t){let{r:e,g:n,b:i,a:o}=this.rgba;return new r(new ye(e,n,i,o*t))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new r(new ye(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(t){let e=t.rgba,n=this.rgba.a,i=e.a,o=n+i*(1-n);if(o<1e-6)return r.transparent;let s=this.rgba.r*n/o+e.r*i*(1-n)/o,a=this.rgba.g*n/o+e.g*i*(1-n)/o,l=this.rgba.b*n/o+e.b*i*(1-n)/o;return new r(new ye(s,a,l,o))}makeOpaque(t){if(this.isOpaque()||t.rgba.a!==1)return this;let{r:e,g:n,b:i,a:o}=this.rgba;return new r(new ye(t.rgba.r-o*(t.rgba.r-e),t.rgba.g-o*(t.rgba.g-n),t.rgba.b-o*(t.rgba.b-i),1))}flatten(...t){let e=t.reduceRight((n,i)=>r._flatten(i,n));return r._flatten(this,e)}static _flatten(t,e){let n=1-t.rgba.a;return new r(new ye(n*e.rgba.r+t.rgba.a*t.rgba.r,n*e.rgba.g+t.rgba.a*t.rgba.g,n*e.rgba.b+t.rgba.a*t.rgba.b))}_toString;toString(){return this._toString||(this._toString=r.Format.CSS.format(this)),this._toString}static getLighterColor(t,e,n){if(t.isLighterThan(e))return t;n=n||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return n=n*(o-i)/o,t.lighten(n)}static getDarkerColor(t,e,n){if(t.isDarkerThan(e))return t;n=n||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return n=n*(i-o)/i,t.darken(n)}static white=new r(new ye(255,255,255,1));static black=new r(new ye(0,0,0,1));static red=new r(new ye(255,0,0,1));static blue=new r(new ye(0,0,255,1));static green=new r(new ye(0,255,0,1));static cyan=new r(new ye(0,255,255,1));static lightgrey=new r(new ye(211,211,211,1));static transparent=new r(new ye(0,0,0,0))};(t=>{let r;(n=>{let e;(v=>{function i(y){return y.rgba.a===1?`rgb(${y.rgba.r}, ${y.rgba.g}, ${y.rgba.b})`:t.Format.CSS.formatRGBA(y)}v.formatRGB=i;function o(y){return`rgba(${y.rgba.r}, ${y.rgba.g}, ${y.rgba.b}, ${+y.rgba.a.toFixed(2)})`}v.formatRGBA=o;function s(y){return y.hsla.a===1?`hsl(${y.hsla.h}, ${(y.hsla.s*100).toFixed(2)}%, ${(y.hsla.l*100).toFixed(2)}%)`:t.Format.CSS.formatHSLA(y)}v.formatHSL=s;function a(y){return`hsla(${y.hsla.h}, ${(y.hsla.s*100).toFixed(2)}%, ${(y.hsla.l*100).toFixed(2)}%, ${y.hsla.a.toFixed(2)})`}v.formatHSLA=a;function l(y){let I=y.toString(16);return I.length!==2?"0"+I:I}function c(y){return`#${l(y.rgba.r)}${l(y.rgba.g)}${l(y.rgba.b)}`}v.formatHex=c;function d(y,I=!1){return I&&y.rgba.a===1?t.Format.CSS.formatHex(y):`#${l(y.rgba.r)}${l(y.rgba.g)}${l(y.rgba.b)}${l(Math.round(y.rgba.a*255))}`}v.formatHexA=d;function u(y){return y.isOpaque()?t.Format.CSS.formatHex(y):t.Format.CSS.formatRGBA(y)}v.format=u;function f(y){let I=y.length;if(I===0||y.charCodeAt(0)!==35)return null;if(I===7){let x=16*h(y.charCodeAt(1))+h(y.charCodeAt(2)),T=16*h(y.charCodeAt(3))+h(y.charCodeAt(4)),R=16*h(y.charCodeAt(5))+h(y.charCodeAt(6));return new t(new ye(x,T,R,1))}if(I===9){let x=16*h(y.charCodeAt(1))+h(y.charCodeAt(2)),T=16*h(y.charCodeAt(3))+h(y.charCodeAt(4)),R=16*h(y.charCodeAt(5))+h(y.charCodeAt(6)),w=16*h(y.charCodeAt(7))+h(y.charCodeAt(8));return new t(new ye(x,T,R,w/255))}if(I===4){let x=h(y.charCodeAt(1)),T=h(y.charCodeAt(2)),R=h(y.charCodeAt(3));return new t(new ye(16*x+x,16*T+T,16*R+R))}if(I===5){let x=h(y.charCodeAt(1)),T=h(y.charCodeAt(2)),R=h(y.charCodeAt(3)),w=h(y.charCodeAt(4));return new t(new ye(16*x+x,16*T+T,16*R+R,(16*w+w)/255))}return null}v.parseHex=f;function h(y){switch(y){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(e=n.CSS||={})})(r=t.Format||={})})(F||={});function VP(r){return r!==null&&typeof r=="object"&&"light"in r&&"dark"in r}var KP={ColorContribution:"base.contributions.colors"},$P="default",bm=class{_onDidChangeSchema=new P;onDidChangeSchema=this._onDidChangeSchema.event;colorsById;colorSchema={type:"object",properties:{}};colorReferenceSchema={type:"string",enum:[],enumDescriptions:[]};constructor(){this.colorsById={}}notifyThemeUpdate(t){for(let e of Object.keys(this.colorsById)){let n=t.getColor(e);n&&(this.colorSchema.properties[e].oneOf[0].defaultSnippets[0].body=`\${1:${n.toString()}}`)}this._onDidChangeSchema.fire()}registerColor(t,e,n,i=!1,o){let s={id:t,description:n,defaults:e,needsTransparency:i,deprecationMessage:o};this.colorsById[t]=s;let a={type:"string",format:"color-hex",defaultSnippets:[{body:"${1:#ff0000}"}]};return o&&(a.deprecationMessage=o),i&&(a.pattern="^#(?:(?<rgba>[0-9a-fA-f]{3}[0-9a-eA-E])|(?:[0-9a-fA-F]{6}(?:(?![fF]{2})(?:[0-9a-fA-F]{2}))))?$",a.patternErrorMessage=g("transparecyRequired","This color must be transparent or it will obscure content")),this.colorSchema.properties[t]={description:n,oneOf:[a,{type:"string",const:$P,description:g("useDefault","Use the default color.")}]},this.colorReferenceSchema.enum.push(t),this.colorReferenceSchema.enumDescriptions.push(n),this._onDidChangeSchema.fire(),t}deregisterColor(t){delete this.colorsById[t],delete this.colorSchema.properties[t];let e=this.colorReferenceSchema.enum.indexOf(t);e!==-1&&(this.colorReferenceSchema.enum.splice(e,1),this.colorReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChangeSchema.fire()}getColors(){return Object.keys(this.colorsById).map(t=>this.colorsById[t])}resolveDefaultColor(t,e){let n=this.colorsById[t];if(n?.defaults){let i=VP(n.defaults)?n.defaults[e.type]:n.defaults;return Ir(i,e)}}getColorSchema(){return this.colorSchema}getColorReferenceSchema(){return this.colorReferenceSchema}toString(){let t=(e,n)=>{let i=e.indexOf(".")===-1?0:1,o=n.indexOf(".")===-1?0:1;return i!==o?i-o:e.localeCompare(n)};return Object.keys(this.colorsById).sort(t).map(e=>`- \`${e}\`: ${this.colorsById[e].description}`).join(`
`)}},cf=new bm;Ne.add(KP.ColorContribution,cf);function S(r,t,e,n,i){return cf.registerColor(r,t,e,n,i)}function zP(r,t){switch(r.op){case 0:return Ir(r.value,t)?.darken(r.factor);case 1:return Ir(r.value,t)?.lighten(r.factor);case 2:return Ir(r.value,t)?.transparent(r.factor);case 3:{let e=Ir(r.background,t);return e?Ir(r.value,t)?.makeOpaque(e):Ir(r.value,t)}case 4:for(let e of r.values){let n=Ir(e,t);if(n)return n}return;case 6:return Ir(t.defines(r.if)?r.then:r.else,t);case 5:{let e=Ir(r.value,t);if(!e)return;let n=Ir(r.background,t);return n?e.isDarkerThan(n)?F.getLighterColor(e,n,r.factor).transparent(r.transparency):F.getDarkerColor(e,n,r.factor).transparent(r.transparency):e.transparent(r.factor*r.transparency)}default:throw sI(r)}}function Or(r,t){return{op:0,value:r,factor:t}}function bn(r,t){return{op:1,value:r,factor:t}}function re(r,t){return{op:2,value:r,factor:t}}function xm(...r){return{op:4,values:r}}function Bb(r,t,e){return{op:6,if:r,then:t,else:e}}function Em(r,t,e,n){return{op:5,value:r,background:t,factor:e,transparency:n}}function Ir(r,t){if(r!==null){if(typeof r=="string")return r[0]==="#"?F.fromHex(r):t.getColor(r);if(r instanceof F)return r;if(typeof r=="object")return zP(r,t)}}var Wb="vscode://schemas/workbench-colors",Vb=Ne.as(ti.JSONContribution);Vb.registerSchema(Wb,cf.getColorSchema());var Nb=new mt(()=>Vb.notifySchemaChanged(Wb),200);cf.onDidChangeSchema(()=>{Nb.isScheduled()||Nb.schedule()});var we=S("foreground",{dark:"#CCCCCC",light:"#616161",hcDark:"#FFFFFF",hcLight:"#292929"},g("foreground","Overall foreground color. This color is only used if not overridden by a component.")),Y3=S("disabledForeground",{dark:"#CCCCCC80",light:"#61616180",hcDark:"#A5A5A5",hcLight:"#7F7F7F"},g("disabledForeground","Overall foreground for disabled elements. This color is only used if not overridden by a component.")),Z3=S("errorForeground",{dark:"#F48771",light:"#A1260D",hcDark:"#F48771",hcLight:"#B5200D"},g("errorForeground","Overall foreground color for error messages. This color is only used if not overridden by a component.")),eB=S("descriptionForeground",{light:"#717171",dark:re(we,.7),hcDark:re(we,.7),hcLight:re(we,.7)},g("descriptionForeground","Foreground color for description text providing additional information, for example for a label.")),gc=S("icon.foreground",{dark:"#C5C5C5",light:"#424242",hcDark:"#FFFFFF",hcLight:"#292929"},g("iconForeground","The default color for icons in the workbench.")),jn=S("focusBorder",{dark:"#007FD4",light:"#0090F1",hcDark:"#F38518",hcLight:"#006BBD"},g("focusBorder","Overall border color for focused elements. This color is only used if not overridden by a component.")),Pe=S("contrastBorder",{light:null,dark:null,hcDark:"#6FC3DF",hcLight:"#0F4A85"},g("contrastBorder","An extra border around elements to separate them from others for greater contrast.")),jt=S("contrastActiveBorder",{light:null,dark:null,hcDark:jn,hcLight:jn},g("activeContrastBorder","An extra border around active elements to separate them from others for greater contrast.")),tB=S("selection.background",null,g("selectionBackground","The background color of text selections in the workbench (e.g. for input fields or text areas). Note that this does not apply to selections within the editor.")),nB=S("textLink.foreground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},g("textLinkForeground","Foreground color for links in text.")),rB=S("textLink.activeForeground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},g("textLinkActiveForeground","Foreground color for links in text when clicked on and on mouse hover.")),iB=S("textSeparator.foreground",{light:"#0000002e",dark:"#ffffff2e",hcDark:F.black,hcLight:"#292929"},g("textSeparatorForeground","Color for text separators.")),oB=S("textPreformat.foreground",{light:"#A31515",dark:"#D7BA7D",hcDark:"#000000",hcLight:"#FFFFFF"},g("textPreformatForeground","Foreground color for preformatted text segments.")),sB=S("textPreformat.background",{light:"#0000001A",dark:"#FFFFFF1A",hcDark:"#FFFFFF",hcLight:"#09345f"},g("textPreformatBackground","Background color for preformatted text segments.")),aB=S("textBlockQuote.background",{light:"#f2f2f2",dark:"#222222",hcDark:null,hcLight:"#F2F2F2"},g("textBlockQuoteBackground","Background color for block quotes in text.")),lB=S("textBlockQuote.border",{light:"#007acc80",dark:"#007acc80",hcDark:F.white,hcLight:"#292929"},g("textBlockQuoteBorder","Border color for block quotes in text.")),cB=S("textCodeBlock.background",{light:"#dcdcdc66",dark:"#0a0a0a66",hcDark:F.black,hcLight:"#F2F2F2"},g("textCodeBlockBackground","Background color for code blocks in text."));var hB=S("sash.hoverBorder",jn,g("sashActiveBorder","Border color of active sashes.")),df=S("badge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:F.black,hcLight:"#0F4A85"},g("badgeBackground","Badge background color. Badges are small information labels, e.g. for search results count.")),gB=S("badge.foreground",{dark:F.white,light:"#333",hcDark:F.white,hcLight:F.white},g("badgeForeground","Badge foreground color. Badges are small information labels, e.g. for search results count.")),Kb=S("scrollbar.shadow",{dark:"#000000",light:"#DDDDDD",hcDark:null,hcLight:null},g("scrollbarShadow","Scrollbar shadow to indicate that the view is scrolled.")),$b=S("scrollbarSlider.background",{dark:F.fromHex("#797979").transparent(.4),light:F.fromHex("#646464").transparent(.4),hcDark:re(Pe,.6),hcLight:re(Pe,.4)},g("scrollbarSliderBackground","Scrollbar slider background color.")),zb=S("scrollbarSlider.hoverBackground",{dark:F.fromHex("#646464").transparent(.7),light:F.fromHex("#646464").transparent(.7),hcDark:re(Pe,.8),hcLight:re(Pe,.8)},g("scrollbarSliderHoverBackground","Scrollbar slider background color when hovering.")),qb=S("scrollbarSlider.activeBackground",{dark:F.fromHex("#BFBFBF").transparent(.4),light:F.fromHex("#000000").transparent(.6),hcDark:Pe,hcLight:Pe},g("scrollbarSliderActiveBackground","Scrollbar slider background color when clicked on.")),mB=S("progressBar.background",{dark:F.fromHex("#0E70C0"),light:F.fromHex("#0E70C0"),hcDark:Pe,hcLight:Pe},g("progressBarBackground","Background color of the progress bar that can show for long running operations."));var uf=S("editor.background",{light:"#ffffff",dark:"#1E1E1E",hcDark:F.black,hcLight:F.white},g("editorBackground","Editor background color.")),xB=S("editor.foreground",{light:"#333333",dark:"#BBBBBB",hcDark:F.white,hcLight:we},g("editorForeground","Editor default foreground color.")),EB=S("editorStickyScroll.background",uf,g("editorStickyScrollBackground","Background color of sticky scroll in the editor")),wB=S("editorStickyScrollHover.background",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:null,hcLight:F.fromHex("#0F4A85").transparent(.1)},g("editorStickyScrollHoverBackground","Background color of sticky scroll on hover in the editor")),PB=S("editorStickyScroll.border",{dark:null,light:null,hcDark:Pe,hcLight:Pe},g("editorStickyScrollBorder","Border color of sticky scroll in the editor")),TB=S("editorStickyScroll.shadow",Kb,g("editorStickyScrollShadow"," Shadow color of sticky scroll in the editor")),xn=S("editorWidget.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#0C141F",hcLight:F.white},g("editorWidgetBackground","Background color of editor widgets, such as find/replace.")),mc=S("editorWidget.foreground",we,g("editorWidgetForeground","Foreground color of editor widgets, such as find/replace.")),qP=S("editorWidget.border",{dark:"#454545",light:"#C8C8C8",hcDark:Pe,hcLight:Pe},g("editorWidgetBorder","Border color of editor widgets. The color is only used if the widget chooses to have a border and if the color is not overridden by a widget.")),RB=S("editorWidget.resizeBorder",null,g("editorWidgetResizeBorder","Border color of the resize bar of editor widgets. The color is only used if the widget chooses to have a resize border and if the color is not overridden by a widget.")),CB=S("editorError.background",null,g("editorError.background","Background color of error text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Rm=S("editorError.foreground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F48771",hcLight:"#B5200D"},g("editorError.foreground","Foreground color of error squigglies in the editor.")),DB=S("editorError.border",{dark:null,light:null,hcDark:F.fromHex("#E47777").transparent(.8),hcLight:"#B5200D"},g("errorBorder","If set, color of double underlines for errors in the editor.")),_B=S("editorWarning.background",null,g("editorWarning.background","Background color of warning text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),js=S("editorWarning.foreground",{dark:"#CCA700",light:"#BF8803",hcDark:"#FFD370",hcLight:"#895503"},g("editorWarning.foreground","Foreground color of warning squigglies in the editor.")),Cm=S("editorWarning.border",{dark:null,light:null,hcDark:F.fromHex("#FFCC00").transparent(.8),hcLight:F.fromHex("#FFCC00").transparent(.8)},g("warningBorder","If set, color of double underlines for warnings in the editor.")),kB=S("editorInfo.background",null,g("editorInfo.background","Background color of info text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Gs=S("editorInfo.foreground",{dark:"#3794FF",light:"#1a85ff",hcDark:"#3794FF",hcLight:"#1a85ff"},g("editorInfo.foreground","Foreground color of info squigglies in the editor.")),Dm=S("editorInfo.border",{dark:null,light:null,hcDark:F.fromHex("#3794FF").transparent(.8),hcLight:"#292929"},g("infoBorder","If set, color of double underlines for infos in the editor.")),UB=S("editorHint.foreground",{dark:F.fromHex("#eeeeee").transparent(.7),light:"#6c6c6c",hcDark:null,hcLight:null},g("editorHint.foreground","Foreground color of hint squigglies in the editor.")),LB=S("editorHint.border",{dark:null,light:null,hcDark:F.fromHex("#eeeeee").transparent(.8),hcLight:"#292929"},g("hintBorder","If set, color of double underlines for hints in the editor.")),FB=S("editorLink.activeForeground",{dark:"#4E94CE",light:F.blue,hcDark:F.cyan,hcLight:"#292929"},g("activeLinkForeground","Color of active links.")),zs=S("editor.selectionBackground",{light:"#ADD6FF",dark:"#264F78",hcDark:"#f3f518",hcLight:"#0F4A85"},g("editorSelectionBackground","Color of the editor selection.")),AB=S("editor.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:F.white},g("editorSelectionForeground","Color of the selected text for high contrast.")),OB=S("editor.inactiveSelectionBackground",{light:re(zs,.5),dark:re(zs,.5),hcDark:re(zs,.7),hcLight:re(zs,.5)},g("editorInactiveSelection","Color of the selection in an inactive editor. The color must not be opaque so as not to hide underlying decorations."),!0),MB=S("editor.selectionHighlightBackground",{light:Em(zs,uf,.3,.6),dark:Em(zs,uf,.3,.6),hcDark:null,hcLight:null},g("editorSelectionHighlight","Color for regions with the same content as the selection. The color must not be opaque so as not to hide underlying decorations."),!0),NB=S("editor.selectionHighlightBorder",{light:null,dark:null,hcDark:jt,hcLight:jt},g("editorSelectionHighlightBorder","Border color for regions with the same content as the selection.")),BB=S("editor.findMatchBackground",{light:"#A8AC94",dark:"#515C6A",hcDark:null,hcLight:null},g("editorFindMatch","Color of the current search match.")),WB=S("editor.findMatchForeground",null,g("editorFindMatchForeground","Text color of the current search match.")),Oi=S("editor.findMatchHighlightBackground",{light:"#EA5C0055",dark:"#EA5C0055",hcDark:null,hcLight:null},g("findMatchHighlight","Color of the other search matches. The color must not be opaque so as not to hide underlying decorations."),!0),VB=S("editor.findMatchHighlightForeground",null,g("findMatchHighlightForeground","Foreground color of the other search matches."),!0),KB=S("editor.findRangeHighlightBackground",{dark:"#3a3d4166",light:"#b4b4b44d",hcDark:null,hcLight:null},g("findRangeHighlight","Color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),$B=S("editor.findMatchBorder",{light:null,dark:null,hcDark:jt,hcLight:jt},g("editorFindMatchBorder","Border color of the current search match.")),Mi=S("editor.findMatchHighlightBorder",{light:null,dark:null,hcDark:jt,hcLight:jt},g("findMatchHighlightBorder","Border color of the other search matches.")),zB=S("editor.findRangeHighlightBorder",{dark:null,light:null,hcDark:re(jt,.4),hcLight:re(jt,.4)},g("findRangeHighlightBorder","Border color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),qB=S("editor.hoverHighlightBackground",{light:"#ADD6FF26",dark:"#264f7840",hcDark:"#ADD6FF26",hcLight:null},g("hoverHighlight","Highlight below the word for which a hover is shown. The color must not be opaque so as not to hide underlying decorations."),!0),Hb=S("editorHoverWidget.background",xn,g("hoverBackground","Background color of the editor hover.")),HB=S("editorHoverWidget.foreground",mc,g("hoverForeground","Foreground color of the editor hover.")),jB=S("editorHoverWidget.border",qP,g("hoverBorder","Border color of the editor hover.")),GB=S("editorHoverWidget.statusBarBackground",{dark:bn(Hb,.2),light:Or(Hb,.05),hcDark:xn,hcLight:xn},g("statusBarBackground","Background color of the editor hover status bar.")),Zb=S("editorInlayHint.foreground",{dark:"#969696",light:"#969696",hcDark:F.white,hcLight:F.black},g("editorInlayHintForeground","Foreground color of inline hints")),ex=S("editorInlayHint.background",{dark:re(df,.1),light:re(df,.1),hcDark:re(F.white,.1),hcLight:re(df,.1)},g("editorInlayHintBackground","Background color of inline hints")),QB=S("editorInlayHint.typeForeground",Zb,g("editorInlayHintForegroundTypes","Foreground color of inline hints for types")),JB=S("editorInlayHint.typeBackground",ex,g("editorInlayHintBackgroundTypes","Background color of inline hints for types")),XB=S("editorInlayHint.parameterForeground",Zb,g("editorInlayHintForegroundParameter","Foreground color of inline hints for parameters")),YB=S("editorInlayHint.parameterBackground",ex,g("editorInlayHintBackgroundParameter","Background color of inline hints for parameters")),HP=S("editorLightBulb.foreground",{dark:"#FFCC00",light:"#DDB100",hcDark:"#FFCC00",hcLight:"#007ACC"},g("editorLightBulbForeground","The color used for the lightbulb actions icon.")),ZB=S("editorLightBulbAutoFix.foreground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},g("editorLightBulbAutoFixForeground","The color used for the lightbulb auto fix actions icon.")),eW=S("editorLightBulbAi.foreground",HP,g("editorLightBulbAiForeground","The color used for the lightbulb AI icon.")),tW=S("editor.snippetTabstopHighlightBackground",{dark:new F(new ye(124,124,124,.3)),light:new F(new ye(10,50,100,.2)),hcDark:new F(new ye(124,124,124,.3)),hcLight:new F(new ye(10,50,100,.2))},g("snippetTabstopHighlightBackground","Highlight background color of a snippet tabstop.")),nW=S("editor.snippetTabstopHighlightBorder",null,g("snippetTabstopHighlightBorder","Highlight border color of a snippet tabstop.")),rW=S("editor.snippetFinalTabstopHighlightBackground",null,g("snippetFinalTabstopHighlightBackground","Highlight background color of the final tabstop of a snippet.")),iW=S("editor.snippetFinalTabstopHighlightBorder",{dark:"#525252",light:new F(new ye(10,50,100,.5)),hcDark:"#525252",hcLight:"#292929"},g("snippetFinalTabstopHighlightBorder","Highlight border color of the final tabstop of a snippet.")),jb=new F(new ye(155,185,85,.2)),Gb=new F(new ye(255,0,0,.2)),oW=S("diffEditor.insertedTextBackground",{dark:"#9ccc2c33",light:"#9ccc2c40",hcDark:null,hcLight:null},g("diffEditorInserted","Background color for text that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),sW=S("diffEditor.removedTextBackground",{dark:"#ff000033",light:"#ff000033",hcDark:null,hcLight:null},g("diffEditorRemoved","Background color for text that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),aW=S("diffEditor.insertedLineBackground",{dark:jb,light:jb,hcDark:null,hcLight:null},g("diffEditorInsertedLines","Background color for lines that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),lW=S("diffEditor.removedLineBackground",{dark:Gb,light:Gb,hcDark:null,hcLight:null},g("diffEditorRemovedLines","Background color for lines that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),cW=S("diffEditorGutter.insertedLineBackground",null,g("diffEditorInsertedLineGutter","Background color for the margin where lines got inserted.")),dW=S("diffEditorGutter.removedLineBackground",null,g("diffEditorRemovedLineGutter","Background color for the margin where lines got removed.")),uW=S("diffEditorOverview.insertedForeground",null,g("diffEditorOverviewInserted","Diff overview ruler foreground for inserted content.")),fW=S("diffEditorOverview.removedForeground",null,g("diffEditorOverviewRemoved","Diff overview ruler foreground for removed content.")),pW=S("diffEditor.insertedTextBorder",{dark:null,light:null,hcDark:"#33ff2eff",hcLight:"#374E06"},g("diffEditorInsertedOutline","Outline color for the text that got inserted.")),hW=S("diffEditor.removedTextBorder",{dark:null,light:null,hcDark:"#FF008F",hcLight:"#AD0707"},g("diffEditorRemovedOutline","Outline color for text that got removed.")),gW=S("diffEditor.border",{dark:null,light:null,hcDark:Pe,hcLight:Pe},g("diffEditorBorder","Border color between the two text editors.")),mW=S("diffEditor.diagonalFill",{dark:"#cccccc33",light:"#22222233",hcDark:null,hcLight:null},g("diffDiagonalFill","Color of the diff editor's diagonal fill. The diagonal fill is used in side-by-side diff views.")),yW=S("diffEditor.unchangedRegionBackground","sideBar.background",g("diffEditor.unchangedRegionBackground","The background color of unchanged blocks in the diff editor.")),vW=S("diffEditor.unchangedRegionForeground","foreground",g("diffEditor.unchangedRegionForeground","The foreground color of unchanged blocks in the diff editor.")),IW=S("diffEditor.unchangedCodeBackground",{dark:"#74747429",light:"#b8b8b829",hcDark:null,hcLight:null},g("diffEditor.unchangedCodeBackground","The background color of unchanged code in the diff editor.")),tx=S("widget.shadow",{dark:re(F.black,.36),light:re(F.black,.16),hcDark:null,hcLight:null},g("widgetShadow","Shadow color of widgets such as find/replace inside the editor.")),SW=S("widget.border",{dark:null,light:null,hcDark:Pe,hcLight:Pe},g("widgetBorder","Border color of widgets such as find/replace inside the editor.")),Qb=S("toolbar.hoverBackground",{dark:"#5a5d5e50",light:"#b8b8b850",hcDark:null,hcLight:null},g("toolbarHoverBackground","Toolbar background when hovering over actions using the mouse")),bW=S("toolbar.hoverOutline",{dark:null,light:null,hcDark:jt,hcLight:jt},g("toolbarHoverOutline","Toolbar outline when hovering over actions using the mouse")),xW=S("toolbar.activeBackground",{dark:bn(Qb,.1),light:Or(Qb,.1),hcDark:null,hcLight:null},g("toolbarActiveBackground","Toolbar background when holding the mouse over actions")),EW=S("breadcrumb.foreground",re(we,.8),g("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),wW=S("breadcrumb.background",uf,g("breadcrumbsBackground","Background color of breadcrumb items.")),PW=S("breadcrumb.focusForeground",{light:Or(we,.2),dark:bn(we,.1),hcDark:bn(we,.1),hcLight:bn(we,.1)},g("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),TW=S("breadcrumb.activeSelectionForeground",{light:Or(we,.2),dark:bn(we,.1),hcDark:bn(we,.1),hcLight:bn(we,.1)},g("breadcrumbsSelectedForeground","Color of selected breadcrumb items.")),RW=S("breadcrumbPicker.background",xn,g("breadcrumbsSelectedBackground","Background color of breadcrumb item picker.")),nx=.5,Jb=F.fromHex("#40C8AE").transparent(nx),Xb=F.fromHex("#40A6FF").transparent(nx),Yb=F.fromHex("#606060").transparent(.4),_m=.4,qs=1,wm=S("merge.currentHeaderBackground",{dark:Jb,light:Jb,hcDark:null,hcLight:null},g("mergeCurrentHeaderBackground","Current header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),CW=S("merge.currentContentBackground",re(wm,_m),g("mergeCurrentContentBackground","Current content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),Pm=S("merge.incomingHeaderBackground",{dark:Xb,light:Xb,hcDark:null,hcLight:null},g("mergeIncomingHeaderBackground","Incoming header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),DW=S("merge.incomingContentBackground",re(Pm,_m),g("mergeIncomingContentBackground","Incoming content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),Tm=S("merge.commonHeaderBackground",{dark:Yb,light:Yb,hcDark:null,hcLight:null},g("mergeCommonHeaderBackground","Common ancestor header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),_W=S("merge.commonContentBackground",re(Tm,_m),g("mergeCommonContentBackground","Common ancestor content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),Hs=S("merge.border",{dark:null,light:null,hcDark:"#C3DF6F",hcLight:"#007ACC"},g("mergeBorder","Border color on headers and the splitter in inline merge-conflicts.")),kW=S("editorOverviewRuler.currentContentForeground",{dark:re(wm,qs),light:re(wm,qs),hcDark:Hs,hcLight:Hs},g("overviewRulerCurrentContentForeground","Current overview ruler foreground for inline merge-conflicts.")),UW=S("editorOverviewRuler.incomingContentForeground",{dark:re(Pm,qs),light:re(Pm,qs),hcDark:Hs,hcLight:Hs},g("overviewRulerIncomingContentForeground","Incoming overview ruler foreground for inline merge-conflicts.")),LW=S("editorOverviewRuler.commonContentForeground",{dark:re(Tm,qs),light:re(Tm,qs),hcDark:Hs,hcLight:Hs},g("overviewRulerCommonContentForeground","Common ancestor overview ruler foreground for inline merge-conflicts.")),FW=S("editorOverviewRuler.findMatchForeground",{dark:"#d186167e",light:"#d186167e",hcDark:"#AB5A00",hcLight:"#AB5A00"},g("overviewRulerFindMatchForeground","Overview ruler marker color for find matches. The color must not be opaque so as not to hide underlying decorations."),!0),AW=S("editorOverviewRuler.selectionHighlightForeground","#A0A0A0CC",g("overviewRulerSelectionHighlightForeground","Overview ruler marker color for selection highlights. The color must not be opaque so as not to hide underlying decorations."),!0),OW=S("problemsErrorIcon.foreground",Rm,g("problemsErrorIconForeground","The color used for the problems error icon.")),MW=S("problemsWarningIcon.foreground",js,g("problemsWarningIconForeground","The color used for the problems warning icon.")),NW=S("problemsInfoIcon.foreground",Gs,g("problemsInfoIconForeground","The color used for the problems info icon."));var rx=S("minimap.findMatchHighlight",{light:"#d18616",dark:"#d18616",hcDark:"#AB5A00",hcLight:"#0F4A85"},g("minimapFindMatchHighlight","Minimap marker color for find matches."),!0),zW=S("minimap.selectionOccurrenceHighlight",{light:"#c9c9c9",dark:"#676767",hcDark:"#ffffff",hcLight:"#0F4A85"},g("minimapSelectionOccurrenceHighlight","Minimap marker color for repeating editor selections."),!0),qW=S("minimap.selectionHighlight",{light:"#ADD6FF",dark:"#264F78",hcDark:"#ffffff",hcLight:"#0F4A85"},g("minimapSelectionHighlight","Minimap marker color for the editor selection."),!0),HW=S("minimap.infoHighlight",{dark:Gs,light:Gs,hcDark:Dm,hcLight:Dm},g("minimapInfo","Minimap marker color for infos.")),jW=S("minimap.warningHighlight",{dark:js,light:js,hcDark:Cm,hcLight:Cm},g("overviewRuleWarning","Minimap marker color for warnings.")),GW=S("minimap.errorHighlight",{dark:new F(new ye(255,18,18,.7)),light:new F(new ye(255,18,18,.7)),hcDark:new F(new ye(255,50,50,1)),hcLight:"#B5200D"},g("minimapError","Minimap marker color for errors.")),QW=S("minimap.background",null,g("minimapBackground","Minimap background color.")),JW=S("minimap.foregroundOpacity",F.fromHex("#000f"),g("minimapForegroundOpacity",'Opacity of foreground elements rendered in the minimap. For example, "#000000c0" will render the elements with 75% opacity.')),XW=S("minimapSlider.background",re($b,.5),g("minimapSliderBackground","Minimap slider background color.")),YW=S("minimapSlider.hoverBackground",re(zb,.5),g("minimapSliderHoverBackground","Minimap slider background color when hovering.")),ZW=S("minimapSlider.activeBackground",re(qb,.5),g("minimapSliderActiveBackground","Minimap slider background color when clicked on."));var oV=S("charts.foreground",we,g("chartsForeground","The foreground color used in charts.")),sV=S("charts.lines",re(we,.5),g("chartsLines","The color used for horizontal lines in charts.")),aV=S("charts.red",Rm,g("chartsRed","The red color used in chart visualizations.")),lV=S("charts.blue",Gs,g("chartsBlue","The blue color used in chart visualizations.")),cV=S("charts.yellow",js,g("chartsYellow","The yellow color used in chart visualizations.")),dV=S("charts.orange",rx,g("chartsOrange","The orange color used in chart visualizations.")),uV=S("charts.green",{dark:"#89D185",light:"#388A34",hcDark:"#89D185",hcLight:"#374e06"},g("chartsGreen","The green color used in chart visualizations.")),fV=S("charts.purple",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},g("chartsPurple","The purple color used in chart visualizations."));var vV=S("input.background",{dark:"#3C3C3C",light:F.white,hcDark:F.black,hcLight:F.white},g("inputBoxBackground","Input box background.")),IV=S("input.foreground",we,g("inputBoxForeground","Input box foreground.")),SV=S("input.border",{dark:null,light:null,hcDark:Pe,hcLight:Pe},g("inputBoxBorder","Input box border.")),jP=S("inputOption.activeBorder",{dark:"#007ACC",light:"#007ACC",hcDark:Pe,hcLight:Pe},g("inputBoxActiveOptionBorder","Border color of activated options in input fields.")),GP=S("inputOption.hoverBackground",{dark:"#5a5d5e80",light:"#b8b8b850",hcDark:null,hcLight:null},g("inputOption.hoverBackground","Background color of activated options in input fields.")),QP=S("inputOption.activeBackground",{dark:re(jn,.4),light:re(jn,.2),hcDark:F.transparent,hcLight:F.transparent},g("inputOption.activeBackground","Background hover color of options in input fields.")),JP=S("inputOption.activeForeground",{dark:F.white,light:F.black,hcDark:we,hcLight:we},g("inputOption.activeForeground","Foreground color of activated options in input fields.")),bV=S("input.placeholderForeground",{light:re(we,.5),dark:re(we,.5),hcDark:re(we,.7),hcLight:re(we,.7)},g("inputPlaceholderForeground","Input box foreground color for placeholder text.")),xV=S("inputValidation.infoBackground",{dark:"#063B49",light:"#D6ECF2",hcDark:F.black,hcLight:F.white},g("inputValidationInfoBackground","Input validation background color for information severity.")),EV=S("inputValidation.infoForeground",{dark:null,light:null,hcDark:null,hcLight:we},g("inputValidationInfoForeground","Input validation foreground color for information severity.")),wV=S("inputValidation.infoBorder",{dark:"#007acc",light:"#007acc",hcDark:Pe,hcLight:Pe},g("inputValidationInfoBorder","Input validation border color for information severity.")),PV=S("inputValidation.warningBackground",{dark:"#352A05",light:"#F6F5D2",hcDark:F.black,hcLight:F.white},g("inputValidationWarningBackground","Input validation background color for warning severity.")),TV=S("inputValidation.warningForeground",{dark:null,light:null,hcDark:null,hcLight:we},g("inputValidationWarningForeground","Input validation foreground color for warning severity.")),RV=S("inputValidation.warningBorder",{dark:"#B89500",light:"#B89500",hcDark:Pe,hcLight:Pe},g("inputValidationWarningBorder","Input validation border color for warning severity.")),CV=S("inputValidation.errorBackground",{dark:"#5A1D1D",light:"#F2DEDE",hcDark:F.black,hcLight:F.white},g("inputValidationErrorBackground","Input validation background color for error severity.")),DV=S("inputValidation.errorForeground",{dark:null,light:null,hcDark:null,hcLight:we},g("inputValidationErrorForeground","Input validation foreground color for error severity.")),_V=S("inputValidation.errorBorder",{dark:"#BE1100",light:"#BE1100",hcDark:Pe,hcLight:Pe},g("inputValidationErrorBorder","Input validation border color for error severity.")),hf=S("dropdown.background",{dark:"#3C3C3C",light:F.white,hcDark:F.black,hcLight:F.white},g("dropdownBackground","Dropdown background.")),kV=S("dropdown.listBackground",{dark:null,light:null,hcDark:F.black,hcLight:F.white},g("dropdownListBackground","Dropdown list background.")),km=S("dropdown.foreground",{dark:"#F0F0F0",light:we,hcDark:F.white,hcLight:we},g("dropdownForeground","Dropdown foreground.")),XP=S("dropdown.border",{dark:hf,light:"#CECECE",hcDark:Pe,hcLight:Pe},g("dropdownBorder","Dropdown border.")),YP=S("button.foreground",F.white,g("buttonForeground","Button foreground color.")),UV=S("button.separator",re(YP,.4),g("buttonSeparator","Button separator color.")),ff=S("button.background",{dark:"#0E639C",light:"#007ACC",hcDark:null,hcLight:"#0F4A85"},g("buttonBackground","Button background color.")),LV=S("button.hoverBackground",{dark:bn(ff,.2),light:Or(ff,.2),hcDark:ff,hcLight:ff},g("buttonHoverBackground","Button background color when hovering.")),FV=S("button.border",Pe,g("buttonBorder","Button border color.")),AV=S("button.secondaryForeground",{dark:F.white,light:F.white,hcDark:F.white,hcLight:we},g("buttonSecondaryForeground","Secondary button foreground color.")),ix=S("button.secondaryBackground",{dark:"#3A3D41",light:"#5F6A79",hcDark:null,hcLight:F.white},g("buttonSecondaryBackground","Secondary button background color.")),OV=S("button.secondaryHoverBackground",{dark:bn(ix,.2),light:Or(ix,.2),hcDark:null,hcLight:null},g("buttonSecondaryHoverBackground","Secondary button background color when hovering.")),pf=S("radio.activeForeground",JP,g("radioActiveForeground","Foreground color of active radio option.")),MV=S("radio.activeBackground",QP,g("radioBackground","Background color of active radio option.")),NV=S("radio.activeBorder",jP,g("radioActiveBorder","Border color of the active radio option.")),BV=S("radio.inactiveForeground",null,g("radioInactiveForeground","Foreground color of inactive radio option.")),WV=S("radio.inactiveBackground",null,g("radioInactiveBackground","Background color of inactive radio option.")),VV=S("radio.inactiveBorder",{light:re(pf,.2),dark:re(pf,.2),hcDark:re(pf,.4),hcLight:re(pf,.2)},g("radioInactiveBorder","Border color of the inactive radio option.")),KV=S("radio.inactiveHoverBackground",GP,g("radioHoverBackground","Background color of inactive active radio option when hovering.")),$V=S("checkbox.background",hf,g("checkbox.background","Background color of checkbox widget.")),zV=S("checkbox.selectBackground",xn,g("checkbox.select.background","Background color of checkbox widget when the element it's in is selected.")),qV=S("checkbox.foreground",km,g("checkbox.foreground","Foreground color of checkbox widget.")),HV=S("checkbox.border",XP,g("checkbox.border","Border color of checkbox widget.")),jV=S("checkbox.selectBorder",gc,g("checkbox.select.border","Border color of checkbox widget when the element it's in is selected.")),GV=S("keybindingLabel.background",{dark:new F(new ye(128,128,128,.17)),light:new F(new ye(221,221,221,.4)),hcDark:F.transparent,hcLight:F.transparent},g("keybindingLabelBackground","Keybinding label background color. The keybinding label is used to represent a keyboard shortcut.")),QV=S("keybindingLabel.foreground",{dark:F.fromHex("#CCCCCC"),light:F.fromHex("#555555"),hcDark:F.white,hcLight:we},g("keybindingLabelForeground","Keybinding label foreground color. The keybinding label is used to represent a keyboard shortcut.")),JV=S("keybindingLabel.border",{dark:new F(new ye(51,51,51,.6)),light:new F(new ye(204,204,204,.4)),hcDark:new F(new ye(111,195,223)),hcLight:Pe},g("keybindingLabelBorder","Keybinding label border color. The keybinding label is used to represent a keyboard shortcut.")),XV=S("keybindingLabel.bottomBorder",{dark:new F(new ye(68,68,68,.6)),light:new F(new ye(187,187,187,.4)),hcDark:new F(new ye(111,195,223)),hcLight:we},g("keybindingLabelBottomBorder","Keybinding label border bottom color. The keybinding label is used to represent a keyboard shortcut."));var rK=S("list.focusBackground",null,g("listFocusBackground","List/Tree background color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),iK=S("list.focusForeground",null,g("listFocusForeground","List/Tree foreground color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),oK=S("list.focusOutline",{dark:jn,light:jn,hcDark:jt,hcLight:jt},g("listFocusOutline","List/Tree outline color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),sK=S("list.focusAndSelectionOutline",null,g("listFocusAndSelectionOutline","List/Tree outline color for the focused item when the list/tree is active and selected. An active list/tree has keyboard focus, an inactive does not.")),ko=S("list.activeSelectionBackground",{dark:"#04395E",light:"#0060C0",hcDark:null,hcLight:F.fromHex("#0F4A85").transparent(.1)},g("listActiveSelectionBackground","List/Tree background color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),yc=S("list.activeSelectionForeground",{dark:F.white,light:F.white,hcDark:null,hcLight:null},g("listActiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),ox=S("list.activeSelectionIconForeground",null,g("listActiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),aK=S("list.inactiveSelectionBackground",{dark:"#37373D",light:"#E4E6F1",hcDark:null,hcLight:F.fromHex("#0F4A85").transparent(.1)},g("listInactiveSelectionBackground","List/Tree background color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),lK=S("list.inactiveSelectionForeground",null,g("listInactiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),cK=S("list.inactiveSelectionIconForeground",null,g("listInactiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),dK=S("list.inactiveFocusBackground",null,g("listInactiveFocusBackground","List/Tree background color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),uK=S("list.inactiveFocusOutline",null,g("listInactiveFocusOutline","List/Tree outline color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),fK=S("list.hoverBackground",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:F.white.transparent(.1),hcLight:F.fromHex("#0F4A85").transparent(.1)},g("listHoverBackground","List/Tree background when hovering over items using the mouse.")),pK=S("list.hoverForeground",null,g("listHoverForeground","List/Tree foreground when hovering over items using the mouse.")),hK=S("list.dropBackground",{dark:"#062F4A",light:"#D6EBFF",hcDark:null,hcLight:null},g("listDropBackground","List/Tree drag and drop background when moving items over other items when using the mouse.")),gK=S("list.dropBetweenBackground",{dark:gc,light:gc,hcDark:null,hcLight:null},g("listDropBetweenBackground","List/Tree drag and drop border color when moving items between items when using the mouse.")),gf=S("list.highlightForeground",{dark:"#2AAAFF",light:"#0066BF",hcDark:jn,hcLight:jn},g("highlight","List/Tree foreground color of the match highlights when searching inside the list/tree.")),mK=S("list.focusHighlightForeground",{dark:gf,light:Bb(ko,gf,"#BBE7FF"),hcDark:gf,hcLight:gf},g("listFocusHighlightForeground","List/Tree foreground color of the match highlights on actively focused items when searching inside the list/tree.")),yK=S("list.invalidItemForeground",{dark:"#B89500",light:"#B89500",hcDark:"#B89500",hcLight:"#B5200D"},g("invalidItemForeground","List/Tree foreground color for invalid items, for example an unresolved root in explorer.")),vK=S("list.errorForeground",{dark:"#F88070",light:"#B01011",hcDark:null,hcLight:null},g("listErrorForeground","Foreground color of list items containing errors.")),IK=S("list.warningForeground",{dark:"#CCA700",light:"#855F00",hcDark:null,hcLight:null},g("listWarningForeground","Foreground color of list items containing warnings.")),SK=S("listFilterWidget.background",{light:Or(xn,0),dark:bn(xn,0),hcDark:xn,hcLight:xn},g("listFilterWidgetBackground","Background color of the type filter widget in lists and trees.")),bK=S("listFilterWidget.outline",{dark:F.transparent,light:F.transparent,hcDark:"#f38518",hcLight:"#007ACC"},g("listFilterWidgetOutline","Outline color of the type filter widget in lists and trees.")),xK=S("listFilterWidget.noMatchesOutline",{dark:"#BE1100",light:"#BE1100",hcDark:Pe,hcLight:Pe},g("listFilterWidgetNoMatchesOutline","Outline color of the type filter widget in lists and trees, when there are no matches.")),EK=S("listFilterWidget.shadow",tx,g("listFilterWidgetShadow","Shadow color of the type filter widget in lists and trees.")),wK=S("list.filterMatchBackground",{dark:Oi,light:Oi,hcDark:null,hcLight:null},g("listFilterMatchHighlight","Background color of the filtered match.")),PK=S("list.filterMatchBorder",{dark:Mi,light:Mi,hcDark:Pe,hcLight:jt},g("listFilterMatchHighlightBorder","Border color of the filtered match.")),TK=S("list.deemphasizedForeground",{dark:"#8C8C8C",light:"#8E8E90",hcDark:"#A7A8A9",hcLight:"#666666"},g("listDeemphasizedForeground","List/Tree foreground color for items that are deemphasized.")),ZP=S("tree.indentGuidesStroke",{dark:"#585858",light:"#a9a9a9",hcDark:"#a9a9a9",hcLight:"#a5a5a5"},g("treeIndentGuidesStroke","Tree stroke color for the indentation guides.")),RK=S("tree.inactiveIndentGuidesStroke",re(ZP,.4),g("treeInactiveIndentGuidesStroke","Tree stroke color for the indentation guides that are not active.")),CK=S("tree.tableColumnsBorder",{dark:"#CCCCCC20",light:"#61616120",hcDark:null,hcLight:null},g("tableColumnsBorder","Table border color between columns.")),DK=S("tree.tableOddRowsBackground",{dark:re(we,.04),light:re(we,.04),hcDark:null,hcLight:null},g("tableOddRowsBackgroundColor","Background color for odd table rows.")),_K=S("editorActionList.background",xn,g("editorActionListBackground","Action List background color.")),kK=S("editorActionList.foreground",mc,g("editorActionListForeground","Action List foreground color.")),UK=S("editorActionList.focusForeground",yc,g("editorActionListFocusForeground","Action List foreground color for the focused item.")),LK=S("editorActionList.focusBackground",ko,g("editorActionListFocusBackground","Action List background color for the focused item."));var BK=S("menu.border",{dark:null,light:null,hcDark:Pe,hcLight:Pe},g("menuBorder","Border color of menus.")),WK=S("menu.foreground",km,g("menuForeground","Foreground color of menu items.")),VK=S("menu.background",hf,g("menuBackground","Background color of menu items.")),KK=S("menu.selectionForeground",yc,g("menuSelectionForeground","Foreground color of the selected menu item in menus.")),$K=S("menu.selectionBackground",ko,g("menuSelectionBackground","Background color of the selected menu item in menus.")),zK=S("menu.selectionBorder",{dark:null,light:null,hcDark:jt,hcLight:jt},g("menuSelectionBorder","Border color of the selected menu item in menus.")),qK=S("menu.separatorBackground",{dark:"#606060",light:"#D4D4D4",hcDark:Pe,hcLight:Pe},g("menuSeparatorBackground","Color of a separator menu item in menus."));var XK=S("quickInput.background",xn,g("pickerBackground","Quick picker background color. The quick picker widget is the container for pickers like the command palette.")),YK=S("quickInput.foreground",mc,g("pickerForeground","Quick picker foreground color. The quick picker widget is the container for pickers like the command palette.")),ZK=S("quickInputTitle.background",{dark:new F(new ye(255,255,255,.105)),light:new F(new ye(0,0,0,.06)),hcDark:"#000000",hcLight:F.white},g("pickerTitleBackground","Quick picker title background color. The quick picker widget is the container for pickers like the command palette.")),e$=S("pickerGroup.foreground",{dark:"#3794FF",light:"#0066BF",hcDark:F.white,hcLight:"#0F4A85"},g("pickerGroupForeground","Quick picker color for grouping labels.")),t$=S("pickerGroup.border",{dark:"#3F3F46",light:"#CCCEDB",hcDark:F.white,hcLight:"#0F4A85"},g("pickerGroupBorder","Quick picker color for grouping borders.")),sx=S("quickInput.list.focusBackground",null,"",void 0,g("quickInput.list.focusBackground deprecation","Please use quickInputList.focusBackground instead")),n$=S("quickInputList.focusForeground",yc,g("quickInput.listFocusForeground","Quick picker foreground color for the focused item.")),r$=S("quickInputList.focusIconForeground",ox,g("quickInput.listFocusIconForeground","Quick picker icon foreground color for the focused item.")),i$=S("quickInputList.focusBackground",{dark:xm(sx,ko),light:xm(sx,ko),hcDark:null,hcLight:null},g("quickInput.listFocusBackground","Quick picker background color for the focused item."));var c$=S("search.resultsInfoForeground",{light:we,dark:re(we,.65),hcDark:we,hcLight:we},g("search.resultsInfoForeground","Color of the text in the search viewlet's completion message.")),d$=S("searchEditor.findMatchBackground",{light:re(Oi,.66),dark:re(Oi,.66),hcDark:Oi,hcLight:Oi},g("searchEditor.queryMatch","Color of the Search Editor query matches.")),u$=S("searchEditor.findMatchBorder",{light:re(Mi,.66),dark:re(Mi,.66),hcDark:Mi,hcLight:Mi},g("searchEditor.editorFindMatchBorder","Border color of the Search Editor query matches."));var eT={IconContribution:"base.contributions.icons"},tT;(t=>{function r(e,n){let i=e.defaults;for(;Fn.isThemeIcon(i);){let o=Qs.getIcon(i.id);if(!o)return;i=o.defaults}return i}t.getDefinition=r})(tT||={});var nT;(e=>{function r(n){return{weight:n.weight,style:n.style,src:n.src.map(i=>({format:i.format,location:i.location.toString()}))}}e.toJSONObject=r;function t(n){let i=o=>De(o)?o:void 0;if(n&&Array.isArray(n.src)&&n.src.every(o=>De(o.format)&&De(o.location)))return{weight:i(n.weight),style:i(n.style),src:n.src.map(o=>({format:o.format,location:C.parse(o.location)}))}}e.fromJSONObject=t})(nT||={});var Um=class{_onDidChange=new P;onDidChange=this._onDidChange.event;iconsById;iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:g("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:g("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}};iconReferenceSchema={type:"string",pattern:`^${Fn.iconNameExpression}$`,enum:[],enumDescriptions:[]};iconFontsById;constructor(){this.iconsById={},this.iconFontsById={}}registerIcon(t,e,n,i){let o=this.iconsById[t];if(o){if(n&&!o.description){o.description=n,this.iconSchema.properties[t].markdownDescription=`${n} $(${t})`;let l=this.iconReferenceSchema.enum.indexOf(t);l!==-1&&(this.iconReferenceSchema.enumDescriptions[l]=n),this._onDidChange.fire()}return o}let s={id:t,description:n,defaults:e,deprecationMessage:i};this.iconsById[t]=s;let a={$ref:"#/definitions/icons"};return i&&(a.deprecationMessage=i),n&&(a.markdownDescription=`${n}: $(${t})`),this.iconSchema.properties[t]=a,this.iconReferenceSchema.enum.push(t),this.iconReferenceSchema.enumDescriptions.push(n||""),this._onDidChange.fire(),{id:t}}deregisterIcon(t){delete this.iconsById[t],delete this.iconSchema.properties[t];let e=this.iconReferenceSchema.enum.indexOf(t);e!==-1&&(this.iconReferenceSchema.enum.splice(e,1),this.iconReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChange.fire()}getIcons(){return Object.keys(this.iconsById).map(t=>this.iconsById[t])}getIcon(t){return this.iconsById[t]}getIconSchema(){return this.iconSchema}getIconReferenceSchema(){return this.iconReferenceSchema}registerIconFont(t,e){let n=this.iconFontsById[t];return n||(this.iconFontsById[t]=e,this._onDidChange.fire(),e)}deregisterIconFont(t){delete this.iconFontsById[t]}getIconFont(t){return this.iconFontsById[t]}toString(){let t=(o,s)=>o.id.localeCompare(s.id),e=o=>{for(;Fn.isThemeIcon(o.defaults);)o=this.iconsById[o.defaults.id];return`codicon codicon-${o?o.id:""}`},n=[];n.push("| preview     | identifier                        | default codicon ID                | description"),n.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");let i=Object.keys(this.iconsById).map(o=>this.iconsById[o]);for(let o of i.filter(s=>!!s.description).sort(t))n.push(`|<i class="${e(o)}"></i>|${o.id}|${Fn.isThemeIcon(o.defaults)?o.defaults.id:o.id}|${o.description||""}|`);n.push("| preview     | identifier                        "),n.push("| ----------- | --------------------------------- |");for(let o of i.filter(s=>!Fn.isThemeIcon(s.defaults)).sort(t))n.push(`|<i class="${e(o)}"></i>|${o.id}|`);return n.join(`
`)}},Qs=new Um;Ne.add(eT.IconContribution,Qs);function Lm(r,t,e,n){return Qs.registerIcon(r,t,e,n)}function rT(){let r=CS();for(let t in r){let e="\\"+r[t].toString(16);Qs.registerIcon(t,{fontCharacter:e})}}rT();var lx="vscode://schemas/icons",cx=Ne.as(ti.JSONContribution);cx.registerSchema(lx,Qs.getIconSchema());var ax=new mt(()=>cx.notifySchemaChanged(lx),200);Qs.onDidChange(()=>{ax.isScheduled()||ax.schedule()});var W$=Lm("widget-close",gr.close,g("widgetClose","Icon for the close action in widgets.")),V$=Lm("goto-previous-location",gr.arrowUp,g("previousChangeIcon","Icon for goto previous editor location.")),K$=Lm("goto-next-location",gr.arrowDown,g("nextChangeIcon","Icon for goto next editor location.")),$$=Fn.modify(gr.sync,"spin"),z$=Fn.modify(gr.loading,"spin");var dz=M("themeService");var uz=gr.file,fz=gr.folder;var iT={ThemingContribution:"base.contributions.theming"},Fm=class{themingParticipants=[];onThemingParticipantAddedEmitter;constructor(){this.themingParticipants=[],this.onThemingParticipantAddedEmitter=new P}onColorThemeChange(t){return this.themingParticipants.push(t),this.onThemingParticipantAddedEmitter.fire(t),J(()=>{let e=this.themingParticipants.indexOf(t);this.themingParticipants.splice(e,1)})}get onThemingParticipantAdded(){return this.onThemingParticipantAddedEmitter.event}getThemingParticipants(){return this.themingParticipants}},oT=new Fm;Ne.add(iT.ThemingContribution,oT);var vc={exports:{}};(function(){function t(o){let s=[];typeof o=="number"&&s.push("code/timeOrigin",o);function a(c){s.push(c,Date.now())}function l(){let c=[];for(let d=0;d<s.length;d+=2)c.push({name:s[d],startTime:s[d+1]});return c}return{mark:a,getMarks:l}}function e(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?t():{mark(o){performance.mark(o)},getMarks(){let o=performance.timeOrigin;typeof o!="number"&&(o=performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart);let s=[{name:"code/timeOrigin",startTime:Math.round(o)}];for(let a of performance.getEntriesByType("mark"))s.push({name:a.name,startTime:Math.round(o+a.startTime)});return s}};if(typeof process=="object"){let o=performance?.timeOrigin;return t(o)}else return console.trace("perf-util loaded in UNKNOWN environment"),t()}function n(o){return o.MonacoPerformanceMarks||(o.MonacoPerformanceMarks=e()),o.MonacoPerformanceMarks}var i;typeof global=="object"?i=global:typeof self=="object"?i=self:i={},typeof vc=="object"&&typeof vc.exports=="object"?vc.exports=n(i):(console.trace("perf-util defined in UNKNOWN context (neither requirejs or commonjs)"),i.perf=n(i))})();var Mr=vc.exports.mark,hz=vc.exports.getMarks;var Ni=M("nativeHostService");var Bi=M("mainProcessService"),mf=class{constructor(t,e){this.server=t;this.router=e}getChannel(t){return this.server.getChannel(t,this.router)}registerChannel(t,e){this.server.registerChannel(t,e)}};var Js=class extends _{constructor(e,n,i,o){super();this.environmentService=e;this.logService=n;this.nativeHostService=i;this.mainProcessService=o;this._register(new mt(()=>{this.cleanUpStorage()},30*1e3)).schedule()}async cleanUpStorage(){this.logService.trace("[storage cleanup]: Starting to clean up workspace storage folders for unused empty workspaces.");try{let e=this.environmentService.workspaceStorageHome.with({scheme:ne.file}).fsPath,n=await ce.readdir(e),i=new Xu(this.mainProcessService.getChannel("storage"));await Promise.all(n.map(async o=>{let s=W(e,o);o.length===Ub||o===pb.id||(await this.nativeHostService.getWindows({includeAuxiliaryWindows:!1})).some(c=>c.workspace?.id===o)||await i.isUsed(s)||(this.logService.trace(`[storage cleanup]: Deleting workspace storage folder ${o} as it seems to be an unused empty workspace.`),await ce.rm(s))}))}catch(e){ze(e)}}};Js=E([m(0,St),m(1,z),m(2,Ni),m(3,Bi)],Js);var Am=M("checksumService");import{createHash as aT}from"crypto";var Xs=class{constructor(t){this.fileService=t}async checksum(t){let e=(await this.fileService.readFileStream(t)).value;return new Promise((n,i)=>{let o=aT("sha256");fs(e,{onData:s=>o.update(s.buffer),onError:s=>i(s),onEnd:()=>n(o.digest("base64").replace(/=+$/,""))})})}};Xs=E([m(0,G)],Xs);var vf;(t=>t.DEFAULT={allowTrailingComma:!0})(vf||={});function Mm(r,t=!1){let e=0,n=r.length,i="",o=0,s=16,a=0;function l(y){let I=0,x=0;for(;I<y;){let T=r.charCodeAt(e);if(T>=48&&T<=57)x=x*16+T-48;else if(T>=65&&T<=70)x=x*16+T-65+10;else if(T>=97&&T<=102)x=x*16+T-97+10;else break;e++,I++}return I<y&&(x=-1),x}function c(y){e=y,i="",o=0,s=16,a=0}function d(){let y=e;if(r.charCodeAt(e)===48)e++;else for(e++;e<r.length&&Ys(r.charCodeAt(e));)e++;if(e<r.length&&r.charCodeAt(e)===46)if(e++,e<r.length&&Ys(r.charCodeAt(e)))for(e++;e<r.length&&Ys(r.charCodeAt(e));)e++;else return a=3,r.substring(y,e);let I=e;if(e<r.length&&(r.charCodeAt(e)===69||r.charCodeAt(e)===101))if(e++,(e<r.length&&r.charCodeAt(e)===43||r.charCodeAt(e)===45)&&e++,e<r.length&&Ys(r.charCodeAt(e))){for(e++;e<r.length&&Ys(r.charCodeAt(e));)e++;I=e}else a=3;return r.substring(y,I)}function u(){let y="",I=e;for(;;){if(e>=n){y+=r.substring(I,e),a=2;break}let x=r.charCodeAt(e);if(x===34){y+=r.substring(I,e),e++;break}if(x===92){if(y+=r.substring(I,e),e++,e>=n){a=2;break}switch(r.charCodeAt(e++)){case 34:y+='"';break;case 92:y+="\\";break;case 47:y+="/";break;case 98:y+="\b";break;case 102:y+="\f";break;case 110:y+=`
`;break;case 114:y+="\r";break;case 116:y+="	";break;case 117:{let R=l(4);R>=0?y+=String.fromCharCode(R):a=4;break}default:a=5}I=e;continue}if(x>=0&&x<=31)if(yf(x)){y+=r.substring(I,e),a=2;break}else a=6;e++}return y}function f(){if(i="",a=0,o=e,e>=n)return o=n,s=17;let y=r.charCodeAt(e);if(Om(y)){do e++,i+=String.fromCharCode(y),y=r.charCodeAt(e);while(Om(y));return s=15}if(yf(y))return e++,i+=String.fromCharCode(y),y===13&&r.charCodeAt(e)===10&&(e++,i+=`
`),s=14;switch(y){case 123:return e++,s=1;case 125:return e++,s=2;case 91:return e++,s=3;case 93:return e++,s=4;case 58:return e++,s=6;case 44:return e++,s=5;case 34:return e++,i=u(),s=10;case 47:{let I=e-1;if(r.charCodeAt(e+1)===47){for(e+=2;e<n&&!yf(r.charCodeAt(e));)e++;return i=r.substring(I,e),s=12}if(r.charCodeAt(e+1)===42){e+=2;let x=n-1,T=!1;for(;e<x;){if(r.charCodeAt(e)===42&&r.charCodeAt(e+1)===47){e+=2,T=!0;break}e++}return T||(e++,a=1),i=r.substring(I,e),s=13}return i+=String.fromCharCode(y),e++,s=16}case 45:if(i+=String.fromCharCode(y),e++,e===n||!Ys(r.charCodeAt(e)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=d(),s=11;default:for(;e<n&&h(y);)e++,y=r.charCodeAt(e);if(o!==e){switch(i=r.substring(o,e),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(y),e++,s=16}}function h(y){if(Om(y)||yf(y))return!1;switch(y){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function v(){let y;do y=f();while(y>=12&&y<=15);return y}return{setPosition:c,getPosition:()=>e,scan:t?v:f,getToken:()=>s,getTokenValue:()=>i,getTokenOffset:()=>o,getTokenLength:()=>e-o,getTokenError:()=>a}}function Om(r){return r===32||r===9||r===11||r===12||r===160||r===5760||r>=8192&&r<=8203||r===8239||r===8287||r===12288||r===65279}function yf(r){return r===10||r===13||r===8232||r===8233}function Ys(r){return r>=48&&r<=57}function Ze(r,t=[],e=vf.DEFAULT){let n=null,i=[],o=[];function s(l){Array.isArray(i)?i.push(l):n!==null&&(i[n]=l)}return Zs(r,{onObjectBegin:()=>{let l={};s(l),o.push(i),i=l,n=null},onObjectProperty:l=>{n=l},onObjectEnd:()=>{i=o.pop()},onArrayBegin:()=>{let l=[];s(l),o.push(i),i=l,n=null},onArrayEnd:()=>{i=o.pop()},onLiteralValue:s,onError:(l,c,d)=>{t.push({error:l,offset:c,length:d})}},e),i[0]}function dx(r,t=[],e=vf.DEFAULT){let n={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(l){n.type==="property"&&(n.length=l-n.offset,n=n.parent)}function o(l){return n.children.push(l),l}Zs(r,{onObjectBegin:l=>{n=o({type:"object",offset:l,length:-1,parent:n,children:[]})},onObjectProperty:(l,c,d)=>{n=o({type:"property",offset:c,length:-1,parent:n,children:[]}),n.children.push({type:"string",value:l,offset:c,length:d,parent:n})},onObjectEnd:(l,c)=>{n.length=l+c-n.offset,n=n.parent,i(l+c)},onArrayBegin:(l,c)=>{n=o({type:"array",offset:l,length:-1,parent:n,children:[]})},onArrayEnd:(l,c)=>{n.length=l+c-n.offset,n=n.parent,i(l+c)},onLiteralValue:(l,c,d)=>{o({type:Wi(l),offset:c,length:d,parent:n,value:l}),i(c+d)},onSeparator:(l,c,d)=>{n.type==="property"&&(l===":"?n.colonOffset=c:l===","&&i(c))},onError:(l,c,d)=>{t.push({error:l,offset:c,length:d})}},e);let a=n.children[0];return a&&delete a.parent,a}function Nm(r,t){if(!r)return;let e=r;for(let n of t)if(typeof n=="string"){if(e.type!=="object"||!Array.isArray(e.children))return;let i=!1;for(let o of e.children)if(Array.isArray(o.children)&&o.children[0].value===n){e=o.children[1],i=!0;break}if(!i)return}else{let i=n;if(e.type!=="array"||i<0||!Array.isArray(e.children)||i>=e.children.length)return;e=e.children[i]}return e}function Zs(r,t,e=vf.DEFAULT){let n=Mm(r,!1);function i(B){return B?()=>B(n.getTokenOffset(),n.getTokenLength()):()=>!0}function o(B){return B?Ee=>B(Ee,n.getTokenOffset(),n.getTokenLength()):()=>!0}let s=i(t.onObjectBegin),a=o(t.onObjectProperty),l=i(t.onObjectEnd),c=i(t.onArrayBegin),d=i(t.onArrayEnd),u=o(t.onLiteralValue),f=o(t.onSeparator),h=i(t.onComment),v=o(t.onError),y=e&&e.disallowComments,I=e&&e.allowTrailingComma;function x(){for(;;){let B=n.scan();switch(n.getTokenError()){case 4:T(14);break;case 5:T(15);break;case 3:T(13);break;case 1:y||T(11);break;case 2:T(12);break;case 6:T(16);break}switch(B){case 12:case 13:y?T(10):h();break;case 16:T(1);break;case 15:case 14:break;default:return B}}}function T(B,Ee=[],se=[]){if(v(B),Ee.length+se.length>0){let ie=n.getToken();for(;ie!==17;){if(Ee.indexOf(ie)!==-1){x();break}else if(se.indexOf(ie)!==-1)break;ie=x()}}}function R(B){let Ee=n.getTokenValue();return B?u(Ee):a(Ee),x(),!0}function w(){switch(n.getToken()){case 11:{let B=0;try{B=JSON.parse(n.getTokenValue()),typeof B!="number"&&(T(2),B=0)}catch{T(2)}u(B);break}case 7:u(null);break;case 8:u(!0);break;case 9:u(!1);break;default:return!1}return x(),!0}function L(){return n.getToken()!==10?(T(3,[],[2,5]),!1):(R(!1),n.getToken()===6?(f(":"),x(),U()||T(4,[],[2,5])):T(5,[],[2,5]),!0)}function Q(){s(),x();let B=!1;for(;n.getToken()!==2&&n.getToken()!==17;){if(n.getToken()===5){if(B||T(4,[],[]),f(","),x(),n.getToken()===2&&I)break}else B&&T(6,[],[]);L()||T(4,[],[2,5]),B=!0}return l(),n.getToken()!==2?T(7,[2],[]):x(),!0}function K(){c(),x();let B=!1;for(;n.getToken()!==4&&n.getToken()!==17;){if(n.getToken()===5){if(B||T(4,[],[]),f(","),x(),n.getToken()===4&&I)break}else B&&T(6,[],[]);U()||T(4,[],[4,5]),B=!0}return d(),n.getToken()!==4?T(8,[4],[]):x(),!0}function U(){switch(n.getToken()){case 3:return K();case 1:return Q();case 10:return R(!0);default:return w()}}return x(),n.getToken()===17?e.allowEmptyContent?!0:(T(4,[],[]),!1):U()?(n.getToken()!==17&&T(9,[],[]),!0):(T(4,[],[]),!1)}function Wi(r){switch(typeof r){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(r){if(Array.isArray(r))return"array"}else return"null";return"object"}default:return"null"}}function ux(r,t,e){let n,i,o,s,a;if(t){for(s=t.offset,a=s+t.length,o=s;o>0&&!Ic(r,o-1);)o--;let R=a;for(;R<r.length&&!Ic(r,R);)R++;i=r.substring(o,R),n=cT(i,e)}else i=r,n=0,o=0,s=0,a=r.length;let l=Wm(e,r),c=!1,d=0,u;e.insertSpaces?u=Bm(" ",e.tabSize||4):u="	";let f=Mm(i,!1),h=!1;function v(){return l+Bm(u,n+d)}function y(){let R=f.scan();for(c=!1;R===15||R===14;)c=c||R===14,R=f.scan();return h=R===16||f.getTokenError()!==0,R}let I=[];function x(R,w,L){!h&&w<a&&L>s&&r.substring(w,L)!==R&&I.push({offset:w,length:L-w,content:R})}let T=y();if(T!==17){let R=f.getTokenOffset()+o,w=Bm(u,n);x(w,o,R)}for(;T!==17;){let R=f.getTokenOffset()+f.getTokenLength()+o,w=y(),L="";for(;!c&&(w===12||w===13);){let K=f.getTokenOffset()+o;x(" ",R,K),R=f.getTokenOffset()+f.getTokenLength()+o,L=w===12?v():"",w=y()}if(w===2)T!==1&&(d--,L=v());else if(w===4)T!==3&&(d--,L=v());else{switch(T){case 3:case 1:d++,L=v();break;case 5:case 12:L=v();break;case 13:c?L=v():L=" ";break;case 6:L=" ";break;case 10:if(w===6){L="";break}case 7:case 8:case 9:case 11:case 2:case 4:w===12||w===13?L=" ":w!==5&&w!==17&&(h=!0);break;case 16:h=!0;break}c&&(w===12||w===13)&&(L=v())}let Q=f.getTokenOffset()+o;x(L,R,Q),T=w}return I}function ni(r,t){let e=JSON.stringify(r,void 0,t.insertSpaces?t.tabSize||4:"	");return t.eol!==void 0?e.replace(/\r\n|\r|\n/g,t.eol):e}function Bm(r,t){let e="";for(let n=0;n<t;n++)e+=r;return e}function cT(r,t){let e=0,n=0,i=t.tabSize||4;for(;e<r.length;){let o=r.charAt(e);if(o===" ")n++;else if(o==="	")n+=i;else break;e++}return Math.floor(n/i)}function Wm(r,t){for(let e=0;e<t.length;e++){let n=t.charAt(e);if(n==="\r")return e+1<t.length&&t.charAt(e+1)===`
`?`\r
`:"\r";if(n===`
`)return`
`}return r&&r.eol||`
`}function Ic(r,t){return`\r
`.indexOf(r.charAt(t))!==-1}function ea(r,t,e,n,i){let o=t.slice(),a=dx(r,[]),l,c;for(;o.length>0&&(c=o.pop(),l=Nm(a,o),l===void 0&&e!==void 0);)typeof c=="string"?e={[c]:e}:e=[e];if(l)if(l.type==="object"&&typeof c=="string"&&Array.isArray(l.children)){let d=Nm(l,[c]);if(d!==void 0)if(e===void 0){if(!d.parent)throw new Error("Malformed AST");let u=l.children.indexOf(d.parent),f,h=d.parent.offset+d.parent.length;if(u>0){let v=l.children[u-1];f=v.offset+v.length}else f=l.offset+1,l.children.length>1&&(h=l.children[1].offset);return Vi(r,{offset:f,length:h-f,content:""},n)}else return Vi(r,{offset:d.offset,length:d.length,content:JSON.stringify(e)},n);else{if(e===void 0)return[];let u=`${JSON.stringify(c)}: ${JSON.stringify(e)}`,f=i?i(l.children.map(v=>v.children[0].value)):l.children.length,h;if(f>0){let v=l.children[f-1];h={offset:v.offset+v.length,length:0,content:","+u}}else l.children.length===0?h={offset:l.offset+1,length:0,content:u}:h={offset:l.offset+1,length:0,content:u+","};return Vi(r,h,n)}}else if(l.type==="array"&&typeof c=="number"&&Array.isArray(l.children))if(e!==void 0){let d=`${JSON.stringify(e)}`,u;if(l.children.length===0||c===0)u={offset:l.offset+1,length:0,content:l.children.length===0?d:d+","};else{let f=c===-1||c>l.children.length?l.children.length:c,h=l.children[f-1];u={offset:h.offset+h.length,length:0,content:","+d}}return Vi(r,u,n)}else{let d=c,u=l.children[d],f;if(l.children.length===1)f={offset:l.offset+1,length:l.length-2,content:""};else if(l.children.length-1===d){let h=l.children[d-1],v=h.offset+h.length,y=l.offset+l.length;f={offset:v,length:y-2-v,content:""}}else f={offset:u.offset,length:l.children[d+1].offset-u.offset,content:""};return Vi(r,f,n)}else throw new Error(`Can not add ${typeof c!="number"?"index":"property"} to parent of type ${l.type}`);else return e===void 0?[]:Vi(r,{offset:a?a.offset:0,length:a?a.length:0,content:JSON.stringify(e)},n)}function Vi(r,t,e){let n=Vm(r,t),i=t.offset,o=t.offset+t.content.length;if(t.length===0||t.content.length===0){for(;i>0&&!Ic(n,i-1);)i--;for(;o<n.length&&!Ic(n,o);)o++}let s=ux(n,{offset:i,length:o-i},e);for(let l=s.length-1;l>=0;l--){let c=s[l];n=Vm(n,c),i=Math.min(i,c.offset),o=Math.max(o,c.offset+c.length),o+=c.content.length-c.length}let a=r.length-(n.length-o)-i;return[{offset:i,length:a,content:n.substring(i,o)}]}function Vm(r,t){return r.substring(0,t.offset)+t.content+r.substring(t.offset+t.length)}function If(r,t){let e=t.slice(0).sort((i,o)=>{let s=i.offset-o.offset;return s===0?i.length-o.length:s}),n=r.length;for(let i=e.length-1;i>=0;i--){let o=e[i];if(o.offset+o.length<=n)r=Vm(r,o);else throw new Error("Overlapping edit");n=o.offset}return r}function Sc(r){return Object.isFrozen(r)?r:ub(r)}var ut=class r{constructor(t,e,n,i,o){this._contents=t;this._keys=e;this._overrides=n;this.raw=i;this.logService=o}static createEmptyModel(t){return new r({},[],[],void 0,t)}overrideConfigurations=new Map;_rawConfiguration;get rawConfiguration(){if(!this._rawConfiguration)if(this.raw?.length){let t=this.raw.map(e=>{if(e instanceof r)return e;let n=new ta("",this.logService);return n.parseRaw(e),n.configurationModel});this._rawConfiguration=t.reduce((e,n)=>n===e?n:e.merge(n),t[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this._contents}get overrides(){return this._overrides}get keys(){return this._keys}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}getValue(t){return t?dc(this.contents,t):this.contents}inspect(t,e){let n=this;return{get value(){return Sc(n.rawConfiguration.getValue(t))},get override(){return e?Sc(n.rawConfiguration.getOverrideValue(t,e)):void 0},get merged(){return Sc(e?n.rawConfiguration.override(e).getValue(t):n.rawConfiguration.getValue(t))},get overrides(){let i=[];for(let{contents:o,identifiers:s,keys:a}of n.rawConfiguration.overrides){let l=new r(o,a,[],void 0,n.logService).getValue(t);l!==void 0&&i.push({identifiers:s,value:l})}return i.length?Sc(i):void 0}}}getOverrideValue(t,e){let n=this.getContentsForOverrideIdentifer(e);return n?t?dc(n,t):n:void 0}getKeysForOverrideIdentifier(t){let e=[];for(let n of this.overrides)n.identifiers.includes(t)&&e.push(...n.keys);return gt(e)}getAllOverrideIdentifiers(){let t=[];for(let e of this.overrides)t.push(...e.identifiers);return gt(t)}override(t){let e=this.overrideConfigurations.get(t);return e||(e=this.createOverrideConfigurationModel(t),this.overrideConfigurations.set(t,e)),e}merge(...t){let e=Ht(this.contents),n=Ht(this.overrides),i=[...this.keys],o=this.raw?.length?[...this.raw]:[this];for(let s of t)if(o.push(...s.raw?.length?s.raw:[s]),!s.isEmpty()){this.mergeContents(e,s.contents);for(let a of s.overrides){let[l]=n.filter(c=>Pt(c.identifiers,a.identifiers));l?(this.mergeContents(l.contents,a.contents),l.keys.push(...a.keys),l.keys=gt(l.keys)):n.push(Ht(a))}for(let a of s.keys)i.indexOf(a)===-1&&i.push(a)}return new r(e,i,n,o.every(s=>s instanceof r)?void 0:o,this.logService)}createOverrideConfigurationModel(t){let e=this.getContentsForOverrideIdentifer(t);if(!e||typeof e!="object"||!Object.keys(e).length)return this;let n={};for(let i of gt([...Object.keys(this.contents),...Object.keys(e)])){let o=this.contents[i],s=e[i];s&&(typeof o=="object"&&typeof s=="object"?(o=Ht(o),this.mergeContents(o,s)):o=s),n[i]=o}return new r(n,this.keys,this.overrides,void 0,this.logService)}mergeContents(t,e){for(let n of Object.keys(e)){if(n in t&&He(t[n])&&He(e[n])){this.mergeContents(t[n],e[n]);continue}t[n]=Ht(e[n])}}getContentsForOverrideIdentifer(t){let e=null,n=null,i=o=>{o&&(n?this.mergeContents(n,o):n=Ht(o))};for(let o of this.overrides)o.identifiers.length===1&&o.identifiers[0]===t?e=o.contents:o.identifiers.includes(t)&&i(o.contents);return i(e),n}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(t,e){this.updateValue(t,e,!0)}setValue(t,e){this.updateValue(t,e,!1)}removeValue(t){let e=this.keys.indexOf(t);e!==-1&&(this.keys.splice(e,1),mb(this.contents,t),Ar.test(t)&&this.overrides.splice(this.overrides.findIndex(n=>Pt(n.identifiers,Ks(t))),1))}updateValue(t,e,n){if(am(this.contents,t,e,i=>this.logService.error(i)),n=n||this.keys.indexOf(t)===-1,n&&this.keys.push(t),Ar.test(t)){let i=Ks(t),o={identifiers:i,keys:Object.keys(this.contents[t]),contents:Mu(this.contents[t],a=>this.logService.error(a))},s=this.overrides.findIndex(a=>Pt(a.identifiers,i));s!==-1?this.overrides[s]=o:this.overrides.push(o)}}},ta=class{constructor(t,e){this._name=t;this.logService=e}_raw=null;_configurationModel=null;_restrictedConfigurations=[];_parseErrors=[];get configurationModel(){return this._configurationModel||ut.createEmptyModel(this.logService)}get restrictedConfigurations(){return this._restrictedConfigurations}get errors(){return this._parseErrors}parse(t,e){if(!ct(t)){let n=this.doParseContent(t);this.parseRaw(n,e)}}reparse(t){this._raw&&this.parseRaw(this._raw,t)}parseRaw(t,e){this._raw=t;let{contents:n,keys:i,overrides:o,restricted:s,hasExcludedProperties:a}=this.doParseRaw(t,e);this._configurationModel=new ut(n,i,o,a?[t]:void 0,this.logService),this._restrictedConfigurations=s||[]}doParseContent(t){let e={},n=null,i=[],o=[],s=[];function a(c){Array.isArray(i)?i.push(c):n!==null&&(i[n]=c)}let l={onObjectBegin:()=>{let c={};a(c),o.push(i),i=c,n=null},onObjectProperty:c=>{n=c},onObjectEnd:()=>{i=o.pop()},onArrayBegin:()=>{let c=[];a(c),o.push(i),i=c,n=null},onArrayEnd:()=>{i=o.pop()},onLiteralValue:a,onError:(c,d,u)=>{s.push({error:c,offset:d,length:u})}};if(t)try{Zs(t,l),e=i[0]||{}}catch(c){this.logService.error(`Error while parsing settings file ${this._name}: ${c}`),this._parseErrors=[c]}return e}doParseRaw(t,e){let n=Ne.as(Wt.Configuration).getConfigurationProperties(),i=this.filter(t,n,!0,e);t=i.raw;let o=Mu(t,l=>this.logService.error(`Conflict in settings file ${this._name}: ${l}`)),s=Object.keys(t),a=this.toOverrides(t,l=>this.logService.error(`Conflict in settings file ${this._name}: ${l}`));return{contents:o,keys:s,overrides:a,restricted:i.restricted,hasExcludedProperties:i.hasExcludedProperties}}filter(t,e,n,i){let o=!1;if(!i?.scopes&&!i?.skipRestricted&&!i?.exclude?.length)return{raw:t,restricted:[],hasExcludedProperties:o};let s={},a=[];for(let l in t)if(Ar.test(l)&&n){let c=this.filter(t[l],e,!1,i);s[l]=c.raw,o=o||c.hasExcludedProperties,a.push(...c.restricted)}else{let c=e[l],d=c?typeof c.scope<"u"?c.scope:3:void 0;c?.restricted&&a.push(l),!i.exclude?.includes(l)&&(i.include?.includes(l)||(d===void 0||i.scopes===void 0||i.scopes.includes(d))&&!(i.skipRestricted&&c?.restricted))?s[l]=t[l]:o=!0}return{raw:s,restricted:a,hasExcludedProperties:o}}toOverrides(t,e){let n=[];for(let i of Object.keys(t))if(Ar.test(i)){let o={};for(let s in t[i])o[s]=t[i][s];n.push({identifiers:Ks(i),keys:Object.keys(o),contents:Mu(o,e)})}return n}},Sf=class extends _{constructor(e,n,i,o,s){super();this.userSettingsResource=e;this.parseOptions=n;this.fileService=o;this.logService=s;this.parser=new ta(this.userSettingsResource.toString(),s),this._register(this.fileService.watch(i.dirname(this.userSettingsResource))),this._register(this.fileService.watch(this.userSettingsResource)),this._register(O.any(O.filter(this.fileService.onDidFilesChange,a=>a.contains(this.userSettingsResource)),O.filter(this.fileService.onDidRunOperation,a=>(a.isOperation(0)||a.isOperation(3)||a.isOperation(1)||a.isOperation(4))&&i.isEqual(a.resource,e)))(()=>this._onDidChange.fire()))}parser;_onDidChange=this._register(new P);onDidChange=this._onDidChange.event;async loadConfiguration(){try{let e=await this.fileService.readFile(this.userSettingsResource);return this.parser.parse(e.value.toString()||"{}",this.parseOptions),this.parser.configurationModel}catch{return ut.createEmptyModel(this.logService)}}reparse(e){return e&&(this.parseOptions=e),this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}},Km=class{constructor(t,e,n,i,o,s,a,l,c,d,u,f,h){this.key=t;this.overrides=e;this._value=n;this.overrideIdentifiers=i;this.defaultConfiguration=o;this.policyConfiguration=s;this.applicationConfiguration=a;this.userConfiguration=l;this.localUserConfiguration=c;this.remoteUserConfiguration=d;this.workspaceConfiguration=u;this.folderConfigurationModel=f;this.memoryConfigurationModel=h}get value(){return Sc(this._value)}toInspectValue(t){return t?.value!==void 0||t?.override!==void 0||t?.overrides!==void 0?t:void 0}_defaultInspectValue;get defaultInspectValue(){return this._defaultInspectValue||(this._defaultInspectValue=this.defaultConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._defaultInspectValue}get defaultValue(){return this.defaultInspectValue.merged}get default(){return this.toInspectValue(this.defaultInspectValue)}_policyInspectValue;get policyInspectValue(){return this._policyInspectValue===void 0&&(this._policyInspectValue=this.policyConfiguration?this.policyConfiguration.inspect(this.key):null),this._policyInspectValue}get policyValue(){return this.policyInspectValue?.merged}get policy(){return this.policyInspectValue?.value!==void 0?{value:this.policyInspectValue.value}:void 0}_applicationInspectValue;get applicationInspectValue(){return this._applicationInspectValue===void 0&&(this._applicationInspectValue=this.applicationConfiguration?this.applicationConfiguration.inspect(this.key):null),this._applicationInspectValue}get applicationValue(){return this.applicationInspectValue?.merged}get application(){return this.toInspectValue(this.applicationInspectValue)}_userInspectValue;get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.userConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get userValue(){return this.userInspectValue.merged}get user(){return this.toInspectValue(this.userInspectValue)}_userLocalInspectValue;get userLocalInspectValue(){return this._userLocalInspectValue||(this._userLocalInspectValue=this.localUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userLocalInspectValue}get userLocalValue(){return this.userLocalInspectValue.merged}get userLocal(){return this.toInspectValue(this.userLocalInspectValue)}_userRemoteInspectValue;get userRemoteInspectValue(){return this._userRemoteInspectValue||(this._userRemoteInspectValue=this.remoteUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userRemoteInspectValue}get userRemoteValue(){return this.userRemoteInspectValue.merged}get userRemote(){return this.toInspectValue(this.userRemoteInspectValue)}_workspaceInspectValue;get workspaceInspectValue(){return this._workspaceInspectValue===void 0&&(this._workspaceInspectValue=this.workspaceConfiguration?this.workspaceConfiguration.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceInspectValue}get workspaceValue(){return this.workspaceInspectValue?.merged}get workspace(){return this.toInspectValue(this.workspaceInspectValue)}_workspaceFolderInspectValue;get workspaceFolderInspectValue(){return this._workspaceFolderInspectValue===void 0&&(this._workspaceFolderInspectValue=this.folderConfigurationModel?this.folderConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceFolderInspectValue}get workspaceFolderValue(){return this.workspaceFolderInspectValue?.merged}get workspaceFolder(){return this.toInspectValue(this.workspaceFolderInspectValue)}_memoryInspectValue;get memoryInspectValue(){return this._memoryInspectValue===void 0&&(this._memoryInspectValue=this.memoryConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier)),this._memoryInspectValue}get memoryValue(){return this.memoryInspectValue.merged}get memory(){return this.toInspectValue(this.memoryInspectValue)}},na=class r{constructor(t,e,n,i,o,s,a,l,c,d){this._defaultConfiguration=t;this._policyConfiguration=e;this._applicationConfiguration=n;this._localUserConfiguration=i;this._remoteUserConfiguration=o;this._workspaceConfiguration=s;this._folderConfigurations=a;this._memoryConfiguration=l;this._memoryConfigurationByResource=c;this.logService=d}_workspaceConsolidatedConfiguration=null;_foldersConsolidatedConfigurations=new Ye;getValue(t,e,n){return this.getConsolidatedConfigurationModel(t,e,n).getValue(t)}updateValue(t,e,n={}){let i;n.resource?(i=this._memoryConfigurationByResource.get(n.resource),i||(i=ut.createEmptyModel(this.logService),this._memoryConfigurationByResource.set(n.resource,i))):i=this._memoryConfiguration,e===void 0?i.removeValue(t):i.setValue(t,e),n.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(t,e,n){let i=this.getConsolidatedConfigurationModel(t,e,n),o=this.getFolderConfigurationModelForResource(e.resource,n),s=e.resource?this._memoryConfigurationByResource.get(e.resource)||this._memoryConfiguration:this._memoryConfiguration,a=new Set;for(let l of i.overrides)for(let c of l.identifiers)i.getOverrideValue(t,c)!==void 0&&a.add(c);return new Km(t,e,i.getValue(t),a.size?[...a]:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,n?this._workspaceConfiguration:void 0,o||void 0,s)}keys(t){let e=this.getFolderConfigurationModelForResource(void 0,t);return{default:this._defaultConfiguration.keys.slice(0),user:this.userConfiguration.keys.slice(0),workspace:this._workspaceConfiguration.keys.slice(0),workspaceFolder:e?e.keys.slice(0):[]}}updateDefaultConfiguration(t){this._defaultConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updatePolicyConfiguration(t){this._policyConfiguration=t}updateApplicationConfiguration(t){this._applicationConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateLocalUserConfiguration(t){this._localUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateRemoteUserConfiguration(t){this._remoteUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateWorkspaceConfiguration(t){this._workspaceConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateFolderConfiguration(t,e){this._folderConfigurations.set(t,e),this._foldersConsolidatedConfigurations.delete(t)}deleteFolderConfiguration(t){this.folderConfigurations.delete(t),this._foldersConsolidatedConfigurations.delete(t)}compareAndUpdateDefaultConfiguration(t,e){let n=[];if(!e){let{added:i,updated:o,removed:s}=Ki(this._defaultConfiguration,t);e=[...i,...o,...s]}for(let i of e)for(let o of Ks(i)){let s=this._defaultConfiguration.getKeysForOverrideIdentifier(o),a=t.getKeysForOverrideIdentifier(o),l=[...a.filter(c=>s.indexOf(c)===-1),...s.filter(c=>a.indexOf(c)===-1),...s.filter(c=>!dt(this._defaultConfiguration.override(o).getValue(c),t.override(o).getValue(c)))];n.push([o,l])}return this.updateDefaultConfiguration(t),{keys:e,overrides:n}}compareAndUpdatePolicyConfiguration(t){let{added:e,updated:n,removed:i}=Ki(this._policyConfiguration,t),o=[...e,...n,...i];return o.length&&this.updatePolicyConfiguration(t),{keys:o,overrides:[]}}compareAndUpdateApplicationConfiguration(t){let{added:e,updated:n,removed:i,overrides:o}=Ki(this.applicationConfiguration,t),s=[...e,...n,...i];return s.length&&this.updateApplicationConfiguration(t),{keys:s,overrides:o}}compareAndUpdateLocalUserConfiguration(t){let{added:e,updated:n,removed:i,overrides:o}=Ki(this.localUserConfiguration,t),s=[...e,...n,...i];return s.length&&this.updateLocalUserConfiguration(t),{keys:s,overrides:o}}compareAndUpdateRemoteUserConfiguration(t){let{added:e,updated:n,removed:i,overrides:o}=Ki(this.remoteUserConfiguration,t),s=[...e,...n,...i];return s.length&&this.updateRemoteUserConfiguration(t),{keys:s,overrides:o}}compareAndUpdateWorkspaceConfiguration(t){let{added:e,updated:n,removed:i,overrides:o}=Ki(this.workspaceConfiguration,t),s=[...e,...n,...i];return s.length&&this.updateWorkspaceConfiguration(t),{keys:s,overrides:o}}compareAndUpdateFolderConfiguration(t,e){let n=this.folderConfigurations.get(t),{added:i,updated:o,removed:s,overrides:a}=Ki(n,e),l=[...i,...o,...s];return(l.length||!n)&&this.updateFolderConfiguration(t,e),{keys:l,overrides:a}}compareAndDeleteFolderConfiguration(t){let e=this.folderConfigurations.get(t);if(!e)throw new Error("Unknown folder");this.deleteFolderConfiguration(t);let{added:n,updated:i,removed:o,overrides:s}=Ki(e,void 0);return{keys:[...n,...i,...o],overrides:s}}get defaults(){return this._defaultConfiguration}get applicationConfiguration(){return this._applicationConfiguration}_userConfiguration=null;get userConfiguration(){return this._userConfiguration||(this._userConfiguration=this._remoteUserConfiguration.isEmpty()?this._localUserConfiguration:this._localUserConfiguration.merge(this._remoteUserConfiguration)),this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}get workspaceConfiguration(){return this._workspaceConfiguration}get folderConfigurations(){return this._folderConfigurations}getConsolidatedConfigurationModel(t,e,n){let i=this.getConsolidatedConfigurationModelForResource(e,n);return e.overrideIdentifier&&(i=i.override(e.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(t)!==void 0&&(i=i.merge(this._policyConfiguration)),i}getConsolidatedConfigurationModelForResource({resource:t},e){let n=this.getWorkspaceConsolidatedConfiguration();if(e&&t){let i=e.getFolder(t);i&&(n=this.getFolderConsolidatedConfiguration(i.uri)||n);let o=this._memoryConfigurationByResource.get(t);o&&(n=n.merge(o))}return n}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration)),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(t){let e=this._foldersConsolidatedConfigurations.get(t);if(!e){let n=this.getWorkspaceConsolidatedConfiguration(),i=this._folderConfigurations.get(t);i?(e=n.merge(i),this._foldersConsolidatedConfigurations.set(t,e)):e=n}return e}getFolderConfigurationModelForResource(t,e){if(e&&t){let n=e.getFolder(t);if(n)return this._folderConfigurations.get(n.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys},user:{contents:this.userConfiguration.contents,overrides:this.userConfiguration.overrides,keys:this.userConfiguration.keys},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((t,e)=>{let{contents:n,overrides:i,keys:o}=this._folderConfigurations.get(e);return t.push([e,{contents:n,overrides:i,keys:o}]),t},[])}}allKeys(){let t=new Set;return this._defaultConfiguration.keys.forEach(e=>t.add(e)),this.userConfiguration.keys.forEach(e=>t.add(e)),this._workspaceConfiguration.keys.forEach(e=>t.add(e)),this._folderConfigurations.forEach(e=>e.keys.forEach(n=>t.add(n))),[...t.values()]}allOverrideIdentifiers(){let t=new Set;return this._defaultConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this.userConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this._workspaceConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this._folderConfigurations.forEach(e=>e.getAllOverrideIdentifiers().forEach(n=>t.add(n))),[...t.values()]}getAllKeysForOverrideIdentifier(t){let e=new Set;return this._defaultConfiguration.getKeysForOverrideIdentifier(t).forEach(n=>e.add(n)),this.userConfiguration.getKeysForOverrideIdentifier(t).forEach(n=>e.add(n)),this._workspaceConfiguration.getKeysForOverrideIdentifier(t).forEach(n=>e.add(n)),this._folderConfigurations.forEach(n=>n.getKeysForOverrideIdentifier(t).forEach(i=>e.add(i))),[...e.values()]}static parse(t,e){let n=this.parseConfigurationModel(t.defaults,e),i=this.parseConfigurationModel(t.policy,e),o=this.parseConfigurationModel(t.application,e),s=this.parseConfigurationModel(t.user,e),a=this.parseConfigurationModel(t.workspace,e),l=t.folders.reduce((c,d)=>(c.set(C.revive(d[0]),this.parseConfigurationModel(d[1],e)),c),new Ye);return new r(n,i,o,s,ut.createEmptyModel(e),a,l,ut.createEmptyModel(e),new Ye,e)}static parseConfigurationModel(t,e){return new ut(t.contents,t.keys,t.overrides,void 0,e)}};var bf=class{constructor(t,e,n,i,o){this.change=t;this.previous=e;this.currentConfiguraiton=n;this.currentWorkspace=i;this.logService=o;for(let s of t.keys)this.affectedKeys.add(s);for(let[,s]of t.overrides)for(let a of s)this.affectedKeys.add(a);this._affectsConfigStr=this._marker;for(let s of this.affectedKeys)this._affectsConfigStr+=s+this._marker}_marker=`
`;_markerCode1=this._marker.charCodeAt(0);_markerCode2=46;_affectsConfigStr;affectedKeys=new Set;source;_previousConfiguration=void 0;get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=na.parse(this.previous.data,this.logService)),this._previousConfiguration}affectsConfiguration(t,e){let n=this._marker+t,i=this._affectsConfigStr.indexOf(n);if(i<0)return!1;let o=i+n.length;if(o>=this._affectsConfigStr.length)return!1;let s=this._affectsConfigStr.charCodeAt(o);if(s!==this._markerCode1&&s!==this._markerCode2)return!1;if(e){let a=this.previousConfiguration?this.previousConfiguration.getValue(t,e,this.previous?.workspace):void 0,l=this.currentConfiguraiton.getValue(t,e,this.currentWorkspace);return!dt(a,l)}return!0}};function Ki(r,t){let{added:e,removed:n,updated:i}=fx(t?.rawConfiguration,r?.rawConfiguration),o=[],s=r?.getAllOverrideIdentifiers()||[],a=t?.getAllOverrideIdentifiers()||[];if(t){let l=a.filter(c=>!s.includes(c));for(let c of l)o.push([c,t.getKeysForOverrideIdentifier(c)])}if(r){let l=s.filter(c=>!a.includes(c));for(let c of l)o.push([c,r.getKeysForOverrideIdentifier(c)])}if(t&&r){for(let l of s)if(a.includes(l)){let c=fx({contents:r.getOverrideValue(void 0,l)||{},keys:r.getKeysForOverrideIdentifier(l)},{contents:t.getOverrideValue(void 0,l)||{},keys:t.getKeysForOverrideIdentifier(l)});o.push([l,[...c.added,...c.removed,...c.updated]])}}return{added:e,removed:n,updated:i,overrides:o}}function fx(r,t){let e=r?t?r.keys.filter(o=>t.keys.indexOf(o)===-1):[...r.keys]:[],n=t?r?t.keys.filter(o=>r.keys.indexOf(o)===-1):[...t.keys]:[],i=[];if(r&&t){for(let o of t.keys)if(r.keys.indexOf(o)!==-1){let s=dc(t.contents,o),a=dc(r.contents,o);dt(s,a)||i.push(o)}}return{added:e,removed:n,updated:i}}var xf=class extends _{constructor(e){super();this.logService=e}_onDidChangeConfiguration=this._register(new P);onDidChangeConfiguration=this._onDidChangeConfiguration.event;_configurationModel=ut.createEmptyModel(this.logService);get configurationModel(){return this._configurationModel}async initialize(){return this.resetConfigurationModel(),this._register(Ne.as(Wt.Configuration).onDidUpdateConfiguration(({properties:e,defaultsOverrides:n})=>this.onDidUpdateConfiguration(Array.from(e),n))),this.configurationModel}reload(){return this.resetConfigurationModel(),this.configurationModel}onDidUpdateConfiguration(e,n){this.updateConfigurationModel(e,Ne.as(Wt.Configuration).getConfigurationProperties()),this._onDidChangeConfiguration.fire({defaults:this.configurationModel,properties:e})}getConfigurationDefaultOverrides(){return{}}resetConfigurationModel(){this._configurationModel=ut.createEmptyModel(this.logService);let e=Ne.as(Wt.Configuration).getConfigurationProperties();this.updateConfigurationModel(Object.keys(e),e)}updateConfigurationModel(e,n){let i=this.getConfigurationDefaultOverrides();for(let o of e){let s=i[o],a=n[o];s!==void 0?this._configurationModel.setValue(o,s):a?this._configurationModel.setValue(o,a.default):this._configurationModel.removeValue(o)}}},Ef=class{onDidChangeConfiguration=O.None;configurationModel=ut.createEmptyModel(new gu);async initialize(){return this.configurationModel}},ra=class extends _{constructor(e,n,i){super();this.defaultConfiguration=e;this.policyService=n;this.logService=i}_onDidChangeConfiguration=this._register(new P);onDidChangeConfiguration=this._onDidChangeConfiguration.event;_configurationModel=ut.createEmptyModel(this.logService);get configurationModel(){return this._configurationModel}async initialize(){return this.logService.trace("PolicyConfiguration#initialize"),this.update(await this.updatePolicyDefinitions(this.defaultConfiguration.configurationModel.keys),!1),this._register(this.policyService.onDidChange(e=>this.onDidChangePolicies(e))),this._register(this.defaultConfiguration.onDidChangeConfiguration(async({properties:e})=>this.update(await this.updatePolicyDefinitions(e),!0))),this._configurationModel}async updatePolicyDefinitions(e){this.logService.trace("PolicyConfiguration#updatePolicyDefinitions",e);let n={},i=[],o=Ne.as(Wt.Configuration).getConfigurationProperties();for(let s of e){let a=o[s];if(!a){i.push(s);continue}if(a.policy){if(a.type!=="string"&&a.type!=="number"){this.logService.warn(`Policy ${a.policy.name} has unsupported type ${a.type}`);continue}i.push(s),n[a.policy.name]={type:a.type}}}return as(n)||await this.policyService.updatePolicyDefinitions(n),i}onDidChangePolicies(e){this.logService.trace("PolicyConfiguration#onDidChangePolicies",e);let n=Ne.as(Wt.Configuration).getPolicyConfigurations(),i=qn(e.map(o=>n.get(o)));this.update(i,!0)}update(e,n){this.logService.trace("PolicyConfiguration#update",e);let i=Ne.as(Wt.Configuration).getConfigurationProperties(),o=[],s=this._configurationModel.isEmpty();for(let a of e){let l=i[a]?.policy?.name;if(l){let c=this.policyService.getPolicyValue(l);(s?c!==void 0:!dt(this._configurationModel.getValue(a),c))&&o.push([a,c])}else this._configurationModel.getValue(a)!==void 0&&o.push([a,void 0])}if(o.length){this.logService.trace("PolicyConfiguration#changed",o);let a=this._configurationModel;this._configurationModel=ut.createEmptyModel(this.logService);for(let l of a.keys)this._configurationModel.setValue(l,a.getValue(l));for(let[l,c]of o)c===void 0?this._configurationModel.removeValue(l):this._configurationModel.setValue(l,c);n&&this._onDidChangeConfiguration.fire(this._configurationModel)}}};ra=E([m(1,Zu),m(2,z)],ra);var wf=class extends _{constructor(e,n,i,o){super();this.settingsResource=e;this.logService=o;this.defaultConfiguration=this._register(new xf(o)),this.policyConfiguration=i instanceof Ws?new Ef:this._register(new ra(this.defaultConfiguration,i,o)),this.userConfiguration=this._register(new Sf(this.settingsResource,{},So,n,o)),this.configuration=new na(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,ut.createEmptyModel(o),ut.createEmptyModel(o),ut.createEmptyModel(o),ut.createEmptyModel(o),new Ye,ut.createEmptyModel(o),new Ye,o),this.configurationEditing=new $m(e,n,this),this.reloadConfigurationScheduler=this._register(new mt(()=>this.reloadConfiguration(),50)),this._register(this.defaultConfiguration.onDidChangeConfiguration(({defaults:s,properties:a})=>this.onDidDefaultConfigurationChange(s,a))),this._register(this.policyConfiguration.onDidChangeConfiguration(s=>this.onDidPolicyConfigurationChange(s))),this._register(this.userConfiguration.onDidChange(()=>this.reloadConfigurationScheduler.schedule()))}configuration;defaultConfiguration;policyConfiguration;userConfiguration;reloadConfigurationScheduler;_onDidChangeConfiguration=this._register(new P);onDidChangeConfiguration=this._onDidChangeConfiguration.event;configurationEditing;async initialize(){let[e,n,i]=await Promise.all([this.defaultConfiguration.initialize(),this.policyConfiguration.initialize(),this.userConfiguration.loadConfiguration()]);this.configuration=new na(e,n,ut.createEmptyModel(this.logService),i,ut.createEmptyModel(this.logService),ut.createEmptyModel(this.logService),new Ye,ut.createEmptyModel(this.logService),new Ye,this.logService)}getConfigurationData(){return this.configuration.toData()}getValue(e,n){let i=typeof e=="string"?e:void 0,o=Ou(e)?e:Ou(n)?n:{};return this.configuration.getValue(i,o,void 0)}async updateValue(e,n,i,o,s){let a=gb(i)?i:Ou(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,l=a?o:i;if(l!==void 0&&l!==3&&l!==2)throw new Error(`Unable to write ${e} to target ${l}.`);a?.overrideIdentifiers&&(a.overrideIdentifiers=gt(a.overrideIdentifiers),a.overrideIdentifiers=a.overrideIdentifiers.length?a.overrideIdentifiers:void 0);let c=this.inspect(e,{resource:a?.resource,overrideIdentifier:a?.overrideIdentifiers?a.overrideIdentifiers[0]:void 0});if(c.policyValue!==void 0)throw new Error(`Unable to write ${e} because it is configured in system policy.`);if(dt(n,c.defaultValue)&&(n=void 0),a?.overrideIdentifiers?.length&&a.overrideIdentifiers.length>1){let u=a.overrideIdentifiers.sort(),f=this.configuration.localUserConfiguration.overrides.find(h=>Pt([...h.identifiers].sort(),u));f&&(a.overrideIdentifiers=f.identifiers)}let d=a?.overrideIdentifiers?.length?[Ob(a.overrideIdentifiers),e]:[e];await this.configurationEditing.write(d,n),await this.reloadConfiguration()}inspect(e,n={}){return this.configuration.inspect(e,n,void 0)}keys(){return this.configuration.keys(void 0)}async reloadConfiguration(){let e=await this.userConfiguration.loadConfiguration();this.onDidChangeUserConfiguration(e)}onDidChangeUserConfiguration(e){let n=this.configuration.toData(),i=this.configuration.compareAndUpdateLocalUserConfiguration(e);this.trigger(i,n,2)}onDidDefaultConfigurationChange(e,n){let i=this.configuration.toData(),o=this.configuration.compareAndUpdateDefaultConfiguration(e,n);this.trigger(o,i,7)}onDidPolicyConfigurationChange(e){let n=this.configuration.toData(),i=this.configuration.compareAndUpdatePolicyConfiguration(e);this.trigger(i,n,7)}trigger(e,n,i){let o=new bf(e,{data:n},this.configuration,void 0,this.logService);o.source=i,this._onDidChangeConfiguration.fire(o)}},$m=class{constructor(t,e,n){this.settingsResource=t;this.fileService=e;this.configurationService=n;this.queue=new fr}queue;write(t,e){return this.queue.queue(()=>this.doWriteConfiguration(t,e))}async doWriteConfiguration(t,e){let n;try{n=(await this.fileService.readFile(this.settingsResource)).value.toString()}catch(s){if(s.fileOperationResult===1)n="{}";else throw s}let i=[];if(Ze(n,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0)throw new Error("Unable to write into the settings file. Please open the file to correct errors/warnings in the file and try again.");let o=this.getEdits(n,t,e);n=If(n,o),await this.fileService.writeFile(this.settingsResource,A.fromString(n))}getEdits(t,e,n){let{tabSize:i,insertSpaces:o,eol:s}=this.formattingOptions;if(!e.length){let a=JSON.stringify(n,null,o?" ".repeat(i):"	");return[{content:a,length:a.length,offset:0}]}return ea(t,e,n,{tabSize:i,insertSpaces:o,eol:s})}_formattingOptions;get formattingOptions(){if(!this._formattingOptions){let t=ir===3||ir===2?`
`:`\r
`,e=this.configurationService.getValue("files.eol",{overrideIdentifier:"jsonc"});e&&typeof e=="string"&&e!=="auto"&&(t=e),this._formattingOptions={eol:t,insertSpaces:!!this.configurationService.getValue("editor.insertSpaces",{overrideIdentifier:"jsonc"}),tabSize:this.configurationService.getValue("editor.tabSize",{overrideIdentifier:"jsonc"})}}return this._formattingOptions}};function hx(r){r&&(delete r.DEBUG,Oe&&delete r.LD_PRELOAD)}var uT="diagnosticsService",zm=M(uT);function qm(r){return!!r.hostName&&!!r.errorMessage}import*as yx from"fs";import*as Rt from"os";import{networkInterfaces as fT}from"os";var Hm=new class{_virtualMachineOUIs;_value;_isVirtualMachineMacAddress(r){return this._virtualMachineOUIs||(this._virtualMachineOUIs=An.forStrings(),this._virtualMachineOUIs.set("00-50-56",!0),this._virtualMachineOUIs.set("00-0C-29",!0),this._virtualMachineOUIs.set("00-05-69",!0),this._virtualMachineOUIs.set("00-03-FF",!0),this._virtualMachineOUIs.set("00-1C-42",!0),this._virtualMachineOUIs.set("00-16-3E",!0),this._virtualMachineOUIs.set("08-00-27",!0),this._virtualMachineOUIs.set("00:50:56",!0),this._virtualMachineOUIs.set("00:0C:29",!0),this._virtualMachineOUIs.set("00:05:69",!0),this._virtualMachineOUIs.set("00:03:FF",!0),this._virtualMachineOUIs.set("00:1C:42",!0),this._virtualMachineOUIs.set("00:16:3E",!0),this._virtualMachineOUIs.set("08:00:27",!0)),!!this._virtualMachineOUIs.findSubstr(r)}value(){if(this._value===void 0){let r=0,t=0,e=fT();for(let n in e){let i=e[n];if(i)for(let{mac:o,internal:s}of i)s||(t+=1,this._isVirtualMachineMacAddress(o.toUpperCase())&&(r+=1))}this._value=t>0?r/t:0}return this._value}};import{exec as Pf}from"child_process";function jm(r){return new Promise((t,e)=>{let n,i=new Map;function o(l,c,d,u,f){let h=i.get(c);if(l===r||h){let v={name:s(d),cmd:d,pid:l,ppid:c,load:u,mem:f};i.set(l,v),l===r&&(n=v),h&&(h.children||(h.children=[]),h.children.push(v),h.children.length>1&&(h.children=h.children.sort((y,I)=>y.pid-I.pid)))}}function s(l){let c=/--utility-sub-type=network/i,d=/--crashes-directory/i,u=/\\pipe\\winpty-control/i,f=/conhost\.exe.+--headless/i,h=/--type=([a-zA-Z-]+)/;if(d.exec(l))return"electron-crash-reporter";if(u.exec(l))return"winpty-agent";if(f.exec(l))return"conpty-agent";let v=h.exec(l);if(v&&v.length===2)return v[1]==="renderer"?"window":v[1]==="utility"?c.exec(l)?"utility-network-service":"utility-process":v[1]==="extensionHost"?"extension-host":v[1];let y=/[a-zA-Z-]+\.js/g,I="";do v=y.exec(l),v&&(I+=v+" ");while(v);return I&&l.indexOf("node ")<0&&l.indexOf("node.exe")<0?`electron-nodejs (${I})`:l}if(process.platform==="win32"){let l=c=>c.indexOf("\\\\?\\")===0||c.indexOf("\\??\\")===0?c.substring(4):c.indexOf('"\\\\?\\')===0||c.indexOf('"\\??\\')===0?'"'+c.substring(5):c;import("@vscode/windows-process-tree").then(c=>{c.getProcessList(r,d=>{if(!d){e(new Error(`Root process ${r} not found`));return}c.getProcessCpuUsage(d,u=>{let f=new Map;u.forEach(h=>{let v=l(h.commandLine||"");f.set(h.pid,{name:s(v),cmd:v,pid:h.pid,ppid:h.ppid,load:h.cpu||0,mem:h.memory||0})}),n=f.get(r),n?(f.forEach(h=>{let v=f.get(h.ppid);v&&(v.children||(v.children=[]),v.children.push(h))}),f.forEach(h=>{h.children&&(h.children=h.children.sort((v,y)=>v.pid-y.pid))}),t(n)):e(new Error(`Root process ${r} not found`))})},c.ProcessDataFlag.CommandLine|c.ProcessDataFlag.Memory)})}else{let l=function(){let c=[n],d=[];for(;c.length;){let f=c.shift();f&&(d.push(f.pid),f.children&&(c=c.concat(f.children)))}let u=JSON.stringify(Sn.asFileUri("vs/base/node/cpuUsage.sh").fsPath);u+=" "+d.join(" "),Pf(u,{},(f,h,v)=>{if(f||v)e(f||new Error(v.toString()));else{let y=h.toString().split(`
`);for(let I=0;I<d.length;I++){let x=i.get(d[I]);x.load=parseFloat(y[I])}if(!n){e(new Error(`Root process ${r} not found`));return}t(n)}})};var a=l;Pf("which ps",{},(c,d,u)=>{if(c||u)if(process.platform!=="linux")e(c||new Error(u.toString()));else{let f=JSON.stringify(Sn.asFileUri("vs/base/node/ps.sh").fsPath);Pf(f,{},(h,v,y)=>{h||y?e(h||new Error(y.toString())):(gx(v,o),l())})}else{let f=d.toString().trim();Pf(`${f} -ax -o pid=,ppid=,pcpu=,pmem=,command=`,{maxBuffer:1e3*1024,env:{LC_NUMERIC:"en_US.UTF-8"}},(v,y,I)=>{v||I&&!I.includes("screen size is bogus")?e(v||new Error(I.toString())):(gx(y,o),process.platform==="linux"?l():n?t(n):e(new Error(`Root process ${r} not found`)))})}})}})}function gx(r,t){let e=/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+\.[0-9]+)\s+([0-9]+\.[0-9]+)\s+(.+)$/,n=r.toString().split(`
`);for(let i of n){let o=e.exec(i.trim());o&&o.length===6&&t(parseInt(o[1]),parseInt(o[2]),o[5],parseFloat(o[3]),parseFloat(o[4]))}}var mx=new Map;async function Gm(r,t){let e=`${r}::${t.join(":")}`,n=mx.get(e);if(n)return n;let i=[{tag:"grunt.js",filePattern:/^gruntfile\.js$/i},{tag:"gulp.js",filePattern:/^gulpfile\.js$/i},{tag:"tsconfig.json",filePattern:/^tsconfig\.json$/i},{tag:"package.json",filePattern:/^package\.json$/i},{tag:"jsconfig.json",filePattern:/^jsconfig\.json$/i},{tag:"tslint.json",filePattern:/^tslint\.json$/i},{tag:"eslint.json",filePattern:/^eslint\.json$/i},{tag:"tasks.json",filePattern:/^tasks\.json$/i},{tag:"launch.json",filePattern:/^launch\.json$/i},{tag:"settings.json",filePattern:/^settings\.json$/i},{tag:"webpack.config.js",filePattern:/^webpack\.config\.js$/i},{tag:"project.json",filePattern:/^project\.json$/i},{tag:"makefile",filePattern:/^makefile$/i},{tag:"sln",filePattern:/^.+\.sln$/i},{tag:"csproj",filePattern:/^.+\.csproj$/i},{tag:"cmake",filePattern:/^.+\.cmake$/i},{tag:"github-actions",filePattern:/^.+\.ya?ml$/i,relativePathPattern:/^\.github(?:\/|\\)workflows$/i},{tag:"devcontainer.json",filePattern:/^devcontainer\.json$/i},{tag:"dockerfile",filePattern:/^(dockerfile|docker\-compose\.ya?ml)$/i},{tag:"cursorrules",filePattern:/^\.cursorrules$/i}],o=new Map,s=new Map,a=2e4;function l(d,u,f,h){let v=u.substring(d.length+1);return Qe.withAsyncBody(async y=>{let I;h.readdirCount++;try{I=await ce.readdir(u,{withFileTypes:!0})}catch{y();return}if(h.count>=a){h.count+=I.length,h.maxReached=!0,y();return}let x=I.length;if(x===0){y();return}let T=I;h.count+I.length>a&&(h.maxReached=!0,x=a-h.count,T=I.slice(0,x)),h.count+=I.length;for(let R of T)if(R.isDirectory()){if(f.includes(R.name)||await l(d,W(u,R.name),f,h),--x===0){y();return}}else{let w=R.name.lastIndexOf(".");if(w>=0){let L=R.name.substring(w+1);L&&o.set(L,(o.get(L)??0)+1)}for(let L of i)L.relativePathPattern?.test(v)!==!1&&L.filePattern.test(R.name)&&s.set(L.tag,(s.get(L.tag)??0)+1);if(--x===0){y();return}}})}let c=Qe.withAsyncBody(async d=>{let u={count:0,maxReached:!1,readdirCount:0},f=new dr(!0);await l(r,r,t,u);let h=await hT(r);d({configFiles:Qm(s),fileTypes:Qm(o),fileCount:u.count,maxFilesReached:u.maxReached,launchConfigFiles:h,totalScanTime:f.elapsed(),totalReaddirCount:u.readdirCount})});return mx.set(e,c),c}function Qm(r){return Array.from(r.entries(),([t,e])=>({name:t,count:e})).sort((t,e)=>e.count-t.count)}function pT(){let r={os:`${Rt.type()} ${Rt.arch()} ${Rt.release()}`,memory:`${(Rt.totalmem()/Ui.GB).toFixed(2)}GB (${(Rt.freemem()/Ui.GB).toFixed(2)}GB free)`,vmHint:`${Math.round(Hm.value()*100)}%`},t=Rt.cpus();return t&&t.length>0&&(r.cpus=`${t[0].model} (${t.length} x ${t[0].speed})`),r}async function hT(r){try{let t=new Map,e=W(r,".vscode","launch.json"),n=await yx.promises.readFile(e),i=[],o=Ze(n.toString(),i);if(i.length)return console.log(`Unable to parse ${e}`),[];if(Wi(o)==="object"&&o.configurations)for(let s of o.configurations){let a=s.type;a&&(t.has(a)?t.set(a,t.get(a)+1):t.set(a,1))}return Qm(t)}catch{return[]}}var ia=class{constructor(t,e){this.telemetryService=t;this.productService=e}formatMachineInfo(t){let e=[];return e.push(`OS Version:       ${t.os}`),e.push(`CPUs:             ${t.cpus}`),e.push(`Memory (System):  ${t.memory}`),e.push(`VM:               ${t.vmHint}`),e.join(`
`)}formatEnvironment(t){let e=[];e.push(`Version:          ${this.productService.nameShort} ${this.productService.version} (${this.productService.commit||"Commit unknown"}, ${this.productService.date||"Date unknown"})`),e.push(`OS Version:       ${Rt.type()} ${Rt.arch()} ${Rt.release()}`);let n=Rt.cpus();return n&&n.length>0&&e.push(`CPUs:             ${n[0].model} (${n.length} x ${n[0].speed})`),e.push(`Memory (System):  ${(Rt.totalmem()/Ui.GB).toFixed(2)}GB (${(Rt.freemem()/Ui.GB).toFixed(2)}GB free)`),be||e.push(`Load (avg):       ${Rt.loadavg().map(i=>Math.round(i)).join(", ")}`),e.push(`VM:               ${Math.round(Hm.value()*100)}%`),e.push(`Screen Reader:    ${t.screenReader?"yes":"no"}`),e.push(`Process Argv:     ${t.mainArguments.join(" ")}`),e.push(`GPU Status:       ${this.expandGPUFeatures(t.gpuFeatureStatus)}`),e.join(`
`)}async getPerformanceInfo(t,e){return Promise.all([jm(t.mainPID),this.formatWorkspaceMetadata(t)]).then(async n=>{let[i,o]=n,s=this.formatProcessList(t,i);return e.forEach(a=>{if(qm(a))s+=`
${a.errorMessage}`,o+=`
${a.errorMessage}`;else if(s+=`

Remote: ${a.hostName}`,a.processes&&(s+=`
${this.formatProcessList(t,a.processes)}`),a.workspaceMetadata){o+=`
|  Remote: ${a.hostName}`;for(let l of Object.keys(a.workspaceMetadata)){let c=a.workspaceMetadata[l],d=`${c.fileCount} files`;c.maxFilesReached&&(d=`more than ${d}`),o+=`|    Folder (${l}): ${d}`,o+=this.formatWorkspaceStats(c)}}}),{processInfo:s,workspaceInfo:o}})}async getSystemInfo(t,e){let{memory:n,vmHint:i,os:o,cpus:s}=pT(),a={os:o,memory:n,cpus:s,vmHint:i,processArgs:`${t.mainArguments.join(" ")}`,gpuStatus:t.gpuFeatureStatus,screenReader:`${t.screenReader?"yes":"no"}`,remoteData:e};return be||(a.load=`${Rt.loadavg().map(l=>Math.round(l)).join(", ")}`),Oe&&(a.linuxEnv={desktopSession:process.env.DESKTOP_SESSION,xdgSessionDesktop:process.env.XDG_SESSION_DESKTOP,xdgCurrentDesktop:process.env.XDG_CURRENT_DESKTOP,xdgSessionType:process.env.XDG_SESSION_TYPE}),Promise.resolve(a)}async getDiagnostics(t,e){let n=[];return jm(t.mainPID).then(async i=>(n.push(""),n.push(this.formatEnvironment(t)),n.push(""),n.push(this.formatProcessList(t,i)),t.windows.some(o=>o.folderURIs&&o.folderURIs.length>0&&!o.remoteAuthority)&&(n.push(""),n.push("Workspace Stats: "),n.push(await this.formatWorkspaceMetadata(t))),e.forEach(o=>{if(qm(o))n.push(`
${o.errorMessage}`);else if(n.push(`

`),n.push(`Remote:           ${o.hostName}`),n.push(this.formatMachineInfo(o.machineInfo)),o.processes&&n.push(this.formatProcessList(t,o.processes)),o.workspaceMetadata)for(let s of Object.keys(o.workspaceMetadata)){let a=o.workspaceMetadata[s],l=`${a.fileCount} files`;a.maxFilesReached&&(l=`more than ${l}`),n.push(`Folder (${s}): ${l}`),n.push(this.formatWorkspaceStats(a))}}),n.push(""),n.push(""),n.join(`
`)))}formatWorkspaceStats(t){let e=[],i=0,o=(c,d)=>{let u=` ${c}(${d})`;i+u.length>60?(e.push(s),s="|                 ",i=s.length):i+=u.length,s+=u},s="|      File types:",a=10,l=t.fileTypes.length>a?a:t.fileTypes.length;for(let c=0;c<l;c++){let d=t.fileTypes[c];o(d.name,d.count)}if(e.push(s),t.configFiles.length>=0&&(s="|      Conf files:",i=0,t.configFiles.forEach(c=>{o(c.name,c.count)}),e.push(s)),t.launchConfigFiles.length>0){let c="|      Launch Configs:";t.launchConfigFiles.forEach(d=>{let u=d.count>1?` ${d.name}(${d.count})`:` ${d.name}`;c+=u}),e.push(c)}return e.join(`
`)}expandGPUFeatures(t){let e=Math.max(...Object.keys(t).map(n=>n.length));return Object.keys(t).map(n=>`${n}:  ${" ".repeat(e-n.length)}  ${t[n]}`).join(`
                  `)}formatWorkspaceMetadata(t){let e=[],n=[];return t.windows.forEach(i=>{i.folderURIs.length===0||i.remoteAuthority||(e.push(`|  Window (${i.title})`),i.folderURIs.forEach(o=>{let s=C.revive(o);if(s.scheme===ne.file){let a=s.fsPath;n.push(Gm(a,["node_modules",".git"]).then(l=>{let c=`${l.fileCount} files`;l.maxFilesReached&&(c=`more than ${c}`),e.push(`|    Folder (${at(a)}): ${c}`),e.push(this.formatWorkspaceStats(l))}).catch(l=>{e.push(`|      Error: Unable to collect workspace stats for folder ${a} (${l.toString()})`)}))}else e.push(`|    Folder (${s.toString()}): Workspace stats not available.`)}))}),Promise.all(n).then(i=>e.join(`
`)).catch(i=>`Unable to collect workspace stats: ${i}`)}formatProcessList(t,e){let n=new Map;t.windows.forEach(o=>n.set(o.pid,`window [${o.id}] (${o.title})`)),t.pidToNames.forEach(({pid:o,name:s})=>n.set(o,s));let i=[];return i.push("CPU %	Mem MB	   PID	Process"),e&&this.formatProcessItem(t.mainPID,n,i,e,0),i.join(`
`)}formatProcessItem(t,e,n,i,o){let s=o===0,a;s?a=i.pid===t?`${this.productService.applicationName} main`:"remote agent":e.has(i.pid)?a=e.get(i.pid):a=`${"  ".repeat(o)} ${i.name}`;let l=process.platform==="win32"?i.mem:Rt.totalmem()*(i.mem/100);n.push(`${i.load.toFixed(0).padStart(5," ")}	${(l/Ui.MB).toFixed(0).padStart(6," ")}	${i.pid.toFixed(0).padStart(6," ")}	${a}`),Array.isArray(i.children)&&i.children.forEach(c=>this.formatProcessItem(t,e,n,c,o+1))}async getWorkspaceFileExtensions(t){let e=new Set;for(let{uri:n}of t.folders){let i=C.revive(n);if(i.scheme!==ne.file)continue;let o=i.fsPath;try{(await Gm(o,["node_modules",".git"])).fileTypes.forEach(a=>e.add(a.name))}catch{}}return{extensions:[...e]}}async reportWorkspaceStats(t){for(let{uri:e}of t.folders){let n=C.revive(e);if(n.scheme!==ne.file)continue;let i=n.fsPath;try{let o=await Gm(i,["node_modules",".git"]);this.telemetryService.publicLog2("workspace.stats",{"workspace.id":t.telemetryId,rendererSessionId:t.rendererSessionId}),o.fileTypes.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.file",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),o.launchConfigFiles.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.launchConfigFile",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),o.configFiles.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.configFiles",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),this.telemetryService.publicLog2("workspace.stats.metadata",{duration:o.totalScanTime,reachedLimit:o.maxFilesReached,fileCount:o.fileCount,readdirCount:o.totalReaddirCount})}catch{}}}};ia=E([m(0,le),m(1,de)],ia);var Tf=M("downloadService");var oa=class{constructor(t,e){this.requestService=t;this.fileService=e}async download(t,e,n=ee.None){if(t.scheme===ne.file||t.scheme===ne.vscodeRemote){await this.fileService.copy(t,e);return}let i={type:"GET",url:t.toString(!0)},o=await this.requestService.request(i,n);if(o.res.statusCode===200)await this.fileService.writeFile(e,o.stream);else{let s=await Nn(o);throw new Error(`Expected 200, got back ${o.res.statusCode} instead.

${s}`)}}};oa=E([m(0,vr),m(1,G)],oa);var gT="__$__isNewStorageMarker",Rf="__$__targetStorageMarker",X=M("storageService");function mT(r){let t=r.get(Rf);if(t)try{return JSON.parse(t)}catch{}return Object.create(null)}var sa=class r extends _{constructor(e={flushInterval:r.DEFAULT_FLUSH_INTERVAL}){super();this.options=e}static DEFAULT_FLUSH_INTERVAL=60*1e3;_onDidChangeValue=this._register(new Ii);_onDidChangeTarget=this._register(new Ii);onDidChangeTarget=this._onDidChangeTarget.event;_onWillSaveState=this._register(new P);onWillSaveState=this._onWillSaveState.event;initializationPromise;flushWhenIdleScheduler=this._register(new mt(()=>this.doFlushWhenIdle(),this.options.flushInterval));runFlushWhenIdle=this._register(new zt);onDidChangeValue(e,n,i){return O.filter(this._onDidChangeValue.event,o=>o.scope===e&&(n===void 0||o.key===n),i)}doFlushWhenIdle(){this.runFlushWhenIdle.value=yg(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){qt([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{Mr("code/willInitStorage");try{await this.doInitialize()}finally{Mr("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(e,n){let{key:i,external:o}=n;if(i===Rf){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:i,target:this.getKeyTargets(e)[i],external:o})}emitWillSaveState(e){this._onWillSaveState.fire({reason:e})}get(e,n,i){return this.getStorage(n)?.get(e,i)}getBoolean(e,n,i){return this.getStorage(n)?.getBoolean(e,i)}getNumber(e,n,i){return this.getStorage(n)?.getNumber(e,i)}getObject(e,n,i){return this.getStorage(n)?.getObject(e,i)}storeAll(e,n){this.withPausedEmitters(()=>{for(let i of e)this.store(i.key,i.value,i.scope,i.target,n)})}store(e,n,i,o,s=!1){if(ct(n)){this.remove(e,i,s);return}this.withPausedEmitters(()=>{this.updateKeyTarget(e,i,o),this.getStorage(i)?.set(e,n,s)})}remove(e,n,i=!1){this.withPausedEmitters(()=>{this.updateKeyTarget(e,n,void 0),this.getStorage(n)?.delete(e,i)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(e,n){let i=[],o=this.getKeyTargets(e);for(let s of Object.keys(o))o[s]===n&&i.push(s);return i}updateKeyTarget(e,n,i,o=!1){let s=this.getKeyTargets(n);typeof i=="number"?s[e]!==i&&(s[e]=i,this.getStorage(n)?.set(Rf,JSON.stringify(s),o)):typeof s[e]=="number"&&(delete s[e],this.getStorage(n)?.set(Rf,JSON.stringify(s),o))}_workspaceKeyTargets=void 0;get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}_profileKeyTargets=void 0;get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}_applicationKeyTargets=void 0;get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){let n=this.getStorage(e);return n?mT(n):Object.create(null)}isNew(e){return this.getBoolean(gT,e)===!0}async flush(e=0){this._onWillSaveState.fire({reason:e});let n=this.getStorage(-1),i=this.getStorage(0),o=this.getStorage(1);switch(e){case 0:await Qe.settled([n?.whenFlushed()??Promise.resolve(),i?.whenFlushed()??Promise.resolve(),o?.whenFlushed()??Promise.resolve()]);break;case 1:await Qe.settled([n?.flush(0)??Promise.resolve(),i?.flush(0)??Promise.resolve(),o?.flush(0)??Promise.resolve()]);break}}async log(){let e=this.getStorage(-1)?.items??new Map,n=this.getStorage(0)?.items??new Map,i=this.getStorage(1)?.items??new Map;return yT(e,n,i,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async optimize(e){return await this.flush(),this.getStorage(e)?.optimize()}async switch(e,n){return this.emitWillSaveState(0),ju(e)?this.switchToProfile(e,n):this.switchToWorkspace(e,n)}canSwitchProfile(e,n){return!(e.id===n.id||aa(n)&&aa(e))}switchData(e,n,i){this.withPausedEmitters(()=>{let o=new Set;for(let[s,a]of e)o.add(s),n.get(s)!==a&&this.emitDidChangeValue(i,{key:s,external:!0});for(let[s]of n.items)o.has(s)||this.emitDidChangeValue(i,{key:s,external:!0})})}};function aa(r){return r.isDefault||!!r.useDefaultFlags?.globalState}async function yT(r,t,e,n,i,o){let s=y=>{try{return JSON.parse(y)}catch{return y}},a=new Map,l=new Map;r.forEach((y,I)=>{a.set(I,y),l.set(I,s(y))});let c=new Map,d=new Map;t.forEach((y,I)=>{c.set(I,y),d.set(I,s(y))});let u=new Map,f=new Map;e.forEach((y,I)=>{u.set(I,y),f.set(I,s(y))}),console.group(n!==i?`Storage: Application (path: ${n})`:`Storage: Application & Profile (path: ${n}, default profile)`);let h=[];if(a.forEach((y,I)=>{h.push({key:I,value:y})}),console.table(h),console.groupEnd(),console.log(l),n!==i){console.group(`Storage: Profile (path: ${i}, profile specific)`);let y=[];c.forEach((I,x)=>{y.push({key:x,value:I})}),console.table(y),console.groupEnd(),console.log(d)}console.group(`Storage: Workspace (path: ${o})`);let v=[];u.forEach((y,I)=>{v.push({key:I,value:y})}),console.table(v),console.groupEnd(),console.log(f)}var $i=class extends _{_onDidChangeEnablement=new P;onDidChangeEnablement=this._onDidChangeEnablement.event;storageManager;constructor(t,e){super(),this.storageManager=this._register(new Jm(t)),this._register(this.storageManager.onDidChange(n=>this._onDidChangeEnablement.fire({extensions:n,source:"storage"}))),this._register(e.onDidInstallExtensions(n=>n.forEach(({local:i,operation:o})=>{i&&o===4&&this._removeFromDisabledExtensions(i.identifier)})))}async enableExtension(t,e){return this._removeFromDisabledExtensions(t)?(this._onDidChangeEnablement.fire({extensions:[t],source:e}),!0):!1}async disableExtension(t,e){return this._addToDisabledExtensions(t)?(this._onDidChangeEnablement.fire({extensions:[t],source:e}),!0):!1}getDisabledExtensions(){return this._getExtensions(oc)}async getDisabledExtensionsAsync(){return this.getDisabledExtensions()}_addToDisabledExtensions(t){let e=this.getDisabledExtensions();return e.every(n=>!Y(n,t))?(e.push(t),this._setDisabledExtensions(e),!0):!1}_removeFromDisabledExtensions(t){let e=this.getDisabledExtensions();for(let n=0;n<e.length;n++){let i=e[n];if(Y(i,t))return e.splice(n,1),this._setDisabledExtensions(e),!0}return!1}_setDisabledExtensions(t){this._setExtensions(oc,t)}_getExtensions(t){return this.storageManager.get(t,0)}_setExtensions(t,e){this.storageManager.set(t,e,0)}};$i=E([m(0,X),m(1,an)],$i);var Jm=class extends _{constructor(e){super();this.storageService=e;this._register(e.onDidChangeValue(0,void 0,this._register(new te))(n=>this.onDidStorageChange(n)))}storage=Object.create(null);_onDidChange=this._register(new P);onDidChange=this._onDidChange.event;get(e,n){let i;return n===0?(ct(this.storage[e])&&(this.storage[e]=this._get(e,n)),i=this.storage[e]):i=this._get(e,n),JSON.parse(i)}set(e,n,i){let o=JSON.stringify(n.map(({id:a,uuid:l})=>({id:a,uuid:l})));this._get(e,i)!==o&&(i===0&&(n.length?this.storage[e]=o:delete this.storage[e]),this._set(e,n.length?o:void 0,i))}onDidStorageChange(e){if(!ct(this.storage[e.key])&&this._get(e.key,e.scope)!==this.storage[e.key]){let i=this.get(e.key,e.scope);delete this.storage[e.key];let o=this.get(e.key,e.scope),s=i.filter(l=>!o.some(c=>Y(l,c))),a=o.filter(l=>!i.some(c=>Y(c,l)));(s.length||a.length)&&this._onDidChange.fire([...s,...a])}}_get(e,n){return this.storageService.get(e,n,"[]")}_set(e,n,i){n?this.storageService.store(e,n,i,1):this.storageService.remove(e,i)}};var Df={},ke={exports:Df};(function(r,t){if(typeof Df=="object"&&typeof ke=="object")ke.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e=t();for(var n in e)(typeof Df=="object"?Df:r)[n]=e[n]}})(typeof self<"u"?self:void 0,function(){return function(r){var t={};function e(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return r[n].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=r,e.c=t,e.d=function(n,i,o){e.o(n,i)||Object.defineProperty(n,i,{enumerable:!0,get:o})},e.r=function(n){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(n,"__esModule",{value:!0})},e.t=function(n,i){if(1&i&&(n=e(n)),8&i||4&i&&typeof n=="object"&&n&&n.__esModule)return n;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:n}),2&i&&typeof n!="string")for(var s in n)e.d(o,s,function(a){return n[a]}.bind(null,s));return o},e.n=function(n){var i=n&&n.__esModule?function(){return n.default}:function(){return n};return e.d(i,"a",i),i},e.o=function(n,i){return Object.prototype.hasOwnProperty.call(n,i)},e.p="",e(e.s=0)}([function(r,t,e){(function(n){var i;t=r.exports=Ke,i=typeof n=="object"&&n.env&&n.env.NODE_DEBUG&&/\bsemver\b/i.test(n.env.NODE_DEBUG)?function(){var b=Array.prototype.slice.call(arguments,0);b.unshift("SEMVER"),console.log.apply(console,b)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var o=256,s=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],l=t.src=[],c=0,d=c++;l[d]="0|[1-9]\\d*";var u=c++;l[u]="[0-9]+";var f=c++;l[f]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=c++;l[h]="("+l[d]+")\\.("+l[d]+")\\.("+l[d]+")";var v=c++;l[v]="("+l[u]+")\\.("+l[u]+")\\.("+l[u]+")";var y=c++;l[y]="(?:"+l[d]+"|"+l[f]+")";var I=c++;l[I]="(?:"+l[u]+"|"+l[f]+")";var x=c++;l[x]="(?:-("+l[y]+"(?:\\."+l[y]+")*))";var T=c++;l[T]="(?:-?("+l[I]+"(?:\\."+l[I]+")*))";var R=c++;l[R]="[0-9A-Za-z-]+";var w=c++;l[w]="(?:\\+("+l[R]+"(?:\\."+l[R]+")*))";var L=c++,Q="v?"+l[h]+l[x]+"?"+l[w]+"?";l[L]="^"+Q+"$";var K="[v=\\s]*"+l[v]+l[T]+"?"+l[w]+"?",U=c++;l[U]="^"+K+"$";var B=c++;l[B]="((?:<|>)?=?)";var Ee=c++;l[Ee]=l[u]+"|x|X|\\*";var se=c++;l[se]=l[d]+"|x|X|\\*";var ie=c++;l[ie]="[v=\\s]*("+l[se]+")(?:\\.("+l[se]+")(?:\\.("+l[se]+")(?:"+l[x]+")?"+l[w]+"?)?)?";var Ve=c++;l[Ve]="[v=\\s]*("+l[Ee]+")(?:\\.("+l[Ee]+")(?:\\.("+l[Ee]+")(?:"+l[T]+")?"+l[w]+"?)?)?";var st=c++;l[st]="^"+l[B]+"\\s*"+l[ie]+"$";var $=c++;l[$]="^"+l[B]+"\\s*"+l[Ve]+"$";var N=c++;l[N]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var q=c++;l[q]="(?:~>?)";var H=c++;l[H]="(\\s*)"+l[q]+"\\s+",a[H]=new RegExp(l[H],"g");var ae=c++;l[ae]="^"+l[q]+l[ie]+"$";var Se=c++;l[Se]="^"+l[q]+l[Ve]+"$";var Ae=c++;l[Ae]="(?:\\^)";var pt=c++;l[pt]="(\\s*)"+l[Ae]+"\\s+",a[pt]=new RegExp(l[pt],"g");var Ft=c++;l[Ft]="^"+l[Ae]+l[ie]+"$";var fe=c++;l[fe]="^"+l[Ae]+l[Ve]+"$";var si=c++;l[si]="^"+l[B]+"\\s*("+K+")$|^$";var $r=c++;l[$r]="^"+l[B]+"\\s*("+Q+")$|^$";var ai=c++;l[ai]="(\\s*)"+l[B]+"\\s*("+K+"|"+l[ie]+")",a[ai]=new RegExp(l[ai],"g");var ao=c++;l[ao]="^\\s*("+l[ie]+")\\s+-\\s+("+l[ie]+")\\s*$";var ed=c++;l[ed]="^\\s*("+l[Ve]+")\\s+-\\s+("+l[Ve]+")\\s*$";var td=c++;l[td]="(<|>)?=?\\s*\\*";for(var lo=0;lo<35;lo++)i(lo,l[lo]),a[lo]||(a[lo]=new RegExp(l[lo]));function co(b,D){if(b instanceof Ke)return b;if(typeof b!="string"||b.length>o||!(D?a[U]:a[L]).test(b))return null;try{return new Ke(b,D)}catch{return null}}function Ke(b,D){if(b instanceof Ke){if(b.loose===D)return b;b=b.version}else if(typeof b!="string")throw new TypeError("Invalid Version: "+b);if(b.length>o)throw new TypeError("version is longer than "+o+" characters");if(!(this instanceof Ke))return new Ke(b,D);i("SemVer",b,D),this.loose=D;var k=b.trim().match(D?a[U]:a[L]);if(!k)throw new TypeError("Invalid Version: "+b);if(this.raw=b,this.major=+k[1],this.minor=+k[2],this.patch=+k[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");k[4]?this.prerelease=k[4].split(".").map(function(Z){if(/^[0-9]+$/.test(Z)){var pe=+Z;if(pe>=0&&pe<s)return pe}return Z}):this.prerelease=[],this.build=k[5]?k[5].split("."):[],this.format()}t.parse=co,t.valid=function(b,D){var k=co(b,D);return k?k.version:null},t.clean=function(b,D){var k=co(b.trim().replace(/^[=v]+/,""),D);return k?k.version:null},t.SemVer=Ke,Ke.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Ke.prototype.toString=function(){return this.version},Ke.prototype.compare=function(b){return i("SemVer.compare",this.version,this.loose,b),b instanceof Ke||(b=new Ke(b,this.loose)),this.compareMain(b)||this.comparePre(b)},Ke.prototype.compareMain=function(b){return b instanceof Ke||(b=new Ke(b,this.loose)),Yo(this.major,b.major)||Yo(this.minor,b.minor)||Yo(this.patch,b.patch)},Ke.prototype.comparePre=function(b){if(b instanceof Ke||(b=new Ke(b,this.loose)),this.prerelease.length&&!b.prerelease.length)return-1;if(!this.prerelease.length&&b.prerelease.length)return 1;if(!this.prerelease.length&&!b.prerelease.length)return 0;var D=0;do{var k=this.prerelease[D],Z=b.prerelease[D];if(i("prerelease compare",D,k,Z),k===void 0&&Z===void 0)return 0;if(Z===void 0)return 1;if(k===void 0)return-1;if(k!==Z)return Yo(k,Z)}while(++D)},Ke.prototype.inc=function(b,D){switch(b){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",D);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",D);break;case"prepatch":this.prerelease.length=0,this.inc("patch",D),this.inc("pre",D);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",D),this.inc("pre",D);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var k=this.prerelease.length;--k>=0;)typeof this.prerelease[k]=="number"&&(this.prerelease[k]++,k=-2);k===-1&&this.prerelease.push(0)}D&&(this.prerelease[0]===D?isNaN(this.prerelease[1])&&(this.prerelease=[D,0]):this.prerelease=[D,0]);break;default:throw new Error("invalid increment argument: "+b)}return this.format(),this.raw=this.version,this},t.inc=function(b,D,k,Z){typeof k=="string"&&(Z=k,k=void 0);try{return new Ke(b,k).inc(D,Z).version}catch{return null}},t.diff=function(b,D){if(Rh(b,D))return null;var k=co(b),Z=co(D);if(k.prerelease.length||Z.prerelease.length){for(var pe in k)if((pe==="major"||pe==="minor"||pe==="patch")&&k[pe]!==Z[pe])return"pre"+pe;return"prerelease"}for(var pe in k)if((pe==="major"||pe==="minor"||pe==="patch")&&k[pe]!==Z[pe])return pe},t.compareIdentifiers=Yo;var Dv=/^[0-9]+$/;function Yo(b,D){var k=Dv.test(b),Z=Dv.test(D);return k&&Z&&(b=+b,D=+D),k&&!Z?-1:Z&&!k?1:b<D?-1:b>D?1:0}function zr(b,D,k){return new Ke(b,k).compare(new Ke(D,k))}function nd(b,D,k){return zr(b,D,k)>0}function rd(b,D,k){return zr(b,D,k)<0}function Rh(b,D,k){return zr(b,D,k)===0}function _v(b,D,k){return zr(b,D,k)!==0}function Ch(b,D,k){return zr(b,D,k)>=0}function Dh(b,D,k){return zr(b,D,k)<=0}function id(b,D,k,Z){var pe;switch(D){case"===":typeof b=="object"&&(b=b.version),typeof k=="object"&&(k=k.version),pe=b===k;break;case"!==":typeof b=="object"&&(b=b.version),typeof k=="object"&&(k=k.version),pe=b!==k;break;case"":case"=":case"==":pe=Rh(b,k,Z);break;case"!=":pe=_v(b,k,Z);break;case">":pe=nd(b,k,Z);break;case">=":pe=Ch(b,k,Z);break;case"<":pe=rd(b,k,Z);break;case"<=":pe=Dh(b,k,Z);break;default:throw new TypeError("Invalid operator: "+D)}return pe}function $n(b,D){if(b instanceof $n){if(b.loose===D)return b;b=b.value}if(!(this instanceof $n))return new $n(b,D);i("comparator",b,D),this.loose=D,this.parse(b),this.semver===vl?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}t.rcompareIdentifiers=function(b,D){return Yo(D,b)},t.major=function(b,D){return new Ke(b,D).major},t.minor=function(b,D){return new Ke(b,D).minor},t.patch=function(b,D){return new Ke(b,D).patch},t.compare=zr,t.compareLoose=function(b,D){return zr(b,D,!0)},t.rcompare=function(b,D,k){return zr(D,b,k)},t.sort=function(b,D){return b.sort(function(k,Z){return t.compare(k,Z,D)})},t.rsort=function(b,D){return b.sort(function(k,Z){return t.rcompare(k,Z,D)})},t.gt=nd,t.lt=rd,t.eq=Rh,t.neq=_v,t.gte=Ch,t.lte=Dh,t.cmp=id,t.Comparator=$n;var vl={};function bt(b,D){if(b instanceof bt)return b.loose===D?b:new bt(b.raw,D);if(b instanceof $n)return new bt(b.value,D);if(!(this instanceof bt))return new bt(b,D);if(this.loose=D,this.raw=b,this.set=b.split(/\s*\|\|\s*/).map(function(k){return this.parseRange(k.trim())},this).filter(function(k){return k.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+b);this.format()}function fn(b){return!b||b.toLowerCase()==="x"||b==="*"}function L0(b,D,k,Z,pe,Kt,$e,mn,Ct,rn,Er,Dt,Qt){return((D=fn(k)?"":fn(Z)?">="+k+".0.0":fn(pe)?">="+k+"."+Z+".0":">="+D)+" "+(mn=fn(Ct)?"":fn(rn)?"<"+(+Ct+1)+".0.0":fn(Er)?"<"+Ct+"."+(+rn+1)+".0":Dt?"<="+Ct+"."+rn+"."+Er+"-"+Dt:"<="+mn)).trim()}function F0(b,D){for(var k=0;k<b.length;k++)if(!b[k].test(D))return!1;if(D.prerelease.length){for(k=0;k<b.length;k++)if(i(b[k].semver),b[k].semver!==vl&&b[k].semver.prerelease.length>0){var Z=b[k].semver;if(Z.major===D.major&&Z.minor===D.minor&&Z.patch===D.patch)return!0}return!1}return!0}function od(b,D,k){try{D=new bt(D,k)}catch{return!1}return D.test(b)}function _h(b,D,k,Z){var pe,Kt,$e,mn,Ct;switch(b=new Ke(b,Z),D=new bt(D,Z),k){case">":pe=nd,Kt=Dh,$e=rd,mn=">",Ct=">=";break;case"<":pe=rd,Kt=Ch,$e=nd,mn="<",Ct="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(od(b,D,Z))return!1;for(var rn=0;rn<D.set.length;++rn){var Er=D.set[rn],Dt=null,Qt=null;if(Er.forEach(function(yn){yn.semver===vl&&(yn=new $n(">=0.0.0")),Dt=Dt||yn,Qt=Qt||yn,pe(yn.semver,Dt.semver,Z)?Dt=yn:$e(yn.semver,Qt.semver,Z)&&(Qt=yn)}),Dt.operator===mn||Dt.operator===Ct||(!Qt.operator||Qt.operator===mn)&&Kt(b,Qt.semver)||Qt.operator===Ct&&$e(b,Qt.semver))return!1}return!0}$n.prototype.parse=function(b){var D=this.loose?a[si]:a[$r],k=b.match(D);if(!k)throw new TypeError("Invalid comparator: "+b);this.operator=k[1],this.operator==="="&&(this.operator=""),k[2]?this.semver=new Ke(k[2],this.loose):this.semver=vl},$n.prototype.toString=function(){return this.value},$n.prototype.test=function(b){return i("Comparator.test",b,this.loose),this.semver===vl||(typeof b=="string"&&(b=new Ke(b,this.loose)),id(b,this.operator,this.semver,this.loose))},$n.prototype.intersects=function(b,D){if(!(b instanceof $n))throw new TypeError("a Comparator is required");var k;if(this.operator==="")return k=new bt(b.value,D),od(this.value,k,D);if(b.operator==="")return k=new bt(this.value,D),od(b.semver,k,D);var Z=!(this.operator!==">="&&this.operator!==">"||b.operator!==">="&&b.operator!==">"),pe=!(this.operator!=="<="&&this.operator!=="<"||b.operator!=="<="&&b.operator!=="<"),Kt=this.semver.version===b.semver.version,$e=!(this.operator!==">="&&this.operator!=="<="||b.operator!==">="&&b.operator!=="<="),mn=id(this.semver,"<",b.semver,D)&&(this.operator===">="||this.operator===">")&&(b.operator==="<="||b.operator==="<"),Ct=id(this.semver,">",b.semver,D)&&(this.operator==="<="||this.operator==="<")&&(b.operator===">="||b.operator===">");return Z||pe||Kt&&$e||mn||Ct},t.Range=bt,bt.prototype.format=function(){return this.range=this.set.map(function(b){return b.join(" ").trim()}).join("||").trim(),this.range},bt.prototype.toString=function(){return this.range},bt.prototype.parseRange=function(b){var D=this.loose;b=b.trim(),i("range",b,D);var k=D?a[ed]:a[ao];b=b.replace(k,L0),i("hyphen replace",b),b=b.replace(a[ai],"$1$2$3"),i("comparator trim",b,a[ai]),b=(b=(b=b.replace(a[H],"$1~")).replace(a[pt],"$1^")).split(/\s+/).join(" ");var Z=D?a[si]:a[$r],pe=b.split(" ").map(function(Kt){return function($e,mn){return i("comp",$e),$e=function(Ct,rn){return Ct.trim().split(/\s+/).map(function(Er){return function(Dt,Qt){i("caret",Dt,Qt);var yn=Qt?a[fe]:a[Ft];return Dt.replace(yn,function(nr,ve,Ue,et,ht){var Jt;return i("caret",Dt,nr,ve,Ue,et,ht),fn(ve)?Jt="":fn(Ue)?Jt=">="+ve+".0.0 <"+(+ve+1)+".0.0":fn(et)?Jt=ve==="0"?">="+ve+"."+Ue+".0 <"+ve+"."+(+Ue+1)+".0":">="+ve+"."+Ue+".0 <"+(+ve+1)+".0.0":ht?(i("replaceCaret pr",ht),ht.charAt(0)!=="-"&&(ht="-"+ht),Jt=ve==="0"?Ue==="0"?">="+ve+"."+Ue+"."+et+ht+" <"+ve+"."+Ue+"."+(+et+1):">="+ve+"."+Ue+"."+et+ht+" <"+ve+"."+(+Ue+1)+".0":">="+ve+"."+Ue+"."+et+ht+" <"+(+ve+1)+".0.0"):(i("no pr"),Jt=ve==="0"?Ue==="0"?">="+ve+"."+Ue+"."+et+" <"+ve+"."+Ue+"."+(+et+1):">="+ve+"."+Ue+"."+et+" <"+ve+"."+(+Ue+1)+".0":">="+ve+"."+Ue+"."+et+" <"+(+ve+1)+".0.0"),i("caret return",Jt),Jt})}(Er,rn)}).join(" ")}($e,mn),i("caret",$e),$e=function(Ct,rn){return Ct.trim().split(/\s+/).map(function(Er){return function(Dt,Qt){var yn=Qt?a[Se]:a[ae];return Dt.replace(yn,function(nr,ve,Ue,et,ht){var Jt;return i("tilde",Dt,nr,ve,Ue,et,ht),fn(ve)?Jt="":fn(Ue)?Jt=">="+ve+".0.0 <"+(+ve+1)+".0.0":fn(et)?Jt=">="+ve+"."+Ue+".0 <"+ve+"."+(+Ue+1)+".0":ht?(i("replaceTilde pr",ht),ht.charAt(0)!=="-"&&(ht="-"+ht),Jt=">="+ve+"."+Ue+"."+et+ht+" <"+ve+"."+(+Ue+1)+".0"):Jt=">="+ve+"."+Ue+"."+et+" <"+ve+"."+(+Ue+1)+".0",i("tilde return",Jt),Jt})}(Er,rn)}).join(" ")}($e,mn),i("tildes",$e),$e=function(Ct,rn){return i("replaceXRanges",Ct,rn),Ct.split(/\s+/).map(function(Er){return function(Dt,Qt){Dt=Dt.trim();var yn=Qt?a[$]:a[st];return Dt.replace(yn,function(nr,ve,Ue,et,ht,Jt){i("xRange",Dt,nr,ve,Ue,et,ht,Jt);var kv=fn(Ue),Il=kv||fn(et),Sl=Il||fn(ht);return ve==="="&&Sl&&(ve=""),kv?nr=ve===">"||ve==="<"?"<0.0.0":"*":ve&&Sl?(Il&&(et=0),Sl&&(ht=0),ve===">"?(ve=">=",Il?(Ue=+Ue+1,et=0,ht=0):Sl&&(et=+et+1,ht=0)):ve==="<="&&(ve="<",Il?Ue=+Ue+1:et=+et+1),nr=ve+Ue+"."+et+"."+ht):Il?nr=">="+Ue+".0.0 <"+(+Ue+1)+".0.0":Sl&&(nr=">="+Ue+"."+et+".0 <"+Ue+"."+(+et+1)+".0"),i("xRange return",nr),nr})}(Er,rn)}).join(" ")}($e,mn),i("xrange",$e),$e=function(Ct,rn){return i("replaceStars",Ct,rn),Ct.trim().replace(a[td],"")}($e,mn),i("stars",$e),$e}(Kt,D)}).join(" ").split(/\s+/);return this.loose&&(pe=pe.filter(function(Kt){return!!Kt.match(Z)})),pe=pe.map(function(Kt){return new $n(Kt,D)})},bt.prototype.intersects=function(b,D){if(!(b instanceof bt))throw new TypeError("a Range is required");return this.set.some(function(k){return k.every(function(Z){return b.set.some(function(pe){return pe.every(function(Kt){return Z.intersects(Kt,D)})})})})},t.toComparators=function(b,D){return new bt(b,D).set.map(function(k){return k.map(function(Z){return Z.value}).join(" ").trim().split(" ")})},bt.prototype.test=function(b){if(!b)return!1;typeof b=="string"&&(b=new Ke(b,this.loose));for(var D=0;D<this.set.length;D++)if(F0(this.set[D],b))return!0;return!1},t.satisfies=od,t.maxSatisfying=function(b,D,k){var Z=null,pe=null;try{var Kt=new bt(D,k)}catch{return null}return b.forEach(function($e){Kt.test($e)&&(Z&&pe.compare($e)!==-1||(pe=new Ke(Z=$e,k)))}),Z},t.minSatisfying=function(b,D,k){var Z=null,pe=null;try{var Kt=new bt(D,k)}catch{return null}return b.forEach(function($e){Kt.test($e)&&(Z&&pe.compare($e)!==1||(pe=new Ke(Z=$e,k)))}),Z},t.validRange=function(b,D){try{return new bt(b,D).range||"*"}catch{return null}},t.ltr=function(b,D,k){return _h(b,D,"<",k)},t.gtr=function(b,D,k){return _h(b,D,">",k)},t.outside=_h,t.prerelease=function(b,D){var k=co(b,D);return k&&k.prerelease.length?k.prerelease:null},t.intersects=function(b,D,k){return b=new bt(b,k),D=new bt(D,k),b.intersects(D)},t.coerce=function(b){if(b instanceof Ke)return b;if(typeof b!="string")return null;var D=b.match(a[N]);return D==null?null:co((D[1]||"0")+"."+(D[2]||"0")+"."+(D[3]||"0"))}}).call(this,e(1))},function(r,t){var e,n,i=r.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(I){if(e===setTimeout)return setTimeout(I,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(I,0);try{return e(I,0)}catch{try{return e.call(null,I,0)}catch{return e.call(this,I,0)}}}(function(){try{e=typeof setTimeout=="function"?setTimeout:o}catch{e=o}try{n=typeof clearTimeout=="function"?clearTimeout:s}catch{n=s}})();var l,c=[],d=!1,u=-1;function f(){d&&l&&(d=!1,l.length?c=l.concat(c):u=-1,c.length&&h())}function h(){if(!d){var I=a(f);d=!0;for(var x=c.length;x;){for(l=c,c=[];++u<x;)l&&l[u].run();u=-1,x=c.length}l=null,d=!1,function(T){if(n===clearTimeout)return clearTimeout(T);if((n===s||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(T);try{n(T)}catch{try{return n.call(null,T)}catch{return n.call(this,T)}}}(I)}}function v(I,x){this.fun=I,this.array=x}function y(){}i.nextTick=function(I){var x=new Array(arguments.length-1);if(arguments.length>1)for(var T=1;T<arguments.length;T++)x[T-1]=arguments[T];c.push(new v(I,x)),c.length!==1||d||a(h)},v.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=y,i.addListener=y,i.once=y,i.off=y,i.removeListener=y,i.removeAllListeners=y,i.emit=y,i.prependListener=y,i.prependOnceListener=y,i.listeners=function(I){return[]},i.binding=function(I){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(I){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}])});var dJ=ke.exports.SEMVER_SPEC_VERSION,uJ=ke.exports.parse,vx=ke.exports.valid,fJ=ke.exports.coerce,pJ=ke.exports.clean,hJ=ke.exports.inc,gJ=ke.exports.major,mJ=ke.exports.minor,yJ=ke.exports.patch,vJ=ke.exports.prerelease,la=ke.exports.gt,IJ=ke.exports.gte,SJ=ke.exports.lt,bJ=ke.exports.lte,Ix=ke.exports.eq,xJ=ke.exports.neq,EJ=ke.exports.cmp,wJ=ke.exports.compare,_f=ke.exports.rcompare,PJ=ke.exports.compareIdentifiers,TJ=ke.exports.rcompareIdentifiers,RJ=ke.exports.compareBuild,CJ=ke.exports.sort,DJ=ke.exports.rsort,_J=ke.exports.diff,kJ=ke.exports.validRange,UJ=ke.exports.satisfies,LJ=ke.exports.maxSatisfying,FJ=ke.exports.minSatisfying,AJ=ke.exports.minVersion,OJ=ke.exports.gtr,MJ=ke.exports.ltr,NJ=ke.exports.outside,BJ=ke.exports.intersects,WJ=ke.exports.SemVer,VJ=ke.exports.Comparator,KJ=ke.exports.Range;var vT={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts"},aiTextSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProviderNew.d.ts"},attributableCoverage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.attributableCoverage.d.ts"},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:2},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},chatVariableResolver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatVariableResolver.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribChatParticipantDetection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribChatParticipantDetection.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribIssueReporter:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribIssueReporter.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},createFileSystemWatcher:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.createFileSystemWatcher.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts"},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},documentPaste:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentPaste.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileComments:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileComments.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProviderNew.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts"},findFiles2New:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2New.d.ts"},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFilesNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFilesNew.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},idToken:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},inlineEdit:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineEdit.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},lmTools:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.lmTools.d.ts",version:6},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookCellExecutionState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecutionState.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},showLocal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.showLocal.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textSearchCompleteNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchCompleteNew.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProviderNew.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},Sx=Object.freeze(vT);var xx=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,IT=/^-(\d{4})(\d{2})(\d{2})$/;function ST(r){return r=r.trim(),r==="*"||xx.test(r)}function Xm(r){if(!ST(r))return null;if(r=r.trim(),r==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};let t=r.match(xx);return t?{hasCaret:t[1]==="^",hasGreaterEquals:t[1]===">=",majorBase:t[2]==="x"?0:parseInt(t[2],10),majorMustEqual:t[2]!=="x",minorBase:t[4]==="x"?0:parseInt(t[4],10),minorMustEqual:t[4]!=="x",patchBase:t[6]==="x"?0:parseInt(t[6],10),patchMustEqual:t[6]!=="x",preRelease:t[8]||null}:null}function Ym(r){if(!r)return null;let t=r.majorBase,e=r.majorMustEqual,n=r.minorBase,i=r.minorMustEqual,o=r.patchBase,s=r.patchMustEqual;r.hasCaret&&(t===0||(i=!1),s=!1);let a=0;if(r.preRelease){let l=IT.exec(r.preRelease);if(l){let[,c,d,u]=l;a=Date.UTC(Number(c),Number(d)-1,Number(u))}}return{majorBase:t,majorMustEqual:e,minorBase:n,minorMustEqual:i,patchBase:o,patchMustEqual:s,isMinimum:r.hasGreaterEquals,notBefore:a}}function bT(r,t,e){let n;typeof r=="string"?n=Ym(Xm(r)):n=r;let i;t instanceof Date?i=t.getTime():typeof t=="string"&&(i=new Date(t).getTime());let o;if(typeof e=="string"?o=Ym(Xm(e)):o=e,!n||!o)return!1;let s=n.majorBase,a=n.minorBase,l=n.patchBase,c=o.majorBase,d=o.minorBase,u=o.patchBase,f=o.notBefore,h=o.majorMustEqual,v=o.minorMustEqual,y=o.patchMustEqual;return o.isMinimum?s>c?!0:s<c?!1:a>d?!0:a<d||i&&i<f?!1:l>=u:(s===1&&c===0&&(!h||!v||!y)&&(c=1,d=0,u=0,h=!0,v=!1,y=!1),s<c?!1:s>c?!h:a<d?!1:a>d?!v:l<u?!1:l>u?!y:!(i&&i<f))}function Ex(r,t,e,n,i,o){let s=[];if(typeof n.publisher<"u"&&typeof n.publisher!="string")return s.push([Mt.Error,g("extensionDescription.publisher","property publisher must be of type `string`.")]),s;if(typeof n.name!="string")return s.push([Mt.Error,g("extensionDescription.name","property `{0}` is mandatory and must be of type `string`","name")]),s;if(typeof n.version!="string")return s.push([Mt.Error,g("extensionDescription.version","property `{0}` is mandatory and must be of type `string`","version")]),s;if(!n.engines)return s.push([Mt.Error,g("extensionDescription.engines","property `{0}` is mandatory and must be of type `object`","engines")]),s;if(typeof n.engines.vscode!="string")return s.push([Mt.Error,g("extensionDescription.engines.vscode","property `{0}` is mandatory and must be of type `string`","engines.vscode")]),s;if(typeof n.extensionDependencies<"u"&&!bx(n.extensionDependencies))return s.push([Mt.Error,g("extensionDescription.extensionDependencies","property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")]),s;if(typeof n.activationEvents<"u"){if(!bx(n.activationEvents))return s.push([Mt.Error,g("extensionDescription.activationEvents1","property `{0}` can be omitted or must be of type `string[]`","activationEvents")]),s;if(typeof n.main>"u"&&typeof n.browser>"u")return s.push([Mt.Error,g("extensionDescription.activationEvents2","property `{0}` should be omitted if the extension doesn't have a `{1}` or `{2}` property.","activationEvents","main","browser")]),s}if(typeof n.extensionKind<"u"&&typeof n.main>"u"&&s.push([Mt.Warning,g("extensionDescription.extensionKind","property `{0}` can be defined only if property `main` is also defined.","extensionKind")]),typeof n.main<"u"){if(typeof n.main!="string")return s.push([Mt.Error,g("extensionDescription.main1","property `{0}` can be omitted or must be of type `string`","main")]),s;{let c=V(e,n.main);hg(c,e)||s.push([Mt.Warning,g("extensionDescription.main2","Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(typeof n.browser<"u"){if(typeof n.browser!="string")return s.push([Mt.Error,g("extensionDescription.browser1","property `{0}` can be omitted or must be of type `string`","browser")]),s;{let c=V(e,n.browser);hg(c,e)||s.push([Mt.Warning,g("extensionDescription.browser2","Expected `browser` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(!vx(n.version))return s.push([Mt.Error,g("notSemver","Extension version is not semver compatible.")]),s;let a=[];if(!xT(r,t,n,i,a))for(let c of a)s.push([Mt.Error,c]);if(o&&n.enabledApiProposals?.length){let c=[];if(!xc([...n.enabledApiProposals],c))for(let d of c)s.push([Mt.Error,d])}return s}function xT(r,t,e,n,i){return n||typeof e.main>"u"&&typeof e.browser>"u"?!0:wx(r,t,e.engines.vscode,i)}function ca(r,t,e){return r==="*"||wx(t,e,r)}function xc(r,t){if(r.length===0)return!0;let e=Array.isArray(t)?t:void 0,n=(e?void 0:t)??Sx,i=[],o=zS(r);for(let{proposalName:s,version:a}of o){let l=n[s];l&&a&&l.version!==a&&i.push(g("apiProposalMismatch","Extension is using an API proposal '{0}' that is not compatible with the current version of VS Code.",s))}return e?.push(...i),i.length===0}function wx(r,t,e,n=[]){let i=Ym(Xm(e));if(!i)return n.push(g("versionSyntax","Could not parse `engines.vscode` value {0}. Please use, for example: ^1.22.0, ^1.22.x, etc.",e)),!1;if(i.majorBase===0){if(!i.majorMustEqual||!i.minorMustEqual)return n.push(g("versionSpecificity1","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions before 1.0.0, please define at a minimum the major and minor desired version. E.g. ^0.10.0, 0.10.x, 0.11.0, etc.",e)),!1}else if(!i.majorMustEqual)return n.push(g("versionSpecificity2","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions after 1.0.0, please define at a minimum the major desired version. E.g. ^1.10.0, 1.10.x, 1.x.x, 2.x.x, etc.",e)),!1;return bT(r,t,i)?!0:(n.push(g("versionMismatch","Extension is not compatible with Code {0}. Extension requires: {1}.",r,e)),!1)}function bx(r){if(!Array.isArray(r))return!1;for(let t=0,e=r.length;t<e;t++)if(typeof r[t]!="string")return!1;return!0}async function Qn(r,t,e){let n=e&&e.get("storage.serviceMachineId",-1)||null;if(n)return n;try{let o=(await t.readFile(r.serviceMachineIdResource)).value.toString();n=Ib(o)?o:null}catch{n=null}if(!n){n=Fe();try{await t.writeFile(r.serviceMachineIdResource,A.fromString(n))}catch{}}return e?.store("storage.serviceMachineId",n,-1,1),n}async function Px(r,t,e,n,i,o,s){let a={"X-Market-Client-Id":`VSCode ${r}`,"User-Agent":`VSCode ${r} (${t.nameShort})`};if(Fs(t,e)&&Vu(n)===3){let l=await Qn(e,i,o);a["X-Market-User-Id"]=l,a["VSCode-SessionId"]=s.machineId||l}return a}var Tx=qe?"web":Eu(Tr,vd),Ec="X-Market-Search-Activity-Id";function PT(...r){return String(r.reduce((t,e)=>t|e,0))}var en={Icon:"Microsoft.VisualStudio.Services.Icons.Default",Details:"Microsoft.VisualStudio.Services.Content.Details",Changelog:"Microsoft.VisualStudio.Services.Content.Changelog",Manifest:"Microsoft.VisualStudio.Code.Manifest",VSIX:"Microsoft.VisualStudio.Services.VSIXPackage",License:"Microsoft.VisualStudio.Services.Content.License",Repository:"Microsoft.VisualStudio.Services.Links.Source",Signature:"Microsoft.VisualStudio.Services.VsixSignature"},ii={Dependency:"Microsoft.VisualStudio.Code.ExtensionDependencies",ExtensionPack:"Microsoft.VisualStudio.Code.ExtensionPack",Engine:"Microsoft.VisualStudio.Code.Engine",PreRelease:"Microsoft.VisualStudio.Code.PreRelease",EnabledApiProposals:"Microsoft.VisualStudio.Code.EnabledApiProposals",LocalizedLanguages:"Microsoft.VisualStudio.Code.LocalizedLanguages",WebExtension:"Microsoft.VisualStudio.Code.WebExtension",SponsorLink:"Microsoft.VisualStudio.Code.SponsorLink",SupportLink:"Microsoft.VisualStudio.Services.Links.Support",ExecutesCode:"Microsoft.VisualStudio.Code.ExecutesCode"},TT=10,RT={pageNumber:1,pageSize:TT,sortBy:0,sortOrder:0,flags:0,criteria:[],assetTypes:[]},Uo=class r{constructor(t=RT){this.state=t}get pageNumber(){return this.state.pageNumber}get pageSize(){return this.state.pageSize}get sortBy(){return this.state.sortBy}get sortOrder(){return this.state.sortOrder}get flags(){return this.state.flags}get criteria(){return this.state.criteria}withPage(t,e=this.state.pageSize){return new r({...this.state,pageNumber:t,pageSize:e})}withFilter(t,...e){let n=[...this.state.criteria,...e.length?e.map(i=>({filterType:t,value:i})):[{filterType:t}]];return new r({...this.state,criteria:n})}withSortBy(t){return new r({...this.state,sortBy:t})}withSortOrder(t){return new r({...this.state,sortOrder:t})}withFlags(...t){return new r({...this.state,flags:t.reduce((e,n)=>e|n,0)})}withAssetTypes(...t){return new r({...this.state,assetTypes:t})}withSource(t){return new r({...this.state,source:t})}get raw(){let{criteria:t,pageNumber:e,pageSize:n,sortBy:i,sortOrder:o,flags:s,assetTypes:a}=this.state;return{filters:[{criteria:t,pageNumber:e,pageSize:n,sortBy:i,sortOrder:o}],assetTypes:a,flags:s}}get searchText(){let t=this.state.criteria.filter(e=>e.filterType===10)[0];return t&&t.value?t.value:""}get telemetryData(){return{filterTypes:this.state.criteria.map(t=>String(t.filterType)),flags:this.state.flags,sortBy:String(this.sortBy),sortOrder:String(this.sortOrder),pageNumber:String(this.pageNumber),source:this.state.source,searchTextLength:this.searchText.length}}};function Zm(r,t){let e=(r||[]).filter(n=>n.statisticName===t)[0];return e?e.value:0}function CT(r){let t="Microsoft.VisualStudio.Code.Translation.";return r.files.filter(n=>n.assetType.indexOf(t)===0).reduce((n,i)=>{let o=ri(r,i.assetType);return o&&n.push([i.assetType.substring(t.length),o]),n},[])}function DT(r){if(r.properties){let t=r.properties.filter(i=>i.key===en.Repository),e=new RegExp("((git|ssh|http(s)?)|(git@[\\w.]+))(:(//)?)([\\w.@:/\\-~]+)(.git)(/)?"),n=t.filter(i=>e.test(i.value))[0];return n?{uri:n.value,fallbackUri:n.value}:null}return ri(r,en.Repository)}function _T(r){return{uri:`${r.fallbackAssetUri}/${en.VSIX}?redirect=true${r.targetPlatform?`&targetPlatform=${r.targetPlatform}`:""}`,fallbackUri:`${r.fallbackAssetUri}/${en.VSIX}${r.targetPlatform?`?targetPlatform=${r.targetPlatform}`:""}`}}function ri(r,t){return r.files.filter(n=>n.assetType===t)[0]?{uri:`${r.assetUri}/${t}${r.targetPlatform?`?targetPlatform=${r.targetPlatform}`:""}`,fallbackUri:`${r.fallbackAssetUri}/${t}${r.targetPlatform?`?targetPlatform=${r.targetPlatform}`:""}`}:null}function Rx(r,t){let e=r.properties?r.properties.filter(i=>i.key===t):[],n=e.length>0&&e[0].value;return n?n.split(",").map(i=>To(i)):[]}function kx(r){let t=r.properties?r.properties.filter(e=>e.key===ii.Engine):[];return t.length>0&&t[0].value||""}function Uf(r){let t=r.properties?r.properties.filter(e=>e.key===ii.PreRelease):[];return t.length>0&&t[0].value==="true"}function kT(r){let t=r.properties?r.properties.filter(e=>e.key===ii.ExecutesCode):[];return t.length>0?t[0].value==="true":void 0}function ty(r){let t=r.properties?r.properties.filter(n=>n.key===ii.EnabledApiProposals):[],e=t.length>0&&t[0].value||"";return e?e.split(","):[]}function UT(r){let t=r.properties?r.properties.filter(n=>n.key===ii.LocalizedLanguages):[],e=t.length>0&&t[0].value||"";return e?e.split(","):[]}function LT(r){return r.properties?.find(t=>t.key===ii.SponsorLink)?.value}function FT(r){return r.properties?.find(t=>t.key===ii.SupportLink)?.value}function AT(r){return r.indexOf("preview")!==-1}function Lf(r){return r.targetPlatform?XS(r.targetPlatform):"undefined"}function ey(r){let t=gt(r.versions.map(Lf)),e=!!r.tags?.includes(HS),n=t.indexOf("web");return e?n===-1&&t.push("web"):n!==-1&&t.splice(n,1),t}function Cx(r,t){for(let e=0;e<r.length;e++){let n=r[e];if(n.version===r[e-1]?.version){let i=e;if(Lf(n)===t)for(;i>0&&r[i-1].version===n.version;)i--;i!==e&&(r.splice(e,1),r.splice(i,0,n))}}return r}function Dx(r,t,e){r.telemetryData={index:t,querySource:e,queryActivityId:r.queryContext?.[Ec]}}function _x(r,t,e,n){let i=r.versions[0],o={manifest:ri(t,en.Manifest),readme:ri(t,en.Details),changelog:ri(t,en.Changelog),license:ri(t,en.License),repository:DT(t),download:_T(t),icon:ri(t,en.Icon),signature:ri(t,en.Signature),coreTranslations:CT(t)};return{type:"gallery",identifier:{id:Hn(r.publisher.publisherName,r.extensionName),uuid:r.extensionId},name:r.extensionName,version:t.version,displayName:r.displayName,publisherId:r.publisher.publisherId,publisher:r.publisher.publisherName,publisherDisplayName:r.publisher.displayName,publisherDomain:r.publisher.domain?{link:r.publisher.domain,verified:!!r.publisher.isDomainVerified}:void 0,publisherSponsorLink:LT(i),description:r.shortDescription??"",installCount:Zm(r.statistics,"install"),rating:Zm(r.statistics,"averagerating"),ratingCount:Zm(r.statistics,"ratingcount"),categories:r.categories||[],tags:r.tags||[],releaseDate:Date.parse(r.releaseDate),lastUpdated:Date.parse(r.lastUpdated),allTargetPlatforms:e,assets:o,properties:{dependencies:Rx(t,ii.Dependency),extensionPack:Rx(t,ii.ExtensionPack),engine:kx(t),enabledApiProposals:ty(t),localizedLanguages:UT(t),targetPlatform:Lf(t),isPreReleaseVersion:Uf(t),executesCode:kT(t)},hasPreReleaseVersion:Uf(i),hasReleaseVersion:!0,preview:AT(r.flags),isSigned:!!o.signature,queryContext:n,supportLink:FT(i)}}var da=class{constructor(t,e,n,i,o,s,a,l){this.requestService=e;this.logService=n;this.environmentService=i;this.telemetryService=o;this.fileService=s;this.productService=a;this.configurationService=l;let c=a.extensionsGallery,d=c?.servicePPEUrl&&l.getValue("_extensionsGallery.enablePPE");this.extensionsGalleryUrl=d?c.servicePPEUrl:c?.serviceUrl,this.extensionsGallerySearchUrl=d?void 0:c?.searchUrl,this.extensionsControlUrl=c?.controlUrl,this.extensionsEnabledWithApiProposalVersion=a.extensionsEnabledWithApiProposalVersion?.map(u=>u.toLowerCase())??[],this.commonHeadersPromise=Px(a.version,a,this.environmentService,this.configurationService,this.fileService,t,this.telemetryService)}extensionsGalleryUrl;extensionsGallerySearchUrl;extensionsControlUrl;commonHeadersPromise;extensionsEnabledWithApiProposalVersion;api(t=""){return`${this.extensionsGalleryUrl}${t}`}isEnabled(){return!!this.extensionsGalleryUrl}async getExtensions(t,e,n){let i=ee.isCancellationToken(e)?{}:e,o=ee.isCancellationToken(e)?e:n,s=await this.doGetExtensions(t,i,o),a=s.map(c=>c.identifier.uuid),l=[];for(let c of t)c.uuid&&!a.includes(c.uuid)&&l.push({...c,uuid:void 0});if(l.length){this.telemetryService.publicLog2("galleryService:additionalQueryByName",{count:l.length});let c=await this.doGetExtensions(l,i,o);s.push(...c)}return s}async doGetExtensions(t,e,n){let i=[],o=[],s=[],a=[],l=!0;for(let u of t){u.uuid?o.push(u.uuid):i.push(u.id);let f=!!(u.version||u.preRelease);s.push({id:u.id,uuid:u.uuid,includePreRelease:f}),u.version&&a.push({id:u.id,uuid:u.uuid,version:u.version}),l=l&&!!u.hasPreRelease&&!f}if(!o.length&&!i.length)return[];let c=new Uo().withPage(1,t.length);o.length&&(c=c.withFilter(4,...o)),i.length&&(c=c.withFilter(7,...i)),(e.queryAllVersions||l)&&(c=c.withFlags(c.flags,1)),e.source&&(c=c.withSource(e.source));let{extensions:d}=await this.queryGalleryExtensions(c,{targetPlatform:e.targetPlatform??Tx,includePreRelease:s,versions:a,compatible:!!e.compatible,productVersion:e.productVersion??{version:this.productService.version,date:this.productService.date}},n);return e.source&&d.forEach((u,f)=>Dx(u,f,e.source)),d}async getCompatibleExtension(t,e,n,i={version:this.productService.version,date:this.productService.date}){if(xs(t.allTargetPlatforms,n))return null;if(await this.isExtensionCompatible(t,e,n))return t;let o=new Uo().withFlags(1).withPage(1,1).withFilter(4,t.identifier.uuid),{extensions:s}=await this.queryGalleryExtensions(o,{targetPlatform:n,compatible:!0,includePreRelease:e,productVersion:i},ee.None);return s[0]||null}async isExtensionCompatible(t,e,n,i={version:this.productService.version,date:this.productService.date}){if(!Es(t.properties.targetPlatform,t.allTargetPlatforms,n)||!e&&t.properties.isPreReleaseVersion)return!1;let o=t.properties.engine;if(!o){let s=await this.getManifest(t,ee.None);if(!s)throw new Error("Manifest was not found");o=s.engines.vscode}return!(!ca(o,i.version,i.date)||!this.areApiProposalsCompatible(t.identifier,t.properties.enabledApiProposals))}areApiProposalsCompatible(t,e){return!e||!this.extensionsEnabledWithApiProposalVersion.includes(t.id.toLowerCase())?!0:xc(e)}async isValidVersion(t,e,n,i,o,s,a={version:this.productService.version,date:this.productService.date}){if(!Es(Lf(e),o,s)||n!=="any"&&Uf(e)!==(n==="prerelease"))return!1;if(i)try{let l=await this.getEngine(t,e);if(!ca(l,a.version,a.date))return!1}catch(l){return this.logService.error(`Error while getting the engine for the version ${e.version}.`,me(l)),!1}return!0}async query(t,e){let n=t.text||"",i=t.pageSize??50,o=new Uo().withPage(1,i);n?(n=n.replace(/\bcategory:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(d,u,f)=>(o=o.withFilter(5,f||u),"")),n=n.replace(/\btag:("([^"]*)"|([^"]\S*))(\s+|\b|$)/g,(d,u,f)=>(o=o.withFilter(1,f||u),"")),n=n.replace(/\bfeatured(\s+|\b|$)/g,()=>(o=o.withFilter(9),"")),n=n.trim(),n&&(n=n.length<200?n:n.substring(0,200),o=o.withFilter(10,n)),o=o.withSortBy(0)):t.ids?o=o.withFilter(4,...t.ids):t.names?o=o.withFilter(7,...t.names):o=o.withSortBy(4),typeof t.sortBy=="number"&&(o=o.withSortBy(t.sortBy)),typeof t.sortOrder=="number"&&(o=o.withSortOrder(t.sortOrder)),t.source&&(o=o.withSource(t.source));let s=async(d,u)=>{let{extensions:f,total:h}=await this.queryGalleryExtensions(d,{targetPlatform:Tx,compatible:!1,includePreRelease:!!t.includePreRelease,productVersion:t.productVersion??{version:this.productService.version,date:this.productService.date}},u);return f.forEach((v,y)=>Dx(v,(d.pageNumber-1)*d.pageSize+y,t.source)),{extensions:f,total:h}},{extensions:a,total:l}=await s(o,e),c=async(d,u)=>{if(u.isCancellationRequested)throw new Ge;let{extensions:f}=await s(o.withPage(d+1),u);return f};return{firstPage:a,total:l,pageSize:o.pageSize,getPage:c}}async queryGalleryExtensions(t,e,n){let i=t.flags;t.flags&512&&t.flags&1&&(t=t.withFlags(t.flags&-2,512)),!(t.flags&512)&&!(t.flags&1)&&(t=t.withFlags(t.flags,512)),e.versions?.length&&(t=t.withFlags(t.flags&-513,1)),t=t.withFlags(t.flags,128,4,2,256,16);let{galleryExtensions:o,total:s,context:a}=await this.queryRawGalleryExtensions(t,n);if(!(t.flags&512)){let u=[];for(let f of o){let h=await this.toGalleryExtensionWithCriteria(f,e,a);h&&u.push(h)}return{extensions:u,total:s}}let c=[],d=new Map;for(let u=0;u<o.length;u++){let f=o[u],h={id:Hn(f.publisher.publisherName,f.extensionName),uuid:f.extensionId},v=pn(e.includePreRelease)?e.includePreRelease:!!e.includePreRelease.find(I=>Y(I,h))?.includePreRelease;if(e.compatible&&xs(ey(f),e.targetPlatform))continue;let y=await this.toGalleryExtensionWithCriteria(f,e,a);!y||y.properties.isPreReleaseVersion&&(!v||!y.hasReleaseVersion)||!y.properties.isPreReleaseVersion&&y.properties.targetPlatform!==e.targetPlatform&&y.hasPreReleaseVersion?d.set(f.extensionId,u):c.push([u,y])}if(d.size){let u=new dr,f=new Uo().withFlags(i&-513,1).withPage(1,d.size).withFilter(4,...d.keys()),{extensions:h}=await this.queryGalleryExtensions(f,e,n);this.telemetryService.publicLog2("galleryService:additionalQuery",{duration:u.elapsed(),count:d.size});for(let v of h){let y=d.get(v.identifier.uuid);c.push([y,v])}}return{extensions:c.sort((u,f)=>u[0]-f[0]).map(([,u])=>u),total:s}}async toGalleryExtensionWithCriteria(t,e,n){let i={id:Hn(t.publisher.publisherName,t.extensionName),uuid:t.extensionId},o=e.versions?.find(c=>Y(c,i))?.version,s=pn(e.includePreRelease)?e.includePreRelease:!!e.includePreRelease.find(c=>Y(c,i))?.includePreRelease,a=ey(t),l=Cx(t.versions,e.targetPlatform);if(e.compatible&&xs(a,e.targetPlatform))return null;for(let c=0;c<l.length;c++){let d=l[c];if(!(o&&d.version!==o)){if(await this.isValidVersion(i.id,d,s?"any":"release",e.compatible,a,e.targetPlatform,e.productVersion)){if(e.compatible&&!this.areApiProposalsCompatible(i,ty(d)))continue;return _x(t,d,a,n)}if(o&&d.version===o)return null}}return o||e.compatible?null:_x(t,t.versions[0],a)}async queryRawGalleryExtensions(t,e){if(!this.isEnabled())throw new Error("No extension gallery service configured.");t=t.withFlags(t.flags,32).withFilter(8,"Microsoft.VisualStudio.Code").withFilter(12,PT(4096));let n=await this.commonHeadersPromise,i=JSON.stringify(t.raw),o={...n,"Content-Type":"application/json",Accept:"application/json;api-version=3.0-preview.1","Accept-Encoding":"gzip","Content-Length":String(i.length)},s=new dr,a,l,c=0;try{if(a=await this.requestService.request({type:"POST",url:this.extensionsGallerySearchUrl&&t.criteria.some(u=>u.filterType===10)?this.extensionsGallerySearchUrl:this.api("/extensionquery"),data:i,headers:o},e),a.res.statusCode&&a.res.statusCode>=400&&a.res.statusCode<500)return{galleryExtensions:[],total:c};let d=await _o(a);if(d){let u=d.results[0],f=u.extensions,h=u.resultMetadata&&u.resultMetadata.filter(v=>v.metadataType==="ResultCount")[0];return c=h&&h.metadataItems.filter(v=>v.name==="TotalCount")[0].count||0,{galleryExtensions:f,total:c,context:a.res.headers.activityid?{[Ec]:a.res.headers.activityid}:{}}}return{galleryExtensions:[],total:c}}catch(d){if(Rn(d))throw l="Cancelled",d;{let u=me(d);throw l=Lb(d)?"Offline":u.startsWith("XHR timeout")?"Timeout":"Failed",new ki(u,l)}}finally{this.telemetryService.publicLog2("galleryService:query",{...t.telemetryData,requestBodySize:String(i.length),duration:s.elapsed(),success:!!a&&Li(a),responseBodySize:a?.res.headers["Content-Length"],statusCode:a?String(a.res.statusCode):void 0,errorCode:l,count:String(c)})}}async reportStatistic(t,e,n,i){if(!this.isEnabled())return;let o=qe?this.api(`/itemName/${t}.${e}/version/${n}/statType/${i==="install"?"1":"3"}/vscodewebextension`):this.api(`/publishers/${t}/extensions/${e}/${n}/stats?statType=${i}`),s=qe?"api-version=6.1-preview.1":"*/*;api-version=4.0-preview.1",l={...await this.commonHeadersPromise,Accept:s};try{await this.requestService.request({type:"POST",url:o,headers:l},ee.None)}catch{}}async download(t,e,n){this.logService.trace("ExtensionGalleryService#download",t.identifier.id);let i=fc(t),o=new Date().getTime(),s=n===2?"install":n===3?"update":"",a=s?{uri:`${t.assets.download.uri}${C.parse(t.assets.download.uri).query?"&":"?"}${s}=true`,fallbackUri:`${t.assets.download.fallbackUri}${C.parse(t.assets.download.fallbackUri).query?"&":"?"}${s}=true`}:t.assets.download,l=t.queryContext?.[Ec]?{[Ec]:t.queryContext[Ec]}:void 0,c=await this.getAsset(t.identifier.id,a,en.VSIX,l?{headers:l}:void 0);try{await this.fileService.writeFile(e,c.stream)}catch(d){try{await this.fileService.del(e)}catch(u){this.logService.warn(`Error while deleting the file ${e.toString()}`,me(u))}throw new ki(me(d),"DownloadFailedWriting")}this.telemetryService.publicLog("galleryService:downloadVSIX",{...i,duration:new Date().getTime()-o})}async downloadSignatureArchive(t,e){if(!t.assets.signature)throw new Error("No signature asset found");this.logService.trace("ExtensionGalleryService#downloadSignatureArchive",t.identifier.id);let n=await this.getAsset(t.identifier.id,t.assets.signature,en.Signature);try{await this.fileService.writeFile(e,n.stream)}catch(i){try{await this.fileService.del(e)}catch(o){this.logService.warn(`Error while deleting the file ${e.toString()}`,me(o))}throw new ki(me(i),"DownloadFailedWriting")}}async getReadme(t,e){if(t.assets.readme){let n=await this.getAsset(t.identifier.id,t.assets.readme,en.Details,{},e);return await Nn(n)||""}return""}async getManifest(t,e){if(t.assets.manifest){let n=await this.getAsset(t.identifier.id,t.assets.manifest,en.Manifest,{},e),i=await Nn(n);return i?JSON.parse(i):null}return null}async getManifestFromRawExtensionVersion(t,e,n){let i=ri(e,en.Manifest);if(!i)throw new Error("Manifest was not found");let o={"Accept-Encoding":"gzip"},s=await this.getAsset(t,i,en.Manifest,{headers:o});return await _o(s)}async getCoreTranslation(t,e){let n=t.assets.coreTranslations.filter(i=>i[0]===e.toUpperCase())[0];if(n){let i=await this.getAsset(t.identifier.id,n[1],n[0]),o=await Nn(i);return o?JSON.parse(o):null}return null}async getChangelog(t,e){if(t.assets.changelog){let n=await this.getAsset(t.identifier.id,t.assets.changelog,en.Changelog,{},e);return await Nn(n)||""}return""}async getAllCompatibleVersions(t,e,n){let i=new Uo().withFlags(1,4,2,16).withPage(1,1);t.uuid?i=i.withFilter(4,t.uuid):i=i.withFilter(7,t.id);let{galleryExtensions:o}=await this.queryRawGalleryExtensions(i,ee.None);if(!o.length)return[];let s=ey(o[0]);if(xs(s,n))return[];let a=[];await Promise.all(o[0].versions.map(async d=>{try{await this.isValidVersion(t.id,d,e?"any":"release",!0,s,n)&&this.areApiProposalsCompatible(t,ty(d))&&a.push(d)}catch{}}));let l=[],c=new Set;for(let d of Cx(a,n))c.has(d.version)||(c.add(d.version),l.push({version:d.version,date:d.lastUpdated,isPreReleaseVersion:Uf(d)}));return l}async getAsset(t,e,n,i={},o=ee.None){let s=await this.commonHeadersPromise,a={type:"GET"},l={...s,...i.headers||{}};i={...i,...a,headers:l};let c=e.uri,d=e.fallbackUri,u={...i,url:c};try{let f=await this.requestService.request(u,o);if(f.res.statusCode===200)return f;let h=await Nn(f);throw new Error(`Expected 200, got back ${f.res.statusCode} instead.

${h}`)}catch(f){if(Rn(f))throw f;let h=me(f);this.telemetryService.publicLog2("galleryService:cdnFallback",{extension:t,assetType:n,message:h});let v={...i,url:d};return this.requestService.request(v,o)}}async getEngine(t,e){let n=kx(e);if(!n){this.telemetryService.publicLog2("galleryService:engineFallback",{extension:t,version:e.version});let i=await this.getManifestFromRawExtensionVersion(t,e,ee.None);if(!i)throw new Error("Manifest was not found");n=i.engines.vscode}return n}async getExtensionsControlManifest(){if(!this.isEnabled())throw new Error("No extension gallery service configured.");if(!this.extensionsControlUrl)return{malicious:[],deprecated:{},search:[]};let t=await this.requestService.request({type:"GET",url:this.extensionsControlUrl},ee.None);if(t.res.statusCode!==200)throw new Error("Could not get extensions report.");let e=await _o(t),n=[],i={},o=[],s=[];if(e){for(let a of e.malicious)n.push({id:a});if(e.migrateToPreRelease)for(let[a,l]of Object.entries(e.migrateToPreRelease))(!l.engine||ca(l.engine,this.productService.version,this.productService.date))&&(i[a.toLowerCase()]={disallowInstall:!0,extension:{id:l.id,displayName:l.displayName,autoMigrate:{storage:!!l.migrateStorage},preRelease:!0}});if(e.deprecated)for(let[a,l]of Object.entries(e.deprecated))l&&(i[a.toLowerCase()]=pn(l)?{}:l);if(e.search)for(let a of e.search)o.push(a);if(Array.isArray(e.extensionsEnabledWithPreRelease))for(let a of e.extensionsEnabledWithPreRelease)s.push(a.toLowerCase())}return{malicious:n,deprecated:i,search:o,extensionsEnabledWithPreRelease:s}}};da=E([m(1,vr),m(2,z),m(3,oe),m(4,le),m(5,G),m(6,de),m(7,ue)],da);var ua=class extends da{constructor(t,e,n,i,o,s,a,l){super(t,e,n,i,o,s,a,l)}};ua=E([m(0,X),m(1,vr),m(2,z),m(3,oe),m(4,le),m(5,G),m(6,de),m(7,ue)],ua);var kf=class extends da{constructor(t,e,n,i,o,s,a){super(void 0,t,e,n,i,o,s,a)}};kf=E([m(0,vr),m(1,z),m(2,oe),m(3,le),m(4,G),m(5,de),m(6,ue)],kf);var ry=class{constructor(t,e,n){this.id=t;this.dependencies=e;this.callback=n}};var iy=class r{static INSTANCE=new r;_isWebWorker=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope";_isRenderer=typeof document=="object";_defineCalls=[];_state=1;_amdPolicy;constructor(){}_initialize(){if(this._state===1){if(globalThis.define){console.log("[amdX] AMD loader already present externally"),this._state=3;return}}else return;this._state=2,globalThis.define=(t,e,n)=>{typeof t!="string"&&(n=e,e=t,t=null),(typeof e!="object"||!Array.isArray(e))&&(n=e,e=null),this._defineCalls.push(new ry(t,e,n))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){if(t.startsWith(window.location.origin)||t.startsWith(`${ne.vscodeFileResource}://${ug}`))return t;throw new Error(`[trusted_script_src] Invalid script url: ${t}`)}}):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){return t}}))}async load(t){if(this._initialize(),this._state===3)return new Promise(s=>{let a=Fe();console.log(`[amdX] Using external define("${a}", ["${t}"])`),globalThis.define(a,[t],function(l){console.log(`[amdX] Got a result for ${a}: ${!!l}`),s(l)})});let e=await(this._isWebWorker?this._workerLoadScript(t):this._isRenderer?this._rendererLoadScript(t):this._nodeJSLoadScript(t));if(!e){console.warn(`Did not receive a define call from script ${t}`);return}let n={},i=[],o=[];if(Array.isArray(e.dependencies))for(let s of e.dependencies)s==="exports"?i.push(n):o.push(s);if(o.length>0)throw new Error(`Cannot resolve dependencies for script ${t}. The dependencies are: ${o.join(", ")}`);return typeof e.callback=="function"?e.callback(...i)??n:e.callback}_rendererLoadScript(t){return new Promise((e,n)=>{let i=document.createElement("script");i.setAttribute("async","async"),i.setAttribute("type","text/javascript");let o=()=>{i.removeEventListener("load",s),i.removeEventListener("error",a)},s=l=>{o(),e(this._defineCalls.pop())},a=l=>{o(),n(l)};i.addEventListener("load",s),i.addEventListener("error",a),this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),i.setAttribute("src",t),window.document.getElementsByTagName("head")[0].appendChild(i)})}async _workerLoadScript(t){return this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),await import(t),this._defineCalls.pop()}async _nodeJSLoadScript(t){try{let e=(await import("fs")).default,n=(await import("vm")).default,i=(await import("module")).default,o=C.parse(t).fsPath,s=e.readFileSync(o).toString(),a=i.wrap(s.replace(/^#!.*/,""));return new n.Script(a).runInThisContext().apply(),this._defineCalls.pop()}catch(e){throw e}}},ny=new Map;async function Lo(r,t,e){if(!0){e===void 0&&(e=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);let n=t?`${r}/${t}`:r;if(ny.has(n))return ny.get(n);let i;if(/^\w[\w\d+.-]*:\/\//.test(n))i=n;else{let l=`${MI}/${n}`;i=Sn.asBrowserUri(l).toString(!0)}let o=iy.INSTANCE.load(i);return ny.set(n,o),o}else return await import(r)}var Ff=M("IExtensionSignatureVerificationService");var oy=class extends Error{constructor(e){super(e);this.code=e}},fa=class{constructor(t,e){this.logService=t;this.telemetryService=e}moduleLoadingPromise;vsceSign(){return this.moduleLoadingPromise||(this.moduleLoadingPromise=this.resolveVsceSign()),this.moduleLoadingPromise}async resolveVsceSign(){return import("@vscode/vsce-sign")}async verify(t,e,n,i){let o,s=t.identifier.id;try{o=await this.vsceSign()}catch(d){return this.logService.error("Could not load vsce-sign module",me(d)),this.logService.info(`Extension signature verification is not done: ${s}`),!1}let a=new Date().getTime(),l;try{this.logService.trace(`Verifying extension signature for ${s}...`),l=await o.verify(e,n,this.logService.getLevel()===1)}catch(d){l={code:"UnknownError",didExecute:!1,output:me(d)}}let c=new Date().getTime()-a;if(this.logService.info(`Extension signature verification result for ${s}: ${l.code}. Executed: ${l.didExecute}. Duration: ${c}ms.`),this.logService.trace(`Extension signature verification output for ${s}:
${l.output}`),this.telemetryService.publicLog2("extensionsignature:verification",{extensionId:s,extensionVersion:t.version,code:l.code,internalCode:l.internalCode,duration:c,didExecute:l.didExecute,clientTargetPlatform:i}),l.code==="Success")return!0;throw new oy(l.code)}};fa=E([m(0,z),m(1,le)],fa);var sy=new class{transformIncoming(r){return r}transformOutgoing(r){return r}transformOutgoingURI(r){return r}transformOutgoingScheme(r){return r}};function Fx(r,t,e,n){if(!r||n>200)return null;if(typeof r=="object"){if(r.$mid===1)return e?C.revive(t.transformIncoming(r)):t.transformIncoming(r);if(r instanceof A)return null;for(let i in r)if(Object.hasOwnProperty.call(r,i)){let o=Fx(r[i],t,e,n+1);o!==null&&(r[i]=o)}}return null}function ay(r,t){let e=Fx(r,t,!0,0);return e===null?r:e}function Sr(r,t){return r?C.revive(t?t.transformIncoming(r):r):void 0}function pa(r,t){return t?t.transformOutgoingURI(r):r}function ha(r,t){t=t||sy;let e=r.manifest;return{...ay({...r,manifest:void 0},t),manifest:e}}function wc(r,t){return r?.profileLocation?ay(r,t??sy):r}function Pc(r,t){return t?Lu(r,e=>e instanceof C?t.transformOutgoingURI(e):void 0):r}var Af=class{constructor(t,e){this.service=t;this.getUriTransformer=e;this.onInstallExtension=O.buffer(t.onInstallExtension,!0),this.onDidInstallExtensions=O.buffer(t.onDidInstallExtensions,!0),this.onUninstallExtension=O.buffer(t.onUninstallExtension,!0),this.onDidUninstallExtension=O.buffer(t.onDidUninstallExtension,!0),this.onDidUpdateExtensionMetadata=O.buffer(t.onDidUpdateExtensionMetadata,!0)}onInstallExtension;onDidInstallExtensions;onUninstallExtension;onDidUninstallExtension;onDidUpdateExtensionMetadata;listen(t,e){let n=this.getUriTransformer(t);switch(e){case"onInstallExtension":return O.map(this.onInstallExtension,i=>({...i,profileLocation:i.profileLocation?pa(i.profileLocation,n):i.profileLocation}));case"onDidInstallExtensions":return O.map(this.onDidInstallExtensions,i=>i.map(o=>({...o,local:o.local?Pc(o.local,n):o.local,profileLocation:o.profileLocation?pa(o.profileLocation,n):o.profileLocation})));case"onUninstallExtension":return O.map(this.onUninstallExtension,i=>({...i,profileLocation:i.profileLocation?pa(i.profileLocation,n):i.profileLocation}));case"onDidUninstallExtension":return O.map(this.onDidUninstallExtension,i=>({...i,profileLocation:i.profileLocation?pa(i.profileLocation,n):i.profileLocation}));case"onDidUpdateExtensionMetadata":return O.map(this.onDidUpdateExtensionMetadata,i=>({local:Pc(i.local,n),profileLocation:pa(i.profileLocation,n)}))}throw new Error("Invalid listen")}async call(t,e,n){let i=this.getUriTransformer(t);switch(e){case"zip":{let o=ha(n[0],i),s=await this.service.zip(o);return pa(s,i)}case"install":return this.service.install(Sr(n[0],i),wc(n[1],i));case"installFromLocation":return this.service.installFromLocation(Sr(n[0],i),Sr(n[1],i));case"installExtensionsFromProfile":return this.service.installExtensionsFromProfile(n[0],Sr(n[1],i),Sr(n[2],i));case"getManifest":return this.service.getManifest(Sr(n[0],i));case"getTargetPlatform":return this.service.getTargetPlatform();case"canInstall":return this.service.canInstall(n[0]);case"installFromGallery":return this.service.installFromGallery(n[0],wc(n[1],i));case"installGalleryExtensions":{let o=n[0];return this.service.installGalleryExtensions(o.map(({extension:s,options:a})=>({extension:s,options:wc(a,i)??{}})))}case"uninstall":return this.service.uninstall(ha(n[0],i),wc(n[1],i));case"uninstallExtensions":{let o=n[0];return this.service.uninstallExtensions(o.map(({extension:s,options:a})=>({extension:ha(s,i),options:wc(a,i)})))}case"reinstallFromGallery":return this.service.reinstallFromGallery(ha(n[0],i));case"getInstalled":return(await this.service.getInstalled(n[0],Sr(n[1],i),n[2])).map(s=>Pc(s,i));case"toggleAppliationScope":{let o=await this.service.toggleAppliationScope(ha(n[0],i),Sr(n[1],i));return Pc(o,i)}case"copyExtensions":return this.service.copyExtensions(Sr(n[0],i),Sr(n[1],i));case"updateMetadata":{let o=await this.service.updateMetadata(ha(n[0],i),n[1],Sr(n[2],i));return Pc(o,i)}case"resetPinnedStateForAllUserExtensions":return this.service.resetPinnedStateForAllUserExtensions(n[0]);case"getExtensionsControlManifest":return this.service.getExtensionsControlManifest();case"download":return this.service.download(n[0],n[1],n[2]);case"cleanUp":return this.service.cleanUp()}throw new Error("Invalid call")}};var Of=class{constructor(t){this.service=t}listen(t,e){throw new Error("Invalid listen")}call(t,e,n){switch(e){case"getConfigBasedTips":return this.service.getConfigBasedTips(C.revive(n[0]));case"getImportantExecutableBasedTips":return this.service.getImportantExecutableBasedTips();case"getOtherExecutableBasedTips":return this.service.getOtherExecutableBasedTips()}throw new Error("Invalid call")}};import*as Hx from"fs";import{createWriteStream as Ax,promises as Ox}from"fs";var ly="end of central directory record signature not found",MT=new RegExp(ly),Fo=class extends Error{type;constructor(t,e){let n=e.message;switch(t){case"CorruptZip":n=`Corrupt ZIP: ${n}`;break}super(n),this.type=t,this.cause=e}};function NT(r){let t=r.externalFileAttributes>>16||33188;return[448,56,7].map(e=>t&e).reduce((e,n)=>e+n,t&61440)}function Mx(r){if(r instanceof Fo)return r;let t;return MT.test(r.message)&&(t="CorruptZip"),new Fo(t,r)}function BT(r,t,e,n,i,o){let s=Et(t),a=W(n,s);if(!a.startsWith(n))return Promise.reject(new Error(g("invalid file","Error extracting {0}. Invalid file.",t)));let l=W(n,t),c;return o.onCancellationRequested(()=>{c?.destroy()}),Promise.resolve(Ox.mkdir(a,{recursive:!0})).then(()=>new Promise((d,u)=>{if(!o.isCancellationRequested)try{c=Ax(l,{mode:e}),c.once("close",()=>d()),c.once("error",u),r.once("error",u),r.pipe(c)}catch(f){u(f)}}))}function WT(r,t,e,n){let i=nt(()=>Promise.resolve()),o=0,s=n.onCancellationRequested(()=>{i.cancel(),r.close()});return new Promise((a,l)=>{let c=new zd,d=u=>{u.isCancellationRequested||(o++,r.readEntry())};r.once("error",l),r.once("close",()=>i.then(()=>{n.isCancellationRequested||r.entryCount===o?a():l(new Fo("Incomplete",new Error(g("incompleteExtract","Incomplete. Found {0} of {1} entries",o,r.entryCount))))},l)),r.readEntry(),r.on("entry",u=>{if(n.isCancellationRequested)return;if(!e.sourcePathRegex.test(u.fileName)){d(n);return}let f=u.fileName.replace(e.sourcePathRegex,"");if(/\/$/.test(f)){let y=W(t,f);i=nt(I=>Ox.mkdir(y,{recursive:!0}).then(()=>d(I)).then(void 0,l));return}let h=Bx(r,u),v=NT(u);i=nt(y=>c.queue(()=>h.then(I=>BT(I,f,v,t,e,y).then(()=>d(y)))).then(null,l))})}).finally(()=>s.dispose())}async function Nx(r,t=!1){let{open:e}=await import("yauzl");return new Promise((n,i)=>{e(r,t?{lazyEntries:!0}:void 0,(o,s)=>{o?i(Mx(o)):n(kn(s))})})}function Bx(r,t){return new Promise((e,n)=>{r.openReadStream(t,(i,o)=>{i?n(Mx(i)):e(kn(o))})})}async function Wx(r,t){let{ZipFile:e}=await import("yazl");return new Promise((n,i)=>{let o=new e;t.forEach(a=>{a.contents?o.addBuffer(typeof a.contents=="string"?Buffer.from(a.contents,"utf8"):a.contents,a.path):a.localPath&&o.addFile(a.localPath,a.path)}),o.end();let s=Ax(r);o.outputStream.pipe(s),o.outputStream.once("error",i),s.once("error",i),s.once("finish",()=>n(r))})}function Vx(r,t,e={},n){let i=new RegExp(e.sourcePath?`^${e.sourcePath}`:""),o=Nx(r,!0);return e.overwrite&&(o=o.then(s=>ce.rm(t).then(()=>s))),o.then(s=>WT(s,t,{sourcePathRegex:i},n))}function VT(r,t){return Nx(r).then(e=>new Promise((n,i)=>{e.on("entry",o=>{o.fileName===t&&Bx(e,o).then(s=>n(s),s=>i(s))}),e.once("close",()=>i(new Error(g("notFound","{0} not found inside zip.",t))))}))}function Mf(r,t){return VT(r,t).then(e=>new Promise((n,i)=>{let o=[];e.once("error",i),e.on("data",s=>o.push(s)),e.on("end",()=>n(Buffer.concat(o)))}))}var ga=class extends _{constructor(e,n,i,o,s,a){super();this.galleryService=e;this.telemetryService=n;this.uriIdentityService=i;this.logService=o;this.productService=s;this.userDataProfilesService=a;this._register(J(()=>{this.installingExtensions.forEach(({task:l})=>l.cancel()),this.uninstallingExtensions.forEach(l=>l.cancel()),this.installingExtensions.clear(),this.uninstallingExtensions.clear()}))}extensionsControlManifest;lastReportTimestamp=0;installingExtensions=new Map;uninstallingExtensions=new Map;_onInstallExtension=this._register(new P);get onInstallExtension(){return this._onInstallExtension.event}_onDidInstallExtensions=this._register(new P);get onDidInstallExtensions(){return this._onDidInstallExtensions.event}_onUninstallExtension=this._register(new P);get onUninstallExtension(){return this._onUninstallExtension.event}_onDidUninstallExtension=this._register(new P);get onDidUninstallExtension(){return this._onDidUninstallExtension.event}_onDidUpdateExtensionMetadata=this._register(new P);get onDidUpdateExtensionMetadata(){return this._onDidUpdateExtensionMetadata.event}participants=[];async canInstall(e){let n=await this.getTargetPlatform();return e.allTargetPlatforms.some(i=>Es(i,e.allTargetPlatforms,n))}async installFromGallery(e,n={}){try{let o=(await this.installGalleryExtensions([{extension:e,options:n}])).find(({identifier:s})=>Y(s,e.identifier));if(o?.local)return o?.local;throw o?.error?o.error:new Xe(`Unknown error while installing extension ${e.identifier.id}`,"Unknown")}catch(i){throw ft(i)}}async installGalleryExtensions(e){if(!this.galleryService.isEnabled())throw new Xe(g("MarketPlaceDisabled","Marketplace is not enabled"),"NotAllowed");let n=[],i=[];return await Promise.allSettled(e.map(async({extension:o,options:s})=>{try{let a=await this.checkAndGetCompatibleVersion(o,!!s?.installGivenVersion,!!s?.installPreReleaseVersion,s.productVersion??{version:this.productService.version,date:this.productService.date});i.push({...a,options:s})}catch(a){n.push({identifier:o.identifier,operation:2,source:o,error:a,profileLocation:s.profileLocation??this.getCurrentExtensionsManifestLocation()})}})),i.length&&n.push(...await this.installExtensions(i)),n}async uninstall(e,n){return this.logService.trace("ExtensionManagementService#uninstall",e.identifier.id),this.uninstallExtensions([{extension:e,options:n}])}async toggleAppliationScope(e,n){if(rc(e.manifest)||e.isBuiltin)return e;if(e.isApplicationScoped){let i=await this.updateMetadata(e,{isApplicationScoped:!1},this.userDataProfilesService.defaultProfile.extensionsResource);this.uriIdentityService.extUri.isEqual(n,this.userDataProfilesService.defaultProfile.extensionsResource)||(i=await this.copyExtension(e,this.userDataProfilesService.defaultProfile.extensionsResource,n));for(let o of this.userDataProfilesService.profiles){let s=(await this.getInstalled(1,o.extensionsResource)).find(a=>Y(a.identifier,e.identifier));s?this._onDidUpdateExtensionMetadata.fire({local:s,profileLocation:o.extensionsResource}):this._onDidUninstallExtension.fire({identifier:e.identifier,profileLocation:o.extensionsResource})}return i}else{let i=this.uriIdentityService.extUri.isEqual(n,this.userDataProfilesService.defaultProfile.extensionsResource)?await this.updateMetadata(e,{isApplicationScoped:!0},this.userDataProfilesService.defaultProfile.extensionsResource):await this.copyExtension(e,n,this.userDataProfilesService.defaultProfile.extensionsResource,{isApplicationScoped:!0});return this._onDidInstallExtensions.fire([{identifier:i.identifier,operation:2,local:i,profileLocation:this.userDataProfilesService.defaultProfile.extensionsResource,applicationScoped:!0}]),i}}getExtensionsControlManifest(){let e=new Date().getTime();return(!this.extensionsControlManifest||e-this.lastReportTimestamp>1e3*60*5)&&(this.extensionsControlManifest=this.updateControlCache(),this.lastReportTimestamp=e),this.extensionsControlManifest}registerParticipant(e){this.participants.push(e)}async resetPinnedStateForAllUserExtensions(e){try{await this.joinAllSettled(this.userDataProfilesService.profiles.map(async n=>{let i=await this.getInstalled(1,n.extensionsResource);await this.joinAllSettled(i.map(async o=>{o.pinned!==e&&await this.updateMetadata(o,{pinned:e},n.extensionsResource)}))}))}catch(n){throw this.logService.error("Error while resetting pinned state for all user extensions",me(n)),n}}async installExtensions(e){let n=new Map,i=new Map,o=[],s=(l,c)=>`${Lt.create(l).toString()}-${c.toString()}`,a=(l,c,d,u)=>{let f=this.createInstallExtensionTask(l,c,d),h=`${Hn(l.publisher,l.name)}-${d.profileLocation.toString()}`;i.set(h,{task:f,root:u}),this._onInstallExtension.fire({identifier:f.identifier,source:c,profileLocation:d.profileLocation}),this.logService.info("Installing extension:",f.identifier.id,d),C.isUri(c)||this.installingExtensions.set(s(c,d.profileLocation),{task:f,waitingTasks:[]})};try{for(let{manifest:l,extension:c,options:d}of e){let u=d.isApplicationScoped||d.isBuiltin||rc(l),f={...d,installOnlyNewlyAddedFromExtensionPack:d.installOnlyNewlyAddedFromExtensionPack??!C.isUri(c),isApplicationScoped:u,profileLocation:u?this.userDataProfilesService.defaultProfile.extensionsResource:d.profileLocation??this.getCurrentExtensionsManifestLocation(),productVersion:d.productVersion??{version:this.productService.version,date:this.productService.date}},h=C.isUri(c)?void 0:this.installingExtensions.get(s(c,f.profileLocation));h?(this.logService.info("Extension is already requested to install",h.task.identifier.id,f.profileLocation.toString()),o.push(h.task.waitUntilTaskIsFinished())):a(l,c,f,void 0)}return await Promise.all([...i.values()].map(async({task:l})=>{if(l.options.donotIncludePackAndDependencies)this.logService.info("Installing the extension without checking dependencies and pack",l.identifier.id);else try{let c=await this.getAllDepsAndPackExtensions(l.identifier,l.manifest,!!l.options.installOnlyNewlyAddedFromExtensionPack,!!l.options.installPreReleaseVersion,l.options.profileLocation,l.options.productVersion),d=await this.getInstalled(void 0,l.options.profileLocation,l.options.productVersion),u={...l.options,context:{...l.options.context,[GS]:!0}};for(let{gallery:f,manifest:h}of gt(c,({gallery:v})=>v.identifier.id)){if(i.has(`${f.identifier.id.toLowerCase()}-${u.profileLocation.toString()}`))continue;let v=this.installingExtensions.get(s(f,u.profileLocation));if(v){if(this.canWaitForTask(l,v.task)){let y=v.task.identifier;this.logService.info("Waiting for already requested installing extension",y.id,l.identifier.id,u.profileLocation.toString()),v.waitingTasks.push(l),o.push(O.toPromise(O.filter(this.onDidInstallExtensions,I=>I.some(x=>Y(x.identifier,y)))).then(I=>{if(this.logService.info("Finished waiting for already requested installing extension",y.id,l.identifier.id,u.profileLocation.toString()),!I.find(T=>Y(T.identifier,y))?.local)throw new Error(`Extension ${y.id} is not installed`)}))}}else d.some(({identifier:y})=>Y(y,f.identifier))||a(h,f,u,l)}}catch(c){if(C.isUri(l.source))Si(l.manifest.extensionDependencies)&&this.logService.warn("Cannot install dependencies of extension:",l.identifier.id,c.message),Si(l.manifest.extensionPack)&&this.logService.warn("Cannot install packed extensions of extension:",l.identifier.id,c.message);else throw this.logService.error("Error while preparing to install dependencies and extension packs of the extension:",l.identifier.id),c}})),await this.joinAllSettled([...i.entries()].map(async([l,{task:c}])=>{let d=new Date().getTime(),u;try{u=await c.run(),await this.joinAllSettled(this.participants.map(f=>f.postInstall(u,c.source,c.options,ee.None)),"PostInstall")}catch(f){let h=ft(f);throw C.isUri(c.source)||cy(this.telemetryService,c.operation===3?"extensionGallery:update":"extensionGallery:install",{extensionData:fc(c.source),error:h,source:c.options.context?.[ic]}),n.set(l,{error:h,identifier:c.identifier,operation:c.operation,source:c.source,context:c.options.context,profileLocation:c.options.profileLocation,applicationScoped:c.options.isApplicationScoped}),this.logService.error("Error while installing the extension",c.identifier.id,me(h),c.options.profileLocation.toString()),h}if(!C.isUri(c.source)){let f=c.operation===3,h=f?void 0:(new Date().getTime()-c.source.lastUpdated)/1e3;if(cy(this.telemetryService,f?"extensionGallery:update":"extensionGallery:install",{extensionData:fc(c.source),verificationStatus:c.verificationStatus,duration:new Date().getTime()-d,durationSinceUpdate:h,source:c.options.context?.[ic]}),qe&&c.operation!==3)try{await this.galleryService.reportStatistic(u.manifest.publisher,u.manifest.name,u.manifest.version,"install")}catch{}}n.set(l,{local:u,identifier:c.identifier,operation:c.operation,source:c.source,context:c.options.context,profileLocation:c.options.profileLocation,applicationScoped:u.isApplicationScoped})})),o.length&&await this.joinAllSettled(o),[...n.values()]}catch(l){let c=(f,h,v)=>{let y=[];f.manifest.extensionDependencies?.length&&y.push(...f.manifest.extensionDependencies),f.manifest.extensionPack?.length&&y.push(...f.manifest.extensionPack);for(let I of y){if(v.includes(I.toLowerCase()))continue;v.push(I.toLowerCase());let x=n.get(`${I.toLowerCase()}-${h.toString()}`);x?.local&&(v=c(x.local,h,v))}return v},d=f=>({identifier:f.identifier,operation:2,source:f.source,context:f.options.context,profileLocation:f.options.profileLocation,error:l}),u=[];for(let[f,{task:h,root:v}]of i){let y=n.get(f);y?y.local&&v&&!n.get(`${v.identifier.id.toLowerCase()}-${h.options.profileLocation.toString()}`)?.local&&(u.push(this.createUninstallExtensionTask(y.local,{versionOnly:!0,profileLocation:h.options.profileLocation})),n.set(f,d(h))):(h.cancel(),n.set(f,d(h)))}for(let[f,{task:h}]of i){let v=n.get(f);if(!v?.local||h.options.donotIncludePackAndDependencies)continue;c(v.local,h.options.profileLocation,[v.local.identifier.id.toLowerCase()]).slice(1).some(I=>i.has(`${I.toLowerCase()}-${h.options.profileLocation.toString()}`)&&!n.get(`${I.toLowerCase()}-${h.options.profileLocation.toString()}`)?.local)&&(u.push(this.createUninstallExtensionTask(v.local,{versionOnly:!0,profileLocation:h.options.profileLocation})),n.set(f,d(h)))}throw u.length&&await Promise.allSettled(u.map(async f=>{try{await f.run(),this.logService.info("Rollback: Uninstalled extension",f.extension.identifier.id)}catch(h){this.logService.warn("Rollback: Error while uninstalling extension",f.extension.identifier.id,me(h))}})),l}finally{for(let{task:l}of i.values())l.source&&!C.isUri(l.source)&&this.installingExtensions.delete(s(l.source,l.options.profileLocation));if(n.size){let l=[...n.values()];for(let c of l)c.local&&this.logService.info("Extension installed successfully:",c.identifier.id,c.profileLocation.toString());this._onDidInstallExtensions.fire(l)}}}canWaitForTask(e,n){for(let[,{task:i,waitingTasks:o}]of this.installingExtensions.entries())if(i===e&&(o.includes(n)||o.some(s=>this.canWaitForTask(s,n)))||i===n&&o[0]&&!this.canWaitForTask(e,o[0]))return!1;return!0}async joinAllSettled(e,n){let i=[],o=[],s=await Promise.allSettled(e);for(let l of s)l.status==="fulfilled"?i.push(l.value):o.push(ft(l.reason,n));if(!o.length)return i;if(o.length===1)throw o[0];let a=new Xe("","Unknown");for(let l of o)a=new Xe(a.message?`${a.message}, ${l.message}`:l.message,l.code!=="Unknown"&&l.code!=="Internal"?l.code:a.code);throw a}async getAllDepsAndPackExtensions(e,n,i,o,s,a){if(!this.galleryService.isEnabled())return[];let l=await this.getInstalled(void 0,s,a),c=[],d=[],u=async(f,h)=>{c.push(f);let v=h.extensionDependencies||[],y=[...v];if(h.extensionPack){let I=i?l.find(x=>Y(x.identifier,f)):void 0;for(let x of h.extensionPack)I&&I.manifest.extensionPack&&I.manifest.extensionPack.some(T=>Y({id:T},{id:x}))||y.every(T=>!Y({id:T},{id:x}))&&y.push(x)}if(y.length){let I=y.filter(x=>c.every(T=>!Y(T,{id:x})));if(I.length){let x=await this.galleryService.getExtensions(I.map(T=>({id:T,preRelease:o})),ee.None);for(let T of x){if(c.find(L=>Y(L,T.identifier)))continue;let R=v.some(L=>Y({id:L},T.identifier)),w;try{w=await this.checkAndGetCompatibleVersion(T,!1,o,a)}catch(L){if(R)throw L;this.logService.info("Skipping the packed extension as it cannot be installed",T.identifier.id,me(L));continue}d.push({gallery:w.extension,manifest:w.manifest}),await u(w.extension.identifier,w.manifest)}}}};return await u(e,n),d}async checkAndGetCompatibleVersion(e,n,i,o){let s,a=await this.getExtensionsControlManifest();if(a.malicious.some(d=>Y(e.identifier,d)))throw new Xe(g("malicious extension","Can't install '{0}' extension since it was reported to be problematic.",e.identifier.id),"Malicious");let l=a.deprecated[e.identifier.id.toLowerCase()];if(l?.extension?.autoMigrate){if(this.logService.info(`The '${e.identifier.id}' extension is deprecated, fetching the compatible '${l.extension.id}' extension instead.`),s=(await this.galleryService.getExtensions([{id:l.extension.id,preRelease:l.extension.preRelease}],{targetPlatform:await this.getTargetPlatform(),compatible:!0,productVersion:o},ee.None))[0],!s)throw new Xe(g("notFoundDeprecatedReplacementExtension","Can't install '{0}' extension since it was deprecated and the replacement extension '{1}' can't be found.",e.identifier.id,l.extension.id),"Deprecated")}else{if(!await this.canInstall(e)){let d=await this.getTargetPlatform();throw new Xe(g("incompatible platform","The '{0}' extension is not available in {1} for {2}.",e.identifier.id,this.productService.nameLong,JS(d)),"IncompatibleTargetPlatform")}if(s=await this.getCompatibleVersion(e,n,i,o),!s){let d=[];throw xc(e.properties.enabledApiProposals??[],d)?!i&&e.properties.isPreReleaseVersion&&(await this.galleryService.getExtensions([e.identifier],ee.None))[0]?new Xe(g("notFoundReleaseExtension","Can't install release version of '{0}' extension because it has no release version.",e.displayName??e.identifier.id),"ReleaseVersionNotFound"):new Xe(g("notFoundCompatibleDependency","Can't install '{0}' extension because it is not compatible with the current version of {1} (version {2}).",e.identifier.id,this.productService.nameLong,this.productService.version),"Incompatible"):new Xe(g("incompatibleAPI","Can't install '{0}' extension. {1}",e.displayName??e.identifier.id,d[0]),"IncompatibleApi")}}this.logService.info("Getting Manifest...",s.identifier.id);let c=await this.galleryService.getManifest(s,ee.None);if(c===null)throw new Xe(`Missing manifest for extension ${s.identifier.id}`,"Invalid");if(c.version!==s.version)throw new Xe(`Cannot install '${s.identifier.id}' extension because of version mismatch in Marketplace`,"Invalid");return{extension:s,manifest:c}}async getCompatibleVersion(e,n,i,o){let s=await this.getTargetPlatform(),a=null;return!n&&e.hasPreReleaseVersion&&e.properties.isPreReleaseVersion!==i&&(a=(await this.galleryService.getExtensions([{...e.identifier,preRelease:i}],{targetPlatform:s,compatible:!0,productVersion:o},ee.None))[0]||null),!a&&await this.galleryService.isExtensionCompatible(e,i,s,o)&&(a=e),a||(n?a=(await this.galleryService.getExtensions([{...e.identifier,version:e.version}],{targetPlatform:s,compatible:!0,productVersion:o},ee.None))[0]||null:a=await this.galleryService.getCompatibleExtension(e,i,s,o)),a}async uninstallExtensions(e){let n=(d,u)=>`${d.identifier.id.toLowerCase()}${u.versionOnly?`-${d.manifest.version}`:""}@${u.profileLocation.toString()}`,i=(d,u)=>{let f=this.createUninstallExtensionTask(d,u);return this.uninstallingExtensions.set(n(f.extension,u),f),this.logService.info("Uninstalling extension from the profile:",`${d.identifier.id}@${d.manifest.version}`,u.profileLocation.toString()),this._onUninstallExtension.fire({identifier:d.identifier,profileLocation:u.profileLocation,applicationScoped:d.isApplicationScoped}),f},o=(d,u,f)=>{f?this.logService.error("Failed to uninstall extension from the profile:",`${d.identifier.id}@${d.manifest.version}`,u.profileLocation.toString(),f.message):this.logService.info("Successfully uninstalled extension from the profile",`${d.identifier.id}@${d.manifest.version}`,u.profileLocation.toString()),cy(this.telemetryService,"extensionGallery:uninstall",{extensionData:_b(d),error:f}),this._onDidUninstallExtension.fire({identifier:d.identifier,error:f?.code,profileLocation:u.profileLocation,applicationScoped:d.isApplicationScoped})},s=[],a=[],l=[],c=new Ye;for(let{extension:d,options:u}of e){let f={...u,profileLocation:d.isApplicationScoped?this.userDataProfilesService.defaultProfile.extensionsResource:u?.profileLocation??this.getCurrentExtensionsManifestLocation()},h=this.uninstallingExtensions.get(n(d,f));h?(this.logService.info("Extensions is already requested to uninstall",d.identifier.id),l.push(h.waitUntilTaskIsFinished())):s.push(i(d,f))}try{for(let d of s.slice(0)){let u=c.get(d.options.profileLocation);if(u||c.set(d.options.profileLocation,u=await this.getInstalled(1,d.options.profileLocation)),d.options.donotIncludePack)this.logService.info("Uninstalling the extension without including packed extension",`${d.extension.identifier.id}@${d.extension.manifest.version}`);else{let f=this.getAllPackExtensionsToUninstall(d.extension,u);for(let h of f)this.uninstallingExtensions.has(n(h,d.options))?this.logService.info("Extensions is already requested to uninstall",h.identifier.id):s.push(i(h,d.options))}d.options.donotCheckDependents?this.logService.info("Uninstalling the extension without checking dependents",`${d.extension.identifier.id}@${d.extension.manifest.version}`):this.checkForDependents(s.map(f=>f.extension),u,d.extension)}await this.joinAllSettled(s.map(async d=>{try{if(await d.run(),await this.joinAllSettled(this.participants.map(u=>u.postUninstall(d.extension,d.options,ee.None))),d.extension.identifier.uuid)try{await this.galleryService.reportStatistic(d.extension.manifest.publisher,d.extension.manifest.name,d.extension.manifest.version,"uninstall")}catch{}}catch(u){let f=ft(u);throw o(d.extension,d.options,f),f}finally{a.push(d)}})),l.length&&await this.joinAllSettled(l);for(let d of s)o(d.extension,d.options)}catch(d){let u=ft(d);for(let f of s){try{f.cancel()}catch{}a.includes(f)||o(f.extension,f.options,u)}throw u}finally{for(let d of s)this.uninstallingExtensions.delete(n(d.extension,d.options))||this.logService.warn("Uninstallation task is not found in the cache",d.extension.identifier.id)}}checkForDependents(e,n,i){for(let o of e){let s=this.getDependents(o,n);if(s.length){let a=s.filter(l=>!e.some(c=>Y(c.identifier,l.identifier)));if(a.length)throw new Error(this.getDependentsErrorMessage(o,a,i))}}}getDependentsErrorMessage(e,n,i){return i===e?n.length===1?g("singleDependentError","Cannot uninstall '{0}' extension. '{1}' extension depends on this.",i.manifest.displayName||i.manifest.name,n[0].manifest.displayName||n[0].manifest.name):n.length===2?g("twoDependentsError","Cannot uninstall '{0}' extension. '{1}' and '{2}' extensions depend on this.",i.manifest.displayName||i.manifest.name,n[0].manifest.displayName||n[0].manifest.name,n[1].manifest.displayName||n[1].manifest.name):g("multipleDependentsError","Cannot uninstall '{0}' extension. '{1}', '{2}' and other extension depend on this.",i.manifest.displayName||i.manifest.name,n[0].manifest.displayName||n[0].manifest.name,n[1].manifest.displayName||n[1].manifest.name):n.length===1?g("singleIndirectDependentError","Cannot uninstall '{0}' extension . It includes uninstalling '{1}' extension and '{2}' extension depends on this.",i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,n[0].manifest.displayName||n[0].manifest.name):n.length===2?g("twoIndirectDependentsError","Cannot uninstall '{0}' extension. It includes uninstalling '{1}' extension and '{2}' and '{3}' extensions depend on this.",i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,n[0].manifest.displayName||n[0].manifest.name,n[1].manifest.displayName||n[1].manifest.name):g("multipleIndirectDependentsError","Cannot uninstall '{0}' extension. It includes uninstalling '{1}' extension and '{2}', '{3}' and other extensions depend on this.",i.manifest.displayName||i.manifest.name,e.manifest.displayName||e.manifest.name,n[0].manifest.displayName||n[0].manifest.name,n[1].manifest.displayName||n[1].manifest.name)}getAllPackExtensionsToUninstall(e,n,i=[]){if(i.indexOf(e)!==-1)return[];i.push(e);let o=e.manifest.extensionPack?e.manifest.extensionPack:[];if(o.length){let s=n.filter(l=>!l.isBuiltin&&o.some(c=>Y({id:c},l.identifier))),a=[];for(let l of s)a.push(...this.getAllPackExtensionsToUninstall(l,n,i));return[...s,...a]}return[]}getDependents(e,n){return n.filter(i=>i.manifest.extensionDependencies&&i.manifest.extensionDependencies.some(o=>Y({id:o},e.identifier)))}async updateControlCache(){try{return this.logService.trace("ExtensionManagementService.updateControlCache"),await this.galleryService.getExtensionsControlManifest()}catch(e){return this.logService.trace("ExtensionManagementService.refreshControlCache - failed to get extension control manifest",me(e)),{malicious:[],deprecated:{},search:[]}}}};ga=E([m(0,Bt),m(1,le),m(2,he),m(3,z),m(4,de),m(5,ge)],ga);function ft(r,t){if(r instanceof Xe)return r;let e;return r instanceof ki?e=new Xe(r.message,r.code==="DownloadFailedWriting"?"DownloadFailedWriting":"Gallery"):e=new Xe(r.message,Rn(r)?"Cancelled":t??"Internal"),e.stack=r.stack,e}function cy(r,t,{extensionData:e,verificationStatus:n,duration:i,error:o,source:s,durationSinceUpdate:a}){let l,c;TI(n)&&(n===!0?n="Verified":(n===!1||(l="Signature",c=n),n="Unverified")),o&&(l=o.code,o.code==="Signature"&&(c=o.message)),r.publicLog(t,{...e,verificationStatus:n,success:!o,duration:i,errorcode:l,errorcodeDetail:c,durationSinceUpdate:a,source:s})}var Tc=class{barrier=new Ei;cancellablePromise;async waitUntilTaskIsFinished(){return await this.barrier.wait(),this.cancellablePromise}run(){return this.cancellablePromise||(this.cancellablePromise=nt(t=>this.doRun(t))),this.barrier.open(),this.cancellablePromise}cancel(){this.cancellablePromise||(this.cancellablePromise=nt(t=>new Promise((e,n)=>{let i=t.onCancellationRequested(()=>{i.dispose(),n(new Ge)})})),this.barrier.open()),this.cancellablePromise.cancel()}};var Ao=class extends Error{constructor(e,n){super(e);this.code=n}},Jn=M("IExtensionsProfileScannerService"),ya=class extends _{constructor(e,n,i,o,s,a){super();this.extensionsLocation=e;this.fileService=n;this.userDataProfilesService=i;this.uriIdentityService=o;this.telemetryService=s;this.logService=a}_serviceBrand;_onAddExtensions=this._register(new P);onAddExtensions=this._onAddExtensions.event;_onDidAddExtensions=this._register(new P);onDidAddExtensions=this._onDidAddExtensions.event;_onRemoveExtensions=this._register(new P);onRemoveExtensions=this._onRemoveExtensions.event;_onDidRemoveExtensions=this._register(new P);onDidRemoveExtensions=this._onDidRemoveExtensions.event;resourcesAccessQueueMap=new Ye;scanProfileExtensions(e,n){return this.withProfileExtensions(e,void 0,n)}async addExtensionsToProfile(e,n,i){let o=[],s=[];try{return await this.withProfileExtensions(n,a=>{let l=[];if(i)l.push(...a);else for(let c of a)e.some(([d])=>Y(d.identifier,c.identifier)&&d.manifest.version!==c.version)?o.push(c):l.push(c);for(let[c,d]of e){let u=l.findIndex(h=>Y(h.identifier,c.identifier)&&h.version===c.manifest.version),f={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:d};u===-1?(s.push(f),l.push(f)):l.splice(u,1,f)}return s.length&&this._onAddExtensions.fire({extensions:s,profileLocation:n}),o.length&&this._onRemoveExtensions.fire({extensions:o,profileLocation:n}),l}),s.length&&this._onDidAddExtensions.fire({extensions:s,profileLocation:n}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,profileLocation:n}),s}catch(a){throw s.length&&this._onDidAddExtensions.fire({extensions:s,error:a,profileLocation:n}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,error:a,profileLocation:n}),a}}async updateMetadata(e,n){let i=[];return await this.withProfileExtensions(n,o=>{let s=[];for(let a of o){let l=e.find(([c])=>Y(c.identifier,a.identifier)&&c.manifest.version===a.version);l&&(a.metadata={...a.metadata,...l[1]},i.push(a)),s.push(a)}return s}),i}async removeExtensionFromProfile(e,n){let i=[];try{await this.withProfileExtensions(n,o=>{let s=[];for(let a of o)Y(a.identifier,e.identifier)?i.push(a):s.push(a);return i.length&&this._onRemoveExtensions.fire({extensions:i,profileLocation:n}),s}),i.length&&this._onDidRemoveExtensions.fire({extensions:i,profileLocation:n})}catch(o){throw i.length&&this._onDidRemoveExtensions.fire({extensions:i,error:o,profileLocation:n}),o}}async withProfileExtensions(e,n,i){return this.getResourceAccessQueue(e).queue(async()=>{let o=[],s;try{let a=await this.fileService.readFile(e);s=JSON.parse(a.value.toString().trim()||"[]")}catch(a){if(rt(a)!==1)throw a;if(this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)&&(s=await this.migrateFromOldDefaultProfileExtensionsLocation()),!s&&i?.bailOutWhenFileNotFound)throw new Ao(me(a),"ERROR_PROFILE_NOT_FOUND")}if(s){Array.isArray(s)||this.reportAndThrowInvalidConentError(e);let a=!1;for(let l of s){Kx(l)||this.reportAndThrowInvalidConentError(e);let c;if(De(l.relativeLocation)&&l.relativeLocation)c=this.resolveExtensionLocation(l.relativeLocation);else if(De(l.location)){this.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${l.location}`);continue}else{c=C.revive(l.location);let d=this.toRelativePath(c);d&&(a=!0,l.relativeLocation=d)}kt(l.metadata?.hasPreReleaseVersion)&&l.metadata?.preRelease&&(a=!0,l.metadata.hasPreReleaseVersion=!0),o.push({identifier:l.identifier,location:c,version:l.version,metadata:l.metadata})}a&&await this.fileService.writeFile(e,A.fromString(JSON.stringify(s)))}if(n){o=n(o);let a=o.map(l=>({identifier:l.identifier,version:l.version,location:l.location.toJSON(),relativeLocation:this.toRelativePath(l.location),metadata:l.metadata}));await this.fileService.writeFile(e,A.fromString(JSON.stringify(a)))}return o})}reportAndThrowInvalidConentError(e){let n=new Ao(`Invalid extensions content in ${e.toString()}`,"ERROR_INVALID_CONTENT");throw this.telemetryService.publicLogError2("extensionsProfileScanningError",{code:n.code}),n}toRelativePath(e){return this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(e),this.extensionsLocation)?this.uriIdentityService.extUri.basename(e):void 0}resolveExtensionLocation(e){return this.uriIdentityService.extUri.joinPath(this.extensionsLocation,e)}_migrationPromise;async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{let e=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"),n=this.uriIdentityService.extUri.joinPath(this.extensionsLocation,".init-default-profile-extensions"),i;try{i=(await this.fileService.readFile(e)).value.toString()}catch(s){if(rt(s)===1)return;throw s}this.logService.info("Migrating extensions from old default profile location",e.toString());let o;try{let s=JSON.parse(i);Array.isArray(s)&&s.every(a=>Kx(a))?o=s:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",s)}catch(s){this.logService.error(s)}if(o)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,A.fromString(JSON.stringify(o)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(s){if(rt(s)===3)this.logService.info("Migration from old default profile location to new location is done by another window",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw s}try{await this.fileService.del(e)}catch(s){rt(s)!==1&&this.logService.error(s)}try{await this.fileService.del(n)}catch(s){rt(s)!==1&&this.logService.error(s)}return o})()),this._migrationPromise}getResourceAccessQueue(e){let n=this.resourcesAccessQueueMap.get(e);return n||(n=new fr,this.resourcesAccessQueueMap.set(e,n)),n}};ya=E([m(1,G),m(2,ge),m(3,he),m(4,le),m(5,z)],ya);function Kx(r){return He(r)&&YS(r.identifier)&&(KT(r.location)||De(r.location)&&r.location)&&(kt(r.relativeLocation)||De(r.relativeLocation))&&r.version&&De(r.version)}function KT(r){return r?De(r.path)&&De(r.scheme):!1}function Bf(r){switch(r){case 1:return g("error.invalidSymbol","Invalid symbol");case 2:return g("error.invalidNumberFormat","Invalid number format");case 3:return g("error.propertyNameExpected","Property name expected");case 4:return g("error.valueExpected","Value expected");case 5:return g("error.colonExpected","Colon expected");case 6:return g("error.commaExpected","Comma expected");case 7:return g("error.closeBraceExpected","Closing brace expected");case 8:return g("error.closeBracketExpected","Closing bracket expected");case 9:return g("error.endOfFileExpected","End of file expected");default:return""}}function $x(r,t,e,n){try{$T(r,t,e,n)}catch(i){r.error(i?.message??i)}return t}function $T(r,t,e,n){let i=(o,s,a)=>{let l=o[s];if(De(l)){let c=l,d=c.length;if(d>1&&c[0]==="%"&&c[d-1]==="%"){let u=c.substr(1,d-2),f=e[u];f===void 0&&n&&(f=n[u]);let h=typeof f=="string"?f:f?.message,v=n?.[u],y=typeof v=="string"?v:v?.message;if(!h){y||r.warn(`[${t.name}]: ${g("missingNLSKey","Couldn't find message for key {0}.",u)}`);return}if(a&&(s==="title"||s==="category")&&y&&y!==h){let I={value:h,original:y};o[s]=I}else o[s]=h}}else if(He(l))for(let c in l)l.hasOwnProperty(c)&&(c==="commands"?i(l,c,!0):i(l,c,a));else if(Array.isArray(l))for(let c=0;c<l.length;c++)i(l,c,a)};for(let o in t)t.hasOwnProperty(o)&&i(t,o)}var zx;(t=>{function r(e,n){if(e===n)return!0;let i=Object.keys(e),o=new Set;for(let s of Object.keys(n))o.add(s);if(i.length!==o.size)return!1;for(let s of i){if(e[s]!==n[s])return!1;o.delete(s)}return o.size===0}t.equals=r})(zx||={});var Sa=M("IExtensionsScannerService"),Rc=class extends _{constructor(e,n,i,o,s,a,l,c,d,u,f,h){super();this.systemExtensionsLocation=e;this.userExtensionsLocation=n;this.extensionsControlLocation=i;this.currentProfile=o;this.userDataProfilesService=s;this.extensionsProfileScannerService=a;this.fileService=l;this.logService=c;this.environmentService=d;this.productService=u;this.uriIdentityService=f;this.instantiationService=h;this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(0))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(1)))}_serviceBrand;_onDidChangeCache=this._register(new P);onDidChangeCache=this._onDidChangeCache.event;obsoleteFile=V(this.userExtensionsLocation,".obsolete");systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Ia,this.currentProfile,this.obsoleteFile));userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Ia,this.currentProfile,this.obsoleteFile));extensionsScanner=this._register(this.instantiationService.createInstance(va,this.obsoleteFile));_targetPlatformPromise;getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=zu(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(e,n,i){let[o,s]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(n)]),a=i?await this.scanExtensionsUnderDevelopment(e,[...o,...s]):[];return this.dedupExtensions(o,s,a,await this.getTargetPlatform(),!0)}async scanSystemExtensions(e){let n=[];n.push(this.scanDefaultSystemExtensions(!!e.useCache,e.language)),n.push(this.scanDevSystemExtensions(e.language,!!e.checkControlFile));let[i,o]=await Promise.all(n);return this.applyScanOptions([...i,...o],0,e,!1)}async scanUserExtensions(e){let n=e.profileLocation??this.userExtensionsLocation;this.logService.trace("Started scanning user extensions",n);let i=this.uriIdentityService.extUri.isEqual(e.profileLocation,this.userDataProfilesService.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,o=await this.createExtensionScannerInput(n,!!e.profileLocation,1,!e.includeUninstalled,e.language,!0,i,e.productVersion??this.getProductVersion()),s=e.useCache&&!o.devMode&&o.excludeObsolete?this.userExtensionsCachedScanner:this.extensionsScanner,a;try{a=await s.scanExtensions(o)}catch(l){if(l instanceof Ao&&l.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions(),a=await s.scanExtensions(o);else throw l}return a=await this.applyScanOptions(a,1,e,!0),this.logService.trace("Scanned user extensions:",a.length),a}async scanExtensionsUnderDevelopment(e,n){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){let i=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(o=>o.scheme===ne.file).map(async o=>{let s=await this.createExtensionScannerInput(o,!1,1,!0,e.language,!1,void 0,e.productVersion??this.getProductVersion());return(await this.extensionsScanner.scanOneOrMultipleExtensions(s)).map(l=>(l.type=n.find(c=>Y(c.identifier,l.identifier))?.type??l.type,this.extensionsScanner.validate(l,s)))}))).flat();return this.applyScanOptions(i,"development",e,!0)}return[]}async scanExistingExtension(e,n,i){let o=await this.createExtensionScannerInput(e,!1,n,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanExtension(o);return!s||!i.includeInvalid&&!s.isValid?null:s}async scanOneOrMultipleExtensions(e,n,i){let o=await this.createExtensionScannerInput(e,!1,n,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanOneOrMultipleExtensions(o);return this.applyScanOptions(s,n,i,!0)}async scanMultipleExtensions(e,n,i){let o=[];return await Promise.all(e.map(async s=>{let a=await this.scanOneOrMultipleExtensions(s,n,i);o.push(...a)})),this.applyScanOptions(o,n,i,!0)}async scanMetadata(e){let n=V(e,"package.json"),i=(await this.fileService.readFile(n)).value.toString();return JSON.parse(i).__metadata}async updateMetadata(e,n){let i=V(e,"package.json"),o=(await this.fileService.readFile(i)).value.toString(),s=JSON.parse(o);n.isMachineScoped===!1&&delete n.isMachineScoped,n.isBuiltin===!1&&delete n.isBuiltin,s.__metadata={...s.__metadata,...n},await this.fileService.writeFile(V(e,"package.json"),A.fromString(JSON.stringify(s,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof Ao&&e.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions();else throw e}}initializeDefaultProfileExtensionsPromise=void 0;async doInitializeDefaultProfileExtensions(){return this.initializeDefaultProfileExtensionsPromise||(this.initializeDefaultProfileExtensionsPromise=(async()=>{try{this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());let e=await this.scanUserExtensions({includeInvalid:!0});if(e.length)await this.extensionsProfileScannerService.addExtensionsToProfile(e.map(n=>[n,n.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource);else try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,A.fromString(JSON.stringify([])))}catch(n){rt(n)!==1&&this.logService.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),me(n))}this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.logService.error(e)}finally{this.initializeDefaultProfileExtensionsPromise=void 0}})()),this.initializeDefaultProfileExtensionsPromise}async applyScanOptions(e,n,i,o){return i.includeAllVersions||(e=this.dedupExtensions(n===0?e:void 0,n===1?e:void 0,n==="development"?e:void 0,await this.getTargetPlatform(),o)),i.includeInvalid||(e=e.filter(s=>s.isValid)),e.sort((s,a)=>{let l=at(s.location.fsPath),c=at(a.location.fsPath);return l<c?-1:l>c?1:0})}dedupExtensions(e,n,i,o,s){let a=(c,d,u)=>{if(c.isValid&&!d.isValid)return!1;if(c.isValid===d.isValid){if(s&&la(c.manifest.version,d.manifest.version))return this.logService.debug(`Skipping extension ${d.location.path} with lower version ${d.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(Ix(c.manifest.version,d.manifest.version)){if(c.type===0)return this.logService.debug(`Skipping extension ${d.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===o)return this.logService.debug(`Skipping extension ${d.location.path} from different target platform ${d.targetPlatform}`),!1}}return u?this.logService.warn(`Overwriting user extension ${c.location.path} with ${d.location.path}.`):this.logService.debug(`Overwriting user extension ${c.location.path} with ${d.location.path}.`),!0},l=new Su;return e?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),n?.forEach(c=>{let d=l.get(c.identifier.id);if(!d&&e&&c.type===0){this.logService.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),i?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!0))&&l.set(c.identifier.id,c),l.set(c.identifier.id,c)}),[...l.values()]}async scanDefaultSystemExtensions(e,n){this.logService.trace("Started scanning system extensions");let i=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,0,!0,n,!0,void 0,this.getProductVersion()),s=await(e&&!i.devMode?this.systemExtensionsCachedScanner:this.extensionsScanner).scanExtensions(i);return this.logService.trace("Scanned system extensions:",s.length),s}async scanDevSystemExtensions(e,n){let i=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!i?.length)return[];this.logService.trace("Started scanning dev system extensions");let o=n?await this.getBuiltInExtensionControl():{},s=[],a=C.file(Dn(W(Sn.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(let c of i){let d=o[c.name]||"marketplace";switch(d){case"disabled":break;case"marketplace":s.push(V(a,c.name));break;default:s.push(C.file(d));break}}let l=await Promise.all(s.map(async c=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(c,!1,0,!0,e,!0,void 0,this.getProductVersion()))));return this.logService.trace("Scanned dev system extensions:",l.length),qn(l)}async getBuiltInExtensionControl(){try{let e=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(e.value.toString())}catch{return{}}}async createExtensionScannerInput(e,n,i,o,s,a,l,c){let d=await this.getTranslations(s??zn),u=await this.getMtime(e),f=n&&!this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,h=f?await this.getMtime(f):void 0;return new Oo(e,u,f,h,n,l,i,o,a,c.version,c.date,this.productService.commit,!this.environmentService.isBuilt,s,d)}async getMtime(e){try{let n=await this.fileService.stat(e);if(typeof n.mtime=="number")return n.mtime}catch{}}getProductVersion(){return{version:this.productService.version,date:this.productService.date}}};Rc=E([m(4,ge),m(5,Jn),m(6,G),m(7,z),m(8,oe),m(9,de),m(10,he),m(11,Ot)],Rc);var Oo=class{constructor(t,e,n,i,o,s,a,l,c,d,u,f,h,v,y){this.location=t;this.mtime=e;this.applicationExtensionslocation=n;this.applicationExtensionslocationMtime=i;this.profile=o;this.profileScanOptions=s;this.type=a;this.excludeObsolete=l;this.validate=c;this.productVersion=d;this.productDate=u;this.productCommit=f;this.devMode=h;this.language=v;this.translations=y}static createNlsConfiguration(t){return{language:t.language,pseudo:t.language==="pseudo",devMode:t.devMode,translations:t.translations}}static equals(t,e){return Ln(t.location,e.location)&&t.mtime===e.mtime&&Ln(t.applicationExtensionslocation,e.applicationExtensionslocation)&&t.applicationExtensionslocationMtime===e.applicationExtensionslocationMtime&&t.profile===e.profile&&dt(t.profileScanOptions,e.profileScanOptions)&&t.type===e.type&&t.excludeObsolete===e.excludeObsolete&&t.validate===e.validate&&t.productVersion===e.productVersion&&t.productDate===e.productDate&&t.productCommit===e.productCommit&&t.devMode===e.devMode&&t.language===e.language&&zx.equals(t.translations,e.translations)}},va=class extends _{constructor(e,n,i,o,s,a,l){super();this.obsoleteFile=e;this.extensionsProfileScannerService=n;this.uriIdentityService=i;this.fileService=o;this.environmentService=a;this.logService=l;this.extensionsEnabledWithApiProposalVersion=s.extensionsEnabledWithApiProposalVersion?.map(c=>c.toLowerCase())??[]}extensionsEnabledWithApiProposalVersion;async scanExtensions(e){let n=e.profile?await this.scanExtensionsFromProfile(e):await this.scanExtensionsFromLocation(e),i={};if(e.excludeObsolete&&e.type===1)try{let o=(await this.fileService.readFile(this.obsoleteFile)).value.toString();i=JSON.parse(o)}catch{}return as(i)?n:n.filter(o=>!i[Lt.create(o).toString()])}async scanExtensionsFromLocation(e){let n=await this.fileService.resolve(e.location);if(!n.children?.length)return[];let i=await Promise.all(n.children.map(async o=>{if(!o.isDirectory||e.type===1&&_r(o.resource).indexOf(".")===0)return null;let s=new Oo(o.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.excludeObsolete,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(s)}));return qn(i).sort((o,s)=>o.location.path<s.location.path?-1:1)}async scanExtensionsFromProfile(e){let n=await this.scanExtensionsFromProfileResource(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(e.location,e.applicationExtensionslocation)){n=n.filter(o=>!o.metadata?.isApplicationScoped);let i=await this.scanExtensionsFromProfileResource(e.applicationExtensionslocation,o=>!!o.metadata?.isBuiltin||!!o.metadata?.isApplicationScoped,e);n.push(...i)}return n}async scanExtensionsFromProfileResource(e,n,i){let o=await this.extensionsProfileScannerService.scanProfileExtensions(e,i.profileScanOptions);if(!o.length)return[];let s=await Promise.all(o.map(async a=>{if(n(a)){let l=new Oo(a.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.excludeObsolete,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(l,a.metadata)}return null}));return qn(s)}async scanOneOrMultipleExtensions(e){try{if(await this.fileService.exists(V(e.location,"package.json"))){let n=await this.scanExtension(e);return n?[n]:[]}else return await this.scanExtensions(e)}catch(n){return this.logService.error(`Error scanning extensions at ${e.location.path}:`,me(n)),[]}}async scanExtension(e,n){try{let i=await this.scanExtensionManifest(e.location);if(i){i.publisher||(i.publisher=xu),n=n??i.__metadata,delete i.__metadata;let o=Hn(i.publisher,i.name),s=n?.id?{id:o,uuid:n.id}:{id:o},a=n?.isSystem?0:e.type,l=a===0||!!n?.isBuiltin;i=await this.translateManifest(e.location,i,Oo.createNlsConfiguration(e));let c={type:a,identifier:s,manifest:i,location:e.location,isBuiltin:l,targetPlatform:n?.targetPlatform??"undefined",publisherDisplayName:n?.publisherDisplayName,metadata:n,isValid:!0,validations:[]};return e.validate&&(c=this.validate(c,e)),i.enabledApiProposals&&(!this.environmentService.isBuilt||this.extensionsEnabledWithApiProposalVersion.includes(o.toLowerCase()))&&(i.originalEnabledApiProposals=i.enabledApiProposals,i.enabledApiProposals=qS([...i.enabledApiProposals])),c}}catch(i){e.type!==0&&this.logService.error(i)}return null}validate(e,n){let i=!0,o=this.environmentService.isBuilt&&this.extensionsEnabledWithApiProposalVersion.includes(e.identifier.id.toLowerCase()),s=Ex(n.productVersion,n.productDate,n.location,e.manifest,e.isBuiltin,o);for(let[a,l]of s)a===Mt.Error&&(i=!1,this.logService.error(this.formatMessage(n.location,l)));return e.isValid=i,e.validations=s,e}async scanExtensionManifest(e){let n=V(e,"package.json"),i;try{i=(await this.fileService.readFile(n)).value.toString()}catch(s){return rt(s)!==1&&this.logService.error(this.formatMessage(e,g("fileReadFail","Cannot read file {0}: {1}.",n.path,s.message))),null}let o;try{o=JSON.parse(i)}catch{let a=[];Ze(i,a);for(let l of a)this.logService.error(this.formatMessage(e,g("jsonParseFail","Failed to parse {0}: [{1}, {2}] {3}.",n.path,l.offset,l.length,Bf(l.error))));return null}return Wi(o)!=="object"?(this.logService.error(this.formatMessage(e,g("jsonParseInvalidType","Invalid manifest file {0}: Not a JSON object.",n.path))),null):o}async translateManifest(e,n,i){let o=await this.getLocalizedMessages(e,n,i);if(o)try{let s=[],a=await this.resolveOriginalMessageBundle(o.default,s);if(s.length>0)return s.forEach(c=>{this.logService.error(this.formatMessage(e,g("jsonsParseReportErrors","Failed to parse {0}: {1}.",o.default?.path,Bf(c.error))))}),n;if(Wi(o)!=="object")return this.logService.error(this.formatMessage(e,g("jsonInvalidFormat","Invalid format {0}: JSON object expected.",o.default?.path))),n;let l=o.values||Object.create(null);return $x(this.logService,n,l,a)}catch{}return n}async getLocalizedMessages(e,n,i){let o=V(e,"package.nls.json"),s=(d,u)=>{u.forEach(f=>{this.logService.error(this.formatMessage(e,g("jsonsParseReportErrors","Failed to parse {0}: {1}.",d?.path,Bf(f.error))))})},a=d=>{this.logService.error(this.formatMessage(e,g("jsonInvalidFormat","Invalid format {0}: JSON object expected.",d?.path)))},l=`${n.publisher}.${n.name}`,c=i.translations[l];if(c)try{let d=C.file(c),u=(await this.fileService.readFile(d)).value.toString(),f=[],h=Ze(u,f);return f.length>0?(s(d,f),{values:void 0,default:o}):Wi(h)!=="object"?(a(d),{values:void 0,default:o}):{values:h.contents?h.contents.package:void 0,default:o}}catch{return{values:void 0,default:o}}else{if(!await this.fileService.exists(o))return;let u;try{u=await this.findMessageBundles(e,i)}catch{return}if(!u.localized)return{values:void 0,default:u.original};try{let f=(await this.fileService.readFile(u.localized)).value.toString(),h=[],v=Ze(f,h);return h.length>0?(s(u.localized,h),{values:void 0,default:u.original}):Wi(v)!=="object"?(a(u.localized),{values:void 0,default:u.original}):{values:v,default:u.original}}catch{return{values:void 0,default:u.original}}}}async resolveOriginalMessageBundle(e,n){if(e)try{let i=(await this.fileService.readFile(e)).value.toString();return Ze(i,n)}catch{}}findMessageBundles(e,n){return new Promise((i,o)=>{let s=a=>{let l=V(e,`package.nls.${a}.json`);this.fileService.exists(l).then(c=>{c&&i({localized:l,original:V(e,"package.nls.json")});let d=a.lastIndexOf("-");d===-1?i({localized:V(e,"package.nls.json"),original:null}):(a=a.substring(0,d),s(a))})};if(n.devMode||n.pseudo||!n.language)return i({localized:V(e,"package.nls.json"),original:null});s(n.language)})}formatMessage(e,n){return`[${e.path}]: ${n}`}};va=E([m(1,Jn),m(2,he),m(3,G),m(4,de),m(5,oe),m(6,z)],va);var Ia=class extends va{constructor(e,n,i,o,s,a,l,c,d){super(n,o,s,a,l,c,d);this.currentProfile=e;this.userDataProfilesService=i}input;cacheValidatorThrottler=this._register(new hn(3e3));_onDidChangeCache=this._register(new P);onDidChangeCache=this._onDidChangeCache.event;async scanExtensions(e){let n=this.getCacheFile(e),i=await this.readExtensionCache(n);if(this.input=e,i&&i.input&&Oo.equals(i.input,this.input))return this.logService.debug("Using cached extensions scan result",e.type===0?"system":"user",e.location.toString()),this.cacheValidatorThrottler.trigger(()=>this.validateCache()),i.result.map(s=>(s.location=C.revive(s.location),s));let o=await super.scanExtensions(e);return await this.writeExtensionCache(n,{input:e,result:o}),o}async readExtensionCache(e){try{let n=await this.fileService.readFile(e),i=JSON.parse(n.value.toString());return{result:i.result,input:Ti(i.input)}}catch(n){this.logService.debug("Error while reading the extension cache file:",e.path,me(n))}return null}async writeExtensionCache(e,n){try{await this.fileService.writeFile(e,A.fromString(JSON.stringify(n)))}catch(i){this.logService.debug("Error while writing the extension cache file:",e.path,me(i))}}async validateCache(){if(!this.input)return;let e=this.getCacheFile(this.input),n=await this.readExtensionCache(e);if(!n)return;let i=n.result,o=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!dt(o,i))try{this.logService.info("Invalidating Cache",i,o),await this.fileService.del(e),this._onDidChangeCache.fire()}catch(s){this.logService.error(s)}}getCacheFile(e){let n=this.getProfile(e);return this.uriIdentityService.extUri.joinPath(n.cacheHome,e.type===0?$S:bu)}getProfile(e){return e.type===0?this.userDataProfilesService.defaultProfile:e.profile?this.uriIdentityService.extUri.isEqual(e.location,this.currentProfile.extensionsResource)?this.currentProfile:this.userDataProfilesService.profiles.find(n=>this.uriIdentityService.extUri.isEqual(e.location,n.extensionsResource))??this.currentProfile:this.userDataProfilesService.defaultProfile}};Ia=E([m(2,ge),m(3,Jn),m(4,he),m(5,G),m(6,de),m(7,oe),m(8,z)],Ia);var Wf=class extends Rc{translationsPromise;constructor(t,e,n,i,o,s,a,l,c,d,u,f){super(t,e,V(n,".vscode-oss-dev","extensions","control.json"),i,o,s,a,l,c,d,u,f),this.translationsPromise=(async()=>{if(Nh)try{let h=await this.fileService.readFile(C.file(Nh));return JSON.parse(h.value.toString())}catch{}return Object.create(null)})()}getTranslations(t){return this.translationsPromise}};function Cc(r){let t="Extract";return r instanceof Fo&&(r.type==="CorruptZip"?t="CorruptZip":r.type==="Incomplete"&&(t="IncompleteZip")),ft(r,t)}async function Vf(r){let t;try{t=await Mf(r,"extension/package.json")}catch(e){throw Cc(e)}try{return JSON.parse(t.toString("utf8"))}catch{throw new Xe(g("invalidManifest","VSIX invalid: package.json is not a JSON file."),"Invalid")}}var zi=class extends _{constructor(e,n,i,o,s,a,l){super();this.fileService=n;this.extensionGalleryService=i;this.configurationService=o;this.extensionSignatureVerificationService=s;this.telemetryService=a;this.logService=l;this.extensionsDownloadDir=e.extensionsDownloadLocation,this.cache=20,this.cleanUpPromise=this.cleanUp()}static SignatureArchiveExtension=".sigzip";extensionsDownloadDir;cache;cleanUpPromise;async download(e,n,i,o){await this.cleanUpPromise;let s=await this.downloadVSIX(e,n),a=!1;if(i&&this.shouldVerifySignature(e)){let l;try{l=await this.downloadSignatureArchive(e)}catch(c){try{await this.delete(s)}catch(d){this.logService.error(d)}throw c}try{a=await this.extensionSignatureVerificationService.verify(e,s.fsPath,l.fsPath,o)}catch(c){if(a=c.code,a==="PackageIsInvalidZip"||a==="SignatureArchiveIsInvalidZip"){try{await this.delete(s)}catch(d){this.logService.error(d)}throw new Xe(ly,"CorruptZip")}}finally{try{await this.delete(l)}catch(c){this.logService.error(c)}}}return{location:s,verificationStatus:a}}shouldVerifySignature(e){if(!e.isSigned)return this.logService.info(`Extension is not signed: ${e.identifier.id}`),!1;let n=this.configurationService.getValue("extensions.verifySignature");return pn(n)?n:!0}async downloadVSIX(e,n){try{let i=V(this.extensionsDownloadDir,this.getName(e)),o=await this.doDownload(e,"vsix",async()=>{await this.downloadFile(e,i,s=>this.extensionGalleryService.download(e,s,n));try{await this.validate(i.fsPath,"extension/package.json")}catch(s){try{await this.fileService.del(i)}catch(a){this.logService.warn(`Error while deleting: ${i.path}`,me(a))}throw s}},2);return o>1&&this.telemetryService.publicLog2("extensiongallery:downloadvsix:retry",{extensionId:e.identifier.id,attempts:o}),i}catch(i){throw ft(i,"Download")}}async downloadSignatureArchive(e){try{let n=V(this.extensionsDownloadDir,`.${Fe()}`),i=await this.doDownload(e,"sigzip",async()=>{await this.extensionGalleryService.downloadSignatureArchive(e,n);try{await this.validate(n.fsPath,".signature.p7s")}catch(o){try{await this.fileService.del(n)}catch(s){this.logService.warn(`Error while deleting: ${n.path}`,me(s))}throw o}},2);return i>1&&this.telemetryService.publicLog2("extensiongallery:downloadsigzip:retry",{extensionId:e.identifier.id,attempts:i}),n}catch(n){throw ft(n,"DownloadSignature")}}async downloadFile(e,n,i){if(await this.fileService.exists(n))return;if(n.scheme!==ne.file){await i(n);return}let o=V(this.extensionsDownloadDir,`.${Fe()}`);try{await i(o)}catch(s){try{await this.fileService.del(o)}catch{}throw s}try{await ce.rename(o.fsPath,n.fsPath,2*60*1e3)}catch(s){try{await this.fileService.del(o)}catch{}let a=!1;try{a=await this.fileService.exists(n)}catch{}if(a)this.logService.info("Rename failed because the file was downloaded by another source. So ignoring renaming.",e.identifier.id,n.path);else throw this.logService.info(`Rename failed because of ${me(s)}. Deleted the file from downloaded location`,o.path),s}}async doDownload(e,n,i,o){let s=1;for(;;)try{return await i(),s}catch(a){if(s++>o)throw a;this.logService.warn(`Failed downloading ${n}. ${me(a)}. Retry again...`,e.identifier.id)}}async validate(e,n){try{await Mf(e,n)}catch(i){throw Cc(i)}}async delete(e){await this.cleanUpPromise,await this.fileService.del(e)}async cleanUp(){try{if(!await this.fileService.exists(this.extensionsDownloadDir)){this.logService.trace("Extension VSIX downloads cache dir does not exist");return}let e=await this.fileService.resolve(this.extensionsDownloadDir,{resolveMetadata:!0});if(e.children){let n=[],i=[],o=[];for(let l of e.children)if(l.name.endsWith(zi.SignatureArchiveExtension))o.push(l.resource);else{let c=Lt.parse(l.name);c&&i.push([c,l])}let s=$u(i,([l])=>l),a=[];for(let l of s)l.sort((c,d)=>_f(c[0].version,d[0].version)),n.push(...l.slice(1).map(c=>c[1].resource)),a.push(l[0][1]);a.sort((l,c)=>l.mtime-c.mtime),n.push(...a.slice(0,Math.max(0,a.length-this.cache)).map(l=>l.resource)),n.push(...o),await Qe.settled(n.map(l=>(this.logService.trace("Deleting from cache",l.path),this.fileService.del(l))))}}catch(e){this.logService.error(e)}}getName(e){return this.cache?Lt.create(e).toString().toLowerCase():Fe()}};zi=E([m(0,St),m(1,G),m(2,Bt),m(3,ue),m(4,Ff),m(5,le),m(6,z)],zi);import{fork as zT}from"child_process";var ba=class extends _{constructor(e,n){super();this.userDataProfilesService=e;this.logService=n}processesLimiter=new Ol(5);async postUninstall(e){let n=this.parseScript(e,"uninstall");n&&(this.logService.info(e.identifier.id,e.manifest.version,"Running post uninstall script"),await this.processesLimiter.queue(async()=>{try{await this.runLifecycleHook(n.script,"uninstall",n.args,!0,e),this.logService.info("Finished running post uninstall script",e.identifier.id,e.manifest.version)}catch(i){this.logService.error("Failed to run post uninstall script",e.identifier.id,e.manifest.version),this.logService.error(i)}}));try{await ce.rm(this.getExtensionStoragePath(e))}catch(i){this.logService.error("Error while removing extension storage path",e.identifier.id),this.logService.error(i)}}parseScript(e,n){let i=`vscode:${n}`;if(e.location.scheme===ne.file&&e.manifest&&e.manifest.scripts&&typeof e.manifest.scripts[i]=="string"){let o=e.manifest.scripts[i].split(" ");return o.length<2||o[0]!=="node"||!o[1]?(this.logService.warn(e.identifier.id,e.manifest.version,`${i} should be a node script`),null):{script:W(e.location.fsPath,o[1]),args:o.slice(2)||[]}}return null}runLifecycleHook(e,n,i,o,s){return new Promise((a,l)=>{let c=this.start(e,n,i,s),d,u=f=>{d&&(clearTimeout(d),d=null),f?l(f):a(void 0)};c.on("error",f=>{u(Tt(f)||"Unknown")}),c.on("exit",(f,h)=>{u(f?`post-${n} process exited with code ${f}`:void 0)}),o&&(d=setTimeout(()=>{d=null,c.kill(),l("timed out")},5e3))})}start(e,n,i,o){let s={silent:!0,execArgv:void 0},a=zT(e,[`--type=extension-post-${n}`,...i],s);a.stdout.setEncoding("utf8"),a.stderr.setEncoding("utf8");let l=O.fromNodeEventEmitter(a.stdout,"data"),c=O.fromNodeEventEmitter(a.stderr,"data");this._register(l(f=>this.logService.info(o.identifier.id,o.manifest.version,`post-${n}`,f))),this._register(c(f=>this.logService.error(o.identifier.id,o.manifest.version,`post-${n}`,f)));let d=O.any(O.map(l,f=>({data:`%c${f}`,format:[""]}),this._store),O.map(c,f=>({data:`%c${f}`,format:["color: red"]}),this._store));return O.debounce(d,(f,h)=>f?{data:f.data+h.data,format:[...f.format,...h.format]}:{data:h.data,format:h.format},100,void 0,void 0,void 0,this._store)(f=>{console.group(o.identifier.id),console.log(f.data,...f.format),console.groupEnd()}),a}getExtensionStoragePath(e){return W(this.userDataProfilesService.defaultProfile.globalStorageHome.fsPath,e.identifier.id.toLowerCase())}};ba=E([m(0,ge),m(1,z)],ba);var Kf=class extends _{constructor(e,n,i,o,s){super();this.userDataProfilesService=e;this.fileService=n;this.uriIdentityService=i;this.logService=s;this._register(o.onDidInstallExtensions(a=>this.onDidInstallExtensions(a))),this._register(o.onDidUninstallExtension(a=>this.onDidUnInstallExtension(a)))}onDidInstallExtensions(e){for(let n of e)n.local&&this.invalidate(n.profileLocation)}onDidUnInstallExtension(e){e.error||this.invalidate(e.profileLocation)}async invalidate(e){if(e)for(let n of this.userDataProfilesService.profiles)this.uriIdentityService.extUri.isEqual(n.extensionsResource,e)&&await this.deleteUserCacheFile(n);else await this.deleteUserCacheFile(this.userDataProfilesService.defaultProfile)}async deleteUserCacheFile(e){try{await this.fileService.del(this.uriIdentityService.extUri.joinPath(e.cacheHome,bu))}catch(n){rt(n)!==1&&this.logService.error(n)}}};var $f=class extends _{constructor(e,n,i,o,s,a,l){super();this.extensionManagementService=e;this.extensionsScannerService=n;this.userDataProfilesService=i;this.extensionsProfileScannerService=o;this.uriIdentityService=s;this.fileService=a;this.logService=l;this.initialize().then(null,c=>l.error("Error while initializing Extensions Watcher",me(c)))}_onDidChangeExtensionsByAnotherSource=this._register(new P);onDidChangeExtensionsByAnotherSource=this._onDidChangeExtensionsByAnotherSource.event;allExtensions=new Map;extensionsProfileWatchDisposables=this._register(new ar);async initialize(){await this.extensionsScannerService.initializeDefaultProfileExtensions(),await this.onDidChangeProfiles(this.userDataProfilesService.profiles),this.registerListeners(),await this.uninstallExtensionsNotInProfiles()}registerListeners(){this._register(this.userDataProfilesService.onDidChangeProfiles(e=>this.onDidChangeProfiles(e.added))),this._register(this.extensionsProfileScannerService.onAddExtensions(e=>this.onAddExtensions(e))),this._register(this.extensionsProfileScannerService.onDidAddExtensions(e=>this.onDidAddExtensions(e))),this._register(this.extensionsProfileScannerService.onRemoveExtensions(e=>this.onRemoveExtensions(e))),this._register(this.extensionsProfileScannerService.onDidRemoveExtensions(e=>this.onDidRemoveExtensions(e))),this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e)))}async onDidChangeProfiles(e){try{e.length&&await Promise.all(e.map(n=>(this.extensionsProfileWatchDisposables.set(n.id,mi(this.fileService.watch(this.uriIdentityService.extUri.dirname(n.extensionsResource)),this.fileService.watch(n.extensionsResource))),this.populateExtensionsFromProfile(n.extensionsResource))))}catch(n){throw this.logService.error(n),n}}async onAddExtensions(e){for(let n of e.extensions)this.addExtensionWithKey(this.getKey(n.identifier,n.version),e.profileLocation)}async onDidAddExtensions(e){for(let n of e.extensions){let i=this.getKey(n.identifier,n.version);e.error?this.removeExtensionWithKey(i,e.profileLocation):this.addExtensionWithKey(i,e.profileLocation)}}async onRemoveExtensions(e){for(let n of e.extensions)this.removeExtensionWithKey(this.getKey(n.identifier,n.version),e.profileLocation)}async onDidRemoveExtensions(e){let n=[],i=[];for(let o of e.extensions){let s=this.getKey(o.identifier,o.version);e.error?this.addExtensionWithKey(s,e.profileLocation):(this.removeExtensionWithKey(s,e.profileLocation),this.allExtensions.has(s)||(this.logService.debug("Extension is removed from all profiles",o.identifier.id,o.version),i.push(this.extensionManagementService.scanInstalledExtensionAtLocation(o.location).then(a=>{a?n.push(a):this.logService.info("Extension not found at the location",o.location.toString())},a=>this.logService.error(a)))))}try{await Promise.all(i),n.length&&await this.uninstallExtensionsNotInProfiles(n)}catch(o){this.logService.error(o)}}onDidFilesChange(e){for(let n of this.userDataProfilesService.profiles)e.contains(n.extensionsResource,0,1)&&this.onDidExtensionsProfileChange(n.extensionsResource)}async onDidExtensionsProfileChange(e){let n=[],i=[],o=await this.extensionsProfileScannerService.scanProfileExtensions(e),s=new Set,a=new Set;for(let[l,c]of this.allExtensions)c.has(e)&&a.add(l);for(let l of o){let c=this.getKey(l.identifier,l.version);s.add(c),a.has(c)||(n.push(l.identifier),this.addExtensionWithKey(c,e))}for(let l of a)if(!s.has(l)){let c=this.fromKey(l);c&&(i.push(c.identifier),this.removeExtensionWithKey(l,e))}(n.length||i.length)&&this._onDidChangeExtensionsByAnotherSource.fire({added:n.length?{extensions:n,profileLocation:e}:void 0,removed:i.length?{extensions:i,profileLocation:e}:void 0})}async populateExtensionsFromProfile(e){let n=await this.extensionsProfileScannerService.scanProfileExtensions(e);for(let i of n)this.addExtensionWithKey(this.getKey(i.identifier,i.version),e)}async uninstallExtensionsNotInProfiles(e){e||(e=(await this.extensionManagementService.scanAllUserInstalledExtensions()).filter(i=>!this.allExtensions.has(this.getKey(i.identifier,i.manifest.version)))),e.length&&await this.extensionManagementService.markAsUninstalled(...e)}addExtensionWithKey(e,n){let i=this.allExtensions.get(e);i||this.allExtensions.set(e,i=new gi(o=>this.uriIdentityService.extUri.getComparisonKey(o))),i.add(n)}removeExtensionWithKey(e,n){let i=this.allExtensions.get(e);i&&i.delete(n),i?.size||this.allExtensions.delete(e)}getKey(e,n){return`${mr.toKey(e.id)}@${n}`}fromKey(e){let[n,i]=Db(e);return i?{identifier:{id:n},version:i}:void 0}};var qf=an,qx=".vsctmp",xa=class extends ga{constructor(e,n,i,o,s,a,l,c,d,u,f,h){super(e,n,f,i,u,h);this.extensionsScannerService=s;this.extensionsProfileScannerService=a;this.downloadService=l;this.instantiationService=c;this.fileService=d;let v=this._register(c.createInstance(ba));this.extensionsScanner=this._register(c.createInstance(Dc,I=>v.postUninstall(I))),this.manifestCache=this._register(new Kf(h,d,f,this,this.logService)),this.extensionsDownloader=this._register(c.createInstance(zi));let y=this._register(new $f(this,this.extensionsScannerService,h,a,f,d,i));this._register(y.onDidChangeExtensionsByAnotherSource(I=>this.onDidChangeExtensionsFromAnotherSource(I))),this.watchForExtensionsNotInstalledBySystem()}extensionsScanner;manifestCache;extensionsDownloader;extractingGalleryExtensions=new Map;_targetPlatformPromise;getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=zu(this.fileService,this.logService)),this._targetPlatformPromise}async zip(e){this.logService.trace("ExtensionManagementService#zip",e.identifier.id);let n=await this.collectFiles(e),i=await Wx(V(this.extensionsDownloader.extensionsDownloadDir,Fe()).fsPath,n);return C.file(i)}async getManifest(e){let{location:n,cleanup:i}=await this.downloadVsix(e),o=Rr(n.fsPath);try{return await Vf(o)}finally{await i()}}getInstalled(e,n=this.userDataProfilesService.defaultProfile.extensionsResource,i={version:this.productService.version,date:this.productService.date}){return this.extensionsScanner.scanExtensions(e??null,n,i)}scanAllUserInstalledExtensions(){return this.extensionsScanner.scanAllUserExtensions(!1)}scanInstalledExtensionAtLocation(e){return this.extensionsScanner.scanUserExtensionAtLocation(e)}async install(e,n={}){this.logService.trace("ExtensionManagementService#install",e.toString());let{location:i,cleanup:o}=await this.downloadVsix(e);try{let s=await Vf(Rr(i.fsPath)),a=Hn(s.publisher,s.name);if(s.engines&&s.engines.vscode&&!ca(s.engines.vscode,this.productService.version,this.productService.date))throw new Error(g("incompatible","Unable to install extension '{0}' as it is not compatible with VS Code '{1}'.",a,this.productService.version));let c=(await this.installExtensions([{manifest:s,extension:i,options:n}])).find(({identifier:d})=>Y(d,{id:a}));if(c?.local)return c.local;throw c?.error?c.error:ft(new Error(`Unknown error while installing extension ${a}`))}finally{await o()}}async installFromLocation(e,n){this.logService.trace("ExtensionManagementService#installFromLocation",e.toString());let i=await this.extensionsScanner.scanUserExtensionAtLocation(e);if(!i||!i.manifest.name||!i.manifest.version)throw new Error(`Cannot find a valid extension from the location ${e.toString()}`);return await this.addExtensionsToProfile([[i,{source:"resource"}]],n),this.logService.info("Successfully installed extension",i.identifier.id,n.toString()),i}async installExtensionsFromProfile(e,n,i){this.logService.trace("ExtensionManagementService#installExtensionsFromProfile",e,n.toString(),i.toString());let o=(await this.getInstalled(1,n)).filter(s=>e.some(a=>Y(a,s.identifier)));if(o.length){let s=await Promise.all(o.map(a=>this.extensionsScanner.scanMetadata(a,n)));await this.addExtensionsToProfile(o.map((a,l)=>[a,s[l]]),i),this.logService.info("Successfully installed extensions",o.map(a=>a.identifier.id),i.toString())}return o}async updateMetadata(e,n,i){return this.logService.trace("ExtensionManagementService#updateMetadata",e.identifier.id),n.isPreReleaseVersion&&(n.preRelease=!0,n.hasPreReleaseVersion=!0),n.isMachineScoped===!1&&(n.isMachineScoped=void 0),n.isBuiltin===!1&&(n.isBuiltin=void 0),n.pinned===!1&&(n.pinned=void 0),e=await this.extensionsScanner.updateMetadata(e,n,i),this.manifestCache.invalidate(i),this._onDidUpdateExtensionMetadata.fire({local:e,profileLocation:i}),e}async reinstallFromGallery(e){if(this.logService.trace("ExtensionManagementService#reinstallFromGallery",e.identifier.id),!this.galleryService.isEnabled())throw new Error(g("MarketPlaceDisabled","Marketplace is not enabled"));let n=await this.getTargetPlatform(),[i]=await this.galleryService.getExtensions([{...e.identifier,preRelease:e.preRelease}],{targetPlatform:n,compatible:!0},ee.None);if(!i)throw new Error(g("Not a Marketplace extension","Only Marketplace Extensions can be reinstalled"));await this.extensionsScanner.setUninstalled(e);try{await this.extensionsScanner.removeUninstalledExtension(e)}catch(o){throw new Error(g("removeError","Error while removing the extension: {0}. Please Quit and Start VS Code before trying again.",Tt(o)))}return this.installFromGallery(i)}copyExtension(e,n,i,o){return this.extensionsScanner.copyExtension(e,n,i,o)}copyExtensions(e,n){return this.extensionsScanner.copyExtensions(e,n,{version:this.productService.version,date:this.productService.date})}markAsUninstalled(...e){return this.extensionsScanner.setUninstalled(...e)}async cleanUp(){this.logService.trace("ExtensionManagementService#cleanUp");try{await this.extensionsScanner.cleanUp()}catch(e){this.logService.error(e)}}async download(e,n,i){let{location:o}=await this.extensionsDownloader.download(e,n,!i);return o}async downloadVsix(e){if(e.scheme===ne.file)return{location:e,async cleanup(){}};this.logService.trace("Downloading extension from",e.toString());let n=V(this.extensionsDownloader.extensionsDownloadDir,Fe());return await this.downloadService.download(e,n),this.logService.info("Downloaded extension to",n.toString()),{location:n,cleanup:async()=>{try{await this.fileService.del(n)}catch(o){this.logService.error(o)}}}}getCurrentExtensionsManifestLocation(){return this.userDataProfilesService.defaultProfile.extensionsResource}createInstallExtensionTask(e,n,i){let o=n instanceof C?new Lt({id:Hn(e.publisher,e.name)},e.version):Lt.create(n);return this.instantiationService.createInstance(_c,o,e,n,i,(s,a)=>{if(n instanceof C)return this.extractVSIX(o,n,i,a);let l=this.extractingGalleryExtensions.get(o.toString());return l||(this.extractingGalleryExtensions.set(o.toString(),l=this.downloadAndExtractGalleryExtension(o,n,s,i,a)),l.finally(()=>this.extractingGalleryExtensions.delete(o.toString()))),l},this.extensionsScanner)}createUninstallExtensionTask(e,n){return new dy(e,n,this.extensionsProfileScannerService)}async downloadAndExtractGalleryExtension(e,n,i,o,s){let{verificationStatus:a,location:l}=await this.extensionsDownloader.download(n,i,!o.donotVerifySignature,o.context?.[QS]);try{if(s.isCancellationRequested)throw new Ge;let c=await Vf(l.fsPath);if(!new Lt(n.identifier,n.version).equals(new Lt({id:Hn(c.publisher,c.name)},c.version)))throw new Xe(g("invalidManifest","Cannot install '{0}' extension because of manifest mismatch with Marketplace",n.identifier.id),"Invalid");return{local:await this.extensionsScanner.extractUserExtension(e,l.fsPath,{id:n.identifier.uuid,publisherId:n.publisherId,publisherDisplayName:n.publisherDisplayName,targetPlatform:n.properties.targetPlatform,isApplicationScoped:o.isApplicationScoped,isMachineScoped:o.isMachineScoped,isBuiltin:o.isBuiltin,isPreReleaseVersion:n.properties.isPreReleaseVersion,hasPreReleaseVersion:n.properties.isPreReleaseVersion,installedTimestamp:Date.now(),pinned:o.installGivenVersion?!0:!!o.pinned,preRelease:pn(o.preRelease)?o.preRelease:o.installPreReleaseVersion||n.properties.isPreReleaseVersion,source:"gallery"},!1,s),verificationStatus:a}}catch(c){try{await this.extensionsDownloader.delete(l)}catch(d){this.logService.warn("Error while deleting the downloaded file",l.toString(),me(d))}throw ft(c)}}async extractVSIX(e,n,i,o){return{local:await this.extensionsScanner.extractUserExtension(e,Rr(n.fsPath),{isApplicationScoped:i.isApplicationScoped,isMachineScoped:i.isMachineScoped,isBuiltin:i.isBuiltin,installedTimestamp:Date.now(),pinned:i.installGivenVersion?!0:!!i.pinned,source:"vsix"},i.keepExisting??!0,o)}}async collectFiles(e){let n=async o=>{let s=await ce.readdir(o);s=s.map(c=>W(o,c));let a=await Promise.all(s.map(c=>Hx.promises.stat(c))),l=Promise.resolve([]);return a.forEach((c,d)=>{let u=s[d];c.isFile()&&(l=l.then(f=>[...f,u])),c.isDirectory()&&(l=l.then(f=>n(u).then(h=>[...f,...h])))}),l};return(await n(e.location.fsPath)).map(o=>({path:`extension/${bd(e.location.fsPath,o)}`,localPath:o}))}async onDidChangeExtensionsFromAnotherSource({added:e,removed:n}){if(n){let i=e&&this.uriIdentityService.extUri.isEqual(n.profileLocation,e.profileLocation)?n.extensions.filter(o=>e.extensions.every(s=>!Y(s,o))):n.extensions;for(let o of i)this.logService.info("Extensions removed from another source",o.id,n.profileLocation.toString()),this._onDidUninstallExtension.fire({identifier:o,profileLocation:n.profileLocation})}if(e){let o=(await this.getInstalled(1,e.profileLocation)).filter(s=>e.extensions.some(a=>Y(a,s.identifier)));this._onDidInstallExtensions.fire(o.map(s=>(this.logService.info("Extensions added from another source",s.identifier.id,e.profileLocation.toString()),{identifier:s.identifier,local:s,profileLocation:e.profileLocation,operation:1})))}}knownDirectories=new gi;async watchForExtensionsNotInstalledBySystem(){this._register(this.extensionsScanner.onExtract(n=>this.knownDirectories.add(n)));let e=await this.fileService.resolve(this.extensionsScannerService.userExtensionsLocation);for(let n of e.children??[])n.isDirectory&&this.knownDirectories.add(n.resource);this._register(this.fileService.watch(this.extensionsScannerService.userExtensionsLocation)),this._register(this.fileService.onDidFilesChange(n=>this.onDidFilesChange(n)))}async onDidFilesChange(e){if(!e.affects(this.extensionsScannerService.userExtensionsLocation,1))return;let n=[];for(let i of e.rawAdded){if(this.knownDirectories.has(i)||!this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(i),this.extensionsScannerService.userExtensionsLocation)||this.uriIdentityService.extUri.isEqual(i,this.uriIdentityService.extUri.joinPath(this.extensionsScannerService.userExtensionsLocation,".obsolete"))||this.uriIdentityService.extUri.basename(i).startsWith(".")||!(await this.fileService.stat(i)).isDirectory)continue;let o=await this.extensionsScanner.scanUserExtensionAtLocation(i);o&&o.installedTimestamp===void 0&&(this.knownDirectories.add(i),n.push(o))}n.length&&(await this.addExtensionsToProfile(n.map(i=>[i,void 0]),this.userDataProfilesService.defaultProfile.extensionsResource),this.logService.info("Added extensions to default profile from external source",n.map(i=>i.identifier.id)))}async addExtensionsToProfile(e,n){let i=e.map(o=>o[0]);await this.setInstalled(i),await this.extensionsProfileScannerService.addExtensionsToProfile(e,n),this._onDidInstallExtensions.fire(i.map(o=>({local:o,identifier:o.identifier,operation:1,profileLocation:n})))}async setInstalled(e){let n=await this.extensionsScanner.getUninstalledExtensions();for(let i of e){let o=Lt.create(i);n[o.toString()]&&(this.logService.trace("Removing the extension from uninstalled list:",o.id),await this.extensionsScanner.setInstalled(o),this.logService.info("Removed the extension from uninstalled list:",o.id))}}};xa=E([m(0,Bt),m(1,le),m(2,z),m(3,St),m(4,Sa),m(5,Jn),m(6,Tf),m(7,Ot),m(8,G),m(9,de),m(10,he),m(11,ge)],xa);var Dc=class extends _{constructor(e,n,i,o,s,a,l){super();this.beforeRemovingExtension=e;this.fileService=n;this.extensionsScannerService=i;this.extensionsProfileScannerService=o;this.uriIdentityService=s;this.telemetryService=a;this.logService=l;this.uninstalledResource=V(this.extensionsScannerService.userExtensionsLocation,".obsolete"),this.uninstalledFileLimiter=new fr}uninstalledResource;uninstalledFileLimiter;_onExtract=this._register(new P);onExtract=this._onExtract.event;scanAllExtensionPromise=new Ye;scanUserExtensionsPromise=new Ye;async cleanUp(){await this.removeTemporarilyDeletedFolders(),await this.removeUninstalledExtensions()}async scanExtensions(e,n,i){try{let o={includeInvalid:!0,profileLocation:n,productVersion:i},s=[];if(e===null||e===0){let a=this.scanAllExtensionPromise.get(n);a||(a=this.extensionsScannerService.scanAllExtensions({includeInvalid:!0,useCache:!0},o,!1).finally(()=>this.scanAllExtensionPromise.delete(n)),this.scanAllExtensionPromise.set(n,a)),s.push(...await a)}else if(e===1){let a=this.scanUserExtensionsPromise.get(n);a||(a=this.extensionsScannerService.scanUserExtensions(o).finally(()=>this.scanUserExtensionsPromise.delete(n)),this.scanUserExtensionsPromise.set(n,a)),s.push(...await a)}return s=e!==null?s.filter(a=>a.type===e):s,await Promise.all(s.map(a=>this.toLocalExtension(a)))}catch(o){throw ft(o,"Scanning")}}async scanAllUserExtensions(e){try{let n=await this.extensionsScannerService.scanUserExtensions({includeAllVersions:!e,includeInvalid:!0});return await Promise.all(n.map(i=>this.toLocalExtension(i)))}catch(n){throw ft(n,"Scanning")}}async scanUserExtensionAtLocation(e){try{let n=await this.extensionsScannerService.scanExistingExtension(e,1,{includeInvalid:!0});if(n)return await this.toLocalExtension(n)}catch(n){this.logService.error(n)}return null}async extractUserExtension(e,n,i,o,s){let a=e.toString(),l=C.file(W(this.extensionsScannerService.userExtensionsLocation.fsPath,`.${Fe()}`)),c=C.file(W(this.extensionsScannerService.userExtensionsLocation.fsPath,a));if(await this.fileService.exists(c)){if(!o)try{return await this.scanLocalExtension(c,1)}catch(d){this.logService.warn(`Error while scanning the existing extension at ${c.path}. Deleting the existing extension and extracting it.`,me(d))}try{await this.deleteExtensionFromLocation(e.id,c,"removeExisting")}catch{throw new Xe(g("errorDeleting","Unable to delete the existing folder '{0}' while installing the extension '{1}'. Please delete the folder manually and try again",c.fsPath,e.id),"Delete")}}try{if(s.isCancellationRequested)throw new Ge;try{this.logService.trace(`Started extracting the extension from ${n} to ${c.fsPath}`),await Vx(n,l.fsPath,{sourcePath:"extension",overwrite:!0},s),this.logService.info(`Extracted extension to ${c}:`,e.id)}catch(d){throw Cc(d)}try{await this.extensionsScannerService.updateMetadata(l,i)}catch(d){throw this.telemetryService.publicLog2("extension:extract",{extensionId:e.id,code:`${rt(d)}`}),ft(d,"UpdateMetadata")}if(s.isCancellationRequested)throw new Ge;try{this.logService.trace(`Started renaming the extension from ${l.fsPath} to ${c.fsPath}`),await this.rename(l.fsPath,c.fsPath),this.logService.info("Renamed to",c.fsPath)}catch(d){if(d.code==="ENOTEMPTY"){this.logService.info("Rename failed because extension was installed by another source. So ignoring renaming.",e.id);try{await this.fileService.del(l,{recursive:!0})}catch{}}else throw this.logService.info(`Rename failed because of ${me(d)}. Deleted from extracted location`,l),d}this._onExtract.fire(c)}catch(d){try{await this.fileService.del(l,{recursive:!0})}catch{}throw d}return this.scanLocalExtension(c,1)}async scanMetadata(e,n){return n?(await this.getScannedExtension(e,n))?.metadata:this.extensionsScannerService.scanMetadata(e.location)}async getScannedExtension(e,n){return(await this.extensionsProfileScannerService.scanProfileExtensions(n)).find(o=>Y(o.identifier,e.identifier))}async updateMetadata(e,n,i){try{i?await this.extensionsProfileScannerService.updateMetadata([[e,n]],i):await this.extensionsScannerService.updateMetadata(e.location,n)}catch(o){throw this.telemetryService.publicLog2("extension:extract",{extensionId:e.identifier.id,code:`${rt(o)}`,isProfile:!!i}),ft(o,"UpdateMetadata")}return this.scanLocalExtension(e.location,e.type,i)}async getUninstalledExtensions(){try{return await this.withUninstalledExtensions()}catch(e){throw ft(e,"ReadUninstalled")}}async setUninstalled(...e){let n=e.map(i=>Lt.create(i));await this.withUninstalledExtensions(i=>n.forEach(o=>{i[o.toString()]=!0,this.logService.info("Marked extension as uninstalled",o.toString())}))}async setInstalled(e){try{await this.withUninstalledExtensions(n=>delete n[e.toString()])}catch(n){throw ft(n,"UnsetUninstalled")}}async removeExtension(e,n){if(this.uriIdentityService.extUri.isEqualOrParent(e.location,this.extensionsScannerService.userExtensionsLocation))return this.deleteExtensionFromLocation(e.identifier.id,e.location,n)}async removeUninstalledExtension(e){await this.removeExtension(e,"uninstalled"),await this.withUninstalledExtensions(n=>delete n[Lt.create(e).toString()])}async copyExtension(e,n,i,o){let s=await this.getScannedExtension(e,n),a=await this.getScannedExtension(e,i);if(o={...s?.metadata,...o},a)if(this.uriIdentityService.extUri.isEqual(a.location,e.location))await this.extensionsProfileScannerService.updateMetadata([[e,{...a.metadata,...o}]],i);else{let l=await this.scanLocalExtension(a.location,e.type,i);await this.extensionsProfileScannerService.removeExtensionFromProfile(l,i),await this.extensionsProfileScannerService.addExtensionsToProfile([[e,{...a.metadata,...o}]],i)}else await this.extensionsProfileScannerService.addExtensionsToProfile([[e,o]],i);return this.scanLocalExtension(e.location,e.type,i)}async copyExtensions(e,n,i){let o=await this.scanExtensions(1,e,i),s=await Promise.all(o.filter(a=>!a.isApplicationScoped).map(async a=>[a,await this.scanMetadata(a,e)]));await this.extensionsProfileScannerService.addExtensionsToProfile(s,n)}async deleteExtensionFromLocation(e,n,i){this.logService.trace(`Deleting ${i} extension from disk`,e,n.fsPath);let o=this.uriIdentityService.extUri.joinPath(this.uriIdentityService.extUri.dirname(n),`${this.uriIdentityService.extUri.basename(n)}.${Ur(Fe()).toString(16)}${qx}`);await this.rename(n.fsPath,o.fsPath),await this.fileService.del(o,{recursive:!0}),this.logService.info(`Deleted ${i} extension from disk`,e,n.fsPath)}withUninstalledExtensions(e){return this.uninstalledFileLimiter.queue(async()=>{let n;try{n=(await this.fileService.readFile(this.uninstalledResource,"utf8")).value.toString()}catch(o){if(rt(o)!==1)throw o}let i={};if(n)try{i=JSON.parse(n)}catch{}return e&&(e(i),Object.keys(i).length?await this.fileService.writeFile(this.uninstalledResource,A.fromString(JSON.stringify(i))):await this.fileService.del(this.uninstalledResource)),i})}async rename(e,n){try{await ce.rename(e,n,2*60*1e3)}catch(i){throw ft(i,"Rename")}}async scanLocalExtension(e,n,i){try{if(i){let s=(await this.extensionsScannerService.scanUserExtensions({profileLocation:i})).find(a=>this.uriIdentityService.extUri.isEqual(a.location,e));if(s)return await this.toLocalExtension(s)}else{let o=await this.extensionsScannerService.scanExistingExtension(e,n,{includeInvalid:!0});if(o)return await this.toLocalExtension(o)}throw new Xe(g("cannot read","Cannot read the extension from {0}",e.path),"ScanningExtension")}catch(o){throw ft(o,"ScanningExtension")}}async toLocalExtension(e){let n=await this.fileService.resolve(e.location),i,o;return n.children&&(i=n.children.find(({name:s})=>/^readme(\.txt|\.md|)$/i.test(s))?.resource,o=n.children.find(({name:s})=>/^changelog(\.txt|\.md|)$/i.test(s))?.resource),{identifier:e.identifier,type:e.type,isBuiltin:e.isBuiltin||!!e.metadata?.isBuiltin,location:e.location,manifest:e.manifest,targetPlatform:e.targetPlatform,validations:e.validations,isValid:e.isValid,readmeUrl:i,changelogUrl:o,publisherDisplayName:e.metadata?.publisherDisplayName,publisherId:e.metadata?.publisherId||null,isApplicationScoped:!!e.metadata?.isApplicationScoped,isMachineScoped:!!e.metadata?.isMachineScoped,isPreReleaseVersion:!!e.metadata?.isPreReleaseVersion,hasPreReleaseVersion:!!e.metadata?.hasPreReleaseVersion,preRelease:!!e.metadata?.preRelease,installedTimestamp:e.metadata?.installedTimestamp,updated:!!e.metadata?.updated,pinned:!!e.metadata?.pinned,isWorkspaceScoped:!1,source:e.metadata?.source??(e.identifier.uuid?"gallery":"vsix")}}async removeUninstalledExtensions(){let e=await this.getUninstalledExtensions();if(Object.keys(e).length===0){this.logService.debug("No uninstalled extensions found.");return}this.logService.debug("Removing uninstalled extensions:",Object.keys(e));let n=await this.extensionsScannerService.scanUserExtensions({includeAllVersions:!0,includeUninstalled:!0,includeInvalid:!0}),i=new Set;for(let s of n)e[Lt.create(s).toString()]||i.add(s.identifier.id.toLowerCase());try{let s=$u(n,a=>a.identifier);await Qe.settled(s.map(async a=>{let l=a.sort((c,d)=>_f(c.manifest.version,d.manifest.version))[0];i.has(l.identifier.id.toLowerCase())||await this.beforeRemovingExtension(await this.toLocalExtension(l))}))}catch(s){this.logService.error(s)}let o=n.filter(s=>s.metadata&&e[Lt.create(s).toString()]);await Promise.allSettled(o.map(s=>this.removeUninstalledExtension(s)))}async removeTemporarilyDeletedFolders(){this.logService.trace("ExtensionManagementService#removeTempDeleteFolders");let e;try{e=await this.fileService.resolve(this.extensionsScannerService.userExtensionsLocation)}catch(n){rt(n)!==1&&this.logService.error(n);return}if(e?.children)try{await Promise.allSettled(e.children.map(async n=>{if(!(!n.isDirectory||!n.name.endsWith(qx))){this.logService.trace("Deleting the temporarily deleted folder",n.resource.toString());try{await this.fileService.del(n.resource,{recursive:!0}),this.logService.trace("Deleted the temporarily deleted folder",n.resource.toString())}catch(i){rt(i)!==1&&this.logService.error(i)}}}))}catch{}}};Dc=E([m(1,G),m(2,Sa),m(3,Jn),m(4,he),m(5,le),m(6,z)],Dc);var _c=class extends Tc{constructor(e,n,i,o,s,a,l,c,d,u,f,h){super();this.extensionKey=e;this.manifest=n;this.source=i;this.options=o;this.extractExtensionFn=s;this.extensionsScanner=a;this.uriIdentityService=l;this.galleryService=c;this.userDataProfilesService=d;this.extensionsScannerService=u;this.extensionsProfileScannerService=f;this.logService=h;this.identifier=this.extensionKey.identifier}_operation=2;get operation(){return this.options.operation??this._operation}_verificationStatus;get verificationStatus(){return this._verificationStatus}identifier;async doRun(e){let i=(await this.extensionsScanner.scanExtensions(1,this.options.profileLocation,this.options.productVersion)).find(l=>Y(l.identifier,this.identifier));i&&(this._operation=3);let o={isApplicationScoped:this.options.isApplicationScoped||i?.isApplicationScoped,isMachineScoped:this.options.isMachineScoped||i?.isMachineScoped,isBuiltin:this.options.isBuiltin||i?.isBuiltin,isSystem:i?.type===0?!0:void 0,installedTimestamp:Date.now(),pinned:this.options.installGivenVersion?!0:this.options.pinned??i?.pinned,source:this.source instanceof C?"vsix":"gallery"},s;if(this.source instanceof C){if(i&&this.extensionKey.equals(new Lt(i.identifier,i.manifest.version)))try{await this.extensionsScanner.removeExtension(i,"existing")}catch{throw new Error(g("restartCode","Please restart VS Code before reinstalling {0}.",this.manifest.displayName||this.manifest.name))}let l=await this.unsetIfUninstalled(this.extensionKey);if(l)try{await this.extensionsScanner.removeExtension(l,"existing")}catch{throw new Error(g("restartCode","Please restart VS Code before reinstalling {0}.",this.manifest.displayName||this.manifest.name))}}else{if(o.id=this.source.identifier.uuid,o.publisherId=this.source.publisherId,o.publisherDisplayName=this.source.publisherDisplayName,o.targetPlatform=this.source.properties.targetPlatform,o.updated=!!i,o.isPreReleaseVersion=this.source.properties.isPreReleaseVersion,o.hasPreReleaseVersion=i?.hasPreReleaseVersion||this.source.properties.isPreReleaseVersion,o.preRelease=pn(this.options.preRelease)?this.options.preRelease:this.options.installPreReleaseVersion||this.source.properties.isPreReleaseVersion||i?.preRelease,i&&i.type!==0&&i.manifest.version===this.source.version)return this.extensionsScanner.updateMetadata(i,o,this.options.profileLocation);s=await this.unsetIfUninstalled(this.extensionKey)}if(e.isCancellationRequested)throw ft(new Ge);if(!s){let l=await this.extractExtensionFn(this.operation,e);s=l.local,this._verificationStatus=l.verificationStatus}if(this.uriIdentityService.extUri.isEqual(this.userDataProfilesService.defaultProfile.extensionsResource,this.options.profileLocation))try{await this.extensionsScannerService.initializeDefaultProfileExtensions()}catch(l){throw ft(l,"IntializeDefaultProfile")}if(e.isCancellationRequested)throw ft(new Ge);try{await this.extensionsProfileScannerService.addExtensionsToProfile([[s,o]],this.options.profileLocation,!s.isValid)}catch(l){throw ft(l,"AddToProfile")}let a=await this.extensionsScanner.scanLocalExtension(s.location,1,this.options.profileLocation);if(!a)throw new Xe("Cannot find the installed extension","InstalledExtensionNotFound");return this.source instanceof C&&this.updateMetadata(s,e),a}async unsetIfUninstalled(e){return(await this.extensionsScanner.getUninstalledExtensions())[e.toString()]?(this.logService.trace("Removing the extension from uninstalled list:",e.id),await this.extensionsScanner.setInstalled(e),this.logService.info("Removed the extension from uninstalled list:",e.id),(await this.extensionsScanner.scanAllUserExtensions(!0)).find(o=>Lt.create(o).equals(e))):void 0}async updateMetadata(e,n){try{let[i]=await this.galleryService.getExtensions([{id:e.identifier.id,version:e.manifest.version}],n);if(i||([i]=await this.galleryService.getExtensions([{id:e.identifier.id}],n)),i){let o={id:i.identifier.uuid,publisherDisplayName:i.publisherDisplayName,publisherId:i.publisherId,isPreReleaseVersion:i.properties.isPreReleaseVersion,hasPreReleaseVersion:e.hasPreReleaseVersion||i.properties.isPreReleaseVersion,preRelease:i.properties.isPreReleaseVersion||this.options.installPreReleaseVersion};await this.extensionsScanner.updateMetadata(e,o,this.options.profileLocation)}}catch{}}};_c=E([m(6,he),m(7,Bt),m(8,ge),m(9,Sa),m(10,Jn),m(11,z)],_c);var dy=class extends Tc{constructor(e,n,i){super();this.extension=e;this.options=n;this.extensionsProfileScannerService=i}async doRun(e){await this.extensionsProfileScannerService.removeExtensionFromProfile(this.extension,this.options.profileLocation)}};var Hf=M("IExtensionRecommendationNotificationService");async function jf(r,t,e,n,i,o){let s;try{await qT(r,t,e,n,i,o)}catch(a){s=a}finally{s&&i.errorTransformer&&(s=i.errorTransformer(s)),typeof s<"u"&&e.error(s),e.end()}}async function qT(r,t,e,n,i,o){uy(o);let s=await r.open(t,{create:!1});try{uy(o);let a=0,l=0,c=i&&typeof i.length=="number"?i.length:void 0,d=A.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),u=i&&typeof i.position=="number"?i.position:0,f=0;do l=await r.read(s,u,d.buffer,f,d.byteLength-f),u+=l,f+=l,a+=l,typeof c=="number"&&(c-=l),f===d.byteLength&&(await e.write(n(d)),d=A.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),f=0);while(l>0&&(typeof c!="number"||c>0)&&uy(o)&&HT(a,i));if(f>0){let h=f;typeof c=="number"&&(h=Math.min(f,c)),e.write(n(d.slice(0,h)))}}catch(a){throw Zr(a)}finally{await r.close(s)}}function uy(r){if(r.isCancellationRequested)throw li();return!0}function HT(r,t){if(typeof t?.limits?.size=="number"&&r>t.limits.size)throw Mn(g("fileTooLargeError","File is too large to open"),"EntryTooLarge");return!0}var qi=class extends _{constructor(e){super();this.logService=e}BUFFER_SIZE=256*1024;_onDidChangeFileSystemProviderRegistrations=this._register(new P);onDidChangeFileSystemProviderRegistrations=this._onDidChangeFileSystemProviderRegistrations.event;_onWillActivateFileSystemProvider=this._register(new P);onWillActivateFileSystemProvider=this._onWillActivateFileSystemProvider.event;_onDidChangeFileSystemProviderCapabilities=this._register(new P);onDidChangeFileSystemProviderCapabilities=this._onDidChangeFileSystemProviderCapabilities.event;provider=new Map;registerProvider(e,n){if(this.provider.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);Mr(`code/registerFilesystem/${e}`);let i=new te;return this.provider.set(e,n),this._onDidChangeFileSystemProviderRegistrations.fire({added:!0,scheme:e,provider:n}),i.add(n.onDidChangeFile(o=>{let s=new Cu(o,!this.isPathCaseSensitive(n));this.internalOnDidFilesChange.fire(s),s.hasCorrelation()||this._onDidUncorrelatedFilesChange.fire(s)})),typeof n.onDidWatchError=="function"&&i.add(n.onDidWatchError(o=>this._onDidWatchError.fire(new Error(o)))),i.add(n.onDidChangeCapabilities(()=>this._onDidChangeFileSystemProviderCapabilities.fire({provider:n,scheme:e}))),J(()=>{this._onDidChangeFileSystemProviderRegistrations.fire({added:!1,scheme:e,provider:n}),this.provider.delete(e),qt(i)})}getProvider(e){return this.provider.get(e)}async activateProvider(e){let n=[];this._onWillActivateFileSystemProvider.fire({scheme:e,join(i){n.push(i)}}),!this.provider.has(e)&&await Qe.settled(n)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.provider.has(e.scheme)}hasCapability(e,n){let i=this.provider.get(e.scheme);return!!(i&&i.capabilities&n)}listCapabilities(){return Cr.map(this.provider,([e,n])=>({scheme:e,capabilities:n.capabilities}))}async withProvider(e){if(!QI(e))throw new ot(g("invalidPath","Unable to resolve filesystem provider with relative file path '{0}'",this.resourceForError(e)),8);await this.activateProvider(e.scheme);let n=this.provider.get(e.scheme);if(!n){let i=new rr;throw i.message=g("noProviderFound","ENOPRO: No file system provider found for resource '{0}'",e.toString()),i}return n}async withReadProvider(e){let n=await this.withProvider(e);if(Yr(n)||On(n)||_u(n))return n;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async withWriteProvider(e){let n=await this.withProvider(e);if(Yr(n)||On(n))return n;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}_onDidRunOperation=this._register(new P);onDidRunOperation=this._onDidRunOperation.event;async resolve(e,n){try{return await this.doResolveFile(e,n)}catch(i){throw lc(i)==="EntryNotFound"?new ot(g("fileNotFoundError","Unable to resolve nonexistent file '{0}'",this.resourceForError(e)),1):Zr(i)}}async doResolveFile(e,n){let i=await this.withProvider(e),o=this.isPathCaseSensitive(i),s=n?.resolveTo,a=n?.resolveSingleChildDescendants,l=n?.resolveMetadata,c=await i.stat(e),d;return this.toFileStat(i,e,c,void 0,!!l,(u,f)=>(d||(d=An.forUris(()=>!o),d.set(e,!0),s&&d.fill(!0,s)),d.get(u.resource)||d.findSuperstr(u.resource.with({query:null,fragment:null}))?!0:u.isDirectory&&a?f===1:!1))}async toFileStat(e,n,i,o,s,a){let{providerExtUri:l}=this.getExtUri(e),c={resource:n,name:l.basename(n),isFile:(i.type&1)!==0,isDirectory:(i.type&2)!==0,isSymbolicLink:(i.type&64)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&1)||!!(e.capabilities&2048),locked:!!((i.permissions??0)&2),etag:im({mtime:i.mtime,size:i.size}),children:void 0};if(c.isDirectory&&a(c,o)){try{let d=await e.readdir(n),u=await Qe.settled(d.map(async([f,h])=>{try{let v=l.joinPath(n,f),y=s?await e.stat(v):{type:h};return await this.toFileStat(e,v,y,d.length,s,a)}catch(v){return this.logService.trace(v),null}}));c.children=qn(u)}catch(d){this.logService.trace(d),c.children=[]}return c}return c}async resolveAll(e){return Qe.settled(e.map(async n=>{try{return{stat:await this.doResolveFile(n.resource,n.options),success:!0}}catch(i){return this.logService.trace(i),{stat:void 0,success:!1}}}))}async stat(e){let n=await this.withProvider(e),i=await n.stat(e);return this.toFileStat(n,e,i,void 0,!0,()=>!1)}async exists(e){let n=await this.withProvider(e);try{return!!await n.stat(e)}catch{return!1}}async canCreateFile(e,n){try{await this.doValidateCreateFile(e,n)}catch(i){return i}return!0}async doValidateCreateFile(e,n){if(!n?.overwrite&&await this.exists(e))throw new ot(g("fileExists","Unable to create file '{0}' that already exists when overwrite flag is not set",this.resourceForError(e)),3,n)}async createFile(e,n=A.fromString(""),i){await this.doValidateCreateFile(e,i);let o=await this.writeFile(e,n);return this._onDidRunOperation.fire(new Xr(e,0,o)),o}async writeFile(e,n,i){let o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),{providerExtUri:s}=this.getExtUri(o),a=i;if(rm(o)&&!a?.atomic){let l=o.enforceAtomicWriteFile?.(e);l&&(a={...i,atomic:l})}try{await this.validateWriteFile(o,e,a)||await this.mkdirp(o,s.dirname(e));let c;if(On(o)&&!(n instanceof A))if(Ml(n)){let d=await tS(n,3);d.ended?c=A.concat(d.buffer):c=d}else c=eS(n,d=>A.concat(d),3);else c=n;!Yr(o)||On(o)&&c instanceof A||On(o)&&rm(o)&&a?.atomic?await this.doWriteUnbuffered(o,e,a,c):await this.doWriteBuffered(o,e,a,c instanceof A?iS(c):c),this._onDidRunOperation.fire(new Xr(e,4))}catch(l){throw new ot(g("err.write","Unable to write file '{0}' ({1})",this.resourceForError(e),Zr(l).toString()),rt(l),a)}return this.resolve(e,{resolveMetadata:!0})}async validateWriteFile(e,n,i){let o=!!i?.unlock;if(o&&!(e.capabilities&8192))throw new Error(g("writeFailedUnlockUnsupported","Unable to unlock file '{0}' because provider does not support it.",this.resourceForError(n)));if(!!i?.atomic){if(!(e.capabilities&32768))throw new Error(g("writeFailedAtomicUnsupported1","Unable to atomically write file '{0}' because provider does not support it.",this.resourceForError(n)));if(!(e.capabilities&2))throw new Error(g("writeFailedAtomicUnsupported2","Unable to atomically write file '{0}' because provider does not support unbuffered writes.",this.resourceForError(n)));if(o)throw new Error(g("writeFailedAtomicUnlock","Unable to unlock file '{0}' because atomic write is enabled.",this.resourceForError(n)))}let a;try{a=await e.stat(n)}catch{return}if(a.type&2)throw new ot(g("fileIsDirectoryWriteError","Unable to write file '{0}' that is actually a directory",this.resourceForError(n)),0,i);if(this.throwIfFileIsReadonly(n,a),typeof i?.mtime=="number"&&typeof i.etag=="string"&&i.etag!==Uu&&typeof a.mtime=="number"&&typeof a.size=="number"&&i.mtime<a.mtime&&i.etag!==im({mtime:i.mtime,size:a.size}))throw new ot(g("fileModifiedError","File Modified Since"),3,i);return a}async readFile(e,n,i){let o=await this.withReadProvider(e);return n?.atomic?this.doReadFileAtomic(o,e,n,i):this.doReadFile(o,e,n,i)}async doReadFileAtomic(e,n,i,o){return new Promise((s,a)=>{this.writeQueue.queueFor(n,async()=>{try{let l=await this.doReadFile(e,n,i,o);s(l)}catch(l){a(l)}},this.getExtUri(e).providerExtUri)})}async doReadFile(e,n,i,o){let s=await this.doReadFileStream(e,n,{...i,preferUnbuffered:!0},o);return{...s,value:await kr(s.value)}}async readFileStream(e,n,i){let o=await this.withReadProvider(e);return this.doReadFileStream(o,e,n,i)}async doReadFileStream(e,n,i,o){let s=new It(o),a=i;ku(e)&&e.enforceAtomicReadFile?.(n)&&(a={...i,atomic:!0});let l=this.validateReadFile(n,a).then(d=>d,d=>{throw s.dispose(!0),d}),c;try{return typeof a?.etag=="string"&&a.etag!==Uu&&await l,a?.atomic&&ku(e)||!(Yr(e)||_u(e))||On(e)&&a?.preferUnbuffered?c=this.readFileUnbuffered(e,n,a):_u(e)?c=this.readFileStreamed(e,n,s.token,a):c=this.readFileBuffered(e,n,s.token,a),c.on("end",()=>s.dispose()),c.on("error",()=>s.dispose()),{...await l,value:c}}catch(d){throw c&&await Jd(c),this.restoreReadError(d,n,a)}}restoreReadError(e,n,i){let o=g("err.read","Unable to read file '{0}' ({1})",this.resourceForError(n),Zr(e).toString());return e instanceof Ds?new Ds(o,e.stat,i):e instanceof Cs?new Cs(o,e.fileOperationResult,e.size,e.options):new ot(o,rt(e),i)}readFileStreamed(e,n,i,o=Object.create(null)){let s=e.readFileStream(n,o,i);return Xd(s,{data:a=>a instanceof A?a:A.wrap(a),error:a=>this.restoreReadError(a,n,o)},a=>A.concat(a))}readFileBuffered(e,n,i,o=Object.create(null)){let s=aS();return jf(e,n,s,a=>a,{...o,bufferSize:this.BUFFER_SIZE,errorTransformer:a=>this.restoreReadError(a,n,o)},i),s}readFileUnbuffered(e,n,i){let o=Qr(s=>A.concat(s));return(async()=>{try{let s;i?.atomic&&ku(e)?s=await e.readFile(n,{atomic:!0}):s=await e.readFile(n),typeof i?.position=="number"&&(s=s.slice(i.position)),typeof i?.length=="number"&&(s=s.slice(0,i.length)),this.validateReadFileLimits(n,s.byteLength,i),o.end(A.wrap(s))}catch(s){o.error(s),o.end()}})(),o}async validateReadFile(e,n){let i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new ot(g("fileIsDirectoryReadError","Unable to read file '{0}' that is actually a directory",this.resourceForError(e)),0,n);if(typeof n?.etag=="string"&&n.etag!==Uu&&n.etag===i.etag)throw new Ds(g("fileNotModifiedError","File not modified since"),i,n);return this.validateReadFileLimits(e,i.size,n),i}validateReadFileLimits(e,n,i){if(typeof i?.limits?.size=="number"&&n>i.limits.size)throw new Cs(g("fileTooLargeError","Unable to read file '{0}' that is too large to open",this.resourceForError(e)),7,n,i)}async canMove(e,n,i){return this.doCanMoveCopy(e,n,"move",i)}async canCopy(e,n,i){return this.doCanMoveCopy(e,n,"copy",i)}async doCanMoveCopy(e,n,i,o){if(e.toString()!==n.toString())try{let s=i==="move"?this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e):await this.withReadProvider(e),a=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(n),n);await this.doValidateMoveCopy(s,e,a,n,i,o)}catch(s){return s}return!0}async move(e,n,i){let o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(n),n),a=await this.doMoveCopy(o,e,s,n,"move",!!i),l=await this.resolve(n,{resolveMetadata:!0});return this._onDidRunOperation.fire(new Xr(e,a==="move"?2:3,l)),l}async copy(e,n,i){let o=await this.withReadProvider(e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(n),n),a=await this.doMoveCopy(o,e,s,n,"copy",!!i),l=await this.resolve(n,{resolveMetadata:!0});return this._onDidRunOperation.fire(new Xr(e,a==="copy"?3:2,l)),l}async doMoveCopy(e,n,i,o,s,a){if(n.toString()===o.toString())return s;let{exists:l,isSameResourceWithDifferentPathCase:c}=await this.doValidateMoveCopy(e,n,i,o,s,a);if(l&&!c&&a&&await this.del(o,{recursive:!0}),await this.mkdirp(i,this.getExtUri(i).providerExtUri.dirname(o)),s==="copy"){if(e===i&&ac(e))await e.copy(n,o,{overwrite:a});else{let d=await this.resolve(n);d.isDirectory?await this.doCopyFolder(e,d,i,o):await this.doCopyFile(e,n,i,o)}return s}else return e===i?(await e.rename(n,o,{overwrite:a}),s):(await this.doMoveCopy(e,n,i,o,"copy",a),await this.del(n,{recursive:!0}),"copy")}async doCopyFile(e,n,i,o){if(Yr(e)&&Yr(i))return this.doPipeBuffered(e,n,i,o);if(Yr(e)&&On(i))return this.doPipeBufferedToUnbuffered(e,n,i,o);if(On(e)&&Yr(i))return this.doPipeUnbufferedToBuffered(e,n,i,o);if(On(e)&&On(i))return this.doPipeUnbuffered(e,n,i,o)}async doCopyFolder(e,n,i,o){await i.mkdir(o),Array.isArray(n.children)&&await Qe.settled(n.children.map(async s=>{let a=this.getExtUri(i).providerExtUri.joinPath(o,s.name);return s.isDirectory?this.doCopyFolder(e,await this.resolve(s.resource),i,a):this.doCopyFile(e,s.resource,i,a)}))}async doValidateMoveCopy(e,n,i,o,s,a){let l=!1;if(e===i){let{providerExtUri:d,isPathCaseSensitive:u}=this.getExtUri(e);if(u||(l=d.isEqual(n,o)),l&&s==="copy")throw new Error(g("unableToMoveCopyError1","Unable to copy when source '{0}' is same as target '{1}' with different path case on a case insensitive file system",this.resourceForError(n),this.resourceForError(o)));if(!l&&d.isEqualOrParent(o,n))throw new Error(g("unableToMoveCopyError2","Unable to move/copy when source '{0}' is parent of target '{1}'.",this.resourceForError(n),this.resourceForError(o)))}let c=await this.exists(o);if(c&&!l){if(!a)throw new ot(g("unableToMoveCopyError3","Unable to move/copy '{0}' because target '{1}' already exists at destination.",this.resourceForError(n),this.resourceForError(o)),4);if(e===i){let{providerExtUri:d}=this.getExtUri(e);if(d.isEqualOrParent(n,o))throw new Error(g("unableToMoveCopyError4","Unable to move/copy '{0}' into '{1}' since a file would replace the folder it is contained in.",this.resourceForError(n),this.resourceForError(o)))}}return{exists:c,isSameResourceWithDifferentPathCase:l}}getExtUri(e){let n=this.isPathCaseSensitive(e);return{providerExtUri:n?Le:pg,isPathCaseSensitive:n}}isPathCaseSensitive(e){return!!(e.capabilities&1024)}async createFolder(e){let n=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e);await this.mkdirp(n,e);let i=await this.resolve(e,{resolveMetadata:!0});return this._onDidRunOperation.fire(new Xr(e,0,i)),i}async mkdirp(e,n){let i=[],{providerExtUri:o}=this.getExtUri(e);for(;!o.isEqual(n,o.dirname(n));)try{if(!((await e.stat(n)).type&2))throw new Error(g("mkdirExistsError","Unable to create folder '{0}' that already exists but is not a directory",this.resourceForError(n)));break}catch(s){if(lc(s)!=="EntryNotFound")throw s;i.push(o.basename(n)),n=o.dirname(n)}for(let s=i.length-1;s>=0;s--){n=o.joinPath(n,i[s]);try{await e.mkdir(n)}catch(a){if(lc(a)!=="EntryExists")throw a}}}async canDelete(e,n){try{await this.doValidateDelete(e,n)}catch(i){return i}return!0}async doValidateDelete(e,n){let i=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e),o=!!n?.useTrash;if(o&&!(i.capabilities&4096))throw new Error(g("deleteFailedTrashUnsupported","Unable to delete file '{0}' via trash because provider does not support it.",this.resourceForError(e)));let s=n?.atomic;if(s&&!(i.capabilities&65536))throw new Error(g("deleteFailedAtomicUnsupported","Unable to delete file '{0}' atomically because provider does not support it.",this.resourceForError(e)));if(o&&s)throw new Error(g("deleteFailedTrashAndAtomicUnsupported","Unable to atomically delete file '{0}' because using trash is enabled.",this.resourceForError(e)));let a;try{a=await i.stat(e)}catch{}if(a)this.throwIfFileIsReadonly(e,a);else throw new ot(g("deleteFailedNotFound","Unable to delete nonexistent file '{0}'",this.resourceForError(e)),1);if(!!!n?.recursive){let c=await this.resolve(e);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error(g("deleteFailedNonEmptyFolder","Unable to delete non-empty folder '{0}'.",this.resourceForError(e)))}return i}async del(e,n){let i=await this.doValidateDelete(e,n),o=n;if(cb(i)&&!o?.atomic){let c=i.enforceAtomicDelete?.(e);c&&(o={...n,atomic:c})}let s=!!o?.useTrash,a=!!o?.recursive,l=o?.atomic??!1;await i.delete(e,{recursive:a,useTrash:s,atomic:l}),this._onDidRunOperation.fire(new Xr(e,1))}async cloneFile(e,n){let i=await this.withProvider(e),o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(n),n);if(!(i===o&&this.getExtUri(i).providerExtUri.isEqual(e,n)))return i===o&&Du(i)?i.cloneFile(e,n):(await this.mkdirp(o,this.getExtUri(o).providerExtUri.dirname(n)),i===o&&ac(i)?this.writeQueue.queueFor(e,()=>i.copy(e,n,{overwrite:!0}),this.getExtUri(i).providerExtUri):this.writeQueue.queueFor(e,()=>this.doCopyFile(i,e,o,n),this.getExtUri(i).providerExtUri))}internalOnDidFilesChange=this._register(new P);_onDidUncorrelatedFilesChange=this._register(new P);onDidFilesChange=this._onDidUncorrelatedFilesChange.event;_onDidWatchError=this._register(new P);onDidWatchError=this._onDidWatchError.event;activeWatchers=new Map;static WATCHER_CORRELATION_IDS=0;createWatcher(e,n){return this.watch(e,{...n,correlationId:qi.WATCHER_CORRELATION_IDS++})}watch(e,n={recursive:!1,excludes:[]}){let i=new te,o=!1,s=()=>{o=!0};i.add(J(()=>s())),(async()=>{try{let l=await this.doWatch(e,n);o?qt(l):s=()=>qt(l)}catch(l){this.logService.error(l)}})();let a=n.correlationId;if(typeof a=="number"){let l=i.add(new P);return i.add(this.internalOnDidFilesChange.event(d=>{d.correlates(a)&&l.fire(d)})),{onDidChange:l.event,dispose:()=>i.dispose()}}return i}async doWatch(e,n){let i=await this.withProvider(e),o=Ur([this.getExtUri(i).providerExtUri.getComparisonKey(e),n]),s=this.activeWatchers.get(o);return s||(s={count:0,disposable:i.watch(e,n)},this.activeWatchers.set(o,s)),s.count+=1,J(()=>{s&&(s.count--,s.count===0&&(qt(s.disposable),this.activeWatchers.delete(o)))})}dispose(){super.dispose();for(let[,e]of this.activeWatchers)qt(e.disposable);this.activeWatchers.clear()}writeQueue=this._register(new us);async doWriteBuffered(e,n,i,o){return this.writeQueue.queueFor(n,async()=>{let s=await e.open(n,{create:!0,unlock:i?.unlock??!1});try{Ml(o)||Qd(o)?await this.doWriteStreamBufferedQueued(e,s,o):await this.doWriteReadableBufferedQueued(e,s,o)}catch(a){throw Zr(a)}finally{await e.close(s)}},this.getExtUri(e).providerExtUri)}async doWriteStreamBufferedQueued(e,n,i){let o=0,s;if(Qd(i)){if(i.buffer.length>0){let a=A.concat(i.buffer);await this.doWriteBuffer(e,n,a,a.byteLength,o,0),o+=a.byteLength}if(i.ended)return;s=i.stream}else s=i;return new Promise((a,l)=>{fs(s,{onData:async c=>{s.pause();try{await this.doWriteBuffer(e,n,c,c.byteLength,o,0)}catch(d){return l(d)}o+=c.byteLength,setTimeout(()=>s.resume())},onError:c=>l(c),onEnd:()=>a()})})}async doWriteReadableBufferedQueued(e,n,i){let o=0,s;for(;(s=i.read())!==null;)await this.doWriteBuffer(e,n,s,s.byteLength,o,0),o+=s.byteLength}async doWriteBuffer(e,n,i,o,s,a){let l=0;for(;l<o;){let c=await e.write(n,s+l,i.buffer,a+l,o-l);l+=c}}async doWriteUnbuffered(e,n,i,o){return this.writeQueue.queueFor(n,()=>this.doWriteUnbufferedQueued(e,n,i,o),this.getExtUri(e).providerExtUri)}async doWriteUnbufferedQueued(e,n,i,o){let s;o instanceof A?s=o:Ml(o)?s=await kr(o):Qd(o)?s=await oS(o):s=rS(o),await e.writeFile(n,s.buffer,{create:!0,overwrite:!0,unlock:i?.unlock??!1,atomic:i?.atomic??!1})}async doPipeBuffered(e,n,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeBufferedQueued(e,n,i,o),this.getExtUri(i).providerExtUri)}async doPipeBufferedQueued(e,n,i,o){let s,a;try{s=await e.open(n,{create:!1}),a=await i.open(o,{create:!0,unlock:!1});let l=A.alloc(this.BUFFER_SIZE),c=0,d=0,u=0;do u=await e.read(s,c,l.buffer,d,l.byteLength-d),await this.doWriteBuffer(i,a,l,u,c,d),c+=u,d+=u,d===l.byteLength&&(d=0);while(u>0)}catch(l){throw Zr(l)}finally{await Qe.settled([typeof s=="number"?e.close(s):Promise.resolve(),typeof a=="number"?i.close(a):Promise.resolve()])}}async doPipeUnbuffered(e,n,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeUnbufferedQueued(e,n,i,o),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedQueued(e,n,i,o){return i.writeFile(o,await e.readFile(n),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async doPipeUnbufferedToBuffered(e,n,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeUnbufferedToBufferedQueued(e,n,i,o),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedToBufferedQueued(e,n,i,o){let s=await i.open(o,{create:!0,unlock:!1});try{let a=await e.readFile(n);await this.doWriteBuffer(i,s,A.wrap(a),a.byteLength,0,0)}catch(a){throw Zr(a)}finally{await i.close(s)}}async doPipeBufferedToUnbuffered(e,n,i,o){let s=await kr(this.readFileBuffered(e,n,ee.None));await this.doWriteUnbuffered(i,o,void 0,s)}throwIfFileSystemIsReadonly(e,n){if(e.capabilities&2048)throw new ot(g("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(n)),6);return e}throwIfFileIsReadonly(e,n){if((n.permissions??0)&1)throw new ot(g("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(e)),6)}resourceForError(e){return e.scheme===ne.file?e.fsPath:e.toString(!0)}};qi=E([m(0,z)],qi);import{promises as Hi}from"fs";function Yf(r){return typeof r.correlationId=="number"}function hy(r){return r.recursive===!0}var Qf=class r extends _{constructor(e,n,i,o){super();this.onFileChanges=e;this.onLogMessage=n;this.verboseLogging=i;this.options=o}static MAX_RESTARTS=5;watcher;watcherDisposables=this._register(new zt);requests=void 0;restartCounter=0;init(){let e=new te;this.watcherDisposables.value=e,this.watcher=this.createWatcher(e),this.watcher.setVerboseLogging(this.verboseLogging),e.add(this.watcher.onDidChangeFile(n=>this.onFileChanges(n))),e.add(this.watcher.onDidLogMessage(n=>this.onLogMessage(n))),e.add(this.watcher.onDidError(n=>this.onError(n.error,n.request)))}onError(e,n){this.canRestart(e,n)?this.restartCounter<r.MAX_RESTARTS&&this.requests?(this.error(`restarting watcher after unexpected error: ${e}`),this.restart(this.requests)):this.error(`gave up attempting to restart watcher after unexpected error: ${e}`):this.error(e)}canRestart(e,n){return!(!this.options.restartOnError||n||e.indexOf("No space left on device")!==-1||e.indexOf("EMFILE")!==-1)}restart(e){this.restartCounter++,this.init(),this.watch(e)}async watch(e){this.requests=e,await this.watcher?.watch(e)}async setVerboseLogging(e){this.verboseLogging=e,await this.watcher?.setVerboseLogging(e)}error(e){this.onLogMessage({type:"error",message:`[File Watcher (${this.options.type})] ${e}`})}trace(e){this.onLogMessage({type:"trace",message:`[File Watcher (${this.options.type})] ${e}`})}dispose(){return this.watcher=void 0,super.dispose()}},Jf=class extends Qf{constructor(t,e,n){super(t,e,n,{type:"node.js",restartOnError:!1})}},Xf=class extends Qf{constructor(t,e,n){super(t,e,n,{type:"universal",restartOnError:!0})}};function kc(r){return r.map(t=>({type:t.type,resource:C.revive(t.resource),cId:t.cId}))}function jx(r){let t=new py;for(let e of r)t.processEvent(e);return t.coalesce()}function QT(r,t){return typeof t=="string"&&!t.startsWith(Ps)&&!fi(t)?{base:r,pattern:t}:t}function gy(r,t){let e=[];for(let n of t)e.push(ab(QT(r,n)));return e}var py=class{coalesced=new Set;mapPathToChange=new Map;toKey(t){return Oe?t.resource.fsPath:t.resource.fsPath.toLowerCase()}processEvent(t){let e=this.mapPathToChange.get(this.toKey(t)),n=!1;if(e){let i=e.type,o=t.type;e.resource.fsPath!==t.resource.fsPath&&(t.type===2||t.type===1)?n=!0:i===1&&o===2?(this.mapPathToChange.delete(this.toKey(t)),this.coalesced.delete(e)):i===2&&o===1?e.type=0:i===1&&o===0||(e.type=o)}else n=!0;n&&(this.coalesced.add(t),this.mapPathToChange.set(this.toKey(t),t))}coalesce(){let t=[],e=[];return Array.from(this.coalesced).filter(n=>n.type!==2?(t.push(n),!1):!0).sort((n,i)=>n.resource.fsPath.length-i.resource.fsPath.length).filter(n=>e.some(i=>db(n.resource.fsPath,i,!Oe))?!1:(e.push(n.resource.fsPath),!0)).concat(t)}};function Gx(r,t){if(typeof t=="number")switch(r.type){case 1:return(t&4)===0;case 2:return(t&8)===0;case 0:return(t&2)===0}return!1}function Qx(r){if(typeof r=="number"){let t=[];return r&4&&t.push("Added"),r&8&&t.push("Deleted"),r&2&&t.push("Updated"),t.length===0?"<all>":`[${t.join(", ")}]`}return"<none>"}var Zf=class extends _{constructor(e,n){super();this.logService=e;this.options=n}_onDidChangeFile=this._register(new P);onDidChangeFile=this._onDidChangeFile.event;_onDidWatchError=this._register(new P);onDidWatchError=this._onDidWatchError.event;watch(e,n){return n.recursive||this.options?.watcher?.forceUniversal?this.watchUniversal(e,n):this.watchNonRecursive(e,n)}universalWatcher;universalWatchRequests=[];universalWatchRequestDelayer=this._register(new hn(0));watchUniversal(e,n){let i={path:this.toWatchPath(e),excludes:n.excludes,includes:n.includes,recursive:n.recursive,filter:n.filter,correlationId:n.correlationId},o=ng(this.universalWatchRequests,i);return this.refreshUniversalWatchers(),J(()=>{o(),this.refreshUniversalWatchers()})}refreshUniversalWatchers(){this.universalWatchRequestDelayer.trigger(()=>this.doRefreshUniversalWatchers()).catch(e=>ze(e))}doRefreshUniversalWatchers(){this.universalWatcher||(this.universalWatcher=this._register(this.createUniversalWatcher(n=>this._onDidChangeFile.fire(kc(n)),n=>this.onWatcherLogMessage(n),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.universalWatcher?.setVerboseLogging(this.logService.getLevel()===1)})));let e=this.options?.watcher?.recursive?.usePolling;if(e===!0)for(let n of this.universalWatchRequests)hy(n)&&(n.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);else if(Array.isArray(e))for(let n of this.universalWatchRequests)hy(n)&&e.includes(n.path)&&(n.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);return this.universalWatcher.watch(this.universalWatchRequests)}nonRecursiveWatcher;nonRecursiveWatchRequests=[];nonRecursiveWatchRequestDelayer=this._register(new hn(0));watchNonRecursive(e,n){let i={path:this.toWatchPath(e),excludes:n.excludes,includes:n.includes,recursive:!1,filter:n.filter,correlationId:n.correlationId},o=ng(this.nonRecursiveWatchRequests,i);return this.refreshNonRecursiveWatchers(),J(()=>{o(),this.refreshNonRecursiveWatchers()})}refreshNonRecursiveWatchers(){this.nonRecursiveWatchRequestDelayer.trigger(()=>this.doRefreshNonRecursiveWatchers()).catch(e=>ze(e))}doRefreshNonRecursiveWatchers(){return this.nonRecursiveWatcher||(this.nonRecursiveWatcher=this._register(this.createNonRecursiveWatcher(e=>this._onDidChangeFile.fire(kc(e)),e=>this.onWatcherLogMessage(e),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.nonRecursiveWatcher?.setVerboseLogging(this.logService.getLevel()===1)}))),this.nonRecursiveWatcher.watch(this.nonRecursiveWatchRequests)}onWatcherLogMessage(e){e.type==="error"&&this._onDidWatchError.fire(e.message),this.logWatcherMessage(e)}logWatcherMessage(e){this.logService[e.type](e.message)}toFilePath(e){return Dn(e.fsPath)}toWatchPath(e){let n=this.toFilePath(e);return VI(n)}};import{fork as eR}from"child_process";function Jx(r){let t=r;return t&&typeof t.type=="string"&&typeof t.severity=="string"}function JT(r){let t=[],e;try{let n=JSON.parse(r.arguments),i=n[n.length-1];i&&i.__$stack&&(n.pop(),e=i.__$stack),t.push(...n)}catch{t.push("Unable to log remote console arguments",r.arguments)}return{args:t,stack:e}}function XT(r){if(!r)return r;let t=r.indexOf(`
`);return t===-1?r:r.substring(0,t)}function Xx(r,t){let{args:e,stack:n}=JT(r),i=typeof e[0]=="string"&&e.length===1,o=XT(n);o&&(o=`(${o.trim()})`);let s=[];if(typeof e[0]=="string"?o&&i?s=[`%c[${t}] %c${e[0]} %c${o}`,Ea("blue"),Ea(""),Ea("grey")]:s=[`%c[${t}] %c${e[0]}`,Ea("blue"),Ea(""),...e.slice(1)]:s=[`%c[${t}]%`,Ea("blue"),...e],o&&!i&&s.push(o),typeof console[r.severity]!="function")throw new Error("Unknown console method");console[r.severity].apply(console,s)}function Ea(r){return`color: ${r}`}import{promises as Yx}from"fs";function Zx(r=Me){return r.comspec||"cmd.exe"}function e1(r){let t=[],e=!1,n=function(i){if(e){t.push(i);return}(!r.send(i,s=>{if(s&&console.error(s),e=!1,t.length>0){let a=t.slice(0);t=[],a.forEach(l=>n(l))}})||be)&&(e=!0)};return{send:n}}var YT;(t=>{async function r(e,n,i){if(fi(e))return e;if(n===void 0&&(n=fo()),Et(e)!==".")return W(n,e);if(i===void 0&&De(Me.PATH)&&(i=Me.PATH.split(Qv)),i===void 0||i.length===0)return W(n,e);async function s(a){if(await ce.exists(a)){let l;try{l=await Yx.stat(a)}catch(c){c.message.startsWith("EACCES")&&(l=await Yx.lstat(a))}return l?!l.isDirectory():!1}return!1}for(let a of i){let l;if(fi(a)?l=W(a,e):l=W(n,a,e),await s(l))return l;let c=l+".com";if(await s(c)||(c=l+".exe",await s(c)))return c}return W(n,e)}t.findExecutable=r})(YT||={});var wa=class{constructor(t,e){this.modulePath=t;this.options=e;let n=e&&e.timeout?e.timeout:6e4;this.disposeDelayer=new bo(n),this.child=null,this._client=null}disposeDelayer;activeRequests=new Set;child;_client;channels=new Map;_onDidProcessExit=new P;onDidProcessExit=this._onDidProcessExit.event;getChannel(t){let e=this;return{call(n,i,o){return e.requestPromise(t,n,i,o)},listen(n,i){return e.requestEvent(t,n,i)}}}requestPromise(t,e,n,i=ee.None){if(!this.disposeDelayer)return Promise.reject(new Error("disposed"));if(i.isCancellationRequested)return Promise.reject(li());this.disposeDelayer.cancel();let o=this.getCachedChannel(t),s=nt(c=>o.call(e,n,c)),a=i.onCancellationRequested(()=>s.cancel()),l=J(()=>s.cancel());return this.activeRequests.add(l),s.finally(()=>{a.dispose(),this.activeRequests.delete(l),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}),s}requestEvent(t,e,n){if(!this.disposeDelayer)return O.None;this.disposeDelayer.cancel();let i,o=new P({onWillAddFirstListener:()=>{i=this.getCachedChannel(t).listen(e,n)(o.fire,o),this.activeRequests.add(i)},onDidRemoveLastListener:()=>{this.activeRequests.delete(i),i.dispose(),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}});return o.event}get client(){if(!this._client){let t=this.options&&this.options.args?this.options.args:[],e=Object.create(null);e.env={...Ht(process.env),VSCODE_PARENT_PID:String(process.pid)},this.options&&this.options.env&&(e.env={...e.env,...this.options.env}),this.options&&this.options.freshExecArgv&&(e.execArgv=[]),this.options&&typeof this.options.debug=="number"&&(e.execArgv=["--nolazy","--inspect="+this.options.debug]),this.options&&typeof this.options.debugBrk=="number"&&(e.execArgv=["--nolazy","--inspect-brk="+this.options.debugBrk]),e.execArgv===void 0&&(e.execArgv=process.execArgv.filter(u=>!/^--inspect(-brk)?=/.test(u)).filter(u=>!u.startsWith("--vscode-"))),hx(e.env),this.child=eR(this.modulePath,t,e);let n=new P,o=O.fromNodeEventEmitter(this.child,"message",u=>u)(u=>{if(Jx(u)){Xx(u,`IPC Library: ${this.options.serverName}`);return}n.fire(A.wrap(Buffer.from(u,"base64")))}),s=this.options.useQueue?e1(this.child):this.child,a=u=>this.child&&this.child.connected&&s.send(u.buffer.toString("base64")),l=n.event,c={send:a,onMessage:l};this._client=new ms(c);let d=()=>this.disposeClient();process.once("exit",d),this.child.on("error",u=>console.warn('IPC "'+this.options.serverName+'" errored with '+u)),this.child.on("exit",(u,f)=>{process.removeListener("exit",d),o.dispose(),this.activeRequests.forEach(h=>qt(h)),this.activeRequests.clear(),u!==0&&f!=="SIGTERM"&&console.warn('IPC "'+this.options.serverName+'" crashed with exit code '+u+" and signal "+f),this.disposeDelayer?.cancel(),this.disposeClient(),this._onDidProcessExit.fire({code:u,signal:f})})}return this._client}getCachedChannel(t){let e=this.channels.get(t);return e||(e=this.client.getChannel(t),this.channels.set(t,e)),e}disposeClient(){this._client&&(this.child&&(this.child.kill(),this.child=null),this._client=null,this.channels.clear())}dispose(){this._onDidProcessExit.dispose(),this.disposeDelayer?.cancel(),this.disposeDelayer=void 0,this.disposeClient(),this.activeRequests.clear()}};var ep=class extends Xf{constructor(t,e,n){super(t,e,n),this.init()}createWatcher(t){let e=t.add(new wa(Sn.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_AMD_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return t.add(e.onDidProcessExit(({code:n,signal:i})=>this.onError(`terminated by itself with code ${n}, signal: ${i} (ETERM)`))),Yt.toService(fS(e.getChannel("watcher")))}};import{watchFile as tR,unwatchFile as nR}from"fs";var tp=class extends _{_onDidChangeFile=this._register(new P);onDidChangeFile=this._onDidChangeFile.event;_onDidLogMessage=this._register(new P);onDidLogMessage=this._onDidLogMessage.event;_onDidWatchFail=this._register(new P);onDidWatchFail=this._onDidWatchFail.event;allNonCorrelatedWatchRequests=new Set;allCorrelatedWatchRequests=new Map;suspendedWatchRequests=this._register(new ar);suspendedWatchRequestsWithPolling=new Set;updateWatchersDelayer=this._register(new hn(this.getUpdateWatchersDelay()));suspendedWatchRequestPollingInterval=5007;joinWatch=new wi;constructor(){super(),this._register(this.onDidWatchFail(t=>this.handleDidWatchFail(t)))}handleDidWatchFail(t){this.isCorrelated(t)&&this.suspendWatchRequest(t)}isCorrelated(t){return Yf(t)}async watch(t){this.joinWatch.isSettled||this.joinWatch.complete(),this.joinWatch=new wi;try{this.allCorrelatedWatchRequests.clear(),this.allNonCorrelatedWatchRequests.clear();for(let e of t)this.isCorrelated(e)?this.allCorrelatedWatchRequests.set(e.correlationId,e):this.allNonCorrelatedWatchRequests.add(e);for(let[e]of this.suspendedWatchRequests)this.allCorrelatedWatchRequests.has(e)||(this.suspendedWatchRequests.deleteAndDispose(e),this.suspendedWatchRequestsWithPolling.delete(e));return await this.updateWatchers(!1)}finally{this.joinWatch.complete()}}updateWatchers(t){return this.updateWatchersDelayer.trigger(()=>this.doWatch([...this.allNonCorrelatedWatchRequests,...Array.from(this.allCorrelatedWatchRequests.values()).filter(e=>!this.suspendedWatchRequests.has(e.correlationId))]),t?this.getUpdateWatchersDelay():0)}getUpdateWatchersDelay(){return 800}isSuspended(t){return typeof t.correlationId!="number"?!1:this.suspendedWatchRequestsWithPolling.has(t.correlationId)?"polling":this.suspendedWatchRequests.has(t.correlationId)}async suspendWatchRequest(t){if(this.suspendedWatchRequests.has(t.correlationId))return;let e=new te;this.suspendedWatchRequests.set(t.correlationId,e),await this.joinWatch.p,!e.isDisposed&&(this.monitorSuspendedWatchRequest(t,e),this.updateWatchers(!0))}resumeWatchRequest(t){this.suspendedWatchRequests.deleteAndDispose(t.correlationId),this.suspendedWatchRequestsWithPolling.delete(t.correlationId),this.updateWatchers(!1)}monitorSuspendedWatchRequest(t,e){this.doMonitorWithExistingWatcher(t,e)?(this.trace(`reusing an existing recursive watcher to monitor ${t.path}`),this.suspendedWatchRequestsWithPolling.delete(t.correlationId)):(this.doMonitorWithNodeJS(t,e),this.suspendedWatchRequestsWithPolling.add(t.correlationId))}doMonitorWithExistingWatcher(t,e){let n=this.recursiveWatcher?.subscribe(t.path,(i,o)=>{e.isDisposed||(i?this.monitorSuspendedWatchRequest(t,e):o?.type===1&&this.onMonitoredPathAdded(t))});return n?(e.add(n),!0):!1}doMonitorWithNodeJS(t,e){let n=!1,i=(o,s)=>{if(e.isDisposed)return;let a=this.isPathNotFound(o),l=this.isPathNotFound(s),c=n;n=a,!a&&(l||c)&&this.onMonitoredPathAdded(t)};this.trace(`starting fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{tR(t.path,{persistent:!1,interval:this.suspendedWatchRequestPollingInterval},i)}catch(o){this.warn(`fs.watchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}e.add(J(()=>{this.trace(`stopping fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{nR(t.path,i)}catch(o){this.warn(`fs.unwatchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}}))}onMonitoredPathAdded(t){this.trace(`detected ${t.path} exists again, resuming watcher (correlationId: ${t.correlationId})`);let e={resource:C.file(t.path),type:1,cId:t.correlationId};this._onDidChangeFile.fire([e]),this.traceEvent(e,t),this.resumeWatchRequest(t)}isPathNotFound(t){return t.ctimeMs===0&&t.ino===0}async stop(){this.suspendedWatchRequests.clearAndDisposeAll(),this.suspendedWatchRequestsWithPolling.clear()}traceEvent(t,e){if(this.verboseLogging){let n=` >> normalized ${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`;this.traceWithCorrelation(n,e)}}traceWithCorrelation(t,e){this.verboseLogging&&this.trace(`${t}${typeof e.correlationId=="number"?` <${e.correlationId}> `:""}`)}requestToString(t){return`${t.path} (excludes: ${t.excludes.length>0?t.excludes:"<none>"}, includes: ${t.includes&&t.includes.length>0?JSON.stringify(t.includes):"<all>"}, filter: ${Qx(t.filter)}, correlationId: ${typeof t.correlationId=="number"?t.correlationId:"<none>"})`}verboseLogging=!1;async setVerboseLogging(t){this.verboseLogging=t}};import{watch as rR,promises as iR}from"fs";async function np(r,t){if(Oe)return r;let e=Et(r);if(r===e)return r;let n=(at(r)||r).toLowerCase();try{if(t?.isCancellationRequested)return null;let o=(await ce.readdir(e)).filter(s=>s.toLowerCase()===n);if(o.length===1){let s=await np(e,t);if(s)return W(s,o[0])}else if(o.length>1){let s=o.indexOf(n);if(s>=0){let a=await np(e,t);if(a)return W(a,o[s])}}}catch{}return null}var rp=class r extends _{constructor(e,n,i,o,s,a){super();this.request=e;this.recursiveWatcher=n;this.onDidFilesChange=i;this.onDidWatchFail=o;this.onLogMessage=s;this.verboseLogging=a}static FILE_DELETE_HANDLER_DELAY=100;static FILE_CHANGES_HANDLER_DELAY=75;throttledFileChangesEmitter=this._register(new Hd({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},e=>this.onDidFilesChange(e)));fileChangesAggregator=this._register(new qd(e=>this.handleFileChanges(e),r.FILE_CHANGES_HANDLER_DELAY));excludes=gy(this.request.path,this.request.excludes);includes=this.request.includes?gy(this.request.path,this.request.includes):void 0;filter=Yf(this.request)?this.request.filter:void 0;cts=new It;ready=this.watch();_isReusingRecursiveWatcher=!1;get isReusingRecursiveWatcher(){return this._isReusingRecursiveWatcher}didFail=!1;get failed(){return this.didFail}async watch(){try{let e=await this.normalizePath(this.request);if(this.cts.token.isCancellationRequested)return;let n=await iR.stat(e);if(this.cts.token.isCancellationRequested)return;this._register(await this.doWatch(e,n.isDirectory()))}catch(e){e.code!=="ENOENT"?this.error(e):this.trace(`ignoring a path for watching who's stat info failed to resolve: ${this.request.path} (error: ${e})`),this.notifyWatchFailed()}}notifyWatchFailed(){this.didFail=!0,this.onDidWatchFail?.()}async normalizePath(e){let n=e.path;try{n=await ce.realpath(e.path),e.path===n&&(n=await np(e.path,this.cts.token)??e.path),e.path!==n&&this.trace(`correcting a path to watch that seems to be a symbolic link or wrong casing (original: ${e.path}, real: ${n})`)}catch{}return n}async doWatch(e,n){let i=new te;return this.doWatchWithExistingWatcher(e,n,i)?(this.trace(`reusing an existing recursive watcher for ${this.request.path}`),this._isReusingRecursiveWatcher=!0):(this._isReusingRecursiveWatcher=!1,await this.doWatchWithNodeJS(e,n,i)),i}doWatchWithExistingWatcher(e,n,i){if(n)return!1;let o=C.file(this.request.path),s=this.recursiveWatcher?.subscribe(this.request.path,async(a,l)=>{if(!i.isDisposed)if(a){let c=await this.doWatch(e,n);i.isDisposed?c.dispose():i.add(c)}else l&&(typeof l.cId=="number"||typeof this.request.correlationId=="number")&&this.onFileChange({resource:o,type:l.type,cId:this.request.correlationId},!0)});return s?(i.add(s),!0):!1}async doWatchWithNodeJS(e,n,i){if(_t&&Gr(e,"/Volumes/",!0)){this.error(`Refusing to watch ${e} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}let o=new It(this.cts.token);i.add(J(()=>o.dispose(!0)));let s=new te;i.add(s);try{let a=C.file(this.request.path),l=at(e),c=rR(e);s.add(J(()=>{c.removeAllListeners(),c.close()})),this.trace(`Started watching: '${e}'`);let d=new Set;if(n)try{for(let f of await ce.readdir(e))d.add(f)}catch(f){this.error(f)}if(o.token.isCancellationRequested)return;let u=new Map;s.add(J(()=>{for(let[,f]of u)f.dispose();u.clear()})),c.on("error",(f,h)=>{o.token.isCancellationRequested||(this.error(`Failed to watch ${e} for changes using fs.watch() (${f}, ${h})`),this.notifyWatchFailed())}),c.on("change",(f,h)=>{if(o.token.isCancellationRequested)return;this.verboseLogging&&this.traceWithCorrelation(`[raw] ["${f}"] ${h}`);let v="";if(h&&(v=h.toString(),_t&&(v=Kl(v))),!(!v||f!=="change"&&f!=="rename"))if(n)if(f==="rename"){u.get(v)?.dispose();let y=setTimeout(async()=>{if(u.delete(v),v===l&&!await ce.exists(e)){this.onWatchedPathDeleted(a);return}if(o.token.isCancellationRequested)return;let I=await this.existsChildStrictCase(W(e,v));if(o.token.isCancellationRequested)return;let x;I?d.has(v)?x=0:(x=1,d.add(v)):(d.delete(v),x=2),this.onFileChange({resource:V(a,v),type:x,cId:this.request.correlationId})},r.FILE_DELETE_HANDLER_DELAY);u.set(v,J(()=>clearTimeout(y)))}else{let y;d.has(v)?y=0:(y=1,d.add(v)),this.onFileChange({resource:V(a,v),type:y,cId:this.request.correlationId})}else if(f==="rename"||v!==l){let y=setTimeout(async()=>{let I=await ce.exists(e);o.token.isCancellationRequested||(I?(this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0),s.add(await this.doWatch(e,!1))):this.onWatchedPathDeleted(a))},r.FILE_DELETE_HANDLER_DELAY);s.clear(),s.add(J(()=>clearTimeout(y)))}else this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0)})}catch(a){o.token.isCancellationRequested||this.error(`Failed to watch ${e} for changes using fs.watch() (${a.toString()})`),this.notifyWatchFailed()}}onWatchedPathDeleted(e){this.warn("Watcher shutdown because watched path got deleted"),this.onFileChange({resource:e,type:2,cId:this.request.correlationId},!0),this.fileChangesAggregator.flush(),this.notifyWatchFailed()}onFileChange(e,n=!1){this.cts.token.isCancellationRequested||(this.verboseLogging&&this.traceWithCorrelation(`${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`),!n&&this.excludes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (excluded) ${e.resource.fsPath}`):!n&&this.includes&&this.includes.length>0&&!this.includes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (not included) ${e.resource.fsPath}`):this.fileChangesAggregator.work(e))}handleFileChanges(e){let n=jx(e),i=[];for(let s of n){if(Gx(s,this.filter)){this.verboseLogging&&this.traceWithCorrelation(` >> ignored (filtered) ${s.resource.fsPath}`);continue}i.push(s)}if(i.length===0)return;if(this.verboseLogging)for(let s of i)this.traceWithCorrelation(` >> normalized ${s.type===1?"[ADDED]":s.type===2?"[DELETED]":"[CHANGED]"} ${s.resource.fsPath}`);this.throttledFileChangesEmitter.work(i)?this.throttledFileChangesEmitter.pending>0&&this.trace(`started throttling events due to large amount of file change events at once (pending: ${this.throttledFileChangesEmitter.pending}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.warn(`started ignoring events due to too many file change events at once (incoming: ${i.length}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async existsChildStrictCase(e){if(Oe)return ce.exists(e);try{let n=at(e);return(await ce.readdir(Et(e))).some(o=>o===n)}catch(n){return this.trace(n),!1}}setVerboseLogging(e){this.verboseLogging=e}error(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"error",message:`[File Watcher (node.js)] ${e}`})}warn(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"warn",message:`[File Watcher (node.js)] ${e}`})}trace(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.onLogMessage?.({type:"trace",message:`[File Watcher (node.js)] ${e}`})}traceWithCorrelation(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.trace(`${e}${typeof this.request.correlationId=="number"?` <${this.request.correlationId}> `:""}`)}dispose(){this.cts.dispose(!0),super.dispose()}};var ip=class extends tp{constructor(e){super();this.recursiveWatcher=e}onDidError=O.None;watchers=new Set;async doWatch(e){e=this.removeDuplicateRequests(e);let n=[],i=new Set(Array.from(this.watchers));for(let o of e){let s=this.findWatcher(o);s&&Zg(s.request.excludes,o.excludes)&&Zg(s.request.includes,o.includes)?i.delete(s):n.push(o)}n.length&&this.trace(`Request to start watching: ${n.map(o=>this.requestToString(o)).join(",")}`),i.size&&this.trace(`Request to stop watching: ${Array.from(i).map(o=>this.requestToString(o.request)).join(",")}`);for(let o of i)this.stopWatching(o);for(let o of n)this.startWatching(o)}findWatcher(e){for(let n of this.watchers)if(typeof e.correlationId=="number"||typeof n.request.correlationId=="number"){if(n.request.correlationId===e.correlationId)return n}else if(Al(n.request.path,e.path,!Oe))return n}startWatching(e){let n=new rp(e,this.recursiveWatcher,o=>this._onDidChangeFile.fire(o),()=>this._onDidWatchFail.fire(e),o=>this._onDidLogMessage.fire(o),this.verboseLogging),i={request:e,instance:n};this.watchers.add(i)}async stop(){await super.stop();for(let e of this.watchers)this.stopWatching(e)}stopWatching(e){this.trace("stopping file watcher",e),this.watchers.delete(e),e.instance.dispose()}removeDuplicateRequests(e){let n=new Map;for(let i of e){let o=Oe?i.path:i.path.toLowerCase(),s=n.get(i.correlationId);s||(s=new Map,n.set(i.correlationId,s)),s.has(o)&&this.trace(`ignoring a request for watching who's path is already watched: ${this.requestToString(i)}`),s.set(o,i)}return Array.from(n.values()).map(i=>Array.from(i.values())).flat()}async setVerboseLogging(e){super.setVerboseLogging(e);for(let n of this.watchers)n.instance.setVerboseLogging(e)}trace(e,n){this.verboseLogging&&this._onDidLogMessage.fire({type:"trace",message:this.toMessage(e,n)})}warn(e){this._onDidLogMessage.fire({type:"warn",message:this.toMessage(e)})}toMessage(e,n){return n?`[File Watcher (node.js)] ${e} (${this.requestToString(n.request)})`:`[File Watcher (node.js)] ${e}`}};var op=class extends Jf{constructor(t,e,n){super(t,e,n),this.init()}createWatcher(t){return t.add(new ip(void 0))}};var sp=class r extends Zf{static TRACE_LOG_RESOURCE_LOCKS=!1;constructor(t,e){super(t,e)}onDidChangeCapabilities=O.None;_capabilities;get capabilities(){return this._capabilities||(this._capabilities=253982,Oe&&(this._capabilities|=1024)),this._capabilities}async stat(t){try{let{stat:e,symbolicLink:n}=await gn.stat(this.toFilePath(t));return{type:this.toType(e,n),ctime:e.birthtime.getTime(),mtime:e.mtime.getTime(),size:e.size,permissions:e.mode&128?void 0:2}}catch(e){throw this.toFileSystemProviderError(e)}}async statIgnoreError(t){try{return await this.stat(t)}catch{return}}async readdir(t){try{let e=await ce.readdir(this.toFilePath(t),{withFileTypes:!0}),n=[];return await Promise.all(e.map(async i=>{try{let o;i.isSymbolicLink()?o=(await this.stat(V(t,i.name))).type:o=this.toType(i),n.push([i.name,o])}catch(o){this.logService.trace(o)}})),n}catch(e){throw this.toFileSystemProviderError(e)}}toType(t,e){let n;return e?.dangling?n=0:t.isFile()?n=1:t.isDirectory()?n=2:n=0,e&&(n|=64),n}resourceLocks=new Ye(t=>So.getComparisonKey(t));async createResourceLock(t){let e=this.toFilePath(t);this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${e})`);let n;for(;n=this.resourceLocks.get(t);)this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${e})`),await n.wait();let i=new Ei;return this.resourceLocks.set(t,i),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${e})`),J(()=>{this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${e})`),this.resourceLocks.get(t)===i&&(this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${e})`),this.resourceLocks.delete(t)),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${e})`),i.open()})}async readFile(t,e){let n;try{e?.atomic&&(this.traceLock(`[Disk FileSystemProvider]: atomic read operation started (${this.toFilePath(t)})`),n=await this.createResourceLock(t));let i=this.toFilePath(t);return await Hi.readFile(i)}catch(i){throw this.toFileSystemProviderError(i)}finally{n?.dispose()}}traceLock(t){r.TRACE_LOG_RESOURCE_LOCKS&&this.logService.trace(t)}readFileStream(t,e,n){let i=Qr(o=>A.concat(o.map(s=>A.wrap(s))).buffer);return jf(this,t,i,o=>o.buffer,{...e,bufferSize:256*1024},n),i}async writeFile(t,e,n){return n?.atomic!==!1&&n?.atomic?.postfix&&await this.canWriteFileAtomic(t)?this.doWriteFileAtomic(t,V(Kd(t),`${_r(t)}${n.atomic.postfix}`),e,n):this.doWriteFile(t,e,n)}async canWriteFileAtomic(t){try{let e=this.toFilePath(t),{symbolicLink:n}=await gn.stat(e);if(n)return!1}catch{}return!0}async doWriteFileAtomic(t,e,n,i){let o=new te;try{o.add(await this.createResourceLock(t)),o.add(await this.createResourceLock(e)),await this.doWriteFile(e,n,i,!0);try{await this.rename(e,t,{overwrite:!0})}catch(s){try{await this.delete(e,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw s}}finally{o.dispose()}}async doWriteFile(t,e,n,i){let o;try{let s=this.toFilePath(t);if(!n.create||!n.overwrite){if(await ce.exists(s)){if(!n.overwrite)throw Mn(g("fileExists","File already exists"),"EntryExists")}else if(!n.create)throw Mn(g("fileNotExists","File does not exist"),"EntryNotFound")}o=await this.open(t,{create:!0,unlock:n.unlock},i),await this.write(o,0,e,0,e.byteLength)}catch(s){throw await this.toFileSystemProviderWriteError(t,s)}finally{typeof o=="number"&&await this.close(o)}}mapHandleToPos=new Map;mapHandleToLock=new Map;writeHandles=new Map;static canFlush=!0;static configureFlushOnWrite(t){r.canFlush=t}async open(t,e,n){let i=this.toFilePath(t),o;_s(e)&&!n&&(o=await this.createResourceLock(t));let s;try{if(_s(e)&&e.unlock)try{let{stat:l}=await gn.stat(i);l.mode&128||await Hi.chmod(i,l.mode|128)}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}let a;if(_s(e)){if(be)try{await Hi.truncate(i,0),a="r+"}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}a||(a="w")}else a="r";s=await ce.open(i,a)}catch(a){throw o?.dispose(),_s(e)?await this.toFileSystemProviderWriteError(t,a):this.toFileSystemProviderError(a)}if(this.mapHandleToPos.set(s,0),_s(e)&&this.writeHandles.set(s,t),o){let a=this.mapHandleToLock.get(s);this.traceLock(`[Disk FileSystemProvider]: open() - storing lock for handle ${s} (${i})`),this.mapHandleToLock.set(s,o),a&&(this.traceLock(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${s} (${i})`),a.dispose())}return s}async close(t){let e=this.mapHandleToLock.get(t);try{if(this.mapHandleToPos.delete(t),this.writeHandles.delete(t)&&r.canFlush)try{await ce.fdatasync(t)}catch(n){r.configureFlushOnWrite(!1),this.logService.error(n)}return await ce.close(t)}catch(n){throw this.toFileSystemProviderError(n)}finally{e&&(this.mapHandleToLock.get(t)===e&&(this.traceLock(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${t}`),this.mapHandleToLock.delete(t)),this.traceLock(`[Disk FileSystemProvider]: close() - disposing lock for handle ${t}`),e.dispose())}}async read(t,e,n,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await ce.read(t,n,i,o,s)).bytesRead}catch(l){throw this.toFileSystemProviderError(l)}finally{this.updatePos(t,s,a)}return a}normalizePos(t,e){return e===this.mapHandleToPos.get(t)?null:e}updatePos(t,e,n){let i=this.mapHandleToPos.get(t);typeof i=="number"&&(typeof e=="number"||(typeof n=="number"?this.mapHandleToPos.set(t,i+n):this.mapHandleToPos.delete(t)))}async write(t,e,n,i,o){return YI(()=>this.doWrite(t,e,n,i,o),100,3)}async doWrite(t,e,n,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await ce.write(t,n,i,o,s)).bytesWritten}catch(l){throw await this.toFileSystemProviderWriteError(this.writeHandles.get(t),l)}finally{this.updatePos(t,s,a)}return a}async mkdir(t){try{await Hi.mkdir(this.toFilePath(t))}catch(e){throw this.toFileSystemProviderError(e)}}async delete(t,e){try{let n=this.toFilePath(t);if(e.recursive){let i;e?.atomic!==!1&&e.atomic.postfix&&(i=W(Et(n),`${at(n)}${e.atomic.postfix}`)),await ce.rm(n,1,i)}else try{await Hi.unlink(n)}catch(i){if(i.code==="EPERM"||i.code==="EISDIR"){let o=!1;try{let{stat:s,symbolicLink:a}=await gn.stat(n);o=s.isDirectory()&&!a}catch{}if(o)await Hi.rmdir(n);else throw i}else throw i}}catch(n){throw this.toFileSystemProviderError(n)}}async rename(t,e,n){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"move",n.overwrite),await ce.rename(i,o)}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(g("moveError","Unable to move '{0}' into '{1}' ({2}).",at(i),at(Et(o)),s.toString()))),this.toFileSystemProviderError(s)}}async copy(t,e,n){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"copy",n.overwrite),await ce.copy(i,o,{preserveSymlinks:!0})}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(g("copyError","Unable to copy '{0}' into '{1}' ({2}).",at(i),at(Et(o)),s.toString()))),this.toFileSystemProviderError(s)}}async validateMoveCopy(t,e,n,i){let o=this.toFilePath(t),s=this.toFilePath(e),a=!1;if(!!(this.capabilities&1024)||(a=Al(o,s,!0)),a){if(n==="copy")throw Mn(g("fileCopyErrorPathCase","File cannot be copied to same path with different path case"),"EntryExists");if(n==="move")return}let c=await this.statIgnoreError(t);if(!c)throw Mn(g("fileMoveCopyErrorNotFound","File to move/copy does not exist"),"EntryNotFound");let d=await this.statIgnoreError(e);if(d){if(!i)throw Mn(g("fileMoveCopyErrorExists","File at target already exists and thus will not be moved/copied to unless overwrite is specified"),"EntryExists");c.type&1&&d.type&1||await this.delete(e,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(t,e){return this.doCloneFile(t,e,!1)}async doCloneFile(t,e,n){let i=this.toFilePath(t),o=this.toFilePath(e),s=!!(this.capabilities&1024);if(Al(i,o,!s))return;let a=new te;try{a.add(await this.createResourceLock(t)),a.add(await this.createResourceLock(e)),n&&await Hi.mkdir(Et(o),{recursive:!0}),await Hi.copyFile(i,o)}catch(l){if(l.code==="ENOENT"&&!n)return this.doCloneFile(t,e,!0);throw this.toFileSystemProviderError(l)}finally{a.dispose()}}createUniversalWatcher(t,e,n){return new ep(i=>t(i),i=>e(i),n)}createNonRecursiveWatcher(t,e,n){return new op(i=>t(i),i=>e(i),n)}toFileSystemProviderError(t){if(t instanceof Rs)return t;let e=t,n;switch(t.code){case"ENOENT":n="EntryNotFound";break;case"EISDIR":n="EntryIsADirectory";break;case"ENOTDIR":n="EntryNotADirectory";break;case"EEXIST":n="EntryExists";break;case"EPERM":case"EACCES":n="NoPermissions";break;case"ERR_UNC_HOST_NOT_ALLOWED":e=`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,n="Unknown";break;default:n="Unknown"}return Mn(e,n)}async toFileSystemProviderWriteError(t,e){let n=this.toFileSystemProviderError(e);if(t&&n.code==="NoPermissions")try{let{stat:i}=await gn.stat(this.toFilePath(t));i.mode&128||(n=Mn(e,"EntryWriteLocked"))}catch(i){this.logService.trace(i)}return n}};var my=class{constructor(t,e){this.key=t;this.data=e}incoming=new Map;outgoing=new Map},Uc=class{constructor(t){this._hashFn=t}_nodes=new Map;roots(){let t=[];for(let e of this._nodes.values())e.outgoing.size===0&&t.push(e);return t}insertEdge(t,e){let n=this.lookupOrInsertNode(t),i=this.lookupOrInsertNode(e);n.outgoing.set(i.key,i),i.incoming.set(n.key,n)}removeNode(t){let e=this._hashFn(t);this._nodes.delete(e);for(let n of this._nodes.values())n.outgoing.delete(e),n.incoming.delete(e)}lookupOrInsertNode(t){let e=this._hashFn(t),n=this._nodes.get(e);return n||(n=new my(e,t),this._nodes.set(e,n)),n}lookup(t){return this._nodes.get(this._hashFn(t))}isEmpty(){return this._nodes.size===0}toString(){let t=[];for(let[e,n]of this._nodes)t.push(`${e}
	(-> incoming)[${[...n.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...n.outgoing.keys()].join(",")}]
`);return t.join(`
`)}findCycleSlow(){for(let[t,e]of this._nodes){let n=new Set([t]),i=this._findCycle(e,n);if(i)return i}}_findCycle(t,e){for(let[n,i]of t.outgoing){if(e.has(n))return[...e,n].join(" -> ");e.add(n);let o=this._findCycle(i,e);if(o)return o;e.delete(n)}}};var oR=!1,ap=class extends Error{constructor(t){super("cyclic dependency between services"),this.message=t.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${t.toString()}`}},lp=class r{constructor(t=new Di,e=!1,n,i=oR){this._services=t;this._strict=e;this._parent=n;this._enableTracing=i;this._services.set(Ot,this),this._globalGraph=i?n?._globalGraph??new Uc(o=>o):void 0}_globalGraph;_globalGraphImplicitDependency;_isDisposed=!1;_servicesToMaybeDispose=new Set;_children=new Set;dispose(){if(!this._isDisposed){this._isDisposed=!0,qt(this._children),this._children.clear();for(let t of this._servicesToMaybeDispose)wd(t)&&t.dispose();this._servicesToMaybeDispose.clear()}}_throwIfDisposed(){if(this._isDisposed)throw new Error("InstantiationService has been disposed")}createChild(t,e){this._throwIfDisposed();let n=this,i=new class extends r{dispose(){n._children.delete(i),super.dispose()}}(t,this._strict,this,this._enableTracing);return this._children.add(i),e?.add(i),i}invokeFunction(t,...e){this._throwIfDisposed();let n=Lc.traceInvocation(this._enableTracing,t),i=!1;try{return t({get:s=>{if(i)throw ad("service accessor is only valid during the invocation of its target method");let a=this._getOrCreateServiceInstance(s,n);if(!a)throw new Error(`[invokeFunction] unknown service '${s}'`);return a}},...e)}finally{i=!0,n.stop()}}createInstance(t,...e){this._throwIfDisposed();let n,i;return t instanceof Ce?(n=Lc.traceCreation(this._enableTracing,t.ctor),i=this._createInstance(t.ctor,t.staticArguments.concat(e),n)):(n=Lc.traceCreation(this._enableTracing,t),i=this._createInstance(t,e,n)),n.stop(),i}_createInstance(t,e=[],n){let i=hr.getServiceDependencies(t).sort((a,l)=>a.index-l.index),o=[];for(let a of i){let l=this._getOrCreateServiceInstance(a.id,n);l||this._throwIfStrict(`[createInstance] ${t.name} depends on UNKNOWN service ${a.id}.`,!1),o.push(l)}let s=i.length>0?i[0].index:e.length;if(e.length!==s){console.trace(`[createInstance] First service dependency of ${t.name} at position ${s+1} conflicts with ${e.length} static arguments`);let a=s-e.length;a>0?e=e.concat(new Array(a)):e=e.slice(0,s)}return Reflect.construct(t,e.concat(o))}_setCreatedServiceInstance(t,e){if(this._services.get(t)instanceof Ce)this._services.set(t,e);else if(this._parent)this._parent._setCreatedServiceInstance(t,e);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(t){let e=this._services.get(t);return!e&&this._parent?this._parent._getServiceInstanceOrDescriptor(t):e}_getOrCreateServiceInstance(t,e){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(t));let n=this._getServiceInstanceOrDescriptor(t);return n instanceof Ce?this._safeCreateAndCacheServiceInstance(t,n,e.branch(t,!0)):(e.branch(t,!1),n)}_activeInstantiations=new Set;_safeCreateAndCacheServiceInstance(t,e,n){if(this._activeInstantiations.has(t))throw new Error(`illegal state - RECURSIVELY instantiating service '${t}'`);this._activeInstantiations.add(t);try{return this._createAndCacheServiceInstance(t,e,n)}finally{this._activeInstantiations.delete(t)}}_createAndCacheServiceInstance(t,e,n){let i=new Uc(l=>l.id.toString()),o=0,s=[{id:t,desc:e,_trace:n}],a=new Set;for(;s.length;){let l=s.pop();if(!a.has(String(l.id))){if(a.add(String(l.id)),i.lookupOrInsertNode(l),o++>1e3)throw new ap(i);for(let c of hr.getServiceDependencies(l.desc.ctor)){let d=this._getServiceInstanceOrDescriptor(c.id);if(d||this._throwIfStrict(`[createInstance] ${t} depends on ${c.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(l.id),String(c.id)),d instanceof Ce){let u={id:c.id,desc:d,_trace:l._trace.branch(c.id,!0)};i.insertEdge(l,u),s.push(u)}}}}for(;;){let l=i.roots();if(l.length===0){if(!i.isEmpty())throw new ap(i);break}for(let{data:c}of l){if(this._getServiceInstanceOrDescriptor(c.id)instanceof Ce){let u=this._createServiceInstanceWithOwner(c.id,c.desc.ctor,c.desc.staticArguments,c.desc.supportsDelayedInstantiation,c._trace);this._setCreatedServiceInstance(c.id,u)}i.removeNode(c)}}return this._getServiceInstanceOrDescriptor(t)}_createServiceInstanceWithOwner(t,e,n=[],i,o){if(this._services.get(t)instanceof Ce)return this._createServiceInstance(t,e,n,i,o,this._servicesToMaybeDispose);if(this._parent)return this._parent._createServiceInstanceWithOwner(t,e,n,i,o);throw new Error(`illegalState - creating UNKNOWN service instance ${e.name}`)}_createServiceInstance(t,e,n=[],i,o,s){if(i){let a=new r(void 0,this._strict,this,this._enableTracing);a._globalGraphImplicitDependency=String(t);let l=new Map,c=new jd(()=>{let d=a._createInstance(e,n,o);for(let[u,f]of l){let h=d[u];if(typeof h=="function")for(let v of f)v.disposable=h.apply(d,v.listener)}return l.clear(),s.add(d),d});return new Proxy(Object.create(null),{get(d,u){if(!c.isInitialized&&typeof u=="string"&&(u.startsWith("onDid")||u.startsWith("onWill"))){let v=l.get(u);return v||(v=new yi,l.set(u,v)),(I,x,T)=>{if(c.isInitialized)return c.value[u](I,x,T);{let R={listener:[I,x,T],disposable:void 0},w=v.push(R);return J(()=>{w(),R.disposable?.dispose()})}}}if(u in d)return d[u];let f=c.value,h=f[u];return typeof h!="function"||(h=h.bind(f),d[u]=h),h},set(d,u,f){return c.value[u]=f,!0},getPrototypeOf(d){return e.prototype}})}else{let a=this._createInstance(e,n,o);return s.add(a),a}}_throwIfStrict(t,e){if(e&&console.warn(t),this._strict)throw new Error(t)}};var Lc=class r{constructor(t,e){this.type=t;this.name=e}static all=new Set;static _None=new class extends r{constructor(){super(0,null)}stop(){}branch(){return this}};static traceInvocation(t,e){return t?new r(2,e.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):r._None}static traceCreation(t,e){return t?new r(1,e.name):r._None}static _totals=0;_start=Date.now();_dep=[];branch(t,e){let n=new r(3,t.toString());return this._dep.push([t,e,n]),n}stop(){let t=Date.now()-this._start;r._totals+=t;let e=!1;function n(o,s){let a=[],l=new Array(o+1).join("	");for(let[c,d,u]of s._dep)if(d&&u){e=!0,a.push(`${l}CREATES -> ${c}`);let f=n(o+1,u);f&&a.push(f)}else a.push(`${l}uses -> ${c}`);return a.join(`
`)}let i=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${n(1,this)}`,`DONE, took ${t.toFixed(2)}ms (grand total ${r._totals.toFixed(2)}ms)`];(t>2||e)&&r.all.add(i.join(`
`))}};var cp=class extends hu{constructor(e,n,i,o,s){super(n,i,o);this.windowId=e;this.channel=s;this._register(s.listen("onDidChangeLogLevel",e)(a=>{LS(a)?super.setLogLevel(a):super.setLogLevel(C.revive(a[0]),a[1])})),this._register(s.listen("onDidChangeVisibility",e)(([a,l])=>super.setVisibility(C.revive(a),l))),this._register(s.listen("onDidChangeLoggers",e)(({added:a,removed:l})=>{for(let c of a)super.registerLogger({...c,resource:C.revive(c.resource)});for(let c of l)super.deregisterLogger(c.resource)}))}createConsoleMainLogger(){return new fu({log:(e,n)=>{this.channel.call("consoleLog",[e,n])}})}registerLogger(e){super.registerLogger(e),this.channel.call("registerLogger",[e,this.windowId])}deregisterLogger(e){super.deregisterLogger(e),this.channel.call("deregisterLogger",[e,this.windowId])}setLogLevel(e,n){super.setLogLevel(e,n),this.channel.call("setLogLevel",[e,n])}setVisibility(e,n){super.setVisibility(e,n),this.channel.call("setVisibility",[this.toResource(e),n])}doCreateLogger(e,n,i){return new yy(this.channel,e,n,i,this.windowId)}static setLogLevel(e,n,i){return e.call("setLogLevel",[n,i])}},yy=class extends du{constructor(e,n,i,o,s){super(o?.logLevel==="always");this.channel=e;this.file=n;this.setLevel(i),this.channel.call("createLogger",[n,o,s]).then(()=>{this.doLog(this.buffer),this.isLoggerCreated=!0})}isLoggerCreated=!1;buffer=[];log(e,n){let i=[[e,n]];this.isLoggerCreated?this.doLog(i):this.buffer.push(...i)}doLog(e){this.channel.call("log",[this.file,e])}};var En,vy=globalThis.vscode;if(typeof vy<"u"&&typeof vy.context<"u"){let r=vy.context.configuration();if(r)En=r.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(En=globalThis._VSCODE_PRODUCT_JSON,Me.VSCODE_DEV&&Object.assign(En,{nameShort:`${En.nameShort} Dev`,nameLong:`${En.nameLong} Dev`,dataFolderName:`${En.dataFolderName}-dev`,serverDataFolderName:En.serverDataFolderName?`${En.serverDataFolderName}-dev`:void 0}),!En.version){let r=globalThis._VSCODE_PACKAGE_JSON;Object.assign(En,{version:r.version})}}else En={},Object.keys(En).length===0&&Object.assign(En,{version:"1.94.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var Nr=En;var dp=class{constructor(t){this.appenders=t}listen(t,e){throw new Error(`Event not found: ${e}`)}call(t,e,{eventName:n,data:i}){return this.appenders.forEach(o=>o.log(n,i)),Promise.resolve(null)}},up=class{constructor(t){this.channel=t}log(t,e){return this.channel.call("log",{eventName:t,data:e}).then(void 0,n=>`Failed to log telemetry: ${console.warn(n)}`),Promise.resolve(null)}flush(){return Promise.resolve()}};var ji=class extends _{constructor(e,n,i,o,s=""){super();this.prefix=s;let a=n.getLogger(Bu);if(a)this.logger=this._register(a);else{let c=Wu(o,i)?" (Not Sent)":"",d=()=>Fs(o,i)&&e.getLevel()===1;this.logger=this._register(n.createLogger(Bu,{name:g("telemetryLog","Telemetry{0}",c),hidden:!d()})),this._register(e.onDidChangeLogLevel(()=>n.setVisibility(Bu,d()))),this.logger.info("Below are logs for every telemetry event sent from VS Code once the log level is set to trace."),this.logger.info("===========================================================")}}logger;flush(){return Promise.resolve(void 0)}log(e,n){this.logger.trace(`${this.prefix}telemetry/${e}`,Ku(n))}};ji=E([m(0,z),m(1,Lr),m(2,oe),m(3,de)],ji);var Gi=class{constructor(t,e,n){this._configurationService=e;this._productService=n;this._appenders=t.appenders,this._commonProperties=t.commonProperties??Object.create(null),this.sessionId=this._commonProperties.sessionID,this.machineId=this._commonProperties["common.machineId"],this.sqmId=this._commonProperties["common.sqmId"],this.devDeviceId=this._commonProperties["common.devDeviceId"],this.firstSessionDate=this._commonProperties["common.firstSessionDate"],this.msftInternal=this._commonProperties["common.msftInternal"],this._piiPaths=t.piiPaths||[],this._telemetryLevel=3,this._sendErrorTelemetry=!!t.sendErrorTelemetry,this._cleanupPatterns=[/(vscode-)?file:\/\/\/.*?\/resources\/app\//gi];for(let i of this._piiPaths)this._cleanupPatterns.push(new RegExp(ur(i),"gi")),i.indexOf("\\")>=0&&this._cleanupPatterns.push(new RegExp(ur(i.replace(/\\/g,"/")),"gi"));this._updateTelemetryLevel(),this._disposables.add(this._configurationService.onDidChangeConfiguration(i=>{(i.affectsConfiguration(Us)||i.affectsConfiguration(uc)||i.affectsConfiguration(Nu))&&this._updateTelemetryLevel()}))}static IDLE_START_EVENT_NAME="UserIdleStart";static IDLE_STOP_EVENT_NAME="UserIdleStop";sessionId;machineId;sqmId;devDeviceId;firstSessionDate;msftInternal;_appenders;_commonProperties;_experimentProperties={};_piiPaths;_telemetryLevel;_sendErrorTelemetry;_disposables=new te;_cleanupPatterns=[];setExperimentProperty(t,e){this._experimentProperties[t]=e}_updateTelemetryLevel(){let t=Vu(this._configurationService),e=this._productService.enabledTelemetryLevels;if(e){this._sendErrorTelemetry=this.sendErrorTelemetry?e.error:!1;let n=e.usage?3:e.error?2:0;t=Math.min(t,n)}this._telemetryLevel=t}get sendErrorTelemetry(){return this._sendErrorTelemetry}get telemetryLevel(){return this._telemetryLevel}dispose(){this._disposables.dispose()}_log(t,e,n){this._telemetryLevel<e||(n=ks(n,this._experimentProperties),n=Cb(n,this._cleanupPatterns),n=ks(n,this._commonProperties),this._appenders.forEach(i=>i.log(t,n)))}publicLog(t,e){this._log(t,3,e)}publicLog2(t,e){this.publicLog(t,e)}publicLogError(t,e){this._sendErrorTelemetry&&this._log(t,2,e)}publicLogError2(t,e){this.publicLogError(t,e)}};Gi=E([m(1,ue),m(2,de)],Gi);function sR(){let r=g("telemetry.telemetryLevelMd","Controls {0} telemetry, first-party extension telemetry, and participating third-party extension telemetry. Some third party extensions might not respect this setting. Consult the specific extension's documentation to be sure. Telemetry helps us better understand how {0} is performing, where improvements need to be made, and how features are being used.",Nr.nameLong),t=Nr.privacyStatementUrl?g("telemetry.docsAndPrivacyStatement","Read more about the [data we collect]({0}) and our [privacy statement]({1}).","https://aka.ms/vscode-telemetry",Nr.privacyStatementUrl):g("telemetry.docsStatement","Read more about the [data we collect]({0}).","https://aka.ms/vscode-telemetry"),e=qe?"":g("telemetry.restart","A full restart of the application is necessary for crash reporting changes to take effect."),n=g("telemetry.crashReports","Crash Reports"),i=g("telemetry.errors","Error Telemetry"),o=g("telemetry.usage","Usage Data"),s=g("telemetry.telemetryLevel.tableDescription","The following table outlines the data sent with each setting:"),a=`
|       | ${n} | ${i} | ${o} |
|:------|:---------------------:|:---------------:|:--------------:|
| all   |            \u2713          |        \u2713        |        \u2713       |
| error |            \u2713          |        \u2713        |        -       |
| crash |            \u2713          |        -        |        -       |
| off   |            -          |        -        |        -       |
`,l=g("telemetry.telemetryLevel.deprecated","****Note:*** If this setting is 'off', no telemetry will be sent regardless of other telemetry settings. If this setting is set to anything except 'off' and telemetry is disabled with deprecated settings, no telemetry will be sent.*");return`
${r} ${t} ${e}

&nbsp;

${s}
${a}

&nbsp;

${l}
`}Ne.as(Wt.Configuration).registerConfiguration({id:cm,order:1,type:"object",title:g("telemetryConfigurationTitle","Telemetry"),properties:{[Us]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[g("telemetry.telemetryLevel.default","Sends usage data, errors, and crash reports."),g("telemetry.telemetryLevel.error","Sends general error telemetry and crash reports."),g("telemetry.telemetryLevel.crash","Sends OS level crash reports."),g("telemetry.telemetryLevel.off","Disables all product telemetry.")],markdownDescription:sR(),default:"all",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"]}}});Ne.as(Wt.Configuration).registerConfiguration({id:cm,order:110,type:"object",title:g("telemetryConfigurationTitle","Telemetry"),properties:{[uc]:{type:"boolean",markdownDescription:Nr.privacyStatementUrl?g("telemetry.enableTelemetryMd","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made. [Read more]({1}) about what we collect and our privacy statement.",Nr.nameLong,Nr.privacyStatementUrl):g("telemetry.enableTelemetry","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made.",Nr.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:g("enableTelemetryDeprecated","If this setting is false, no telemetry will be sent regardless of the new setting's value. Deprecated in favor of the {0} setting.",`\`#${Us}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}});var Pa=class{constructor(t,e,n,i,o,s){this.configurationService=t;this.telemetryService=e;this.logService=n;this.loggerService=i;this.environmentService=o;this.productService=s}customTelemetryServices=new Map;getCustomTelemetryService(t){if(!this.customTelemetryServices.has(t.id)){let e=Object.create(null);e["common.vscodemachineid"]=this.telemetryService.machineId,e["common.vscodesessionid"]=this.telemetryService.sessionId;let n=[t.id,JSON.stringify(e),t.aiKey],o=new wa(Sn.asFileUri("bootstrap-fork").fsPath,{serverName:"Debug Telemetry",timeout:1e3*60*5,args:n,env:{ELECTRON_RUN_AS_NODE:1,VSCODE_PIPE_LOGGING:"true",VSCODE_AMD_ENTRYPOINT:"vs/workbench/contrib/debug/node/telemetryApp"}}).getChannel("telemetryAppender"),s=[new up(o),new ji(this.logService,this.loggerService,this.environmentService,this.productService,`[${t.id}] `)];this.customTelemetryServices.set(t.id,new Gi({appenders:s,sendErrorTelemetry:t.sendErrorTelemetry},this.configurationService,this.productService))}return this.customTelemetryServices.get(t.id)}publicLog(t,e,n){this.getCustomTelemetryService(t).publicLog(e,n)}publicLogError(t,e,n){this.getCustomTelemetryService(t).publicLogError(e,n)}};Pa=E([m(0,ue),m(1,le),m(2,z),m(3,Lr),m(4,oe),m(5,de)],Pa);var Ta=M("IExtensionStorageService"),aR=/^extensionKeys\/([^.]+\..+)@(\d+\.\d+\.\d+(-.*)?)$/,Vt=class extends _{constructor(e,n,i){super();this.storageService=e;this.productService=n;this.logService=i;this.extensionsWithKeysForSync=Vt.readAllExtensionsWithKeysForSync(e),this._register(this.storageService.onDidChangeValue(0,void 0,this._register(new te))(o=>this.onDidChangeStorageValue(o)))}_serviceBrand;static LARGE_STATE_WARNING_THRESHOLD=512*1024;static toKey(e){return`extensionKeys/${To(e.id)}@${e.version}`}static fromKey(e){let n=aR.exec(e);if(n&&n[1])return{id:n[1],version:n[2]}}static async removeOutdatedExtensionVersions(e,n){let i=await e.getInstalled(),o=[];for(let[s,a]of Vt.readAllExtensionsWithKeysForSync(n)){let l=i.find(c=>Y(c.identifier,{id:s}))?.manifest.version;for(let c of a)l!==c&&o.push(Vt.toKey({id:s,version:c}))}for(let s of o)n.remove(s,0)}static readAllExtensionsWithKeysForSync(e){let n=new Map,i=e.keys(0,1);for(let o of i){let s=Vt.fromKey(o);if(s){let a=n.get(s.id.toLowerCase());a||n.set(s.id.toLowerCase(),a=[]),a.push(s.version)}}return n}_onDidChangeExtensionStorageToSync=this._register(new P);onDidChangeExtensionStorageToSync=this._onDidChangeExtensionStorageToSync.event;extensionsWithKeysForSync;onDidChangeStorageValue(e){if(this.extensionsWithKeysForSync.has(e.key.toLowerCase())){this._onDidChangeExtensionStorageToSync.fire();return}let n=Vt.fromKey(e.key);if(n){if(this.storageService.get(e.key,0)===void 0)this.extensionsWithKeysForSync.delete(n.id.toLowerCase());else{let i=this.extensionsWithKeysForSync.get(n.id.toLowerCase());i||this.extensionsWithKeysForSync.set(n.id.toLowerCase(),i=[]),i.push(n.version),this._onDidChangeExtensionStorageToSync.fire()}return}}getExtensionId(e){if(De(e))return e;let n=e.manifest?e.manifest.publisher:e.publisher,i=e.manifest?e.manifest.name:e.name;return Ro(n,i)}getExtensionState(e,n){let i=this.getExtensionId(e),o=this.getExtensionStateRaw(e,n);if(o)try{return JSON.parse(o)}catch(s){this.logService.error(`[mainThreadStorage] unexpected error parsing storage contents (extensionId: ${i}, global: ${n}): ${s}`)}}getExtensionStateRaw(e,n){let i=this.getExtensionId(e),o=this.storageService.get(i,n?0:1);return o&&o?.length>Vt.LARGE_STATE_WARNING_THRESHOLD&&this.logService.warn(`[mainThreadStorage] large extension state detected (extensionId: ${i}, global: ${n}): ${o.length/1024}kb. Consider to use 'storageUri' or 'globalStorageUri' to store this data on disk instead.`),o}setExtensionState(e,n,i){let o=this.getExtensionId(e);n===void 0?this.storageService.remove(o,i?0:1):this.storageService.store(o,JSON.stringify(n),i?0:1,1)}setKeysForSync(e,n){this.storageService.store(Vt.toKey(e),JSON.stringify(n),0,1)}getKeysForSync(e){let n=this.productService.extensionSyncedKeys?.[e.id.toLowerCase()],i=this.storageService.get(Vt.toKey(e),0),o=i?JSON.parse(i):void 0;return o&&n?gt([...o,...n]):o||n}addToMigrationList(e,n){if(e!==n){let i=this.migrationList.filter(o=>!o.includes(e)&&!o.includes(n));i.push([e,n]),this.migrationList=i}}getSourceExtensionToMigrate(e){let n=this.migrationList.find(([,i])=>e===i);return n?n[0]:void 0}get migrationList(){let e=this.storageService.get("extensionStorage.migrationList",-1,"[]");try{let n=JSON.parse(e);if(Array.isArray(n))return n}catch{}return[]}set migrationList(e){e.length?this.storageService.store("extensionStorage.migrationList",JSON.stringify(e),-1,1):this.storageService.remove("extensionStorage.migrationList",-1)}};Vt=E([m(0,X),m(1,de),m(2,z)],Vt);var Ca=M("IIgnoredExtensionsManagementService"),Ra=class{constructor(t){this.configurationService=t}hasToNeverSyncExtension(t){return this.getConfiguredIgnoredExtensions().includes(t.toLowerCase())}hasToAlwaysSyncExtension(t){return this.getConfiguredIgnoredExtensions().includes(`-${t.toLowerCase()}`)}updateIgnoredExtensions(t,e){let n=[...this.configurationService.getValue("settingsSync.ignoredExtensions")].map(i=>i.toLowerCase());return n=n.filter(i=>i!==t&&i!==`-${t}`),e&&n.push(t.toLowerCase()),this.configurationService.updateValue("settingsSync.ignoredExtensions",n.length?n:void 0,2)}updateSynchronizedExtensions(t,e){let n=[...this.configurationService.getValue("settingsSync.ignoredExtensions")].map(i=>i.toLowerCase());return n=n.filter(i=>i!==t&&i!==`-${t}`),e&&n.push(`-${t.toLowerCase()}`),this.configurationService.updateValue("settingsSync.ignoredExtensions",n.length?n:void 0,2)}getIgnoredExtensions(t){let e=t.filter(s=>s.isMachineScoped).map(s=>s.identifier.id.toLowerCase()),n=this.getConfiguredIgnoredExtensions().map(s=>s.toLowerCase()),i=[],o=[];if(Array.isArray(n))for(let s of n)s.startsWith("-")?o.push(s.substring(1)):i.push(s);return gt([...e,...i].filter(s=>!o.includes(s)))}getConfiguredIgnoredExtensions(){let t=this.configurationService.inspect("settingsSync.ignoredExtensions").userValue;return t!==void 0||(t=this.configurationService.inspect("sync.ignoredExtensions").userValue,t!==void 0)?t:(this.configurationService.getValue("settingsSync.ignoredExtensions")||[]).map(e=>e.toLowerCase())}};Ra=E([m(0,ue)],Ra);var Mo=M("IUserDataSyncMachinesService"),t1="sync.currentMachineName",lR="Safari",cR="Chrome",dR="Edge",uR="Firefox",fR="Android";function n1(){return gd?lR:Pl?cR:md?dR:hd?uR:Hv?fR:pd(qe?0:Tr)}var Xn=class extends _{constructor(e,n,i,o,s,a){super();this.storageService=i;this.userDataSyncStoreService=o;this.logService=s;this.productService=a;this.currentMachineIdPromise=Qn(e,n,i)}static VERSION=1;static RESOURCE="machines";_serviceBrand;_onDidChange=this._register(new P);onDidChange=this._onDidChange.event;currentMachineIdPromise;userData=null;async getMachines(e){let n=await this.currentMachineIdPromise;return(await this.readMachinesData(e)).machines.map(o=>({...o,isCurrent:o.id===n}))}async addCurrentMachine(e){let n=await this.currentMachineIdPromise,i=await this.readMachinesData(e);i.machines.some(({id:o})=>o===n)||(i.machines.push({id:n,name:this.computeCurrentMachineName(i.machines),platform:n1()}),await this.writeMachinesData(i))}async removeCurrentMachine(e){let n=await this.currentMachineIdPromise,i=await this.readMachinesData(e),o=i.machines.filter(({id:s})=>s!==n);o.length!==i.machines.length&&(i.machines=o,await this.writeMachinesData(i))}async renameMachine(e,n,i){let o=await this.readMachinesData(i),s=o.machines.find(({id:a})=>a===e);if(s){s.name=n,await this.writeMachinesData(o);let a=await this.currentMachineIdPromise;e===a&&this.storageService.store(t1,n,-1,1)}}async setEnablements(e){let n=await this.readMachinesData();for(let[i,o]of e){let s=n.machines.find(a=>a.id===i);s&&(s.disabled=o?void 0:!0)}await this.writeMachinesData(n)}computeCurrentMachineName(e){let n=this.storageService.get(t1,-1);if(n)return n;let i=`${this.productService.embedderIdentifier?`${this.productService.embedderIdentifier} - `:""}${n1()} (${this.productService.nameShort})`,o=new RegExp(`${ur(i)}\\s#(\\d+)`),s=0;for(let a of e){let l=o.exec(a.name),c=l?parseInt(l[1]):0;s=c>s?c:s}return`${i} #${s+1}`}async readMachinesData(e){this.userData=await this.readUserData(e);let n=this.parse(this.userData);if(n.version!==Xn.VERSION)throw new Error(g("error incompatible","Cannot read machines data as the current version is incompatible. Please update {0} and try again.",this.productService.nameLong));return n}async writeMachinesData(e){let n=JSON.stringify(e),i=await this.userDataSyncStoreService.writeResource(Xn.RESOURCE,n,this.userData?.ref||null);this.userData={ref:i,content:n},this._onDidChange.fire()}async readUserData(e){if(this.userData){let n=e&&e.latest?e.latest[Xn.RESOURCE]:void 0;if(this.userData.ref===n)return this.userData;if(n===void 0&&this.userData.content===null)return this.userData}return this.userDataSyncStoreService.readResource(Xn.RESOURCE,this.userData)}parse(e){if(e.content!==null)try{return JSON.parse(e.content)}catch(n){this.logService.error(n)}return{version:Xn.VERSION,machines:[]}}};Xn=E([m(0,oe),m(1,G),m(2,X),m(3,je),m(4,Ie),m(5,de)],Xn);function fp(){let r=Ne.as(Wt.Configuration).getConfigurationProperties();return Object.keys(r).filter(t=>!!r[t].disallowSyncIgnore)}function pR(r=!1){let t=Ne.as(Wt.Configuration).getConfigurationProperties(),e=r1(t,r),n=fp();return gt([...e,...n])}function Iy(r){if(!r.contributes?.configuration)return[];let t=Array.isArray(r.contributes.configuration)?r.contributes.configuration:[r.contributes.configuration];if(!t.length)return[];let e=mm(t);return r1(e,!1)}function r1(r,t){let e=new Set;for(let n in r){if(t&&r[n].source)continue;let i=De(r[n].scope)?Mb(r[n].scope):r[n].scope;(r[n].ignoreSync||i===2||i===6)&&e.add(n)}return[...e.values()]}var No="settingsSync",Fc="settingsSync.keybindingsPerPlatform";function i1(){let r="vscode://schemas/ignoredSettings",t=Ne.as(Wt.Configuration);t.registerConfiguration({id:"settingsSync",order:30,title:g("settings sync","Settings Sync"),type:"object",properties:{[Fc]:{type:"boolean",description:g("settingsSync.keybindingsPerPlatform","Synchronize keybindings for each platform."),default:!0,scope:1,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredExtensions":{type:"array",markdownDescription:g("settingsSync.ignoredExtensions","List of extensions to be ignored while synchronizing. The identifier of an extension is always `${publisher}.${name}`. For example: `vscode.csharp`."),items:[{type:"string",pattern:Qg,errorMessage:g("app.extension.identifier.errorMessage","Expected format '${publisher}.${name}'. Example: 'vscode.csharp'.")}],default:[],scope:1,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]},"settingsSync.ignoredSettings":{type:"array",description:g("settingsSync.ignoredSettings","Configure settings to be ignored while synchronizing."),default:[],scope:1,$ref:r,additionalProperties:!0,uniqueItems:!0,disallowSyncIgnore:!0,tags:["sync","usesOnlineServices"]}}});let e=Ne.as(ti.JSONContribution),n=()=>{let i=fp(),o=pR(),s=Object.keys(Vs.properties).filter(c=>!o.includes(c)),a=o.filter(c=>!i.includes(c)),l={items:{type:"string",enum:[...s,...a.map(c=>`-${c}`)]}};e.registerSchema(r,l)};return t.onDidUpdateConfiguration(()=>n())}var Br=["settings","keybindings","snippets","tasks","extensions","globalState","profiles"];function Sy(r,...t){return r?[r,...t]:t}function by(r,t,e,n){return n.joinPath(e.userDataSyncHome,...Sy(r,t,`lastSync${t}.json`))}var wn=M("IUserDataSyncStoreManagementService"),je=M("IUserDataSyncStoreService"),yt=M("IUserDataSyncLocalStoreService"),Wr="x-operation-id",xy="X-Execution-Id";function Qi(r){let t={};return t[xy]=r,t}var Te=class extends Error{constructor(e,n,i,o){super(e);this.code=n;this.resource=i;this.operationId=o;this.name=`${this.code} (UserDataSyncError) syncResource:${this.resource||"unknown"} operationId:${this.operationId||"unknown"}`}},Je=class extends Te{constructor(e,n,i,o,s){super(e,i,void 0,s);this.url=n;this.serverCode=o}},Yn=class extends Te{constructor(t,e){super(t,e)}};(t=>{function r(e){if(e instanceof t)return e;let n=/^(.+) \(UserDataSyncError\) syncResource:(.+) operationId:(.+)$/.exec(e.name);if(n&&n[1]){let i=n[2]==="unknown"?void 0:n[2],o=n[3]==="unknown"?void 0:n[3];return new t(e.message,n[1],i,o)}return new t(e.message,"Unknown")}t.toUserDataSyncError=r})(Te||={});var br="sync.store.url.type";function Da(r){return`sync.enable.${r}`}var it=M("IUserDataSyncEnablementService"),Bo=M("IUserDataSyncService"),Ac=M("IUserDataSyncResourceProviderService"),wpe=M("IUserDataAutoSyncService"),Ji=M("IUserDataSyncUtilService"),Ie=M("IUserDataSyncLogService"),Ey="userDataSync",j="vscode-userdata-sync",o1="preview";var Wo=M("IUserDataSyncAccountService"),_a=class extends _{constructor(e,n){super();this.userDataSyncStoreService=e;this.logService=n;this._register(e.onTokenFailed(i=>{this.logService.info("Settings Sync auth token failed",this.account?.authenticationProviderId,this.wasTokenFailed,i),this.updateAccount(void 0),i==="Forbidden"?this._onTokenFailed.fire(!0):this._onTokenFailed.fire(this.wasTokenFailed),this.wasTokenFailed=!0})),this._register(e.onTokenSucceed(()=>this.wasTokenFailed=!1))}_serviceBrand;_account;get account(){return this._account}_onDidChangeAccount=this._register(new P);onDidChangeAccount=this._onDidChangeAccount.event;_onTokenFailed=this._register(new P);onTokenFailed=this._onTokenFailed.event;wasTokenFailed=!1;async updateAccount(e){(e&&this._account?e.token!==this._account.token||e.authenticationProviderId!==this._account.authenticationProviderId:e!==this._account)&&(this._account=e,this._account&&this.userDataSyncStoreService.setAuthToken(this._account.token,this._account.authenticationProviderId),this._onDidChangeAccount.fire(e))}};_a=E([m(0,je),m(1,Ie)],_a);var hR=60,gR=hR*60,wy=gR*24,Fpe=wy*7,Ape=wy*30,Ope=wy*365;function ka(r){return r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0")+"-"+String(r.getDate()).padStart(2,"0")+"T"+String(r.getHours()).padStart(2,"0")+":"+String(r.getMinutes()).padStart(2,"0")+":"+String(r.getSeconds()).padStart(2,"0")+"."+(r.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var Ua=class extends _{constructor(e,n,i,o,s){super();this.environmentService=e;this.fileService=n;this.configurationService=i;this.logService=o;this.userDataProfilesService=s;this.cleanUp()}_serviceBrand;async cleanUp(){for(let n of this.userDataProfilesService.profiles)for(let i of Br)try{await this.cleanUpBackup(this.getResourceBackupHome(i,n.isDefault?void 0:n.id))}catch(o){this.logService.error(o)}let e;try{e=await this.fileService.resolve(this.environmentService.userDataSyncHome)}catch(n){rt(n)!==1&&this.logService.error(n);return}if(e.children){for(let n of e.children)if(n.isDirectory&&!Br.includes(n.name)&&!this.userDataProfilesService.profiles.some(i=>i.id===n.name))try{this.logService.info("Deleting non existing profile from backup",n.resource.path),await this.fileService.del(n.resource,{recursive:!0})}catch(i){this.logService.error(i)}}}async getAllResourceRefs(e,n,i){let o=this.getResourceBackupHome(e,n,i);try{let s=await this.fileService.resolve(o);if(s.children)return s.children.filter(l=>l.isFile&&!l.name.startsWith("lastSync")).sort().reverse().map(l=>({ref:l.name,created:this.getCreationTime(l)}))}catch(s){if(rt(s)!==1)throw s}return[]}async resolveResourceContent(e,n,i,o){let s=this.getResourceBackupHome(e,i,o),a=V(s,n);try{return(await this.fileService.readFile(a)).value.toString()}catch(l){return this.logService.error(l),null}}async writeResource(e,n,i,o,s){let a=this.getResourceBackupHome(e,o,s),l=V(a,`${ka(i).replace(/-|:|\.\d+Z$/g,"")}.json`);try{await this.fileService.writeFile(l,A.fromString(n))}catch(c){this.logService.error(c)}}getResourceBackupHome(e,n,i=this.environmentService.userDataSyncHome){return V(i,...n?[n,e]:[e])}async cleanUpBackup(e){try{try{if(!await this.fileService.exists(e))return}catch{return}let n=await this.fileService.resolve(e);if(n.children){let i=n.children.filter(l=>l.isFile&&/^\d{8}T\d{6}(\.json)?$/.test(l.name)).sort(),o=1e3*60*60*24*(this.configurationService.getValue("sync.localBackupDuration")||30),s=i.filter(l=>Date.now()-this.getCreationTime(l)>o),a=i.length-s.length;a<10&&(s=s.slice(10-a)),await Qe.settled(s.map(async l=>{this.logService.info("Deleting from backup",l.resource.path),await this.fileService.del(l.resource)}))}}catch(n){this.logService.error(n)}}getCreationTime(e){return new Date(parseInt(e.name.substring(0,4)),parseInt(e.name.substring(4,6))-1,parseInt(e.name.substring(6,8)),parseInt(e.name.substring(9,11)),parseInt(e.name.substring(11,13)),parseInt(e.name.substring(13,15))).getTime()}};Ua=E([m(0,oe),m(1,G),m(2,ue),m(3,Ie),m(4,ge)],Ua);var pp=Object.freeze({text:"text/plain",binary:"application/octet-stream",unknown:"application/unknown",markdown:"text/markdown",latex:"text/latex",uriList:"text/uri-list"});var s1="configurationSync.store",Py="sync.previous.store",Ty="sync.donot-make-requests-until",hp="sync.user-session-id",Ry="sync.machine-session-id",mR=100,yR=1e3*60*5,Vo=class extends _{constructor(e,n,i){super();this.productService=e;this.configurationService=n;this.storageService=i;this.updateUserDataSyncStore();let o=this._register(new te);this._register(O.filter(i.onDidChangeValue(-1,br,o),()=>this.userDataSyncStoreType!==this.userDataSyncStore?.type,o)(()=>this.updateUserDataSyncStore()))}_serviceBrand;_onDidChangeUserDataSyncStore=this._register(new P);onDidChangeUserDataSyncStore=this._onDidChangeUserDataSyncStore.event;_userDataSyncStore;get userDataSyncStore(){return this._userDataSyncStore}get userDataSyncStoreType(){return this.storageService.get(br,-1)}set userDataSyncStoreType(e){this.storageService.store(br,e,-1,qe?0:1)}updateUserDataSyncStore(){this._userDataSyncStore=this.toUserDataSyncStore(this.productService[s1]),this._onDidChangeUserDataSyncStore.fire()}toUserDataSyncStore(e){if(e&&(e=qe&&e.web?{...e,...e.web}:e,De(e.url)&&He(e.authenticationProviders)&&Object.keys(e.authenticationProviders).every(n=>Array.isArray(e.authenticationProviders[n].scopes)))){let n=e,i=!!n.canSwitch,o=n.url===n.insidersUrl?"insiders":"stable",s=(i?this.userDataSyncStoreType:void 0)||o,a=s==="insiders"?n.insidersUrl:s==="stable"?n.stableUrl:n.url;return{url:C.parse(a),type:s,defaultType:o,defaultUrl:C.parse(n.url),stableUrl:C.parse(n.stableUrl),insidersUrl:C.parse(n.insidersUrl),canSwitch:i,authenticationProviders:Object.keys(n.authenticationProviders).reduce((l,c)=>(l.push({id:c,scopes:n.authenticationProviders[c].scopes}),l),[])}}}};Vo=E([m(0,de),m(1,ue),m(2,X)],Vo);var La=class extends Vo{previousConfigurationSyncStore;constructor(t,e,n){super(t,e,n);let i=this.storageService.get(Py,-1);i&&(this.previousConfigurationSyncStore=JSON.parse(i));let o=this.productService[s1];o?this.storageService.store(Py,JSON.stringify(o),-1,1):this.storageService.remove(Py,-1)}async switch(t){t!==this.userDataSyncStoreType&&(this.userDataSyncStoreType=t,this.updateUserDataSyncStore())}async getPreviousUserDataSyncStore(){return this.toUserDataSyncStore(this.previousConfigurationSyncStore)}};La=E([m(0,de),m(1,ue),m(2,X)],La);var Oc=class extends _{constructor(e,n,i,o,s,a,l){super();this.requestService=i;this.logService=o;this.storageService=l;this.updateUserDataSyncStoreUrl(e),this.commonHeadersPromise=Qn(s,a,l).then(c=>{let d={"X-Client-Name":`${n.applicationName}${qe?"-web":""}`,"X-Client-Version":n.version};return n.commit&&(d["X-Client-Commit"]=n.commit),d}),this.session=new Cy(mR,yR,this.requestService,this.logService),this.initDonotMakeRequestsUntil(),this._register(J(()=>{this.resetDonotMakeRequestsUntilPromise&&(this.resetDonotMakeRequestsUntilPromise.cancel(),this.resetDonotMakeRequestsUntilPromise=void 0)}))}userDataSyncStoreUrl;authToken;commonHeadersPromise;session;_onTokenFailed=this._register(new P);onTokenFailed=this._onTokenFailed.event;_onTokenSucceed=this._register(new P);onTokenSucceed=this._onTokenSucceed.event;_donotMakeRequestsUntil=void 0;get donotMakeRequestsUntil(){return this._donotMakeRequestsUntil}_onDidChangeDonotMakeRequestsUntil=this._register(new P);onDidChangeDonotMakeRequestsUntil=this._onDidChangeDonotMakeRequestsUntil.event;setAuthToken(e,n){this.authToken={token:e,type:n}}updateUserDataSyncStoreUrl(e){this.userDataSyncStoreUrl=e?V(e,"v1"):void 0}initDonotMakeRequestsUntil(){let e=this.storageService.getNumber(Ty,-1);e&&Date.now()<e&&this.setDonotMakeRequestsUntil(new Date(e))}resetDonotMakeRequestsUntilPromise=void 0;setDonotMakeRequestsUntil(e){this._donotMakeRequestsUntil?.getTime()!==e?.getTime()&&(this._donotMakeRequestsUntil=e,this.resetDonotMakeRequestsUntilPromise&&(this.resetDonotMakeRequestsUntilPromise.cancel(),this.resetDonotMakeRequestsUntilPromise=void 0),this._donotMakeRequestsUntil?(this.storageService.store(Ty,this._donotMakeRequestsUntil.getTime(),-1,1),this.resetDonotMakeRequestsUntilPromise=nt(n=>pr(this._donotMakeRequestsUntil.getTime()-Date.now(),n).then(()=>this.setDonotMakeRequestsUntil(void 0))),this.resetDonotMakeRequestsUntilPromise.then(null,n=>null)):this.storageService.remove(Ty,-1),this._onDidChangeDonotMakeRequestsUntil.fire())}async getAllCollections(e={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let n=V(this.userDataSyncStoreUrl,"collection").toString();e={...e},e["Content-Type"]="application/json";let i=await this.request(n,{type:"GET",headers:e},[],ee.None);return(await _o(i))?.map(({id:o})=>o)||[]}async createCollection(e={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let n=V(this.userDataSyncStoreUrl,"collection").toString();e={...e},e["Content-Type"]=pp.text;let i=await this.request(n,{type:"POST",headers:e},[],ee.None),o=await Nn(i);if(!o)throw new Je("Server did not return the collection id",n,"NoCollection",i.res.statusCode,i.res.headers[Wr]);return o}async deleteCollection(e,n={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let i=e?V(this.userDataSyncStoreUrl,"collection",e).toString():V(this.userDataSyncStoreUrl,"collection").toString();n={...n},await this.request(i,{type:"DELETE",headers:n},[],ee.None)}async getAllResourceRefs(e,n){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let i=this.getResourceUrl(this.userDataSyncStoreUrl,n,e),o={},s=await this.request(i.toString(),{type:"GET",headers:o},[],ee.None);return(await _o(s)||[]).map(({url:l,created:c})=>({ref:GI(i,i.with({path:l})),created:c*1e3}))}async resolveResourceContent(e,n,i,o={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let s=V(this.getResourceUrl(this.userDataSyncStoreUrl,i,e),n).toString();o={...o},o["Cache-Control"]="no-cache";let a=await this.request(s,{type:"GET",headers:o},[],ee.None);return await Nn(a)}async deleteResource(e,n,i){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let o=n!==null?V(this.getResourceUrl(this.userDataSyncStoreUrl,i,e),n).toString():this.getResourceUrl(this.userDataSyncStoreUrl,i,e).toString(),s={};await this.request(o,{type:"DELETE",headers:s},[],ee.None)}async deleteResources(){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let e=V(this.userDataSyncStoreUrl,"resource").toString(),n={"Content-Type":pp.text};await this.request(e,{type:"DELETE",headers:n},[],ee.None)}async readResource(e,n,i,o={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let s=V(this.getResourceUrl(this.userDataSyncStoreUrl,i,e),"latest").toString();o={...o},o["Cache-Control"]="no-cache",n&&(o["If-None-Match"]=n.ref);let a=await this.request(s,{type:"GET",headers:o},[304],ee.None),l=null;if(a.res.statusCode===304&&(l=n),l===null){let c=a.res.headers.etag;if(!c)throw new Je("Server did not return the ref",s,"NoRef",a.res.statusCode,a.res.headers[Wr]);let d=await Nn(a);if(!d&&a.res.statusCode===304)throw new Je("Empty response",s,"EmptyResponse",a.res.statusCode,a.res.headers[Wr]);l={ref:c,content:d}}return l}async writeResource(e,n,i,o,s={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let a=this.getResourceUrl(this.userDataSyncStoreUrl,o,e).toString();s={...s},s["Content-Type"]=pp.text,i&&(s["If-Match"]=i);let l=await this.request(a,{type:"POST",data:n,headers:s},[],ee.None),c=l.res.headers.etag;if(!c)throw new Je("Server did not return the ref",a,"NoRef",l.res.statusCode,l.res.headers[Wr]);return c}async manifest(e,n={}){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let i=V(this.userDataSyncStoreUrl,"manifest").toString();n={...n},n["Content-Type"]="application/json",e&&(n["If-None-Match"]=e.ref);let o=await this.request(i,{type:"GET",headers:n},[304],ee.None),s=null;if(o.res.statusCode===304&&(s=e),!s){let l=o.res.headers.etag;if(!l)throw new Je("Server did not return the ref",i,"NoRef",o.res.statusCode,o.res.headers[Wr]);let c=await Nn(o);if(!c&&o.res.statusCode===304)throw new Je("Empty response",i,"EmptyResponse",o.res.statusCode,o.res.headers[Wr]);c&&(s={...JSON.parse(c),ref:l})}let a=this.storageService.get(hp,-1);return a&&s&&a!==s.session&&this.clearSession(),s===null&&a&&this.clearSession(),s&&this.storageService.store(hp,s.session,-1,1),s}async clear(){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");await this.deleteCollection(),await this.deleteResources(),this.clearSession()}async getActivityData(){if(!this.userDataSyncStoreUrl)throw new Error("No settings sync store url configured.");let e=V(this.userDataSyncStoreUrl,"download").toString(),n={},i=await this.request(e,{type:"GET",headers:n},[],ee.None);if(!Li(i))throw new Je("Server returned "+i.res.statusCode,e,"EmptyResponse",i.res.statusCode,i.res.headers[Wr]);if(lf(i))throw new Je("Empty response",e,"EmptyResponse",i.res.statusCode,i.res.headers[Wr]);return i.stream}getResourceUrl(e,n,i){return n?V(e,"collection",n,"resource",i):V(e,"resource",i)}clearSession(){this.storageService.remove(hp,-1),this.storageService.remove(Ry,-1)}async request(e,n,i,o){if(!this.authToken)throw new Je("No Auth Token Available",e,"Unauthorized",void 0,void 0);if(this._donotMakeRequestsUntil&&Date.now()<this._donotMakeRequestsUntil.getTime())throw new Je(`${n.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",void 0,void 0);this.setDonotMakeRequestsUntil(void 0);let s=await this.commonHeadersPromise;n.headers={...n.headers||{},...s,"X-Account-Type":this.authToken.type,authorization:`Bearer ${this.authToken.token}`},this.addSessionHeaders(n.headers),this.logService.trace("Sending request to server",{url:e,type:n.type,headers:{...n.headers,authorization:void 0}});let a;try{a=await this.session.request(e,n,o)}catch(f){if(!(f instanceof Je)){let h="RequestFailed",v=me(f).toLowerCase();v.includes("xhr timeout")?h="RequestTimeout":v.includes("protocol")&&v.includes("not supported")?h="RequestProtocolNotSupported":v.includes("request path contains unescaped characters")?h="RequestPathNotEscaped":v.includes("headers must be an object")?h="RequestHeadersNotObject":Rn(f)&&(h="RequestCanceled"),f=new Je(`Connection refused for the request '${e}'.`,e,h,void 0,void 0)}throw this.logService.info("Request failed",e),f}let l=a.res.headers[Wr],c={url:e,status:a.res.statusCode,"execution-id":n.headers[xy],"operation-id":l},d=Li(a)||a.res.statusCode&&i.includes(a.res.statusCode),u="";if(d?this.logService.trace("Request succeeded",c):(u=await Sm(a)||"",this.logService.info("Request failed",c,u)),a.res.statusCode===401||a.res.statusCode===403){if(this.authToken=void 0,a.res.statusCode===401)throw this._onTokenFailed.fire("Unauthorized"),new Je(`${n.type} request '${e}' failed because of Unauthorized (401).`,e,"Unauthorized",a.res.statusCode,l);if(a.res.statusCode===403)throw this._onTokenFailed.fire("Forbidden"),new Je(`${n.type} request '${e}' failed because the access is forbidden (403).`,e,"Forbidden",a.res.statusCode,l)}if(this._onTokenSucceed.fire(),a.res.statusCode===404)throw new Je(`${n.type} request '${e}' failed because the requested resource is not found (404).`,e,"NotFound",a.res.statusCode,l);if(a.res.statusCode===405)throw new Je(`${n.type} request '${e}' failed because the requested endpoint is not found (405). ${u}`,e,"MethodNotFound",a.res.statusCode,l);if(a.res.statusCode===409)throw new Je(`${n.type} request '${e}' failed because of Conflict (409). There is new data for this resource. Make the request again with latest data.`,e,"Conflict",a.res.statusCode,l);if(a.res.statusCode===410)throw new Je(`${n.type} request '${e}' failed because the requested resource is not longer available (410).`,e,"Gone",a.res.statusCode,l);if(a.res.statusCode===412)throw new Je(`${n.type} request '${e}' failed because of Precondition Failed (412). There is new data for this resource. Make the request again with latest data.`,e,"PreconditionFailed",a.res.statusCode,l);if(a.res.statusCode===413)throw new Je(`${n.type} request '${e}' failed because of too large payload (413).`,e,"TooLarge",a.res.statusCode,l);if(a.res.statusCode===426)throw new Je(`${n.type} request '${e}' failed with status Upgrade Required (426). Please upgrade the client and try again.`,e,"UpgradeRequired",a.res.statusCode,l);if(a.res.statusCode===429){let f=a.res.headers["retry-after"];throw f?(this.setDonotMakeRequestsUntil(new Date(Date.now()+parseInt(f)*1e3)),new Je(`${n.type} request '${e}' failed because of too many requests (429).`,e,"TooManyRequestsAndRetryAfter",a.res.statusCode,l)):new Je(`${n.type} request '${e}' failed because of too many requests (429).`,e,"RemoteTooManyRequests",a.res.statusCode,l)}if(!d)throw new Je("Server returned "+a.res.statusCode,e,"Unknown",a.res.statusCode,l);return a}addSessionHeaders(e){let n=this.storageService.get(Ry,-1);n===void 0&&(n=Fe(),this.storageService.store(Ry,n,-1,1)),e["X-Machine-Session-Id"]=n;let i=this.storageService.get(hp,-1);i!==void 0&&(e["X-User-Session-Id"]=i)}};Oc=E([m(1,de),m(2,vr),m(3,Ie),m(4,oe),m(5,G),m(6,X)],Oc);var Fa=class extends Oc{_serviceBrand;constructor(t,e,n,i,o,s,a){super(t.userDataSyncStore?.url,e,n,i,o,s,a),this._register(t.onDidChangeUserDataSyncStore(()=>this.updateUserDataSyncStoreUrl(t.userDataSyncStore?.url)))}};Fa=E([m(0,wn),m(1,de),m(2,vr),m(3,Ie),m(4,oe),m(5,G),m(6,X)],Fa);var Cy=class{constructor(t,e,n,i){this.limit=t;this.interval=e;this.requestService=n;this.logService=i}requests=[];startTime=void 0;request(t,e,n){if(this.isExpired()&&this.reset(),e.url=t,this.requests.length>=this.limit)throw this.logService.info("Too many requests",...this.requests),new Je(`Too many requests. Only ${this.limit} requests allowed in ${this.interval/(1e3*60)} minutes.`,t,"LocalTooManyRequests",void 0,void 0);return this.startTime=this.startTime||new Date,this.requests.push(t),this.requestService.request(e,n)}isExpired(){return this.startTime!==void 0&&new Date().getTime()-this.startTime.getTime()>this.interval}reset(){this.requests=[],this.startTime=void 0}};var mp=class{constructor(t){this.service=t}listen(t,e){switch(e){case"onDidChangeAccount":return this.service.onDidChangeAccount;case"onTokenFailed":return this.service.onTokenFailed}throw new Error(`[UserDataSyncAccountServiceChannel] Event not found: ${e}`)}call(t,e,n){switch(e){case"_getInitialData":return Promise.resolve(this.service.account);case"updateAccount":return this.service.updateAccount(n)}throw new Error("Invalid call")}};var yp=class{constructor(t){this.service=t}listen(t,e){switch(e){case"onDidChangeUserDataSyncStore":return this.service.onDidChangeUserDataSyncStore}throw new Error(`[UserDataSyncStoreManagementServiceChannel] Event not found: ${e}`)}call(t,e,n){switch(e){case"switch":return this.service.switch(n[0]);case"getPreviousUserDataSyncStore":return this.service.getPreviousUserDataSyncStore()}throw new Error("Invalid call")}},gp=class extends Vo{constructor(e,n,i,o){super(n,i,o);this.channel=e;this._register(this.channel.listen("onDidChangeUserDataSyncStore")(()=>this.updateUserDataSyncStore()))}async switch(e){return this.channel.call("switch",[e])}async getPreviousUserDataSyncStore(){let e=await this.channel.call("getPreviousUserDataSyncStore");return this.revive(e)}revive(e){return{url:C.revive(e.url),type:e.type,defaultUrl:C.revive(e.defaultUrl),insidersUrl:C.revive(e.insidersUrl),stableUrl:C.revive(e.stableUrl),canSwitch:e.canSwitch,authenticationProviders:e.authenticationProviders}}};gp=E([m(1,de),m(2,ue),m(3,X)],gp);var Aa=class extends _i{logger;constructor(t,e){super(),this.logger=this._register(t.createLogger(V(e.logsHome,`${Ey}.log`),{id:Ey,name:g("userDataSyncLog","Settings Sync")}))}trace(t,...e){this.logger.trace(t,...e)}debug(t,...e){this.logger.debug(t,...e)}info(t,...e){this.logger.info(t,...e)}warn(t,...e){this.logger.warn(t,...e)}error(t,...e){this.logger.error(t,...e)}flush(){this.logger.flush()}};Aa=E([m(0,Lr),m(1,oe)],Aa);var vp="sync.enable",Oa=class extends _{constructor(e,n,i,o){super();this.storageService=e;this.telemetryService=n;this.environmentService=i;this.userDataSyncStoreManagementService=o;this._register(e.onDidChangeValue(-1,void 0,this._register(new te))(s=>this.onDidStorageChange(s)))}_serviceBrand;_onDidChangeEnablement=new P;onDidChangeEnablement=this._onDidChangeEnablement.event;_onDidChangeResourceEnablement=new P;onDidChangeResourceEnablement=this._onDidChangeResourceEnablement.event;isEnabled(){switch(this.environmentService.sync){case"on":return!0;case"off":return!1}return this.storageService.getBoolean(vp,-1,!1)}canToggleEnablement(){return this.userDataSyncStoreManagementService.userDataSyncStore!==void 0&&this.environmentService.sync===void 0}setEnablement(e){e&&!this.canToggleEnablement()||(this.telemetryService.publicLog2(vp,{enabled:e}),this.storageService.store(vp,e,-1,1))}isResourceEnabled(e){return this.storageService.getBoolean(Da(e),-1,!0)}setResourceEnablement(e,n){if(this.isResourceEnabled(e)!==n){let i=Da(e);this.storeResourceEnablement(i,n)}}getResourceSyncStateVersion(e){}storeResourceEnablement(e,n){this.storageService.store(e,n,-1,qe?0:1)}onDidStorageChange(e){if(vp===e.key){this._onDidChangeEnablement.fire(this.isEnabled());return}let n=Br.filter(i=>Da(i)===e.key)[0];if(n){this._onDidChangeResourceEnablement.fire([n,this.isResourceEnabled(n)]);return}}};Oa=E([m(0,X),m(1,le),m(2,oe),m(3,wn)],Oa);function IR(r){return!!(r&&r.ref!==void 0&&typeof r.ref=="string"&&r.ref!==""&&r.syncData!==void 0&&(r.syncData===null||$o(r.syncData)))}function $o(r){return!!(r&&r.version!==void 0&&typeof r.version=="number"&&r.content!==void 0&&typeof r.content=="string"&&(Object.keys(r).length===2||Object.keys(r).length===3&&r.machineId!==void 0&&typeof r.machineId=="string"))}function Ma(r,t){return`${OI(r)}${t.isDefault?"":` (${t.name})`}`}var Wn=class extends _{constructor(e,n,i,o,s,a,l,c,d,u,f,h){super();this.syncResource=e;this.collection=n;this.fileService=i;this.environmentService=o;this.storageService=s;this.userDataSyncStoreService=a;this.userDataSyncLocalStoreService=l;this.userDataSyncEnablementService=c;this.telemetryService=d;this.logService=u;this.configurationService=f;this.syncResourceLogLabel=Ma(e.syncResource,e.profile),this.extUri=h.extUri,this.syncFolder=this.extUri.joinPath(o.userDataSyncHome,...Sy(e.profile.isDefault?void 0:e.profile.id,e.syncResource)),this.syncPreviewFolder=this.extUri.joinPath(this.syncFolder,o1),this.lastSyncResource=by(e.profile.isDefault?void 0:e.profile.id,e.syncResource,o,this.extUri),this.currentMachineIdPromise=Qn(o,i,s)}syncPreviewPromise=null;syncFolder;syncPreviewFolder;extUri;currentMachineIdPromise;_status="idle";get status(){return this._status}_onDidChangStatus=this._register(new P);onDidChangeStatus=this._onDidChangStatus.event;_conflicts=[];get conflicts(){return{...this.syncResource,conflicts:this._conflicts}}_onDidChangeConflicts=this._register(new P);onDidChangeConflicts=this._onDidChangeConflicts.event;localChangeTriggerThrottler=this._register(new hn(50));_onDidChangeLocal=this._register(new P);onDidChangeLocal=this._onDidChangeLocal.event;lastSyncResource;lastSyncUserDataStateKey=`${this.collection?`${this.collection}.`:""}${this.syncResource.syncResource}.lastSyncUserData`;hasSyncResourceStateVersionChanged=!1;syncResourceLogLabel;syncHeaders={};resource=this.syncResource.syncResource;triggerLocalChange(){this.localChangeTriggerThrottler.trigger(()=>this.doTriggerLocalChange())}async doTriggerLocalChange(){if(this.status==="hasConflicts"){this.logService.info(`${this.syncResourceLogLabel}: In conflicts state and local change detected. Syncing again...`);let e=await this.syncPreviewPromise;this.syncPreviewPromise=null;let n=await this.performSync(e.remoteUserData,e.lastSyncUserData,!0,this.getUserDataSyncConfiguration());this.setStatus(n)}else{this.logService.trace(`${this.syncResourceLogLabel}: Checking for local changes...`);let e=await this.getLastSyncUserData();(e?await this.hasRemoteChanged(e):!0)&&this._onDidChangeLocal.fire()}}setStatus(e){this._status!==e&&(this._status=e,this._onDidChangStatus.fire(e))}async sync(e,n={}){await this._sync(e,!0,this.getUserDataSyncConfiguration(),n)}async preview(e,n,i={}){return this._sync(e,!1,n,i)}async apply(e,n={}){try{this.syncHeaders={...n};let i=await this.doApply(e);return this.setStatus(i),this.syncPreviewPromise}finally{this.syncHeaders={}}}async _sync(e,n,i,o){try{if(this.syncHeaders={...o},this.status==="hasConflicts")return this.logService.info(`${this.syncResourceLogLabel}: Skipped synchronizing ${this.resource.toLowerCase()} as there are conflicts.`),this.syncPreviewPromise;if(this.status==="syncing")return this.logService.info(`${this.syncResourceLogLabel}: Skipped synchronizing ${this.resource.toLowerCase()} as it is running already.`),this.syncPreviewPromise;this.logService.trace(`${this.syncResourceLogLabel}: Started synchronizing ${this.resource.toLowerCase()}...`),this.setStatus("syncing");let s="idle";try{let a=await this.getLastSyncUserData(),l=await this.getLatestRemoteUserData(e,a);return s=await this.performSync(l,a,n,i),s==="hasConflicts"?this.logService.info(`${this.syncResourceLogLabel}: Detected conflicts while synchronizing ${this.resource.toLowerCase()}.`):s==="idle"&&this.logService.trace(`${this.syncResourceLogLabel}: Finished synchronizing ${this.resource.toLowerCase()}.`),this.syncPreviewPromise||null}finally{this.setStatus(s)}}finally{this.syncHeaders={}}}async replace(e){let n=this.parseSyncData(e);if(!n)return!1;await this.stop();try{this.logService.trace(`${this.syncResourceLogLabel}: Started resetting ${this.resource.toLowerCase()}...`),this.setStatus("syncing");let i=await this.getLastSyncUserData(),o=await this.getLatestRemoteUserData(null,i),s=await this.isRemoteDataFromCurrentMachine(o),a=await this.generateSyncPreview({ref:o.ref,syncData:n},i,s,this.getUserDataSyncConfiguration(),ee.None),l=[];for(let c of a){let d=await this.getAcceptResult(c,c.remoteResource,void 0,ee.None),{remoteChange:u}=await this.getAcceptResult(c,c.previewResource,c.remoteContent,ee.None);l.push([c,{...d,remoteChange:u!==0?u:2}])}await this.applyResult(o,i,l,!1),this.logService.info(`${this.syncResourceLogLabel}: Finished resetting ${this.resource.toLowerCase()}.`)}finally{this.setStatus("idle")}return!0}async isRemoteDataFromCurrentMachine(e){let n=await this.currentMachineIdPromise;return!!e.syncData?.machineId&&e.syncData.machineId===n}async getLatestRemoteUserData(e,n){if(n){let i=e?e[this.resource]:void 0;if(n.ref===i||i===void 0&&n.syncData===null)return n}return this.getRemoteUserData(n)}async performSync(e,n,i,o){if(e.syncData&&e.syncData.version>this.version)throw this.telemetryService.publicLog2("sync/incompatible",{source:this.resource}),new Te(g({key:"incompatible",comment:["This is an error while syncing a resource that its local version is not compatible with its remote version."]},"Cannot sync {0} as its local version {1} is not compatible with its remote version {2}",this.resource,this.version,e.syncData.version),"IncompatibleLocalContent",this.resource);try{return await this.doSync(e,n,i,o)}catch(s){if(s instanceof Te)switch(s.code){case"LocalPreconditionFailed":return this.logService.info(`${this.syncResourceLogLabel}: Failed to synchronize ${this.syncResourceLogLabel} as there is a new local version available. Synchronizing again...`),this.performSync(e,n,i,o);case"Conflict":case"PreconditionFailed":return this.logService.info(`${this.syncResourceLogLabel}: Failed to synchronize as there is a new remote version available. Synchronizing again...`),e=await this.getRemoteUserData(null),n=await this.getLastSyncUserData(),this.performSync(e,n,i,o)}throw s}}async doSync(e,n,i,o){try{let s=await this.isRemoteDataFromCurrentMachine(e),a=!s&&n===null&&this.getStoredLastSyncUserDataStateContent()!==void 0,l=i&&!a;this.syncPreviewPromise||(this.syncPreviewPromise=nt(d=>this.doGenerateSyncResourcePreview(e,n,s,l,o,d)));let c=await this.syncPreviewPromise;if(i&&a){this.logService.info(`${this.syncResourceLogLabel}: Accepting remote because it was synced before and the last sync data is not available.`);for(let d of c.resourcePreviews)c=await this.accept(d.remoteResource)||c}return this.updateConflicts(c.resourcePreviews),c.resourcePreviews.some(({mergeState:d})=>d==="conflict")?"hasConflicts":i?await this.doApply(!1):"syncing"}catch(s){throw this.syncPreviewPromise=null,s}}async merge(e){return await this.updateSyncResourcePreview(e,async n=>{let i=await this.getMergeResult(n,ee.None);await this.fileService.writeFile(n.previewResource,A.fromString(i?.content||""));let o=i&&!i.hasConflicts?await this.getAcceptResult(n,n.previewResource,void 0,ee.None):void 0;return n.acceptResult=o,n.mergeState=i.hasConflicts?"conflict":o?"accepted":"preview",n.localChange=o?o.localChange:i.localChange,n.remoteChange=o?o.remoteChange:i.remoteChange,n}),this.syncPreviewPromise}async accept(e,n){return await this.updateSyncResourcePreview(e,async i=>{let o=await this.getAcceptResult(i,e,n,ee.None);return i.acceptResult=o,i.mergeState="accepted",i.localChange=o.localChange,i.remoteChange=o.remoteChange,i}),this.syncPreviewPromise}async discard(e){return await this.updateSyncResourcePreview(e,async n=>{let i=await this.getMergeResult(n,ee.None);return await this.fileService.writeFile(n.previewResource,A.fromString(i.content||"")),n.acceptResult=void 0,n.mergeState="preview",n.localChange=i.localChange,n.remoteChange=i.remoteChange,n}),this.syncPreviewPromise}async updateSyncResourcePreview(e,n){if(!this.syncPreviewPromise)return;let i=await this.syncPreviewPromise,o=i.resourcePreviews.findIndex(({localResource:s,remoteResource:a,previewResource:l})=>this.extUri.isEqual(s,e)||this.extUri.isEqual(a,e)||this.extUri.isEqual(l,e));o!==-1&&(this.syncPreviewPromise=nt(async s=>{let a=[...i.resourcePreviews];return a[o]=await n(a[o]),{...i,resourcePreviews:a}}),i=await this.syncPreviewPromise,this.updateConflicts(i.resourcePreviews),i.resourcePreviews.some(({mergeState:s})=>s==="conflict")?this.setStatus("hasConflicts"):this.setStatus("syncing"))}async doApply(e){if(!this.syncPreviewPromise)return"idle";let n=await this.syncPreviewPromise;return n.resourcePreviews.some(({mergeState:i})=>i==="conflict")?"hasConflicts":n.resourcePreviews.some(({mergeState:i})=>i!=="accepted")?"syncing":(await this.applyResult(n.remoteUserData,n.lastSyncUserData,n.resourcePreviews.map(i=>[i,i.acceptResult]),e),this.syncPreviewPromise=null,await this.clearPreviewFolder(),"idle")}async clearPreviewFolder(){try{await this.fileService.del(this.syncPreviewFolder,{recursive:!0})}catch{}}updateConflicts(e){let n=e.filter(({mergeState:i})=>i==="conflict");Pt(this._conflicts,n,(i,o)=>this.extUri.isEqual(i.previewResource,o.previewResource))||(this._conflicts=n,this._onDidChangeConflicts.fire(this.conflicts))}async hasPreviouslySynced(){let e=await this.getLastSyncUserData();return!!e&&e.syncData!==null}async resolvePreviewContent(e){let n=this.syncPreviewPromise?await this.syncPreviewPromise:null;if(n)for(let i of n.resourcePreviews){if(this.extUri.isEqual(i.acceptedResource,e))return i.acceptResult?i.acceptResult.content:null;if(this.extUri.isEqual(i.remoteResource,e))return i.remoteContent;if(this.extUri.isEqual(i.localResource,e))return i.localContent;if(this.extUri.isEqual(i.baseResource,e))return i.baseContent}return null}async resetLocal(){this.storageService.remove(this.lastSyncUserDataStateKey,-1);try{await this.fileService.del(this.lastSyncResource)}catch(e){rt(e)!==1&&this.logService.error(e)}}async doGenerateSyncResourcePreview(e,n,i,o,s,a){let l=await this.generateSyncPreview(e,n,i,s,a),c=[];for(let d of l){let u=d.previewResource.with({scheme:j,authority:"accepted"});if(d.localChange===0&&d.remoteChange===0)c.push({...d,acceptedResource:u,acceptResult:{content:null,localChange:0,remoteChange:0},mergeState:"accepted"});else{let f=o?await this.getMergeResult(d,a):void 0;if(a.isCancellationRequested)break;await this.fileService.writeFile(d.previewResource,A.fromString(f?.content||""));let h=f&&!f.hasConflicts?await this.getAcceptResult(d,d.previewResource,void 0,a):void 0;c.push({...d,acceptResult:h,mergeState:f?.hasConflicts?"conflict":h?"accepted":"preview",localChange:h?h.localChange:f?f.localChange:d.localChange,remoteChange:h?h.remoteChange:f?f.remoteChange:d.remoteChange})}}return{syncResource:this.resource,profile:this.syncResource.profile,remoteUserData:e,lastSyncUserData:n,resourcePreviews:c,isLastSyncFromCurrentMachine:i}}async getLastSyncUserData(){let e=this.getStoredLastSyncUserDataStateContent();if(e||(e=await this.migrateLastSyncUserData()),!e)return this.logService.info(`${this.syncResourceLogLabel}: Last sync data state does not exist.`),null;let n=JSON.parse(e),i=this.userDataSyncEnablementService.getResourceSyncStateVersion(this.resource);if(this.hasSyncResourceStateVersionChanged=!!n.version&&!!i&&n.version!==i,this.hasSyncResourceStateVersionChanged)return this.logService.info(`${this.syncResourceLogLabel}: Reset last sync state because last sync state version ${n.version} is not compatible with current sync state version ${i}.`),await this.resetLocal(),null;let o,s=1;for(;o===void 0&&s++<6;)try{let a=await this.readLastSyncStoredRemoteUserData();a&&(a.ref===n.ref?o=a.syncData:this.logService.info(`${this.syncResourceLogLabel}: Last sync data stored locally is not same as the last sync state.`));break}catch(a){if(a instanceof ot&&a.fileOperationResult===1){this.logService.info(`${this.syncResourceLogLabel}: Last sync resource does not exist locally.`);break}else{if(a instanceof Te)throw a;this.logService.error(a,s)}}if(o===void 0)try{let a=await this.userDataSyncStoreService.resolveResourceContent(this.resource,n.ref,this.collection,this.syncHeaders);o=a===null?null:this.parseSyncData(a),await this.writeLastSyncStoredRemoteUserData({ref:n.ref,syncData:o})}catch(a){if(a instanceof Te&&a.code==="NotFound")this.logService.info(`${this.syncResourceLogLabel}: Last sync resource does not exist remotely.`);else throw a}return o===void 0?null:{...n,syncData:o}}async updateLastSyncUserData(e,n={}){if(n.ref||n.version)throw new Error("Cannot have core properties as additional");let i=this.userDataSyncEnablementService.getResourceSyncStateVersion(this.resource),o={ref:e.ref,version:i,...n};this.storageService.store(this.lastSyncUserDataStateKey,JSON.stringify(o),-1,1),await this.writeLastSyncStoredRemoteUserData(e)}getStoredLastSyncUserDataStateContent(){return this.storageService.get(this.lastSyncUserDataStateKey,-1)}async readLastSyncStoredRemoteUserData(){let e=(await this.fileService.readFile(this.lastSyncResource)).value.toString();try{let n=e?JSON.parse(e):void 0;if(IR(n))return n}catch(n){this.logService.error(n)}}async writeLastSyncStoredRemoteUserData(e){await this.fileService.writeFile(this.lastSyncResource,A.fromString(JSON.stringify(e)))}async migrateLastSyncUserData(){try{let e=await this.fileService.readFile(this.lastSyncResource),n=JSON.parse(e.value.toString());await this.fileService.del(this.lastSyncResource),n.ref&&n.content!==void 0?(this.storageService.store(this.lastSyncUserDataStateKey,JSON.stringify({...n,content:void 0}),-1,1),await this.writeLastSyncStoredRemoteUserData({ref:n.ref,syncData:n.content===null?null:JSON.parse(n.content)})):this.logService.info(`${this.syncResourceLogLabel}: Migrating last sync user data. Invalid data.`,n)}catch(e){e instanceof ot&&e.fileOperationResult===1?this.logService.info(`${this.syncResourceLogLabel}: Migrating last sync user data. Resource does not exist.`):this.logService.error(e)}return this.storageService.get(this.lastSyncUserDataStateKey,-1)}async getRemoteUserData(e){let{ref:n,content:i}=await this.getUserData(e),o=null;return i!==null&&(o=this.parseSyncData(i)),{ref:n,syncData:o}}parseSyncData(e){try{let n=JSON.parse(e);if($o(n))return n}catch(n){this.logService.error(n)}throw new Te(g("incompatible sync data","Cannot parse sync data as it is not compatible with the current version."),"IncompatibleRemoteContent",this.resource)}async getUserData(e){let n=e?{ref:e.ref,content:e.syncData?JSON.stringify(e.syncData):null}:null;return this.userDataSyncStoreService.readResource(this.resource,n,this.collection,this.syncHeaders)}async updateRemoteUserData(e,n){let i=await this.currentMachineIdPromise,o={version:this.version,machineId:i,content:e};try{return n=await this.userDataSyncStoreService.writeResource(this.resource,JSON.stringify(o),n,this.collection,this.syncHeaders),{ref:n,syncData:o}}catch(s){throw s instanceof Te&&s.code==="TooLarge"&&(s=new Te(s.message,s.code,this.resource)),s}}async backupLocal(e){let n={version:this.version,content:e};return this.userDataSyncLocalStoreService.writeResource(this.resource,JSON.stringify(n),new Date,this.syncResource.profile.isDefault?void 0:this.syncResource.profile.id)}async stop(){this.status!=="idle"&&(this.logService.trace(`${this.syncResourceLogLabel}: Stopping synchronizing ${this.resource.toLowerCase()}.`),this.syncPreviewPromise&&(this.syncPreviewPromise.cancel(),this.syncPreviewPromise=null),this.updateConflicts([]),await this.clearPreviewFolder(),this.setStatus("idle"),this.logService.info(`${this.syncResourceLogLabel}: Stopped synchronizing ${this.resource.toLowerCase()}.`))}getUserDataSyncConfiguration(){return this.configurationService.getValue(No)}};Wn=E([m(2,G),m(3,oe),m(4,X),m(5,je),m(6,yt),m(7,it),m(8,le),m(9,Ie),m(10,ue),m(11,he)],Wn);var Ko=class extends Wn{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v){super(n,i,o,s,a,l,c,d,u,f,h,v);this.file=e;this._register(this.fileService.watch(this.extUri.dirname(e))),this._register(this.fileService.onDidFilesChange(y=>this.onFileChanges(y)))}async getLocalFileContent(){try{return await this.fileService.readFile(this.file)}catch{return null}}async updateLocalFileContent(e,n,i){try{n?await this.fileService.writeFile(this.file,A.fromString(e),i?void 0:n):await this.fileService.createFile(this.file,A.fromString(e),{overwrite:i})}catch(o){throw o instanceof ot&&o.fileOperationResult===1||o instanceof ot&&o.fileOperationResult===3?new Te(o.message,"LocalPreconditionFailed"):o}}async deleteLocalFile(){try{await this.fileService.del(this.file)}catch(e){if(!(e instanceof ot&&e.fileOperationResult===1))throw e}}onFileChanges(e){e.contains(this.file)&&this.triggerLocalChange()}};Ko=E([m(3,G),m(4,oe),m(5,X),m(6,je),m(7,yt),m(8,it),m(9,le),m(10,Ie),m(11,ue),m(12,he)],Ko);var Xi=class extends Ko{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v,y){super(e,n,i,o,s,a,l,c,d,u,f,v,y);this.userDataSyncUtilService=h}hasErrors(e,n){let i=[],o=Ze(e,i,{allowEmptyContent:!0,allowTrailingComma:!0});return i.length>0||!kt(o)&&n!==Array.isArray(o)}_formattingOptions=void 0;getFormattingOptions(){return this._formattingOptions||(this._formattingOptions=this.userDataSyncUtilService.resolveFormattingOptions(this.file)),this._formattingOptions}};Xi=E([m(3,G),m(4,oe),m(5,X),m(6,je),m(7,yt),m(8,it),m(9,le),m(10,Ie),m(11,Ji),m(12,ue),m(13,he)],Xi);var cn=class{constructor(t,e,n,i,o,s,a){this.resource=t;this.userDataProfilesService=e;this.environmentService=n;this.logService=i;this.fileService=o;this.storageService=s;this.extUri=a.extUri,this.lastSyncResource=by(void 0,this.resource,n,this.extUri)}extUri;lastSyncResource;async initialize({ref:t,content:e}){if(!e){this.logService.info("Remote content does not exist.",this.resource);return}let n=this.parseSyncData(e);if(n)try{await this.doInitialize({ref:t,syncData:n})}catch(i){this.logService.error(i)}}parseSyncData(t){try{let e=JSON.parse(t);if($o(e))return e}catch(e){this.logService.error(e)}this.logService.info("Cannot parse sync data as it is not compatible with the current version.",this.resource)}async updateLastSyncUserData(t,e={}){if(e.ref||e.version)throw new Error("Cannot have core properties as additional");let n={ref:t.ref,version:void 0,...e};this.storageService.store(`${this.resource}.lastSyncUserData`,JSON.stringify(n),-1,1),await this.fileService.writeFile(this.lastSyncResource,A.fromString(JSON.stringify(t)))}};cn=E([m(1,ge),m(2,oe),m(3,z),m(4,G),m(5,X),m(6,he)],cn);function Nc(r,t,e,n,i,o){let s=[],a=[],l=[];if(!t){let U=r.filter(({identifier:B})=>i.every(Ee=>Ee.toLowerCase()!==B.id.toLowerCase()));return{local:{added:s,removed:a,updated:l},remote:U.length>0?{added:U,updated:[],removed:[],all:U}:null}}r=r.map(Dy),t=t.map(Dy),e=e?e.map(Dy):null;let c=new Map,d=U=>{U.uuid&&c.set(U.id.toLowerCase(),U.uuid)};r.forEach(({identifier:U})=>d(U)),t.forEach(({identifier:U})=>d(U)),e?.forEach(({identifier:U})=>d(U)),n?.forEach(({identifier:U})=>d(U)),o?.forEach(U=>d(U));let u=U=>{let B=U.identifier.uuid||c.get(U.identifier.id.toLowerCase());return B?`uuid:${B}`:`id:${U.identifier.id.toLowerCase()}`},f=(U,B)=>(U.set(u(B),B),U),h=r.reduce(f,new Map),v=t.reduce(f,new Map),y=t.reduce((U,B)=>f(U,Ht(B)),new Map),I=e?e.reduce(f,new Map):null,x=n.reduce(f,new Map),T=i.reduce((U,B)=>{let Ee=c.get(B.toLowerCase());return U.add(Ee?`uuid:${Ee}`:`id:${B.toLowerCase()}`)},new Set),R=o?o.reduce((U,{id:B,uuid:Ee})=>(Ee=Ee??c.get(B.toLowerCase()),U.add(Ee?`uuid:${Ee}`:`id:${B.toLowerCase()}`)),new Set):null,w=Ip(h,v,T,!1);if(w.added.size>0||w.removed.size>0||w.updated.size>0){let U=Ip(I,h,T,!1),B=Ip(I,v,T,!0),Ee=(se,ie,Ve,st)=>{let $,N,q;return ie.installed?($=st.pinned,q=st.preRelease,$&&(N=st.version)):($=Ve.pinned,q=Ve.preRelease,$&&(N=Ve.version)),$===void 0&&($=ie.pinned,$&&(N=ie.version)),q===void 0&&(q=ie.preRelease),{...st,installed:ie.installed||Ve.installed,pinned:$,preRelease:q,version:N??(Ve.version&&(!ie.installed||la(Ve.version,ie.version))?Ve.version:ie.version),state:SR(ie,Ve,I?.get(se))}};for(let se of B.removed.values()){let ie=h.get(se);if(!ie)continue;let Ve=kn(I?.get(se)),st=R&&!R.has(se)&&Ve.installed;ie.installed&&st?a.push(ie.identifier):y.set(se,ie)}for(let se of B.added.values()){let ie=kn(v.get(se)),Ve=h.get(se);if(Ve){if(w.updated.has(se)){let st=Ee(se,Ve,ie,ie);l1(Ve,ie,!1,!1)||l.push(Mc(st,se)),y.set(se,st)}}else ie.installed&&s.push(Mc(ie,se))}for(let se of B.updated.values()){let ie=kn(v.get(se)),Ve=kn(I?.get(se)),st=h.get(se);if(st)if(R&&!R.has(se)&&Ve.installed&&st.installed&&!ie.installed)a.push(st.identifier);else{let N=Ee(se,st,ie,ie);l.push(Mc(N,se)),y.set(se,N)}else ie.installed&&s.push(Mc(ie,se))}for(let se of U.added.values())B.added.has(se)||y.set(se,kn(h.get(se)));for(let se of U.updated.values()){if(B.removed.has(se)||B.updated.has(se))continue;let ie=kn(h.get(se)),Ve=kn(v.get(se));y.set(se,Ee(se,ie,Ve,ie))}for(let se of U.removed.values())B.updated.has(se)||B.removed.has(se)||x.has(se)||kn(v.get(se)).installed&&R&&(R.has(se)||!kn(I?.get(se)).installed||y.delete(se))}let L=[],Q=Ip(v,y,new Set,!0),K=Q.added.size>0||Q.updated.size>0||Q.removed.size>0;return K&&y.forEach((U,B)=>L.push(Mc(U,B))),{local:{added:s,removed:a,updated:l},remote:K?{added:[...Q.added].map(U=>y.get(U)),updated:[...Q.updated].map(U=>y.get(U)),removed:[...Q.removed].map(U=>v.get(U)),all:L}:null}}function Ip(r,t,e,n){let i=r?[...r.keys()].filter(c=>!e.has(c)):[],o=[...t.keys()].filter(c=>!e.has(c)),s=o.filter(c=>!i.includes(c)).reduce((c,d)=>(c.add(d),c),new Set),a=i.filter(c=>!o.includes(c)).reduce((c,d)=>(c.add(d),c),new Set),l=new Set;for(let c of i){if(a.has(c))continue;let d=r.get(c),u=t.get(c);(!u||!l1(d,u,n,!0))&&l.add(c)}return{added:s,removed:a,updated:l}}function l1(r,t,e,n){return!(r.disabled!==t.disabled||!!r.isApplicationScoped!=!!t.isApplicationScoped||n&&r.installed!==t.installed||r.installed&&t.installed&&(r.preRelease!==t.preRelease||r.pinned!==t.pinned||t.pinned&&r.version!==t.version)||!bR(r.state,t.state)||e&&r.version!==t.version)}function SR(r,t,e){let n=r.state,i=t.state,o=e?.state;if(!t.version||n&&la(r.version,t.version))return n;if(i&&la(t.version,r.version)||!n)return i;if(!i)return n;let s=Ht(n),a=o?_y(o,i):{added:Object.keys(i).reduce((c,d)=>(c.add(d),c),new Set),removed:new Set,updated:new Set},l=o?_y(o,n):{added:Object.keys(n).reduce((c,d)=>(c.add(d),c),new Set),removed:new Set,updated:new Set};for(let c of[...a.added.values(),...a.updated.values()])s[c]=i[c];for(let c of a.removed.values())l.updated.has(c)||delete s[c];return s}function _y(r,t){let e=Object.keys(r),n=Object.keys(t),i=n.filter(a=>!e.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),o=e.filter(a=>!n.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),s=new Set;for(let a of e){if(o.has(a))continue;let l=r[a],c=t[a];dt(l,c)||s.add(a)}return{added:i,removed:o,updated:s}}function bR(r={},t={}){let{added:e,removed:n,updated:i}=_y(r,t);return e.size===0&&n.size===0&&i.size===0}function Dy(r){return{...r,disabled:!!r.disabled,installed:!!r.installed}}function Mc(r,t){let e={...r,identifier:{id:r.identifier.id,uuid:t.startsWith("uuid:")?t.substring(5):void 0},preRelease:!!r.preRelease,pinned:!!r.pinned};return r.disabled||delete e.disabled,r.installed||delete e.installed,r.state||delete e.state,r.isApplicationScoped||delete e.isApplicationScoped,e}var Zi=M("IUserDataProfileStorageService"),Bc=class extends _{constructor(e,n){super();this.storageService=n;e&&(this.storageServicesMap=this._register(new ar))}_serviceBrand;storageServicesMap;async readStorageData(e){return this.withProfileScopedStorageService(e,async n=>this.getItems(n))}async updateStorageData(e,n,i){return this.withProfileScopedStorageService(e,async o=>this.writeItems(o,n,i))}async withProfileScopedStorageService(e,n){if(this.storageService.hasScope(e))return n(this.storageService);let i=this.storageServicesMap?.get(e.id);if(!i){i=new ky(this.createStorageDatabase(e)),this.storageServicesMap?.set(e.id,i);try{await i.initialize()}catch(o){throw this.storageServicesMap?.has(e.id)?this.storageServicesMap.deleteAndDispose(e.id):i.dispose(),o}}try{let o=await n(i);return await i.flush(),o}finally{this.storageServicesMap?.has(e.id)||i.dispose()}}getItems(e){let n=new Map,i=o=>{for(let s of e.keys(0,o))n.set(s,{value:e.get(s,0),target:o})};return i(0),i(1),n}writeItems(e,n,i){e.storeAll(Array.from(n.entries()).map(([o,s])=>({key:o,value:s,scope:0,target:i})),!0)}};Bc=E([m(1,X)],Bc);var Sp=class extends Bc{constructor(e,n,i,o,s){super(e,o);this.remoteService=n;let a=n.getChannel("profileStorageListener"),l=this._register(new zt);this._onDidChange=this._register(new P({onWillAddFirstListener:()=>{l.value=a.listen("onDidChange")(c=>{s.trace("profile storage changes",c),this._onDidChange.fire({targetChanges:c.targetChanges.map(d=>ln(d,i.profilesHome.scheme)),valueChanges:c.valueChanges.map(d=>({...d,profile:ln(d.profile,i.profilesHome.scheme)}))})})},onDidRemoveLastListener:()=>l.value=void 0})),this.onDidChange=this._onDidChange.event}_onDidChange;onDidChange;async createStorageDatabase(e){let n=this.remoteService.getChannel("storage");return aa(e)?new Ns(n):new Bs(n,e)}},ky=class extends sa{constructor(e){super({flushInterval:100});this.profileStorageDatabase=e}profileStorage;async doInitialize(){let e=await this.profileStorageDatabase,n=new ei(e);return this._register(n.onDidChangeStorage(i=>{this.emitDidChangeValue(0,i)})),this._register(J(()=>{n.close(),n.dispose(),wd(e)&&e.dispose()})),this.profileStorage=n,this.profileStorage.init()}getStorage(e){return e===0?this.profileStorage:void 0}getLogDetails(){}async switchToProfile(){}async switchToWorkspace(){}hasScope(){return!1}};async function xp(r,t){let e=JSON.parse(r.content);if(r.version===1||r.version===2){let n=(await t.getInstalled(0)).filter(i=>i.isBuiltin);for(let i of e)r.version===1&&(i.enabled===!1&&(i.disabled=!0),delete i.enabled),r.version===2&&n.every(o=>!Y(o.identifier,i.identifier))&&(i.installed=!0)}return e}function c1(r){return JSON.parse(r.content)}function Ep(r,t){return r.sort((e,n)=>!e.identifier.uuid&&n.identifier.uuid?-1:e.identifier.uuid&&!n.identifier.uuid?1:vo(e.identifier.id,n.identifier.id)),t?ni(r,{}):JSON.stringify(r)}var Na=class extends Wn{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v,y,I,x,T){super({syncResource:"extensions",profile:e},n,o,i,s,a,l,h,v,u,f,I);this.extensionManagementService=c;this.ignoredExtensionsManagementService=d;this.instantiationService=T;this.localExtensionsProvider=this.instantiationService.createInstance(zo),this._register(O.any(O.filter(this.extensionManagementService.onDidInstallExtensions,R=>R.some(({local:w})=>!!w)),O.filter(this.extensionManagementService.onDidUninstallExtension,R=>!R.error),O.filter(x.onDidChange,R=>R.valueChanges.some(({profile:w,changes:L})=>this.syncResource.profile.id===w.id&&L.some(Q=>Q.key===oc))),y.onDidChangeExtensionStorageToSync)(()=>this.triggerLocalChange()))}version=6;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"extensions.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});localExtensionsProvider;async generateSyncPreview(e,n){let i=e.syncData?await xp(e.syncData,this.extensionManagementService):null,o=n?.skippedExtensions??[],s=n?.builtinExtensions??null,a=n?.syncData?await xp(n.syncData,this.extensionManagementService):null,{localExtensions:l,ignoredExtensions:c}=await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);i?this.logService.trace(`${this.syncResourceLogLabel}: Merging remote extensions with local extensions...`):this.logService.trace(`${this.syncResourceLogLabel}: Remote extensions does not exist. Synchronizing extensions for the first time.`);let{local:d,remote:u}=Nc(l,i,a,o,c,s),f={local:d,remote:u,content:this.getPreviewContent(l,d.added,d.updated,d.removed),localChange:d.added.length>0||d.removed.length>0||d.updated.length>0?2:0,remoteChange:u!==null?2:0},h=this.stringify(l,!1);return[{skippedExtensions:o,builtinExtensions:s,baseResource:this.baseResource,baseContent:a?this.stringify(a,!1):h,localResource:this.localResource,localContent:h,localExtensions:l,remoteResource:this.remoteResource,remoteExtensions:i,remoteContent:i?this.stringify(i,!1):null,previewResource:this.previewResource,previewResult:f,localChange:f.localChange,remoteChange:f.remoteChange,acceptedResource:this.acceptedResource}]}async hasRemoteChanged(e){let n=e.syncData?await xp(e.syncData,this.extensionManagementService):null,{localExtensions:i,ignoredExtensions:o}=await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile),{remote:s}=Nc(i,n,n,e.skippedExtensions||[],o,e.builtinExtensions||[]);return s!==null}getPreviewContent(e,n,i,o){let s=[...n,...i],a=new Set,l=c=>{a.add(c.id.toLowerCase()),c.uuid&&a.add(c.uuid)};s.forEach(({identifier:c})=>l(c)),o.forEach(l);for(let c of e)a.has(c.identifier.id.toLowerCase())||c.identifier.uuid&&a.has(c.identifier.uuid)||s.push(c);return this.stringify(s,!1)}async getMergeResult(e,n){return{...e.previewResult,hasConflicts:!1}}async getAcceptResult(e,n,i,o){if(this.extUri.isEqual(n,this.localResource))return this.acceptLocal(e);if(this.extUri.isEqual(n,this.remoteResource))return this.acceptRemote(e);if(this.extUri.isEqual(n,this.previewResource))return e.previewResult;throw new Error(`Invalid Resource: ${n.toString()}`)}async acceptLocal(e){let n=await this.extensionManagementService.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.ignoredExtensionsManagementService.getIgnoredExtensions(n),o=Nc(e.localExtensions,null,null,e.skippedExtensions,i,e.builtinExtensions),{local:s,remote:a}=o;return{content:e.localContent,local:s,remote:a,localChange:s.added.length>0||s.removed.length>0||s.updated.length>0?2:0,remoteChange:a!==null?2:0}}async acceptRemote(e){let n=await this.extensionManagementService.getInstalled(void 0,this.syncResource.profile.extensionsResource),i=this.ignoredExtensionsManagementService.getIgnoredExtensions(n),o=e.remoteContent?JSON.parse(e.remoteContent):null;if(o!==null){let s=Nc(e.localExtensions,o,e.localExtensions,[],i,e.builtinExtensions),{local:a,remote:l}=s;return{content:e.remoteContent,local:a,remote:l,localChange:a.added.length>0||a.removed.length>0||a.updated.length>0?2:0,remoteChange:l!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async applyResult(e,n,i,o){let{skippedExtensions:s,builtinExtensions:a,localExtensions:l}=i[0][0],{local:c,remote:d,localChange:u,remoteChange:f}=i[0][1];if(u===0&&f===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing extensions.`),u!==0&&(await this.backupLocal(JSON.stringify(l)),s=await this.localExtensionsProvider.updateLocalExtensions(c.added,c.removed,c.updated,s,this.syncResource.profile)),d){this.logService.trace(`${this.syncResourceLogLabel}: Updating remote extensions...`);let h=JSON.stringify(d.all);e=await this.updateRemoteUserData(h,o?null:e.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote extensions.${d.added.length?` Added: ${JSON.stringify(d.added.map(v=>v.identifier.id))}.`:""}${d.updated.length?` Updated: ${JSON.stringify(d.updated.map(v=>v.identifier.id))}.`:""}${d.removed.length?` Removed: ${JSON.stringify(d.removed.map(v=>v.identifier.id))}.`:""}`)}n?.ref!==e.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized extensions...`),a=this.computeBuiltinExtensions(l,a),await this.updateLastSyncUserData(e,{skippedExtensions:s,builtinExtensions:a}),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized extensions.${s.length?` Skipped: ${JSON.stringify(s.map(h=>h.identifier.id))}.`:""}`))}computeBuiltinExtensions(e,n){let i=new Set,o=[];for(let s of e)i.add(s.identifier.id.toLowerCase()),s.installed||o.push(s.identifier);if(n)for(let s of n)i.has(s.id.toLowerCase())||o.push(s);return o}async resolveContent(e){if(this.extUri.isEqual(this.remoteResource,e)||this.extUri.isEqual(this.baseResource,e)||this.extUri.isEqual(this.localResource,e)||this.extUri.isEqual(this.acceptedResource,e)){let n=await this.resolvePreviewContent(e);return n&&this.stringify(JSON.parse(n),!0)}return null}stringify(e,n){return Ep(e,n)}async hasLocalData(){try{let{localExtensions:e}=await this.localExtensionsProvider.getLocalExtensions(this.syncResource.profile);if(e.some(n=>n.installed||n.disabled))return!0}catch{}return!1}};Na=E([m(2,oe),m(3,G),m(4,X),m(5,je),m(6,yt),m(7,an),m(8,Ca),m(9,Ie),m(10,ue),m(11,it),m(12,le),m(13,Ta),m(14,he),m(15,Zi),m(16,Ot)],Na);var zo=class{constructor(t,e,n,i,o,s){this.extensionManagementService=t;this.userDataProfileStorageService=e;this.extensionGalleryService=n;this.ignoredExtensionsManagementService=i;this.instantiationService=o;this.logService=s}async getLocalExtensions(t){let e=await this.extensionManagementService.getInstalled(void 0,t.extensionsResource),n=this.ignoredExtensionsManagementService.getIgnoredExtensions(e);return{localExtensions:await this.withProfileScopedServices(t,async(o,s)=>{let a=o.getDisabledExtensions();return e.map(l=>{let{identifier:c,isBuiltin:d,manifest:u,preRelease:f,pinned:h,isApplicationScoped:v}=l,y={identifier:c,preRelease:f,version:u.version,pinned:!!h};v&&!rc(u)&&(y.isApplicationScoped=v),a.some(I=>Y(I,c))&&(y.disabled=!0),d||(y.installed=!0);try{let I=s.getKeysForSync({id:c.id,version:u.version});if(I){let x=s.getExtensionState(l,!0)||{};y.state=Object.keys(x).reduce((T,R)=>(I.includes(R)&&(T[R]=x[R]),T),{})}}catch(I){this.logService.info(`${Ma("extensions",t)}: Error while parsing extension state`,me(I))}return y})}),ignoredExtensions:n}}async updateLocalExtensions(t,e,n,i,o){let s=Ma("extensions",o),a=[],l=new Map,c=[],d=[],u=await this.extensionManagementService.getInstalled(void 0,o.extensionsResource);if((t.length||n.length)&&await this.withProfileScopedServices(o,async(v,y)=>{await Qe.settled([...t,...n].map(async I=>{let x=u.find(w=>Y(w.identifier,I.identifier));if(x&&x.isBuiltin){I.state&&x.manifest.version===I.version&&this.updateExtensionState(I.state,x,x.manifest.version,y),v.getDisabledExtensions().some(L=>Y(L,I.identifier))!==!!I.disabled&&(I.disabled?(this.logService.trace(`${s}: Disabling extension...`,I.identifier.id),await v.disableExtension(I.identifier),this.logService.info(`${s}: Disabled extension`,I.identifier.id)):(this.logService.trace(`${s}: Enabling extension...`,I.identifier.id),await v.enableExtension(I.identifier),this.logService.info(`${s}: Enabled extension`,I.identifier.id))),c.push(I.identifier);return}let T=I.pinned?I.version:void 0,R=(await this.extensionGalleryService.getExtensions([{...I.identifier,version:T,preRelease:T?void 0:I.preRelease}],ee.None))[0];if(I.state&&(x?x.manifest.version===I.version:R)&&this.updateExtensionState(I.state,x||R,x?.manifest.version,y),R)try{v.getDisabledExtensions().some(L=>Y(L,I.identifier))!==!!I.disabled&&(I.disabled?(this.logService.trace(`${s}: Disabling extension...`,I.identifier.id,R.version),await v.disableExtension(R.identifier),this.logService.info(`${s}: Disabled extension`,I.identifier.id,R.version)):(this.logService.trace(`${s}: Enabling extension...`,I.identifier.id,R.version),await v.enableExtension(R.identifier),this.logService.info(`${s}: Enabled extension`,I.identifier.id,R.version))),(!x||x.preRelease!==I.preRelease||x.pinned!==I.pinned||T&&x.manifest.version!==T)&&(await this.extensionManagementService.canInstall(R)?(a.push({extension:R,options:{isMachineScoped:!1,donotIncludePackAndDependencies:!0,installGivenVersion:I.pinned&&!!I.version,pinned:I.pinned,installPreReleaseVersion:I.preRelease,profileLocation:o.extensionsResource,isApplicationScoped:I.isApplicationScoped,context:{[jS]:!0,[ic]:"settingsSync"}}}),l.set(R.identifier.id.toLowerCase(),I)):(this.logService.info(`${s}: Skipped synchronizing extension because it cannot be installed.`,R.displayName||R.identifier.id),d.push(I)))}catch(w){d.push(I),this.logService.error(w),this.logService.info(`${s}: Skipped synchronizing extension`,R.displayName||R.identifier.id)}else d.push(I),this.logService.info(`${s}: Skipped synchronizing extension because the extension is not found.`,I.identifier.id)}))}),e.length){let v=u.filter(({identifier:y,isBuiltin:I})=>!I&&e.some(x=>Y(y,x)));await Qe.settled(v.map(async y=>{this.logService.trace(`${s}: Uninstalling local extension...`,y.identifier.id),await this.extensionManagementService.uninstall(y,{donotIncludePack:!0,donotCheckDependents:!0,profileLocation:o.extensionsResource}),this.logService.info(`${s}: Uninstalled local extension.`,y.identifier.id),c.push(y.identifier)}))}let f=await this.extensionManagementService.installGalleryExtensions(a);for(let{identifier:v,local:y,error:I,source:x}of f){let T=x;if(y)this.logService.info(`${s}: Installed extension.`,v.id,T.version),c.push(v);else{let R=l.get(v.id.toLowerCase());R&&(d.push(R),this.logService.info(`${s}: Skipped synchronizing extension`,T.displayName||T.identifier.id)),I instanceof Xe&&["Incompatible","IncompatibleApi","IncompatibleTargetPlatform"].includes(I.code)?this.logService.info(`${s}: Skipped synchronizing extension because the compatible extension is not found.`,T.displayName||T.identifier.id):I&&this.logService.error(I)}}let h=[];for(let v of i)c.some(y=>Y(y,v.identifier))||h.push(v);for(let v of d)h.some(y=>Y(y.identifier,v.identifier))||h.push(v);return h}updateExtensionState(t,e,n,i){let o=i.getExtensionState(e,!0)||{},s=n?i.getKeysForSync({id:e.identifier.id,version:n}):void 0;s?s.forEach(a=>{o[a]=t[a]}):Object.keys(t).forEach(a=>o[a]=t[a]),i.setExtensionState(e,o,!0)}async withProfileScopedServices(t,e){return this.userDataProfileStorageService.withProfileScopedStorageService(t,async n=>{let i=new te,o=i.add(this.instantiationService.createChild(new Di([X,n]))),s=i.add(o.createInstance($i)),a=i.add(o.createInstance(Vt));try{return await e(s,a)}finally{i.dispose()}})}};zo=E([m(0,an),m(1,Zi),m(2,Bt),m(3,Ca),m(4,Ot),m(5,Ie)],zo);var bp=class extends cn{constructor(e,n,i,o,s,a,l,c){super("extensions",o,s,a,i,l,c);this.extensionManagementService=e;this.ignoredExtensionsManagementService=n}async parseExtensions(e){return e.syncData?await xp(e.syncData,this.extensionManagementService):null}generatePreview(e,n){let i=[],o=[],s=[];for(let a of e){if(this.ignoredExtensionsManagementService.hasToNeverSyncExtension(a.identifier.id))continue;let l=n.find(c=>Y(c.identifier,a.identifier));l?(i.push(l),a.disabled&&s.push(a.identifier)):a.installed&&(o.push({...a.identifier,preRelease:!!a.preRelease}),a.disabled&&s.push(a.identifier))}return{installedExtensions:i,newExtensions:o,disabledExtensions:s,remoteExtensions:e}}};bp=E([m(0,an),m(1,Ca),m(2,G),m(3,ge),m(4,oe),m(5,z),m(6,X),m(7,he)],bp);function tn(r,t,e,n){let i=ea(r,t,e,n)[0];return i&&(r=r.substring(0,i.offset)+i.content+r.substring(i.offset+i.length)),r}function Pp(r,t,e,n,i){if(!t)return{remote:{added:Object.keys(r),removed:[],updated:[],all:Object.keys(r).length>0?r:null},local:{added:{},removed:[],updated:{}}};let o=wp(r,t);if(o.added.size===0&&o.removed.size===0&&o.updated.size===0)return{remote:{added:[],removed:[],updated:[],all:null},local:{added:{},removed:[],updated:{}}};let s=e?wp(e,t):{added:Object.keys(t).reduce((f,h)=>(f.add(h),f),new Set),removed:new Set,updated:new Set},a=e?wp(e,r):{added:Object.keys(r).reduce((f,h)=>(f.add(h),f),new Set),removed:new Set,updated:new Set},l={added:{},removed:[],updated:{}},c=Ht(t),d=!e;for(let f of a.added.values())f!==br&&d&&s.added.has(f)||(c[f]=r[f]);for(let f of a.updated.values())c[f]=r[f];for(let f of a.removed.values())n.unregistered.includes(f)||delete c[f];for(let f of s.added.values()){let h=t[f];if(n.machine.includes(f)){i.info(`GlobalState: Skipped adding ${f} in local storage because it is declared as machine scoped.`);continue}if(e&&a.added.has(f))continue;let v=r[f];v&&v.value===h.value||f===br&&d&&a.added.has(f)||(v?l.updated[f]=h:l.added[f]=h)}for(let f of s.updated.values()){let h=t[f];if(n.machine.includes(f)){i.info(`GlobalState: Skipped updating ${f} in local storage because it is declared as machine scoped.`);continue}if(a.updated.has(f)||a.removed.has(f))continue;let v=r[f];v&&v.value===h.value||(l.updated[f]=h)}for(let f of s.removed.values()){if(n.machine.includes(f)){i.trace(`GlobalState: Skipped removing ${f} in local storage because it is declared as machine scoped.`);continue}a.updated.has(f)||a.removed.has(f)||l.removed.push(f)}let u=wp(t,c);return{local:l,remote:{added:[...u.added],updated:[...u.updated],removed:[...u.removed],all:u.added.size===0&&u.removed.size===0&&u.updated.size===0?null:c}}}function wp(r,t){let e=Object.keys(r),n=Object.keys(t),i=n.filter(a=>!e.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),o=e.filter(a=>!n.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),s=new Set;for(let a of e){if(o.has(a))continue;let l=r[a],c=t[a];dt(l,c)||s.add(a)}return{added:i,removed:o,updated:s}}var Ho="globalState.argv.",xR=["locale"];function to(r,t){let e=r.storage?Object.keys(r.storage).sort():[],n={};return e.forEach(i=>n[i]=r.storage[i]),r.storage=n,t?ni(r,{}):JSON.stringify(r)}var Uy=1,Ba=class extends Wn{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v,y){super({syncResource:"globalState",profile:e},n,o,c,h,s,a,d,u,l,f,v);this.userDataProfileStorageService=i;this.localGlobalStateProvider=y.createInstance(qo),this._register(o.watch(this.extUri.dirname(this.environmentService.argvResource))),this._register(O.any(O.filter(o.onDidFilesChange,I=>I.contains(this.environmentService.argvResource)),O.filter(i.onDidChange,I=>!!(I.targetChanges.some(x=>this.syncResource.profile.id===x.id)||I.valueChanges.some(({profile:x,changes:T})=>this.syncResource.profile.id===x.id&&T.some(R=>R.target===0)))))(()=>this.triggerLocalChange()))}version=Uy;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"globalState.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});localGlobalStateProvider;async generateSyncPreview(e,n,i){let o=e.syncData?JSON.parse(e.syncData.content):null;n=n===null&&i?e:n;let s=n&&n.syncData?JSON.parse(n.syncData.content):null,a=await this.localGlobalStateProvider.getLocalGlobalState(this.syncResource.profile);o?this.logService.trace(`${this.syncResourceLogLabel}: Merging remote ui state with local ui state...`):this.logService.trace(`${this.syncResourceLogLabel}: Remote ui state does not exist. Synchronizing ui state for the first time.`);let l=await this.getStorageKeys(s),{local:c,remote:d}=Pp(a.storage,o?o.storage:null,s?s.storage:null,l,this.logService),u={content:null,local:c,remote:d,localChange:Object.keys(c.added).length>0||Object.keys(c.updated).length>0||c.removed.length>0?2:0,remoteChange:d.all!==null?2:0},f=to(a,!1);return[{baseResource:this.baseResource,baseContent:s?to(s,!1):f,localResource:this.localResource,localContent:f,localUserData:a,remoteResource:this.remoteResource,remoteContent:o?to(o,!1):null,previewResource:this.previewResource,previewResult:u,localChange:u.localChange,remoteChange:u.remoteChange,acceptedResource:this.acceptedResource,storageKeys:l}]}async hasRemoteChanged(e){let n=e.syncData?JSON.parse(e.syncData.content):null;if(n===null)return!0;let i=await this.localGlobalStateProvider.getLocalGlobalState(this.syncResource.profile),o=await this.getStorageKeys(n),{remote:s}=Pp(i.storage,n.storage,n.storage,o,this.logService);return s.all!==null}async getMergeResult(e,n){return{...e.previewResult,hasConflicts:!1}}async getAcceptResult(e,n,i,o){if(this.extUri.isEqual(n,this.localResource))return this.acceptLocal(e);if(this.extUri.isEqual(n,this.remoteResource))return this.acceptRemote(e);if(this.extUri.isEqual(n,this.previewResource))return e.previewResult;throw new Error(`Invalid Resource: ${n.toString()}`)}async acceptLocal(e){return{content:e.localContent,local:{added:{},removed:[],updated:{}},remote:{added:Object.keys(e.localUserData.storage),removed:[],updated:[],all:e.localUserData.storage},localChange:0,remoteChange:2}}async acceptRemote(e){if(e.remoteContent!==null){let n=JSON.parse(e.remoteContent),{local:i,remote:o}=Pp(e.localUserData.storage,n.storage,null,e.storageKeys,this.logService);return{content:e.remoteContent,local:i,remote:o,localChange:Object.keys(i.added).length>0||Object.keys(i.updated).length>0||i.removed.length>0?2:0,remoteChange:o!==null?2:0}}else return{content:e.remoteContent,local:{added:{},removed:[],updated:{}},remote:{added:[],removed:[],updated:[],all:null},localChange:0,remoteChange:0}}async applyResult(e,n,i,o){let{localUserData:s}=i[0][0],{local:a,remote:l,localChange:c,remoteChange:d}=i[0][1];if(c===0&&d===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing ui state.`),c!==0&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating local ui state...`),await this.backupLocal(JSON.stringify(s)),await this.localGlobalStateProvider.writeLocalGlobalState(a,this.syncResource.profile),this.logService.info(`${this.syncResourceLogLabel}: Updated local ui state`)),d!==0){this.logService.trace(`${this.syncResourceLogLabel}: Updating remote ui state...`);let u=JSON.stringify({storage:l.all});e=await this.updateRemoteUserData(u,o?null:e.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote ui state.${l.added.length?` Added: ${l.added}.`:""}${l.updated.length?` Updated: ${l.updated}.`:""}${l.removed.length?` Removed: ${l.removed}.`:""}`)}n?.ref!==e.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized ui state...`),await this.updateLastSyncUserData(e),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized ui state`))}async resolveContent(e){if(this.extUri.isEqual(this.remoteResource,e)||this.extUri.isEqual(this.baseResource,e)||this.extUri.isEqual(this.localResource,e)||this.extUri.isEqual(this.acceptedResource,e)){let n=await this.resolvePreviewContent(e);return n&&to(JSON.parse(n),!0)}return null}async hasLocalData(){try{let{storage:e}=await this.localGlobalStateProvider.getLocalGlobalState(this.syncResource.profile);if(Object.keys(e).length>1||e[`${Ho}.locale`]?.value!=="en")return!0}catch{}return!1}async getStorageKeys(e){let n=await this.userDataProfileStorageService.readStorageData(this.syncResource.profile),i=[],o=[];for(let[l,c]of n)c.target===0?i.push(l):c.target===1&&o.push(l);let s=[...i,...o],a=e?.storage?Object.keys(e.storage).filter(l=>!l.startsWith(Ho)&&!s.includes(l)&&n.get(l)!==void 0):[];if(!qe){let l=[...Br.map(c=>Da(c)),br];a.push(...l),o.push(...l)}return{user:i,machine:o,unregistered:a}}};Ba=E([m(2,Zi),m(3,G),m(4,je),m(5,yt),m(6,Ie),m(7,oe),m(8,it),m(9,le),m(10,ue),m(11,X),m(12,he),m(13,Ot)],Ba);var qo=class{constructor(t,e,n,i){this.fileService=t;this.environmentService=e;this.userDataProfileStorageService=n;this.logService=i}async getLocalGlobalState(t){let e={};if(t.isDefault){let i=await this.getLocalArgvContent(),o=Ze(i);for(let s of xR)o[s]!==void 0&&(e[`${Ho}${s}`]={version:1,value:o[s]})}let n=await this.userDataProfileStorageService.readStorageData(t);for(let[i,o]of n)o.value&&o.target===0&&(e[i]={version:1,value:o.value});return{storage:e}}async getLocalArgvContent(){try{this.logService.debug("GlobalStateSync#getLocalArgvContent",this.environmentService.argvResource);let t=await this.fileService.readFile(this.environmentService.argvResource);return this.logService.debug("GlobalStateSync#getLocalArgvContent - Resolved",this.environmentService.argvResource),t.value.toString()}catch(t){this.logService.debug(me(t))}return"{}"}async writeLocalGlobalState({added:t,removed:e,updated:n},i){let o=Ma("globalState",i),s={},a=new Map,l=await this.userDataProfileStorageService.readStorageData(i),c=(d,u)=>{for(let f of d){if(f.startsWith(Ho)){s[f.substring(Ho.length)]=u?u[f].value:void 0;continue}if(u){let h=u[f];h.value!==l.get(f)?.value&&a.set(f,h.value)}else l.get(f)!==void 0&&a.set(f,void 0)}};if(c(Object.keys(t),t),c(Object.keys(n),n),c(e),Object.keys(s).length){this.logService.trace(`${o}: Updating locale...`);let d=await this.getLocalArgvContent(),u=d;for(let f of Object.keys(s))u=tn(u,[f],s[f],{});d!==u&&(this.logService.trace(`${o}: Updating locale...`),await this.fileService.writeFile(this.environmentService.argvResource,A.fromString(u)),this.logService.info(`${o}: Updated locale.`)),this.logService.info(`${o}: Updated locale`)}a.size&&(this.logService.trace(`${o}: Updating global state...`),await this.userDataProfileStorageService.updateStorageData(i,a,0),this.logService.info(`${o}: Updated global state`,[...a.keys()]))}};qo=E([m(0,G),m(1,oe),m(2,Zi),m(3,Ie)],qo);var Tp=class extends cn{constructor(t,e,n,i,o,s){super("globalState",n,i,o,e,t,s)}async doInitialize(t){let e=t.syncData?JSON.parse(t.syncData.content):null;if(!e){this.logService.info("Skipping initializing global state because remote global state does not exist.");return}let n={},i={};for(let o of Object.keys(e.storage))o.startsWith(Ho)?n[o.substring(Ho.length)]=e.storage[o].value:this.storageService.get(o,0)===void 0&&(i[o]=e.storage[o].value);if(Object.keys(n).length){let o="{}";try{o=(await this.fileService.readFile(this.environmentService.argvResource)).value.toString()}catch{}for(let s of Object.keys(n))o=tn(o,[s],n[s],{});await this.fileService.writeFile(this.environmentService.argvResource,A.fromString(o))}if(Object.keys(i).length){let o=[];for(let s of Object.keys(i))o.push({key:s,value:i[s],scope:0,target:0});this.storageService.storeAll(o,!0)}}};Tp=E([m(0,X),m(1,G),m(2,ge),m(3,oe),m(4,Ie),m(5,he)],Tp);var Rp=class{constructor(t,e,n,i,o){this.userDataSyncStoreClient=t;this.storageService=e;this.environmentService=n;this.fileService=i;this.logService=o}getSyncStoreType(t){return this.parseGlobalState(t)?.storage[br]?.value}async sync(t){let e=Qi(Fe());try{return await this.doSync(t,e)}catch(n){if(n instanceof Te)switch(n.code){case"PreconditionFailed":return this.logService.info("Failed to synchronize UserDataSyncStoreType as there is a new remote version available. Synchronizing again..."),this.doSync(t,e)}throw n}}async doSync(t,e){let n=await this.userDataSyncStoreClient.readResource("globalState",null,void 0,e),i=this.parseGlobalState(n)||{storage:{}};i.storage[br]={value:t,version:Uy};let o=await Qn(this.environmentService,this.fileService,this.storageService),s={version:Uy,machineId:o,content:to(i,!1)};await this.userDataSyncStoreClient.writeResource("globalState",JSON.stringify(s),n.ref,void 0,e)}parseGlobalState({content:t}){if(!t)return null;let e=JSON.parse(t);if($o(e))return e?JSON.parse(e.content):null;throw new Error("Invalid remote data")}};Rp=E([m(1,X),m(2,oe),m(3,G),m(4,z)],Rp);var FIe=M("keybindingService");function Wc(r){return Ze(r)||[]}async function Ny(r,t,e,n,i){let o=Wc(r),s=Wc(t),a=e?Wc(e):null,l=[...o,...s,...a||[]].map(R=>R.key),c=await i.resolveUserBindings(l),d=ER(o,s,a,c);if(!d.hasLocalForwarded&&!d.hasRemoteForwarded)return{mergeContent:r,hasChanges:!1,hasConflicts:!1};if(!d.hasLocalForwarded&&d.hasRemoteForwarded)return{mergeContent:t,hasChanges:!0,hasConflicts:!1};if(d.hasLocalForwarded&&!d.hasRemoteForwarded)return{mergeContent:r,hasChanges:!0,hasConflicts:!1};let u=Fy(o),f=Fy(s),h=a?Fy(a):null,v=Oy(u,f,c),y=h?Oy(h,u,c):{added:[...u.keys()].reduce((R,w)=>(R.add(w),R),new Set),removed:new Set,updated:new Set},I=h?Oy(h,f,c):{added:[...f.keys()].reduce((R,w)=>(R.add(w),R),new Set),removed:new Set,updated:new Set},x=u1(v,y,I),T=r;for(let R of x.removed.values())x.conflicts.has(R)||(T=TR(T,R,n));for(let R of x.added.values()){if(x.conflicts.has(R))continue;let w=f.get(R);if(w.some(L=>L.command!==`-${R}`&&d.conflicts.has(c[L.key]))){x.conflicts.add(R);continue}T=PR(T,w,n)}for(let R of x.updated.values()){if(x.conflicts.has(R))continue;let w=f.get(R);if(w.some(L=>L.command!==`-${R}`&&d.conflicts.has(c[L.key]))){x.conflicts.add(R);continue}T=RR(T,R,w,n)}return{mergeContent:T,hasChanges:!0,hasConflicts:x.conflicts.size>0}}function u1(r,t,e){let n=new Set,i=new Set,o=new Set,s=new Set;for(let a of t.removed.values())e.updated.has(a)&&s.add(a);for(let a of e.removed.values())s.has(a)||(t.updated.has(a)?s.add(a):i.add(a));for(let a of t.added.values())s.has(a)||e.added.has(a)&&r.updated.has(a)&&s.add(a);for(let a of e.added.values())s.has(a)||(t.added.has(a)?r.updated.has(a)&&s.add(a):n.add(a));for(let a of t.updated.values())s.has(a)||e.updated.has(a)&&r.updated.has(a)&&s.add(a);for(let a of e.updated.values())s.has(a)||(t.updated.has(a)?r.updated.has(a)&&s.add(a):o.add(a));return{added:n,removed:i,updated:o,conflicts:s}}function ER(r,t,e,n){let i=new Set,o=Ly(r,n),s=Ly(t,n),a=e?Ly(e,n):null,l=Ay(o,s);if(l.added.size===0&&l.removed.size===0&&l.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!1,added:i,removed:i,updated:i,conflicts:i};let c=a?Ay(a,o):{added:[...o.keys()].reduce((y,I)=>(y.add(I),y),new Set),removed:new Set,updated:new Set};if(c.added.size===0&&c.removed.size===0&&c.updated.size===0)return{hasLocalForwarded:!1,hasRemoteForwarded:!0,added:i,removed:i,updated:i,conflicts:i};let d=a?Ay(a,s):{added:[...s.keys()].reduce((y,I)=>(y.add(I),y),new Set),removed:new Set,updated:new Set};if(d.added.size===0&&d.removed.size===0&&d.updated.size===0)return{hasLocalForwarded:!0,hasRemoteForwarded:!1,added:i,removed:i,updated:i,conflicts:i};let{added:u,removed:f,updated:h,conflicts:v}=u1(l,c,d);return{hasLocalForwarded:!0,hasRemoteForwarded:!0,added:u,removed:f,updated:h,conflicts:v}}function Ly(r,t){let e=new Map;for(let n of r){let i=t[n.key],o=e.get(i);o||(o=[],e.set(i,o)),o.push(n)}return e}function Fy(r){let t=new Map;for(let e of r){let n=e.command[0]==="-"?e.command.substring(1):e.command,i=t.get(n);i||(i=[],t.set(n,i)),i.push(e)}return t}function Ay(r,t){let e=[...r.keys()],n=[...t.keys()],i=n.filter(a=>!e.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),o=e.filter(a=>!n.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),s=new Set;for(let a of e){if(o.has(a))continue;let l=r.get(a).map(d=>({...d,key:a})),c=t.get(a).map(d=>({...d,key:a}));Pt(l,c,(d,u)=>My(d,u))||s.add(a)}return{added:i,removed:o,updated:s}}function Oy(r,t,e){let n=[...r.keys()],i=[...t.keys()],o=i.filter(l=>!n.includes(l)).reduce((l,c)=>(l.add(c),l),new Set),s=n.filter(l=>!i.includes(l)).reduce((l,c)=>(l.add(c),l),new Set),a=new Set;for(let l of n){if(s.has(l))continue;let c=r.get(l).map(u=>({...u,key:e[u.key]})),d=t.get(l).map(u=>({...u,key:e[u.key]}));wR(c,d)||a.add(l)}return{added:o,removed:s,updated:a}}function wR(r,t){return!(!Pt(r.filter(({command:e})=>e[0]!=="-"),t.filter(({command:e})=>e[0]!=="-"),(e,n)=>My(e,n))||!Pt(r.filter(({command:e})=>e[0]==="-"),t.filter(({command:e})=>e[0]==="-"),(e,n)=>My(e,n)))}function My(r,t){if(r.command!==t.command||r.key!==t.key)return!1;let e=Ut.deserialize(r.when),n=Ut.deserialize(t.when);return!(e&&!n||!e&&n||e&&n&&!e.equals(n)||!dt(r.args,t.args))}function PR(r,t,e){for(let n of t)r=tn(r,[-1],n,e);return r}function TR(r,t,e){let n=Wc(r);for(let i=n.length-1;i>=0;i--)(n[i].command===t||n[i].command===`-${t}`)&&(r=tn(r,[i],void 0,e));return r}function RR(r,t,e,n){let i=Wc(r),o=i.findIndex(s=>s.command===t||s.command===`-${t}`);for(let s=i.length-1;s>=0;s--)(i[s].command===t||i[s].command===`-${t}`)&&(r=tn(r,[s],void 0,n));for(let s=e.length-1;s>=0;s--)r=tn(r,[o],e[s],n);return r}function Vc(r,t,e){try{let n=JSON.parse(r);if(!t)return kt(n.all)?null:n.all;switch(ir){case 2:return kt(n.mac)?null:n.mac;case 3:return kt(n.linux)?null:n.linux;case 1:return kt(n.windows)?null:n.windows}}catch(n){return e.error(n),null}}var Wa=class extends Xi{version=2;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"keybindings.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});constructor(t,e,n,i,o,s,a,l,c,d,u,f,h){super(t.keybindingsResource,{syncResource:"keybindings",profile:t},e,l,c,d,n,i,a,f,o,u,s,h),this._register(O.filter(s.onDidChangeConfiguration,v=>v.affectsConfiguration("settingsSync.keybindingsPerPlatform"))(()=>this.triggerLocalChange()))}async generateSyncPreview(t,e,n,i){let o=t.syncData?Vc(t.syncData.content,i.keybindingsPerPlatform??this.syncKeybindingsPerPlatform(),this.logService):null;e=e===null&&n?t:e;let s=e?this.getKeybindingsContentFromLastSyncUserData(e):null,a=await this.getLocalFileContent(),l=await this.getFormattingOptions(),c=null,d=!1,u=!1,f=!1;if(o){let y=a?a.value.toString():"[]";if(y=y||"[]",this.hasErrors(y,!0))throw new Te(g("errorInvalidSettings","Unable to sync keybindings because the content in the file is not valid. Please open the file and correct it."),"LocalInvalidContent",this.resource);if(!s||s!==y||s!==o){this.logService.trace(`${this.syncResourceLogLabel}: Merging remote keybindings with local keybindings...`);let I=await Ny(y,o,s,l,this.userDataSyncUtilService);I.hasChanges&&(c=I.mergeContent,f=I.hasConflicts,d=f||I.mergeContent!==y,u=f||I.mergeContent!==o)}}else a&&(this.logService.trace(`${this.syncResourceLogLabel}: Remote keybindings does not exist. Synchronizing keybindings for the first time.`),c=a.value.toString(),u=!0);let h={content:f?s:c,localChange:d?a?2:1:0,remoteChange:u?2:0,hasConflicts:f},v=a?a.value.toString():null;return[{fileContent:a,baseResource:this.baseResource,baseContent:s,localResource:this.localResource,localContent:v,localChange:h.localChange,remoteResource:this.remoteResource,remoteContent:o,remoteChange:h.remoteChange,previewResource:this.previewResource,previewResult:h,acceptedResource:this.acceptedResource}]}async hasRemoteChanged(t){let e=this.getKeybindingsContentFromLastSyncUserData(t);if(e===null)return!0;let n=await this.getLocalFileContent(),i=n?n.value.toString():"",o=await this.getFormattingOptions(),s=await Ny(i||"[]",e,e,o,this.userDataSyncUtilService);return s.hasConflicts||s.mergeContent!==e}async getMergeResult(t,e){return t.previewResult}async getAcceptResult(t,e,n,i){if(this.extUri.isEqual(e,this.localResource))return{content:t.fileContent?t.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.extUri.isEqual(e,this.remoteResource))return{content:t.remoteContent,localChange:2,remoteChange:0};if(this.extUri.isEqual(e,this.previewResource))return n===void 0?{content:t.previewResult.content,localChange:t.previewResult.localChange,remoteChange:t.previewResult.remoteChange}:{content:n,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${e.toString()}`)}async applyResult(t,e,n,i){let{fileContent:o}=n[0][0],{content:s,localChange:a,remoteChange:l}=n[0][1];if(a===0&&l===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing keybindings.`),s!==null&&(s=s.trim(),s=s||"[]",this.hasErrors(s,!0)))throw new Te(g("errorInvalidSettings","Unable to sync keybindings because the content in the file is not valid. Please open the file and correct it."),"LocalInvalidContent",this.resource);if(a!==0&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating local keybindings...`),o&&await this.backupLocal(this.toSyncContent(o.value.toString())),await this.updateLocalFileContent(s||"[]",o,i),this.logService.info(`${this.syncResourceLogLabel}: Updated local keybindings`)),l!==0){this.logService.trace(`${this.syncResourceLogLabel}: Updating remote keybindings...`);let c=this.toSyncContent(s||"[]",t.syncData?.content);t=await this.updateRemoteUserData(c,i?null:t.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote keybindings`)}try{await this.fileService.del(this.previewResource)}catch{}e?.ref!==t.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized keybindings...`),await this.updateLastSyncUserData(t,{platformSpecific:this.syncKeybindingsPerPlatform()}),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized keybindings`))}async hasLocalData(){try{let t=await this.getLocalFileContent();if(t){let e=Ze(t.value.toString());if(Si(e))return!0}}catch(t){if(t.fileOperationResult!==1)return!0}return!1}async resolveContent(t){return this.extUri.isEqual(this.remoteResource,t)||this.extUri.isEqual(this.baseResource,t)||this.extUri.isEqual(this.localResource,t)||this.extUri.isEqual(this.acceptedResource,t)?this.resolvePreviewContent(t):null}getKeybindingsContentFromLastSyncUserData(t){return!t.syncData||t.platformSpecific!==void 0&&t.platformSpecific!==this.syncKeybindingsPerPlatform()?null:Vc(t.syncData.content,this.syncKeybindingsPerPlatform(),this.logService)}toSyncContent(t,e){let n={};try{n=JSON.parse(e||"{}")}catch(i){this.logService.error(i)}switch(this.syncKeybindingsPerPlatform()?delete n.all:n.all=t,ir){case 2:n.mac=t;break;case 3:n.linux=t;break;case 1:n.windows=t;break}return JSON.stringify(n)}syncKeybindingsPerPlatform(){return!!this.configurationService.getValue(Fc)}};Wa=E([m(2,je),m(3,yt),m(4,Ie),m(5,ue),m(6,it),m(7,G),m(8,oe),m(9,X),m(10,Ji),m(11,le),m(12,he)],Wa);var Cp=class extends cn{constructor(t,e,n,i,o,s){super("keybindings",e,n,i,t,o,s)}async doInitialize(t){let e=t.syncData?this.getKeybindingsContentFromSyncContent(t.syncData.content):null;if(!e){this.logService.info("Skipping initializing keybindings because remote keybindings does not exist.");return}if(!await this.isEmpty()){this.logService.info("Skipping initializing keybindings because local keybindings exist.");return}await this.fileService.writeFile(this.userDataProfilesService.defaultProfile.keybindingsResource,A.fromString(e)),await this.updateLastSyncUserData(t)}async isEmpty(){try{let t=await this.fileService.readFile(this.userDataProfilesService.defaultProfile.settingsResource),e=Ze(t.value.toString());return!Si(e)}catch(t){return t.fileOperationResult===1}}getKeybindingsContentFromSyncContent(t){try{return Vc(t,!0,this.logService)}catch(e){return this.logService.error(e),null}}};Cp=E([m(0,G),m(1,ge),m(2,oe),m(3,Ie),m(4,X),m(5,he)],Cp);function f1(r,t,e){let n=[];e?n=DR(e):n=CR(t);let i=[],o=[...fp()];if(Array.isArray(n))for(let s of n)s.startsWith("-")?o.push(s.substring(1)):i.push(s);return gt([...r,...i].filter(s=>!o.includes(s)))}function CR(r){let t=r.inspect("settingsSync.ignoredSettings").userValue;return t!==void 0||(t=r.inspect("sync.ignoredSettings").userValue,t!==void 0)?t:r.getValue("settingsSync.ignoredSettings")||[]}function DR(r){let t=Ze(r);return t?t["settingsSync.ignoredSettings"]||t["sync.ignoredSettings"]||[]:[]}function Vr(r,t,e,n){if(e.length){let i=Ka(t),o=Ze(t)||{},s=Ze(r);if(!s)return r;let a=[];for(let l of e){let c=o[l],d=s[l];c===void 0?r=tn(r,[l],void 0,n):d!==void 0?r=tn(r,[l],c,n):a.push(Kc(l,i))}a.sort((l,c)=>l.startOffset-c.startOffset),a.forEach(l=>r=Wy(l.setting.key,t,r,n))}return r}function Ky(r,t,e,n,i,o){let s=Vr(r,t,n,o),a=e!==s,l=e!==t;if(!a&&!l)return{conflictsSettings:[],localContent:null,remoteContent:null,hasConflicts:!1};if(a&&!l)return{conflictsSettings:[],localContent:null,remoteContent:s,hasConflicts:!1};if(l&&!a)return{conflictsSettings:[],localContent:Vr(t,r,n,o),remoteContent:null,hasConflicts:!1};if(e===null&&Up(r)){let U=Dp(r,t,n)?null:Vr(t,r,n,o);return{conflictsSettings:[],localContent:U,remoteContent:null,hasConflicts:!1}}let c=r,d=t,u=Ze(r),f=Ze(t),h=e?Ze(e):null,v=n.reduce((U,B)=>(U.add(B),U),new Set),y=By(u,f,v),I=By(h,u,v),x=By(h,f,v),T=new Map,R=new Set,w=U=>{R.add(U);let B=i.filter(({key:Ee})=>Ee===U)[0];B?(c=tn(c,[U],B.value,o),d=tn(d,[U],B.value,o)):T.set(U,{key:U,localValue:u[U],remoteValue:f[U]})};for(let U of I.removed.values())x.updated.has(U)?w(U):d=tn(d,[U],void 0,o);for(let U of x.removed.values())R.has(U)||(I.updated.has(U)?w(U):c=tn(c,[U],void 0,o));for(let U of I.updated.values())R.has(U)||(x.updated.has(U)?y.updated.has(U)&&w(U):d=tn(d,[U],u[U],o));for(let U of x.updated.values())R.has(U)||(I.updated.has(U)?y.updated.has(U)&&w(U):c=tn(c,[U],f[U],o));for(let U of I.added.values())R.has(U)||(x.added.has(U)?y.updated.has(U)&&w(U):d=Wy(U,c,d,o));for(let U of x.added.values())R.has(U)||(I.added.has(U)?y.updated.has(U)&&w(U):c=Wy(U,d,c,o));let L=T.size>0||!Dp(c,d,n),Q=L||!Dp(c,r,[]),K=L||!Dp(d,t,[]);return{localContent:Q?c:null,remoteContent:K?d:null,conflictsSettings:[...T.values()],hasConflicts:L}}function Dp(r,t,e){if(r===t)return!0;let n=Ze(r),i=Ze(t),o=e.reduce((l,c)=>(l.add(c),l),new Set),s=Ka(r).filter(l=>!(l.setting&&o.has(l.setting.key))),a=Ka(t).filter(l=>!(l.setting&&o.has(l.setting.key)));if(s.length!==a.length)return!1;for(let l=0;l<s.length;l++){let c=s[l],d=a[l];if(c.setting&&d.setting){if(c.setting.key!==d.setting.key||!dt(n[c.setting.key],i[c.setting.key]))return!1}else if(!c.setting&&!d.setting){if(c.value!==d.value)return!1}else return!1}return!0}function Up(r){return r?Ka(r).length===0:!0}function By(r,t,e){let n=r?Object.keys(r).filter(l=>!e.has(l)):[],i=Object.keys(t).filter(l=>!e.has(l)),o=i.filter(l=>!n.includes(l)).reduce((l,c)=>(l.add(c),l),new Set),s=n.filter(l=>!i.includes(l)).reduce((l,c)=>(l.add(c),l),new Set),a=new Set;if(r)for(let l of n){if(s.has(l))continue;let c=r[l],d=t[l];dt(c,d)||a.add(l)}return{added:o,removed:s,updated:a}}function Wy(r,t,e,n){let i=Ze(t),o=Ka(t),s=Ka(e),a=_R(r,o,s);return kR(e,r,i[r],a,s,n)}function _R(r,t,e){let n=t.findIndex(o=>o.setting?.key===r),i=t[n-1];if(i){if(i.setting){let s=Kc(i.setting.key,e);if(s)return{index:e.indexOf(s),insertAfter:!0}}else{let s=Vy(n,t);if(s){let a=Kc(s.setting.key,e);if(a){let l=kp(e.indexOf(a),e),c=Va(t,s,t[n]);if(l){let d=Va(e,a,l),u=_p(c,d);return u?{index:e.indexOf(u),insertAfter:!0}:{index:e.indexOf(l),insertAfter:!1}}else{let d=Va(e,a,e[e.length-1]),u=_p(c,d);return u?{index:e.indexOf(u),insertAfter:!0}:{index:e.length-1,insertAfter:!0}}}}}let o=t[n+1];if(o)if(o.setting){let s=Kc(o.setting.key,e);if(s)return{index:e.indexOf(s),insertAfter:!1}}else{let s=kp(n,t);if(s){let a=Kc(s.setting.key,e);if(a){let l=Vy(e.indexOf(a),e),c=Va(t,t[n],s);if(l){let d=Va(e,l,a),u=_p(c.reverse(),d.reverse());return u?{index:e.indexOf(u),insertAfter:!1}:{index:e.indexOf(l),insertAfter:!0}}else{let d=Va(e,e[0],a),u=_p(c.reverse(),d.reverse());return u?{index:e.indexOf(u),insertAfter:!1}:{index:0,insertAfter:!1}}}}}}return{index:e.length-1,insertAfter:!0}}function kR(r,t,e,n,i,o){let s;return n.index===-1?s=ea(r,[t],e,o):s=UR(r,t,e,n,i,o).map(a=>Vi(r,a,o)[0]),If(r,s)}function UR(r,t,e,n,i,o){let s=`${JSON.stringify(t)}: ${JSON.stringify(e)}`,a=Wm(o,r),l=i[n.index];if(n.insertAfter){let c=[];if(l.setting)c.push({offset:l.endOffset,length:0,content:","+s});else{let d=kp(n.index,i),u=Vy(n.index,i),f=u?.setting?.commaOffset;u&&f===void 0&&c.push({offset:u.endOffset,length:0,content:","});let h=f!==void 0&&f>l.endOffset;c.push({offset:h?f+1:l.endOffset,length:0,content:d?a+s+",":a+s})}return c}else{if(l.setting)return[{offset:l.startOffset,length:0,content:s+","}];let c=(i[n.index-1]&&!i[n.index-1].setting?a:"")+s+(kp(n.index,i)?",":"")+a;return[{offset:l.startOffset,length:0,content:c}]}}function Kc(r,t){return t.filter(e=>e.setting?.key===r)[0]}function Vy(r,t){for(let e=r-1;e>=0;e--)if(t[e].setting)return t[e]}function kp(r,t){for(let e=r+1;e<t.length;e++)if(t[e].setting)return t[e]}function Va(r,t,e){let n=r.indexOf(t),i=r.indexOf(e);return r.filter((o,s)=>n<s&&s<i)}function _p(r,t){if(r.length&&t.length){let e=0;for(;e<t.length&&e<r.length;e++)if(r[e].value!==t[e].value)return t[e-1];return t[e-1]}}function Ka(r){let t=[],e=-1,n,i;return Zs(r,{onObjectBegin:s=>{e++},onObjectProperty:(s,a,l)=>{e===0&&(n=a,i=s)},onObjectEnd:(s,a)=>{e--,e===0&&t.push({startOffset:n,endOffset:s+a,value:r.substring(n,s+a),setting:{key:i,commaOffset:void 0}})},onArrayBegin:(s,a)=>{e++},onArrayEnd:(s,a)=>{e--,e===0&&t.push({startOffset:n,endOffset:s+a,value:r.substring(n,s+a),setting:{key:i,commaOffset:void 0}})},onLiteralValue:(s,a,l)=>{e===0&&t.push({startOffset:n,endOffset:a+l,value:r.substring(n,a+l),setting:{key:i,commaOffset:void 0}})},onSeparator:(s,a,l)=>{if(e===0&&s===","){let c=t.length-1;for(;c>=0&&!t[c].setting;c--);let d=t[c];d&&t.splice(c,1,{startOffset:d.startOffset,endOffset:d.endOffset,value:d.value,setting:{key:d.setting.key,commaOffset:a}})}},onComment:(s,a)=>{e===0&&t.push({startOffset:s,endOffset:s+a,value:r.substring(s,s+a)})}}),t}function LR(r){return r&&r.settings&&typeof r.settings=="string"&&Object.keys(r).length===1}function Fp(r){let t=JSON.parse(r);return LR(t)?t:{settings:r}}var jo=class extends Xi{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v,y){super(e.settingsResource,{syncResource:"settings",profile:e},n,i,o,s,a,l,f,h,c,d,u,y);this.profile=e;this.extensionManagementService=v}version=2;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"settings.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});async getRemoteUserDataSyncConfiguration(e){let n=await this.getLastSyncUserData(),i=await this.getLatestRemoteUserData(e,n),o=this.getSettingsSyncContent(i),s=new ta(No,this.logService);return o?.settings&&s.parse(o.settings),s.configurationModel.getValue(No)||{}}async generateSyncPreview(e,n,i){let o=await this.getLocalFileContent(),s=await this.getFormattingOptions(),a=this.getSettingsSyncContent(e);n=n===null&&i?e:n;let l=n?this.getSettingsSyncContent(n):null,c=await this.getIgnoredSettings(),d=null,u=!1,f=!1,h=!1;if(a){let x=o?o.value.toString().trim():"{}";x=x||"{}",this.validateContent(x),this.logService.trace(`${this.syncResourceLogLabel}: Merging remote settings with local settings...`);let T=Ky(x,a.settings,l?l.settings:null,c,[],s);d=T.localContent||T.remoteContent,u=T.localContent!==null,f=T.remoteContent!==null,h=T.hasConflicts}else o&&(this.logService.trace(`${this.syncResourceLogLabel}: Remote settings does not exist. Synchronizing settings for the first time.`),d=o.value.toString().trim()||"{}",this.validateContent(d),f=!0);let v=o?o.value.toString():null,y=l?.settings??null,I={content:h?y:d,localChange:u?2:0,remoteChange:f?2:0,hasConflicts:h};return[{fileContent:o,baseResource:this.baseResource,baseContent:y,localResource:this.localResource,localContent:v,localChange:I.localChange,remoteResource:this.remoteResource,remoteContent:a?a.settings:null,remoteChange:I.remoteChange,previewResource:this.previewResource,previewResult:I,acceptedResource:this.acceptedResource}]}async hasRemoteChanged(e){let n=this.getSettingsSyncContent(e);if(n===null)return!0;let i=await this.getLocalFileContent(),o=i?i.value.toString().trim():"",s=await this.getIgnoredSettings(),a=await this.getFormattingOptions();return Ky(o||"{}",n.settings,n.settings,s,[],a).remoteContent!==null}async getMergeResult(e,n){let i=await this.getFormattingOptions(),o=await this.getIgnoredSettings();return{...e.previewResult,content:e.previewResult.content?Vr(e.previewResult.content,"{}",o,i):null}}async getAcceptResult(e,n,i,o){let s=await this.getFormattingOptions(),a=await this.getIgnoredSettings();if(this.extUri.isEqual(n,this.localResource))return{content:e.fileContent?Vr(e.fileContent.value.toString(),"{}",a,s):null,localChange:0,remoteChange:2};if(this.extUri.isEqual(n,this.remoteResource))return{content:e.remoteContent!==null?Vr(e.remoteContent,e.fileContent?e.fileContent.value.toString():"{}",a,s):null,localChange:2,remoteChange:0};if(this.extUri.isEqual(n,this.previewResource))return i===void 0?{content:e.previewResult.content,localChange:e.previewResult.localChange,remoteChange:e.previewResult.remoteChange}:{content:i!==null?Vr(i,e.fileContent?e.fileContent.value.toString():"{}",a,s):null,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${n.toString()}`)}async applyResult(e,n,i,o){let{fileContent:s}=i[0][0],{content:a,localChange:l,remoteChange:c}=i[0][1];if(l===0&&c===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing settings.`),a=a?a.trim():"{}",a=a||"{}",this.validateContent(a),l!==0&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating local settings...`),s&&await this.backupLocal(JSON.stringify(this.toSettingsSyncContent(s.value.toString()))),await this.updateLocalFileContent(a,s,o),await this.configurationService.reloadConfiguration(3),this.logService.info(`${this.syncResourceLogLabel}: Updated local settings`)),c!==0){let d=await this.getFormattingOptions(),u=this.getSettingsSyncContent(e),f=await this.getIgnoredSettings(a);a=Vr(a,u?u.settings:"{}",f,d),this.logService.trace(`${this.syncResourceLogLabel}: Updating remote settings...`),e=await this.updateRemoteUserData(JSON.stringify(this.toSettingsSyncContent(a)),o?null:e.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote settings`)}try{await this.fileService.del(this.previewResource)}catch{}n?.ref!==e.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized settings...`),await this.updateLastSyncUserData(e),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized settings`))}async hasLocalData(){try{let e=await this.getLocalFileContent();if(e)return!Up(e.value.toString())}catch(e){if(e.fileOperationResult!==1)return!0}return!1}async resolveContent(e){return this.extUri.isEqual(this.remoteResource,e)||this.extUri.isEqual(this.localResource,e)||this.extUri.isEqual(this.acceptedResource,e)||this.extUri.isEqual(this.baseResource,e)?this.resolvePreviewContent(e):null}async resolvePreviewContent(e){let n=await super.resolvePreviewContent(e);if(n){let i=await this.getFormattingOptions(),o=await this.getIgnoredSettings();n=Vr(n,"{}",o,i)}return n}getSettingsSyncContent(e){return e.syncData?this.parseSettingsSyncContent(e.syncData.content):null}parseSettingsSyncContent(e){try{return Fp(e)}catch(n){this.logService.error(n)}return null}toSettingsSyncContent(e){return{settings:e}}coreIgnoredSettings=void 0;systemExtensionsIgnoredSettings=void 0;userExtensionsIgnoredSettings=void 0;async getIgnoredSettings(e){if(this.coreIgnoredSettings||(this.coreIgnoredSettings=this.userDataSyncUtilService.resolveDefaultCoreIgnoredSettings()),this.systemExtensionsIgnoredSettings||(this.systemExtensionsIgnoredSettings=this.getIgnoredSettingForSystemExtensions()),!this.userExtensionsIgnoredSettings){this.userExtensionsIgnoredSettings=this.getIgnoredSettingForUserExtensions();let i=this._register(O.any(O.filter(this.extensionManagementService.onDidInstallExtensions,o=>o.some(({local:s})=>!!s)),O.filter(this.extensionManagementService.onDidUninstallExtension,o=>!o.error))(()=>{i.dispose(),this.userExtensionsIgnoredSettings=void 0}))}let n=(await Promise.all([this.coreIgnoredSettings,this.systemExtensionsIgnoredSettings,this.userExtensionsIgnoredSettings])).flat();return f1(n,this.configurationService,e)}async getIgnoredSettingForSystemExtensions(){let e=await this.extensionManagementService.getInstalled(0);return gt(e.map(n=>Iy(n.manifest)).flat())}async getIgnoredSettingForUserExtensions(){let e=await this.extensionManagementService.getInstalled(1,this.profile.extensionsResource);return gt(e.map(n=>Iy(n.manifest)).flat())}validateContent(e){if(this.hasErrors(e,!1))throw new Te(g("errorInvalidSettings","Unable to sync settings as there are errors/warning in settings file."),"LocalInvalidContent",this.resource)}};jo=E([m(2,G),m(3,oe),m(4,X),m(5,je),m(6,yt),m(7,Ie),m(8,Ji),m(9,ue),m(10,it),m(11,le),m(12,an),m(13,he)],jo);var Lp=class extends cn{constructor(t,e,n,i,o,s){super("settings",e,n,i,t,o,s)}async doInitialize(t){let e=t.syncData?this.parseSettingsSyncContent(t.syncData.content):null;if(!e){this.logService.info("Skipping initializing settings because remote settings does not exist.");return}if(!await this.isEmpty()){this.logService.info("Skipping initializing settings because local settings exist.");return}await this.fileService.writeFile(this.userDataProfilesService.defaultProfile.settingsResource,A.fromString(e.settings)),await this.updateLastSyncUserData(t)}async isEmpty(){try{let t=await this.fileService.readFile(this.userDataProfilesService.defaultProfile.settingsResource);return Up(t.value.toString().trim())}catch(t){return t.fileOperationResult===1}}parseSettingsSyncContent(t){try{return Fp(t)}catch(e){this.logService.error(e)}return null}};Lp=E([m(0,G),m(1,ge),m(2,oe),m(3,Ie),m(4,X),m(5,he)],Lp);function $y(r,t,e){let n={},i={},o=new Set;if(!t)return{local:{added:n,updated:i,removed:[...o.values()]},remote:{added:r,updated:{},removed:[]},conflicts:[]};let s=Ap(r,t);if(s.added.size===0&&s.removed.size===0&&s.updated.size===0)return{local:{added:n,updated:i,removed:[...o.values()]},remote:{added:{},updated:{},removed:[]},conflicts:[]};let a=Ap(e,r),l=Ap(e,t),c={},d={},u=new Set,f=new Set;for(let h of a.removed.values())l.updated.has(h)?n[h]=t[h]:u.add(h);for(let h of l.removed.values())f.has(h)||(a.updated.has(h)?f.add(h):o.add(h));for(let h of a.updated.values())f.has(h)||(l.updated.has(h)?s.updated.has(h)&&f.add(h):d[h]=r[h]);for(let h of l.updated.values())f.has(h)||(a.updated.has(h)?s.updated.has(h)&&f.add(h):r[h]!==void 0&&(i[h]=t[h]));for(let h of a.added.values())f.has(h)||(l.added.has(h)?s.updated.has(h)&&f.add(h):c[h]=r[h]);for(let h of l.added.values())f.has(h)||(a.added.has(h)?s.updated.has(h)&&f.add(h):n[h]=t[h]);return{local:{added:n,removed:[...o.values()],updated:i},remote:{added:c,removed:[...u.values()],updated:d},conflicts:[...f.values()]}}function Ap(r,t){let e=r?Object.keys(r):[],n=t?Object.keys(t):[],i=n.filter(a=>!e.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),o=e.filter(a=>!n.includes(a)).reduce((a,l)=>(a.add(l),a),new Set),s=new Set;for(let a of e){if(o.has(a))continue;let l=r[a],c=t[a];l!==c&&s.add(a)}return{added:i,removed:o,updated:s}}function p1(r,t){let{added:e,removed:n,updated:i}=Ap(r,t);return e.size===0&&n.size===0&&i.size===0}function Mp(r){return JSON.parse(r.content)}var $a=class extends Wn{version=1;snippetsFolder;constructor(t,e,n,i,o,s,a,l,c,d,u,f){super({syncResource:"snippets",profile:t},e,i,n,o,s,a,d,u,l,c,f),this.snippetsFolder=t.snippetsHome,this._register(this.fileService.watch(n.userRoamingDataHome)),this._register(this.fileService.watch(this.snippetsFolder)),this._register(O.filter(this.fileService.onDidFilesChange,h=>h.affects(this.snippetsFolder))(()=>this.triggerLocalChange()))}async generateSyncPreview(t,e,n){let i=await this.getSnippetsFileContents(),o=this.toSnippetsContents(i),s=t.syncData?this.parseSnippets(t.syncData):null;e=e===null&&n?t:e;let a=e&&e.syncData?this.parseSnippets(e.syncData):null;s?this.logService.trace(`${this.syncResourceLogLabel}: Merging remote snippets with local snippets...`):this.logService.trace(`${this.syncResourceLogLabel}: Remote snippets does not exist. Synchronizing snippets for the first time.`);let l=$y(o,s,a);return this.getResourcePreviews(l,i,s||{},a||{})}async hasRemoteChanged(t){let e=t.syncData?this.parseSnippets(t.syncData):null;if(e===null)return!0;let n=await this.getSnippetsFileContents(),i=this.toSnippetsContents(n),o=$y(i,e,e);return Object.keys(o.remote.added).length>0||Object.keys(o.remote.updated).length>0||o.remote.removed.length>0||o.conflicts.length>0}async getMergeResult(t,e){return t.previewResult}async getAcceptResult(t,e,n,i){if(this.extUri.isEqualOrParent(e,this.syncPreviewFolder.with({scheme:j,authority:"local"})))return{content:t.fileContent?t.fileContent.value.toString():null,localChange:0,remoteChange:t.fileContent?t.remoteContent!==null?2:1:3};if(this.extUri.isEqualOrParent(e,this.syncPreviewFolder.with({scheme:j,authority:"remote"})))return{content:t.remoteContent,localChange:t.remoteContent!==null?t.fileContent?2:1:3,remoteChange:0};if(this.extUri.isEqualOrParent(e,this.syncPreviewFolder))return n===void 0?{content:t.previewResult.content,localChange:t.previewResult.localChange,remoteChange:t.previewResult.remoteChange}:{content:n,localChange:n===null?t.fileContent!==null?3:0:2,remoteChange:n===null?t.remoteContent!==null?3:0:2};throw new Error(`Invalid Resource: ${e.toString()}`)}async applyResult(t,e,n,i){let o=n.map(([s,a])=>({...s,acceptResult:a}));o.every(({localChange:s,remoteChange:a})=>s===0&&a===0)&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing snippets.`),o.some(({localChange:s})=>s!==0)&&(await this.updateLocalBackup(o),await this.updateLocalSnippets(o,i)),o.some(({remoteChange:s})=>s!==0)&&(t=await this.updateRemoteSnippets(o,t,i)),e?.ref!==t.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized snippets...`),await this.updateLastSyncUserData(t),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized snippets`));for(let{previewResource:s}of o)try{await this.fileService.del(s)}catch{}}getResourcePreviews(t,e,n,i){let o=new Map;for(let s of Object.keys(t.local.added)){let a={content:t.local.added[s],hasConflicts:!1,localChange:1,remoteChange:0};o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:null,fileContent:null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),localContent:null,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s],previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of Object.keys(t.local.updated)){let a={content:t.local.updated[s],hasConflicts:!1,localChange:2,remoteChange:0},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s],localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s],previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of t.local.removed){let a={content:null,hasConflicts:!1,localChange:3,remoteChange:0},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s],localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:null,previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of Object.keys(t.remote.added)){let a={content:t.remote.added[s],hasConflicts:!1,localChange:0,remoteChange:1},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s],localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:null,previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of Object.keys(t.remote.updated)){let a={content:t.remote.updated[s],hasConflicts:!1,localChange:0,remoteChange:2},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s],localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s],previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of t.remote.removed){let a={content:null,hasConflicts:!1,localChange:0,remoteChange:3};o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:null,localContent:null,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s],previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of t.conflicts){let a={content:i[s]??null,hasConflicts:!0,localChange:e[s]?2:1,remoteChange:n[s]?2:1},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s]||null,localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s]||null,previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}for(let s of Object.keys(e))if(!o.has(s)){let a={content:e[s]?e[s].value.toString():null,hasConflicts:!1,localChange:0,remoteChange:0},l=e[s]?e[s].value.toString():null;o.set(s,{baseResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"base"}),baseContent:i[s]??null,localResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"local"}),fileContent:e[s]||null,localContent:l,remoteResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"remote"}),remoteContent:n[s]||null,previewResource:this.extUri.joinPath(this.syncPreviewFolder,s),previewResult:a,localChange:a.localChange,remoteChange:a.remoteChange,acceptedResource:this.extUri.joinPath(this.syncPreviewFolder,s).with({scheme:j,authority:"accepted"})})}return[...o.values()]}async resolveContent(t){return this.extUri.isEqualOrParent(t,this.syncPreviewFolder.with({scheme:j,authority:"remote"}))||this.extUri.isEqualOrParent(t,this.syncPreviewFolder.with({scheme:j,authority:"local"}))||this.extUri.isEqualOrParent(t,this.syncPreviewFolder.with({scheme:j,authority:"base"}))||this.extUri.isEqualOrParent(t,this.syncPreviewFolder.with({scheme:j,authority:"accepted"}))?this.resolvePreviewContent(t):null}async hasLocalData(){try{let t=await this.getSnippetsFileContents();if(Object.keys(t).length)return!0}catch{}return!1}async updateLocalBackup(t){let e={};for(let n of t)n.fileContent&&(e[this.extUri.basename(n.localResource)]=n.fileContent);await this.backupLocal(JSON.stringify(this.toSnippetsContents(e)))}async updateLocalSnippets(t,e){for(let{fileContent:n,acceptResult:i,localResource:o,remoteResource:s,localChange:a}of t)if(a!==0){let l=s?this.extUri.basename(s):this.extUri.basename(o),c=this.extUri.joinPath(this.snippetsFolder,l);a===3?(this.logService.trace(`${this.syncResourceLogLabel}: Deleting snippet...`,this.extUri.basename(c)),await this.fileService.del(c),this.logService.info(`${this.syncResourceLogLabel}: Deleted snippet`,this.extUri.basename(c))):a===1?(this.logService.trace(`${this.syncResourceLogLabel}: Creating snippet...`,this.extUri.basename(c)),await this.fileService.createFile(c,A.fromString(i.content),{overwrite:e}),this.logService.info(`${this.syncResourceLogLabel}: Created snippet`,this.extUri.basename(c))):(this.logService.trace(`${this.syncResourceLogLabel}: Updating snippet...`,this.extUri.basename(c)),await this.fileService.writeFile(c,A.fromString(i.content),e?void 0:n),this.logService.info(`${this.syncResourceLogLabel}: Updated snippet`,this.extUri.basename(c)))}}async updateRemoteSnippets(t,e,n){let i=e.syncData?this.parseSnippets(e.syncData):{},o=Ht(i);for(let{acceptResult:s,localResource:a,remoteResource:l,remoteChange:c}of t)if(c!==0){let d=a?this.extUri.basename(a):this.extUri.basename(l);c===3?delete o[d]:o[d]=s.content}return p1(i,o)||(this.logService.trace(`${this.syncResourceLogLabel}: Updating remote snippets...`),e=await this.updateRemoteUserData(JSON.stringify(o),n?null:e.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote snippets`)),e}parseSnippets(t){return Mp(t)}toSnippetsContents(t){let e={};for(let n of Object.keys(t))e[n]=t[n].value.toString();return e}async getSnippetsFileContents(){let t={},e;try{e=await this.fileService.resolve(this.snippetsFolder)}catch(n){if(n instanceof ot&&n.fileOperationResult===1)return t;throw n}for(let n of e.children||[]){let i=n.resource,o=this.extUri.extname(i);if(o===".json"||o===".code-snippets"){let s=this.extUri.relativePath(this.snippetsFolder,i),a=await this.fileService.readFile(i);t[s]=a}}return t}};$a=E([m(2,oe),m(3,G),m(4,X),m(5,je),m(6,yt),m(7,Ie),m(8,ue),m(9,it),m(10,le),m(11,he)],$a);var Op=class extends cn{constructor(t,e,n,i,o,s){super("snippets",e,n,i,t,o,s)}async doInitialize(t){let e=t.syncData?JSON.parse(t.syncData.content):null;if(!e){this.logService.info("Skipping initializing snippets because remote snippets does not exist.");return}if(!await this.isEmpty()){this.logService.info("Skipping initializing snippets because local snippets exist.");return}for(let i of Object.keys(e)){let o=e[i];if(o){let s=this.extUri.joinPath(this.userDataProfilesService.defaultProfile.snippetsHome,i);await this.fileService.createFile(s,A.fromString(o)),this.logService.info("Created snippet",this.extUri.basename(s))}}await this.updateLastSyncUserData(t)}async isEmpty(){try{return!(await this.fileService.resolve(this.userDataProfilesService.defaultProfile.snippetsHome)).children?.length}catch(t){return t.fileOperationResult===1}}};Op=E([m(0,G),m(1,ge),m(2,oe),m(3,Ie),m(4,X),m(5,he)],Op);function qa(r,t){try{return JSON.parse(r).tasks??null}catch(e){return t.error(e),null}}var za=class extends Ko{version=1;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"tasks.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});constructor(t,e,n,i,o,s,a,l,c,d,u,f){super(t.tasksResource,{syncResource:"tasks",profile:t},e,l,c,d,n,i,a,u,o,s,f)}async generateSyncPreview(t,e,n,i){let o=t.syncData?qa(t.syncData.content,this.logService):null;e=e===null&&n?t:e;let s=e?.syncData?qa(e.syncData.content,this.logService):null,a=await this.getLocalFileContent(),l=null,c=!1,d=!1,u=!1;if(t.syncData){let v=a?a.value.toString():null;if(!s||s!==v||s!==o){this.logService.trace(`${this.syncResourceLogLabel}: Merging remote tasks with local tasks...`);let y=h1(v,o,s);l=y.content,u=y.hasConflicts,c=y.hasLocalChanged,d=y.hasRemoteChanged}}else a&&(this.logService.trace(`${this.syncResourceLogLabel}: Remote tasks does not exist. Synchronizing tasks for the first time.`),l=a.value.toString(),d=!0);let f={content:u?s:l,localChange:c?a?2:1:0,remoteChange:d?2:0,hasConflicts:u},h=a?a.value.toString():null;return[{fileContent:a,baseResource:this.baseResource,baseContent:s,localResource:this.localResource,localContent:h,localChange:f.localChange,remoteResource:this.remoteResource,remoteContent:o,remoteChange:f.remoteChange,previewResource:this.previewResource,previewResult:f,acceptedResource:this.acceptedResource}]}async hasRemoteChanged(t){let e=t?.syncData?qa(t.syncData.content,this.logService):null;if(e===null)return!0;let n=await this.getLocalFileContent(),i=n?n.value.toString():null,o=h1(i,e,e);return o.hasLocalChanged||o.hasRemoteChanged}async getMergeResult(t,e){return t.previewResult}async getAcceptResult(t,e,n,i){if(this.extUri.isEqual(e,this.localResource))return{content:t.fileContent?t.fileContent.value.toString():null,localChange:0,remoteChange:2};if(this.extUri.isEqual(e,this.remoteResource))return{content:t.remoteContent,localChange:2,remoteChange:0};if(this.extUri.isEqual(e,this.previewResource))return n===void 0?{content:t.previewResult.content,localChange:t.previewResult.localChange,remoteChange:t.previewResult.remoteChange}:{content:n,localChange:2,remoteChange:2};throw new Error(`Invalid Resource: ${e.toString()}`)}async applyResult(t,e,n,i){let{fileContent:o}=n[0][0],{content:s,localChange:a,remoteChange:l}=n[0][1];if(a===0&&l===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing tasks.`),a!==0&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating local tasks...`),o&&await this.backupLocal(JSON.stringify(this.toTasksSyncContent(o.value.toString()))),s?await this.updateLocalFileContent(s,o,i):await this.deleteLocalFile(),this.logService.info(`${this.syncResourceLogLabel}: Updated local tasks`)),l!==0){this.logService.trace(`${this.syncResourceLogLabel}: Updating remote tasks...`);let c=JSON.stringify(this.toTasksSyncContent(s));t=await this.updateRemoteUserData(c,i?null:t.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote tasks`)}try{await this.fileService.del(this.previewResource)}catch{}e?.ref!==t.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized tasks...`),await this.updateLastSyncUserData(t),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized tasks`))}async hasLocalData(){return this.fileService.exists(this.file)}async resolveContent(t){return this.extUri.isEqual(this.remoteResource,t)||this.extUri.isEqual(this.baseResource,t)||this.extUri.isEqual(this.localResource,t)||this.extUri.isEqual(this.acceptedResource,t)?this.resolvePreviewContent(t):null}toTasksSyncContent(t){return t?{tasks:t}:{}}};za=E([m(2,je),m(3,yt),m(4,Ie),m(5,ue),m(6,it),m(7,G),m(8,oe),m(9,X),m(10,le),m(11,he)],za);var Np=class extends cn{tasksResource=this.userDataProfilesService.defaultProfile.tasksResource;constructor(t,e,n,i,o,s){super("tasks",e,n,i,t,o,s)}async doInitialize(t){let e=t.syncData?qa(t.syncData.content,this.logService):null;if(!e){this.logService.info("Skipping initializing tasks because remote tasks does not exist.");return}if(!await this.isEmpty()){this.logService.info("Skipping initializing tasks because local tasks exist.");return}await this.fileService.writeFile(this.tasksResource,A.fromString(e)),await this.updateLastSyncUserData(t)}async isEmpty(){return this.fileService.exists(this.tasksResource)}};Np=E([m(0,G),m(1,ge),m(2,oe),m(3,Ie),m(4,X),m(5,he)],Np);function h1(r,t,e){if(r===null&&t===null&&e===null)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};if(r===t)return{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1};let n=e!==r,i=e!==t;return!n&&!i?{content:null,hasLocalChanged:!1,hasRemoteChanged:!1,hasConflicts:!1}:n&&!i?{content:r,hasRemoteChanged:!0,hasLocalChanged:!1,hasConflicts:!1}:i&&!n?{content:t,hasLocalChanged:!0,hasRemoteChanged:!1,hasConflicts:!1}:{content:r,hasLocalChanged:!0,hasRemoteChanged:!0,hasConflicts:!0}}function $c(r,t,e,n){let i={added:[],removed:[],updated:[]},o={added:[],removed:[],updated:[]};if(!t){let a=r.filter(({id:l})=>!n.includes(l));return a.length?o.added=a:o=null,{local:i,remote:o}}let s=zy(r,t,n);if(s.added.length>0||s.removed.length>0||s.updated.length>0){let a=zy(e,r,n),l=zy(e,t,n);for(let c of l.removed){let d=r.find(u=>u.id===c);d&&i.removed.push(d)}for(let c of l.added){let d=t.find(u=>u.id===c);a.added.includes(c)?s.updated.includes(c)&&i.updated.push(d):i.added.push(d)}for(let c of l.updated)i.updated.push(t.find(d=>d.id===c));for(let c of a.added)l.added.includes(c)||o.added.push(r.find(d=>d.id===c));for(let c of a.updated)l.removed.includes(c)||l.updated.includes(c)||o.updated.push(r.find(d=>d.id===c));for(let c of a.removed){let d=t.find(u=>u.id===c);d&&o.removed.push(d)}}return o.added.length===0&&o.removed.length===0&&o.updated.length===0&&(o=null),{local:i,remote:o}}function zy(r,t,e){r=r?r.filter(({id:l})=>!e.includes(l)):[],t=t.filter(({id:l})=>!e.includes(l));let n=r.map(({id:l})=>l),i=t.map(({id:l})=>l),o=i.filter(l=>!n.includes(l)),s=n.filter(l=>!i.includes(l)),a=[];for(let{id:l,name:c,shortName:d,icon:u,useDefaultFlags:f}of r){if(s.includes(l))continue;let h=t.find(v=>v.id===l);(!h||h.name!==c||h.shortName!==d||h.icon!==u||!dt(h.useDefaultFlags,f))&&a.push(l)}return{added:o,removed:s,updated:a}}var ro=class extends Wn{constructor(e,n,i,o,s,a,l,c,d,u,f,h,v){super({syncResource:"profiles",profile:e},n,o,s,a,l,c,f,h,d,u,v);this.userDataProfilesService=i;this._register(i.onDidChangeProfiles(()=>this.triggerLocalChange()))}version=2;previewResource=this.extUri.joinPath(this.syncPreviewFolder,"profiles.json");baseResource=this.previewResource.with({scheme:j,authority:"base"});localResource=this.previewResource.with({scheme:j,authority:"local"});remoteResource=this.previewResource.with({scheme:j,authority:"remote"});acceptedResource=this.previewResource.with({scheme:j,authority:"accepted"});async getLastSyncedProfiles(){let e=await this.getLastSyncUserData();return e?.syncData?no(e.syncData):null}async getRemoteSyncedProfiles(e){let n=await this.getLastSyncUserData(),i=await this.getLatestRemoteUserData(e,n);return i?.syncData?no(i.syncData):null}async generateSyncPreview(e,n,i){if(!this.userDataProfilesService.isEnabled())throw new Te("Cannot sync profiles because they are disabled","LocalError");let o=e.syncData?no(e.syncData):null,s=n?.syncData?no(n.syncData):null,a=this.getLocalUserDataProfiles(),{local:l,remote:c}=$c(a,o,s,[]),d={local:l,remote:c,content:s?this.stringifyRemoteProfiles(s):null,localChange:l.added.length>0||l.removed.length>0||l.updated.length>0?2:0,remoteChange:c!==null?2:0},u=Bp(a,!1);return[{baseResource:this.baseResource,baseContent:s?this.stringifyRemoteProfiles(s):null,localResource:this.localResource,localContent:u,remoteResource:this.remoteResource,remoteContent:o?this.stringifyRemoteProfiles(o):null,remoteProfiles:o,previewResource:this.previewResource,previewResult:d,localChange:d.localChange,remoteChange:d.remoteChange,acceptedResource:this.acceptedResource}]}async hasRemoteChanged(e){let n=e?.syncData?no(e.syncData):null,i=this.getLocalUserDataProfiles(),{remote:o}=$c(i,n,n,[]);return!!o?.added.length||!!o?.removed.length||!!o?.updated.length}async getMergeResult(e,n){return{...e.previewResult,hasConflicts:!1}}async getAcceptResult(e,n,i,o){if(this.extUri.isEqual(n,this.localResource))return this.acceptLocal(e);if(this.extUri.isEqual(n,this.remoteResource))return this.acceptRemote(e);if(this.extUri.isEqual(n,this.previewResource))return e.previewResult;throw new Error(`Invalid Resource: ${n.toString()}`)}async acceptLocal(e){let n=this.getLocalUserDataProfiles(),i=$c(n,null,null,[]),{local:o,remote:s}=i;return{content:e.localContent,local:o,remote:s,localChange:o.added.length>0||o.removed.length>0||o.updated.length>0?2:0,remoteChange:s!==null?2:0}}async acceptRemote(e){let n=e.remoteContent?JSON.parse(e.remoteContent):null,i=[],o=[];for(let s of this.getLocalUserDataProfiles()){let a=n?.find(l=>l.id===s.id);a&&(i.push({id:s.id,name:s.name,collection:a.collection}),o.push(s))}if(n!==null){let s=$c(o,n,i,[]),{local:a,remote:l}=s;return{content:e.remoteContent,local:a,remote:l,localChange:a.added.length>0||a.removed.length>0||a.updated.length>0?2:0,remoteChange:l!==null?2:0}}else return{content:e.remoteContent,local:{added:[],removed:[],updated:[]},remote:null,localChange:0,remoteChange:0}}async applyResult(e,n,i,o){let{local:s,remote:a,localChange:l,remoteChange:c}=i[0][1];l===0&&c===0&&this.logService.info(`${this.syncResourceLogLabel}: No changes found during synchronizing profiles.`);let d=i[0][0].remoteProfiles||[];if(d.length+(a?.added.length??0)-(a?.removed.length??0)>20)throw new Te("Too many profiles to sync. Please remove some profiles and try again.","LocalTooManyProfiles");if(l!==0&&(await this.backupLocal(Bp(this.getLocalUserDataProfiles(),!1)),await Promise.all(s.removed.map(async u=>{this.logService.trace(`${this.syncResourceLogLabel}: Removing '${u.name}' profile...`),await this.userDataProfilesService.removeProfile(u),this.logService.info(`${this.syncResourceLogLabel}: Removed profile '${u.name}'.`)})),await Promise.all(s.added.map(async u=>{this.logService.trace(`${this.syncResourceLogLabel}: Creating '${u.name}' profile...`),await this.userDataProfilesService.createProfile(u.id,u.name,{shortName:u.shortName,icon:u.icon,useDefaultFlags:u.useDefaultFlags}),this.logService.info(`${this.syncResourceLogLabel}: Created profile '${u.name}'.`)})),await Promise.all(s.updated.map(async u=>{let f=this.userDataProfilesService.profiles.find(h=>h.id===u.id);f?(this.logService.trace(`${this.syncResourceLogLabel}: Updating '${u.name}' profile...`),await this.userDataProfilesService.updateProfile(f,{name:u.name,shortName:u.shortName,icon:u.icon,useDefaultFlags:u.useDefaultFlags}),this.logService.info(`${this.syncResourceLogLabel}: Updated profile '${u.name}'.`)):this.logService.info(`${this.syncResourceLogLabel}: Could not find profile with id '${u.id}' to update.`)}))),c!==0){this.logService.trace(`${this.syncResourceLogLabel}: Updating remote profiles...`);let u=[],f=d.length+(a?.added.length??0)<=20;if(f)for(let h of a?.added||[]){let v=await this.userDataSyncStoreService.createCollection(this.syncHeaders);u.push(v),d.push({id:h.id,name:h.name,collection:v,shortName:h.shortName,icon:h.icon,useDefaultFlags:h.useDefaultFlags})}else this.logService.info(`${this.syncResourceLogLabel}: Could not create remote profiles as there are too many profiles.`);for(let h of a?.removed||[])d.splice(d.findIndex(({id:v})=>h.id===v),1);for(let h of a?.updated||[]){let v=d.find(({id:y})=>h.id===y);v&&d.splice(d.indexOf(v),1,{...v,id:h.id,name:h.name,shortName:h.shortName,icon:h.icon,useDefaultFlags:h.useDefaultFlags})}try{e=await this.updateRemoteProfiles(d,o?null:e.ref),this.logService.info(`${this.syncResourceLogLabel}: Updated remote profiles.${f&&a?.added.length?` Added: ${JSON.stringify(a.added.map(h=>h.name))}.`:""}${a?.updated.length?` Updated: ${JSON.stringify(a.updated.map(h=>h.name))}.`:""}${a?.removed.length?` Removed: ${JSON.stringify(a.removed.map(h=>h.name))}.`:""}`)}catch(h){if(u.length){this.logService.info(`${this.syncResourceLogLabel}: Failed to update remote profiles. Cleaning up added collections...`);for(let v of u)await this.userDataSyncStoreService.deleteCollection(v,this.syncHeaders)}throw h}for(let h of a?.removed||[])await this.userDataSyncStoreService.deleteCollection(h.collection,this.syncHeaders)}n?.ref!==e.ref&&(this.logService.trace(`${this.syncResourceLogLabel}: Updating last synchronized profiles...`),await this.updateLastSyncUserData(e),this.logService.info(`${this.syncResourceLogLabel}: Updated last synchronized profiles.`))}async updateRemoteProfiles(e,n){return this.updateRemoteUserData(this.stringifyRemoteProfiles(e),n)}async hasLocalData(){return this.getLocalUserDataProfiles().length>0}async resolveContent(e){if(this.extUri.isEqual(this.remoteResource,e)||this.extUri.isEqual(this.baseResource,e)||this.extUri.isEqual(this.localResource,e)||this.extUri.isEqual(this.acceptedResource,e)){let n=await this.resolvePreviewContent(e);return n&&ni(JSON.parse(n),{})}return null}getLocalUserDataProfiles(){return this.userDataProfilesService.profiles.filter(e=>!e.isDefault&&!e.isTransient)}stringifyRemoteProfiles(e){return JSON.stringify([...e].sort((n,i)=>n.name.localeCompare(i.name)))}};ro=E([m(2,ge),m(3,G),m(4,oe),m(5,X),m(6,je),m(7,yt),m(8,Ie),m(9,ue),m(10,it),m(11,le),m(12,he)],ro);function Bp(r,t){let e=[...r].sort((n,i)=>n.name.localeCompare(i.name)).map(n=>({id:n.id,name:n.name}));return t?ni(e,{}):JSON.stringify(e)}function no(r){return JSON.parse(r.content)}var qy="sync.lastSyncTime",Ha=class extends _{constructor(e,n,i,o,s,a,l,c,d,u,f){super();this.fileService=e;this.userDataSyncStoreService=n;this.userDataSyncStoreManagementService=i;this.instantiationService=o;this.logService=s;this.telemetryService=a;this.storageService=l;this.userDataSyncEnablementService=c;this.userDataProfilesService=d;this.userDataSyncResourceProviderService=u;this.userDataSyncLocalStoreService=f;this._status=i.userDataSyncStore?"idle":"uninitialized",this._lastSyncTime=this.storageService.getNumber(qy,-1,void 0),this._register(J(()=>this.clearActiveProfileSynchronizers())),this._register(new mt(()=>this.cleanUpStaleStorageData(),5*1e3)).schedule()}_serviceBrand;_status="uninitialized";get status(){return this._status}_onDidChangeStatus=this._register(new P);onDidChangeStatus=this._onDidChangeStatus.event;_onDidChangeLocal=this._register(new P);onDidChangeLocal=this._onDidChangeLocal.event;_conflicts=[];get conflicts(){return this._conflicts}_onDidChangeConflicts=this._register(new P);onDidChangeConflicts=this._onDidChangeConflicts.event;_syncErrors=[];_onSyncErrors=this._register(new P);onSyncErrors=this._onSyncErrors.event;_lastSyncTime=void 0;get lastSyncTime(){return this._lastSyncTime}_onDidChangeLastSyncTime=this._register(new P);onDidChangeLastSyncTime=this._onDidChangeLastSyncTime.event;_onDidResetLocal=this._register(new P);onDidResetLocal=this._onDidResetLocal.event;_onDidResetRemote=this._register(new P);onDidResetRemote=this._onDidResetRemote.event;activeProfileSynchronizers=new Map;async createSyncTask(e,n){this.checkEnablement(),this.logService.info("Sync started.");let i=new Date().getTime(),o=Fe();try{let c=Qi(o);n&&(c["Cache-Control"]="no-cache"),e=await this.userDataSyncStoreService.manifest(e,c)}catch(c){let d=Te.toUserDataSyncError(c);throw Wp(d,o,this.userDataSyncStoreManagementService,this.telemetryService),d}let s=!1,a=this,l;return{manifest:e,async run(){if(s)throw new Error("Can run a task only once");l=nt(c=>a.sync(e,!1,o,c)),await l.finally(()=>l=void 0),a.logService.info(`Sync done. Took ${new Date().getTime()-i}ms`),a.updateLastSyncTime()},stop(){return l?.cancel(),a.stop()}}}async createManualSyncTask(){if(this.checkEnablement(),this.userDataSyncEnablementService.isEnabled())throw new Te("Cannot start manual sync when sync is enabled","LocalError");this.logService.info("Sync started.");let e=new Date().getTime(),n=Fe(),i=Qi(n),o;try{o=await this.userDataSyncStoreService.manifest(null,i)}catch(l){let c=Te.toUserDataSyncError(l);throw Wp(c,n,this.userDataSyncStoreManagementService,this.telemetryService),c}await this.resetLocal();let s=this,a=new It;return{id:n,async merge(){return s.sync(o,!0,n,a.token)},async apply(){try{try{await s.applyManualSync(o,n,a.token)}catch(l){if(Te.toUserDataSyncError(l).code==="MethodNotFound")s.logService.info("Client is making invalid requests. Cleaning up data..."),await s.cleanUpRemoteData(),s.logService.info("Applying manual sync again..."),await s.applyManualSync(o,n,a.token);else throw l}}catch(l){throw s.logService.error(l),l}s.logService.info(`Sync done. Took ${new Date().getTime()-e}ms`),s.updateLastSyncTime()},async stop(){a.cancel(),await s.stop(),await s.resetLocal()}}}async sync(e,n,i,o){this._syncErrors=[];try{this.status!=="hasConflicts"&&this.setStatus("syncing");let s=this.getOrCreateActiveProfileSynchronizer(this.userDataProfilesService.defaultProfile,void 0);this._syncErrors.push(...await this.syncProfile(s,e,n,i,o));let a=s.enabled.find(l=>l.resource==="profiles");if(a){let l=await a.getLastSyncedProfiles()||[];if(o.isCancellationRequested)return;await this.syncRemoteProfiles(l,e,n,i,o)}}finally{this.status!=="hasConflicts"&&this.setStatus("idle"),this._onSyncErrors.fire(this._syncErrors)}}async syncRemoteProfiles(e,n,i,o,s){for(let a of e){if(s.isCancellationRequested)return;let l=this.userDataProfilesService.profiles.find(d=>d.id===a.id);if(!l){this.logService.error(`Profile with id:${a.id} and name: ${a.name} does not exist locally to sync.`);continue}this.logService.info("Syncing profile.",a.name);let c=this.getOrCreateActiveProfileSynchronizer(l,a);this._syncErrors.push(...await this.syncProfile(c,n,i,o,s))}for(let[a,l]of this.activeProfileSynchronizers.entries())this.userDataProfilesService.profiles.some(c=>c.id===l[0].profile.id)||(await l[0].resetLocal(),l[1].dispose(),this.activeProfileSynchronizers.delete(a))}async applyManualSync(e,n,i){let o=this.getActiveProfileSynchronizers();for(let d of o){if(i.isCancellationRequested)return;await d.apply(n,i)}let s=o.find(d=>d.profile.isDefault);if(!s)return;let a=s.enabled.find(d=>d.resource==="profiles");if(!a)return;let c=(await a.getRemoteSyncedProfiles(e?.latest??null)||[]).filter(d=>o.every(u=>u.profile.id!==d.id));c.length&&await this.syncRemoteProfiles(c,e,!1,n,i)}async syncProfile(e,n,i,o,s){return(await e.sync(n,i,o,s)).map(([l,c])=>({profile:e.profile,syncResource:l,error:c}))}async stop(){this.status!=="idle"&&await Promise.allSettled(this.getActiveProfileSynchronizers().map(e=>e.stop()))}async resolveContent(e){let n=await this.userDataSyncResourceProviderService.resolveContent(e);if(n)return n;for(let i of this.getActiveProfileSynchronizers())for(let o of i.enabled){let s=await o.resolveContent(e);if(s)return s}return null}async replace(e){this.checkEnablement();let n=this.userDataSyncResourceProviderService.resolveUserDataSyncResource(e);if(!n)return;let i=await this.resolveContent(e.uri);i&&await this.performAction(n.profile,async o=>{if(n.syncResource===o.resource)return await o.replace(i),!0})}async accept(e,n,i,o){this.checkEnablement(),await this.performAction(e.profile,async s=>{if(e.syncResource===s.resource)return await s.accept(n,i),o&&await s.apply(pn(o)?!1:o.force,Qi(Fe())),!0})}async hasLocalData(){return!!await this.performAction(this.userDataProfilesService.defaultProfile,async n=>{if(n.resource!=="globalState"&&await n.hasLocalData())return!0})}async hasPreviouslySynced(){return!!await this.performAction(this.userDataProfilesService.defaultProfile,async n=>{if(await n.hasPreviouslySynced())return!0})}async reset(){this.checkEnablement(),await this.resetRemote(),await this.resetLocal()}async resetRemote(){this.checkEnablement();try{await this.userDataSyncStoreService.clear(),this.logService.info("Cleared data on server")}catch(e){this.logService.error(e)}this._onDidResetRemote.fire()}async resetLocal(){this.checkEnablement(),this._lastSyncTime=void 0,this.storageService.remove(qy,-1);for(let[e]of this.activeProfileSynchronizers.values())try{await e.resetLocal()}catch(n){this.logService.error(n)}this.clearActiveProfileSynchronizers(),this._onDidResetLocal.fire(),this.logService.info("Did reset the local sync state.")}async cleanUpStaleStorageData(){let e=this.storageService.keys(-1,1),n=[];for(let o of e){if(!o.endsWith(".lastSyncUserData"))continue;let s=o.split(".");s.length===3&&n.push([o,s[0]])}if(!n.length)return;let i=new te;try{let o=this.activeProfileSynchronizers.get(this.userDataProfilesService.defaultProfile.id)?.[0];o||(o=i.add(this.instantiationService.createInstance(io,this.userDataProfilesService.defaultProfile,void 0)));let s=o.enabled.find(c=>c.resource==="profiles");if(!s)return;let l=(await s.getLastSyncedProfiles())?.map(c=>c.collection)??[];for(let[c,d]of n)l.includes(d)||(this.logService.info(`Removing last sync state for stale profile: ${d}`),this.storageService.remove(c,-1))}finally{i.dispose()}}async cleanUpRemoteData(){let e=await this.userDataSyncResourceProviderService.getRemoteSyncedProfiles(),n=e.map(a=>a.collection),i=await this.userDataSyncStoreService.getAllCollections(),o=i.filter(a=>!n.includes(a));o.length&&(this.logService.info(`Deleting ${o.length} redundant collections on server`),await Promise.allSettled(o.map(a=>this.userDataSyncStoreService.deleteCollection(a))),this.logService.info("Deleted redundant collections on server"));let s=e.filter(a=>i.includes(a.collection));if(s.length!==e.length){let a=this.instantiationService.createInstance(ro,this.userDataProfilesService.defaultProfile,void 0);try{this.logService.info("Resetting the last synced state of profiles"),await a.resetLocal(),this.logService.info("Did reset the last synced state of profiles"),this.logService.info("Updating remote profiles with invalid collections on server"),await a.updateRemoteProfiles(s,null),this.logService.info("Updated remote profiles on server")}finally{a.dispose()}}}async saveRemoteActivityData(e){this.checkEnablement();let n=await this.userDataSyncStoreService.getActivityData();await this.fileService.writeFile(e,n)}async extractActivityData(e,n){let i=(await this.fileService.readFile(e)).value.toString(),o=JSON.parse(i);if(o.resources)for(let s in o.resources)for(let a of o.resources[s])await this.userDataSyncLocalStoreService.writeResource(s,a.content,new Date(a.created*1e3),void 0,n);if(o.collections)for(let s in o.collections)for(let a in o.collections[s].resources)for(let l of o.collections[s].resources?.[a]??[])await this.userDataSyncLocalStoreService.writeResource(a,l.content,new Date(l.created*1e3),s,n)}async performAction(e,n){let i=new te;try{let o=this.activeProfileSynchronizers.get(e.id);if(o){let d=await this.performActionWithProfileSynchronizer(o[0],n,i);return kt(d)?null:d}if(e.isDefault){let d=i.add(this.instantiationService.createInstance(io,e,void 0)),u=await this.performActionWithProfileSynchronizer(d,n,i);return kt(u)?null:u}if(this.userDataProfilesService.isEnabled())return null;let s=i.add(this.instantiationService.createInstance(ro,e,void 0)),a=await this.userDataSyncStoreService.manifest(null),c=(await s.getRemoteSyncedProfiles(a?.latest??null)||[]).find(d=>d.id===e.id);if(c){let d=i.add(this.instantiationService.createInstance(io,e,c.collection)),u=await this.performActionWithProfileSynchronizer(d,n,i);return kt(u)?null:u}return null}finally{i.dispose()}}async performActionWithProfileSynchronizer(e,n,i){let o=[...e.enabled,...e.disabled.reduce((s,a)=>(a!=="workspaceState"&&s.push(i.add(e.createSynchronizer(a))),s),[])];for(let s of o){let a=await n(s);if(!kt(a))return a}}setStatus(e){let n=this._status;this._status!==e&&(this._status=e,this._onDidChangeStatus.fire(e),n==="hasConflicts"&&this.updateLastSyncTime())}updateConflicts(){let e=this.getActiveProfileSynchronizers().map(n=>n.conflicts).flat();Pt(this._conflicts,e,(n,i)=>n.profile.id===i.profile.id&&n.syncResource===i.syncResource&&Pt(n.conflicts,i.conflicts,(o,s)=>Ln(o.previewResource,s.previewResource)))||(this._conflicts=e,this._onDidChangeConflicts.fire(e))}updateLastSyncTime(){this.status==="idle"&&(this._lastSyncTime=new Date().getTime(),this.storageService.store(qy,this._lastSyncTime,-1,1),this._onDidChangeLastSyncTime.fire(this._lastSyncTime))}getOrCreateActiveProfileSynchronizer(e,n){let i=this.activeProfileSynchronizers.get(e.id);if(i&&i[0].collection!==n?.collection&&(this.logService.error("Profile synchronizer collection does not match with the remote sync profile collection"),i[1].dispose(),i=void 0,this.activeProfileSynchronizers.delete(e.id)),!i){let o=new te,s=o.add(this.instantiationService.createInstance(io,e,n?.collection));o.add(s.onDidChangeStatus(a=>this.setStatus(a))),o.add(s.onDidChangeConflicts(a=>this.updateConflicts())),o.add(s.onDidChangeLocal(a=>this._onDidChangeLocal.fire(a))),this.activeProfileSynchronizers.set(e.id,i=[s,o])}return i[0]}getActiveProfileSynchronizers(){let e=[];for(let[n]of this.activeProfileSynchronizers.values())e.push(n);return e}clearActiveProfileSynchronizers(){this.activeProfileSynchronizers.forEach(([,e])=>e.dispose()),this.activeProfileSynchronizers.clear()}checkEnablement(){if(!this.userDataSyncStoreManagementService.userDataSyncStore)throw new Error("Not enabled")}};Ha=E([m(0,G),m(1,je),m(2,wn),m(3,Ot),m(4,Ie),m(5,le),m(6,X),m(7,it),m(8,ge),m(9,Ac),m(10,yt)],Ha);var io=class extends _{constructor(e,n,i,o,s,a,l,c,d,u){super();this.profile=e;this.collection=n;this.userDataSyncEnablementService=i;this.instantiationService=o;this.extensionGalleryService=s;this.userDataSyncStoreManagementService=a;this.telemetryService=l;this.logService=c;this.userDataProfilesService=d;this.configurationService=u;this._register(i.onDidChangeResourceEnablement(([f,h])=>this.onDidChangeResourceEnablement(f,h))),this._register(J(()=>this._enabled.splice(0,this._enabled.length).forEach(([,,f])=>f.dispose())));for(let f of Br)i.isResourceEnabled(f)&&this.registerSynchronizer(f)}_enabled=[];get enabled(){return this._enabled.sort((e,n)=>e[1]-n[1]).map(([e])=>e)}get disabled(){return Br.filter(e=>!this.userDataSyncEnablementService.isResourceEnabled(e))}_status="idle";get status(){return this._status}_onDidChangeStatus=this._register(new P);onDidChangeStatus=this._onDidChangeStatus.event;_onDidChangeLocal=this._register(new P);onDidChangeLocal=this._onDidChangeLocal.event;_conflicts=[];get conflicts(){return this._conflicts}_onDidChangeConflicts=this._register(new P);onDidChangeConflicts=this._onDidChangeConflicts.event;onDidChangeResourceEnablement(e,n){n?this.registerSynchronizer(e):this.deRegisterSynchronizer(e)}registerSynchronizer(e){if(this._enabled.some(([s])=>s.resource===e))return;if(e==="extensions"&&!this.extensionGalleryService.isEnabled()){this.logService.info("Skipping extensions sync because gallery is not configured");return}if(e==="profiles"&&(!this.profile.isDefault||!this.userDataProfilesService.isEnabled())||e==="workspaceState")return;if(e!=="profiles"&&this.profile.useDefaultFlags?.[e]){this.logService.debug(`Skipping syncing ${e} in ${this.profile.name} because it is already synced by default profile`);return}let n=new te,i=n.add(this.createSynchronizer(e));n.add(i.onDidChangeStatus(()=>this.updateStatus())),n.add(i.onDidChangeConflicts(()=>this.updateConflicts())),n.add(i.onDidChangeLocal(()=>this._onDidChangeLocal.fire(e)));let o=this.getOrder(e);this._enabled.push([i,o,n])}deRegisterSynchronizer(e){let n=this._enabled.findIndex(([i])=>i.resource===e);if(n!==-1){let[[i,,o]]=this._enabled.splice(n,1);o.dispose(),this.updateStatus(),i.stop().then(null,s=>this.logService.error(s))}}createSynchronizer(e){switch(e){case"settings":return this.instantiationService.createInstance(jo,this.profile,this.collection);case"keybindings":return this.instantiationService.createInstance(Wa,this.profile,this.collection);case"snippets":return this.instantiationService.createInstance($a,this.profile,this.collection);case"tasks":return this.instantiationService.createInstance(za,this.profile,this.collection);case"globalState":return this.instantiationService.createInstance(Ba,this.profile,this.collection);case"extensions":return this.instantiationService.createInstance(Na,this.profile,this.collection);case"profiles":return this.instantiationService.createInstance(ro,this.profile,this.collection)}}async sync(e,n,i,o){if(o.isCancellationRequested)return[];let s=this.enabled;if(!s.length)return[];try{let a=[],l=Qi(i),c=(this.collection?e?.collections?.[this.collection]?.latest:e?.latest)??null,d=n?await this.getUserDataSyncConfiguration(c):{};for(let u of s){if(o.isCancellationRequested)return[];if(!this.userDataSyncEnablementService.isResourceEnabled(u.resource))return[];try{if(n){let f=await u.preview(c,d,l);if(f)for(let h of f.resourcePreviews)(h.localChange!==0||h.remoteChange!==0)&&h.mergeState==="preview"&&await u.merge(h.previewResource)}else await u.sync(c,l)}catch(f){let h=Te.toUserDataSyncError(f);if(Wp(h,i,this.userDataSyncStoreManagementService,this.telemetryService),g1(f))throw h;this.logService.error(f),this.logService.error(`${u.resource}: ${Tt(f)}`),a.push([u.resource,h])}}return a}finally{this.updateStatus()}}async apply(e,n){let i=Qi(e);for(let o of this.enabled){if(n.isCancellationRequested)return;try{await o.apply(!1,i)}catch(s){let a=Te.toUserDataSyncError(s);if(Wp(a,e,this.userDataSyncStoreManagementService,this.telemetryService),g1(s))throw a;this.logService.error(s),this.logService.error(`${o.resource}: ${Tt(s)}`)}}}async stop(){for(let e of this.enabled)try{e.status!=="idle"&&await e.stop()}catch(n){this.logService.error(n)}}async resetLocal(){for(let e of this.enabled)try{await e.resetLocal()}catch(n){this.logService.error(`${e.resource}: ${Tt(n)}`),this.logService.error(n)}}async getUserDataSyncConfiguration(e){if(!this.profile.isDefault)return{};let n=this.configurationService.getValue(No),i=this.enabled.find(o=>o instanceof jo);if(i){let o=await i.getRemoteUserDataSyncConfiguration(e);return{...n,...o}}return n}setStatus(e){this._status!==e&&(this._status=e,this._onDidChangeStatus.fire(e))}updateStatus(){return this.updateConflicts(),this.enabled.some(e=>e.status==="hasConflicts")?this.setStatus("hasConflicts"):this.enabled.some(e=>e.status==="syncing")?this.setStatus("syncing"):this.setStatus("idle")}updateConflicts(){let e=this.enabled.filter(n=>n.status==="hasConflicts").filter(n=>n.conflicts.conflicts.length>0).map(n=>n.conflicts);Pt(this._conflicts,e,(n,i)=>n.syncResource===i.syncResource&&Pt(n.conflicts,i.conflicts,(o,s)=>Ln(o.previewResource,s.previewResource)))||(this._conflicts=e,this._onDidChangeConflicts.fire(e))}getOrder(e){switch(e){case"settings":return 0;case"keybindings":return 1;case"snippets":return 2;case"tasks":return 3;case"globalState":return 4;case"extensions":return 5;case"profiles":return 6;case"workspaceState":return 7}}};io=E([m(2,it),m(3,Ot),m(4,Bt),m(5,wn),m(6,le),m(7,Ie),m(8,ge),m(9,ue)],io);function g1(r){if(r instanceof Te)switch(r.code){case"MethodNotFound":case"TooLarge":case"RemoteTooManyRequests":case"TooManyRequestsAndRetryAfter":case"LocalTooManyRequests":case"LocalTooManyProfiles":case"Gone":case"UpgradeRequired":case"IncompatibleRemoteContent":case"IncompatibleLocalContent":return!0}return!1}function Wp(r,t,e,n){n.publicLog2("sync/error",{code:r.code,serverCode:r instanceof Je?String(r.serverCode):void 0,url:r instanceof Je?r.url:void 0,resource:r.resource,executionId:t,service:e.userDataSyncStore.url.toString()})}function FR(r,t){return{...r,profile:ln(r.profile,t.profilesHome.scheme)}}function AR(r){return{created:r.created,uri:C.revive(r.uri)}}var Kp=class{constructor(t,e,n){this.service=t;this.userDataProfilesService=e;this.logService=n}manualSyncTasks=new Map;onManualSynchronizeResources=new P;listen(t,e){switch(e){case"onDidChangeStatus":return this.service.onDidChangeStatus;case"onDidChangeConflicts":return this.service.onDidChangeConflicts;case"onDidChangeLocal":return this.service.onDidChangeLocal;case"onDidChangeLastSyncTime":return this.service.onDidChangeLastSyncTime;case"onSyncErrors":return this.service.onSyncErrors;case"onDidResetLocal":return this.service.onDidResetLocal;case"onDidResetRemote":return this.service.onDidResetRemote;case"manualSync/onSynchronizeResources":return this.onManualSynchronizeResources.event}throw new Error(`[UserDataSyncServiceChannel] Event not found: ${e}`)}async call(t,e,n){try{return await this._call(t,e,n)}catch(i){throw this.logService.error(i),i}}async _call(t,e,n){switch(e){case"_getInitialData":return Promise.resolve([this.service.status,this.service.conflicts,this.service.lastSyncTime]);case"reset":return this.service.reset();case"resetRemote":return this.service.resetRemote();case"resetLocal":return this.service.resetLocal();case"hasPreviouslySynced":return this.service.hasPreviouslySynced();case"hasLocalData":return this.service.hasLocalData();case"resolveContent":return this.service.resolveContent(C.revive(n[0]));case"accept":return this.service.accept(FR(n[0],this.userDataProfilesService),C.revive(n[1]),n[2],n[3]);case"replace":return this.service.replace(AR(n[0]));case"cleanUpRemoteData":return this.service.cleanUpRemoteData();case"getRemoteActivityData":return this.service.saveRemoteActivityData(C.revive(n[0]));case"extractActivityData":return this.service.extractActivityData(C.revive(n[0]),C.revive(n[1]));case"createManualSyncTask":return this.createManualSyncTask()}if(e.startsWith("manualSync/")){let i=e.substring(11),o=n[0],s=this.getManualSyncTask(o);switch(n=n.slice(1),i){case"merge":return s.merge();case"apply":return s.apply().then(()=>this.manualSyncTasks.delete(this.createKey(s.id)));case"stop":return s.stop().finally(()=>this.manualSyncTasks.delete(this.createKey(s.id)))}}throw new Error("Invalid call")}getManualSyncTask(t){let e=this.manualSyncTasks.get(this.createKey(t));if(!e)throw new Error(`Manual sync taks not found: ${t}`);return e}async createManualSyncTask(){let t=await this.service.createManualSyncTask();return this.manualSyncTasks.set(this.createKey(t.id),t),t.id}createKey(t){return`manualSyncTask-${t}`}},Vp=class extends _{constructor(e,n){super();this.userDataProfilesService=n;this.channel={call(i,o,s){return e.call(i,o,s).then(null,a=>{throw Te.toUserDataSyncError(a)})},listen(i,o){return e.listen(i,o)}},this.channel.call("_getInitialData").then(([i,o,s])=>{this.updateStatus(i),this.updateConflicts(o),s&&this.updateLastSyncTime(s),this._register(this.channel.listen("onDidChangeStatus")(a=>this.updateStatus(a))),this._register(this.channel.listen("onDidChangeLastSyncTime")(a=>this.updateLastSyncTime(a)))}),this._register(this.channel.listen("onDidChangeConflicts")(i=>this.updateConflicts(i))),this._register(this.channel.listen("onSyncErrors")(i=>this._onSyncErrors.fire(i.map(o=>({...o,error:Te.toUserDataSyncError(o.error)})))))}channel;_status="uninitialized";get status(){return this._status}_onDidChangeStatus=this._register(new P);onDidChangeStatus=this._onDidChangeStatus.event;get onDidChangeLocal(){return this.channel.listen("onDidChangeLocal")}_conflicts=[];get conflicts(){return this._conflicts}_onDidChangeConflicts=this._register(new P);onDidChangeConflicts=this._onDidChangeConflicts.event;_lastSyncTime=void 0;get lastSyncTime(){return this._lastSyncTime}_onDidChangeLastSyncTime=this._register(new P);onDidChangeLastSyncTime=this._onDidChangeLastSyncTime.event;_onSyncErrors=this._register(new P);onSyncErrors=this._onSyncErrors.event;get onDidResetLocal(){return this.channel.listen("onDidResetLocal")}get onDidResetRemote(){return this.channel.listen("onDidResetRemote")}createSyncTask(){throw new Error("not supported")}async createManualSyncTask(){let e=await this.channel.call("createManualSyncTask"),n=this;return new Hy(e,{async call(o,s,a){return n.channel.call(`manualSync/${o}`,[e,...Array.isArray(s)?s:[s]],a)},listen(){throw new Error("not supported")}})}reset(){return this.channel.call("reset")}resetRemote(){return this.channel.call("resetRemote")}resetLocal(){return this.channel.call("resetLocal")}hasPreviouslySynced(){return this.channel.call("hasPreviouslySynced")}hasLocalData(){return this.channel.call("hasLocalData")}accept(e,n,i,o){return this.channel.call("accept",[e,n,i,o])}resolveContent(e){return this.channel.call("resolveContent",[e])}cleanUpRemoteData(){return this.channel.call("cleanUpRemoteData")}replace(e){return this.channel.call("replace",[e])}saveRemoteActivityData(e){return this.channel.call("getRemoteActivityData",[e])}extractActivityData(e,n){return this.channel.call("extractActivityData",[e,n])}async updateStatus(e){this._status=e,this._onDidChangeStatus.fire(e)}async updateConflicts(e){this._conflicts=e.map(n=>({syncResource:n.syncResource,profile:ln(n.profile,this.userDataProfilesService.profilesHome.scheme),conflicts:n.conflicts.map(i=>({...i,baseResource:C.revive(i.baseResource),localResource:C.revive(i.localResource),remoteResource:C.revive(i.remoteResource),previewResource:C.revive(i.previewResource)}))})),this._onDidChangeConflicts.fire(this._conflicts)}updateLastSyncTime(e){this._lastSyncTime!==e&&(this._lastSyncTime=e,this._onDidChangeLastSyncTime.fire(e))}};Vp=E([m(1,ge)],Vp);var Hy=class extends _{constructor(e,n){super();this.id=e;this.channel=n}async merge(){return this.channel.call("merge")}async apply(){return this.channel.call("apply")}stop(){return this.channel.call("stop")}dispose(){this.channel.call("dispose"),super.dispose()}};var ja=class extends Sp{constructor(t,e,n,i){super(!0,t,e,n,i)}};ja=E([m(0,Bi),m(1,ge),m(2,X),m(3,z)],ja);var $p=class extends _{disposables=this._register(new te);firstActiveWindowIdPromise;activeWindowId;constructor({onDidOpenMainWindow:t,onDidFocusMainWindow:e,getActiveWindowId:n}){super(),O.latch(O.any(t,e))(this.setActiveWindow,this,this.disposables),this.firstActiveWindowIdPromise=nt(()=>n()),(async()=>{try{let o=await this.firstActiveWindowIdPromise;this.activeWindowId=typeof this.activeWindowId=="number"?this.activeWindowId:o}catch{}finally{this.firstActiveWindowIdPromise=void 0}})()}setActiveWindow(t){this.firstActiveWindowIdPromise&&(this.firstActiveWindowIdPromise.cancel(),this.firstActiveWindowIdPromise=void 0),this.activeWindowId=t}async getActiveClientId(){return`window:${this.firstActiveWindowIdPromise?await this.firstActiveWindowIdPromise:this.activeWindowId}`}};var OR="signService",Ga=M(OR);var zp=class r{static _nextId=1;validators=new Map;async createNewMessage(t){try{let e=await this.getValidator();if(e){let n=String(r._nextId++);return this.validators.set(n,e),{id:n,data:e.createNewMessage(t)}}}catch{}return{id:"",data:t}}async validate(t,e){if(!t.id)return!0;let n=this.validators.get(t.id);if(!n)return!1;this.validators.delete(t.id);try{return n.validate(e)==="ok"}catch{return!1}finally{n.dispose?.()}}async sign(t){try{return await this.signValue(t)}catch{}return t}};var qp=class extends zp{getValidator(){return this.vsda().then(t=>new t.validator)}signValue(t){return this.vsda().then(e=>new e.signer().sign(t))}async vsda(){let t="vsda",{default:e}=await import(t);return e}};var Jp;(s=>{s.enableDiagnostics=!1,s.records=[];let e=new WeakMap,n=0;function i(a,l){if(!e.has(a)){let c=String(++n);e.set(a,c)}return e.get(a)}function o(a,l,c,d){}s.traceSocketEvent=o})(Jp||={});var jy=null;function oo(){return jy||(jy=A.alloc(0)),jy}var Hp=class{_chunks;_totalLength;get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(t){this._chunks.push(t),this._totalLength+=t.byteLength}read(t){return this._read(t,!0)}peek(t){return this._read(t,!1)}_read(t,e){if(t===0)return oo();if(t>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===t){let s=this._chunks[0];return e&&(this._chunks.shift(),this._totalLength-=t),s}if(this._chunks[0].byteLength>t){let s=this._chunks[0].slice(0,t);return e&&(this._chunks[0]=this._chunks[0].slice(t),this._totalLength-=t),s}let n=A.alloc(t),i=0,o=0;for(;t>0;){let s=this._chunks[o];if(s.byteLength>t){let a=s.slice(0,t);n.set(a,i),i+=t,e&&(this._chunks[o]=s.slice(t),this._totalLength-=t),t-=t}else n.set(s,i),i+=s.byteLength,e?(this._chunks.shift(),this._totalLength-=s.byteLength):o++,t-=s.byteLength}return n}};function m1(r){switch(r){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}var Zn=class{constructor(t,e,n,i){this.type=t;this.id=e;this.ack=n;this.data=i;this.writtenTime=0}writtenTime;get size(){return this.data.byteLength}},jp=class extends _{_socket;_isDisposed;_incomingData;lastReadTime;_onMessage=this._register(new P);onMessage=this._onMessage.event;_state={readHead:!0,readLen:13,messageType:0,id:0,ack:0};constructor(t){super(),this._socket=t,this._isDisposed=!1,this._incomingData=new Hp,this._register(this._socket.onData(e=>this.acceptChunk(e))),this.lastReadTime=Date.now()}acceptChunk(t){if(!(!t||t.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(t);this._incomingData.byteLength>=this._state.readLen;){let e=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=e.readUInt32BE(9),this._state.messageType=e.readUInt8(0),this._state.id=e.readUInt32BE(1),this._state.ack=e.readUInt32BE(5),this._socket.traceSocketEvent("protocolHeaderRead",{messageType:m1(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{let n=this._state.messageType,i=this._state.id,o=this._state.ack;if(this._state.readHead=!0,this._state.readLen=13,this._state.messageType=0,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent("protocolMessageRead",e),this._onMessage.fire(new Zn(n,i,o,e)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}},Gp=class{_isDisposed;_isPaused;_socket;_data;_totalLength;lastWriteTime;constructor(t){this._isDisposed=!1,this._isPaused=!1,this._socket=t,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(t){if(this._isDisposed)return;t.writtenTime=Date.now(),this.lastWriteTime=Date.now();let e=A.alloc(13);e.writeUInt8(t.type,0),e.writeUInt32BE(t.id,1),e.writeUInt32BE(t.ack,5),e.writeUInt32BE(t.data.byteLength,9),this._socket.traceSocketEvent("protocolHeaderWrite",{messageType:m1(t.type),id:t.id,ack:t.ack,messageSize:t.data.byteLength}),this._socket.traceSocketEvent("protocolMessageWrite",t.data),this._writeSoon(e,t.data)}_bufferAdd(t,e){let n=this._totalLength===0;return this._data.push(t,e),this._totalLength+=t.byteLength+e.byteLength,n}_bufferTake(){let t=A.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,t}_writeSoon(t,e){this._bufferAdd(t,e)&&this._scheduleWriting()}_writeNowTimeout=null;_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;let t=this._bufferTake();this._socket.traceSocketEvent("protocolWrite",{byteLength:t.byteLength}),this._socket.write(t)}};var Go=class{_emitter;event;_hasListeners=!1;_isDeliveringMessages=!1;_bufferedMessages=[];constructor(){this._emitter=new P({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(t){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(t):this._emitter.fire(t):this._bufferedMessages.push(t)}flushBuffer(){this._bufferedMessages=[]}},Gy=class{data;next;constructor(t){this.data=t,this.next=null}},Qy=class{_first;_last;constructor(){this._first=null,this._last=null}length(){let t=0,e=this._first;for(;e;)e=e.next,t++;return t}peek(){return this._first?this._first.data:null}toArray(){let t=[],e=0,n=this._first;for(;n;)t[e++]=n.data,n=n.next;return t}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(t){let e=new Gy(t);if(!this._first){this._first=e,this._last=e;return}this._last.next=e,this._last=e}},Jy=class r{static _HISTORY_LENGTH=10;static _INSTANCE=null;static getInstance(){return r._INSTANCE||(r._INSTANCE=new r),r._INSTANCE}lastRuns;constructor(){this.lastRuns=[];let t=Date.now();for(let e=0;e<r._HISTORY_LENGTH;e++)this.lastRuns[e]=t-1e3*e;setInterval(()=>{for(let e=r._HISTORY_LENGTH;e>=1;e--)this.lastRuns[e]=this.lastRuns[e-1];this.lastRuns[0]=Date.now()},1e3)}load(){let t=Date.now(),e=(1+r._HISTORY_LENGTH)*1e3,n=0;for(let i=0;i<r._HISTORY_LENGTH;i++)t-this.lastRuns[i]<=e&&n++;return 1-n/r._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}},Qp=class{_isReconnecting;_didSendDisconnect;_outgoingUnackMsg;_outgoingMsgId;_outgoingAckId;_outgoingAckTimeout;_incomingMsgId;_incomingAckId;_incomingMsgLastTime;_incomingAckTimeout;_keepAliveInterval;_lastReplayRequestTime;_lastSocketTimeoutTime;_socket;_socketWriter;_socketReader;_socketDisposables;_loadEstimator;_shouldSendKeepAlive;_onControlMessage=new Go;onControlMessage=this._onControlMessage.event;_onMessage=new Go;onMessage=this._onMessage.event;_onDidDispose=new Go;onDidDispose=this._onDidDispose.event;_onSocketClose=new Go;onSocketClose=this._onSocketClose.event;_onSocketTimeout=new Go;onSocketTimeout=this._onSocketTimeout.event;get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(t){this._loadEstimator=t.loadEstimator??Jy.getInstance(),this._shouldSendKeepAlive=t.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new Qy,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new te,this._socket=t.socket,this._socketWriter=this._socketDisposables.add(new Gp(this._socket)),this._socketReader=this._socketDisposables.add(new jp(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(e=>this._receiveMessage(e))),this._socketDisposables.add(this._socket.onClose(e=>this._onSocketClose.fire(e))),t.initialChunk&&this._socketReader.acceptChunk(t.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},5e3):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){if(!this._didSendDisconnect){this._didSendDisconnect=!0;let t=new Zn(5,0,0,oo());this._socketWriter.write(t),this._socketWriter.flush()}}sendPause(){let t=new Zn(7,0,0,oo());this._socketWriter.write(t)}sendResume(){let t=new Zn(8,0,0,oo());this._socketWriter.write(t)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(t,e){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new te,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=t,this._socketWriter=this._socketDisposables.add(new Gp(this._socket)),this._socketReader=this._socketDisposables.add(new jp(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(n=>this._receiveMessage(n))),this._socketDisposables.add(this._socket.onClose(n=>this._onSocketClose.fire(n))),this._socketReader.acceptChunk(e)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;let t=new Zn(3,0,this._incomingAckId,oo());this._socketWriter.write(t);let e=this._outgoingUnackMsg.toArray();for(let n=0,i=e.length;n<i;n++)this._socketWriter.write(e[n]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(t){if(t.ack>this._outgoingAckId){this._outgoingAckId=t.ack;do{let e=this._outgoingUnackMsg.peek();if(e&&e.id<=t.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(t.type){case 0:break;case 1:{if(t.id>this._incomingMsgId)if(t.id!==this._incomingMsgId+1){let e=Date.now();e-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=e,this._socketWriter.write(new Zn(6,0,0,oo())))}else this._incomingMsgId=t.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(t.data);break}case 2:{this._onControlMessage.fire(t.data);break}case 3:break;case 5:{this._onDidDispose.fire();break}case 6:{let e=this._outgoingUnackMsg.toArray();for(let n=0,i=e.length;n<i;n++)this._socketWriter.write(e[n]);this._recvAckCheck();break}case 7:{this._socketWriter.pause();break}case 8:{this._socketWriter.resume();break}case 9:break}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(t){let e=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;let n=new Zn(1,e,this._incomingAckId,t);this._outgoingUnackMsg.push(n),this._isReconnecting||(this._socketWriter.write(n),this._recvAckCheck())}sendControl(t){let e=new Zn(2,0,0,t);this._socketWriter.write(e)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;let t=Date.now()-this._incomingMsgLastTime;if(t>=2e3){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},2e3-t+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;let t=this._outgoingUnackMsg.peek(),e=Date.now()-t.writtenTime,n=Date.now()-this._socketReader.lastReadTime,i=Date.now()-this._lastSocketTimeoutTime;if(e>=2e4&&n>=2e4&&i>=2e4&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:e,timeSinceLastReceivedSomeData:n});return}let o=Math.max(2e4-e,2e4-n,2e4-i,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},o)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;let t=new Zn(3,0,this._incomingAckId,oo());this._socketWriter.write(t)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;let t=new Zn(9,0,this._incomingAckId,oo());this._socketWriter.write(t)}};var uEe=M("remoteAuthorityResolverService");var Qa=M("remoteSocketFactoryService"),Xp=class{factories={};register(t,e){return this.factories[t]??=[],this.factories[t].push(e),J(()=>{let n=this.factories[t]?.indexOf(e);typeof n=="number"&&n>=0&&this.factories[t]?.splice(n,1)})}getSocketFactory(t){return(this.factories[t.type]||[]).find(n=>n.supports(t))}connect(t,e,n,i){let o=this.getSocketFactory(t);if(!o)throw new Error(`No socket factory found for ${t}`);return o.connect(t,e,n,i)}};var QEe=30*1e3;function Yy(r){switch(r){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function BR(r){let t=new It;return setTimeout(()=>t.cancel(),r),t.token}function WR(r,t){if(r.isCancellationRequested||t.isCancellationRequested)return ee.Cancelled;let e=new It;return r.onCancellationRequested(()=>e.cancel()),t.onCancellationRequested(()=>e.cancel()),e.token}var zc=class{_state;_disposables;promise;_resolvePromise;_rejectPromise;get didTimeout(){return this._state==="timedout"}constructor(t){this._state="pending",this._disposables=new te,{promise:this.promise,resolve:this._resolvePromise,reject:this._rejectPromise}=XI(),t.isCancellationRequested?this._timeout():this._disposables.add(t.onCancellationRequested(()=>this._timeout()))}registerDisposable(t){this._state==="pending"?this._disposables.add(t):t.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){let t=new Error("Time limit reached");return t.code="ETIMEDOUT",t.syscall="connect",t}resolve(t){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(t))}reject(t){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(t))}};function VR(r,t){let e=new zc(t);return e.registerDisposable(r.onControlMessage(n=>{let i=JSON.parse(n.toString()),o=jR(i);o?e.reject(o):e.resolve(i)})),e.promise}function KR(r,t,e,n,i,o,s,a){let l=new zc(a),c=dr.create(!1);return r.info(`Creating a socket (${s})...`),Mr(`code/willCreateSocket/${o}`),t.connect(e,n,i,s).then(d=>{l.didTimeout?(Mr(`code/didCreateSocketError/${o}`),r.info(`Creating a socket (${s}) finished after ${c.elapsed()} ms, but this is too late and has timed out already.`),d?.dispose()):(Mr(`code/didCreateSocketOK/${o}`),r.info(`Creating a socket (${s}) was successful after ${c.elapsed()} ms.`),l.resolve(d))},d=>{Mr(`code/didCreateSocketError/${o}`),r.info(`Creating a socket (${s}) returned an error after ${c.elapsed()} ms.`),r.error(d),l.reject(d)}),l.promise}function Xy(r,t){let e=new zc(t);return r.then(n=>{e.didTimeout||e.resolve(n)},n=>{e.didTimeout||e.reject(n)}),e.promise}async function $R(r,t,e,n){let i=v1(r,t);r.logService.trace(`${i} 1/6. invoking socketFactory.connect().`);let o;try{o=await KR(r.logService,r.remoteSocketFactoryService,r.connectTo,dg.getServerRootPath(),`reconnectionToken=${r.reconnectionToken}&reconnection=${r.reconnectionProtocol?"true":"false"}`,Yy(t),`renderer-${Yy(t)}-${r.reconnectionToken}`,n)}catch(d){throw r.logService.error(`${i} socketFactory.connect() failed or timed out. Error:`),r.logService.error(d),d}r.logService.trace(`${i} 2/6. socketFactory.connect() was successful.`);let s,a;r.reconnectionProtocol?(r.reconnectionProtocol.beginAcceptReconnection(o,null),s=r.reconnectionProtocol,a=!1):(s=new Qp({socket:o}),a=!0),r.logService.trace(`${i} 3/6. sending AuthRequest control message.`);let l=await Xy(r.signService.createNewMessage(Fe()),n),c={type:"auth",auth:r.connectionToken||"00000000000000000000",data:l.data};s.sendControl(A.fromString(JSON.stringify(c)));try{let d=await VR(s,WR(n,BR(1e4)));if(d.type!=="sign"||typeof d.data!="string"){let v=new Error("Unexpected handshake message");throw v.code="VSCODE_CONNECTION_ERROR",v}if(r.logService.trace(`${i} 4/6. received SignRequest control message.`),!await Xy(r.signService.validate(l,d.signedData),n)){let v=new Error("Refused to connect to unsupported server");throw v.code="VSCODE_CONNECTION_ERROR",v}let f=await Xy(r.signService.sign(d.data),n),h={type:"connectionType",commit:r.commit,signedData:f,desiredConnectionType:t};return e&&(h.args=e),r.logService.trace(`${i} 5/6. sending ConnectionTypeRequest control message.`),s.sendControl(A.fromString(JSON.stringify(h))),{protocol:s,ownsProtocol:a}}catch(d){throw d&&d.code==="ETIMEDOUT"&&(r.logService.error(`${i} the handshake timed out. Error:`),r.logService.error(d)),d&&d.code==="VSCODE_CONNECTION_ERROR"&&(r.logService.error(`${i} received error control message when negotiating connection. Error:`),r.logService.error(d)),a&&HR(s),d}}async function zR(r,t,e){let n=Date.now(),i=v1(r,3),{protocol:o}=await $R(r,3,t,e);return r.logService.trace(`${i} 6/6. handshake finished, connection is up and running after ${XR(n)}!`),o}async function qR(r,t,e){let{connectTo:n,connectionToken:i}=await r.addressProvider.getAddress();return{commit:r.commit,quality:r.quality,connectTo:n,connectionToken:i,reconnectionToken:t,reconnectionProtocol:e,remoteSocketFactoryService:r.remoteSocketFactoryService,signService:r.signService,logService:r.logService}}async function y1(r,t,e){let n=await qR(r,Fe(),null);return await zR(n,{host:t,port:e},ee.None)}function HR(r){try{r.acceptDisconnect();let t=r.getSocket();r.dispose(),t.dispose()}catch(t){ze(t)}}function jR(r){if(r&&r.type==="error"){let t=new Error(`Connection error: ${r.reason}`);return t.code="VSCODE_CONNECTION_ERROR",t}return null}function GR(r,t){for(;r.length<t;)r+=" ";return r}function QR(r,t){return`[remote-connection][${GR(Yy(r),13)}][${t.substr(0,5)}\u2026]`}function JR(r,t,e){return`${QR(r,t)}[${e?"reconnect":"initial"}]`}function v1(r,t){return`${JR(t,r.reconnectionToken,!!r.reconnectionProtocol)}[${r.connectTo}]`}function XR(r){return`${Date.now()-r} ms`}var fwe=M("tunnelService"),Zp=M("sharedTunnelsService");function I1(r){return!!r.forwardPort}function YR(r){if(r.scheme!=="http"&&r.scheme!=="https")return;let t=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(r.authority);if(t)return{address:t[1],port:+t[2]}}var Zy=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function Yp(r){return Zy.indexOf(r)>=0}var ev=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function Xa(r){return ev.indexOf(r)>=0}function S1(r,t,e,n){if(e===1)return!1;if(e===2&&Xa(t)){let i=/(\d+)\.(\d+)\.(\d+)/g.exec(n);if(i?.length===4&&parseInt(i[1])>=18)return!1}return r<1024}var Ja=class extends _{constructor(e,n){super();this.logService=e;this.configurationService=n}_onTunnelOpened=new P;onTunnelOpened=this._onTunnelOpened.event;_onTunnelClosed=new P;onTunnelClosed=this._onTunnelClosed.event;_onAddedTunnelProvider=new P;onAddedTunnelProvider=this._onAddedTunnelProvider.event;_tunnels=new Map;_tunnelProvider;_canElevate=!1;_canChangeProtocol=!0;_privacyOptions=[];_factoryInProgress=new Set;get hasTunnelProvider(){return!!this._tunnelProvider}get defaultTunnelHost(){let e=this.configurationService.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this._tunnelProvider=e,e?(this._onAddedTunnelProvider.fire(),{dispose:()=>{this._tunnelProvider=void 0,this._canElevate=!1,this._privacyOptions=[]}}):(this._canElevate=!1,this._privacyOptions=[],this._onAddedTunnelProvider.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this._canElevate=e.elevation,this._privacyOptions=e.privacyOptions,this._canChangeProtocol=e.protocol}get canChangeProtocol(){return this._canChangeProtocol}get canElevate(){return this._canElevate}get canChangePrivacy(){return this._privacyOptions.length>0}get privacyOptions(){return this._privacyOptions}get tunnels(){return this.getTunnels()}async getTunnels(){let e=[],n=Array.from(this._tunnels.values());for(let i of n){let o=Array.from(i.values());for(let s of o){let a=await s.value;a&&typeof a!="string"&&e.push(a)}}return e}async dispose(){super.dispose();for(let e of this._tunnels.values()){for(let{value:n}of e.values())await n.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this._tunnels.clear()}setEnvironmentTunnel(e,n,i,o,s){this.addTunnelToMap(e,n,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:n,localAddress:i,privacy:o,protocol:s,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,n){(Xa(e)||Yp(e))&&(e=Zy[0]);let i=this.getTunnelFromMap(e,n);if(i)return++i.refcount,i.value}openTunnel(e,n,i,o,s,a=!1,l,c){this.logService.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${n}:${i} on local port ${s}.`);let d=this._tunnelProvider??e;if(!d)return;if(n||(n="localhost"),o||(o=this.defaultTunnelHost),this._tunnelProvider&&this._factoryInProgress.has(i)){this.logService.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}let u=this.retainOrCreateTunnel(d,n,i,o,s,a,l,c);return u?u.then(f=>{if(f){if(typeof f=="string")return this.logService.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.removeEmptyOrErrorTunnelFromMap(n,i),f}else{this.logService.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.removeEmptyOrErrorTunnelFromMap(n,i);return}this.logService.trace("ForwardedPorts: (TunnelService) New tunnel established.");let h=this.makeTunnel(f);return(f.tunnelRemoteHost!==n||f.tunnelRemotePort!==i)&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),l&&f.privacy!==l&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this._onTunnelOpened.fire(h),h}):(this.logService.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),u)}makeTunnel(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.logService.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);let n=this._tunnels.get(e.tunnelRemoteHost);if(n){let i=n.get(e.tunnelRemotePort);i&&(i.refcount--,await this.tryDisposeTunnel(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async tryDisposeTunnel(e,n,i){if(i.refcount<=0){this.logService.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${n}.`);let o=i.value.then(async s=>{s&&typeof s!="string"&&(await s.dispose(!0),this._onTunnelClosed.fire({host:s.tunnelRemoteHost,port:s.tunnelRemotePort}))});return this._tunnels.has(e)&&this._tunnels.get(e).delete(n),o}}async closeTunnel(e,n){this.logService.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${n} `);let i=this._tunnels.get(e);if(i&&i.has(n)){let o=i.get(n);o.refcount=0,await this.tryDisposeTunnel(e,n,o)}}addTunnelToMap(e,n,i){this._tunnels.has(e)||this._tunnels.set(e,new Map),this._tunnels.get(e).set(n,{refcount:1,value:i})}async removeEmptyOrErrorTunnelFromMap(e,n){let i=this._tunnels.get(e);if(i){let o=i.get(n),s=o?await o.value:void 0;(!s||typeof s=="string")&&i.delete(n),i.size===0&&this._tunnels.delete(e)}}getTunnelFromMap(e,n){let i=[e];Yp(e)?(i.push(...Zy),i.push(...ev)):Xa(e)&&i.push(...ev);let o=i.map(s=>this._tunnels.get(s));for(let s of o){let a=s?.get(n);if(a)return a}}canTunnel(e){return!!YR(e)}createWithProvider(e,n,i,o,s,a,l){this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${n}:${i} on local port ${o}.`);let c=i;this._factoryInProgress.add(c);let d=o===void 0?i:o,u={elevationRequired:s?this.isPortPrivileged(d):!1},f={remoteAddress:{host:n,port:i},localAddressPort:o,privacy:a,public:a?a!=="private":void 0,protocol:l},h=e.forwardPort(f,u);return h?(this.addTunnelToMap(n,i,h),h.finally(()=>{this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this._factoryInProgress.delete(c)})):this._factoryInProgress.delete(c),h}};Ja=E([m(0,z),m(1,ue)],Ja);import*as x1 from"net";import*as E1 from"os";import*as tv from"net";var nv={1:!0,7:!0,9:!0,11:!0,13:!0,15:!0,17:!0,19:!0,20:!0,21:!0,22:!0,23:!0,25:!0,37:!0,42:!0,43:!0,53:!0,69:!0,77:!0,79:!0,87:!0,95:!0,101:!0,102:!0,103:!0,104:!0,109:!0,110:!0,111:!0,113:!0,115:!0,117:!0,119:!0,123:!0,135:!0,137:!0,139:!0,143:!0,161:!0,179:!0,389:!0,427:!0,465:!0,512:!0,513:!0,514:!0,515:!0,526:!0,530:!0,531:!0,532:!0,540:!0,548:!0,554:!0,556:!0,563:!0,587:!0,601:!0,636:!0,989:!0,990:!0,993:!0,995:!0,1719:!0,1720:!0,1723:!0,2049:!0,3659:!0,4045:!0,5060:!0,5061:!0,6e3:!0,6566:!0,6665:!0,6666:!0,6667:!0,6668:!0,6669:!0,6697:!0,10080:!0};function b1(r,t,e,n="127.0.0.1"){let i=!1,o,s=1,a=tv.createServer({pauseOnConnect:!0});function l(c,d){i||(i=!0,a.removeAllListeners(),a.close(),o&&clearTimeout(o),d(c))}return new Promise(c=>{o=setTimeout(()=>{l(0,c)},e),a.on("listening",()=>{l(r,c)}),a.on("error",d=>{d&&(d.code==="EADDRINUSE"||d.code==="EACCES")&&s<t?(r++,s++,a.listen(r,n)):l(0,c)}),a.on("close",()=>{l(0,c)}),a.listen(r,n)})}var ZR=3e4,Qo=class{debugLabel;socket;_errorListener;_closeListener;_endListener;_canWrite=!0;traceSocketEvent(t,e){Jp.traceSocketEvent(this.socket,this.debugLabel,t,e)}constructor(t,e=""){this.debugLabel=e,this.socket=t,this.traceSocketEvent("created",{type:"NodeSocket"}),this._errorListener=i=>{if(this.traceSocketEvent("error",{code:i?.code,message:i?.message}),i){if(i.code==="EPIPE")return;ze(i)}},this.socket.on("error",this._errorListener);let n;this._closeListener=i=>{this.traceSocketEvent("close",{hadError:i}),this._canWrite=!1,n&&clearTimeout(n)},this.socket.on("close",this._closeListener),this._endListener=()=>{this.traceSocketEvent("nodeEndReceived"),this._canWrite=!1,n=setTimeout(()=>t.destroy(),ZR)},this.socket.on("end",this._endListener)}dispose(){this.socket.off("error",this._errorListener),this.socket.off("close",this._closeListener),this.socket.off("end",this._endListener),this.socket.destroy()}onData(t){let e=n=>{this.traceSocketEvent("read",n),t(A.wrap(n))};return this.socket.on("data",e),{dispose:()=>this.socket.off("data",e)}}onClose(t){let e=n=>{t({type:0,hadError:n,error:void 0})};return this.socket.on("close",e),{dispose:()=>this.socket.off("close",e)}}onEnd(t){let e=()=>{t()};return this.socket.on("end",e),{dispose:()=>this.socket.off("end",e)}}write(t){if(!(this.socket.destroyed||!this._canWrite))try{this.traceSocketEvent("write",t),this.socket.write(t.buffer,e=>{if(e){if(e.code==="EPIPE")return;ze(e)}})}catch(e){if(e.code==="EPIPE")return;ze(e)}}end(){this.traceSocketEvent("nodeEndSent"),this.socket.end()}drain(){return this.traceSocketEvent("nodeDrainBegin"),new Promise((t,e)=>{if(this.socket.bufferSize===0){this.traceSocketEvent("nodeDrainEnd"),t();return}let n=()=>{this.socket.off("close",n),this.socket.off("end",n),this.socket.off("error",n),this.socket.off("timeout",n),this.socket.off("drain",n),this.traceSocketEvent("nodeDrainEnd"),t()};this.socket.on("close",n),this.socket.on("end",n),this.socket.on("error",n),this.socket.on("timeout",n),this.socket.on("drain",n)})}};var kwe=process.env.XDG_RUNTIME_DIR,Uwe={2:107,1:103};async function eC(r,t,e,n,i){let o;for(let s=3;s&&(o?.dispose(),o=await new rv(r,t,e,n,i).waitForReady(),!(i&&nv[i]||!nv[o.tunnelLocalPort]));s--);return o}var rv=class extends _{constructor(e,n,i,o,s){super();this.defaultTunnelHost=n;this.suggestedLocalPort=s;this._options=e,this._server=x1.createServer(),this._barrier=new Ei,this._listeningListener=()=>this._barrier.open(),this._server.on("listening",this._listeningListener),this._connectionListener=a=>this._onConnection(a),this._server.on("connection",this._connectionListener),this._errorListener=()=>{},this._server.on("error",this._errorListener),this.tunnelRemotePort=o,this.tunnelRemoteHost=i}tunnelRemotePort;tunnelLocalPort;tunnelRemoteHost;localAddress;privacy="private";_options;_server;_barrier;_listeningListener;_connectionListener;_errorListener;_socketsDispose=new Map;async dispose(){super.dispose(),this._server.removeListener("listening",this._listeningListener),this._server.removeListener("connection",this._connectionListener),this._server.removeListener("error",this._errorListener),this._server.close(),Array.from(this._socketsDispose.values()).forEach(n=>{n()})}async waitForReady(){let e=this.suggestedLocalPort??this.tunnelRemotePort,n=Xa(this.defaultTunnelHost)?"0.0.0.0":"127.0.0.1",i=await b1(e,2,1e3,n),o=null;return this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),o=this._server.address(),o||(i=0,this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),o=this._server.address()),this.tunnelLocalPort=o.port,this.localAddress=`${this.tunnelRemoteHost==="127.0.0.1"?"127.0.0.1":"localhost"}:${o.port}`,this}async _onConnection(e){e.pause();let n=Yp(this.tunnelRemoteHost)||Xa(this.tunnelRemoteHost)?"localhost":this.tunnelRemoteHost,i=await y1(this._options,n,this.tunnelRemotePort),o=i.getSocket(),s=i.readEntireBuffer();i.dispose(),s.byteLength>0&&e.write(s.buffer),e.on("end",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),o.end()}),e.on("close",()=>o.end()),e.on("error",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),o instanceof Qo?o.socket.destroy():o.end()}),o instanceof Qo?this._mirrorNodeSocket(e,o):this._mirrorGenericSocket(e,o),e.localAddress&&this._socketsDispose.set(e.localAddress,()=>{e.end(),o.end()})}_mirrorGenericSocket(e,n){n.onClose(()=>e.destroy()),n.onEnd(()=>e.end()),n.onData(i=>e.write(i.buffer)),e.on("data",i=>n.write(A.wrap(i))),e.resume()}_mirrorNodeSocket(e,n){let i=n.socket;i.on("end",()=>e.end()),i.on("close",()=>e.end()),i.on("error",()=>{e.destroy()}),i.pipe(e),e.pipe(i)}},qc=class extends Ja{constructor(e,n,i,o,s){super(n,s);this.remoteSocketFactoryService=e;this.signService=i;this.productService=o}isPortPrivileged(e){return S1(e,this.defaultTunnelHost,ir,E1.release())}retainOrCreateTunnel(e,n,i,o,s,a,l,c){let d=this.getTunnelFromMap(n,i);if(d)return++d.refcount,d.value;if(I1(e))return this.createWithProvider(e,n,i,s,a,l,c);{this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel without provider ${n}:${i} on local port ${s}.`);let u={commit:this.productService.commit,quality:this.productService.quality,addressProvider:e,remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this.signService,logService:this.logService,ipcLogger:null},f=eC(u,o,n,i,s);return this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created without provider."),this.addTunnelToMap(n,i,f),f}}};qc=E([m(0,Qa),m(1,z),m(2,Ga),m(3,de),m(4,ue)],qc);var Hc=class extends qc{constructor(t,e,n,i,o){super(t,e,n,i,o)}};Hc=E([m(0,Qa),m(1,z),m(2,Ga),m(3,de),m(4,ue)],Hc);var Ya=class extends _{constructor(e,n,i,o,s){super();this.remoteSocketFactoryService=e;this.logService=n;this.productService=i;this.signService=o;this.configurationService=s}_tunnelServices=new Map;async openTunnel(e,n,i,o,s,a,l,c,d){if(this.logService.trace(`ForwardedPorts: (SharedTunnelService) openTunnel request for ${i}:${o} on local port ${a}.`),!this._tunnelServices.has(e)){let u=new Hc(this.remoteSocketFactoryService,this.logService,this.signService,this.productService,this.configurationService);this._register(u),this._tunnelServices.set(e,u),u.onTunnelClosed(async()=>{(await u.tunnels).length===0&&(u.dispose(),this._tunnelServices.delete(e))})}return this._tunnelServices.get(e).openTunnel(n,i,o,s,a,l,c,d)}};Ya=E([m(0,Qa),m(1,z),m(2,de),m(3,Ga),m(4,ue)],Ya);var iv=M("sharedProcessTunnelService"),w1="sharedProcessTunnel";var ov=class extends _{_address;_addressPromise;constructor(){super(),this._address=null,this._addressPromise=null}async getAddress(){return this._address?this._address:(this._addressPromise||(this._addressPromise=new wi),this._addressPromise.p)}setAddress(t){this._address=t,this._addressPromise&&(this._addressPromise.complete(t),this._addressPromise=null)}setTunnel(t){this._register(t)}},so=class extends _{constructor(e,n){super();this._tunnelService=e;this._logService=n}_serviceBrand;static _lastId=0;_tunnels=new Map;_disposedTunnels=new Set;dispose(){super.dispose(),this._tunnels.forEach(e=>e.dispose())}async createTunnel(){return{id:String(++so._lastId)}}async startTunnel(e,n,i,o,s,a,l){let c=new ov,d=await Promise.resolve(this._tunnelService.openTunnel(e,c,i,o,s,a,l));if(!d||typeof d=="string")throw this._logService.info(`[SharedProcessTunnelService] Could not create a tunnel to ${i}:${o} (remote).`),c.dispose(),new Error("Could not create tunnel");if(this._disposedTunnels.has(n))throw this._disposedTunnels.delete(n),c.dispose(),await d.dispose(),li();return c.setTunnel(d),this._tunnels.set(n,c),this._logService.info(`[SharedProcessTunnelService] Created tunnel ${n}: ${d.localAddress} (local) to ${i}:${o} (remote).`),{tunnelLocalPort:d.tunnelLocalPort,localAddress:d.localAddress}}async setAddress(e,n){let i=this._tunnels.get(e);i&&i.setAddress(n)}async destroyTunnel(e){let n=this._tunnels.get(e);if(n){this._logService.info(`[SharedProcessTunnelService] Disposing tunnel ${e}.`),this._tunnels.delete(e),await n.dispose();return}this._disposedTunnels.add(e)}};so=E([m(0,Zp),m(1,z)],so);var tC=[];function P1(r,t,e){t instanceof Ce||(t=new Ce(t,[],!!e)),tC.push([r,t])}var Gc=class{constructor(t,e,n){this.level=t;this.key=e;this.value=n;this.forward=[]}forward},jc=void 0,eh=class r{constructor(t,e=2**16){this.comparator=t;this._maxLevel=Math.max(1,Math.log2(e)|0),this._header=new Gc(this._maxLevel,jc,jc)}[Symbol.toStringTag]="SkipList";_maxLevel;_level=0;_header;_size=0;get size(){return this._size}clear(){this._header=new Gc(this._maxLevel,jc,jc),this._size=0}has(t){return!!r._search(this,t,this.comparator)}get(t){return r._search(this,t,this.comparator)?.value}set(t,e){return r._insert(this,t,e,this.comparator)&&(this._size+=1),this}delete(t){let e=r._delete(this,t,this.comparator);return e&&(this._size-=1),e}forEach(t,e){let n=this._header.forward[0];for(;n;)t.call(e,n.value,n.key,this),n=n.forward[0]}[Symbol.iterator](){return this.entries()}*entries(){let t=this._header.forward[0];for(;t;)yield[t.key,t.value],t=t.forward[0]}*keys(){let t=this._header.forward[0];for(;t;)yield t.key,t=t.forward[0]}*values(){let t=this._header.forward[0];for(;t;)yield t.value,t=t.forward[0]}toString(){let t="[SkipList]:",e=this._header.forward[0];for(;e;)t+=`node(${e.key}, ${e.value}, lvl:${e.level})`,e=e.forward[0];return t}static _search(t,e,n){let i=t._header;for(let o=t._level-1;o>=0;o--)for(;i.forward[o]&&n(i.forward[o].key,e)<0;)i=i.forward[o];if(i=i.forward[0],i&&n(i.key,e)===0)return i}static _insert(t,e,n,i){let o=[],s=t._header;for(let a=t._level-1;a>=0;a--){for(;s.forward[a]&&i(s.forward[a].key,e)<0;)s=s.forward[a];o[a]=s}if(s=s.forward[0],s&&i(s.key,e)===0)return s.value=n,!1;{let a=r._randomLevel(t);if(a>t._level){for(let l=t._level;l<a;l++)o[l]=t._header;t._level=a}s=new Gc(a,e,n);for(let l=0;l<a;l++)s.forward[l]=o[l].forward[l],o[l].forward[l]=s;return!0}}static _randomLevel(t,e=.5){let n=1;for(;Math.random()<e&&n<t._maxLevel;)n+=1;return n}static _delete(t,e,n){let i=[],o=t._header;for(let s=t._level-1;s>=0;s--){for(;o.forward[s]&&n(o.forward[s].key,e)<0;)o=o.forward[s];i[s]=o}if(o=o.forward[0],!o||n(o.key,e)!==0)return!1;for(let s=0;s<t._level&&i[s].forward[s]===o;s++)i[s].forward[s]=o.forward[s];for(;t._level>0&&t._header.forward[t._level-1]===jc;)t._level-=1;return!0}};var th=class r{constructor(t){this.uri=t}static _clock=0;time=r._clock++;touch(){return this.time=r._clock++,this}},Jo=class{constructor(t){this._fileService=t;let e=new Map,n=i=>{let o=e.get(i.scheme);return o===void 0&&(o=t.hasProvider(i)&&!this._fileService.hasCapability(i,1024),e.set(i.scheme,o)),o};this._dispooables.add(O.any(t.onDidChangeFileSystemProviderRegistrations,t.onDidChangeFileSystemProviderCapabilities)(i=>{e.delete(i.scheme)})),this.extUri=new Io(n),this._canonicalUris=new eh((i,o)=>this.extUri.compare(i,o,!0),this._limit)}extUri;_dispooables=new te;_canonicalUris;_limit=2**16;dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(t){this._fileService.hasProvider(t)&&(t=jI(t));let e=this._canonicalUris.get(t);return e?e.touch().uri.with({fragment:t.fragment}):(this._canonicalUris.set(t,new th(t)),this._checkTrim(),t)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;let t=[...this._canonicalUris.entries()].sort((n,i)=>n[1].time<i[1].time?1:n[1].time>i[1].time?-1:0);th._clock=0,this._canonicalUris.clear();let e=this._limit*.5;for(let n=0;n<e;n++)this._canonicalUris.set(t[n][0],t[n][1].touch())}};Jo=E([m(0,G)],Jo);P1(he,Jo,1);var nh=class extends _{constructor(e,n,i,o,s,a){super();this.fileSystemScheme=e;this.fileSystemProvider=n;this.userDataScheme=i;this.userDataProfilesService=o;this.uriIdentityService=s;this.logService=a;this.updateAtomicReadWritesResources(),this._register(o.onDidChangeProfiles(()=>this.updateAtomicReadWritesResources())),this._register(this.fileSystemProvider.onDidChangeFile(l=>this.handleFileChanges(l)))}capabilities=this.fileSystemProvider.capabilities;onDidChangeCapabilities=this.fileSystemProvider.onDidChangeCapabilities;_onDidChangeFile=this._register(new P);onDidChangeFile=this._onDidChangeFile.event;watchResources=An.forUris(()=>!(this.capabilities&1024));atomicReadWriteResources=new gi(e=>this.uriIdentityService.extUri.getComparisonKey(this.toFileSystemResource(e)));updateAtomicReadWritesResources(){this.atomicReadWriteResources.clear();for(let e of this.userDataProfilesService.profiles)this.atomicReadWriteResources.add(e.settingsResource),this.atomicReadWriteResources.add(e.keybindingsResource),this.atomicReadWriteResources.add(e.tasksResource),this.atomicReadWriteResources.add(e.extensionsResource)}open(e,n){return this.fileSystemProvider.open(this.toFileSystemResource(e),n)}close(e){return this.fileSystemProvider.close(e)}read(e,n,i,o,s){return this.fileSystemProvider.read(e,n,i,o,s)}write(e,n,i,o,s){return this.fileSystemProvider.write(e,n,i,o,s)}watch(e,n){this.watchResources.set(e,e);let i=this.fileSystemProvider.watch(this.toFileSystemResource(e),n);return J(()=>{this.watchResources.delete(e),i.dispose()})}stat(e){return this.fileSystemProvider.stat(this.toFileSystemResource(e))}mkdir(e){return this.fileSystemProvider.mkdir(this.toFileSystemResource(e))}rename(e,n,i){return this.fileSystemProvider.rename(this.toFileSystemResource(e),this.toFileSystemResource(n),i)}readFile(e,n){return this.fileSystemProvider.readFile(this.toFileSystemResource(e),n)}readFileStream(e,n,i){return this.fileSystemProvider.readFileStream(this.toFileSystemResource(e),n,i)}readdir(e){return this.fileSystemProvider.readdir(this.toFileSystemResource(e))}enforceAtomicReadFile(e){return this.atomicReadWriteResources.has(e)}writeFile(e,n,i){return this.fileSystemProvider.writeFile(this.toFileSystemResource(e),n,i)}enforceAtomicWriteFile(e){return this.atomicReadWriteResources.has(e)?{postfix:".vsctmp"}:!1}delete(e,n){return this.fileSystemProvider.delete(this.toFileSystemResource(e),n)}copy(e,n,i){if(ac(this.fileSystemProvider))return this.fileSystemProvider.copy(this.toFileSystemResource(e),this.toFileSystemResource(n),i);throw new Error("copy not supported")}cloneFile(e,n){if(Du(this.fileSystemProvider))return this.fileSystemProvider.cloneFile(this.toFileSystemResource(e),this.toFileSystemResource(n));throw new Error("clone not supported")}handleFileChanges(e){let n=[];for(let i of e){if(i.resource.scheme!==this.fileSystemScheme)continue;let o=this.toUserDataResource(i.resource);this.watchResources.findSubstr(o)&&n.push({resource:o,type:i.type,cId:i.cId})}n.length&&(this.logService.debug("User data changed"),this._onDidChangeFile.fire(n))}toFileSystemResource(e){return e.with({scheme:this.fileSystemScheme})}toUserDataResource(e){return e.with({scheme:this.userDataScheme})}};var T1="localFilesystem",rh=class extends _{constructor(e,n){super();this.channel=e;this.extraCapabilities=n;this.registerFileChangeListeners()}onDidChangeCapabilities=O.None;_capabilities;get capabilities(){return this._capabilities||(this._capabilities=253982,this.extraCapabilities.pathCaseSensitive&&(this._capabilities|=1024),this.extraCapabilities.trash&&(this._capabilities|=4096)),this._capabilities}stat(e){return this.channel.call("stat",[e])}readdir(e){return this.channel.call("readdir",[e])}async readFile(e,n){let{buffer:i}=await this.channel.call("readFile",[e,n]);return i}readFileStream(e,n,i){let o=Qr(a=>A.concat(a.map(l=>A.wrap(l))).buffer),s=new te;return s.add(this.channel.listen("readFileStream",[e,n])(a=>{if(a instanceof A)o.write(a.buffer);else{if(a==="end")o.end();else{let l;if(a instanceof Error)l=a;else{let c=a;l=Mn(c.message??Tt(c),c.code??"Unknown")}o.error(l),o.end()}s.dispose()}})),s.add(i.onCancellationRequested(()=>{o.error(li()),o.end(),s.dispose()})),o}writeFile(e,n,i){return this.channel.call("writeFile",[e,A.wrap(n),i])}open(e,n){return this.channel.call("open",[e,n])}close(e){return this.channel.call("close",[e])}async read(e,n,i,o,s){let[a,l]=await this.channel.call("read",[e,n,s]);return i.set(a.buffer.slice(0,l),o),l}write(e,n,i,o,s){return this.channel.call("write",[e,n,A.wrap(i),o,s])}mkdir(e){return this.channel.call("mkdir",[e])}delete(e,n){return this.channel.call("delete",[e,n])}rename(e,n,i){return this.channel.call("rename",[e,n,i])}copy(e,n,i){return this.channel.call("copy",[e,n,i])}cloneFile(e,n){return this.channel.call("cloneFile",[e,n])}_onDidChange=this._register(new P);onDidChangeFile=this._onDidChange.event;_onDidWatchError=this._register(new P);onDidWatchError=this._onDidWatchError.event;sessionId=Fe();registerFileChangeListeners(){this._register(this.channel.listen("fileChange",[this.sessionId])(e=>{if(Array.isArray(e)){let n=e;this._onDidChange.fire(kc(n))}else{let n=e;this._onDidWatchError.fire(n)}}))}watch(e,n){let i=Fe();return this.channel.call("watch",[this.sessionId,i,e,n]),J(()=>this.channel.call("unwatch",[this.sessionId,i]))}};var ih=class{_serviceBrand;_sessions=new Map;async startProfiling(t){let n=await(await import("v8-inspect-profiler")).startProfiling({host:t.host,port:t.port,checkForPaused:!0}),i=Fe();return this._sessions.set(i,n),i}async stopProfiling(t){let e=this._sessions.get(t);if(!e)throw new Error(`UNKNOWN session '${t}'`);let n=await e.stop();return this._sessions.delete(t),n.profile}};var Za=class extends Wf{constructor(t,e,n,i,o,s,a,l){super(C.file(o.builtinExtensionsPath),C.file(o.extensionsPath),o.userHome,t.defaultProfile,t,e,n,i,o,s,a,l)}};Za=E([m(0,ge),m(1,Jn),m(2,G),m(3,z),m(4,St),m(5,de),m(6,he),m(7,Ot)],Za);var oh=class extends Yu{constructor(e,n){super();this.channel=n;for(let i in e){let{definition:o,value:s}=e[i];this.policyDefinitions[i]=o,s!==void 0&&this.policies.set(i,s)}this.channel.listen("onDidChange")(i=>{for(let o in i){let s=i[o];s===null?this.policies.delete(o):this.policies.set(o,s)}this._onDidChange.fire(Object.keys(i))})}async _updatePolicyDefinitions(e){let n=await this.channel.call("updatePolicyDefinitions",e);for(let i in n)this.policies.set(i,n[i])}};var sh=class extends _{constructor(e,n,i){super();this.profilesHome=n;this.channel=i;this._profiles=e.map(o=>ln(o,this.profilesHome.scheme)),this._register(this.channel.listen("onDidChangeProfiles")(o=>{let s=o.added.map(c=>ln(c,this.profilesHome.scheme)),a=o.removed.map(c=>ln(c,this.profilesHome.scheme)),l=o.updated.map(c=>ln(c,this.profilesHome.scheme));this._profiles=o.all.map(c=>ln(c,this.profilesHome.scheme)),this._onDidChangeProfiles.fire({added:s,removed:a,updated:l,all:this.profiles})})),this.onDidResetWorkspaces=this.channel.listen("onDidResetWorkspaces")}_serviceBrand;get defaultProfile(){return this.profiles[0]}_profiles=[];get profiles(){return this._profiles}_onDidChangeProfiles=this._register(new P);onDidChangeProfiles=this._onDidChangeProfiles.event;onDidResetWorkspaces;enabled=!0;setEnablement(e){this.enabled=e}isEnabled(){return this.enabled}async createNamedProfile(e,n,i){let o=await this.channel.call("createNamedProfile",[e,n,i]);return ln(o,this.profilesHome.scheme)}async createProfile(e,n,i,o){let s=await this.channel.call("createProfile",[e,n,i,o]);return ln(s,this.profilesHome.scheme)}async createTransientProfile(e){let n=await this.channel.call("createTransientProfile",[e]);return ln(n,this.profilesHome.scheme)}async setProfileForWorkspace(e,n){await this.channel.call("setProfileForWorkspace",[e,n])}removeProfile(e){return this.channel.call("removeProfile",[e])}async updateProfile(e,n){let i=await this.channel.call("updateProfile",[e,n]);return ln(i,this.profilesHome.scheme)}resetWorkspaces(){return this.channel.call("resetWorkspaces")}cleanUp(){return this.channel.call("cleanUp")}cleanUpTransientProfiles(){return this.channel.call("cleanUpTransientProfiles")}};import*as C1 from"https";var R1="https://mobile.events.data.microsoft.com/OneCollector/1.0",nC="https://mobile.events.data.microsoft.com/ping";async function rC(r,t,e){let n=qe?await Lo("@microsoft/1ds-core-js","bundle/ms.core.min.js"):await import("@microsoft/1ds-core-js"),i=qe?await Lo("@microsoft/1ds-post-js","bundle/ms.post.min.js"):await import("@microsoft/1ds-post-js"),o=new n.AppInsightsCore,s=new i.PostChannel,a={instrumentationKey:r,endpointUrl:R1,loggingLevelTelemetry:0,loggingLevelConsole:0,disableCookiesUsage:!0,disableDbgExt:!0,disableInstrumentationKeyValidation:!0,channels:[[s]]};if(e){a.extensionConfig={};let l={alwaysUseXhrOverride:!0,ignoreMc1Ms0CookieProcessing:!0,httpXHROverride:e};a.extensionConfig[s.identifier]=l}return o.initialize(a,[]),o.addTelemetryInitializer(l=>{l.ext=l.ext??{},l.ext.web=l.ext.web??{},l.ext.web.consentDetails='{"GPC_DataSharingOptIn":false}',t&&(l.ext.utc=l.ext.utc??{},l.ext.utc.flags=8462029)}),o}var ah=class{constructor(t,e,n,i,o){this._isInternalTelemetry=t;this._eventPrefix=e;this._defaultData=n;this._xhrOverride=o;this._defaultData||(this._defaultData={}),typeof i=="function"?this._aiCoreOrKey=i():this._aiCoreOrKey=i,this._asyncAiCore=null}_aiCoreOrKey;_asyncAiCore;endPointUrl=R1;endPointHealthUrl=nC;_withAIClient(t){if(this._aiCoreOrKey){if(typeof this._aiCoreOrKey!="string"){t(this._aiCoreOrKey);return}this._asyncAiCore||(this._asyncAiCore=rC(this._aiCoreOrKey,this._isInternalTelemetry,this._xhrOverride)),this._asyncAiCore.then(e=>{t(e)},e=>{ze(e),console.error(e)})}}log(t,e){if(!this._aiCoreOrKey)return;e=ks(e,this._defaultData),e=Ku(e);let n=this._eventPrefix+"/"+t;try{this._withAIClient(i=>{i.pluginVersionString=e?.properties.version??"Unknown",i.track({name:n,baseData:{name:n,properties:e?.properties,measurements:e?.measurements}})})}catch{}}flush(){return this._aiCoreOrKey?new Promise(t=>{this._withAIClient(e=>{e.unload(!0,()=>{this._aiCoreOrKey=void 0,t(void 0)})})}):Promise.resolve(void 0)}};async function iC(r,t){let e=await t.request(r,ee.None),n=(await kr(e.stream)).toString(),i=e.res.statusCode??200;return{headers:e.res.headers,statusCode:i,responseData:n}}async function oC(r){let t={method:r.type,headers:r.headers};return new Promise((n,i)=>{let o=C1.request(r.url??"",t,s=>{s.on("data",function(a){n({headers:s.headers,statusCode:s.statusCode??200,responseData:a.toString()})}),s.on("error",function(a){i(a)})});o.write(r.data,s=>{s&&i(s)}),o.end()})}async function sC(r,t,e){let n=typeof t.data=="string"?t.data:new TextDecoder().decode(t.data),i={type:"POST",headers:{...t.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(t.data).toString()},url:t.urlString,data:n};try{let o=r?await iC(i,r):await oC(i);e(o.statusCode,o.headers,o.responseData)}catch{e(0,{})}}var lh=class extends ah{constructor(t,e,n,i,o){let s={sendPOST:(a,l)=>{sC(t,a,l)}};super(e,n,i,o,s)}};var el=class extends _{constructor(t){super(),this._register(new mt(()=>{t.cleanUp()},10*1e3)).schedule()}};el=E([m(0,ge)],el);var sv=M("IRemoteTunnelService"),Qc={active:!1},dn;(i=>(i.disconnected=o=>({type:"disconnected",onTokenFailed:o}),i.connected=(o,s)=>({type:"connected",info:o,serviceInstallFailed:s}),i.connecting=o=>({type:"connecting",progress:o}),i.uninitialized={type:"uninitialized"}))(dn||={});var D1="remote.tunnels.access",av=D1+".hostNameOverride",lv=D1+".preventSleep",cv="remoteTunnelService",_1=g("remoteTunnelLog","Remote Tunnel Service");var nn=class{constructor(t,e,n,i,o,s,a,l,c,d){this.userDataSyncStoreService=t;this.userDataSyncLocalStoreService=e;this.logService=n;this.environmentService=o;this.storageService=s;this.fileService=a;this.userDataProfilesService=l;this.configurationService=c;this.instantiationService=d;this.extUri=i.extUri}_serviceBrand;static NOT_EXISTING_RESOURCE="not-existing-resource";static REMOTE_BACKUP_AUTHORITY="remote-backup";static LOCAL_BACKUP_AUTHORITY="local-backup";extUri;async getRemoteSyncedProfiles(){let t=await this.userDataSyncStoreService.readResource("profiles",null,void 0);if(t.content){let e=this.parseSyncData(t.content,"profiles");return no(e)}return[]}async getLocalSyncedProfiles(t){let e=await this.userDataSyncLocalStoreService.getAllResourceRefs("profiles",void 0,t);if(e.length){let n=await this.userDataSyncLocalStoreService.resolveResourceContent("profiles",e[0].ref,void 0,t);if(n){let i=this.parseSyncData(n,"profiles");return no(i)}}return[]}async getLocalSyncedMachines(t){let e=await this.userDataSyncLocalStoreService.getAllResourceRefs("machines",void 0,t);if(e.length){let n=await this.userDataSyncLocalStoreService.resolveResourceContent("machines",e[0].ref,void 0,t);if(n)return JSON.parse(n).machines.map(o=>({...o,isCurrent:!1}))}return[]}async getRemoteSyncResourceHandles(t,e){return(await this.userDataSyncStoreService.getAllResourceRefs(t,e?.collection)).map(({created:i,ref:o})=>({created:i,uri:this.toUri({remote:!0,syncResource:t,profile:e?.id??this.userDataProfilesService.defaultProfile.id,location:void 0,collection:e?.collection,ref:o,node:void 0})}))}async getLocalSyncResourceHandles(t,e,n){return(await this.userDataSyncLocalStoreService.getAllResourceRefs(t,e?.collection,n)).map(({created:o,ref:s})=>({created:o,uri:this.toUri({remote:!1,syncResource:t,profile:e?.id??this.userDataProfilesService.defaultProfile.id,collection:e?.collection,ref:s,node:void 0,location:n})}))}resolveUserDataSyncResource({uri:t}){let e=this.resolveUri(t),n=e?this.userDataProfilesService.profiles.find(i=>i.id===e.profile):void 0;return e&&n?{profile:n,syncResource:e?.syncResource}:void 0}async getAssociatedResources({uri:t}){let e=this.resolveUri(t);if(!e)return[];let n=this.userDataProfilesService.profiles.find(i=>i.id===e.profile);switch(e.syncResource){case"settings":return this.getSettingsAssociatedResources(t,n);case"keybindings":return this.getKeybindingsAssociatedResources(t,n);case"tasks":return this.getTasksAssociatedResources(t,n);case"snippets":return this.getSnippetsAssociatedResources(t,n);case"globalState":return this.getGlobalStateAssociatedResources(t,n);case"extensions":return this.getExtensionsAssociatedResources(t,n);case"profiles":return this.getProfilesAssociatedResources(t,n);case"workspaceState":return[]}}async getMachineId({uri:t}){let e=this.resolveUri(t);if(e){if(e.remote){if(e.ref){let{content:n}=await this.getUserData(e.syncResource,e.ref,e.collection);if(n)return this.parseSyncData(n,e.syncResource)?.machineId}return}if(e.location){if(e.ref){let n=await this.userDataSyncLocalStoreService.resolveResourceContent(e.syncResource,e.ref,e.collection,e.location);if(n)return this.parseSyncData(n,e.syncResource)?.machineId}return}return Qn(this.environmentService,this.fileService,this.storageService)}}async resolveContent(t){let e=this.resolveUri(t);if(!e||e.node===nn.NOT_EXISTING_RESOURCE)return null;if(e.ref){let n=await this.getContentFromStore(e.remote,e.syncResource,e.collection,e.ref,e.location);return e.node&&n?this.resolveNodeContent(e.syncResource,n,e.node):n}return!e.remote&&!e.node?this.resolveLatestContent(e.syncResource,e.profile):null}async getContentFromStore(t,e,n,i,o){if(t){let{content:s}=await this.getUserData(e,i,n);return s}return this.userDataSyncLocalStoreService.resolveResourceContent(e,i,n,o)}resolveNodeContent(t,e,n){let i=this.parseSyncData(e,t);switch(t){case"settings":return this.resolveSettingsNodeContent(i,n);case"keybindings":return this.resolveKeybindingsNodeContent(i,n);case"tasks":return this.resolveTasksNodeContent(i,n);case"snippets":return this.resolveSnippetsNodeContent(i,n);case"globalState":return this.resolveGlobalStateNodeContent(i,n);case"extensions":return this.resolveExtensionsNodeContent(i,n);case"profiles":return this.resolveProfileNodeContent(i,n);case"workspaceState":return null}}async resolveLatestContent(t,e){let n=this.userDataProfilesService.profiles.find(i=>i.id===e);if(!n)return null;switch(t){case"globalState":return this.resolveLatestGlobalStateContent(n);case"extensions":return this.resolveLatestExtensionsContent(n);case"profiles":return this.resolveLatestProfilesContent(n);case"settings":return null;case"keybindings":return null;case"tasks":return null;case"snippets":return null;case"workspaceState":return null}}getSettingsAssociatedResources(t,e){let n=this.extUri.joinPath(t,"settings.json"),i=e?e.settingsResource:this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);return[{resource:n,comparableResource:i}]}resolveSettingsNodeContent(t,e){switch(e){case"settings.json":return Fp(t.content).settings}return null}getKeybindingsAssociatedResources(t,e){let n=this.extUri.joinPath(t,"keybindings.json"),i=e?e.keybindingsResource:this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);return[{resource:n,comparableResource:i}]}resolveKeybindingsNodeContent(t,e){switch(e){case"keybindings.json":return Vc(t.content,!!this.configurationService.getValue(Fc),this.logService)}return null}getTasksAssociatedResources(t,e){let n=this.extUri.joinPath(t,"tasks.json"),i=e?e.tasksResource:this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);return[{resource:n,comparableResource:i}]}resolveTasksNodeContent(t,e){switch(e){case"tasks.json":return qa(t.content,this.logService)}return null}async getSnippetsAssociatedResources(t,e){let n=await this.resolveContent(t);if(n){let i=this.parseSyncData(n,"snippets");if(i){let o=Mp(i),s=[];for(let a of Object.keys(o)){let l=this.extUri.joinPath(t,a),c=e?this.extUri.joinPath(e.snippetsHome,a):this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);s.push({resource:l,comparableResource:c})}return s}}return[]}resolveSnippetsNodeContent(t,e){return Mp(t)[e]||null}getExtensionsAssociatedResources(t,e){let n=this.extUri.joinPath(t,"extensions.json"),i=e?this.toUri({remote:!1,syncResource:"extensions",profile:e.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);return[{resource:n,comparableResource:i}]}resolveExtensionsNodeContent(t,e){switch(e){case"extensions.json":return Ep(c1(t),!0)}return null}async resolveLatestExtensionsContent(t){let{localExtensions:e}=await this.instantiationService.createInstance(zo).getLocalExtensions(t);return Ep(e,!0)}getGlobalStateAssociatedResources(t,e){let n=this.extUri.joinPath(t,"globalState.json"),i=e?this.toUri({remote:!1,syncResource:"globalState",profile:e.id,location:void 0,collection:void 0,ref:void 0,node:void 0}):this.extUri.joinPath(t,nn.NOT_EXISTING_RESOURCE);return[{resource:n,comparableResource:i}]}resolveGlobalStateNodeContent(t,e){switch(e){case"globalState.json":return to(JSON.parse(t.content),!0)}return null}async resolveLatestGlobalStateContent(t){let e=await this.instantiationService.createInstance(qo).getLocalGlobalState(t);return to(e,!0)}getProfilesAssociatedResources(t,e){let n=this.extUri.joinPath(t,"profiles.json"),i=this.toUri({remote:!1,syncResource:"profiles",profile:this.userDataProfilesService.defaultProfile.id,location:void 0,collection:void 0,ref:void 0,node:void 0});return[{resource:n,comparableResource:i}]}resolveProfileNodeContent(t,e){switch(e){case"profiles.json":return ni(JSON.parse(t.content),{})}return null}async resolveLatestProfilesContent(t){return Bp(this.userDataProfilesService.profiles.filter(e=>!e.isDefault&&!e.isTransient),!0)}toUri(t){let e=t.remote?nn.REMOTE_BACKUP_AUTHORITY:nn.LOCAL_BACKUP_AUTHORITY,n=[];return t.location&&(n.push(`scheme:${t.location.scheme}`),n.push(`authority:${t.location.authority}`),n.push(LI(t.location.path,"/"))),n.push(`syncResource:${t.syncResource}`),n.push(`profile:${t.profile}`),t.collection&&n.push(`collection:${t.collection}`),t.ref&&n.push(`ref:${t.ref}`),t.node&&n.push(t.node),this.extUri.joinPath(C.from({scheme:j,authority:e,path:"/",query:t.location?.query,fragment:t.location?.fragment}),...n)}resolveUri(t){if(t.scheme!==j)return;let e=[];for(;t.path!=="/";)e.unshift(this.extUri.basename(t)),t=this.extUri.dirname(t);if(e.length<2)return;let n=t.authority===nn.REMOTE_BACKUP_AUTHORITY,i,o,s=[],a,l,c,d,u;for(;e.length;){let f=e.shift();f.startsWith("scheme:")?i=f.substring(7):f.startsWith("authority:")?o=f.substring(10):f.startsWith("syncResource:")?a=f.substring(13):f.startsWith("profile:")?l=f.substring(8):f.startsWith("collection:")?c=f.substring(11):f.startsWith("ref:")?d=f.substring(4):a?u=f:s.push(f)}return{remote:n,syncResource:a,profile:l,collection:c,ref:d,node:u,location:i&&o!==void 0?this.extUri.joinPath(C.from({scheme:i,authority:o,query:t.query,fragment:t.fragment,path:"/"}),...s):void 0}}parseSyncData(t,e){try{let n=JSON.parse(t);if($o(n))return n}catch(n){this.logService.error(n)}throw new Te(g("incompatible sync data","Cannot parse sync data as it is not compatible with the current version."),"IncompatibleRemoteContent",e)}async getUserData(t,e,n){let i=await this.userDataSyncStoreService.resolveResourceContent(t,e,n);return{ref:e,content:i}}};nn=E([m(0,je),m(1,yt),m(2,Ie),m(3,he),m(4,oe),m(5,X),m(6,G),m(7,ge),m(8,ue),m(9,Ot)],nn);async function k1(r,t,e,n,i){try{let o=await r.getExtensionsControlManifest();if(!o.deprecated)return;let s=await r.getInstalled(1);for(let[a,l]of Object.entries(o.deprecated)){if(!l?.extension)continue;let{id:c,autoMigrate:d,preRelease:u}=l.extension;if(!d)continue;let f=s.find(v=>Y(v.identifier,{id:a}));if(!f)continue;let h=(await t.getExtensions([{id:c,preRelease:u}],{targetPlatform:await r.getTargetPlatform(),compatible:!0},ee.None))[0];if(!h){i.info(`Skipping migrating '${f.identifier.id}' extension because, the comaptible target '${c}' extension is not found`);continue}try{i.info(`Migrating '${f.identifier.id}' extension to '${c}' extension...`);let v=!n.getDisabledExtensions().some(I=>Y(I,f.identifier));await r.uninstall(f),i.info(`Uninstalled the unsupported extension '${f.identifier.id}'`);let y=s.find(I=>Y(I.identifier,{id:c}));(!y||!y.isPreReleaseVersion&&v)&&(y=await r.installFromGallery(h,{installPreReleaseVersion:!0,isMachineScoped:f.isMachineScoped,operation:4}),i.info(`Installed the pre-release extension '${y.identifier.id}'`),v||(await n.disableExtension(y.identifier),i.info(`Disabled the pre-release extension '${y.identifier.id}' because the unsupported extension '${f.identifier.id}' is disabled`)),d.storage&&(e.addToMigrationList(Ro(f.manifest.publisher,f.manifest.name),Ro(y.manifest.publisher,y.manifest.name)),i.info("Added pre-release extension to the storage migration list"))),i.info(`Migrated '${f.identifier.id}' extension to '${c}' extension.`)}catch(v){i.error(v)}}}catch(o){i.error(o)}}var tl=class extends _{constructor(t,e,n,i,o,s){super(),t.cleanUp(),k1(t,e,n,i,s),Vt.removeOutdatedExtensionVersions(t,o)}};tl=E([m(0,qf),m(1,Bt),m(2,Ta),m(3,wu),m(4,X),m(5,z)],tl);var ch=class extends _{logger;constructor(t,e=[]){super(),this.logger=new pu([t,...e]),this._register(t.onDidChangeLogLevel(n=>this.setLevel(n)))}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(t){this.logger.setLevel(t)}getLevel(){return this.logger.getLevel()}trace(t,...e){this.logger.trace(t,...e)}debug(t,...e){this.logger.debug(t,...e)}info(t,...e){this.logger.info(t,...e)}warn(t,...e){this.logger.warn(t,...e)}error(t,...e){this.logger.error(t,...e)}flush(){this.logger.flush()}};var dh=M("sharedProcessLifecycleService"),nl=class extends _{constructor(e){super();this.logService=e}_onWillShutdown=this._register(new P);onWillShutdown=this._onWillShutdown.event;fireOnWillShutdown(){this.logService.trace("Lifecycle#onWillShutdown.fire()"),this._onWillShutdown.fire()}};nl=E([m(0,z)],nl);import{spawn as U1}from"child_process";import{hostname as lC,homedir as cC}from"os";import{Transform as aC}from"stream";var Jc=class extends aC{buffer;splitter;spitterLen;constructor(t){if(super(),typeof t=="number")this.splitter=t,this.spitterLen=1;else{let e=Buffer.isBuffer(t)?t:Buffer.from(t);this.splitter=e.length===1?e[0]:e,this.spitterLen=e.length}}_transform(t,e,n){this.buffer?this.buffer=Buffer.concat([this.buffer,t]):this.buffer=t;let i=0;for(;i<this.buffer.length;){let o=typeof this.splitter=="number"?this.buffer.indexOf(this.splitter,i):bg(this.buffer,this.splitter,i);if(o===-1)break;this.push(this.buffer.slice(i,o+this.spitterLen)),i=o+this.spitterLen}this.buffer=i===this.buffer.length?void 0:this.buffer.slice(i),n()}_flush(t){this.buffer&&this.push(this.buffer),t()}};var dC=[av,lv],dv="remoteTunnelSession",uv="remoteTunnelIsService",rl=class extends _{constructor(e,n,i,o,s,a,l){super();this.telemetryService=e;this.productService=n;this.environmentService=i;this.configurationService=a;this.storageService=l;this._logger=this._register(o.createLogger(V(i.logsHome,`${cv}.log`),{id:cv,name:_1})),this._startTunnelProcessDelayer=new bo(100),this._register(this._logger.onDidChangeLogLevel(c=>this._logger.info("Log level changed to "+Zl(c)))),this._register(s.onWillShutdown(()=>{this._tunnelProcess?.cancel(),this._tunnelProcess=void 0,this.dispose()})),this._register(a.onDidChangeConfiguration(c=>{dC.some(d=>c.affectsConfiguration(d))&&this._startTunnelProcessDelayer.trigger(()=>this.updateTunnelProcess())})),this._mode=this._restoreMode(),this._tunnelStatus=dn.uninitialized}_onDidTokenFailedEmitter=new P;onDidTokenFailed=this._onDidTokenFailedEmitter.event;_onDidChangeTunnelStatusEmitter=new P;onDidChangeTunnelStatus=this._onDidChangeTunnelStatusEmitter.event;_onDidChangeModeEmitter=new P;onDidChangeMode=this._onDidChangeModeEmitter.event;_logger;_mode=Qc;_tunnelProcess;_tunnelStatus;_startTunnelProcessDelayer;_tunnelCommand;_initialized=!1;async getTunnelStatus(){return this._tunnelStatus}setTunnelStatus(e){this._tunnelStatus=e,this._onDidChangeTunnelStatusEmitter.fire(e)}setMode(e){L1(this._mode,e)||(this._mode=e,this._storeMode(e),this._onDidChangeModeEmitter.fire(this._mode),e.active?(this._logger.info(`Session updated: ${e.session.accountLabel} (${e.session.providerId}) (service=${e.asService})`),e.session.token&&this._logger.info(`Session token updated: ${e.session.accountLabel} (${e.session.providerId})`)):this._logger.info("Session reset"))}getMode(){return Promise.resolve(this._mode)}async initialize(e){if(this._initialized)return this._tunnelStatus;this._initialized=!0,this.setMode(e);try{await this._startTunnelProcessDelayer.trigger(()=>this.updateTunnelProcess())}catch(n){this._logger.error(n)}return this._tunnelStatus}defaultOnOutput=(e,n)=>{n?this._logger.error(e):this._logger.info(e)};getTunnelCommandLocation(){if(!this._tunnelCommand){let e;_t?e=this.environmentService.appRoot:e=Et(Et(this.environmentService.appRoot)),this._tunnelCommand=W(e,"bin",`${this.productService.tunnelApplicationName}${be?".exe":""}`)}return this._tunnelCommand}async startTunnel(e){if(L1(this._mode,e)&&this._tunnelStatus.type!=="disconnected")return this._tunnelStatus;this.setMode(e);try{await this._startTunnelProcessDelayer.trigger(()=>this.updateTunnelProcess())}catch(n){this._logger.error(n)}return this._tunnelStatus}async stopTunnel(){if(this._tunnelProcess&&(this._tunnelProcess.cancel(),this._tunnelProcess=void 0),this._mode.active){let e=this._mode.asService;this.setMode(Qc);try{e&&this.runCodeTunnelCommand("uninstallService",["service","uninstall"])}catch(n){this._logger.error(n)}}try{await this.runCodeTunnelCommand("stop",["kill"])}catch(e){this._logger.error(e)}this.setTunnelStatus(dn.disconnected())}async updateTunnelProcess(){this.telemetryService.publicLog2("remoteTunnel.enablement",{enabled:this._mode.active,service:this._mode.active&&this._mode.asService}),this._tunnelProcess&&(this._tunnelProcess.cancel(),this._tunnelProcess=void 0);let e="",n=!1,i=(d,u)=>{u?this._logger.error(d):e+=d,!this.environmentService.isBuilt&&d.startsWith("   Compiling")&&this.setTunnelStatus(dn.connecting(g("remoteTunnelService.building","Building CLI from sources")))},o=this.runCodeTunnelCommand("status",["status"],i);this._tunnelProcess=o;try{if(await o,this._tunnelProcess!==o)return;let d;try{d=JSON.parse(e.trim().split(`
`).find(u=>u.startsWith("{")))}catch{this._logger.error(`Could not parse status output: ${JSON.stringify(e.trim())}`),this.setTunnelStatus(dn.disconnected());return}if(n=d.service_installed,this._logger.info(d.tunnel?"Other tunnel running, attaching...":"No other tunnel running"),!d.tunnel&&!this._mode.active){this.setTunnelStatus(dn.disconnected());return}}catch(d){this._logger.error(d),this.setTunnelStatus(dn.disconnected());return}finally{this._tunnelProcess===o&&(this._tunnelProcess=void 0)}let s=this._mode.active?this._mode.session:void 0;if(s&&s.token){let d=s.token;this.setTunnelStatus(dn.connecting(g({key:"remoteTunnelService.authorizing",comment:["{0} is a user account name, {1} a provider name (e.g. Github)"]},"Connecting as {0} ({1})",s.accountLabel,s.providerId)));let u=(h,v)=>{h=h.replaceAll(d,"*".repeat(4)),i(h,v)},f=this.runCodeTunnelCommand("login",["user","login","--provider",s.providerId,"--log",Zl(this._logger.getLevel())],u,{VSCODE_CLI_ACCESS_TOKEN:d});this._tunnelProcess=f;try{if(await f,this._tunnelProcess!==f)return}catch(h){this._logger.error(h),this._tunnelProcess=void 0,this._onDidTokenFailedEmitter.fire(s),this.setTunnelStatus(dn.disconnected(s));return}}let a=this._getTunnelName();a?this.setTunnelStatus(dn.connecting(g({key:"remoteTunnelService.openTunnelWithName",comment:["{0} is a tunnel name"]},"Opening tunnel {0}",a))):this.setTunnelStatus(dn.connecting(g("remoteTunnelService.openTunnel","Opening tunnel")));let l=["--accept-server-license-terms","--log",Zl(this._logger.getLevel())];a?l.push("--name",a):l.push("--random-name");let c=!1;return this._mode.active&&this._mode.asService&&!n&&(c=await this.installTunnelService(l)===!1),this.serverOrAttachTunnel(s,l,c)}async installTunnelService(e){let n;try{n=await this.runCodeTunnelCommand("serviceInstall",["service","install",...e])}catch(i){this._logger.error(i),n=1}if(n!==0){let i=g("remoteTunnelService.serviceInstallFailed","Failed to install tunnel as a service, starting in session...");return this._logger.warn(i),this.setTunnelStatus(dn.connecting(i)),!1}return!0}async serverOrAttachTunnel(e,n,i){n.push("--parent-process-id",String(process.pid)),this._preventSleep()&&n.push("--no-sleep");let o=!1,s=this.runCodeTunnelCommand("tunnel",n,(a,l)=>{l?this._logger.error(a):this._logger.info(a),a.includes("Connected to an existing tunnel process")&&(o=!0);let c=a.match(/Open this link in your browser (https:\/\/([^\/\s]+)\/([^\/\s]+)\/([^\/\s]+))/);if(c){let d={link:c[1],domain:c[2],tunnelName:c[4],isAttached:o};this.setTunnelStatus(dn.connected(d,i))}else a.match(/error refreshing token/)&&(s.cancel(),this._onDidTokenFailedEmitter.fire(e),this.setTunnelStatus(dn.disconnected(e)))});this._tunnelProcess=s,s.finally(()=>{s===this._tunnelProcess&&(this._logger.info("tunnel process terminated"),this._tunnelProcess=void 0,this._mode=Qc,this.setTunnelStatus(dn.disconnected()))})}runCodeTunnelCommand(e,n,i=this.defaultOnOutput,o){return nt(s=>new Promise((a,l)=>{s.isCancellationRequested&&a(-1);let c,d=["ignore","pipe","pipe"];if(s.onCancellationRequested(()=>{c&&(this._logger.info(`${e} terminating(${c.pid})`),c.kill())}),!this.environmentService.isBuilt)i(`Building tunnel CLI from sources and run
`,!1),i(`${e} Spawning: cargo run -- tunnel ${n.join(" ")}
`,!1),c=U1("cargo",["run","--","tunnel",...n],{cwd:W(this.environmentService.appRoot,"cli"),stdio:d,env:{...process.env,RUST_BACKTRACE:"1",...o}});else{i(`Running tunnel CLI
`,!1);let u=this.getTunnelCommandLocation();i(`${e} Spawning: ${u} tunnel ${n.join(" ")}
`,!1),c=U1(u,["tunnel",...n],{cwd:cC(),stdio:d,env:{...process.env,...o}})}c.stdout.pipe(new Jc(`
`)).on("data",u=>{if(c){let f=u.toString();i(f,!1)}}),c.stderr.pipe(new Jc(`
`)).on("data",u=>{if(c){let f=u.toString();i(f,!0)}}),c.on("exit",u=>{c&&(i(`${e} exit(${c.pid}): + ${u} `,!1),c=void 0,a(u||0))}),c.on("error",u=>{c&&(i(`${e} error(${c.pid}): + ${u} `,!0),c=void 0,l())})}))}async getTunnelName(){return this._getTunnelName()}_preventSleep(){return!!this.configurationService.getValue(lv)}_getTunnelName(){let e=this.configurationService.getValue(av)||lC();return e=e.replace(/^-+/g,"").replace(/[^\w-]/g,"").substring(0,20),e||void 0}_restoreMode(){try{let e=this.storageService.get(dv,-1),n=this.storageService.getBoolean(uv,-1,!1);if(e){let i=JSON.parse(e);if(i&&De(i.accountLabel)&&De(i.sessionId)&&De(i.providerId))return{active:!0,session:i,asService:n};this._logger.error("Problems restoring session from storage, invalid format",i)}}catch(e){this._logger.error("Problems restoring session from storage",e)}return Qc}_storeMode(e){if(e.active){let n={providerId:e.session.providerId,sessionId:e.session.sessionId,accountLabel:e.session.accountLabel};this.storageService.store(dv,JSON.stringify(n),-1,1),this.storageService.store(uv,e.asService,-1,1)}else this.storageService.remove(dv,-1),this.storageService.remove(uv,-1)}};rl=E([m(0,le),m(1,de),m(2,St),m(3,Lr),m(4,dh),m(5,ue),m(6,X)],rl);function uC(r,t){return r&&t?r.sessionId===t.sessionId&&r.providerId===t.providerId&&r.token===t.token:r===t}var L1=(r,t)=>r.active!==t.active?!1:r.active&&t.active?r.asService===t.asService&&uC(r.session,t.session):!0;var il=class extends ya{constructor(t,e,n,i,o,s){super(C.file(t.extensionsPath),e,n,i,o,s)}};il=E([m(0,St),m(1,G),m(2,ge),m(3,he),m(4,le),m(5,z)],il);var uh=class{constructor(t){this.channel=t}get ignoredRecommendations(){throw new Error("not supported")}promptImportantExtensionsInstallNotification(t){return this.channel.call("promptImportantExtensionsInstallNotification",[t])}promptWorkspaceRecommendations(t){throw new Error("not supported")}hasToIgnoreRecommendationNotifications(){throw new Error("not supported")}};var ol=class{constructor(t,e){this.windowId=t;return Yt.toService(e.getChannel("nativeHost"),{context:t,properties:(()=>{let n=new Map;return n.set("windowId",t),n})()})}};ol=E([m(1,Bi)],ol);var fv="sync.disableMachineEventually",gv="sync.sessionId",pv="sync.storeUrl",hv="sync.productQuality",sl=class extends _{constructor(e,n,i,o,s,a,l,c,d,u){super();this.userDataSyncStoreManagementService=n;this.userDataSyncStoreService=i;this.userDataSyncEnablementService=o;this.userDataSyncService=s;this.logService=a;this.userDataSyncAccountService=l;this.telemetryService=c;this.userDataSyncMachinesService=d;this.storageService=u;this.syncTriggerDelayer=this._register(new hn(this.getSyncTriggerDelayTime())),this.lastSyncUrl=this.syncUrl,this.syncUrl=n.userDataSyncStore?.url,this.previousProductQuality=this.productQuality,this.productQuality=e.quality,this.syncUrl&&(this.logService.info("Using settings sync service",this.syncUrl.toString()),this._register(n.onDidChangeUserDataSyncStore(()=>{Ln(this.syncUrl,n.userDataSyncStore?.url)||(this.lastSyncUrl=this.syncUrl,this.syncUrl=n.userDataSyncStore?.url,this.syncUrl&&this.logService.info("Using settings sync service",this.syncUrl.toString()))})),this.userDataSyncEnablementService.isEnabled()?this.logService.info("Auto Sync is enabled."):this.logService.info("Auto Sync is disabled."),this.updateAutoSync(),this.hasToDisableMachineEventually()&&this.disableMachineEventually(),this._register(l.onDidChangeAccount(()=>this.updateAutoSync())),this._register(i.onDidChangeDonotMakeRequestsUntil(()=>this.updateAutoSync())),this._register(s.onDidChangeLocal(f=>this.triggerSync([f],!1,!1))),this._register(O.filter(this.userDataSyncEnablementService.onDidChangeResourceEnablement,([,f])=>f)(()=>this.triggerSync(["resourceEnablement"],!1,!1))),this._register(this.userDataSyncStoreManagementService.onDidChangeUserDataSyncStore(()=>this.triggerSync(["userDataSyncStoreChanged"],!1,!1))))}_serviceBrand;autoSync=this._register(new zt);successiveFailures=0;lastSyncTriggerTime=void 0;syncTriggerDelayer;suspendUntilRestart=!1;_onError=this._register(new P);onError=this._onError.event;lastSyncUrl;get syncUrl(){let e=this.storageService.get(pv,-1);return e?C.parse(e):void 0}set syncUrl(e){e?this.storageService.store(pv,e.toString(),-1,1):this.storageService.remove(pv,-1)}previousProductQuality;get productQuality(){return this.storageService.get(hv,-1)}set productQuality(e){e?this.storageService.store(hv,e,-1,1):this.storageService.remove(hv,-1)}updateAutoSync(){let{enabled:e,message:n}=this.isAutoSyncEnabled();e?this.autoSync.value===void 0&&(this.autoSync.value=new mv(this.lastSyncUrl,1e3*60*5,this.userDataSyncStoreManagementService,this.userDataSyncStoreService,this.userDataSyncService,this.userDataSyncMachinesService,this.logService,this.telemetryService,this.storageService),this.autoSync.value.register(this.autoSync.value.onDidStartSync(()=>this.lastSyncTriggerTime=new Date().getTime())),this.autoSync.value.register(this.autoSync.value.onDidFinishSync(i=>this.onDidFinishSync(i))),this.startAutoSync()&&this.autoSync.value.start()):(this.syncTriggerDelayer.cancel(),this.autoSync.value!==void 0?(n&&this.logService.info(n),this.autoSync.clear()):n&&this.userDataSyncEnablementService.isEnabled()&&this.logService.info(n))}startAutoSync(){return!0}isAutoSyncEnabled(){return this.userDataSyncEnablementService.isEnabled()?this.userDataSyncAccountService.account?this.userDataSyncStoreService.donotMakeRequestsUntil?{enabled:!1,message:`Auto Sync: Suspended until ${ka(this.userDataSyncStoreService.donotMakeRequestsUntil)} because server is not accepting requests until then.`}:this.suspendUntilRestart?{enabled:!1,message:"Auto Sync: Suspended until restart."}:{enabled:!0}:{enabled:!1,message:"Auto Sync: Suspended until auth token is available."}:{enabled:!1,message:"Auto Sync: Disabled."}}async turnOn(){this.stopDisableMachineEventually(),this.lastSyncUrl=this.syncUrl,this.updateEnablement(!0)}async turnOff(e,n,i){try{this.userDataSyncAccountService.account&&!i&&await this.userDataSyncMachinesService.removeCurrentMachine(),this.updateEnablement(!1),this.storageService.remove(gv,-1),e?(this.telemetryService.publicLog2("sync/turnOffEveryWhere"),await this.userDataSyncService.reset()):await this.userDataSyncService.resetLocal()}catch(o){if(this.logService.error(o),n)this.updateEnablement(!1);else throw o}}updateEnablement(e){this.userDataSyncEnablementService.isEnabled()!==e&&(this.userDataSyncEnablementService.setEnablement(e),this.updateAutoSync())}hasProductQualityChanged(){return!!this.previousProductQuality&&!!this.productQuality&&this.previousProductQuality!==this.productQuality}async onDidFinishSync(e){if(!e){this.successiveFailures=0;return}let n=Te.toUserDataSyncError(e);n instanceof Yn&&this.telemetryService.publicLog2("autosync/error",{code:n.code,service:this.userDataSyncStoreManagementService.userDataSyncStore.url.toString()}),n.code==="SessionExpired"?(await this.turnOff(!1,!0),this.logService.info("Auto Sync: Turned off sync because current session is expired")):n.code==="TurnedOff"?(await this.turnOff(!1,!0),this.logService.info("Auto Sync: Turned off sync because sync is turned off in the cloud")):n.code==="LocalTooManyRequests"?(this.suspendUntilRestart=!0,this.logService.info("Auto Sync: Suspended sync because of making too many requests to server"),this.updateAutoSync()):n.code==="RemoteTooManyRequests"?(await this.turnOff(!1,!0,!0),this.disableMachineEventually(),this.logService.info("Auto Sync: Turned off sync because of making too many requests to server")):n.code==="MethodNotFound"?(await this.turnOff(!1,!0),this.logService.info("Auto Sync: Turned off sync because current client is making requests to server that are not supported")):n.code==="UpgradeRequired"||n.code==="Gone"?(await this.turnOff(!1,!0,!0),this.disableMachineEventually(),this.logService.info("Auto Sync: Turned off sync because current client is not compatible with server. Requires client upgrade.")):n.code==="IncompatibleLocalContent"?(await this.turnOff(!1,!0),this.logService.info(`Auto Sync: Turned off sync because server has ${n.resource} content with newer version than of client. Requires client upgrade.`)):n.code==="IncompatibleRemoteContent"?(await this.turnOff(!1,!0),this.logService.info(`Auto Sync: Turned off sync because server has ${n.resource} content with older version than of client. Requires server reset.`)):n.code==="ServiceChanged"||n.code==="DefaultServiceChanged"?qe&&n.code==="DefaultServiceChanged"&&!this.hasProductQualityChanged()?(await this.turnOff(!1,!0),this.logService.info("Auto Sync: Turned off sync because default sync service is changed.")):(await this.turnOff(!1,!0,!0),await this.turnOn(),this.logService.info("Auto Sync: Sync Service changed. Turned off auto sync, reset local state and turned on auto sync.")):(this.logService.error(n),this.successiveFailures++),this._onError.fire(n)}async disableMachineEventually(){this.storageService.store(fv,!0,-1,1),await pr(1e3*60*10),this.hasToDisableMachineEventually()&&(this.stopDisableMachineEventually(),!this.userDataSyncEnablementService.isEnabled()&&this.userDataSyncAccountService.account&&await this.userDataSyncMachinesService.removeCurrentMachine())}hasToDisableMachineEventually(){return this.storageService.getBoolean(fv,-1,!1)}stopDisableMachineEventually(){this.storageService.remove(fv,-1)}sources=[];async triggerSync(e,n,i){if(this.autoSync.value===void 0)return this.syncTriggerDelayer.cancel();if(n&&this.lastSyncTriggerTime&&Math.round((new Date().getTime()-this.lastSyncTriggerTime)/1e3)<10){this.logService.debug("Auto Sync: Skipped. Limited to once per 10 seconds.");return}return this.sources.push(...e),this.syncTriggerDelayer.trigger(async()=>{this.logService.trace("activity sources",...this.sources);let o=this.userDataSyncAccountService.account?.authenticationProviderId||"";this.telemetryService.publicLog2("sync/triggered",{sources:this.sources,providerId:o}),this.sources=[],this.autoSync.value&&await this.autoSync.value.sync("Activity",i)},this.successiveFailures?this.getSyncTriggerDelayTime()*1*Math.min(Math.pow(2,this.successiveFailures),60):this.getSyncTriggerDelayTime())}getSyncTriggerDelayTime(){return 2e3}};sl=E([m(0,de),m(1,wn),m(2,je),m(3,it),m(4,Bo),m(5,Ie),m(6,Wo),m(7,le),m(8,Mo),m(9,X)],sl);var mv=class r extends _{constructor(e,n,i,o,s,a,l,c,d){super();this.lastSyncUrl=e;this.interval=n;this.userDataSyncStoreManagementService=i;this.userDataSyncStoreService=o;this.userDataSyncService=s;this.userDataSyncMachinesService=a;this.logService=l;this.telemetryService=c;this.storageService=d}static INTERVAL_SYNCING="Interval";intervalHandler=this._register(new zt);_onDidStartSync=this._register(new P);onDidStartSync=this._onDidStartSync.event;_onDidFinishSync=this._register(new P);onDidFinishSync=this._onDidFinishSync.event;manifest=null;syncTask;syncPromise;start(){this._register(this.onDidFinishSync(()=>this.waitUntilNextIntervalAndSync())),this._register(J(()=>{this.syncPromise&&(this.syncPromise.cancel(),this.logService.info("Auto sync: Cancelled sync that is in progress"),this.syncPromise=void 0),this.syncTask?.stop(),this.logService.info("Auto Sync: Stopped")})),this.sync(r.INTERVAL_SYNCING,!1)}waitUntilNextIntervalAndSync(){this.intervalHandler.value=Pi(()=>{this.sync(r.INTERVAL_SYNCING,!1),this.intervalHandler.value=void 0},this.interval)}sync(e,n){let i=nt(async o=>{if(this.syncPromise)try{this.logService.debug("Auto Sync: Waiting until sync is finished."),await this.syncPromise}catch(s){if(Rn(s))return}return this.doSync(e,n,o)});return this.syncPromise=i,this.syncPromise.finally(()=>this.syncPromise=void 0),this.syncPromise}hasSyncServiceChanged(){return this.lastSyncUrl!==void 0&&!Ln(this.lastSyncUrl,this.userDataSyncStoreManagementService.userDataSyncStore?.url)}async hasDefaultServiceChanged(){let e=await this.userDataSyncStoreManagementService.getPreviousUserDataSyncStore(),n=this.userDataSyncStoreManagementService.userDataSyncStore;return!!n&&!!e&&(!Ln(n.defaultUrl,e.defaultUrl)||!Ln(n.insidersUrl,e.insidersUrl)||!Ln(n.stableUrl,e.stableUrl))}async doSync(e,n,i){this.logService.info(`Auto Sync: Triggered by ${e}`),this._onDidStartSync.fire();let o;try{await this.createAndRunSyncTask(n,i)}catch(s){if(this.logService.error(s),o=s,Te.toUserDataSyncError(s).code==="MethodNotFound")try{this.logService.info("Auto Sync: Client is making invalid requests. Cleaning up data..."),await this.userDataSyncService.cleanUpRemoteData(),this.logService.info("Auto Sync: Retrying sync..."),await this.createAndRunSyncTask(n,i),o=void 0}catch(a){this.logService.error(a),o=a}}this._onDidFinishSync.fire(o)}async createAndRunSyncTask(e,n){if(this.syncTask=await this.userDataSyncService.createSyncTask(this.manifest,e),n.isCancellationRequested)return;if(this.manifest=this.syncTask.manifest,this.manifest===null&&await this.userDataSyncService.hasPreviouslySynced())throw this.hasSyncServiceChanged()?await this.hasDefaultServiceChanged()?new Yn(g("default service changed","Cannot sync because default service has changed"),"DefaultServiceChanged"):new Yn(g("service changed","Cannot sync because sync service has changed"),"ServiceChanged"):new Yn(g("turned off","Cannot sync because syncing is turned off in the cloud"),"TurnedOff");let i=this.storageService.get(gv,-1);if(i&&this.manifest&&i!==this.manifest.session)throw this.hasSyncServiceChanged()?await this.hasDefaultServiceChanged()?new Yn(g("default service changed","Cannot sync because default service has changed"),"DefaultServiceChanged"):new Yn(g("service changed","Cannot sync because sync service has changed"),"ServiceChanged"):new Yn(g("session expired","Cannot sync because current session is expired"),"SessionExpired");let o=await this.userDataSyncMachinesService.getMachines(this.manifest||void 0);if(n.isCancellationRequested)return;let s=o.find(l=>l.isCurrent);if(s?.disabled)throw new Yn(g("turned off machine","Cannot sync because syncing is turned off on this machine from another machine."),"TurnedOff");let a=new Date().getTime();if(await this.syncTask.run(),this.telemetryService.publicLog2("settingsSync:sync",{duration:new Date().getTime()-a}),this.manifest===null)try{this.manifest=await this.userDataSyncStoreService.manifest(null)}catch(l){throw new Yn(Tt(l),l instanceof Te?l.code:"Unknown")}this.manifest&&this.manifest.session!==i&&this.storageService.store(gv,this.manifest.session,-1,1),!n.isCancellationRequested&&(s||await this.userDataSyncMachinesService.addCurrentMachine(this.manifest||void 0))}register(e){return super._register(e)}};var al=class extends sl{constructor(t,e,n,i,o,s,a,l,c,d,u){super(t,e,n,i,o,a,l,c,d,u),this._register(O.debounce(O.any(O.map(s.onDidFocusMainWindow,()=>"windowFocus"),O.map(s.onDidOpenMainWindow,()=>"windowOpen")),(f,h)=>f?[...f,h]:[h],1e3)(f=>this.triggerSync(f,!0,!1)))}};al=E([m(0,de),m(1,wn),m(2,je),m(3,it),m(4,Bo),m(5,Ni),m(6,Ie),m(7,Wo),m(8,le),m(9,Mo),m(10,X)],al);var Xc=class extends _{constructor(e,n){super();this.fileService=e;this.productService=n;this.productService.configBasedExtensionTips&&Object.entries(this.productService.configBasedExtensionTips).forEach(([,i])=>this.allConfigBasedTips.set(i.configPath,i))}_serviceBrand;allConfigBasedTips=new Map;getConfigBasedTips(e){return this.getValidConfigBasedTips(e)}async getImportantExecutableBasedTips(){return[]}async getOtherExecutableBasedTips(){return[]}async getValidConfigBasedTips(e){let n=[];for(let[i,o]of this.allConfigBasedTips)if(!(o.configScheme&&o.configScheme!==e.scheme))try{let s=(await this.fileService.readFile(V(e,i))).value.toString();for(let[a,l]of Object.entries(o.recommendations))(!l.contentPattern||new RegExp(l.contentPattern,"mig").test(s))&&n.push({extensionId:a,extensionName:l.name,configName:o.configName,important:!!l.important,isExtensionPack:!!l.isExtensionPack,whenNotInstalled:l.whenNotInstalled})}catch{}return n}};Xc=E([m(0,G),m(1,de)],Xc);var F1="extensionTips/promptedExecutableTips",A1="extensionTips/lastPromptedMediumImpExeTime",fh=class extends Xc{constructor(e,n,i,o,s,a,l,c){super(l,c);this.userHome=e;this.windowEvents=n;this.telemetryService=i;this.extensionManagementService=o;this.storageService=s;this.extensionRecommendationNotificationService=a;c.exeBasedExtensionTips&&Object.entries(c.exeBasedExtensionTips).forEach(([d,u])=>{let f=[],h=[],v=[];Object.entries(u.recommendations).forEach(([y,I])=>{I.important?u.important?f.push({extensionId:y,extensionName:I.name,isExtensionPack:!!I.isExtensionPack}):h.push({extensionId:y,extensionName:I.name,isExtensionPack:!!I.isExtensionPack}):v.push({extensionId:y,extensionName:I.name,isExtensionPack:!!I.isExtensionPack})}),f.length&&this.highImportanceExecutableTips.set(d,{exeFriendlyName:u.friendlyName,windowsPath:u.windowsPath,recommendations:f}),h.length&&this.mediumImportanceExecutableTips.set(d,{exeFriendlyName:u.friendlyName,windowsPath:u.windowsPath,recommendations:h}),v.length&&this.allOtherExecutableTips.set(d,{exeFriendlyName:u.friendlyName,windowsPath:u.windowsPath,recommendations:v})}),Pi(async()=>{await this.collectTips(),this.promptHighImportanceExeBasedTip(),this.promptMediumImportanceExeBasedTip()},3e3,this._store)}highImportanceExecutableTips=new Map;mediumImportanceExecutableTips=new Map;allOtherExecutableTips=new Map;highImportanceTipsByExe=new Map;mediumImportanceTipsByExe=new Map;async getImportantExecutableBasedTips(){let e=await this.getValidExecutableBasedExtensionTips(this.highImportanceExecutableTips),n=await this.getValidExecutableBasedExtensionTips(this.mediumImportanceExecutableTips);return[...e,...n]}getOtherExecutableBasedTips(){return this.getValidExecutableBasedExtensionTips(this.allOtherExecutableTips)}async collectTips(){let e=await this.getValidExecutableBasedExtensionTips(this.highImportanceExecutableTips),n=await this.getValidExecutableBasedExtensionTips(this.mediumImportanceExecutableTips),i=await this.extensionManagementService.getInstalled();this.highImportanceTipsByExe=this.groupImportantTipsByExe(e,i),this.mediumImportanceTipsByExe=this.groupImportantTipsByExe(n,i)}groupImportantTipsByExe(e,n){let i=new Map;e.forEach(c=>i.set(c.extensionId.toLowerCase(),c));let{installed:o,uninstalled:s}=this.groupByInstalled([...i.keys()],n);for(let c of o){let d=i.get(c);d&&this.telemetryService.publicLog2("exeExtensionRecommendations:alreadyInstalled",{extensionId:c,exeName:d.exeName})}for(let c of s){let d=i.get(c);d&&this.telemetryService.publicLog2("exeExtensionRecommendations:notInstalled",{extensionId:c,exeName:d.exeName})}let a=this.getPromptedExecutableTips(),l=new Map;for(let c of s){let d=i.get(c);if(d&&(!a[d.exeName]||!a[d.exeName].includes(d.extensionId))){let u=l.get(d.exeName);u||(u=[],l.set(d.exeName,u)),u.push(d)}}return l}promptHighImportanceExeBasedTip(){if(this.highImportanceTipsByExe.size===0)return;let[e,n]=[...this.highImportanceTipsByExe.entries()][0];this.promptExeRecommendations(n).then(i=>{switch(i){case"reacted":this.addToRecommendedExecutables(n[0].exeName,n);break;case"ignored":this.highImportanceTipsByExe.delete(e);break;case"incompatibleWindow":{let o=O.once(O.latch(O.any(this.windowEvents.onDidOpenMainWindow,this.windowEvents.onDidFocusMainWindow)));this._register(o(()=>this.promptHighImportanceExeBasedTip()));break}case"toomany":{let o=this._register(new zt);o.value=Pi(()=>{o.dispose(),this.promptHighImportanceExeBasedTip()},60*60*1e3);break}}})}promptMediumImportanceExeBasedTip(){if(this.mediumImportanceTipsByExe.size===0)return;let e=this.getLastPromptedMediumExeTime(),n=Date.now()-e,i=7*24*60*60*1e3;if(n<i){let a=this._register(new zt);a.value=Pi(()=>{a.dispose(),this.promptMediumImportanceExeBasedTip()},i-n);return}let[o,s]=[...this.mediumImportanceTipsByExe.entries()][0];this.promptExeRecommendations(s).then(a=>{switch(a){case"reacted":{this.updateLastPromptedMediumExeTime(Date.now()),this.mediumImportanceTipsByExe.delete(o),this.addToRecommendedExecutables(s[0].exeName,s);let l=this._register(new zt);l.value=Pi(()=>{l.dispose(),this.promptMediumImportanceExeBasedTip()},i);break}case"ignored":this.mediumImportanceTipsByExe.delete(o),this.promptMediumImportanceExeBasedTip();break;case"incompatibleWindow":{let l=O.once(O.latch(O.any(this.windowEvents.onDidOpenMainWindow,this.windowEvents.onDidFocusMainWindow)));this._register(l(()=>this.promptMediumImportanceExeBasedTip()));break}case"toomany":{let l=this._register(new zt);l.value=Pi(()=>{l.dispose(),this.promptMediumImportanceExeBasedTip()},60*60*1e3);break}}})}async promptExeRecommendations(e){let n=await this.extensionManagementService.getInstalled(1),i=e.filter(o=>!o.whenNotInstalled||o.whenNotInstalled.every(s=>n.every(a=>!Y(a.identifier,{id:s})))).map(({extensionId:o})=>o.toLowerCase());return this.extensionRecommendationNotificationService.promptImportantExtensionsInstallNotification({extensions:i,source:3,name:e[0].exeFriendlyName,searchValue:`@exe:"${e[0].exeName}"`})}getLastPromptedMediumExeTime(){let e=this.storageService.getNumber(A1,-1);return e||(e=Date.now(),this.updateLastPromptedMediumExeTime(e)),e}updateLastPromptedMediumExeTime(e){this.storageService.store(A1,e,-1,1)}getPromptedExecutableTips(){return JSON.parse(this.storageService.get(F1,-1,"{}"))}addToRecommendedExecutables(e,n){let i=this.getPromptedExecutableTips();i[e]=n.map(({extensionId:o})=>o.toLowerCase()),this.storageService.store(F1,JSON.stringify(i),-1,0)}groupByInstalled(e,n){let i=[],o=[],s=n.reduce((a,l)=>(a.add(l.identifier.id.toLowerCase()),a),new Set);return e.forEach(a=>{s.has(a.toLowerCase())?i.push(a):o.push(a)}),{installed:i,uninstalled:o}}async getValidExecutableBasedExtensionTips(e){let n=[],i=new Map;for(let o of e.keys()){let s=e.get(o);if(!s||!Si(s.recommendations))continue;let a=[];be?s.windowsPath&&a.push(s.windowsPath.replace("%USERPROFILE%",()=>Me.USERPROFILE).replace("%ProgramFiles(x86)%",()=>Me["ProgramFiles(x86)"]).replace("%ProgramFiles%",()=>Me.ProgramFiles).replace("%APPDATA%",()=>Me.APPDATA).replace("%WINDIR%",()=>Me.WINDIR)):(a.push(W("/usr/local/bin",o)),a.push(W("/usr/bin",o)),a.push(W(this.userHome.fsPath,o)));for(let l of a){let c=i.get(l);if(c===void 0&&(c=await this.fileService.exists(C.file(l)),i.set(l,c)),c)for(let{extensionId:d,extensionName:u,isExtensionPack:f,whenNotInstalled:h}of s.recommendations)n.push({extensionId:d,extensionName:u,isExtensionPack:f,exeName:o,exeFriendlyName:s.exeFriendlyName,windowsPath:s.windowsPath,whenNotInstalled:h})}}return n}};var ll=class extends fh{constructor(t,e,n,i,o,s,a,l){super(t.userHome,o,e,n,i,s,a,l)}};ll=E([m(0,St),m(1,le),m(2,an),m(3,X),m(4,Ni),m(5,Hf),m(6,G),m(7,de)],ll);var ph=class extends sa{constructor(e,n,i,o){super();this.initialWorkspace=e;this.initialProfiles=n;this.remoteService=i;this.environmentService=o}applicationStorageProfile=this.initialProfiles.defaultProfile;applicationStorage=this.createApplicationStorage();profileStorageProfile=this.initialProfiles.currentProfile;profileStorageDisposables=this._register(new te);profileStorage=this.createProfileStorage(this.profileStorageProfile);workspaceStorageId=this.initialWorkspace?.id;workspaceStorageDisposables=this._register(new te);workspaceStorage=this.createWorkspaceStorage(this.initialWorkspace);createApplicationStorage(){let e=this._register(new Ns(this.remoteService.getChannel("storage"))),n=this._register(new ei(e));return this._register(n.onDidChangeStorage(i=>this.emitDidChangeValue(-1,i))),n}createProfileStorage(e){this.profileStorageDisposables.clear(),this.profileStorageProfile=e;let n;if(aa(e))n=this.applicationStorage;else{let i=this.profileStorageDisposables.add(new Bs(this.remoteService.getChannel("storage"),e));n=this.profileStorageDisposables.add(new ei(i))}return this.profileStorageDisposables.add(n.onDidChangeStorage(i=>this.emitDidChangeValue(0,i))),n}createWorkspaceStorage(e){this.workspaceStorageDisposables.clear(),this.workspaceStorageId=e?.id;let n;if(e){let i=this.workspaceStorageDisposables.add(new Ju(this.remoteService.getChannel("storage"),e));n=this.workspaceStorageDisposables.add(new ei(i)),this.workspaceStorageDisposables.add(n.onDidChangeStorage(o=>this.emitDidChangeValue(1,o)))}return n}async doInitialize(){await Qe.settled([this.applicationStorage.init(),this.profileStorage.init(),this.workspaceStorage?.init()??Promise.resolve()])}getStorage(e){switch(e){case-1:return this.applicationStorage;case 0:return this.profileStorage;default:return this.workspaceStorage}}getLogDetails(e){switch(e){case-1:return this.applicationStorageProfile.globalStorageHome.with({scheme:ne.file}).fsPath;case 0:return this.profileStorageProfile?.globalStorageHome.with({scheme:ne.file}).fsPath;default:return this.workspaceStorageId?`${V(this.environmentService.workspaceStorageHome,this.workspaceStorageId,"state.vscdb").with({scheme:ne.file}).fsPath}`:void 0}}async close(){this.stopFlushWhenIdle(),this.emitWillSaveState(1),await Qe.settled([this.applicationStorage.close(),this.profileStorage.close(),this.workspaceStorage?.close()??Promise.resolve()])}async switchToProfile(e){if(!this.canSwitchProfile(this.profileStorageProfile,e))return;let n=this.profileStorage,i=n.items;n!==this.applicationStorage&&await n.close(),this.profileStorage=this.createProfileStorage(e),await this.profileStorage.init(),this.switchData(i,this.profileStorage,0)}async switchToWorkspace(e,n){let i=this.workspaceStorage,o=i?.items??new Map;await i?.close(),this.workspaceStorage=this.createWorkspaceStorage(e),await this.workspaceStorage.init(),this.switchData(o,this.workspaceStorage,1)}hasScope(e){return ju(e)?this.profileStorageProfile.id===e.id:this.workspaceStorageId===e.id}};import*as M1 from"net";var O1=(r,t,e)=>{let n=new Uint8Array(16);for(let s=0;s<16;s++)n[s]=Math.round(Math.random()*256);let i=lS(A.wrap(n));return[`GET ws://localhost${r}?${t}&skipWebSocketFrames=true HTTP/1.1`,"Connection: Upgrade","Upgrade: websocket",`Sec-WebSocket-Key: ${i}`].join(`\r
`)+`\r
\r
`},eUe=A.fromString(`\r
\r
`);var N1=new class{supports(r){return!0}connect({host:r,port:t},e,n,i){return new Promise((o,s)=>{let a=M1.createConnection({host:r,port:t},()=>{a.removeListener("error",s),a.write(O1(e,n,i));let l=c=>{c.toString().indexOf(`\r
\r
`)>=0&&(a.off("data",l),o(new Qo(a,i)))};a.on("data",l)});a.setNoDelay(!0),a.once("error",s)})}};import{homedir as gC,tmpdir as mC}from"os";var B1=/^([^.]+\..+)[:=](.+)$/,Be=class{constructor(t,e,n){this._args=t;this.paths=e;this.productService=n}get appRoot(){return Et(Sn.asFileUri("").fsPath)}get userHome(){return C.file(this.paths.homeDir)}get userDataPath(){return this.paths.userDataDir}get appSettingsHome(){return C.file(W(this.userDataPath,"User"))}get tmpDir(){return C.file(this.paths.tmpDir)}get cacheHome(){return C.file(this.userDataPath)}get stateResource(){return V(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome.with({scheme:ne.vscodeUserData})}get userDataSyncHome(){return V(this.appSettingsHome,"sync")}get logsHome(){if(!this.args.logsPath){let t=ka(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=W(this.userDataPath,"logs",t)}return C.file(this.args.logsPath)}get sync(){return this.args.sync}get machineSettingsResource(){return V(C.file(W(this.userDataPath,"Machine")),"settings.json")}get workspaceStorageHome(){return V(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return V(this.appSettingsHome,"History")}get keyboardLayoutResource(){return V(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){let t=Me.VSCODE_PORTABLE;return t?C.file(W(t,"argv.json")):V(this.userHome,this.productService.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return C.file(W(this.userDataPath,"Workspaces"))}get builtinExtensionsPath(){let t=this.args["builtin-extensions-dir"];return t?Rr(t):Dn(W(Sn.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){let t=this.args["extensions-download-dir"];return t?C.file(Rr(t)):C.file(W(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){let t=this.args["extensions-dir"];if(t)return Rr(t);let e=Me.VSCODE_EXTENSIONS;if(e)return e;let n=Me.VSCODE_PORTABLE;return n?W(n,"extensions"):V(this.userHome,this.productService.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){let t=this.args.extensionDevelopmentPath;if(Array.isArray(t))return t.map(e=>/^[^:/?#]+?:\/\//.test(e)?C.parse(e):C.file(Dn(e)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(t=>t==="ui"||t==="workspace"||t==="web"?t:"workspace")}get extensionTestsLocationURI(){let t=this.args.extensionTestsPath;if(t)return/^[^:/?#]+?:\/\//.test(t)?C.parse(t):C.file(Dn(t))}get disableExtensions(){if(this.args["disable-extensions"])return!0;let t=this.args["disable-extension"];if(t){if(typeof t=="string")return[t];if(Array.isArray(t)&&t.length>0)return t}return!1}get debugExtensionHost(){return fC(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!Me.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(t=>!B1.test(t))}get extensionLogLevel(){let t=[];for(let e of this.args.log||[]){let n=B1.exec(e);n&&n[1]&&n[2]&&t.push([n[1],n[2]])}return t.length?t:void 0}get serviceMachineIdResource(){return V(C.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get useInMemorySecretStorage(){return!!this.args["use-inmemory-secretstorage"]}get policyFile(){if(this.args["__enable-file-policy"]){let t=Me.VSCODE_PORTABLE;return t?C.file(W(t,"policy.json")):V(this.userHome,this.productService.dataFolderName,"policy.json")}}editSessionId=this.args.editSessionId;get continueOn(){return this.args.continueOn}set continueOn(t){this.args.continueOn=t}get args(){return this._args}};E([We],Be.prototype,"appRoot",1),E([We],Be.prototype,"userHome",1),E([We],Be.prototype,"userDataPath",1),E([We],Be.prototype,"appSettingsHome",1),E([We],Be.prototype,"tmpDir",1),E([We],Be.prototype,"cacheHome",1),E([We],Be.prototype,"stateResource",1),E([We],Be.prototype,"userRoamingDataHome",1),E([We],Be.prototype,"userDataSyncHome",1),E([We],Be.prototype,"sync",1),E([We],Be.prototype,"machineSettingsResource",1),E([We],Be.prototype,"workspaceStorageHome",1),E([We],Be.prototype,"localHistoryHome",1),E([We],Be.prototype,"keyboardLayoutResource",1),E([We],Be.prototype,"argvResource",1),E([We],Be.prototype,"isExtensionDevelopment",1),E([We],Be.prototype,"untitledWorkspacesHome",1),E([We],Be.prototype,"builtinExtensionsPath",1),E([We],Be.prototype,"extensionsPath",1),E([We],Be.prototype,"extensionDevelopmentLocationURI",1),E([We],Be.prototype,"extensionDevelopmentKind",1),E([We],Be.prototype,"extensionTestsLocationURI",1),E([We],Be.prototype,"debugExtensionHost",1),E([We],Be.prototype,"logLevel",1),E([We],Be.prototype,"extensionLogLevel",1),E([We],Be.prototype,"serviceMachineIdResource",1),E([We],Be.prototype,"disableTelemetry",1),E([We],Be.prototype,"disableWorkspaceTrust",1),E([We],Be.prototype,"useInMemorySecretStorage",1),E([We],Be.prototype,"policyFile",1);function fC(r,t){return W1(r["inspect-extensions"],r["inspect-brk-extensions"],5870,t,r.debugId,r.extensionEnvironment)}function W1(r,t,e,n,i,o){let a=Number(t||r)||(n?null:e),l=a?!!t:!1,c;if(o)try{c=JSON.parse(o)}catch{}return{port:a,break:l,debugId:i,env:c}}import*as pC from"os";import*as hC from"path";var hh={exports:{}};(function(){function t(e,n,i){function o(a,l){let c=s(a,l),d=[c];return e.isAbsolute(c)||d.unshift(i),e.resolve(...d)}function s(a,l){process.env.VSCODE_DEV&&(l="code-oss-dev");let c=process.env.VSCODE_PORTABLE;if(c)return e.join(c,"user-data");let d=process.env.VSCODE_APPDATA;if(d)return e.join(d,l);let u=a["user-data-dir"];if(u)return u;switch(process.platform){case"win32":if(d=process.env.APPDATA,!d){let f=process.env.USERPROFILE;if(typeof f!="string")throw new Error("Windows: Unexpected undefined %USERPROFILE% environment variable");d=e.join(f,"AppData","Roaming")}break;case"darwin":d=e.join(n.homedir(),"Library","Application Support");break;case"linux":d=process.env.XDG_CONFIG_HOME||e.join(n.homedir(),".config");break;default:throw new Error("Platform not supported")}return e.join(d,l)}return{getUserDataPath:o}}if(typeof hh=="object"&&typeof hh.exports=="object")hh.exports=t(hC,pC,process.env.VSCODE_CWD||process.cwd());else throw new Error("Unknown context")})();var V1=hh.exports.getUserDataPath;var gh=class extends Be{constructor(t,e){super(t,{homeDir:gC(),tmpDir:mC(),userDataDir:V1(t,e.nameShort)},e)}};var mh={exit:"vscode:electron-main->shared-process=exit",ipcReady:"vscode:shared-process->electron-main=ipc-ready",initDone:"vscode:shared-process->electron-main=init-done"};var K1={request:"vscode:createSharedProcessRawConnection",response:"vscode:createSharedProcessRawConnectionResult"};import{constants as yC,promises as vC}from"fs";import{createInterface as IC}from"readline";async function $1(r){if(_t||be)return;let t;for(let e of["/etc/os-release","/usr/lib/os-release","/etc/lsb-release"])try{t=await vC.open(e,yC.R_OK);break}catch{}if(!t){r("Unable to retrieve release information from known identifier paths.");return}try{let e=new Set(["ID","DISTRIB_ID","ID_LIKE","VERSION_ID","DISTRIB_RELEASE"]),n={id:"unknown"};for await(let i of IC({input:t.createReadStream(),crlfDelay:1/0})){if(!i.includes("="))continue;let o=i.split("=")[0].toUpperCase().trim();if(e.has(o)){let s=i.split("=")[1].replace(/"/g,"").toLowerCase().trim();o==="ID"||o==="DISTRIB_ID"?n.id=s:o==="ID_LIKE"?n.id_like=s:(o==="VERSION_ID"||o==="DISTRIB_RELEASE")&&(n.version_id=s)}}return n}catch(e){r(e)}}var SC="XDG_CURRENT_DESKTOP",yv="KDE_SESSION_VERSION";function z1(){let r=Me[SC];if(r){let e=r.split(":").map(n=>n.trim()).filter(n=>n.length>0);for(let n of e)switch(n){case"Unity":{let i=Me.DESKTOP_SESSION;return i&&i.includes("gnome-fallback")?"GNOME":"UNITY"}case"Deepin":return"DEEPIN";case"GNOME":return"GNOME";case"X-Cinnamon":return"CINNAMON";case"KDE":{let i=Me[yv];return i==="5"?"KDE5":i==="6"?"KDE6":"KDE4"}case"Pantheon":return"PANTHEON";case"XFCE":return"XFCE";case"UKUI":return"UKUI";case"LXQt":return"LXQT"}}let t=Me.DESKTOP_SESSION;if(t)switch(t){case"deepin":return"DEEPIN";case"gnome":case"mate":return"GNOME";case"kde4":case"kde-plasma":return"KDE4";case"kde":return yv in Me?"KDE4":"KDE3";case"xfce":case"xubuntu":return"XFCE";case"ukui":return"UKUI"}return"GNOME_DESKTOP_SESSION_ID"in Me?"GNOME":"KDE_FULL_SESSION"in Me?yv in Me?"KDE4":"KDE3":"UNKNOWN"}import{constants as bC,promises as xC}from"fs";var EC="XDG_SESSION_TYPE",wC="WAYLAND_DISPLAY",PC="XDG_RUNTIME_DIR";async function q1(r){let t=Me[EC];if(t)return t==="wayland"||t==="x11"?t:"unknown";if(Me[wC]){let n=Me[PC];if(n){let i=W(n,"wayland-0");try{return await xC.access(i,bC.R_OK),"wayland"}catch(o){return r(o),"unknown"}}else return"unknown"}else return"x11"}function H1(r,t){if(t)switch(t){case"auto":return r;case"x11":return r==="wayland"?"xwayland":"x11";case"wayland":return"wayland";default:return"unknown"}else return r==="wayland"?"xwayland":"x11"}import{net as $D}from"electron";import{parse as k0}from"url";import{spawn as BC}from"child_process";import{userInfo as LC}from"os";import*as Q1 from"os";var j1=/^\d+$/,TC=/^Microsoft.PowerShell_.*/,RC=/^Microsoft.PowerShellPreview_.*/;var Yc;switch(process.arch){case"ia32":Yc=1;break;case"arm":case"arm64":Yc=2;break;default:Yc=0;break}var cl;process.env.PROCESSOR_ARCHITEW6432?cl=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?cl=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?cl=1:cl=0;var dl=class{constructor(t,e,n){this.exePath=t;this.displayName=e;this.knownToExist=n}async exists(){return this.knownToExist===void 0&&(this.knownToExist=await gn.existsFile(this.exePath)),this.knownToExist}};function CC({useAlternateBitness:r=!1}={}){return r?Yc===0?process.env["ProgramFiles(x86)"]||null:cl===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function yh({useAlternateBitness:r=!1,findPreview:t=!1}={}){let e=CC({useAlternateBitness:r});if(!e)return null;let n=W(e,"PowerShell");if(!await gn.existsDirectory(n))return null;let i=-1,o=null;for(let l of await ce.readdir(n)){let c=-1;if(t){let u=l.indexOf("-");if(u<0)continue;let f=l.substring(0,u);if(!j1.test(f)||l.substring(u+1)!=="preview")continue;c=parseInt(f,10)}else{if(!j1.test(l))continue;c=parseInt(l,10)}if(c<=i)continue;let d=W(n,l,"pwsh.exe");await gn.existsFile(d)&&(o=d,i=c)}if(!o)return null;let s=e.includes("x86")?" (x86)":"",a=t?" Preview":"";return new dl(o,`PowerShell${a}${s}`,!0)}async function G1({findPreview:r}={}){if(!process.env.LOCALAPPDATA)return null;let t=W(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await gn.existsDirectory(t))return null;let{pwshMsixDirRegex:e,pwshMsixName:n}=r?{pwshMsixDirRegex:RC,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:TC,pwshMsixName:"PowerShell (Store)"};for(let i of await ce.readdir(t))if(e.test(i)){let o=W(t,i,"pwsh.exe");return new dl(o,n)}return null}function DC(){let r=W(Q1.homedir(),".dotnet","tools","pwsh.exe");return new dl(r,".NET Core PowerShell Global Tool")}function _C(){let r=W(process.env.windir,Yc===1&&cl!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new dl(r,"Windows PowerShell",!0)}async function*kC(){let r=await yh();r&&(yield r),r=await yh({useAlternateBitness:!0}),r&&(yield r),r=await G1(),r&&(yield r),r=DC(),r&&(yield r),r=await yh({findPreview:!0}),r&&(yield r),r=await G1({findPreview:!0}),r&&(yield r),r=await yh({useAlternateBitness:!0,findPreview:!0}),r&&(yield r),r=_C(),r&&(yield r)}async function*UC(){for await(let r of kC())await r.exists()&&(yield r)}async function J1(){for await(let r of UC())return r;return null}async function X1(r,t){return r===1?be?AC():Zx(t):FC(r,t)}var vv=null;function FC(r,t){if(Oe&&r===2||_t&&r===3)return"/bin/bash";if(!vv){let e;if(be)e="/bin/bash";else{if(e=t.SHELL,!e)try{e=LC().shell}catch{}e||(e="sh"),e==="/bin/false"&&(e="/bin/bash")}vv=e}return vv}var Iv=null;async function AC(){return Iv||(Iv=(await J1()).exePath),Iv}var MC=Uh(t0());var eLe={o:g("optionsUpperCase","Options"),e:g("extensionsManagement","Extensions Management"),t:g("troubleshooting","Troubleshooting")};var NC={tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel",options:{"cli-data-dir":{type:"string",args:"dir",description:g("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:g("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:g("diff","Compare two files with each other.")},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:g("merge","Perform a three-way merge by providing paths for two modified versions of a file, the common origin of both modified versions and the output file to save merge results.")},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:g("add","Add folder(s) to the last active window.")},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:g("goto","Open a file at the path on the specified line and character position.")},"new-window":{type:"boolean",cat:"o",alias:"n",description:g("newWindow","Force to open a new window.")},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:g("reuseWindow","Force to open a file or folder in an already opened window.")},wait:{type:"boolean",cat:"o",alias:"w",description:g("wait","Wait for the files to be closed before returning.")},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:g("locale","The locale to use (e.g. en-US or zh-TW).")},"user-data-dir":{type:"string",cat:"o",args:"dir",description:g("userDataDir","Specifies the directory that user data is kept in. Can be used to open multiple distinct instances of Code.")},profile:{type:"string",cat:"o",args:"profileName",description:g("profileName","Opens the provided folder or workspace with the given profile and associates the profile with the workspace. If the profile does not exist, a new empty one is created.")},help:{type:"boolean",cat:"o",alias:"h",description:g("help","Print usage.")},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:g("extensionHomePath","Set the root path for extensions.")},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:g("listExtensions","List the installed extensions.")},"show-versions":{type:"boolean",cat:"e",description:g("showVersions","Show versions of installed extensions, when using --list-extensions.")},category:{type:"string",allowEmptyValue:!0,cat:"e",description:g("category","Filters installed extensions by provided category, when using --list-extensions."),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:g("installExtension","Installs or updates an extension. The argument is either an extension id or a path to a VSIX. The identifier of an extension is '${publisher}.${name}'. Use '--force' argument to update to latest version. To install a specific version provide '@${version}'. For example: 'vscode.csharp@1.2.3'.")},"pre-release":{type:"boolean",cat:"e",description:g("install prerelease","Installs the pre-release version of the extension, when using --install-extension")},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:g("uninstallExtension","Uninstalls an extension.")},"update-extensions":{type:"boolean",cat:"e",description:g("updateExtensions","Update the installed extensions.")},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:g("experimentalApis","Enables proposed API features for extensions. Can receive one or more extension IDs to enable individually.")},version:{type:"boolean",cat:"t",alias:"v",description:g("version","Print version.")},verbose:{type:"boolean",cat:"t",global:!0,description:g("verbose","Print verbose output (implies --wait).")},log:{type:"string[]",cat:"t",args:"level",global:!0,description:g("log","Log level to use. Default is 'info'. Allowed values are 'critical', 'error', 'warn', 'info', 'debug', 'trace', 'off'. You can also configure the log level of an extension by passing extension id and log level in the following format: '${publisher}.${name}:${logLevel}'. For example: 'vscode.csharp:trace'. Can receive one or more such entries.")},status:{type:"boolean",alias:"s",cat:"t",description:g("status","Print process usage and diagnostics information.")},"prof-startup":{type:"boolean",cat:"t",description:g("prof-startup","Run CPU profiler during startup.")},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:g("disableExtensions","Disable all installed extensions. This option is not persisted and is effective only when the command opens a new window.")},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:g("disableExtension","Disable the provided extension. This option is not persisted and is effective only when the command opens a new window.")},sync:{type:"string",cat:"t",description:g("turn sync","Turn sync on or off."),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:g("inspect-extensions","Allow debugging and profiling of extensions. Check the developer tools for the connection URI.")},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:g("inspect-brk-extensions","Allow debugging and profiling of extensions with the extension host being paused after start. Check the developer tools for the connection URI.")},"disable-lcd-text":{type:"boolean",cat:"t",description:g("disableLCDText","Disable LCD font rendering.")},"disable-gpu":{type:"boolean",cat:"t",description:g("disableGPU","Disable GPU hardware acceleration.")},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:g("disableChromiumSandbox","Use this option only when there is requirement to launch the application as sudo user on Linux or when running as an elevated user in an applocker environment on Windows.")},sandbox:{type:"boolean"},telemetry:{type:"boolean",cat:"t",description:g("telemetry","Shows all telemetry events which VS code collects.")},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},trace:{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"locate-shell-integration-path":{type:"string",args:["bash","pwsh","zsh","fish"]},"enable-coi":{type:"boolean"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},_:{type:"string[]"}};function Sv(r){return r.VSCODE_CLI==="1"}function n0(r,t,e){return Math.min(Math.max(r,t),e)}var bv;async function r0(r,t,e,n){return e["force-disable-user-env"]?(t.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):be?(t.trace("resolveShellEnv(): skipped (Windows)"),{}):Sv(n)&&!e["force-user-env"]?(t.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):(Sv(n)?t.trace("resolveShellEnv(): running (--force-user-env)"):t.trace("resolveShellEnv(): running (macOS/Linux)"),bv||(bv=Qe.withAsyncBody(async(i,o)=>{let s=new It,a=1e4,l=r.getValue("application.shellEnvironmentResolutionTimeout");typeof l=="number"&&(a=n0(l,1,120)*1e3);let c=setTimeout(()=>{s.dispose(!0),o(new Error(g("resolveShellEnvTimeout","Unable to resolve your shell environment in a reasonable time. Please review your shell configuration and restart.")))},a);try{i(await WC(t,s.token))}catch(d){!Rn(d)&&!s.token.isCancellationRequested?o(new Error(g("resolveShellEnvError","Unable to resolve your shell environment: {0}",Tt(d)))):i({})}finally{clearTimeout(c),s.dispose()}})),bv)}async function WC(r,t){let e=process.env.ELECTRON_RUN_AS_NODE;r.trace("getUnixShellEnvironment#runAsNode",e);let n=process.env.ELECTRON_NO_ATTACH_CONSOLE;r.trace("getUnixShellEnvironment#noAttach",n);let i=Fe().replace(/-/g,"").substr(0,12),o=new RegExp(i+"({.*})"+i),s={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};r.trace("getUnixShellEnvironment#env",s);let a=await X1(ir,s);return r.trace("getUnixShellEnvironment#shell",a),new Promise((l,c)=>{if(t.isCancellationRequested)return c(new Ge);let d=at(a),u,f,h="";/^pwsh(-preview)?$/.test(d)?(u=`& '${process.execPath}' ${h} -p '''${i}'' + JSON.stringify(process.env) + ''${i}'''`,f=["-Login","-Command"]):d==="nu"?(u=`^'${process.execPath}' ${h} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,f=["-i","-l","-c"]):d==="xonsh"?(u=`import os, json; print("${i}", json.dumps(dict(os.environ)), "${i}")`,f=["-i","-l","-c"]):(u=`'${process.execPath}' ${h} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,d==="tcsh"||d==="csh"?f=["-ic"]:f=["-i","-l","-c"]),r.trace("getUnixShellEnvironment#spawn",JSON.stringify(f),u);let v=BC(a,[...f,u],{detached:!0,stdio:["ignore","pipe","pipe"],env:s});t.onCancellationRequested(()=>(v.kill(),c(new Ge))),v.on("error",x=>{r.error("getUnixShellEnvironment#errorChildProcess",Tt(x)),c(x)});let y=[];v.stdout.on("data",x=>y.push(x));let I=[];v.stderr.on("data",x=>I.push(x)),v.on("close",(x,T)=>{let R=Buffer.concat(y).toString("utf8");r.trace("getUnixShellEnvironment#raw",R);let w=Buffer.concat(I).toString("utf8");if(w.trim()&&r.trace("getUnixShellEnvironment#stderr",w),x||T)return c(new Error(g("resolveShellEnvExitError","Unexpected exit code from spawned shell (code {0}, signal {1})",x,T)));let L=o.exec(R),Q=L?L[1]:"{}";try{let K=JSON.parse(Q);e?K.ELECTRON_RUN_AS_NODE=e:delete K.ELECTRON_RUN_AS_NODE,n?K.ELECTRON_NO_ATTACH_CONSOLE=n:delete K.ELECTRON_NO_ATTACH_CONSOLE,delete K.VSCODE_RESOLVING_ENVIRONMENT,delete K.XDG_RUNTIME_DIR,r.trace("getUnixShellEnvironment#result",K),l(K)}catch(K){r.error("getUnixShellEnvironment#errorCaught",Tt(K)),c(K)}})})}import{parse as D0}from"url";function WD(r,t){return r.protocol==="http:"?t.HTTP_PROXY||t.http_proxy||null:r.protocol==="https:"&&(t.HTTPS_PROXY||t.https_proxy||t.HTTP_PROXY||t.http_proxy)||null}async function _0(r,t,e={}){let n=D0(r),i=e.proxyUrl||WD(n,t);if(!i)return null;let o=D0(i);if(!/^https?:$/.test(o.protocol||""))return null;let s={host:o.hostname||"",port:(o.port?+o.port:0)||(o.protocol==="https"?443:80),auth:o.auth,rejectUnauthorized:pn(e.strictSSL)?e.strictSSL:!0};if(n.protocol==="http:"){let{default:a}=await Promise.resolve().then(()=>Uh(x0()));return new a.HttpProxyAgent(i,s)}else{let{default:a}=await Promise.resolve().then(()=>Uh(C0()));return new a.HttpsProxyAgent(i,s)}}import{createGunzip as VD}from"zlib";var yl=class extends af{constructor(e,n,i){super(i);this.configurationService=e;this.environmentService=n;this.configure(),this._register(e.onDidChangeConfiguration(o=>{o.affectsConfiguration("http")&&this.configure()}))}proxyUrl;strictSSL;authorization;shellEnvErrorLogged;configure(){let e=this.configurationService.getValue("http");this.proxyUrl=e?.proxy,this.strictSSL=!!e?.proxyStrictSSL,this.authorization=e?.proxyAuthorization}async request(e,n){let{proxyUrl:i,strictSSL:o}=this,s;try{s=await r0(this.configurationService,this.logService,this.environmentService.args,process.env)}catch(c){this.shellEnvErrorLogged||(this.shellEnvErrorLogged=!0,this.logService.error("resolving shell environment failed",me(c)))}let a={...process.env,...s},l=e.agent?e.agent:await _0(e.url||"",a,{proxyUrl:i,strictSSL:o});return e.agent=l,e.strictSSL=o,this.authorization&&(e.headers={...e.headers||{},"Proxy-Authorization":this.authorization}),this.logAndRequest(e,()=>U0(e,n))}async resolveProxy(e){}async lookupAuthorization(e){}async lookupKerberosAuthorization(e){try{let n=await import("kerberos"),i=new URL(e),o=this.configurationService.getValue("http.proxyKerberosServicePrincipal")||(process.platform==="win32"?`HTTP/${i.hostname}`:`HTTP@${i.hostname}`);return this.logService.debug("RequestService#lookupKerberosAuthorization Kerberos authentication lookup",`proxyURL:${i}`,`spn:${o}`),"Negotiate "+await(await n.initializeClient(o)).step("")}catch(n){this.logService.debug("RequestService#lookupKerberosAuthorization Kerberos authentication failed",n);return}}async loadCertificates(){return(await import("@vscode/proxy-agent")).loadSystemCertificates({log:this.logService})}};yl=E([m(0,ue),m(1,St),m(2,z)],yl);async function KD(r){return(k0(r.url).protocol==="https:"?await import("https"):await import("http")).request}async function U0(r,t){return Qe.withAsyncBody(async(e,n)=>{let i=k0(r.url),o=r.getRawRequest?r.getRawRequest(r):await KD(r),s={hostname:i.hostname,port:i.port?parseInt(i.port):i.protocol==="https:"?443:80,protocol:i.protocol,path:i.path,method:r.type||"GET",headers:r.headers,agent:r.agent,rejectUnauthorized:pn(r.strictSSL)?r.strictSSL:!0};r.user&&r.password&&(s.auth=r.user+":"+r.password);let a=o(s,l=>{let c=yo(r.followRedirects)?r.followRedirects:3;if(l.statusCode&&l.statusCode>=300&&l.statusCode<400&&c>0&&l.headers.location)U0({...r,url:l.headers.location,followRedirects:c-1},t).then(e,n);else{let d=l;!r.isChromiumNetwork&&l.headers["content-encoding"]==="gzip"&&(d=l.pipe(VD())),e({res:l,stream:sS(d)})}});a.on("error",n),r.timeout&&a.setTimeout(r.timeout),r.isChromiumNetwork&&a.removeHeader("Content-Length"),r.data&&typeof r.data=="string"&&a.write(r.data),a.end(),t.onCancellationRequested(()=>{a.abort(),n(new Ge)})})}function zD(r){return $D.request}var Th=class extends yl{request(t,e){return super.request({...t||{},getRawRequest:zD,isChromiumNetwork:!0},e)}};var Cv=class extends _{constructor(e){super();this.configuration=e;this.registerListeners()}server=this._register(new nu(this));lifecycleService=void 0;onDidWindowConnectRaw=this._register(new P);registerListeners(){let e=!1,n=()=>{e||(e=!0,this.lifecycleService?.fireOnWillShutdown(),this.dispose())};process.once("exit",n),pS(process.parentPort,mh.exit,n)}async init(){let e=await this.initServices();i1(),e.invokeFunction(n=>{let i=n.get(z),o=n.get(le),s=n.get(ge);i.trace("sharedProcess configuration",JSON.stringify(this.configuration)),this.initChannels(n),this.registerErrorHandler(i),this.reportProfilesInfo(o,s),this._register(s.onDidChangeProfiles(()=>this.reportProfilesInfo(o,s))),this.reportClientOSInfo(o,i)}),this._register(mi(e.createInstance(Ss,this.configuration.codeCachePath),e.createInstance(bs),e.createInstance(Js),e.createInstance(Ms),e.createInstance(Os),e.createInstance(tl),e.createInstance(el)))}async initServices(){let e=new Di,n={_serviceBrand:void 0,...Nr};e.set(de,n);let i=new Vl(ie=>ie==="main"),o=new mf(this.server,i);e.set(Bi,o);let s=this.configuration.policiesData?new oh(this.configuration.policiesData,o.getChannel("policy")):new Ws;e.set(Zu,s);let a=new gh(this.configuration.args,n);e.set(St,a);let l=new cp(void 0,this.configuration.logLevel,a.logsHome,this.configuration.loggers.map(ie=>({...ie,resource:C.revive(ie.resource)})),o.getChannel("logger"));e.set(Lr,l);let c=this._register(l.createLogger("sharedprocess",{name:g("sharedLog","Shared")})),d=this._register(new uu(c.getLevel())),u=this._register(new ch(c,[d]));e.set(z,u),this.lifecycleService=this._register(new nl(u)),e.set(dh,this.lifecycleService);let f=this._register(new qi(u));e.set(G,f);let h=this._register(new sp(u));f.registerProvider(ne.file,h);let v=new Jo(f);e.set(he,v);let y=this._register(new sh(this.configuration.profiles.all,C.revive(this.configuration.profiles.home).with({scheme:a.userRoamingDataHome.scheme}),o.getChannel("userDataProfiles")));e.set(ge,y);let I=this._register(new nh(ne.file,this._register(new rh(o.getChannel(T1),{pathCaseSensitive:Oe})),ne.vscodeUserData,y,v,u));f.registerProvider(ne.vscodeUserData,I);let x=this._register(new wf(y.defaultProfile.settingsResource,f,s,u));e.set(ue,x);let T=new ph(void 0,{defaultProfile:y.defaultProfile,currentProfile:y.defaultProfile},o,a);e.set(X,T),this._register(J(()=>T.flush())),await Promise.all([x.initialize(),T.initialize()]);let R=new Th(x,a,u);e.set(vr,R),e.set(Am,new Ce(Xs,void 0,!1)),e.set(um,new Ce(ih,void 0,!1));let w=new ol(-1,o);e.set(Ni,w),e.set(Tf,new Ce(oa,void 0,!0));let L=this._register(new $p(w)),Q=new Vl(ie=>L.getActiveClientId().then(Ve=>ie===Ve));e.set(Hf,new uh(this.server.getChannel("extensionRecommendationNotification",Q)));let K,U=[],B=Tb(n,x);if(Fs(n,a)){let ie=new ji(u,l,a,n);if(U.push(ie),!Wu(n,a)&&n.aiConfig?.ariaKey){let Ve=new lh(R,B,"monacoworkbench",null,n.aiConfig.ariaKey);this._register(J(()=>Ve.flush())),U.push(Ve)}K=new Gi({appenders:U,commonProperties:Sb(HD(),qD(),process.arch,n.commit,n.version,this.configuration.machineId,this.configuration.sqmId,this.configuration.devDeviceId,B),sendErrorTelemetry:!0,piiPaths:Rb(a)},x,n)}else{K=Eb;let ie=wb;U.push(ie)}this.server.registerChannel("telemetryAppender",new dp(U)),e.set(le,K);let Ee=new Pa(x,K,u,l,a,n);e.set(lm,Ee),e.set(Jn,new Ce(il,void 0,!0)),e.set(Sa,new Ce(Za,void 0,!0)),e.set(Ff,new Ce(fa,void 0,!0)),e.set(qf,new Ce(xa,void 0,!0)),e.set(Bt,new Ce(ua,void 0,!0)),e.set(Jg,new Ce(ll,void 0,!1)),e.set(sc,new Ce(As,void 0,!1)),e.set(zm,new Ce(ia,void 0,!1)),e.set(Wo,new Ce(_a,void 0,!0)),e.set(Ie,new Ce(Aa,void 0,!0)),e.set(Ji,Yt.toService(this.server.getChannel("userDataSyncUtil",ie=>ie.ctx!=="main"))),e.set(wu,new Ce($i,void 0,!1)),e.set(Ca,new Ce(Ra,void 0,!0)),e.set(Ta,new Ce(Vt)),e.set(wn,new Ce(La,void 0,!0)),e.set(je,new Ce(Fa,void 0,!0)),e.set(Mo,new Ce(Xn,void 0,!0)),e.set(yt,new Ce(Ua,void 0,!1)),e.set(it,new Ce(Oa,void 0,!0)),e.set(Bo,new Ce(Ha,void 0,!1)),e.set(Zi,new Ce(ja,void 0,!0)),e.set(Ac,new Ce(nn,void 0,!0)),e.set(Ga,new Ce(qp,void 0,!1));let se=new Xp;return e.set(Qa,se),se.register(0,N1),e.set(Zp,new Ce(Ya)),e.set(iv,new Ce(so)),e.set(sv,new Ce(rl)),new lp(e)}initChannels(e){let n=new Af(e.get(an),()=>null);this.server.registerChannel("extensions",n);let i=Yt.fromService(e.get(sc),this._store);this.server.registerChannel("languagePacks",i);let o=Yt.fromService(e.get(zm),this._store);this.server.registerChannel("diagnostics",o);let s=new Of(e.get(Jg));this.server.registerChannel("extensionTipsService",s);let a=Yt.fromService(e.get(Am),this._store);this.server.registerChannel("checksum",a);let l=Yt.fromService(e.get(um),this._store);this.server.registerChannel("v8InspectProfiling",l);let c=Yt.fromService(e.get(Mo),this._store);this.server.registerChannel("userDataSyncMachines",c);let d=Yt.fromService(e.get(lm),this._store);this.server.registerChannel("customEndpointTelemetry",d);let u=new mp(e.get(Wo));this.server.registerChannel("userDataSyncAccount",u);let f=new yp(e.get(wn));this.server.registerChannel("userDataSyncStoreManagement",f);let h=new Kp(e.get(Bo),e.get(ge),e.get(z));this.server.registerChannel("userDataSync",h);let v=this._register(e.get(Ot).createInstance(al));this.server.registerChannel("userDataAutoSync",Yt.fromService(v,this._store)),this.server.registerChannel("IUserDataSyncResourceProviderService",Yt.fromService(e.get(Ac),this._store));let y=Yt.fromService(e.get(iv),this._store);this.server.registerChannel(w1,y);let I=Yt.fromService(e.get(sv),this._store);this.server.registerChannel("remoteTunnel",I)}registerErrorHandler(e){process.on("uncaughtException",n=>ze(n)),process.on("unhandledRejection",n=>ze(n)),Fv(n=>{let i=Tt(n,!0);i&&e.error(`[uncaught exception in sharedProcess]: ${i}`)})}reportProfilesInfo(e,n){e.publicLog2("profilesInfo",{count:n.profiles.length})}async reportClientOSInfo(e,n){if(Oe){let[i,o]=await Promise.all([$1(n.error.bind(n)),q1(n.error.bind(n))]),s=z1(),a=H1(o,this.configuration.args["ozone-platform"]);i&&e.publicLog2("clientPlatformInfo",{platformId:i.id,platformVersionId:i.version_id,platformIdLike:i.id_like,desktopEnvironment:s,displayProtocol:o,codeDisplayProtocol:a})}}handledClientConnection(e){if(e.data!==K1.response)return!1;let n=e.ports.at(0);return n?(this.onDidWindowConnectRaw.fire(n),!0):!1}};async function jD(r){try{let t=new Cv(r);process.parentPort.postMessage(mh.ipcReady),await t.init(),process.parentPort.postMessage(mh.initDone)}catch(t){process.parentPort.postMessage({error:t.toString()})}}var GD=setTimeout(()=>{process.parentPort.postMessage({warning:"[SharedProcess] did not receive configuration within 30s..."})},3e4);process.parentPort.once("message",r=>{clearTimeout(GD),jD(r.data)});export{jD as main};
