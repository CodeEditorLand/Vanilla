{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/code/electron-utility/sharedProcess/contrib/logsDataCleaner.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { join } from '../../../../base/common/path.js';\nimport { basename, dirname } from '../../../../base/common/resources.js';\nimport { Promises } from '../../../../base/node/pfs.js';\nimport { IEnvironmentService } from '../../../../platform/environment/common/environment.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\n\nexport class LogsDataCleaner extends Disposable {\n\n\tconstructor(\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tsuper();\n\n\t\tconst scheduler = this._register(new RunOnceScheduler(() => {\n\t\t\tthis.cleanUpOldLogs();\n\t\t}, 10 * 1000 /* after 10s */));\n\t\tscheduler.schedule();\n\t}\n\n\tprivate async cleanUpOldLogs(): Promise<void> {\n\t\tthis.logService.trace('[logs cleanup]: Starting to clean up old logs.');\n\n\t\ttry {\n\t\t\tconst currentLog = basename(this.environmentService.logsHome);\n\t\t\tconst logsRoot = dirname(this.environmentService.logsHome.with({ scheme: Schemas.file })).fsPath;\n\t\t\tconst logFiles = await Promises.readdir(logsRoot);\n\n\t\t\tconst allSessions = logFiles.filter(logFile => /^\\d{8}T\\d{6}$/.test(logFile));\n\t\t\tconst oldSessions = allSessions.sort().filter(session => session !== currentLog);\n\t\t\tconst sessionsToDelete = oldSessions.slice(0, Math.max(0, oldSessions.length - 9));\n\n\t\t\tif (sessionsToDelete.length > 0) {\n\t\t\t\tthis.logService.trace(`[logs cleanup]: Removing log folders '${sessionsToDelete.join(', ')}'`);\n\n\t\t\t\tawait Promise.all(sessionsToDelete.map(sessionToDelete => Promises.rm(join(logsRoot, sessionToDelete))));\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tonUnexpectedError(error);\n\t\t}\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,wBAAwB;AACjC,SAAS,yBAAyB;AAClC,SAAS,kBAAkB;AAC3B,SAAS,eAAe;AACxB,SAAS,YAAY;AACrB,SAAS,UAAU,eAAe;AAClC,SAAS,gBAAgB;AACzB,SAAS,2BAA2B;AACpC,SAAS,mBAAmB;AAErB,IAAM,kBAAN,cAA8B,WAAW;AAAA,EAE/C,YACuC,oBACR,YAC7B;AACD,UAAM;AAHgC;AACR;AAI9B,UAAM,YAAY,KAAK,UAAU,IAAI;AAAA,MAAiB,MAAM;AAC3D,aAAK,eAAe;AAAA,MACrB;AAAA,MAAG,KAAK;AAAA;AAAA,IAAoB,CAAC;AAC7B,cAAU,SAAS;AAAA,EACpB;AAAA,EA3BD,OAegD;AAAA;AAAA;AAAA,EAc/C,MAAc,iBAAgC;AAC7C,SAAK,WAAW,MAAM,gDAAgD;AAEtE,QAAI;AACH,YAAM,aAAa,SAAS,KAAK,mBAAmB,QAAQ;AAC5D,YAAM,WAAW,QAAQ,KAAK,mBAAmB,SAAS,KAAK,EAAE,QAAQ,QAAQ,KAAK,CAAC,CAAC,EAAE;AAC1F,YAAM,WAAW,MAAM,SAAS,QAAQ,QAAQ;AAEhD,YAAM,cAAc,SAAS,OAAO,aAAW,gBAAgB,KAAK,OAAO,CAAC;AAC5E,YAAM,cAAc,YAAY,KAAK,EAAE,OAAO,aAAW,YAAY,UAAU;AAC/E,YAAM,mBAAmB,YAAY,MAAM,GAAG,KAAK,IAAI,GAAG,YAAY,SAAS,CAAC,CAAC;AAEjF,UAAI,iBAAiB,SAAS,GAAG;AAChC,aAAK,WAAW,MAAM,yCAAyC,iBAAiB,KAAK,IAAI,CAAC,GAAG;AAE7F,cAAM,QAAQ,IAAI,iBAAiB,IAAI,qBAAmB,SAAS,GAAG,KAAK,UAAU,eAAe,CAAC,CAAC,CAAC;AAAA,MACxG;AAAA,IACD,SAAS,OAAO;AACf,wBAAkB,KAAK;AAAA,IACxB;AAAA,EACD;AACD;AAnCa,kBAAN;AAAA,EAGJ;AAAA,EACA;AAAA,GAJU;",
  "names": []
}
