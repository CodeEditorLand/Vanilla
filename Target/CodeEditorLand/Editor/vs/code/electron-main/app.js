var VI=Object.create;var Wu=Object.defineProperty;var Km=Object.getOwnPropertyDescriptor;var KI=Object.getOwnPropertyNames;var HI=Object.getPrototypeOf,zI=Object.prototype.hasOwnProperty;var qI=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var $I=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of KI(t))!zI.call(n,i)&&i!==e&&Wu(n,i,{get:()=>t[i],enumerable:!(r=Km(t,i))||r.enumerable});return n};var jI=(n,t,e)=>(e=n!=null?VI(HI(n)):{},$I(t||!n||!n.__esModule?Wu(e,"default",{value:n,enumerable:!0}):e,n));var P=(n,t,e,r)=>{for(var i=r>1?void 0:r?Km(t,e):t,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(t,e,i):s(i))||i);return r&&i&&Wu(t,e,i),i},h=(n,t)=>(e,r)=>t(e,r,n);var Ey=qI((sN,Sy)=>{"use strict";function bS(n,t){var e=n;t.slice(0,-1).forEach(function(i){e=e[i]||{}});var r=t[t.length-1];return r in e}function wy(n){return typeof n=="number"||/^0x[0-9a-f]+$/i.test(n)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(n)}function xy(n,t){return t==="constructor"&&typeof n[t]=="function"||t==="__proto__"}Sy.exports=function(n,t){t||(t={});var e={bools:{},strings:{},unknownFn:null};typeof t.unknown=="function"&&(e.unknownFn=t.unknown),typeof t.boolean=="boolean"&&t.boolean?e.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(_){e.bools[_]=!0});var r={};function i(_){return r[_].some(function(V){return e.bools[V]})}Object.keys(t.alias||{}).forEach(function(_){r[_]=[].concat(t.alias[_]),r[_].forEach(function(V){r[V]=[_].concat(r[_].filter(function(Y){return V!==Y}))})}),[].concat(t.string).filter(Boolean).forEach(function(_){e.strings[_]=!0,r[_]&&[].concat(r[_]).forEach(function(V){e.strings[V]=!0})});var o=t.default||{},s={_:[]};function a(_,V){return e.allBools&&/^--[^=]+$/.test(V)||e.strings[_]||e.bools[_]||r[_]}function l(_,V,Y){for(var q=_,ze=0;ze<V.length-1;ze++){var ee=V[ze];if(xy(q,ee))return;q[ee]===void 0&&(q[ee]={}),(q[ee]===Object.prototype||q[ee]===Number.prototype||q[ee]===String.prototype)&&(q[ee]={}),q[ee]===Array.prototype&&(q[ee]=[]),q=q[ee]}var Be=V[V.length-1];xy(q,Be)||((q===Object.prototype||q===Number.prototype||q===String.prototype)&&(q={}),q===Array.prototype&&(q=[]),q[Be]===void 0||e.bools[Be]||typeof q[Be]=="boolean"?q[Be]=Y:Array.isArray(q[Be])?q[Be].push(Y):q[Be]=[q[Be],Y])}function c(_,V,Y){if(!(Y&&e.unknownFn&&!a(_,Y)&&e.unknownFn(Y)===!1)){var q=!e.strings[_]&&wy(V)?Number(V):V;l(s,_.split("."),q),(r[_]||[]).forEach(function(ze){l(s,ze.split("."),q)})}}Object.keys(e.bools).forEach(function(_){c(_,o[_]===void 0?!1:o[_])});var d=[];n.indexOf("--")!==-1&&(d=n.slice(n.indexOf("--")+1),n=n.slice(0,n.indexOf("--")));for(var f=0;f<n.length;f++){var m=n[f],g,b;if(/^--.+=/.test(m)){var v=m.match(/^--([^=]+)=([\s\S]*)$/);g=v[1];var w=v[2];e.bools[g]&&(w=w!=="false"),c(g,w,m)}else if(/^--no-.+/.test(m))g=m.match(/^--no-(.+)/)[1],c(g,!1,m);else if(/^--.+/.test(m))g=m.match(/^--(.+)/)[1],b=n[f+1],b!==void 0&&!/^(-|--)[^-]/.test(b)&&!e.bools[g]&&!e.allBools&&(!r[g]||!i(g))?(c(g,b,m),f+=1):/^(true|false)$/.test(b)?(c(g,b==="true",m),f+=1):c(g,e.strings[g]?"":!0,m);else if(/^-[^-]+/.test(m)){for(var k=m.slice(1,-1).split(""),C=!1,M=0;M<k.length;M++){if(b=m.slice(M+2),b==="-"){c(k[M],b,m);continue}if(/[A-Za-z]/.test(k[M])&&b[0]==="="){c(k[M],b.slice(1),m),C=!0;break}if(/[A-Za-z]/.test(k[M])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(b)){c(k[M],b,m),C=!0;break}if(k[M+1]&&k[M+1].match(/\W/)){c(k[M],m.slice(M+2),m),C=!0;break}else c(k[M],e.strings[k[M]]?"":!0,m)}g=m.slice(-1)[0],!C&&g!=="-"&&(n[f+1]&&!/^(-|--)[^-]/.test(n[f+1])&&!e.bools[g]&&(!r[g]||!i(g))?(c(g,n[f+1],m),f+=1):n[f+1]&&/^(true|false)$/.test(n[f+1])?(c(g,n[f+1]==="true",m),f+=1):c(g,e.strings[g]?"":!0,m))}else if((!e.unknownFn||e.unknownFn(m)!==!1)&&s._.push(e.strings._||!wy(m)?m:Number(m)),t.stopEarly){s._.push.apply(s._,n.slice(f+1));break}}return Object.keys(o).forEach(function(_){bS(s,_.split("."))||(l(s,_.split("."),o[_]),(r[_]||[]).forEach(function(V){l(s,V.split("."),o[_])}))}),t["--"]?s["--"]=d.slice():d.forEach(function(_){s._.push(_)}),s}});import{app as io,BrowserWindow as lP,protocol as FI,session as Hs,systemPreferences as UI}from"electron";var Ln={exports:{}};(function(){function t(){function e(){return process.uncHostAllowlist}function r(c){let d=new Set;if(Array.isArray(c))for(let f of c)typeof f=="string"&&d.add(f);return Array.from(d)}function i(){let c=e();return c?Array.from(c):[]}function o(c){if(process.platform!=="win32")return;let d=e();if(d)if(typeof c=="string")d.add(c.toLowerCase());else for(let f of r(c))o(f)}function s(c){if(typeof c!="string")return;let d=["\\\\.\\UNC\\","\\\\?\\UNC\\","\\\\"],f;for(let m of d){if(c.indexOf(m)!==0)continue;let b=c.indexOf("\\",m.length);if(b===-1)continue;let v=c.substring(m.length,b);if(v){f=v;break}}return f}function a(){process.platform==="win32"&&(process.restrictUNCAccess=!1)}function l(){return process.platform!=="win32"?!0:process.restrictUNCAccess===!1}return{getUNCHostAllowlist:i,addUNCHostToAllowlist:o,getUNCHost:s,disableUNCAccessRestrictions:a,isUNCAccessRestrictionsDisabled:l}}typeof Ln=="object"&&typeof Ln.exports=="object"?Ln.exports=t():console.trace("vs/base/node/unc defined in UNKNOWN context (neither requirejs or commonjs)")})();var pP=Ln.exports.getUNCHost,Hm=Ln.exports.getUNCHostAllowlist,Tl=Ln.exports.addUNCHostToAllowlist,zm=Ln.exports.disableUNCAccessRestrictions,qm=Ln.exports.isUNCAccessRestrictionsDisabled;import ca from"electron";var Fu=class{unexpectedErrorHandler;listeners;constructor(){this.listeners=[],this.unexpectedErrorHandler=function(t){setTimeout(()=>{throw t.stack?On.isErrorNoTelemetry(t)?new On(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.listeners.push(t),()=>{this._removeListener(t)}}emit(t){this.listeners.forEach(e=>{e(t)})}_removeListener(t){this.listeners.splice(this.listeners.indexOf(t),1)}setUnexpectedErrorHandler(t){this.unexpectedErrorHandler=t}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(t){this.unexpectedErrorHandler(t),this.emit(t)}onUnexpectedExternalError(t){this.unexpectedErrorHandler(t)}},Uu=new Fu;function $m(n){Uu.setUnexpectedErrorHandler(n)}function jm(n){if(!n||typeof n!="object")return!1;let t=n;return t.code==="EPIPE"&&t.syscall?.toUpperCase()==="WRITE"}function ao(n){Uu.onUnexpectedError(n)}function nt(n){Nu(n)||Uu.onUnexpectedError(n)}var kl="Canceled";function Nu(n){return n instanceof rt?!0:n instanceof Error&&n.name===kl&&n.message===kl}var rt=class extends Error{constructor(){super(kl),this.name=this.message}};function Vr(){let n=new Error(kl);return n.name=n.message,n}function Gm(n){return n?new Error(`Illegal state: ${n}`):new Error("Illegal state")}function Kr(n){return n?n.message?n.message:n.stack?n.stack.split(`
`)[0]:String(n):"Error"}var On=class n extends Error{name;constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof n)return t;let e=new n;return e.message=t.message,e.stack=t.stack,e}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},so=class n extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,n.prototype)}};function Qm(n,t,e=0,r=n.length){let i=e,o=r;for(;i<o;){let s=Math.floor((i+o)/2);t(n[s])?o=s:i=s+1}return i}function Bu(n,t,e=(r,i)=>r===i){if(n===t)return!0;if(!n||!t||n.length!==t.length)return!1;for(let r=0,i=n.length;r<i;r++)if(!e(n[r],t[r]))return!1;return!0}function Xm(n,t,e){if(e===0)return[];let r=n.slice(0,e).sort(t);return GI(n,t,r,e,n.length),r}function GI(n,t,e,r,i){for(let o=e.length;r<i;r++){let s=n[r];if(t(s,e[o-1])<0){e.pop();let a=Qm(e,l=>t(s,l)<0);e.splice(a,0,s)}}}function pt(n){return n.filter(t=>!!t)}function Si(n,t=e=>e){let e=new Set;return n.filter(r=>{let i=t(r);return e.has(i)?!1:(e.add(i),!0)})}function Vu(n,t){return n.push(t),()=>JI(n,t)}function JI(n,t){let e=n.indexOf(t);if(e>-1)return n.splice(e,1),t}function Ku(n,t){let e;if(typeof t=="number"){let r=t;e=()=>{let i=Math.sin(r++)*179426549;return i-Math.floor(i)}}else e=Math.random;for(let r=n.length-1;r>0;r-=1){let i=Math.floor(e()*(r+1)),o=n[r];n[r]=n[i],n[i]=o}}function Zm(n){return n[Math.floor(Math.random()*n.length)]}var eh;(a=>{function n(l){return l<0}a.isLessThan=n;function t(l){return l<=0}a.isLessThanOrEqual=t;function e(l){return l>0}a.isGreaterThan=e;function r(l){return l===0}a.isNeitherLessOrGreaterThan=r,a.greaterThan=1,a.lessThan=-1,a.neitherLessOrGreaterThan=0})(eh||={});var Ym=class n{constructor(t){this.iterate=t}static empty=new n(t=>{});forEach(t){this.iterate(e=>(t(e),!0))}toArray(){let t=[];return this.iterate(e=>(t.push(e),!0)),t}filter(t){return new n(e=>this.iterate(r=>t(r)?e(r):!0))}map(t){return new n(e=>this.iterate(r=>e(t(r))))}some(t){let e=!1;return this.iterate(r=>(e=t(r),!e)),e}findFirst(t){let e;return this.iterate(r=>t(r)?(e=r,!1):!0),e}findLast(t){let e;return this.iterate(r=>(t(r)&&(e=r),!0)),e}findLastMaxBy(t){let e,r=!0;return this.iterate(i=>((r||eh.isGreaterThan(t(i,e)))&&(r=!1,e=i),!0)),e}};function ln(){return globalThis._VSCODE_NLS_MESSAGES}function Tr(){return globalThis._VSCODE_NLS_LANGUAGE}var QI=Tr()==="pseudo"||typeof document<"u"&&document.location&&document.location.hash.indexOf("pseudo=true")>=0;function Cl(n,t){let e;return t.length===0?e=n:e=n.replace(/\{(\d+)\}/g,(r,i)=>{let o=i[0],s=t[o],a=r;return typeof s=="string"?a=s:(typeof s=="number"||typeof s=="boolean"||s===void 0||s===null)&&(a=String(s)),a}),QI&&(e="\uFF3B"+e.replace(/[aouei]/g,"$&$&")+"\uFF3D"),e}function p(n,t,...e){return Cl(typeof n=="number"?rh(n,t):t,e)}function rh(n,t){let e=ln()?.[n];if(typeof e!="string"){if(typeof t=="string")return t;throw new Error(`!!! NLS MISSING: ${n} !!!`)}return e}function Hr(n,t,...e){let r;typeof n=="number"?r=rh(n,t):r=t;let i=Cl(r,e);return{value:i,original:t===r?i:Cl(t,e)}}var lo="en",Js=!1,Qs=!1,Gs=!1,ih=!1,oh=!1,Hu=!1,YI=!1,sh=!1,ah=!1,XI=!1,_l,Dl=lo,nh=lo,lh,cn,dn=globalThis,cr;typeof dn.vscode<"u"&&typeof dn.vscode.process<"u"?cr=dn.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(cr=process);var ch=typeof cr?.versions?.electron=="string",ZI=ch&&cr?.type==="renderer";if(typeof cr=="object"){Js=cr.platform==="win32",Qs=cr.platform==="darwin",Gs=cr.platform==="linux",ih=Gs&&!!cr.env.SNAP&&!!cr.env.SNAP_REVISION,YI=ch,ah=!!cr.env.CI||!!cr.env.BUILD_ARTIFACTSTAGINGDIRECTORY,_l=lo,Dl=lo;let n=cr.env.VSCODE_NLS_CONFIG;if(n)try{let t=JSON.parse(n);_l=t.userLocale,nh=t.osLocale,Dl=t.resolvedLanguage||lo,lh=t.languagePack?.translationsConfigFile}catch{}oh=!0}else typeof navigator=="object"&&!ZI?(cn=navigator.userAgent,Js=cn.indexOf("Windows")>=0,Qs=cn.indexOf("Macintosh")>=0,sh=(cn.indexOf("Macintosh")>=0||cn.indexOf("iPad")>=0||cn.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,Gs=cn.indexOf("Linux")>=0,XI=cn?.indexOf("Mobi")>=0,Hu=!0,Dl=Tr()||lo,_l=navigator.language.toLowerCase(),nh=_l):console.error("Unable to resolve platform.");function Ll(n){switch(n){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var Rl=0;Qs?Rl=1:Js?Rl=3:Gs&&(Rl=2);var N=Js,A=Qs,j=Gs,Ol=ih,Al=oh;var kr=Hu,e1=Hu&&typeof dn.importScripts=="function",dh=e1?dn.origin:void 0;var uh=ah,Ei=Rl,zr=cn,dr=Dl,t1;(r=>{function n(){return dr}r.value=n;function t(){return dr.length===2?dr==="en":dr.length>=3?dr[0]==="e"&&dr[1]==="n"&&dr[2]==="-":!1}r.isDefaultVariant=t;function e(){return dr==="en"}r.isDefault=e})(t1||={});var zu=lh,r1=typeof dn.postMessage=="function"&&!dn.importScripts,ph=(()=>{if(r1){let n=[];dn.addEventListener("message",e=>{if(e.data&&e.data.vscodeScheduleAsyncWork)for(let r=0,i=n.length;r<i;r++){let o=n[r];if(o.id===e.data.vscodeScheduleAsyncWork){n.splice(r,1),o.callback();return}}});let t=0;return e=>{let r=++t;n.push({id:r,callback:e}),dn.postMessage({vscodeScheduleAsyncWork:r},"*")}}return n=>setTimeout(n)})();var ur=Qs||sh?2:Js?1:3;var qu=!!(zr&&zr.indexOf("Chrome")>=0),fh=!!(zr&&zr.indexOf("Firefox")>=0),mh=!!(!qu&&zr&&zr.indexOf("Safari")>=0),hh=!!(zr&&zr.indexOf("Edg/")>=0),LP=!!(zr&&zr.indexOf("Android")>=0);function gh(n){return parseFloat(n)>=20}var Pi,$u=globalThis.vscode;if(typeof $u<"u"&&typeof $u.process<"u"){let n=$u.process;Pi={get platform(){return n.platform},get arch(){return n.arch},get env(){return n.env},cwd(){return n.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?Pi={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:Pi={get platform(){return N?"win32":A?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var pr=Pi.cwd,xt=Pi.env,Ys=Pi.platform,vh=Pi.arch;var n1=65,i1=97,o1=90,s1=122,Wn=46,St=47,Qt=92,An=58,a1=63,Ml=class extends Error{code;constructor(t,e,r){let i;typeof e=="string"&&e.indexOf("not ")===0?(i="must not be",e=e.replace(/^not /,"")):i="must be";let o=t.indexOf(".")!==-1?"property":"argument",s=`The "${t}" ${o} ${i} of type ${e}`;s+=`. Received type ${typeof r}`,super(s),this.code="ERR_INVALID_ARG_TYPE"}};function l1(n,t){if(n===null||typeof n!="object")throw new Ml(t,"Object",n)}function it(n,t){if(typeof n!="string")throw new Ml(t,"string",n)}var Yt=Ys==="win32";function he(n){return n===St||n===Qt}function Gu(n){return n===St}function Mn(n){return n>=n1&&n<=o1||n>=i1&&n<=s1}function Wl(n,t,e,r){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=n.length;++c){if(c<n.length)l=n.charCodeAt(c);else{if(r(l))break;l=St}if(r(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==Wn||i.charCodeAt(i.length-2)!==Wn){if(i.length>2){let d=i.lastIndexOf(e);d===-1?(i="",o=0):(i=i.slice(0,d),o=i.length-1-i.lastIndexOf(e)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}t&&(i+=i.length>0?`${e}..`:"..",o=2)}else i.length>0?i+=`${e}${n.slice(s+1,c)}`:i=n.slice(s+1,c),o=c-s-1;s=c,a=0}else l===Wn&&a!==-1?++a:a=-1}return i}function c1(n){return n?`${n[0]==="."?"":"."}${n}`:""}function yh(n,t){l1(t,"pathObject");let e=t.dir||t.root,r=t.base||`${t.name||""}${c1(t.ext)}`;return e?e===t.root?`${e}${r}`:`${e}${n}${r}`:r}var Ne={resolve(...n){let t="",e="",r=!1;for(let i=n.length-1;i>=-1;i--){let o;if(i>=0){if(o=n[i],it(o,`paths[${i}]`),o.length===0)continue}else t.length===0?o=pr():(o=xt[`=${t}`]||pr(),(o===void 0||o.slice(0,2).toLowerCase()!==t.toLowerCase()&&o.charCodeAt(2)===Qt)&&(o=`${t}\\`));let s=o.length,a=0,l="",c=!1,d=o.charCodeAt(0);if(s===1)he(d)&&(a=1,c=!0);else if(he(d))if(c=!0,he(o.charCodeAt(1))){let f=2,m=f;for(;f<s&&!he(o.charCodeAt(f));)f++;if(f<s&&f!==m){let g=o.slice(m,f);for(m=f;f<s&&he(o.charCodeAt(f));)f++;if(f<s&&f!==m){for(m=f;f<s&&!he(o.charCodeAt(f));)f++;(f===s||f!==m)&&(l=`\\\\${g}\\${o.slice(m,f)}`,a=f)}}}else a=1;else Mn(d)&&o.charCodeAt(1)===An&&(l=o.slice(0,2),a=2,s>2&&he(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(t.length>0){if(l.toLowerCase()!==t.toLowerCase())continue}else t=l;if(r){if(t.length>0)break}else if(e=`${o.slice(a)}\\${e}`,r=c,c&&t.length>0)break}return e=Wl(e,!r,"\\",he),r?`${t}\\${e}`:`${t}${e}`||"."},normalize(n){it(n,"path");let t=n.length;if(t===0)return".";let e=0,r,i=!1,o=n.charCodeAt(0);if(t===1)return Gu(o)?"\\":n;if(he(o))if(i=!0,he(n.charCodeAt(1))){let a=2,l=a;for(;a<t&&!he(n.charCodeAt(a));)a++;if(a<t&&a!==l){let c=n.slice(l,a);for(l=a;a<t&&he(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!he(n.charCodeAt(a));)a++;if(a===t)return`\\\\${c}\\${n.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${n.slice(l,a)}`,e=a)}}}else e=1;else Mn(o)&&n.charCodeAt(1)===An&&(r=n.slice(0,2),e=2,t>2&&he(n.charCodeAt(2))&&(i=!0,e=3));let s=e<t?Wl(n.slice(e),!i,"\\",he):"";return s.length===0&&!i&&(s="."),s.length>0&&he(n.charCodeAt(t-1))&&(s+="\\"),r===void 0?i?`\\${s}`:s:i?`${r}\\${s}`:`${r}${s}`},isAbsolute(n){it(n,"path");let t=n.length;if(t===0)return!1;let e=n.charCodeAt(0);return he(e)||t>2&&Mn(e)&&n.charCodeAt(1)===An&&he(n.charCodeAt(2))},join(...n){if(n.length===0)return".";let t,e;for(let o=0;o<n.length;++o){let s=n[o];it(s,"path"),s.length>0&&(t===void 0?t=e=s:t+=`\\${s}`)}if(t===void 0)return".";let r=!0,i=0;if(typeof e=="string"&&he(e.charCodeAt(0))){++i;let o=e.length;o>1&&he(e.charCodeAt(1))&&(++i,o>2&&(he(e.charCodeAt(2))?++i:r=!1))}if(r){for(;i<t.length&&he(t.charCodeAt(i));)i++;i>=2&&(t=`\\${t.slice(i)}`)}return Ne.normalize(t)},relative(n,t){if(it(n,"from"),it(t,"to"),n===t)return"";let e=Ne.resolve(n),r=Ne.resolve(t);if(e===r||(n=e.toLowerCase(),t=r.toLowerCase(),n===t))return"";let i=0;for(;i<n.length&&n.charCodeAt(i)===Qt;)i++;let o=n.length;for(;o-1>i&&n.charCodeAt(o-1)===Qt;)o--;let s=o-i,a=0;for(;a<t.length&&t.charCodeAt(a)===Qt;)a++;let l=t.length;for(;l-1>a&&t.charCodeAt(l-1)===Qt;)l--;let c=l-a,d=s<c?s:c,f=-1,m=0;for(;m<d;m++){let b=n.charCodeAt(i+m);if(b!==t.charCodeAt(a+m))break;b===Qt&&(f=m)}if(m!==d){if(f===-1)return r}else{if(c>d){if(t.charCodeAt(a+m)===Qt)return r.slice(a+m+1);if(m===2)return r.slice(a+m)}s>d&&(n.charCodeAt(i+m)===Qt?f=m:m===2&&(f=3)),f===-1&&(f=0)}let g="";for(m=i+f+1;m<=o;++m)(m===o||n.charCodeAt(m)===Qt)&&(g+=g.length===0?"..":"\\..");return a+=f,g.length>0?`${g}${r.slice(a,l)}`:(r.charCodeAt(a)===Qt&&++a,r.slice(a,l))},toNamespacedPath(n){if(typeof n!="string"||n.length===0)return n;let t=Ne.resolve(n);if(t.length<=2)return n;if(t.charCodeAt(0)===Qt){if(t.charCodeAt(1)===Qt){let e=t.charCodeAt(2);if(e!==a1&&e!==Wn)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(Mn(t.charCodeAt(0))&&t.charCodeAt(1)===An&&t.charCodeAt(2)===Qt)return`\\\\?\\${t}`;return n},dirname(n){it(n,"path");let t=n.length;if(t===0)return".";let e=-1,r=0,i=n.charCodeAt(0);if(t===1)return he(i)?n:".";if(he(i)){if(e=r=1,he(n.charCodeAt(1))){let a=2,l=a;for(;a<t&&!he(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&he(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!he(n.charCodeAt(a));)a++;if(a===t)return n;a!==l&&(e=r=a+1)}}}}else Mn(i)&&n.charCodeAt(1)===An&&(e=t>2&&he(n.charCodeAt(2))?3:2,r=e);let o=-1,s=!0;for(let a=t-1;a>=r;--a)if(he(n.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(e===-1)return".";o=e}return n.slice(0,o)},basename(n,t){t!==void 0&&it(t,"suffix"),it(n,"path");let e=0,r=-1,i=!0,o;if(n.length>=2&&Mn(n.charCodeAt(0))&&n.charCodeAt(1)===An&&(e=2),t!==void 0&&t.length>0&&t.length<=n.length){if(t===n)return"";let s=t.length-1,a=-1;for(o=n.length-1;o>=e;--o){let l=n.charCodeAt(o);if(he(l)){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return e===r?r=a:r===-1&&(r=n.length),n.slice(e,r)}for(o=n.length-1;o>=e;--o)if(he(n.charCodeAt(o))){if(!i){e=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(e,r)},extname(n){it(n,"path");let t=0,e=-1,r=0,i=-1,o=!0,s=0;n.length>=2&&n.charCodeAt(1)===An&&Mn(n.charCodeAt(0))&&(t=r=2);for(let a=n.length-1;a>=t;--a){let l=n.charCodeAt(a);if(he(l)){if(!o){r=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===Wn?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||i===-1||s===0||s===1&&e===i-1&&e===r+1?"":n.slice(e,i)},format:yh.bind(null,"\\"),parse(n){it(n,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return t;let e=n.length,r=0,i=n.charCodeAt(0);if(e===1)return he(i)?(t.root=t.dir=n,t):(t.base=t.name=n,t);if(he(i)){if(r=1,he(n.charCodeAt(1))){let f=2,m=f;for(;f<e&&!he(n.charCodeAt(f));)f++;if(f<e&&f!==m){for(m=f;f<e&&he(n.charCodeAt(f));)f++;if(f<e&&f!==m){for(m=f;f<e&&!he(n.charCodeAt(f));)f++;f===e?r=f:f!==m&&(r=f+1)}}}}else if(Mn(i)&&n.charCodeAt(1)===An){if(e<=2)return t.root=t.dir=n,t;if(r=2,he(n.charCodeAt(2))){if(e===3)return t.root=t.dir=n,t;r=3}}r>0&&(t.root=n.slice(0,r));let o=-1,s=r,a=-1,l=!0,c=n.length-1,d=0;for(;c>=r;--c){if(i=n.charCodeAt(c),he(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===Wn?o===-1?o=c:d!==1&&(d=1):o!==-1&&(d=-1)}return a!==-1&&(o===-1||d===0||d===1&&o===a-1&&o===s+1?t.base=t.name=n.slice(s,a):(t.name=n.slice(s,o),t.base=n.slice(s,a),t.ext=n.slice(o,a))),s>0&&s!==r?t.dir=n.slice(0,s-1):t.dir=t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},d1=(()=>{if(Yt){let n=/\\/g;return()=>{let t=pr().replace(n,"/");return t.slice(t.indexOf("/"))}}return()=>pr()})(),Q={resolve(...n){let t="",e=!1;for(let r=n.length-1;r>=-1&&!e;r--){let i=r>=0?n[r]:d1();it(i,`paths[${r}]`),i.length!==0&&(t=`${i}/${t}`,e=i.charCodeAt(0)===St)}return t=Wl(t,!e,"/",Gu),e?`/${t}`:t.length>0?t:"."},normalize(n){if(it(n,"path"),n.length===0)return".";let t=n.charCodeAt(0)===St,e=n.charCodeAt(n.length-1)===St;return n=Wl(n,!t,"/",Gu),n.length===0?t?"/":e?"./":".":(e&&(n+="/"),t?`/${n}`:n)},isAbsolute(n){return it(n,"path"),n.length>0&&n.charCodeAt(0)===St},join(...n){if(n.length===0)return".";let t;for(let e=0;e<n.length;++e){let r=n[e];it(r,"path"),r.length>0&&(t===void 0?t=r:t+=`/${r}`)}return t===void 0?".":Q.normalize(t)},relative(n,t){if(it(n,"from"),it(t,"to"),n===t||(n=Q.resolve(n),t=Q.resolve(t),n===t))return"";let e=1,r=n.length,i=r-e,o=1,s=t.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let f=n.charCodeAt(e+c);if(f!==t.charCodeAt(o+c))break;f===St&&(l=c)}if(c===a)if(s>a){if(t.charCodeAt(o+c)===St)return t.slice(o+c+1);if(c===0)return t.slice(o+c)}else i>a&&(n.charCodeAt(e+c)===St?l=c:c===0&&(l=0));let d="";for(c=e+l+1;c<=r;++c)(c===r||n.charCodeAt(c)===St)&&(d+=d.length===0?"..":"/..");return`${d}${t.slice(o+l)}`},toNamespacedPath(n){return n},dirname(n){if(it(n,"path"),n.length===0)return".";let t=n.charCodeAt(0)===St,e=-1,r=!0;for(let i=n.length-1;i>=1;--i)if(n.charCodeAt(i)===St){if(!r){e=i;break}}else r=!1;return e===-1?t?"/":".":t&&e===1?"//":n.slice(0,e)},basename(n,t){t!==void 0&&it(t,"ext"),it(n,"path");let e=0,r=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=n.length){if(t===n)return"";let s=t.length-1,a=-1;for(o=n.length-1;o>=0;--o){let l=n.charCodeAt(o);if(l===St){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return e===r?r=a:r===-1&&(r=n.length),n.slice(e,r)}for(o=n.length-1;o>=0;--o)if(n.charCodeAt(o)===St){if(!i){e=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(e,r)},extname(n){it(n,"path");let t=-1,e=0,r=-1,i=!0,o=0;for(let s=n.length-1;s>=0;--s){let a=n.charCodeAt(s);if(a===St){if(!i){e=s+1;break}continue}r===-1&&(i=!1,r=s+1),a===Wn?t===-1?t=s:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||r===-1||o===0||o===1&&t===r-1&&t===e+1?"":n.slice(t,r)},format:yh.bind(null,"/"),parse(n){it(n,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return t;let e=n.charCodeAt(0)===St,r;e?(t.root="/",r=1):r=0;let i=-1,o=0,s=-1,a=!0,l=n.length-1,c=0;for(;l>=r;--l){let d=n.charCodeAt(l);if(d===St){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),d===Wn?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let d=o===0&&e?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?t.base=t.name=n.slice(d,s):(t.name=n.slice(d,i),t.base=n.slice(d,s),t.ext=n.slice(i,s))}return o>0?t.dir=n.slice(0,o-1):e&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};Q.win32=Ne.win32=Ne;Q.posix=Ne.posix=Q;var ct=Yt?Ne.normalize:Q.normalize,fr=Yt?Ne.isAbsolute:Q.isAbsolute,F=Yt?Ne.join:Q.join,Fn=Yt?Ne.resolve:Q.resolve,bh=Yt?Ne.relative:Q.relative,Fe=Yt?Ne.dirname:Q.dirname,ve=Yt?Ne.basename:Q.basename,Fl=Yt?Ne.extname:Q.extname,MP=Yt?Ne.format:Q.format,WP=Yt?Ne.parse:Q.parse,FP=Yt?Ne.toNamespacedPath:Q.toNamespacedPath,ot=Yt?Ne.sep:Q.sep,uo=Yt?Ne.delimiter:Q.delimiter;var u1=/^\w[\w\d+.-]*$/,p1=/^\//,f1=/^\/\//;function m1(n,t){if(!n.scheme&&t)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${n.authority}", path: "${n.path}", query: "${n.query}", fragment: "${n.fragment}"}`);if(n.scheme&&!u1.test(n.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(n.path){if(n.authority){if(!p1.test(n.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(f1.test(n.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function h1(n,t){return!n&&!t?"file":n}function g1(n,t){switch(n){case"https":case"http":case"file":t?t[0]!==Cr&&(t=Cr+t):t=Cr;break}return t}var Ke="",Cr="/",v1=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,x=class n{static isUri(t){return t instanceof n?!0:t?typeof t.authority=="string"&&typeof t.fragment=="string"&&typeof t.path=="string"&&typeof t.query=="string"&&typeof t.scheme=="string"&&typeof t.fsPath=="string"&&typeof t.with=="function"&&typeof t.toString=="function":!1}scheme;authority;path;query;fragment;constructor(t,e,r,i,o,s=!1){typeof t=="object"?(this.scheme=t.scheme||Ke,this.authority=t.authority||Ke,this.path=t.path||Ke,this.query=t.query||Ke,this.fragment=t.fragment||Ke):(this.scheme=h1(t,s),this.authority=e||Ke,this.path=g1(this.scheme,r||Ke),this.query=i||Ke,this.fragment=o||Ke,m1(this,s))}get fsPath(){return Xs(this,!1)}with(t){if(!t)return this;let{scheme:e,authority:r,path:i,query:o,fragment:s}=t;return e===void 0?e=this.scheme:e===null&&(e=Ke),r===void 0?r=this.authority:r===null&&(r=Ke),i===void 0?i=this.path:i===null&&(i=Ke),o===void 0?o=this.query:o===null&&(o=Ke),s===void 0?s=this.fragment:s===null&&(s=Ke),e===this.scheme&&r===this.authority&&i===this.path&&o===this.query&&s===this.fragment?this:new Un(e,r,i,o,s)}static parse(t,e=!1){let r=v1.exec(t);return r?new Un(r[2]||Ke,Ul(r[4]||Ke),Ul(r[5]||Ke),Ul(r[7]||Ke),Ul(r[9]||Ke),e):new Un(Ke,Ke,Ke,Ke,Ke)}static file(t){let e=Ke;if(N&&(t=t.replace(/\\/g,Cr)),t[0]===Cr&&t[1]===Cr){let r=t.indexOf(Cr,2);r===-1?(e=t.substring(2),t=Cr):(e=t.substring(2,r),t=t.substring(r)||Cr)}return new Un("file",e,t,Ke,Ke)}static from(t,e){return new Un(t.scheme,t.authority,t.path,t.query,t.fragment,e)}static joinPath(t,...e){if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let r;return N&&t.scheme==="file"?r=n.file(Ne.join(Xs(t,!0),...e)).path:r=Q.join(t.path,...e),t.with({path:r})}toString(t=!1){return Ju(this,t)}toJSON(){return this}static revive(t){if(t){if(t instanceof n)return t;{let e=new Un(t);return e._formatted=t.external??null,e._fsPath=t._sep===Sh?t.fsPath??null:null,e}}else return t}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}};var Sh=N?1:void 0,Un=class extends x{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=Xs(this,!1)),this._fsPath}toString(t=!1){return t?Ju(this,!0):(this._formatted||(this._formatted=Ju(this,!1)),this._formatted)}toJSON(){let t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=Sh),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}},Eh={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function Ih(n,t,e){let r,i=-1;for(let o=0;o<n.length;o++){let s=n.charCodeAt(o);if(s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||s===45||s===46||s===95||s===126||t&&s===47||e&&s===91||e&&s===93||e&&s===58)i!==-1&&(r+=encodeURIComponent(n.substring(i,o)),i=-1),r!==void 0&&(r+=n.charAt(o));else{r===void 0&&(r=n.substr(0,o));let a=Eh[s];a!==void 0?(i!==-1&&(r+=encodeURIComponent(n.substring(i,o)),i=-1),r+=a):i===-1&&(i=o)}}return i!==-1&&(r+=encodeURIComponent(n.substring(i))),r!==void 0?r:n}function y1(n){let t;for(let e=0;e<n.length;e++){let r=n.charCodeAt(e);r===35||r===63?(t===void 0&&(t=n.substr(0,e)),t+=Eh[r]):t!==void 0&&(t+=n[e])}return t!==void 0?t:n}function Xs(n,t){let e;return n.authority&&n.path.length>1&&n.scheme==="file"?e=`//${n.authority}${n.path}`:n.path.charCodeAt(0)===47&&(n.path.charCodeAt(1)>=65&&n.path.charCodeAt(1)<=90||n.path.charCodeAt(1)>=97&&n.path.charCodeAt(1)<=122)&&n.path.charCodeAt(2)===58?t?e=n.path.substr(1):e=n.path[1].toLowerCase()+n.path.substr(2):e=n.path,N&&(e=e.replace(/\//g,"\\")),e}function Ju(n,t){let e=t?y1:Ih,r="",{scheme:i,authority:o,path:s,query:a,fragment:l}=n;if(i&&(r+=i,r+=":"),(o||i==="file")&&(r+=Cr,r+=Cr),o){let c=o.indexOf("@");if(c!==-1){let d=o.substr(0,c);o=o.substr(c+1),c=d.lastIndexOf(":"),c===-1?r+=e(d,!1,!1):(r+=e(d.substr(0,c),!1,!1),r+=":",r+=e(d.substr(c+1),!1,!0)),r+="@"}o=o.toLowerCase(),c=o.lastIndexOf(":"),c===-1?r+=e(o,!1,!0):(r+=e(o.substr(0,c),!1,!0),r+=o.substr(c))}if(s){if(s.length>=3&&s.charCodeAt(0)===47&&s.charCodeAt(2)===58){let c=s.charCodeAt(1);c>=65&&c<=90&&(s=`/${String.fromCharCode(c+32)}:${s.substr(3)}`)}else if(s.length>=2&&s.charCodeAt(1)===58){let c=s.charCodeAt(0);c>=65&&c<=90&&(s=`${String.fromCharCode(c+32)}:${s.substr(2)}`)}r+=e(s,!0,!1)}return a&&(r+="?",r+=e(a,!1,!1)),l&&(r+="#",r+=t?l:Ih(l,!1,!1)),r}function Ph(n){try{return decodeURIComponent(n)}catch{return n.length>3?n.substr(0,3)+Ph(n.substr(3)):n}}var wh=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Ul(n){return n.match(wh)?n.replace(wh,t=>Ph(t)):n}function Th(n){let t=[];return n.forEach((e,r)=>{t.push(`${r} => ${e}`)}),`Map(${n.size}) {${t.join(", ")}}`}function kh(n){let t=[];return n.forEach(e=>{t.push(e)}),`Set(${n.size}) {${t.join(", ")}}`}var Qu=class{constructor(t,e){this.uri=t;this.value=e}};function b1(n){return Array.isArray(n)}var Ot=class n{static defaultToKey=t=>t.toString();[Symbol.toStringTag]="ResourceMap";map;toKey;constructor(t,e){if(t instanceof n)this.map=new Map(t.map),this.toKey=e??n.defaultToKey;else if(b1(t)){this.map=new Map,this.toKey=e??n.defaultToKey;for(let[r,i]of t)this.set(r,i)}else this.map=new Map,this.toKey=t??n.defaultToKey}set(t,e){return this.map.set(this.toKey(t),new Qu(t,e)),this}get(t){return this.map.get(this.toKey(t))?.value}has(t){return this.map.has(this.toKey(t))}get size(){return this.map.size}clear(){this.map.clear()}delete(t){return this.map.delete(this.toKey(t))}forEach(t,e){typeof e<"u"&&(t=t.bind(e));for(let[r,i]of this.map)t(i.value,i.uri,this)}*values(){for(let t of this.map.values())yield t.value}*keys(){for(let t of this.map.values())yield t.uri}*entries(){for(let t of this.map.values())yield[t.uri,t.value]}*[Symbol.iterator](){for(let[,t]of this.map)yield[t.uri,t.value]}};var Yu=class{[Symbol.toStringTag]="LinkedMap";_map;_head;_tail;_size;_state;constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(t){return this._map.has(t)}get(t,e=0){let r=this._map.get(t);if(r)return e!==0&&this.touch(r,e),r.value}set(t,e,r=0){let i=this._map.get(t);if(i)i.value=e,r!==0&&this.touch(i,r);else{switch(i={key:t,value:e,next:void 0,previous:void 0},r){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(t,i),this._size++}return this}delete(t){return!!this.remove(t)}remove(t){let e=this._map.get(t);if(e)return this._map.delete(t),this.removeItem(e),this._size--,e.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,e){let r=this._state,i=this._head;for(;i;){if(e?t.bind(e)(i.value,i.key,this):t(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.key,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}values(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.value,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}entries(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:[r.key,r.value],done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}[Symbol.iterator](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._head,r=this.size;for(;e&&r>t;)this._map.delete(e.key),e=e.next,r--;this._head=e,this._size=r,e&&(e.previous=void 0),this._state++}trimNew(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._tail,r=this.size;for(;e&&r>t;)this._map.delete(e.key),e=e.previous,r--;this._tail=e,this._size=r,e&&(e.next=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{let e=t.next,r=t.previous;if(!e||!r)throw new Error("Invalid list");e.previous=r,r.next=e}t.next=void 0,t.previous=void 0,this._state++}touch(t,e){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(e!==1&&e!==2)){if(e===1){if(t===this._head)return;let r=t.next,i=t.previous;t===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(e===2){if(t===this._tail)return;let r=t.next,i=t.previous;t===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){let t=[];return this.forEach((e,r)=>{t.push([r,e])}),t}fromJSON(t){this.clear();for(let[e,r]of t)this.set(e,r)}},Xu=class extends Yu{_limit;_ratio;constructor(t,e=1){super(),this._limit=t,this._ratio=Math.min(Math.max(0,e),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,e=2){return super.get(t,e)}peek(t){return super.get(t,0)}set(t,e){return super.set(t,e,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},un=class extends Xu{constructor(t,e=1){super(t,e)}trim(t){this.trimOld(t)}set(t,e){return super.set(t,e),this.checkTrim(),this}};function po(n,t){let e=this,r=!1,i;return function(){if(r)return i;if(r=!0,t)try{i=n.apply(e,arguments)}finally{t()}else i=n.apply(e,arguments);return i}}var fo;(M=>{function n(_){return _&&typeof _=="object"&&typeof _[Symbol.iterator]=="function"}M.is=n;let t=Object.freeze([]);function e(){return t}M.empty=e;function*r(_){yield _}M.single=r;function i(_){return n(_)?_:r(_)}M.wrap=i;function o(_){return _||t}M.from=o;function*s(_){for(let V=_.length-1;V>=0;V--)yield _[V]}M.reverse=s;function a(_){return!_||_[Symbol.iterator]().next().done===!0}M.isEmpty=a;function l(_){return _[Symbol.iterator]().next().value}M.first=l;function c(_,V){let Y=0;for(let q of _)if(V(q,Y++))return!0;return!1}M.some=c;function d(_,V){for(let Y of _)if(V(Y))return Y}M.find=d;function*f(_,V){for(let Y of _)V(Y)&&(yield Y)}M.filter=f;function*m(_,V){let Y=0;for(let q of _)yield V(q,Y++)}M.map=m;function*g(_,V){let Y=0;for(let q of _)yield*V(q,Y++)}M.flatMap=g;function*b(..._){for(let V of _)yield*V}M.concat=b;function v(_,V,Y){let q=Y;for(let ze of _)q=V(q,ze);return q}M.reduce=v;function*w(_,V,Y=_.length){for(V<0&&(V+=_.length),Y<0?Y+=_.length:Y>_.length&&(Y=_.length);V<Y;V++)yield _[V]}M.slice=w;function k(_,V=Number.POSITIVE_INFINITY){let Y=[];if(V===0)return[Y,_];let q=_[Symbol.iterator]();for(let ze=0;ze<V;ze++){let ee=q.next();if(ee.done)return[Y,M.empty()];Y.push(ee.value)}return[Y,{[Symbol.iterator](){return q}}]}M.consume=k;async function C(_){let V=[];for await(let Y of _)V.push(Y);return Promise.resolve(V)}M.asyncToArray=C})(fo||={});var I1=!1,mo=null;function w1(n){mo=n}if(I1){let n="__is_disposable_tracked__";w1(new class{trackDisposable(t){let e=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[n]||console.log(e)},3e3)}setParent(t,e){if(t&&t!==O.None)try{t[n]=!0}catch{}}markAsDisposed(t){if(t&&t!==O.None)try{t[n]=!0}catch{}}markAsSingleton(t){}})}function Ti(n){return mo?.trackDisposable(n),n}function ki(n){mo?.markAsDisposed(n)}function Zs(n,t){mo?.setParent(n,t)}function x1(n,t){if(mo)for(let e of n)mo.setParent(e,t)}function Ch(n){return typeof n=="object"&&n!==null&&typeof n.dispose=="function"&&n.dispose.length===0}function ft(n){if(fo.is(n)){let t=[];for(let e of n)if(e)try{e.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}function Nl(...n){let t=Z(()=>ft(n));return x1(n,t),t}function Z(n){let t=Ti({dispose:po(()=>{ki(t),n()})});return t}var re=class n{static DISABLE_DISPOSED_WARNING=!1;_toDispose=new Set;_isDisposed=!1;constructor(){Ti(this)}dispose(){this._isDisposed||(ki(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{ft(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return Zs(t,this),this._isDisposed?n.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),Zs(t,null))}},O=class{static None=Object.freeze({dispose(){}});_store=new re;constructor(){Ti(this),Zs(this._store,this)}dispose(){ki(this),this._store.dispose()}_register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(t)}},Dr=class{_value;_isDisposed=!1;constructor(){Ti(this)}get value(){return this._isDisposed?void 0:this._value}set value(t){this._isDisposed||t===this._value||(this._value?.dispose(),t&&Zs(t,this),this._value=t)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,ki(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let t=this._value;return this._value=void 0,t&&Zs(t,null),t}};var pn=class{_store=new Map;_isDisposed=!1;constructor(){Ti(this)}dispose(){ki(this),this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{ft(this._store.values())}finally{this._store.clear()}}has(t){return this._store.has(t)}get size(){return this._store.size}get(t){return this._store.get(t)}set(t,e,r=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),r||this._store.get(t)?.dispose(),this._store.set(t,e)}deleteAndDispose(t){this._store.get(t)?.dispose(),this._store.delete(t)}deleteAndLeak(t){let e=this._store.get(t);return this._store.delete(t),e}keys(){return this._store.keys()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var _h=Object.freeze(function(n,t){let e=setTimeout(n.bind(t),0);return{dispose(){clearTimeout(e)}}}),Ee;(r=>{function n(i){return i===r.None||i===r.Cancelled||i instanceof ho?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}r.isCancellationToken=n,r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:E.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:_h})})(Ee||={});var ho=class{_isCancelled=!1;_emitter=null;cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?_h:(this._emitter||(this._emitter=new S),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},mt=class{_token=void 0;_parentListener=void 0;constructor(t){this._parentListener=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new ho),this._token}cancel(){this._token?this._token instanceof ho&&this._token.cancel():this._token=Ee.Cancelled}dispose(t=!1){t&&this.cancel(),this._parentListener?.dispose(),this._token?this._token instanceof ho&&this._token.dispose():this._token=Ee.None}};var qe=class n{static Undefined=new n(void 0);element;next;prev;constructor(t){this.element=t,this.next=n.Undefined,this.prev=n.Undefined}},go=class{_first=qe.Undefined;_last=qe.Undefined;_size=0;get size(){return this._size}isEmpty(){return this._first===qe.Undefined}clear(){let t=this._first;for(;t!==qe.Undefined;){let e=t.next;t.prev=qe.Undefined,t.next=qe.Undefined,t=e}this._first=qe.Undefined,this._last=qe.Undefined,this._size=0}unshift(t){return this._insert(t,!1)}push(t){return this._insert(t,!0)}_insert(t,e){let r=new qe(t);if(this._first===qe.Undefined)this._first=r,this._last=r;else if(e){let o=this._last;this._last=r,r.prev=o,o.next=r}else{let o=this._first;this._first=r,r.next=o,o.prev=r}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(r))}}shift(){if(this._first!==qe.Undefined){let t=this._first.element;return this._remove(this._first),t}}pop(){if(this._last!==qe.Undefined){let t=this._last.element;return this._remove(this._last),t}}_remove(t){if(t.prev!==qe.Undefined&&t.next!==qe.Undefined){let e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===qe.Undefined&&t.next===qe.Undefined?(this._first=qe.Undefined,this._last=qe.Undefined):t.next===qe.Undefined?(this._last=this._last.prev,this._last.next=qe.Undefined):t.prev===qe.Undefined&&(this._first=this._first.next,this._first.prev=qe.Undefined);this._size-=1}*[Symbol.iterator](){let t=this._first;for(;t!==qe.Undefined;)yield t.element,t=t.next}};var Ci=(n,t)=>n===t;var Rr=class{constructor(t,e,r){this.owner=t;this.debugNameSource=e;this.referenceFn=r}getDebugName(t){return Oh(t,this)}},Dh=new Map,Zu=new WeakMap;function Oh(n,t){let e=Zu.get(n);if(e)return e;let r=S1(n,t);if(r){let i=Dh.get(r)??0;i++,Dh.set(r,i);let o=i===1?r:`${r}#${i}`;return Zu.set(n,o),o}}function S1(n,t){let e=Zu.get(n);if(e)return e;let r=t.owner?P1(t.owner)+".":"",i,o=t.debugNameSource;if(o!==void 0)if(typeof o=="function"){if(i=o(),i!==void 0)return r+i}else return r+o;let s=t.referenceFn;if(s!==void 0&&(i=Bl(s),i!==void 0))return r+i;if(t.owner!==void 0){let a=E1(t.owner,n);if(a!==void 0)return r+a}}function E1(n,t){for(let e in n)if(n[e]===t)return e}var Rh=new Map,Lh=new WeakMap;function P1(n){let t=Lh.get(n);if(t)return t;let e=T1(n),r=Rh.get(e)??0;r++,Rh.set(e,r);let i=r===1?e:`${e}#${r}`;return Lh.set(n,i),i}function T1(n){let t=n.constructor;return t?t.name:"Object"}function Bl(n){let t=n.toString(),r=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(t);return(r?r[1]:void 0)?.trim()}function Vl(n,t){if(!n)throw new Error(t?`Assertion failed (${t})`:"Assertion Failed")}function Ah(n,t="Unreachable"){throw new Error(t)}function Kl(n){if(!n()){debugger;n(),nt(new so("Assertion Failed"))}}function ea(n){return new Hl(new Rr(void 0,void 0,n),n,void 0,void 0)}var Hl=class{constructor(t,e,r,i){this._debugNameData=t;this._runFn=e;this.createChangeSummary=r;this._handleChange=i;this.changeSummary=this.createChangeSummary?.(),mr()?.handleAutorunCreated(this),this._runIfNeeded(),Ti(this)}state=2;updateCount=0;disposed=!1;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}dispose(){this.disposed=!0;for(let t of this.dependencies)t.removeObserver(this);this.dependencies.clear(),ki(this)}_runIfNeeded(){if(this.state===3)return;let t=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=t,this.state=3;let e=this.disposed;try{if(!e){mr()?.handleAutorunTriggered(this);let r=this.changeSummary;try{this.changeSummary=this.createChangeSummary?.(),this._runFn(this,r)}catch(i){ao(i)}}}finally{e||mr()?.handleAutorunFinished(this);for(let r of this.dependenciesToBeRemoved)r.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){try{if(this.updateCount===1)do{if(this.state===1){this.state=3;for(let t of this.dependencies)if(t.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3)}finally{this.updateCount--}Kl(()=>this.updateCount>=0)}handlePossibleChange(t){this.state===3&&this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t)&&(this.state=1)}handleChange(t,e){if(this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t))try{(this._handleChange?this._handleChange({changedObservable:t,change:e,didChange:i=>i===t},this.changeSummary):!0)&&(this.state=2)}catch(r){ao(r)}}readObservable(t){if(this.disposed)return t.get();t.addObserver(this);let e=t.get();return this.dependencies.add(t),this.dependenciesToBeRemoved.delete(t),e}};(t=>t.Observer=Hl)(ea||={});function ep(n,t){return new zl(new Rr(n.owner,n.debugName,n.debugReferenceFn),t,void 0,void 0,n.onLastObserverRemoved,n.equalsFn??Ci)}Mh(ep);var zl=class extends _i{constructor(e,r,i,o,s=void 0,a){super();this._debugNameData=e;this._computeFn=r;this.createChangeSummary=i;this._handleChange=o;this._handleLastObserverRemoved=s;this._equalityComparator=a;this.changeSummary=this.createChangeSummary?.(),mr()?.handleDerivedCreated(this)}state=0;value=void 0;updateCount=0;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary=void 0;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}onLastObserverRemoved(){this.state=0,this.value=void 0;for(let e of this.dependencies)e.removeObserver(this);this.dependencies.clear(),this._handleLastObserverRemoved?.()}get(){if(this.observers.size===0){let e=this._computeFn(this,this.createChangeSummary?.());return this.onLastObserverRemoved(),e}else{do{if(this.state===1){for(let e of this.dependencies)if(e.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){if(this.state===3)return;let e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e;let r=this.state!==0,i=this.value;this.state=3;let o=!1;try{let s=this.changeSummary;this.changeSummary=this.createChangeSummary?.();try{this.value=this._computeFn(this,s)}finally{for(let a of this.dependenciesToBeRemoved)a.removeObserver(this);this.dependenciesToBeRemoved.clear()}o=r&&!this._equalityComparator(i,this.value),mr()?.handleDerivedRecomputed(this,{oldValue:i,newValue:this.value,change:void 0,didChange:o,hadValue:r})}catch(s){ao(s)}if(o)for(let s of this.observers)s.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){this.updateCount++;let r=this.updateCount===1;if(this.state===3&&(this.state=1,!r))for(let i of this.observers)i.handlePossibleChange(this);if(r)for(let i of this.observers)i.beginUpdate(this)}endUpdate(e){if(this.updateCount--,this.updateCount===0){let r=[...this.observers];for(let i of r)i.endUpdate(this)}Kl(()=>this.updateCount>=0)}handlePossibleChange(e){if(this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){this.state=1;for(let r of this.observers)r.handlePossibleChange(this)}}handleChange(e,r){if(this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){let i=!1;try{i=this._handleChange?this._handleChange({changedObservable:e,change:r,didChange:s=>s===e},this.changeSummary):!0}catch(s){ao(s)}let o=this.state===3;if(i&&(this.state===1||o)&&(this.state=2,o))for(let s of this.observers)s.handlePossibleChange(this)}}readObservable(e){e.addObserver(this);let r=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),r}addObserver(e){let r=!this.observers.has(e)&&this.updateCount>0;super.addObserver(e),r&&e.beginUpdate(this)}removeObserver(e){let r=this.observers.has(e)&&this.updateCount>0;super.removeObserver(e),r&&e.endUpdate(this)}};function tp(...n){let t,e,r;return n.length===3?[t,e,r]=n:[e,r]=n,new Nn(new Rr(t,void 0,r),e,r,()=>Nn.globalTransaction,Ci)}var Nn=class extends _i{constructor(e,r,i,o,s){super();this._debugNameData=e;this.event=r;this._getValue=i;this._getTransaction=o;this._equalityComparator=s}static globalTransaction;value;hasValue=!1;subscription;getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){let e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}handleEvent=e=>{let r=this._getValue(e),i=this.value,o=!this.hasValue||!this._equalityComparator(i,r),s=!1;o&&(this.value=r,this.hasValue&&(s=!0,rp(this._getTransaction(),a=>{mr()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:r,change:void 0,didChange:o,hadValue:this.hasValue});for(let l of this.observers)a.updateObserver(l,this),l.handleChange(this,void 0)},()=>{let a=this.getDebugName();return"Event fired"+(a?`: ${a}`:"")})),this.hasValue=!0),s||mr()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:r,change:void 0,didChange:o,hadValue:this.hasValue})};onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}};(e=>{e.Observer=Nn;function t(r,i){let o=!1;Nn.globalTransaction===void 0&&(Nn.globalTransaction=r,o=!0);try{i()}finally{o&&(Nn.globalTransaction=void 0)}}e.batchEventsGlobally=t})(tp||={});function Fh(n){let t=new ql(!1,void 0);return n.addObserver(t),Z(()=>{n.removeObserver(t)})}Bh(Fh);function Uh(n,t){let e=new ql(!0,t);return n.addObserver(e),t?t(n.get()):n.reportChanges(),Z(()=>{n.removeObserver(e)})}Nh(Uh);var ql=class{constructor(t,e){this._forceRecompute=t;this._handleValue=e}_counter=0;beginUpdate(t){this._counter++}endUpdate(t){this._counter--,this._counter===0&&this._forceRecompute&&(this._handleValue?this._handleValue(t.get()):t.reportChanges())}handlePossibleChange(t){}handleChange(t,e){}};var Kh;function Hh(n){Kh=n}function mr(){return Kh}var Gl=class{indentation=0;textToConsoleArgs(t){return D1([vo(O1("|  ",this.indentation)),t])}formatInfo(t){return t.hadValue?t.didChange?[vo(" "),Lr(ra(t.oldValue,70),{color:"red",strikeThrough:!0}),vo(" "),Lr(ra(t.newValue,60),{color:"green"})]:[vo(" (unchanged)")]:[vo(" "),Lr(ra(t.newValue,60),{color:"green"}),vo(" (initial)")]}handleObservableChanged(t,e){console.log(...this.textToConsoleArgs([ta("observable value changed"),Lr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e)]))}changedObservablesSets=new WeakMap;formatChanges(t){if(t.size!==0)return Lr(" (changed deps: "+[...t].map(e=>e.debugName).join(", ")+")",{color:"gray"})}handleDerivedCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(r,i)=>(this.changedObservablesSets.get(t).add(r),e.apply(t,[r,i]))}handleDerivedRecomputed(t,e){let r=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([ta("derived recomputed"),Lr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),this.formatChanges(r),{data:[{fn:t._debugNameData.referenceFn??t._computeFn}]}])),r.clear()}handleFromEventObservableTriggered(t,e){console.log(...this.textToConsoleArgs([ta("observable from event triggered"),Lr(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),{data:[{fn:t._getValue}]}]))}handleAutorunCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(r,i)=>(this.changedObservablesSets.get(t).add(r),e.apply(t,[r,i]))}handleAutorunTriggered(t){let e=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([ta("autorun"),Lr(t.debugName,{color:"BlueViolet"}),this.formatChanges(e),{data:[{fn:t._debugNameData.referenceFn??t._runFn}]}])),e.clear(),this.indentation++}handleAutorunFinished(t){this.indentation--}handleBeginTransaction(t){let e=t.getDebugName();e===void 0&&(e=""),console.log(...this.textToConsoleArgs([ta("transaction"),Lr(e,{color:"BlueViolet"}),{data:[{fn:t._fn}]}])),this.indentation++}handleEndTransaction(){this.indentation--}};function D1(n){let t=new Array,e=[],r="";function i(s){if("length"in s)for(let a of s)a&&i(a);else"text"in s?(r+=`%c${s.text}`,t.push(s.style),s.data&&e.push(...s.data)):"data"in s&&e.push(...s.data)}i(n);let o=[r,...t];return o.push(...e),o}function vo(n){return Lr(n,{color:"black"})}function ta(n){return Lr(A1(`${n}: `,10),{color:"black",bold:!0})}function Lr(n,t={color:"black"}){function e(i){return Object.entries(i).reduce((o,[s,a])=>`${o}${s}:${a};`,"")}let r={color:t.color};return t.strikeThrough&&(r["text-decoration"]="line-through"),t.bold&&(r["font-weight"]="bold"),{text:n,style:e(r)}}function ra(n,t){switch(typeof n){case"number":return""+n;case"string":return n.length+2<=t?`"${n}"`:`"${n.substr(0,t-7)}"+...`;case"boolean":return n?"true":"false";case"undefined":return"undefined";case"object":return n===null?"null":Array.isArray(n)?R1(n,t):L1(n,t);case"symbol":return n.toString();case"function":return`[[Function${n.name?" "+n.name:""}]]`;default:return""+n}}function R1(n,t){let e="[ ",r=!0;for(let i of n){if(r||(e+=", "),e.length-5>t){e+="...";break}r=!1,e+=`${ra(i,t-e.length)}`}return e+=" ]",e}function L1(n,t){let e="{ ",r=!0;for(let[i,o]of Object.entries(n)){if(r||(e+=", "),e.length-5>t){e+="...";break}r=!1,e+=`${i}: ${ra(o,t-e.length)}`}return e+=" }",e}function O1(n,t){let e="";for(let r=1;r<=t;r++)e+=n;return e}function A1(n,t){for(;n.length<t;)n+=" ";return n}var zh;function Nh(n){zh=n}var qh;function Bh(n){qh=n}var np;function Mh(n){np=n}var $l=class{get TChange(){return null}reportChanges(){this.get()}read(t){return t?t.readObservable(this):this.get()}map(t,e){let r=e===void 0?void 0:t,i=e===void 0?t:e;return np({owner:r,debugName:()=>{let o=Bl(i);if(o!==void 0)return o;let a=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(i.toString());if(a)return`${this.debugName}.${a[2]}`;if(!r)return`${this.debugName} (mapped)`},debugReferenceFn:i},o=>i(this.read(o),o))}flatten(){return np({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},t=>this.read(t).read(t))}recomputeInitiallyAndOnChange(t,e){return t.add(zh(this,e)),this}keepObserved(t){return t.add(qh(this)),this}get debugValue(){return this.get()}},_i=class extends $l{observers=new Set;addObserver(t){let e=this.observers.size;this.observers.add(t),e===0&&this.onFirstObserverAdded()}removeObserver(t){this.observers.delete(t)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}};function jl(n,t){let e=new Jl(n,t);try{n(e)}finally{e.finish()}}function rp(n,t,e){n?t(n):jl(t,e)}var Jl=class{constructor(t,e){this._fn=t;this._getDebugName=e;mr()?.handleBeginTransaction(this)}updatingObservers=[];getDebugName(){return this._getDebugName?this._getDebugName():Bl(this._fn)}updateObserver(t,e){this.updatingObservers.push({observer:t,observable:e}),t.beginUpdate(e)}finish(){let t=this.updatingObservers;for(let e=0;e<t.length;e++){let{observer:r,observable:i}=t[e];r.endUpdate(i)}this.updatingObservers=null,mr()?.handleEndTransaction()}};var M1=!1;M1&&Hh(new Gl);var W1=globalThis.performance&&typeof globalThis.performance.now=="function",$r=class n{_startTime;_stopTime;_now;static create(t){return new n(t)}constructor(t){this._now=W1&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}};var $h=Symbol("MicrotaskDelay");var F1=!1,jh=!1,U1=!1,E;(br=>{br.None=()=>O.None;function t(H){if(U1){let{onDidAddListener:W}=H,z=na.create(),K=0;H.onDidAddListener=()=>{++K===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),z.print()),W?.()}}}function e(H,W){return g(H,()=>{},0,void 0,!0,void 0,W)}br.defer=e;function r(H){return(W,z=null,K)=>{let X=!1,pe;return pe=H(Se=>{if(!X)return pe?pe.dispose():X=!0,W.call(z,Se)},null,K),X&&pe.dispose(),pe}}br.once=r;function i(H,W){return br.once(br.filter(H,W))}br.onceIf=i;function o(H,W,z){return f((K,X=null,pe)=>H(Se=>K.call(X,W(Se)),null,pe),z)}br.map=o;function s(H,W,z){return f((K,X=null,pe)=>H(Se=>{W(Se),K.call(X,Se)},null,pe),z)}br.forEach=s;function a(H,W,z){return f((K,X=null,pe)=>H(Se=>W(Se)&&K.call(X,Se),null,pe),z)}br.filter=a;function l(H){return H}br.signal=l;function c(...H){return(W,z=null,K)=>{let X=Nl(...H.map(pe=>pe(Se=>W.call(z,Se))));return m(X,K)}}br.any=c;function d(H,W,z,K){let X=z;return o(H,pe=>(X=W(X,pe),X),K)}br.reduce=d;function f(H,W){let z,K={onWillAddFirstListener(){z=H(X.fire,X)},onDidRemoveLastListener(){z?.dispose()}};W||t(K);let X=new S(K);return W?.add(X),X.event}function m(H,W){return W instanceof Array?W.push(H):W&&W.add(H),H}function g(H,W,z=100,K=!1,X=!1,pe,Se){let Ge,ut,oe,Dn=0,sn,Rn={leakWarningThreshold:pe,onWillAddFirstListener(){Ge=H(Il=>{Dn++,ut=W(ut,Il),K&&!oe&&(Ii.fire(ut),ut=void 0),sn=()=>{let wl=ut;ut=void 0,oe=void 0,(!K||Dn>1)&&Ii.fire(wl),Dn=0},typeof z=="number"?(clearTimeout(oe),oe=setTimeout(sn,z)):oe===void 0&&(oe=0,queueMicrotask(sn))})},onWillRemoveListener(){X&&Dn>0&&sn?.()},onDidRemoveLastListener(){sn=void 0,Ge.dispose()}};Se||t(Rn);let Ii=new S(Rn);return Se?.add(Ii),Ii.event}br.debounce=g;function b(H,W=0,z){return br.debounce(H,(K,X)=>K?(K.push(X),K):[X],W,void 0,!0,void 0,z)}br.accumulate=b;function v(H,W=(K,X)=>K===X,z){let K=!0,X;return a(H,pe=>{let Se=K||!W(pe,X);return K=!1,X=pe,Se},z)}br.latch=v;function w(H,W,z){return[br.filter(H,W,z),br.filter(H,K=>!W(K),z)]}br.split=w;function k(H,W=!1,z=[],K){let X=z.slice(),pe=H(ut=>{X?X.push(ut):Ge.fire(ut)});K&&K.add(pe);let Se=()=>{X?.forEach(ut=>Ge.fire(ut)),X=null},Ge=new S({onWillAddFirstListener(){pe||(pe=H(ut=>Ge.fire(ut)),K&&K.add(pe))},onDidAddFirstListener(){X&&(W?setTimeout(Se):Se())},onDidRemoveLastListener(){pe&&pe.dispose(),pe=null}});return K&&K.add(Ge),Ge.event}br.buffer=k;function C(H,W){return(K,X,pe)=>{let Se=W(new _);return H(function(Ge){let ut=Se.evaluate(Ge);ut!==M&&K.call(X,ut)},void 0,pe)}}br.chain=C;let M=Symbol("HaltChainable");class _{steps=[];map(W){return this.steps.push(W),this}forEach(W){return this.steps.push(z=>(W(z),z)),this}filter(W){return this.steps.push(z=>W(z)?z:M),this}reduce(W,z){let K=z;return this.steps.push(X=>(K=W(K,X),K)),this}latch(W=(z,K)=>z===K){let z=!0,K;return this.steps.push(X=>{let pe=z||!W(X,K);return z=!1,K=X,pe?X:M}),this}evaluate(W){for(let z of this.steps)if(W=z(W),W===M)break;return W}}function V(H,W,z=K=>K){let K=(...Ge)=>Se.fire(z(...Ge)),X=()=>H.on(W,K),pe=()=>H.removeListener(W,K),Se=new S({onWillAddFirstListener:X,onDidRemoveLastListener:pe});return Se.event}br.fromNodeEventEmitter=V;function Y(H,W,z=K=>K){let K=(...Ge)=>Se.fire(z(...Ge)),X=()=>H.addEventListener(W,K),pe=()=>H.removeEventListener(W,K),Se=new S({onWillAddFirstListener:X,onDidRemoveLastListener:pe});return Se.event}br.fromDOMEventEmitter=Y;function q(H){return new Promise(W=>r(H)(W))}br.toPromise=q;function ze(H){let W=new S;return H.then(z=>{W.fire(z)},()=>{W.fire(void 0)}).finally(()=>{W.dispose()}),W.event}br.fromPromise=ze;function ee(H,W){return H(z=>W.fire(z))}br.forward=ee;function Be(H,W,z){return W(z),H(K=>W(K))}br.runAndSubscribe=Be;class yr{constructor(W,z){this._observable=W;let K={onWillAddFirstListener:()=>{W.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{W.removeObserver(this)}};z||t(K),this.emitter=new S(K),z&&z.add(this.emitter)}emitter;_counter=0;_hasChanged=!1;beginUpdate(W){this._counter++}handlePossibleChange(W){}handleChange(W,z){this._hasChanged=!0}endUpdate(W){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function Dt(H,W){return new yr(H,W).emitter.event}br.fromObservable=Dt;function Nr(H){return(W,z,K)=>{let X=0,pe=!1,Se={beginUpdate(){X++},endUpdate(){X--,X===0&&(H.reportChanges(),pe&&(pe=!1,W.call(z)))},handlePossibleChange(){},handleChange(){pe=!0}};H.addObserver(Se),H.reportChanges();let Ge={dispose(){H.removeObserver(Se)}};return K instanceof re?K.add(Ge):Array.isArray(K)&&K.push(Ge),Ge}}br.fromObservableLight=Nr})(E||={});var ip=class n{static all=new Set;static _idPool=0;name;listenerCount=0;invocationCount=0;elapsedOverall=0;durations=[];_stopWatch;constructor(t){this.name=`${t}_${n._idPool++}`,n.all.add(this)}start(t){this._stopWatch=new $r,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}},Gh=-1;var op=class n{constructor(t,e,r=(n._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t;this.threshold=e;this.name=r}static _idPool=1;_stacks;_warnCountdown=0;dispose(){this._stacks?.clear()}check(t,e){let r=this.threshold;if(r<=0||e<r)return;this._stacks||(this._stacks=new Map);let i=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,i+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[o,s]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${e} listeners already. MOST frequent listener (${s}):`;console.warn(a),console.warn(o);let l=new sp(a,o);this._errorHandler(l)}return()=>{let o=this._stacks.get(t.value)||0;this._stacks.set(t.value,o-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,e=0;for(let[r,i]of this._stacks)(!t||e<i)&&(t=[r,i],e=i);return t}},na=class n{constructor(t){this.value=t}static create(){let t=new Error;return new n(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},sp=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},ap=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},N1=0,yo=class{constructor(t){this.value=t}stack;id=N1++},B1=2,V1=(n,t)=>{if(n instanceof yo)t(n);else for(let e=0;e<n.length;e++){let r=n[e];r&&t(r)}},Ql;if(F1){let n=[];setInterval(()=>{n.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(n.join(`
`)),n.length=0)},3e3),Ql=new FinalizationRegistry(t=>{typeof t=="string"&&n.push(t)})}var S=class{_options;_leakageMon;_perfMon;_disposed;_event;_listeners;_deliveryQueue;_size=0;constructor(t){this._options=t,this._leakageMon=Gh>0||this._options?.leakWarningThreshold?new op(t?.onListenerError??nt,this._options?.leakWarningThreshold??Gh):void 0,this._perfMon=this._options?._profName?new ip(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(jh){let t=this._listeners;queueMicrotask(()=>{V1(t,e=>e.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(t,e,r)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let l=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(l);let c=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],d=new ap(`${l}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this._options?.onListenerError||nt)(d),O.None}if(this._disposed)return O.None;e&&(t=t.bind(e));let i=new yo(t),o,s;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(i.stack=na.create(),o=this._leakageMon.check(i.stack,this._size+1)),jh&&(i.stack=s??na.create()),this._listeners?this._listeners instanceof yo?(this._deliveryQueue??=new lp,this._listeners=[this._listeners,i]):this._listeners.push(i):(this._options?.onWillAddFirstListener?.(this),this._listeners=i,this._options?.onDidAddFirstListener?.(this)),this._size++;let a=Z(()=>{Ql?.unregister(a),o?.(),this._removeListener(i)});if(r instanceof re?r.add(a):Array.isArray(r)&&r.push(a),Ql){let l=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),c=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(l);Ql.register(a,c?.[2]??l,a)}return a},this._event}_removeListener(t){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let e=this._listeners,r=e.indexOf(t);if(r===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,e[r]=void 0;let i=this._deliveryQueue.current===this;if(this._size*B1<=e.length){let o=0;for(let s=0;s<e.length;s++)e[s]?e[o++]=e[s]:i&&(this._deliveryQueue.end--,o<this._deliveryQueue.i&&this._deliveryQueue.i--);e.length=o}}_deliver(t,e){if(!t)return;let r=this._options?.onListenerError||nt;if(!r){t.value(e);return}try{t.value(e)}catch(i){r(i)}}_deliverQueue(t){let e=t.current._listeners;for(;t.i<t.end;)this._deliver(e[t.i++],t.value);t.reset()}fire(t){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof yo)this._deliver(this._listeners,t);else{let e=this._deliveryQueue;e.enqueue(this,t,this._listeners.length),this._deliverQueue(e)}this._perfMon?.stop()}hasListeners(){return this._size>0}};var lp=class{i=-1;end=0;current;value;enqueue(t,e,r){this.i=0,this.end=r,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}};var Di=class extends S{_isPaused=0;_eventQueue=new go;_mergeFn;get isPaused(){return this._isPaused!==0}constructor(t){super(t),this._mergeFn=t?.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){let t=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(t))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(t){this._size&&(this._isPaused!==0?this._eventQueue.push(t):super.fire(t))}};var Yl=class{emitter;hasListeners=!1;events=[];constructor(){this.emitter=new S({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(t){let e={event:t,listener:null};return this.events.push(e),this.hasListeners&&this.hook(e),Z(po(()=>{this.hasListeners&&this.unhook(e);let i=this.events.indexOf(e);this.events.splice(i,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(t=>this.hook(t))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(t=>this.unhook(t))}hook(t){t.listener=t.event(e=>this.emitter.fire(e))}unhook(t){t.listener?.dispose(),t.listener=null}dispose(){this.emitter.dispose();for(let t of this.events)t.listener?.dispose();this.events=[]}};var ia=class{listening=!1;inputEvent=E.None;inputEventListener=O.None;emitter=new S({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}});event=this.emitter.event;set input(t){this.inputEvent=t,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=t(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}};function K1(n){return n}var Xl=class{lastCache=void 0;lastArgKey=void 0;_fn;_computeKey;constructor(t,e){typeof t=="function"?(this._fn=t,this._computeKey=K1):(this._fn=e,this._computeKey=t.getCacheKey)}get(t){let e=this._computeKey(t);return this.lastArgKey!==e&&(this.lastArgKey=e,this.lastCache=this._fn(t)),this.lastCache}};var Or=class{constructor(t){this.executor=t}_didRun=!1;_value;_error;get hasValue(){return this._didRun}get value(){if(!this._didRun)try{this._value=this.executor()}catch(t){this._error=t}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}};function Yh(n){return!n||typeof n!="string"?!0:n.trim().length===0}function fn(n){return n.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function cp(n,t){if(!n||!t)return n;let e=t.length;if(e===0||n.length===0)return n;let r=0;for(;n.indexOf(t,r)===r;)r=r+e;return n.substring(r)}function Ri(n,t){if(!n||!t)return n;let e=t.length,r=n.length;if(e===0||r===0)return n;let i=r,o=-1;for(;o=n.lastIndexOf(t,i-1),!(o===-1||o+e!==i);){if(o===0)return"";i=o}return n.substring(0,i)}function oa(n,t){return n<t?-1:n>t?1:0}function Zl(n,t,e=0,r=n.length,i=0,o=t.length){for(;e<r&&i<o;e++,i++){let l=n.charCodeAt(e),c=t.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=r-e,a=o-i;return s<a?-1:s>a?1:0}function sa(n,t){return bo(n,t,0,n.length,0,t.length)}function bo(n,t,e=0,r=n.length,i=0,o=t.length){for(;e<r&&i<o;e++,i++){let l=n.charCodeAt(e),c=t.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return Zl(n.toLowerCase(),t.toLowerCase(),e,r,i,o);Jh(l)&&(l-=32),Jh(c)&&(c-=32);let d=l-c;if(d!==0)return d}let s=r-e,a=o-i;return s<a?-1:s>a?1:0}function Jh(n){return n>=97&&n<=122}function dp(n){return n>=65&&n<=90}function hr(n,t){return n.length===t.length&&bo(n,t)===0}function jr(n,t){let e=t.length;return t.length>n.length?!1:bo(n,t,0,e)===0}function Xh(n){return 55296<=n&&n<=56319}function up(n){return 56320<=n&&n<=57343}function Zh(n,t){return(n-55296<<10)+(t-56320)+65536}var m_=String.fromCharCode(65279);var Qh=class n{constructor(t){this.confusableDictionary=t}static ambiguousCharacterData=new Or(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'));static cache=new Xl({getCacheKey:JSON.stringify},t=>{function e(d){let f=new Map;for(let m=0;m<d.length;m+=2)f.set(d[m],d[m+1]);return f}function r(d,f){let m=new Map(d);for(let[g,b]of f)m.set(g,b);return m}function i(d,f){if(!d)return f;let m=new Map;for(let[g,b]of d)f.has(g)&&m.set(g,b);return m}let o=this.ambiguousCharacterData.value,s=t.filter(d=>!d.startsWith("_")&&d in o);s.length===0&&(s=["_default"]);let a;for(let d of s){let f=e(o[d]);a=i(a,f)}let l=e(o._common),c=r(l,a);return new n(c)});static getInstance(t){return n.cache.get(Array.from(t))}static _locales=new Or(()=>Object.keys(n.ambiguousCharacterData.value).filter(t=>!t.startsWith("_")));static getLocales(){return n._locales.value}isAmbiguous(t){return this.confusableDictionary.has(t)}containsAmbiguousCharacter(t){for(let e=0;e<t.length;e++){let r=t.codePointAt(e);if(typeof r=="number"&&this.isAmbiguous(r))return!0}return!1}getPrimaryConfusable(t){return this.confusableDictionary.get(t)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}};var U;(oe=>(oe.inMemory="inmemory",oe.vscode="vscode",oe.internal="private",oe.walkThrough="walkThrough",oe.walkThroughSnippet="walkThroughSnippet",oe.http="http",oe.https="https",oe.file="file",oe.mailto="mailto",oe.untitled="untitled",oe.data="data",oe.command="command",oe.vscodeRemote="vscode-remote",oe.vscodeRemoteResource="vscode-remote-resource",oe.vscodeManagedRemoteResource="vscode-managed-remote-resource",oe.vscodeUserData="vscode-userdata",oe.vscodeCustomEditor="vscode-custom-editor",oe.vscodeNotebookCell="vscode-notebook-cell",oe.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",oe.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",oe.vscodeNotebookCellOutput="vscode-notebook-cell-output",oe.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",oe.vscodeNotebookMetadata="vscode-notebook-metadata",oe.vscodeInteractiveInput="vscode-interactive-input",oe.vscodeSettings="vscode-settings",oe.vscodeWorkspaceTrust="vscode-workspace-trust",oe.vscodeTerminal="vscode-terminal",oe.vscodeChatCodeBlock="vscode-chat-code-block",oe.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",oe.vscodeChatSesssion="vscode-chat-editor",oe.webviewPanel="webview-panel",oe.vscodeWebview="vscode-webview",oe.extension="extension",oe.vscodeFileResource="vscode-file",oe.tmp="tmp",oe.vsls="vsls",oe.vscodeSourceControl="vscode-scm",oe.commentsInput="comment",oe.codeSetting="code-setting",oe.outputChannel="output"))(U||={});function H1(n,t){return x.isUri(n)?hr(n.scheme,t):jr(n,t+":")}function eg(n,...t){return t.some(e=>H1(n,e))}var z1="tkn",pp=class{_hosts=Object.create(null);_ports=Object.create(null);_connectionTokens=Object.create(null);_preferredWebSchema="http";_delegate=null;_serverRootPath="/";setPreferredWebSchema(t){this._preferredWebSchema=t}setDelegate(t){this._delegate=t}setServerRootPath(t,e){this._serverRootPath=$1(t,e)}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return Q.join(this._serverRootPath,U.vscodeRemoteResource)}set(t,e,r){this._hosts[t]=e,this._ports[t]=r}setConnectionToken(t,e){this._connectionTokens[t]=e}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(t){if(this._delegate)try{return this._delegate(t)}catch(a){return nt(a),t}let e=t.authority,r=this._hosts[e];r&&r.indexOf(":")!==-1&&r.indexOf("[")===-1&&(r=`[${r}]`);let i=this._ports[e],o=this._connectionTokens[e],s=`path=${encodeURIComponent(t.path)}`;return typeof o=="string"&&(s+=`&${z1}=${encodeURIComponent(o)}`),x.from({scheme:kr?this._preferredWebSchema:U.vscodeRemoteResource,authority:`${r}:${i}`,path:this._remoteResourcesPath,query:s})}},q1=new pp;function $1(n,t){return Q.join(t??"/",`${n.quality??"oss"}-${n.commit??"dev"}`)}var la="vscode-app",fp=class n{static FALLBACK_AUTHORITY=la;asBrowserUri(t){let e=this.toUri(t);return this.uriToBrowserUri(e)}uriToBrowserUri(t){return t.scheme===U.vscodeRemote?q1.rewrite(t):t.scheme===U.file&&(Al||dh===`${U.vscodeFileResource}://${n.FALLBACK_AUTHORITY}`)?t.with({scheme:U.vscodeFileResource,authority:t.authority||n.FALLBACK_AUTHORITY,query:null,fragment:null}):t}asFileUri(t){let e=this.toUri(t);return this.uriToFileUri(e)}uriToFileUri(t){return t.scheme===U.vscodeFileResource?t.with({scheme:U.file,authority:t.authority!==n.FALLBACK_AUTHORITY?t.authority:null,query:null,fragment:null}):t}toUri(t,e){if(x.isUri(t))return t;if(globalThis._VSCODE_FILE_ROOT){let r=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(r))return x.joinPath(x.parse(r,!0),t);let i=F(r,t);return x.file(i)}return x.parse(e.toUrl(t))}},Me=new fp,mp;(o=>{let n=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);o.CoopAndCoep=Object.freeze(n.get("3"));let e="vscode-coi";function r(s){let a;typeof s=="string"?a=new URL(s).searchParams:s instanceof URL?a=s.searchParams:x.isUri(s)&&(a=new URL(s.toString(!0)).searchParams);let l=a?.get(e);if(l)return n.get(l)}o.getHeadersFromQuery=r;function i(s,a,l){if(!globalThis.crossOriginIsolated)return;let c=a&&l?"3":l?"2":"1";s instanceof URLSearchParams?s.set(e,c):s[e]=c}o.addSearchParam=i})(mp||={});var hp=class{mapListenerToWrapper=new WeakMap;on(t,e){let r=(i,...o)=>{this.validateEvent(t,i)&&e(i,...o)};return this.mapListenerToWrapper.set(e,r),ca.ipcMain.on(t,r),this}once(t,e){return ca.ipcMain.once(t,(r,...i)=>{this.validateEvent(t,r)&&e(r,...i)}),this}handle(t,e){return ca.ipcMain.handle(t,(r,...i)=>this.validateEvent(t,r)?e(r,...i):Promise.reject(`Invalid channel '${t}' or sender for ipcMain.handle() usage.`)),this}removeHandler(t){return ca.ipcMain.removeHandler(t),this}removeListener(t,e){let r=this.mapListenerToWrapper.get(e);return r&&(ca.ipcMain.removeListener(t,r),this.mapListenerToWrapper.delete(e)),this}validateEvent(t,e){if(!t||!t.startsWith("vscode:"))return nt(`Refused to handle ipcMain event for channel '${t}' because the channel is unknown.`),!1;let r=e.senderFrame,i=r.url;if(!i||i==="about:blank")return!0;let o="unknown";try{o=new URL(i).host}catch{return nt(`Refused to handle ipcMain event for channel '${t}' because of a malformed URL '${i}'.`),!1}return o!==la?(nt(`Refused to handle ipcMain event for channel '${t}' because of a bad origin of '${o}'.`),!1):r.parent!==null?(nt(`Refused to handle ipcMain event for channel '${t}' because sender of origin '${o}' is not a main frame.`),!1):!0}},ke=new hp;import{hostname as cP,release as dP}from"os";function ec(n,t){return new gp(n,t)}var gp=class{constructor(t,e){this.reducer=t;this.options=e}state={flowing:!1,ended:!1,destroyed:!1};buffer={data:[],error:[]};listeners={data:[],error:[],end:[]};pendingWritePromises=[];pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(t){if(!this.state.destroyed){if(this.state.flowing)this.emitData(t);else if(this.buffer.data.push(t),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(e=>this.pendingWritePromises.push(e))}}error(t){this.state.destroyed||(this.state.flowing?this.emitError(t):this.buffer.error.push(t))}end(t){this.state.destroyed||(typeof t<"u"&&this.write(t),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(t){this.listeners.data.slice(0).forEach(e=>e(t))}emitError(t){this.listeners.error.length===0?nt(t):this.listeners.error.slice(0).forEach(e=>e(t))}emitEnd(){this.listeners.end.slice(0).forEach(t=>t())}on(t,e){if(!this.state.destroyed)switch(t){case"data":this.listeners.data.push(e),this.resume();break;case"end":this.listeners.end.push(e),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(e),this.state.flowing&&this.flowErrors();break}}removeListener(t,e){if(this.state.destroyed)return;let r;switch(t){case"data":r=this.listeners.data;break;case"end":r=this.listeners.end;break;case"error":r=this.listeners.error;break}if(r){let i=r.indexOf(e);i>=0&&r.splice(i,1)}}flowData(){if(this.buffer.data.length>0){let t=this.reducer(this.buffer.data);this.emitData(t),this.buffer.data.length=0;let e=[...this.pendingWritePromises];this.pendingWritePromises.length=0,e.forEach(r=>r())}}flowErrors(){if(this.listeners.error.length>0){for(let t of this.buffer.error)this.emitError(t);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}};function tg(n,t){return new Promise((e,r)=>{let i=[];vp(n,{onData:o=>{t&&i.push(o)},onError:o=>{t?r(o):e(void 0)},onEnd:()=>{e(t?t(i):void 0)}})})}function vp(n,t,e){n.on("error",r=>{e?.isCancellationRequested||t.onError(r)}),n.on("end",()=>{e?.isCancellationRequested||t.onEnd()}),n.on("data",r=>{e?.isCancellationRequested||t.onData(r)})}var tc=typeof Buffer<"u",G1=new Or(()=>new Uint8Array(256)),yp,bp,te=class n{static alloc(t){return tc?new n(Buffer.allocUnsafe(t)):new n(new Uint8Array(t))}static wrap(t){return tc&&!Buffer.isBuffer(t)&&(t=Buffer.from(t.buffer,t.byteOffset,t.byteLength)),new n(t)}static fromString(t,e){return!(e?.dontUseNodeBuffer||!1)&&tc?new n(Buffer.from(t)):(yp||(yp=new TextEncoder),new n(yp.encode(t)))}static fromByteArray(t){let e=n.alloc(t.length);for(let r=0,i=t.length;r<i;r++)e.buffer[r]=t[r];return e}static concat(t,e){if(typeof e>"u"){e=0;for(let o=0,s=t.length;o<s;o++)e+=t[o].byteLength}let r=n.alloc(e),i=0;for(let o=0,s=t.length;o<s;o++){let a=t[o];r.set(a,i),i+=a.byteLength}return r}buffer;byteLength;constructor(t){this.buffer=t,this.byteLength=this.buffer.byteLength}clone(){let t=n.alloc(this.byteLength);return t.set(this),t}toString(){return tc?this.buffer.toString():(bp||(bp=new TextDecoder),bp.decode(this.buffer))}slice(t,e){return new n(this.buffer.subarray(t,e))}set(t,e){if(t instanceof n)this.buffer.set(t.buffer,e);else if(t instanceof Uint8Array)this.buffer.set(t,e);else if(t instanceof ArrayBuffer)this.buffer.set(new Uint8Array(t),e);else if(ArrayBuffer.isView(t))this.buffer.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e);else throw new Error("Unknown argument 'array'")}readUInt32BE(t){return Q1(this.buffer,t)}writeUInt32BE(t,e){Y1(this.buffer,t,e)}readUInt32LE(t){return X1(this.buffer,t)}writeUInt32LE(t,e){Z1(this.buffer,t,e)}readUInt8(t){return ew(this.buffer,t)}writeUInt8(t,e){tw(this.buffer,t,e)}indexOf(t,e=0){return J1(this.buffer,t instanceof n?t.buffer:t,e)}};function J1(n,t,e=0){let r=t.byteLength,i=n.byteLength;if(r===0)return 0;if(r===1)return n.indexOf(t[0]);if(r>i-e)return-1;let o=G1.value;o.fill(t.length);for(let c=0;c<t.length;c++)o[t[c]]=t.length-c-1;let s=e+t.length-1,a=s,l=-1;for(;s<i;)if(n[s]===t[a]){if(a===0){l=s;break}s--,a--}else s+=Math.max(t.length-a,o[n[s]]),a=t.length-1;return l}function Q1(n,t){return n[t]*2**24+n[t+1]*2**16+n[t+2]*2**8+n[t+3]}function Y1(n,t,e){n[e+3]=t,t=t>>>8,n[e+2]=t,t=t>>>8,n[e+1]=t,t=t>>>8,n[e]=t}function X1(n,t){return n[t+0]<<0>>>0|n[t+1]<<8>>>0|n[t+2]<<16>>>0|n[t+3]<<24>>>0}function Z1(n,t,e){n[e+0]=t&255,t=t>>>8,n[e+1]=t&255,t=t>>>8,n[e+2]=t&255,t=t>>>8,n[e+3]=t&255}function ew(n,t){return n[t]}function tw(n,t,e){n[e]=t}function rc(n){return tg(n,t=>te.concat(t))}function Ce(n){return typeof n=="string"}function Xe(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}function Io(n){return typeof n=="number"&&!isNaN(n)}function wr(n){return typeof n>"u"}function st(n){return wr(n)||n===null}function rg(n,t){if(!n)throw new Error(t?`Unexpected type, expected '${t}'`:"Unexpected type")}function mn(n){if(st(n))throw new Error("Assertion Failed: argument is undefined or null");return n}var rw=Object.prototype.hasOwnProperty;function nc(n){if(!Xe(n))return!1;for(let t in n)if(rw.call(n,t))return!1;return!0}function ic(n){return typeof n=="function"}function ng(n,t){let e=Math.min(n.length,t.length);for(let r=0;r<e;r++)nw(n[r],t[r])}function nw(n,t){if(Ce(t)){if(typeof n!==t)throw new Error(`argument does not match constraint: typeof ${t}`)}else if(ic(t)){try{if(n instanceof t)return}catch{}if(!st(n)&&n.constructor===t||t.length===1&&t.call(void 0,n)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}function Ip(n,t){return t&&(n.stack||n.stacktrace)?p("stackTrace.format","{0}: {1}",og(n),ig(n.stack)||ig(n.stacktrace)):og(n)}function ig(n){return Array.isArray(n)?n.join(`
`):n}function og(n){return n.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${n.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof n.code=="string"&&typeof n.errno=="number"&&typeof n.syscall=="string"?p("nodeExceptionMessage","A system error occurred ({0})",n.message):n.message||p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function Xt(n=null,t=!1){if(!n)return p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.");if(Array.isArray(n)){let e=pt(n),r=Xt(e[0],t);return e.length>1?p("error.moreErrors","{0} ({1} errors in total)",r,e.length):r}if(Ce(n))return n;if(n.detail){let e=n.detail;if(e.error)return Ip(e.error,t);if(e.exception)return Ip(e.exception,t)}return n.stack?Ip(n,t):n.message?n.message:p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}var ua={exports:{}};(function(){function t(){let e=/("[^"\\]*(?:\\.[^"\\]*)*")|('[^'\\]*(?:\\.[^'\\]*)*')|(\/\*[^\/\*]*(?:(?:\*|\/)[^\/\*]*)*?\*\/)|(\/{2,}.*?(?:(?:\r?\n)|$))|(,\s*[}\]])/g;function r(o){return o.replace(e,function(s,a,l,c,d,f){if(c)return"";if(d){let m=d.length;return d[m-1]===`
`?d[m-2]==="\r"?`\r
`:`
`:""}else return f?s.substring(1):s})}function i(o){let s=r(o);try{return JSON.parse(s)}catch{let l=s.replace(/,\s*([}\]])/g,"$1");return JSON.parse(l)}}return{stripComments:r,parse:i}}typeof ua=="object"&&typeof ua.exports=="object"?ua.exports=t():console.trace("jsonc defined in UNKNOWN context (neither requirejs or commonjs)")})();var z_=ua.exports.stripComments,sg=ua.exports.parse;function Bn(n){return n===47||n===92}function Gr(n){return n.replace(/[\\/]/g,Q.sep)}function ag(n){return n.indexOf("/")===-1&&(n=Gr(n)),/^[a-zA-Z]:(\/|$)/.test(n)&&(n="/"+n),n}function wp(n,t=Q.sep){if(!n)return"";let e=n.length,r=n.charCodeAt(0);if(Bn(r)){if(Bn(n.charCodeAt(1))&&!Bn(n.charCodeAt(2))){let o=3,s=o;for(;o<e&&!Bn(n.charCodeAt(o));o++);if(s!==o&&!Bn(n.charCodeAt(o+1))){for(o+=1;o<e;o++)if(Bn(n.charCodeAt(o)))return n.slice(0,o+1).replace(/[\\/]/g,t)}}return t}else if(oc(r)&&n.charCodeAt(1)===58)return Bn(n.charCodeAt(2))?n.slice(0,2)+t:n.slice(0,2);let i=n.indexOf("://");if(i!==-1){for(i+=3;i<e;i++)if(Bn(n.charCodeAt(i)))return n.slice(0,i+1)}return""}function lg(n){if(!N||!n||n.length<5)return!1;let t=n.charCodeAt(0);if(t!==92||(t=n.charCodeAt(1),t!==92))return!1;let e=2,r=e;for(;e<n.length&&(t=n.charCodeAt(e),t!==92);e++);return!(r===e||(t=n.charCodeAt(e+1),isNaN(t)||t===92))}function Li(n,t,e){let r=n===t;return!e||r?r:!n||!t?!1:hr(n,t)}function hn(n,t,e,r=ot){if(n===t)return!0;if(!n||!t||t.length>n.length)return!1;if(e){if(!jr(n,t))return!1;if(t.length===n.length)return!0;let o=t.length;return t.charAt(t.length-1)===r&&o--,n.charAt(o)===r}return t.charAt(t.length-1)!==r&&(t+=r),n.indexOf(t)===0}function oc(n){return n>=65&&n<=90||n>=97&&n<=122}function cg(n,t){return N&&n.endsWith(":")&&(n+=ot),fr(n)||(n=F(t,n)),n=ct(n),xp(n)}function xp(n){return N?(n=Ri(n,ot),n.endsWith(":")&&(n+=ot)):(n=Ri(n,ot),n||(n=ot)),n}function dg(n){let t=ct(n);return N?n.length>3?!1:Sp(t)&&(n.length===2||t.charCodeAt(2)===92):t===Q.sep}function Sp(n,t=N){return t?oc(n.charCodeAt(0))&&n.charCodeAt(1)===58:!1}function sc(n){let t=n.split(":"),e,r,i;for(let o of t){let s=Number(o);Io(s)?r===void 0?r=s:i===void 0&&(i=s):e=e?[e,o].join(":"):o}if(!e)throw new Error("Format for `--goto` should be: `FILE:LINE(:COLUMN)`");return{path:e,line:r!==void 0?r:void 0,column:i!==void 0?i:r!==void 0?1:void 0}}var iw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",ow="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function ac(n,t,e=8){let r="";for(let o=0;o<e;o++){let s;o===0&&N&&!t&&(e===3||e===4)?s=ow:s=iw,r+=s.charAt(Math.floor(Math.random()*s.length))}let i;return t?i=`${t}-${r}`:i=r,n?F(n,i):i}function Et(n){return Xs(n,!0)}var pa=class{constructor(t){this._ignorePathCasing=t}compare(t,e,r=!1){return t===e?0:oa(this.getComparisonKey(t,r),this.getComparisonKey(e,r))}isEqual(t,e,r=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,r)===this.getComparisonKey(e,r)}getComparisonKey(t,e=!1){return t.with({path:this._ignorePathCasing(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this._ignorePathCasing(t)}isEqualOrParent(t,e,r=!1){if(t.scheme===e.scheme){if(t.scheme===U.file)return hn(Et(t),Et(e),this._ignorePathCasing(t))&&t.query===e.query&&(r||t.fragment===e.fragment);if(Ft(t.authority,e.authority))return hn(t.path,e.path,this._ignorePathCasing(t),"/")&&t.query===e.query&&(r||t.fragment===e.fragment)}return!1}joinPath(t,...e){return x.joinPath(t,...e)}basenameOrAuthority(t){return Vt(t)||t.authority}basename(t){return Q.basename(t.path)}extname(t){return Q.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===U.file?e=x.file(Fe(Et(t))).path:(e=Q.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==47&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===U.file?e=x.file(ct(Et(t))).path:e=Q.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!Ft(t.authority,e.authority))return;if(t.scheme===U.file){let o=bh(Et(t),Et(e));return N?Gr(o):o}let r=t.path||"/",i=e.path||"/";if(this._ignorePathCasing(t)){let o=0;for(let s=Math.min(r.length,i.length);o<s&&!(r.charCodeAt(o)!==i.charCodeAt(o)&&r.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);r=i.substr(0,o)+r.substr(o)}return Q.relative(r,i)}resolvePath(t,e){if(t.scheme===U.file){let r=x.file(Fn(Et(t),e));return t.with({authority:r.authority,path:r.path})}return e=ag(e),t.with({path:Q.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&hr(t,e)}hasTrailingPathSeparator(t,e=ot){if(t.scheme===U.file){let r=Et(t);return r.length>wp(r).length&&r[r.length-1]===e}else{let r=t.path;return r.length>1&&r.charCodeAt(r.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=ot){return ug(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=ot){let r=!1;if(t.scheme===U.file){let i=Et(t);r=i!==void 0&&i.length===wp(i).length&&i[i.length-1]===e}else{e="/";let i=t.path;r=i.length===1&&i.charCodeAt(i.length-1)===47}return!r&&!ug(t,e)?t.with({path:t.path+"/"}):t}},we=new pa(()=>!1),Ae=new pa(n=>n.scheme===U.file?!j:!0),pg=new pa(n=>!0),lc=we.isEqual.bind(we),Ep=we.isEqualOrParent.bind(we),r2=we.getComparisonKey.bind(we),aw=we.basenameOrAuthority.bind(we),Vt=we.basename.bind(we),fg=we.extname.bind(we),mg=we.dirname.bind(we),ne=we.joinPath.bind(we),hg=we.normalizePath.bind(we),n2=we.relativePath.bind(we),i2=we.resolvePath.bind(we),o2=we.isAbsolutePath.bind(we),Ft=we.isEqualAuthority.bind(we),ug=we.hasTrailingPathSeparator.bind(we),gg=we.removeTrailingPathSeparator.bind(we),s2=we.addTrailingPathSeparator.bind(we);var lw;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(d=>{let[f,m]=d.split(":");f&&m&&a.set(f,m)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(lw||={});function Oi(n,t){let{os:e,tildify:r,relative:i}=t;if(i){let a=cw(n,i,e);if(typeof a=="string")return a}let o=n.fsPath;if(e===1&&!N?o=o.replace(/\//g,"\\"):e!==1&&N&&(o=o.replace(/\\/g,"/")),e!==1&&r?.userHome){let a=r.userHome.fsPath,l;n.scheme!==r.userHome.scheme&&n.path[0]===Q.sep&&n.path[1]!==Q.sep?l=r.userHome.with({path:n.path}).fsPath:l=o,o=dw(l,a,e)}return(e===1?Ne:Q).normalize(fa(o,e===1))}function cw(n,t,e){let r=e===1?Ne:Q,i=e===3?we:pg,o=t.getWorkspace(),s=o.folders.at(0);if(!s)return;n.scheme!==s.uri.scheme&&n.path[0]===Q.sep&&n.path[1]!==Q.sep&&(n=s.uri.with({path:n.path}));let a=t.getWorkspaceFolder(n);if(!a)return;let l;if(i.isEqual(a.uri,n)?l="":l=i.relativePath(a.uri,n)??"",l&&(l=r.normalize(l)),o.folders.length>1&&!t.noPrefix){let c=a.name?a.name:i.basenameOrAuthority(a.uri);l=l?`${c} \u2022 ${l}`:c}return l}function fa(n,t=N){return Sp(n,t)?n.charAt(0).toUpperCase()+n.slice(1):n}var Pp=Object.create(null);function dw(n,t,e=ur){if(e===1||!n||!t)return n;let r=Pp.original===t?Pp.normalized:void 0;r||(r=t,N&&(r=Gr(r)),r=`${Ri(r,Q.sep)}${Q.sep}`,Pp={original:t,normalized:r});let i=n;return N&&(i=Gr(i)),(e===3?i.startsWith(r):jr(i,r))?`~/${i.substr(r.length)}`:n}function yg(n,t){return A||t?n.replace(/\(&&\w\)|&&/g,"").replace(/&/g,A?"&":"&&"):n.replace(/&&|&/g,e=>e==="&"?"&&":"&")}function cc(n,t){return A||t?n.replace(/\(&&\w\)|&&/g,""):N?n.replace(/&&|&/g,e=>e==="&"?"&&":"&"):n.replace(/&&/g,"_")}function bg(n){if(n.endsWith("]")){let t=n.lastIndexOf(" [",n.length-2);if(t!==-1){let e=vg(n.substring(0,t)),r=n.substring(t);return{name:e.name+r,parentPath:e.parentPath}}}return vg(n)}function vg(n){let t=n.indexOf("/")!==-1?Q:Ne,e=t.basename(n),r=t.dirname(n);return e.length?{name:e,parentPath:r}:{name:r,parentPath:""}}var uw=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function Ig(n){return uw.test(n)}var yt=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let n;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?n=crypto.getRandomValues.bind(crypto):n=function(r){for(let i=0;i<r.length;i++)r[i]=Math.floor(Math.random()*256);return r};let t=new Uint8Array(16),e=[];for(let r=0;r<256;r++)e.push(r.toString(16).padStart(2,"0"));return function(){n(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let i=0,o="";return o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o}}();import{Menu as fw,MenuItem as kp}from"electron";var wg="vscode:contextmenu",xg="vscode:onCloseContextMenu";function Sg(){ke.on(wg,(n,t,e,r,i)=>{let o=Eg(n,r,e);o.popup({x:i?i.x:void 0,y:i?i.y:void 0,positioningItem:i?i.positioningItem:void 0,callback:()=>{o&&n.sender.send(xg,t)}})})}function Eg(n,t,e){let r=new fw;return e.forEach(i=>{let o;i.type==="separator"?o=new kp({type:i.type}):Array.isArray(i.submenu)?o=new kp({submenu:Eg(n,t,i.submenu),label:i.label}):o=new kp({label:i.label,type:i.type,accelerator:i.accelerator,checked:i.checked,enabled:i.enabled,visible:i.visible,click:(s,a,l)=>n.sender.send(t,i.id,l)}),r.append(o)}),r}function fc(n){return!!n&&typeof n.then=="function"}function Hn(n){let t=new mt,e=n(t.token),r=new Promise((i,o)=>{let s=t.token.onCancellationRequested(()=>{s.dispose(),o(new rt)});Promise.resolve(e).then(a=>{s.dispose(),t.dispose(),i(a)},a=>{s.dispose(),t.dispose(),o(a)})});return new class{cancel(){t.cancel(),t.dispose()}then(i,o){return r.then(i,o)}catch(i){return this.then(void 0,i)}finally(i){return r.finally(i)}}}function Tg(n,t,e){let r,i=setTimeout(()=>{r?.(void 0),e?.()},t);return Promise.race([n.finally(()=>clearTimeout(i)),new Promise(o=>r=o)])}var _p=class{activePromise;queuedPromise;queuedPromiseFactory;isDisposed=!1;constructor(){this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(t){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=t,!this.queuedPromise){let e=()=>{if(this.queuedPromise=null,this.isDisposed)return;let r=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,r};this.queuedPromise=new Promise(r=>{this.activePromise.then(e,e).then(r)})}return new Promise((e,r)=>{this.queuedPromise.then(e,r)})}return this.activePromise=t(),new Promise((e,r)=>{this.activePromise.then(i=>{this.activePromise=null,e(i)},i=>{this.activePromise=null,r(i)})})}dispose(){this.isDisposed=!0}};var mw=(n,t)=>{let e=!0,r=setTimeout(()=>{e=!1,t()},n);return{isTriggered:()=>e,dispose:()=>{clearTimeout(r),e=!1}}},hw=n=>{let t=!0;return queueMicrotask(()=>{t&&(t=!1,n())}),{isTriggered:()=>t,dispose:()=>{t=!1}}},ma=class{constructor(t){this.defaultDelay=t;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}deferred;completionPromise;doResolve;doReject;task;trigger(t,e=this.defaultDelay){this.task=t,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}));let r=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=e===$h?hw(r):mw(e,r),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new rt),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}},Kt=class{delayer;throttler;constructor(t){this.delayer=new ma(t),this.throttler=new _p}trigger(t,e){return this.delayer.trigger(()=>this.throttler.queue(t),e)}isTriggered(){return this.delayer.isTriggered()}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}},Vn=class{_isOpen;_promise;_completePromise;constructor(){this._isOpen=!1,this._promise=new Promise((t,e)=>{this._completePromise=t})}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}};function $e(n,t){return t?new Promise((e,r)=>{let i=setTimeout(()=>{o.dispose(),e()},n),o=t.onCancellationRequested(()=>{clearTimeout(i),o.dispose(),r(new rt)})}):Hn(e=>$e(n,e))}function kg(n,t=0,e){let r=setTimeout(()=>{n(),e&&i.dispose()},t),i=Z(()=>{clearTimeout(r),e?.deleteAndLeak(i)});return e?.add(i),i}function Cg(n,t=r=>!!r,e=null){let r=0,i=n.length,o=()=>{if(r>=i)return Promise.resolve(e);let s=n[r++];return Promise.resolve(s()).then(l=>t(l)?Promise.resolve(l):o())};return o()}var Dp=class{_size=0;_isDisposed=!1;runningPromises;maxDegreeOfParalellism;outstandingPromises;_onDrained;constructor(t){this.maxDegreeOfParalellism=t,this.outstandingPromises=[],this.runningPromises=0,this._onDrained=new S}whenIdle(){return this.size>0?E.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this._onDrained.event}get size(){return this._size}queue(t){if(this._isDisposed)throw new Error("Object has been disposed");return this._size++,new Promise((e,r)=>{this.outstandingPromises.push({factory:t,c:e,e:r}),this.consume()})}consume(){for(;this.outstandingPromises.length&&this.runningPromises<this.maxDegreeOfParalellism;){let t=this.outstandingPromises.shift();this.runningPromises++;let e=t.factory();e.then(t.c,t.e),e.then(()=>this.consumed(),()=>this.consumed())}}consumed(){this._isDisposed||(this.runningPromises--,--this._size===0&&this._onDrained.fire(),this.outstandingPromises.length>0&&this.consume())}clear(){if(this._isDisposed)throw new Error("Object has been disposed");this.outstandingPromises.length=0,this._size=this.runningPromises}dispose(){this._isDisposed=!0,this.outstandingPromises.length=0,this._size=0,this._onDrained.dispose()}},Kn=class extends Dp{constructor(){super(1)}};var dc=class{queues=new Map;drainers=new Set;drainListeners=void 0;drainListenerCount=0;async whenDrained(){if(this.isDrained())return;let t=new Ht;return this.drainers.add(t),t.p}isDrained(){for(let[,t]of this.queues)if(t.size>0)return!1;return!0}queueSize(t,e=we){let r=e.getComparisonKey(t);return this.queues.get(r)?.size??0}queueFor(t,e,r=we){let i=r.getComparisonKey(t),o=this.queues.get(i);if(!o){o=new Kn;let s=this.drainListenerCount++,a=E.once(o.onDrained)(()=>{o?.dispose(),this.queues.delete(i),this.onDidQueueDrain(),this.drainListeners?.deleteAndDispose(s),this.drainListeners?.size===0&&(this.drainListeners.dispose(),this.drainListeners=void 0)});this.drainListeners||(this.drainListeners=new pn),this.drainListeners.set(s,a),this.queues.set(i,o)}return o.queue(e)}onDidQueueDrain(){this.isDrained()&&this.releaseDrainers()}releaseDrainers(){for(let t of this.drainers)t.complete();this.drainers.clear()}dispose(){for(let[,t]of this.queues)t.dispose();this.queues.clear(),this.releaseDrainers(),this.drainListeners?.dispose()}};var bt=class{runner;timeoutToken;timeout;timeoutHandler;constructor(t,e){this.timeoutToken=-1,this.runner=t,this.timeout=e,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=-1)}schedule(t=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,t)}get delay(){return this.timeout}set delay(t){this.timeout=t}isScheduled(){return this.timeoutToken!==-1}flush(){this.isScheduled()&&(this.cancel(),this.doRun())}onTimeout(){this.timeoutToken=-1,this.runner&&this.doRun()}doRun(){this.runner?.()}};var uc=class extends bt{units=[];constructor(t,e){super(t,e)}work(t){this.units.push(t),this.isScheduled()||this.schedule()}doRun(){let t=this.units;this.units=[],this.runner?.(t)}dispose(){this.units=[],super.dispose()}},pc=class extends O{constructor(e,r){super();this.options=e;this.handler=r}pendingWork=[];throttler=this._register(new Dr);disposed=!1;get pending(){return this.pendingWork.length}work(e){if(this.disposed)return!1;if(typeof this.options.maxBufferedWork=="number"){if(this.throttler.value){if(this.pending+e.length>this.options.maxBufferedWork)return!1}else if(this.pending+e.length-this.options.maxWorkChunkSize>this.options.maxBufferedWork)return!1}for(let r of e)this.pendingWork.push(r);return this.throttler.value||this.doWork(),!0}doWork(){this.handler(this.pendingWork.splice(0,this.options.maxWorkChunkSize)),this.pendingWork.length>0&&(this.throttler.value=new bt(()=>{this.throttler.clear(),this.doWork()},this.options.throttleDelay),this.throttler.value.schedule())}dispose(){super.dispose(),this.disposed=!0}},ha,Cp;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?Cp=(n,t)=>{ph(()=>{if(e)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let e=!1;return{dispose(){e||(e=!0)}}}:Cp=(n,t,e)=>{let r=n.requestIdleCallback(t,typeof e=="number"?{timeout:e}:void 0),i=!1;return{dispose(){i||(i=!0,n.cancelIdleCallback(r))}}},ha=n=>Cp(globalThis,n)})();async function _g(n,t,e){let r;for(let i=0;i<e;i++)try{return await n()}catch(o){r=o,await $e(t)}throw r}var Ht=class{completeCallback;errorCallback;outcome;get isRejected(){return this.outcome?.outcome===1}get isResolved(){return this.outcome?.outcome===0}get isSettled(){return!!this.outcome}get value(){return this.outcome?.outcome===0?this.outcome?.value:void 0}p;constructor(){this.p=new Promise((t,e)=>{this.completeCallback=t,this.errorCallback=e})}complete(t){return new Promise(e=>{this.completeCallback(t),this.outcome={outcome:0,value:t},e()})}error(t){return new Promise(e=>{this.errorCallback(t),this.outcome={outcome:1,value:t},e()})}cancel(){return this.error(new rt)}},Zt;(e=>{async function n(r){let i,o=await Promise.all(r.map(s=>s.then(a=>a,a=>{i||(i=a)})));if(typeof i<"u")throw i;return o}e.settled=n;function t(r){return new Promise(async(i,o)=>{try{await r(i,o)}catch(s){o(s)}})}e.withAsyncBody=t})(Zt||={});var Pg=class n{static fromArray(t){return new n(e=>{e.emitMany(t)})}static fromPromise(t){return new n(async e=>{e.emitMany(await t)})}static fromPromises(t){return new n(async e=>{await Promise.all(t.map(async r=>e.emitOne(await r)))})}static merge(t){return new n(async e=>{await Promise.all(t.map(async r=>{for await(let i of r)e.emitOne(i)}))})}static EMPTY=n.fromArray([]);_state;_results;_error;_onReturn;_onStateChanged;constructor(t,e){this._state=0,this._results=[],this._error=null,this._onReturn=e,this._onStateChanged=new S,queueMicrotask(async()=>{let r={emitOne:i=>this.emitOne(i),emitMany:i=>this.emitMany(i),reject:i=>this.reject(i)};try{await Promise.resolve(t(r)),this.resolve()}catch(i){this.reject(i)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await E.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,e){return new n(async r=>{for await(let i of t)r.emitOne(e(i))})}map(t){return n.map(this,t)}static filter(t,e){return new n(async r=>{for await(let i of t)e(i)&&r.emitOne(i)})}filter(t){return n.filter(this,t)}static coalesce(t){return n.filter(t,e=>!!e)}coalesce(){return n.coalesce(this)}static async toPromise(t){let e=[];for await(let r of t)e.push(r);return e}toPromise(){return n.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};function ie(n,t,e){let r=null,i=null;if(typeof e.value=="function"?(r="value",i=e.value,i.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof e.get=="function"&&(r="get",i=e.get),!i)throw new Error("not supported");let o=`$memoize$${t}`;e[r]=function(...s){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:i.apply(this,s)}),this[o]}}function Dg(n){return JSON.stringify(n,gw)}function Rg(n){let t=JSON.parse(n);return t=Ar(t),t}function gw(n,t){return t instanceof RegExp?{$mid:2,source:t.source,flags:t.flags}:t}function Ar(n,t=0){if(!n||t>200)return n;if(typeof n=="object"){switch(n.$mid){case 1:return x.revive(n);case 2:return new RegExp(n.source,n.flags);case 17:return new Date(n.source)}if(n instanceof te||n instanceof Uint8Array)return n;if(Array.isArray(n))for(let e=0;e<n.length;++e)n[e]=Ar(n[e],t+1);else for(let e in n)Object.hasOwnProperty.call(n,e)&&(n[e]=Ar(n[e],t+1))}return n}function So(n){switch(n){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}function mc(n){switch(n){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}function wo(n){let t=0;for(let e=0;;e+=7){let r=n.read(1);if(t|=(r.buffer[0]&127)<<e,!(r.buffer[0]&128))return t}}var vw=zn(0);function xo(n,t){if(t===0){n.write(vw);return}let e=0;for(let i=t;i!==0;i=i>>>7)e++;let r=te.alloc(e);for(let i=0;t!==0;i++)r.buffer[i]=t&127,t=t>>>7,t>0&&(r.buffer[i]|=128);n.write(r)}var ga=class{constructor(t){this.buffer=t}pos=0;read(t){let e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=e.byteLength,e}},va=class{buffers=[];get buffer(){return te.concat(this.buffers)}write(t){this.buffers.push(t)}};function zn(n){let t=te.alloc(1);return t.writeUInt8(n,0),t}var Ai={Undefined:zn(0),String:zn(1),Buffer:zn(2),VSBuffer:zn(3),Array:zn(4),Object:zn(5),Uint:zn(6)},yw=typeof Buffer<"u";function Eo(n,t){if(typeof t>"u")n.write(Ai.Undefined);else if(typeof t=="string"){let e=te.fromString(t);n.write(Ai.String),xo(n,e.byteLength),n.write(e)}else if(yw&&Buffer.isBuffer(t)){let e=te.wrap(t);n.write(Ai.Buffer),xo(n,e.byteLength),n.write(e)}else if(t instanceof te)n.write(Ai.VSBuffer),xo(n,t.byteLength),n.write(t);else if(Array.isArray(t)){n.write(Ai.Array),xo(n,t.length);for(let e of t)Eo(n,e)}else if(typeof t=="number"&&(t|0)===t)n.write(Ai.Uint),xo(n,t);else{let e=te.fromString(JSON.stringify(t));n.write(Ai.Object),xo(n,e.byteLength),n.write(e)}}function Po(n){switch(n.read(1).readUInt8(0)){case 0:return;case 1:return n.read(wo(n)).toString();case 2:return n.read(wo(n)).buffer;case 3:return n.read(wo(n));case 4:{let e=wo(n),r=[];for(let i=0;i<e;i++)r.push(Po(n));return r}case 5:return JSON.parse(n.read(wo(n)).toString());case 6:return wo(n)}}var ya=class{constructor(t,e,r=null,i=1e3){this.protocol=t;this.ctx=e;this.logger=r;this.timeoutDelay=i;this.protocolListener=this.protocol.onMessage(o=>this.onRawMessage(o)),this.sendResponse({type:200})}channels=new Map;activeRequests=new Map;protocolListener;pendingRequests=new Map;registerChannel(t,e){this.channels.set(t,e),setTimeout(()=>this.flushPendingRequests(t),0)}sendResponse(t){switch(t.type){case 200:{let e=this.send([t.type]);this.logger?.logOutgoing(e,0,1,mc(t.type));return}case 201:case 202:case 204:case 203:{let e=this.send([t.type,t.id],t.data);this.logger?.logOutgoing(e,t.id,1,mc(t.type),t.data);return}}}send(t,e=void 0){let r=new va;return Eo(r,t),Eo(r,e),this.sendBuffer(r.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onRawMessage(t){let e=new ga(t),r=Po(e),i=Po(e),o=r[0];switch(o){case 100:return this.logger?.logIncoming(t.byteLength,r[1],1,`${So(o)}: ${r[2]}.${r[3]}`,i),this.onPromise({type:o,id:r[1],channelName:r[2],name:r[3],arg:i});case 102:return this.logger?.logIncoming(t.byteLength,r[1],1,`${So(o)}: ${r[2]}.${r[3]}`,i),this.onEventListen({type:o,id:r[1],channelName:r[2],name:r[3],arg:i});case 101:return this.logger?.logIncoming(t.byteLength,r[1],1,`${So(o)}`),this.disposeActiveRequest({type:o,id:r[1]});case 103:return this.logger?.logIncoming(t.byteLength,r[1],1,`${So(o)}`),this.disposeActiveRequest({type:o,id:r[1]})}}onPromise(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let r=new mt,i;try{i=e.call(this.ctx,t.name,t.arg,r.token)}catch(a){i=Promise.reject(a)}let o=t.id;i.then(a=>{this.sendResponse({id:o,data:a,type:201})},a=>{a instanceof Error?this.sendResponse({id:o,data:{message:a.message,name:a.name,stack:a.stack?a.stack.split(`
`):void 0},type:202}):this.sendResponse({id:o,data:a,type:203})}).finally(()=>{s.dispose(),this.activeRequests.delete(t.id)});let s=Z(()=>r.cancel());this.activeRequests.set(t.id,s)}onEventListen(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let r=t.id,o=e.listen(this.ctx,t.name,t.arg)(s=>this.sendResponse({id:r,data:s,type:204}));this.activeRequests.set(t.id,o)}disposeActiveRequest(t){let e=this.activeRequests.get(t.id);e&&(e.dispose(),this.activeRequests.delete(t.id))}collectPendingRequest(t){let e=this.pendingRequests.get(t.channelName);e||(e=[],this.pendingRequests.set(t.channelName,e));let r=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.sendResponse({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);e.push({request:t,timeoutTimer:r})}flushPendingRequests(t){let e=this.pendingRequests.get(t);if(e){for(let r of e)switch(clearTimeout(r.timeoutTimer),r.request.type){case 100:this.onPromise(r.request);break;case 102:this.onEventListen(r.request);break}this.pendingRequests.delete(t)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),ft(this.activeRequests.values()),this.activeRequests.clear()}};var Mi=class{constructor(t,e=null){this.protocol=t;this.protocolListener=this.protocol.onMessage(r=>this.onBuffer(r)),this.logger=e}isDisposed=!1;state=0;activeRequests=new Set;handlers=new Map;lastRequestId=0;protocolListener;logger;_onDidInitialize=new S;onDidInitialize=this._onDidInitialize.event;getChannel(t){let e=this;return{call(r,i,o){return e.isDisposed?Promise.reject(new rt):e.requestPromise(t,r,i,o)},listen(r,i){return e.isDisposed?E.None:e.requestEvent(t,r,i)}}}requestPromise(t,e,r,i=Ee.None){let o=this.lastRequestId++,a={id:o,type:100,channelName:t,name:e,arg:r};if(i.isCancellationRequested)return Promise.reject(new rt);let l;return new Promise((d,f)=>{if(i.isCancellationRequested)return f(new rt);let m=()=>{let w=k=>{switch(k.type){case 201:this.handlers.delete(o),d(k.data);break;case 202:{this.handlers.delete(o);let C=new Error(k.data.message);C.stack=Array.isArray(k.data.stack)?k.data.stack.join(`
`):k.data.stack,C.name=k.data.name,f(C);break}case 203:this.handlers.delete(o),f(k.data);break}};this.handlers.set(o,w),this.sendRequest(a)},g=null;this.state===1?m():(g=Hn(w=>this.whenInitialized()),g.then(()=>{g=null,m()}));let b=()=>{g?(g.cancel(),g=null):this.sendRequest({id:o,type:101}),f(new rt)},v=i.onCancellationRequested(b);l=Nl(Z(b),v),this.activeRequests.add(l)}).finally(()=>{l.dispose(),this.activeRequests.delete(l)})}requestEvent(t,e,r){let i=this.lastRequestId++,s={id:i,type:102,channelName:t,name:e,arg:r},a=null,l=new S({onWillAddFirstListener:()=>{a=Hn(d=>this.whenInitialized()),a.then(()=>{a=null,this.activeRequests.add(l),this.sendRequest(s)})},onDidRemoveLastListener:()=>{a?(a.cancel(),a=null):(this.activeRequests.delete(l),this.sendRequest({id:i,type:103}))}}),c=d=>l.fire(d.data);return this.handlers.set(i,c),l.event}sendRequest(t){switch(t.type){case 100:case 102:{let e=this.send([t.type,t.id,t.channelName,t.name],t.arg);this.logger?.logOutgoing(e,t.id,0,`${So(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{let e=this.send([t.type,t.id]);this.logger?.logOutgoing(e,t.id,0,So(t.type));return}}}send(t,e=void 0){let r=new va;return Eo(r,t),Eo(r,e),this.sendBuffer(r.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onBuffer(t){let e=new ga(t),r=Po(e),i=Po(e),o=r[0];switch(o){case 200:return this.logger?.logIncoming(t.byteLength,0,0,mc(o)),this.onResponse({type:r[0]});case 201:case 202:case 204:case 203:return this.logger?.logIncoming(t.byteLength,r[1],0,mc(o),i),this.onResponse({type:r[0],id:r[1],data:i})}}onResponse(t){if(t.type===200){this.state=1,this._onDidInitialize.fire();return}this.handlers.get(t.id)?.(t)}get onDidInitializePromise(){return E.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===1?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),ft(this.activeRequests.values()),this.activeRequests.clear()}};P([ie],Mi.prototype,"onDidInitializePromise",1);var ba=class{channels=new Map;_connections=new Set;_onDidAddConnection=new S;onDidAddConnection=this._onDidAddConnection.event;_onDidRemoveConnection=new S;onDidRemoveConnection=this._onDidRemoveConnection.event;disposables=new re;get connections(){let t=[];return this._connections.forEach(e=>t.push(e)),t}constructor(t,e,r){this.disposables.add(t(({protocol:i,onDidClientDisconnect:o})=>{let s=E.once(i.onMessage);this.disposables.add(s(a=>{let l=new ga(a),c=Po(l),d=new ya(i,c,e,r),f=new Mi(i,e);this.channels.forEach((g,b)=>d.registerChannel(b,g));let m={channelServer:d,channelClient:f,ctx:c};this._connections.add(m),this._onDidAddConnection.fire(m),this.disposables.add(o(()=>{d.dispose(),f.dispose(),this._connections.delete(m),this._onDidRemoveConnection.fire(m)}))}))}))}getChannel(t,e){let r=this;return{call(i,o,s){let a;if(ic(e)){let c=Zm(r.connections.filter(e));a=c?Promise.resolve(c):E.toPromise(E.filter(r.onDidAddConnection,e))}else a=e.routeCall(r,i,o);let l=a.then(c=>c.channelClient.getChannel(t));return wa(l).call(i,o,s)},listen(i,o){if(ic(e))return r.getMulticastEvent(t,e,i,o);let s=e.routeEvent(r,i,o).then(a=>a.channelClient.getChannel(t));return wa(s).listen(i,o)}}}getMulticastEvent(t,e,r,i){let o=this,s,a=new S({onWillAddFirstListener:()=>{s=new re;let l=new Yl,c=new Map,d=m=>{let b=m.channelClient.getChannel(t).listen(r,i),v=l.add(b);c.set(m,v)},f=m=>{let g=c.get(m);g&&(g.dispose(),c.delete(m))};o.connections.filter(e).forEach(d),E.filter(o.onDidAddConnection,e)(d,void 0,s),o.onDidRemoveConnection(f,void 0,s),l.event(a.fire,a,s),s.add(l)},onDidRemoveLastListener:()=>{s?.dispose(),s=void 0}});return a.event}registerChannel(t,e){this.channels.set(t,e);for(let r of this._connections)r.channelServer.registerChannel(t,e)}dispose(){this.disposables.dispose();for(let t of this._connections)t.channelClient.dispose(),t.channelServer.dispose();this._connections.clear(),this.channels.clear(),this._onDidAddConnection.dispose(),this._onDidRemoveConnection.dispose()}},Ia=class{channelClient;channelServer;constructor(t,e,r=null){let i=new va;Eo(i,e),t.send(i.buffer),this.channelClient=new Mi(t,r),this.channelServer=new ya(t,e,r)}getChannel(t){return this.channelClient.getChannel(t)}registerChannel(t,e){this.channelServer.registerChannel(t,e)}dispose(){this.channelClient.dispose(),this.channelServer.dispose()}};function wa(n){return{call(t,e,r){return n.then(i=>i.call(t,e,r))},listen(t,e){let r=new ia;return n.then(i=>r.input=i.listen(t,e)),r.event}}}function Lg(n){let t=!1;return{call(e,r,i){return t?n.call(e,r,i):$e(0).then(()=>t=!0).then(()=>n.call(e,r,i))},listen(e,r){if(t)return n.listen(e,r);let i=new ia;return $e(0).then(()=>t=!0).then(()=>i.input=n.listen(e,r)),i.event}}}var hc=class{constructor(t){this.fn=t}routeCall(t){return this.route(t)}routeEvent(t){return this.route(t)}async route(t){for(let e of t.connections)if(await Promise.resolve(this.fn(e.ctx)))return Promise.resolve(e);return await E.toPromise(t.onDidAddConnection),await this.route(t)}},je;(i=>{function n(o,s,a){let l=o,c=a&&a.disableMarshalling,d=new Map;for(let f in l)e(f)&&d.set(f,E.buffer(l[f],!0,void 0,s));return new class{listen(f,m,g){let b=d.get(m);if(b)return b;let v=l[m];if(typeof v=="function"){if(r(m))return v.call(l,g);if(e(m))return d.set(m,E.buffer(l[m],!0,void 0,s)),d.get(m)}throw new On(`Event not found: ${m}`)}call(f,m,g){let b=l[m];if(typeof b=="function"){if(!c&&Array.isArray(g))for(let w=0;w<g.length;w++)g[w]=Ar(g[w]);let v=b.apply(l,g);return v instanceof Promise||(v=Promise.resolve(v)),v}throw new On(`Method not found: ${m}`)}}}i.fromService=n;function t(o,s){let a=s&&s.disableMarshalling;return new Proxy({},{get(l,c){if(typeof c=="string")return s?.properties?.has(c)?s.properties.get(c):r(c)?function(d){return o.listen(c,d)}:e(c)?o.listen(c):async function(...d){let f;s&&!st(s.context)?f=[s.context,...d]:f=d;let m=await o.call(c,f);return a?m:Ar(m)};throw new On(`Property not found: ${String(c)}`)}})}i.toService=t;function e(o){return o[0]==="o"&&o[1]==="n"&&dp(o.charCodeAt(2))}function r(o){return/^onDynamic/.test(o)&&dp(o.charCodeAt(9))}})(je||={});import"electron";var gc=class{constructor(t,e){this.sender=t;this.onMessage=e}send(t){try{this.sender.send("vscode:message",t.buffer)}catch{}}disconnect(){this.sender.send("vscode:disconnect",null)}};function Og(n,t){let e=E.fromNodeEventEmitter(ke,t,(i,o)=>({event:i,message:o})),r=E.filter(e,({event:i})=>i.sender.id===n);return E.map(r,({message:i})=>i&&te.wrap(i))}var vc=class n extends ba{static Clients=new Map;static getOnDidClientConnect(){let t=E.fromNodeEventEmitter(ke,"vscode:hello",({sender:e})=>e);return E.map(t,e=>{let r=e.id;n.Clients.get(r)?.dispose();let o=new S;n.Clients.set(r,Z(()=>o.fire()));let s=Og(r,"vscode:message"),a=E.any(E.signal(Og(r,"vscode:disconnect")),o.event);return{protocol:new gc(e,s),onDidClientDisconnect:a}})}constructor(){super(n.getOnDidClientConnect())}};import"electron";var Rp=class{constructor(t){this.port=t;t.start()}onMessage=E.fromDOMEventEmitter(this.port,"message",t=>t.data?te.wrap(t.data):te.alloc(0));send(t){this.port.postMessage(t.buffer)}disconnect(){this.port.close()}},yc=class extends Ia{protocol;constructor(t,e){let r=new Rp(t);super(r,e),this.protocol=r}dispose(){this.protocol.disconnect(),super.dispose()}};var To=class extends yc{constructor(t,e){super({addEventListener:(r,i)=>t.addListener(r,i),removeEventListener:(r,i)=>t.removeListener(r,i),postMessage:r=>t.postMessage(r),start:()=>t.start(),close:()=>t.close()},e)}};import{createHash as bw}from"crypto";var Ag;(s=>{s.enableDiagnostics=!1,s.records=[];let e=new WeakMap,r=0;function i(a,l){if(!e.has(a)){let c=String(++r);e.set(a,c)}return e.get(a)}function o(a,l,c,d){}s.traceSocketEvent=o})(Ag||={});var Mg=process.env.XDG_RUNTIME_DIR,Iw={2:107,1:103};function Wg(n,t,e){let i=bw("sha256").update(n).digest("hex").substr(0,8);if(process.platform==="win32")return`\\\\.\\pipe\\${i}-${e}-${t}-sock`;let o=e.substr(0,4),s=t.substr(0,6),a;return process.platform!=="darwin"&&Mg&&!process.env.VSCODE_PORTABLE?a=F(Mg,`vscode-${i}-${o}-${s}.sock`):a=F(n,`${o}-${s}.sock`),ww(a),a}function ww(n){let t=Iw[Ei];typeof t=="number"&&n.length>=t&&console.warn(`WARNING: IPC handle "${n}" is longer than ${t} chars, try a shorter --user-data-dir`)}import{app as KS}from"electron";function er(n){return Ap(n,0)}function Ap(n,t){switch(typeof n){case"object":return n===null?gn(349,t):Array.isArray(n)?Sw(n,t):Ew(n,t);case"string":return Ng(n,t);case"boolean":return xw(n,t);case"number":return gn(n,t);case"undefined":return gn(937,t);default:return gn(617,t)}}function gn(n,t){return(t<<5)-t+n|0}function xw(n,t){return gn(n?433:863,t)}function Ng(n,t){t=gn(149417,t);for(let e=0,r=n.length;e<r;e++)t=gn(n.charCodeAt(e),t);return t}function Sw(n,t){return t=gn(104579,t),n.reduce((e,r)=>Ap(r,e),t)}function Ew(n,t){return t=gn(181387,t),Object.keys(n).sort().reduce((e,r)=>(e=Ng(r,e),Ap(n[r],e)),t)}function Op(n,t,e=32){let r=e-t,i=~((1<<r)-1);return(n<<t|(i&n)>>>r)>>>0}function Fg(n,t=0,e=n.byteLength,r=0){for(let i=0;i<e;i++)n[t+i]=r}function Pw(n,t,e="0"){for(;n.length<t;)n=e+n;return n}function xa(n,t=32){return n instanceof ArrayBuffer?Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join(""):Pw((n>>>0).toString(16),t/4)}var Ug=class n{static _bigBlock32=new DataView(new ArrayBuffer(320));_h0=1732584193;_h1=4023233417;_h2=2562383102;_h3=271733878;_h4=3285377520;_buff;_buffDV;_buffLen;_totalLen;_leftoverHighSurrogate;_finished;constructor(){this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let e=t.length;if(e===0)return;let r=this._buff,i=this._buffLen,o=this._leftoverHighSurrogate,s,a;for(o!==0?(s=o,a=-1,o=0):(s=t.charCodeAt(0),a=0);;){let l=s;if(Xh(s))if(a+1<e){let c=t.charCodeAt(a+1);up(c)?(a++,l=Zh(s,c)):l=65533}else{o=s;break}else up(s)&&(l=65533);if(i=this._push(r,i,l),a++,a<e)s=t.charCodeAt(a);else break}this._buffLen=i,this._leftoverHighSurrogate=o}_push(t,e,r){return r<128?t[e++]=r:r<2048?(t[e++]=192|(r&1984)>>>6,t[e++]=128|(r&63)>>>0):r<65536?(t[e++]=224|(r&61440)>>>12,t[e++]=128|(r&4032)>>>6,t[e++]=128|(r&63)>>>0):(t[e++]=240|(r&1835008)>>>18,t[e++]=128|(r&258048)>>>12,t[e++]=128|(r&4032)>>>6,t[e++]=128|(r&63)>>>0),e>=64&&(this._step(),e-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),e}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),xa(this._h0)+xa(this._h1)+xa(this._h2)+xa(this._h3)+xa(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,Fg(this._buff,this._buffLen),this._buffLen>56&&(this._step(),Fg(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=n._bigBlock32,e=this._buffDV;for(let f=0;f<64;f+=4)t.setUint32(f,e.getUint32(f,!1),!1);for(let f=64;f<320;f+=4)t.setUint32(f,Op(t.getUint32(f-12,!1)^t.getUint32(f-32,!1)^t.getUint32(f-56,!1)^t.getUint32(f-64,!1),1),!1);let r=this._h0,i=this._h1,o=this._h2,s=this._h3,a=this._h4,l,c,d;for(let f=0;f<80;f++)f<20?(l=i&o|~i&s,c=1518500249):f<40?(l=i^o^s,c=1859775393):f<60?(l=i&o|i&s|o&s,c=2400959708):(l=i^o^s,c=3395469782),d=Op(r,5)+l+a+c+t.getUint32(f*4,!1)&4294967295,a=s,s=o,o=Op(i,30),i=r,r=d;this._h0=this._h0+r&4294967295,this._h1=this._h1+i&4294967295,this._h2=this._h2+o&4294967295,this._h3=this._h3+s&4294967295,this._h4=this._h4+a&4294967295}};var _e=class{ctor;staticArguments;supportsDelayedInstantiation;constructor(t,e=[],r=!1){this.ctor=t,this.staticArguments=e,this.supportsDelayedInstantiation=r}};var bc=class{_entries=new Map;constructor(...t){for(let[e,r]of t)this.set(e,r)}set(t,e){let r=this._entries.get(t);return this._entries.set(t,e),r}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}};var qn;(i=>{i.serviceIds=new Map,i.DI_TARGET="$di$target",i.DI_DEPENDENCIES="$di$dependencies";function r(o){return o[i.DI_DEPENDENCIES]||[]}i.getServiceDependencies=r})(qn||={});var tr=R("instantiationService");function Tw(n,t,e){t[qn.DI_TARGET]===t?t[qn.DI_DEPENDENCIES].push({id:n,index:e}):(t[qn.DI_DEPENDENCIES]=[{id:n,index:e}],t[qn.DI_TARGET]=t)}function R(n){if(qn.serviceIds.has(n))return qn.serviceIds.get(n);let t=function(e,r,i){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");Tw(t,e,i)};return t.toString=()=>n,qn.serviceIds.set(n,t),t}var Mp=class{_value="";_pos=0;reset(t){return this._value=t,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(t){let e=t.charCodeAt(0),r=this._value.charCodeAt(this._pos);return e-r}value(){return this._value[this._pos]}},Wp=class{constructor(t=!0){this._caseSensitive=t}_value;_from;_to;reset(t){return this._value=t,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let t=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(t)this._from++;else break;else t=!1;return this}cmp(t){return this._caseSensitive?Zl(t,this._value,0,t.length,this._from,this._to):bo(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}},Ic=class{constructor(t=!0,e=!0){this._splitOnBackslash=t;this._caseSensitive=e}_value;_valueLen;_from;_to;reset(t){this._from=0,this._to=0,this._value=t,this._valueLen=t.length;for(let e=t.length-1;e>=0;e--,this._valueLen--){let r=this._value.charCodeAt(e);if(!(r===47||this._splitOnBackslash&&r===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let t=!0;for(;this._to<this._valueLen;this._to++){let e=this._value.charCodeAt(this._to);if(e===47||this._splitOnBackslash&&e===92)if(t)this._from++;else break;else t=!1}return this}cmp(t){return this._caseSensitive?Zl(t,this._value,0,t.length,this._from,this._to):bo(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}};var Fp=class{constructor(t,e){this._ignorePathCasing=t;this._ignoreQueryAndFragment=e}_pathIterator;_value;_states=[];_stateIdx=0;reset(t){return this._value=t,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new Ic(!1,!this._ignorePathCasing(t)),this._pathIterator.reset(t.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(t)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(t){if(this._states[this._stateIdx]===1)return sa(t,this._value.scheme);if(this._states[this._stateIdx]===2)return sa(t,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(t);if(this._states[this._stateIdx]===4)return oa(t,this._value.query);if(this._states[this._stateIdx]===5)return oa(t,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}},ko=class{height=1;segment;value;key;left;mid;right;isEmpty(){return!this.left&&!this.mid&&!this.right&&!this.value}rotateLeft(){let t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){let t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}};var Co=class n{static forUris(t=()=>!1,e=()=>!1){return new n(new Fp(t,e))}static forPaths(t=!1){return new n(new Ic(void 0,!t))}static forStrings(){return new n(new Mp)}static forConfigKeys(){return new n(new Wp)}_iter;_root;constructor(t){this._iter=t}clear(){this._root=void 0}fill(t,e){if(e){let r=e.slice(0);Ku(r);for(let i of r)this.set(i,t)}else{let r=t.slice(0);Ku(r);for(let i of r)this.set(i[0],i[1])}}set(t,e){let r=this._iter.reset(t),i;this._root||(this._root=new ko,this._root.segment=r.value());let o=[];for(i=this._root;;){let a=r.cmp(i.segment);if(a>0)i.left||(i.left=new ko,i.left.segment=r.value()),o.push([-1,i]),i=i.left;else if(a<0)i.right||(i.right=new ko,i.right.segment=r.value()),o.push([1,i]),i=i.right;else if(r.hasNext())r.next(),i.mid||(i.mid=new ko,i.mid.segment=r.value()),o.push([0,i]),i=i.mid;else break}let s=i.value;i.value=e,i.key=t;for(let a=o.length-1;a>=0;a--){let l=o[a][1];l.updateHeight();let c=l.balanceFactor();if(c<-1||c>1){let d=o[a][0],f=o[a+1][0];if(d===1&&f===1)o[a][1]=l.rotateLeft();else if(d===-1&&f===-1)o[a][1]=l.rotateRight();else if(d===1&&f===-1)l.right=o[a+1][1]=o[a+1][1].rotateRight(),o[a][1]=l.rotateLeft();else if(d===-1&&f===1)l.left=o[a+1][1]=o[a+1][1].rotateLeft(),o[a][1]=l.rotateRight();else throw new Error;if(a>0)switch(o[a-1][0]){case-1:o[a-1][1].left=o[a][1];break;case 1:o[a-1][1].right=o[a][1];break;case 0:o[a-1][1].mid=o[a][1];break}else this._root=o[0][1]}}return s}get(t){return this._getNode(t)?.value}_getNode(t){let e=this._iter.reset(t),r=this._root;for(;r;){let i=e.cmp(r.segment);if(i>0)r=r.left;else if(i<0)r=r.right;else if(e.hasNext())e.next(),r=r.mid;else break}return r}has(t){let e=this._getNode(t);return!(e?.value===void 0&&e?.mid===void 0)}delete(t){return this._delete(t,!1)}deleteSuperstr(t){return this._delete(t,!0)}_delete(t,e){let r=this._iter.reset(t),i=[],o=this._root;for(;o;){let s=r.cmp(o.segment);if(s>0)i.push([-1,o]),o=o.left;else if(s<0)i.push([1,o]),o=o.right;else if(r.hasNext())r.next(),i.push([0,o]),o=o.mid;else break}if(o){if(e?(o.left=void 0,o.mid=void 0,o.right=void 0,o.height=1):(o.key=void 0,o.value=void 0),!o.mid&&!o.value)if(o.left&&o.right){let s=this._min(o.right);if(s.key){let{key:a,value:l,segment:c}=s;this._delete(s.key,!1),o.key=a,o.value=l,o.segment=c}}else{let s=o.left??o.right;if(i.length>0){let[a,l]=i[i.length-1];switch(a){case-1:l.left=s;break;case 0:l.mid=s;break;case 1:l.right=s;break}}else this._root=s}for(let s=i.length-1;s>=0;s--){let a=i[s][1];a.updateHeight();let l=a.balanceFactor();if(l>1?(a.right.balanceFactor()>=0||(a.right=a.right.rotateRight()),i[s][1]=a.rotateLeft()):l<-1&&(a.left.balanceFactor()<=0||(a.left=a.left.rotateLeft()),i[s][1]=a.rotateRight()),s>0)switch(i[s-1][0]){case-1:i[s-1][1].left=i[s][1];break;case 1:i[s-1][1].right=i[s][1];break;case 0:i[s-1][1].mid=i[s][1];break}else this._root=i[0][1]}}}_min(t){for(;t.left;)t=t.left;return t}findSubstr(t){let e=this._iter.reset(t),r=this._root,i;for(;r;){let o=e.cmp(r.segment);if(o>0)r=r.left;else if(o<0)r=r.right;else if(e.hasNext())e.next(),i=r.value||i,r=r.mid;else break}return r&&r.value||i}findSuperstr(t){return this._findSuperstrOrElement(t,!1)}_findSuperstrOrElement(t,e){let r=this._iter.reset(t),i=this._root;for(;i;){let o=r.cmp(i.segment);if(o>0)i=i.left;else if(o<0)i=i.right;else if(r.hasNext())r.next(),i=i.mid;else return i.mid?this._entries(i.mid):e?i.value:void 0}}hasElementOrSubtree(t){return this._findSuperstrOrElement(t,!0)!==void 0}forEach(t){for(let[e,r]of this)t(r,e)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(t){let e=[];return this._dfsEntries(t,e),e[Symbol.iterator]()}_dfsEntries(t,e){t&&(t.left&&this._dfsEntries(t.left,e),t.value&&e.push([t.key,t.value]),t.mid&&this._dfsEntries(t.mid,e),t.right&&this._dfsEntries(t.right,e))}_isBalanced(){let t=e=>{if(!e)return!0;let r=e.balanceFactor();return r<-1||r>1?!1:t(e.left)&&t(e.right)};return t(this._root)}};var zt=R("environmentService"),Jr=zt;var ZR=R("contextService");function Ze(n){let t=n;return typeof t?.id=="string"&&x.isUri(t.uri)}var kw={id:"ext-dev"},Cw={id:"empty-window"};function $n(n,t){if(typeof n=="string"||typeof n>"u")return typeof n=="string"?{id:ve(n)}:t?kw:Cw;let e=n;return e.configuration?{id:e.id,configPath:e.configuration}:e.folders.length===1?{id:e.id,uri:e.folders[0].uri}:{id:e.id}}function Ue(n){let t=n;return typeof t?.id=="string"&&x.isUri(t.configPath)}function Bg(n){let t=n;if(t?.uri)return{id:t.id,uri:x.revive(t.uri)};let e=n;if(e?.configPath)return{id:e.id,configPath:x.revive(e.configPath)};if(n?.id)return{id:n.id}}var wc=class{constructor(t,e){this.raw=e;this.uri=t.uri,this.index=t.index,this.name=t.name}uri;name;index;toResource(t){return ne(this.uri,t)}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}};var Sa="code-workspace",_w=`.${Sa}`,Vg=[{name:p("codeWorkspace","Code Workspace"),extensions:[Sa]}],Np="workspace.json";function Bp(n,t){return Ae.isEqualOrParent(n,t.untitledWorkspacesHome)}function Qr(n){return(typeof n=="string"?Fl(n):fg(n))===_w}var Ie=R("configurationService");function Kg(n){return n.replace(/[\[\]]/g,"")}var d4=R("encryptionService"),Ea=R("encryptionMainService");import{homedir as Mw,tmpdir as Ww}from"os";var Dw=60,Rw=Dw*60,Vp=Rw*24,f4=Vp*7,m4=Vp*30,h4=Vp*365;function Hg(n){return n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0")+"-"+String(n.getDate()).padStart(2,"0")+"T"+String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0")+":"+String(n.getSeconds()).padStart(2,"0")+"."+(n.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var Oe=R("productService");var zg=/^([^.]+\..+)[:=](.+)$/,Pe=class{constructor(t,e,r){this._args=t;this.paths=e;this.productService=r}get appRoot(){return Fe(Me.asFileUri("").fsPath)}get userHome(){return x.file(this.paths.homeDir)}get userDataPath(){return this.paths.userDataDir}get appSettingsHome(){return x.file(F(this.userDataPath,"User"))}get tmpDir(){return x.file(this.paths.tmpDir)}get cacheHome(){return x.file(this.userDataPath)}get stateResource(){return ne(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome.with({scheme:U.vscodeUserData})}get userDataSyncHome(){return ne(this.appSettingsHome,"sync")}get logsHome(){if(!this.args.logsPath){let t=Hg(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=F(this.userDataPath,"logs",t)}return x.file(this.args.logsPath)}get sync(){return this.args.sync}get machineSettingsResource(){return ne(x.file(F(this.userDataPath,"Machine")),"settings.json")}get workspaceStorageHome(){return ne(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return ne(this.appSettingsHome,"History")}get keyboardLayoutResource(){return ne(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){let t=xt.VSCODE_PORTABLE;return t?x.file(F(t,"argv.json")):ne(this.userHome,this.productService.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return x.file(F(this.userDataPath,"Workspaces"))}get builtinExtensionsPath(){let t=this.args["builtin-extensions-dir"];return t?Fn(t):ct(F(Me.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){let t=this.args["extensions-download-dir"];return t?x.file(Fn(t)):x.file(F(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){let t=this.args["extensions-dir"];if(t)return Fn(t);let e=xt.VSCODE_EXTENSIONS;if(e)return e;let r=xt.VSCODE_PORTABLE;return r?F(r,"extensions"):ne(this.userHome,this.productService.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){let t=this.args.extensionDevelopmentPath;if(Array.isArray(t))return t.map(e=>/^[^:/?#]+?:\/\//.test(e)?x.parse(e):x.file(ct(e)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(t=>t==="ui"||t==="workspace"||t==="web"?t:"workspace")}get extensionTestsLocationURI(){let t=this.args.extensionTestsPath;if(t)return/^[^:/?#]+?:\/\//.test(t)?x.parse(t):x.file(ct(t))}get disableExtensions(){if(this.args["disable-extensions"])return!0;let t=this.args["disable-extension"];if(t){if(typeof t=="string")return[t];if(Array.isArray(t)&&t.length>0)return t}return!1}get debugExtensionHost(){return Lw(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!xt.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(t=>!zg.test(t))}get extensionLogLevel(){let t=[];for(let e of this.args.log||[]){let r=zg.exec(e);r&&r[1]&&r[2]&&t.push([r[1],r[2]])}return t.length?t:void 0}get serviceMachineIdResource(){return ne(x.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get useInMemorySecretStorage(){return!!this.args["use-inmemory-secretstorage"]}get policyFile(){if(this.args["__enable-file-policy"]){let t=xt.VSCODE_PORTABLE;return t?x.file(F(t,"policy.json")):ne(this.userHome,this.productService.dataFolderName,"policy.json")}}editSessionId=this.args.editSessionId;get continueOn(){return this.args.continueOn}set continueOn(t){this.args.continueOn=t}get args(){return this._args}};P([ie],Pe.prototype,"appRoot",1),P([ie],Pe.prototype,"userHome",1),P([ie],Pe.prototype,"userDataPath",1),P([ie],Pe.prototype,"appSettingsHome",1),P([ie],Pe.prototype,"tmpDir",1),P([ie],Pe.prototype,"cacheHome",1),P([ie],Pe.prototype,"stateResource",1),P([ie],Pe.prototype,"userRoamingDataHome",1),P([ie],Pe.prototype,"userDataSyncHome",1),P([ie],Pe.prototype,"sync",1),P([ie],Pe.prototype,"machineSettingsResource",1),P([ie],Pe.prototype,"workspaceStorageHome",1),P([ie],Pe.prototype,"localHistoryHome",1),P([ie],Pe.prototype,"keyboardLayoutResource",1),P([ie],Pe.prototype,"argvResource",1),P([ie],Pe.prototype,"isExtensionDevelopment",1),P([ie],Pe.prototype,"untitledWorkspacesHome",1),P([ie],Pe.prototype,"builtinExtensionsPath",1),P([ie],Pe.prototype,"extensionsPath",1),P([ie],Pe.prototype,"extensionDevelopmentLocationURI",1),P([ie],Pe.prototype,"extensionDevelopmentKind",1),P([ie],Pe.prototype,"extensionTestsLocationURI",1),P([ie],Pe.prototype,"debugExtensionHost",1),P([ie],Pe.prototype,"logLevel",1),P([ie],Pe.prototype,"extensionLogLevel",1),P([ie],Pe.prototype,"serviceMachineIdResource",1),P([ie],Pe.prototype,"disableTelemetry",1),P([ie],Pe.prototype,"disableWorkspaceTrust",1),P([ie],Pe.prototype,"useInMemorySecretStorage",1),P([ie],Pe.prototype,"policyFile",1);function Lw(n,t){return xc(n["inspect-extensions"],n["inspect-brk-extensions"],5870,t,n.debugId,n.extensionEnvironment)}function xc(n,t,e,r,i,o){let a=Number(t||n)||(r?null:e),l=a?!!t:!1,c;if(o)try{c=JSON.parse(o)}catch{}return{port:a,break:l,debugId:i,env:c}}import*as Ow from"os";import*as Aw from"path";var Sc={exports:{}};(function(){function t(e,r,i){function o(a,l){let c=s(a,l),d=[c];return e.isAbsolute(c)||d.unshift(i),e.resolve(...d)}function s(a,l){process.env.VSCODE_DEV&&(l="code-oss-dev");let c=process.env.VSCODE_PORTABLE;if(c)return e.join(c,"user-data");let d=process.env.VSCODE_APPDATA;if(d)return e.join(d,l);let f=a["user-data-dir"];if(f)return f;switch(process.platform){case"win32":if(d=process.env.APPDATA,!d){let m=process.env.USERPROFILE;if(typeof m!="string")throw new Error("Windows: Unexpected undefined %USERPROFILE% environment variable");d=e.join(m,"AppData","Roaming")}break;case"darwin":d=e.join(r.homedir(),"Library","Application Support");break;case"linux":d=process.env.XDG_CONFIG_HOME||e.join(r.homedir(),".config");break;default:throw new Error("Platform not supported")}return e.join(d,l)}return{getUserDataPath:o}}if(typeof Sc=="object"&&typeof Sc.exports=="object")Sc.exports=t(Aw,Ow,process.env.VSCODE_CWD||process.cwd());else throw new Error("Unknown context")})();var qg=Sc.exports.getUserDataPath;var Ec=class extends Pe{constructor(t,e){super(t,{homeDir:Mw(),tmpDir:Ww(),userDataDir:qg(t,e.nameShort)},e)}};function $g(n,t){return xc(n["inspect-ptyhost"],n["inspect-brk-ptyhost"],5877,t,n.extensionEnvironment)}function jg(n,t){return xc(n["inspect-sharedprocess"],n["inspect-brk-sharedprocess"],5879,t,n.extensionEnvironment)}var ge=zt,vn=class extends Ec{_snapEnv={};get backupHome(){return F(this.userDataPath,"Backups")}get mainIPCHandle(){return Wg(this.userDataPath,"main",this.productService.version)}get mainLockfile(){return F(this.userDataPath,"code.lock")}get disableUpdates(){return!!this.args["disable-updates"]}get crossOriginIsolated(){return!!this.args["enable-coi"]}get codeCachePath(){return process.env.VSCODE_CODE_CACHE_PATH||void 0}get useCodeCache(){return!!this.codeCachePath}unsetSnapExportedVariables(){if(j){for(let t in process.env)if(t.endsWith("_VSCODE_SNAP_ORIG")){let e=t.slice(0,-17);if(this._snapEnv[e])continue;process.env[e]&&(this._snapEnv[e]=process.env[e]),process.env[t]?process.env[e]=process.env[t]:delete process.env[e]}}}restoreSnapExportedVariables(){if(j)for(let t in this._snapEnv)process.env[t]=this._snapEnv[t],delete this._snapEnv[t]}};P([ie],vn.prototype,"backupHome",1),P([ie],vn.prototype,"mainIPCHandle",1),P([ie],vn.prototype,"mainLockfile",1),P([ie],vn.prototype,"disableUpdates",1),P([ie],vn.prototype,"crossOriginIsolated",1),P([ie],vn.prototype,"codeCachePath",1),P([ie],vn.prototype,"useCodeCache",1);function Kp(...n){switch(n.length){case 1:return p("contextkey.scanner.hint.didYouMean1","Did you mean {0}?",n[0]);case 2:return p("contextkey.scanner.hint.didYouMean2","Did you mean {0} or {1}?",n[0],n[1]);case 3:return p("contextkey.scanner.hint.didYouMean3","Did you mean {0}, {1} or {2}?",n[0],n[1],n[2]);default:return}}var Fw=p("contextkey.scanner.hint.didYouForgetToOpenOrCloseQuote","Did you forget to open or close the quote?"),Uw=p("contextkey.scanner.hint.didYouForgetToEscapeSlash","Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\/'."),jn=class n{static getLexeme(t){switch(t.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return t.isTripleEq?"===":"==";case 4:return t.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return t.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return t.lexeme;case 18:return t.lexeme;case 19:return t.lexeme;case 20:return"EOF";default:throw Gm(`unhandled token type: ${JSON.stringify(t)}; have you forgotten to add a case?`)}}static _regexFlags=new Set(["i","g","s","m","y","u"].map(t=>t.charCodeAt(0)));static _keywords=new Map([["not",14],["in",13],["false",12],["true",11]]);_input="";_start=0;_current=0;_tokens=[];_errors=[];get errors(){return this._errors}reset(t){return this._input=t,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){let e=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:e})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){let e=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:e})}else this._match(126)?this._addToken(9):this._error(Kp("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(Kp("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(Kp("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(t){return this._isAtEnd()||this._input.charCodeAt(this._current)!==t?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(t){this._tokens.push({type:t,offset:this._start})}_error(t){let e=this._start,r=this._input.substring(this._start,this._current),i={type:19,offset:this._start,lexeme:r};this._errors.push({offset:e,lexeme:r,additionalInfo:t}),this._tokens.push(i)}stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy;_string(){this.stringRe.lastIndex=this._start;let t=this.stringRe.exec(this._input);if(t){this._current=this._start+t[0].length;let e=this._input.substring(this._start,this._current),r=n._keywords.get(e);r?this._addToken(r):this._tokens.push({type:17,lexeme:e,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(Fw);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let t=this._current,e=!1,r=!1;for(;;){if(t>=this._input.length){this._current=t,this._error(Uw);return}let o=this._input.charCodeAt(t);if(e)e=!1;else if(o===47&&!r){t++;break}else o===91?r=!0:o===92?e=!0:o===93&&(r=!1);t++}for(;t<this._input.length&&n._regexFlags.has(this._input.charCodeAt(t));)t++;this._current=t;let i=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:i,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}};var It=new Map;It.set("false",!1);It.set("true",!0);It.set("isMac",A);It.set("isLinux",j);It.set("isWindows",N);It.set("isWeb",kr);It.set("isMacNative",A&&!kr);It.set("isEdge",hh);It.set("isFirefox",fh);It.set("isChrome",qu);It.set("isSafari",mh);var Nw=Object.prototype.hasOwnProperty;var Bw={regexParsingWithErrorRecovery:!0},Vw=p("contextkey.parser.error.emptyString","Empty context key expression"),Kw=p("contextkey.parser.error.emptyString.hint","Did you forget to write an expression? You can also put 'false' or 'true' to always evaluate to false or true, respectively."),Hw=p("contextkey.parser.error.noInAfterNot","'in' after 'not'."),Gg=p("contextkey.parser.error.closingParenthesis","closing parenthesis ')'"),zw=p("contextkey.parser.error.unexpectedToken","Unexpected token"),qw=p("contextkey.parser.error.unexpectedToken.hint","Did you forget to put && or || before the token?"),$w=p("contextkey.parser.error.unexpectedEOF","Unexpected end of expression"),jw=p("contextkey.parser.error.unexpectedEOF.hint","Did you forget to put a context key?"),Hp=class n{constructor(t=Bw){this._config=t}static _parseError=new Error;_scanner=new jn;_tokens=[];_current=0;_parsingErrors=[];get lexingErrors(){return this._scanner.errors}get parsingErrors(){return this._parsingErrors}parse(t){if(t===""){this._parsingErrors.push({message:Vw,offset:0,lexeme:"",additionalInfo:Kw});return}this._tokens=this._scanner.reset(t).scan(),this._current=0,this._parsingErrors=[];try{let e=this._expr();if(!this._isAtEnd()){let r=this._peek(),i=r.type===17?qw:void 0;throw this._parsingErrors.push({message:zw,offset:r.offset,lexeme:jn.getLexeme(r),additionalInfo:i}),n._parseError}return e}catch(e){if(e!==n._parseError)throw e;return}}_expr(){return this._or()}_or(){let t=[this._and()];for(;this._matchOne(16);){let e=this._and();t.push(e)}return t.length===1?t[0]:Pt.or(...t)}_and(){let t=[this._term()];for(;this._matchOne(15);){let e=this._term();t.push(e)}return t.length===1?t[0]:Pt.and(...t)}_term(){if(this._matchOne(2)){let t=this._peek();switch(t.type){case 11:return this._advance(),At.INSTANCE;case 12:return this._advance(),Ut.INSTANCE;case 0:{this._advance();let e=this._expr();return this._consume(1,Gg),e?.negate()}case 17:return this._advance(),Fi.create(t.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",t)}}return this._primary()}_primary(){let t=this._peek();switch(t.type){case 11:return this._advance(),Pt.true();case 12:return this._advance(),Pt.false();case 0:{this._advance();let e=this._expr();return this._consume(1,Gg),e}case 17:{let e=t.lexeme;if(this._advance(),this._matchOne(9)){let i=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),i.type!==10)throw this._errExpectedButGot("REGEX",i);let o=i.lexeme,s=o.lastIndexOf("/"),a=s===o.length-1?void 0:this._removeFlagsGY(o.substring(s+1)),l;try{l=new RegExp(o.substring(1,s),a)}catch{throw this._errExpectedButGot("REGEX",i)}return La.create(e,l)}switch(i.type){case 10:case 19:{let o=[i.lexeme];this._advance();let s=this._peek(),a=0;for(let m=0;m<i.lexeme.length;m++)i.lexeme.charCodeAt(m)===40?a++:i.lexeme.charCodeAt(m)===41&&a--;for(;!this._isAtEnd()&&s.type!==15&&s.type!==16;){switch(s.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let m=0;m<s.lexeme.length;m++)s.lexeme.charCodeAt(m)===40?a++:i.lexeme.charCodeAt(m)===41&&a--}if(a<0)break;o.push(jn.getLexeme(s)),this._advance(),s=this._peek()}let l=o.join(""),c=l.lastIndexOf("/"),d=c===l.length-1?void 0:this._removeFlagsGY(l.substring(c+1)),f;try{f=new RegExp(l.substring(1,c),d)}catch{throw this._errExpectedButGot("REGEX",i)}return Pt.regex(e,f)}case 18:{let o=i.lexeme;this._advance();let s=null;if(!Yh(o)){let a=o.indexOf("/"),l=o.lastIndexOf("/");if(a!==l&&a>=0){let c=o.slice(a+1,l),d=o[l+1]==="i"?"i":"";try{s=new RegExp(c,d)}catch{throw this._errExpectedButGot("REGEX",i)}}}if(s===null)throw this._errExpectedButGot("REGEX",i);return La.create(e,s)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,Hw);let i=this._value();return Pt.notIn(e,i)}switch(this._peek().type){case 3:{this._advance();let i=this._value();if(this._previous().type===18)return Pt.equals(e,i);switch(i){case"true":return Pt.has(e);case"false":return Pt.not(e);default:return Pt.equals(e,i)}}case 4:{this._advance();let i=this._value();if(this._previous().type===18)return Pt.notEquals(e,i);switch(i){case"true":return Pt.not(e);case"false":return Pt.has(e);default:return Pt.notEquals(e,i)}}case 5:return this._advance(),Da.create(e,this._value());case 6:return this._advance(),Ra.create(e,this._value());case 7:return this._advance(),Ca.create(e,this._value());case 8:return this._advance(),_a.create(e,this._value());case 13:return this._advance(),Pt.in(e,this._value());default:return Pt.has(e)}}case 20:throw this._parsingErrors.push({message:$w,offset:t.offset,lexeme:"",additionalInfo:jw}),n._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){let t=this._peek();switch(t.type){case 17:case 18:return this._advance(),t.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_flagsGYRe=/g|y/g;_removeFlagsGY(t){return t.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(t){return this._check(t)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(t,e){if(this._check(t))return this._advance();throw this._errExpectedButGot(e,this._peek())}_errExpectedButGot(t,e,r){let i=p("contextkey.parser.error.expectedButGot",`Expected: {0}
Received: '{1}'.`,t,jn.getLexeme(e)),o=e.offset,s=jn.getLexeme(e);return this._parsingErrors.push({message:i,offset:o,lexeme:s,additionalInfo:r}),n._parseError}_check(t){return this._peek().type===t}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}},Pt=class{static false(){return At.INSTANCE}static true(){return Ut.INSTANCE}static has(t){return Wi.create(t)}static equals(t,e){return Ta.create(t,e)}static notEquals(t,e){return ka.create(t,e)}static regex(t,e){return La.create(t,e)}static in(t,e){return Pc.create(t,e)}static notIn(t,e){return Tc.create(t,e)}static not(t){return Fi.create(t)}static and(...t){return kc.create(t,null,!0)}static or(...t){return Oa.create(t,null,!0)}static greater(t,e){return Ca.create(t,e)}static greaterEquals(t,e){return _a.create(t,e)}static smaller(t,e){return Da.create(t,e)}static smallerEquals(t,e){return Ra.create(t,e)}static _parser=new Hp({regexParsingWithErrorRecovery:!1});static deserialize(t){return t==null?void 0:this._parser.parse(t)}};function Pa(n,t){return n.cmp(t)}var At=class n{static INSTANCE=new n;type=0;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!1}serialize(){return"false"}keys(){return[]}map(t){return this}negate(){return Ut.INSTANCE}},Ut=class n{static INSTANCE=new n;type=1;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!0}serialize(){return"true"}keys(){return[]}map(t){return this}negate(){return At.INSTANCE}},Wi=class n{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let r=It.get(t);return typeof r=="boolean"?r?Ut.INSTANCE:At.INSTANCE:new n(t,e)}type=2;cmp(t){return t.type!==this.type?this.type-t.type:Xg(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=It.get(this.key);return typeof t=="boolean"?t?Ut.INSTANCE:At.INSTANCE:this}evaluate(t){return!!t.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(t){return t.mapDefined(this.key)}negate(){return this.negated||(this.negated=Fi.create(this.key,this)),this.negated}},Ta=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){if(typeof e=="boolean")return e?Wi.create(t,r):Fi.create(t,r);let i=It.get(t);return typeof i=="boolean"?e===(i?"true":"false")?Ut.INSTANCE:At.INSTANCE:new n(t,e,r)}type=4;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=It.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?Ut.INSTANCE:At.INSTANCE}return this}evaluate(t){return t.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}map(t){return t.mapEquals(this.key,this.value)}negate(){return this.negated||(this.negated=ka.create(this.key,this.value,this)),this.negated}},Pc=class n{constructor(t,e){this.key=t;this.valueKey=e}static create(t,e){return new n(t,e)}type=10;negated=null;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.valueKey,t.key,t.valueKey)}equals(t){return t.type===this.type?this.key===t.key&&this.valueKey===t.valueKey:!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.valueKey),r=t.getValue(this.key);return Array.isArray(e)?e.includes(r):typeof r=="string"&&typeof e=="object"&&e!==null?Nw.call(e,r):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}map(t){return t.mapIn(this.key,this.valueKey)}negate(){return this.negated||(this.negated=Tc.create(this.key,this.valueKey)),this.negated}},Tc=class n{constructor(t,e){this.key=t;this.valueKey=e;this._negated=Pc.create(t,e)}static create(t,e){return new n(t,e)}type=11;_negated;cmp(t){return t.type!==this.type?this.type-t.type:this._negated.cmp(t._negated)}equals(t){return t.type===this.type?this._negated.equals(t._negated):!1}substituteConstants(){return this}evaluate(t){return!this._negated.evaluate(t)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}map(t){return t.mapNotIn(this.key,this.valueKey)}negate(){return this._negated}},ka=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){if(typeof e=="boolean")return e?Fi.create(t,r):Wi.create(t,r);let i=It.get(t);return typeof i=="boolean"?e===(i?"true":"false")?At.INSTANCE:Ut.INSTANCE:new n(t,e,r)}type=5;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=It.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?At.INSTANCE:Ut.INSTANCE}return this}evaluate(t){return t.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}map(t){return t.mapNotEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Ta.create(this.key,this.value,this)),this.negated}},Fi=class n{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let r=It.get(t);return typeof r=="boolean"?r?At.INSTANCE:Ut.INSTANCE:new n(t,e)}type=3;cmp(t){return t.type!==this.type?this.type-t.type:Xg(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=It.get(this.key);return typeof t=="boolean"?t?At.INSTANCE:Ut.INSTANCE:this}evaluate(t){return!t.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}map(t){return t.mapNot(this.key)}negate(){return this.negated||(this.negated=Wi.create(this.key,this)),this.negated}};function Cc(n,t){if(typeof n=="string"){let e=parseFloat(n);isNaN(e)||(n=e)}return typeof n=="string"||typeof n=="number"?t(n):At.INSTANCE}var Ca=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Cc(e,i=>new n(t,i,r))}type=12;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreater(this.key,this.value)}negate(){return this.negated||(this.negated=Ra.create(this.key,this.value,this)),this.negated}},_a=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Cc(e,i=>new n(t,i,r))}type=13;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreaterEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Da.create(this.key,this.value,this)),this.negated}},Da=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Cc(e,i=>new n(t,i,r))}type=14;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmaller(this.key,this.value)}negate(){return this.negated||(this.negated=_a.create(this.key,this.value,this)),this.negated}},Ra=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Cc(e,i=>new n(t,i,r))}type=15;cmp(t){return t.type!==this.type?this.type-t.type:Ui(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmallerEquals(this.key,this.value)}negate(){return this.negated||(this.negated=Ca.create(this.key,this.value,this)),this.negated}},La=class n{constructor(t,e){this.key=t;this.regexp=e}static create(t,e){return new n(t,e)}type=7;negated=null;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.key<t.key)return-1;if(this.key>t.key)return 1;let e=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return e<r?-1:e>r?1:0}equals(t){if(t.type===this.type){let e=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return this.key===t.key&&e===r}return!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.key);return this.regexp?this.regexp.test(e):!1}serialize(){let t=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${t}`}keys(){return[this.key]}map(t){return t.mapRegex(this.key,this.regexp)}negate(){return this.negated||(this.negated=zp.create(this)),this.negated}},zp=class n{constructor(t){this._actual=t}static create(t){return new n(t)}type=8;cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}map(t){return new n(this._actual.map(t))}negate(){return this._actual}};function Yg(n){let t=null;for(let e=0,r=n.length;e<r;e++){let i=n[e].substituteConstants();if(n[e]!==i&&t===null){t=[];for(let o=0;o<e;o++)t[o]=n[o]}t!==null&&(t[e]=i)}return t===null?n:t}var kc=class n{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,r){return n._normalizeArr(t,e,r)}type=6;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,r=this.expr.length;e<r;e++){let i=Pa(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=Yg(this.expr);return t===this.expr?this:n.create(t,this.negated,!1)}evaluate(t){for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].evaluate(t))return!1;return!0}static _normalizeArr(t,e,r){let i=[],o=!1;for(let s of t)if(s){if(s.type===1){o=!0;continue}if(s.type===0)return At.INSTANCE;if(s.type===6){i.push(...s.expr);continue}i.push(s)}if(i.length===0&&o)return Ut.INSTANCE;if(i.length!==0){if(i.length===1)return i[0];i.sort(Pa);for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];for(;i.length>1;){let s=i[i.length-1];if(s.type!==9)break;i.pop();let a=i.pop(),l=i.length===0,c=Oa.create(s.expr.map(d=>n.create([d,a],null,r)),null,l);c&&(i.push(c),i.sort(Pa))}if(i.length===1)return i[0];if(r){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return At.INSTANCE;if(i.length===1)return i[0]}return new n(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" && ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new n(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());this.negated=Oa.create(t,this,!0)}return this.negated}},Oa=class n{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,r){return n._normalizeArr(t,e,r)}type=9;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,r=this.expr.length;e<r;e++){let i=Pa(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=Yg(this.expr);return t===this.expr?this:n.create(t,this.negated,!1)}evaluate(t){for(let e=0,r=this.expr.length;e<r;e++)if(this.expr[e].evaluate(t))return!0;return!1}static _normalizeArr(t,e,r){let i=[],o=!1;if(t){for(let s=0,a=t.length;s<a;s++){let l=t[s];if(l){if(l.type===0){o=!0;continue}if(l.type===1)return Ut.INSTANCE;if(l.type===9){i=i.concat(l.expr);continue}i.push(l)}}if(i.length===0&&o)return At.INSTANCE;i.sort(Pa)}if(i.length!==0){if(i.length===1)return i[0];for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];if(r){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return Ut.INSTANCE;if(i.length===1)return i[0]}return new n(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" || ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new n(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());for(;t.length>1;){let e=t.shift(),r=t.shift(),i=[];for(let o of Jg(e))for(let s of Jg(r))i.push(kc.create([o,s],null,!1));t.unshift(n.create(i,null,!1))}this.negated=n.create(t,this,!0)}return this.negated}},_o=class n extends Wi{static _info=[];static all(){return n._info.values()}_defaultValue;constructor(t,e,r){super(t,null),this._defaultValue=e,typeof r=="object"?n._info.push({...r,key:t}):r!==!0&&n._info.push({key:t,description:r,type:e!=null?typeof e:void 0})}bindTo(t){return t.createKey(this.key,this._defaultValue)}getValue(t){return t.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(t){return Ta.create(this.key,t)}notEqualsTo(t){return ka.create(this.key,t)}},S5=R("contextKeyService");function Xg(n,t){return n<t?-1:n>t?1:0}function Ui(n,t,e,r){return n<e?-1:n>e?1:t<r?-1:t>r?1:0}function Jg(n){return n.type===9?n.expr:[n]}var qp=Object.create(null);function u(n,t){if(Ce(t)){let e=qp[t];if(e===void 0)throw new Error(`${n} references an unknown codicon: ${t}`);t=e}return qp[n]=t,{id:n}}function Zg(){return qp}var ev={add:u("add",6e4),plus:u("plus",6e4),gistNew:u("gist-new",6e4),repoCreate:u("repo-create",6e4),lightbulb:u("lightbulb",60001),lightBulb:u("light-bulb",60001),repo:u("repo",60002),repoDelete:u("repo-delete",60002),gistFork:u("gist-fork",60003),repoForked:u("repo-forked",60003),gitPullRequest:u("git-pull-request",60004),gitPullRequestAbandoned:u("git-pull-request-abandoned",60004),recordKeys:u("record-keys",60005),keyboard:u("keyboard",60005),tag:u("tag",60006),gitPullRequestLabel:u("git-pull-request-label",60006),tagAdd:u("tag-add",60006),tagRemove:u("tag-remove",60006),person:u("person",60007),personFollow:u("person-follow",60007),personOutline:u("person-outline",60007),personFilled:u("person-filled",60007),gitBranch:u("git-branch",60008),gitBranchCreate:u("git-branch-create",60008),gitBranchDelete:u("git-branch-delete",60008),sourceControl:u("source-control",60008),mirror:u("mirror",60009),mirrorPublic:u("mirror-public",60009),star:u("star",60010),starAdd:u("star-add",60010),starDelete:u("star-delete",60010),starEmpty:u("star-empty",60010),comment:u("comment",60011),commentAdd:u("comment-add",60011),alert:u("alert",60012),warning:u("warning",60012),search:u("search",60013),searchSave:u("search-save",60013),logOut:u("log-out",60014),signOut:u("sign-out",60014),logIn:u("log-in",60015),signIn:u("sign-in",60015),eye:u("eye",60016),eyeUnwatch:u("eye-unwatch",60016),eyeWatch:u("eye-watch",60016),circleFilled:u("circle-filled",60017),primitiveDot:u("primitive-dot",60017),closeDirty:u("close-dirty",60017),debugBreakpoint:u("debug-breakpoint",60017),debugBreakpointDisabled:u("debug-breakpoint-disabled",60017),debugHint:u("debug-hint",60017),terminalDecorationSuccess:u("terminal-decoration-success",60017),primitiveSquare:u("primitive-square",60018),edit:u("edit",60019),pencil:u("pencil",60019),info:u("info",60020),issueOpened:u("issue-opened",60020),gistPrivate:u("gist-private",60021),gitForkPrivate:u("git-fork-private",60021),lock:u("lock",60021),mirrorPrivate:u("mirror-private",60021),close:u("close",60022),removeClose:u("remove-close",60022),x:u("x",60022),repoSync:u("repo-sync",60023),sync:u("sync",60023),clone:u("clone",60024),desktopDownload:u("desktop-download",60024),beaker:u("beaker",60025),microscope:u("microscope",60025),vm:u("vm",60026),deviceDesktop:u("device-desktop",60026),file:u("file",60027),fileText:u("file-text",60027),more:u("more",60028),ellipsis:u("ellipsis",60028),kebabHorizontal:u("kebab-horizontal",60028),mailReply:u("mail-reply",60029),reply:u("reply",60029),organization:u("organization",60030),organizationFilled:u("organization-filled",60030),organizationOutline:u("organization-outline",60030),newFile:u("new-file",60031),fileAdd:u("file-add",60031),newFolder:u("new-folder",60032),fileDirectoryCreate:u("file-directory-create",60032),trash:u("trash",60033),trashcan:u("trashcan",60033),history:u("history",60034),clock:u("clock",60034),folder:u("folder",60035),fileDirectory:u("file-directory",60035),symbolFolder:u("symbol-folder",60035),logoGithub:u("logo-github",60036),markGithub:u("mark-github",60036),github:u("github",60036),terminal:u("terminal",60037),console:u("console",60037),repl:u("repl",60037),zap:u("zap",60038),symbolEvent:u("symbol-event",60038),error:u("error",60039),stop:u("stop",60039),variable:u("variable",60040),symbolVariable:u("symbol-variable",60040),array:u("array",60042),symbolArray:u("symbol-array",60042),symbolModule:u("symbol-module",60043),symbolPackage:u("symbol-package",60043),symbolNamespace:u("symbol-namespace",60043),symbolObject:u("symbol-object",60043),symbolMethod:u("symbol-method",60044),symbolFunction:u("symbol-function",60044),symbolConstructor:u("symbol-constructor",60044),symbolBoolean:u("symbol-boolean",60047),symbolNull:u("symbol-null",60047),symbolNumeric:u("symbol-numeric",60048),symbolNumber:u("symbol-number",60048),symbolStructure:u("symbol-structure",60049),symbolStruct:u("symbol-struct",60049),symbolParameter:u("symbol-parameter",60050),symbolTypeParameter:u("symbol-type-parameter",60050),symbolKey:u("symbol-key",60051),symbolText:u("symbol-text",60051),symbolReference:u("symbol-reference",60052),goToFile:u("go-to-file",60052),symbolEnum:u("symbol-enum",60053),symbolValue:u("symbol-value",60053),symbolRuler:u("symbol-ruler",60054),symbolUnit:u("symbol-unit",60054),activateBreakpoints:u("activate-breakpoints",60055),archive:u("archive",60056),arrowBoth:u("arrow-both",60057),arrowDown:u("arrow-down",60058),arrowLeft:u("arrow-left",60059),arrowRight:u("arrow-right",60060),arrowSmallDown:u("arrow-small-down",60061),arrowSmallLeft:u("arrow-small-left",60062),arrowSmallRight:u("arrow-small-right",60063),arrowSmallUp:u("arrow-small-up",60064),arrowUp:u("arrow-up",60065),bell:u("bell",60066),bold:u("bold",60067),book:u("book",60068),bookmark:u("bookmark",60069),debugBreakpointConditionalUnverified:u("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:u("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:u("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:u("debug-breakpoint-data-unverified",60072),debugBreakpointData:u("debug-breakpoint-data",60073),debugBreakpointDataDisabled:u("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:u("debug-breakpoint-log-unverified",60074),debugBreakpointLog:u("debug-breakpoint-log",60075),debugBreakpointLogDisabled:u("debug-breakpoint-log-disabled",60075),briefcase:u("briefcase",60076),broadcast:u("broadcast",60077),browser:u("browser",60078),bug:u("bug",60079),calendar:u("calendar",60080),caseSensitive:u("case-sensitive",60081),check:u("check",60082),checklist:u("checklist",60083),chevronDown:u("chevron-down",60084),chevronLeft:u("chevron-left",60085),chevronRight:u("chevron-right",60086),chevronUp:u("chevron-up",60087),chromeClose:u("chrome-close",60088),chromeMaximize:u("chrome-maximize",60089),chromeMinimize:u("chrome-minimize",60090),chromeRestore:u("chrome-restore",60091),circleOutline:u("circle-outline",60092),circle:u("circle",60092),debugBreakpointUnverified:u("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:u("terminal-decoration-incomplete",60092),circleSlash:u("circle-slash",60093),circuitBoard:u("circuit-board",60094),clearAll:u("clear-all",60095),clippy:u("clippy",60096),closeAll:u("close-all",60097),cloudDownload:u("cloud-download",60098),cloudUpload:u("cloud-upload",60099),code:u("code",60100),collapseAll:u("collapse-all",60101),colorMode:u("color-mode",60102),commentDiscussion:u("comment-discussion",60103),creditCard:u("credit-card",60105),dash:u("dash",60108),dashboard:u("dashboard",60109),database:u("database",60110),debugContinue:u("debug-continue",60111),debugDisconnect:u("debug-disconnect",60112),debugPause:u("debug-pause",60113),debugRestart:u("debug-restart",60114),debugStart:u("debug-start",60115),debugStepInto:u("debug-step-into",60116),debugStepOut:u("debug-step-out",60117),debugStepOver:u("debug-step-over",60118),debugStop:u("debug-stop",60119),debug:u("debug",60120),deviceCameraVideo:u("device-camera-video",60121),deviceCamera:u("device-camera",60122),deviceMobile:u("device-mobile",60123),diffAdded:u("diff-added",60124),diffIgnored:u("diff-ignored",60125),diffModified:u("diff-modified",60126),diffRemoved:u("diff-removed",60127),diffRenamed:u("diff-renamed",60128),diff:u("diff",60129),diffSidebyside:u("diff-sidebyside",60129),discard:u("discard",60130),editorLayout:u("editor-layout",60131),emptyWindow:u("empty-window",60132),exclude:u("exclude",60133),extensions:u("extensions",60134),eyeClosed:u("eye-closed",60135),fileBinary:u("file-binary",60136),fileCode:u("file-code",60137),fileMedia:u("file-media",60138),filePdf:u("file-pdf",60139),fileSubmodule:u("file-submodule",60140),fileSymlinkDirectory:u("file-symlink-directory",60141),fileSymlinkFile:u("file-symlink-file",60142),fileZip:u("file-zip",60143),files:u("files",60144),filter:u("filter",60145),flame:u("flame",60146),foldDown:u("fold-down",60147),foldUp:u("fold-up",60148),fold:u("fold",60149),folderActive:u("folder-active",60150),folderOpened:u("folder-opened",60151),gear:u("gear",60152),gift:u("gift",60153),gistSecret:u("gist-secret",60154),gist:u("gist",60155),gitCommit:u("git-commit",60156),gitCompare:u("git-compare",60157),compareChanges:u("compare-changes",60157),gitMerge:u("git-merge",60158),githubAction:u("github-action",60159),githubAlt:u("github-alt",60160),globe:u("globe",60161),grabber:u("grabber",60162),graph:u("graph",60163),gripper:u("gripper",60164),heart:u("heart",60165),home:u("home",60166),horizontalRule:u("horizontal-rule",60167),hubot:u("hubot",60168),inbox:u("inbox",60169),issueReopened:u("issue-reopened",60171),issues:u("issues",60172),italic:u("italic",60173),jersey:u("jersey",60174),json:u("json",60175),kebabVertical:u("kebab-vertical",60176),key:u("key",60177),law:u("law",60178),lightbulbAutofix:u("lightbulb-autofix",60179),linkExternal:u("link-external",60180),link:u("link",60181),listOrdered:u("list-ordered",60182),listUnordered:u("list-unordered",60183),liveShare:u("live-share",60184),loading:u("loading",60185),location:u("location",60186),mailRead:u("mail-read",60187),mail:u("mail",60188),markdown:u("markdown",60189),megaphone:u("megaphone",60190),mention:u("mention",60191),milestone:u("milestone",60192),gitPullRequestMilestone:u("git-pull-request-milestone",60192),mortarBoard:u("mortar-board",60193),move:u("move",60194),multipleWindows:u("multiple-windows",60195),mute:u("mute",60196),noNewline:u("no-newline",60197),note:u("note",60198),octoface:u("octoface",60199),openPreview:u("open-preview",60200),package:u("package",60201),paintcan:u("paintcan",60202),pin:u("pin",60203),play:u("play",60204),run:u("run",60204),plug:u("plug",60205),preserveCase:u("preserve-case",60206),preview:u("preview",60207),project:u("project",60208),pulse:u("pulse",60209),question:u("question",60210),quote:u("quote",60211),radioTower:u("radio-tower",60212),reactions:u("reactions",60213),references:u("references",60214),refresh:u("refresh",60215),regex:u("regex",60216),remoteExplorer:u("remote-explorer",60217),remote:u("remote",60218),remove:u("remove",60219),replaceAll:u("replace-all",60220),replace:u("replace",60221),repoClone:u("repo-clone",60222),repoForcePush:u("repo-force-push",60223),repoPull:u("repo-pull",60224),repoPush:u("repo-push",60225),report:u("report",60226),requestChanges:u("request-changes",60227),rocket:u("rocket",60228),rootFolderOpened:u("root-folder-opened",60229),rootFolder:u("root-folder",60230),rss:u("rss",60231),ruby:u("ruby",60232),saveAll:u("save-all",60233),saveAs:u("save-as",60234),save:u("save",60235),screenFull:u("screen-full",60236),screenNormal:u("screen-normal",60237),searchStop:u("search-stop",60238),server:u("server",60240),settingsGear:u("settings-gear",60241),settings:u("settings",60242),shield:u("shield",60243),smiley:u("smiley",60244),sortPrecedence:u("sort-precedence",60245),splitHorizontal:u("split-horizontal",60246),splitVertical:u("split-vertical",60247),squirrel:u("squirrel",60248),starFull:u("star-full",60249),starHalf:u("star-half",60250),symbolClass:u("symbol-class",60251),symbolColor:u("symbol-color",60252),symbolConstant:u("symbol-constant",60253),symbolEnumMember:u("symbol-enum-member",60254),symbolField:u("symbol-field",60255),symbolFile:u("symbol-file",60256),symbolInterface:u("symbol-interface",60257),symbolKeyword:u("symbol-keyword",60258),symbolMisc:u("symbol-misc",60259),symbolOperator:u("symbol-operator",60260),symbolProperty:u("symbol-property",60261),wrench:u("wrench",60261),wrenchSubaction:u("wrench-subaction",60261),symbolSnippet:u("symbol-snippet",60262),tasklist:u("tasklist",60263),telescope:u("telescope",60264),textSize:u("text-size",60265),threeBars:u("three-bars",60266),thumbsdown:u("thumbsdown",60267),thumbsup:u("thumbsup",60268),tools:u("tools",60269),triangleDown:u("triangle-down",60270),triangleLeft:u("triangle-left",60271),triangleRight:u("triangle-right",60272),triangleUp:u("triangle-up",60273),twitter:u("twitter",60274),unfold:u("unfold",60275),unlock:u("unlock",60276),unmute:u("unmute",60277),unverified:u("unverified",60278),verified:u("verified",60279),versions:u("versions",60280),vmActive:u("vm-active",60281),vmOutline:u("vm-outline",60282),vmRunning:u("vm-running",60283),watch:u("watch",60284),whitespace:u("whitespace",60285),wholeWord:u("whole-word",60286),window:u("window",60287),wordWrap:u("word-wrap",60288),zoomIn:u("zoom-in",60289),zoomOut:u("zoom-out",60290),listFilter:u("list-filter",60291),listFlat:u("list-flat",60292),listSelection:u("list-selection",60293),selection:u("selection",60293),listTree:u("list-tree",60294),debugBreakpointFunctionUnverified:u("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:u("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:u("debug-breakpoint-function-disabled",60296),debugStackframeActive:u("debug-stackframe-active",60297),circleSmallFilled:u("circle-small-filled",60298),debugStackframeDot:u("debug-stackframe-dot",60298),terminalDecorationMark:u("terminal-decoration-mark",60298),debugStackframe:u("debug-stackframe",60299),debugStackframeFocused:u("debug-stackframe-focused",60299),debugBreakpointUnsupported:u("debug-breakpoint-unsupported",60300),symbolString:u("symbol-string",60301),debugReverseContinue:u("debug-reverse-continue",60302),debugStepBack:u("debug-step-back",60303),debugRestartFrame:u("debug-restart-frame",60304),debugAlt:u("debug-alt",60305),callIncoming:u("call-incoming",60306),callOutgoing:u("call-outgoing",60307),menu:u("menu",60308),expandAll:u("expand-all",60309),feedback:u("feedback",60310),gitPullRequestReviewer:u("git-pull-request-reviewer",60310),groupByRefType:u("group-by-ref-type",60311),ungroupByRefType:u("ungroup-by-ref-type",60312),account:u("account",60313),gitPullRequestAssignee:u("git-pull-request-assignee",60313),bellDot:u("bell-dot",60314),debugConsole:u("debug-console",60315),library:u("library",60316),output:u("output",60317),runAll:u("run-all",60318),syncIgnored:u("sync-ignored",60319),pinned:u("pinned",60320),githubInverted:u("github-inverted",60321),serverProcess:u("server-process",60322),serverEnvironment:u("server-environment",60323),pass:u("pass",60324),issueClosed:u("issue-closed",60324),stopCircle:u("stop-circle",60325),playCircle:u("play-circle",60326),record:u("record",60327),debugAltSmall:u("debug-alt-small",60328),vmConnect:u("vm-connect",60329),cloud:u("cloud",60330),merge:u("merge",60331),export:u("export",60332),graphLeft:u("graph-left",60333),magnet:u("magnet",60334),notebook:u("notebook",60335),redo:u("redo",60336),checkAll:u("check-all",60337),pinnedDirty:u("pinned-dirty",60338),passFilled:u("pass-filled",60339),circleLargeFilled:u("circle-large-filled",60340),circleLarge:u("circle-large",60341),circleLargeOutline:u("circle-large-outline",60341),combine:u("combine",60342),gather:u("gather",60342),table:u("table",60343),variableGroup:u("variable-group",60344),typeHierarchy:u("type-hierarchy",60345),typeHierarchySub:u("type-hierarchy-sub",60346),typeHierarchySuper:u("type-hierarchy-super",60347),gitPullRequestCreate:u("git-pull-request-create",60348),runAbove:u("run-above",60349),runBelow:u("run-below",60350),notebookTemplate:u("notebook-template",60351),debugRerun:u("debug-rerun",60352),workspaceTrusted:u("workspace-trusted",60353),workspaceUntrusted:u("workspace-untrusted",60354),workspaceUnknown:u("workspace-unknown",60355),terminalCmd:u("terminal-cmd",60356),terminalDebian:u("terminal-debian",60357),terminalLinux:u("terminal-linux",60358),terminalPowershell:u("terminal-powershell",60359),terminalTmux:u("terminal-tmux",60360),terminalUbuntu:u("terminal-ubuntu",60361),terminalBash:u("terminal-bash",60362),arrowSwap:u("arrow-swap",60363),copy:u("copy",60364),personAdd:u("person-add",60365),filterFilled:u("filter-filled",60366),wand:u("wand",60367),debugLineByLine:u("debug-line-by-line",60368),inspect:u("inspect",60369),layers:u("layers",60370),layersDot:u("layers-dot",60371),layersActive:u("layers-active",60372),compass:u("compass",60373),compassDot:u("compass-dot",60374),compassActive:u("compass-active",60375),azure:u("azure",60376),issueDraft:u("issue-draft",60377),gitPullRequestClosed:u("git-pull-request-closed",60378),gitPullRequestDraft:u("git-pull-request-draft",60379),debugAll:u("debug-all",60380),debugCoverage:u("debug-coverage",60381),runErrors:u("run-errors",60382),folderLibrary:u("folder-library",60383),debugContinueSmall:u("debug-continue-small",60384),beakerStop:u("beaker-stop",60385),graphLine:u("graph-line",60386),graphScatter:u("graph-scatter",60387),pieChart:u("pie-chart",60388),bracket:u("bracket",60175),bracketDot:u("bracket-dot",60389),bracketError:u("bracket-error",60390),lockSmall:u("lock-small",60391),azureDevops:u("azure-devops",60392),verifiedFilled:u("verified-filled",60393),newline:u("newline",60394),layout:u("layout",60395),layoutActivitybarLeft:u("layout-activitybar-left",60396),layoutActivitybarRight:u("layout-activitybar-right",60397),layoutPanelLeft:u("layout-panel-left",60398),layoutPanelCenter:u("layout-panel-center",60399),layoutPanelJustify:u("layout-panel-justify",60400),layoutPanelRight:u("layout-panel-right",60401),layoutPanel:u("layout-panel",60402),layoutSidebarLeft:u("layout-sidebar-left",60403),layoutSidebarRight:u("layout-sidebar-right",60404),layoutStatusbar:u("layout-statusbar",60405),layoutMenubar:u("layout-menubar",60406),layoutCentered:u("layout-centered",60407),target:u("target",60408),indent:u("indent",60409),recordSmall:u("record-small",60410),errorSmall:u("error-small",60411),terminalDecorationError:u("terminal-decoration-error",60411),arrowCircleDown:u("arrow-circle-down",60412),arrowCircleLeft:u("arrow-circle-left",60413),arrowCircleRight:u("arrow-circle-right",60414),arrowCircleUp:u("arrow-circle-up",60415),layoutSidebarRightOff:u("layout-sidebar-right-off",60416),layoutPanelOff:u("layout-panel-off",60417),layoutSidebarLeftOff:u("layout-sidebar-left-off",60418),blank:u("blank",60419),heartFilled:u("heart-filled",60420),map:u("map",60421),mapHorizontal:u("map-horizontal",60421),foldHorizontal:u("fold-horizontal",60421),mapFilled:u("map-filled",60422),mapHorizontalFilled:u("map-horizontal-filled",60422),foldHorizontalFilled:u("fold-horizontal-filled",60422),circleSmall:u("circle-small",60423),bellSlash:u("bell-slash",60424),bellSlashDot:u("bell-slash-dot",60425),commentUnresolved:u("comment-unresolved",60426),gitPullRequestGoToChanges:u("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:u("git-pull-request-new-changes",60428),searchFuzzy:u("search-fuzzy",60429),commentDraft:u("comment-draft",60430),send:u("send",60431),sparkle:u("sparkle",60432),insert:u("insert",60433),mic:u("mic",60434),thumbsdownFilled:u("thumbsdown-filled",60435),thumbsupFilled:u("thumbsup-filled",60436),coffee:u("coffee",60437),snake:u("snake",60438),game:u("game",60439),vr:u("vr",60440),chip:u("chip",60441),piano:u("piano",60442),music:u("music",60443),micFilled:u("mic-filled",60444),repoFetch:u("repo-fetch",60445),copilot:u("copilot",60446),lightbulbSparkle:u("lightbulb-sparkle",60447),robot:u("robot",60448),sparkleFilled:u("sparkle-filled",60449),diffSingle:u("diff-single",60450),diffMultiple:u("diff-multiple",60451),surroundWith:u("surround-with",60452),share:u("share",60453),gitStash:u("git-stash",60454),gitStashApply:u("git-stash-apply",60455),gitStashPop:u("git-stash-pop",60456),vscode:u("vscode",60457),vscodeInsiders:u("vscode-insiders",60458),codeOss:u("code-oss",60459),runCoverage:u("run-coverage",60460),runAllCoverage:u("run-all-coverage",60461),coverage:u("coverage",60462),githubProject:u("github-project",60463),mapVertical:u("map-vertical",60464),foldVertical:u("fold-vertical",60464),mapVerticalFilled:u("map-vertical-filled",60465),foldVerticalFilled:u("fold-vertical-filled",60465),goToSearch:u("go-to-search",60466),percentage:u("percentage",60467),sortPercentage:u("sort-percentage",60467),attach:u("attach",60468)};function $p(){return Object.values(Qe)}var Gw={dialogError:u("dialog-error","error"),dialogWarning:u("dialog-warning","warning"),dialogInfo:u("dialog-info","info"),dialogClose:u("dialog-close","close"),treeItemExpanded:u("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:u("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:u("tree-filter-on-type-off","list-selection"),treeFilterClear:u("tree-filter-clear","close"),treeItemLoading:u("tree-item-loading","loading"),menuSelection:u("menu-selection","check"),menuSubmenu:u("menu-submenu","chevron-right"),menuBarMore:u("menubar-more","more"),scrollbarButtonLeft:u("scrollbar-button-left","triangle-left"),scrollbarButtonRight:u("scrollbar-button-right","triangle-right"),scrollbarButtonUp:u("scrollbar-button-up","triangle-up"),scrollbarButtonDown:u("scrollbar-button-down","triangle-down"),toolBarMore:u("toolbar-more","more"),quickInputBack:u("quick-input-back","arrow-left"),dropDownButton:u("drop-down-button",60084),symbolCustomColor:u("symbol-customcolor",60252),exportIcon:u("export",60332),workspaceUnspecified:u("workspace-unspecified",60355),newLine:u("newline",60394),thumbsDownFilled:u("thumbsdown-filled",60435),thumbsUpFilled:u("thumbsup-filled",60436),gitFetch:u("git-fetch",60445),lightbulbSparkleAutofix:u("lightbulb-sparkle-autofix",60447),debugBreakpointPending:u("debug-breakpoint-pending",60377)},Qe={...ev,...Gw};var tv;(t=>{function n(e){return e&&typeof e=="object"&&typeof e.id=="string"}t.isThemeColor=n})(tv||={});var Tt;(v=>{v.iconNameSegment="[A-Za-z0-9]+",v.iconNameExpression="[A-Za-z0-9-]+",v.iconModifierExpression="~[A-Za-z]+",v.iconNameCharacter="[A-Za-z0-9~-]";let i=new RegExp(`^(${v.iconNameExpression})(${v.iconModifierExpression})?$`);function o(w){let k=i.exec(w.id);if(!k)return o(Qe.error);let[,C,M]=k,_=["codicon","codicon-"+C];return M&&_.push("codicon-modifier-"+M.substring(1)),_}v.asClassNameArray=o;function s(w){return o(w).join(" ")}v.asClassName=s;function a(w){return"."+o(w).join(".")}v.asCSSSelector=a;function l(w){return w&&typeof w=="object"&&typeof w.id=="string"&&(typeof w.color>"u"||tv.isThemeColor(w.color))}v.isThemeIcon=l;let c=new RegExp(`^\\$\\((${v.iconNameExpression}(?:${v.iconModifierExpression})?)\\)$`);function d(w){let k=c.exec(w);if(!k)return;let[,C]=k;return{id:C}}v.fromString=d;function f(w){return{id:w}}v.fromId=f;function m(w,k){let C=w.id,M=C.lastIndexOf("~");return M!==-1&&(C=C.substring(0,M)),k&&(C=`${C}~${k}`),{id:C}}v.modify=m;function g(w){let k=w.id.lastIndexOf("~");if(k!==-1)return w.id.substring(k+1)}v.getModifier=g;function b(w,k){return w.id===k.id&&w.color?.id===k.color?.id}v.isEqual=b})(Tt||={});var N5=Object.freeze({View:Hr("view","View"),Help:Hr("help","Help"),Test:Hr("test","Test"),File:Hr("file","File"),Preferences:Hr("preferences","Preferences"),Developer:Hr({key:"developer",comment:["A developer on Code itself or someone diagnosing issues in Code"]},"Developer")});function rv(n){let t=!1,e=new Map,r=new Map;if(Jw(n,d=>{if(n===d)return!0;let f=JSON.stringify(d);if(f.length<30)return!0;let m=e.get(f);if(!m){let g={schemas:[d]};return e.set(f,g),r.set(d,g),!0}return m.schemas.push(d),r.set(d,m),t=!0,!1}),e.clear(),!t)return JSON.stringify(n);let o="$defs";for(;n.hasOwnProperty(o);)o+="_";let s=[];function a(d){return JSON.stringify(d,(f,m)=>{if(m!==d){let g=r.get(m);if(g&&g.schemas.length>1)return g.id||(g.id=`_${s.length}`,s.push(g.schemas[0])),{$ref:`#/${o}/${g.id}`}}return m})}let l=a(n),c=[];for(let d=0;d<s.length;d++)c.push(`"_${d}":${a(s[d])}`);return c.length?`${l.substring(0,l.length-1)},"${o}":{${c.join(",")}}}`:l}function Do(n){return typeof n=="object"&&n!==null}function Jw(n,t){if(!n||typeof n!="object")return;let e=(...l)=>{for(let c of l)Do(c)&&s.push(c)},r=(...l)=>{for(let c of l)if(Do(c))for(let d in c){let f=c[d];Do(f)&&s.push(f)}},i=(...l)=>{for(let c of l)if(Array.isArray(c))for(let d of c)Do(d)&&s.push(d)},o=l=>{if(Array.isArray(l))for(let c of l)Do(c)&&s.push(c);else Do(l)&&s.push(l)},s=[n],a=s.pop();for(;a;)t(a)&&(e(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),r(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),i(a.anyOf,a.allOf,a.oneOf,a.prefixItems),o(a.items)),a=s.pop()}var Qw=R("commandService"),nv=new class{_commands=new Map;_onDidRegisterCommand=new S;onDidRegisterCommand=this._onDidRegisterCommand.event;registerCommand(n,t){if(!n)throw new Error("invalid command");if(typeof n=="string"){if(!t)throw new Error("invalid command");return this.registerCommand({id:n,handler:t})}if(n.metadata&&Array.isArray(n.metadata.args)){let s=[];for(let l of n.metadata.args)s.push(l.constraint);let a=n.handler;n.handler=function(l,...c){return ng(c,s),a(l,...c)}}let{id:e}=n,r=this._commands.get(e);r||(r=new go,this._commands.set(e,r));let i=r.unshift(n),o=Z(()=>{i(),this._commands.get(e)?.isEmpty()&&this._commands.delete(e)});return this._onDidRegisterCommand.fire(e),o}registerCommandAlias(n,t){return nv.registerCommand(n,(e,...r)=>e.get(Qw).executeCommand(t,...r))}getCommand(n){let t=this._commands.get(n);if(!(!t||t.isEmpty()))return fo.first(t)}getCommands(){let n=new Map;for(let t of this._commands.keys()){let e=this.getCommand(t);e&&n.set(t,e)}return n}};nv.registerCommand("noop",()=>{});var B=R("logService"),Ro=R("loggerService");function _c(n){return Io(n)}function iv(n,t,e){switch(t){case 1:n.trace(e);break;case 2:n.debug(e);break;case 3:n.info(e);break;case 4:n.warn(e);break;case 5:n.error(e);break;case 0:break;default:throw new Error(`Invalid log level ${t}`)}}function Yw(n){switch(n){case 1:return"trace";case 2:return"debug";case 3:return"info";case 4:return"warn";case 5:return"error";case 0:return"off"}}var AL=new _o("logLevel",Yw(3));var jp=class{data=new Map;add(t,e){Vl(Ce(t)),Vl(Xe(e)),Vl(!this.data.has(t),"There is already an extension with this id"),this.data.set(t,e)}knows(t){return this.data.has(t)}as(t){return this.data.get(t)||null}},et=new jp;var Ni={JSONContribution:"base.contributions.json"};function Xw(n){return n.length>0&&n.charAt(n.length-1)==="#"?n.substring(0,n.length-1):n}var Gp=class{schemasById;_onDidChangeSchema=new S;onDidChangeSchema=this._onDidChangeSchema.event;constructor(){this.schemasById={}}registerSchema(t,e){this.schemasById[Xw(t)]=e,this._onDidChangeSchema.fire(t)}notifySchemaChanged(t){this._onDidChangeSchema.fire(t)}getSchemaContributions(){return{schemas:this.schemasById}}getSchemaContent(t){let e=this.schemasById[t];return e?rv(e):void 0}hasSchemaContent(t){return!!this.schemasById[t]}},Zw=new Gp;et.add(Ni.JSONContribution,Zw);var Gn=R("policy");var yn={Configuration:"base.contributions.configuration"};var Rc={properties:{},patternProperties:{}},Lc={properties:{},patternProperties:{}},Oc={properties:{},patternProperties:{}},Ac={properties:{},patternProperties:{}},Mc={properties:{},patternProperties:{}},Aa={properties:{},patternProperties:{}},Bi="vscode://schemas/settings/resourceLanguage";var Wc=et.as(Ni.JSONContribution),Jp=class{registeredConfigurationDefaults=[];configurationDefaultsOverrides;defaultLanguageConfigurationOverridesNode;configurationContributors;configurationProperties;policyConfigurations;excludedConfigurationProperties;resourceLanguageSettingsSchema;overrideIdentifiers=new Set;_onDidSchemaChange=new S;onDidSchemaChange=this._onDidSchemaChange.event;_onDidUpdateConfiguration=new S;onDidUpdateConfiguration=this._onDidUpdateConfiguration.event;constructor(){this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:p("defaultLanguageConfigurationOverrides.title","Default Language Configuration Overrides"),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},Wc.registerSchema(Bi,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(t,e=!0){this.registerConfigurations([t],e)}registerConfigurations(t,e=!0){let r=new Set;this.doRegisterConfigurations(t,e,r),Wc.registerSchema(Bi,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r})}deregisterConfigurations(t){let e=new Set;this.doDeregisterConfigurations(t,e),Wc.registerSchema(Bi,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e})}updateConfigurations({add:t,remove:e}){let r=new Set;this.doDeregisterConfigurations(e,r),this.doRegisterConfigurations(t,!1,r),Wc.registerSchema(Bi,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r})}registerDefaultConfigurations(t){let e=new Set;this.doRegisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doRegisterDefaultConfigurations(t,e){this.registeredConfigurationDefaults.push(...t);let r=[];for(let{overrides:i,source:o}of t)for(let s in i){e.add(s);let a=this.configurationDefaultsOverrides.get(s)??this.configurationDefaultsOverrides.set(s,{configurationDefaultOverrides:[]}).get(s),l=i[s];if(a.configurationDefaultOverrides.push({value:l,source:o}),Ma.test(s)){let c=this.mergeDefaultConfigurationsForOverrideIdentifier(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c,this.updateDefaultOverrideProperty(s,c,o),r.push(...ex(s))}else{let c=this.mergeDefaultConfigurationsForConfigurationProperty(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c;let d=this.configurationProperties[s];d&&(this.updatePropertyDefaultValue(s,d),this.updateSchema(s,d))}}this.doRegisterOverrideIdentifiers(r)}deregisterDefaultConfigurations(t){let e=new Set;this.doDeregisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doDeregisterDefaultConfigurations(t,e){for(let r of t){let i=this.registeredConfigurationDefaults.indexOf(r);i!==-1&&this.registeredConfigurationDefaults.splice(i,1)}for(let{overrides:r,source:i}of t)for(let o in r){let s=this.configurationDefaultsOverrides.get(o);if(!s)continue;let a=s.configurationDefaultOverrides.findIndex(l=>i?l.source?.id===i.id:l.value===r[o]);if(a!==-1){if(s.configurationDefaultOverrides.splice(a,1),s.configurationDefaultOverrides.length===0&&this.configurationDefaultsOverrides.delete(o),Ma.test(o)){let l;for(let c of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForOverrideIdentifier(o,c.value,c.source,l);l&&!nc(l.value)?(s.configurationDefaultOverrideValue=l,this.updateDefaultOverrideProperty(o,l,i)):(this.configurationDefaultsOverrides.delete(o),delete this.configurationProperties[o],delete this.defaultLanguageConfigurationOverridesNode.properties[o])}else{let l;for(let d of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForConfigurationProperty(o,d.value,d.source,l);s.configurationDefaultOverrideValue=l;let c=this.configurationProperties[o];c&&(this.updatePropertyDefaultValue(o,c),this.updateSchema(o,c))}e.add(o)}}this.updateOverridePropertyPatternKey()}updateDefaultOverrideProperty(t,e,r){let i={type:"object",default:e.value,description:p("defaultLanguageConfiguration.description","Configure settings to be overridden for the {0} language.",Kg(t)),$ref:Bi,defaultDefaultValue:e.value,source:r,defaultValueSource:r};this.configurationProperties[t]=i,this.defaultLanguageConfigurationOverridesNode.properties[t]=i}mergeDefaultConfigurationsForOverrideIdentifier(t,e,r,i){let o=i?.value||{},s=i?.source??new Map;if(!(s instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(let a of Object.keys(e)){let l=e[a];if(Xe(l)&&(wr(o[a])||Xe(o[a]))){if(o[a]={...o[a]??{},...l},r)for(let d in l)s.set(`${a}.${d}`,r)}else o[a]=l,r?s.set(a,r):s.delete(a)}return{value:o,source:s}}mergeDefaultConfigurationsForConfigurationProperty(t,e,r,i){let o=this.configurationProperties[t],s=i?.value??o?.defaultDefaultValue,a=r;if(Xe(e)&&(o!==void 0&&o.type==="object"||o===void 0&&(wr(s)||Xe(s)))){if(a=i?.source??new Map,!(a instanceof Map)){console.error("defaultValueSource is not a Map");return}for(let c in e)r&&a.set(`${t}.${c}`,r);e={...Xe(s)?s:{},...e}}return{value:e,source:a}}deltaConfiguration(t){let e=!1,r=new Set;t.removedDefaults&&(this.doDeregisterDefaultConfigurations(t.removedDefaults,r),e=!0),t.addedDefaults&&(this.doRegisterDefaultConfigurations(t.addedDefaults,r),e=!0),t.removedConfigurations&&this.doDeregisterConfigurations(t.removedConfigurations,r),t.addedConfigurations&&this.doRegisterConfigurations(t.addedConfigurations,!1,r),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r,defaultsOverrides:e})}notifyConfigurationSchemaUpdated(...t){this._onDidSchemaChange.fire()}registerOverrideIdentifiers(t){this.doRegisterOverrideIdentifiers(t),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(t){for(let e of t)this.overrideIdentifiers.add(e);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(t,e,r){t.forEach(i=>{this.validateAndRegisterProperties(i,e,i.extensionInfo,i.restrictedProperties,void 0,r),this.configurationContributors.push(i),this.registerJSONConfiguration(i)})}doDeregisterConfigurations(t,e){let r=i=>{if(i.properties)for(let o in i.properties){e.add(o);let s=this.configurationProperties[o];s?.policy?.name&&this.policyConfigurations.delete(s.policy.name),delete this.configurationProperties[o],this.removeFromSchema(o,i.properties[o])}i.allOf?.forEach(o=>r(o))};for(let i of t){r(i);let o=this.configurationContributors.indexOf(i);o!==-1&&this.configurationContributors.splice(o,1)}}validateAndRegisterProperties(t,e=!0,r,i,o=3,s){o=st(t.scope)?o:t.scope;let a=t.properties;if(a)for(let c in a){let d=a[c];if(e&&rx(c,d)){delete a[c];continue}if(d.source=r,d.defaultDefaultValue=a[c].default,this.updatePropertyDefaultValue(c,d),Ma.test(c)?d.scope=void 0:(d.scope=st(d.scope)?o:d.scope,d.restricted=st(d.restricted)?!!i?.includes(c):d.restricted),a[c].hasOwnProperty("included")&&!a[c].included){this.excludedConfigurationProperties[c]=a[c],delete a[c];continue}else this.configurationProperties[c]=a[c],a[c].policy?.name&&this.policyConfigurations.set(a[c].policy.name,c);!a[c].deprecationMessage&&a[c].markdownDeprecationMessage&&(a[c].deprecationMessage=a[c].markdownDeprecationMessage),s.add(c)}let l=t.allOf;if(l)for(let c of l)this.validateAndRegisterProperties(c,e,r,i,o,s)}getConfigurations(){return this.configurationContributors}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}getRegisteredDefaultConfigurations(){return[...this.registeredConfigurationDefaults]}getConfigurationDefaultsOverrides(){let t=new Map;for(let[e,r]of this.configurationDefaultsOverrides)r.configurationDefaultOverrideValue&&t.set(e,r.configurationDefaultOverrideValue);return t}registerJSONConfiguration(t){let e=r=>{let i=r.properties;if(i)for(let s in i)this.updateSchema(s,i[s]);r.allOf?.forEach(e)};e(t)}updateSchema(t,e){switch(Rc.properties[t]=e,e.scope){case 1:Lc.properties[t]=e;break;case 2:Oc.properties[t]=e;break;case 6:Ac.properties[t]=e;break;case 3:Mc.properties[t]=e;break;case 4:Aa.properties[t]=e;break;case 5:Aa.properties[t]=e,this.resourceLanguageSettingsSchema.properties[t]=e;break}}removeFromSchema(t,e){switch(delete Rc.properties[t],e.scope){case 1:delete Lc.properties[t];break;case 2:delete Oc.properties[t];break;case 6:delete Ac.properties[t];break;case 3:delete Mc.properties[t];break;case 4:case 5:delete Aa.properties[t],delete this.resourceLanguageSettingsSchema.properties[t];break}}updateOverridePropertyPatternKey(){for(let t of this.overrideIdentifiers.values()){let e=`[${t}]`,r={type:"object",description:p("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:p("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Bi};this.updatePropertyDefaultValue(e,r),Rc.properties[e]=r,Lc.properties[e]=r,Oc.properties[e]=r,Ac.properties[e]=r,Mc.properties[e]=r,Aa.properties[e]=r}}registerOverridePropertyPatternKey(){let t={type:"object",description:p("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:p("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Bi};Rc.patternProperties[Vi]=t,Lc.patternProperties[Vi]=t,Oc.patternProperties[Vi]=t,Ac.patternProperties[Vi]=t,Mc.patternProperties[Vi]=t,Aa.patternProperties[Vi]=t,this._onDidSchemaChange.fire()}updatePropertyDefaultValue(t,e){let r=this.configurationDefaultsOverrides.get(t)?.configurationDefaultOverrideValue,i,o;r&&(!e.disallowConfigurationDefault||!r.source)&&(i=r.value,o=r.source),wr(i)&&(i=e.defaultDefaultValue,o=void 0),wr(i)&&(i=tx(e.type)),e.default=i,e.defaultValueSource=o}},sv="\\[([^\\]]+)\\]",ov=new RegExp(sv,"g"),Vi=`^(${sv})+$`,Ma=new RegExp(Vi);function ex(n){let t=[];if(Ma.test(n)){let e=ov.exec(n);for(;e?.length;){let r=e[1].trim();r&&t.push(r),e=ov.exec(n)}}return Si(t)}function tx(n){switch(Array.isArray(n)?n[0]:n){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var Fc=new Jp;et.add(yn.Configuration,Fc);function rx(n,t){return n.trim()?Ma.test(n)?p("config.property.languageDefault","Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.",n):Fc.getConfigurationProperties()[n]!==void 0?p("config.property.duplicate","Cannot register '{0}'. This property is already registered.",n):t.policy?.name&&Fc.getPolicyConfigurations().get(t.policy?.name)!==void 0?p("config.policy.duplicate","Cannot register '{0}'. The associated policy {1} is already registered with {2}.",n,t.policy?.name,Fc.getPolicyConfigurations().get(t.policy?.name)):null:p("config.property.empty","Cannot register an empty property")}var xr=R("requestService");function nx(n){return n.res.statusCode&&n.res.statusCode>=200&&n.res.statusCode<300||n.res.statusCode===1223}function ix(n){return n.res.statusCode===204}async function Uc(n){if(!nx(n))throw new Error("Server returned "+n.res.statusCode);if(ix(n))return null;let e=(await rc(n.stream)).toString();try{return JSON.parse(e)}catch(r){throw r.message+=`:
`+e,r}}var Qp;function ox(n){let t=et.as(yn.Configuration),e=Qp;Qp={id:"http",order:15,title:p("httpConfigurationTitle","HTTP"),type:"object",scope:n,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:p("proxy","The proxy setting to use. If not set, will be inherited from the `http_proxy` and `https_proxy` environment variables."),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,description:p("strictSSL","Controls whether the proxy server certificate should be verified against the list of supplied CAs."),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:p("proxyKerberosServicePrincipal","Overrides the principal service name for Kerberos authentication with the HTTP proxy. A default based on the proxy hostname is used when this is not set."),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:p("noProxy","Specifies domain names for which proxy settings should be ignored for HTTP/HTTPS requests."),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:p("proxyAuthorization","The value to send as the `Proxy-Authorization` header for every network request."),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[p("proxySupportOff","Disable proxy support for extensions."),p("proxySupportOn","Enable proxy support for extensions."),p("proxySupportFallback","Enable proxy support for extensions, fall back to request options, when no proxy found."),p("proxySupportOverride","Enable proxy support for extensions, override request options.")],default:"override",description:p("proxySupport","Use the proxy support for extensions."),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,description:p("systemCertificates","Controls whether CA certificates should be loaded from the OS. (On Windows and macOS, a reload of the window is required after turning this off.)"),restricted:!0},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,description:p("systemCertificatesV2","Controls whether experimental loading of CA certificates from the OS should be enabled. This uses a more general approach than the default implemenation."),restricted:!0}}},t.updateConfigurations({add:[Qp],remove:e?[e]:[]})}ox(1);var Wa={exports:{}};(function(){function t(o){let s=[];typeof o=="number"&&s.push("code/timeOrigin",o);function a(c){s.push(c,Date.now())}function l(){let c=[];for(let d=0;d<s.length;d+=2)c.push({name:s[d],startTime:s[d+1]});return c}return{mark:a,getMarks:l}}function e(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?t():{mark(o){performance.mark(o)},getMarks(){let o=performance.timeOrigin;typeof o!="number"&&(o=performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart);let s=[{name:"code/timeOrigin",startTime:Math.round(o)}];for(let a of performance.getEntriesByType("mark"))s.push({name:a.name,startTime:Math.round(o+a.startTime)});return s}};if(typeof process=="object"){let o=performance?.timeOrigin;return t(o)}else return console.trace("perf-util loaded in UNKNOWN environment"),t()}function r(o){return o.MonacoPerformanceMarks||(o.MonacoPerformanceMarks=e()),o.MonacoPerformanceMarks}var i;typeof global=="object"?i=global:typeof self=="object"?i=self:i={},typeof Wa=="object"&&typeof Wa.exports=="object"?Wa.exports=r(i):(console.trace("perf-util defined in UNKNOWN context (neither requirejs or commonjs)"),i.perf=r(i))})();var Sr=Wa.exports.mark,Nc=Wa.exports.getMarks;var Yr=class n extends O{constructor(e,r=Object.create(null)){super();this.database=e;this.options=r;this.registerListeners()}static DEFAULT_FLUSH_DELAY=100;_onDidChangeStorage=this._register(new Di);onDidChangeStorage=this._onDidChangeStorage.event;state=0;cache=new Map;flushDelayer=this._register(new Kt(n.DEFAULT_FLUSH_DELAY));pendingDeletes=new Set;pendingInserts=new Map;pendingClose=void 0;whenFlushedCallbacks=[];registerListeners(){this._register(this.database.onDidChangeItemsExternal(e=>this.onDidChangeItemsExternal(e)))}onDidChangeItemsExternal(e){this._onDidChangeStorage.pause();try{e.changed?.forEach((r,i)=>this.acceptExternal(i,r)),e.deleted?.forEach(r=>this.acceptExternal(r,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(e,r){if(this.state===2)return;let i=!1;st(r)?i=this.cache.delete(e):this.cache.get(e)!==r&&(this.cache.set(e,r),i=!0),i&&this._onDidChangeStorage.fire({key:e,external:!0})}get items(){return this.cache}get size(){return this.cache.size}async init(){this.state===0&&(this.state=1,this.options.hint!==0&&(this.cache=await this.database.getItems()))}get(e,r){let i=this.cache.get(e);return st(i)?r:i}getBoolean(e,r){let i=this.get(e);return st(i)?r:i==="true"}getNumber(e,r){let i=this.get(e);return st(i)?r:parseInt(i,10)}getObject(e,r){let i=this.get(e);return st(i)?r:Rg(i)}async set(e,r,i=!1){if(this.state===2)return;if(st(r))return this.delete(e,i);let o=Xe(r)||Array.isArray(r)?Dg(r):String(r);if(this.cache.get(e)!==o)return this.cache.set(e,o),this.pendingInserts.set(e,o),this.pendingDeletes.delete(e),this._onDidChangeStorage.fire({key:e,external:i}),this.doFlush()}async delete(e,r=!1){if(!(this.state===2||!this.cache.delete(e)))return this.pendingDeletes.has(e)||this.pendingDeletes.add(e),this.pendingInserts.delete(e),this._onDidChangeStorage.fire({key:e,external:r}),this.doFlush()}async optimize(){if(this.state!==2)return await this.flush(0),this.database.optimize()}async close(){return this.pendingClose||(this.pendingClose=this.doClose()),this.pendingClose}async doClose(){this.state=2;try{await this.doFlush(0)}catch{}await this.database.close(()=>this.cache)}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;let e={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(e).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async flush(e){if(!(this.state===2||this.pendingClose))return this.doFlush(e)}async doFlush(e){return this.options.hint===1?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),e)}async whenFlushed(){if(this.hasPending)return new Promise(e=>this.whenFlushedCallbacks.push(e))}isInMemory(){return this.options.hint===1}},Lo=class{onDidChangeItemsExternal=E.None;items=new Map;async getItems(){return this.items}async updateItems(t){t.insert?.forEach((e,r)=>this.items.set(r,e)),t.delete?.forEach(e=>this.items.delete(e))}async optimize(){}async close(){}};var Oo="**",lv="/",Bc="[/\\\\]",Vc="[^/\\\\]",sx=/\//g;function cv(n,t){switch(n){case 0:return"";case 1:return`${Vc}*?`;default:return`(?:${Bc}|${Vc}+${Bc}${t?`|${Bc}${Vc}+`:""})*?`}}function dv(n,t){if(!n)return[];let e=[],r=!1,i=!1,o="";for(let s of n){switch(s){case t:if(!r&&!i){e.push(o),o="";continue}break;case"{":r=!0;break;case"}":r=!1;break;case"[":i=!0;break;case"]":i=!1;break}o+=s}return o&&e.push(o),e}function hv(n){if(!n)return"";let t="",e=dv(n,lv);if(e.every(r=>r===Oo))t=".*";else{let r=!1;e.forEach((i,o)=>{if(i===Oo){if(r)return;t+=cv(2,o===e.length-1)}else{let s=!1,a="",l=!1,c="";for(let d of i){if(d!=="}"&&s){a+=d;continue}if(l&&(d!=="]"||!c)){let f;d==="-"?f=d:(d==="^"||d==="!")&&!c?f="^":d===lv?f="":f=fn(d),c+=f;continue}switch(d){case"{":s=!0;continue;case"[":l=!0;continue;case"}":{let m=`(?:${dv(a,",").map(g=>hv(g)).join("|")})`;t+=m,s=!1,a="";break}case"]":{t+="["+c+"]",l=!1,c="";break}case"?":t+=Vc;continue;case"*":t+=cv(1);continue;default:t+=fn(d)}}o<e.length-1&&(e[o+1]!==Oo||o+2<e.length)&&(t+=Bc)}r=i===Oo})}return t}var ax=/^\*\*\/\*\.[\w\.-]+$/,lx=/^\*\*\/([\w\.-]+)\/?$/,cx=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,dx=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,ux=/^\*\*((\/[\w\.-]+)+)\/?$/,px=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,uv=new un(1e4),pv=function(){return!1},Xr=function(){return null};function Xp(n,t){if(!n)return Xr;let e;typeof n!="string"?e=n.pattern:e=n,e=e.trim();let r=`${e}_${!!t.trimForExclusions}`,i=uv.get(r);if(i)return fv(i,n);let o;return ax.test(e)?i=fx(e.substr(4),e):(o=lx.exec(Yp(e,t)))?i=mx(o[1],e):(t.trimForExclusions?dx:cx).test(e)?i=hx(e,t):(o=ux.exec(Yp(e,t)))?i=mv(o[1].substr(1),e,!0):(o=px.exec(Yp(e,t)))?i=mv(o[1],e,!1):i=gx(e),uv.set(r,i),fv(i,n)}function fv(n,t){if(typeof t=="string")return n;let e=function(r,i){return hn(r,t.base,!j)?n(cp(r.substr(t.base.length),ot),i):null};return e.allBasenames=n.allBasenames,e.allPaths=n.allPaths,e.basenames=n.basenames,e.patterns=n.patterns,e}function Yp(n,t){return t.trimForExclusions&&n.endsWith("/**")?n.substr(0,n.length-2):n}function fx(n,t){return function(e,r){return typeof e=="string"&&e.endsWith(n)?t:null}}function mx(n,t){let e=`/${n}`,r=`\\${n}`,i=function(s,a){return typeof s!="string"?null:a?a===n?t:null:s===n||s.endsWith(e)||s.endsWith(r)?t:null},o=[n];return i.basenames=o,i.patterns=[t],i.allBasenames=o,i}function hx(n,t){let e=vv(n.slice(1,-1).split(",").map(a=>Xp(a,t)).filter(a=>a!==Xr),n),r=e.length;if(!r)return Xr;if(r===1)return e[0];let i=function(a,l){for(let c=0,d=e.length;c<d;c++)if(e[c](a,l))return n;return null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function mv(n,t,e){let r=ot===Q.sep,i=r?n:n.replace(sx,ot),o=ot+i,s=Q.sep+n,a;return e?a=function(l,c){return typeof l=="string"&&(l===i||l.endsWith(o)||!r&&(l===n||l.endsWith(s)))?t:null}:a=function(l,c){return typeof l=="string"&&(l===i||!r&&l===n)?t:null},a.allPaths=[(e?"*/":"./")+n],a}function gx(n){try{let t=new RegExp(`^${hv(n)}$`);return function(e){return t.lastIndex=0,typeof e=="string"&&t.test(e)?n:null}}catch{return Xr}}function gv(n,t={}){if(!n)return pv;if(typeof n=="string"||vx(n)){let e=Xp(n,t);if(e===Xr)return pv;let r=function(i,o){return!!e(i,o)};return e.allBasenames&&(r.allBasenames=e.allBasenames),e.allPaths&&(r.allPaths=e.allPaths),r}return yx(n,t)}function vx(n){let t=n;return t?typeof t.base=="string"&&typeof t.pattern=="string":!1}function yx(n,t){let e=vv(Object.getOwnPropertyNames(n).map(a=>bx(a,n[a],t)).filter(a=>a!==Xr)),r=e.length;if(!r)return Xr;if(!e.some(a=>!!a.requiresSiblings)){if(r===1)return e[0];let a=function(d,f){let m;for(let g=0,b=e.length;g<b;g++){let v=e[g](d,f);if(typeof v=="string")return v;fc(v)&&(m||(m=[]),m.push(v))}return m?(async()=>{for(let g of m){let b=await g;if(typeof b=="string")return b}return null})():null},l=e.find(d=>!!d.allBasenames);l&&(a.allBasenames=l.allBasenames);let c=e.reduce((d,f)=>f.allPaths?d.concat(f.allPaths):d,[]);return c.length&&(a.allPaths=c),a}let i=function(a,l,c){let d,f;for(let m=0,g=e.length;m<g;m++){let b=e[m];b.requiresSiblings&&c&&(l||(l=ve(a)),d||(d=l.substr(0,l.length-Fl(a).length)));let v=b(a,l,d,c);if(typeof v=="string")return v;fc(v)&&(f||(f=[]),f.push(v))}return f?(async()=>{for(let m of f){let g=await m;if(typeof g=="string")return g}return null})():null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function bx(n,t,e){if(t===!1)return Xr;let r=Xp(n,e);if(r===Xr)return Xr;if(typeof t=="boolean")return r;if(t){let i=t.when;if(typeof i=="string"){let o=(s,a,l,c)=>{if(!c||!r(s,a))return null;let d=i.replace("$(basename)",()=>l),f=c(d);return fc(f)?f.then(m=>m?n:null):f?n:null};return o.requiresSiblings=!0,o}}return r}function vv(n,t){let e=n.filter(a=>!!a.basenames);if(e.length<2)return n;let r=e.reduce((a,l)=>{let c=l.basenames;return c?a.concat(c):a},[]),i;if(t){i=[];for(let a=0,l=r.length;a<l;a++)i.push(t)}else i=e.reduce((a,l)=>{let c=l.patterns;return c?a.concat(c):a},[]);let o=function(a,l){if(typeof a!="string")return null;if(!l){let d;for(d=a.length;d>0;d--){let f=a.charCodeAt(d-1);if(f===47||f===92)break}l=a.substr(d)}let c=r.indexOf(l);return c!==-1?i[c]:null};o.basenames=r,o.patterns=i,o.allBasenames=r;let s=n.filter(a=>!a.basenames);return s.push(o),s}function Zp(n,t){return Bu(n,t,(e,r)=>typeof e=="string"&&typeof r=="string"?e===r:typeof e!="string"&&typeof r!="string"?e.base===r.base&&e.pattern===r.pattern:!1)}var $O=new Uint32Array(10);var jO=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),GO=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),JO=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),QO=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function yv(...n){return function(t,e){for(let r=0,i=n.length;r<i;r++){let o=n[r](t,e);if(o)return o}return null}}var iA=Iv.bind(void 0,!1),bv=Iv.bind(void 0,!0);function Iv(n,t,e){if(!e||e.length<t.length)return null;let r;return n?r=jr(e,t):r=e.indexOf(t)===0,r?t.length>0?[{start:0,end:t.length}]:[]:null}function Ix(n,t){let e=t.toLowerCase().indexOf(n.toLowerCase());return e===-1?null:[{start:e,end:e+n.length}]}function wx(n,t){return ef(n.toLowerCase(),t.toLowerCase(),0,0)}function ef(n,t,e,r){if(e===n.length)return[];if(r===t.length)return null;if(n[e]===t[r]){let i=null;return(i=ef(n,t,e+1,r+1))?xv({start:r,end:r+1},i):null}return ef(n,t,e,r+1)}function rf(n){return 97<=n&&n<=122}function Hc(n){return 65<=n&&n<=90}function nf(n){return 48<=n&&n<=57}function xx(n){return n===32||n===9||n===10||n===13}var Sx=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(n=>Sx.add(n.charCodeAt(0)));function wv(n){return rf(n)||Hc(n)||nf(n)}function xv(n,t){return t.length===0?t=[n]:n.end===t[0].start?t[0].start=n.start:t.unshift(n),t}function Sv(n,t){for(let e=t;e<n.length;e++){let r=n.charCodeAt(e);if(Hc(r)||nf(r)||e>0&&!wv(n.charCodeAt(e-1)))return e}return n.length}function tf(n,t,e,r){if(e===n.length)return[];if(r===t.length)return null;if(n[e]!==t[r].toLowerCase())return null;{let i=null,o=r+1;for(i=tf(n,t,e+1,r+1);!i&&(o=Sv(t,o))<t.length;)i=tf(n,t,e+1,o),o++;return i===null?null:xv({start:r,end:r+1},i)}}function Ex(n){let t=0,e=0,r=0,i=0,o=0;for(let d=0;d<n.length;d++)o=n.charCodeAt(d),Hc(o)&&t++,rf(o)&&e++,wv(o)&&r++,nf(o)&&i++;let s=t/n.length,a=e/n.length,l=r/n.length,c=i/n.length;return{upperPercent:s,lowerPercent:a,alphaPercent:l,numericPercent:c}}function Px(n){let{upperPercent:t,lowerPercent:e}=n;return e===0&&t>.6}function Tx(n){let{upperPercent:t,lowerPercent:e,alphaPercent:r,numericPercent:i}=n;return e>.2&&t<.8&&r>.6&&i<.2}function kx(n){let t=0,e=0,r=0,i=0;for(let o=0;o<n.length;o++)r=n.charCodeAt(o),Hc(r)&&t++,rf(r)&&e++,xx(r)&&i++;return(t===0||e===0)&&i===0?n.length<=30:t<=5}function Ev(n,t){if(!t||(t=t.trim(),t.length===0)||!kx(n))return null;t.length>60&&(t=t.substring(0,60));let e=Ex(t);if(!Tx(e)){if(!Px(e))return null;t=t.toLowerCase()}let r=null,i=0;for(n=n.toLowerCase();i<t.length&&(r=tf(n,t,0,i))===null;)i=Sv(t,i+1);return r}var oA=yv(bv,Ev,Ix),sA=yv(bv,Ev,wx),aA=new un(1e4);var Kc=128;function of(){let n=[],t=[];for(let e=0;e<=Kc;e++)t[e]=0;for(let e=0;e<=Kc;e++)n.push(t.slice(0));return n}function Pv(n){let t=[];for(let e=0;e<=n;e++)t[e]=0;return t}var lA=Pv(2*Kc),cA=Pv(2*Kc),dA=of(),uA=of(),pA=of();var Cx;(e=>{e.Default=[-100,0];function t(r){return!r||r.length===2&&r[0]===-100&&r[1]===0}e.isDefault=t})(Cx||={});var sf=new RegExp(`\\$\\(${Tt.iconNameExpression}(?:${Tt.iconModifierExpression})?\\)`,"g"),bA=new RegExp(`(\\\\)?${sf.source}`,"g");var IA=new RegExp(`\\\\${sf.source}`,"g");var wA=new RegExp(`(\\s)?(\\\\)?${sf.source}(\\s)?`,"g");var xA=new RegExp(`\\$\\(${Tt.iconNameCharacter}+\\)`,"g");var We=R("fileService");function Mo(n){return n.create===!0}var Ao=class n extends Error{constructor(e,r){super(e);this.code=r}static create(e,r){let i=new n(e.toString(),r);return _x(i,r),i}};function qt(n,t){return Ao.create(n,t)}function Tv(n){return n||qt(p("unknownError","Unknown Error"),"Unknown")}function _x(n,t){return n.name=t?`${t} (FileSystemError)`:"FileSystemError",n}function Dx(n){if(!n)return"Unknown";if(n instanceof Ao)return n.code;let t=/^(.+) \(FileSystemError\)$/.exec(n.name);if(!t)return"Unknown";switch(t[1]){case"EntryExists":return"EntryExists";case"EntryIsADirectory":return"EntryIsADirectory";case"EntryNotADirectory":return"EntryNotADirectory";case"EntryNotFound":return"EntryNotFound";case"EntryTooLarge":return"EntryTooLarge";case"EntryWriteLocked":return"EntryWriteLocked";case"NoPermissions":return"NoPermissions";case"Unavailable":return"Unavailable"}return"Unknown"}function Mr(n){if(n instanceof af)return n.fileOperationResult;switch(Dx(n)){case"EntryNotFound":return 1;case"EntryIsADirectory":return 0;case"EntryNotADirectory":return 9;case"EntryWriteLocked":return 5;case"NoPermissions":return 6;case"EntryExists":return 4;case"EntryTooLarge":return 7;default:return 10}}function kv(n,t,e){return!n||!t||n===t||t.length>n.length?!1:(t.charAt(t.length-1)!==ot&&(t+=ot),e?jr(n,t):n.indexOf(t)===0)}var af=class extends Error{constructor(e,r,i){super(e);this.fileOperationResult=r;this.options=i}};var zc={OFF:"off",ON_EXIT:"onExit",ON_EXIT_AND_WINDOW_CLOSE:"onExitAndWindowClose"};var lf=class n{static KB=1024;static MB=n.KB*n.KB;static GB=n.MB*n.KB;static TB=n.GB*n.KB;static formatSize(t){return Io(t)||(t=0),t<n.KB?p("sizeB","{0}B",t.toFixed(0)):t<n.MB?p("sizeKB","{0}KB",(t/n.KB).toFixed(2)):t<n.GB?p("sizeMB","{0}MB",(t/n.MB).toFixed(2)):t<n.TB?p("sizeGB","{0}GB",(t/n.GB).toFixed(2)):p("sizeTB","{0}TB",(t/n.TB).toFixed(2))}};var ht=R("IUriIdentityService");function Cv(n){let t=n;return!!(t&&typeof t=="object"&&typeof t.id=="string"&&typeof t.isDefault=="boolean"&&typeof t.name=="string"&&x.isUri(t.location)&&x.isUri(t.globalStorageHome)&&x.isUri(t.settingsResource)&&x.isUri(t.keybindingsResource)&&x.isUri(t.tasksResource)&&x.isUri(t.snippetsHome)&&x.isUri(t.extensionsResource))}var $t=R("IUserDataProfilesService");function qc(n,t,e,r,i,o){return{id:n,name:t,location:e,isDefault:!1,shortName:i?.shortName,icon:i?.icon,globalStorageHome:o&&i?.useDefaultFlags?.globalState?o.globalStorageHome:ne(e,"globalStorage"),settingsResource:o&&i?.useDefaultFlags?.settings?o.settingsResource:ne(e,"settings.json"),keybindingsResource:o&&i?.useDefaultFlags?.keybindings?o.keybindingsResource:ne(e,"keybindings.json"),tasksResource:o&&i?.useDefaultFlags?.tasks?o.tasksResource:ne(e,"tasks.json"),snippetsHome:o&&i?.useDefaultFlags?.snippets?o.snippetsHome:ne(e,"snippets"),extensionsResource:o&&i?.useDefaultFlags?.extensions?o.extensionsResource:ne(e,"extensions.json"),cacheHome:ne(r,n),useDefaultFlags:i?.useDefaultFlags,isTransient:i?.transient}}var Wo=class extends O{constructor(e,r,i,o){super();this.environmentService=e;this.fileService=r;this.uriIdentityService=i;this.logService=o;this.profilesHome=ne(this.environmentService.userRoamingDataHome,"profiles"),this.profilesCacheHome=ne(this.environmentService.cacheHome,"CachedProfilesData")}static PROFILES_KEY="userDataProfiles";static PROFILE_ASSOCIATIONS_KEY="profileAssociations";_serviceBrand;enabled=!0;profilesHome;profilesCacheHome;get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.profilesObject.profiles,...this.transientProfilesObject.profiles]}_onDidChangeProfiles=this._register(new S);onDidChangeProfiles=this._onDidChangeProfiles.event;_onWillCreateProfile=this._register(new S);onWillCreateProfile=this._onWillCreateProfile.event;_onWillRemoveProfile=this._register(new S);onWillRemoveProfile=this._onWillRemoveProfile.event;_onDidResetWorkspaces=this._register(new S);onDidResetWorkspaces=this._onDidResetWorkspaces.event;profileCreationPromises=new Map;transientProfilesObject={profiles:[],folders:new Ot,workspaces:new Ot,emptyWindows:new Map};init(){this._profilesObject=void 0}setEnablement(e){this.enabled!==e&&(this._profilesObject=void 0,this.enabled=e)}isEnabled(){return this.enabled}_profilesObject;get profilesObject(){if(!this._profilesObject){let e=this.createDefaultProfile(),r=[e];if(this.enabled)try{for(let s of this.getStoredProfiles()){if(!s.name||!Ce(s.name)||!s.location){this.logService.warn("Skipping the invalid stored profile",s.location||s.name);continue}r.push(qc(Vt(s.location),s.name,s.location,this.profilesCacheHome,{shortName:s.shortName,icon:s.icon,useDefaultFlags:s.useDefaultFlags},e))}}catch(s){this.logService.error(s)}let i=new Ot,o=new Map;if(r.length)try{let s=this.getStoredProfileAssociations();if(s.workspaces)for(let[a,l]of Object.entries(s.workspaces)){let c=x.parse(a),d=r.find(f=>f.id===l);d&&i.set(c,d)}if(s.emptyWindows)for(let[a,l]of Object.entries(s.emptyWindows)){let c=r.find(d=>d.id===l);c&&o.set(a,c)}}catch(s){this.logService.error(s)}this._profilesObject={profiles:r,workspaces:i,emptyWindows:o}}return this._profilesObject}createDefaultProfile(){let e=qc("__default__profile__",p("defaultProfile","Default"),this.environmentService.userRoamingDataHome,this.profilesCacheHome);return{...e,extensionsResource:this.getDefaultProfileExtensionsLocation()??e.extensionsResource,isDefault:!0}}async createTransientProfile(e){let r="Temp",i=new RegExp(`${fn(r)}\\s(\\d+)`),o=0;for(let a of this.profiles){let l=i.exec(a.name),c=l?parseInt(l[1]):0;o=c>o?c:o}let s=`${r} ${o+1}`;return this.createProfile(er(yt()).toString(16),s,{transient:!0},e)}async createNamedProfile(e,r,i){return this.createProfile(er(yt()).toString(16),e,r,i)}async createProfile(e,r,i,o){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let s=await this.doCreateProfile(e,r,i);return o&&await this.setProfileForWorkspace(o,s),s}async doCreateProfile(e,r,i){if(!Ce(r)||!r)throw new Error("Name of the profile is mandatory and must be of type `string`");let o=this.profileCreationPromises.get(r);return o||(o=(async()=>{try{if(this.profiles.find(c=>c.name===r||c.id===e))throw new Error(`Profile with ${r} name already exists`);let a=qc(e,r,ne(this.profilesHome,e),this.profilesCacheHome,i,this.defaultProfile);await this.fileService.createFolder(a.location);let l=[];return this._onWillCreateProfile.fire({profile:a,join(c){l.push(c)}}),await Zt.settled(l),this.updateProfiles([a],[],[]),a}finally{this.profileCreationPromises.delete(r)}})(),this.profileCreationPromises.set(r,o)),o}async updateProfile(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===e.id);if(!i)throw new Error(`Profile '${e.name}' does not exist`);return i=qc(i.id,r.name??i.name,i.location,this.profilesCacheHome,{shortName:r.shortName??i.shortName,icon:r.icon===null?void 0:r.icon??i.icon,transient:r.transient??i.isTransient,useDefaultFlags:r.useDefaultFlags??i.useDefaultFlags},this.defaultProfile),this.updateProfiles([],[],[i]),i}async removeProfile(e){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");if(e.isDefault)throw new Error("Cannot remove default profile");let r=this.profiles.find(o=>o.id===e.id);if(!r)throw new Error(`Profile '${e.name}' does not exist`);let i=[];this._onWillRemoveProfile.fire({profile:r,join(o){i.push(o)}});try{await Promise.allSettled(i)}catch(o){this.logService.error(o)}for(let o of[...this.profilesObject.emptyWindows.keys()])r.id===this.profilesObject.emptyWindows.get(o)?.id&&this.profilesObject.emptyWindows.delete(o);for(let o of[...this.profilesObject.workspaces.keys()])r.id===this.profilesObject.workspaces.get(o)?.id&&this.profilesObject.workspaces.delete(o);this.updateStoredProfileAssociations(),this.updateProfiles([],[r],[]);try{await this.fileService.del(r.cacheHome,{recursive:!0})}catch(o){Mr(o)!==1&&this.logService.error(o)}}async setProfileForWorkspace(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===r.id);if(!i)throw new Error(`Profile '${r.name}' does not exist`);this.updateWorkspaceAssociation(e,i)}unsetWorkspace(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");this.updateWorkspaceAssociation(e,void 0,r)}async resetWorkspaces(){this.transientProfilesObject.folders.clear(),this.transientProfilesObject.workspaces.clear(),this.transientProfilesObject.emptyWindows.clear(),this.profilesObject.workspaces.clear(),this.profilesObject.emptyWindows.clear(),this.updateStoredProfileAssociations(),this._onDidResetWorkspaces.fire()}async cleanUp(){if(this.enabled&&await this.fileService.exists(this.profilesHome)){let e=await this.fileService.resolve(this.profilesHome);await Promise.all((e.children||[]).filter(r=>r.isDirectory&&this.profiles.every(i=>!this.uriIdentityService.extUri.isEqual(i.location,r.resource))).map(r=>this.fileService.del(r.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){if(!this.enabled)return;let e=this.transientProfilesObject.profiles.filter(r=>!this.isProfileAssociatedToWorkspace(r));await Promise.allSettled(e.map(r=>this.removeProfile(r)))}getProfileForWorkspace(e){let r=this.getWorkspace(e),i=x.isUri(r)?this.profilesObject.workspaces.get(r):this.profilesObject.emptyWindows.get(r);return i||(Ze(e)?this.transientProfilesObject.folders.get(e.uri):Ue(e)?this.transientProfilesObject.workspaces.get(e.configPath):this.transientProfilesObject.emptyWindows.get(e.id))}getWorkspace(e){return Ze(e)?e.uri:Ue(e)?e.configPath:e.id}isProfileAssociatedToWorkspace(e){return!!([...this.profilesObject.emptyWindows.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.profilesObject.workspaces.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.emptyWindows.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.workspaces.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.folders.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location)))}updateProfiles(e,r,i){let o=[...this.profiles,...e],s=[],a=this.transientProfilesObject.profiles;this.transientProfilesObject.profiles=[];for(let l of o){if(l.isDefault||r.some(d=>l.id===d.id))continue;l=i.find(d=>l.id===d.id)??l;let c=a.find(d=>l.id===d.id);if(l.isTransient)this.transientProfilesObject.profiles.push(l);else{if(c){for(let[d,f]of this.transientProfilesObject.emptyWindows.entries())if(l.id===f.id){this.updateWorkspaceAssociation({id:d},l);break}for(let[d,f]of this.transientProfilesObject.workspaces.entries())if(l.id===f.id){this.updateWorkspaceAssociation({id:"",configPath:d},l);break}for(let[d,f]of this.transientProfilesObject.folders.entries())if(l.id===f.id){this.updateWorkspaceAssociation({id:"",uri:d},l);break}}s.push({location:l.location,name:l.name,shortName:l.shortName,icon:l.icon,useDefaultFlags:l.useDefaultFlags})}}this.saveStoredProfiles(s),this._profilesObject=void 0,this.triggerProfilesChanges(e,r,i)}triggerProfilesChanges(e,r,i){this._onDidChangeProfiles.fire({added:e,removed:r,updated:i,all:this.profiles})}updateWorkspaceAssociation(e,r,i){if(i=r?.isTransient?!0:i,i)Ze(e)?(this.transientProfilesObject.folders.delete(e.uri),r&&this.transientProfilesObject.folders.set(e.uri,r)):Ue(e)?(this.transientProfilesObject.workspaces.delete(e.configPath),r&&this.transientProfilesObject.workspaces.set(e.configPath,r)):(this.transientProfilesObject.emptyWindows.delete(e.id),r&&this.transientProfilesObject.emptyWindows.set(e.id,r));else{this.updateWorkspaceAssociation(e,void 0,!0);let o=this.getWorkspace(e);x.isUri(o)?(this.profilesObject.workspaces.delete(o),r&&this.profilesObject.workspaces.set(o,r)):(this.profilesObject.emptyWindows.delete(o),r&&this.profilesObject.emptyWindows.set(o,r)),this.updateStoredProfileAssociations()}}updateStoredProfileAssociations(){let e={};for(let[i,o]of this.profilesObject.workspaces.entries())e[i.toString()]=o.id;let r={};for(let[i,o]of this.profilesObject.emptyWindows.entries())r[i.toString()]=o.id;this.saveStoredProfileAssociations({workspaces:e,emptyWindows:r}),this._profilesObject=void 0}migrateStoredProfileAssociations(e){let r={},i=this.createDefaultProfile();if(e.workspaces)for(let[s,a]of Object.entries(e.workspaces)){let l=x.parse(a);r[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}let o={};if(e.emptyWindows)for(let[s,a]of Object.entries(e.emptyWindows)){let l=x.parse(a);o[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}return{workspaces:r,emptyWindows:o}}getStoredProfiles(){return[]}saveStoredProfiles(e){throw new Error("not implemented")}getStoredProfileAssociations(){return{}}saveStoredProfileAssociations(e){throw new Error("not implemented")}getDefaultProfileExtensionsLocation(){}};Wo=P([h(0,zt),h(1,We),h(2,ht),h(3,B)],Wo);var Ua="__$__isNewStorageMarker",bn="__$__targetStorageMarker",_v=R("storageService");function $c(n){let t=n.get(bn);if(t)try{return JSON.parse(t)}catch{}return Object.create(null)}var Fo=class n extends O{constructor(e={flushInterval:n.DEFAULT_FLUSH_INTERVAL}){super();this.options=e}static DEFAULT_FLUSH_INTERVAL=60*1e3;_onDidChangeValue=this._register(new Di);_onDidChangeTarget=this._register(new Di);onDidChangeTarget=this._onDidChangeTarget.event;_onWillSaveState=this._register(new S);onWillSaveState=this._onWillSaveState.event;initializationPromise;flushWhenIdleScheduler=this._register(new bt(()=>this.doFlushWhenIdle(),this.options.flushInterval));runFlushWhenIdle=this._register(new Dr);onDidChangeValue(e,r,i){return E.filter(this._onDidChangeValue.event,o=>o.scope===e&&(r===void 0||o.key===r),i)}doFlushWhenIdle(){this.runFlushWhenIdle.value=ha(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){ft([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{Sr("code/willInitStorage");try{await this.doInitialize()}finally{Sr("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(e,r){let{key:i,external:o}=r;if(i===bn){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:i,target:this.getKeyTargets(e)[i],external:o})}emitWillSaveState(e){this._onWillSaveState.fire({reason:e})}get(e,r,i){return this.getStorage(r)?.get(e,i)}getBoolean(e,r,i){return this.getStorage(r)?.getBoolean(e,i)}getNumber(e,r,i){return this.getStorage(r)?.getNumber(e,i)}getObject(e,r,i){return this.getStorage(r)?.getObject(e,i)}storeAll(e,r){this.withPausedEmitters(()=>{for(let i of e)this.store(i.key,i.value,i.scope,i.target,r)})}store(e,r,i,o,s=!1){if(st(r)){this.remove(e,i,s);return}this.withPausedEmitters(()=>{this.updateKeyTarget(e,i,o),this.getStorage(i)?.set(e,r,s)})}remove(e,r,i=!1){this.withPausedEmitters(()=>{this.updateKeyTarget(e,r,void 0),this.getStorage(r)?.delete(e,i)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(e,r){let i=[],o=this.getKeyTargets(e);for(let s of Object.keys(o))o[s]===r&&i.push(s);return i}updateKeyTarget(e,r,i,o=!1){let s=this.getKeyTargets(r);typeof i=="number"?s[e]!==i&&(s[e]=i,this.getStorage(r)?.set(bn,JSON.stringify(s),o)):typeof s[e]=="number"&&(delete s[e],this.getStorage(r)?.set(bn,JSON.stringify(s),o))}_workspaceKeyTargets=void 0;get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}_profileKeyTargets=void 0;get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}_applicationKeyTargets=void 0;get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){let r=this.getStorage(e);return r?$c(r):Object.create(null)}isNew(e){return this.getBoolean(Ua,e)===!0}async flush(e=0){this._onWillSaveState.fire({reason:e});let r=this.getStorage(-1),i=this.getStorage(0),o=this.getStorage(1);switch(e){case 0:await Zt.settled([r?.whenFlushed()??Promise.resolve(),i?.whenFlushed()??Promise.resolve(),o?.whenFlushed()??Promise.resolve()]);break;case 1:await Zt.settled([r?.flush(0)??Promise.resolve(),i?.flush(0)??Promise.resolve(),o?.flush(0)??Promise.resolve()]);break}}async log(){let e=this.getStorage(-1)?.items??new Map,r=this.getStorage(0)?.items??new Map,i=this.getStorage(1)?.items??new Map;return Lx(e,r,i,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async optimize(e){return await this.flush(),this.getStorage(e)?.optimize()}async switch(e,r){return this.emitWillSaveState(0),Cv(e)?this.switchToProfile(e,r):this.switchToWorkspace(e,r)}canSwitchProfile(e,r){return!(e.id===r.id||Fa(r)&&Fa(e))}switchData(e,r,i){this.withPausedEmitters(()=>{let o=new Set;for(let[s,a]of e)o.add(s),r.get(s)!==a&&this.emitDidChangeValue(i,{key:s,external:!0});for(let[s]of r.items)o.has(s)||this.emitDidChangeValue(i,{key:s,external:!0})})}};function Fa(n){return n.isDefault||!!n.useDefaultFlags?.globalState}async function Lx(n,t,e,r,i,o){let s=v=>{try{return JSON.parse(v)}catch{return v}},a=new Map,l=new Map;n.forEach((v,w)=>{a.set(w,v),l.set(w,s(v))});let c=new Map,d=new Map;t.forEach((v,w)=>{c.set(w,v),d.set(w,s(v))});let f=new Map,m=new Map;e.forEach((v,w)=>{f.set(w,v),m.set(w,s(v))}),console.group(r!==i?`Storage: Application (path: ${r})`:`Storage: Application & Profile (path: ${r}, default profile)`);let g=[];if(a.forEach((v,w)=>{g.push({key:w,value:v})}),console.table(g),console.groupEnd(),console.log(l),r!==i){console.group(`Storage: Profile (path: ${i}, profile specific)`);let v=[];c.forEach((w,k)=>{v.push({key:k,value:w})}),console.table(v),console.groupEnd(),console.log(d)}console.group(`Storage: Workspace (path: ${o})`);let b=[];f.forEach((v,w)=>{b.push({key:w,value:v})}),console.table(b),console.groupEnd(),console.log(m)}import vr from"electron";var Dv=R("stateReadService"),Ye=R("stateService");import Zx from"electron";function Qn(n,t){let e=Math.pow(10,t);return Math.round(n*e)/e}var ae=class{_rgbaBrand=void 0;r;g;b;a;constructor(t,e,r,i=1){this.r=Math.min(255,Math.max(0,t))|0,this.g=Math.min(255,Math.max(0,e))|0,this.b=Math.min(255,Math.max(0,r))|0,this.a=Qn(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}},Jn=class n{_hslaBrand=void 0;h;s;l;a;constructor(t,e,r,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Qn(Math.max(Math.min(1,e),0),3),this.l=Qn(Math.max(Math.min(1,r),0),3),this.a=Qn(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.l===e.l&&t.a===e.a}static fromRGBA(t){let e=t.r/255,r=t.g/255,i=t.b/255,o=t.a,s=Math.max(e,r,i),a=Math.min(e,r,i),l=0,c=0,d=(a+s)/2,f=s-a;if(f>0){switch(c=Math.min(d<=.5?f/(2*d):f/(2-2*d),1),s){case e:l=(r-i)/f+(r<i?6:0);break;case r:l=(i-e)/f+2;break;case i:l=(e-r)/f+4;break}l*=60,l=Math.round(l)}return new n(l,c,d,o)}static _hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}static toRGBA(t){let e=t.h/360,{s:r,l:i,a:o}=t,s,a,l;if(r===0)s=a=l=i;else{let c=i<.5?i*(1+r):i+r-i*r,d=2*i-c;s=n._hue2rgb(d,c,e+1/3),a=n._hue2rgb(d,c,e),l=n._hue2rgb(d,c,e-1/3)}return new ae(Math.round(s*255),Math.round(a*255),Math.round(l*255),o)}},Uo=class n{_hsvaBrand=void 0;h;s;v;a;constructor(t,e,r,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Qn(Math.max(Math.min(1,e),0),3),this.v=Qn(Math.max(Math.min(1,r),0),3),this.a=Qn(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.v===e.v&&t.a===e.a}static fromRGBA(t){let e=t.r/255,r=t.g/255,i=t.b/255,o=Math.max(e,r,i),s=Math.min(e,r,i),a=o-s,l=o===0?0:a/o,c;return a===0?c=0:o===e?c=((r-i)/a%6+6)%6:o===r?c=(i-e)/a+2:c=(e-r)/a+4,new n(Math.round(c*60),l,o,t.a)}static toRGBA(t){let{h:e,s:r,v:i,a:o}=t,s=i*r,a=s*(1-Math.abs(e/60%2-1)),l=i-s,[c,d,f]=[0,0,0];return e<60?(c=s,d=a):e<120?(c=a,d=s):e<180?(d=s,f=a):e<240?(d=a,f=s):e<300?(c=a,f=s):e<=360&&(c=s,f=a),c=Math.round((c+l)*255),d=Math.round((d+l)*255),f=Math.round((f+l)*255),new ae(c,d,f,o)}},L=class n{static fromHex(t){return n.Format.CSS.parseHex(t)||n.red}static equals(t,e){return!t&&!e?!0:!t||!e?!1:t.equals(e)}rgba;_hsla;get hsla(){return this._hsla?this._hsla:Jn.fromRGBA(this.rgba)}_hsva;get hsva(){return this._hsva?this._hsva:Uo.fromRGBA(this.rgba)}constructor(t){if(t)if(t instanceof ae)this.rgba=t;else if(t instanceof Jn)this._hsla=t,this.rgba=Jn.toRGBA(t);else if(t instanceof Uo)this._hsva=t,this.rgba=Uo.toRGBA(t);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(t){return!!t&&ae.equals(this.rgba,t.rgba)&&Jn.equals(this.hsla,t.hsla)&&Uo.equals(this.hsva,t.hsva)}getRelativeLuminance(){let t=n._relativeLuminanceForComponent(this.rgba.r),e=n._relativeLuminanceForComponent(this.rgba.g),r=n._relativeLuminanceForComponent(this.rgba.b),i=.2126*t+.7152*e+.0722*r;return Qn(i,4)}static _relativeLuminanceForComponent(t){let e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}getContrastRatio(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)}isDarker(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3<128}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e>r}isDarkerThan(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e<r}lighten(t){return new n(new Jn(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*t,this.hsla.a))}darken(t){return new n(new Jn(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*t,this.hsla.a))}transparent(t){let{r:e,g:r,b:i,a:o}=this.rgba;return new n(new ae(e,r,i,o*t))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new n(new ae(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(t){let e=t.rgba,r=this.rgba.a,i=e.a,o=r+i*(1-r);if(o<1e-6)return n.transparent;let s=this.rgba.r*r/o+e.r*i*(1-r)/o,a=this.rgba.g*r/o+e.g*i*(1-r)/o,l=this.rgba.b*r/o+e.b*i*(1-r)/o;return new n(new ae(s,a,l,o))}makeOpaque(t){if(this.isOpaque()||t.rgba.a!==1)return this;let{r:e,g:r,b:i,a:o}=this.rgba;return new n(new ae(t.rgba.r-o*(t.rgba.r-e),t.rgba.g-o*(t.rgba.g-r),t.rgba.b-o*(t.rgba.b-i),1))}flatten(...t){let e=t.reduceRight((r,i)=>n._flatten(i,r));return n._flatten(this,e)}static _flatten(t,e){let r=1-t.rgba.a;return new n(new ae(r*e.rgba.r+t.rgba.a*t.rgba.r,r*e.rgba.g+t.rgba.a*t.rgba.g,r*e.rgba.b+t.rgba.a*t.rgba.b))}_toString;toString(){return this._toString||(this._toString=n.Format.CSS.format(this)),this._toString}static getLighterColor(t,e,r){if(t.isLighterThan(e))return t;r=r||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return r=r*(o-i)/o,t.lighten(r)}static getDarkerColor(t,e,r){if(t.isDarkerThan(e))return t;r=r||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return r=r*(i-o)/i,t.darken(r)}static white=new n(new ae(255,255,255,1));static black=new n(new ae(0,0,0,1));static red=new n(new ae(255,0,0,1));static blue=new n(new ae(0,0,255,1));static green=new n(new ae(0,255,0,1));static cyan=new n(new ae(0,255,255,1));static lightgrey=new n(new ae(211,211,211,1));static transparent=new n(new ae(0,0,0,0))};(t=>{let n;(r=>{let e;(b=>{function i(v){return v.rgba.a===1?`rgb(${v.rgba.r}, ${v.rgba.g}, ${v.rgba.b})`:t.Format.CSS.formatRGBA(v)}b.formatRGB=i;function o(v){return`rgba(${v.rgba.r}, ${v.rgba.g}, ${v.rgba.b}, ${+v.rgba.a.toFixed(2)})`}b.formatRGBA=o;function s(v){return v.hsla.a===1?`hsl(${v.hsla.h}, ${(v.hsla.s*100).toFixed(2)}%, ${(v.hsla.l*100).toFixed(2)}%)`:t.Format.CSS.formatHSLA(v)}b.formatHSL=s;function a(v){return`hsla(${v.hsla.h}, ${(v.hsla.s*100).toFixed(2)}%, ${(v.hsla.l*100).toFixed(2)}%, ${v.hsla.a.toFixed(2)})`}b.formatHSLA=a;function l(v){let w=v.toString(16);return w.length!==2?"0"+w:w}function c(v){return`#${l(v.rgba.r)}${l(v.rgba.g)}${l(v.rgba.b)}`}b.formatHex=c;function d(v,w=!1){return w&&v.rgba.a===1?t.Format.CSS.formatHex(v):`#${l(v.rgba.r)}${l(v.rgba.g)}${l(v.rgba.b)}${l(Math.round(v.rgba.a*255))}`}b.formatHexA=d;function f(v){return v.isOpaque()?t.Format.CSS.formatHex(v):t.Format.CSS.formatRGBA(v)}b.format=f;function m(v){let w=v.length;if(w===0||v.charCodeAt(0)!==35)return null;if(w===7){let k=16*g(v.charCodeAt(1))+g(v.charCodeAt(2)),C=16*g(v.charCodeAt(3))+g(v.charCodeAt(4)),M=16*g(v.charCodeAt(5))+g(v.charCodeAt(6));return new t(new ae(k,C,M,1))}if(w===9){let k=16*g(v.charCodeAt(1))+g(v.charCodeAt(2)),C=16*g(v.charCodeAt(3))+g(v.charCodeAt(4)),M=16*g(v.charCodeAt(5))+g(v.charCodeAt(6)),_=16*g(v.charCodeAt(7))+g(v.charCodeAt(8));return new t(new ae(k,C,M,_/255))}if(w===4){let k=g(v.charCodeAt(1)),C=g(v.charCodeAt(2)),M=g(v.charCodeAt(3));return new t(new ae(16*k+k,16*C+C,16*M+M))}if(w===5){let k=g(v.charCodeAt(1)),C=g(v.charCodeAt(2)),M=g(v.charCodeAt(3)),_=g(v.charCodeAt(4));return new t(new ae(16*k+k,16*C+C,16*M+M,(16*_+_)/255))}return null}b.parseHex=m;function g(v){switch(v){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(e=r.CSS||={})})(n=t.Format||={})})(L||={});function Ox(n){return n!==null&&typeof n=="object"&&"light"in n&&"dark"in n}var Ax={ColorContribution:"base.contributions.colors"},Mx="default",df=class{_onDidChangeSchema=new S;onDidChangeSchema=this._onDidChangeSchema.event;colorsById;colorSchema={type:"object",properties:{}};colorReferenceSchema={type:"string",enum:[],enumDescriptions:[]};constructor(){this.colorsById={}}notifyThemeUpdate(t){for(let e of Object.keys(this.colorsById)){let r=t.getColor(e);r&&(this.colorSchema.properties[e].oneOf[0].defaultSnippets[0].body=`\${1:${r.toString()}}`)}this._onDidChangeSchema.fire()}registerColor(t,e,r,i=!1,o){let s={id:t,description:r,defaults:e,needsTransparency:i,deprecationMessage:o};this.colorsById[t]=s;let a={type:"string",format:"color-hex",defaultSnippets:[{body:"${1:#ff0000}"}]};return o&&(a.deprecationMessage=o),i&&(a.pattern="^#(?:(?<rgba>[0-9a-fA-f]{3}[0-9a-eA-E])|(?:[0-9a-fA-F]{6}(?:(?![fF]{2})(?:[0-9a-fA-F]{2}))))?$",a.patternErrorMessage=p("transparecyRequired","This color must be transparent or it will obscure content")),this.colorSchema.properties[t]={description:r,oneOf:[a,{type:"string",const:Mx,description:p("useDefault","Use the default color.")}]},this.colorReferenceSchema.enum.push(t),this.colorReferenceSchema.enumDescriptions.push(r),this._onDidChangeSchema.fire(),t}deregisterColor(t){delete this.colorsById[t],delete this.colorSchema.properties[t];let e=this.colorReferenceSchema.enum.indexOf(t);e!==-1&&(this.colorReferenceSchema.enum.splice(e,1),this.colorReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChangeSchema.fire()}getColors(){return Object.keys(this.colorsById).map(t=>this.colorsById[t])}resolveDefaultColor(t,e){let r=this.colorsById[t];if(r?.defaults){let i=Ox(r.defaults)?r.defaults[e.type]:r.defaults;return Wr(i,e)}}getColorSchema(){return this.colorSchema}getColorReferenceSchema(){return this.colorReferenceSchema}toString(){let t=(e,r)=>{let i=e.indexOf(".")===-1?0:1,o=r.indexOf(".")===-1?0:1;return i!==o?i-o:e.localeCompare(r)};return Object.keys(this.colorsById).sort(t).map(e=>`- \`${e}\`: ${this.colorsById[e].description}`).join(`
`)}},jc=new df;et.add(Ax.ColorContribution,jc);function y(n,t,e,r,i){return jc.registerColor(n,t,e,r,i)}function Wx(n,t){switch(n.op){case 0:return Wr(n.value,t)?.darken(n.factor);case 1:return Wr(n.value,t)?.lighten(n.factor);case 2:return Wr(n.value,t)?.transparent(n.factor);case 3:{let e=Wr(n.background,t);return e?Wr(n.value,t)?.makeOpaque(e):Wr(n.value,t)}case 4:for(let e of n.values){let r=Wr(e,t);if(r)return r}return;case 6:return Wr(t.defines(n.if)?n.then:n.else,t);case 5:{let e=Wr(n.value,t);if(!e)return;let r=Wr(n.background,t);return r?e.isDarkerThan(r)?L.getLighterColor(e,r,n.factor).transparent(n.transparency):L.getDarkerColor(e,r,n.factor).transparent(n.transparency):e.transparent(n.factor*n.transparency)}default:throw Ah(n)}}function Zr(n,t){return{op:0,value:n,factor:t}}function rr(n,t){return{op:1,value:n,factor:t}}function J(n,t){return{op:2,value:n,factor:t}}function uf(...n){return{op:4,values:n}}function Lv(n,t,e){return{op:6,if:n,then:t,else:e}}function pf(n,t,e,r){return{op:5,value:n,background:t,factor:e,transparency:r}}function Wr(n,t){if(n!==null){if(typeof n=="string")return n[0]==="#"?L.fromHex(n):t.getColor(n);if(n instanceof L)return n;if(typeof n=="object")return Wx(n,t)}}var Ov="vscode://schemas/workbench-colors",Av=et.as(Ni.JSONContribution);Av.registerSchema(Ov,jc.getColorSchema());var Rv=new bt(()=>Av.notifySchemaChanged(Ov),200);jc.onDidChangeSchema(()=>{Rv.isScheduled()||Rv.schedule()});var fe=y("foreground",{dark:"#CCCCCC",light:"#616161",hcDark:"#FFFFFF",hcLight:"#292929"},p("foreground","Overall foreground color. This color is only used if not overridden by a component.")),TW=y("disabledForeground",{dark:"#CCCCCC80",light:"#61616180",hcDark:"#A5A5A5",hcLight:"#7F7F7F"},p("disabledForeground","Overall foreground for disabled elements. This color is only used if not overridden by a component.")),kW=y("errorForeground",{dark:"#F48771",light:"#A1260D",hcDark:"#F48771",hcLight:"#B5200D"},p("errorForeground","Overall foreground color for error messages. This color is only used if not overridden by a component.")),CW=y("descriptionForeground",{light:"#717171",dark:J(fe,.7),hcDark:J(fe,.7),hcLight:J(fe,.7)},p("descriptionForeground","Foreground color for description text providing additional information, for example for a label.")),Na=y("icon.foreground",{dark:"#C5C5C5",light:"#424242",hcDark:"#FFFFFF",hcLight:"#292929"},p("iconForeground","The default color for icons in the workbench.")),Er=y("focusBorder",{dark:"#007FD4",light:"#0090F1",hcDark:"#F38518",hcLight:"#006BBD"},p("focusBorder","Overall border color for focused elements. This color is only used if not overridden by a component.")),me=y("contrastBorder",{light:null,dark:null,hcDark:"#6FC3DF",hcLight:"#0F4A85"},p("contrastBorder","An extra border around elements to separate them from others for greater contrast.")),kt=y("contrastActiveBorder",{light:null,dark:null,hcDark:Er,hcLight:Er},p("activeContrastBorder","An extra border around active elements to separate them from others for greater contrast.")),_W=y("selection.background",null,p("selectionBackground","The background color of text selections in the workbench (e.g. for input fields or text areas). Note that this does not apply to selections within the editor.")),DW=y("textLink.foreground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},p("textLinkForeground","Foreground color for links in text.")),RW=y("textLink.activeForeground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},p("textLinkActiveForeground","Foreground color for links in text when clicked on and on mouse hover.")),LW=y("textSeparator.foreground",{light:"#0000002e",dark:"#ffffff2e",hcDark:L.black,hcLight:"#292929"},p("textSeparatorForeground","Color for text separators.")),OW=y("textPreformat.foreground",{light:"#A31515",dark:"#D7BA7D",hcDark:"#000000",hcLight:"#FFFFFF"},p("textPreformatForeground","Foreground color for preformatted text segments.")),AW=y("textPreformat.background",{light:"#0000001A",dark:"#FFFFFF1A",hcDark:"#FFFFFF",hcLight:"#09345f"},p("textPreformatBackground","Background color for preformatted text segments.")),MW=y("textBlockQuote.background",{light:"#f2f2f2",dark:"#222222",hcDark:null,hcLight:"#F2F2F2"},p("textBlockQuoteBackground","Background color for block quotes in text.")),WW=y("textBlockQuote.border",{light:"#007acc80",dark:"#007acc80",hcDark:L.white,hcLight:"#292929"},p("textBlockQuoteBorder","Border color for block quotes in text.")),FW=y("textCodeBlock.background",{light:"#dcdcdc66",dark:"#0a0a0a66",hcDark:L.black,hcLight:"#F2F2F2"},p("textCodeBlockBackground","Background color for code blocks in text."));var KW=y("sash.hoverBorder",Er,p("sashActiveBorder","Border color of active sashes.")),Gc=y("badge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:L.black,hcLight:"#0F4A85"},p("badgeBackground","Badge background color. Badges are small information labels, e.g. for search results count.")),HW=y("badge.foreground",{dark:L.white,light:"#333",hcDark:L.white,hcLight:L.white},p("badgeForeground","Badge foreground color. Badges are small information labels, e.g. for search results count.")),Mv=y("scrollbar.shadow",{dark:"#000000",light:"#DDDDDD",hcDark:null,hcLight:null},p("scrollbarShadow","Scrollbar shadow to indicate that the view is scrolled.")),Wv=y("scrollbarSlider.background",{dark:L.fromHex("#797979").transparent(.4),light:L.fromHex("#646464").transparent(.4),hcDark:J(me,.6),hcLight:J(me,.4)},p("scrollbarSliderBackground","Scrollbar slider background color.")),Fv=y("scrollbarSlider.hoverBackground",{dark:L.fromHex("#646464").transparent(.7),light:L.fromHex("#646464").transparent(.7),hcDark:J(me,.8),hcLight:J(me,.8)},p("scrollbarSliderHoverBackground","Scrollbar slider background color when hovering.")),Uv=y("scrollbarSlider.activeBackground",{dark:L.fromHex("#BFBFBF").transparent(.4),light:L.fromHex("#000000").transparent(.6),hcDark:me,hcLight:me},p("scrollbarSliderActiveBackground","Scrollbar slider background color when clicked on.")),zW=y("progressBar.background",{dark:L.fromHex("#0E70C0"),light:L.fromHex("#0E70C0"),hcDark:me,hcLight:me},p("progressBarBackground","Background color of the progress bar that can show for long running operations."));var Jc=y("editor.background",{light:"#ffffff",dark:"#1E1E1E",hcDark:L.black,hcLight:L.white},p("editorBackground","Editor background color.")),QW=y("editor.foreground",{light:"#333333",dark:"#BBBBBB",hcDark:L.white,hcLight:fe},p("editorForeground","Editor default foreground color.")),YW=y("editorStickyScroll.background",Jc,p("editorStickyScrollBackground","Background color of sticky scroll in the editor")),XW=y("editorStickyScrollHover.background",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:null,hcLight:L.fromHex("#0F4A85").transparent(.1)},p("editorStickyScrollHoverBackground","Background color of sticky scroll on hover in the editor")),ZW=y("editorStickyScroll.border",{dark:null,light:null,hcDark:me,hcLight:me},p("editorStickyScrollBorder","Border color of sticky scroll in the editor")),eF=y("editorStickyScroll.shadow",Mv,p("editorStickyScrollShadow"," Shadow color of sticky scroll in the editor")),nr=y("editorWidget.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#0C141F",hcLight:L.white},p("editorWidgetBackground","Background color of editor widgets, such as find/replace.")),Ba=y("editorWidget.foreground",fe,p("editorWidgetForeground","Foreground color of editor widgets, such as find/replace.")),Fx=y("editorWidget.border",{dark:"#454545",light:"#C8C8C8",hcDark:me,hcLight:me},p("editorWidgetBorder","Border color of editor widgets. The color is only used if the widget chooses to have a border and if the color is not overridden by a widget.")),tF=y("editorWidget.resizeBorder",null,p("editorWidgetResizeBorder","Border color of the resize bar of editor widgets. The color is only used if the widget chooses to have a resize border and if the color is not overridden by a widget.")),rF=y("editorError.background",null,p("editorError.background","Background color of error text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),gf=y("editorError.foreground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F48771",hcLight:"#B5200D"},p("editorError.foreground","Foreground color of error squigglies in the editor.")),nF=y("editorError.border",{dark:null,light:null,hcDark:L.fromHex("#E47777").transparent(.8),hcLight:"#B5200D"},p("errorBorder","If set, color of double underlines for errors in the editor.")),iF=y("editorWarning.background",null,p("editorWarning.background","Background color of warning text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Ko=y("editorWarning.foreground",{dark:"#CCA700",light:"#BF8803",hcDark:"#FFD370",hcLight:"#895503"},p("editorWarning.foreground","Foreground color of warning squigglies in the editor.")),vf=y("editorWarning.border",{dark:null,light:null,hcDark:L.fromHex("#FFCC00").transparent(.8),hcLight:L.fromHex("#FFCC00").transparent(.8)},p("warningBorder","If set, color of double underlines for warnings in the editor.")),oF=y("editorInfo.background",null,p("editorInfo.background","Background color of info text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Ho=y("editorInfo.foreground",{dark:"#3794FF",light:"#1a85ff",hcDark:"#3794FF",hcLight:"#1a85ff"},p("editorInfo.foreground","Foreground color of info squigglies in the editor.")),yf=y("editorInfo.border",{dark:null,light:null,hcDark:L.fromHex("#3794FF").transparent(.8),hcLight:"#292929"},p("infoBorder","If set, color of double underlines for infos in the editor.")),sF=y("editorHint.foreground",{dark:L.fromHex("#eeeeee").transparent(.7),light:"#6c6c6c",hcDark:null,hcLight:null},p("editorHint.foreground","Foreground color of hint squigglies in the editor.")),aF=y("editorHint.border",{dark:null,light:null,hcDark:L.fromHex("#eeeeee").transparent(.8),hcLight:"#292929"},p("hintBorder","If set, color of double underlines for hints in the editor.")),lF=y("editorLink.activeForeground",{dark:"#4E94CE",light:L.blue,hcDark:L.cyan,hcLight:"#292929"},p("activeLinkForeground","Color of active links.")),No=y("editor.selectionBackground",{light:"#ADD6FF",dark:"#264F78",hcDark:"#f3f518",hcLight:"#0F4A85"},p("editorSelectionBackground","Color of the editor selection.")),cF=y("editor.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:L.white},p("editorSelectionForeground","Color of the selected text for high contrast.")),dF=y("editor.inactiveSelectionBackground",{light:J(No,.5),dark:J(No,.5),hcDark:J(No,.7),hcLight:J(No,.5)},p("editorInactiveSelection","Color of the selection in an inactive editor. The color must not be opaque so as not to hide underlying decorations."),!0),uF=y("editor.selectionHighlightBackground",{light:pf(No,Jc,.3,.6),dark:pf(No,Jc,.3,.6),hcDark:null,hcLight:null},p("editorSelectionHighlight","Color for regions with the same content as the selection. The color must not be opaque so as not to hide underlying decorations."),!0),pF=y("editor.selectionHighlightBorder",{light:null,dark:null,hcDark:kt,hcLight:kt},p("editorSelectionHighlightBorder","Border color for regions with the same content as the selection.")),fF=y("editor.findMatchBackground",{light:"#A8AC94",dark:"#515C6A",hcDark:null,hcLight:null},p("editorFindMatch","Color of the current search match.")),mF=y("editor.findMatchForeground",null,p("editorFindMatchForeground","Text color of the current search match.")),Yn=y("editor.findMatchHighlightBackground",{light:"#EA5C0055",dark:"#EA5C0055",hcDark:null,hcLight:null},p("findMatchHighlight","Color of the other search matches. The color must not be opaque so as not to hide underlying decorations."),!0),hF=y("editor.findMatchHighlightForeground",null,p("findMatchHighlightForeground","Foreground color of the other search matches."),!0),gF=y("editor.findRangeHighlightBackground",{dark:"#3a3d4166",light:"#b4b4b44d",hcDark:null,hcLight:null},p("findRangeHighlight","Color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),vF=y("editor.findMatchBorder",{light:null,dark:null,hcDark:kt,hcLight:kt},p("editorFindMatchBorder","Border color of the current search match.")),Xn=y("editor.findMatchHighlightBorder",{light:null,dark:null,hcDark:kt,hcLight:kt},p("findMatchHighlightBorder","Border color of the other search matches.")),yF=y("editor.findRangeHighlightBorder",{dark:null,light:null,hcDark:J(kt,.4),hcLight:J(kt,.4)},p("findRangeHighlightBorder","Border color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),bF=y("editor.hoverHighlightBackground",{light:"#ADD6FF26",dark:"#264f7840",hcDark:"#ADD6FF26",hcLight:null},p("hoverHighlight","Highlight below the word for which a hover is shown. The color must not be opaque so as not to hide underlying decorations."),!0),Nv=y("editorHoverWidget.background",nr,p("hoverBackground","Background color of the editor hover.")),IF=y("editorHoverWidget.foreground",Ba,p("hoverForeground","Foreground color of the editor hover.")),wF=y("editorHoverWidget.border",Fx,p("hoverBorder","Border color of the editor hover.")),xF=y("editorHoverWidget.statusBarBackground",{dark:rr(Nv,.2),light:Zr(Nv,.05),hcDark:nr,hcLight:nr},p("statusBarBackground","Background color of the editor hover status bar.")),$v=y("editorInlayHint.foreground",{dark:"#969696",light:"#969696",hcDark:L.white,hcLight:L.black},p("editorInlayHintForeground","Foreground color of inline hints")),jv=y("editorInlayHint.background",{dark:J(Gc,.1),light:J(Gc,.1),hcDark:J(L.white,.1),hcLight:J(Gc,.1)},p("editorInlayHintBackground","Background color of inline hints")),SF=y("editorInlayHint.typeForeground",$v,p("editorInlayHintForegroundTypes","Foreground color of inline hints for types")),EF=y("editorInlayHint.typeBackground",jv,p("editorInlayHintBackgroundTypes","Background color of inline hints for types")),PF=y("editorInlayHint.parameterForeground",$v,p("editorInlayHintForegroundParameter","Foreground color of inline hints for parameters")),TF=y("editorInlayHint.parameterBackground",jv,p("editorInlayHintBackgroundParameter","Background color of inline hints for parameters")),Ux=y("editorLightBulb.foreground",{dark:"#FFCC00",light:"#DDB100",hcDark:"#FFCC00",hcLight:"#007ACC"},p("editorLightBulbForeground","The color used for the lightbulb actions icon.")),kF=y("editorLightBulbAutoFix.foreground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},p("editorLightBulbAutoFixForeground","The color used for the lightbulb auto fix actions icon.")),CF=y("editorLightBulbAi.foreground",Ux,p("editorLightBulbAiForeground","The color used for the lightbulb AI icon.")),_F=y("editor.snippetTabstopHighlightBackground",{dark:new L(new ae(124,124,124,.3)),light:new L(new ae(10,50,100,.2)),hcDark:new L(new ae(124,124,124,.3)),hcLight:new L(new ae(10,50,100,.2))},p("snippetTabstopHighlightBackground","Highlight background color of a snippet tabstop.")),DF=y("editor.snippetTabstopHighlightBorder",null,p("snippetTabstopHighlightBorder","Highlight border color of a snippet tabstop.")),RF=y("editor.snippetFinalTabstopHighlightBackground",null,p("snippetFinalTabstopHighlightBackground","Highlight background color of the final tabstop of a snippet.")),LF=y("editor.snippetFinalTabstopHighlightBorder",{dark:"#525252",light:new L(new ae(10,50,100,.5)),hcDark:"#525252",hcLight:"#292929"},p("snippetFinalTabstopHighlightBorder","Highlight border color of the final tabstop of a snippet.")),Bv=new L(new ae(155,185,85,.2)),Vv=new L(new ae(255,0,0,.2)),OF=y("diffEditor.insertedTextBackground",{dark:"#9ccc2c33",light:"#9ccc2c40",hcDark:null,hcLight:null},p("diffEditorInserted","Background color for text that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),AF=y("diffEditor.removedTextBackground",{dark:"#ff000033",light:"#ff000033",hcDark:null,hcLight:null},p("diffEditorRemoved","Background color for text that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),MF=y("diffEditor.insertedLineBackground",{dark:Bv,light:Bv,hcDark:null,hcLight:null},p("diffEditorInsertedLines","Background color for lines that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),WF=y("diffEditor.removedLineBackground",{dark:Vv,light:Vv,hcDark:null,hcLight:null},p("diffEditorRemovedLines","Background color for lines that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),FF=y("diffEditorGutter.insertedLineBackground",null,p("diffEditorInsertedLineGutter","Background color for the margin where lines got inserted.")),UF=y("diffEditorGutter.removedLineBackground",null,p("diffEditorRemovedLineGutter","Background color for the margin where lines got removed.")),NF=y("diffEditorOverview.insertedForeground",null,p("diffEditorOverviewInserted","Diff overview ruler foreground for inserted content.")),BF=y("diffEditorOverview.removedForeground",null,p("diffEditorOverviewRemoved","Diff overview ruler foreground for removed content.")),VF=y("diffEditor.insertedTextBorder",{dark:null,light:null,hcDark:"#33ff2eff",hcLight:"#374E06"},p("diffEditorInsertedOutline","Outline color for the text that got inserted.")),KF=y("diffEditor.removedTextBorder",{dark:null,light:null,hcDark:"#FF008F",hcLight:"#AD0707"},p("diffEditorRemovedOutline","Outline color for text that got removed.")),HF=y("diffEditor.border",{dark:null,light:null,hcDark:me,hcLight:me},p("diffEditorBorder","Border color between the two text editors.")),zF=y("diffEditor.diagonalFill",{dark:"#cccccc33",light:"#22222233",hcDark:null,hcLight:null},p("diffDiagonalFill","Color of the diff editor's diagonal fill. The diagonal fill is used in side-by-side diff views.")),qF=y("diffEditor.unchangedRegionBackground","sideBar.background",p("diffEditor.unchangedRegionBackground","The background color of unchanged blocks in the diff editor.")),$F=y("diffEditor.unchangedRegionForeground","foreground",p("diffEditor.unchangedRegionForeground","The foreground color of unchanged blocks in the diff editor.")),jF=y("diffEditor.unchangedCodeBackground",{dark:"#74747429",light:"#b8b8b829",hcDark:null,hcLight:null},p("diffEditor.unchangedCodeBackground","The background color of unchanged code in the diff editor.")),Gv=y("widget.shadow",{dark:J(L.black,.36),light:J(L.black,.16),hcDark:null,hcLight:null},p("widgetShadow","Shadow color of widgets such as find/replace inside the editor.")),GF=y("widget.border",{dark:null,light:null,hcDark:me,hcLight:me},p("widgetBorder","Border color of widgets such as find/replace inside the editor.")),Kv=y("toolbar.hoverBackground",{dark:"#5a5d5e50",light:"#b8b8b850",hcDark:null,hcLight:null},p("toolbarHoverBackground","Toolbar background when hovering over actions using the mouse")),JF=y("toolbar.hoverOutline",{dark:null,light:null,hcDark:kt,hcLight:kt},p("toolbarHoverOutline","Toolbar outline when hovering over actions using the mouse")),QF=y("toolbar.activeBackground",{dark:rr(Kv,.1),light:Zr(Kv,.1),hcDark:null,hcLight:null},p("toolbarActiveBackground","Toolbar background when holding the mouse over actions")),YF=y("breadcrumb.foreground",J(fe,.8),p("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),XF=y("breadcrumb.background",Jc,p("breadcrumbsBackground","Background color of breadcrumb items.")),ZF=y("breadcrumb.focusForeground",{light:Zr(fe,.2),dark:rr(fe,.1),hcDark:rr(fe,.1),hcLight:rr(fe,.1)},p("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),e7=y("breadcrumb.activeSelectionForeground",{light:Zr(fe,.2),dark:rr(fe,.1),hcDark:rr(fe,.1),hcLight:rr(fe,.1)},p("breadcrumbsSelectedForeground","Color of selected breadcrumb items.")),t7=y("breadcrumbPicker.background",nr,p("breadcrumbsSelectedBackground","Background color of breadcrumb item picker.")),Jv=.5,Hv=L.fromHex("#40C8AE").transparent(Jv),zv=L.fromHex("#40A6FF").transparent(Jv),qv=L.fromHex("#606060").transparent(.4),bf=.4,Bo=1,ff=y("merge.currentHeaderBackground",{dark:Hv,light:Hv,hcDark:null,hcLight:null},p("mergeCurrentHeaderBackground","Current header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),r7=y("merge.currentContentBackground",J(ff,bf),p("mergeCurrentContentBackground","Current content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),mf=y("merge.incomingHeaderBackground",{dark:zv,light:zv,hcDark:null,hcLight:null},p("mergeIncomingHeaderBackground","Incoming header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),n7=y("merge.incomingContentBackground",J(mf,bf),p("mergeIncomingContentBackground","Incoming content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),hf=y("merge.commonHeaderBackground",{dark:qv,light:qv,hcDark:null,hcLight:null},p("mergeCommonHeaderBackground","Common ancestor header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),i7=y("merge.commonContentBackground",J(hf,bf),p("mergeCommonContentBackground","Common ancestor content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),Vo=y("merge.border",{dark:null,light:null,hcDark:"#C3DF6F",hcLight:"#007ACC"},p("mergeBorder","Border color on headers and the splitter in inline merge-conflicts.")),o7=y("editorOverviewRuler.currentContentForeground",{dark:J(ff,Bo),light:J(ff,Bo),hcDark:Vo,hcLight:Vo},p("overviewRulerCurrentContentForeground","Current overview ruler foreground for inline merge-conflicts.")),s7=y("editorOverviewRuler.incomingContentForeground",{dark:J(mf,Bo),light:J(mf,Bo),hcDark:Vo,hcLight:Vo},p("overviewRulerIncomingContentForeground","Incoming overview ruler foreground for inline merge-conflicts.")),a7=y("editorOverviewRuler.commonContentForeground",{dark:J(hf,Bo),light:J(hf,Bo),hcDark:Vo,hcLight:Vo},p("overviewRulerCommonContentForeground","Common ancestor overview ruler foreground for inline merge-conflicts.")),l7=y("editorOverviewRuler.findMatchForeground",{dark:"#d186167e",light:"#d186167e",hcDark:"#AB5A00",hcLight:"#AB5A00"},p("overviewRulerFindMatchForeground","Overview ruler marker color for find matches. The color must not be opaque so as not to hide underlying decorations."),!0),c7=y("editorOverviewRuler.selectionHighlightForeground","#A0A0A0CC",p("overviewRulerSelectionHighlightForeground","Overview ruler marker color for selection highlights. The color must not be opaque so as not to hide underlying decorations."),!0),d7=y("problemsErrorIcon.foreground",gf,p("problemsErrorIconForeground","The color used for the problems error icon.")),u7=y("problemsWarningIcon.foreground",Ko,p("problemsWarningIconForeground","The color used for the problems warning icon.")),p7=y("problemsInfoIcon.foreground",Ho,p("problemsInfoIconForeground","The color used for the problems info icon."));var Qv=y("minimap.findMatchHighlight",{light:"#d18616",dark:"#d18616",hcDark:"#AB5A00",hcLight:"#0F4A85"},p("minimapFindMatchHighlight","Minimap marker color for find matches."),!0),y7=y("minimap.selectionOccurrenceHighlight",{light:"#c9c9c9",dark:"#676767",hcDark:"#ffffff",hcLight:"#0F4A85"},p("minimapSelectionOccurrenceHighlight","Minimap marker color for repeating editor selections."),!0),b7=y("minimap.selectionHighlight",{light:"#ADD6FF",dark:"#264F78",hcDark:"#ffffff",hcLight:"#0F4A85"},p("minimapSelectionHighlight","Minimap marker color for the editor selection."),!0),I7=y("minimap.infoHighlight",{dark:Ho,light:Ho,hcDark:yf,hcLight:yf},p("minimapInfo","Minimap marker color for infos.")),w7=y("minimap.warningHighlight",{dark:Ko,light:Ko,hcDark:vf,hcLight:vf},p("overviewRuleWarning","Minimap marker color for warnings.")),x7=y("minimap.errorHighlight",{dark:new L(new ae(255,18,18,.7)),light:new L(new ae(255,18,18,.7)),hcDark:new L(new ae(255,50,50,1)),hcLight:"#B5200D"},p("minimapError","Minimap marker color for errors.")),S7=y("minimap.background",null,p("minimapBackground","Minimap background color.")),E7=y("minimap.foregroundOpacity",L.fromHex("#000f"),p("minimapForegroundOpacity",'Opacity of foreground elements rendered in the minimap. For example, "#000000c0" will render the elements with 75% opacity.')),P7=y("minimapSlider.background",J(Wv,.5),p("minimapSliderBackground","Minimap slider background color.")),T7=y("minimapSlider.hoverBackground",J(Fv,.5),p("minimapSliderHoverBackground","Minimap slider background color when hovering.")),k7=y("minimapSlider.activeBackground",J(Uv,.5),p("minimapSliderActiveBackground","Minimap slider background color when clicked on."));var O7=y("charts.foreground",fe,p("chartsForeground","The foreground color used in charts.")),A7=y("charts.lines",J(fe,.5),p("chartsLines","The color used for horizontal lines in charts.")),M7=y("charts.red",gf,p("chartsRed","The red color used in chart visualizations.")),W7=y("charts.blue",Ho,p("chartsBlue","The blue color used in chart visualizations.")),F7=y("charts.yellow",Ko,p("chartsYellow","The yellow color used in chart visualizations.")),U7=y("charts.orange",Qv,p("chartsOrange","The orange color used in chart visualizations.")),N7=y("charts.green",{dark:"#89D185",light:"#388A34",hcDark:"#89D185",hcLight:"#374e06"},p("chartsGreen","The green color used in chart visualizations.")),B7=y("charts.purple",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},p("chartsPurple","The purple color used in chart visualizations."));var $7=y("input.background",{dark:"#3C3C3C",light:L.white,hcDark:L.black,hcLight:L.white},p("inputBoxBackground","Input box background.")),j7=y("input.foreground",fe,p("inputBoxForeground","Input box foreground.")),G7=y("input.border",{dark:null,light:null,hcDark:me,hcLight:me},p("inputBoxBorder","Input box border.")),Nx=y("inputOption.activeBorder",{dark:"#007ACC",light:"#007ACC",hcDark:me,hcLight:me},p("inputBoxActiveOptionBorder","Border color of activated options in input fields.")),Bx=y("inputOption.hoverBackground",{dark:"#5a5d5e80",light:"#b8b8b850",hcDark:null,hcLight:null},p("inputOption.hoverBackground","Background color of activated options in input fields.")),Vx=y("inputOption.activeBackground",{dark:J(Er,.4),light:J(Er,.2),hcDark:L.transparent,hcLight:L.transparent},p("inputOption.activeBackground","Background hover color of options in input fields.")),Kx=y("inputOption.activeForeground",{dark:L.white,light:L.black,hcDark:fe,hcLight:fe},p("inputOption.activeForeground","Foreground color of activated options in input fields.")),J7=y("input.placeholderForeground",{light:J(fe,.5),dark:J(fe,.5),hcDark:J(fe,.7),hcLight:J(fe,.7)},p("inputPlaceholderForeground","Input box foreground color for placeholder text.")),Q7=y("inputValidation.infoBackground",{dark:"#063B49",light:"#D6ECF2",hcDark:L.black,hcLight:L.white},p("inputValidationInfoBackground","Input validation background color for information severity.")),Y7=y("inputValidation.infoForeground",{dark:null,light:null,hcDark:null,hcLight:fe},p("inputValidationInfoForeground","Input validation foreground color for information severity.")),X7=y("inputValidation.infoBorder",{dark:"#007acc",light:"#007acc",hcDark:me,hcLight:me},p("inputValidationInfoBorder","Input validation border color for information severity.")),Z7=y("inputValidation.warningBackground",{dark:"#352A05",light:"#F6F5D2",hcDark:L.black,hcLight:L.white},p("inputValidationWarningBackground","Input validation background color for warning severity.")),e9=y("inputValidation.warningForeground",{dark:null,light:null,hcDark:null,hcLight:fe},p("inputValidationWarningForeground","Input validation foreground color for warning severity.")),t9=y("inputValidation.warningBorder",{dark:"#B89500",light:"#B89500",hcDark:me,hcLight:me},p("inputValidationWarningBorder","Input validation border color for warning severity.")),r9=y("inputValidation.errorBackground",{dark:"#5A1D1D",light:"#F2DEDE",hcDark:L.black,hcLight:L.white},p("inputValidationErrorBackground","Input validation background color for error severity.")),n9=y("inputValidation.errorForeground",{dark:null,light:null,hcDark:null,hcLight:fe},p("inputValidationErrorForeground","Input validation foreground color for error severity.")),i9=y("inputValidation.errorBorder",{dark:"#BE1100",light:"#BE1100",hcDark:me,hcLight:me},p("inputValidationErrorBorder","Input validation border color for error severity.")),Xc=y("dropdown.background",{dark:"#3C3C3C",light:L.white,hcDark:L.black,hcLight:L.white},p("dropdownBackground","Dropdown background.")),o9=y("dropdown.listBackground",{dark:null,light:null,hcDark:L.black,hcLight:L.white},p("dropdownListBackground","Dropdown list background.")),If=y("dropdown.foreground",{dark:"#F0F0F0",light:fe,hcDark:L.white,hcLight:fe},p("dropdownForeground","Dropdown foreground.")),Hx=y("dropdown.border",{dark:Xc,light:"#CECECE",hcDark:me,hcLight:me},p("dropdownBorder","Dropdown border.")),zx=y("button.foreground",L.white,p("buttonForeground","Button foreground color.")),s9=y("button.separator",J(zx,.4),p("buttonSeparator","Button separator color.")),Qc=y("button.background",{dark:"#0E639C",light:"#007ACC",hcDark:null,hcLight:"#0F4A85"},p("buttonBackground","Button background color.")),a9=y("button.hoverBackground",{dark:rr(Qc,.2),light:Zr(Qc,.2),hcDark:Qc,hcLight:Qc},p("buttonHoverBackground","Button background color when hovering.")),l9=y("button.border",me,p("buttonBorder","Button border color.")),c9=y("button.secondaryForeground",{dark:L.white,light:L.white,hcDark:L.white,hcLight:fe},p("buttonSecondaryForeground","Secondary button foreground color.")),Yv=y("button.secondaryBackground",{dark:"#3A3D41",light:"#5F6A79",hcDark:null,hcLight:L.white},p("buttonSecondaryBackground","Secondary button background color.")),d9=y("button.secondaryHoverBackground",{dark:rr(Yv,.2),light:Zr(Yv,.2),hcDark:null,hcLight:null},p("buttonSecondaryHoverBackground","Secondary button background color when hovering.")),Yc=y("radio.activeForeground",Kx,p("radioActiveForeground","Foreground color of active radio option.")),u9=y("radio.activeBackground",Vx,p("radioBackground","Background color of active radio option.")),p9=y("radio.activeBorder",Nx,p("radioActiveBorder","Border color of the active radio option.")),f9=y("radio.inactiveForeground",null,p("radioInactiveForeground","Foreground color of inactive radio option.")),m9=y("radio.inactiveBackground",null,p("radioInactiveBackground","Background color of inactive radio option.")),h9=y("radio.inactiveBorder",{light:J(Yc,.2),dark:J(Yc,.2),hcDark:J(Yc,.4),hcLight:J(Yc,.2)},p("radioInactiveBorder","Border color of the inactive radio option.")),g9=y("radio.inactiveHoverBackground",Bx,p("radioHoverBackground","Background color of inactive active radio option when hovering.")),v9=y("checkbox.background",Xc,p("checkbox.background","Background color of checkbox widget.")),y9=y("checkbox.selectBackground",nr,p("checkbox.select.background","Background color of checkbox widget when the element it's in is selected.")),b9=y("checkbox.foreground",If,p("checkbox.foreground","Foreground color of checkbox widget.")),I9=y("checkbox.border",Hx,p("checkbox.border","Border color of checkbox widget.")),w9=y("checkbox.selectBorder",Na,p("checkbox.select.border","Border color of checkbox widget when the element it's in is selected.")),x9=y("keybindingLabel.background",{dark:new L(new ae(128,128,128,.17)),light:new L(new ae(221,221,221,.4)),hcDark:L.transparent,hcLight:L.transparent},p("keybindingLabelBackground","Keybinding label background color. The keybinding label is used to represent a keyboard shortcut.")),S9=y("keybindingLabel.foreground",{dark:L.fromHex("#CCCCCC"),light:L.fromHex("#555555"),hcDark:L.white,hcLight:fe},p("keybindingLabelForeground","Keybinding label foreground color. The keybinding label is used to represent a keyboard shortcut.")),E9=y("keybindingLabel.border",{dark:new L(new ae(51,51,51,.6)),light:new L(new ae(204,204,204,.4)),hcDark:new L(new ae(111,195,223)),hcLight:me},p("keybindingLabelBorder","Keybinding label border color. The keybinding label is used to represent a keyboard shortcut.")),P9=y("keybindingLabel.bottomBorder",{dark:new L(new ae(68,68,68,.6)),light:new L(new ae(187,187,187,.4)),hcDark:new L(new ae(111,195,223)),hcLight:fe},p("keybindingLabelBottomBorder","Keybinding label border bottom color. The keybinding label is used to represent a keyboard shortcut."));var R9=y("list.focusBackground",null,p("listFocusBackground","List/Tree background color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),L9=y("list.focusForeground",null,p("listFocusForeground","List/Tree foreground color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),O9=y("list.focusOutline",{dark:Er,light:Er,hcDark:kt,hcLight:kt},p("listFocusOutline","List/Tree outline color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),A9=y("list.focusAndSelectionOutline",null,p("listFocusAndSelectionOutline","List/Tree outline color for the focused item when the list/tree is active and selected. An active list/tree has keyboard focus, an inactive does not.")),Ki=y("list.activeSelectionBackground",{dark:"#04395E",light:"#0060C0",hcDark:null,hcLight:L.fromHex("#0F4A85").transparent(.1)},p("listActiveSelectionBackground","List/Tree background color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),Va=y("list.activeSelectionForeground",{dark:L.white,light:L.white,hcDark:null,hcLight:null},p("listActiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),Xv=y("list.activeSelectionIconForeground",null,p("listActiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),M9=y("list.inactiveSelectionBackground",{dark:"#37373D",light:"#E4E6F1",hcDark:null,hcLight:L.fromHex("#0F4A85").transparent(.1)},p("listInactiveSelectionBackground","List/Tree background color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),W9=y("list.inactiveSelectionForeground",null,p("listInactiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),F9=y("list.inactiveSelectionIconForeground",null,p("listInactiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),U9=y("list.inactiveFocusBackground",null,p("listInactiveFocusBackground","List/Tree background color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),N9=y("list.inactiveFocusOutline",null,p("listInactiveFocusOutline","List/Tree outline color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),B9=y("list.hoverBackground",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:L.white.transparent(.1),hcLight:L.fromHex("#0F4A85").transparent(.1)},p("listHoverBackground","List/Tree background when hovering over items using the mouse.")),V9=y("list.hoverForeground",null,p("listHoverForeground","List/Tree foreground when hovering over items using the mouse.")),K9=y("list.dropBackground",{dark:"#062F4A",light:"#D6EBFF",hcDark:null,hcLight:null},p("listDropBackground","List/Tree drag and drop background when moving items over other items when using the mouse.")),H9=y("list.dropBetweenBackground",{dark:Na,light:Na,hcDark:null,hcLight:null},p("listDropBetweenBackground","List/Tree drag and drop border color when moving items between items when using the mouse.")),Zc=y("list.highlightForeground",{dark:"#2AAAFF",light:"#0066BF",hcDark:Er,hcLight:Er},p("highlight","List/Tree foreground color of the match highlights when searching inside the list/tree.")),z9=y("list.focusHighlightForeground",{dark:Zc,light:Lv(Ki,Zc,"#BBE7FF"),hcDark:Zc,hcLight:Zc},p("listFocusHighlightForeground","List/Tree foreground color of the match highlights on actively focused items when searching inside the list/tree.")),q9=y("list.invalidItemForeground",{dark:"#B89500",light:"#B89500",hcDark:"#B89500",hcLight:"#B5200D"},p("invalidItemForeground","List/Tree foreground color for invalid items, for example an unresolved root in explorer.")),$9=y("list.errorForeground",{dark:"#F88070",light:"#B01011",hcDark:null,hcLight:null},p("listErrorForeground","Foreground color of list items containing errors.")),j9=y("list.warningForeground",{dark:"#CCA700",light:"#855F00",hcDark:null,hcLight:null},p("listWarningForeground","Foreground color of list items containing warnings.")),G9=y("listFilterWidget.background",{light:Zr(nr,0),dark:rr(nr,0),hcDark:nr,hcLight:nr},p("listFilterWidgetBackground","Background color of the type filter widget in lists and trees.")),J9=y("listFilterWidget.outline",{dark:L.transparent,light:L.transparent,hcDark:"#f38518",hcLight:"#007ACC"},p("listFilterWidgetOutline","Outline color of the type filter widget in lists and trees.")),Q9=y("listFilterWidget.noMatchesOutline",{dark:"#BE1100",light:"#BE1100",hcDark:me,hcLight:me},p("listFilterWidgetNoMatchesOutline","Outline color of the type filter widget in lists and trees, when there are no matches.")),Y9=y("listFilterWidget.shadow",Gv,p("listFilterWidgetShadow","Shadow color of the type filter widget in lists and trees.")),X9=y("list.filterMatchBackground",{dark:Yn,light:Yn,hcDark:null,hcLight:null},p("listFilterMatchHighlight","Background color of the filtered match.")),Z9=y("list.filterMatchBorder",{dark:Xn,light:Xn,hcDark:me,hcLight:kt},p("listFilterMatchHighlightBorder","Border color of the filtered match.")),e8=y("list.deemphasizedForeground",{dark:"#8C8C8C",light:"#8E8E90",hcDark:"#A7A8A9",hcLight:"#666666"},p("listDeemphasizedForeground","List/Tree foreground color for items that are deemphasized.")),qx=y("tree.indentGuidesStroke",{dark:"#585858",light:"#a9a9a9",hcDark:"#a9a9a9",hcLight:"#a5a5a5"},p("treeIndentGuidesStroke","Tree stroke color for the indentation guides.")),t8=y("tree.inactiveIndentGuidesStroke",J(qx,.4),p("treeInactiveIndentGuidesStroke","Tree stroke color for the indentation guides that are not active.")),r8=y("tree.tableColumnsBorder",{dark:"#CCCCCC20",light:"#61616120",hcDark:null,hcLight:null},p("tableColumnsBorder","Table border color between columns.")),n8=y("tree.tableOddRowsBackground",{dark:J(fe,.04),light:J(fe,.04),hcDark:null,hcLight:null},p("tableOddRowsBackgroundColor","Background color for odd table rows.")),i8=y("editorActionList.background",nr,p("editorActionListBackground","Action List background color.")),o8=y("editorActionList.foreground",Ba,p("editorActionListForeground","Action List foreground color.")),s8=y("editorActionList.focusForeground",Va,p("editorActionListFocusForeground","Action List foreground color for the focused item.")),a8=y("editorActionList.focusBackground",Ki,p("editorActionListFocusBackground","Action List background color for the focused item."));var f8=y("menu.border",{dark:null,light:null,hcDark:me,hcLight:me},p("menuBorder","Border color of menus.")),m8=y("menu.foreground",If,p("menuForeground","Foreground color of menu items.")),h8=y("menu.background",Xc,p("menuBackground","Background color of menu items.")),g8=y("menu.selectionForeground",Va,p("menuSelectionForeground","Foreground color of the selected menu item in menus.")),v8=y("menu.selectionBackground",Ki,p("menuSelectionBackground","Background color of the selected menu item in menus.")),y8=y("menu.selectionBorder",{dark:null,light:null,hcDark:kt,hcLight:kt},p("menuSelectionBorder","Border color of the selected menu item in menus.")),b8=y("menu.separatorBackground",{dark:"#606060",light:"#D4D4D4",hcDark:me,hcLight:me},p("menuSeparatorBackground","Color of a separator menu item in menus."));var P8=y("quickInput.background",nr,p("pickerBackground","Quick picker background color. The quick picker widget is the container for pickers like the command palette.")),T8=y("quickInput.foreground",Ba,p("pickerForeground","Quick picker foreground color. The quick picker widget is the container for pickers like the command palette.")),k8=y("quickInputTitle.background",{dark:new L(new ae(255,255,255,.105)),light:new L(new ae(0,0,0,.06)),hcDark:"#000000",hcLight:L.white},p("pickerTitleBackground","Quick picker title background color. The quick picker widget is the container for pickers like the command palette.")),C8=y("pickerGroup.foreground",{dark:"#3794FF",light:"#0066BF",hcDark:L.white,hcLight:"#0F4A85"},p("pickerGroupForeground","Quick picker color for grouping labels.")),_8=y("pickerGroup.border",{dark:"#3F3F46",light:"#CCCEDB",hcDark:L.white,hcLight:"#0F4A85"},p("pickerGroupBorder","Quick picker color for grouping borders.")),Zv=y("quickInput.list.focusBackground",null,"",void 0,p("quickInput.list.focusBackground deprecation","Please use quickInputList.focusBackground instead")),D8=y("quickInputList.focusForeground",Va,p("quickInput.listFocusForeground","Quick picker foreground color for the focused item.")),R8=y("quickInputList.focusIconForeground",Xv,p("quickInput.listFocusIconForeground","Quick picker icon foreground color for the focused item.")),L8=y("quickInputList.focusBackground",{dark:uf(Zv,Ki),light:uf(Zv,Ki),hcDark:null,hcLight:null},p("quickInput.listFocusBackground","Quick picker background color for the focused item."));var F8=y("search.resultsInfoForeground",{light:fe,dark:J(fe,.65),hcDark:fe,hcLight:fe},p("search.resultsInfoForeground","Color of the text in the search viewlet's completion message.")),U8=y("searchEditor.findMatchBackground",{light:J(Yn,.66),dark:J(Yn,.66),hcDark:Yn,hcLight:Yn},p("searchEditor.queryMatch","Color of the Search Editor query matches.")),N8=y("searchEditor.findMatchBorder",{light:J(Xn,.66),dark:J(Xn,.66),hcDark:Xn,hcLight:Xn},p("searchEditor.editorFindMatchBorder","Border color of the Search Editor query matches."));var $x={IconContribution:"base.contributions.icons"},jx;(t=>{function n(e,r){let i=e.defaults;for(;Tt.isThemeIcon(i);){let o=zo.getIcon(i.id);if(!o)return;i=o.defaults}return i}t.getDefinition=n})(jx||={});var Gx;(e=>{function n(r){return{weight:r.weight,style:r.style,src:r.src.map(i=>({format:i.format,location:i.location.toString()}))}}e.toJSONObject=n;function t(r){let i=o=>Ce(o)?o:void 0;if(r&&Array.isArray(r.src)&&r.src.every(o=>Ce(o.format)&&Ce(o.location)))return{weight:i(r.weight),style:i(r.style),src:r.src.map(o=>({format:o.format,location:x.parse(o.location)}))}}e.fromJSONObject=t})(Gx||={});var wf=class{_onDidChange=new S;onDidChange=this._onDidChange.event;iconsById;iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:p("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:p("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}};iconReferenceSchema={type:"string",pattern:`^${Tt.iconNameExpression}$`,enum:[],enumDescriptions:[]};iconFontsById;constructor(){this.iconsById={},this.iconFontsById={}}registerIcon(t,e,r,i){let o=this.iconsById[t];if(o){if(r&&!o.description){o.description=r,this.iconSchema.properties[t].markdownDescription=`${r} $(${t})`;let l=this.iconReferenceSchema.enum.indexOf(t);l!==-1&&(this.iconReferenceSchema.enumDescriptions[l]=r),this._onDidChange.fire()}return o}let s={id:t,description:r,defaults:e,deprecationMessage:i};this.iconsById[t]=s;let a={$ref:"#/definitions/icons"};return i&&(a.deprecationMessage=i),r&&(a.markdownDescription=`${r}: $(${t})`),this.iconSchema.properties[t]=a,this.iconReferenceSchema.enum.push(t),this.iconReferenceSchema.enumDescriptions.push(r||""),this._onDidChange.fire(),{id:t}}deregisterIcon(t){delete this.iconsById[t],delete this.iconSchema.properties[t];let e=this.iconReferenceSchema.enum.indexOf(t);e!==-1&&(this.iconReferenceSchema.enum.splice(e,1),this.iconReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChange.fire()}getIcons(){return Object.keys(this.iconsById).map(t=>this.iconsById[t])}getIcon(t){return this.iconsById[t]}getIconSchema(){return this.iconSchema}getIconReferenceSchema(){return this.iconReferenceSchema}registerIconFont(t,e){let r=this.iconFontsById[t];return r||(this.iconFontsById[t]=e,this._onDidChange.fire(),e)}deregisterIconFont(t){delete this.iconFontsById[t]}getIconFont(t){return this.iconFontsById[t]}toString(){let t=(o,s)=>o.id.localeCompare(s.id),e=o=>{for(;Tt.isThemeIcon(o.defaults);)o=this.iconsById[o.defaults.id];return`codicon codicon-${o?o.id:""}`},r=[];r.push("| preview     | identifier                        | default codicon ID                | description"),r.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");let i=Object.keys(this.iconsById).map(o=>this.iconsById[o]);for(let o of i.filter(s=>!!s.description).sort(t))r.push(`|<i class="${e(o)}"></i>|${o.id}|${Tt.isThemeIcon(o.defaults)?o.defaults.id:o.id}|${o.description||""}|`);r.push("| preview     | identifier                        "),r.push("| ----------- | --------------------------------- |");for(let o of i.filter(s=>!Tt.isThemeIcon(s.defaults)).sort(t))r.push(`|<i class="${e(o)}"></i>|${o.id}|`);return r.join(`
`)}},zo=new wf;et.add($x.IconContribution,zo);function xf(n,t,e,r){return zo.registerIcon(n,t,e,r)}function Jx(){let n=Zg();for(let t in n){let e="\\"+n[t].toString(16);zo.registerIcon(t,{fontCharacter:e})}}Jx();var ty="vscode://schemas/icons",ry=et.as(Ni.JSONContribution);ry.registerSchema(ty,zo.getIconSchema());var ey=new bt(()=>ry.notifySchemaChanged(ty),200);zo.onDidChange(()=>{ey.isScheduled()||ey.schedule()});var mU=xf("widget-close",Qe.close,p("widgetClose","Icon for the close action in widgets.")),hU=xf("goto-previous-location",Qe.arrowUp,p("previousChangeIcon","Icon for goto previous editor location.")),gU=xf("goto-next-location",Qe.arrowDown,p("nextChangeIcon","Icon for goto next editor location.")),vU=Tt.modify(Qe.sync,"spin"),yU=Tt.modify(Qe.loading,"spin");var UU=R("themeService");var NU=Qe.file,BU=Qe.folder;var Qx={ThemingContribution:"base.contributions.theming"},Sf=class{themingParticipants=[];onThemingParticipantAddedEmitter;constructor(){this.themingParticipants=[],this.onThemingParticipantAddedEmitter=new S}onColorThemeChange(t){return this.themingParticipants.push(t),this.onThemingParticipantAddedEmitter.fire(t),Z(()=>{let e=this.themingParticipants.indexOf(t);this.themingParticipants.splice(e,1)})}get onThemingParticipantAdded(){return this.onThemingParticipantAddedEmitter.event}getThemingParticipants(){return this.themingParticipants}},Yx=new Sf;et.add(Qx.ThemingContribution,Yx);var Ef={WIDTH:400,WIDTH_WITH_VERTICAL_PANEL:600,HEIGHT:270};function Ka(n){return!!n.workspaceUri}function ed(n){return!!n.folderUri}function Pf(n){return!!n.fileUri}function ny(n){let t=Fr(n),e=n.getValue("window.menuBarVisibility");return e==="default"||t&&e==="compact"||A&&Al?"classic":e}function Fr(n,t){return t||(t=Xx(n)),t==="native"}function Xx(n){if(kr)return"custom";let t=n.getValue("window");if(t){if(A&&t.nativeTabs===!0||A&&t.nativeFullScreen===!1)return"native";let i=t.titleBarStyle;if(i==="native"||i==="custom")return i}return j?"native":"custom"}var iy=35;function Zn(n){if(A||kr||Fr(n))return!1;if(j){let t=n.getValue("window.experimentalControlOverlay");if(typeof t=="boolean")return t}return!0}function td(n){let t=n.getValue("window");return!t||typeof t.nativeFullScreen!="boolean"||t.nativeTabs?!0:t.nativeFullScreen!==!1}function qo(n=0){return Math.pow(1.2,n)}var ei=function(n=1){return{width:1024,height:768,mode:n}},oy=function(){let e=Zx.screen.getPrimaryDisplay().workArea,r=Math.max(e.x+e.width/2-800/2,0),i=Math.max(e.y+e.height/2-600/2,0);return{x:r,y:i,width:800,height:600,mode:1}};import{BrowserWindow as NS}from"electron";import gr from"electron";import{release as US}from"os";function sy(n){return n&&n.hasOwnProperty("folderUri")}function ay(n){return typeof n?.backupFolder=="string"}function ly(n){let t=[];try{Array.isArray(n.workspaces)&&(t=n.workspaces.map(e=>({workspace:{id:e.id,configPath:x.parse(e.configURIPath)},remoteAuthority:e.remoteAuthority})))}catch{}return t}function cy(n){let t=[];try{Array.isArray(n.folders)&&(t=n.folders.map(e=>({folderUri:x.parse(e.folderUri),remoteAuthority:e.remoteAuthority})))}catch{}return t}var en=R("backupMainService");import Hi from"electron";var eS=new un(1e4);function tn(n){return rS(n,"NFC",eS)}var r3=new un(1e4);var tS=/[^\u0000-\u0080]/;function rS(n,t,e){if(!n)return n;let r=e.get(n);if(r)return r;let i;return tS.test(n)?i=n.normalize(t):i=n,e.set(n,i),i}import*as de from"fs";import{tmpdir as nS}from"os";import{promisify as rd}from"util";async function uy(n,t=0,e){if(dg(n))throw new Error("rimraf - will refuse to recursively delete root");return t===0?Tf(n):iS(n,e)}async function iS(n,t=ac(nS())){try{try{await de.promises.rename(n,t)}catch(e){return e.code==="ENOENT"?void 0:Tf(n)}Tf(t).catch(e=>{})}catch(e){if(e.code!=="ENOENT")throw e}}async function Tf(n){return de.promises.rm(n,{recursive:!0,force:!0,maxRetries:3})}async function nd(n,t){return sS(await(t?oS(n):de.promises.readdir(n)))}async function oS(n){try{return await de.promises.readdir(n,{withFileTypes:!0})}catch(r){console.warn("[node.js fs] readdir with filetypes failed with error: ",r)}let t=[],e=await nd(n);for(let r of e){let i=!1,o=!1,s=!1;try{let a=await de.promises.lstat(F(n,r));i=a.isFile(),o=a.isDirectory(),s=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}t.push({name:r,isFile:()=>i,isDirectory:()=>o,isSymbolicLink:()=>s})}return t}function sS(n){return n.map(t=>typeof t=="string"?A?tn(t):t:(t.name=A?tn(t.name):t.name,t))}async function aS(n){let t=await nd(n),e=[];for(let r of t)await gt.existsDirectory(F(n,r))&&e.push(r);return e}function py(n,t=1e3){return new Promise(e=>{let r=!1,i=setInterval(()=>{r||(r=!0,de.access(n,o=>{r=!1,o&&(clearInterval(i),e(void 0))}))},t)})}var gt;(r=>{async function n(i){let o;try{if(o=await de.promises.lstat(i),!o.isSymbolicLink())return{stat:o}}catch{}try{return{stat:await de.promises.stat(i),symbolicLink:o?.isSymbolicLink()?{dangling:!1}:void 0}}catch(s){if(s.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};if(N&&s.code==="EACCES")try{return{stat:await de.promises.stat(await de.promises.readlink(i)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};throw a}throw s}}r.stat=n;async function t(i){try{let{stat:o,symbolicLink:s}=await r.stat(i);return o.isFile()&&s?.dangling!==!0}catch{}return!1}r.existsFile=t;async function e(i){try{let{stat:o,symbolicLink:s}=await r.stat(i);return o.isDirectory()&&s?.dangling!==!0}catch{}return!1}r.existsDirectory=e})(gt||={});var lS=new dc;function cS(n,t,e){return lS.queueFor(x.file(n),()=>{let r=pS(e);return new Promise((i,o)=>uS(n,t,r,s=>s?o(s):i()))},Ae)}var fy=!0;function dS(n){fy=n}function uS(n,t,e,r){if(!fy)return de.writeFile(n,t,{mode:e.mode,flag:e.flag},r);de.open(n,e.flag,e.mode,(i,o)=>{if(i)return r(i);de.writeFile(o,t,s=>{if(s)return de.close(o,()=>r(s));de.fdatasync(o,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),dS(!1)),de.close(o,l=>r(l))))})})}function pS(n){return n?{mode:typeof n.mode=="number"?n.mode:438,flag:typeof n.flag=="string"?n.flag:"w"}:{mode:438,flag:"w"}}async function fS(n,t,e=6e4){if(n!==t)try{N&&typeof e=="number"?await my(n,t,Date.now(),e):await de.promises.rename(n,t)}catch(r){if(n.toLowerCase()!==t.toLowerCase()&&r.code==="EXDEV"||n.endsWith("."))await hy(n,t,{preserveSymlinks:!1}),await uy(n,1);else throw r}}async function my(n,t,e,r,i=0){try{return await de.promises.rename(n,t)}catch(o){if(o.code!=="EACCES"&&o.code!=="EPERM"&&o.code!=="EBUSY")throw o;if(Date.now()-e>=r)throw console.error(`[node.js fs] rename failed after ${i} retries with error: ${o}`),o;if(i===0){let s=!1;try{let{stat:a}=await gt.stat(t);a.isFile()||(s=!0)}catch{}if(s)throw o}return await $e(Math.min(100,i*10)),my(n,t,e,r,i+1)}}async function hy(n,t,e){return gy(n,t,{root:{source:n,target:t},options:e,handledSourcePaths:new Set})}var dy=511;async function gy(n,t,e){if(e.handledSourcePaths.has(n))return;e.handledSourcePaths.add(n);let{stat:r,symbolicLink:i}=await gt.stat(n);if(i){if(e.options.preserveSymlinks)try{return await gS(n,t,e)}catch{}if(i.dangling)return}return r.isDirectory()?mS(n,t,r.mode&dy,e):hS(n,t,r.mode&dy)}async function mS(n,t,e,r){await de.promises.mkdir(t,{recursive:!0,mode:e});let i=await nd(n);for(let o of i)await gy(F(n,o),F(t,o),r)}async function hS(n,t,e){await de.promises.copyFile(n,t),await de.promises.chmod(t,e)}async function gS(n,t,e){let r=await de.promises.readlink(n);hn(r,e.root.source,!j)&&(r=F(e.root.target,r.substr(e.root.source.length+1))),await de.promises.symlink(r,t)}var $=new class{get read(){return(n,t,e,r,i)=>new Promise((o,s)=>{de.read(n,t,e,r,i,(a,l,c)=>a?s(a):o({bytesRead:l,buffer:c}))})}get write(){return(n,t,e,r,i)=>new Promise((o,s)=>{de.write(n,t,e,r,i,(a,l,c)=>a?s(a):o({bytesWritten:l,buffer:c}))})}get fdatasync(){return rd(de.fdatasync)}get open(){return rd(de.open)}get close(){return rd(de.close)}get realpath(){return rd(de.realpath)}async exists(n){try{return await de.promises.access(n),!0}catch{return!1}}get readdir(){return nd}get readDirsInDir(){return aS}get writeFile(){return cS}get rm(){return uy}get rename(){return fS}get copy(){return hy}};var id=(i=>(i[i.Ignore=0]="Ignore",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i))(id||{});(a=>{let n="error",t="warning",e="warn",r="info",i="ignore";function o(l){return l?hr(n,l)?3:hr(t,l)||hr(e,l)?2:hr(r,l)?1:0:0}a.fromValue=o;function s(l){switch(l){case 3:return n;case 2:return t;case 1:return r;default:return i}}a.toString=s})(id||={});var xe=id;var He=R("telemetryService"),g3=R("customEndpointTelemetryService"),kf="telemetry.currentSessionDate",Cf="telemetry.firstSessionDate",vy="telemetry.lastSessionDate",od="telemetry.machineId",sd="telemetry.sqmId",ad="telemetry.devDeviceId",_f="telemetry",jo="telemetry.telemetryLevel",ld="telemetry.enableCrashReporter",Ha="telemetry.enableTelemetry";function In(n){if(!n||typeof n!="object"||n instanceof RegExp)return n;let t=Array.isArray(n)?[]:{};return Object.entries(n).forEach(([e,r])=>{t[e]=r&&typeof r=="object"?In(r):r}),t}var vS=Object.prototype.hasOwnProperty;function yy(n,t){return Df(n,t,new Set)}function Df(n,t,e){if(st(n))return n;let r=t(n);if(typeof r<"u")return r;if(Array.isArray(n)){let i=[];for(let o of n)i.push(Df(o,t,e));return i}if(Xe(n)){if(e.has(n))throw new Error("Cannot clone recursive data-structure");e.add(n);let i={};for(let o in n)vS.call(n,o)&&(i[o]=Df(n[o],t,e));return e.delete(n),i}return n}function cd(n,t,e=!0){return Xe(n)?(Xe(t)&&Object.keys(t).forEach(r=>{r in n?e&&(Xe(n[r])&&Xe(t[r])?cd(n[r],t[r],e):n[r]=t[r]):n[r]=t[r]}),n):t}function Go(n,t){if(n===t)return!0;if(n==null||t===null||t===void 0||typeof n!=typeof t||typeof n!="object"||Array.isArray(n)!==Array.isArray(t))return!1;let e,r;if(Array.isArray(n)){if(n.length!==t.length)return!1;for(e=0;e<n.length;e++)if(!Go(n[e],t[e]))return!1}else{let i=[];for(r in n)i.push(r);i.sort();let o=[];for(r in t)o.push(r);if(o.sort(),!Go(i,o))return!1;for(e=0;e<i.length;e++)if(!Go(n[i[e]],t[i[e]]))return!1}return!0}function by(n,t){let e=t.toLowerCase(),r=Object.keys(n).find(i=>i.toLowerCase()===e);return r?n[r]:n[t]}var N3=R("dialogService");var B3=R("fileDialogService");function Iy(n,t){let e=In(n),r=(e.buttons??[]).map(a=>cc(a)),i=(n.buttons||[]).map((a,l)=>l),o=0,s=e.cancelId??r.length-1;if(r.length>1){let a=typeof s=="number"?r[s]:void 0;if(j||A){if(typeof a=="string"&&r.length>1&&s!==1){r.splice(s,1),r.splice(1,0,a);let l=i[s];i.splice(s,1),i.splice(1,0,l),s=1}j&&r.length>1&&(r=r.reverse(),i=i.reverse(),o=r.length-1,typeof a=="string"&&(s=o-1))}else if(N&&typeof a=="string"&&r.length>1&&s!==r.length-1){r.splice(s,1),r.push(a);let l=i[s];i.splice(s,1),i.push(l),s=r.length-1}}return e.buttons=r,e.defaultId=o,e.cancelId=s,e.noLink=!0,e.title=e.title||t.nameLong,{options:e,buttonIndeces:i}}var Mt=R("dialogMainService"),Jo=class{constructor(t,e){this.logService=t;this.productService=e}windowFileDialogLocks=new Map;windowDialogQueues=new Map;noWindowDialogueQueue=new Kn;pickFileFolder(t,e){return this.doPick({...t,pickFolders:!0,pickFiles:!0,title:p("open","Open")},e)}pickFolder(t,e){return this.doPick({...t,pickFolders:!0,title:p("openFolder","Open Folder")},e)}pickFile(t,e){return this.doPick({...t,pickFiles:!0,title:p("openFile","Open File")},e)}pickWorkspace(t,e){let r=p("openWorkspaceTitle","Open Workspace from File"),i=cc(p({key:"openWorkspace",comment:["&& denotes a mnemonic"]},"&&Open")),o=Vg;return this.doPick({...t,pickFiles:!0,title:r,filters:o,buttonLabel:i},e)}async doPick(t,e){let r={title:t.title,buttonLabel:t.buttonLabel,filters:t.filters,defaultPath:t.defaultPath};(typeof t.pickFiles=="boolean"||typeof t.pickFolders=="boolean")&&(r.properties=void 0,t.pickFiles&&t.pickFolders&&(r.properties=["multiSelections","openDirectory","openFile","createDirectory"])),r.properties||(r.properties=["multiSelections",t.pickFolders?"openDirectory":"openFile","createDirectory"]),A&&r.properties.push("treatPackageAsDirectory");let i=await this.showOpenDialog(r,(e||Hi.BrowserWindow.getFocusedWindow())??void 0);if(i&&i.filePaths&&i.filePaths.length>0)return i.filePaths}getWindowDialogQueue(t){if(t){let e=this.windowDialogQueues.get(t.id);return e||(e=new Kn,this.windowDialogQueues.set(t.id,e)),e}else return this.noWindowDialogueQueue}showMessageBox(t,e){return this.getWindowDialogQueue(e).queue(async()=>{let{options:r,buttonIndeces:i}=Iy(t,this.productService),o;return e?o=await Hi.dialog.showMessageBox(e,r):o=await Hi.dialog.showMessageBox(r),{response:i[o.response],checkboxChecked:o.checkboxChecked}})}async showSaveDialog(t,e){let r=this.acquireFileDialogLock(t,e);if(!r)return this.logService.error("[DialogMainService]: file save dialog is already or will be showing for the window with the same configuration"),{canceled:!0,filePath:""};try{return await this.getWindowDialogQueue(e).queue(async()=>{let i;return e?i=await Hi.dialog.showSaveDialog(e,t):i=await Hi.dialog.showSaveDialog(t),i.filePath=this.normalizePath(i.filePath),i})}finally{ft(r)}}normalizePath(t){return t&&A&&(t=tn(t)),t}normalizePaths(t){return t.map(e=>this.normalizePath(e))}async showOpenDialog(t,e){t.defaultPath&&(await $.exists(t.defaultPath)||(t.defaultPath=void 0));let r=this.acquireFileDialogLock(t,e);if(!r)return this.logService.error("[DialogMainService]: file open dialog is already or will be showing for the window with the same configuration"),{canceled:!0,filePaths:[]};try{return await this.getWindowDialogQueue(e).queue(async()=>{let i;return e?i=await Hi.dialog.showOpenDialog(e,t):i=await Hi.dialog.showOpenDialog(t),i.filePaths=this.normalizePaths(i.filePaths),i})}finally{ft(r)}}acquireFileDialogLock(t,e){if(!e)return O.None;this.logService.trace("[DialogMainService]: request to acquire file dialog lock",t);let r=this.windowFileDialogLocks.get(e.id);r||(r=new Set,this.windowFileDialogLocks.set(e.id,r));let i=er(t);if(!r.has(i))return this.logService.trace("[DialogMainService]: new file dialog lock created",t),r.add(i),Z(()=>{this.logService.trace("[DialogMainService]: file dialog lock disposed",t),r?.delete(i),r?.size===0&&this.windowFileDialogLocks.delete(e.id)})}};Jo=P([h(0,B),h(1,Oe)],Jo);var Py=jI(Ey());var cN={o:p("optionsUpperCase","Options"),e:p("extensionsManagement","Extensions Management"),t:p("troubleshooting","Troubleshooting")};var Rf={tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel",options:{"cli-data-dir":{type:"string",args:"dir",description:p("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:p("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:p("diff","Compare two files with each other.")},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:p("merge","Perform a three-way merge by providing paths for two modified versions of a file, the common origin of both modified versions and the output file to save merge results.")},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:p("add","Add folder(s) to the last active window.")},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:p("goto","Open a file at the path on the specified line and character position.")},"new-window":{type:"boolean",cat:"o",alias:"n",description:p("newWindow","Force to open a new window.")},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:p("reuseWindow","Force to open a file or folder in an already opened window.")},wait:{type:"boolean",cat:"o",alias:"w",description:p("wait","Wait for the files to be closed before returning.")},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:p("locale","The locale to use (e.g. en-US or zh-TW).")},"user-data-dir":{type:"string",cat:"o",args:"dir",description:p("userDataDir","Specifies the directory that user data is kept in. Can be used to open multiple distinct instances of Code.")},profile:{type:"string",cat:"o",args:"profileName",description:p("profileName","Opens the provided folder or workspace with the given profile and associates the profile with the workspace. If the profile does not exist, a new empty one is created.")},help:{type:"boolean",cat:"o",alias:"h",description:p("help","Print usage.")},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:p("extensionHomePath","Set the root path for extensions.")},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:p("listExtensions","List the installed extensions.")},"show-versions":{type:"boolean",cat:"e",description:p("showVersions","Show versions of installed extensions, when using --list-extensions.")},category:{type:"string",allowEmptyValue:!0,cat:"e",description:p("category","Filters installed extensions by provided category, when using --list-extensions."),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:p("installExtension","Installs or updates an extension. The argument is either an extension id or a path to a VSIX. The identifier of an extension is '${publisher}.${name}'. Use '--force' argument to update to latest version. To install a specific version provide '@${version}'. For example: 'vscode.csharp@1.2.3'.")},"pre-release":{type:"boolean",cat:"e",description:p("install prerelease","Installs the pre-release version of the extension, when using --install-extension")},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:p("uninstallExtension","Uninstalls an extension.")},"update-extensions":{type:"boolean",cat:"e",description:p("updateExtensions","Update the installed extensions.")},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:p("experimentalApis","Enables proposed API features for extensions. Can receive one or more extension IDs to enable individually.")},version:{type:"boolean",cat:"t",alias:"v",description:p("version","Print version.")},verbose:{type:"boolean",cat:"t",global:!0,description:p("verbose","Print verbose output (implies --wait).")},log:{type:"string[]",cat:"t",args:"level",global:!0,description:p("log","Log level to use. Default is 'info'. Allowed values are 'critical', 'error', 'warn', 'info', 'debug', 'trace', 'off'. You can also configure the log level of an extension by passing extension id and log level in the following format: '${publisher}.${name}:${logLevel}'. For example: 'vscode.csharp:trace'. Can receive one or more such entries.")},status:{type:"boolean",alias:"s",cat:"t",description:p("status","Print process usage and diagnostics information.")},"prof-startup":{type:"boolean",cat:"t",description:p("prof-startup","Run CPU profiler during startup.")},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:p("disableExtensions","Disable all installed extensions. This option is not persisted and is effective only when the command opens a new window.")},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:p("disableExtension","Disable the provided extension. This option is not persisted and is effective only when the command opens a new window.")},sync:{type:"string",cat:"t",description:p("turn sync","Turn sync on or off."),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:p("inspect-extensions","Allow debugging and profiling of extensions. Check the developer tools for the connection URI.")},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:p("inspect-brk-extensions","Allow debugging and profiling of extensions with the extension host being paused after start. Check the developer tools for the connection URI.")},"disable-lcd-text":{type:"boolean",cat:"t",description:p("disableLCDText","Disable LCD font rendering.")},"disable-gpu":{type:"boolean",cat:"t",description:p("disableGPU","Disable GPU hardware acceleration.")},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:p("disableChromiumSandbox","Use this option only when there is requirement to launch the application as sudo user on Linux or when running as an elevated user in an applocker environment on Windows.")},sandbox:{type:"boolean"},telemetry:{type:"boolean",cat:"t",description:p("telemetry","Shows all telemetry events which VS code collects.")},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},trace:{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"locate-shell-integration-path":{type:"string",args:["bash","pwsh","zsh","fish"]},"enable-coi":{type:"boolean"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},_:{type:"string[]"}},IS={onUnknownOption:()=>{},onMultipleValues:()=>{},onEmptyValue:()=>{},onDeprecatedOption:()=>{}};function dd(n,t,e=IS){let r=n.find(m=>m.length>0&&m[0]!=="-"),i={},o=["_"],s=[],a={},l;for(let m in t){let g=t[m];g.type==="subcommand"?m===r&&(l=g):(g.alias&&(i[m]=g.alias),g.type==="string"||g.type==="string[]"?(o.push(m),g.deprecates&&o.push(...g.deprecates)):g.type==="boolean"&&(s.push(m),g.deprecates&&s.push(...g.deprecates)),g.global&&(a[m]=g))}if(l&&r){let m=a;for(let w in l.options)m[w]=l.options[w];let g=n.filter(w=>w!==r),b=e.getSubcommandReporter?e.getSubcommandReporter(r):void 0,v=dd(g,m,b);return{[r]:v,_:[]}}let c=(0,Py.default)(n,{string:o,boolean:s,alias:i}),d={},f=c;d._=c._.map(m=>String(m)).filter(m=>m.length>0),delete f._;for(let m in t){let g=t[m];if(g.type==="subcommand")continue;g.alias&&delete f[g.alias];let b=f[m];if(g.deprecates)for(let v of g.deprecates)f.hasOwnProperty(v)&&(b||(b=f[v],b&&e.onDeprecatedOption(v,g.deprecationMessage||p("deprecated.useInstead","Use {0} instead.",m))),delete f[v]);if(typeof b<"u"){if(g.type==="string[]"){if(Array.isArray(b)||(b=[b]),!g.allowEmptyValue){let v=b.filter(w=>w.length>0);v.length!==b.length&&(e.onEmptyValue(m),b=v.length>0?v:void 0)}}else g.type==="string"&&(Array.isArray(b)?(b=b.pop(),e.onMultipleValues(m,b)):!b&&!g.allowEmptyValue&&(e.onEmptyValue(m),b=void 0));d[m]=b,g.deprecationMessage&&e.onDeprecatedOption(m,g.deprecationMessage)}delete f[m]}for(let m in f)e.onUnknownOption(m);return d}function rn(n){return n.VSCODE_CLI==="1"}var ti=R("protocolMainService");async function Ty(n,t,e){let r=e&&e.get("storage.serviceMachineId",-1)||null;if(r)return r;try{let o=(await t.readFile(n.serviceMachineIdResource)).value.toString();r=Ig(o)?o:null}catch{r=null}if(!r){r=yt();try{await t.writeFile(n.serviceMachineIdResource,te.fromString(r))}catch{}}return e?.store("storage.serviceMachineId",r,-1,1),r}function wn(n){return n.scheme===U.vscodeRemote?n.authority:void 0}function wS(n){if(Ei===2&&/^penguin(\.|$)/i.test(n))return"chromebook"}function ky(n,t,e,r,i,o,s,a,l,c){let d=Object.create(null);d["common.machineId"]=o,d["common.sqmId"]=s,d["common.devDeviceId"]=a,d.sessionID=yt()+Date.now(),d.commitHash=r,d.version=i,d["common.platformVersion"]=(n||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),d["common.platform"]=Ll(Ei),d["common.nodePlatform"]=Ys,d["common.nodeArch"]=e,d["common.product"]=c||"desktop",l&&(d["common.msftInternal"]=l);let f=0,m=Date.now();Object.defineProperties(d,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-m,enumerable:!0},"common.sequence":{get:()=>f++,enumerable:!0}}),Ol&&(d["common.snap"]="true");let g=wS(t);return g&&(d["common.platformDetail"]=g),d}function Cy(n){let t=xt.USERDNSDOMAIN;if(!t)return!1;let e=t.toLowerCase();return n.some(r=>e===r)}var ud=class{constructor(t){this.value=t}isTrustedTelemetryValue=!0},Of=class{telemetryLevel=0;sessionId="someValue.sessionId";machineId="someValue.machineId";sqmId="someValue.sqmId";devDeviceId="someValue.devDeviceId";firstSessionDate="someValue.firstSessionDate";sendErrorTelemetry=!1;publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},Qo=new Of;function pd(n,t){return!t.isBuilt&&!t.disableTelemetry?!0:!(t.disableTelemetry||!n.enableTelemetry)}function Yo(n){let t=n.getValue(jo),e=n.getValue(ld);if(n.getValue(Ha)===!1||e===!1)return 0;switch(t??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}function _y(n,t){let e=n.msftInternalDomains||[],r=t.getValue("telemetry.internalTesting");return Cy(e)||r}function Dy(n){return[n.appRoot,n.extensionsPath,n.userHome.fsPath,n.tmpDir.fsPath,n.userDataPath]}function ES(n,t){if(!n||!n.includes("/")&&!n.includes("\\"))return n;let e=n,r=[];for(let a of t)for(;;){let l=a.exec(n);if(!l)break;r.push([l.index,a.lastIndex])}let i=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,o=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g,s=0;for(e="";;){let a=o.exec(n);if(!a)break;let l=r.some(([c,d])=>a.index<d&&c<o.lastIndex);!i.test(a[0])&&!l&&(e+=n.substring(s,a.index)+"<REDACTED: user-file-path>",s=o.lastIndex)}return s<n.length&&(e+=n.substr(s)),e}function PS(n){if(!n)return n;let t=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Email",regex:/@[a-zA-Z0-9-]+\.[a-zA-Z0-9-]+/}];for(let e of t)if(e.regex.test(n))return`<REDACTED: ${e.label}>`;return n}function Ry(n,t){return yy(n,e=>{if(e instanceof ud||Object.hasOwnProperty.call(e,"isTrustedTelemetryValue"))return e.value;if(typeof e=="string"){let r=e.replaceAll("%20"," ");r=ES(r,t);for(let i of t)r=r.replace(i,"");return r=PS(r),r}})}async function Ly(n,t,e,r,i,o,s){let a={"X-Market-Client-Id":`VSCode ${n}`,"User-Agent":`VSCode ${n} (${t.nameShort})`};if(pd(t,e)&&Yo(r)===3){let l=await Ty(e,i,o);a["X-Market-User-Id"]=l,a["VSCode-SessionId"]=s.machineId||l}return a}import Nt from"electron";var TS="#FFFFFF",kS="#1F1F1F",Oy="#000000",Ay="#FFFFFF",My="theme",Wy="themeBackground",Fy="windowSplash",qa;(e=>(e.DETECT_COLOR_SCHEME="window.autoDetectColorScheme",e.SYSTEM_COLOR_THEME="window.systemColorTheme"))(qa||={});var ri=R("themeMainService"),fd=class extends O{constructor(e,r){super();this.stateService=e;this.configurationService=r;j||this._register(this.configurationService.onDidChangeConfiguration(i=>{(i.affectsConfiguration(qa.SYSTEM_COLOR_THEME)||i.affectsConfiguration(qa.DETECT_COLOR_SCHEME))&&this.updateSystemColorTheme()})),this.updateSystemColorTheme(),this._register(E.fromNodeEventEmitter(Nt.nativeTheme,"updated")(()=>this._onDidChangeColorScheme.fire(this.getColorScheme())))}_onDidChangeColorScheme=this._register(new S);onDidChangeColorScheme=this._onDidChangeColorScheme.event;updateSystemColorTheme(){if(j||this.configurationService.getValue(qa.DETECT_COLOR_SCHEME))Nt.nativeTheme.themeSource="system";else switch(this.configurationService.getValue(qa.SYSTEM_COLOR_THEME)){case"dark":Nt.nativeTheme.themeSource="dark";break;case"light":Nt.nativeTheme.themeSource="light";break;case"auto":switch(this.getBaseTheme()){case"vs":Nt.nativeTheme.themeSource="light";break;case"vs-dark":Nt.nativeTheme.themeSource="dark";break;default:Nt.nativeTheme.themeSource="system"}break;default:Nt.nativeTheme.themeSource="system";break}}getColorScheme(){if(N){if(Nt.nativeTheme.shouldUseHighContrastColors)return{dark:Nt.nativeTheme.shouldUseInvertedColorScheme,highContrast:!0}}else if(A){if(Nt.nativeTheme.shouldUseInvertedColorScheme||Nt.nativeTheme.shouldUseHighContrastColors)return{dark:Nt.nativeTheme.shouldUseDarkColors,highContrast:!0}}else if(j&&Nt.nativeTheme.shouldUseHighContrastColors)return{dark:!0,highContrast:!0};return{dark:Nt.nativeTheme.shouldUseDarkColors,highContrast:!1}}getBackgroundColor(){let e=this.getColorScheme();if(e.highContrast&&this.configurationService.getValue("window.autoDetectHighContrast"))return e.dark?Oy:Ay;let r=this.stateService.getItem(Wy,null);if(!r)switch(this.getBaseTheme()){case"vs":r=TS;break;case"hc-black":r=Oy;break;case"hc-light":r=Ay;break;default:r=kS}return r}getBaseTheme(){switch(this.stateService.getItem(My,"vs-dark").split(" ")[0]){case"vs":return"vs";case"hc-black":return"hc-black";case"hc-light":return"hc-light";default:return"vs-dark"}}saveWindowSplash(e,r){this.stateService.setItems([{key:My,data:r.baseTheme},{key:Wy,data:r.colorInfo.background},{key:Fy,data:r}]),typeof e=="number"&&this.updateBackgroundColor(e,r),this.updateSystemColorTheme()}updateBackgroundColor(e,r){for(let i of Nt.BrowserWindow.getAllWindows())if(i.id===e){i.setBackgroundColor(r.colorInfo.background);break}}getWindowSplash(){return this.stateService.getItem(Fy)}};fd=P([h(0,Ye),h(1,Ie)],fd);import Uy from"electron";var Te=R("windowsMainService");function hd(n,t,e,r){let i=n.get(ri),o=n.get(Oe),s=n.get(Ie),a=n.get(ge),l=s.getValue("window"),c={backgroundColor:i.getBackgroundColor(),minWidth:Ef.WIDTH,minHeight:Ef.HEIGHT,title:o.nameLong,show:t.mode!==0&&t.mode!==3,x:t.x,y:t.y,width:t.width,height:t.height,webPreferences:{...r,enableWebSQL:!1,spellcheck:!1,zoomFactor:qo(t.zoomLevel??l?.zoomLevel),autoplayPolicy:"user-gesture-required",enableBlinkFeatures:"HighlightAPI",sandbox:!0},experimentalDarkMode:!0};if(j?c.icon=F(a.appRoot,"resources/linux/code.png"):N&&!a.isBuilt&&(c.icon=F(a.appRoot,"resources/win32/code_150x150.png")),A&&(c.acceptFirstMouse=!0,l?.clickThroughInactive===!1&&(c.acceptFirstMouse=!1)),e?.disableFullscreen?c.fullscreen=!1:A&&!td(s)&&(c.fullscreenable=!1),A&&l?.nativeTabs===!0&&(c.tabbingIdentifier=o.nameShort),!Fr(s,e?.forceNativeTitlebar?"native":void 0)&&(c.titleBarStyle="hidden",A||(c.frame=!1),Zn(s))){let m=i.getWindowSplash()?.colorInfo.titleBarBackground??i.getBackgroundColor(),g=L.fromHex(m).isDarker()?"#FFFFFF":"#000000";c.titleBarOverlay={height:29,color:m,symbolColor:g}}return c}function gd(n){let t,e=Number.MIN_VALUE;for(let r of n)r.lastFocusTime>e&&(e=r.lastFocusTime,t=r);return t}var $a;(e=>{function n(r,i,o=Uy.screen.getAllDisplays()){if(r.trace(`window#validateWindowState: validating window state on ${o.length} display(s)`,i),typeof i.x!="number"||typeof i.y!="number"||typeof i.width!="number"||typeof i.height!="number"){r.trace("window#validateWindowState: unexpected type of state values");return}if(i.width<=0||i.height<=0){r.trace("window#validateWindowState: unexpected negative values");return}if(o.length===1){let c=t(o[0]);if(r.trace("window#validateWindowState: single monitor working area",c),c){let d=function(){!i||typeof i.x!="number"||typeof i.y!="number"||!c||(i.x<c.x&&(i.x=c.x),i.y<c.y&&(i.y=c.y))};var l=d;d(),i.width>c.width&&(i.width=c.width),i.height>c.height&&(i.height=c.height),i.x>c.x+c.width-128&&(i.x=c.x+c.width-i.width),i.y>c.y+c.height-128&&(i.y=c.y+c.height-i.height),d()}return i}if(i.display&&i.mode===3){let c=o.find(d=>d.id===i.display);if(c&&typeof c.bounds?.x=="number"&&typeof c.bounds?.y=="number"){r.trace("window#validateWindowState: restoring fullscreen to previous display");let d=ei(3);return d.x=c.bounds.x,d.y=c.bounds.y,d}}let s,a;try{s=Uy.screen.getDisplayMatching({x:i.x,y:i.y,width:i.width,height:i.height}),a=t(s),r.trace("window#validateWindowState: multi-monitor working area",a)}catch(c){r.error("window#validateWindowState: error finding display for window state",c)}if(s&&a&&i.x+i.width>a.x&&i.y+i.height>a.y&&i.x<a.x+a.width&&i.y<a.y+a.height)return i;r.trace("window#validateWindowState: state is outside of the multi-monitor working area")}e.validateWindowState=n;function t(r){if(r.workArea.width>0&&r.workArea.height>0)return r.workArea;if(r.bounds.width>0&&r.bounds.height>0)return r.bounds}})($a||={});import*as Bf from"fs";import AS from"electron";var Wf;(t=>t.DEFAULT={allowTrailingComma:!0})(Wf||={});function By(n,t=!1){let e=0,r=n.length,i="",o=0,s=16,a=0;function l(v){let w=0,k=0;for(;w<v;){let C=n.charCodeAt(e);if(C>=48&&C<=57)k=k*16+C-48;else if(C>=65&&C<=70)k=k*16+C-65+10;else if(C>=97&&C<=102)k=k*16+C-97+10;else break;e++,w++}return w<v&&(k=-1),k}function c(v){e=v,i="",o=0,s=16,a=0}function d(){let v=e;if(n.charCodeAt(e)===48)e++;else for(e++;e<n.length&&Xo(n.charCodeAt(e));)e++;if(e<n.length&&n.charCodeAt(e)===46)if(e++,e<n.length&&Xo(n.charCodeAt(e)))for(e++;e<n.length&&Xo(n.charCodeAt(e));)e++;else return a=3,n.substring(v,e);let w=e;if(e<n.length&&(n.charCodeAt(e)===69||n.charCodeAt(e)===101))if(e++,(e<n.length&&n.charCodeAt(e)===43||n.charCodeAt(e)===45)&&e++,e<n.length&&Xo(n.charCodeAt(e))){for(e++;e<n.length&&Xo(n.charCodeAt(e));)e++;w=e}else a=3;return n.substring(v,w)}function f(){let v="",w=e;for(;;){if(e>=r){v+=n.substring(w,e),a=2;break}let k=n.charCodeAt(e);if(k===34){v+=n.substring(w,e),e++;break}if(k===92){if(v+=n.substring(w,e),e++,e>=r){a=2;break}switch(n.charCodeAt(e++)){case 34:v+='"';break;case 92:v+="\\";break;case 47:v+="/";break;case 98:v+="\b";break;case 102:v+="\f";break;case 110:v+=`
`;break;case 114:v+="\r";break;case 116:v+="	";break;case 117:{let M=l(4);M>=0?v+=String.fromCharCode(M):a=4;break}default:a=5}w=e;continue}if(k>=0&&k<=31)if(vd(k)){v+=n.substring(w,e),a=2;break}else a=6;e++}return v}function m(){if(i="",a=0,o=e,e>=r)return o=r,s=17;let v=n.charCodeAt(e);if(Mf(v)){do e++,i+=String.fromCharCode(v),v=n.charCodeAt(e);while(Mf(v));return s=15}if(vd(v))return e++,i+=String.fromCharCode(v),v===13&&n.charCodeAt(e)===10&&(e++,i+=`
`),s=14;switch(v){case 123:return e++,s=1;case 125:return e++,s=2;case 91:return e++,s=3;case 93:return e++,s=4;case 58:return e++,s=6;case 44:return e++,s=5;case 34:return e++,i=f(),s=10;case 47:{let w=e-1;if(n.charCodeAt(e+1)===47){for(e+=2;e<r&&!vd(n.charCodeAt(e));)e++;return i=n.substring(w,e),s=12}if(n.charCodeAt(e+1)===42){e+=2;let k=r-1,C=!1;for(;e<k;){if(n.charCodeAt(e)===42&&n.charCodeAt(e+1)===47){e+=2,C=!0;break}e++}return C||(e++,a=1),i=n.substring(w,e),s=13}return i+=String.fromCharCode(v),e++,s=16}case 45:if(i+=String.fromCharCode(v),e++,e===r||!Xo(n.charCodeAt(e)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=d(),s=11;default:for(;e<r&&g(v);)e++,v=n.charCodeAt(e);if(o!==e){switch(i=n.substring(o,e),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(v),e++,s=16}}function g(v){if(Mf(v)||vd(v))return!1;switch(v){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function b(){let v;do v=m();while(v>=12&&v<=15);return v}return{setPosition:c,getPosition:()=>e,scan:t?b:m,getToken:()=>s,getTokenValue:()=>i,getTokenOffset:()=>o,getTokenLength:()=>e-o,getTokenError:()=>a}}function Mf(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function vd(n){return n===10||n===13||n===8232||n===8233}function Xo(n){return n>=48&&n<=57}function ni(n,t=[],e=Wf.DEFAULT){let r=null,i=[],o=[];function s(l){Array.isArray(i)?i.push(l):r!==null&&(i[r]=l)}return CS(n,{onObjectBegin:()=>{let l={};s(l),o.push(i),i=l,r=null},onObjectProperty:l=>{r=l},onObjectEnd:()=>{i=o.pop()},onArrayBegin:()=>{let l=[];s(l),o.push(i),i=l,r=null},onArrayEnd:()=>{i=o.pop()},onLiteralValue:s,onError:(l,c,d)=>{t.push({error:l,offset:c,length:d})}},e),i[0]}function CS(n,t,e=Wf.DEFAULT){let r=By(n,!1);function i(ee){return ee?()=>ee(r.getTokenOffset(),r.getTokenLength()):()=>!0}function o(ee){return ee?Be=>ee(Be,r.getTokenOffset(),r.getTokenLength()):()=>!0}let s=i(t.onObjectBegin),a=o(t.onObjectProperty),l=i(t.onObjectEnd),c=i(t.onArrayBegin),d=i(t.onArrayEnd),f=o(t.onLiteralValue),m=o(t.onSeparator),g=i(t.onComment),b=o(t.onError),v=e&&e.disallowComments,w=e&&e.allowTrailingComma;function k(){for(;;){let ee=r.scan();switch(r.getTokenError()){case 4:C(14);break;case 5:C(15);break;case 3:C(13);break;case 1:v||C(11);break;case 2:C(12);break;case 6:C(16);break}switch(ee){case 12:case 13:v?C(10):g();break;case 16:C(1);break;case 15:case 14:break;default:return ee}}}function C(ee,Be=[],yr=[]){if(b(ee),Be.length+yr.length>0){let Dt=r.getToken();for(;Dt!==17;){if(Be.indexOf(Dt)!==-1){k();break}else if(yr.indexOf(Dt)!==-1)break;Dt=k()}}}function M(ee){let Be=r.getTokenValue();return ee?f(Be):a(Be),k(),!0}function _(){switch(r.getToken()){case 11:{let ee=0;try{ee=JSON.parse(r.getTokenValue()),typeof ee!="number"&&(C(2),ee=0)}catch{C(2)}f(ee);break}case 7:f(null);break;case 8:f(!0);break;case 9:f(!1);break;default:return!1}return k(),!0}function V(){return r.getToken()!==10?(C(3,[],[2,5]),!1):(M(!1),r.getToken()===6?(m(":"),k(),ze()||C(4,[],[2,5])):C(5,[],[2,5]),!0)}function Y(){s(),k();let ee=!1;for(;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(ee||C(4,[],[]),m(","),k(),r.getToken()===2&&w)break}else ee&&C(6,[],[]);V()||C(4,[],[2,5]),ee=!0}return l(),r.getToken()!==2?C(7,[2],[]):k(),!0}function q(){c(),k();let ee=!1;for(;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(ee||C(4,[],[]),m(","),k(),r.getToken()===4&&w)break}else ee&&C(6,[],[]);ze()||C(4,[],[4,5]),ee=!0}return d(),r.getToken()!==4?C(8,[4],[]):k(),!0}function ze(){switch(r.getToken()){case 3:return q();case 1:return Y();case 10:return M(!0);default:return _()}}return k(),r.getToken()===17?e.allowEmptyContent?!0:(C(4,[],[]),!1):ze()?(r.getToken()!==17&&C(9,[],[]),!0):(C(4,[],[]),!1)}function ja(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var Ff=class extends O{constructor(e,r,i,o){super();this.storagePath=e;this.saveStrategy=r;this.logService=i;this.fileService=o}storage=Object.create(null);lastSavedStorageContents="";flushDelayer=this._register(new Kt(this.saveStrategy===0?0:100));initializing=void 0;closing=void 0;init(){return this.initializing||(this.initializing=this.doInit()),this.initializing}async doInit(){try{this.lastSavedStorageContents=(await this.fileService.readFile(this.storagePath)).value.toString(),this.storage=JSON.parse(this.lastSavedStorageContents)}catch(e){e.fileOperationResult!==1&&this.logService.error(e)}}getItem(e,r){let i=this.storage[e];return st(i)?r:i}setItem(e,r){this.setItems([{key:e,data:r}])}setItems(e){let r=!1;for(let{key:i,data:o}of e)this.storage[i]!==o&&(st(o)?wr(this.storage[i])||(this.storage[i]=void 0,r=!0):(this.storage[i]=o,r=!0));r&&this.save()}removeItem(e){wr(this.storage[e])||(this.storage[e]=void 0,this.save())}async save(){if(!this.closing)return this.flushDelayer.trigger(()=>this.doSave())}async doSave(){if(!this.initializing)return;await this.initializing;let e=JSON.stringify(this.storage,null,4);if(e!==this.lastSavedStorageContents)try{await this.fileService.writeFile(this.storagePath,te.fromString(e),{atomic:{postfix:".vsctmp"}}),this.lastSavedStorageContents=e}catch(r){this.logService.error(r)}}async close(){return this.closing||(this.closing=this.flushDelayer.trigger(()=>this.doSave(),0)),this.closing}},Ga=class extends O{fileStorage;constructor(t,e,r,i){super(),this.fileStorage=this._register(new Ff(e.stateResource,t,r,i))}async init(){await this.fileStorage.init()}getItem(t,e){return this.fileStorage.getItem(t,e)}};Ga=P([h(1,zt),h(2,B),h(3,We)],Ga);var yd=class extends Ga{setItem(t,e){this.fileStorage.setItem(t,e)}setItems(t){this.fileStorage.setItems(t)}removeItem(t){this.fileStorage.removeItem(t)}close(){return this.fileStorage.close()}};var xn=class extends Wo{constructor(e,r,i,o,s){super(i,o,r,s);this.stateReadonlyService=e;this.nativeEnvironmentService=i}static PROFILE_ASSOCIATIONS_MIGRATION_KEY="profileAssociationsMigration";getStoredProfiles(){return this.stateReadonlyService.getItem(xn.PROFILES_KEY,[]).map(r=>({...r,location:Ce(r.location)?this.uriIdentityService.extUri.joinPath(this.profilesHome,r.location):x.revive(r.location)}))}getStoredProfileAssociations(){let e=this.stateReadonlyService.getItem(xn.PROFILE_ASSOCIATIONS_KEY,{});return this.stateReadonlyService.getItem(xn.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!1)?e:this.migrateStoredProfileAssociations(e)}getDefaultProfileExtensionsLocation(){return this.uriIdentityService.extUri.joinPath(x.file(this.nativeEnvironmentService.extensionsPath).with({scheme:this.profilesHome.scheme}),"extensions.json")}};xn=P([h(0,Dv),h(1,ht),h(2,Jr),h(3,We),h(4,B)],xn);var jt=class extends xn{constructor(e,r,i,o,s){super(e,r,i,o,s);this.stateService=e}saveStoredProfiles(e){e.length?this.stateService.setItem(jt.PROFILES_KEY,e.map(r=>({...r,location:this.uriIdentityService.extUri.basename(r.location)}))):this.stateService.removeItem(jt.PROFILES_KEY)}getStoredProfiles(){let e=super.getStoredProfiles();return this.stateService.getItem("userDataProfilesMigration",!1)||(this.saveStoredProfiles(e),this.stateService.setItem("userDataProfilesMigration",!0)),e}saveStoredProfileAssociations(e){e.emptyWindows||e.workspaces?this.stateService.setItem(jt.PROFILE_ASSOCIATIONS_KEY,e):this.stateService.removeItem(jt.PROFILE_ASSOCIATIONS_KEY)}getStoredProfileAssociations(){let e="workspaceAndProfileInfo",r=this.stateService.getItem(e,void 0);if(r){this.stateService.removeItem(e);let o=r.reduce((s,{workspace:a,profile:l})=>(s[x.revive(a).toString()]=x.revive(l).toString(),s),{});this.stateService.setItem(jt.PROFILE_ASSOCIATIONS_KEY,{workspaces:o})}let i=super.getStoredProfileAssociations();return this.stateService.getItem(jt.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!1)||(this.saveStoredProfileAssociations(i),this.stateService.setItem(jt.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!0)),i}};jt=P([h(0,Ye),h(1,ht),h(2,Jr),h(3,We),h(4,B)],jt);var bd=class extends jt{constructor(t,e,r,i){super(new yd(0,e,i,r),t,e,r,i)}async init(){return await this.stateService.init(),super.init()}};bd=P([h(0,ht),h(1,Jr),h(2,We),h(3,B)],bd);var ir=$t,Id=class extends jt{constructor(t,e,r,i,o){super(t,e,r,i,o)}getAssociatedEmptyWindows(){let t=[];for(let e of this.profilesObject.emptyWindows.keys())t.push({id:e});return t}};Id=P([h(0,Ye),h(1,ht),h(2,Jr),h(3,We),h(4,B)],Id);async function Vy(n,t,e){for(let i of n){let o=i.openedWorkspace;if(Ue(o)){let s=await e(o);if(s){if(s.folders.some(a=>Ae.isEqualOrParent(t,a.uri)))return i}else if(Ae.isEqualOrParent(t,o.configPath))return i}}let r=n.filter(i=>Ze(i.openedWorkspace)&&Ae.isEqualOrParent(t,i.openedWorkspace.uri));if(r.length)return r.sort((i,o)=>-(i.openedWorkspace.uri.path.length-o.openedWorkspace.uri.path.length))[0]}function ii(n,t){for(let e of n)if(Ue(e.openedWorkspace)&&Ae.isEqual(e.openedWorkspace.configPath,t)||Ze(e.openedWorkspace)&&Ae.isEqual(e.openedWorkspace.uri,t))return e}function Ky(n,t){let e=r=>t.some(i=>Ae.isEqual(x.file(i),x.file(r)));for(let r of n)if(r.config?.extensionDevelopmentPath?.some(i=>e(i)))return r}var Uf=R("workspacesService");function wd(n){return n.hasOwnProperty("workspace")}function Ja(n){return n.hasOwnProperty("folderUri")}function zy(n){return n.hasOwnProperty("fileUri")}function qy(n){return $y(n)||jy(n)}function $y(n){let t=n;return typeof t?.path=="string"&&(!t.name||typeof t.name=="string")}function jy(n){let t=n;return typeof t?.uri=="string"&&(!t.name||typeof t.name=="string")}function Gy(n,t,e,r,i){if(n.scheme!==r.scheme)return{name:e,uri:n.toString(!0)};let o=t?void 0:i.relativePath(r,n);if(o!==void 0)o.length===0?o=".":N&&(o=Hy(o));else if(n.scheme===U.file)o=n.fsPath,N&&(o=Hy(o));else if(i.isEqualAuthority(n.authority,r.authority))o=n.path;else return{name:e,uri:n.toString(!0)};return{name:e,path:o}}function Hy(n){return n=fa(n),lg(n)||(n=Gr(n)),n}function Jy(n,t,e){let r=[],i=new Set,o=e.dirname(t);for(let s of n){let a;if($y(s))s.path&&(a=e.resolvePath(o,s.path));else if(jy(s))try{a=x.parse(s.uri),a.path[0]!==Q.sep&&(a=a.with({path:Q.sep+a.path}))}catch(l){console.warn(l)}if(a){let l=e.getComparisonKey(a);if(!i.has(l)){i.add(l);let c=s.name||e.basenameOrAuthority(a);r.push(new wc({uri:a,name:c,index:r.length},s))}}}return r}function RS(n){return n.workspace&&typeof n.workspace=="object"&&typeof n.workspace.id=="string"&&typeof n.workspace.configPath=="string"}function LS(n){return typeof n.folderUri=="string"}function OS(n){return typeof n.fileUri=="string"}function Qy(n,t){let e={workspaces:[],files:[]};if(n){let r=function(o,s){for(let a=0;a<o.length;a++)try{s(o[a],a)}catch(l){t.warn(`Error restoring recent entry ${JSON.stringify(o[a])}: ${l.toString()}. Skip entry.`)}},i=n;Array.isArray(i.entries)&&r(i.entries,o=>{let s=o.label,a=o.remoteAuthority;RS(o)?e.workspaces.push({label:s,remoteAuthority:a,workspace:{id:o.workspace.id,configPath:x.parse(o.workspace.configPath)}}):LS(o)?e.workspaces.push({label:s,remoteAuthority:a,folderUri:x.parse(o.folderUri)}):OS(o)&&e.files.push({label:s,remoteAuthority:a,fileUri:x.parse(o.fileUri)})})}return e}function Yy(n){let t={entries:[]};for(let e of n.workspaces)Ja(e)?t.entries.push({folderUri:e.folderUri.toString(),label:e.label,remoteAuthority:e.remoteAuthority}):t.entries.push({workspace:{id:e.workspace.id,configPath:e.workspace.configPath.toString()},label:e.label,remoteAuthority:e.remoteAuthority});for(let e of n.files)t.entries.push({fileUri:e.fileUri.toString(),label:e.label,remoteAuthority:e.remoteAuthority});return t}import{createHash as Nf}from"crypto";var yH=128/4;function Sn(n){function t(){let e=n.scheme===U.file?Et(n):n.toString();return j||(e=e.toLowerCase()),Nf("md5").update(e).digest("hex")}return{id:t(),configPath:n}}function xd(n,t){function e(){if(n.scheme!==U.file)return Nf("md5").update(n.toString()).digest("hex");if(!t)return;let i;return j?i=t.ino:A?i=t.birthtime.getTime():N&&(typeof t.birthtimeMs=="number"?i=Math.floor(t.birthtimeMs):i=t.birthtime.getTime()),Nf("md5").update(n.fsPath).update(i?String(i):"").digest("hex")}let r=e();if(typeof r=="string")return{id:r,uri:n}}function Qa(){return{id:(Date.now()+Math.round(Math.random()*1e3)).toString()}}var or=R("workspacesManagementMainService"),Zo=class extends O{constructor(e,r,i,o,s){super();this.environmentMainService=e;this.logService=r;this.userDataProfilesMainService=i;this.backupMainService=o;this.dialogMainService=s}_onDidDeleteUntitledWorkspace=this._register(new S);onDidDeleteUntitledWorkspace=this._onDidDeleteUntitledWorkspace.event;_onDidEnterWorkspace=this._register(new S);onDidEnterWorkspace=this._onDidEnterWorkspace.event;untitledWorkspacesHome=this.environmentMainService.untitledWorkspacesHome;untitledWorkspaces=[];async initialize(){this.untitledWorkspaces=[];try{let e=(await $.readdir(this.untitledWorkspacesHome.with({scheme:U.file}).fsPath)).map(r=>ne(this.untitledWorkspacesHome,r,Np));for(let r of e){let i=Sn(r),o=await this.resolveLocalWorkspace(r);o?this.untitledWorkspaces.push({workspace:i,remoteAuthority:o.remoteAuthority}):await this.deleteUntitledWorkspace(i)}}catch(e){e.code!=="ENOENT"&&this.logService.warn(`Unable to read folders in ${this.untitledWorkspacesHome} (${e}).`)}}resolveLocalWorkspace(e){return this.doResolveLocalWorkspace(e,r=>Bf.promises.readFile(r,"utf8"))}doResolveLocalWorkspace(e,r){if(this.isWorkspacePath(e)&&e.scheme===U.file)try{let i=r(e.fsPath);return i instanceof Promise?i.then(o=>this.doResolveWorkspace(e,o),o=>{}):this.doResolveWorkspace(e,i)}catch{return}}isWorkspacePath(e){return Bp(e,this.environmentMainService)||Qr(e)}doResolveWorkspace(e,r){try{let i=this.doParseStoredWorkspace(e,r),o=Sn(e);return{id:o.id,configPath:o.configPath,folders:Jy(i.folders,o.configPath,Ae),remoteAuthority:i.remoteAuthority,transient:i.transient}}catch(i){this.logService.warn(i.toString())}}doParseStoredWorkspace(e,r){let i=ni(r);if(i&&Array.isArray(i.folders))i.folders=i.folders.filter(o=>qy(o));else throw new Error(`${e.toString(!0)} looks like an invalid workspace file.`);return i}async createUntitledWorkspace(e,r){let{workspace:i,storedWorkspace:o}=this.newUntitledWorkspace(e,r),s=i.configPath.fsPath;return await Bf.promises.mkdir(Fe(s),{recursive:!0}),await $.writeFile(s,JSON.stringify(o,null,"	")),this.untitledWorkspaces.push({workspace:i,remoteAuthority:r}),i}newUntitledWorkspace(e=[],r){let i=(Date.now()+Math.round(Math.random()*1e3)).toString(),o=ne(this.untitledWorkspacesHome,i),s=ne(o,Np),a=[];for(let l of e)a.push(Gy(l.uri,!0,l.name,o,Ae));return{workspace:Sn(s),storedWorkspace:{folders:a,remoteAuthority:r}}}async getWorkspaceIdentifier(e){return Sn(e)}isUntitledWorkspace(e){return Bp(e.configPath,this.environmentMainService)}async deleteUntitledWorkspace(e){this.isUntitledWorkspace(e)&&(await this.doDeleteUntitledWorkspace(e),this.userDataProfilesMainService.isEnabled()&&this.userDataProfilesMainService.unsetWorkspace(e),this._onDidDeleteUntitledWorkspace.fire(e))}async doDeleteUntitledWorkspace(e){let r=Et(e.configPath);try{await $.rm(Fe(r));let i=F(this.environmentMainService.workspaceStorageHome.with({scheme:U.file}).fsPath,e.id);await $.exists(i)&&await $.writeFile(F(i,"obsolete"),""),this.untitledWorkspaces=this.untitledWorkspaces.filter(o=>o.workspace.id!==e.id)}catch(i){this.logService.warn(`Unable to delete untitled workspace ${r} (${i}).`)}}getUntitledWorkspaces(){return this.untitledWorkspaces}async enterWorkspace(e,r,i){if(!e||!e.win||!e.isReady||!await this.isValidTargetWorkspacePath(e,r,i))return;let s=await this.doEnterWorkspace(e,Sn(i));if(s)return this._onDidEnterWorkspace.fire({window:e,workspace:s.workspace}),s}async isValidTargetWorkspacePath(e,r,i){return i?Ue(e.openedWorkspace)&&Ae.isEqual(e.openedWorkspace.configPath,i)?!1:ii(r,i)?(await this.dialogMainService.showMessageBox({type:"info",buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK")],message:p("workspaceOpenedMessage","Unable to save workspace '{0}'",Vt(i)),detail:p("workspaceOpenedDetail","The workspace is already opened in another window. Please close that window first and then try again.")},AS.BrowserWindow.getFocusedWindow()??void 0),!1):!0:!0}async doEnterWorkspace(e,r){if(!e.config)return;e.focus();let i;return e.config.extensionDevelopmentPath||(e.config.backupPath?i=await this.backupMainService.registerWorkspaceBackup({workspace:r,remoteAuthority:e.remoteAuthority},e.config.backupPath):i=this.backupMainService.registerWorkspaceBackup({workspace:r,remoteAuthority:e.remoteAuthority})),Ue(e.openedWorkspace)&&this.isUntitledWorkspace(e.openedWorkspace)&&await this.deleteUntitledWorkspace(e.openedWorkspace),e.config.workspace=r,e.config.backupPath=i,{workspace:r,backupPath:i}}};Zo=P([h(0,ge),h(1,B),h(2,ir),h(3,en),h(4,Mt)],Zo);var oi=Ro;var Ya=class n extends O{constructor(e,r,i,o){super();this.configurationService=e;this.stateService=r;this.environmentMainService=i;this.logService=o}_onDidClose=this._register(new S);onDidClose=this._onDidClose.event;_onDidMaximize=this._register(new S);onDidMaximize=this._onDidMaximize.event;_onDidUnmaximize=this._register(new S);onDidUnmaximize=this._onDidUnmaximize.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;_onDidEnterFullScreen=this._register(new S);onDidEnterFullScreen=this._onDidEnterFullScreen.event;_onDidLeaveFullScreen=this._register(new S);onDidLeaveFullScreen=this._onDidLeaveFullScreen.event;_lastFocusTime=Date.now();get lastFocusTime(){return this._lastFocusTime}_win=null;get win(){return this._win}setWin(e,r){this._win=e,this._register(E.fromNodeEventEmitter(e,"maximize")(()=>this._onDidMaximize.fire())),this._register(E.fromNodeEventEmitter(e,"unmaximize")(()=>this._onDidUnmaximize.fire())),this._register(E.fromNodeEventEmitter(e,"closed")(()=>{this._onDidClose.fire(),this.dispose()})),this._register(E.fromNodeEventEmitter(e,"focus")(()=>{this._lastFocusTime=Date.now()})),this._register(E.fromNodeEventEmitter(this._win,"enter-full-screen")(()=>this._onDidEnterFullScreen.fire())),this._register(E.fromNodeEventEmitter(this._win,"leave-full-screen")(()=>this._onDidLeaveFullScreen.fire()));let i=!Fr(this.configurationService,r?.titleBarStyle==="hidden"?"custom":void 0);if(A&&i&&e.setSheetOffset(gh(US())?28:22),i&&(Zn(this.configurationService)||A)){let o=this.stateService.getItem(n.windowControlHeightStateStorageKey);o?this.updateWindowControls({height:o}):this.updateWindowControls({height:iy})}N&&i&&e.hookWindowMessage(278,()=>{let[s,a]=e.getPosition(),l=gr.screen.getCursorScreenPoint(),c=l.x-s,d=l.y-a;return!(c>30&&d>=0&&d<=Math.max(e.getBounds().height*.15,35))||(e.setEnabled(!1),e.setEnabled(!0),this._onDidTriggerSystemContextMenu.fire({x:c,y:d})),0}),this.environmentMainService.args["open-devtools"]===!0&&e.webContents.openDevTools(),A&&(this._register(this.onDidEnterFullScreen(()=>{this.joinNativeFullScreenTransition?.complete(!0)})),this._register(this.onDidLeaveFullScreen(()=>{this.joinNativeFullScreenTransition?.complete(!0)})))}applyState(e,r=gr.screen.getAllDisplays().length>0){let i=this.configurationService.getValue("window"),o=A&&i?.nativeTabs===!0;(A||N)&&r&&(!o||gr.BrowserWindow.getAllWindows().length===1)&&[e.width,e.height,e.x,e.y].every(s=>typeof s=="number")&&this._win?.setBounds({width:e.width,height:e.height,x:e.x,y:e.y}),(e.mode===0||e.mode===3)&&(this._win?.maximize(),e.mode===3&&this.setFullScreen(!0,!0),this._win?.show())}representedFilename;setRepresentedFilename(e){A?this.win?.setRepresentedFilename(e):this.representedFilename=e}getRepresentedFilename(){return A?this.win?.getRepresentedFilename():this.representedFilename}documentEdited;setDocumentEdited(e){A&&this.win?.setDocumentEdited(e),this.documentEdited=e}isDocumentEdited(){return A?!!this.win?.isDocumentEdited():!!this.documentEdited}focus(e){A&&e?.force&&gr.app.focus({steal:!0});let r=this.win;r&&(r.isMinimized()&&r.restore(),r.focus())}handleTitleDoubleClick(){let e=this.win;if(e)if(A)switch(gr.systemPreferences.getUserDefault("AppleActionOnDoubleClick","string")){case"Minimize":e.minimize();break;case"None":break;case"Maximize":default:e.isMaximized()?e.unmaximize():e.maximize()}else e.isMaximized()?e.unmaximize():e.maximize()}static windowControlHeightStateStorageKey="windowControlHeight";hasWindowControlOverlay=Zn(this.configurationService);updateWindowControls(e){let r=this.win;if(r){if(e.height&&this.stateService.setItem(zi.windowControlHeightStateStorageKey,e.height),this.hasWindowControlOverlay)r.setTitleBarOverlay({color:e.backgroundColor?.trim()===""?void 0:e.backgroundColor,symbolColor:e.foregroundColor?.trim()===""?void 0:e.foregroundColor,height:e.height?e.height-1:void 0});else if(A&&e.height!==void 0){let i=(e.height-15)/2;i?r.setWindowButtonPosition({x:i,y:i}):r.setWindowButtonPosition(null)}}}transientIsNativeFullScreen=void 0;joinNativeFullScreenTransition=void 0;toggleFullScreen(){this.setFullScreen(!this.isFullScreen,!1)}setFullScreen(e,r){td(this.configurationService)?this.setNativeFullScreen(e,r):this.setSimpleFullScreen(e)}get isFullScreen(){if(A&&typeof this.transientIsNativeFullScreen=="boolean")return this.transientIsNativeFullScreen;let e=this.win,r=e?.isFullScreen(),i=e?.isSimpleFullScreen();return!!(r||i)}setNativeFullScreen(e,r){let i=this.win;i?.isSimpleFullScreen()&&i?.setSimpleFullScreen(!1),this.doSetNativeFullScreen(e,r)}doSetNativeFullScreen(e,r){if(A){this.transientIsNativeFullScreen=e;let o=this.joinNativeFullScreenTransition=new Ht;(async()=>{let s=await Promise.race([o.p,$e(1e4).then(()=>!1)]);this.joinNativeFullScreenTransition===o&&(this.transientIsNativeFullScreen=void 0,this.joinNativeFullScreenTransition=void 0,!s&&e&&r&&this.win&&!this.win.isFullScreen()&&(this.logService.warn("window: native macOS fullscreen transition did not happen within 10s from restoring"),this._onDidLeaveFullScreen.fire()))})()}this.win?.setFullScreen(e)}setSimpleFullScreen(e){let r=this.win;r?.isFullScreen()&&this.doSetNativeFullScreen(!1,!1),r?.setSimpleFullScreen(e),r?.webContents.focus()}dispose(){super.dispose(),this._win=null}},zi=class extends Ya{constructor(e,r,i,o,s,a,l,c,d,f,m,g,b,v,w,k,C,M,_,V,Y){super(f,V,o,r);this.loggerMainService=i;this.policyService=s;this.userDataProfilesService=a;this.fileService=l;this.applicationStorageMainService=c;this.storageMainService=d;this.themeMainService=m;this.workspacesManagementMainService=g;this.backupMainService=b;this.telemetryService=v;this.dialogMainService=w;this.lifecycleMainService=k;this.productService=C;this.protocolMainService=M;this.windowsMainService=_;{let[q,ze]=this.restoreWindowState(e.state);this.windowState=q,this.logService.trace("window#ctor: using window state",q);let ee=Y.invokeFunction(hd,this.windowState,void 0,{preload:Me.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${this.configObjectUrl.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none"});Sr("code/willCreateCodeBrowserWindow"),this._win=new gr.BrowserWindow(ee),Sr("code/didCreateCodeBrowserWindow"),this._id=this._win.id,this.setWin(this._win,ee),this.applyState(this.windowState,ze),this._lastFocusTime=Date.now()}this.onConfigurationUpdated(),this.createTouchBar(),this.registerListeners()}_onWillLoad=this._register(new S);onWillLoad=this._onWillLoad.event;_onDidSignalReady=this._register(new S);onDidSignalReady=this._onDidSignalReady.event;_onDidDestroy=this._register(new S);onDidDestroy=this._onDidDestroy.event;_id;get id(){return this._id}_win;get backupPath(){return this._config?.backupPath}get openedWorkspace(){return this._config?.workspace}get profile(){if(!this.config)return;let e=this.userDataProfilesService.profiles.find(r=>r.id===this.config?.profiles.profile.id);return this.isExtensionDevelopmentHost&&e?e:this.userDataProfilesService.getProfileForWorkspace(this.config.workspace??$n(this.backupPath,this.isExtensionDevelopmentHost))??this.userDataProfilesService.defaultProfile}get remoteAuthority(){return this._config?.remoteAuthority}_config;get config(){return this._config}get isExtensionDevelopmentHost(){return!!this._config?.extensionDevelopmentPath}get isExtensionTestHost(){return!!this._config?.extensionTestsPath}get isExtensionDevelopmentTestFromCli(){return this.isExtensionDevelopmentHost&&this.isExtensionTestHost&&!this._config?.debugId}windowState;currentMenuBarVisibility;whenReadyCallbacks=[];touchBarGroups=[];currentHttpProxy=void 0;currentNoProxy=void 0;customZoomLevel=void 0;configObjectUrl=this._register(this.protocolMainService.createIPCObjectUrl());pendingLoadConfig;wasLoaded=!1;readyState=0;setReady(){for(this.logService.trace(`window#load: window reported ready (id: ${this._id})`),this.readyState=2;this.whenReadyCallbacks.length;)this.whenReadyCallbacks.pop()(this);this._onDidSignalReady.fire()}ready(){return new Promise(e=>{if(this.isReady)return e(this);this.whenReadyCallbacks.push(e)})}get isReady(){return this.readyState===2}get whenClosedOrLoaded(){return new Promise(e=>{function r(){i.dispose(),o.dispose(),e()}let i=this.onDidClose(()=>r()),o=this.onWillLoad(()=>r())})}registerListeners(){this._register(E.fromNodeEventEmitter(this._win,"unresponsive")(()=>this.onWindowError(1))),this._register(E.fromNodeEventEmitter(this._win.webContents,"render-process-gone",(r,i)=>i)(r=>this.onWindowError(2,{...r}))),this._register(E.fromNodeEventEmitter(this._win.webContents,"did-fail-load",(r,i,o)=>({exitCode:i,reason:o}))(({exitCode:r,reason:i})=>this.onWindowError(3,{reason:i,exitCode:r}))),this._register(E.fromNodeEventEmitter(this._win.webContents,"will-prevent-unload")(r=>r.preventDefault())),this._register(E.fromNodeEventEmitter(this._win.webContents,"did-finish-load")(()=>{this.pendingLoadConfig&&(this._config=this.pendingLoadConfig,this.pendingLoadConfig=void 0)})),this._register(this.onDidMaximize(()=>{this._config&&(this._config.maximized=!0)})),this._register(this.onDidUnmaximize(()=>{this._config&&(this._config.maximized=!1)})),this._register(this.onDidEnterFullScreen(()=>{this.sendWhenReady("vscode:enterFullScreen",Ee.None)})),this._register(this.onDidLeaveFullScreen(()=>{this.sendWhenReady("vscode:leaveFullScreen",Ee.None)})),this._register(this.configurationService.onDidChangeConfiguration(r=>this.onConfigurationUpdated(r))),this._register(this.workspacesManagementMainService.onDidDeleteUntitledWorkspace(r=>this.onDidDeleteUntitledWorkspace(r)));let e=["https://marketplace.visualstudio.com/*","https://*.vsassets.io/*"];this._win.webContents.session.webRequest.onBeforeSendHeaders({urls:e},async(r,i)=>{let o=await this.getMarketplaceHeaders();i({cancel:!1,requestHeaders:Object.assign(r.requestHeaders,o)})})}marketplaceHeadersPromise;getMarketplaceHeaders(){return this.marketplaceHeadersPromise||(this.marketplaceHeadersPromise=Ly(this.productService.version,this.productService,this.environmentMainService,this.configurationService,this.fileService,this.applicationStorageMainService,this.telemetryService)),this.marketplaceHeadersPromise}async onWindowError(e,r){switch(e){case 2:this.logService.error(`CodeWindow: renderer process gone (reason: ${r?.reason||"<unknown>"}, code: ${r?.exitCode||"<unknown>"})`);break;case 1:this.logService.error("CodeWindow: detected unresponsive");break;case 3:this.logService.error(`CodeWindow: failed to load (reason: ${r?.reason||"<unknown>"}, code: ${r?.exitCode||"<unknown>"})`);break}switch(this.telemetryService.publicLog2("windowerror",{type:e,reason:r?.reason,code:r?.exitCode}),e){case 1:case 2:if(this.isExtensionDevelopmentTestFromCli){this.lifecycleMainService.kill(1);return}if(this.environmentMainService.args["enable-smoke-test-driver"]){await this.destroyWindow(!1,!1),this.lifecycleMainService.quit();return}if(e===1){if(this.isExtensionDevelopmentHost||this.isExtensionTestHost||this._win&&this._win.webContents&&this._win.webContents.isDevToolsOpened())return;let{response:i,checkboxChecked:o}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"reopen",comment:["&& denotes a mnemonic"]},"&&Reopen"),p({key:"close",comment:["&& denotes a mnemonic"]},"&&Close"),p({key:"wait",comment:["&& denotes a mnemonic"]},"&&Keep Waiting")],message:p("appStalled","The window is not responding"),detail:p("appStalledDetail","You can reopen or close the window or keep waiting."),checkboxLabel:this._config?.workspace?p("doNotRestoreEditors","Don't restore editors"):void 0},this._win);if(i!==2){let s=i===0;await this.destroyWindow(s,o)}}else if(e===2){let i;r?i=p("appGoneDetails","The window terminated unexpectedly (reason: '{0}', code: '{1}')",r.reason,r.exitCode??"<unknown>"):i=p("appGone","The window terminated unexpectedly");let{response:o,checkboxChecked:s}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[this._config?.workspace?p({key:"reopen",comment:["&& denotes a mnemonic"]},"&&Reopen"):p({key:"newWindow",comment:["&& denotes a mnemonic"]},"&&New Window"),p({key:"close",comment:["&& denotes a mnemonic"]},"&&Close")],message:i,detail:this._config?.workspace?p("appGoneDetailWorkspace","We are sorry for the inconvenience. You can reopen the window to continue where you left off."):p("appGoneDetailEmptyWindow","We are sorry for the inconvenience. You can open a new empty window to start again."),checkboxLabel:this._config?.workspace?p("doNotRestoreEditors","Don't restore editors"):void 0},this._win),a=o===0;await this.destroyWindow(a,s)}break}}async destroyWindow(e,r){let i=this._config?.workspace;if(r&&i)try{let o=this.storageMainService.workspaceStorage(i);await o.init(),o.delete("memento/workbench.parts.editor"),await o.close()}catch(o){this.logService.error(o)}this._onDidDestroy.fire();try{if(e&&this._config){let o,s;Ze(i)?o={folderUri:i.uri}:Ue(i)?o={workspaceUri:i.configPath}:s=!0,(await this.windowsMainService.open({context:5,userEnv:this._config.userEnv,cli:{...this.environmentMainService.args,_:[]},urisToOpen:o?[o]:void 0,forceEmpty:s,forceNewWindow:!0,remoteAuthority:this.remoteAuthority})).at(0)?.focus()}}finally{this._win?.destroy()}}onDidDeleteUntitledWorkspace(e){this._config?.workspace?.id===e.id&&(this._config.workspace=void 0)}onConfigurationUpdated(e){if(!e||e.affectsConfiguration("window.menuBarVisibility")){let r=this.getMenuBarVisibility();r!==this.currentMenuBarVisibility&&(this.currentMenuBarVisibility=r,this.setMenuBarVisibility(r))}if(!e||e.affectsConfiguration("http.proxy")||e.affectsConfiguration("http.noProxy")){let r=(this.configurationService.getValue("http.proxy")||"").trim()||(process.env.https_proxy||process.env.HTTPS_PROXY||process.env.http_proxy||process.env.HTTP_PROXY||"").trim()||void 0;if(r?.indexOf("@")!==-1){let o=x.parse(r),s=o.authority.indexOf("@");s!==-1&&(r=o.with({authority:o.authority.substring(s+1)}).toString())}r?.endsWith("/")&&(r=r.substr(0,r.length-1));let i=(this.configurationService.getValue("http.noProxy")||[]).map(o=>o.trim()).join(",")||(process.env.no_proxy||process.env.NO_PROXY||"").trim()||void 0;if((r||"").indexOf("@")===-1&&(r!==this.currentHttpProxy||i!==this.currentNoProxy)){this.currentHttpProxy=r,this.currentNoProxy=i;let o=r||"",s=i?`${i},<local>`:"<local>";this.logService.trace(`Setting proxy to '${o}', bypassing '${s}'`),this._win.webContents.session.setProxy({proxyRules:o,proxyBypassRules:s,pacScript:""}),gr.app.setProxy({proxyRules:o,proxyBypassRules:s,pacScript:""})}}}addTabbedWindow(e){A&&e.win&&this._win.addTabbedWindow(e.win)}load(e,r=Object.create(null)){this.logService.trace(`window#load: attempt to load window (id: ${this._id})`),this.isDocumentEdited()&&(!r.isReload||!this.backupMainService.isHotExitEnabled())&&this.setDocumentEdited(!1),r.isReload||(this.getRepresentedFilename()&&this.setRepresentedFilename(""),this._win.setTitle(this.productService.nameLong)),this.updateConfiguration(e,r),this.readyState===0?this._config=e:this.pendingLoadConfig=e,this.readyState=1,this._win.loadURL(Me.asBrowserUri(`vs/code/electron-sandbox/workbench/workbench${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0));let i=this.wasLoaded;this.wasLoaded=!0,!this.environmentMainService.isBuilt&&!this.environmentMainService.extensionTestsLocationURI&&this._register(new bt(()=>{this._win&&!this._win.isVisible()&&!this._win.isMinimized()&&(this._win.show(),this.focus({force:!0}),this._win.webContents.openDevTools())},1e4)).schedule(),this._onWillLoad.fire({workspace:e.workspace,reason:r.isReload?3:i?2:1})}updateConfiguration(e,r){let i=(this._config??this.pendingLoadConfig)?.userEnv;if(i){let o=rn(i)&&!rn(e.userEnv),s=this.isExtensionDevelopmentHost;(o||s)&&(e.userEnv={...i,...e.userEnv})}process.env.CHROME_CRASHPAD_PIPE_NAME&&Object.assign(e.userEnv,{CHROME_CRASHPAD_PIPE_NAME:process.env.CHROME_CRASHPAD_PIPE_NAME}),r.disableExtensions!==void 0&&(e["disable-extensions"]=r.disableExtensions),e.fullscreen=this.isFullScreen,e.maximized=this._win.isMaximized(),e.partsSplash=this.themeMainService.getWindowSplash(),e.zoomLevel=this.getZoomLevel(),e.isCustomZoomLevel=typeof this.customZoomLevel=="number",e.isCustomZoomLevel&&e.partsSplash&&(e.partsSplash.zoomLevel=e.zoomLevel),Sr("code/willOpenNewWindow"),e.perfMarks=Nc(),this.configObjectUrl.update(e)}async reload(e){let r=Object.assign({},this._config);r.workspace=await this.validateWorkspaceBeforeReload(r),delete r.filesToOpenOrCreate,delete r.filesToDiff,delete r.filesToMerge,delete r.filesToWait,this.isExtensionDevelopmentHost&&e&&(r.verbose=e.verbose,r.debugId=e.debugId,r.extensionEnvironment=e.extensionEnvironment,r["inspect-extensions"]=e["inspect-extensions"],r["inspect-brk-extensions"]=e["inspect-brk-extensions"],r["extensions-dir"]=e["extensions-dir"]),r.accessibilitySupport=gr.app.isAccessibilitySupportEnabled(),r.isInitialStartup=!1,r.policiesData=this.policyService.serialize(),r.continueOn=this.environmentMainService.continueOn,r.profiles={all:this.userDataProfilesService.profiles,profile:this.profile||this.userDataProfilesService.defaultProfile,home:this.userDataProfilesService.profilesHome},r.logLevel=this.loggerMainService.getLogLevel(),r.loggers={window:this.loggerMainService.getRegisteredLoggers(this.id),global:this.loggerMainService.getRegisteredLoggers()},this.load(r,{isReload:!0,disableExtensions:e?.["disable-extensions"]})}async validateWorkspaceBeforeReload(e){if(Ue(e.workspace)){let r=e.workspace.configPath;if(r.scheme===U.file&&!await this.fileService.exists(r))return}else if(Ze(e.workspace)){let r=e.workspace.uri;if(r.scheme===U.file&&!await this.fileService.exists(r))return}return e.workspace}serializeWindowState(){if(!this._win)return ei();if(this.isFullScreen){let i;try{i=gr.screen.getDisplayMatching(this.getBounds())}catch{}let o=ei();return{mode:3,display:i?i.id:void 0,width:this.windowState.width||o.width,height:this.windowState.height||o.height,x:this.windowState.x||0,y:this.windowState.y||0,zoomLevel:this.customZoomLevel}}let e=Object.create(null),r;if(!A&&this._win.isMaximized()?r=0:r=1,r===0?e.mode=0:e.mode=1,r===1||r===0){let i;r===1?i=this.getBounds():i=this._win.getNormalBounds(),e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e.zoomLevel=this.customZoomLevel,e}restoreWindowState(e){Sr("code/willRestoreCodeWindowState");let r=!1;if(e){this.customZoomLevel=e.zoomLevel;try{let i=gr.screen.getAllDisplays();r=i.length>1,e=$a.validateWindowState(this.logService,e,i)}catch(i){this.logService.warn(`Unexpected error validating window state: ${i}
${i.stack}`)}}return Sr("code/didRestoreCodeWindowState"),[e||ei(),r]}getBounds(){let[e,r]=this._win.getPosition(),[i,o]=this._win.getSize();return{x:e,y:r,width:i,height:o}}setFullScreen(e,r){super.setFullScreen(e,r),this.sendWhenReady(e?"vscode:enterFullScreen":"vscode:leaveFullScreen",Ee.None),this.currentMenuBarVisibility&&this.setMenuBarVisibility(this.currentMenuBarVisibility,!1)}getMenuBarVisibility(){let e=ny(this.configurationService);return["visible","toggle","hidden"].indexOf(e)<0&&(e="classic"),e}setMenuBarVisibility(e,r=!0){A||(e==="toggle"&&r&&this.send("vscode:showInfoMessage",p("hiddenMenuBar","You can still access the menu bar by pressing the Alt-key.")),e==="hidden"?setTimeout(()=>{this.doSetMenuBarVisibility(e)}):this.doSetMenuBarVisibility(e))}doSetMenuBarVisibility(e){let r=this.isFullScreen;switch(e){case"classic":this._win.setMenuBarVisibility(!r),this._win.autoHideMenuBar=r;break;case"visible":this._win.setMenuBarVisibility(!0),this._win.autoHideMenuBar=!1;break;case"toggle":this._win.setMenuBarVisibility(!1),this._win.autoHideMenuBar=!0;break;case"hidden":this._win.setMenuBarVisibility(!1),this._win.autoHideMenuBar=!1;break}}notifyZoomLevel(e){this.customZoomLevel=e}getZoomLevel(){return typeof this.customZoomLevel=="number"?this.customZoomLevel:this.configurationService.getValue("window")?.zoomLevel}close(){this._win?.close()}sendWhenReady(e,r,...i){this.isReady?this.send(e,...i):this.ready().then(()=>{r.isCancellationRequested||this.send(e,...i)})}send(e,...r){if(this._win){if(this._win.isDestroyed()||this._win.webContents.isDestroyed()){this.logService.warn(`Sending IPC message to channel '${e}' for window that is destroyed`);return}try{this._win.webContents.send(e,...r)}catch(i){this.logService.warn(`Error sending IPC message to channel '${e}' of window ${this._id}: ${Xt(i)}`)}}}updateTouchBar(e){A&&this.touchBarGroups.forEach((r,i)=>{let o=e[i];r.segments=this.createTouchBarGroupSegments(o)})}createTouchBar(){if(A){for(let e=0;e<10;e++){let r=this.createTouchBarGroup();this.touchBarGroups.push(r)}this._win.setTouchBar(new gr.TouchBar({items:this.touchBarGroups}))}}createTouchBarGroup(e=[]){let r=this.createTouchBarGroupSegments(e),i=new gr.TouchBar.TouchBarSegmentedControl({segments:r,mode:"buttons",segmentStyle:"automatic",change:o=>{this.sendWhenReady("vscode:runAction",Ee.None,{id:i.segments[o].id,from:"touchbar"})}});return i}createTouchBarGroupSegments(e=[]){return e.map(i=>{let o;i.icon&&!Tt.isThemeIcon(i.icon)&&i.icon?.dark?.scheme===U.file&&(o=gr.nativeImage.createFromPath(x.revive(i.icon.dark).fsPath),o.isEmpty()&&(o=void 0));let s;return typeof i.title=="string"?s=i.title:s=i.title.value,{id:i.id,label:o?void 0:s,icon:o}})}matches(e){return this._win?.webContents.id===e.id}dispose(){super.dispose(),this.loggerMainService.deregisterLoggers(this.id)}};zi=P([h(1,B),h(2,oi),h(3,ge),h(4,Gn),h(5,ir),h(6,We),h(7,si),h(8,$i),h(9,Ie),h(10,ri),h(11,or),h(12,en),h(13,He),h(14,Mt),h(15,le),h(16,Oe),h(17,ti),h(18,Te),h(19,Ye),h(20,tr)],zi);var ts=class extends Ya{constructor(e,r,i,o,s,a){super(o,s,r,i);this.webContents=e;this.lifecycleMainService=a;this.tryClaimWindow()}id=this.webContents.id;parentId=-1;get win(){return super.win||this.tryClaimWindow(),super.win}stateApplied=!1;tryClaimWindow(e){this._store.isDisposed||this.webContents.isDestroyed()||(this.doTryClaimWindow(e),e&&!this.stateApplied&&(this.stateApplied=!0,this.applyState({x:e.x,y:e.y,width:e.width,height:e.height,mode:e.show===!1?0:1})))}doTryClaimWindow(e){if(this._win)return;let r=NS.fromWebContents(this.webContents);r&&(this.logService.trace("[aux window] Claimed browser window instance"),this.setWin(r,e),r.setMenu(null),(N||j)&&Fr(this.configurationService,e?.titleBarStyle==="hidden"?"custom":void 0)&&r.setAutoHideMenuBar(!0),this.lifecycleMainService.registerAuxWindow(this))}matches(e){return this.webContents.id===e.id}};ts=P([h(1,ge),h(2,B),h(3,Ie),h(4,Ye),h(5,le)],ts);var le=R("lifecycleMainService");var ai=class extends O{constructor(e,r,i){super();this.logService=e;this.stateService=r;this.environmentMainService=i;this.resolveRestarted(),this.when(2).then(()=>this.registerListeners())}static QUIT_AND_RESTART_KEY="lifecycle.quitAndRestart";_onBeforeShutdown=this._register(new S);onBeforeShutdown=this._onBeforeShutdown.event;_onWillShutdown=this._register(new S);onWillShutdown=this._onWillShutdown.event;_onWillLoadWindow=this._register(new S);onWillLoadWindow=this._onWillLoadWindow.event;_onBeforeCloseWindow=this._register(new S);onBeforeCloseWindow=this._onBeforeCloseWindow.event;_quitRequested=!1;get quitRequested(){return this._quitRequested}_wasRestarted=!1;get wasRestarted(){return this._wasRestarted}_phase=1;get phase(){return this._phase}windowToCloseRequest=new Set;oneTimeListenerTokenGenerator=0;windowCounter=0;pendingQuitPromise=void 0;pendingQuitPromiseResolve=void 0;pendingWillShutdownPromise=void 0;mapWindowIdToPendingUnload=new Map;phaseWhen=new Map;relaunchHandler=void 0;resolveRestarted(){this._wasRestarted=!!this.stateService.getItem(ai.QUIT_AND_RESTART_KEY),this._wasRestarted&&this.stateService.removeItem(ai.QUIT_AND_RESTART_KEY)}registerListeners(){let e=()=>{this._quitRequested||(this.trace("Lifecycle#app.on(before-quit)"),this._quitRequested=!0,this.trace("Lifecycle#onBeforeShutdown.fire()"),this._onBeforeShutdown.fire(),A&&this.windowCounter===0&&this.fireOnWillShutdown(1))};vr.app.addListener("before-quit",e);let r=()=>{this.trace("Lifecycle#app.on(window-all-closed)"),(this._quitRequested||!A)&&vr.app.quit()};vr.app.addListener("window-all-closed",r),vr.app.once("will-quit",i=>{this.trace("Lifecycle#app.on(will-quit) - begin"),i.preventDefault(),this.fireOnWillShutdown(1).finally(()=>{this.trace("Lifecycle#app.on(will-quit) - after fireOnWillShutdown"),this.resolvePendingQuitPromise(!1),vr.app.removeListener("before-quit",e),vr.app.removeListener("window-all-closed",r),this.trace("Lifecycle#app.on(will-quit) - calling app.quit()"),vr.app.quit()})})}fireOnWillShutdown(e){if(this.pendingWillShutdownPromise)return this.pendingWillShutdownPromise;let r=this.logService;this.trace("Lifecycle#onWillShutdown.fire()");let i=[];return this._onWillShutdown.fire({reason:e,join(o,s){r.trace(`Lifecycle#onWillShutdown - begin '${o}'`),i.push(s.finally(()=>{r.trace(`Lifecycle#onWillShutdown - end '${o}'`)}))}}),this.pendingWillShutdownPromise=(async()=>{try{await Zt.settled(i)}catch(o){this.logService.error(o)}try{await this.stateService.close()}catch(o){this.logService.error(o)}})(),this.pendingWillShutdownPromise}set phase(e){if(e<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===e)return;this.trace(`lifecycle (main): phase changed (value: ${e})`),this._phase=e;let r=this.phaseWhen.get(this._phase);r&&(r.open(),this.phaseWhen.delete(this._phase))}async when(e){if(e<=this._phase)return;let r=this.phaseWhen.get(e);r||(r=new Vn,this.phaseWhen.set(e,r)),await r.wait()}registerWindow(e){let r=new re;this.windowCounter++,r.add(e.onWillLoad(o=>this._onWillLoadWindow.fire({window:e,workspace:o.workspace,reason:o.reason})));let i=mn(e.win);r.add(E.fromNodeEventEmitter(i,"close")(o=>{let s=e.id;if(this.windowToCloseRequest.has(s)){this.windowToCloseRequest.delete(s);return}this.trace(`Lifecycle#window.on('close') - window ID ${e.id}`),o.preventDefault(),this.unload(e,1).then(a=>{if(a){this.windowToCloseRequest.delete(s);return}this.windowToCloseRequest.add(s),this.trace(`Lifecycle#onBeforeCloseWindow.fire() - window ID ${s}`),this._onBeforeCloseWindow.fire(e),e.close()})})),r.add(E.fromNodeEventEmitter(i,"closed")(()=>{this.trace(`Lifecycle#window.on('closed') - window ID ${e.id}`),this.windowCounter--,r.dispose(),this.windowCounter===0&&(!A||this._quitRequested)&&this.fireOnWillShutdown(1)}))}registerAuxWindow(e){let r=mn(e.win),i=new re;i.add(E.fromNodeEventEmitter(r,"close")(o=>{this.trace(`Lifecycle#auxWindow.on('close') - window ID ${e.id}`),this._quitRequested&&(this.trace("Lifecycle#auxWindow.on('close') - preventDefault() because quit requested"),o.preventDefault())})),i.add(E.fromNodeEventEmitter(r,"closed")(()=>{this.trace(`Lifecycle#auxWindow.on('closed') - window ID ${e.id}`),i.dispose()}))}async reload(e,r){await this.unload(e,3)||e.reload(r)}unload(e,r){let i=this.mapWindowIdToPendingUnload.get(e.id);if(i)return i;let o=this.doUnload(e,r).finally(()=>{this.mapWindowIdToPendingUnload.delete(e.id)});return this.mapWindowIdToPendingUnload.set(e.id,o),o}async doUnload(e,r){if(!e.isReady)return!1;this.trace(`Lifecycle#unload() - window ID ${e.id}`);let i=this._quitRequested?2:r,o=await this.onBeforeUnloadWindowInRenderer(e,i);return o?(this.trace(`Lifecycle#unload() - veto in renderer (window ID ${e.id})`),this.handleWindowUnloadVeto(o)):(await this.onWillUnloadWindowInRenderer(e,i),!1)}handleWindowUnloadVeto(e){return e?(this.resolvePendingQuitPromise(!0),this._quitRequested=!1,!0):!1}resolvePendingQuitPromise(e){this.pendingQuitPromiseResolve&&(this.pendingQuitPromiseResolve(e),this.pendingQuitPromiseResolve=void 0,this.pendingQuitPromise=void 0)}onBeforeUnloadWindowInRenderer(e,r){return new Promise(i=>{let o=this.oneTimeListenerTokenGenerator++,s=`vscode:ok${o}`,a=`vscode:cancel${o}`;ke.once(s,()=>{i(!1)}),ke.once(a,()=>{i(!0)}),e.send("vscode:onBeforeUnload",{okChannel:s,cancelChannel:a,reason:r})})}onWillUnloadWindowInRenderer(e,r){return new Promise(i=>{let s=`vscode:reply${this.oneTimeListenerTokenGenerator++}`;ke.once(s,()=>i()),e.send("vscode:onWillUnload",{replyChannel:s,reason:r})})}quit(e){return this.doQuit(e).then(r=>{if(!r&&e)try{if(N){let i=pr();i!==process.cwd()&&process.chdir(i)}}catch(i){this.logService.error(i)}return r})}doQuit(e){return this.trace(`Lifecycle#quit() - begin (willRestart: ${e})`),this.pendingQuitPromise?(this.trace("Lifecycle#quit() - returning pending quit promise"),this.pendingQuitPromise):(e&&this.stateService.setItem(ai.QUIT_AND_RESTART_KEY,!0),this.pendingQuitPromise=new Promise(r=>{this.pendingQuitPromiseResolve=r,this.trace("Lifecycle#quit() - calling app.quit()"),vr.app.quit()}),this.pendingQuitPromise)}trace(e){this.environmentMainService.args["enable-smoke-test-driver"]?this.logService.info(e):this.logService.trace(e)}setRelaunchHandler(e){this.relaunchHandler=e}async relaunch(e){this.trace("Lifecycle#relaunch()");let r=process.argv.slice(1);if(e?.addArgs&&r.push(...e.addArgs),e?.removeArgs)for(let s of e.removeArgs){let a=r.indexOf(s);a>=0&&r.splice(a,1)}let i=()=>{this.relaunchHandler?.handleRelaunch(e)||(this.trace("Lifecycle#relaunch() - calling app.relaunch()"),vr.app.relaunch({args:r}))};vr.app.once("quit",i),await this.quit(!0)&&vr.app.removeListener("quit",i)}async kill(e){this.trace("Lifecycle#kill()"),await this.fireOnWillShutdown(2),await Promise.race([$e(1e3),(async()=>{for(let r of vr.BrowserWindow.getAllWindows())if(r&&!r.isDestroyed()){let i;r.webContents&&!r.webContents.isDestroyed()?i=new Promise(o=>r.once("closed",o)):i=Promise.resolve(),r.destroy(),await i}})()]),vr.app.exit(e)}};ai=P([h(0,B),h(1,Ye),h(2,ge)],ai);import*as Xy from"fs";import*as Vf from"fs";var ji=class n{constructor(t,e=Object.create(null)){this.path=t;this.options=e}static IN_MEMORY_PATH=":memory:";get onDidChangeItemsExternal(){return E.None}static BUSY_OPEN_TIMEOUT=2e3;static MAX_HOST_PARAMETERS=256;name=ve(this.path);logger=new Kf(this.options.logging);whenConnected=this.connect(this.path);async getItems(){let t=await this.whenConnected,e=new Map;return(await this.all(t,"SELECT * FROM ItemTable")).forEach(i=>e.set(i.key,i.value)),this.logger.isTracing&&this.logger.trace(`[storage ${this.name}] getItems(): ${e.size} rows`),e}async updateItems(t){let e=await this.whenConnected;return this.doUpdateItems(e,t)}doUpdateItems(t,e){return this.logger.isTracing&&this.logger.trace(`[storage ${this.name}] updateItems(): insert(${e.insert?Th(e.insert):"0"}), delete(${e.delete?kh(e.delete):"0"})`),this.transaction(t,()=>{let r=e.insert,i=e.delete;if(r&&r.size>0){let o=[];o.push([]);let s=0;r.forEach((a,l)=>{let c=o[s];c.length>n.MAX_HOST_PARAMETERS&&(s++,c=[],o.push(c)),c.push(l,a)}),o.forEach(a=>{this.prepare(t,`INSERT INTO ItemTable VALUES ${new Array(a.length/2).fill("(?,?)").join(",")}`,l=>l.run(a),()=>{let l=[],c=0;return r.forEach((d,f)=>{l.push(f),c+=d.length}),`Keys: ${l.join(", ")} Length: ${c}`})})}if(i&&i.size){let o=[];o.push([]);let s=0;i.forEach(a=>{let l=o[s];l.length>n.MAX_HOST_PARAMETERS&&(s++,l=[],o.push(l)),l.push(a)}),o.forEach(a=>{this.prepare(t,`DELETE FROM ItemTable WHERE key IN (${new Array(a.length).fill("?").join(",")})`,l=>l.run(a),()=>{let l=[];return i.forEach(c=>{l.push(c)}),`Keys: ${l.join(", ")}`})})}})}async optimize(){this.logger.trace(`[storage ${this.name}] vacuum()`);let t=await this.whenConnected;return this.exec(t,"VACUUM")}async close(t){this.logger.trace(`[storage ${this.name}] close()`);let e=await this.whenConnected;return this.doClose(e,t)}doClose(t,e){return new Promise((r,i)=>{t.db.close(o=>(o&&this.handleSQLiteError(t,`[storage ${this.name}] close(): ${o}`),this.path===n.IN_MEMORY_PATH?r():!t.isErroneous&&!t.isInMemory?this.backup().then(r,s=>(this.logger.error(`[storage ${this.name}] backup(): ${s}`),r())):typeof e=="function"?Vf.promises.unlink(this.path).then(()=>this.doConnect(this.path).then(s=>{let a=()=>this.doClose(s,void 0);return this.doUpdateItems(s,{insert:e()}).then(()=>a(),l=>(a(),Promise.reject(l)))})).then(r,i):i(o||new Error("Database has errors or is in-memory without recovery option"))))})}backup(){let t=this.toBackupPath(this.path);return $.copy(this.path,t,{preserveSymlinks:!1})}toBackupPath(t){return`${t}.backup`}async checkIntegrity(t){this.logger.trace(`[storage ${this.name}] checkIntegrity(full: ${t})`);let e=await this.whenConnected,r=await this.get(e,t?"PRAGMA integrity_check":"PRAGMA quick_check"),i=t?r.integrity_check:r.quick_check;return e.isErroneous?`${i} (last error: ${e.lastError})`:e.isInMemory?`${i} (in-memory!)`:i}async connect(t,e=!0){this.logger.trace(`[storage ${this.name}] open(${t}, retryOnBusy: ${e})`);try{return await this.doConnect(t)}catch(r){if(this.logger.error(`[storage ${this.name}] open(): Unable to open DB due to ${r}`),r.code==="SQLITE_BUSY"&&e)return await $e(n.BUSY_OPEN_TIMEOUT),this.connect(t,!1);try{await Vf.promises.unlink(t);try{await $.rename(this.toBackupPath(t),t,!1)}catch{}return await this.doConnect(t)}catch(i){return this.logger.error(`[storage ${this.name}] open(): Unable to use backup due to ${i}`),this.doConnect(n.IN_MEMORY_PATH)}}}handleSQLiteError(t,e){t.isErroneous=!0,t.lastError=e,this.logger.error(e)}doConnect(t){return new Promise((e,r)=>{import("@vscode/sqlite3").then(i=>{let o=this.logger.isTracing?i.default.verbose().Database:i.default.Database,s={db:new o(t,a=>a?s.db&&a.code!=="SQLITE_CANTOPEN"?s.db.close(()=>r(a)):r(a):this.exec(s,["PRAGMA user_version = 1;","CREATE TABLE IF NOT EXISTS ItemTable (key TEXT UNIQUE ON CONFLICT REPLACE, value BLOB)"].join("")).then(()=>e(s),l=>s.db.close(()=>r(l)))),isInMemory:t===n.IN_MEMORY_PATH};s.db.on("error",a=>this.handleSQLiteError(s,`[storage ${this.name}] Error (event): ${a}`)),this.logger.isTracing&&s.db.on("trace",a=>this.logger.trace(`[storage ${this.name}] Trace (event): ${a}`))},r)})}exec(t,e){return new Promise((r,i)=>{t.db.exec(e,o=>o?(this.handleSQLiteError(t,`[storage ${this.name}] exec(): ${o}`),i(o)):r())})}get(t,e){return new Promise((r,i)=>{t.db.get(e,(o,s)=>o?(this.handleSQLiteError(t,`[storage ${this.name}] get(): ${o}`),i(o)):r(s))})}all(t,e){return new Promise((r,i)=>{t.db.all(e,(o,s)=>o?(this.handleSQLiteError(t,`[storage ${this.name}] all(): ${o}`),i(o)):r(s))})}transaction(t,e){return new Promise((r,i)=>{t.db.serialize(()=>{t.db.run("BEGIN TRANSACTION"),e(),t.db.run("END TRANSACTION",o=>o?(this.handleSQLiteError(t,`[storage ${this.name}] transaction(): ${o}`),i(o)):r())})})}prepare(t,e,r,i){let o=t.db.prepare(e),s=a=>{this.handleSQLiteError(t,`[storage ${this.name}] prepare(): ${a} (${e}). Details: ${i()}`)};o.on("error",s),r(o),o.finalize(a=>{a&&s(a),o.removeListener("error",s)})}},Kf=class n{static VSCODE_TRACE_STORAGE="VSCODE_TRACE_STORAGE";logTrace;logError;constructor(t){t&&typeof t.logTrace=="function"&&process.env[n.VSCODE_TRACE_STORAGE]&&(this.logTrace=t.logTrace),t&&typeof t.logError=="function"&&(this.logError=t.logError)}get isTracing(){return!!this.logTrace}trace(t){this.logTrace?.(t)}error(t){this.logError?.(t)}};var Xa=class n extends O{constructor(e,r){super();this.logService=e;this.fileService=r}static LOG_SLOW_CLOSE_THRESHOLD=2e3;_onDidChangeStorage=this._register(new S);onDidChangeStorage=this._onDidChangeStorage.event;_onDidCloseStorage=this._register(new S);onDidCloseStorage=this._onDidCloseStorage.event;_storage=this._register(new Yr(new Lo,{hint:1}));get storage(){return this._storage}initializePromise=void 0;whenInitPromise=new Ht;whenInit=this.whenInitPromise.p;state=0;isInMemory(){return this._storage.isInMemory()}init(){return this.initializePromise||(this.initializePromise=(async()=>{if(this.state===0)try{let e=this._register(await this.doCreate());this._storage.dispose(),this._storage=e,this._register(e.onDidChangeStorage(i=>this._onDidChangeStorage.fire(i))),await this.doInit(e);let r=e.getBoolean(Ua);r===void 0?e.set(Ua,!0):r&&e.set(Ua,!1)}catch(e){this.logService.error(`[storage main] initialize(): Unable to init storage due to ${e}`)}finally{this.state=1,this.whenInitPromise.complete()}})()),this.initializePromise}createLoggingOptions(){return{logTrace:this.logService.getLevel()===1?e=>this.logService.trace(e):void 0,logError:e=>this.logService.error(e)}}doInit(e){return e.init()}get items(){return this._storage.items}get(e,r){return this._storage.get(e,r)}set(e,r){return this._storage.set(e,r)}delete(e){return this._storage.delete(e)}optimize(){return this._storage.optimize()}async close(){let e=new $r(!1);await this.doClose(),e.stop(),e.elapsed()>n.LOG_SLOW_CLOSE_THRESHOLD&&await this.logSlowClose(e),this._onDidCloseStorage.fire()}async logSlowClose(e){if(this.path)try{let r=Xm(Array.from(this._storage.items.entries()).map(([o,s])=>({key:o,length:s.length})),(o,s)=>s.length-o.length,5).map(o=>`${o.key}:${o.length}`).join(", "),i=(await this.fileService.stat(x.file(this.path))).size;this.logService.warn(`[storage main] detected slow close() operation: Time: ${e.elapsed()}ms, DB size: ${i}b, Large Keys: ${r}`)}catch(r){this.logService.error("[storage main] figuring out stats for slow DB on close() resulted in an error",r)}}async doClose(){this.initializePromise&&await this.initializePromise,this.state=2,await this._storage.close()}},Ed=class n extends Xa{constructor(e,r,i,o){super(i,o);this.profile=e;this.options=r}static STORAGE_NAME="state.vscdb";get path(){if(!this.options.useInMemoryStorage)return F(this.profile.globalStorageHome.with({scheme:U.file}).fsPath,n.STORAGE_NAME)}async doCreate(){return new Yr(new ji(this.path??ji.IN_MEMORY_PATH,{logging:this.createLoggingOptions()}),this.path?void 0:{hint:1})}},Pd=class extends Ed{constructor(t,e,r,i){super(t,e,r,i)}},Td=class extends Ed{constructor(t,e,r,i){super(e.defaultProfile,t,r,i)}async doInit(t){await super.doInit(t),this.updateTelemetryState(t)}updateTelemetryState(t){t.get(Cf,void 0)===void 0&&t.set(Cf,new Date().toUTCString());let r=t.get(kf,void 0),i=new Date().toUTCString();t.set(vy,typeof r>"u"?null:r),t.set(kf,i)}},kd=class n extends Xa{constructor(e,r,i,o,s){super(i,s);this.workspace=e;this.options=r;this.environmentService=o}static WORKSPACE_STORAGE_NAME="state.vscdb";static WORKSPACE_META_NAME="workspace.json";get path(){if(!this.options.useInMemoryStorage)return F(this.environmentService.workspaceStorageHome.with({scheme:U.file}).fsPath,this.workspace.id,n.WORKSPACE_STORAGE_NAME)}async doCreate(){let{storageFilePath:e,wasCreated:r}=await this.prepareWorkspaceStorageFolder();return new Yr(new ji(e,{logging:this.createLoggingOptions()}),{hint:this.options.useInMemoryStorage?1:r?0:void 0})}async prepareWorkspaceStorageFolder(){if(this.options.useInMemoryStorage)return{storageFilePath:ji.IN_MEMORY_PATH,wasCreated:!0};let e=F(this.environmentService.workspaceStorageHome.with({scheme:U.file}).fsPath,this.workspace.id),r=F(e,n.WORKSPACE_STORAGE_NAME);return await $.exists(e)?{storageFilePath:r,wasCreated:!1}:(await Xy.promises.mkdir(e,{recursive:!0}),this.ensureWorkspaceStorageFolderMeta(e),{storageFilePath:r,wasCreated:!0})}async ensureWorkspaceStorageFolderMeta(e){let r;if(Ze(this.workspace)?r={folder:this.workspace.uri.toString()}:Ue(this.workspace)&&(r={workspace:this.workspace.configPath.toString()}),r)try{let i=F(e,n.WORKSPACE_META_NAME);await $.exists(i)||await $.writeFile(i,JSON.stringify(r,void 0,2))}catch(i){this.logService.error(`[storage main] ensureWorkspaceStorageFolderMeta(): Unable to create workspace storage metadata due to ${i}`)}}},Za=class extends Xa{get path(){}async doCreate(){return new Yr(new Lo,{hint:1})}};var $i=R("storageMainService"),rs=class extends O{constructor(e,r,i,o,s,a){super();this.logService=e;this.environmentService=r;this.userDataProfilesService=i;this.lifecycleMainService=o;this.fileService=s;this.uriIdentityService=a;this.registerListeners()}shutdownReason=void 0;_onDidChangeProfileStorage=this._register(new S);onDidChangeProfileStorage=this._onDidChangeProfileStorage.event;getStorageOptions(){return{useInMemoryStorage:!!this.environmentService.extensionTestsLocationURI}}registerListeners(){(async()=>(await this.lifecycleMainService.when(3),this.applicationStorage.init()))(),this._register(this.lifecycleMainService.onWillLoadWindow(e=>{e.window.profile&&this.profileStorage(e.window.profile).init(),e.workspace&&this.workspaceStorage(e.workspace).init()})),this._register(this.lifecycleMainService.onWillShutdown(e=>{this.logService.trace("storageMainService#onWillShutdown()"),this.shutdownReason=e.reason,e.join("applicationStorage",this.applicationStorage.close());for(let[,r]of this.mapProfileToStorage)e.join("profileStorage",r.close());for(let[,r]of this.mapWorkspaceToStorage)e.join("workspaceStorage",r.close())})),this._register(this.userDataProfilesService.onWillCreateProfile(e=>{e.join((async()=>{await this.fileService.exists(e.profile.globalStorageHome)||await this.fileService.createFolder(e.profile.globalStorageHome)})())})),this._register(this.userDataProfilesService.onWillRemoveProfile(e=>{let r=this.mapProfileToStorage.get(e.profile.id);r&&e.join(r.close())}))}applicationStorage=this._register(this.createApplicationStorage());createApplicationStorage(){this.logService.trace("StorageMainService: creating application storage");let e=new Td(this.getStorageOptions(),this.userDataProfilesService,this.logService,this.fileService);return this._register(E.once(e.onDidCloseStorage)(()=>{this.logService.trace("StorageMainService: closed application storage")})),e}mapProfileToStorage=new Map;profileStorage(e){if(Fa(e))return this.applicationStorage;let r=this.mapProfileToStorage.get(e.id);if(!r){this.logService.trace(`StorageMainService: creating profile storage (${e.name})`),r=this._register(this.createProfileStorage(e)),this.mapProfileToStorage.set(e.id,r);let i=this._register(r.onDidChangeStorage(o=>this._onDidChangeProfileStorage.fire({...o,storage:r,profile:e})));this._register(E.once(r.onDidCloseStorage)(()=>{this.logService.trace(`StorageMainService: closed profile storage (${e.name})`),this.mapProfileToStorage.delete(e.id),i.dispose()}))}return r}createProfileStorage(e){return this.shutdownReason===2?new Za(this.logService,this.fileService):new Pd(e,this.getStorageOptions(),this.logService,this.fileService)}mapWorkspaceToStorage=new Map;workspaceStorage(e){let r=this.mapWorkspaceToStorage.get(e.id);return r||(this.logService.trace(`StorageMainService: creating workspace storage (${e.id})`),r=this._register(this.createWorkspaceStorage(e)),this.mapWorkspaceToStorage.set(e.id,r),this._register(E.once(r.onDidCloseStorage)(()=>{this.logService.trace(`StorageMainService: closed workspace storage (${e.id})`),this.mapWorkspaceToStorage.delete(e.id)}))),r}createWorkspaceStorage(e){return this.shutdownReason===2?new Za(this.logService,this.fileService):new kd(e,this.getStorageOptions(),this.logService,this.environmentService,this.fileService)}isUsed(e){let r=x.file(e);for(let i of[this.applicationStorage,...this.mapProfileToStorage.values(),...this.mapWorkspaceToStorage.values()])if(i.path&&this.uriIdentityService.extUri.isEqualOrParent(x.file(i.path),r))return!0;return!1}};rs=P([h(0,B),h(1,zt),h(2,ir),h(3,le),h(4,We),h(5,ht)],rs);var si=R("applicationStorageMainService"),ns=class extends Fo{constructor(e,r){super();this.userDataProfilesService=e;this.storageMainService=r}whenReady=this.storageMainService.applicationStorage.whenInit;doInitialize(){return this.storageMainService.applicationStorage.whenInit}getStorage(e){if(e===-1)return this.storageMainService.applicationStorage.storage}getLogDetails(e){if(e===-1)return this.userDataProfilesService.defaultProfile.globalStorageHome.with({scheme:U.file}).fsPath}shouldFlushWhenIdle(){return!1}switch(){throw new Error("Migrating storage is unsupported from main process")}switchToProfile(){throw new Error("Switching storage profile is unsupported from main process")}switchToWorkspace(){throw new Error("Switching storage workspace is unsupported from main process")}hasScope(){throw new Error("Main process is never profile or workspace scoped")}};ns=P([h(0,$t),h(1,$i)],ns);var tl=R("proxyAuthService"),is=class extends O{constructor(e,r,i,o,s,a){super();this.logService=e;this.windowsMainService=r;this.encryptionMainService=i;this.applicationStorageMainService=o;this.configurationService=s;this.environmentMainService=a;this.registerListeners()}PROXY_CREDENTIALS_SERVICE_KEY="proxy-credentials://";pendingProxyResolves=new Map;currentDialog=void 0;cancelledAuthInfoHashes=new Set;sessionCredentials=new Map;registerListeners(){let e=E.fromNodeEventEmitter(KS,"login",(r,i,o,s,a)=>({event:r,authInfo:{...s,attempt:o.firstAuthAttempt?1:2},callback:a}));this._register(e(this.onLogin,this))}async lookupAuthorization(e){return this.onLogin({authInfo:e})}async onLogin({event:e,authInfo:r,callback:i}){if(!r.isProxy)return;e?.preventDefault();let o=String(er({scheme:r.scheme,host:r.host,port:r.port})),s,a=this.pendingProxyResolves.get(o);if(a)this.logService.trace("auth#onLogin (proxy) - pending proxy handling found"),s=await a;else{this.logService.trace("auth#onLogin (proxy) - no pending proxy handling found, starting new"),a=this.resolveProxyCredentials(r,o),this.pendingProxyResolves.set(o,a);try{s=await a}finally{this.pendingProxyResolves.delete(o)}}return i?.(s?.username,s?.password),s}async resolveProxyCredentials(e,r){this.logService.trace("auth#resolveProxyCredentials (proxy) - enter");try{let i=await this.doResolveProxyCredentials(e,r);if(i)return this.logService.trace("auth#resolveProxyCredentials (proxy) - got credentials"),i;this.logService.trace("auth#resolveProxyCredentials (proxy) - did not get credentials")}finally{this.logService.trace("auth#resolveProxyCredentials (proxy) - exit")}}async doResolveProxyCredentials(e,r){if(this.logService.trace("auth#doResolveProxyCredentials - enter",e),this.environmentMainService.extensionTestsLocationURI){let d=this.configurationService.getValue("integration-test.http.proxyAuth");if(d){let f=d.indexOf(":");return f!==-1?{username:d.substring(0,f),password:d.substring(f+1)}:{username:d,password:""}}return}let i=(this.configurationService.getValue("http.proxy")||"").trim()||(process.env.https_proxy||process.env.HTTPS_PROXY||process.env.http_proxy||process.env.HTTP_PROXY||"").trim()||void 0;if(i?.indexOf("@")!==-1){let d=x.parse(i),f=d.authority.indexOf("@");if(f!==-1){if(e.attempt>1){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - ignoring previously used config/envvar credentials");return}this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found config/envvar credentials to use");let m=d.authority.substring(0,f),g=m.indexOf(":");return g!==-1?{username:m.substring(0,g),password:m.substring(g+1)}:{username:m,password:""}}}let o=e.attempt===1&&this.sessionCredentials.get(r);if(o){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found session credentials to use");let{username:d,password:f}=o;return{username:d,password:f}}let s,a;try{let d=this.applicationStorageMainService.get(this.PROXY_CREDENTIALS_SERVICE_KEY+r,-1);if(d){let f=JSON.parse(await this.encryptionMainService.decrypt(d));s=f.username,a=f.password}}catch(d){this.logService.error(d)}if(e.attempt===1&&typeof s=="string"&&typeof a=="string")return this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found stored credentials to use"),this.sessionCredentials.set(r,{username:s,password:a}),{username:s,password:a};let l=this.currentDialog,c=this.currentDialog=(async()=>{await l;let d=await this.showProxyCredentialsDialog(e,r,s,a);return this.currentDialog===c&&(this.currentDialog=void 0),d})();return c}async showProxyCredentialsDialog(e,r,i,o){if(this.cancelledAuthInfoHashes.has(r)){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - login dialog was cancelled before, not showing again");return}let s=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(!s){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - no opened window found to show dialog in");return}this.logService.trace(`auth#doResolveProxyCredentials (proxy) - asking window ${s.id} to handle proxy login`);let a=this.sessionCredentials.get(r),l={authInfo:e,username:a?.username??i,password:a?.password??o,replyChannel:`vscode:proxyAuthResponse:${yt()}`};s.sendWhenReady("vscode:openProxyAuthenticationDialog",Ee.None,l);let c=await new Promise(d=>{let f=async(m,g,b)=>{if(g===l.replyChannel)if(this.logService.trace(`auth#doResolveProxyCredentials - exit - received credentials from window ${s.id}`),s.win?.webContents.off("ipc-message",f),b){let v={username:b.username,password:b.password};try{if(b.remember){let w=await this.encryptionMainService.encrypt(JSON.stringify(v));this.applicationStorageMainService.store(this.PROXY_CREDENTIALS_SERVICE_KEY+r,w,-1,1)}else this.applicationStorageMainService.remove(this.PROXY_CREDENTIALS_SERVICE_KEY+r,-1)}catch(w){this.logService.error(w)}d({username:v.username,password:v.password})}else this.cancelledAuthInfoHashes.add(r),d(void 0)};s.win?.webContents.on("ipc-message",f)});return this.sessionCredentials.set(r,c),c}};is=P([h(0,B),h(1,Te),h(2,Ea),h(3,si),h(4,Ie),h(5,ge)],is);import{createHash as zS}from"crypto";var En=class{constructor(t,e,r,i){this.environmentMainService=t;this.configurationService=e;this.logService=r;this.stateService=i}static backupWorkspacesMetadataStorageKey="backupWorkspaces";backupHome=this.environmentMainService.backupHome;workspaces=[];folders=[];emptyWindows=[];backupUriComparer=Ae;backupPathComparer={isEqual:(t,e)=>Li(t,e,!j)};async initialize(){let t=this.stateService.getItem(En.backupWorkspacesMetadataStorageKey)??{workspaces:[],folders:[],emptyWindows:[]};this.emptyWindows=await this.validateEmptyWorkspaces(t.emptyWindows),this.workspaces=await this.validateWorkspaces(ly(t)),this.folders=await this.validateFolders(cy(t)),this.storeWorkspacesMetadata()}getWorkspaceBackups(){return this.isHotExitOnExitAndWindowClose()?[]:this.workspaces.slice(0)}getFolderBackups(){return this.isHotExitOnExitAndWindowClose()?[]:this.folders.slice(0)}isHotExitEnabled(){return this.getHotExitConfig()!==zc.OFF}isHotExitOnExitAndWindowClose(){return this.getHotExitConfig()===zc.ON_EXIT_AND_WINDOW_CLOSE}getHotExitConfig(){return this.configurationService.getValue()?.files?.hotExit||zc.ON_EXIT}getEmptyWindowBackups(){return this.emptyWindows.slice(0)}registerWorkspaceBackup(t,e){this.workspaces.some(i=>t.workspace.id===i.workspace.id)||(this.workspaces.push(t),this.storeWorkspacesMetadata());let r=F(this.backupHome,t.workspace.id);return e?this.moveBackupFolder(r,e).then(()=>r):r}async moveBackupFolder(t,e){if(await $.exists(t)&&await this.convertToEmptyWindowBackup(t),await $.exists(e))try{await $.rename(e,t,!1)}catch(r){this.logService.error(`Backup: Could not move backup folder to new location: ${r.toString()}`)}}registerFolderBackup(t){return this.folders.some(e=>this.backupUriComparer.isEqual(t.folderUri,e.folderUri))||(this.folders.push(t),this.storeWorkspacesMetadata()),F(this.backupHome,this.getFolderHash(t))}registerEmptyWindowBackup(t){return this.emptyWindows.some(e=>!!e.backupFolder&&this.backupPathComparer.isEqual(e.backupFolder,t.backupFolder))||(this.emptyWindows.push(t),this.storeWorkspacesMetadata()),F(this.backupHome,t.backupFolder)}async validateWorkspaces(t){if(!Array.isArray(t))return[];let e=new Set,r=[];for(let i of t){let o=i.workspace;if(!Ue(o))return[];if(!e.has(o.id)){e.add(o.id);let s=F(this.backupHome,o.id);await this.doHasBackups(s)?o.configPath.scheme!==U.file||await $.exists(o.configPath.fsPath)?r.push(i):await this.convertToEmptyWindowBackup(s):await this.deleteStaleBackup(s)}}return r}async validateFolders(t){if(!Array.isArray(t))return[];let e=[],r=new Set;for(let i of t){let o=i.folderUri,s=this.backupUriComparer.getComparisonKey(o);if(!r.has(s)){r.add(s);let a=F(this.backupHome,this.getFolderHash(i));await this.doHasBackups(a)?o.scheme!==U.file||await $.exists(o.fsPath)?e.push(i):await this.convertToEmptyWindowBackup(a):await this.deleteStaleBackup(a)}}return e}async validateEmptyWorkspaces(t){if(!Array.isArray(t))return[];let e=[],r=new Set;for(let i of t){let o=i.backupFolder;if(typeof o!="string")return[];if(!r.has(o)){r.add(o);let s=F(this.backupHome,o);await this.doHasBackups(s)?e.push(i):await this.deleteStaleBackup(s)}}return e}async deleteStaleBackup(t){try{await $.rm(t,1)}catch(e){this.logService.error(`Backup: Could not delete stale backup: ${e.toString()}`)}}prepareNewEmptyWindowBackup(){let t=Qa();for(;this.emptyWindows.some(e=>!!e.backupFolder&&this.backupPathComparer.isEqual(e.backupFolder,t.id));)t=Qa();return{backupFolder:t.id}}async convertToEmptyWindowBackup(t){let e=this.prepareNewEmptyWindowBackup(),r=F(this.backupHome,e.backupFolder);try{await $.rename(t,r,!1)}catch(i){return this.logService.error(`Backup: Could not rename backup folder: ${i.toString()}`),!1}return this.emptyWindows.push(e),!0}async getDirtyWorkspaces(){let t=[];for(let e of this.workspaces)await this.hasBackups(e)&&t.push(e);for(let e of this.folders)await this.hasBackups(e)&&t.push(e);return t}hasBackups(t){let e;return ay(t)?e=F(this.backupHome,t.backupFolder):sy(t)?e=F(this.backupHome,this.getFolderHash(t)):e=F(this.backupHome,t.workspace.id),this.doHasBackups(e)}async doHasBackups(t){try{let e=await $.readdir(t);for(let r of e)try{if((await $.readdir(F(t,r))).length>0)return!0}catch{}}catch{}return!1}storeWorkspacesMetadata(){let t={workspaces:this.workspaces.map(({workspace:e,remoteAuthority:r})=>{let i={id:e.id,configURIPath:e.configPath.toString()};return r&&(i.remoteAuthority=r),i}),folders:this.folders.map(({folderUri:e,remoteAuthority:r})=>{let i={folderUri:e.toString()};return r&&(i.remoteAuthority=r),i}),emptyWindows:this.emptyWindows.map(({backupFolder:e,remoteAuthority:r})=>{let i={backupFolder:e};return r&&(i.remoteAuthority=r),i})};this.stateService.setItem(En.backupWorkspacesMetadataStorageKey,t)}getFolderHash(t){let e=t.folderUri,r;return e.scheme===U.file?r=j?e.fsPath:e.fsPath.toLowerCase():r=e.toString().toLowerCase(),zS("md5").update(r).digest("hex")}};En=P([h(0,ge),h(1,Ie),h(2,B),h(3,Ye)],En);import{createServer as qS}from"net";var RG=R("extensionHostDebugService");var Cd=class{static ChannelName="extensionhostdebugservice";_onCloseEmitter=new S;_onReloadEmitter=new S;_onTerminateEmitter=new S;_onAttachEmitter=new S;call(t,e,r){switch(e){case"close":return Promise.resolve(this._onCloseEmitter.fire({sessionId:r[0]}));case"reload":return Promise.resolve(this._onReloadEmitter.fire({sessionId:r[0]}));case"terminate":return Promise.resolve(this._onTerminateEmitter.fire({sessionId:r[0]}));case"attach":return Promise.resolve(this._onAttachEmitter.fire({sessionId:r[0],port:r[1],subId:r[2]}))}throw new Error("Method not implemented.")}listen(t,e,r){switch(e){case"close":return this._onCloseEmitter.event;case"reload":return this._onReloadEmitter.event;case"terminate":return this._onTerminateEmitter.event;case"attach":return this._onAttachEmitter.event}throw new Error("Method not implemented.")}};var _d=class extends Cd{constructor(e){super();this.windowsMainService=e}call(e,r,i){return r==="openExtensionDevelopmentHostWindow"?this.openExtensionDevelopmentHostWindow(i[0],i[1]):super.call(e,r,i)}async openExtensionDevelopmentHostWindow(e,r){let i=dd(e,Rf);i.debugRenderer=r;let o=i.extensionDevelopmentPath;if(!o)return{success:!1};let[s]=await this.windowsMainService.openExtensionDevelopmentHostWindow(o,{context:5,cli:i,forceProfile:i.profile,forceTempProfile:i["profile-temp"]});if(!r)return{success:!0};let a=s.win;if(!a)return{success:!0};let l=a.webContents.debugger,c=l.isAttached()?1/0:0,d=qS(f=>{c++===0&&l.attach();let m=!1,g=w=>{m||f.write(JSON.stringify(w)+"\0")},b=(w,k,C,M)=>g({method:k,params:C,sessionId:M});a.on("close",()=>{l.removeListener("message",b),f.end(),m=!0}),l.addListener("message",b);let v=Buffer.alloc(0);f.on("data",w=>{v=Buffer.concat([v,w]);for(let k=v.indexOf(0);k!==-1;k=v.indexOf(0)){let C;try{let M=v.slice(0,k).toString("utf8");v=v.slice(k+1),C=JSON.parse(M)}catch(M){console.error("error reading cdp line",M)}l.sendCommand(C.method,C.params,C.sessionId).then(M=>g({id:C.id,sessionId:C.sessionId,result:M})).catch(M=>g({id:C.id,sessionId:C.sessionId,error:{code:0,message:M.message}}))}}),f.on("error",w=>{console.error("error on cdp pipe:",w)}),f.on("close",()=>{m=!0,--c===0&&l.detach()})});return await new Promise(f=>d.listen(0,f)),a.on("close",()=>d.close()),{rendererDebugPort:d.address().port,success:!0}}};function Zy(n,...t){let e=t.reduce((o,s)=>(o[s]=!0,o),{}),r=[/^ELECTRON_.+$/,/^VSCODE_(?!(PORTABLE|SHELL_LOGIN|ENV_REPLACE|ENV_APPEND|ENV_PREPEND)).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(n).filter(o=>!e[o]).forEach(o=>{for(let s=0;s<r.length;s++)if(o.search(r[s])!==-1){delete n[o];break}})}function Dd(n){n&&(delete n.DEBUG,j&&delete n.LD_PRELOAD)}var $S="diagnosticsService",Rd=R($S);function eb(n){return!!n.hostName&&!!n.errorMessage}import{app as rb,BrowserWindow as YS}from"electron";import{MessageChannelMain as jS,app as GS,utilityProcess as JS}from"electron";import{StringDecoder as tb}from"string_decoder";function QS(n){return typeof n.responseWindowId=="number"}var Ct=class extends O{constructor(e,r,i){super();this.logService=e;this.telemetryService=r;this.lifecycleMainService=i}static ID_COUNTER=0;static all=new Map;static getAll(){return Array.from(Ct.all.values())}id=String(++Ct.ID_COUNTER);_onStdout=this._register(new S);onStdout=this._onStdout.event;_onStderr=this._register(new S);onStderr=this._onStderr.event;_onMessage=this._register(new S);onMessage=this._onMessage.event;_onSpawn=this._register(new S);onSpawn=this._onSpawn.event;_onExit=this._register(new S);onExit=this._onExit.event;_onCrash=this._register(new S);onCrash=this._onCrash.event;process=void 0;processPid=void 0;configuration=void 0;killed=!1;log(e,r){let i;switch(this.configuration?.correlationId?i=`[UtilityProcess id: ${this.configuration?.correlationId}, type: ${this.configuration?.type}, pid: ${this.processPid??"<none>"}]: ${e}`:i=`[UtilityProcess type: ${this.configuration?.type}, pid: ${this.processPid??"<none>"}]: ${e}`,r){case xe.Error:this.logService.error(i);break;case xe.Warning:this.logService.warn(i);break;case xe.Info:this.logService.trace(i);break}}validateCanStart(){return this.process?(this.log("Cannot start utility process because it is already running...",xe.Error),!1):!0}start(e){let r=this.doStart(e);return r&&e.payload&&this.postMessage(e.payload)&&this.log("payload sent via postMessage()",xe.Info),r}doStart(e){if(!this.validateCanStart())return!1;this.configuration=e;let r=`${this.configuration.type}-${this.id}`,i=Me.asFileUri("bootstrap-fork.js").fsPath,o=this.configuration.args??[],s=this.configuration.execArgv??[],a=this.configuration.allowLoadingUnsignedLibraries,l=this.configuration.forceAllocationsToV8Sandbox,c=this.configuration.respondToAuthRequestsFromMainProcess,d="pipe",f=this.createEnv(e);return this.log("creating new...",xe.Info),this.process=JS.fork(i,o,{serviceName:r,env:f,execArgv:s,allowLoadingUnsignedLibraries:a,forceAllocationsToV8Sandbox:l,respondToAuthRequestsFromMainProcess:c,stdio:d}),this.registerListeners(this.process,this.configuration,r),!0}createEnv(e){let r=e.env?{...e.env}:{...In(process.env)};r.VSCODE_AMD_ENTRYPOINT=e.entryPoint,typeof e.parentLifecycleBound=="number"&&(r.VSCODE_PARENT_PID=String(e.parentLifecycleBound)),r.VSCODE_CRASH_REPORTER_PROCESS_TYPE=e.type,N&&(qm()?r.NODE_DISABLE_UNC_ACCESS_CHECKS="1":r.NODE_UNC_HOST_ALLOWLIST=Hm().join("\\")),Dd(r);for(let i of Object.keys(r))r[i]=String(r[i]);return r}registerListeners(e,r,i){if(e.stdout){let o=new tb("utf-8");this._register(E.fromNodeEventEmitter(e.stdout,"data")(s=>this._onStdout.fire(typeof s=="string"?s:o.write(s))))}if(e.stderr){let o=new tb("utf-8");this._register(E.fromNodeEventEmitter(e.stderr,"data")(s=>this._onStderr.fire(typeof s=="string"?s:o.write(s))))}this._register(E.fromNodeEventEmitter(e,"message")(o=>this._onMessage.fire(o))),this._register(E.fromNodeEventEmitter(e,"spawn")(()=>{this.processPid=e.pid,typeof e.pid=="number"&&Ct.all.set(e.pid,{pid:e.pid,name:QS(r)?`${r.type} [${r.responseWindowId}]`:r.type}),this.log("successfully created",xe.Info),this._onSpawn.fire(e.pid)})),this._register(E.fromNodeEventEmitter(e,"exit")(o=>{let s=this.isNormalExit(o)?0:o;this.log(`received exit event with code ${s}`,xe.Info),this._onExit.fire({pid:this.processPid,code:s,signal:"unknown"}),this.onDidExitOrCrashOrKill()})),this._register(E.fromNodeEventEmitter(GS,"child-process-gone",(o,s)=>({event:o,details:s}))(({details:o})=>{o.type==="Utility"&&o.name===i&&!this.isNormalExit(o.exitCode)&&(this.log(`crashed with code ${o.exitCode} and reason '${o.reason}'`,xe.Error),this.telemetryService.publicLog2("utilityprocesscrash",{type:r.type,reason:o.reason,code:o.exitCode}),this._onCrash.fire({pid:this.processPid,code:o.exitCode,reason:o.reason}),this.onDidExitOrCrashOrKill())}))}once(e,r){let i=this._register(this._onMessage.event(o=>{o===e&&(i.dispose(),r())}))}postMessage(e,r){return this.process?(this.process.postMessage(e,r),!0):!1}connect(e){let{port1:r,port2:i}=new jS;return this.postMessage(e,[i]),r}enableInspectPort(){if(!this.process||typeof this.processPid!="number")return!1;this.log("enabling inspect port",xe.Info);let e=process;return typeof e._debugProcess=="function"?(e._debugProcess(this.processPid),!0):!1}kill(){if(!this.process)return;this.log("attempting to kill the process...",xe.Info),this.process.kill()?(this.log("successfully killed the process",xe.Info),this.killed=!0,this.onDidExitOrCrashOrKill()):this.log("unable to kill the process",xe.Warning)}isNormalExit(e){return e===0?!0:this.killed&&e===15}onDidExitOrCrashOrKill(){typeof this.processPid=="number"&&Ct.all.delete(this.processPid),this.process=void 0}async waitForExit(e){this.process&&(this.log("waiting to exit...",xe.Info),await Promise.race([E.toPromise(this.onExit),$e(e)]),this.process&&(this.log(`did not exit within ${e}ms, will kill it now...`,xe.Info),this.kill()))}};Ct=P([h(0,B),h(1,He),h(2,le)],Ct);var li=class extends Ct{constructor(e,r,i,o){super(e,i,o);this.windowsMainService=r}start(e){let r=this.windowsMainService.getWindowById(e.responseWindowId);if(!r?.win||r.win.isDestroyed()||r.win.webContents.isDestroyed())return this.log("Refusing to start utility process because requesting window cannot be found or is destroyed...",xe.Error),!0;if(!super.doStart(e))return!1;this.registerWindowListeners(r.win,e);let o=this.connect(e.payload);return r.win.webContents.postMessage(e.responseChannel,e.responseNonce,[o]),!0}registerWindowListeners(e,r){r.windowLifecycleBound&&(this._register(E.filter(this.lifecycleMainService.onWillLoadWindow,i=>i.window.win===e)(()=>this.kill())),this._register(E.fromNodeEventEmitter(e,"closed")(()=>this.kill())))}};li=P([h(0,B),h(1,Te),h(2,He),h(3,le)],li);var XS="diagnosticsMainService",rl=R(XS),os=class{constructor(t,e,r){this.windowsMainService=t;this.workspacesManagementMainService=e;this.logService=r}async getRemoteDiagnostics(t){let e=this.windowsMainService.getWindows();return(await Promise.all(e.map(async i=>{let o=i.remoteAuthority;if(!o)return;let s=`vscode:getDiagnosticInfoResponse${i.id}`,a={includeProcesses:t.includeProcesses,folders:t.includeWorkspaceMetadata?await this.getFolderURIs(i):void 0};return new Promise(l=>{i.sendWhenReady("vscode:getDiagnosticInfo",Ee.None,{replyChannel:s,args:a}),ke.once(s,(c,d)=>{d||l({hostName:o,errorMessage:`Unable to resolve connection to '${o}'.`}),l(d)}),setTimeout(()=>{l({hostName:o,errorMessage:`Connection to '${o}' could not be established`})},5e3)})}))).filter(i=>!!i)}async getMainDiagnostics(){this.logService.trace("Received request for main process info from other instance.");let t=[];for(let r of YS.getAllWindows()){let i=this.windowsMainService.getWindowById(r.id);i?t.push(await this.codeWindowToInfo(i)):t.push(this.browserWindowToInfo(r))}let e=[];for(let{pid:r,name:i}of Ct.getAll())e.push({pid:r,name:i});return{mainPID:process.pid,mainArguments:process.argv.slice(1),windows:t,pidToNames:e,screenReader:!!rb.accessibilitySupportEnabled,gpuFeatureStatus:rb.getGPUFeatureStatus()}}async codeWindowToInfo(t){let e=await this.getFolderURIs(t),r=mn(t.win);return this.browserWindowToInfo(r,e,t.remoteAuthority)}browserWindowToInfo(t,e=[],r){return{id:t.id,pid:t.webContents.getOSProcessId(),title:t.getTitle(),folderURIs:e,remoteAuthority:r}}async getFolderURIs(t){let e=[],r=t.openedWorkspace;if(Ze(r))e.push(r.uri);else if(Ue(r)){let i=await this.workspacesManagementMainService.resolveLocalWorkspace(r.configPath);i&&i.folders.forEach(s=>{e.push(s.uri)})}return e}};os=P([h(0,Te),h(1,or),h(2,B)],os);import{safeStorage as ZS,app as e0}from"electron";var ci=ZS,ss=class{constructor(t){this.logService=t;e0.commandLine.getSwitchValue("password-store")==="basic"&&(this.logService.trace("[EncryptionMainService] setting usePlainTextEncryption to true..."),ci.setUsePlainTextEncryption?.(!0),this.logService.trace("[EncryptionMainService] set usePlainTextEncryption to true"))}_serviceBrand;async encrypt(t){this.logService.trace("[EncryptionMainService] Encrypting value...");try{let e=JSON.stringify(ci.encryptString(t));return this.logService.trace("[EncryptionMainService] Encrypted value."),e}catch(e){throw this.logService.error(e),e}}async decrypt(t){let e;try{if(e=JSON.parse(t),!e.data)throw new Error(`[EncryptionMainService] Invalid encrypted value: ${t}`);let r=Buffer.from(e.data);this.logService.trace("[EncryptionMainService] Decrypting value...");let i=ci.decryptString(r);return this.logService.trace("[EncryptionMainService] Decrypted value."),i}catch(r){throw this.logService.error(r),r}}isEncryptionAvailable(){this.logService.trace("[EncryptionMainService] Checking if encryption is available...");let t=ci.isEncryptionAvailable();return this.logService.trace("[EncryptionMainService] Encryption is available: ",t),Promise.resolve(t)}getKeyStorageProvider(){if(N)return Promise.resolve("dpapi");if(A)return Promise.resolve("keychain_access");if(ci.getSelectedStorageBackend)try{this.logService.trace("[EncryptionMainService] Getting selected storage backend...");let t=ci.getSelectedStorageBackend();return this.logService.trace("[EncryptionMainService] Selected storage backend: ",t),Promise.resolve(t)}catch(t){this.logService.error(t)}return Promise.resolve("unknown")}async setUsePlainTextEncryption(){if(N)throw new Error("Setting plain text encryption is not supported on Windows.");if(A)throw new Error("Setting plain text encryption is not supported on macOS.");if(!ci.setUsePlainTextEncryption)throw new Error("Setting plain text encryption is not supported.");this.logService.trace("[EncryptionMainService] Setting usePlainTextEncryption to true..."),ci.setUsePlainTextEncryption(!0),this.logService.trace("[EncryptionMainService] Set usePlainTextEncryption to true")}};ss=P([h(0,B)],ss);import{spawn as d0}from"child_process";import{userInfo as a0}from"os";import*as ob from"os";var nb=/^\d+$/,t0=/^Microsoft.PowerShell_.*/,r0=/^Microsoft.PowerShellPreview_.*/;var nl;switch(process.arch){case"ia32":nl=1;break;case"arm":case"arm64":nl=2;break;default:nl=0;break}var as;process.env.PROCESSOR_ARCHITEW6432?as=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?as=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?as=1:as=0;var ls=class{constructor(t,e,r){this.exePath=t;this.displayName=e;this.knownToExist=r}async exists(){return this.knownToExist===void 0&&(this.knownToExist=await gt.existsFile(this.exePath)),this.knownToExist}};function n0({useAlternateBitness:n=!1}={}){return n?nl===0?process.env["ProgramFiles(x86)"]||null:as===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function Ld({useAlternateBitness:n=!1,findPreview:t=!1}={}){let e=n0({useAlternateBitness:n});if(!e)return null;let r=F(e,"PowerShell");if(!await gt.existsDirectory(r))return null;let i=-1,o=null;for(let l of await $.readdir(r)){let c=-1;if(t){let f=l.indexOf("-");if(f<0)continue;let m=l.substring(0,f);if(!nb.test(m)||l.substring(f+1)!=="preview")continue;c=parseInt(m,10)}else{if(!nb.test(l))continue;c=parseInt(l,10)}if(c<=i)continue;let d=F(r,l,"pwsh.exe");await gt.existsFile(d)&&(o=d,i=c)}if(!o)return null;let s=e.includes("x86")?" (x86)":"",a=t?" Preview":"";return new ls(o,`PowerShell${a}${s}`,!0)}async function ib({findPreview:n}={}){if(!process.env.LOCALAPPDATA)return null;let t=F(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await gt.existsDirectory(t))return null;let{pwshMsixDirRegex:e,pwshMsixName:r}=n?{pwshMsixDirRegex:r0,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:t0,pwshMsixName:"PowerShell (Store)"};for(let i of await $.readdir(t))if(e.test(i)){let o=F(t,i,"pwsh.exe");return new ls(o,r)}return null}function i0(){let n=F(ob.homedir(),".dotnet","tools","pwsh.exe");return new ls(n,".NET Core PowerShell Global Tool")}function o0(){let n=F(process.env.windir,nl===1&&as!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new ls(n,"Windows PowerShell",!0)}async function*s0(){let n=await Ld();n&&(yield n),n=await Ld({useAlternateBitness:!0}),n&&(yield n),n=await ib(),n&&(yield n),n=i0(),n&&(yield n),n=await Ld({findPreview:!0}),n&&(yield n),n=await ib({findPreview:!0}),n&&(yield n),n=await Ld({useAlternateBitness:!0,findPreview:!0}),n&&(yield n),n=o0(),n&&(yield n)}async function*Hf(){for await(let n of s0())await n.exists()&&(yield n)}async function sb(){for await(let n of Hf())return n;return null}import{promises as ab}from"fs";function Od(n=xt){return n.comspec||"cmd.exe"}function lb(n){let t=[],e=!1,r=function(i){if(e){t.push(i);return}(!n.send(i,s=>{if(s&&console.error(s),e=!1,t.length>0){let a=t.slice(0);t=[],a.forEach(l=>r(l))}})||N)&&(e=!0)};return{send:r}}var zf;(t=>{async function n(e,r,i){if(fr(e))return e;if(r===void 0&&(r=pr()),Fe(e)!==".")return F(r,e);if(i===void 0&&Ce(xt.PATH)&&(i=xt.PATH.split(uo)),i===void 0||i.length===0)return F(r,e);async function s(a){if(await $.exists(a)){let l;try{l=await ab.stat(a)}catch(c){c.message.startsWith("EACCES")&&(l=await ab.lstat(a))}return l?!l.isDirectory():!1}return!1}for(let a of i){let l;if(fr(a)?l=F(a,e):l=F(r,a,e),await s(l))return l;let c=l+".com";if(await s(c)||(c=l+".exe",await s(c)))return c}return F(r,e)}t.findExecutable=n})(zf||={});async function Ad(n,t){return n===1?N?c0():Od(t):l0(n,t)}var qf=null;function l0(n,t){if(j&&n===2||A&&n===3)return"/bin/bash";if(!qf){let e;if(N)e="/bin/bash";else{if(e=t.SHELL,!e)try{e=a0().shell}catch{}e||(e="sh"),e==="/bin/false"&&(e="/bin/bash")}qf=e}return qf}var $f=null;async function c0(){return $f||($f=(await sb()).exePath),$f}function db(n,t,e){return Math.min(Math.max(n,t),e)}var jf;async function Md(n,t,e,r){return e["force-disable-user-env"]?(t.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):N?(t.trace("resolveShellEnv(): skipped (Windows)"),{}):rn(r)&&!e["force-user-env"]?(t.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):(rn(r)?t.trace("resolveShellEnv(): running (--force-user-env)"):t.trace("resolveShellEnv(): running (macOS/Linux)"),jf||(jf=Zt.withAsyncBody(async(i,o)=>{let s=new mt,a=1e4,l=n.getValue("application.shellEnvironmentResolutionTimeout");typeof l=="number"&&(a=db(l,1,120)*1e3);let c=setTimeout(()=>{s.dispose(!0),o(new Error(p("resolveShellEnvTimeout","Unable to resolve your shell environment in a reasonable time. Please review your shell configuration and restart.")))},a);try{i(await u0(t,s.token))}catch(d){!Nu(d)&&!s.token.isCancellationRequested?o(new Error(p("resolveShellEnvError","Unable to resolve your shell environment: {0}",Xt(d)))):i({})}finally{clearTimeout(c),s.dispose()}})),jf)}async function u0(n,t){let e=process.env.ELECTRON_RUN_AS_NODE;n.trace("getUnixShellEnvironment#runAsNode",e);let r=process.env.ELECTRON_NO_ATTACH_CONSOLE;n.trace("getUnixShellEnvironment#noAttach",r);let i=yt().replace(/-/g,"").substr(0,12),o=new RegExp(i+"({.*})"+i),s={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};n.trace("getUnixShellEnvironment#env",s);let a=await Ad(ur,s);return n.trace("getUnixShellEnvironment#shell",a),new Promise((l,c)=>{if(t.isCancellationRequested)return c(new rt);let d=ve(a),f,m,g="";/^pwsh(-preview)?$/.test(d)?(f=`& '${process.execPath}' ${g} -p '''${i}'' + JSON.stringify(process.env) + ''${i}'''`,m=["-Login","-Command"]):d==="nu"?(f=`^'${process.execPath}' ${g} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,m=["-i","-l","-c"]):d==="xonsh"?(f=`import os, json; print("${i}", json.dumps(dict(os.environ)), "${i}")`,m=["-i","-l","-c"]):(f=`'${process.execPath}' ${g} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,d==="tcsh"||d==="csh"?m=["-ic"]:m=["-i","-l","-c"]),n.trace("getUnixShellEnvironment#spawn",JSON.stringify(m),f);let b=d0(a,[...m,f],{detached:!0,stdio:["ignore","pipe","pipe"],env:s});t.onCancellationRequested(()=>(b.kill(),c(new rt))),b.on("error",k=>{n.error("getUnixShellEnvironment#errorChildProcess",Xt(k)),c(k)});let v=[];b.stdout.on("data",k=>v.push(k));let w=[];b.stderr.on("data",k=>w.push(k)),b.on("close",(k,C)=>{let M=Buffer.concat(v).toString("utf8");n.trace("getUnixShellEnvironment#raw",M);let _=Buffer.concat(w).toString("utf8");if(_.trim()&&n.trace("getUnixShellEnvironment#stderr",_),k||C)return c(new Error(p("resolveShellEnvExitError","Unexpected exit code from spawned shell (code {0}, signal {1})",k,C)));let V=o.exec(M),Y=V?V[1]:"{}";try{let q=JSON.parse(Y);e?q.ELECTRON_RUN_AS_NODE=e:delete q.ELECTRON_RUN_AS_NODE,r?q.ELECTRON_NO_ATTACH_CONSOLE=r:delete q.ELECTRON_NO_ATTACH_CONSOLE,delete q.VSCODE_RESOLVING_ENVIRONMENT,delete q.XDG_RUNTIME_DIR,n.trace("getUnixShellEnvironment#result",q),l(q)}catch(q){n.error("getUnixShellEnvironment#errorCaught",Xt(q)),c(q)}})})}var Gf=R("extensionHostStarter"),ub="extensionHostStarter";var di=class extends O{constructor(e,r,i,o){super();this._logService=e;this._lifecycleMainService=r;this._windowsMainService=i;this._telemetryService=o;this._register(this._lifecycleMainService.onWillShutdown(s=>{this._shutdown=!0,s.join("extHostStarter",this._waitForAllExit(6e3))}))}_serviceBrand;static _lastId=0;_extHosts=new Map;_shutdown=!1;dispose(){super.dispose()}_getExtHost(e){let r=this._extHosts.get(e);if(!r)throw new Error("Unknown extension host!");return r}onDynamicStdout(e){return this._getExtHost(e).onStdout}onDynamicStderr(e){return this._getExtHost(e).onStderr}onDynamicMessage(e){return this._getExtHost(e).onMessage}onDynamicExit(e){return this._getExtHost(e).onExit}async createExtensionHost(){if(this._shutdown)throw Vr();let e=String(++di._lastId),r=new li(this._logService,this._windowsMainService,this._telemetryService,this._lifecycleMainService);this._extHosts.set(e,r);let i=r.onExit(({pid:o,code:s,signal:a})=>{i.dispose(),this._logService.info(`Extension host with pid ${o} exited with code: ${s}, signal: ${a}.`),setTimeout(()=>{r.dispose(),this._extHosts.delete(e)}),setTimeout(()=>{try{process.kill(o,0),this._logService.error(`Extension host with pid ${o} still exists, forcefully killing it...`),process.kill(o)}catch{}},1e3)});return{id:e}}async start(e,r){if(this._shutdown)throw Vr();let i=this._getExtHost(e);return i.start({...r,type:"extensionHost",entryPoint:"vs/workbench/api/node/extensionHostProcess",args:["--skipWorkspaceStorageLock"],execArgv:r.execArgv,allowLoadingUnsignedLibraries:!0,forceAllocationsToV8Sandbox:!0,respondToAuthRequestsFromMainProcess:!0,correlationId:e}),{pid:await E.toPromise(i.onSpawn)}}async enableInspectPort(e){if(this._shutdown)throw Vr();let r=this._extHosts.get(e);return r?r.enableInspectPort():!1}async kill(e){if(this._shutdown)throw Vr();let r=this._extHosts.get(e);r&&r.kill()}async _killAllNow(){for(let[,e]of this._extHosts)e.kill()}async _waitForAllExit(e){let r=[];for(let[,i]of this._extHosts)r.push(i.waitForExit(e));return Zt.settled(r).then(()=>{})}};di=P([h(0,B),h(1,le),h(2,Te),h(3,He)],di);var LX=new _o("terminalTabFocusMode",!1,!0);var OX=R("ptyService");var p0={Backend:"workbench.contributions.terminal.processBackend"},Jf=class{_backends=new Map;get backends(){return this._backends}registerTerminalBackend(t){let e=this._sanitizeRemoteAuthority(t.remoteAuthority);if(this._backends.has(e))throw new Error(`A terminal backend with remote authority '${e}' was already registered.`);this._backends.set(e,t)}getTerminalBackend(t){return this._backends.get(this._sanitizeRemoteAuthority(t))}_sanitizeRemoteAuthority(t){return t?.toLowerCase()??""}};et.add(p0.Backend,new Jf);var Qf=R("localPtyService"),AX=R("terminalLogService");var NX=R("externalTerminal"),il="Terminal.app";var ol=R("externalTerminal");import*as Gi from"child_process";var pb=p("console.title","VS Code Console"),sl=class{_serviceBrand;async getDefaultTerminalForPlatforms(){return{windows:al.getDefaultTerminalWindows(),linux:await ll.getDefaultTerminalLinuxReady(),osx:"xterm"}}},Ur=class Ur extends sl{static CMD="cmd.exe";static _DEFAULT_TERMINAL_WINDOWS;openTerminal(t,e){return this.spawnTerminal(Gi,t,Od(),e)}spawnTerminal(t,e,r,i){let o=e.windowsExec||Ur.getDefaultTerminalWindows();i&&i[1]===":"&&(i=i[0].toUpperCase()+i.substr(1));let s=ve(o,".exe").toLowerCase();if(s==="cmder")return t.spawn(o,i?[i]:void 0),Promise.resolve(void 0);let a=["/c","start","/wait"];return o.indexOf(" ")>=0&&a.push(o),a.push(o),s==="wt"&&a.push("-d ."),new Promise((l,c)=>{let d=cs(process),f=t.spawn(r,a,{cwd:i,env:d,detached:!0});f.on("error",c),f.on("exit",()=>l())})}async runInTerminal(t,e,r,i,o){let s="windowsExec"in o&&o.windowsExec?o.windowsExec:Ur.getDefaultTerminalWindows(),a=await Ur.getWtExePath();return new Promise((l,c)=>{let d=`"${e} - ${pb}"`,f=`"${r.join('" "')}" & pause`,m=Object.assign({},cs(process),i);Object.keys(m).filter(k=>m[k]===null).forEach(k=>delete m[k]);let g={cwd:e,env:m,windowsVerbatimArguments:!0},b,v;ve(s,".exe")==="wt"?(b=s,v=["-d",".",Ur.CMD,"/c",f]):a?(b=a,v=["-d",".",s,"/c",f]):(b=Ur.CMD,v=["/c","start",d,"/wait",s,"/c",`"${f}"`]),Gi.spawn(b,v,g).on("error",k=>{c(Yf(k))}),l(void 0)})}static getDefaultTerminalWindows(){if(!Ur._DEFAULT_TERMINAL_WINDOWS){let t=!!process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432");Ur._DEFAULT_TERMINAL_WINDOWS=`${process.env.windir?process.env.windir:"C:\\Windows"}\\${t?"Sysnative":"System32"}\\cmd.exe`}return Ur._DEFAULT_TERMINAL_WINDOWS}static async getWtExePath(){try{let t=await zf.findExecutable("wt");return await $.exists(t)?t:void 0}catch{return}}};P([ie],Ur,"getWtExePath",1);var al=Ur,Wd=class n extends sl{static OSASCRIPT="/usr/bin/osascript";openTerminal(t,e){return this.spawnTerminal(Gi,t,e)}runInTerminal(t,e,r,i,o){let s=o.osxExec||il;return new Promise((a,l)=>{if(s===il||s==="iTerm.app"){let c=s===il?"TerminalHelper":"iTermHelper",f=[Me.asFileUri(`vs/workbench/contrib/externalTerminal/node/${c}.scpt`).fsPath,"-t",t||pb,"-w",e];for(let b of r)f.push("-a"),f.push(b);if(i){let b=Object.assign({},cs(process),i);for(let v in b){let w=b[v];w===null?(f.push("-u"),f.push(v)):(f.push("-e"),f.push(`${v}=${w}`))}}let m="",g=Gi.spawn(n.OSASCRIPT,f);g.on("error",b=>{l(Yf(b))}),g.stderr.on("data",b=>{m+=b.toString()}),g.on("exit",b=>{if(b===0)a(void 0);else if(m){let v=m.split(`
`,1);l(new Error(v[0]))}else l(new Error(p("mac.terminal.script.failed","Script '{0}' failed with exit code {1}",c,b)))})}else l(new Error(p("mac.terminal.type.not.supported","'{0}' not supported",s)))})}spawnTerminal(t,e,r){let i=e.osxExec||il;return new Promise((o,s)=>{let a=["-a",i];r&&a.push(r);let l=cs(process),c=t.spawn("/usr/bin/open",a,{cwd:r,env:l});c.on("error",s),c.on("exit",()=>o())})}},ll=class n extends sl{static WAIT_MESSAGE=p("press.any.key","Press any key to continue...");openTerminal(t,e){return this.spawnTerminal(Gi,t,e)}runInTerminal(t,e,r,i,o){let s=o.linuxExec?Promise.resolve(o.linuxExec):n.getDefaultTerminalLinuxReady();return new Promise((a,l)=>{let c=[];s.then(d=>{d.indexOf("gnome-terminal")>=0?c.push("-x"):c.push("-e"),c.push("bash"),c.push("-c");let f=`${f0(r)}; echo; read -p "${n.WAIT_MESSAGE}" -n1;`;c.push(`''${f}''`);let m=Object.assign({},cs(process),i);Object.keys(m).filter(w=>m[w]===null).forEach(w=>delete m[w]);let g={cwd:e,env:m},b="",v=Gi.spawn(d,c,g);v.on("error",w=>{l(Yf(w))}),v.stderr.on("data",w=>{b+=w.toString()}),v.on("exit",w=>{if(w===0)a(void 0);else if(b){let k=b.split(`
`,1);l(new Error(k[0]))}else l(new Error(p("linux.term.failed","'{0}' failed with exit code {1}",d,w)))})})})}static _DEFAULT_TERMINAL_LINUX_READY;static async getDefaultTerminalLinuxReady(){if(!n._DEFAULT_TERMINAL_LINUX_READY)if(!j)n._DEFAULT_TERMINAL_LINUX_READY=Promise.resolve("xterm");else{let t=await $.exists("/etc/debian_version");n._DEFAULT_TERMINAL_LINUX_READY=new Promise(e=>{t?e("x-terminal-emulator"):process.env.DESKTOP_SESSION==="gnome"||process.env.DESKTOP_SESSION==="gnome-classic"?e("gnome-terminal"):process.env.DESKTOP_SESSION==="kde-plasma"?e("konsole"):process.env.COLORTERM?e(process.env.COLORTERM):process.env.TERM?e(process.env.TERM):e("xterm")})}return n._DEFAULT_TERMINAL_LINUX_READY}spawnTerminal(t,e,r){let i=e.linuxExec?Promise.resolve(e.linuxExec):n.getDefaultTerminalLinuxReady();return new Promise((o,s)=>{i.then(a=>{let l=cs(process),c=t.spawn(a,[],{cwd:r,env:l});c.on("error",s),c.on("exit",()=>o())})})}};function cs(n){let t={...n.env};return Zy(t),t}function Yf(n){return"errno"in n&&n.errno==="ENOENT"&&"path"in n&&typeof n.path=="string"?new Error(p("ext.term.app.not.found","can't find terminal application '{0}'",n.path)):n}function f0(n){let t="";for(let e of n)e.indexOf(" ")>=0?t+='"'+e+'"':t+=e,t+=" ";return t}function Bd(n){return typeof n.correlationId=="number"}function Zf(n){return n.recursive===!0}var Fd=class n extends O{constructor(e,r,i,o){super();this.onFileChanges=e;this.onLogMessage=r;this.verboseLogging=i;this.options=o}static MAX_RESTARTS=5;watcher;watcherDisposables=this._register(new Dr);requests=void 0;restartCounter=0;init(){let e=new re;this.watcherDisposables.value=e,this.watcher=this.createWatcher(e),this.watcher.setVerboseLogging(this.verboseLogging),e.add(this.watcher.onDidChangeFile(r=>this.onFileChanges(r))),e.add(this.watcher.onDidLogMessage(r=>this.onLogMessage(r))),e.add(this.watcher.onDidError(r=>this.onError(r.error,r.request)))}onError(e,r){this.canRestart(e,r)?this.restartCounter<n.MAX_RESTARTS&&this.requests?(this.error(`restarting watcher after unexpected error: ${e}`),this.restart(this.requests)):this.error(`gave up attempting to restart watcher after unexpected error: ${e}`):this.error(e)}canRestart(e,r){return!(!this.options.restartOnError||r||e.indexOf("No space left on device")!==-1||e.indexOf("EMFILE")!==-1)}restart(e){this.restartCounter++,this.init(),this.watch(e)}async watch(e){this.requests=e,await this.watcher?.watch(e)}async setVerboseLogging(e){this.verboseLogging=e,await this.watcher?.setVerboseLogging(e)}error(e){this.onLogMessage({type:"error",message:`[File Watcher (${this.options.type})] ${e}`})}trace(e){this.onLogMessage({type:"trace",message:`[File Watcher (${this.options.type})] ${e}`})}dispose(){return this.watcher=void 0,super.dispose()}},Ud=class extends Fd{constructor(t,e,r){super(t,e,r,{type:"node.js",restartOnError:!1})}},Nd=class extends Fd{constructor(t,e,r){super(t,e,r,{type:"universal",restartOnError:!0})}};function Vd(n){return n.map(t=>({type:t.type,resource:x.revive(t.resource),cId:t.cId}))}function mb(n){let t=new Xf;for(let e of n)t.processEvent(e);return t.coalesce()}function m0(n,t){return typeof t=="string"&&!t.startsWith(Oo)&&!fr(t)?{base:n,pattern:t}:t}function em(n,t){let e=[];for(let r of t)e.push(gv(m0(n,r)));return e}var Xf=class{coalesced=new Set;mapPathToChange=new Map;toKey(t){return j?t.resource.fsPath:t.resource.fsPath.toLowerCase()}processEvent(t){let e=this.mapPathToChange.get(this.toKey(t)),r=!1;if(e){let i=e.type,o=t.type;e.resource.fsPath!==t.resource.fsPath&&(t.type===2||t.type===1)?r=!0:i===1&&o===2?(this.mapPathToChange.delete(this.toKey(t)),this.coalesced.delete(e)):i===2&&o===1?e.type=0:i===1&&o===0||(e.type=o)}else r=!0;r&&(this.coalesced.add(t),this.mapPathToChange.set(this.toKey(t),t))}coalesce(){let t=[],e=[];return Array.from(this.coalesced).filter(r=>r.type!==2?(t.push(r),!1):!0).sort((r,i)=>r.resource.fsPath.length-i.resource.fsPath.length).filter(r=>e.some(i=>kv(r.resource.fsPath,i,!j))?!1:(e.push(r.resource.fsPath),!0)).concat(t)}};function hb(n,t){if(typeof t=="number")switch(n.type){case 1:return(t&4)===0;case 2:return(t&8)===0;case 0:return(t&2)===0}return!1}function gb(n){if(typeof n=="number"){let t=[];return n&4&&t.push("Added"),n&8&&t.push("Deleted"),n&2&&t.push("Updated"),t.length===0?"<all>":`[${t.join(", ")}]`}return"<none>"}var rm="localFilesystem";import{shell as k0}from"electron";import{promises as ui}from"fs";async function vb(n,t,e,r,i,o){let s;try{await g0(n,t,e,r,i,o)}catch(a){s=a}finally{s&&i.errorTransformer&&(s=i.errorTransformer(s)),typeof s<"u"&&e.error(s),e.end()}}async function g0(n,t,e,r,i,o){nm(o);let s=await n.open(t,{create:!1});try{nm(o);let a=0,l=0,c=i&&typeof i.length=="number"?i.length:void 0,d=te.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),f=i&&typeof i.position=="number"?i.position:0,m=0;do l=await n.read(s,f,d.buffer,m,d.byteLength-m),f+=l,m+=l,a+=l,typeof c=="number"&&(c-=l),m===d.byteLength&&(await e.write(r(d)),d=te.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),m=0);while(l>0&&(typeof c!="number"||c>0)&&nm(o)&&v0(a,i));if(m>0){let g=m;typeof c=="number"&&(g=Math.min(m,c)),e.write(r(d.slice(0,g)))}}catch(a){throw Tv(a)}finally{await n.close(s)}}function nm(n){if(n.isCancellationRequested)throw Vr();return!0}function v0(n,t){if(typeof t?.limits?.size=="number"&&n>t.limits.size)throw qt(p("fileTooLargeError","File is too large to open"),"EntryTooLarge");return!0}var Kd=class extends O{constructor(e,r){super();this.logService=e;this.options=r}_onDidChangeFile=this._register(new S);onDidChangeFile=this._onDidChangeFile.event;_onDidWatchError=this._register(new S);onDidWatchError=this._onDidWatchError.event;watch(e,r){return r.recursive||this.options?.watcher?.forceUniversal?this.watchUniversal(e,r):this.watchNonRecursive(e,r)}universalWatcher;universalWatchRequests=[];universalWatchRequestDelayer=this._register(new Kt(0));watchUniversal(e,r){let i={path:this.toWatchPath(e),excludes:r.excludes,includes:r.includes,recursive:r.recursive,filter:r.filter,correlationId:r.correlationId},o=Vu(this.universalWatchRequests,i);return this.refreshUniversalWatchers(),Z(()=>{o(),this.refreshUniversalWatchers()})}refreshUniversalWatchers(){this.universalWatchRequestDelayer.trigger(()=>this.doRefreshUniversalWatchers()).catch(e=>nt(e))}doRefreshUniversalWatchers(){this.universalWatcher||(this.universalWatcher=this._register(this.createUniversalWatcher(r=>this._onDidChangeFile.fire(Vd(r)),r=>this.onWatcherLogMessage(r),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.universalWatcher?.setVerboseLogging(this.logService.getLevel()===1)})));let e=this.options?.watcher?.recursive?.usePolling;if(e===!0)for(let r of this.universalWatchRequests)Zf(r)&&(r.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);else if(Array.isArray(e))for(let r of this.universalWatchRequests)Zf(r)&&e.includes(r.path)&&(r.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);return this.universalWatcher.watch(this.universalWatchRequests)}nonRecursiveWatcher;nonRecursiveWatchRequests=[];nonRecursiveWatchRequestDelayer=this._register(new Kt(0));watchNonRecursive(e,r){let i={path:this.toWatchPath(e),excludes:r.excludes,includes:r.includes,recursive:!1,filter:r.filter,correlationId:r.correlationId},o=Vu(this.nonRecursiveWatchRequests,i);return this.refreshNonRecursiveWatchers(),Z(()=>{o(),this.refreshNonRecursiveWatchers()})}refreshNonRecursiveWatchers(){this.nonRecursiveWatchRequestDelayer.trigger(()=>this.doRefreshNonRecursiveWatchers()).catch(e=>nt(e))}doRefreshNonRecursiveWatchers(){return this.nonRecursiveWatcher||(this.nonRecursiveWatcher=this._register(this.createNonRecursiveWatcher(e=>this._onDidChangeFile.fire(Vd(e)),e=>this.onWatcherLogMessage(e),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.nonRecursiveWatcher?.setVerboseLogging(this.logService.getLevel()===1)}))),this.nonRecursiveWatcher.watch(this.nonRecursiveWatchRequests)}onWatcherLogMessage(e){e.type==="error"&&this._onDidWatchError.fire(e.message),this.logWatcherMessage(e)}logWatcherMessage(e){this.logService[e.type](e.message)}toFilePath(e){return ct(e.fsPath)}toWatchPath(e){let r=this.toFilePath(e);return xp(r)}};import{fork as I0}from"child_process";function yb(n){let t=n;return t&&typeof t.type=="string"&&typeof t.severity=="string"}function y0(n){let t=[],e;try{let r=JSON.parse(n.arguments),i=r[r.length-1];i&&i.__$stack&&(r.pop(),e=i.__$stack),t.push(...r)}catch{t.push("Unable to log remote console arguments",n.arguments)}return{args:t,stack:e}}function b0(n){if(!n)return n;let t=n.indexOf(`
`);return t===-1?n:n.substring(0,t)}function bb(n,t){let{args:e,stack:r}=y0(n),i=typeof e[0]=="string"&&e.length===1,o=b0(r);o&&(o=`(${o.trim()})`);let s=[];if(typeof e[0]=="string"?o&&i?s=[`%c[${t}] %c${e[0]} %c${o}`,ds("blue"),ds(""),ds("grey")]:s=[`%c[${t}] %c${e[0]}`,ds("blue"),ds(""),...e.slice(1)]:s=[`%c[${t}]%`,ds("blue"),...e],o&&!i&&s.push(o),typeof console[n.severity]!="function")throw new Error("Unknown console method");console[n.severity].apply(console,s)}function ds(n){return`color: ${n}`}var Hd=class{constructor(t,e){this.modulePath=t;this.options=e;let r=e&&e.timeout?e.timeout:6e4;this.disposeDelayer=new ma(r),this.child=null,this._client=null}disposeDelayer;activeRequests=new Set;child;_client;channels=new Map;_onDidProcessExit=new S;onDidProcessExit=this._onDidProcessExit.event;getChannel(t){let e=this;return{call(r,i,o){return e.requestPromise(t,r,i,o)},listen(r,i){return e.requestEvent(t,r,i)}}}requestPromise(t,e,r,i=Ee.None){if(!this.disposeDelayer)return Promise.reject(new Error("disposed"));if(i.isCancellationRequested)return Promise.reject(Vr());this.disposeDelayer.cancel();let o=this.getCachedChannel(t),s=Hn(c=>o.call(e,r,c)),a=i.onCancellationRequested(()=>s.cancel()),l=Z(()=>s.cancel());return this.activeRequests.add(l),s.finally(()=>{a.dispose(),this.activeRequests.delete(l),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}),s}requestEvent(t,e,r){if(!this.disposeDelayer)return E.None;this.disposeDelayer.cancel();let i,o=new S({onWillAddFirstListener:()=>{i=this.getCachedChannel(t).listen(e,r)(o.fire,o),this.activeRequests.add(i)},onDidRemoveLastListener:()=>{this.activeRequests.delete(i),i.dispose(),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}});return o.event}get client(){if(!this._client){let t=this.options&&this.options.args?this.options.args:[],e=Object.create(null);e.env={...In(process.env),VSCODE_PARENT_PID:String(process.pid)},this.options&&this.options.env&&(e.env={...e.env,...this.options.env}),this.options&&this.options.freshExecArgv&&(e.execArgv=[]),this.options&&typeof this.options.debug=="number"&&(e.execArgv=["--nolazy","--inspect="+this.options.debug]),this.options&&typeof this.options.debugBrk=="number"&&(e.execArgv=["--nolazy","--inspect-brk="+this.options.debugBrk]),e.execArgv===void 0&&(e.execArgv=process.execArgv.filter(f=>!/^--inspect(-brk)?=/.test(f)).filter(f=>!f.startsWith("--vscode-"))),Dd(e.env),this.child=I0(this.modulePath,t,e);let r=new S,o=E.fromNodeEventEmitter(this.child,"message",f=>f)(f=>{if(yb(f)){bb(f,`IPC Library: ${this.options.serverName}`);return}r.fire(te.wrap(Buffer.from(f,"base64")))}),s=this.options.useQueue?lb(this.child):this.child,a=f=>this.child&&this.child.connected&&s.send(f.buffer.toString("base64")),l=r.event,c={send:a,onMessage:l};this._client=new Mi(c);let d=()=>this.disposeClient();process.once("exit",d),this.child.on("error",f=>console.warn('IPC "'+this.options.serverName+'" errored with '+f)),this.child.on("exit",(f,m)=>{process.removeListener("exit",d),o.dispose(),this.activeRequests.forEach(g=>ft(g)),this.activeRequests.clear(),f!==0&&m!=="SIGTERM"&&console.warn('IPC "'+this.options.serverName+'" crashed with exit code '+f+" and signal "+m),this.disposeDelayer?.cancel(),this.disposeClient(),this._onDidProcessExit.fire({code:f,signal:m})})}return this._client}getCachedChannel(t){let e=this.channels.get(t);return e||(e=this.client.getChannel(t),this.channels.set(t,e)),e}disposeClient(){this._client&&(this.child&&(this.child.kill(),this.child=null),this._client=null,this.channels.clear())}dispose(){this._onDidProcessExit.dispose(),this.disposeDelayer?.cancel(),this.disposeDelayer=void 0,this.disposeClient(),this.activeRequests.clear()}};var zd=class extends Nd{constructor(t,e,r){super(t,e,r),this.init()}createWatcher(t){let e=t.add(new Hd(Me.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_AMD_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return t.add(e.onDidProcessExit(({code:r,signal:i})=>this.onError(`terminated by itself with code ${r}, signal: ${i} (ETERM)`))),je.toService(Lg(e.getChannel("watcher")))}};import{watchFile as w0,unwatchFile as x0}from"fs";var qd=class extends O{_onDidChangeFile=this._register(new S);onDidChangeFile=this._onDidChangeFile.event;_onDidLogMessage=this._register(new S);onDidLogMessage=this._onDidLogMessage.event;_onDidWatchFail=this._register(new S);onDidWatchFail=this._onDidWatchFail.event;allNonCorrelatedWatchRequests=new Set;allCorrelatedWatchRequests=new Map;suspendedWatchRequests=this._register(new pn);suspendedWatchRequestsWithPolling=new Set;updateWatchersDelayer=this._register(new Kt(this.getUpdateWatchersDelay()));suspendedWatchRequestPollingInterval=5007;joinWatch=new Ht;constructor(){super(),this._register(this.onDidWatchFail(t=>this.handleDidWatchFail(t)))}handleDidWatchFail(t){this.isCorrelated(t)&&this.suspendWatchRequest(t)}isCorrelated(t){return Bd(t)}async watch(t){this.joinWatch.isSettled||this.joinWatch.complete(),this.joinWatch=new Ht;try{this.allCorrelatedWatchRequests.clear(),this.allNonCorrelatedWatchRequests.clear();for(let e of t)this.isCorrelated(e)?this.allCorrelatedWatchRequests.set(e.correlationId,e):this.allNonCorrelatedWatchRequests.add(e);for(let[e]of this.suspendedWatchRequests)this.allCorrelatedWatchRequests.has(e)||(this.suspendedWatchRequests.deleteAndDispose(e),this.suspendedWatchRequestsWithPolling.delete(e));return await this.updateWatchers(!1)}finally{this.joinWatch.complete()}}updateWatchers(t){return this.updateWatchersDelayer.trigger(()=>this.doWatch([...this.allNonCorrelatedWatchRequests,...Array.from(this.allCorrelatedWatchRequests.values()).filter(e=>!this.suspendedWatchRequests.has(e.correlationId))]),t?this.getUpdateWatchersDelay():0)}getUpdateWatchersDelay(){return 800}isSuspended(t){return typeof t.correlationId!="number"?!1:this.suspendedWatchRequestsWithPolling.has(t.correlationId)?"polling":this.suspendedWatchRequests.has(t.correlationId)}async suspendWatchRequest(t){if(this.suspendedWatchRequests.has(t.correlationId))return;let e=new re;this.suspendedWatchRequests.set(t.correlationId,e),await this.joinWatch.p,!e.isDisposed&&(this.monitorSuspendedWatchRequest(t,e),this.updateWatchers(!0))}resumeWatchRequest(t){this.suspendedWatchRequests.deleteAndDispose(t.correlationId),this.suspendedWatchRequestsWithPolling.delete(t.correlationId),this.updateWatchers(!1)}monitorSuspendedWatchRequest(t,e){this.doMonitorWithExistingWatcher(t,e)?(this.trace(`reusing an existing recursive watcher to monitor ${t.path}`),this.suspendedWatchRequestsWithPolling.delete(t.correlationId)):(this.doMonitorWithNodeJS(t,e),this.suspendedWatchRequestsWithPolling.add(t.correlationId))}doMonitorWithExistingWatcher(t,e){let r=this.recursiveWatcher?.subscribe(t.path,(i,o)=>{e.isDisposed||(i?this.monitorSuspendedWatchRequest(t,e):o?.type===1&&this.onMonitoredPathAdded(t))});return r?(e.add(r),!0):!1}doMonitorWithNodeJS(t,e){let r=!1,i=(o,s)=>{if(e.isDisposed)return;let a=this.isPathNotFound(o),l=this.isPathNotFound(s),c=r;r=a,!a&&(l||c)&&this.onMonitoredPathAdded(t)};this.trace(`starting fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{w0(t.path,{persistent:!1,interval:this.suspendedWatchRequestPollingInterval},i)}catch(o){this.warn(`fs.watchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}e.add(Z(()=>{this.trace(`stopping fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{x0(t.path,i)}catch(o){this.warn(`fs.unwatchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}}))}onMonitoredPathAdded(t){this.trace(`detected ${t.path} exists again, resuming watcher (correlationId: ${t.correlationId})`);let e={resource:x.file(t.path),type:1,cId:t.correlationId};this._onDidChangeFile.fire([e]),this.traceEvent(e,t),this.resumeWatchRequest(t)}isPathNotFound(t){return t.ctimeMs===0&&t.ino===0}async stop(){this.suspendedWatchRequests.clearAndDisposeAll(),this.suspendedWatchRequestsWithPolling.clear()}traceEvent(t,e){if(this.verboseLogging){let r=` >> normalized ${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`;this.traceWithCorrelation(r,e)}}traceWithCorrelation(t,e){this.verboseLogging&&this.trace(`${t}${typeof e.correlationId=="number"?` <${e.correlationId}> `:""}`)}requestToString(t){return`${t.path} (excludes: ${t.excludes.length>0?t.excludes:"<none>"}, includes: ${t.includes&&t.includes.length>0?JSON.stringify(t.includes):"<all>"}, filter: ${gb(t.filter)}, correlationId: ${typeof t.correlationId=="number"?t.correlationId:"<none>"})`}verboseLogging=!1;async setVerboseLogging(t){this.verboseLogging=t}};import{watch as E0,promises as P0}from"fs";import*as us from"fs";async function $d(n,t){if(j)return n;let e=Fe(n);if(n===e)return n;let r=(ve(n)||n).toLowerCase();try{if(t?.isCancellationRequested)return null;let o=(await $.readdir(e)).filter(s=>s.toLowerCase()===r);if(o.length===1){let s=await $d(e,t);if(s)return F(s,o[0])}else if(o.length>1){let s=o.indexOf(r);if(s>=0){let a=await $d(e,t);if(a)return F(a,o[s])}}}catch{}return null}async function Ib(n){try{return await $.realpath(n)}catch{let e=S0(n);return await us.promises.access(e,us.constants.R_OK),e}}function S0(n){return Ri(ct(n),ot)}var jd=class n extends O{constructor(e,r,i,o,s,a){super();this.request=e;this.recursiveWatcher=r;this.onDidFilesChange=i;this.onDidWatchFail=o;this.onLogMessage=s;this.verboseLogging=a}static FILE_DELETE_HANDLER_DELAY=100;static FILE_CHANGES_HANDLER_DELAY=75;throttledFileChangesEmitter=this._register(new pc({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},e=>this.onDidFilesChange(e)));fileChangesAggregator=this._register(new uc(e=>this.handleFileChanges(e),n.FILE_CHANGES_HANDLER_DELAY));excludes=em(this.request.path,this.request.excludes);includes=this.request.includes?em(this.request.path,this.request.includes):void 0;filter=Bd(this.request)?this.request.filter:void 0;cts=new mt;ready=this.watch();_isReusingRecursiveWatcher=!1;get isReusingRecursiveWatcher(){return this._isReusingRecursiveWatcher}didFail=!1;get failed(){return this.didFail}async watch(){try{let e=await this.normalizePath(this.request);if(this.cts.token.isCancellationRequested)return;let r=await P0.stat(e);if(this.cts.token.isCancellationRequested)return;this._register(await this.doWatch(e,r.isDirectory()))}catch(e){e.code!=="ENOENT"?this.error(e):this.trace(`ignoring a path for watching who's stat info failed to resolve: ${this.request.path} (error: ${e})`),this.notifyWatchFailed()}}notifyWatchFailed(){this.didFail=!0,this.onDidWatchFail?.()}async normalizePath(e){let r=e.path;try{r=await $.realpath(e.path),e.path===r&&(r=await $d(e.path,this.cts.token)??e.path),e.path!==r&&this.trace(`correcting a path to watch that seems to be a symbolic link or wrong casing (original: ${e.path}, real: ${r})`)}catch{}return r}async doWatch(e,r){let i=new re;return this.doWatchWithExistingWatcher(e,r,i)?(this.trace(`reusing an existing recursive watcher for ${this.request.path}`),this._isReusingRecursiveWatcher=!0):(this._isReusingRecursiveWatcher=!1,await this.doWatchWithNodeJS(e,r,i)),i}doWatchWithExistingWatcher(e,r,i){if(r)return!1;let o=x.file(this.request.path),s=this.recursiveWatcher?.subscribe(this.request.path,async(a,l)=>{if(!i.isDisposed)if(a){let c=await this.doWatch(e,r);i.isDisposed?c.dispose():i.add(c)}else l&&(typeof l.cId=="number"||typeof this.request.correlationId=="number")&&this.onFileChange({resource:o,type:l.type,cId:this.request.correlationId},!0)});return s?(i.add(s),!0):!1}async doWatchWithNodeJS(e,r,i){if(A&&hn(e,"/Volumes/",!0)){this.error(`Refusing to watch ${e} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}let o=new mt(this.cts.token);i.add(Z(()=>o.dispose(!0)));let s=new re;i.add(s);try{let a=x.file(this.request.path),l=ve(e),c=E0(e);s.add(Z(()=>{c.removeAllListeners(),c.close()})),this.trace(`Started watching: '${e}'`);let d=new Set;if(r)try{for(let m of await $.readdir(e))d.add(m)}catch(m){this.error(m)}if(o.token.isCancellationRequested)return;let f=new Map;s.add(Z(()=>{for(let[,m]of f)m.dispose();f.clear()})),c.on("error",(m,g)=>{o.token.isCancellationRequested||(this.error(`Failed to watch ${e} for changes using fs.watch() (${m}, ${g})`),this.notifyWatchFailed())}),c.on("change",(m,g)=>{if(o.token.isCancellationRequested)return;this.verboseLogging&&this.traceWithCorrelation(`[raw] ["${m}"] ${g}`);let b="";if(g&&(b=g.toString(),A&&(b=tn(b))),!(!b||m!=="change"&&m!=="rename"))if(r)if(m==="rename"){f.get(b)?.dispose();let v=setTimeout(async()=>{if(f.delete(b),b===l&&!await $.exists(e)){this.onWatchedPathDeleted(a);return}if(o.token.isCancellationRequested)return;let w=await this.existsChildStrictCase(F(e,b));if(o.token.isCancellationRequested)return;let k;w?d.has(b)?k=0:(k=1,d.add(b)):(d.delete(b),k=2),this.onFileChange({resource:ne(a,b),type:k,cId:this.request.correlationId})},n.FILE_DELETE_HANDLER_DELAY);f.set(b,Z(()=>clearTimeout(v)))}else{let v;d.has(b)?v=0:(v=1,d.add(b)),this.onFileChange({resource:ne(a,b),type:v,cId:this.request.correlationId})}else if(m==="rename"||b!==l){let v=setTimeout(async()=>{let w=await $.exists(e);o.token.isCancellationRequested||(w?(this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0),s.add(await this.doWatch(e,!1))):this.onWatchedPathDeleted(a))},n.FILE_DELETE_HANDLER_DELAY);s.clear(),s.add(Z(()=>clearTimeout(v)))}else this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0)})}catch(a){o.token.isCancellationRequested||this.error(`Failed to watch ${e} for changes using fs.watch() (${a.toString()})`),this.notifyWatchFailed()}}onWatchedPathDeleted(e){this.warn("Watcher shutdown because watched path got deleted"),this.onFileChange({resource:e,type:2,cId:this.request.correlationId},!0),this.fileChangesAggregator.flush(),this.notifyWatchFailed()}onFileChange(e,r=!1){this.cts.token.isCancellationRequested||(this.verboseLogging&&this.traceWithCorrelation(`${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`),!r&&this.excludes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (excluded) ${e.resource.fsPath}`):!r&&this.includes&&this.includes.length>0&&!this.includes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (not included) ${e.resource.fsPath}`):this.fileChangesAggregator.work(e))}handleFileChanges(e){let r=mb(e),i=[];for(let s of r){if(hb(s,this.filter)){this.verboseLogging&&this.traceWithCorrelation(` >> ignored (filtered) ${s.resource.fsPath}`);continue}i.push(s)}if(i.length===0)return;if(this.verboseLogging)for(let s of i)this.traceWithCorrelation(` >> normalized ${s.type===1?"[ADDED]":s.type===2?"[DELETED]":"[CHANGED]"} ${s.resource.fsPath}`);this.throttledFileChangesEmitter.work(i)?this.throttledFileChangesEmitter.pending>0&&this.trace(`started throttling events due to large amount of file change events at once (pending: ${this.throttledFileChangesEmitter.pending}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.warn(`started ignoring events due to too many file change events at once (incoming: ${i.length}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async existsChildStrictCase(e){if(j)return $.exists(e);try{let r=ve(e);return(await $.readdir(Fe(e))).some(o=>o===r)}catch(r){return this.trace(r),!1}}setVerboseLogging(e){this.verboseLogging=e}error(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"error",message:`[File Watcher (node.js)] ${e}`})}warn(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"warn",message:`[File Watcher (node.js)] ${e}`})}trace(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.onLogMessage?.({type:"trace",message:`[File Watcher (node.js)] ${e}`})}traceWithCorrelation(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.trace(`${e}${typeof this.request.correlationId=="number"?` <${this.request.correlationId}> `:""}`)}dispose(){this.cts.dispose(!0),super.dispose()}};var Gd=class extends qd{constructor(e){super();this.recursiveWatcher=e}onDidError=E.None;watchers=new Set;async doWatch(e){e=this.removeDuplicateRequests(e);let r=[],i=new Set(Array.from(this.watchers));for(let o of e){let s=this.findWatcher(o);s&&Zp(s.request.excludes,o.excludes)&&Zp(s.request.includes,o.includes)?i.delete(s):r.push(o)}r.length&&this.trace(`Request to start watching: ${r.map(o=>this.requestToString(o)).join(",")}`),i.size&&this.trace(`Request to stop watching: ${Array.from(i).map(o=>this.requestToString(o.request)).join(",")}`);for(let o of i)this.stopWatching(o);for(let o of r)this.startWatching(o)}findWatcher(e){for(let r of this.watchers)if(typeof e.correlationId=="number"||typeof r.request.correlationId=="number"){if(r.request.correlationId===e.correlationId)return r}else if(Li(r.request.path,e.path,!j))return r}startWatching(e){let r=new jd(e,this.recursiveWatcher,o=>this._onDidChangeFile.fire(o),()=>this._onDidWatchFail.fire(e),o=>this._onDidLogMessage.fire(o),this.verboseLogging),i={request:e,instance:r};this.watchers.add(i)}async stop(){await super.stop();for(let e of this.watchers)this.stopWatching(e)}stopWatching(e){this.trace("stopping file watcher",e),this.watchers.delete(e),e.instance.dispose()}removeDuplicateRequests(e){let r=new Map;for(let i of e){let o=j?i.path:i.path.toLowerCase(),s=r.get(i.correlationId);s||(s=new Map,r.set(i.correlationId,s)),s.has(o)&&this.trace(`ignoring a request for watching who's path is already watched: ${this.requestToString(i)}`),s.set(o,i)}return Array.from(r.values()).map(i=>Array.from(i.values())).flat()}async setVerboseLogging(e){super.setVerboseLogging(e);for(let r of this.watchers)r.instance.setVerboseLogging(e)}trace(e,r){this.verboseLogging&&this._onDidLogMessage.fire({type:"trace",message:this.toMessage(e,r)})}warn(e){this._onDidLogMessage.fire({type:"warn",message:this.toMessage(e)})}toMessage(e,r){return r?`[File Watcher (node.js)] ${e} (${this.requestToString(r.request)})`:`[File Watcher (node.js)] ${e}`}};var Jd=class extends Ud{constructor(t,e,r){super(t,e,r),this.init()}createWatcher(t){return t.add(new Gd(void 0))}};var ps=class n extends Kd{static TRACE_LOG_RESOURCE_LOCKS=!1;constructor(t,e){super(t,e)}onDidChangeCapabilities=E.None;_capabilities;get capabilities(){return this._capabilities||(this._capabilities=253982,j&&(this._capabilities|=1024)),this._capabilities}async stat(t){try{let{stat:e,symbolicLink:r}=await gt.stat(this.toFilePath(t));return{type:this.toType(e,r),ctime:e.birthtime.getTime(),mtime:e.mtime.getTime(),size:e.size,permissions:e.mode&128?void 0:2}}catch(e){throw this.toFileSystemProviderError(e)}}async statIgnoreError(t){try{return await this.stat(t)}catch{return}}async readdir(t){try{let e=await $.readdir(this.toFilePath(t),{withFileTypes:!0}),r=[];return await Promise.all(e.map(async i=>{try{let o;i.isSymbolicLink()?o=(await this.stat(ne(t,i.name))).type:o=this.toType(i),r.push([i.name,o])}catch(o){this.logService.trace(o)}})),r}catch(e){throw this.toFileSystemProviderError(e)}}toType(t,e){let r;return e?.dangling?r=0:t.isFile()?r=1:t.isDirectory()?r=2:r=0,e&&(r|=64),r}resourceLocks=new Ot(t=>Ae.getComparisonKey(t));async createResourceLock(t){let e=this.toFilePath(t);this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${e})`);let r;for(;r=this.resourceLocks.get(t);)this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${e})`),await r.wait();let i=new Vn;return this.resourceLocks.set(t,i),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${e})`),Z(()=>{this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${e})`),this.resourceLocks.get(t)===i&&(this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${e})`),this.resourceLocks.delete(t)),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${e})`),i.open()})}async readFile(t,e){let r;try{e?.atomic&&(this.traceLock(`[Disk FileSystemProvider]: atomic read operation started (${this.toFilePath(t)})`),r=await this.createResourceLock(t));let i=this.toFilePath(t);return await ui.readFile(i)}catch(i){throw this.toFileSystemProviderError(i)}finally{r?.dispose()}}traceLock(t){n.TRACE_LOG_RESOURCE_LOCKS&&this.logService.trace(t)}readFileStream(t,e,r){let i=ec(o=>te.concat(o.map(s=>te.wrap(s))).buffer);return vb(this,t,i,o=>o.buffer,{...e,bufferSize:256*1024},r),i}async writeFile(t,e,r){return r?.atomic!==!1&&r?.atomic?.postfix&&await this.canWriteFileAtomic(t)?this.doWriteFileAtomic(t,ne(mg(t),`${Vt(t)}${r.atomic.postfix}`),e,r):this.doWriteFile(t,e,r)}async canWriteFileAtomic(t){try{let e=this.toFilePath(t),{symbolicLink:r}=await gt.stat(e);if(r)return!1}catch{}return!0}async doWriteFileAtomic(t,e,r,i){let o=new re;try{o.add(await this.createResourceLock(t)),o.add(await this.createResourceLock(e)),await this.doWriteFile(e,r,i,!0);try{await this.rename(e,t,{overwrite:!0})}catch(s){try{await this.delete(e,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw s}}finally{o.dispose()}}async doWriteFile(t,e,r,i){let o;try{let s=this.toFilePath(t);if(!r.create||!r.overwrite){if(await $.exists(s)){if(!r.overwrite)throw qt(p("fileExists","File already exists"),"EntryExists")}else if(!r.create)throw qt(p("fileNotExists","File does not exist"),"EntryNotFound")}o=await this.open(t,{create:!0,unlock:r.unlock},i),await this.write(o,0,e,0,e.byteLength)}catch(s){throw await this.toFileSystemProviderWriteError(t,s)}finally{typeof o=="number"&&await this.close(o)}}mapHandleToPos=new Map;mapHandleToLock=new Map;writeHandles=new Map;static canFlush=!0;static configureFlushOnWrite(t){n.canFlush=t}async open(t,e,r){let i=this.toFilePath(t),o;Mo(e)&&!r&&(o=await this.createResourceLock(t));let s;try{if(Mo(e)&&e.unlock)try{let{stat:l}=await gt.stat(i);l.mode&128||await ui.chmod(i,l.mode|128)}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}let a;if(Mo(e)){if(N)try{await ui.truncate(i,0),a="r+"}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}a||(a="w")}else a="r";s=await $.open(i,a)}catch(a){throw o?.dispose(),Mo(e)?await this.toFileSystemProviderWriteError(t,a):this.toFileSystemProviderError(a)}if(this.mapHandleToPos.set(s,0),Mo(e)&&this.writeHandles.set(s,t),o){let a=this.mapHandleToLock.get(s);this.traceLock(`[Disk FileSystemProvider]: open() - storing lock for handle ${s} (${i})`),this.mapHandleToLock.set(s,o),a&&(this.traceLock(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${s} (${i})`),a.dispose())}return s}async close(t){let e=this.mapHandleToLock.get(t);try{if(this.mapHandleToPos.delete(t),this.writeHandles.delete(t)&&n.canFlush)try{await $.fdatasync(t)}catch(r){n.configureFlushOnWrite(!1),this.logService.error(r)}return await $.close(t)}catch(r){throw this.toFileSystemProviderError(r)}finally{e&&(this.mapHandleToLock.get(t)===e&&(this.traceLock(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${t}`),this.mapHandleToLock.delete(t)),this.traceLock(`[Disk FileSystemProvider]: close() - disposing lock for handle ${t}`),e.dispose())}}async read(t,e,r,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await $.read(t,r,i,o,s)).bytesRead}catch(l){throw this.toFileSystemProviderError(l)}finally{this.updatePos(t,s,a)}return a}normalizePos(t,e){return e===this.mapHandleToPos.get(t)?null:e}updatePos(t,e,r){let i=this.mapHandleToPos.get(t);typeof i=="number"&&(typeof e=="number"||(typeof r=="number"?this.mapHandleToPos.set(t,i+r):this.mapHandleToPos.delete(t)))}async write(t,e,r,i,o){return _g(()=>this.doWrite(t,e,r,i,o),100,3)}async doWrite(t,e,r,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await $.write(t,r,i,o,s)).bytesWritten}catch(l){throw await this.toFileSystemProviderWriteError(this.writeHandles.get(t),l)}finally{this.updatePos(t,s,a)}return a}async mkdir(t){try{await ui.mkdir(this.toFilePath(t))}catch(e){throw this.toFileSystemProviderError(e)}}async delete(t,e){try{let r=this.toFilePath(t);if(e.recursive){let i;e?.atomic!==!1&&e.atomic.postfix&&(i=F(Fe(r),`${ve(r)}${e.atomic.postfix}`)),await $.rm(r,1,i)}else try{await ui.unlink(r)}catch(i){if(i.code==="EPERM"||i.code==="EISDIR"){let o=!1;try{let{stat:s,symbolicLink:a}=await gt.stat(r);o=s.isDirectory()&&!a}catch{}if(o)await ui.rmdir(r);else throw i}else throw i}}catch(r){throw this.toFileSystemProviderError(r)}}async rename(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"move",r.overwrite),await $.rename(i,o)}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(p("moveError","Unable to move '{0}' into '{1}' ({2}).",ve(i),ve(Fe(o)),s.toString()))),this.toFileSystemProviderError(s)}}async copy(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"copy",r.overwrite),await $.copy(i,o,{preserveSymlinks:!0})}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(p("copyError","Unable to copy '{0}' into '{1}' ({2}).",ve(i),ve(Fe(o)),s.toString()))),this.toFileSystemProviderError(s)}}async validateMoveCopy(t,e,r,i){let o=this.toFilePath(t),s=this.toFilePath(e),a=!1;if(!!(this.capabilities&1024)||(a=Li(o,s,!0)),a){if(r==="copy")throw qt(p("fileCopyErrorPathCase","File cannot be copied to same path with different path case"),"EntryExists");if(r==="move")return}let c=await this.statIgnoreError(t);if(!c)throw qt(p("fileMoveCopyErrorNotFound","File to move/copy does not exist"),"EntryNotFound");let d=await this.statIgnoreError(e);if(d){if(!i)throw qt(p("fileMoveCopyErrorExists","File at target already exists and thus will not be moved/copied to unless overwrite is specified"),"EntryExists");c.type&1&&d.type&1||await this.delete(e,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(t,e){return this.doCloneFile(t,e,!1)}async doCloneFile(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e),s=!!(this.capabilities&1024);if(Li(i,o,!s))return;let a=new re;try{a.add(await this.createResourceLock(t)),a.add(await this.createResourceLock(e)),r&&await ui.mkdir(Fe(o),{recursive:!0}),await ui.copyFile(i,o)}catch(l){if(l.code==="ENOENT"&&!r)return this.doCloneFile(t,e,!0);throw this.toFileSystemProviderError(l)}finally{a.dispose()}}createUniversalWatcher(t,e,r){return new zd(i=>t(i),i=>e(i),r)}createNonRecursiveWatcher(t,e,r){return new Jd(i=>t(i),i=>e(i),r)}toFileSystemProviderError(t){if(t instanceof Ao)return t;let e=t,r;switch(t.code){case"ENOENT":r="EntryNotFound";break;case"EISDIR":r="EntryIsADirectory";break;case"ENOTDIR":r="EntryNotADirectory";break;case"EEXIST":r="EntryExists";break;case"EPERM":case"EACCES":r="NoPermissions";break;case"ERR_UNC_HOST_NOT_ALLOWED":e=`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,r="Unknown";break;default:r="Unknown"}return qt(e,r)}async toFileSystemProviderWriteError(t,e){let r=this.toFileSystemProviderError(e);if(t&&r.code==="NoPermissions")try{let{stat:i}=await gt.stat(this.toFilePath(t));i.mode&128||(r=qt(e,"EntryWriteLocked"))}catch(i){this.logService.trace(i)}return r}};var wb=new class{transformIncoming(n){return n}transformOutgoing(n){return n}transformOutgoingURI(n){return n}transformOutgoingScheme(n){return n}};var Qd=class extends O{constructor(e,r){super();this.provider=e;this.logService=r}call(e,r,i){let o=this.getUriTransformer(e);switch(r){case"stat":return this.stat(o,i[0]);case"readdir":return this.readdir(o,i[0]);case"open":return this.open(o,i[0],i[1]);case"close":return this.close(i[0]);case"read":return this.read(i[0],i[1],i[2]);case"readFile":return this.readFile(o,i[0],i[1]);case"write":return this.write(i[0],i[1],i[2],i[3],i[4]);case"writeFile":return this.writeFile(o,i[0],i[1],i[2]);case"rename":return this.rename(o,i[0],i[1],i[2]);case"copy":return this.copy(o,i[0],i[1],i[2]);case"cloneFile":return this.cloneFile(o,i[0],i[1]);case"mkdir":return this.mkdir(o,i[0]);case"delete":return this.delete(o,i[0],i[1]);case"watch":return this.watch(o,i[0],i[1],i[2],i[3]);case"unwatch":return this.unwatch(i[0],i[1])}throw new Error(`IPC Command ${r} not found`)}listen(e,r,i){let o=this.getUriTransformer(e);switch(r){case"fileChange":return this.onFileChange(o,i[0]);case"readFileStream":return this.onReadFileStream(o,i[0],i[1])}throw new Error(`Unknown event ${r}`)}stat(e,r){let i=this.transformIncoming(e,r,!0);return this.provider.stat(i)}readdir(e,r){let i=this.transformIncoming(e,r);return this.provider.readdir(i)}async readFile(e,r,i){let o=this.transformIncoming(e,r,!0),s=await this.provider.readFile(o,i);return te.wrap(s)}onReadFileStream(e,r,i){let o=this.transformIncoming(e,r,!0),s=new mt,a=new S({onDidRemoveLastListener:()=>{s.cancel()}}),l=this.provider.readFileStream(o,i,s.token);return vp(l,{onData:c=>a.fire(te.wrap(c)),onError:c=>a.fire(c),onEnd:()=>{a.fire("end"),a.dispose(),s.dispose()}}),a.event}writeFile(e,r,i,o){let s=this.transformIncoming(e,r);return this.provider.writeFile(s,i.buffer,o)}open(e,r,i){let o=this.transformIncoming(e,r,!0);return this.provider.open(o,i)}close(e){return this.provider.close(e)}async read(e,r,i){let o=te.alloc(i),a=await this.provider.read(e,r,o.buffer,0,i);return[o,a]}write(e,r,i,o,s){return this.provider.write(e,r,i.buffer,o,s)}mkdir(e,r){let i=this.transformIncoming(e,r);return this.provider.mkdir(i)}delete(e,r,i){let o=this.transformIncoming(e,r);return this.provider.delete(o,i)}rename(e,r,i,o){let s=this.transformIncoming(e,r),a=this.transformIncoming(e,i);return this.provider.rename(s,a,o)}copy(e,r,i,o){let s=this.transformIncoming(e,r),a=this.transformIncoming(e,i);return this.provider.copy(s,a,o)}cloneFile(e,r,i){let o=this.transformIncoming(e,r),s=this.transformIncoming(e,i);return this.provider.cloneFile(o,s)}sessionToWatcher=new Map;watchRequests=new Map;onFileChange(e,r){let i=new S({onWillAddFirstListener:()=>{this.sessionToWatcher.set(r,this.createSessionFileWatcher(e,i))},onDidRemoveLastListener:()=>{ft(this.sessionToWatcher.get(r)),this.sessionToWatcher.delete(r)}});return i.event}async watch(e,r,i,o,s){let a=this.sessionToWatcher.get(r);if(a){let l=this.transformIncoming(e,o),c=a.watch(i,l,s);this.watchRequests.set(r+i,c)}}async unwatch(e,r){let i=e+r,o=this.watchRequests.get(i);o&&(ft(o),this.watchRequests.delete(i))}dispose(){super.dispose();for(let[,e]of this.watchRequests)e.dispose();this.watchRequests.clear();for(let[,e]of this.sessionToWatcher)e.dispose();this.sessionToWatcher.clear()}},Yd=class extends O{constructor(e,r,i,o){super();this.uriTransformer=e;this.logService=i;this.environmentService=o;this.registerListeners(r)}watcherRequests=new Map;fileWatcher=this._register(new ps(this.logService,{watcher:{recursive:this.getRecursiveWatcherOptions(this.environmentService)}}));registerListeners(e){let r=this._register(new S);this._register(r.event(i=>{e.fire(i.map(o=>({resource:this.uriTransformer.transformOutgoingURI(o.resource),type:o.type,cId:o.cId})))})),this._register(this.fileWatcher.onDidChangeFile(i=>r.fire(i))),this._register(this.fileWatcher.onDidWatchError(i=>e.fire(i)))}getRecursiveWatcherOptions(e){}getExtraExcludes(e){}watch(e,r,i){let o=this.getExtraExcludes(this.environmentService);return Array.isArray(o)&&(i.excludes=[...i.excludes,...o]),this.watcherRequests.set(e,this.fileWatcher.watch(r,i)),Z(()=>{ft(this.watcherRequests.get(e)),this.watcherRequests.delete(e)})}dispose(){for(let[,e]of this.watcherRequests)e.dispose();this.watcherRequests.clear(),super.dispose()}};var Xd=class extends Qd{constructor(e,r,i){super(e,r);this.environmentService=i}getUriTransformer(e){return wb}transformIncoming(e,r){return x.revive(r)}async delete(e,r,i){if(!i.useTrash)return super.delete(e,r,i);let o=this.transformIncoming(e,r),s=ct(o.fsPath);try{await k0.trashItem(s)}catch(a){throw qt(N?p("binFailed","Failed to move '{0}' to the recycle bin ({1})",ve(s),Xt(a)):p("trashFailed","Failed to move '{0}' to the trash ({1})",ve(s),Xt(a)),"Unknown")}}createSessionFileWatcher(e,r){return new im(e,r,this.logService,this.environmentService)}},im=class extends Yd{watch(t,e,r){if(r.recursive)throw qt("Recursive file watching is not supported from main process for performance reasons.","Unavailable");return super.watch(t,e,r)}};var om=R("issueService"),sm=R("processService");import{BrowserWindow as Fb,screen as pl}from"electron";import{arch as Y0,release as X0,type as Z0}from"os";import*as Zd from"fs";import{exec as Mb}from"child_process";import{app as cl,clipboard as Ji,Menu as dl,powerMonitor as N0,screen as ul,shell as Qi,webContents as B0}from"electron";import{arch as V0,cpus as K0,freemem as H0,loadavg as z0,platform as q0,release as $0,totalmem as j0,type as G0}from"os";import{promisify as Wb}from"util";import{networkInterfaces as R0}from"os";import{networkInterfaces as C0}from"os";var _0=new Set(["00:00:00:00:00:00","ff:ff:ff:ff:ff:ff","ac:de:48:00:11:22"]);function D0(n){let t=n.replace(/\-/g,":").toLowerCase();return!_0.has(t)}function xb(){let n=C0();for(let t in n){let e=n[t];if(e){for(let{mac:r}of e)if(D0(r))return r}}throw new Error("Unable to retrieve mac address (unexpected format)")}var Sb=new class{_virtualMachineOUIs;_value;_isVirtualMachineMacAddress(n){return this._virtualMachineOUIs||(this._virtualMachineOUIs=Co.forStrings(),this._virtualMachineOUIs.set("00-50-56",!0),this._virtualMachineOUIs.set("00-0C-29",!0),this._virtualMachineOUIs.set("00-05-69",!0),this._virtualMachineOUIs.set("00-03-FF",!0),this._virtualMachineOUIs.set("00-1C-42",!0),this._virtualMachineOUIs.set("00-16-3E",!0),this._virtualMachineOUIs.set("08-00-27",!0),this._virtualMachineOUIs.set("00:50:56",!0),this._virtualMachineOUIs.set("00:0C:29",!0),this._virtualMachineOUIs.set("00:05:69",!0),this._virtualMachineOUIs.set("00:03:FF",!0),this._virtualMachineOUIs.set("00:1C:42",!0),this._virtualMachineOUIs.set("00:16:3E",!0),this._virtualMachineOUIs.set("08:00:27",!0)),!!this._virtualMachineOUIs.findSubstr(n)}value(){if(this._value===void 0){let n=0,t=0,e=R0();for(let r in e){let i=e[r];if(i)for(let{mac:o,internal:s}of i)s||(t+=1,this._isVirtualMachineMacAddress(o.toUpperCase())&&(n+=1))}this._value=t>0?n/t:0}return this._value}},am;async function Eb(n){return am||(am=(async()=>await L0(n)||yt())()),am}async function L0(n){try{let t=await import("crypto"),e=xb();return t.createHash("sha256").update(e,"utf8").digest("hex")}catch(t){n(t);return}}var O0="Software\\Microsoft\\SQMClient";async function Pb(n){if(N){let t=await import("@vscode/windows-registry");try{return t.GetStringRegKey("HKEY_LOCAL_MACHINE",O0,"MachineId")||""}catch(e){return n(e),""}}return""}async function Tb(n){try{return await(await import("@vscode/deviceid")).getDeviceId()}catch(t){return n(t),""}}import*as cm from"net";function Cb(n,t,e,r=1){let i=!1;return new Promise(o=>{let s=setTimeout(()=>{if(!i)return i=!0,o(0)},e);lm(n,t,r,a=>{if(!i)return i=!0,clearTimeout(s),o(a)})})}function lm(n,t,e,r){if(t===0)return r(0);let i=new cm.Socket;i.once("connect",()=>(kb(i),lm(n+e,t-1,e,r))),i.once("data",()=>{}),i.once("error",o=>(kb(i),o.code!=="ECONNREFUSED"?lm(n+e,t-1,e,r):r(n))),i.connect(n,"127.0.0.1")}function kb(n){try{n.removeAllListeners("connect"),n.removeAllListeners("error"),n.end(),n.destroy(),n.unref()}catch(t){console.error(t)}}var roe=R("IV8InspectProfilingService"),A0;(e=>{function n(r){return!!(r.samples&&r.timeDeltas)}e.isValidProfile=n;function t(r,i="noAbsolutePaths"){for(let o of r.nodes)o.callFrame&&o.callFrame.url&&(fr(o.callFrame.url)||/^\w[\w\d+.-]*:\/\/\/?/.test(o.callFrame.url))&&(o.callFrame.url=F(i,ve(o.callFrame.url)));return r}e.rewriteAbsolutePaths=t})(A0||={});var Roe=R("nativeHostService");import*as _b from"fs";import*as Db from"os";import*as Rb from"child_process";import*as Lb from"path";var dm;async function Ob(n=!1){return(dm===void 0||n)&&(dm=M0()),dm}async function M0(){let n=W0();if(n===void 0)return!1;if(n>=22e3){let t=F0();if(t)return new Promise(e=>{try{Rb.execFile(t,["--status"],r=>e(!r))}catch{e(!1)}})}else{let t=U0();if(t)try{if((await _b.promises.stat(t)).isFile())return!0}catch{}}return!1}function W0(){let n=/(\d+)\.(\d+)\.(\d+)/g.exec(Db.release());if(n)return parseInt(n[3])}function Ab(n){let t=process.env.SystemRoot;if(t){let e=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432");return Lb.join(t,e?"Sysnative":"System32",n)}}function F0(){return Ab("wsl.exe")}function U0(){return Ab("lxss\\LxssManager.dll")}import"electron";var fs=class{constructor(t,e,r){this._window=t;this._sessionId=e;this._logService=r}async inspect(t){await this._connect();let e=this._window.webContents.debugger;await e.sendCommand("Profiler.start"),this._logService.warn("[perf] profiling STARTED",this._sessionId),await $e(t);let r=await e.sendCommand("Profiler.stop");return this._logService.warn("[perf] profiling DONE",this._sessionId),await this._disconnect(),r.profile}async _connect(){let t=this._window.webContents.debugger;t.attach(),await t.sendCommand("Profiler.enable")}async _disconnect(){let t=this._window.webContents.debugger;await t.sendCommand("Profiler.disable"),t.detach()}};fs=P([h(2,B)],fs);import"electron";var Pn=R("auxiliaryWindowsMainService");var sr=R("nativeHostMainService"),Yi=class extends O{constructor(e,r,i,o,s,a,l,c,d,f,m,g){super();this.windowsMainService=e;this.auxiliaryWindowsMainService=r;this.dialogMainService=i;this.lifecycleMainService=o;this.environmentMainService=s;this.logService=a;this.productService=l;this.themeMainService=c;this.workspacesManagementMainService=d;this.configurationService=f;this.requestService=m;this.proxyAuthService=g}get windowId(){throw new Error("Not implemented in electron-main")}onDidOpenMainWindow=E.map(this.windowsMainService.onDidOpenWindow,e=>e.id);onDidTriggerWindowSystemContextMenu=E.any(E.map(this.windowsMainService.onDidTriggerSystemContextMenu,({window:e,x:r,y:i})=>({windowId:e.id,x:r,y:i})),E.map(this.auxiliaryWindowsMainService.onDidTriggerSystemContextMenu,({window:e,x:r,y:i})=>({windowId:e.id,x:r,y:i})));onDidMaximizeWindow=E.any(E.map(this.windowsMainService.onDidMaximizeWindow,e=>e.id),E.map(this.auxiliaryWindowsMainService.onDidMaximizeWindow,e=>e.id));onDidUnmaximizeWindow=E.any(E.map(this.windowsMainService.onDidUnmaximizeWindow,e=>e.id),E.map(this.auxiliaryWindowsMainService.onDidUnmaximizeWindow,e=>e.id));onDidChangeWindowFullScreen=E.any(E.map(this.windowsMainService.onDidChangeFullScreen,e=>({windowId:e.window.id,fullscreen:e.fullscreen})),E.map(this.auxiliaryWindowsMainService.onDidChangeFullScreen,e=>({windowId:e.window.id,fullscreen:e.fullscreen})));onDidBlurMainWindow=E.filter(E.fromNodeEventEmitter(cl,"browser-window-blur",(e,r)=>r.id),e=>!!this.windowsMainService.getWindowById(e));onDidFocusMainWindow=E.any(E.map(E.filter(E.map(this.windowsMainService.onDidChangeWindowsCount,()=>this.windowsMainService.getLastActiveWindow()),e=>!!e),e=>e.id),E.filter(E.fromNodeEventEmitter(cl,"browser-window-focus",(e,r)=>r.id),e=>!!this.windowsMainService.getWindowById(e)));onDidBlurMainOrAuxiliaryWindow=E.any(this.onDidBlurMainWindow,E.map(E.filter(E.fromNodeEventEmitter(cl,"browser-window-blur",(e,r)=>this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents)),e=>!!e),e=>e.id));onDidFocusMainOrAuxiliaryWindow=E.any(this.onDidFocusMainWindow,E.map(E.filter(E.fromNodeEventEmitter(cl,"browser-window-focus",(e,r)=>this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents)),e=>!!e),e=>e.id));onDidResumeOS=E.fromNodeEventEmitter(N0,"resume");onDidChangeColorScheme=this.themeMainService.onDidChangeColorScheme;_onDidChangePassword=this._register(new S);onDidChangePassword=this._onDidChangePassword.event;onDidChangeDisplay=E.debounce(E.any(E.filter(E.fromNodeEventEmitter(ul,"display-metrics-changed",(e,r,i)=>i),e=>!(Array.isArray(e)&&e.length===1&&e[0]==="workArea")),E.fromNodeEventEmitter(ul,"display-added"),E.fromNodeEventEmitter(ul,"display-removed")),()=>{},100);async getWindows(e,r){let i=this.windowsMainService.getWindows().map(s=>({id:s.id,workspace:s.openedWorkspace??$n(s.backupPath,s.isExtensionDevelopmentHost),title:s.win?.getTitle()??"",filename:s.getRepresentedFilename(),dirty:s.isDocumentEdited()})),o=[];return r.includeAuxiliaryWindows&&o.push(...this.auxiliaryWindowsMainService.getWindows().map(s=>({id:s.id,parentId:s.parentId,title:s.win?.getTitle()??"",filename:s.getRepresentedFilename()}))),[...i,...o]}async getWindowCount(e){return this.windowsMainService.getWindowCount()}async getActiveWindowId(e){let r=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(r)return r.id}async getActiveWindowPosition(){let e=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(e)return e.getBounds()}openWindow(e,r,i){return Array.isArray(r)?this.doOpenWindow(e,r,i):this.doOpenEmptyWindow(e,r)}async doOpenWindow(e,r,i=Object.create(null)){r.length>0&&await this.windowsMainService.open({context:5,contextWindowId:e,urisToOpen:r,cli:this.environmentMainService.args,forceNewWindow:i.forceNewWindow,forceReuseWindow:i.forceReuseWindow,preferNewWindow:i.preferNewWindow,diffMode:i.diffMode,mergeMode:i.mergeMode,addMode:i.addMode,gotoLineMode:i.gotoLineMode,noRecentEntry:i.noRecentEntry,waitMarkerFileURI:i.waitMarkerFileURI,remoteAuthority:i.remoteAuthority||void 0,forceProfile:i.forceProfile,forceTempProfile:i.forceTempProfile})}async doOpenEmptyWindow(e,r){await this.windowsMainService.openEmptyWindow({context:5,contextWindowId:e},r)}async isFullScreen(e,r){return this.windowById(r?.targetWindowId,e)?.isFullScreen??!1}async toggleFullScreen(e,r){this.windowById(r?.targetWindowId,e)?.toggleFullScreen()}async handleTitleDoubleClick(e,r){this.windowById(r?.targetWindowId,e)?.handleTitleDoubleClick()}async getCursorScreenPoint(e){let r=ul.getCursorScreenPoint(),i=ul.getDisplayNearestPoint(r);return{point:r,display:i.bounds}}async isMaximized(e,r){return this.windowById(r?.targetWindowId,e)?.win?.isMaximized()??!1}async maximizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.maximize()}async unmaximizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.unmaximize()}async minimizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.minimize()}async moveWindowTop(e,r){this.windowById(r?.targetWindowId,e)?.win?.moveTop()}async positionWindow(e,r,i){let o=this.windowById(i?.targetWindowId,e);if(o?.win){if(o.win.isFullScreen()){let s=E.toPromise(E.once(E.fromNodeEventEmitter(o.win,"leave-full-screen")));o.win.setFullScreen(!1),await s}o.win.setBounds(r)}}async updateWindowControls(e,r){this.windowById(r?.targetWindowId,e)?.updateWindowControls(r)}async focusWindow(e,r){this.windowById(r?.targetWindowId,e)?.focus({force:r?.force??!1})}async setMinimumSize(e,r,i){let o=this.codeWindowById(e);if(o?.win){let[s,a]=o.win.getSize(),[l,c]=o.win.getMinimumSize(),[d,f]=[r??l,i??c],[m,g]=[Math.max(s,d),Math.max(a,f)];(l!==d||c!==f)&&o.win.setMinimumSize(d,f),(s!==m||a!==g)&&o.win.setSize(m,g)}}async saveWindowSplash(e,r){this.themeMainService.saveWindowSplash(e,r)}async installShellCommand(e){let{source:r,target:i}=await this.getShellCommandLink();try{let{symbolicLink:o}=await gt.stat(r);if(o&&!o.dangling){let s=await Ib(r);if(i===s)return}await Zd.promises.unlink(r)}catch(o){if(o.code!=="ENOENT")throw o}try{await Zd.promises.symlink(i,r)}catch(o){if(o.code!=="EACCES"&&o.code!=="ENOENT")throw o;let{response:s}=await this.showMessageBox(e,{type:"info",message:p("warnEscalation","{0} will now prompt with 'osascript' for Administrator privileges to install the shell command.",this.productService.nameShort),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]});if(s===1)throw new rt;try{let a=`osascript -e "do shell script \\"mkdir -p /usr/local/bin && ln -sf '${i}' '${r}'\\" with administrator privileges"`;await Wb(Mb)(a)}catch{throw new Error(p("cantCreateBinFolder","Unable to install the shell command '{0}'.",r))}}}async uninstallShellCommand(e){let{source:r}=await this.getShellCommandLink();try{await Zd.promises.unlink(r)}catch(i){switch(i.code){case"EACCES":{let{response:o}=await this.showMessageBox(e,{type:"info",message:p("warnEscalationUninstall","{0} will now prompt with 'osascript' for Administrator privileges to uninstall the shell command.",this.productService.nameShort),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]});if(o===1)throw new rt;try{let s=`osascript -e "do shell script \\"rm '${r}'\\" with administrator privileges"`;await Wb(Mb)(s)}catch{throw new Error(p("cantUninstall","Unable to uninstall the shell command '{0}'.",r))}break}case"ENOENT":break;default:throw i}}}async getShellCommandLink(){let e=Fn(this.environmentMainService.appRoot,"bin","code"),r=`/usr/local/bin/${this.productService.applicationName}`;if(!await $.exists(e))throw new Error(p("sourceMissing","Unable to find shell script in '{0}'",e));return{source:r,target:e}}async showMessageBox(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showMessageBox(r,i?.win??void 0)}async showSaveDialog(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showSaveDialog(r,i?.win??void 0)}async showOpenDialog(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showOpenDialog(r,i?.win??void 0)}async pickFileFolderAndOpen(e,r){let i=await this.dialogMainService.pickFileFolder(r);i&&await this.doOpenPicked(await Promise.all(i.map(async o=>await gt.existsDirectory(o)?{folderUri:x.file(o)}:{fileUri:x.file(o)})),r,e)}async pickFolderAndOpen(e,r){let i=await this.dialogMainService.pickFolder(r);i&&await this.doOpenPicked(i.map(o=>({folderUri:x.file(o)})),r,e)}async pickFileAndOpen(e,r){let i=await this.dialogMainService.pickFile(r);i&&await this.doOpenPicked(i.map(o=>({fileUri:x.file(o)})),r,e)}async pickWorkspaceAndOpen(e,r){let i=await this.dialogMainService.pickWorkspace(r);i&&await this.doOpenPicked(i.map(o=>({workspaceUri:x.file(o)})),r,e)}async doOpenPicked(e,r,i){await this.windowsMainService.open({context:3,contextWindowId:i,cli:this.environmentMainService.args,urisToOpen:e,forceNewWindow:r.forceNewWindow})}async showItemInFolder(e,r){Qi.showItemInFolder(r)}async setRepresentedFilename(e,r,i){this.windowById(i?.targetWindowId,e)?.setRepresentedFilename(r)}async setDocumentEdited(e,r,i){this.windowById(i?.targetWindowId,e)?.setDocumentEdited(r)}async openExternal(e,r,i){this.environmentMainService.unsetSnapExportedVariables();try{eg(r,U.http,U.https)?this.openExternalBrowser(r,i):Qi.openExternal(r)}finally{this.environmentMainService.restoreSnapExportedVariables()}return!0}async openExternalBrowser(e,r){let i=r??this.configurationService.getValue("workbench.externalBrowser");if(!i)return Qi.openExternal(e);if((i.includes(Q.sep)||i.includes(Ne.sep))&&!await $.exists(i))return this.logService.error(`Configured external browser path does not exist: ${i}`),Qi.openExternal(e);try{let{default:o}=await import("open");(await o(e,{app:{name:Object.hasOwn(o.apps,i)?o.apps[i]:i}})).stderr?.once("data",a=>(this.logService.error(`Error openening external URL '${e}' using browser '${i}': ${a.toString()}`),Qi.openExternal(e)))}catch(o){return this.logService.error(`Unable to open external URL '${e}' using browser '${i}' due to ${o}.`),Qi.openExternal(e)}}moveItemToTrash(e,r){return Qi.trashItem(r)}async isAdmin(){let e;return N?e=(await import("native-is-elevated")).default():e=process.getuid?.()===0,e}async writeElevated(e,r,i,o){let s=await import("@vscode/sudo-prompt");return new Promise((a,l)=>{let c=[`"${this.cliPath}"`];o?.unlock&&c.push("--file-chmod"),c.push("--file-write",`"${r.fsPath}"`,`"${i.fsPath}"`);let d={name:this.productService.nameLong.replace("-",""),icns:A&&this.environmentMainService.isBuilt?F(Fe(this.environmentMainService.appRoot),`${this.productService.nameShort}.icns`):void 0};s.exec(c.join(" "),d,(f,m,g)=>{m&&this.logService.trace(`[sudo-prompt] received stdout: ${m}`),g&&this.logService.trace(`[sudo-prompt] received stderr: ${g}`),f?l(f):a(void 0)})})}async isRunningUnderARM64Translation(){return j||N?!1:cl.runningUnderARM64Translation}get cliPath(){return N?this.environmentMainService.isBuilt?F(Fe(process.execPath),"bin",`${this.productService.applicationName}.cmd`):F(this.environmentMainService.appRoot,"scripts","code-cli.bat"):j?this.environmentMainService.isBuilt?F(Fe(process.execPath),"bin",`${this.productService.applicationName}`):F(this.environmentMainService.appRoot,"scripts","code-cli.sh"):this.environmentMainService.isBuilt?F(this.environmentMainService.appRoot,"bin","code"):F(this.environmentMainService.appRoot,"scripts","code-cli.sh")}async getOSStatistics(){return{totalmem:j0(),freemem:H0(),loadavg:z0()}}async getOSProperties(){return{arch:V0(),platform:q0(),release:$0(),type:G0(),cpus:K0()}}async getOSVirtualMachineHint(){return Sb.value()}async getOSColorScheme(){return this.themeMainService.getColorScheme()}async hasWSLFeatureInstalled(){return N&&Ob()}async getProcessId(e){return this.windowById(void 0,e)?.win?.webContents.getOSProcessId()}async killProcess(e,r,i){process.kill(r,i)}async readClipboardText(e,r){return Ji.readText(r)}async writeClipboardText(e,r,i){return Ji.writeText(r,i)}async readClipboardFindText(e){return Ji.readFindText()}async writeClipboardFindText(e,r){return Ji.writeFindText(r)}async writeClipboardBuffer(e,r,i,o){return Ji.writeBuffer(r,Buffer.from(i.buffer),o)}async readClipboardBuffer(e,r){return te.wrap(Ji.readBuffer(r))}async hasClipboard(e,r,i){return Ji.has(r,i)}async newWindowTab(){await this.windowsMainService.open({context:5,cli:this.environmentMainService.args,forceNewTabbedWindow:!0,forceEmpty:!0,remoteAuthority:this.environmentMainService.args.remote||void 0})}async showPreviousWindowTab(){dl.sendActionToFirstResponder("selectPreviousTab:")}async showNextWindowTab(){dl.sendActionToFirstResponder("selectNextTab:")}async moveWindowTabToNewWindow(){dl.sendActionToFirstResponder("moveTabToNewWindow:")}async mergeAllWindowTabs(){dl.sendActionToFirstResponder("mergeAllWindows:")}async toggleWindowTabsBar(){dl.sendActionToFirstResponder("toggleTabBar:")}async updateTouchBar(e,r){this.codeWindowById(e)?.updateTouchBar(r)}async notifyReady(e){this.codeWindowById(e)?.setReady()}async relaunch(e,r){return this.lifecycleMainService.relaunch(r)}async reload(e,r){let i=this.codeWindowById(e);if(i){if(Ue(i.openedWorkspace)){let o=i.openedWorkspace.configPath;if(o.scheme===U.file&&(await this.workspacesManagementMainService.resolveLocalWorkspace(o))?.transient)return this.openWindow(i.id,{forceReuseWindow:!0})}return this.lifecycleMainService.reload(i,r?.disableExtensions!==void 0?{_:[],"disable-extensions":r.disableExtensions}:void 0)}}async closeWindow(e,r){return this.windowById(r?.targetWindowId,e)?.win?.close()}async quit(e){let r=this.windowsMainService.getLastActiveWindow();r?.isExtensionDevelopmentHost&&this.windowsMainService.getWindowCount()>1&&r.win?r.win.close():this.lifecycleMainService.quit()}async exit(e,r){await this.lifecycleMainService.kill(r)}async resolveProxy(e,r){if(this.environmentMainService.extensionTestsLocationURI){let s=this.configurationService.getValue("integration-test.http.proxy");if(s)return s}return this.codeWindowById(e)?.win?.webContents?.session?.resolveProxy(r)}async lookupAuthorization(e,r){return this.proxyAuthService.lookupAuthorization(r)}async lookupKerberosAuthorization(e,r){return this.requestService.lookupKerberosAuthorization(r)}async loadCertificates(e){return this.requestService.loadCertificates()}findFreePort(e,r,i,o,s=1){return Cb(r,i,o,s)}async openDevTools(e,r){let i=this.windowById(r?.targetWindowId,e),o;j&&Zn(this.configurationService)&&(o="bottom"),i?.win?.webContents.openDevTools(o?{mode:o}:void 0)}async toggleDevTools(e,r){let o=this.windowById(r?.targetWindowId,e)?.win?.webContents;o&&(j&&Zn(this.configurationService)&&!o.isDevToolsOpened()?o.openDevTools({mode:"bottom"}):o.toggleDevTools())}async profileRenderer(e,r,i){let o=this.codeWindowById(e);if(!o||!o.win)throw new Error;return await new fs(o.win,r,this.logService).inspect(i)}async windowsGetStringRegKey(e,r,i,o){if(!N)return;let s=await import("@vscode/windows-registry");try{return s.GetStringRegKey(r,i,o)}catch{return}}windowById(e,r){return this.codeWindowById(e)??this.auxiliaryWindowById(e)??this.codeWindowById(r)}codeWindowById(e){if(typeof e=="number")return this.windowsMainService.getWindowById(e)}auxiliaryWindowById(e){if(typeof e!="number")return;let r=B0.fromId(e);if(r)return this.auxiliaryWindowsMainService.getWindowByWebContents(r)}};P([ie],Yi.prototype,"cliPath",1),Yi=P([h(0,Te),h(1,Pn),h(2,Mt),h(3,le),h(4,ge),h(5,B),h(6,Oe),h(7,ri),h(8,or),h(9,Ie),h(10,xr),h(11,tl)],Yi);var ar,um=globalThis.vscode;if(typeof um<"u"&&typeof um.context<"u"){let n=um.context.configuration();if(n)ar=n.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(ar=globalThis._VSCODE_PRODUCT_JSON,xt.VSCODE_DEV&&Object.assign(ar,{nameShort:`${ar.nameShort} Dev`,nameLong:`${ar.nameLong} Dev`,dataFolderName:`${ar.dataFolderName}-dev`,serverDataFolderName:ar.serverDataFolderName?`${ar.serverDataFolderName}-dev`:void 0}),!ar.version){let n=globalThis._VSCODE_PACKAGE_JSON;Object.assign(ar,{version:n.version})}}else ar={},Object.keys(ar).length===0&&Object.assign(ar,{version:"1.94.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var lr=ar;import{spawn as J0}from"child_process";import{relative as Q0}from"path";var pi=R("ICSSDevelopmentService"),ms=class{constructor(t,e){this.envService=t;this.logService=e}_cssModules;get isEnabled(){return!this.envService.isBuilt&&!0}getCssModules(){return this._cssModules??=this.computeCssModules(),this._cssModules}async computeCssModules(){if(!this.isEnabled)return[];let t=await import("@vscode/ripgrep");return await new Promise(e=>{let r=$r.create(),i=[],o=new TextDecoder,s=Me.asFileUri("").fsPath,a=J0(t.rgPath,["-g","**/*.css","--files","--no-ignore",s],{});a.stdout.on("data",l=>{let c=o.decode(l,{stream:!0});i.push(c.split(`
`).filter(Boolean))}),a.on("error",l=>{this.logService.error("[CSS_DEV] FAILED to compute CSS data",l),e([])}),a.on("close",()=>{let l=i.flat().map(c=>Q0(s,c).replace(/\\/g,"/")).filter(Boolean).sort();e(l),this.logService.info(`[CSS_DEV] DONE, ${l.length} css modules (${Math.round(r.elapsed())}ms)`)})})}};ms=P([h(0,zt),h(1,B)],ms);var fi=class{constructor(t,e,r,i,o,s,a,l){this.userEnv=t;this.environmentMainService=e;this.logService=r;this.dialogMainService=i;this.nativeHostMainService=o;this.protocolMainService=s;this.windowsMainService=a;this.cssDevelopmentService=l}static DEFAULT_BACKGROUND_COLOR="#1E1E1E";issueReporterWindow=null;issueReporterParentWindow=null;async openReporter(t){if(this.issueReporterWindow)this.issueReporterWindow&&this.focusWindow(this.issueReporterWindow);else if(this.issueReporterParentWindow=Fb.getFocusedWindow(),this.issueReporterParentWindow){let e=new re,r=e.add(this.protocolMainService.createIPCObjectUrl()),i=this.getWindowPosition(this.issueReporterParentWindow,700,800);this.issueReporterWindow=this.createBrowserWindow(i,r,{backgroundColor:t.styles.backgroundColor,title:p("issueReporter","Issue Reporter"),zoomLevel:t.zoomLevel,alwaysOnTop:!1},"issue-reporter"),r.update({appRoot:this.environmentMainService.appRoot,windowId:this.issueReporterWindow.id,userEnv:this.userEnv,data:t,disableExtensions:!!this.environmentMainService.disableExtensions,os:{type:Z0(),arch:Y0(),release:X0()},product:lr,nls:{messages:ln(),language:Tr()},cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0}),this.issueReporterWindow.loadURL(Me.asBrowserUri(`vs/workbench/contrib/issue/electron-sandbox/issueReporter${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0)),this.issueReporterWindow.on("close",()=>{this.issueReporterWindow=null,e.dispose()}),this.issueReporterParentWindow.on("closed",()=>{this.issueReporterWindow&&(this.issueReporterWindow.close(),this.issueReporterWindow=null,e.dispose())})}}async $reloadWithExtensionsDisabled(){if(this.issueReporterParentWindow)try{await this.nativeHostMainService.reload(this.issueReporterParentWindow.id,{disableExtensions:!0})}catch(t){this.logService.error(t)}}async $showConfirmCloseDialog(){if(this.issueReporterWindow){let{response:t}=await this.dialogMainService.showMessageBox({type:"warning",message:p("confirmCloseIssueReporter","Your input will not be saved. Are you sure you want to close this window?"),buttons:[p({key:"yes",comment:["&& denotes a mnemonic"]},"&&Yes"),p("cancel","Cancel")]},this.issueReporterWindow);t===0&&this.issueReporterWindow&&(this.issueReporterWindow.destroy(),this.issueReporterWindow=null)}}async $showClipboardDialog(){if(this.issueReporterWindow){let{response:t}=await this.dialogMainService.showMessageBox({type:"warning",message:p("issueReporterWriteToClipboard","There is too much data to send to GitHub directly. The data will be copied to the clipboard, please paste it into the GitHub issue page that is opened."),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]},this.issueReporterWindow);return t===0}return!1}issueReporterWindowCheck(){if(!this.issueReporterParentWindow)throw new Error("Issue reporter window not available");let t=this.windowsMainService.getWindowById(this.issueReporterParentWindow.id);if(!t)throw new Error("Window not found");return t}async $sendReporterMenu(t,e){let r=this.issueReporterWindowCheck(),i="vscode:triggerReporterMenu",o=new mt;return r.sendWhenReady(i,o.token,{replyChannel:i,extensionId:t,extensionName:e}),await Tg(new Promise(a=>ke.once(`vscode:triggerReporterMenuResponse:${t}`,(l,c)=>a(c))),5e3,()=>{this.logService.error(`Error: Extension ${t} timed out waiting for menu response`),o.cancel()})}async $closeReporter(){this.issueReporterWindow?.close()}focusWindow(t){t.isMinimized()&&t.restore(),t.focus()}createBrowserWindow(t,e,r,i){let o=new Fb({fullscreen:!1,skipTaskbar:!1,resizable:!0,width:t.width,height:t.height,minWidth:300,minHeight:200,x:t.x,y:t.y,title:r.title,backgroundColor:r.backgroundColor||fi.DEFAULT_BACKGROUND_COLOR,webPreferences:{preload:Me.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${e.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none",enableWebSQL:!1,spellcheck:!1,zoomFactor:qo(r.zoomLevel),sandbox:!0},alwaysOnTop:r.alwaysOnTop,experimentalDarkMode:!0});return o.setMenuBarVisibility(!1),o}getWindowPosition(t,e,r){let i,o=pl.getAllDisplays();if(o.length===1)i=o[0];else{if(A){let l=pl.getCursorScreenPoint();i=pl.getDisplayNearestPoint(l)}!i&&t&&(i=pl.getDisplayMatching(t.getBounds())),i||(i=pl.getPrimaryDisplay()||o[0])}let s=i.bounds,a={width:e,height:r,x:s.x+s.width/2-e/2,y:s.y+s.height/2-r/2};return s.width>0&&s.height>0&&(a.x<s.x&&(a.x=s.x),a.y<s.y&&(a.y=s.y),a.x>s.x+s.width&&(a.x=s.x),a.y>s.y+s.height&&(a.y=s.y),a.width>s.width&&(a.width=s.width),a.height>s.height&&(a.height=s.height)),a}};fi=P([h(1,ge),h(2,B),h(3,Mt),h(4,sr),h(5,ti),h(6,Te),h(7,pi)],fi);import{BrowserWindow as pm,contentTracing as eE,screen as fl}from"electron";import{exec as eu}from"child_process";function Nb(n){return new Promise((t,e)=>{let r,i=new Map;function o(l,c,d,f,m){let g=i.get(c);if(l===n||g){let b={name:s(d),cmd:d,pid:l,ppid:c,load:f,mem:m};i.set(l,b),l===n&&(r=b),g&&(g.children||(g.children=[]),g.children.push(b),g.children.length>1&&(g.children=g.children.sort((v,w)=>v.pid-w.pid)))}}function s(l){let c=/--utility-sub-type=network/i,d=/--crashes-directory/i,f=/\\pipe\\winpty-control/i,m=/conhost\.exe.+--headless/i,g=/--type=([a-zA-Z-]+)/;if(d.exec(l))return"electron-crash-reporter";if(f.exec(l))return"winpty-agent";if(m.exec(l))return"conpty-agent";let b=g.exec(l);if(b&&b.length===2)return b[1]==="renderer"?"window":b[1]==="utility"?c.exec(l)?"utility-network-service":"utility-process":b[1]==="extensionHost"?"extension-host":b[1];let v=/[a-zA-Z-]+\.js/g,w="";do b=v.exec(l),b&&(w+=b+" ");while(b);return w&&l.indexOf("node ")<0&&l.indexOf("node.exe")<0?`electron-nodejs (${w})`:l}if(process.platform==="win32"){let l=c=>c.indexOf("\\\\?\\")===0||c.indexOf("\\??\\")===0?c.substring(4):c.indexOf('"\\\\?\\')===0||c.indexOf('"\\??\\')===0?'"'+c.substring(5):c;import("@vscode/windows-process-tree").then(c=>{c.getProcessList(n,d=>{if(!d){e(new Error(`Root process ${n} not found`));return}c.getProcessCpuUsage(d,f=>{let m=new Map;f.forEach(g=>{let b=l(g.commandLine||"");m.set(g.pid,{name:s(b),cmd:b,pid:g.pid,ppid:g.ppid,load:g.cpu||0,mem:g.memory||0})}),r=m.get(n),r?(m.forEach(g=>{let b=m.get(g.ppid);b&&(b.children||(b.children=[]),b.children.push(g))}),m.forEach(g=>{g.children&&(g.children=g.children.sort((b,v)=>b.pid-v.pid))}),t(r)):e(new Error(`Root process ${n} not found`))})},c.ProcessDataFlag.CommandLine|c.ProcessDataFlag.Memory)})}else{let l=function(){let c=[r],d=[];for(;c.length;){let m=c.shift();m&&(d.push(m.pid),m.children&&(c=c.concat(m.children)))}let f=JSON.stringify(Me.asFileUri("vs/base/node/cpuUsage.sh").fsPath);f+=" "+d.join(" "),eu(f,{},(m,g,b)=>{if(m||b)e(m||new Error(b.toString()));else{let v=g.toString().split(`
`);for(let w=0;w<d.length;w++){let k=i.get(d[w]);k.load=parseFloat(v[w])}if(!r){e(new Error(`Root process ${n} not found`));return}t(r)}})};var a=l;eu("which ps",{},(c,d,f)=>{if(c||f)if(process.platform!=="linux")e(c||new Error(f.toString()));else{let m=JSON.stringify(Me.asFileUri("vs/base/node/ps.sh").fsPath);eu(m,{},(g,b,v)=>{g||v?e(g||new Error(v.toString())):(Ub(b,o),l())})}else{let m=d.toString().trim();eu(`${m} -ax -o pid=,ppid=,pcpu=,pmem=,command=`,{maxBuffer:1e3*1024,env:{LC_NUMERIC:"en_US.UTF-8"}},(b,v,w)=>{b||w&&!w.includes("screen size is bogus")?e(b||new Error(w.toString())):(Ub(v,o),process.platform==="linux"?l():r?t(r):e(new Error(`Root process ${n} not found`)))})}})}})}function Ub(n,t){let e=/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+\.[0-9]+)\s+([0-9]+\.[0-9]+)\s+(.+)$/,r=n.toString().split(`
`);for(let i of r){let o=e.exec(i.trim());o&&o.length===6&&t(parseInt(o[1]),parseInt(o[2]),o[5],parseFloat(o[3]),parseFloat(o[4]))}}var Bb="issue.processExplorerWindowState",mi=class{constructor(t,e,r,i,o,s,a,l,c,d,f){this.userEnv=t;this.environmentMainService=e;this.logService=r;this.diagnosticsService=i;this.diagnosticsMainService=o;this.dialogMainService=s;this.nativeHostMainService=a;this.protocolMainService=l;this.productService=c;this.stateService=d;this.cssDevelopmentService=f;this.registerListeners()}static DEFAULT_BACKGROUND_COLOR="#1E1E1E";processExplorerWindow=null;processExplorerParentWindow=null;registerListeners(){ke.on("vscode:listProcesses",async t=>{let e=[];try{e.push({name:p("local","Local"),rootProcess:await Nb(process.pid)}),(await this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!0})).forEach(i=>{eb(i)?e.push({name:i.hostName,rootProcess:i}):i.processes&&e.push({name:i.hostName,rootProcess:i.processes})})}catch(r){this.logService.error(`Listing processes failed: ${r}`)}this.safeSend(t,"vscode:listProcessesResponse",e)}),ke.on("vscode:workbenchCommand",(t,e)=>{let{id:r,from:i,args:o}=e,s;switch(i){case"processExplorer":s=this.processExplorerParentWindow;break;default:throw new Error(`Unexpected command source: ${i}`)}s?.webContents.send("vscode:runAction",{id:r,from:i,args:o})}),ke.on("vscode:closeProcessExplorer",t=>{this.processExplorerWindow?.close()}),ke.on("vscode:pidToNameRequest",async t=>{let e=await this.diagnosticsMainService.getMainDiagnostics(),r=[];for(let i of e.windows)r.push([i.pid,`window [${i.id}] (${i.title})`]);for(let{pid:i,name:o}of Ct.getAll())r.push([i,o]);this.safeSend(t,"vscode:pidToNameResponse",r)})}async openProcessExplorer(t){if(!this.processExplorerWindow&&(this.processExplorerParentWindow=pm.getFocusedWindow(),this.processExplorerParentWindow)){let e=new re,r=e.add(this.protocolMainService.createIPCObjectUrl()),i=this.stateService.getItem(Bb,void 0),o=tE(i)?i:this.getWindowPosition(this.processExplorerParentWindow,800,500);this.processExplorerWindow=this.createBrowserWindow(o,r,{backgroundColor:t.styles.backgroundColor,title:p("processExplorer","Process Explorer"),zoomLevel:t.zoomLevel,alwaysOnTop:!0},"process-explorer"),r.update({appRoot:this.environmentMainService.appRoot,windowId:this.processExplorerWindow.id,userEnv:this.userEnv,data:t,product:lr,nls:{messages:ln(),language:Tr()},cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0}),this.processExplorerWindow.loadURL(Me.asBrowserUri(`vs/code/electron-sandbox/processExplorer/processExplorer${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0)),this.processExplorerWindow.on("close",()=>{this.processExplorerWindow=null,e.dispose()}),this.processExplorerParentWindow.on("close",()=>{this.processExplorerWindow&&(this.processExplorerWindow.close(),this.processExplorerWindow=null,e.dispose())});let s=()=>{if(!this.processExplorerWindow)return;let a=this.processExplorerWindow.getSize(),l=this.processExplorerWindow.getPosition();if(!a||!l)return;let c={width:a[0],height:a[1],x:l[0],y:l[1]};this.stateService.setItem(Bb,c)};this.processExplorerWindow.on("moved",s),this.processExplorerWindow.on("resized",s)}this.processExplorerWindow&&this.focusWindow(this.processExplorerWindow)}focusWindow(t){t.isMinimized()&&t.restore(),t.focus()}getWindowPosition(t,e,r){let i,o=fl.getAllDisplays();if(o.length===1)i=o[0];else{if(A){let l=fl.getCursorScreenPoint();i=fl.getDisplayNearestPoint(l)}!i&&t&&(i=fl.getDisplayMatching(t.getBounds())),i||(i=fl.getPrimaryDisplay()||o[0])}let s=i.bounds,a={width:e,height:r,x:s.x+s.width/2-e/2,y:s.y+s.height/2-r/2};return s.width>0&&s.height>0&&(a.x<s.x&&(a.x=s.x),a.y<s.y&&(a.y=s.y),a.x>s.x+s.width&&(a.x=s.x),a.y>s.y+s.height&&(a.y=s.y),a.width>s.width&&(a.width=s.width),a.height>s.height&&(a.height=s.height)),a}async stopTracing(){if(!this.environmentMainService.args.trace)return;let t=await eE.stopRecording(`${ac(this.environmentMainService.userHome.fsPath,this.productService.applicationName)}.trace.txt`);await this.dialogMainService.showMessageBox({type:"info",message:p("trace.message","Successfully created the trace file"),detail:p("trace.detail",`Please create an issue and manually attach the following file:
{0}`,t),buttons:[p({key:"trace.ok",comment:["&& denotes a mnemonic"]},"&&OK")]},pm.getFocusedWindow()??void 0),this.nativeHostMainService.showItemInFolder(void 0,t)}async getSystemStatus(){let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!1,includeWorkspaceMetadata:!1})]);return this.diagnosticsService.getDiagnostics(t,e)}async $getSystemInfo(){let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!1,includeWorkspaceMetadata:!1})]);return await this.diagnosticsService.getSystemInfo(t,e)}async $getPerformanceInfo(){try{let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!0,includeWorkspaceMetadata:!0})]);return await this.diagnosticsService.getPerformanceInfo(t,e)}catch(t){throw this.logService.warn("issueService#getPerformanceInfo ",t.message),t}}createBrowserWindow(t,e,r,i){let o=new pm({fullscreen:!1,skipTaskbar:!1,resizable:!0,width:t.width,height:t.height,minWidth:300,minHeight:200,x:t.x,y:t.y,title:r.title,backgroundColor:r.backgroundColor||mi.DEFAULT_BACKGROUND_COLOR,webPreferences:{preload:Me.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${e.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none",enableWebSQL:!1,spellcheck:!1,zoomFactor:qo(r.zoomLevel),sandbox:!0},alwaysOnTop:r.alwaysOnTop,experimentalDarkMode:!0});return o.setMenuBarVisibility(!1),o}safeSend(t,e,...r){t.sender.isDestroyed()||t.sender.send(e,...r)}async closeProcessExplorer(){this.processExplorerWindow?.close()}};mi=P([h(1,ge),h(2,B),h(3,Rd),h(4,rl),h(5,Mt),h(6,sr),h(7,ti),h(8,Oe),h(9,Ye),h(10,pi)],mi);function tE(n){return typeof n!="object"||n===null?!1:"x"in n&&"y"in n&&"width"in n&&"height"in n}var ml=class{_keyCodeToStr;_strToKeyCode;constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(t,e){this._keyCodeToStr[t]=e,this._strToKeyCode[e.toLowerCase()]=t}keyCodeToStr(t){return this._keyCodeToStr[t]}strToKeyCode(t){return this._strToKeyCode[t.toLowerCase()]||0}},tu=new ml,fm=new ml,mm=new ml,rE=new Array(230),nE={},iE=[],oE=Object.create(null),sE=Object.create(null);var Vb=[],hm=[];for(let n=0;n<=193;n++)Vb[n]=-1;for(let n=0;n<=132;n++)hm[n]=-1;(function(){let n="",t=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN",n,n],[1,1,"Hyper",0,n,0,n,n,n],[1,2,"Super",0,n,0,n,n,n],[1,3,"Fn",0,n,0,n,n,n],[1,4,"FnLock",0,n,0,n,n,n],[1,5,"Suspend",0,n,0,n,n,n],[1,6,"Resume",0,n,0,n,n,n],[1,7,"Turbo",0,n,0,n,n,n],[1,8,"Sleep",0,n,0,"VK_SLEEP",n,n],[1,9,"WakeUp",0,n,0,n,n,n],[0,10,"KeyA",31,"A",65,"VK_A",n,n],[0,11,"KeyB",32,"B",66,"VK_B",n,n],[0,12,"KeyC",33,"C",67,"VK_C",n,n],[0,13,"KeyD",34,"D",68,"VK_D",n,n],[0,14,"KeyE",35,"E",69,"VK_E",n,n],[0,15,"KeyF",36,"F",70,"VK_F",n,n],[0,16,"KeyG",37,"G",71,"VK_G",n,n],[0,17,"KeyH",38,"H",72,"VK_H",n,n],[0,18,"KeyI",39,"I",73,"VK_I",n,n],[0,19,"KeyJ",40,"J",74,"VK_J",n,n],[0,20,"KeyK",41,"K",75,"VK_K",n,n],[0,21,"KeyL",42,"L",76,"VK_L",n,n],[0,22,"KeyM",43,"M",77,"VK_M",n,n],[0,23,"KeyN",44,"N",78,"VK_N",n,n],[0,24,"KeyO",45,"O",79,"VK_O",n,n],[0,25,"KeyP",46,"P",80,"VK_P",n,n],[0,26,"KeyQ",47,"Q",81,"VK_Q",n,n],[0,27,"KeyR",48,"R",82,"VK_R",n,n],[0,28,"KeyS",49,"S",83,"VK_S",n,n],[0,29,"KeyT",50,"T",84,"VK_T",n,n],[0,30,"KeyU",51,"U",85,"VK_U",n,n],[0,31,"KeyV",52,"V",86,"VK_V",n,n],[0,32,"KeyW",53,"W",87,"VK_W",n,n],[0,33,"KeyX",54,"X",88,"VK_X",n,n],[0,34,"KeyY",55,"Y",89,"VK_Y",n,n],[0,35,"KeyZ",56,"Z",90,"VK_Z",n,n],[0,36,"Digit1",22,"1",49,"VK_1",n,n],[0,37,"Digit2",23,"2",50,"VK_2",n,n],[0,38,"Digit3",24,"3",51,"VK_3",n,n],[0,39,"Digit4",25,"4",52,"VK_4",n,n],[0,40,"Digit5",26,"5",53,"VK_5",n,n],[0,41,"Digit6",27,"6",54,"VK_6",n,n],[0,42,"Digit7",28,"7",55,"VK_7",n,n],[0,43,"Digit8",29,"8",56,"VK_8",n,n],[0,44,"Digit9",30,"9",57,"VK_9",n,n],[0,45,"Digit0",21,"0",48,"VK_0",n,n],[1,46,"Enter",3,"Enter",13,"VK_RETURN",n,n],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE",n,n],[1,48,"Backspace",1,"Backspace",8,"VK_BACK",n,n],[1,49,"Tab",2,"Tab",9,"VK_TAB",n,n],[1,50,"Space",10,"Space",32,"VK_SPACE",n,n],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,n,0,n,n,n],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL",n,n],[1,64,"F1",59,"F1",112,"VK_F1",n,n],[1,65,"F2",60,"F2",113,"VK_F2",n,n],[1,66,"F3",61,"F3",114,"VK_F3",n,n],[1,67,"F4",62,"F4",115,"VK_F4",n,n],[1,68,"F5",63,"F5",116,"VK_F5",n,n],[1,69,"F6",64,"F6",117,"VK_F6",n,n],[1,70,"F7",65,"F7",118,"VK_F7",n,n],[1,71,"F8",66,"F8",119,"VK_F8",n,n],[1,72,"F9",67,"F9",120,"VK_F9",n,n],[1,73,"F10",68,"F10",121,"VK_F10",n,n],[1,74,"F11",69,"F11",122,"VK_F11",n,n],[1,75,"F12",70,"F12",123,"VK_F12",n,n],[1,76,"PrintScreen",0,n,0,n,n,n],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL",n,n],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE",n,n],[1,79,"Insert",19,"Insert",45,"VK_INSERT",n,n],[1,80,"Home",14,"Home",36,"VK_HOME",n,n],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR",n,n],[1,82,"Delete",20,"Delete",46,"VK_DELETE",n,n],[1,83,"End",13,"End",35,"VK_END",n,n],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT",n,n],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",n],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",n],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",n],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",n],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK",n,n],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE",n,n],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY",n,n],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT",n,n],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD",n,n],[1,94,"NumpadEnter",3,n,0,n,n,n],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1",n,n],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2",n,n],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3",n,n],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4",n,n],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5",n,n],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6",n,n],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7",n,n],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8",n,n],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9",n,n],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0",n,n],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL",n,n],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102",n,n],[1,107,"ContextMenu",58,"ContextMenu",93,n,n,n],[1,108,"Power",0,n,0,n,n,n],[1,109,"NumpadEqual",0,n,0,n,n,n],[1,110,"F13",71,"F13",124,"VK_F13",n,n],[1,111,"F14",72,"F14",125,"VK_F14",n,n],[1,112,"F15",73,"F15",126,"VK_F15",n,n],[1,113,"F16",74,"F16",127,"VK_F16",n,n],[1,114,"F17",75,"F17",128,"VK_F17",n,n],[1,115,"F18",76,"F18",129,"VK_F18",n,n],[1,116,"F19",77,"F19",130,"VK_F19",n,n],[1,117,"F20",78,"F20",131,"VK_F20",n,n],[1,118,"F21",79,"F21",132,"VK_F21",n,n],[1,119,"F22",80,"F22",133,"VK_F22",n,n],[1,120,"F23",81,"F23",134,"VK_F23",n,n],[1,121,"F24",82,"F24",135,"VK_F24",n,n],[1,122,"Open",0,n,0,n,n,n],[1,123,"Help",0,n,0,n,n,n],[1,124,"Select",0,n,0,n,n,n],[1,125,"Again",0,n,0,n,n,n],[1,126,"Undo",0,n,0,n,n,n],[1,127,"Cut",0,n,0,n,n,n],[1,128,"Copy",0,n,0,n,n,n],[1,129,"Paste",0,n,0,n,n,n],[1,130,"Find",0,n,0,n,n,n],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE",n,n],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP",n,n],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN",n,n],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR",n,n],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1",n,n],[1,136,"KanaMode",0,n,0,n,n,n],[0,137,"IntlYen",0,n,0,n,n,n],[1,138,"Convert",0,n,0,n,n,n],[1,139,"NonConvert",0,n,0,n,n,n],[1,140,"Lang1",0,n,0,n,n,n],[1,141,"Lang2",0,n,0,n,n,n],[1,142,"Lang3",0,n,0,n,n,n],[1,143,"Lang4",0,n,0,n,n,n],[1,144,"Lang5",0,n,0,n,n,n],[1,145,"Abort",0,n,0,n,n,n],[1,146,"Props",0,n,0,n,n,n],[1,147,"NumpadParenLeft",0,n,0,n,n,n],[1,148,"NumpadParenRight",0,n,0,n,n,n],[1,149,"NumpadBackspace",0,n,0,n,n,n],[1,150,"NumpadMemoryStore",0,n,0,n,n,n],[1,151,"NumpadMemoryRecall",0,n,0,n,n,n],[1,152,"NumpadMemoryClear",0,n,0,n,n,n],[1,153,"NumpadMemoryAdd",0,n,0,n,n,n],[1,154,"NumpadMemorySubtract",0,n,0,n,n,n],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR",n,n],[1,156,"NumpadClearEntry",0,n,0,n,n,n],[1,0,n,5,"Ctrl",17,"VK_CONTROL",n,n],[1,0,n,4,"Shift",16,"VK_SHIFT",n,n],[1,0,n,6,"Alt",18,"VK_MENU",n,n],[1,0,n,57,"Meta",91,"VK_COMMAND",n,n],[1,157,"ControlLeft",5,n,0,"VK_LCONTROL",n,n],[1,158,"ShiftLeft",4,n,0,"VK_LSHIFT",n,n],[1,159,"AltLeft",6,n,0,"VK_LMENU",n,n],[1,160,"MetaLeft",57,n,0,"VK_LWIN",n,n],[1,161,"ControlRight",5,n,0,"VK_RCONTROL",n,n],[1,162,"ShiftRight",4,n,0,"VK_RSHIFT",n,n],[1,163,"AltRight",6,n,0,"VK_RMENU",n,n],[1,164,"MetaRight",57,n,0,"VK_RWIN",n,n],[1,165,"BrightnessUp",0,n,0,n,n,n],[1,166,"BrightnessDown",0,n,0,n,n,n],[1,167,"MediaPlay",0,n,0,n,n,n],[1,168,"MediaRecord",0,n,0,n,n,n],[1,169,"MediaFastForward",0,n,0,n,n,n],[1,170,"MediaRewind",0,n,0,n,n,n],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK",n,n],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK",n,n],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP",n,n],[1,174,"Eject",0,n,0,n,n,n],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE",n,n],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT",n,n],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL",n,n],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2",n,n],[1,179,"LaunchApp1",0,n,0,"VK_MEDIA_LAUNCH_APP1",n,n],[1,180,"SelectTask",0,n,0,n,n,n],[1,181,"LaunchScreenSaver",0,n,0,n,n,n],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH",n,n],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME",n,n],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK",n,n],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD",n,n],[1,186,"BrowserStop",0,n,0,"VK_BROWSER_STOP",n,n],[1,187,"BrowserRefresh",0,n,0,"VK_BROWSER_REFRESH",n,n],[1,188,"BrowserFavorites",0,n,0,"VK_BROWSER_FAVORITES",n,n],[1,189,"ZoomToggle",0,n,0,n,n,n],[1,190,"MailReply",0,n,0,n,n,n],[1,191,"MailForward",0,n,0,n,n,n],[1,192,"MailSend",0,n,0,n,n,n],[1,0,n,114,"KeyInComposition",229,n,n,n],[1,0,n,116,"ABNT_C2",194,"VK_ABNT_C2",n,n],[1,0,n,96,"OEM_8",223,"VK_OEM_8",n,n],[1,0,n,0,n,0,"VK_KANA",n,n],[1,0,n,0,n,0,"VK_HANGUL",n,n],[1,0,n,0,n,0,"VK_JUNJA",n,n],[1,0,n,0,n,0,"VK_FINAL",n,n],[1,0,n,0,n,0,"VK_HANJA",n,n],[1,0,n,0,n,0,"VK_KANJI",n,n],[1,0,n,0,n,0,"VK_CONVERT",n,n],[1,0,n,0,n,0,"VK_NONCONVERT",n,n],[1,0,n,0,n,0,"VK_ACCEPT",n,n],[1,0,n,0,n,0,"VK_MODECHANGE",n,n],[1,0,n,0,n,0,"VK_SELECT",n,n],[1,0,n,0,n,0,"VK_PRINT",n,n],[1,0,n,0,n,0,"VK_EXECUTE",n,n],[1,0,n,0,n,0,"VK_SNAPSHOT",n,n],[1,0,n,0,n,0,"VK_HELP",n,n],[1,0,n,0,n,0,"VK_APPS",n,n],[1,0,n,0,n,0,"VK_PROCESSKEY",n,n],[1,0,n,0,n,0,"VK_PACKET",n,n],[1,0,n,0,n,0,"VK_DBE_SBCSCHAR",n,n],[1,0,n,0,n,0,"VK_DBE_DBCSCHAR",n,n],[1,0,n,0,n,0,"VK_ATTN",n,n],[1,0,n,0,n,0,"VK_CRSEL",n,n],[1,0,n,0,n,0,"VK_EXSEL",n,n],[1,0,n,0,n,0,"VK_EREOF",n,n],[1,0,n,0,n,0,"VK_PLAY",n,n],[1,0,n,0,n,0,"VK_ZOOM",n,n],[1,0,n,0,n,0,"VK_NONAME",n,n],[1,0,n,0,n,0,"VK_PA1",n,n],[1,0,n,0,n,0,"VK_OEM_CLEAR",n,n]],e=[],r=[];for(let i of t){let[o,s,a,l,c,d,f,m,g]=i;if(r[s]||(r[s]=!0,iE[s]=a,oE[a]=s,sE[a.toLowerCase()]=s,o&&(Vb[s]=l,l!==0&&l!==3&&l!==5&&l!==4&&l!==6&&l!==57&&(hm[l]=s))),!e[l]){if(e[l]=!0,!c)throw new Error(`String representation missing for key code ${l} around scan code ${a}`);tu.define(l,c),fm.define(l,m||c),mm.define(l,g||m||c)}d&&(rE[d]=l),f&&(nE[f]=l)}hm[3]=46})();var aE;(s=>{function n(a){return tu.keyCodeToStr(a)}s.toString=n;function t(a){return tu.strToKeyCode(a)}s.fromString=t;function e(a){return fm.keyCodeToStr(a)}s.toUserSettingsUS=e;function r(a){return mm.keyCodeToStr(a)}s.toUserSettingsGeneral=r;function i(a){return fm.strToKeyCode(a)||mm.strToKeyCode(a)}s.fromUserSettings=i;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return tu.keyCodeToStr(a)}s.toElectronAccelerator=o})(aE||={});var Bce=R("keybindingService");var nde=R("keyboardLayoutService");var gm=R("keyboardLayoutMainService"),hs=class extends O{_onDidChangeKeyboardLayout=this._register(new S);onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;_initPromise;_keyboardLayoutData;constructor(t){super(),this._initPromise=null,this._keyboardLayoutData=null,t.when(3).then(()=>this._initialize())}_initialize(){return this._initPromise||(this._initPromise=this._doInitialize()),this._initPromise}async _doInitialize(){let t=await import("native-keymap");this._keyboardLayoutData=Kb(t),uh||t.onDidChangeKeyboardLayout(()=>{this._keyboardLayoutData=Kb(t),this._onDidChangeKeyboardLayout.fire(this._keyboardLayoutData)})}async getKeyboardLayoutData(){return await this._initialize(),this._keyboardLayoutData}};hs=P([h(0,le)],hs);function Kb(n){let t=n.getKeyMap(),e=n.getCurrentKeyboardLayout();return{keyboardMapping:t,keyboardLayoutInfo:e}}import{app as cE}from"electron";var gs=R("urlService");var dE="launchMainService",vm=R(dE),vs=class{constructor(t,e,r,i){this.logService=t;this.windowsMainService=e;this.urlService=r;this.configurationService=i}async start(t,e){this.logService.trace("Received data from other instance: ",t,e),A&&cE.focus({steal:!0});let r=this.parseOpenUrl(t);if(r.length){let i=Promise.resolve();if(this.windowsMainService.getWindowCount()===0){let o=(await this.windowsMainService.openEmptyWindow({context:4})).at(0);o&&(i=o.ready())}i.then(()=>{for(let{uri:o,originalUrl:s}of r)this.urlService.open(o,{originalUrl:s})})}else return this.startOpenWindow(t,e)}parseOpenUrl(t){return t["open-url"]&&t._urls&&t._urls.length>0?pt(t._urls.map(e=>{try{return{uri:x.parse(e),originalUrl:e}}catch{return null}})):[]}async startOpenWindow(t,e){let r=rn(e)?0:4,i=[],o=t.wait&&t.waitMarkerFilePath?x.file(t.waitMarkerFilePath):void 0,s=t.remote||void 0,a={context:r,cli:t,userEnv:t["preserve-env"]||r===0?e:void 0,waitMarkerFileURI:o,remoteAuthority:s,forceProfile:t.profile,forceTempProfile:t["profile-temp"]};if(t.extensionDevelopmentPath)await this.windowsMainService.openExtensionDevelopmentHostWindow(t.extensionDevelopmentPath,a);else if(!t._.length&&!t["folder-uri"]&&!t["file-uri"]){let l=!1;if(t["new-window"]||a.forceProfile||a.forceTempProfile)l=!0;else if(t["reuse-window"])l=!1;else switch(this.configurationService.getValue("window")?.openWithoutArgumentsInNewWindow||"default"){case"on":l=!0;break;case"off":l=!1;break;default:l=!A}if(l)i=await this.windowsMainService.open({...a,forceNewWindow:!0,forceEmpty:!0});else{let c=this.windowsMainService.getLastActiveWindow();c?(this.windowsMainService.openExistingWindow(c,a),i=[c]):i=await this.windowsMainService.open({...a,forceEmpty:!0})}}else i=await this.windowsMainService.open({...a,forceNewWindow:t["new-window"],preferNewWindow:!t["reuse-window"]&&!t.wait,forceReuseWindow:t["reuse-window"],diffMode:t.diff,mergeMode:t.merge,addMode:t.add,noRecentEntry:!!t["skip-add-to-recently-opened"],gotoLineMode:t.goto});if(o&&i.length===1&&i[0])return Promise.race([i[0].whenClosedOrLoaded,py(o.fsPath)]).then(()=>{},()=>{})}async getMainProcessId(){return this.logService.trace("Received request for process ID from other instance."),process.pid}};vs=P([h(0,B),h(1,Te),h(2,gs),h(3,Ie)],vs);function ym(n){return n.submenu!==void 0}function bm(n){return n.id==="vscode.menubar.separator"}function Im(n){return n.uri!==void 0}function Hb(n){return!ym(n)&&!bm(n)&&!Im(n)}import{app as uE,BrowserWindow as ru,Menu as dt,MenuItem as De}from"electron";var ue={Uninitialized:{type:"uninitialized"},Disabled:n=>({type:"disabled",reason:n}),Idle:(n,t)=>({type:"idle",updateType:n,error:t}),CheckingForUpdates:n=>({type:"checking for updates",explicit:n}),AvailableForDownload:n=>({type:"available for download",update:n}),Downloading:{type:"downloading"},Downloaded:n=>({type:"downloaded",update:n}),Updating:n=>({type:"updating",update:n}),Ready:n=>({type:"ready",update:n})},hi=R("updateService");import{app as Xi}from"electron";var gi=R("workspacesHistoryMainService"),_t=class extends O{constructor(e,r,i,o,s){super();this.logService=e;this.workspacesManagementMainService=r;this.lifecycleMainService=i;this.applicationStorageMainService=o;this.dialogMainService=s;this.registerListeners()}static MAX_TOTAL_RECENT_ENTRIES=500;static RECENTLY_OPENED_STORAGE_KEY="history.recentlyOpenedPathsList";_onDidChangeRecentlyOpened=this._register(new S);onDidChangeRecentlyOpened=this._onDidChangeRecentlyOpened.event;registerListeners(){this.lifecycleMainService.when(4).then(()=>this.handleWindowsJumpList()),this._register(this.workspacesManagementMainService.onDidEnterWorkspace(e=>this.addRecentlyOpened([{workspace:e.workspace,remoteAuthority:e.window.remoteAuthority}])))}async addRecentlyOpened(e){let r=[],i=[];for(let s of e)if(wd(s))!this.workspacesManagementMainService.isUntitledWorkspace(s.workspace)&&!this.containsWorkspace(r,s.workspace)&&r.push(s);else if(Ja(s))this.containsFolder(r,s.folderUri)||r.push(s);else{let a=this.containsFile(i,s.fileUri),l=s.fileUri.scheme===U.file&&_t.COMMON_FILES_FILTER.indexOf(Vt(s.fileUri))>=0;!a&&!l&&(i.push(s),N&&s.fileUri.scheme===U.file&&Xi.addRecentDocument(s.fileUri.fsPath))}let o=await this.mergeEntriesFromStorage({workspaces:r,files:i});r=o.workspaces,i=o.files,r.length>_t.MAX_TOTAL_RECENT_ENTRIES&&(r.length=_t.MAX_TOTAL_RECENT_ENTRIES),i.length>_t.MAX_TOTAL_RECENT_ENTRIES&&(i.length=_t.MAX_TOTAL_RECENT_ENTRIES),await this.saveRecentlyOpened({workspaces:r,files:i}),this._onDidChangeRecentlyOpened.fire(),A&&this.macOSRecentDocumentsUpdater.trigger(()=>this.updateMacOSRecentDocuments())}async removeRecentlyOpened(e){let r=a=>{let l=this.location(a);for(let c of e)if(Ae.isEqual(c,l))return!1;return!0},i=await this.getRecentlyOpened(),o=i.workspaces.filter(r),s=i.files.filter(r);(o.length!==i.workspaces.length||s.length!==i.files.length)&&(await this.saveRecentlyOpened({files:s,workspaces:o}),this._onDidChangeRecentlyOpened.fire(),A&&this.macOSRecentDocumentsUpdater.trigger(()=>this.updateMacOSRecentDocuments()))}async clearRecentlyOpened(e){if(e?.confirm){let{response:r}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"clearButtonLabel",comment:["&& denotes a mnemonic"]},"&&Clear"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&Cancel")],message:p("confirmClearRecentsMessage","Do you want to clear all recently opened files and workspaces?"),detail:p("confirmClearDetail","This action is irreversible!"),cancelId:1});if(r!==0)return}await this.saveRecentlyOpened({workspaces:[],files:[]}),Xi.clearRecentDocuments(),this._onDidChangeRecentlyOpened.fire()}async getRecentlyOpened(){return this.mergeEntriesFromStorage()}async mergeEntriesFromStorage(e){let r=new Ot(s=>Ae.getComparisonKey(s));if(e?.workspaces)for(let s of e.workspaces)r.set(this.location(s),s);let i=new Ot(s=>Ae.getComparisonKey(s));if(e?.files)for(let s of e.files)i.set(this.location(s),s);let o=await this.getRecentlyOpenedFromStorage();for(let s of o.workspaces){let a=r.get(this.location(s));a?a.label=a.label??s.label:r.set(this.location(s),s)}for(let s of o.files){let a=i.get(this.location(s));a?a.label=a.label??s.label:i.set(this.location(s),s)}return{workspaces:[...r.values()],files:[...i.values()]}}async getRecentlyOpenedFromStorage(){await this.applicationStorageMainService.whenReady;let e,r=this.applicationStorageMainService.get(_t.RECENTLY_OPENED_STORAGE_KEY,-1);if(typeof r=="string")try{e=JSON.parse(r)}catch(i){this.logService.error("Unexpected error parsing opened paths list",i)}return Qy(e,this.logService)}async saveRecentlyOpened(e){await this.applicationStorageMainService.whenReady,this.applicationStorageMainService.store(_t.RECENTLY_OPENED_STORAGE_KEY,JSON.stringify(Yy(e)),-1,1)}location(e){return Ja(e)?e.folderUri:zy(e)?e.fileUri:e.workspace.configPath}containsWorkspace(e,r){return!!e.find(i=>wd(i)&&i.workspace.id===r.id)}containsFolder(e,r){return!!e.find(i=>Ja(i)&&Ae.isEqual(i.folderUri,r))}containsFile(e,r){return!!e.find(i=>Ae.isEqual(i.fileUri,r))}static MAX_MACOS_DOCK_RECENT_WORKSPACES=7;static MAX_MACOS_DOCK_RECENT_ENTRIES_TOTAL=10;static MAX_WINDOWS_JUMP_LIST_ENTRIES=7;static COMMON_FILES_FILTER=["COMMIT_EDITMSG","MERGE_MSG","git-rebase-todo"];macOSRecentDocumentsUpdater=this._register(new Kt(800));async handleWindowsJumpList(){N&&(await this.updateWindowsJumpList(),this._register(this.onDidChangeRecentlyOpened(()=>this.updateWindowsJumpList())))}async updateWindowsJumpList(){if(!N)return;let e=[];if(e.push({type:"tasks",items:[{type:"task",title:p("newWindow","New Window"),description:p("newWindowDesc","Opens a new window"),program:process.execPath,args:"-n",iconPath:process.execPath,iconIndex:0}]}),(await this.getRecentlyOpened()).workspaces.length>0){let r=[];for(let s of Xi.getJumpListSettings().removedItems){let a=s.args;if(a){let l=/^--(folder|file)-uri\s+"([^"]+)"$/.exec(a);l&&r.push(x.parse(l[2]))}}await this.removeRecentlyOpened(r);let i=!1,o=pt((await this.getRecentlyOpened()).workspaces.slice(0,_t.MAX_WINDOWS_JUMP_LIST_ENTRIES).map(s=>{let a=wd(s)?s.workspace:s.folderUri,{title:l,description:c}=this.getWindowsJumpListLabel(a,s.label),d;return x.isUri(a)?d=`--folder-uri "${a.toString()}"`:(i=!0,d=`--file-uri "${a.configPath.toString()}"`),{type:"task",title:l.substr(0,255),description:c.substr(0,255),program:process.execPath,args:d,iconPath:"explorer.exe",iconIndex:0}}));o.length>0&&e.push({type:"custom",name:i?p("recentFoldersAndWorkspaces","Recent Folders & Workspaces"):p("recentFolders","Recent Folders"),items:o})}e.push({type:"recent"});try{let r=Xi.setJumpList(e);r&&r!=="ok"&&this.logService.warn(`updateWindowsJumpList#setJumpList unexpected result: ${r}`)}catch(r){this.logService.warn("updateWindowsJumpList#setJumpList",r)}}getWindowsJumpListLabel(e,r){if(r)return{title:bg(r).name,description:r};if(x.isUri(e))return{title:Vt(e),description:this.renderJumpListPathDescription(e)};if(this.workspacesManagementMainService.isUntitledWorkspace(e))return{title:p("untitledWorkspace","Untitled (Workspace)"),description:""};let i=Vt(e.configPath);return i.endsWith(Sa)&&(i=i.substr(0,i.length-Sa.length-1)),{title:p("workspaceName","{0} (Workspace)",i),description:this.renderJumpListPathDescription(e.configPath)}}renderJumpListPathDescription(e){return e.scheme==="file"?fa(e.fsPath):e.toString()}async updateMacOSRecentDocuments(){if(!A)return;Xi.clearRecentDocuments();let e=await this.getRecentlyOpened(),r=[],i=0;for(let s=0;s<e.workspaces.length&&i<_t.MAX_MACOS_DOCK_RECENT_WORKSPACES;s++){let a=this.location(e.workspaces[s]);if(a.scheme===U.file){let l=Et(a);await $.exists(l)&&(r.push(l),i++)}}let o=[];for(let s=0;s<e.files.length&&i<_t.MAX_MACOS_DOCK_RECENT_ENTRIES_TOTAL;s++){let a=this.location(e.files[s]);if(a.scheme===U.file){let l=Et(a);if(_t.COMMON_FILES_FILTER.includes(Vt(a))||r.includes(l))continue;await $.exists(l)&&(o.push(l),i++)}}o.reverse().forEach(s=>Xi.addRecentDocument(s)),r.reverse().forEach(s=>Xi.addRecentDocument(s))}};_t=P([h(0,B),h(1,or),h(2,le),h(3,si),h(4,Mt)],_t);var nu="menu",kn=class extends O{constructor(e,r,i,o,s,a,l,c,d,f,m,g){super();this.updateService=e;this.configurationService=r;this.windowsMainService=i;this.environmentMainService=o;this.telemetryService=s;this.workspacesHistoryMainService=a;this.stateService=l;this.lifecycleMainService=c;this.logService=d;this.nativeHostMainService=f;this.productService=m;this.auxiliaryWindowsMainService=g;this.menuUpdater=new bt(()=>this.doUpdateMenu(),0),this.menuGC=new bt(()=>{this.oldMenus=[]},1e4),this.menubarMenus=Object.create(null),this.keybindings=Object.create(null),(A||Fr(r))&&this.restoreCachedMenubarData(),this.addFallbackHandlers(),this.closedLastWindow=!1,this.noActiveMainWindow=!1,this.oldMenus=[],this.install(),this.registerListeners()}static lastKnownMenubarStorageKey="lastKnownMenubarData";willShutdown;appMenuInstalled;closedLastWindow;noActiveMainWindow;menuUpdater;menuGC;oldMenus;menubarMenus;keybindings;fallbackMenuHandlers=Object.create(null);restoreCachedMenubarData(){let e=this.stateService.getItem(kn.lastKnownMenubarStorageKey);e&&(e.menus&&(this.menubarMenus=e.menus),e.keybindings&&(this.keybindings=e.keybindings))}addFallbackHandlers(){this.fallbackMenuHandlers["workbench.action.files.newUntitledFile"]=(a,l,c)=>{this.runActionInRenderer({type:"commandId",commandId:"workbench.action.files.newUntitledFile"})||this.windowsMainService.openEmptyWindow({context:2,contextWindowId:l?.id})},this.fallbackMenuHandlers["workbench.action.newWindow"]=(a,l,c)=>this.windowsMainService.openEmptyWindow({context:2,contextWindowId:l?.id}),this.fallbackMenuHandlers["workbench.action.files.openFileFolder"]=(a,l,c)=>this.nativeHostMainService.pickFileFolderAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:nu}}),this.fallbackMenuHandlers["workbench.action.files.openFolder"]=(a,l,c)=>this.nativeHostMainService.pickFolderAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:nu}}),this.fallbackMenuHandlers["workbench.action.openWorkspace"]=(a,l,c)=>this.nativeHostMainService.pickWorkspaceAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:nu}}),this.fallbackMenuHandlers["workbench.action.clearRecentFiles"]=()=>this.workspacesHistoryMainService.clearRecentlyOpened({confirm:!0});let e=this.productService.youTubeUrl;e&&(this.fallbackMenuHandlers["workbench.action.openYouTubeUrl"]=()=>this.openUrl(e,"openYouTubeUrl"));let r=this.productService.requestFeatureUrl;r&&(this.fallbackMenuHandlers["workbench.action.openRequestFeatureUrl"]=()=>this.openUrl(r,"openUserVoiceUrl"));let i=this.productService.reportIssueUrl;i&&(this.fallbackMenuHandlers["workbench.action.openIssueReporter"]=()=>this.openUrl(i,"openReportIssues"));let o=this.productService.licenseUrl;o&&(this.fallbackMenuHandlers["workbench.action.openLicenseUrl"]=()=>{if(dr){let a=o.indexOf("?")>0?"&":"?";this.openUrl(`${o}${a}lang=${dr}`,"openLicenseUrl")}else this.openUrl(o,"openLicenseUrl")});let s=this.productService.privacyStatementUrl;s&&o&&(this.fallbackMenuHandlers["workbench.action.openPrivacyStatementUrl"]=()=>{this.openUrl(s,"openPrivacyStatement")})}registerListeners(){this._register(this.lifecycleMainService.onWillShutdown(()=>this.willShutdown=!0)),this._register(this.windowsMainService.onDidChangeWindowsCount(e=>this.onDidChangeWindowsCount(e))),this._register(this.nativeHostMainService.onDidBlurMainWindow(()=>this.onDidChangeWindowFocus())),this._register(this.nativeHostMainService.onDidFocusMainWindow(()=>this.onDidChangeWindowFocus()))}get currentEnableMenuBarMnemonics(){let e=this.configurationService.getValue("window.enableMenuBarMnemonics");return typeof e!="boolean"?!0:e}get currentEnableNativeTabs(){if(!A)return!1;let e=this.configurationService.getValue("window.nativeTabs");return typeof e!="boolean"?!1:e}updateMenu(e,r){this.menubarMenus=e.menus,this.keybindings=e.keybindings,this.stateService.setItem(kn.lastKnownMenubarStorageKey,e),this.scheduleUpdateMenu()}scheduleUpdateMenu(){this.menuUpdater.schedule()}doUpdateMenu(){this.willShutdown||setTimeout(()=>{this.willShutdown||this.install()},10)}onDidChangeWindowsCount(e){A&&(e.oldCount===0&&e.newCount>0||e.oldCount>0&&e.newCount===0)&&(this.closedLastWindow=e.newCount===0,this.scheduleUpdateMenu())}onDidChangeWindowFocus(){if(!A)return;let e=ru.getFocusedWindow();this.noActiveMainWindow=!e||!!this.auxiliaryWindowsMainService.getWindowByWebContents(e.webContents),this.scheduleUpdateMenu()}install(){let e=dt.getApplicationMenu();if(e&&this.oldMenus.push(e),Object.keys(this.menubarMenus).length===0){this.doSetApplicationMenu(A?new dt:null);return}let r=new dt,i;if(A){let s=new dt;i=new De({label:this.productService.nameShort,submenu:s}),this.setMacApplicationMenu(s),r.append(i)}if(A&&!this.appMenuInstalled){this.appMenuInstalled=!0;let s=new dt;s.append(new De({label:this.mnemonicLabel(p({key:"miNewWindow",comment:["&& denotes a mnemonic"]},"New &&Window")),click:()=>this.windowsMainService.openEmptyWindow({context:1})})),uE.dock.setMenu(s)}if(this.shouldDrawMenu("File")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mFile",comment:["&& denotes a mnemonic"]},"&&File")),submenu:s});this.setMenuById(s,"File"),r.append(a)}if(this.shouldDrawMenu("Edit")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mEdit",comment:["&& denotes a mnemonic"]},"&&Edit")),submenu:s});this.setMenuById(s,"Edit"),r.append(a)}if(this.shouldDrawMenu("Selection")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mSelection",comment:["&& denotes a mnemonic"]},"&&Selection")),submenu:s});this.setMenuById(s,"Selection"),r.append(a)}if(this.shouldDrawMenu("View")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mView",comment:["&& denotes a mnemonic"]},"&&View")),submenu:s});this.setMenuById(s,"View"),r.append(a)}if(this.shouldDrawMenu("Go")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mGoto",comment:["&& denotes a mnemonic"]},"&&Go")),submenu:s});this.setMenuById(s,"Go"),r.append(a)}if(this.shouldDrawMenu("Run")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mRun",comment:["&& denotes a mnemonic"]},"&&Run")),submenu:s});this.setMenuById(s,"Run"),r.append(a)}if(this.shouldDrawMenu("Terminal")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal")),submenu:s});this.setMenuById(s,"Terminal"),r.append(a)}let o;if(this.shouldDrawMenu("Window")){let s=new dt;o=new De({label:this.mnemonicLabel(p("mWindow","Window")),submenu:s,role:"window"}),this.setMacWindowMenu(s)}if(o&&r.append(o),this.shouldDrawMenu("Help")){let s=new dt,a=new De({label:this.mnemonicLabel(p({key:"mHelp",comment:["&& denotes a mnemonic"]},"&&Help")),submenu:s,role:"help"});this.setMenuById(s,"Help"),r.append(a)}r.items&&r.items.length>0?this.doSetApplicationMenu(r):this.doSetApplicationMenu(null),this.menuGC.schedule()}doSetApplicationMenu(e){if(dt.setApplicationMenu(e),e)for(let r of this.auxiliaryWindowsMainService.getWindows())r.win?.setMenu(null)}setMacApplicationMenu(e){let r=this.createMenuItem(p("mAbout","About {0}",this.productService.nameLong),"workbench.action.showAboutDialog"),i=this.getUpdateMenuItems(),o;if(this.shouldDrawMenu("Preferences")){let g=new dt;this.setMenuById(g,"Preferences"),o=new De({label:this.mnemonicLabel(p({key:"miPreferences",comment:["&& denotes a mnemonic"]},"&&Preferences")),submenu:g})}let s=new dt,a=new De({label:p("mServices","Services"),role:"services",submenu:s}),l=new De({label:p("mHide","Hide {0}",this.productService.nameLong),role:"hide",accelerator:"Command+H"}),c=new De({label:p("mHideOthers","Hide Others"),role:"hideOthers",accelerator:"Command+Alt+H"}),d=new De({label:p("mShowAll","Show All"),role:"unhide"}),f=new De(this.likeAction("workbench.action.quit",{label:p("miQuit","Quit {0}",this.productService.nameLong),click:async(g,b,v)=>{let w=this.windowsMainService.getLastActiveWindow();(this.windowsMainService.getWindowCount()===0||ru.getFocusedWindow()||w?.win?.isMinimized())&&await this.confirmBeforeQuit(v)&&this.nativeHostMainService.quit(void 0)}})),m=[r];m.push(...i),o&&m.push(Tn(),o),m.push(Tn(),a,Tn(),l,c,d,Tn(),f),m.forEach(g=>e.append(g))}async confirmBeforeQuit(e){if(this.windowsMainService.getWindowCount()===0)return!0;let r=this.configurationService.getValue("window.confirmBeforeClose");if(r==="always"||r==="keyboardOnly"&&this.isKeyboardEvent(e)){let{response:i}=await this.nativeHostMainService.showMessageBox(this.windowsMainService.getFocusedWindow()?.id,{type:"question",buttons:[p({key:"quit",comment:["&& denotes a mnemonic"]},"&&Quit"),p("cancel","Cancel")],message:p("quitMessage","Are you sure you want to quit?")});return i===0}return!0}shouldDrawMenu(e){if(!A&&!Fr(this.configurationService))return!1;switch(e){case"File":case"Help":if(A)return this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow||!!this.menubarMenus&&!!this.menubarMenus[e];case"Window":if(A)return this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow||!!this.menubarMenus;default:return this.windowsMainService.getWindowCount()>0&&!!this.menubarMenus&&!!this.menubarMenus[e]}}setMenu(e,r){r.forEach(i=>{if(bm(i))e.append(Tn());else if(ym(i)){let o=new dt,s=new De({label:this.mnemonicLabel(i.label),submenu:o});this.setMenu(o,i.submenu.items),e.append(s)}else Im(i)?e.append(this.createOpenRecentMenuItem(i)):Hb(i)&&(i.id==="workbench.action.showAboutDialog"&&this.insertCheckForUpdatesItems(e),A?this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow?this.fallbackMenuHandlers[i.id]?e.append(new De(this.likeAction(i.id,{label:this.mnemonicLabel(i.label),click:this.fallbackMenuHandlers[i.id]}))):e.append(this.createMenuItem(i.label,i.id,!1,i.checked)):e.append(this.createMenuItem(i.label,i.id,i.enabled!==!1,!!i.checked)):e.append(this.createMenuItem(i.label,i.id,i.enabled!==!1,!!i.checked)))})}setMenuById(e,r){this.menubarMenus&&this.menubarMenus[r]&&this.setMenu(e,this.menubarMenus[r].items)}insertCheckForUpdatesItems(e){let r=this.getUpdateMenuItems();r.length&&(r.forEach(i=>e.append(i)),e.append(Tn()))}createOpenRecentMenuItem(e){let r=x.revive(e.uri),i=e.id,o=i==="openRecentFile"?{fileUri:r}:i==="openRecentWorkspace"?{workspaceUri:r}:{folderUri:r};return new De(this.likeAction(i,{label:e.label,click:async(s,a,l)=>{let c=this.isOptionClick(l);(await this.windowsMainService.open({context:2,cli:this.environmentMainService.args,urisToOpen:[o],forceNewWindow:c,gotoLineMode:!1,remoteAuthority:e.remoteAuthority})).length>0||await this.workspacesHistoryMainService.removeRecentlyOpened([r])}},!1))}isOptionClick(e){return!!(e&&(!A&&(e.ctrlKey||e.shiftKey)||A&&(e.metaKey||e.altKey)))}isKeyboardEvent(e){return!!(e.triggeredByAccelerator||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)}createRoleMenuItem(e,r,i){let o={label:this.mnemonicLabel(e),role:i,enabled:!0};return new De(this.withKeybinding(r,o))}setMacWindowMenu(e){let r=new De({label:p("mMinimize","Minimize"),role:"minimize",accelerator:"Command+M",enabled:this.windowsMainService.getWindowCount()>0}),i=new De({label:p("mZoom","Zoom"),role:"zoom",enabled:this.windowsMainService.getWindowCount()>0}),o=new De({label:p("mBringToFront","Bring All to Front"),role:"front",enabled:this.windowsMainService.getWindowCount()>0}),s=this.createMenuItem(p({key:"miSwitchWindow",comment:["&& denotes a mnemonic"]},"Switch &&Window..."),"workbench.action.switchWindow"),a=[];this.currentEnableNativeTabs&&(a.push(Tn()),a.push(this.createMenuItem(p("mNewTab","New Tab"),"workbench.action.newWindowTab")),a.push(this.createRoleMenuItem(p("mShowPreviousTab","Show Previous Tab"),"workbench.action.showPreviousWindowTab","selectPreviousTab")),a.push(this.createRoleMenuItem(p("mShowNextTab","Show Next Tab"),"workbench.action.showNextWindowTab","selectNextTab")),a.push(this.createRoleMenuItem(p("mMoveTabToNewWindow","Move Tab to New Window"),"workbench.action.moveWindowTabToNewWindow","moveTabToNewWindow")),a.push(this.createRoleMenuItem(p("mMergeAllWindows","Merge All Windows"),"workbench.action.mergeAllWindowTabs","mergeAllWindows"))),[r,i,Tn(),s,...a,Tn(),o].forEach(l=>e.append(l))}getUpdateMenuItems(){switch(this.updateService.state.type){case"idle":return[new De({label:this.mnemonicLabel(p("miCheckForUpdates","Check for &&Updates...")),click:()=>setTimeout(()=>{this.reportMenuActionTelemetry("CheckForUpdate"),this.updateService.checkForUpdates(!0)},0)})];case"checking for updates":return[new De({label:p("miCheckingForUpdates","Checking for Updates..."),enabled:!1})];case"available for download":return[new De({label:this.mnemonicLabel(p("miDownloadUpdate","D&&ownload Available Update")),click:()=>{this.updateService.downloadUpdate()}})];case"downloading":return[new De({label:p("miDownloadingUpdate","Downloading Update..."),enabled:!1})];case"downloaded":return A?[]:[new De({label:this.mnemonicLabel(p("miInstallUpdate","Install &&Update...")),click:()=>{this.reportMenuActionTelemetry("InstallUpdate"),this.updateService.applyUpdate()}})];case"updating":return[new De({label:p("miInstallingUpdate","Installing Update..."),enabled:!1})];case"ready":return[new De({label:this.mnemonicLabel(p("miRestartToUpdate","Restart to &&Update")),click:()=>{this.reportMenuActionTelemetry("RestartToUpdate"),this.updateService.quitAndInstall()}})];default:return[]}}createMenuItem(e,r,i,o){let s=this.mnemonicLabel(e),a=typeof r=="function"?r:(m,g,b)=>{let v=m?m.userSettingsLabel:null,w=r;Array.isArray(r)&&(w=this.isOptionClick(b)?r[1]:r[0]),v&&b.triggeredByAccelerator?this.runActionInRenderer({type:"keybinding",userSettingsLabel:v}):this.runActionInRenderer({type:"commandId",commandId:w})},l=typeof i=="boolean"?i:this.windowsMainService.getWindowCount()>0,c=typeof o=="boolean"?o:!1,d={label:s,click:a,enabled:l};c&&(d.type="checkbox",d.checked=c);let f;return typeof r=="string"?f=r:Array.isArray(r)&&(f=r[0]),A&&(f==="editor.action.clipboardCutAction"?d.role="cut":f==="editor.action.clipboardCopyAction"?d.role="copy":f==="editor.action.clipboardPasteAction"&&(d.role="paste"),f==="undo"?d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.undo(),inNoWindow:()=>dt.sendActionToFirstResponder("undo:")}):f==="redo"?d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.redo(),inNoWindow:()=>dt.sendActionToFirstResponder("redo:")}):f==="editor.action.selectAll"&&(d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.selectAll(),inNoWindow:()=>dt.sendActionToFirstResponder("selectAll:")}))),new De(this.withKeybinding(f,d))}makeContextAwareClickHandler(e,r){return(i,o,s)=>{let a=ru.getFocusedWindow();if(!a)return r.inNoWindow();if(a.webContents.isDevToolsFocused()&&a.webContents.devToolsWebContents)return r.inDevTools(a.webContents.devToolsWebContents);e(i,o||a,s)}}runActionInRenderer(e){let r=ru.getFocusedWindow();if(r){let o=this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents);o&&(r=this.windowsMainService.getWindowById(o.parentId)?.win??null)}if(!r){let o=this.windowsMainService.getLastActiveWindow();o?.win?.isMinimized()&&(r=o.win)}let i=r?this.windowsMainService.getWindowById(r.id):void 0;if(i){if(this.logService.trace("menubar#runActionInRenderer",e),A&&!this.environmentMainService.isBuilt&&!i.isReady&&(e.type==="commandId"&&e.commandId==="workbench.action.toggleDevTools"||e.type!=="commandId"&&e.userSettingsLabel==="alt+cmd+i"))return!1;if(e.type==="commandId"){let o={id:e.commandId,from:"menu"};i.sendWhenReady("vscode:runAction",Ee.None,o)}else{let o={userSettingsLabel:e.userSettingsLabel};i.sendWhenReady("vscode:runKeybinding",Ee.None,o)}return!0}else return this.logService.trace("menubar#runActionInRenderer: no active window found",e),!1}withKeybinding(e,r){let i=typeof e=="string"?this.keybindings[e]:void 0;if(i?.label){if(i.isNative!==!1)r.accelerator=i.label,r.userSettingsLabel=i.userSettingsLabel;else if(typeof r.label=="string"){let o=r.label.indexOf("[");o>=0?r.label=`${r.label.substr(0,o)} [${i.label}]`:r.label=`${r.label} [${i.label}]`}}else r.accelerator=void 0;return r}likeAction(e,r,i=!r.accelerator){i&&(r=this.withKeybinding(e,r));let o=r.click;return r.click=(s,a,l)=>{this.reportMenuActionTelemetry(e),o?.(s,a,l)},r}openUrl(e,r){this.nativeHostMainService.openExternal(void 0,e),this.reportMenuActionTelemetry(r)}reportMenuActionTelemetry(e){this.telemetryService.publicLog2("workbenchActionExecuted",{id:e,from:nu})}mnemonicLabel(e){return yg(e,!this.currentEnableMenuBarMnemonics)}};kn=P([h(0,hi),h(1,Ie),h(2,Te),h(3,ge),h(4,He),h(5,gi),h(6,Ye),h(7,le),h(8,B),h(9,sr),h(10,Oe),h(11,Pn)],kn);function Tn(){return new De({type:"separator"})}var wm=R("menubarMainService"),ys=class extends O{constructor(e,r,i){super();this.instantiationService=e;this.lifecycleMainService=r;this.logService=i}menubar=this.installMenuBarAfterWindowOpen();async installMenuBarAfterWindowOpen(){return await this.lifecycleMainService.when(3),this._register(this.instantiationService.createInstance(kn))}async updateMenubar(e,r){this.logService.trace("menubarService#updateMenubar",e),(await this.menubar).updateMenu(r,e)}};ys=P([h(0,tr),h(1,le),h(2,B)],ys);import"electron";var ou={exit:"vscode:electron-main->shared-process=exit",ipcReady:"vscode:shared-process->electron-main=ipc-ready",initDone:"vscode:shared-process->electron-main=init-done"},xm={request:"vscode:createSharedProcessChannelConnection",response:"vscode:createSharedProcessChannelConnectionResult"},Sm={request:"vscode:createSharedProcessRawConnection",response:"vscode:createSharedProcessRawConnectionResult"};var bs=class extends O{constructor(e,r,i,o,s,a,l,c,d){super();this.machineId=e;this.sqmId=r;this.devDeviceId=i;this.environmentMainService=o;this.userDataProfilesService=s;this.lifecycleMainService=a;this.logService=l;this.loggerMainService=c;this.policyService=d;this.registerListeners()}firstWindowConnectionBarrier=new Vn;utilityProcess=void 0;utilityProcessLogListener=void 0;_onDidCrash=this._register(new S);onDidCrash=this._onDidCrash.event;registerListeners(){ke.on(xm.request,(e,r)=>this.onWindowConnection(e,r,xm.response)),ke.on(Sm.request,(e,r)=>this.onWindowConnection(e,r,Sm.response)),this._register(this.lifecycleMainService.onWillShutdown(()=>this.onWillShutdown()))}async onWindowConnection(e,r,i){this.logService.trace(`[SharedProcess] onWindowConnection for: ${i}`),this.firstWindowConnectionBarrier.isOpen()||this.firstWindowConnectionBarrier.open(),await this.whenReady();let o=await this.connect(i);if(e.sender.isDestroyed())return o.close();e.sender.postMessage(i,r,[o])}onWillShutdown(){this.logService.trace("[SharedProcess] onWillShutdown"),this.utilityProcess?.postMessage(ou.exit),this.utilityProcess=void 0}_whenReady=void 0;whenReady(){return this._whenReady||(this._whenReady=(async()=>{await this.whenIpcReady;let e=new Ht;this.utilityProcess?.once(ou.initDone,()=>e.complete()),await e.p,this.utilityProcessLogListener?.dispose(),this.logService.trace("[SharedProcess] Overall ready")})()),this._whenReady}_whenIpcReady=void 0;get whenIpcReady(){return this._whenIpcReady||(this._whenIpcReady=(async()=>{await this.firstWindowConnectionBarrier.wait(),this.createUtilityProcess();let e=new Ht;this.utilityProcess?.once(ou.ipcReady,()=>e.complete()),await e.p,this.logService.trace("[SharedProcess] IPC ready")})()),this._whenIpcReady}createUtilityProcess(){this.utilityProcess=this._register(new Ct(this.logService,Qo,this.lifecycleMainService)),this.utilityProcessLogListener=this.utilityProcess.onMessage(i=>{typeof i.warning=="string"?this.logService.warn(i.warning):typeof i.error=="string"&&this.logService.error(i.error)});let e=jg(this.environmentMainService.args,this.environmentMainService.isBuilt),r;e.port&&(r=["--nolazy"],e.break?r.push(`--inspect-brk=${e.port}`):r.push(`--inspect=${e.port}`)),this.utilityProcess.start({type:"shared-process",entryPoint:"vs/code/electron-utility/sharedProcess/sharedProcessMain",payload:this.createSharedProcessConfiguration(),respondToAuthRequestsFromMainProcess:!0,execArgv:r}),this._register(this.utilityProcess.onCrash(()=>this._onDidCrash.fire()))}createSharedProcessConfiguration(){return{machineId:this.machineId,sqmId:this.sqmId,devDeviceId:this.devDeviceId,codeCachePath:this.environmentMainService.codeCachePath,profiles:{home:this.userDataProfilesService.profilesHome,all:this.userDataProfilesService.profiles},args:this.environmentMainService.args,logLevel:this.loggerMainService.getLogLevel(),loggers:this.loggerMainService.getRegisteredLoggers(),policiesData:this.policyService.serialize()}}async connect(e){return await this.whenIpcReady,mn(this.utilityProcess).connect(e)}};bs=P([h(3,ge),h(4,$t),h(5,le),h(6,B),h(7,oi),h(8,Gn)],bs);var pE="signService",zb=R(pE);var su=class n extends O{constructor(e,r){super();this.logService=e;this.storageMainService=r;this.registerStorageChangeListeners(r.applicationStorage,this.onDidChangeApplicationStorageEmitter)}static STORAGE_CHANGE_DEBOUNCE_TIME=100;onDidChangeApplicationStorageEmitter=this._register(new S);mapProfileToOnDidChangeProfileStorageEmitter=new Map;registerStorageChangeListeners(e,r){this._register(E.debounce(e.onDidChangeStorage,(i,o)=>(i?i.push(o):i=[o],i),n.STORAGE_CHANGE_DEBOUNCE_TIME)(i=>{i.length&&r.fire(this.serializeStorageChangeEvents(i,e))}))}serializeStorageChangeEvents(e,r){let i=new Map,o=new Set;return e.forEach(s=>{let a=r.get(s.key);typeof a=="string"?i.set(s.key,a):o.add(s.key)}),{changed:Array.from(i.entries()),deleted:Array.from(o.values())}}listen(e,r,i){switch(r){case"onDidChangeStorage":{let o=i.profile?Ar(i.profile):void 0;if(!o)return this.onDidChangeApplicationStorageEmitter.event;let s=this.mapProfileToOnDidChangeProfileStorageEmitter.get(o.id);return s||(s=this._register(new S),this.registerStorageChangeListeners(this.storageMainService.profileStorage(o),s),this.mapProfileToOnDidChangeProfileStorageEmitter.set(o.id,s)),s.event}}throw new Error(`Event not found: ${r}`)}async call(e,r,i){let o=i.profile?Ar(i.profile):void 0,s=Bg(i.workspace),a=await this.withStorageInitialized(o,s);switch(r){case"getItems":return Array.from(a.items.entries());case"updateItems":{let l=i;if(l.insert)for(let[c,d]of l.insert)a.set(c,d);l.delete?.forEach(c=>a.delete(c));break}case"optimize":return a.optimize();case"isUsed":{let l=i.payload;if(typeof l=="string")return this.storageMainService.isUsed(l)}default:throw new Error(`Call not found: ${r}`)}}async withStorageInitialized(e,r){let i;r?i=this.storageMainService.workspaceStorage(r):e?i=this.storageMainService.profileStorage(e):i=this.storageMainService.applicationStorage;try{await i.init()}catch(o){this.logService.error(`StorageIPC#init: Unable to init ${r?"workspace":e?"profile":"application"} storage due to ${o}`)}return i}};var au=class{constructor(t){this.channel=t}log(t,e){return this.channel.call("log",{eventName:t,data:e}).then(void 0,r=>`Failed to log telemetry: ${console.warn(r)}`),Promise.resolve(null)}flush(){return Promise.resolve()}};var Is=class{constructor(t,e,r){this._configurationService=e;this._productService=r;this._appenders=t.appenders,this._commonProperties=t.commonProperties??Object.create(null),this.sessionId=this._commonProperties.sessionID,this.machineId=this._commonProperties["common.machineId"],this.sqmId=this._commonProperties["common.sqmId"],this.devDeviceId=this._commonProperties["common.devDeviceId"],this.firstSessionDate=this._commonProperties["common.firstSessionDate"],this.msftInternal=this._commonProperties["common.msftInternal"],this._piiPaths=t.piiPaths||[],this._telemetryLevel=3,this._sendErrorTelemetry=!!t.sendErrorTelemetry,this._cleanupPatterns=[/(vscode-)?file:\/\/\/.*?\/resources\/app\//gi];for(let i of this._piiPaths)this._cleanupPatterns.push(new RegExp(fn(i),"gi")),i.indexOf("\\")>=0&&this._cleanupPatterns.push(new RegExp(fn(i.replace(/\\/g,"/")),"gi"));this._updateTelemetryLevel(),this._disposables.add(this._configurationService.onDidChangeConfiguration(i=>{(i.affectsConfiguration(jo)||i.affectsConfiguration(Ha)||i.affectsConfiguration(ld))&&this._updateTelemetryLevel()}))}static IDLE_START_EVENT_NAME="UserIdleStart";static IDLE_STOP_EVENT_NAME="UserIdleStop";sessionId;machineId;sqmId;devDeviceId;firstSessionDate;msftInternal;_appenders;_commonProperties;_experimentProperties={};_piiPaths;_telemetryLevel;_sendErrorTelemetry;_disposables=new re;_cleanupPatterns=[];setExperimentProperty(t,e){this._experimentProperties[t]=e}_updateTelemetryLevel(){let t=Yo(this._configurationService),e=this._productService.enabledTelemetryLevels;if(e){this._sendErrorTelemetry=this.sendErrorTelemetry?e.error:!1;let r=e.usage?3:e.error?2:0;t=Math.min(t,r)}this._telemetryLevel=t}get sendErrorTelemetry(){return this._sendErrorTelemetry}get telemetryLevel(){return this._telemetryLevel}dispose(){this._disposables.dispose()}_log(t,e,r){this._telemetryLevel<e||(r=cd(r,this._experimentProperties),r=Ry(r,this._cleanupPatterns),r=cd(r,this._commonProperties),this._appenders.forEach(i=>i.log(t,r)))}publicLog(t,e){this._log(t,3,e)}publicLog2(t,e){this.publicLog(t,e)}publicLogError(t,e){this._sendErrorTelemetry&&this._log(t,2,e)}publicLogError2(t,e){this.publicLogError(t,e)}};Is=P([h(1,Ie),h(2,Oe)],Is);function fE(){let n=p("telemetry.telemetryLevelMd","Controls {0} telemetry, first-party extension telemetry, and participating third-party extension telemetry. Some third party extensions might not respect this setting. Consult the specific extension's documentation to be sure. Telemetry helps us better understand how {0} is performing, where improvements need to be made, and how features are being used.",lr.nameLong),t=lr.privacyStatementUrl?p("telemetry.docsAndPrivacyStatement","Read more about the [data we collect]({0}) and our [privacy statement]({1}).","https://aka.ms/vscode-telemetry",lr.privacyStatementUrl):p("telemetry.docsStatement","Read more about the [data we collect]({0}).","https://aka.ms/vscode-telemetry"),e=kr?"":p("telemetry.restart","A full restart of the application is necessary for crash reporting changes to take effect."),r=p("telemetry.crashReports","Crash Reports"),i=p("telemetry.errors","Error Telemetry"),o=p("telemetry.usage","Usage Data"),s=p("telemetry.telemetryLevel.tableDescription","The following table outlines the data sent with each setting:"),a=`
|       | ${r} | ${i} | ${o} |
|:------|:---------------------:|:---------------:|:--------------:|
| all   |            \u2713          |        \u2713        |        \u2713       |
| error |            \u2713          |        \u2713        |        -       |
| crash |            \u2713          |        -        |        -       |
| off   |            -          |        -        |        -       |
`,l=p("telemetry.telemetryLevel.deprecated","****Note:*** If this setting is 'off', no telemetry will be sent regardless of other telemetry settings. If this setting is set to anything except 'off' and telemetry is disabled with deprecated settings, no telemetry will be sent.*");return`
${n} ${t} ${e}

&nbsp;

${s}
${a}

&nbsp;

${l}
`}et.as(yn.Configuration).registerConfiguration({id:_f,order:1,type:"object",title:p("telemetryConfigurationTitle","Telemetry"),properties:{[jo]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[p("telemetry.telemetryLevel.default","Sends usage data, errors, and crash reports."),p("telemetry.telemetryLevel.error","Sends general error telemetry and crash reports."),p("telemetry.telemetryLevel.crash","Sends OS level crash reports."),p("telemetry.telemetryLevel.off","Disables all product telemetry.")],markdownDescription:fE(),default:"all",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"]}}});et.as(yn.Configuration).registerConfiguration({id:_f,order:110,type:"object",title:p("telemetryConfigurationTitle","Telemetry"),properties:{[Ha]:{type:"boolean",markdownDescription:lr.privacyStatementUrl?p("telemetry.enableTelemetryMd","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made. [Read more]({1}) about what we collect and our privacy statement.",lr.nameLong,lr.privacyStatementUrl):p("telemetry.enableTelemetry","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made.",lr.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:p("enableTelemetryDeprecated","If this setting is false, no telemetry will be sent regardless of the new setting's value. Deprecated in favor of the {0} setting.",`\`#${jo}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}});var lu=class{constructor(t){this.service=t}listen(t,e){switch(e){case"onStateChange":return this.service.onStateChange}throw new Error(`Event not found: ${e}`)}call(t,e,r){switch(e){case"checkForUpdates":return this.service.checkForUpdates(r);case"downloadUpdate":return this.service.downloadUpdate();case"applyUpdate":return this.service.applyUpdate();case"quitAndInstall":return this.service.quitAndInstall();case"_getInitialState":return Promise.resolve(this.service.state);case"isLatestVersion":return this.service.isLatestVersion();case"_applySpecificUpdate":return this.service._applySpecificUpdate(r)}throw new Error(`Call not found: ${e}`)}};import*as vi from"electron";function ws(n,t,e){return`${e.updateUrl}/api/update/${n}/${t}/${e.commit}`}var nn=class{constructor(t,e,r,i,o,s){this.lifecycleMainService=t;this.configurationService=e;this.environmentMainService=r;this.requestService=i;this.logService=o;this.productService=s;t.when(3).finally(()=>this.initialize())}url;_state=ue.Uninitialized;_onStateChange=new S;onStateChange=this._onStateChange.event;get state(){return this._state}setState(t){this.logService.info("update#setState",t.type),this._state=t,this._onStateChange.fire(t)}async initialize(){if(!this.environmentMainService.isBuilt){this.setState(ue.Disabled(0));return}if(this.environmentMainService.disableUpdates){this.setState(ue.Disabled(1)),this.logService.info("update#ctor - updates are disabled by the environment");return}if(!this.productService.updateUrl||!this.productService.commit){this.setState(ue.Disabled(3)),this.logService.info("update#ctor - updates are disabled as there is no update URL");return}let t=this.configurationService.getValue("update.mode"),e=this.getProductQuality(t);if(!e){this.setState(ue.Disabled(2)),this.logService.info("update#ctor - updates are disabled by user preference");return}if(this.url=this.buildUpdateFeedUrl(e),!this.url){this.setState(ue.Disabled(4)),this.logService.info("update#ctor - updates are disabled as the update URL is badly formed");return}if(this.configurationService.getValue("_update.prss")){let r=new URL(this.url);r.searchParams.set("prss","true"),this.url=r.toString()}if(this.setState(ue.Idle(this.getUpdateType())),t==="manual"){this.logService.info("update#ctor - manual checks only; automatic updates are disabled by user preference");return}t==="start"?(this.logService.info("update#ctor - startup checks only; automatic updates are disabled by user preference"),setTimeout(()=>this.checkForUpdates(!1),30*1e3)):this.scheduleCheckForUpdates(30*1e3).then(void 0,r=>this.logService.error(r))}getProductQuality(t){return t==="none"?void 0:this.productService.quality}scheduleCheckForUpdates(t=60*60*1e3){return $e(t).then(()=>this.checkForUpdates(!1)).then(()=>this.scheduleCheckForUpdates(60*60*1e3))}async checkForUpdates(t){this.logService.trace("update#checkForUpdates, state = ",this.state.type),this.state.type==="idle"&&this.doCheckForUpdates(t)}async downloadUpdate(){this.logService.trace("update#downloadUpdate, state = ",this.state.type),this.state.type==="available for download"&&await this.doDownloadUpdate(this.state)}async doDownloadUpdate(t){}async applyUpdate(){this.logService.trace("update#applyUpdate, state = ",this.state.type),this.state.type==="downloaded"&&await this.doApplyUpdate()}async doApplyUpdate(){}quitAndInstall(){return this.logService.trace("update#quitAndInstall, state = ",this.state.type),this.state.type!=="ready"||(this.logService.trace("update#quitAndInstall(): before lifecycle quit()"),this.lifecycleMainService.quit(!0).then(t=>{this.logService.trace(`update#quitAndInstall(): after lifecycle quit() with veto: ${t}`),!t&&(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.doQuitAndInstall())})),Promise.resolve(void 0)}async isLatestVersion(){if(!this.url)return;if(this.configurationService.getValue("update.mode")==="none")return!1;try{return(await this.requestService.request({url:this.url},Ee.None)).res.statusCode===204}catch(e){this.logService.error("update#isLatestVersion(): failed to check for updates"),this.logService.error(e);return}}async _applySpecificUpdate(t){}getUpdateType(){return 1}doQuitAndInstall(){}};nn=P([h(0,le),h(1,Ie),h(2,ge),h(3,xr),h(4,B),h(5,Oe)],nn);var on=class extends nn{constructor(e,r,i,o,s,a,l){super(e,r,o,s,a,l);this.telemetryService=i;e.setRelaunchHandler(this)}disposables=new re;get onRawError(){return E.fromNodeEventEmitter(vi.autoUpdater,"error",(e,r)=>r)}get onRawUpdateNotAvailable(){return E.fromNodeEventEmitter(vi.autoUpdater,"update-not-available")}get onRawUpdateAvailable(){return E.fromNodeEventEmitter(vi.autoUpdater,"update-available")}get onRawUpdateDownloaded(){return E.fromNodeEventEmitter(vi.autoUpdater,"update-downloaded",(e,r,i,o)=>({version:i,productVersion:i,timestamp:o}))}handleRelaunch(e){return e?.addArgs||e?.removeArgs||this.state.type!=="ready"?!1:(this.logService.trace("update#handleRelaunch(): running raw#quitAndInstall()"),this.doQuitAndInstall(),!0)}async initialize(){await super.initialize(),this.onRawError(this.onError,this,this.disposables),this.onRawUpdateAvailable(this.onUpdateAvailable,this,this.disposables),this.onRawUpdateDownloaded(this.onUpdateDownloaded,this,this.disposables),this.onRawUpdateNotAvailable(this.onUpdateNotAvailable,this,this.disposables)}onError(e){this.telemetryService.publicLog2("update:error",{messageHash:String(er(String(e)))}),this.logService.error("UpdateService error:",e);let r=this.state.type==="checking for updates"&&this.state.explicit?e:void 0;this.setState(ue.Idle(1,r))}buildUpdateFeedUrl(e){let r;this.productService.darwinUniversalAssetId?r=this.productService.darwinUniversalAssetId:r=process.arch==="x64"?"darwin":"darwin-arm64";let i=ws(r,e,this.productService);try{vi.autoUpdater.setFeedURL({url:i})}catch(o){this.logService.error("Failed to set update feed URL",o);return}return i}doCheckForUpdates(e){this.setState(ue.CheckingForUpdates(e)),vi.autoUpdater.checkForUpdates()}onUpdateAvailable(){this.state.type==="checking for updates"&&this.setState(ue.Downloading)}onUpdateDownloaded(e){this.state.type==="downloading"&&(this.setState(ue.Downloaded(e)),this.telemetryService.publicLog2("update:downloaded",{version:e.version}),this.setState(ue.Ready(e)))}onUpdateNotAvailable(){this.state.type==="checking for updates"&&(this.telemetryService.publicLog2("update:notAvailable",{explicit:this.state.explicit}),this.setState(ue.Idle(1)))}doQuitAndInstall(){this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),vi.autoUpdater.quitAndInstall()}dispose(){this.disposables.dispose()}};P([ie],on.prototype,"onRawError",1),P([ie],on.prototype,"onRawUpdateNotAvailable",1),P([ie],on.prototype,"onRawUpdateAvailable",1),P([ie],on.prototype,"onRawUpdateDownloaded",1),on=P([h(0,le),h(1,Ie),h(2,He),h(3,ge),h(4,xr),h(5,B),h(6,Oe)],on);var xs=class extends nn{constructor(e,r,i,o,s,a,l,c){super(e,r,o,s,a,c);this.telemetryService=i;this.nativeHostMainService=l}buildUpdateFeedUrl(e){return ws(`linux-${process.arch}`,e,this.productService)}doCheckForUpdates(e){this.url&&(this.setState(ue.CheckingForUpdates(e)),this.requestService.request({url:this.url},Ee.None).then(Uc).then(r=>{!r||!r.url||!r.version||!r.productVersion?(this.telemetryService.publicLog2("update:notAvailable",{explicit:!!e}),this.setState(ue.Idle(1))):this.setState(ue.AvailableForDownload(r))}).then(void 0,r=>{this.logService.error(r);let i=e?r.message||r:void 0;this.setState(ue.Idle(1,i))}))}async doDownloadUpdate(e){this.productService.downloadUrl&&this.productService.downloadUrl.length>0?this.nativeHostMainService.openExternal(void 0,this.productService.downloadUrl):e.update.url&&this.nativeHostMainService.openExternal(void 0,e.update.url),this.setState(ue.Idle(1))}};xs=P([h(0,le),h(1,Ie),h(2,He),h(3,ge),h(4,xr),h(5,B),h(6,sr),h(7,Oe)],xs);import{spawn as hE}from"child_process";import{realpath as gE,watch as vE}from"fs";var hl=class{constructor(t,e,r){this.lifecycleMainService=t;this.logService=r;if(e.disableUpdates){this.logService.info("update#ctor - updates are disabled");return}this.setState(ue.Idle(this.getUpdateType())),this.scheduleCheckForUpdates(30*1e3).then(void 0,i=>this.logService.error(i))}_state=ue.Uninitialized;_onStateChange=new S;onStateChange=this._onStateChange.event;get state(){return this._state}setState(t){this.logService.info("update#setState",t.type),this._state=t,this._onStateChange.fire(t)}scheduleCheckForUpdates(t=60*60*1e3){return $e(t).then(()=>this.checkForUpdates(!1)).then(()=>this.scheduleCheckForUpdates(60*60*1e3))}async checkForUpdates(t){this.logService.trace("update#checkForUpdates, state = ",this.state.type),this.state.type==="idle"&&this.doCheckForUpdates(t)}async downloadUpdate(){this.logService.trace("update#downloadUpdate, state = ",this.state.type),this.state.type==="available for download"&&await this.doDownloadUpdate(this.state)}doDownloadUpdate(t){return Promise.resolve(void 0)}async applyUpdate(){this.logService.trace("update#applyUpdate, state = ",this.state.type),this.state.type==="downloaded"&&await this.doApplyUpdate()}doApplyUpdate(){return Promise.resolve(void 0)}quitAndInstall(){return this.logService.trace("update#quitAndInstall, state = ",this.state.type),this.state.type!=="ready"||(this.logService.trace("update#quitAndInstall(): before lifecycle quit()"),this.lifecycleMainService.quit(!0).then(t=>{this.logService.trace(`update#quitAndInstall(): after lifecycle quit() with veto: ${t}`),!t&&(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.doQuitAndInstall())})),Promise.resolve(void 0)}getUpdateType(){return 2}doQuitAndInstall(){}async _applySpecificUpdate(t){}};hl=P([h(0,le),h(1,ge),h(2,B)],hl);var Ss=class extends hl{constructor(e,r,i,o,s,a){super(i,o,s);this.snap=e;this.snapRevision=r;this.telemetryService=a;let l=vE(Fe(this.snap)),c=E.fromNodeEventEmitter(l,"change",(g,b)=>b),d=E.filter(c,g=>g==="current"),m=E.debounce(d,(g,b)=>b,2e3)(()=>this.checkForUpdates(!1));i.onWillShutdown(()=>{m.dispose(),l.close()})}doCheckForUpdates(){this.setState(ue.CheckingForUpdates(!1)),this.isUpdateAvailable().then(e=>{e?this.setState(ue.Ready({version:"something"})):(this.telemetryService.publicLog2("update:notAvailable",{explicit:!1}),this.setState(ue.Idle(2)))},e=>{this.logService.error(e),this.telemetryService.publicLog2("update:notAvailable",{explicit:!1}),this.setState(ue.Idle(2,e.message||e))})}doQuitAndInstall(){this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),hE("sleep 3 && "+ve(process.argv[0]),{shell:!0,detached:!0,stdio:"ignore"})}async isUpdateAvailable(){let e=await new Promise((i,o)=>gE(`${Fe(this.snap)}/current`,(s,a)=>s?o(s):i(a))),r=ve(e);return this.snapRevision!==r}isLatestVersion(){return this.isUpdateAvailable().then(void 0,e=>{this.logService.error("update#checkForSnapUpdate(): Could not get realpath of application.")})}};Ss=P([h(2,le),h(3,ge),h(4,B),h(5,He)],Ss);import{spawn as Gb}from"child_process";import*as eo from"fs";import{tmpdir as yE}from"os";import*as qb from"crypto";import*as $b from"fs";async function jb(n,t){if(await new Promise((i,o)=>{let s=$b.createReadStream(n),a=qb.createHash("sha256");s.pipe(a);let l=po((c,d)=>{s.removeAllListeners(),a.removeAllListeners(),c?o(c):i(d)});s.once("error",l),s.once("end",l),a.once("error",l),a.once("data",c=>l(void 0,c.toString("hex")))})!==t)throw new Error("Hash mismatch")}async function bE(n,t=1e3){for(;!n();)await $e(t)}var Em;function Es(){return typeof Em>"u"&&(Em=eo.existsSync(F(Fe(process.execPath),"unins000.exe"))?0:1),Em}var Zi=class extends nn{constructor(e,r,i,o,s,a,l,c,d){super(e,r,o,s,a,d);this.telemetryService=i;this.fileService=l;this.nativeHostMainService=c;e.setRelaunchHandler(this)}availableUpdate;get cachePath(){let e=F(yE(),`vscode-${this.productService.quality}-${this.productService.target}-${process.arch}`);return eo.promises.mkdir(e,{recursive:!0}).then(()=>e)}handleRelaunch(e){return e?.addArgs||e?.removeArgs||this.state.type!=="ready"||!this.availableUpdate?!1:(this.logService.trace("update#handleRelaunch(): running raw#quitAndInstall()"),this.doQuitAndInstall(),!0)}async initialize(){if(this.productService.target==="user"&&await this.nativeHostMainService.isAdmin(void 0)){this.setState(ue.Disabled(5)),this.logService.info("update#ctor - updates are disabled due to running as Admin in user setup");return}await super.initialize()}buildUpdateFeedUrl(e){let r=`win32-${process.arch}`;return Es()===1?r+="-archive":this.productService.target==="user"&&(r+="-user"),ws(r,e,this.productService)}doCheckForUpdates(e){this.url&&(this.setState(ue.CheckingForUpdates(e)),this.requestService.request({url:this.url},Ee.None).then(Uc).then(r=>{let i=Es();return!r||!r.url||!r.version||!r.productVersion?(this.telemetryService.publicLog2("update:notAvailable",{explicit:!!e}),this.setState(ue.Idle(i)),Promise.resolve(null)):i===1?(this.setState(ue.AvailableForDownload(r)),Promise.resolve(null)):(this.setState(ue.Downloading),this.cleanup(r.version).then(()=>this.getUpdatePackagePath(r.version).then(o=>$.exists(o).then(s=>{if(s)return Promise.resolve(o);let a=`${o}.tmp`;return this.requestService.request({url:r.url},Ee.None).then(l=>this.fileService.writeFile(x.file(a),l.stream)).then(r.sha256hash?()=>jb(a,r.sha256hash):()=>{}).then(()=>$.rename(a,o,!1)).then(()=>o)})).then(o=>{this.availableUpdate={packagePath:o},this.setState(ue.Downloaded(r)),this.configurationService.getValue("update.enableWindowsBackgroundUpdates")?this.productService.target==="user"&&this.doApplyUpdate():this.setState(ue.Ready(r))})))}).then(void 0,r=>{this.telemetryService.publicLog2("update:error",{messageHash:String(er(String(r)))}),this.logService.error(r);let i=e?r.message||r:void 0;this.setState(ue.Idle(Es(),i))}))}async doDownloadUpdate(e){e.update.url&&this.nativeHostMainService.openExternal(void 0,e.update.url),this.setState(ue.Idle(Es()))}async getUpdatePackagePath(e){let r=await this.cachePath;return F(r,`CodeSetup-${this.productService.quality}-${e}.exe`)}async cleanup(e=null){let r=e?a=>!new RegExp(`${this.productService.quality}-${e}\\.exe$`).test(a):()=>!0,i=await this.cachePath,s=(await $.readdir(i)).filter(r).map(async a=>{try{await eo.promises.unlink(F(i,a))}catch{}});await Promise.all(s)}async doApplyUpdate(){if(this.state.type!=="downloaded"||!this.availableUpdate)return Promise.resolve(void 0);let e=this.state.update;this.setState(ue.Updating(e));let r=await this.cachePath;this.availableUpdate.updateFilePath=F(r,`CodeSetup-${this.productService.quality}-${e.version}.flag`),await $.writeFile(this.availableUpdate.updateFilePath,"flag"),Gb(this.availableUpdate.packagePath,["/verysilent","/log",`/update="${this.availableUpdate.updateFilePath}"`,"/nocloseapplications","/mergetasks=runcode,!desktopicon,!quicklaunchicon"],{detached:!0,stdio:["ignore","ignore","ignore"],windowsVerbatimArguments:!0}).once("exit",()=>{this.availableUpdate=void 0,this.setState(ue.Idle(Es()))});let o=`${this.productService.win32MutexName}-ready`,s=await import("@vscode/windows-mutex");bE(()=>s.isActive(o)).then(()=>this.setState(ue.Ready(e)))}doQuitAndInstall(){this.state.type!=="ready"||!this.availableUpdate||(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.availableUpdate.updateFilePath?eo.unlinkSync(this.availableUpdate.updateFilePath):Gb(this.availableUpdate.packagePath,["/silent","/log","/mergetasks=runcode,!desktopicon,!quicklaunchicon"],{detached:!0,stdio:["ignore","ignore","ignore"]}))}getUpdateType(){return Es()}async _applySpecificUpdate(e){if(this.state.type!=="idle")return;let r=this.configurationService.getValue("update.enableWindowsBackgroundUpdates"),i={version:"unknown",productVersion:"unknown"};this.setState(ue.Downloading),this.availableUpdate={packagePath:e},this.setState(ue.Downloaded(i)),r?this.productService.target==="user"&&this.doApplyUpdate():this.setState(ue.Ready(i))}};P([ie],Zi.prototype,"cachePath",1),Zi=P([h(0,le),h(1,Ie),h(2,He),h(3,ge),h(4,xr),h(5,B),h(6,We),h(7,sr),h(8,Oe)],Zi);var du=class{constructor(t){this.channel=t}handleURL(t,e){return this.channel.call("handleURL",[t.toJSON(),e])}},uu=class{constructor(t,e){this.next=t;this.logService=e}async routeCall(t,e,r,i){if(e!=="handleURL")throw new Error(`Call not found: ${e}`);if(Array.isArray(r)&&r.length>0){let o=x.revive(r[0]);if(this.logService.trace("URLHandlerRouter#routeCall() with URI argument",o.toString(!0)),o.query){let s=/\bwindowId=(\d+)/.exec(o.query);if(s){let a=s[1];this.logService.trace(`URLHandlerRouter#routeCall(): found windowId query parameter with value "${a}"`,o.toString(!0));let l=new RegExp(`window:${a}`),c=t.connections.find(d=>(this.logService.trace("URLHandlerRouter#routeCall(): testing connection",d.ctx),l.test(d.ctx)));if(c)return this.logService.trace("URLHandlerRouter#routeCall(): found a connection to route",o.toString(!0)),c;this.logService.trace("URLHandlerRouter#routeCall(): did not find a connection to route",o.toString(!0))}else this.logService.trace("URLHandlerRouter#routeCall(): did not find windowId query parameter",o.toString(!0))}}else this.logService.trace("URLHandlerRouter#routeCall() without URI argument");return this.next.routeCall(t,e,r,i)}routeEvent(t,e){throw new Error(`Event not found: ${e}`)}};var Pm=class extends O{handlers=new Set;open(t,e){let r=[...this.handlers.values()];return Cg(r.map(i=>()=>i.handleURL(t,e)),void 0,!1).then(i=>i||!1)}registerHandler(t){return this.handlers.add(t),Z(()=>this.handlers.delete(t))}},Ps=class extends Pm{constructor(e){super();this.productService=e}create(e){let{authority:r,path:i,query:o,fragment:s}=e||{authority:void 0,path:void 0,query:void 0,fragment:void 0};return r&&i&&i.indexOf("/")!==0&&(i=`/${i}`),x.from({scheme:this.productService.urlProtocol,authority:r,path:i,query:o,fragment:s})}};Ps=P([h(0,Oe)],Ps);import{app as Jb}from"electron";var pu=class extends O{constructor(e,r,i,o,s,a){super();this.urlService=r;this.logService=a;if(e&&(a.trace("ElectronURLListener initialUrisToHandle:",e.map(d=>d.originalUrl)),this.uris=e),N){let d=o.isBuilt?[]:[`"${o.appRoot}"`];d.push("--open-url","--"),Jb.setAsDefaultProtocolClient(s.urlProtocol,process.execPath,d)}let l=E.map(E.fromNodeEventEmitter(Jb,"open-url",(d,f)=>({event:d,url:f})),({event:d,url:f})=>(d.preventDefault(),f));this._register(l(d=>{let f=this.uriFromRawUrl(d);f&&this.urlService.open(f,{originalUrl:d})})),i.getWindows().filter(d=>d.isReady).length>0?(a.trace("ElectronURLListener: window is ready to handle URLs"),this.flush()):(a.trace("ElectronURLListener: waiting for window to be ready to handle URLs..."),this._register(E.once(i.onDidSignalReadyWindow)(()=>this.flush())))}uris=[];retryCount=0;uriFromRawUrl(e){try{return x.parse(e)}catch{return}}async flush(){if(this.retryCount++>10){this.logService.trace("ElectronURLListener#flush(): giving up after 10 retries");return}this.logService.trace("ElectronURLListener#flush(): flushing URLs");let e=[];for(let r of this.uris)await this.urlService.open(r.uri,{originalUrl:r.originalUrl})?this.logService.trace("ElectronURLListener#flush(): URL was handled",r.originalUrl):(this.logService.trace("ElectronURLListener#flush(): URL was not yet handled",r.originalUrl),e.push(r));e.length!==0&&(this.uris=e,kg(()=>this.flush(),500,this._store))}};var Tm=R("webviewManagerService");import{webContents as wE}from"electron";import{protocol as IE}from"electron";var fu=class n extends O{static validWebviewFilePaths=new Map([["/index.html","index.html"],["/fake.html","fake.html"],["/service-worker.js","service-worker.js"]]);constructor(){super();let t=this.handleWebviewRequest.bind(this);IE.registerFileProtocol(U.vscodeWebview,t)}handleWebviewRequest(t,e){try{let r=x.parse(t.url),i=n.validWebviewFilePaths.get(r.path);if(typeof i=="string"){let o=`vs/workbench/contrib/webview/browser/pre/${i}`,s=Me.asFileUri(o);return e({path:s.fsPath,headers:{...mp.getHeadersFromQuery(t.url),"Cross-Origin-Resource-Policy":"cross-origin"}})}else return e({error:-10})}catch{}return e({error:-2})}};var Ts=class extends O{constructor(e){super();this.windowsMainService=e;this._register(new fu)}_onFoundInFrame=this._register(new S);onFoundInFrame=this._onFoundInFrame.event;async setIgnoreMenuShortcuts(e,r){let i;if(typeof e.windowId=="number"){let{windowId:o}=e,s=this.windowsMainService.getWindowById(o);if(!s?.win)throw new Error(`Invalid windowId: ${o}`);i=s.win.webContents}else{let{webContentsId:o}=e;if(i=wE.fromId(o),!i)throw new Error(`Invalid webContentsId: ${o}`)}i.isDestroyed()||i.setIgnoreMenuShortcuts(r)}async findInFrame(e,r,i,o){let a=this.getFrameByName(e,r);if(typeof a.findInFrame=="function"){a.findInFrame(i,{findNext:o.findNext,forward:o.forward});let l=(c,d)=>{d.finalUpdate&&(this._onFoundInFrame.fire(d),a.removeListener("found-in-frame",l))};a.on("found-in-frame",l)}}async stopFindInFrame(e,r,i){let s=this.getFrameByName(e,r);typeof s.stopFindInFrame=="function"&&s.stopFindInFrame(i.keepSelection?"keepSelection":"clearSelection")}getFrameByName(e,r){let i=this.windowsMainService.getWindowById(e.windowId);if(!i?.win)throw new Error(`Invalid windowId: ${e}`);let o=i.win.webContents.mainFrame.framesInSubtree.find(s=>s.name===r);if(!o)throw new Error(`Unknown frame: ${r}`);return o}};Ts=P([h(0,Te)],Ts);import*as Qb from"fs";import{app as EE,BrowserWindow as mu,shell as PE}from"electron";import{hostname as TE,release as kE,arch as CE}from"os";import ks from"electron";var Cn=class extends O{constructor(e,r,i,o,s){super();this.windowsMainService=e;this.stateService=r;this.lifecycleMainService=i;this.logService=o;this.configurationService=s;this.registerListeners()}static windowsStateStorageKey="windowsState";get state(){return this._state}_state=xE(this.stateService.getItem(Cn.windowsStateStorageKey));lastClosedState=void 0;shuttingDown=!1;registerListeners(){ks.app.on("browser-window-blur",()=>{this.shuttingDown||this.saveWindowsState()}),this._register(this.lifecycleMainService.onBeforeCloseWindow(e=>this.onBeforeCloseWindow(e))),this._register(this.lifecycleMainService.onBeforeShutdown(()=>this.onBeforeShutdown())),this._register(this.windowsMainService.onDidChangeWindowsCount(e=>{e.newCount-e.oldCount>0&&(this.lastClosedState=void 0)})),this._register(this.windowsMainService.onDidDestroyWindow(e=>this.onBeforeCloseWindow(e)))}onBeforeShutdown(){this.shuttingDown=!0,this.saveWindowsState()}saveWindowsState(){let e=new Set,r={openedWindows:[],lastPluginDevelopmentHostWindow:this._state.lastPluginDevelopmentHostWindow,lastActiveWindow:this.lastClosedState};if(!r.lastActiveWindow){let s=this.windowsMainService.getLastActiveWindow();(!s||s.isExtensionDevelopmentHost)&&(s=this.windowsMainService.getWindows().find(a=>!a.isExtensionDevelopmentHost)),s&&(r.lastActiveWindow=this.toWindowState(s),r.lastActiveWindow.uiState.mode===3&&e.add(r.lastActiveWindow.uiState.display))}let i=this.windowsMainService.getWindows().find(s=>s.isExtensionDevelopmentHost&&!s.isExtensionTestHost);i&&(r.lastPluginDevelopmentHostWindow=this.toWindowState(i),r.lastPluginDevelopmentHostWindow.uiState.mode===3&&(e.has(r.lastPluginDevelopmentHostWindow.uiState.display)?A&&!i.win?.isSimpleFullScreen()&&(r.lastPluginDevelopmentHostWindow.uiState.mode=1):e.add(r.lastPluginDevelopmentHostWindow.uiState.display))),this.windowsMainService.getWindowCount()>1&&(r.openedWindows=this.windowsMainService.getWindows().filter(s=>!s.isExtensionDevelopmentHost).map(s=>{let a=this.toWindowState(s);return a.uiState.mode===3&&(e.has(a.uiState.display)?A&&a.windowId!==r.lastActiveWindow?.windowId&&!s.win?.isSimpleFullScreen()&&(a.uiState.mode=1):e.add(a.uiState.display)),a}));let o=SE(r);this.stateService.setItem(Cn.windowsStateStorageKey,o),this.shuttingDown&&this.logService.trace("[WindowsStateHandler] onBeforeShutdown",o)}onBeforeCloseWindow(e){if(this.lifecycleMainService.quitRequested)return;let r=this.toWindowState(e);e.isExtensionDevelopmentHost&&!e.isExtensionTestHost?this._state.lastPluginDevelopmentHostWindow=r:!e.isExtensionDevelopmentHost&&e.openedWorkspace&&this._state.openedWindows.forEach(i=>{let o=Ue(e.openedWorkspace)&&i.workspace?.id===e.openedWorkspace.id,s=Ze(e.openedWorkspace)&&i.folderUri&&Ae.isEqual(i.folderUri,e.openedWorkspace.uri);(o||s)&&(i.uiState=r.uiState)}),this.windowsMainService.getWindowCount()===1&&(this.lastClosedState=r)}toWindowState(e){return{windowId:e.id,workspace:Ue(e.openedWorkspace)?e.openedWorkspace:void 0,folderUri:Ze(e.openedWorkspace)?e.openedWorkspace.uri:void 0,backupPath:e.backupPath,remoteAuthority:e.remoteAuthority,uiState:e.serializeWindowState()}}getNewWindowState(e){let r=this.doGetNewWindowState(e),i=this.configurationService.getValue("window");if(r.mode===3){let o;r.hasDefaultState?o=!!(i?.newWindowDimensions&&["fullscreen","inherit","offset"].indexOf(i.newWindowDimensions)>=0):o=!!(this.lifecycleMainService.wasRestarted||i?.restoreFullscreen),o||(r.mode=1)}return r}doGetNewWindowState(e){let r=this.windowsMainService.getLastActiveWindow();if(!e.extensionTestsPath){if(e.extensionDevelopmentPath&&this.state.lastPluginDevelopmentHostWindow)return this.state.lastPluginDevelopmentHostWindow.uiState;let c=e.workspace;if(Ue(c)){let f=this.state.openedWindows.filter(m=>m.workspace&&m.workspace.id===c.id).map(m=>m.uiState);if(f.length)return f[0]}if(Ze(c)){let f=this.state.openedWindows.filter(m=>m.folderUri&&Ae.isEqual(m.folderUri,c.uri)).map(m=>m.uiState);if(f.length)return f[0]}else if(e.backupPath){let f=this.state.openedWindows.filter(m=>m.backupPath===e.backupPath).map(m=>m.uiState);if(f.length)return f[0]}let d=this.lastClosedState||this.state.lastActiveWindow;if(!r&&d)return d.uiState}let i,o=ks.screen.getAllDisplays();if(o.length===1)i=o[0];else{if(A){let c=ks.screen.getCursorScreenPoint();i=ks.screen.getDisplayNearestPoint(c)}!i&&r&&(i=ks.screen.getDisplayMatching(r.getBounds())),i||(i=ks.screen.getPrimaryDisplay()||o[0])}let s=ei();s.x=Math.round(i.bounds.x+i.bounds.width/2-s.width/2),s.y=Math.round(i.bounds.y+i.bounds.height/2-s.height/2);let a=this.configurationService.getValue("window"),l=!0;if(a?.newWindowDimensions){if(a.newWindowDimensions==="maximized")s.mode=0,l=!1;else if(a.newWindowDimensions==="fullscreen")s.mode=3,l=!1;else if((a.newWindowDimensions==="inherit"||a.newWindowDimensions==="offset")&&r){let c=r.serializeWindowState();c.mode===3?s.mode=3:s={...c,zoomLevel:void 0},l=s.mode!==3&&a.newWindowDimensions==="offset"}}return l&&(s=this.ensureNoOverlap(s)),s.hasDefaultState=!0,s}ensureNoOverlap(e){if(this.windowsMainService.getWindows().length===0)return e;e.x=typeof e.x=="number"?e.x:0,e.y=typeof e.y=="number"?e.y:0;let r=this.windowsMainService.getWindows().map(i=>i.getBounds());for(;r.some(i=>i.x===e.x||i.y===e.y);)e.x+=30,e.y+=30;return e}};Cn=P([h(0,Te),h(1,Ye),h(2,le),h(3,B),h(4,Ie)],Cn);function xE(n){let t={openedWindows:[]},e=n||{openedWindows:[]};return e.lastActiveWindow&&(t.lastActiveWindow=km(e.lastActiveWindow)),e.lastPluginDevelopmentHostWindow&&(t.lastPluginDevelopmentHostWindow=km(e.lastPluginDevelopmentHostWindow)),Array.isArray(e.openedWindows)&&(t.openedWindows=e.openedWindows.map(r=>km(r))),t}function km(n){let t={uiState:n.uiState};return n.backupPath&&(t.backupPath=n.backupPath),n.remoteAuthority&&(t.remoteAuthority=n.remoteAuthority),n.folder&&(t.folderUri=x.parse(n.folder)),n.workspaceIdentifier&&(t.workspace={id:n.workspaceIdentifier.id,configPath:x.parse(n.workspaceIdentifier.configURIPath)}),t}function SE(n){return{lastActiveWindow:n.lastActiveWindow&&Cm(n.lastActiveWindow),lastPluginDevelopmentHostWindow:n.lastPluginDevelopmentHostWindow&&Cm(n.lastPluginDevelopmentHostWindow),openedWindows:n.openedWindows.map(t=>Cm(t))}}function Cm(n){return{workspaceIdentifier:n.workspace&&{id:n.workspace.id,configURIPath:n.workspace.configPath.toString()},folder:n.folderUri&&n.folderUri.toString(),backupPath:n.backupPath,remoteAuthority:n.remoteAuthority,uiState:n.uiState}}function hu(n){return Ue(n?.workspace)}function Cs(n){return Ze(n?.workspace)}var _s=class extends O{constructor(e,r,i,o,s,a,l,c,d,f,m,g,b,v,w,k,C,M,_,V,Y,q){super();this.machineId=e;this.sqmId=r;this.devDeviceId=i;this.initialUserEnv=o;this.logService=s;this.loggerService=a;this.stateService=l;this.policyService=c;this.environmentMainService=d;this.userDataProfilesMainService=f;this.lifecycleMainService=m;this.backupMainService=g;this.configurationService=b;this.workspacesHistoryMainService=v;this.workspacesManagementMainService=w;this.instantiationService=k;this.dialogMainService=C;this.fileService=M;this.protocolMainService=_;this.themeMainService=V;this.auxiliaryWindowsMainService=Y;this.cssDevelopmentService=q;this.registerListeners()}_onDidOpenWindow=this._register(new S);onDidOpenWindow=this._onDidOpenWindow.event;_onDidSignalReadyWindow=this._register(new S);onDidSignalReadyWindow=this._onDidSignalReadyWindow.event;_onDidDestroyWindow=this._register(new S);onDidDestroyWindow=this._onDidDestroyWindow.event;_onDidChangeWindowsCount=this._register(new S);onDidChangeWindowsCount=this._onDidChangeWindowsCount.event;_onDidMaximizeWindow=this._register(new S);onDidMaximizeWindow=this._onDidMaximizeWindow.event;_onDidUnmaximizeWindow=this._register(new S);onDidUnmaximizeWindow=this._onDidUnmaximizeWindow.event;_onDidChangeFullScreen=this._register(new S);onDidChangeFullScreen=this._onDidChangeFullScreen.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;windows=new Map;windowsStateHandler=this._register(new Cn(this,this.stateService,this.lifecycleMainService,this.logService,this.configurationService));registerListeners(){this._register(this.workspacesManagementMainService.onDidEnterWorkspace(e=>this._onDidSignalReadyWindow.fire(e.window))),this._register(this.onDidSignalReadyWindow(e=>{if(e.config?.extensionDevelopmentPath||e.config?.extensionTestsPath){let r=new re;if(r.add(E.any(e.onDidClose,e.onDidDestroy)(()=>r.dispose())),e.config.extensionDevelopmentPath)for(let i of e.config.extensionDevelopmentPath)r.add(this.protocolMainService.addValidFileRoot(i));e.config.extensionTestsPath&&r.add(this.protocolMainService.addValidFileRoot(e.config.extensionTestsPath))}}))}openEmptyWindow(e,r){let i=this.environmentMainService.args,o=r?.remoteAuthority||void 0,s=!0,a=r?.forceReuseWindow,l=!a;return this.open({...e,cli:i,forceEmpty:s,forceNewWindow:l,forceReuseWindow:a,remoteAuthority:o,forceTempProfile:r?.forceTempProfile,forceProfile:r?.forceProfile})}openExistingWindow(e,r){e.focus(),this.handleWaitMarkerFile(r,[e])}async open(e){this.logService.trace("windowsManager#open"),e.addMode&&(e.initialStartup||!this.getLastActiveWindow())&&(e.addMode=!1);let r=[],i=[],o=[],s=[],a=[],l,c=!1,d=await this.getPathsToOpen(e);this.logService.trace("windowsManager#open pathsToOpen",d);for(let v of d)Cs(v)?e.addMode?r.push(v):i.push(v):hu(v)?o.push(v):v.fileUri?(l||(l={filesToOpenOrCreate:[],filesToDiff:[],filesToMerge:[],remoteAuthority:v.remoteAuthority}),l.filesToOpenOrCreate.push(v)):v.backupPath?a.push({backupFolder:ve(v.backupPath),remoteAuthority:v.remoteAuthority}):c=!0;e.diffMode&&l&&l.filesToOpenOrCreate.length>=2&&(l.filesToDiff=l.filesToOpenOrCreate.slice(0,2),l.filesToOpenOrCreate=[]),e.mergeMode&&l&&l.filesToOpenOrCreate.length===4&&(l.filesToMerge=l.filesToOpenOrCreate.slice(0,4),l.filesToOpenOrCreate=[],l.filesToDiff=[]),l&&e.waitMarkerFileURI&&(l.filesToWait={paths:pt([...l.filesToDiff,l.filesToMerge[3],...l.filesToOpenOrCreate]),waitMarkerFileUri:e.waitMarkerFileURI}),e.initialStartup?(s.push(...this.workspacesManagementMainService.getUntitledWorkspaces()),o.push(...s),a.push(...this.backupMainService.getEmptyWindowBackups())):a.length=0;let{windows:f,filesOpenedInWindow:m}=await this.doOpen(e,o,i,a,c,l,r);if(this.logService.trace(`windowsManager#open used window count ${f.length} (workspacesToOpen: ${o.length}, foldersToOpen: ${i.length}, emptyToRestore: ${a.length}, openOneEmptyWindow: ${c})`),f.length>1)if(m)m.focus();else{let v=this.windowsStateHandler.state.lastActiveWindow&&!e.forceEmpty&&!e.cli._.length&&!e.cli["file-uri"]&&!e.cli["folder-uri"]&&!(e.urisToOpen&&e.urisToOpen.length),w=!0,k=!0;if(v){let C=f.filter(M=>this.windowsStateHandler.state.lastActiveWindow&&M.backupPath===this.windowsStateHandler.state.lastActiveWindow.backupPath);C.length&&(C[0].focus(),w=!1,k=!1)}if(w)for(let C=f.length-1;C>=0;C--){let M=f[C];if(!(M.openedWorkspace&&s.some(_=>M.openedWorkspace&&_.workspace.id===M.openedWorkspace.id)||M.backupPath&&a.some(_=>M.backupPath&&_.backupFolder===ve(M.backupPath)))){M.focus(),k=!1;break}}k&&f[f.length-1].focus()}let g=l&&l.filesToDiff.length>0,b=l&&l.filesToMerge.length>0;if(!f.some(v=>v.isExtensionDevelopmentHost)&&!g&&!b&&!e.noRecentEntry){let v=[];for(let w of d)hu(w)&&!w.transient?v.push({label:w.label,workspace:w.workspace,remoteAuthority:w.remoteAuthority}):Cs(w)?v.push({label:w.label,folderUri:w.workspace.uri,remoteAuthority:w.remoteAuthority}):w.fileUri&&v.push({label:w.label,fileUri:w.fileUri,remoteAuthority:w.remoteAuthority});this.workspacesHistoryMainService.addRecentlyOpened(v)}return this.handleWaitMarkerFile(e,f),f}handleWaitMarkerFile(e,r){let i=e.waitMarkerFileURI;e.context===0&&i&&r.length===1&&r[0]&&(async()=>{await r[0].whenClosedOrLoaded;try{await this.fileService.del(i)}catch{}})()}async doOpen(e,r,i,o,s,a,l){let c=[],d;function f(C,M){c.push(C),M&&(d=C,a=void 0)}let{openFolderInNewWindow:m,openFilesInNewWindow:g}=this.shouldOpenNewWindow(e);if(!e.initialStartup&&l.length>0){let C=l[0].remoteAuthority,M=this.getLastActiveWindowForAuthority(C);M&&f(this.doAddFoldersToExistingWindow(M,l.map(_=>_.workspace.uri)))}let b=i.length+r.length+o.length;if(a&&b===0){let C=a.filesToOpenOrCreate[0]||a.filesToDiff[0]||a.filesToMerge[3],M=this.getWindows().filter(V=>a&&Ft(V.remoteAuthority,a.remoteAuthority)),_;C?.fileUri&&!g&&((e.context===4||e.context===0||e.context===1||e.context===6)&&(_=await Vy(M,C.fileUri,async V=>V.configPath.scheme===U.file?this.workspacesManagementMainService.resolveLocalWorkspace(V.configPath):void 0)),_||(_=this.doGetLastActiveWindow(M))),_?Ue(_.openedWorkspace)?r.push({workspace:_.openedWorkspace,remoteAuthority:_.remoteAuthority}):Ze(_.openedWorkspace)?i.push({workspace:_.openedWorkspace,remoteAuthority:_.remoteAuthority}):f(this.doOpenFilesInExistingWindow(e,_,a),!0):f(await this.openInBrowserWindow({userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,filesToOpen:a,forceNewWindow:!0,remoteAuthority:a.remoteAuthority,forceNewTabbedWindow:e.forceNewTabbedWindow,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile}),!0)}let v=Si(r,C=>C.workspace.id);if(v.length>0){let C=pt(v.map(M=>ii(this.getWindows(),M.workspace.configPath)));if(C.length>0){let M=C[0],_=Ft(a?.remoteAuthority,M.remoteAuthority)?a:void 0;f(this.doOpenFilesInExistingWindow(e,M,_),!!_),m=!0}for(let M of v){if(C.some(Y=>Y.openedWorkspace&&Y.openedWorkspace.id===M.workspace.id))continue;let _=M.remoteAuthority,V=Ft(a?.remoteAuthority,_)?a:void 0;f(await this.doOpenFolderOrWorkspace(e,M,m,V),!!V),m=!0}}let w=Si(i,C=>Ae.getComparisonKey(C.workspace.uri));if(w.length>0){let C=pt(w.map(M=>ii(this.getWindows(),M.workspace.uri)));if(C.length>0){let M=C[0],_=Ft(a?.remoteAuthority,M.remoteAuthority)?a:void 0;f(this.doOpenFilesInExistingWindow(e,M,_),!!_),m=!0}for(let M of w){if(C.some(Y=>Ze(Y.openedWorkspace)&&Ae.isEqual(Y.openedWorkspace.uri,M.workspace.uri)))continue;let _=M.remoteAuthority,V=Ft(a?.remoteAuthority,_)?a:void 0;f(await this.doOpenFolderOrWorkspace(e,M,m,V),!!V),m=!0}}let k=Si(o,C=>C.backupFolder);if(k.length>0)for(let C of k){let M=C.remoteAuthority,_=Ft(a?.remoteAuthority,M)?a:void 0;f(await this.doOpenEmpty(e,!0,M,_,C),!!_),m=!0}if(a||s){let C=a?a.remoteAuthority:e.remoteAuthority;f(await this.doOpenEmpty(e,m,C,a),!!a)}return{windows:Si(c),filesOpenedInWindow:d}}doOpenFilesInExistingWindow(e,r,i){this.logService.trace("windowsManager#doOpenFilesInExistingWindow",{filesToOpen:i}),this.focusMainOrChildWindow(r);let o={filesToOpenOrCreate:i?.filesToOpenOrCreate,filesToDiff:i?.filesToDiff,filesToMerge:i?.filesToMerge,filesToWait:i?.filesToWait,termProgram:e?.userEnv?.TERM_PROGRAM};return r.sendWhenReady("vscode:openFiles",Ee.None,o),r}focusMainOrChildWindow(e){let r=e,i=mu.getFocusedWindow();if(i&&i.id!==e.id){let o=this.auxiliaryWindowsMainService.getWindowByWebContents(i.webContents);o&&o.parentId===e.id&&(r=o)}r.focus()}doAddFoldersToExistingWindow(e,r){this.logService.trace("windowsManager#doAddFoldersToExistingWindow",{foldersToAdd:r}),e.focus();let i={foldersToAdd:r};return e.sendWhenReady("vscode:addFolders",Ee.None,i),e}doOpenEmpty(e,r,i,o,s){this.logService.trace("windowsManager#doOpenEmpty",{restore:!!s,remoteAuthority:i,filesToOpen:o,forceNewWindow:r});let a;return!r&&typeof e.contextWindowId=="number"&&(a=this.getWindowById(e.contextWindowId)),this.openInBrowserWindow({userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,remoteAuthority:i,forceNewWindow:r,forceNewTabbedWindow:e.forceNewTabbedWindow,filesToOpen:o,windowToUse:a,emptyWindowBackupInfo:s,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile})}doOpenFolderOrWorkspace(e,r,i,o,s){return this.logService.trace("windowsManager#doOpenFolderOrWorkspace",{folderOrWorkspace:r,filesToOpen:o}),!i&&!s&&typeof e.contextWindowId=="number"&&(s=this.getWindowById(e.contextWindowId)),this.openInBrowserWindow({workspace:r.workspace,userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,remoteAuthority:r.remoteAuthority,forceNewWindow:i,forceNewTabbedWindow:e.forceNewTabbedWindow,filesToOpen:o,windowToUse:s,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile})}async getPathsToOpen(e){let r,i=!1,o=!1;if(e.urisToOpen&&e.urisToOpen.length>0?(r=await this.doExtractPathsFromAPI(e),i=!0):e.forceEmpty?r=[Object.create(null)]:e.cli._.length||e.cli["folder-uri"]||e.cli["file-uri"]?(r=await this.doExtractPathsFromCLI(e.cli),r.length===0&&r.push(Object.create(null)),i=!0):(r=await this.doGetPathsFromLastSession(),r.length===0&&r.push(Object.create(null)),o=!0),!e.addMode&&i){let s=r.filter(a=>Cs(a));if(s.length>1){let a=s[0].remoteAuthority;if(s.every(l=>Ft(l.remoteAuthority,a))){let l=await this.workspacesManagementMainService.createUntitledWorkspace(s.map(c=>({uri:c.workspace.uri})));r.push({workspace:l,remoteAuthority:a}),r=r.filter(c=>!Cs(c))}}}if(e.initialStartup&&!o&&this.configurationService.getValue("window")?.restoreWindows==="preserve"){let s=await this.doGetPathsFromLastSession();r.unshift(...s.filter(a=>hu(a)||Cs(a)||a.backupPath))}return r}async doExtractPathsFromAPI(e){let r={gotoLineMode:e.gotoLineMode,remoteAuthority:e.remoteAuthority},i=await Promise.all(pt(e.urisToOpen||[]).map(async o=>{let s=await this.resolveOpenable(o,r);if(s)return s.label=o.label,s;let a=this.resourceFromOpenable(o);this.dialogMainService.showMessageBox({type:"info",buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK")],message:a.scheme===U.file?p("pathNotExistTitle","Path does not exist"):p("uriInvalidTitle","URI can not be opened"),detail:a.scheme===U.file?p("pathNotExistDetail","The path '{0}' does not exist on this computer.",Oi(a,{os:ur,tildify:this.environmentMainService})):p("uriInvalidDetail","The URI '{0}' is not valid and can not be opened.",a.toString(!0))},mu.getFocusedWindow()??void 0)}));return pt(i)}async doExtractPathsFromCLI(e){let r=[],i={ignoreFileNotFound:!0,gotoLineMode:e.goto,remoteAuthority:e.remote||void 0,forceOpenWorkspaceAsFile:e.diff&&e._.length===2||e.merge&&e._.length===4},o=e["folder-uri"];if(o){let l=await Promise.all(o.map(c=>{let d=this.cliArgToUri(c);if(d)return this.resolveOpenable({folderUri:d},i)}));r.push(...pt(l))}let s=e["file-uri"];if(s){let l=await Promise.all(s.map(c=>{let d=this.cliArgToUri(c);if(d)return this.resolveOpenable(Qr(c)?{workspaceUri:d}:{fileUri:d},i)}));r.push(...pt(l))}let a=await Promise.all(e._.map(l=>i.remoteAuthority?this.doResolveRemotePath(l,i):this.doResolveFilePath(l,i)));return r.push(...pt(a)),r}cliArgToUri(e){try{let r=x.parse(e);if(!r.scheme){this.logService.error(`Invalid URI input string, scheme missing: ${e}`);return}return r.path?r:r.with({path:"/"})}catch(r){this.logService.error(`Invalid URI input string: ${e}, ${r.message}`)}}async doGetPathsFromLastSession(){let e=this.getRestoreWindowsSetting();switch(e){case"none":return[];case"one":case"all":case"preserve":case"folders":{let r=[];e!=="one"&&r.push(...this.windowsStateHandler.state.openedWindows),this.windowsStateHandler.state.lastActiveWindow&&r.push(this.windowsStateHandler.state.lastActiveWindow);let i=await Promise.all(r.map(async o=>{if(o.workspace){let s=await this.resolveOpenable({workspaceUri:o.workspace.configPath},{remoteAuthority:o.remoteAuthority,rejectTransientWorkspaces:!0});if(hu(s))return s}else if(o.folderUri){let s=await this.resolveOpenable({folderUri:o.folderUri},{remoteAuthority:o.remoteAuthority});if(Cs(s))return s}else if(e!=="folders"&&o.backupPath)return{backupPath:o.backupPath,remoteAuthority:o.remoteAuthority}}));return pt(i)}}}getRestoreWindowsSetting(){let e;return this.lifecycleMainService.wasRestarted?e="all":(e=this.configurationService.getValue("window")?.restoreWindows||"all",["preserve","all","folders","one","none"].includes(e)||(e="all")),e}async resolveOpenable(e,r=Object.create(null)){let i=this.resourceFromOpenable(e);return i.scheme===U.file?(Pf(e)&&(r={...r,forceOpenWorkspaceAsFile:!0}),this.doResolveFilePath(i.fsPath,r)):this.doResolveRemoteOpenable(e,r)}doResolveRemoteOpenable(e,r){let i=this.resourceFromOpenable(e),o=wn(i)||r.remoteAuthority;if(i=gg(hg(i)),Pf(e)){if(r.gotoLineMode){let{path:s,line:a,column:l}=sc(i.path);return{fileUri:i.with({path:s}),options:{selection:a?{startLineNumber:a,startColumn:l||1}:void 0},remoteAuthority:o}}return{fileUri:i,remoteAuthority:o}}else if(Ka(e))return{workspace:Sn(i),remoteAuthority:o};return{workspace:xd(i),remoteAuthority:o}}resourceFromOpenable(e){return Ka(e)?e.workspaceUri:ed(e)?e.folderUri:e.fileUri}async doResolveFilePath(e,r,i){let o,s;r.gotoLineMode&&({path:e,line:o,column:s}=sc(e)),e=cg(ct(e),pr());try{let a=await Qb.promises.stat(e);if(a.isFile()){if(!r.forceOpenWorkspaceAsFile){let l=await this.workspacesManagementMainService.resolveLocalWorkspace(x.file(e));if(l)return l.transient&&r.rejectTransientWorkspaces?void 0:{workspace:{id:l.id,configPath:l.configPath},type:1,exists:!0,remoteAuthority:l.remoteAuthority,transient:l.transient}}return{fileUri:x.file(e),type:1,exists:!0,options:{selection:o?{startLineNumber:o,startColumn:s||1}:void 0}}}else{if(a.isDirectory())return{workspace:xd(x.file(e),a),type:2,exists:!0};if(!N&&e==="/dev/null")return{fileUri:x.file(e),type:1,exists:!0}}}catch(a){if(a.code==="ERR_UNC_HOST_NOT_ALLOWED"&&!i)return this.onUNCHostNotAllowed(e,r);let l=x.file(e);if(this.workspacesHistoryMainService.removeRecentlyOpened([l]),r.ignoreFileNotFound)return{fileUri:l,type:1,exists:!1}}}async onUNCHostNotAllowed(e,r){let i=x.file(e),{response:o,checkboxChecked:s}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"allow",comment:["&& denotes a mnemonic"]},"&&Allow"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&Cancel"),p({key:"learnMore",comment:["&& denotes a mnemonic"]},"&&Learn More")],message:p("confirmOpenMessage","The host '{0}' was not found in the list of allowed hosts. Do you want to allow it anyway?",i.authority),detail:p("confirmOpenDetail","The path '{0}' uses a host that is not allowed. Unless you trust the host, you should press 'Cancel'",Oi(i,{os:ur,tildify:this.environmentMainService})),checkboxLabel:p("doNotAskAgain","Permanently allow host '{0}'",i.authority),cancelId:1});if(o===0){if(Tl(i.authority),s){let a={channel:"vscode:configureAllowedUNCHost",args:i.authority};this.sendToFocused(a.channel,a.args),this.sendToOpeningWindow(a.channel,a.args)}return this.doResolveFilePath(e,r,!0)}if(o===2)return PE.openExternal("https://aka.ms/vscode-windows-unc"),this.onUNCHostNotAllowed(e,r)}doResolveRemotePath(e,r){let i=e.charCodeAt(0),o=r.remoteAuthority,s,a;r.gotoLineMode&&({path:e,line:s,column:a}=sc(e)),i!==47&&(oc(i)&&e.charCodeAt(e.charCodeAt(1))===58&&(e=Gr(e)),e=`/${e}`);let l=x.from({scheme:U.vscodeRemote,authority:o,path:e});if(e.charCodeAt(e.length-1)!==47){if(Qr(e))return r.forceOpenWorkspaceAsFile?{fileUri:l,options:{selection:s?{startLineNumber:s,startColumn:a||1}:void 0},remoteAuthority:r.remoteAuthority}:{workspace:Sn(l),remoteAuthority:o};if(r.gotoLineMode||Q.basename(e).indexOf(".")!==-1)return{fileUri:l,options:{selection:s?{startLineNumber:s,startColumn:a||1}:void 0},remoteAuthority:o}}return{workspace:xd(l),remoteAuthority:o}}shouldOpenNewWindow(e){let r=this.configurationService.getValue("window"),i=r?.openFoldersInNewWindow||"default",o=r?.openFilesInNewWindow||"off",s=(e.preferNewWindow||e.forceNewWindow)&&!e.forceReuseWindow;!e.forceNewWindow&&!e.forceReuseWindow&&(i==="on"||i==="off")&&(s=i==="on");let a=!1;return e.forceNewWindow||e.forceReuseWindow?a=!!e.forceNewWindow&&!e.forceReuseWindow:(A?e.context===1&&(a=!0):e.context!==3&&e.context!==2&&!(e.userEnv&&e.userEnv.TERM_PROGRAM==="vscode")&&(a=!0),!e.cli.extensionDevelopmentPath&&(o==="on"||o==="off")&&(a=o==="on")),{openFolderInNewWindow:!!s,openFilesInNewWindow:a}}async openExtensionDevelopmentHostWindow(e,r){let i=Ky(this.getWindows(),e);if(i)return this.lifecycleMainService.reload(i,r.cli),i.focus(),[i];let o=r.cli["folder-uri"]||[],s=r.cli["file-uri"]||[],a=r.cli._;if(!a.length&&!o.length&&!s.length&&!r.cli.extensionTestsPath){let d=this.windowsStateHandler.state.lastPluginDevelopmentHostWindow,f=d?.workspace??d?.folderUri;f&&(x.isUri(f)?f.scheme===U.file?a=[f.fsPath]:o=[f.toString()]:f.configPath.scheme===U.file?a=[Et(f.configPath)]:s=[f.configPath.toString()])}let l=r.remoteAuthority;for(let d of e)if(d.match(/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/)){let f=x.parse(d),m=wn(f);m&&(l?Ft(m,l)||this.logService.error("more than one extension development path authority"):l=m)}a=a.filter(d=>{let f=x.file(d);return ii(this.getWindows(),f)?!1:Ft(wn(f),l)}),o=o.filter(d=>{let f=this.cliArgToUri(d);return f&&ii(this.getWindows(),f)?!1:f?Ft(wn(f),l):!1}),s=s.filter(d=>{let f=this.cliArgToUri(d);return f&&ii(this.getWindows(),f)?!1:f?Ft(wn(f),l):!1}),r.cli._=a,r.cli["folder-uri"]=o,r.cli["file-uri"]=s;let c={context:r.context,cli:r.cli,forceNewWindow:!0,forceEmpty:!a.length&&!o.length&&!s.length,userEnv:r.userEnv,noRecentEntry:!0,waitMarkerFileURI:r.waitMarkerFileURI,remoteAuthority:l,forceProfile:r.forceProfile,forceTempProfile:r.forceTempProfile};return this.open(c)}async openInBrowserWindow(e){let r=this.configurationService.getValue("window"),i=this.getLastActiveWindow(),s=(r?.newWindowProfile?this.userDataProfilesMainService.profiles.find(c=>c.name===r.newWindowProfile):void 0)??i?.profile??this.userDataProfilesMainService.defaultProfile,a;!e.forceNewWindow&&!e.forceNewTabbedWindow&&(a=e.windowToUse||i,a&&a.focus());let l={...this.environmentMainService.args,...e.cli,machineId:this.machineId,sqmId:this.sqmId,devDeviceId:this.devDeviceId,windowId:-1,mainPid:process.pid,appRoot:this.environmentMainService.appRoot,execPath:process.execPath,codeCachePath:this.environmentMainService.codeCachePath,backupPath:e.emptyWindowBackupInfo?F(this.environmentMainService.backupHome,e.emptyWindowBackupInfo.backupFolder):void 0,profiles:{home:this.userDataProfilesMainService.profilesHome,all:this.userDataProfilesMainService.profiles,profile:s},homeDir:this.environmentMainService.userHome.with({scheme:U.file}).fsPath,tmpDir:this.environmentMainService.tmpDir.with({scheme:U.file}).fsPath,userDataDir:this.environmentMainService.userDataPath,remoteAuthority:e.remoteAuthority,workspace:e.workspace,userEnv:{...this.initialUserEnv,...e.userEnv},nls:{messages:ln(),language:Tr()},filesToOpenOrCreate:e.filesToOpen?.filesToOpenOrCreate,filesToDiff:e.filesToOpen?.filesToDiff,filesToMerge:e.filesToOpen?.filesToMerge,filesToWait:e.filesToOpen?.filesToWait,logLevel:this.loggerService.getLogLevel(),loggers:{window:[],global:this.loggerService.getRegisteredLoggers()},logsPath:this.environmentMainService.logsHome.with({scheme:U.file}).fsPath,product:lr,isInitialStartup:e.initialStartup,perfMarks:Nc(),os:{release:kE(),hostname:TE(),arch:CE()},autoDetectHighContrast:r?.autoDetectHighContrast??!0,autoDetectColorScheme:r?.autoDetectColorScheme??!1,accessibilitySupport:EE.accessibilitySupportEnabled,colorScheme:this.themeMainService.getColorScheme(),policiesData:this.policyService.serialize(),continueOn:this.environmentMainService.continueOn,cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0};if(a){let c=a.config;!l.extensionDevelopmentPath&&c?.extensionDevelopmentPath&&(l.extensionDevelopmentPath=c.extensionDevelopmentPath,l.extensionDevelopmentKind=c.extensionDevelopmentKind,l["enable-proposed-api"]=c["enable-proposed-api"],l.verbose=c.verbose,l["inspect-extensions"]=c["inspect-extensions"],l["inspect-brk-extensions"]=c["inspect-brk-extensions"],l.debugId=c.debugId,l.extensionEnvironment=c.extensionEnvironment,l["extensions-dir"]=c["extensions-dir"],l["disable-extensions"]=c["disable-extensions"]),l.loggers={global:l.loggers.global,window:c?.loggers.window??l.loggers.window}}else{let c=this.windowsStateHandler.getNewWindowState(l);Sr("code/willCreateCodeWindow");let d=a=this.instantiationService.createInstance(zi,{state:c,extensionDevelopmentPath:l.extensionDevelopmentPath,isExtensionTestHost:!!l.extensionTestsPath});Sr("code/didCreateCodeWindow"),e.forceNewTabbedWindow&&this.getLastActiveWindow()?.addTabbedWindow(d),this.windows.set(d.id,d),this._onDidOpenWindow.fire(d),this._onDidChangeWindowsCount.fire({oldCount:this.getWindowCount()-1,newCount:this.getWindowCount()});let f=new re;f.add(d.onDidSignalReady(()=>this._onDidSignalReadyWindow.fire(d))),f.add(E.once(d.onDidClose)(()=>this.onWindowClosed(d,f))),f.add(E.once(d.onDidDestroy)(()=>this.onWindowDestroyed(d))),f.add(d.onDidMaximize(()=>this._onDidMaximizeWindow.fire(d))),f.add(d.onDidUnmaximize(()=>this._onDidUnmaximizeWindow.fire(d))),f.add(d.onDidEnterFullScreen(()=>this._onDidChangeFullScreen.fire({window:d,fullscreen:!0}))),f.add(d.onDidLeaveFullScreen(()=>this._onDidChangeFullScreen.fire({window:d,fullscreen:!1}))),f.add(d.onDidTriggerSystemContextMenu(({x:g,y:b})=>this._onDidTriggerSystemContextMenu.fire({window:d,x:g,y:b})));let m=mn(d.win?.webContents);m.removeAllListeners("devtools-reload-page"),f.add(E.fromNodeEventEmitter(m,"devtools-reload-page")(()=>this.lifecycleMainService.reload(d))),this.lifecycleMainService.registerWindow(d)}return l.windowId=a.id,a.isReady?this.lifecycleMainService.unload(a,4).then(async c=>{c||await this.doOpenInBrowserWindow(a,l,e,s)}):await this.doOpenInBrowserWindow(a,l,e,s),a}async doOpenInBrowserWindow(e,r,i,o){if(r.extensionDevelopmentPath||(Ue(r.workspace)?r.backupPath=this.backupMainService.registerWorkspaceBackup({workspace:r.workspace,remoteAuthority:r.remoteAuthority}):Ze(r.workspace)?r.backupPath=this.backupMainService.registerFolderBackup({folderUri:r.workspace.uri,remoteAuthority:r.remoteAuthority}):r.backupPath=this.backupMainService.registerEmptyWindowBackup({backupFolder:i.emptyWindowBackupInfo?.backupFolder??Qa().id,remoteAuthority:r.remoteAuthority})),this.userDataProfilesMainService.isEnabled()){let s=r.workspace??$n(r.backupPath,!1),a=this.resolveProfileForBrowserWindow(i,s,o),l=a instanceof Promise?await a:a;r.profiles.profile=l,r.extensionDevelopmentPath||await this.userDataProfilesMainService.setProfileForWorkspace(s,l)}e.load(r)}resolveProfileForBrowserWindow(e,r,i){return e.forceProfile?this.userDataProfilesMainService.profiles.find(o=>o.name===e.forceProfile)??this.userDataProfilesMainService.createNamedProfile(e.forceProfile):e.forceTempProfile?this.userDataProfilesMainService.createTransientProfile():this.userDataProfilesMainService.getProfileForWorkspace(r)??i}onWindowClosed(e,r){this.windows.delete(e.id),this._onDidChangeWindowsCount.fire({oldCount:this.getWindowCount()+1,newCount:this.getWindowCount()}),r.dispose()}onWindowDestroyed(e){this.windows.delete(e.id),this._onDidDestroyWindow.fire(e)}getFocusedWindow(){let e=mu.getFocusedWindow();if(e)return this.getWindowById(e.id)}getLastActiveWindow(){return this.doGetLastActiveWindow(this.getWindows())}getLastActiveWindowForAuthority(e){return this.doGetLastActiveWindow(this.getWindows().filter(r=>Ft(r.remoteAuthority,e)))}doGetLastActiveWindow(e){return gd(e)}sendToFocused(e,...r){(this.getFocusedWindow()||this.getLastActiveWindow())?.sendWhenReady(e,Ee.None,...r)}sendToOpeningWindow(e,...r){this._register(E.once(this.onDidSignalReadyWindow)(i=>{i.sendWhenReady(e,Ee.None,...r)}))}sendToAll(e,r,i){for(let o of this.getWindows())i&&i.indexOf(o.id)>=0||o.sendWhenReady(e,Ee.None,r)}getWindows(){return Array.from(this.windows.values())}getWindowCount(){return this.windows.size}getWindowById(e){return this.windows.get(e)}getWindowByWebContents(e){let r=mu.fromWebContents(e);if(!r)return;let i=this.getWindowById(r.id);return i?.matches(e)?i:void 0}};_s=P([h(4,B),h(5,oi),h(6,Ye),h(7,Gn),h(8,ge),h(9,ir),h(10,le),h(11,en),h(12,Ie),h(13,gi),h(14,or),h(15,tr),h(16,Mt),h(17,We),h(18,ti),h(19,ri),h(20,Pn),h(21,pi)],_s);var gu=class extends O{disposables=this._register(new re);firstActiveWindowIdPromise;activeWindowId;constructor({onDidOpenMainWindow:t,onDidFocusMainWindow:e,getActiveWindowId:r}){super(),E.latch(E.any(t,e))(this.setActiveWindow,this,this.disposables),this.firstActiveWindowIdPromise=Hn(()=>r()),(async()=>{try{let o=await this.firstActiveWindowIdPromise;this.activeWindowId=typeof this.activeWindowId=="number"?this.activeWindowId:o}catch{}finally{this.firstActiveWindowIdPromise=void 0}})()}setActiveWindow(t){this.firstActiveWindowIdPromise&&(this.firstActiveWindowIdPromise.cancel(),this.firstActiveWindowIdPromise=void 0),this.activeWindowId=t}async getActiveClientId(){return`window:${this.firstActiveWindowIdPromise?await this.firstActiveWindowIdPromise:this.activeWindowId}`}};var Ds=class{constructor(t,e,r,i){this.workspacesManagementMainService=t;this.windowsMainService=e;this.workspacesHistoryMainService=r;this.backupMainService=i}async enterWorkspace(t,e){let r=this.windowsMainService.getWindowById(t);if(r)return this.workspacesManagementMainService.enterWorkspace(r,this.windowsMainService.getWindows(),e)}createUntitledWorkspace(t,e,r){return this.workspacesManagementMainService.createUntitledWorkspace(e,r)}deleteUntitledWorkspace(t,e){return this.workspacesManagementMainService.deleteUntitledWorkspace(e)}getWorkspaceIdentifier(t,e){return this.workspacesManagementMainService.getWorkspaceIdentifier(e)}onDidChangeRecentlyOpened=this.workspacesHistoryMainService.onDidChangeRecentlyOpened;getRecentlyOpened(t){return this.workspacesHistoryMainService.getRecentlyOpened()}addRecentlyOpened(t,e){return this.workspacesHistoryMainService.addRecentlyOpened(e)}removeRecentlyOpened(t,e){return this.workspacesHistoryMainService.removeRecentlyOpened(e)}clearRecentlyOpened(t){return this.workspacesHistoryMainService.clearRecentlyOpened()}async getDirtyWorkspaces(){return this.backupMainService.getDirtyWorkspaces()}};Ds=P([h(0,or),h(1,Te),h(2,gi),h(3,en)],Ds);var vu=class{constructor(t){this.service=t}disposables=new re;listen(t,e){switch(e){case"onDidChange":return E.map(this.service.onDidChange,r=>r.reduce((i,o)=>({...i,[o]:this.service.getPolicyValue(o)??null}),{}),this.disposables)}throw new Error(`Event not found: ${e}`)}call(t,e,r){switch(e){case"updatePolicyDefinitions":return this.service.updatePolicyDefinitions(r)}throw new Error(`Call not found: ${e}`)}dispose(){this.disposables.dispose()}};var yu=class{constructor(t){this.service=t}listen(t,e){throw new Error("Invalid listen")}call(t,e,r,i=Ee.None){switch(e){case"request":return this.service.request(r[0],i).then(async({res:o,stream:s})=>{let a=await rc(s);return[{statusCode:o.statusCode,headers:o.headers},a]});case"resolveProxy":return this.service.resolveProxy(r[0]);case"lookupAuthorization":return this.service.lookupAuthorization(r[0]);case"lookupKerberosAuthorization":return this.service.lookupKerberosAuthorization(r[0]);case"loadCertificates":return this.service.loadCertificates()}throw new Error("Invalid call")}};var Yb="extensions.user.cache",Xb="extensions.builtin.cache",Iu="undefined_publisher";var _n=class{value;_lower;constructor(t){this.value=t,this._lower=t.toLowerCase()}static equals(t,e){if(typeof t>"u"||t===null)return typeof e>"u"||e===null;if(typeof e>"u"||e===null)return!1;if(typeof t=="string"||typeof e=="string"){let r=typeof t=="string"?t:t.value,i=typeof e=="string"?e:e.value;return hr(r,i)}return t._lower===e._lower}static toKey(t){return typeof t=="string"?t.toLowerCase():t._lower}};var bu=class{_map=new Map;clear(){this._map.clear()}delete(t){this._map.delete(_n.toKey(t))}get(t){return this._map.get(_n.toKey(t))}has(t){return this._map.has(_n.toKey(t))}set(t,e){this._map.set(_n.toKey(t),e)}values(){return this._map.values()}forEach(t){this._map.forEach(t)}[Symbol.iterator](){return this._map[Symbol.iterator]()}};function Zb(n){return n.map(t=>{let[e,r]=t.split("@");return{proposalName:e,version:r?parseInt(r):void 0}})}function eI(n){return n.map(t=>t.split("@")[0])}var n1e=R("IBuiltinExtensionsScannerService");var _E="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",x1e=new RegExp(_E);function rI(n,t){switch(n){case 3:return t==="x64"?"win32-x64":t==="arm64"?"win32-arm64":"unknown";case 2:return t==="x64"?"linux-x64":t==="arm64"?"linux-arm64":t==="arm"?"linux-armhf":"unknown";case"alpine":return t==="x64"?"alpine-x64":t==="arm64"?"alpine-arm64":"unknown";case 1:return t==="x64"?"darwin-x64":t==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}function nI(n){return n&&typeof n=="object"&&typeof n.id=="string"&&(!n.uuid||typeof n.uuid=="string")}var S1e=R("extensionGalleryService");var E1e=R("extensionManagementService");var P1e=R("IGlobalExtensionEnablementService"),T1e=R("IExtensionTipsService"),k1e=Hr("extensions","Extensions"),C1e=Hr("preferences","Preferences");function yi(n,t){return n.uuid&&t.uuid?n.uuid===t.uuid:n.id===t.id?!0:sa(n.id,t.id)===0}var DE=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/,wu=class n{constructor(t,e,r="undefined"){this.identifier=t;this.version=e;this.targetPlatform=r;this.id=t.id}static create(t){let e=t.manifest?t.manifest.version:t.version,r=t.manifest?t.targetPlatform:t.properties.targetPlatform;return new n(t.identifier,e,r)}static parse(t){let e=DE.exec(t);return e&&e[1]&&e[2]?new n({id:e[1]},e[2],e[4]||void 0):null}id;toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(t){return t instanceof n?yi(this,t)&&this.version===t.version&&this.targetPlatform===t.targetPlatform:!1}};function iI(n,t){return`${n}.${t}`}function RE(n){return n.toLowerCase()}function oI(n,t){return RE(iI(n??Iu,t))}var $1e=new _n("pprice.better-merge");async function LE(n,t){if(!j)return!1;let e;try{e=(await n.readFile(x.file("/etc/os-release"))).value.toString()}catch{try{e=(await n.readFile(x.file("/usr/lib/os-release"))).value.toString()}catch(i){t.debug("Error while getting the os-release file.",Kr(i))}}return!!e&&(e.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}async function sI(n,t){let e=await LE(n,t),r=rI(e?"alpine":Ei,vh);return t.debug("ComputeTargetPlatform:",r),r}var to=class extends Error{constructor(e,r){super(e);this.code=r}},bi=R("IExtensionsProfileScannerService"),Rs=class extends O{constructor(e,r,i,o,s,a){super();this.extensionsLocation=e;this.fileService=r;this.userDataProfilesService=i;this.uriIdentityService=o;this.telemetryService=s;this.logService=a}_serviceBrand;_onAddExtensions=this._register(new S);onAddExtensions=this._onAddExtensions.event;_onDidAddExtensions=this._register(new S);onDidAddExtensions=this._onDidAddExtensions.event;_onRemoveExtensions=this._register(new S);onRemoveExtensions=this._onRemoveExtensions.event;_onDidRemoveExtensions=this._register(new S);onDidRemoveExtensions=this._onDidRemoveExtensions.event;resourcesAccessQueueMap=new Ot;scanProfileExtensions(e,r){return this.withProfileExtensions(e,void 0,r)}async addExtensionsToProfile(e,r,i){let o=[],s=[];try{return await this.withProfileExtensions(r,a=>{let l=[];if(i)l.push(...a);else for(let c of a)e.some(([d])=>yi(d.identifier,c.identifier)&&d.manifest.version!==c.version)?o.push(c):l.push(c);for(let[c,d]of e){let f=l.findIndex(g=>yi(g.identifier,c.identifier)&&g.version===c.manifest.version),m={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:d};f===-1?(s.push(m),l.push(m)):l.splice(f,1,m)}return s.length&&this._onAddExtensions.fire({extensions:s,profileLocation:r}),o.length&&this._onRemoveExtensions.fire({extensions:o,profileLocation:r}),l}),s.length&&this._onDidAddExtensions.fire({extensions:s,profileLocation:r}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,profileLocation:r}),s}catch(a){throw s.length&&this._onDidAddExtensions.fire({extensions:s,error:a,profileLocation:r}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,error:a,profileLocation:r}),a}}async updateMetadata(e,r){let i=[];return await this.withProfileExtensions(r,o=>{let s=[];for(let a of o){let l=e.find(([c])=>yi(c.identifier,a.identifier)&&c.manifest.version===a.version);l&&(a.metadata={...a.metadata,...l[1]},i.push(a)),s.push(a)}return s}),i}async removeExtensionFromProfile(e,r){let i=[];try{await this.withProfileExtensions(r,o=>{let s=[];for(let a of o)yi(a.identifier,e.identifier)?i.push(a):s.push(a);return i.length&&this._onRemoveExtensions.fire({extensions:i,profileLocation:r}),s}),i.length&&this._onDidRemoveExtensions.fire({extensions:i,profileLocation:r})}catch(o){throw i.length&&this._onDidRemoveExtensions.fire({extensions:i,error:o,profileLocation:r}),o}}async withProfileExtensions(e,r,i){return this.getResourceAccessQueue(e).queue(async()=>{let o=[],s;try{let a=await this.fileService.readFile(e);s=JSON.parse(a.value.toString().trim()||"[]")}catch(a){if(Mr(a)!==1)throw a;if(this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)&&(s=await this.migrateFromOldDefaultProfileExtensionsLocation()),!s&&i?.bailOutWhenFileNotFound)throw new to(Kr(a),"ERROR_PROFILE_NOT_FOUND")}if(s){Array.isArray(s)||this.reportAndThrowInvalidConentError(e);let a=!1;for(let l of s){aI(l)||this.reportAndThrowInvalidConentError(e);let c;if(Ce(l.relativeLocation)&&l.relativeLocation)c=this.resolveExtensionLocation(l.relativeLocation);else if(Ce(l.location)){this.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${l.location}`);continue}else{c=x.revive(l.location);let d=this.toRelativePath(c);d&&(a=!0,l.relativeLocation=d)}wr(l.metadata?.hasPreReleaseVersion)&&l.metadata?.preRelease&&(a=!0,l.metadata.hasPreReleaseVersion=!0),o.push({identifier:l.identifier,location:c,version:l.version,metadata:l.metadata})}a&&await this.fileService.writeFile(e,te.fromString(JSON.stringify(s)))}if(r){o=r(o);let a=o.map(l=>({identifier:l.identifier,version:l.version,location:l.location.toJSON(),relativeLocation:this.toRelativePath(l.location),metadata:l.metadata}));await this.fileService.writeFile(e,te.fromString(JSON.stringify(a)))}return o})}reportAndThrowInvalidConentError(e){let r=new to(`Invalid extensions content in ${e.toString()}`,"ERROR_INVALID_CONTENT");throw this.telemetryService.publicLogError2("extensionsProfileScanningError",{code:r.code}),r}toRelativePath(e){return this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(e),this.extensionsLocation)?this.uriIdentityService.extUri.basename(e):void 0}resolveExtensionLocation(e){return this.uriIdentityService.extUri.joinPath(this.extensionsLocation,e)}_migrationPromise;async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{let e=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"),r=this.uriIdentityService.extUri.joinPath(this.extensionsLocation,".init-default-profile-extensions"),i;try{i=(await this.fileService.readFile(e)).value.toString()}catch(s){if(Mr(s)===1)return;throw s}this.logService.info("Migrating extensions from old default profile location",e.toString());let o;try{let s=JSON.parse(i);Array.isArray(s)&&s.every(a=>aI(a))?o=s:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",s)}catch(s){this.logService.error(s)}if(o)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,te.fromString(JSON.stringify(o)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(s){if(Mr(s)===3)this.logService.info("Migration from old default profile location to new location is done by another window",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw s}try{await this.fileService.del(e)}catch(s){Mr(s)!==1&&this.logService.error(s)}try{await this.fileService.del(r)}catch(s){Mr(s)!==1&&this.logService.error(s)}return o})()),this._migrationPromise}getResourceAccessQueue(e){let r=this.resourcesAccessQueueMap.get(e);return r||(r=new Kn,this.resourcesAccessQueueMap.set(e,r)),r}};Rs=P([h(1,We),h(2,$t),h(3,ht),h(4,He),h(5,B)],Rs);function aI(n){return Xe(n)&&nI(n.identifier)&&(OE(n.location)||Ce(n.location)&&n.location)&&(wr(n.relativeLocation)||Ce(n.relativeLocation))&&n.version&&Ce(n.version)}function OE(n){return n?Ce(n.path)&&Ce(n.scheme):!1}function xu(n){switch(n){case 1:return p("error.invalidSymbol","Invalid symbol");case 2:return p("error.invalidNumberFormat","Invalid number format");case 3:return p("error.propertyNameExpected","Property name expected");case 4:return p("error.valueExpected","Value expected");case 5:return p("error.colonExpected","Colon expected");case 6:return p("error.commaExpected","Comma expected");case 7:return p("error.closeBraceExpected","Closing brace expected");case 8:return p("error.closeBracketExpected","Closing bracket expected");case 9:return p("error.endOfFileExpected","End of file expected");default:return""}}var Su={},ye={exports:Su};(function(n,t){if(typeof Su=="object"&&typeof ye=="object")ye.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e=t();for(var r in e)(typeof Su=="object"?Su:n)[r]=e[r]}})(typeof self<"u"?self:void 0,function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return n[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=n,e.c=t,e.d=function(r,i,o){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:o})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(1&i&&(r=e(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var s in r)e.d(o,s,function(a){return r[a]}.bind(null,s));return o},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=0)}([function(n,t,e){(function(r){var i;t=n.exports=Re,i=typeof r=="object"&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var I=Array.prototype.slice.call(arguments,0);I.unshift("SEMVER"),console.log.apply(console,I)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var o=256,s=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],l=t.src=[],c=0,d=c++;l[d]="0|[1-9]\\d*";var f=c++;l[f]="[0-9]+";var m=c++;l[m]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var g=c++;l[g]="("+l[d]+")\\.("+l[d]+")\\.("+l[d]+")";var b=c++;l[b]="("+l[f]+")\\.("+l[f]+")\\.("+l[f]+")";var v=c++;l[v]="(?:"+l[d]+"|"+l[m]+")";var w=c++;l[w]="(?:"+l[f]+"|"+l[m]+")";var k=c++;l[k]="(?:-("+l[v]+"(?:\\."+l[v]+")*))";var C=c++;l[C]="(?:-?("+l[w]+"(?:\\."+l[w]+")*))";var M=c++;l[M]="[0-9A-Za-z-]+";var _=c++;l[_]="(?:\\+("+l[M]+"(?:\\."+l[M]+")*))";var V=c++,Y="v?"+l[g]+l[k]+"?"+l[_]+"?";l[V]="^"+Y+"$";var q="[v=\\s]*"+l[b]+l[C]+"?"+l[_]+"?",ze=c++;l[ze]="^"+q+"$";var ee=c++;l[ee]="((?:<|>)?=?)";var Be=c++;l[Be]=l[f]+"|x|X|\\*";var yr=c++;l[yr]=l[d]+"|x|X|\\*";var Dt=c++;l[Dt]="[v=\\s]*("+l[yr]+")(?:\\.("+l[yr]+")(?:\\.("+l[yr]+")(?:"+l[k]+")?"+l[_]+"?)?)?";var Nr=c++;l[Nr]="[v=\\s]*("+l[Be]+")(?:\\.("+l[Be]+")(?:\\.("+l[Be]+")(?:"+l[C]+")?"+l[_]+"?)?)?";var br=c++;l[br]="^"+l[ee]+"\\s*"+l[Dt]+"$";var H=c++;l[H]="^"+l[ee]+"\\s*"+l[Nr]+"$";var W=c++;l[W]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var z=c++;l[z]="(?:~>?)";var K=c++;l[K]="(\\s*)"+l[z]+"\\s+",a[K]=new RegExp(l[K],"g");var X=c++;l[X]="^"+l[z]+l[Dt]+"$";var pe=c++;l[pe]="^"+l[z]+l[Nr]+"$";var Se=c++;l[Se]="(?:\\^)";var Ge=c++;l[Ge]="(\\s*)"+l[Se]+"\\s+",a[Ge]=new RegExp(l[Ge],"g");var ut=c++;l[ut]="^"+l[Se]+l[Dt]+"$";var oe=c++;l[oe]="^"+l[Se]+l[Nr]+"$";var Dn=c++;l[Dn]="^"+l[ee]+"\\s*("+q+")$|^$";var sn=c++;l[sn]="^"+l[ee]+"\\s*("+Y+")$|^$";var Rn=c++;l[Rn]="(\\s*)"+l[ee]+"\\s*("+q+"|"+l[Dt]+")",a[Rn]=new RegExp(l[Rn],"g");var Ii=c++;l[Ii]="^\\s*("+l[Dt]+")\\s+-\\s+("+l[Dt]+")\\s*$";var Il=c++;l[Il]="^\\s*("+l[Nr]+")\\s+-\\s+("+l[Nr]+")\\s*$";var wl=c++;l[wl]="(<|>)?=?\\s*\\*";for(var wi=0;wi<35;wi++)i(wi,l[wi]),a[wi]||(a[wi]=new RegExp(l[wi]));function xi(I,T){if(I instanceof Re)return I;if(typeof I!="string"||I.length>o||!(T?a[ze]:a[V]).test(I))return null;try{return new Re(I,T)}catch{return null}}function Re(I,T){if(I instanceof Re){if(I.loose===T)return I;I=I.version}else if(typeof I!="string")throw new TypeError("Invalid Version: "+I);if(I.length>o)throw new TypeError("version is longer than "+o+" characters");if(!(this instanceof Re))return new Re(I,T);i("SemVer",I,T),this.loose=T;var D=I.trim().match(T?a[ze]:a[V]);if(!D)throw new TypeError("Invalid Version: "+I);if(this.raw=I,this.major=+D[1],this.minor=+D[2],this.patch=+D[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");D[4]?this.prerelease=D[4].split(".").map(function(G){if(/^[0-9]+$/.test(G)){var se=+G;if(se>=0&&se<s)return se}return G}):this.prerelease=[],this.build=D[5]?D[5].split("."):[],this.format()}t.parse=xi,t.valid=function(I,T){var D=xi(I,T);return D?D.version:null},t.clean=function(I,T){var D=xi(I.trim().replace(/^[=v]+/,""),T);return D?D.version:null},t.SemVer=Re,Re.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Re.prototype.toString=function(){return this.version},Re.prototype.compare=function(I){return i("SemVer.compare",this.version,this.loose,I),I instanceof Re||(I=new Re(I,this.loose)),this.compareMain(I)||this.comparePre(I)},Re.prototype.compareMain=function(I){return I instanceof Re||(I=new Re(I,this.loose)),oo(this.major,I.major)||oo(this.minor,I.minor)||oo(this.patch,I.patch)},Re.prototype.comparePre=function(I){if(I instanceof Re||(I=new Re(I,this.loose)),this.prerelease.length&&!I.prerelease.length)return-1;if(!this.prerelease.length&&I.prerelease.length)return 1;if(!this.prerelease.length&&!I.prerelease.length)return 0;var T=0;do{var D=this.prerelease[T],G=I.prerelease[T];if(i("prerelease compare",T,D,G),D===void 0&&G===void 0)return 0;if(G===void 0)return 1;if(D===void 0)return-1;if(D!==G)return oo(D,G)}while(++T)},Re.prototype.inc=function(I,T){switch(I){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",T);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",T);break;case"prepatch":this.prerelease.length=0,this.inc("patch",T),this.inc("pre",T);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",T),this.inc("pre",T);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var D=this.prerelease.length;--D>=0;)typeof this.prerelease[D]=="number"&&(this.prerelease[D]++,D=-2);D===-1&&this.prerelease.push(0)}T&&(this.prerelease[0]===T?isNaN(this.prerelease[1])&&(this.prerelease=[T,0]):this.prerelease=[T,0]);break;default:throw new Error("invalid increment argument: "+I)}return this.format(),this.raw=this.version,this},t.inc=function(I,T,D,G){typeof D=="string"&&(G=D,D=void 0);try{return new Re(I,D).inc(T,G).version}catch{return null}},t.diff=function(I,T){if(Lu(I,T))return null;var D=xi(I),G=xi(T);if(D.prerelease.length||G.prerelease.length){for(var se in D)if((se==="major"||se==="minor"||se==="patch")&&D[se]!==G[se])return"pre"+se;return"prerelease"}for(var se in D)if((se==="major"||se==="minor"||se==="patch")&&D[se]!==G[se])return se},t.compareIdentifiers=oo;var Nm=/^[0-9]+$/;function oo(I,T){var D=Nm.test(I),G=Nm.test(T);return D&&G&&(I=+I,T=+T),D&&!G?-1:G&&!D?1:I<T?-1:I>T?1:0}function an(I,T,D){return new Re(I,D).compare(new Re(T,D))}function xl(I,T,D){return an(I,T,D)>0}function Sl(I,T,D){return an(I,T,D)<0}function Lu(I,T,D){return an(I,T,D)===0}function Bm(I,T,D){return an(I,T,D)!==0}function Ou(I,T,D){return an(I,T,D)>=0}function Au(I,T,D){return an(I,T,D)<=0}function El(I,T,D,G){var se;switch(T){case"===":typeof I=="object"&&(I=I.version),typeof D=="object"&&(D=D.version),se=I===D;break;case"!==":typeof I=="object"&&(I=I.version),typeof D=="object"&&(D=D.version),se=I!==D;break;case"":case"=":case"==":se=Lu(I,D,G);break;case"!=":se=Bm(I,D,G);break;case">":se=xl(I,D,G);break;case">=":se=Ou(I,D,G);break;case"<":se=Sl(I,D,G);break;case"<=":se=Au(I,D,G);break;default:throw new TypeError("Invalid operator: "+T)}return se}function Ir(I,T){if(I instanceof Ir){if(I.loose===T)return I;I=I.value}if(!(this instanceof Ir))return new Ir(I,T);i("comparator",I,T),this.loose=T,this.parse(I),this.semver===qs?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}t.rcompareIdentifiers=function(I,T){return oo(T,I)},t.major=function(I,T){return new Re(I,T).major},t.minor=function(I,T){return new Re(I,T).minor},t.patch=function(I,T){return new Re(I,T).patch},t.compare=an,t.compareLoose=function(I,T){return an(I,T,!0)},t.rcompare=function(I,T,D){return an(T,I,D)},t.sort=function(I,T){return I.sort(function(D,G){return t.compare(D,G,T)})},t.rsort=function(I,T){return I.sort(function(D,G){return t.rcompare(D,G,T)})},t.gt=xl,t.lt=Sl,t.eq=Lu,t.neq=Bm,t.gte=Ou,t.lte=Au,t.cmp=El,t.Comparator=Ir;var qs={};function tt(I,T){if(I instanceof tt)return I.loose===T?I:new tt(I.raw,T);if(I instanceof Ir)return new tt(I.value,T);if(!(this instanceof tt))return new tt(I,T);if(this.loose=T,this.raw=I,this.set=I.split(/\s*\|\|\s*/).map(function(D){return this.parseRange(D.trim())},this).filter(function(D){return D.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+I);this.format()}function Bt(I){return!I||I.toLowerCase()==="x"||I==="*"}function NI(I,T,D,G,se,wt,Le,Gt,at,Wt,Br,lt,Rt){return((T=Bt(D)?"":Bt(G)?">="+D+".0.0":Bt(se)?">="+D+"."+G+".0":">="+T)+" "+(Gt=Bt(at)?"":Bt(Wt)?"<"+(+at+1)+".0.0":Bt(Br)?"<"+at+"."+(+Wt+1)+".0":lt?"<="+at+"."+Wt+"."+Br+"-"+lt:"<="+Gt)).trim()}function BI(I,T){for(var D=0;D<I.length;D++)if(!I[D].test(T))return!1;if(T.prerelease.length){for(D=0;D<I.length;D++)if(i(I[D].semver),I[D].semver!==qs&&I[D].semver.prerelease.length>0){var G=I[D].semver;if(G.major===T.major&&G.minor===T.minor&&G.patch===T.patch)return!0}return!1}return!0}function Pl(I,T,D){try{T=new tt(T,D)}catch{return!1}return T.test(I)}function Mu(I,T,D,G){var se,wt,Le,Gt,at;switch(I=new Re(I,G),T=new tt(T,G),D){case">":se=xl,wt=Au,Le=Sl,Gt=">",at=">=";break;case"<":se=Sl,wt=Ou,Le=xl,Gt="<",at="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(Pl(I,T,G))return!1;for(var Wt=0;Wt<T.set.length;++Wt){var Br=T.set[Wt],lt=null,Rt=null;if(Br.forEach(function(Jt){Jt.semver===qs&&(Jt=new Ir(">=0.0.0")),lt=lt||Jt,Rt=Rt||Jt,se(Jt.semver,lt.semver,G)?lt=Jt:Le(Jt.semver,Rt.semver,G)&&(Rt=Jt)}),lt.operator===Gt||lt.operator===at||(!Rt.operator||Rt.operator===Gt)&&wt(I,Rt.semver)||Rt.operator===at&&Le(I,Rt.semver))return!1}return!0}Ir.prototype.parse=function(I){var T=this.loose?a[Dn]:a[sn],D=I.match(T);if(!D)throw new TypeError("Invalid comparator: "+I);this.operator=D[1],this.operator==="="&&(this.operator=""),D[2]?this.semver=new Re(D[2],this.loose):this.semver=qs},Ir.prototype.toString=function(){return this.value},Ir.prototype.test=function(I){return i("Comparator.test",I,this.loose),this.semver===qs||(typeof I=="string"&&(I=new Re(I,this.loose)),El(I,this.operator,this.semver,this.loose))},Ir.prototype.intersects=function(I,T){if(!(I instanceof Ir))throw new TypeError("a Comparator is required");var D;if(this.operator==="")return D=new tt(I.value,T),Pl(this.value,D,T);if(I.operator==="")return D=new tt(this.value,T),Pl(I.semver,D,T);var G=!(this.operator!==">="&&this.operator!==">"||I.operator!==">="&&I.operator!==">"),se=!(this.operator!=="<="&&this.operator!=="<"||I.operator!=="<="&&I.operator!=="<"),wt=this.semver.version===I.semver.version,Le=!(this.operator!==">="&&this.operator!=="<="||I.operator!==">="&&I.operator!=="<="),Gt=El(this.semver,"<",I.semver,T)&&(this.operator===">="||this.operator===">")&&(I.operator==="<="||I.operator==="<"),at=El(this.semver,">",I.semver,T)&&(this.operator==="<="||this.operator==="<")&&(I.operator===">="||I.operator===">");return G||se||wt&&Le||Gt||at},t.Range=tt,tt.prototype.format=function(){return this.range=this.set.map(function(I){return I.join(" ").trim()}).join("||").trim(),this.range},tt.prototype.toString=function(){return this.range},tt.prototype.parseRange=function(I){var T=this.loose;I=I.trim(),i("range",I,T);var D=T?a[Il]:a[Ii];I=I.replace(D,NI),i("hyphen replace",I),I=I.replace(a[Rn],"$1$2$3"),i("comparator trim",I,a[Rn]),I=(I=(I=I.replace(a[K],"$1~")).replace(a[Ge],"$1^")).split(/\s+/).join(" ");var G=T?a[Dn]:a[sn],se=I.split(" ").map(function(wt){return function(Le,Gt){return i("comp",Le),Le=function(at,Wt){return at.trim().split(/\s+/).map(function(Br){return function(lt,Rt){i("caret",lt,Rt);var Jt=Rt?a[oe]:a[ut];return lt.replace(Jt,function(Pr,ce,be,Ve,Je){var Lt;return i("caret",lt,Pr,ce,be,Ve,Je),Bt(ce)?Lt="":Bt(be)?Lt=">="+ce+".0.0 <"+(+ce+1)+".0.0":Bt(Ve)?Lt=ce==="0"?">="+ce+"."+be+".0 <"+ce+"."+(+be+1)+".0":">="+ce+"."+be+".0 <"+(+ce+1)+".0.0":Je?(i("replaceCaret pr",Je),Je.charAt(0)!=="-"&&(Je="-"+Je),Lt=ce==="0"?be==="0"?">="+ce+"."+be+"."+Ve+Je+" <"+ce+"."+be+"."+(+Ve+1):">="+ce+"."+be+"."+Ve+Je+" <"+ce+"."+(+be+1)+".0":">="+ce+"."+be+"."+Ve+Je+" <"+(+ce+1)+".0.0"):(i("no pr"),Lt=ce==="0"?be==="0"?">="+ce+"."+be+"."+Ve+" <"+ce+"."+be+"."+(+Ve+1):">="+ce+"."+be+"."+Ve+" <"+ce+"."+(+be+1)+".0":">="+ce+"."+be+"."+Ve+" <"+(+ce+1)+".0.0"),i("caret return",Lt),Lt})}(Br,Wt)}).join(" ")}(Le,Gt),i("caret",Le),Le=function(at,Wt){return at.trim().split(/\s+/).map(function(Br){return function(lt,Rt){var Jt=Rt?a[pe]:a[X];return lt.replace(Jt,function(Pr,ce,be,Ve,Je){var Lt;return i("tilde",lt,Pr,ce,be,Ve,Je),Bt(ce)?Lt="":Bt(be)?Lt=">="+ce+".0.0 <"+(+ce+1)+".0.0":Bt(Ve)?Lt=">="+ce+"."+be+".0 <"+ce+"."+(+be+1)+".0":Je?(i("replaceTilde pr",Je),Je.charAt(0)!=="-"&&(Je="-"+Je),Lt=">="+ce+"."+be+"."+Ve+Je+" <"+ce+"."+(+be+1)+".0"):Lt=">="+ce+"."+be+"."+Ve+" <"+ce+"."+(+be+1)+".0",i("tilde return",Lt),Lt})}(Br,Wt)}).join(" ")}(Le,Gt),i("tildes",Le),Le=function(at,Wt){return i("replaceXRanges",at,Wt),at.split(/\s+/).map(function(Br){return function(lt,Rt){lt=lt.trim();var Jt=Rt?a[H]:a[br];return lt.replace(Jt,function(Pr,ce,be,Ve,Je,Lt){i("xRange",lt,Pr,ce,be,Ve,Je,Lt);var Vm=Bt(be),$s=Vm||Bt(Ve),js=$s||Bt(Je);return ce==="="&&js&&(ce=""),Vm?Pr=ce===">"||ce==="<"?"<0.0.0":"*":ce&&js?($s&&(Ve=0),js&&(Je=0),ce===">"?(ce=">=",$s?(be=+be+1,Ve=0,Je=0):js&&(Ve=+Ve+1,Je=0)):ce==="<="&&(ce="<",$s?be=+be+1:Ve=+Ve+1),Pr=ce+be+"."+Ve+"."+Je):$s?Pr=">="+be+".0.0 <"+(+be+1)+".0.0":js&&(Pr=">="+be+"."+Ve+".0 <"+be+"."+(+Ve+1)+".0"),i("xRange return",Pr),Pr})}(Br,Wt)}).join(" ")}(Le,Gt),i("xrange",Le),Le=function(at,Wt){return i("replaceStars",at,Wt),at.trim().replace(a[wl],"")}(Le,Gt),i("stars",Le),Le}(wt,T)}).join(" ").split(/\s+/);return this.loose&&(se=se.filter(function(wt){return!!wt.match(G)})),se=se.map(function(wt){return new Ir(wt,T)})},tt.prototype.intersects=function(I,T){if(!(I instanceof tt))throw new TypeError("a Range is required");return this.set.some(function(D){return D.every(function(G){return I.set.some(function(se){return se.every(function(wt){return G.intersects(wt,T)})})})})},t.toComparators=function(I,T){return new tt(I,T).set.map(function(D){return D.map(function(G){return G.value}).join(" ").trim().split(" ")})},tt.prototype.test=function(I){if(!I)return!1;typeof I=="string"&&(I=new Re(I,this.loose));for(var T=0;T<this.set.length;T++)if(BI(this.set[T],I))return!0;return!1},t.satisfies=Pl,t.maxSatisfying=function(I,T,D){var G=null,se=null;try{var wt=new tt(T,D)}catch{return null}return I.forEach(function(Le){wt.test(Le)&&(G&&se.compare(Le)!==-1||(se=new Re(G=Le,D)))}),G},t.minSatisfying=function(I,T,D){var G=null,se=null;try{var wt=new tt(T,D)}catch{return null}return I.forEach(function(Le){wt.test(Le)&&(G&&se.compare(Le)!==1||(se=new Re(G=Le,D)))}),G},t.validRange=function(I,T){try{return new tt(I,T).range||"*"}catch{return null}},t.ltr=function(I,T,D){return Mu(I,T,"<",D)},t.gtr=function(I,T,D){return Mu(I,T,">",D)},t.outside=Mu,t.prerelease=function(I,T){var D=xi(I,T);return D&&D.prerelease.length?D.prerelease:null},t.intersects=function(I,T,D){return I=new tt(I,D),T=new tt(T,D),I.intersects(T)},t.coerce=function(I){if(I instanceof Re)return I;if(typeof I!="string")return null;var T=I.match(a[W]);return T==null?null:xi((T[1]||"0")+"."+(T[2]||"0")+"."+(T[3]||"0"))}}).call(this,e(1))},function(n,t){var e,r,i=n.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(w){if(e===setTimeout)return setTimeout(w,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(w,0);try{return e(w,0)}catch{try{return e.call(null,w,0)}catch{return e.call(this,w,0)}}}(function(){try{e=typeof setTimeout=="function"?setTimeout:o}catch{e=o}try{r=typeof clearTimeout=="function"?clearTimeout:s}catch{r=s}})();var l,c=[],d=!1,f=-1;function m(){d&&l&&(d=!1,l.length?c=l.concat(c):f=-1,c.length&&g())}function g(){if(!d){var w=a(m);d=!0;for(var k=c.length;k;){for(l=c,c=[];++f<k;)l&&l[f].run();f=-1,k=c.length}l=null,d=!1,function(C){if(r===clearTimeout)return clearTimeout(C);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(C);try{r(C)}catch{try{return r.call(null,C)}catch{return r.call(this,C)}}}(w)}}function b(w,k){this.fun=w,this.array=k}function v(){}i.nextTick=function(w){var k=new Array(arguments.length-1);if(arguments.length>1)for(var C=1;C<arguments.length;C++)k[C-1]=arguments[C];c.push(new b(w,k)),c.length!==1||d||a(g)},b.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(w){return[]},i.binding=function(w){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(w){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}])});var Swe=ye.exports.SEMVER_SPEC_VERSION,Ewe=ye.exports.parse,lI=ye.exports.valid,Pwe=ye.exports.coerce,Twe=ye.exports.clean,kwe=ye.exports.inc,Cwe=ye.exports.major,_we=ye.exports.minor,Dwe=ye.exports.patch,Rwe=ye.exports.prerelease,cI=ye.exports.gt,Lwe=ye.exports.gte,Owe=ye.exports.lt,Awe=ye.exports.lte,dI=ye.exports.eq,Mwe=ye.exports.neq,Wwe=ye.exports.cmp,Fwe=ye.exports.compare,Uwe=ye.exports.rcompare,Nwe=ye.exports.compareIdentifiers,Bwe=ye.exports.rcompareIdentifiers,Vwe=ye.exports.compareBuild,Kwe=ye.exports.sort,Hwe=ye.exports.rsort,zwe=ye.exports.diff,qwe=ye.exports.validRange,$we=ye.exports.satisfies,jwe=ye.exports.maxSatisfying,Gwe=ye.exports.minSatisfying,Jwe=ye.exports.minVersion,Qwe=ye.exports.gtr,Ywe=ye.exports.ltr,Xwe=ye.exports.outside,Zwe=ye.exports.intersects,exe=ye.exports.SemVer,txe=ye.exports.Comparator,rxe=ye.exports.Range;var AE={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts"},aiTextSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProviderNew.d.ts"},attributableCoverage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.attributableCoverage.d.ts"},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:2},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},chatVariableResolver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatVariableResolver.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribChatParticipantDetection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribChatParticipantDetection.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribIssueReporter:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribIssueReporter.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},createFileSystemWatcher:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.createFileSystemWatcher.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts"},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},documentPaste:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentPaste.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileComments:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileComments.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProviderNew.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts"},findFiles2New:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2New.d.ts"},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFilesNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFilesNew.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},idToken:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},inlineEdit:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineEdit.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},lmTools:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.lmTools.d.ts",version:6},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookCellExecutionState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecutionState.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},showLocal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.showLocal.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textSearchCompleteNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchCompleteNew.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProviderNew.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},pI=Object.freeze(AE);var mI=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,ME=/^-(\d{4})(\d{2})(\d{2})$/;function WE(n){return n=n.trim(),n==="*"||mI.test(n)}function _m(n){if(!WE(n))return null;if(n=n.trim(),n==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};let t=n.match(mI);return t?{hasCaret:t[1]==="^",hasGreaterEquals:t[1]===">=",majorBase:t[2]==="x"?0:parseInt(t[2],10),majorMustEqual:t[2]!=="x",minorBase:t[4]==="x"?0:parseInt(t[4],10),minorMustEqual:t[4]!=="x",patchBase:t[6]==="x"?0:parseInt(t[6],10),patchMustEqual:t[6]!=="x",preRelease:t[8]||null}:null}function Dm(n){if(!n)return null;let t=n.majorBase,e=n.majorMustEqual,r=n.minorBase,i=n.minorMustEqual,o=n.patchBase,s=n.patchMustEqual;n.hasCaret&&(t===0||(i=!1),s=!1);let a=0;if(n.preRelease){let l=ME.exec(n.preRelease);if(l){let[,c,d,f]=l;a=Date.UTC(Number(c),Number(d)-1,Number(f))}}return{majorBase:t,majorMustEqual:e,minorBase:r,minorMustEqual:i,patchBase:o,patchMustEqual:s,isMinimum:n.hasGreaterEquals,notBefore:a}}function FE(n,t,e){let r;typeof n=="string"?r=Dm(_m(n)):r=n;let i;t instanceof Date?i=t.getTime():typeof t=="string"&&(i=new Date(t).getTime());let o;if(typeof e=="string"?o=Dm(_m(e)):o=e,!r||!o)return!1;let s=r.majorBase,a=r.minorBase,l=r.patchBase,c=o.majorBase,d=o.minorBase,f=o.patchBase,m=o.notBefore,g=o.majorMustEqual,b=o.minorMustEqual,v=o.patchMustEqual;return o.isMinimum?s>c?!0:s<c?!1:a>d?!0:a<d||i&&i<m?!1:l>=f:(s===1&&c===0&&(!g||!b||!v)&&(c=1,d=0,f=0,g=!0,b=!1,v=!1),s<c?!1:s>c?!g:a<d?!1:a>d?!b:l<f?!1:l>f?!v:!(i&&i<m))}function hI(n,t,e,r,i,o){let s=[];if(typeof r.publisher<"u"&&typeof r.publisher!="string")return s.push([xe.Error,p("extensionDescription.publisher","property publisher must be of type `string`.")]),s;if(typeof r.name!="string")return s.push([xe.Error,p("extensionDescription.name","property `{0}` is mandatory and must be of type `string`","name")]),s;if(typeof r.version!="string")return s.push([xe.Error,p("extensionDescription.version","property `{0}` is mandatory and must be of type `string`","version")]),s;if(!r.engines)return s.push([xe.Error,p("extensionDescription.engines","property `{0}` is mandatory and must be of type `object`","engines")]),s;if(typeof r.engines.vscode!="string")return s.push([xe.Error,p("extensionDescription.engines.vscode","property `{0}` is mandatory and must be of type `string`","engines.vscode")]),s;if(typeof r.extensionDependencies<"u"&&!fI(r.extensionDependencies))return s.push([xe.Error,p("extensionDescription.extensionDependencies","property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")]),s;if(typeof r.activationEvents<"u"){if(!fI(r.activationEvents))return s.push([xe.Error,p("extensionDescription.activationEvents1","property `{0}` can be omitted or must be of type `string[]`","activationEvents")]),s;if(typeof r.main>"u"&&typeof r.browser>"u")return s.push([xe.Error,p("extensionDescription.activationEvents2","property `{0}` should be omitted if the extension doesn't have a `{1}` or `{2}` property.","activationEvents","main","browser")]),s}if(typeof r.extensionKind<"u"&&typeof r.main>"u"&&s.push([xe.Warning,p("extensionDescription.extensionKind","property `{0}` can be defined only if property `main` is also defined.","extensionKind")]),typeof r.main<"u"){if(typeof r.main!="string")return s.push([xe.Error,p("extensionDescription.main1","property `{0}` can be omitted or must be of type `string`","main")]),s;{let c=ne(e,r.main);Ep(c,e)||s.push([xe.Warning,p("extensionDescription.main2","Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(typeof r.browser<"u"){if(typeof r.browser!="string")return s.push([xe.Error,p("extensionDescription.browser1","property `{0}` can be omitted or must be of type `string`","browser")]),s;{let c=ne(e,r.browser);Ep(c,e)||s.push([xe.Warning,p("extensionDescription.browser2","Expected `browser` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(!lI(r.version))return s.push([xe.Error,p("notSemver","Extension version is not semver compatible.")]),s;let a=[];if(!UE(n,t,r,i,a))for(let c of a)s.push([xe.Error,c]);if(o&&r.enabledApiProposals?.length){let c=[];if(!NE([...r.enabledApiProposals],c))for(let d of c)s.push([xe.Error,d])}return s}function UE(n,t,e,r,i){return r||typeof e.main>"u"&&typeof e.browser>"u"?!0:BE(n,t,e.engines.vscode,i)}function NE(n,t){if(n.length===0)return!0;let e=Array.isArray(t)?t:void 0,r=(e?void 0:t)??pI,i=[],o=Zb(n);for(let{proposalName:s,version:a}of o){let l=r[s];l&&a&&l.version!==a&&i.push(p("apiProposalMismatch","Extension is using an API proposal '{0}' that is not compatible with the current version of VS Code.",s))}return e?.push(...i),i.length===0}function BE(n,t,e,r=[]){let i=Dm(_m(e));if(!i)return r.push(p("versionSyntax","Could not parse `engines.vscode` value {0}. Please use, for example: ^1.22.0, ^1.22.x, etc.",e)),!1;if(i.majorBase===0){if(!i.majorMustEqual||!i.minorMustEqual)return r.push(p("versionSpecificity1","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions before 1.0.0, please define at a minimum the major and minor desired version. E.g. ^0.10.0, 0.10.x, 0.11.0, etc.",e)),!1}else if(!i.majorMustEqual)return r.push(p("versionSpecificity2","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions after 1.0.0, please define at a minimum the major desired version. E.g. ^1.10.0, 1.10.x, 1.x.x, 2.x.x, etc.",e)),!1;return FE(n,t,i)?!0:(r.push(p("versionMismatch","Extension is not compatible with Code {0}. Extension requires: {1}.",n,e)),!1)}function fI(n){if(!Array.isArray(n))return!1;for(let t=0,e=n.length;t<e;t++)if(typeof n[t]!="string")return!1;return!0}function gI(n,t,e,r){try{VE(n,t,e,r)}catch(i){n.error(i?.message??i)}return t}function VE(n,t,e,r){let i=(o,s,a)=>{let l=o[s];if(Ce(l)){let c=l,d=c.length;if(d>1&&c[0]==="%"&&c[d-1]==="%"){let f=c.substr(1,d-2),m=e[f];m===void 0&&r&&(m=r[f]);let g=typeof m=="string"?m:m?.message,b=r?.[f],v=typeof b=="string"?b:b?.message;if(!g){v||n.warn(`[${t.name}]: ${p("missingNLSKey","Couldn't find message for key {0}.",f)}`);return}if(a&&(s==="title"||s==="category")&&v&&v!==g){let w={value:g,original:v};o[s]=w}else o[s]=g}}else if(Xe(l))for(let c in l)l.hasOwnProperty(c)&&(c==="commands"?i(l,c,!0):i(l,c,a));else if(Array.isArray(l))for(let c=0;c<l.length;c++)i(l,c,a)};for(let o in t)t.hasOwnProperty(o)&&i(t,o)}var vI;(t=>{function n(e,r){if(e===r)return!0;let i=Object.keys(e),o=new Set;for(let s of Object.keys(r))o.add(s);if(i.length!==o.size)return!1;for(let s of i){if(e[s]!==r[s])return!1;o.delete(s)}return o.size===0}t.equals=n})(vI||={});var yI=R("IExtensionsScannerService"),gl=class extends O{constructor(e,r,i,o,s,a,l,c,d,f,m,g){super();this.systemExtensionsLocation=e;this.userExtensionsLocation=r;this.extensionsControlLocation=i;this.currentProfile=o;this.userDataProfilesService=s;this.extensionsProfileScannerService=a;this.fileService=l;this.logService=c;this.environmentService=d;this.productService=f;this.uriIdentityService=m;this.instantiationService=g;this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(0))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(1)))}_serviceBrand;_onDidChangeCache=this._register(new S);onDidChangeCache=this._onDidChangeCache.event;obsoleteFile=ne(this.userExtensionsLocation,".obsolete");systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Os,this.currentProfile,this.obsoleteFile));userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Os,this.currentProfile,this.obsoleteFile));extensionsScanner=this._register(this.instantiationService.createInstance(Ls,this.obsoleteFile));_targetPlatformPromise;getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=sI(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(e,r,i){let[o,s]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(r)]),a=i?await this.scanExtensionsUnderDevelopment(e,[...o,...s]):[];return this.dedupExtensions(o,s,a,await this.getTargetPlatform(),!0)}async scanSystemExtensions(e){let r=[];r.push(this.scanDefaultSystemExtensions(!!e.useCache,e.language)),r.push(this.scanDevSystemExtensions(e.language,!!e.checkControlFile));let[i,o]=await Promise.all(r);return this.applyScanOptions([...i,...o],0,e,!1)}async scanUserExtensions(e){let r=e.profileLocation??this.userExtensionsLocation;this.logService.trace("Started scanning user extensions",r);let i=this.uriIdentityService.extUri.isEqual(e.profileLocation,this.userDataProfilesService.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,o=await this.createExtensionScannerInput(r,!!e.profileLocation,1,!e.includeUninstalled,e.language,!0,i,e.productVersion??this.getProductVersion()),s=e.useCache&&!o.devMode&&o.excludeObsolete?this.userExtensionsCachedScanner:this.extensionsScanner,a;try{a=await s.scanExtensions(o)}catch(l){if(l instanceof to&&l.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions(),a=await s.scanExtensions(o);else throw l}return a=await this.applyScanOptions(a,1,e,!0),this.logService.trace("Scanned user extensions:",a.length),a}async scanExtensionsUnderDevelopment(e,r){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){let i=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(o=>o.scheme===U.file).map(async o=>{let s=await this.createExtensionScannerInput(o,!1,1,!0,e.language,!1,void 0,e.productVersion??this.getProductVersion());return(await this.extensionsScanner.scanOneOrMultipleExtensions(s)).map(l=>(l.type=r.find(c=>yi(c.identifier,l.identifier))?.type??l.type,this.extensionsScanner.validate(l,s)))}))).flat();return this.applyScanOptions(i,"development",e,!0)}return[]}async scanExistingExtension(e,r,i){let o=await this.createExtensionScannerInput(e,!1,r,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanExtension(o);return!s||!i.includeInvalid&&!s.isValid?null:s}async scanOneOrMultipleExtensions(e,r,i){let o=await this.createExtensionScannerInput(e,!1,r,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanOneOrMultipleExtensions(o);return this.applyScanOptions(s,r,i,!0)}async scanMultipleExtensions(e,r,i){let o=[];return await Promise.all(e.map(async s=>{let a=await this.scanOneOrMultipleExtensions(s,r,i);o.push(...a)})),this.applyScanOptions(o,r,i,!0)}async scanMetadata(e){let r=ne(e,"package.json"),i=(await this.fileService.readFile(r)).value.toString();return JSON.parse(i).__metadata}async updateMetadata(e,r){let i=ne(e,"package.json"),o=(await this.fileService.readFile(i)).value.toString(),s=JSON.parse(o);r.isMachineScoped===!1&&delete r.isMachineScoped,r.isBuiltin===!1&&delete r.isBuiltin,s.__metadata={...s.__metadata,...r},await this.fileService.writeFile(ne(e,"package.json"),te.fromString(JSON.stringify(s,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof to&&e.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions();else throw e}}initializeDefaultProfileExtensionsPromise=void 0;async doInitializeDefaultProfileExtensions(){return this.initializeDefaultProfileExtensionsPromise||(this.initializeDefaultProfileExtensionsPromise=(async()=>{try{this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());let e=await this.scanUserExtensions({includeInvalid:!0});if(e.length)await this.extensionsProfileScannerService.addExtensionsToProfile(e.map(r=>[r,r.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource);else try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,te.fromString(JSON.stringify([])))}catch(r){Mr(r)!==1&&this.logService.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),Kr(r))}this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.logService.error(e)}finally{this.initializeDefaultProfileExtensionsPromise=void 0}})()),this.initializeDefaultProfileExtensionsPromise}async applyScanOptions(e,r,i,o){return i.includeAllVersions||(e=this.dedupExtensions(r===0?e:void 0,r===1?e:void 0,r==="development"?e:void 0,await this.getTargetPlatform(),o)),i.includeInvalid||(e=e.filter(s=>s.isValid)),e.sort((s,a)=>{let l=ve(s.location.fsPath),c=ve(a.location.fsPath);return l<c?-1:l>c?1:0})}dedupExtensions(e,r,i,o,s){let a=(c,d,f)=>{if(c.isValid&&!d.isValid)return!1;if(c.isValid===d.isValid){if(s&&cI(c.manifest.version,d.manifest.version))return this.logService.debug(`Skipping extension ${d.location.path} with lower version ${d.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if(dI(c.manifest.version,d.manifest.version)){if(c.type===0)return this.logService.debug(`Skipping extension ${d.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===o)return this.logService.debug(`Skipping extension ${d.location.path} from different target platform ${d.targetPlatform}`),!1}}return f?this.logService.warn(`Overwriting user extension ${c.location.path} with ${d.location.path}.`):this.logService.debug(`Overwriting user extension ${c.location.path} with ${d.location.path}.`),!0},l=new bu;return e?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),r?.forEach(c=>{let d=l.get(c.identifier.id);if(!d&&e&&c.type===0){this.logService.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),i?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!0))&&l.set(c.identifier.id,c),l.set(c.identifier.id,c)}),[...l.values()]}async scanDefaultSystemExtensions(e,r){this.logService.trace("Started scanning system extensions");let i=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,0,!0,r,!0,void 0,this.getProductVersion()),s=await(e&&!i.devMode?this.systemExtensionsCachedScanner:this.extensionsScanner).scanExtensions(i);return this.logService.trace("Scanned system extensions:",s.length),s}async scanDevSystemExtensions(e,r){let i=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!i?.length)return[];this.logService.trace("Started scanning dev system extensions");let o=r?await this.getBuiltInExtensionControl():{},s=[],a=x.file(ct(F(Me.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(let c of i){let d=o[c.name]||"marketplace";switch(d){case"disabled":break;case"marketplace":s.push(ne(a,c.name));break;default:s.push(x.file(d));break}}let l=await Promise.all(s.map(async c=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(c,!1,0,!0,e,!0,void 0,this.getProductVersion()))));return this.logService.trace("Scanned dev system extensions:",l.length),pt(l)}async getBuiltInExtensionControl(){try{let e=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(e.value.toString())}catch{return{}}}async createExtensionScannerInput(e,r,i,o,s,a,l,c){let d=await this.getTranslations(s??dr),f=await this.getMtime(e),m=r&&!this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,g=m?await this.getMtime(m):void 0;return new ro(e,f,m,g,r,l,i,o,a,c.version,c.date,this.productService.commit,!this.environmentService.isBuilt,s,d)}async getMtime(e){try{let r=await this.fileService.stat(e);if(typeof r.mtime=="number")return r.mtime}catch{}}getProductVersion(){return{version:this.productService.version,date:this.productService.date}}};gl=P([h(4,$t),h(5,bi),h(6,We),h(7,B),h(8,zt),h(9,Oe),h(10,ht),h(11,tr)],gl);var ro=class{constructor(t,e,r,i,o,s,a,l,c,d,f,m,g,b,v){this.location=t;this.mtime=e;this.applicationExtensionslocation=r;this.applicationExtensionslocationMtime=i;this.profile=o;this.profileScanOptions=s;this.type=a;this.excludeObsolete=l;this.validate=c;this.productVersion=d;this.productDate=f;this.productCommit=m;this.devMode=g;this.language=b;this.translations=v}static createNlsConfiguration(t){return{language:t.language,pseudo:t.language==="pseudo",devMode:t.devMode,translations:t.translations}}static equals(t,e){return lc(t.location,e.location)&&t.mtime===e.mtime&&lc(t.applicationExtensionslocation,e.applicationExtensionslocation)&&t.applicationExtensionslocationMtime===e.applicationExtensionslocationMtime&&t.profile===e.profile&&Go(t.profileScanOptions,e.profileScanOptions)&&t.type===e.type&&t.excludeObsolete===e.excludeObsolete&&t.validate===e.validate&&t.productVersion===e.productVersion&&t.productDate===e.productDate&&t.productCommit===e.productCommit&&t.devMode===e.devMode&&t.language===e.language&&vI.equals(t.translations,e.translations)}},Ls=class extends O{constructor(e,r,i,o,s,a,l){super();this.obsoleteFile=e;this.extensionsProfileScannerService=r;this.uriIdentityService=i;this.fileService=o;this.environmentService=a;this.logService=l;this.extensionsEnabledWithApiProposalVersion=s.extensionsEnabledWithApiProposalVersion?.map(c=>c.toLowerCase())??[]}extensionsEnabledWithApiProposalVersion;async scanExtensions(e){let r=e.profile?await this.scanExtensionsFromProfile(e):await this.scanExtensionsFromLocation(e),i={};if(e.excludeObsolete&&e.type===1)try{let o=(await this.fileService.readFile(this.obsoleteFile)).value.toString();i=JSON.parse(o)}catch{}return nc(i)?r:r.filter(o=>!i[wu.create(o).toString()])}async scanExtensionsFromLocation(e){let r=await this.fileService.resolve(e.location);if(!r.children?.length)return[];let i=await Promise.all(r.children.map(async o=>{if(!o.isDirectory||e.type===1&&Vt(o.resource).indexOf(".")===0)return null;let s=new ro(o.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.excludeObsolete,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(s)}));return pt(i).sort((o,s)=>o.location.path<s.location.path?-1:1)}async scanExtensionsFromProfile(e){let r=await this.scanExtensionsFromProfileResource(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(e.location,e.applicationExtensionslocation)){r=r.filter(o=>!o.metadata?.isApplicationScoped);let i=await this.scanExtensionsFromProfileResource(e.applicationExtensionslocation,o=>!!o.metadata?.isBuiltin||!!o.metadata?.isApplicationScoped,e);r.push(...i)}return r}async scanExtensionsFromProfileResource(e,r,i){let o=await this.extensionsProfileScannerService.scanProfileExtensions(e,i.profileScanOptions);if(!o.length)return[];let s=await Promise.all(o.map(async a=>{if(r(a)){let l=new ro(a.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.excludeObsolete,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(l,a.metadata)}return null}));return pt(s)}async scanOneOrMultipleExtensions(e){try{if(await this.fileService.exists(ne(e.location,"package.json"))){let r=await this.scanExtension(e);return r?[r]:[]}else return await this.scanExtensions(e)}catch(r){return this.logService.error(`Error scanning extensions at ${e.location.path}:`,Kr(r)),[]}}async scanExtension(e,r){try{let i=await this.scanExtensionManifest(e.location);if(i){i.publisher||(i.publisher=Iu),r=r??i.__metadata,delete i.__metadata;let o=oI(i.publisher,i.name),s=r?.id?{id:o,uuid:r.id}:{id:o},a=r?.isSystem?0:e.type,l=a===0||!!r?.isBuiltin;i=await this.translateManifest(e.location,i,ro.createNlsConfiguration(e));let c={type:a,identifier:s,manifest:i,location:e.location,isBuiltin:l,targetPlatform:r?.targetPlatform??"undefined",publisherDisplayName:r?.publisherDisplayName,metadata:r,isValid:!0,validations:[]};return e.validate&&(c=this.validate(c,e)),i.enabledApiProposals&&(!this.environmentService.isBuilt||this.extensionsEnabledWithApiProposalVersion.includes(o.toLowerCase()))&&(i.originalEnabledApiProposals=i.enabledApiProposals,i.enabledApiProposals=eI([...i.enabledApiProposals])),c}}catch(i){e.type!==0&&this.logService.error(i)}return null}validate(e,r){let i=!0,o=this.environmentService.isBuilt&&this.extensionsEnabledWithApiProposalVersion.includes(e.identifier.id.toLowerCase()),s=hI(r.productVersion,r.productDate,r.location,e.manifest,e.isBuiltin,o);for(let[a,l]of s)a===xe.Error&&(i=!1,this.logService.error(this.formatMessage(r.location,l)));return e.isValid=i,e.validations=s,e}async scanExtensionManifest(e){let r=ne(e,"package.json"),i;try{i=(await this.fileService.readFile(r)).value.toString()}catch(s){return Mr(s)!==1&&this.logService.error(this.formatMessage(e,p("fileReadFail","Cannot read file {0}: {1}.",r.path,s.message))),null}let o;try{o=JSON.parse(i)}catch{let a=[];ni(i,a);for(let l of a)this.logService.error(this.formatMessage(e,p("jsonParseFail","Failed to parse {0}: [{1}, {2}] {3}.",r.path,l.offset,l.length,xu(l.error))));return null}return ja(o)!=="object"?(this.logService.error(this.formatMessage(e,p("jsonParseInvalidType","Invalid manifest file {0}: Not a JSON object.",r.path))),null):o}async translateManifest(e,r,i){let o=await this.getLocalizedMessages(e,r,i);if(o)try{let s=[],a=await this.resolveOriginalMessageBundle(o.default,s);if(s.length>0)return s.forEach(c=>{this.logService.error(this.formatMessage(e,p("jsonsParseReportErrors","Failed to parse {0}: {1}.",o.default?.path,xu(c.error))))}),r;if(ja(o)!=="object")return this.logService.error(this.formatMessage(e,p("jsonInvalidFormat","Invalid format {0}: JSON object expected.",o.default?.path))),r;let l=o.values||Object.create(null);return gI(this.logService,r,l,a)}catch{}return r}async getLocalizedMessages(e,r,i){let o=ne(e,"package.nls.json"),s=(d,f)=>{f.forEach(m=>{this.logService.error(this.formatMessage(e,p("jsonsParseReportErrors","Failed to parse {0}: {1}.",d?.path,xu(m.error))))})},a=d=>{this.logService.error(this.formatMessage(e,p("jsonInvalidFormat","Invalid format {0}: JSON object expected.",d?.path)))},l=`${r.publisher}.${r.name}`,c=i.translations[l];if(c)try{let d=x.file(c),f=(await this.fileService.readFile(d)).value.toString(),m=[],g=ni(f,m);return m.length>0?(s(d,m),{values:void 0,default:o}):ja(g)!=="object"?(a(d),{values:void 0,default:o}):{values:g.contents?g.contents.package:void 0,default:o}}catch{return{values:void 0,default:o}}else{if(!await this.fileService.exists(o))return;let f;try{f=await this.findMessageBundles(e,i)}catch{return}if(!f.localized)return{values:void 0,default:f.original};try{let m=(await this.fileService.readFile(f.localized)).value.toString(),g=[],b=ni(m,g);return g.length>0?(s(f.localized,g),{values:void 0,default:f.original}):ja(b)!=="object"?(a(f.localized),{values:void 0,default:f.original}):{values:b,default:f.original}}catch{return{values:void 0,default:f.original}}}}async resolveOriginalMessageBundle(e,r){if(e)try{let i=(await this.fileService.readFile(e)).value.toString();return ni(i,r)}catch{}}findMessageBundles(e,r){return new Promise((i,o)=>{let s=a=>{let l=ne(e,`package.nls.${a}.json`);this.fileService.exists(l).then(c=>{c&&i({localized:l,original:ne(e,"package.nls.json")});let d=a.lastIndexOf("-");d===-1?i({localized:ne(e,"package.nls.json"),original:null}):(a=a.substring(0,d),s(a))})};if(r.devMode||r.pseudo||!r.language)return i({localized:ne(e,"package.nls.json"),original:null});s(r.language)})}formatMessage(e,r){return`[${e.path}]: ${r}`}};Ls=P([h(1,bi),h(2,ht),h(3,We),h(4,Oe),h(5,zt),h(6,B)],Ls);var Os=class extends Ls{constructor(e,r,i,o,s,a,l,c,d){super(r,o,s,a,l,c,d);this.currentProfile=e;this.userDataProfilesService=i}input;cacheValidatorThrottler=this._register(new Kt(3e3));_onDidChangeCache=this._register(new S);onDidChangeCache=this._onDidChangeCache.event;async scanExtensions(e){let r=this.getCacheFile(e),i=await this.readExtensionCache(r);if(this.input=e,i&&i.input&&ro.equals(i.input,this.input))return this.logService.debug("Using cached extensions scan result",e.type===0?"system":"user",e.location.toString()),this.cacheValidatorThrottler.trigger(()=>this.validateCache()),i.result.map(s=>(s.location=x.revive(s.location),s));let o=await super.scanExtensions(e);return await this.writeExtensionCache(r,{input:e,result:o}),o}async readExtensionCache(e){try{let r=await this.fileService.readFile(e),i=JSON.parse(r.value.toString());return{result:i.result,input:Ar(i.input)}}catch(r){this.logService.debug("Error while reading the extension cache file:",e.path,Kr(r))}return null}async writeExtensionCache(e,r){try{await this.fileService.writeFile(e,te.fromString(JSON.stringify(r)))}catch(i){this.logService.debug("Error while writing the extension cache file:",e.path,Kr(i))}}async validateCache(){if(!this.input)return;let e=this.getCacheFile(this.input),r=await this.readExtensionCache(e);if(!r)return;let i=r.result,o=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!Go(o,i))try{this.logService.info("Invalidating Cache",i,o),await this.fileService.del(e),this._onDidChangeCache.fire()}catch(s){this.logService.error(s)}}getCacheFile(e){let r=this.getProfile(e);return this.uriIdentityService.extUri.joinPath(r.cacheHome,e.type===0?Xb:Yb)}getProfile(e){return e.type===0?this.userDataProfilesService.defaultProfile:e.profile?this.uriIdentityService.extUri.isEqual(e.location,this.currentProfile.extensionsResource)?this.currentProfile:this.userDataProfilesService.profiles.find(r=>this.uriIdentityService.extUri.isEqual(e.location,r.extensionsResource))??this.currentProfile:this.userDataProfilesService.defaultProfile}};Os=P([h(2,$t),h(3,bi),h(4,ht),h(5,We),h(6,Oe),h(7,zt),h(8,B)],Os);var Eu=class extends gl{translationsPromise;constructor(t,e,r,i,o,s,a,l,c,d,f,m){super(t,e,ne(r,".vscode-oss-dev","extensions","control.json"),i,o,s,a,l,c,d,f,m),this.translationsPromise=(async()=>{if(zu)try{let g=await this.fileService.readFile(x.file(zu));return JSON.parse(g.value.toString())}catch{}return Object.create(null)})()}getTranslations(t){return this.translationsPromise}};var As=class extends Eu{constructor(t,e,r,i,o,s,a,l){super(x.file(o.builtinExtensionsPath),x.file(o.extensionsPath),o.userHome,t.defaultProfile,t,e,r,i,o,s,a,l)}};As=P([h(0,$t),h(1,bi),h(2,We),h(3,B),h(4,Jr),h(5,Oe),h(6,ht),h(7,tr)],As);var Ms=class extends O{constructor(e,r,i){super();this.userDataProfilesService=r;this.windowsMainService=i;this._register(e.onWillLoadWindow(o=>{o.reason===2&&this.unsetProfileForWorkspace(o.window)})),this._register(e.onBeforeCloseWindow(o=>this.unsetProfileForWorkspace(o))),this._register(new bt(()=>this.cleanUpEmptyWindowAssociations(),30*1e3)).schedule()}async unsetProfileForWorkspace(e){let r=this.getWorkspace(e),i=this.userDataProfilesService.getProfileForWorkspace(r);i?.isTransient&&(this.userDataProfilesService.unsetWorkspace(r,i.isTransient),i.isTransient&&await this.userDataProfilesService.cleanUpTransientProfiles())}getWorkspace(e){return e.openedWorkspace??$n(e.backupPath,e.isExtensionDevelopmentHost)}cleanUpEmptyWindowAssociations(){let e=this.userDataProfilesService.getAssociatedEmptyWindows();if(e.length===0)return;let r=this.windowsMainService.getWindows().map(i=>this.getWorkspace(i));for(let i of e)r.some(o=>o.id===i.id)||this.userDataProfilesService.unsetWorkspace(i,!1)}};Ms=P([h(0,le),h(1,ir),h(2,Te)],Ms);var o0e=R("IUserDataProfileStorageService"),Pu=class extends O{constructor(e,r){super();this.storageService=r;e&&(this.storageServicesMap=this._register(new pn))}_serviceBrand;storageServicesMap;async readStorageData(e){return this.withProfileScopedStorageService(e,async r=>this.getItems(r))}async updateStorageData(e,r,i){return this.withProfileScopedStorageService(e,async o=>this.writeItems(o,r,i))}async withProfileScopedStorageService(e,r){if(this.storageService.hasScope(e))return r(this.storageService);let i=this.storageServicesMap?.get(e.id);if(!i){i=new Rm(this.createStorageDatabase(e)),this.storageServicesMap?.set(e.id,i);try{await i.initialize()}catch(o){throw this.storageServicesMap?.has(e.id)?this.storageServicesMap.deleteAndDispose(e.id):i.dispose(),o}}try{let o=await r(i);return await i.flush(),o}finally{this.storageServicesMap?.has(e.id)||i.dispose()}}getItems(e){let r=new Map,i=o=>{for(let s of e.keys(0,o))r.set(s,{value:e.get(s,0),target:o})};return i(0),i(1),r}writeItems(e,r,i){e.storeAll(Array.from(r.entries()).map(([o,s])=>({key:o,value:s,scope:0,target:i})),!0)}};Pu=P([h(1,_v)],Pu);var Rm=class extends Fo{constructor(e){super({flushInterval:100});this.profileStorageDatabase=e}profileStorage;async doInitialize(){let e=await this.profileStorageDatabase,r=new Yr(e);return this._register(r.onDidChangeStorage(i=>{this.emitDidChangeValue(0,i)})),this._register(Z(()=>{r.close(),r.dispose(),Ch(e)&&e.dispose()})),this.profileStorage=r,this.profileStorage.init()}getStorage(e){return e===0?this.profileStorage:void 0}getLogDetails(){}async switchToProfile(){}async switchToWorkspace(){}hasScope(){return!1}};var Tu=class extends O{constructor(e,r,i){super();this.storageMainService=e;this.userDataProfilesService=r;this.logService=i;let o=this._register(new Dr);this._onDidChange=this._register(new S({onWillAddFirstListener:()=>o.value=this.registerStorageChangeListeners(),onDidRemoveLastListener:()=>o.value=void 0}))}_onDidChange;registerStorageChangeListeners(){this.logService.debug("ProfileStorageChangesListenerChannel#registerStorageChangeListeners");let e=new re;return e.add(E.debounce(this.storageMainService.applicationStorage.onDidChangeStorage,(r,i)=>(r?r.push(i.key):r=[i.key],r),100)(r=>this.onDidChangeApplicationStorage(r))),e.add(E.debounce(this.storageMainService.onDidChangeProfileStorage,(r,i)=>{r||(r=new Map);let o=r.get(i.profile.id);return o||r.set(i.profile.id,o={profile:i.profile,keys:[],storage:i.storage}),o.keys.push(i.key),r},100)(r=>this.onDidChangeProfileStorage(r))),e}onDidChangeApplicationStorage(e){let r=e.includes(bn)?[this.userDataProfilesService.defaultProfile]:[],i=[];if(e=e.filter(o=>o!==bn),e.length){let o=$c(this.storageMainService.applicationStorage.storage);i.push({profile:this.userDataProfilesService.defaultProfile,changes:e.map(s=>({key:s,scope:0,target:o[s]}))})}this.triggerEvents(r,i)}onDidChangeProfileStorage(e){let r=[],i=new Map;for(let[o,s]of e.entries()){s.keys.includes(bn)&&r.push(s.profile);let a=s.keys.filter(l=>l!==bn);if(a.length){let l=$c(s.storage.storage);i.set(o,{profile:s.profile,changes:a.map(c=>({key:c,scope:0,target:l[c]}))})}}this.triggerEvents(r,[...i.values()])}triggerEvents(e,r){(e.length||r.length)&&this._onDidChange.fire({valueChanges:r,targetChanges:e})}listen(e,r,i){switch(r){case"onDidChange":return this._onDidChange.event}throw new Error(`[ProfileStorageChangesListenerChannel] Event not found: ${r}`)}async call(e,r){throw new Error(`Call not found: ${r}`)}};async function bI(n,t){let e=n.getItem(od);return(typeof e!="string"||A&&e==="6c9d2bc8f91b89624add29c0abeae7fb42bf539fa1cdb2e3e57cd668fa9bcead")&&(e=await Eb(t.error.bind(t))),e}async function II(n,t){let e=n.getItem(sd);return typeof e!="string"&&(e=await Pb(t.error.bind(t))),e}async function wI(n,t){let e=n.getItem(ad);return typeof e!="string"&&(e=await Tb(t.error.bind(t))),e}async function xI(n,t){let e=await bI(n,t);return n.setItem(od,e),e}async function SI(n,t){let e=await II(n,t);return n.setItem(sd,e),e}async function EI(n,t){let e=await wI(n,t);return n.setItem(ad,e),e}var Ws=class extends Rs{constructor(t,e,r,i,o,s){super(x.file(t.extensionsPath),e,r,i,o,s)}};Ws=P([h(0,Jr),h(1,We),h(2,$t),h(3,ht),h(4,He),h(5,B)],Ws);var ku=class{constructor(t){this.loggerService=t}loggers=new Ot;listen(t,e,r){switch(e){case"onDidChangeLoggers":return r?this.loggerService.getOnDidChangeLoggersEvent(r):this.loggerService.onDidChangeLoggers;case"onDidChangeLogLevel":return r?this.loggerService.getOnDidChangeLogLevelEvent(r):this.loggerService.onDidChangeLogLevel;case"onDidChangeVisibility":return r?this.loggerService.getOnDidChangeVisibilityEvent(r):this.loggerService.onDidChangeVisibility}throw new Error(`Event not found: ${e}`)}async call(t,e,r){switch(e){case"createLogger":this.createLogger(x.revive(r[0]),r[1],r[2]);return;case"log":return this.log(x.revive(r[0]),r[1]);case"consoleLog":return this.consoleLog(r[0],r[1]);case"setLogLevel":return _c(r[0])?this.loggerService.setLogLevel(r[0]):this.loggerService.setLogLevel(x.revive(r[0]),r[1]);case"setVisibility":return this.loggerService.setVisibility(x.revive(r[0]),r[1]);case"registerLogger":return this.loggerService.registerLogger({...r[0],resource:x.revive(r[0].resource)},r[1]);case"deregisterLogger":return this.loggerService.deregisterLogger(x.revive(r[0]))}throw new Error(`Call not found: ${e}`)}createLogger(t,e,r){this.loggers.set(t,this.loggerService.createLogger(t,e,r))}consoleLog(t,e){let r=console.log;switch(t){case 5:r=console.error;break;case 4:r=console.warn;break;case 3:r=console.info;break}r.call(console,...e)}log(t,e){let r=this.loggers.get(t);if(!r)throw new Error("Create the logger before logging");for(let[i,o]of e)iv(r,i,o)}};var PI="utilityProcessWorker";var Lm=R("utilityProcessWorker"),Fs=class extends O{constructor(e,r,i,o){super();this.logService=e;this.windowsMainService=r;this.telemetryService=i;this.lifecycleMainService=o}workers=new Map;async createWorker(e){let r=`window: ${e.reply.windowId}, moduleId: ${e.process.moduleId}`;this.logService.trace(`[UtilityProcessWorker]: createWorker(${r})`);let i=this.hash(e);this.workers.has(i)&&(this.logService.warn(`[UtilityProcessWorker]: createWorker() found an existing worker that will be terminated (${r})`),this.disposeWorker(e));let o=new vl(this.logService,this.windowsMainService,this.telemetryService,this.lifecycleMainService,e);if(!o.spawn())return{reason:{code:1,signal:"EINVALID"}};this.workers.set(i,o);let s=new Ht;return E.once(o.onDidTerminate)(a=>{a.code===0?this.logService.trace(`[UtilityProcessWorker]: terminated normally with code ${a.code}, signal: ${a.signal}`):this.logService.error(`[UtilityProcessWorker]: terminated unexpectedly with code ${a.code}, signal: ${a.signal}`),this.workers.delete(i),s.complete({reason:a})}),s.p}hash(e){return er({moduleId:e.process.moduleId,windowId:e.reply.windowId})}async disposeWorker(e){let r=this.hash(e),i=this.workers.get(r);i&&(this.logService.trace(`[UtilityProcessWorker]: disposeWorker(window: ${e.reply.windowId}, moduleId: ${e.process.moduleId})`),i.kill(),i.dispose(),this.workers.delete(r))}};Fs=P([h(0,B),h(1,Te),h(2,He),h(3,le)],Fs);var vl=class extends O{constructor(e,r,i,o,s){super();this.logService=e;this.windowsMainService=r;this.telemetryService=i;this.lifecycleMainService=o;this.configuration=s;this.registerListeners()}_onDidTerminate=this._register(new S);onDidTerminate=this._onDidTerminate.event;utilityProcess=this._register(new li(this.logService,this.windowsMainService,this.telemetryService,this.lifecycleMainService));registerListeners(){this._register(this.utilityProcess.onExit(e=>this._onDidTerminate.fire({code:e.code,signal:e.signal}))),this._register(this.utilityProcess.onCrash(e=>this._onDidTerminate.fire({code:e.code,signal:"ECRASH"})))}spawn(){let r=this.windowsMainService.getWindowById(this.configuration.reply.windowId)?.win?.webContents.getOSProcessId();return this.utilityProcess.start({type:this.configuration.process.type,entryPoint:this.configuration.process.moduleId,parentLifecycleBound:r,windowLifecycleBound:!0,correlationId:`${this.configuration.reply.windowId}`,responseWindowId:this.configuration.reply.windowId,responseChannel:this.configuration.reply.channel,responseNonce:this.configuration.reply.nonce})}kill(){this.utilityProcess.kill()}};vl=P([h(0,B),h(1,Te),h(2,He),h(3,le)],vl);import"electron";var Us=class extends O{constructor(e,r,i,o,s){super();this._reconnectConstants=e;this._configurationService=r;this._environmentMainService=i;this._lifecycleMainService=o;this._logService=s;this._register(this._lifecycleMainService.onWillShutdown(()=>this._onWillShutdown.fire())),ke.on("vscode:createPtyHostMessageChannel",(a,l)=>this._onWindowConnection(a,l)),this._register(Z(()=>{ke.removeHandler("vscode:createPtyHostMessageChannel")}))}utilityProcess=void 0;_onRequestConnection=new S;onRequestConnection=this._onRequestConnection.event;_onWillShutdown=new S;onWillShutdown=this._onWillShutdown.event;start(){this.utilityProcess=new Ct(this._logService,Qo,this._lifecycleMainService);let e=$g(this._environmentMainService.args,this._environmentMainService.isBuilt),r=e.port?["--nolazy",`--inspect${e.break?"-brk":""}=${e.port}`]:void 0;this.utilityProcess.start({type:"ptyHost",entryPoint:"vs/platform/terminal/node/ptyHostMain",execArgv:r,args:["--logsPath",this._environmentMainService.logsHome.with({scheme:U.file}).fsPath],env:this._createPtyHostConfiguration()});let i=this.utilityProcess.connect(),o=new To(i,"ptyHost"),s=new re;return s.add(o),s.add(Z(()=>{this.utilityProcess?.kill(),this.utilityProcess?.dispose(),this.utilityProcess=void 0})),{client:o,store:s,onDidProcessExit:this.utilityProcess.onExit}}_createPtyHostConfiguration(){this._environmentMainService.unsetSnapExportedVariables();let e={...In(process.env),VSCODE_AMD_ENTRYPOINT:"vs/platform/terminal/node/ptyHostMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true",VSCODE_RECONNECT_GRACE_TIME:String(this._reconnectConstants.graceTime),VSCODE_RECONNECT_SHORT_GRACE_TIME:String(this._reconnectConstants.shortGraceTime),VSCODE_RECONNECT_SCROLLBACK:String(this._reconnectConstants.scrollback)},r=this._configurationService.getValue("terminal.integrated.developer.ptyHost.latency");r&&typeof r=="number"&&(e.VSCODE_LATENCY=String(r));let i=this._configurationService.getValue("terminal.integrated.developer.ptyHost.startupDelay");return i&&typeof i=="number"&&(e.VSCODE_STARTUP_DELAY=String(i)),this._environmentMainService.restoreSnapExportedVariables(),e}_onWindowConnection(e,r){this._onRequestConnection.fire();let i=this.utilityProcess.connect();if(e.sender.isDestroyed()){i.close();return}e.sender.postMessage("vscode:createPtyHostMessageChannelResult",r,[i])}};Us=P([h(1,Ie),h(2,ge),h(3,le),h(4,B)],Us);var _u=class extends O{constructor(t,e){super(),e.call("setLogLevel",[t.getLogLevel()]),this._register(t.onDidChangeLogLevel(r=>e.call("setLogLevel",[r]))),e.call("getRegisteredLoggers").then(r=>{for(let i of r)t.registerLogger({...i,resource:x.revive(i.resource)})}),this._register(e.listen("onDidChangeVisibility")(([r,i])=>t.setVisibility(x.revive(r),i))),this._register(e.listen("onDidChangeLoggers")(({added:r,removed:i})=>{for(let o of r)t.registerLogger({...o,resource:x.revive(o.resource)});for(let o of i)t.deregisterLogger(o.resource)}))}};var Ns=class extends O{constructor(e,r){super();this._logService=r;this._timeout=e===void 0?15e3:e,this._register(Z(()=>{for(let i of this._pendingRequestDisposables.values())ft(i)}))}_lastRequestId=0;_timeout;_pendingRequests=new Map;_pendingRequestDisposables=new Map;_onCreateRequest=this._register(new S);onCreateRequest=this._onCreateRequest.event;createRequest(e){return new Promise((r,i)=>{let o=++this._lastRequestId;this._pendingRequests.set(o,r),this._onCreateRequest.fire({requestId:o,...e});let s=new mt;$e(this._timeout,s.token).then(()=>i(`Request ${o} timed out (${this._timeout}ms)`)),this._pendingRequestDisposables.set(o,[Z(()=>s.cancel())])})}acceptReply(e,r){let i=this._pendingRequests.get(e);i?(this._pendingRequests.delete(e),ft(this._pendingRequestDisposables.get(e)||[]),this._pendingRequestDisposables.delete(e),i(r)):this._logService.warn(`RequestStore#acceptReply was called without receiving a matching request ${e}`)}};Ns=P([h(1,B)],Ns);function TI(n,t){let e=[{name:null,description:p("terminalAutomaticProfile","Automatically detect the default")}];return e.push(...n.map(r=>({name:r.profileName,description:KE(r)}))),t&&e.push(...t.map(r=>({name:r.title,description:HE(r)}))),{values:e.map(r=>r.name),markdownDescriptions:e.map(r=>r.description)}}function KE(n){let t=`$(${Tt.isThemeIcon(n.icon)?n.icon.id:n.icon?n.icon:Qe.terminal.id}) ${n.profileName}
- path: ${n.path}`;return n.args&&(typeof n.args=="string"?t+=`
- args: "${n.args}"`:t+=`
- args: [${n.args.length===0?"":`'${n.args.join("','")}'`}]`),n.overrideName!==void 0&&(t+=`
- overrideName: ${n.overrideName}`),n.color&&(t+=`
- color: ${n.color}`),n.env&&(t+=`
- env: ${JSON.stringify(n.env)}`),t}function HE(n){return`$(${Tt.isThemeIcon(n.icon)?n.icon.id:n.icon?n.icon:Qe.terminal.id}) ${n.title}
- extensionIdentifier: ${n.extensionIdentifier}`}var zE={type:["string","null"],enum:["terminal.ansiBlack","terminal.ansiRed","terminal.ansiGreen","terminal.ansiYellow","terminal.ansiBlue","terminal.ansiMagenta","terminal.ansiCyan","terminal.ansiWhite"],default:null},qE={type:"string",enum:Array.from($p(),n=>n.id),markdownEnumDescriptions:Array.from($p(),n=>`$(${n.id})`)},Bs={args:{description:p("terminalProfile.args","An optional set of arguments to run the shell executable with."),type:"array",items:{type:"string"}},overrideName:{description:p("terminalProfile.overrideName","Whether or not to replace the dynamic terminal title that detects what program is running with the static profile name."),type:"boolean"},icon:{description:p("terminalProfile.icon","A codicon ID to associate with the terminal icon."),...qE},color:{description:p("terminalProfile.color","A theme color ID to associate with the terminal icon."),...zE},env:{markdownDescription:p("terminalProfile.env","An object with environment variables that will be added to the terminal profile process. Set to `null` to delete environment variables from the base environment."),type:"object",additionalProperties:{type:["string","null"]},default:{}}},Om={type:"object",required:["path"],properties:{path:{description:p("terminalProfile.path","A single path to a shell executable or an array of paths that will be used as fallbacks when one fails."),type:["string","array"],items:{type:"string"}},...Bs}},Am={type:"object",required:["path"],properties:{path:{description:p("terminalAutomationProfile.path","A single path to a shell executable."),type:["string"],items:{type:"string"}},...Bs}};function Mm(n){let t=n===2?"linux":n===1?"osx":"windows";return p({key:"terminal.integrated.profile",comment:["{0} is the platform, {1} is a code block, {2} and {3} are a link start and end"]},`A set of terminal profile customizations for {0} which allows adding, removing or changing how terminals are launched. Profiles are made up of a mandatory path, optional arguments and other presentation options.

To override an existing profile use its profile name as the key, for example:

{1}

{2}Read more about configuring profiles{3}.`,Ll(n),'```json\n"terminal.integrated.profile.'+t+'": {\n  "bash": null\n}\n```',"[","](https://code.visualstudio.com/docs/terminal/profiles)")}var $E={id:"terminal",order:100,title:p("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.automationProfile.linux":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.linux","The terminal profile to use on Linux for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},Am],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.osx":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.osx","The terminal profile to use on macOS for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},Am],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.windows":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.windows","The terminal profile to use for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.windows`"),type:["object","null"],default:null,anyOf:[{type:"null"},Am],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.profiles.windows":{restricted:!0,markdownDescription:Mm(3),type:"object",default:{PowerShell:{source:"PowerShell",icon:"terminal-powershell"},"Command Prompt":{path:["${env:windir}\\Sysnative\\cmd.exe","${env:windir}\\System32\\cmd.exe"],args:[],icon:"terminal-cmd"},"Git Bash":{source:"Git Bash"}},additionalProperties:{anyOf:[{type:"object",required:["source"],properties:{source:{description:p("terminalProfile.windowsSource","A profile source that will auto detect the paths to the shell. Note that non-standard executable locations are not supported and must be created manually in a new profile."),enum:["PowerShell","Git Bash"]},...Bs}},{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.windowsExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.windowsExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.windowsExtensionTitle","The name of the extension terminal"),type:"string"},...Bs}},{type:"null"},Om]}},"terminal.integrated.profiles.osx":{restricted:!0,markdownDescription:Mm(1),type:"object",default:{bash:{path:"bash",args:["-l"],icon:"terminal-bash"},zsh:{path:"zsh",args:["-l"]},fish:{path:"fish",args:["-l"]},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.osxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.osxExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.osxExtensionTitle","The name of the extension terminal"),type:"string"},...Bs}},{type:"null"},Om]}},"terminal.integrated.profiles.linux":{restricted:!0,markdownDescription:Mm(2),type:"object",default:{bash:{path:"bash",icon:"terminal-bash"},zsh:{path:"zsh"},fish:{path:"fish"},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.linuxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.linuxExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.linuxExtensionTitle","The name of the extension terminal"),type:"string"},...Bs}},{type:"null"},Om]}},"terminal.integrated.useWslProfiles":{description:p("terminal.integrated.useWslProfiles","Controls whether or not WSL distros are shown in the terminal dropdown"),type:"boolean",default:!0},"terminal.integrated.inheritEnv":{scope:1,description:p("terminal.integrated.inheritEnv","Whether new shells should inherit their environment from VS Code, which may source a login shell to ensure $PATH and other development variables are initialized. This has no effect on Windows."),type:"boolean",default:!0},"terminal.integrated.persistentSessionScrollback":{scope:1,markdownDescription:p("terminal.integrated.persistentSessionScrollback","Controls the maximum amount of lines that will be restored when reconnecting to a persistent terminal session. Increasing this will restore more lines of scrollback at the cost of more memory and increase the time it takes to connect to terminals on start up. This setting requires a restart to take effect and should be set to a value less than or equal to `#terminal.integrated.scrollback#`."),type:"number",default:100},"terminal.integrated.showLinkHover":{scope:1,description:p("terminal.integrated.showLinkHover","Whether to show hovers for links in the terminal output."),type:"boolean",default:!0},"terminal.integrated.ignoreProcessNames":{markdownDescription:p("terminal.integrated.confirmIgnoreProcesses","A set of process names to ignore when using the {0} setting.","`#terminal.integrated.confirmOnKill#`"),type:"array",items:{type:"string",uniqueItems:!0},default:["starship","oh-my-posh","bash","zsh"]}}};function kI(){et.as(yn.Configuration).registerConfiguration($E),jE()}var Wm;function jE(n,t){let e=et.as(yn.Configuration),r;n&&(r=TI(n?.profiles,t));let i=Wm;Wm={id:"terminal",order:100,title:p("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.defaultProfile.linux":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.linux","The default terminal profile on Linux."),type:["string","null"],default:null,enum:n?.os===3?r?.values:void 0,markdownEnumDescriptions:n?.os===3?r?.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.osx":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.osx","The default terminal profile on macOS."),type:["string","null"],default:null,enum:n?.os===2?r?.values:void 0,markdownEnumDescriptions:n?.os===2?r?.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.windows":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.windows","The default terminal profile on Windows."),type:["string","null"],default:null,enum:n?.os===1?r?.values:void 0,markdownEnumDescriptions:n?.os===1?r?.markdownDescriptions:void 0}}},e.updateConfigurations({add:[Wm],remove:i?[i]:[]})}import*as RI from"fs";import*as LI from"child_process";import*as yl from"os";var bTe=new Map([[2,"APPEND"],[3,"PREPEND"],[1,"REPLACE"]]);function CI(){let n=/(\d+)\.(\d+)\.(\d+)/g.exec(yl.release()),t=0;return n&&n.length===4&&(t=parseInt(n[3])),t}async function Fm(n,t,e,r=xt,i=$.exists){if(fr(n))return await i(n)?n:void 0;if(t===void 0&&(t=pr()),Fe(n)!=="."){let l=F(t,n);return await i(l)?l:void 0}let s=by(r,"PATH");if(e===void 0&&Ce(s)&&(e=s.split(uo)),e===void 0||e.length===0){let l=F(t,n);return await i(l)?l:void 0}for(let l of e){let c;if(fr(l)?c=F(l,n):c=F(t,l,n),await i(c))return c;if(N){let d=c+".com";if(await i(d)||(d=c+".exe",await i(d)))return d}}let a=F(t,n);return await i(a)?a:void 0}var no=new Map;no.set("windows-pwsh",["-noexit","-command",'try { . "{0}\\out\\vs\\workbench\\contrib\\terminal\\common\\scripts\\shellIntegration.ps1" } catch {}{1}']);no.set("windows-pwsh-login",["-l","-noexit","-command",'try { . "{0}\\out\\vs\\workbench\\contrib\\terminal\\common\\scripts\\shellIntegration.ps1" } catch {}{1}']);no.set("pwsh",["-noexit","-command",'. "{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1"{1}']);no.set("pwsh-login",["-l","-noexit","-command",'. "{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1"']);no.set("zsh",["-i"]);no.set("zsh-login",["-il"]);no.set("bash",["--init-file","{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh"]);import{dirname as JE,resolve as QE}from"path";var bl,_I=!0;function OI(n,t,e,r,i=process.env,o,s,a,l){return o=o||{existsFile:gt.existsFile,readFile:RI.promises.readFile},N?YE(e,o,i,s,r.getValue("terminal.integrated.useWslProfiles")!==!1,n&&typeof n=="object"?{...n}:r.getValue("terminal.integrated.profiles.windows"),typeof t=="string"?t:r.getValue("terminal.integrated.defaultProfile.windows"),l,a):iP(o,s,e,n&&typeof n=="object"?{...n}:r.getValue(j?"terminal.integrated.profiles.linux":"terminal.integrated.profiles.osx"),typeof t=="string"?t:r.getValue(j?"terminal.integrated.defaultProfile.linux":"terminal.integrated.defaultProfile.osx"),l,a,i)}async function YE(n,t,e,r,i,o,s,a,l){let c=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),d=`${process.env.windir}\\${c?"Sysnative":"System32"}`,f=!1;CI()>=16299&&(f=!0),await ZE(a);let m=new Map;if(n){m.set("PowerShell",{source:"PowerShell",icon:Qe.terminalPowershell,isAutoDetected:!0}),m.set("Windows PowerShell",{path:`${d}\\WindowsPowerShell\\v1.0\\powershell.exe`,icon:Qe.terminalPowershell,isAutoDetected:!0}),m.set("Git Bash",{source:"Git Bash",isAutoDetected:!0}),m.set("Command Prompt",{path:`${d}\\cmd.exe`,icon:Qe.terminalCmd,isAutoDetected:!0}),m.set("Cygwin",{path:[{path:`${process.env.HOMEDRIVE}\\cygwin64\\bin\\bash.exe`,isUnsafe:!0},{path:`${process.env.HOMEDRIVE}\\cygwin\\bin\\bash.exe`,isUnsafe:!0}],args:["--login"],isAutoDetected:!0}),m.set("bash (MSYS2)",{path:[{path:`${process.env.HOMEDRIVE}\\msys64\\usr\\bin\\bash.exe`,isUnsafe:!0}],args:["--login","-i"],env:{CHERE_INVOKING:"1"},icon:Qe.terminalBash,isAutoDetected:!0});let b=`${process.env.CMDER_ROOT||`${process.env.HOMEDRIVE}\\cmder`}\\vendor\\bin\\vscode_init.cmd`;m.set("Cmder",{path:`${d}\\cmd.exe`,args:["/K",b],requiresPath:process.env.CMDER_ROOT?b:{path:b,isUnsafe:!0},isAutoDetected:!0})}MI(o,m);let g=await AI(m.entries(),s,t,e,r,l);if(n&&i)try{let b=await rP(`${d}\\${f?"wsl":"bash"}.exe`,s);for(let v of b)(!o||!(v.profileName in o))&&g.push(v)}catch{_I&&(r?.trace("WSL is not installed, so could not detect WSL profiles"),_I=!1)}return g}async function AI(n,t,e,r=process.env,i,o){let s=[];for(let[a,l]of n)s.push(XE(a,l,t,e,r,i,o));return(await Promise.all(s)).filter(a=>!!a)}async function XE(n,t,e,r,i=process.env,o,s){if(t===null)return;let a,l,c;if("source"in t&&!("path"in t)){let g=bl?.get(t.source);if(!g)return;a=g.paths,l=t.args||g.args,t.icon?c=DI(t.icon):g.icon&&(c=g.icon)}else a=Array.isArray(t.path)?t.path:[t.path],l=N||Array.isArray(t.args)?t.args:void 0,c=DI(t.icon);let d;if(s){let g=a.map(v=>typeof v=="string"?v:v.path),b=await s(g);d=new Array(a.length);for(let v=0;v<a.length;v++)typeof a[v]=="string"?d[v]=b[v]:d[v]={path:b[v],isUnsafe:!0}}else d=a.slice();let f;if(t.requiresPath){let g;if(Ce(t.requiresPath)?g=t.requiresPath:(g=t.requiresPath.path,t.requiresPath.isUnsafe&&(f=g)),!await r.existsFile(g))return}let m=await Du(n,e,d,r,i,l,t.env,t.overrideName,t.isAutoDetected,f);if(!m){o?.debug("Terminal profile not validated",n,a);return}return m.isAutoDetected=t.isAutoDetected,m.icon=c,m.color=t.color,m}function DI(n){return typeof n=="string"?{id:n}:n}async function ZE(n){if(bl&&!n)return;let[t,e]=await Promise.all([eP(),n||tP()]);bl=new Map,bl.set("Git Bash",{profileName:"Git Bash",paths:t,args:["--login","-i"]}),bl.set("PowerShell",{profileName:"PowerShell",paths:e,icon:Qe.terminalPowershell})}async function eP(){let n=new Set,t=await Fm("git.exe");if(t){let i=JE(t);n.add(QE(i,"../.."))}function e(i,o){o&&i.add(o)}e(n,process.env.ProgramW6432),e(n,process.env.ProgramFiles),e(n,process.env["ProgramFiles(X86)"]),e(n,`${process.env.LocalAppData}\\Program`);let r=[];for(let i of n)r.push(`${i}\\Git\\bin\\bash.exe`,`${i}\\Git\\usr\\bin\\bash.exe`,`${i}\\usr\\bin\\bash.exe`);return r.push(`${process.env.UserProfile}\\scoop\\apps\\git\\current\\bin\\bash.exe`),r.push(`${process.env.UserProfile}\\scoop\\apps\\git-with-openssh\\current\\bin\\bash.exe`),r}async function tP(){let n=[];for await(let t of Hf())n.push(t.exePath);return n}async function rP(n,t){let e=[],r=await new Promise((s,a)=>{LI.exec("wsl.exe -l -q",{encoding:"utf16le",timeout:1e3},(l,c)=>{if(l)return a("Problem occurred when getting wsl distros");s(c)})});if(!r)return[];let i=new RegExp(/[\r?\n]/),o=r.split(i).filter(s=>s.trim().length>0&&s!=="");for(let s of o){if(s===""||s.startsWith("docker-desktop"))continue;let a=`${s} (WSL)`,l={profileName:a,path:n,args:["-d",`${s}`],isDefault:a===t,icon:nP(s),isAutoDetected:!1};e.push(l)}return e}function nP(n){return n.includes("Ubuntu")?Qe.terminalUbuntu:n.includes("Debian")?Qe.terminalDebian:Qe.terminalLinux}async function iP(n,t,e,r,i,o,s,a){let l=new Map;if(e&&await n.existsFile("/etc/shells")){let c=(await n.readFile("/etc/shells")).toString(),d=(o||c.split(`
`)).map(m=>{let g=m.indexOf("#");return g===-1?m:m.substring(0,g)}).filter(m=>m.trim().length>0),f=new Map;for(let m of d){let g=ve(m),b=f.get(g)||0;b++,b>1&&(g=`${g} (${b})`),f.set(g,b),l.set(g,{path:m,isAutoDetected:!0})}}return MI(r,l),await AI(l.entries(),i,n,a,t,s)}function MI(n,t){if(n)for(let[e,r]of Object.entries(n))r===null||typeof r!="object"||!("path"in r)&&!("source"in r)?t.delete(e):(r.icon=r.icon||t.get(e)?.icon,t.set(e,r))}async function Du(n,t,e,r,i,o,s,a,l,c){if(e.length===0)return Promise.resolve(void 0);let d=e.shift();if(d==="")return Du(n,t,e,r,i,o,s,a,l);let f=typeof d!="string"&&d.isUnsafe,m=typeof d=="string"?d:d.path,g={profileName:n,path:m,args:o,env:s,overrideName:a,isAutoDetected:l,isDefault:n===t,isUnsafePath:f,requiresUnsafePath:c};if(ve(m)===m){let v=i.PATH?i.PATH.split(uo):void 0,w=await Fm(m,void 0,v,void 0,r.existsFile);return w?(g.path=w,g.isFromPath=!0,g):Du(n,t,e,r,i,o)}return await r.existsFile(ct(m))?g:Du(n,t,e,r,i,o,s,a,l)}var Vs=class extends O{constructor(e,r,i,o){super();this._ptyHostStarter=e;this._configurationService=r;this._logService=i;this._loggerService=o;kI(),this._register(this._ptyHostStarter),this._register(Z(()=>this._disposePtyHost())),this._resolveVariablesRequestStore=this._register(new Ns(void 0,this._logService)),this._register(this._resolveVariablesRequestStore.onCreateRequest(this._onPtyHostRequestResolveVariables.fire,this._onPtyHostRequestResolveVariables)),this._ptyHostStarter.onRequestConnection&&this._register(E.once(this._ptyHostStarter.onRequestConnection)(()=>this._ensurePtyHost())),this._ptyHostStarter.onWillShutdown&&this._register(this._ptyHostStarter.onWillShutdown(()=>this._wasQuitRequested=!0))}__connection;__proxy;get _connection(){return this._ensurePtyHost(),this.__connection}get _proxy(){return this._ensurePtyHost(),this.__proxy}get _optionalProxy(){return this.__proxy}_ensurePtyHost(){this.__connection||this._startPtyHost()}_resolveVariablesRequestStore;_wasQuitRequested=!1;_restartCount=0;_isResponsive=!0;_heartbeatFirstTimeout;_heartbeatSecondTimeout;_onPtyHostExit=this._register(new S);onPtyHostExit=this._onPtyHostExit.event;_onPtyHostStart=this._register(new S);onPtyHostStart=this._onPtyHostStart.event;_onPtyHostUnresponsive=this._register(new S);onPtyHostUnresponsive=this._onPtyHostUnresponsive.event;_onPtyHostResponsive=this._register(new S);onPtyHostResponsive=this._onPtyHostResponsive.event;_onPtyHostRequestResolveVariables=this._register(new S);onPtyHostRequestResolveVariables=this._onPtyHostRequestResolveVariables.event;_onProcessData=this._register(new S);onProcessData=this._onProcessData.event;_onProcessReady=this._register(new S);onProcessReady=this._onProcessReady.event;_onProcessReplay=this._register(new S);onProcessReplay=this._onProcessReplay.event;_onProcessOrphanQuestion=this._register(new S);onProcessOrphanQuestion=this._onProcessOrphanQuestion.event;_onDidRequestDetach=this._register(new S);onDidRequestDetach=this._onDidRequestDetach.event;_onDidChangeProperty=this._register(new S);onDidChangeProperty=this._onDidChangeProperty.event;_onProcessExit=this._register(new S);onProcessExit=this._onProcessExit.event;get _ignoreProcessNames(){return this._configurationService.getValue("terminal.integrated.ignoreProcessNames")}async _refreshIgnoreProcessNames(){return this._optionalProxy?.refreshIgnoreProcessNames?.(this._ignoreProcessNames)}async _resolveShellEnv(){if(N)return process.env;try{return await Md(this._configurationService,this._logService,{_:[]},process.env)}catch(e){return this._logService.error("ptyHost was unable to resolve shell environment",e),{}}}_startPtyHost(){let e=this._ptyHostStarter.start(),r=e.client;this._logService.getLevel()===1&&this._logService.trace("PtyHostService#_startPtyHost",new Error().stack?.replace(/^Error/,"")),je.toService(r.getChannel("heartbeat")).onBeat(()=>this._handleHeartbeat()),this._handleHeartbeat(!0),this._register(e.onDidProcessExit(s=>{this._onPtyHostExit.fire(s.code),!this._wasQuitRequested&&!this._store.isDisposed&&(this._restartCount<=5?(this._logService.error(`ptyHost terminated unexpectedly with code ${s.code}`),this._restartCount++,this.restartPtyHost()):this._logService.error(`ptyHost terminated unexpectedly with code ${s.code}, giving up`))}));let o=je.toService(r.getChannel("ptyHost"));return this._register(o.onProcessData(s=>this._onProcessData.fire(s))),this._register(o.onProcessReady(s=>this._onProcessReady.fire(s))),this._register(o.onProcessExit(s=>this._onProcessExit.fire(s))),this._register(o.onDidChangeProperty(s=>this._onDidChangeProperty.fire(s))),this._register(o.onProcessReplay(s=>this._onProcessReplay.fire(s))),this._register(o.onProcessOrphanQuestion(s=>this._onProcessOrphanQuestion.fire(s))),this._register(o.onDidRequestDetach(s=>this._onDidRequestDetach.fire(s))),this._register(new _u(this._loggerService,r.getChannel("logger"))),this.__connection=e,this.__proxy=o,this._onPtyHostStart.fire(),this._register(this._configurationService.onDidChangeConfiguration(async s=>{s.affectsConfiguration("terminal.integrated.ignoreProcessNames")&&await this._refreshIgnoreProcessNames()})),this._refreshIgnoreProcessNames(),[e,o]}async createProcess(e,r,i,o,s,a,l,c,d,f,m){let g=setTimeout(()=>this._handleUnresponsiveCreateProcess(),5e3),b=await this._proxy.createProcess(e,r,i,o,s,a,l,c,d,f,m);return clearTimeout(g),b}updateTitle(e,r,i){return this._proxy.updateTitle(e,r,i)}updateIcon(e,r,i,o){return this._proxy.updateIcon(e,r,i,o)}attachToProcess(e){return this._proxy.attachToProcess(e)}detachFromProcess(e,r){return this._proxy.detachFromProcess(e,r)}shutdownAll(){return this._proxy.shutdownAll()}listProcesses(){return this._proxy.listProcesses()}async getPerformanceMarks(){return this._optionalProxy?.getPerformanceMarks()??[]}async reduceConnectionGraceTime(){return this._optionalProxy?.reduceConnectionGraceTime()}start(e){return this._proxy.start(e)}shutdown(e,r){return this._proxy.shutdown(e,r)}input(e,r){return this._proxy.input(e,r)}processBinary(e,r){return this._proxy.processBinary(e,r)}resize(e,r,i){return this._proxy.resize(e,r,i)}clearBuffer(e){return this._proxy.clearBuffer(e)}acknowledgeDataEvent(e,r){return this._proxy.acknowledgeDataEvent(e,r)}setUnicodeVersion(e,r){return this._proxy.setUnicodeVersion(e,r)}getInitialCwd(e){return this._proxy.getInitialCwd(e)}getCwd(e){return this._proxy.getCwd(e)}async getLatency(){let e=new $r,r=await this._proxy.getLatency();return e.stop(),[{label:"ptyhostservice<->ptyhost",latency:e.elapsed()},...r]}orphanQuestionReply(e){return this._proxy.orphanQuestionReply(e)}installAutoReply(e,r){return this._proxy.installAutoReply(e,r)}uninstallAllAutoReplies(){return this._proxy.uninstallAllAutoReplies()}uninstallAutoReply(e){return this._proxy.uninstallAutoReply(e)}getDefaultSystemShell(e){return this._optionalProxy?.getDefaultSystemShell(e)??Ad(e??ur,process.env)}async getProfiles(e,r,i,o=!1){let s=await this._resolveShellEnv();return OI(r,i,o,this._configurationService,s,void 0,this._logService,this._resolveVariables.bind(this,e))}async getEnvironment(){return this.__proxy?this._proxy.getEnvironment():{...process.env}}getWslPath(e,r){return this._proxy.getWslPath(e,r)}getRevivedPtyNewId(e,r){return this._proxy.getRevivedPtyNewId(e,r)}setTerminalLayoutInfo(e){return this._proxy.setTerminalLayoutInfo(e)}async getTerminalLayoutInfo(e){return this._optionalProxy?.getTerminalLayoutInfo(e)}async requestDetachInstance(e,r){return this._proxy.requestDetachInstance(e,r)}async acceptDetachInstanceReply(e,r){return this._proxy.acceptDetachInstanceReply(e,r)}async freePortKillProcess(e){if(!this._proxy.freePortKillProcess)throw new Error("freePortKillProcess does not exist on the pty proxy");return this._proxy.freePortKillProcess(e)}async serializeTerminalState(e){return this._proxy.serializeTerminalState(e)}async reviveTerminalProcesses(e,r,i){return this._proxy.reviveTerminalProcesses(e,r,i)}async refreshProperty(e,r){return this._proxy.refreshProperty(e,r)}async updateProperty(e,r,i){return this._proxy.updateProperty(e,r,i)}async restartPtyHost(){this._disposePtyHost(),this._isResponsive=!0,this._startPtyHost()}_disposePtyHost(){this._proxy.shutdownAll(),this._connection.store.dispose()}_handleHeartbeat(e){this._clearHeartbeatTimeouts(),this._heartbeatFirstTimeout=setTimeout(()=>this._handleHeartbeatFirstTimeout(),e?2e4:5e3*1.2),this._isResponsive||(this._isResponsive=!0,this._onPtyHostResponsive.fire())}_handleHeartbeatFirstTimeout(){this._logService.warn(`No ptyHost heartbeat after ${5e3*1.2/1e3} seconds`),this._heartbeatFirstTimeout=void 0,this._heartbeatSecondTimeout=setTimeout(()=>this._handleHeartbeatSecondTimeout(),5e3*1)}_handleHeartbeatSecondTimeout(){this._logService.error(`No ptyHost heartbeat after ${(5e3*1.2+5e3*1.2)/1e3} seconds`),this._heartbeatSecondTimeout=void 0,this._isResponsive&&(this._isResponsive=!1,this._onPtyHostUnresponsive.fire())}_handleUnresponsiveCreateProcess(){this._clearHeartbeatTimeouts(),this._logService.error(`No ptyHost response to createProcess after ${5e3/1e3} seconds`),this._isResponsive&&(this._isResponsive=!1,this._onPtyHostUnresponsive.fire())}_clearHeartbeatTimeouts(){this._heartbeatFirstTimeout&&(clearTimeout(this._heartbeatFirstTimeout),this._heartbeatFirstTimeout=void 0),this._heartbeatSecondTimeout&&(clearTimeout(this._heartbeatSecondTimeout),this._heartbeatSecondTimeout=void 0)}_resolveVariables(e,r){return this._resolveVariablesRequestStore.createRequest({workspaceId:e,originalText:r})}async acceptPtyHostResolvedVariables(e,r){this._resolveVariablesRequestStore.acceptReply(e,r)}};Vs=P([h(1,Ie),h(2,B),h(3,Ro)],Vs);var Um="request",WI="remoteResourceHandler",Ru=class{async routeCall(t,e,r){if(e!==Um)throw new Error(`Call not found: ${e}`);let i=r[0];if(i?.authority){let o=t.connections.find(s=>s.ctx===i.authority);if(o)return o}throw new Error("Caller not found")}routeEvent(t,e){throw new Error(`Event not found: ${e}`)}};import{BrowserWindow as sP,app as aP}from"electron";var Ks=class extends O{constructor(e,r){super();this.instantiationService=e;this.logService=r;this.registerListeners()}_onDidMaximizeWindow=this._register(new S);onDidMaximizeWindow=this._onDidMaximizeWindow.event;_onDidUnmaximizeWindow=this._register(new S);onDidUnmaximizeWindow=this._onDidUnmaximizeWindow.event;_onDidChangeFullScreen=this._register(new S);onDidChangeFullScreen=this._onDidChangeFullScreen.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;windows=new Map;registerListeners(){aP.on("browser-window-created",(e,r)=>{let i=this.getWindowByWebContents(r.webContents);if(i)this.logService.trace('[aux window] app.on("browser-window-created"): Trying to claim auxiliary window'),i.tryClaimWindow();else{let o=new re;o.add(E.fromNodeEventEmitter(r.webContents,"did-create-window",(s,a)=>({browserWindow:s,details:a}))(({browserWindow:s,details:a})=>{let l=this.getWindowByWebContents(s.webContents);l&&(this.logService.trace('[aux window] window.on("did-create-window"): Trying to claim auxiliary window'),l.tryClaimWindow(a.options))})),o.add(E.fromNodeEventEmitter(r,"closed")(()=>o.dispose()))}}),ke.handle("vscode:registerAuxiliaryWindow",async(e,r)=>{let i=this.getWindowByWebContents(e.sender);return i&&(this.logService.trace("[aux window] vscode:registerAuxiliaryWindow: Registering auxiliary window to main window"),i.parentId=r),e.sender.id})}createWindow(e){let{state:r,overrides:i}=this.computeWindowStateAndOverrides(e);return this.instantiationService.invokeFunction(hd,r,i,{preload:Me.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload-aux.js").fsPath})}computeWindowStateAndOverrides(e){let r={},i={},o=e.features.split(",");for(let a of o){let[l,c]=a.split("=");switch(l){case"width":r.width=parseInt(c,10);break;case"height":r.height=parseInt(c,10);break;case"left":r.x=parseInt(c,10);break;case"top":r.y=parseInt(c,10);break;case"window-maximized":r.mode=0;break;case"window-fullscreen":r.mode=3;break;case"window-disable-fullscreen":i.disableFullscreen=!0;break;case"window-native-titlebar":i.forceNativeTitlebar=!0;break}}let s=$a.validateWindowState(this.logService,r)??oy();return this.logService.trace("[aux window] using window state",s),{state:s,overrides:i}}registerWindow(e){let r=new re,i=this.instantiationService.createInstance(ts,e);this.windows.set(i.id,i),r.add(Z(()=>this.windows.delete(i.id))),r.add(i.onDidMaximize(()=>this._onDidMaximizeWindow.fire(i))),r.add(i.onDidUnmaximize(()=>this._onDidUnmaximizeWindow.fire(i))),r.add(i.onDidEnterFullScreen(()=>this._onDidChangeFullScreen.fire({window:i,fullscreen:!0}))),r.add(i.onDidLeaveFullScreen(()=>this._onDidChangeFullScreen.fire({window:i,fullscreen:!1}))),r.add(i.onDidTriggerSystemContextMenu(({x:o,y:s})=>this._onDidTriggerSystemContextMenu.fire({window:i,x:o,y:s}))),E.once(i.onDidClose)(()=>r.dispose())}getWindowByWebContents(e){let r=this.windows.get(e.id);return r?.matches(e)?r:void 0}getFocusedWindow(){let e=sP.getFocusedWindow();if(e)return this.getWindowByWebContents(e.webContents)}getLastActiveWindow(){return gd(Array.from(this.windows.values()))}getWindows(){return Array.from(this.windows.values())}};Ks=P([h(0,tr),h(1,B)],Ks);var zs=class extends O{constructor(e,r,i,o,s,a,l,c,d,f,m,g){super();this.mainProcessNodeIpcServer=e;this.userEnv=r;this.mainInstantiationService=i;this.logService=o;this.loggerService=s;this.environmentMainService=a;this.lifecycleMainService=l;this.configurationService=c;this.stateService=d;this.fileService=f;this.productService=m;this.userDataProfilesMainService=g;this.configureSession(),this.registerListeners()}static SECURITY_PROTOCOL_HANDLING_CONFIRMATION_SETTING_KEY={[U.file]:"security.promptForLocalFileProtocolHandling",[U.vscodeRemote]:"security.promptForRemoteFileProtocolHandling"};windowsMainService;auxiliaryWindowsMainService;nativeHostMainService;configureSession(){let e=d=>d?.startsWith(`${U.vscodeWebview}://`),r=new Set(["clipboard-read","clipboard-sanitized-write"]);Hs.defaultSession.setPermissionRequestHandler((d,f,m,g)=>e(g.requestingUrl)?m(r.has(f)):m(!1)),Hs.defaultSession.setPermissionCheckHandler((d,f,m,g)=>e(g.requestingUrl)?r.has(f):!1);let i=new Set([U.file,U.vscodeFileResource,U.vscodeRemoteResource,U.vscodeManagedRemoteResource,"devtools"]),o=d=>{for(let f=d;f;f=f.parent)if(f.url.startsWith(`${U.vscodeWebview}://`))return!0;return!1},s=d=>d.resourceType==="xhr"||o(d.frame),a=d=>{let f=d.frame;if(!f||!this.windowsMainService)return!1;let m=lP.getAllWindows();for(let g of m)if(f.processId===g.webContents.mainFrame.processId)return!0;return!1},l=(d,f)=>{if(d.path!=="/index.html")return!0;let m=f.frame;if(!m||!this.windowsMainService)return!1;for(let g of this.windowsMainService.getWindows())if(g.win&&m.processId===g.win.webContents.mainFrame.processId)return!0;return!1};Hs.defaultSession.webRequest.onBeforeRequest((d,f)=>{let m=x.parse(d.url);return m.scheme===U.vscodeWebview&&!l(m,d)?(this.logService.error("Blocked vscode-webview request",d.url),f({cancel:!0})):m.scheme===U.vscodeFileResource&&!a(d)?(this.logService.error("Blocked vscode-file request",d.url),f({cancel:!0})):m.path.endsWith(".svg")&&!i.has(m.scheme)?f({cancel:!s(d)}):f({cancel:!1})}),Hs.defaultSession.webRequest.onHeadersReceived((d,f)=>{let m=d.responseHeaders,g=m["content-type"]||m["Content-Type"];if(g&&Array.isArray(g)){let b=x.parse(d.url);if(b.path.endsWith(".svg")&&i.has(b.scheme))return m["Content-Type"]=["image/svg+xml"],f({cancel:!1,responseHeaders:m});if(!b.path.endsWith(U.vscodeRemoteResource)&&g.some(v=>v.toLowerCase().includes("image/svg")))return f({cancel:!s(d)})}return f({cancel:!1})}),Hs.defaultSession.webRequest.onHeadersReceived((d,f)=>{if(d.url.startsWith("https://vscode.download.prss.microsoft.com/")){let m=d.responseHeaders??Object.create(null);if(m["Access-Control-Allow-Origin"]===void 0)return m["Access-Control-Allow-Origin"]=["*"],f({cancel:!1,responseHeaders:m})}return f({cancel:!1})});let c=Hs.defaultSession;typeof c.setCodeCachePath=="function"&&this.environmentMainService.codeCachePath&&c.setCodeCachePath(F(this.environmentMainService.codeCachePath,"chrome")),N&&(this.configurationService.getValue("security.restrictUNCAccess")===!1?zm():Tl(this.configurationService.getValue("security.allowedUNCHosts")))}registerListeners(){$m(i=>this.onUnexpectedError(i)),process.on("uncaughtException",i=>{jm(i)||nt(i)}),process.on("unhandledRejection",i=>nt(i)),E.once(this.lifecycleMainService.onWillShutdown)(()=>this.dispose()),Sg(),io.on("accessibility-support-changed",(i,o)=>{this.windowsMainService?.sendToAll("vscode:accessibilitySupportChanged",o)}),io.on("activate",async(i,o)=>{this.logService.trace("app#activate"),o||await this.windowsMainService?.openEmptyWindow({context:1})}),io.on("web-contents-created",(i,o)=>{o?.opener?.url.startsWith(`${U.vscodeFileResource}://${la}/`)&&(this.logService.trace('[aux window]  app.on("web-contents-created"): Registering auxiliary window'),this.auxiliaryWindowsMainService?.registerWindow(o)),o.on("will-navigate",s=>{this.logService.error("webContents#will-navigate: Prevented webcontent navigation"),s.preventDefault()}),o.setWindowOpenHandler(s=>s.url==="about:blank"?(this.logService.trace("[aux window] webContents#setWindowOpenHandler: Allowing auxiliary window to open on about:blank"),{action:"allow",overrideBrowserWindowOptions:this.auxiliaryWindowsMainService?.createWindow(s)}):(this.logService.trace(`webContents#setWindowOpenHandler: Prevented opening window with URL ${s.url}}`),this.nativeHostMainService?.openExternal(void 0,s.url),{action:"deny"}))});let e=[],r;io.on("open-file",(i,o)=>{o=tn(o),this.logService.trace("app#open-file: ",o),i.preventDefault(),e.push(Qr(o)?{workspaceUri:x.file(o)}:{fileUri:x.file(o)}),r!==void 0&&(clearTimeout(r),r=void 0),r=setTimeout(async()=>{await this.windowsMainService?.open({context:1,cli:this.environmentMainService.args,urisToOpen:e,gotoLineMode:!1,preferNewWindow:!0}),e=[],r=void 0},100)}),io.on("new-window-for-tab",async()=>{await this.windowsMainService?.openEmptyWindow({context:4})}),ke.handle("vscode:fetchShellEnv",i=>{let o=this.windowsMainService?.getWindowByWebContents(i.sender),s,a;return o?.config?(s=o.config,a={...process.env,...o.config.userEnv}):(s=this.environmentMainService.args,a=process.env),this.resolveShellEnvironment(s,a,!1)}),ke.on("vscode:toggleDevTools",i=>i.sender.toggleDevTools()),ke.on("vscode:openDevTools",i=>i.sender.openDevTools()),ke.on("vscode:reloadWindow",i=>i.sender.reload()),ke.handle("vscode:notifyZoomLevel",async(i,o)=>{let s=this.windowsMainService?.getWindowByWebContents(i.sender);s&&s.notifyZoomLevel(o)})}onUnexpectedError(e){if(e){let r={message:`[uncaught exception in main]: ${e.message}`,stack:e.stack};this.windowsMainService?.sendToFocused("vscode:reportError",JSON.stringify(r))}this.logService.error(`[uncaught exception in main]: ${e}`),e.stack&&this.logService.error(e.stack)}async startup(){this.logService.debug("Starting VS Code"),this.logService.debug(`from: ${this.environmentMainService.appRoot}`),this.logService.debug("args:",this.environmentMainService.args);let e=this.productService.win32AppUserModelId;N&&e&&io.setAppUserModelId(e);try{A&&this.configurationService.getValue("window.nativeTabs")===!0&&!UI.getUserDefault("NSUseImprovedLayoutPass","boolean")&&UI.setUserDefault("NSUseImprovedLayoutPass","boolean",!0)}catch(m){this.logService.error(m)}let r=new vc;E.once(this.lifecycleMainService.onWillShutdown)(m=>{m.reason===2&&r.dispose()}),this.logService.trace("Resolving machine identifier...");let[i,o,s]=await Promise.all([xI(this.stateService,this.logService),SI(this.stateService,this.logService),EI(this.stateService,this.logService)]);this.logService.trace(`Resolved machine identifier: ${i}`);let{sharedProcessReady:a,sharedProcessClient:l}=this.setupSharedProcess(i,o,s),c=await this.initServices(i,o,s,a);c.invokeFunction(m=>m.get(tl)),this._register(c.createInstance(Ms)),c.invokeFunction(m=>this.initChannels(m,r,l));let d=await c.invokeFunction(m=>this.setupProtocolUrlHandlers(m,r));this.setupManagedRemoteResourceUrlHandler(r),this.lifecycleMainService.phase=2,await c.invokeFunction(m=>this.openFirstWindow(m,d)),this.lifecycleMainService.phase=3,this.afterWindowOpen(),this._register(new bt(()=>{this._register(ha(()=>this.lifecycleMainService.phase=4,2500))},2500)).schedule()}async setupProtocolUrlHandlers(e,r){let i=this.windowsMainService=e.get(Te),o=e.get(gs),s=this.nativeHostMainService=e.get(sr),a=e.get(Mt),l=this;o.registerHandler({async handleURL(b,v){return l.handleProtocolUrl(i,a,o,b,v)}});let c=this._register(new gu({onDidOpenMainWindow:s.onDidOpenMainWindow,onDidFocusMainWindow:s.onDidFocusMainWindow,getActiveWindowId:()=>s.getActiveWindowId(-1)})),d=new hc(b=>c.getActiveClientId().then(v=>b===v)),f=new uu(d,this.logService),m=r.getChannel("urlHandler",f);o.registerHandler(new du(m));let g=await this.resolveInitialProtocolUrls(i,a);return this._register(new pu(g?.urls,o,i,this.environmentMainService,this.productService,this.logService)),g}setupManagedRemoteResourceUrlHandler(e){let r=()=>({statusCode:404,data:"Not found"}),i=new Or(()=>e.getChannel(WI,new Ru));FI.registerBufferProtocol(U.vscodeManagedRemoteResource,(o,s)=>{let a=x.parse(o.url);if(!a.authority.startsWith("window:"))return s(r());i.value.call(Um,[a]).then(l=>s({...l,data:Buffer.from(l.body,"base64")}),l=>{this.logService.warn("error dispatching remote resource call",l),s({statusCode:500,data:String(l)})})})}async resolveInitialProtocolUrls(e,r){let i=this.environmentMainService.args["open-url"]?this.environmentMainService.args._urls||[]:[];i.length>0&&this.logService.trace("app#resolveInitialProtocolUrls() protocol urls from command line:",i);let o=global.getOpenUrls()||[];if(o.length>0&&this.logService.trace("app#resolveInitialProtocolUrls() protocol urls from macOS 'open-url' event:",o),i.length+o.length===0)return;let s=[...i,...o].map(c=>{try{return{uri:x.parse(c),originalUrl:c}}catch{this.logService.trace("app#resolveInitialProtocolUrls() protocol url failed to parse:",c);return}}),a=[],l=[];for(let c of s){if(!c)continue;let d=this.getWindowOpenableFromProtocolUrl(c.uri);if(d)if(await this.shouldBlockOpenable(d,e,r)){this.logService.trace("app#resolveInitialProtocolUrls() protocol url was blocked:",c.uri.toString(!0));continue}else this.logService.trace("app#resolveInitialProtocolUrls() protocol url will be handled as window to open:",c.uri.toString(!0),d),a.push(d);else this.logService.trace("app#resolveInitialProtocolUrls() protocol url will be passed to active window for handling:",c.uri.toString(!0)),l.push(c)}return{urls:l,openables:a}}async shouldBlockOpenable(e,r,i){let o,s;if(Ka(e)?(o=e.workspaceUri,s=p("confirmOpenMessageWorkspace","An external application wants to open '{0}' in {1}. Do you want to open this workspace file?",o.scheme===U.file?Oi(o,{os:ur,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)):ed(e)?(o=e.folderUri,s=p("confirmOpenMessageFolder","An external application wants to open '{0}' in {1}. Do you want to open this folder?",o.scheme===U.file?Oi(o,{os:ur,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)):(o=e.fileUri,s=p("confirmOpenMessageFileOrFolder","An external application wants to open '{0}' in {1}. Do you want to open this file or folder?",o.scheme===U.file?Oi(o,{os:ur,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)),o.scheme!==U.file&&o.scheme!==U.vscodeRemote||this.configurationService.getValue(zs.SECURITY_PROTOCOL_HANDLING_CONFIRMATION_SETTING_KEY[o.scheme])===!1)return!1;let{response:l,checkboxChecked:c}=await i.showMessageBox({type:"warning",buttons:[p({key:"open",comment:["&& denotes a mnemonic"]},"&&Yes"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&No")],message:s,detail:p("confirmOpenDetail","If you did not initiate this request, it may represent an attempted attack on your system. Unless you took an explicit action to initiate this request, you should press 'No'"),checkboxLabel:o.scheme===U.file?p("doNotAskAgainLocal","Allow opening local paths without asking"):p("doNotAskAgainRemote","Allow opening remote paths without asking"),cancelId:1});if(l!==0)return!0;if(c){let d={channel:"vscode:disablePromptForProtocolHandling",args:o.scheme===U.file?"local":"remote"};r.sendToFocused(d.channel,d.args),r.sendToOpeningWindow(d.channel,d.args)}return!1}getWindowOpenableFromProtocolUrl(e){if(e.path){if(e.authority===U.file){let r=x.file(e.fsPath);return Qr(r)?{workspaceUri:r}:{fileUri:r}}else if(e.authority===U.vscodeRemote){let r=e.path.indexOf(Q.sep,1),i,o;r!==-1?(i=e.path.substring(1,r),o=e.path.substring(r)):(i=e.path.substring(1),o="/");let s=e.query,a=new URLSearchParams(e.query);a.get("windowId")==="_blank"&&(a.delete("windowId"),s=a.toString());let l=x.from({scheme:U.vscodeRemote,authority:i,path:o,query:s,fragment:e.fragment});return Qr(o)?{workspaceUri:l}:/:[\d]+$/.test(o)?{fileUri:l}:{folderUri:l}}}}async handleProtocolUrl(e,r,i,o,s){this.logService.trace("app#handleProtocolUrl():",o.toString(!0),s),o.scheme===this.productService.urlProtocol&&o.path==="workspace"&&(o=o.with({authority:"file",path:x.parse(o.query).path,query:""}));let a=!1,l=new URLSearchParams(o.query);l.get("windowId")==="_blank"?(this.logService.trace("app#handleProtocolUrl() found 'windowId=_blank' as parameter, setting shouldOpenInNewWindow=true:",o.toString(!0)),l.delete("windowId"),o=o.with({query:l.toString()}),a=!0):A&&e.getWindowCount()===0&&(this.logService.trace("app#handleProtocolUrl() running on macOS with no window open, setting shouldOpenInNewWindow=true:",o.toString(!0)),a=!0);let c=l.get("continueOn");c!==null&&(this.logService.trace("app#handleProtocolUrl() found 'continueOn' as parameter:",o.toString(!0)),l.delete("continueOn"),o=o.with({query:l.toString()}),this.environmentMainService.continueOn=c??void 0);let d=this.getWindowOpenableFromProtocolUrl(o);return d?await this.shouldBlockOpenable(d,e,r)?(this.logService.trace("app#handleProtocolUrl() protocol url was blocked:",o.toString(!0)),!0):(this.logService.trace("app#handleProtocolUrl() opening protocol url as window:",d,o.toString(!0)),(await e.open({context:6,cli:{...this.environmentMainService.args},urisToOpen:[d],forceNewWindow:a,gotoLineMode:!0})).at(0)?.focus(),!0):a?(this.logService.trace("app#handleProtocolUrl() opening empty window and passing in protocol url:",o.toString(!0)),await(await e.open({context:6,cli:{...this.environmentMainService.args},forceNewWindow:!0,forceEmpty:!0,gotoLineMode:!0,remoteAuthority:wn(o)})).at(0)?.ready(),i.open(o,s)):(this.logService.trace("app#handleProtocolUrl(): not handled",o.toString(!0),s),!1)}setupSharedProcess(e,r,i){let o=this._register(this.mainInstantiationService.createInstance(bs,e,r,i));this._register(o.onDidCrash(()=>this.windowsMainService?.sendToFocused("vscode:reportSharedProcessCrash")));let s=(async()=>{this.logService.trace("Main->SharedProcess#connect");let l=await o.connect();return this.logService.trace("Main->SharedProcess#connect: connection established"),new To(l,"main")})();return{sharedProcessReady:(async()=>(await o.whenReady(),s))(),sharedProcessClient:s}}async initServices(e,r,i,o){let s=new bc;switch(process.platform){case"win32":s.set(hi,new _e(Zi));break;case"linux":Ol?s.set(hi,new _e(Ss,[process.env.SNAP,process.env.SNAP_REVISION])):s.set(hi,new _e(xs));break;case"darwin":s.set(hi,new _e(on));break}s.set(Te,new _e(_s,[e,r,i,this.userEnv],!1)),s.set(Pn,new _e(Ks,void 0,!1));let a=new Jo(this.logService,this.productService);s.set(Mt,a),s.set(vm,new _e(vs,void 0,!1)),s.set(rl,new _e(os,void 0,!1)),s.set(Rd,je.toService(wa(o.then(m=>m.getChannel("diagnostics"))))),s.set(om,new _e(fi,[this.userEnv])),s.set(sm,new _e(mi,[this.userEnv])),s.set(Ea,new _e(ss)),s.set(gm,new _e(hs)),s.set(sr,new _e(Yi,void 0,!1)),s.set(Tm,new _e(Ts)),s.set(wm,new _e(ys)),s.set(Gf,new _e(di)),s.set($i,new _e(rs)),s.set(si,new _e(ns));let l=new Us({graceTime:6e4,shortGraceTime:6e3,scrollback:this.configurationService.getValue("terminal.integrated.persistentSessionScrollback")??100},this.configurationService,this.environmentMainService,this.lifecycleMainService,this.logService),c=new Vs(l,this.configurationService,this.logService,this.loggerService);s.set(Qf,c),N?s.set(ol,new _e(al)):A?s.set(ol,new _e(Wd)):j&&s.set(ol,new _e(ll));let d=new En(this.environmentMainService,this.configurationService,this.logService,this.stateService);s.set(en,d);let f=new Zo(this.environmentMainService,this.logService,this.userDataProfilesMainService,d,a);if(s.set(or,f),s.set(Uf,new _e(Ds,void 0,!1)),s.set(gi,new _e(_t,void 0,!1)),s.set(gs,new _e(Ps,void 0,!1)),pd(this.productService,this.environmentMainService)){let m=_y(this.productService,this.configurationService),g=wa(o.then(C=>C.getChannel("telemetryAppender"))),b=new au(g),v=ky(dP(),cP(),process.arch,this.productService.commit,this.productService.version,e,r,i,m),w=Dy(this.environmentMainService),k={appenders:[b],commonProperties:v,piiPaths:w,sendErrorTelemetry:!0};s.set(He,new _e(Is,[k],!1))}else s.set(He,Qo);return s.set(bi,new _e(Ws,void 0,!0)),s.set(yI,new _e(As,void 0,!0)),s.set(Lm,new _e(Fs,void 0,!0)),s.set(tl,new _e(is)),s.set(pi,new _e(ms,void 0,!0)),await Zt.settled([d.initialize(),f.initialize()]),this.mainInstantiationService.createChild(s)}initChannels(e,r,i){let o=this._register(new re),s=je.fromService(e.get(vm),o,{disableMarshalling:!0});this.mainProcessNodeIpcServer.registerChannel("launch",s);let a=je.fromService(e.get(rl),o,{disableMarshalling:!0});this.mainProcessNodeIpcServer.registerChannel("diagnostics",a);let l=o.add(new vu(e.get(Gn)));r.registerChannel("policy",l),i.then(W=>W.registerChannel("policy",l));let c=this.fileService.getProvider(U.file);rg(c instanceof ps);let d=o.add(new Xd(c,this.logService,this.environmentMainService));r.registerChannel(rm,d),i.then(W=>W.registerChannel(rm,d));let f=je.fromService(e.get(ir),o);r.registerChannel("userDataProfiles",f),i.then(W=>W.registerChannel("userDataProfiles",f));let m=new yu(e.get(xr));i.then(W=>W.registerChannel("request",m));let g=new lu(e.get(hi));r.registerChannel("update",g);let b=je.fromService(e.get(om),o);r.registerChannel("issue",b);let v=je.fromService(e.get(sm),o);r.registerChannel("process",v);let w=je.fromService(e.get(Ea),o);r.registerChannel("encryption",w);let k=je.fromService(e.get(zb),o);r.registerChannel("sign",k);let C=je.fromService(e.get(gm),o);r.registerChannel("keyboardLayout",C),this.nativeHostMainService=e.get(sr);let M=je.fromService(this.nativeHostMainService,o);r.registerChannel("nativeHost",M),i.then(W=>W.registerChannel("nativeHost",M));let _=je.fromService(e.get(Uf),o);r.registerChannel("workspaces",_);let V=je.fromService(e.get(wm),o);r.registerChannel("menubar",V);let Y=je.fromService(e.get(gs),o);r.registerChannel("url",Y);let q=je.fromService(e.get(Tm),o);r.registerChannel("webview",q);let ze=o.add(new su(this.logService,e.get($i)));r.registerChannel("storage",ze),i.then(W=>W.registerChannel("storage",ze));let ee=o.add(new Tu(e.get($i),e.get(ir),this.logService));i.then(W=>W.registerChannel("profileStorageListener",ee));let Be=je.fromService(e.get(Qf),o);r.registerChannel("localPty",Be);let yr=je.fromService(e.get(ol),o);r.registerChannel("externalTerminal",yr);let Dt=new ku(e.get(oi));r.registerChannel("logger",Dt),i.then(W=>W.registerChannel("logger",Dt));let Nr=new _d(e.get(Te));r.registerChannel("extensionhostdebugservice",Nr);let br=je.fromService(e.get(Gf),o);r.registerChannel(ub,br);let H=je.fromService(e.get(Lm),o);r.registerChannel(PI,H)}async openFirstWindow(e,r){let i=this.windowsMainService=e.get(Te);this.auxiliaryWindowsMainService=e.get(Pn);let o=rn(process.env)?0:4,s=this.environmentMainService.args;if(r){if(r.openables.length>0)return i.open({context:o,cli:s,urisToOpen:r.openables,gotoLineMode:!0,initialStartup:!0});if(r.urls.length>0)for(let w of r.urls){let k=new URLSearchParams(w.uri.query);if(k.get("windowId")==="_blank")return k.delete("windowId"),w.originalUrl=w.uri.toString(!0),w.uri=w.uri.with({query:k.toString()}),i.open({context:o,cli:s,forceNewWindow:!0,forceEmpty:!0,gotoLineMode:!0,initialStartup:!0})}}let a=global.macOpenFiles,l=s._.length,c=!!s["folder-uri"],d=!!s["file-uri"],f=s["skip-add-to-recently-opened"]===!0,m=s.wait&&s.waitMarkerFilePath?x.file(s.waitMarkerFilePath):void 0,g=s.remote||void 0,b=s.profile,v=s["profile-temp"];if(!l&&!c&&!d){if(s["new-window"]||b||v)return i.open({context:o,cli:s,forceNewWindow:!0,forceEmpty:!0,noRecentEntry:f,waitMarkerFileURI:m,initialStartup:!0,remoteAuthority:g,forceProfile:b,forceTempProfile:v});if(a.length)return i.open({context:1,cli:s,urisToOpen:a.map(w=>(w=tn(w),Qr(w)?{workspaceUri:x.file(w)}:{fileUri:x.file(w)})),noRecentEntry:f,waitMarkerFileURI:m,initialStartup:!0})}return i.open({context:o,cli:s,forceNewWindow:s["new-window"],diffMode:s.diff,mergeMode:s.merge,noRecentEntry:f,waitMarkerFileURI:m,gotoLineMode:s.goto,initialStartup:!0,remoteAuthority:g,forceProfile:b,forceTempProfile:v})}afterWindowOpen(){this.installMutex(),FI.registerHttpProtocol(U.vscodeRemoteResource,(e,r)=>{r({url:e.url.replace(/^vscode-remote-resource:/,"http:"),method:e.method})}),this.resolveShellEnvironment(this.environmentMainService.args,process.env,!0),this.updateCrashReporterEnablement(),A&&io.runningUnderARM64Translation&&this.windowsMainService?.sendToFocused("vscode:showTranslatedBuildWarning")}async installMutex(){let e=this.productService.win32MutexName;if(N&&e)try{let r=await import("@vscode/windows-mutex"),i=new r.Mutex(e);E.once(this.lifecycleMainService.onWillShutdown)(()=>i.release())}catch(r){this.logService.error(r)}}async resolveShellEnvironment(e,r,i){try{return await Md(this.configurationService,this.logService,e,r)}catch(o){let s=Xt(o);i?this.windowsMainService?.sendToFocused("vscode:showResolveShellEnvError",s):this.logService.error(s)}return{}}async updateCrashReporterEnablement(){try{let r=(await this.fileService.readFile(this.environmentMainService.argvResource)).value.toString(),i=sg(r),s=Yo(this.configurationService)>=1;if(i["enable-crash-reporter"]===void 0){let a=["","	// Allows to disable crash reporting.","	// Should restart the app if the value is changed.",`	"enable-crash-reporter": ${s},`,"","	// Unique id used for correlating crash reports sent from this instance.","	// Do not edit this value.",`	"crash-reporter-id": "${yt()}"`,"}"],l=r.substring(0,r.length-2).concat(`,
`,a.join(`
`));await this.fileService.writeFile(this.environmentMainService.argvResource,te.fromString(l))}else{let a=r.replace(/"enable-crash-reporter": .*,/,`"enable-crash-reporter": ${s},`);a!==r&&await this.fileService.writeFile(this.environmentMainService.argvResource,te.fromString(a))}}catch(e){this.logService.error(e),this.windowsMainService?.sendToFocused("vscode:showArgvParseWarning")}}};zs=P([h(2,tr),h(3,B),h(4,Ro),h(5,ge),h(6,le),h(7,Ie),h(8,Ye),h(9,We),h(10,Oe),h(11,ir)],zs);export{zs as CodeApplication};
