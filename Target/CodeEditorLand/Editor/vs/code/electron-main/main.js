var p0=Object.create;var km=Object.defineProperty;var cy=Object.getOwnPropertyDescriptor;var f0=Object.getOwnPropertyNames;var m0=Object.getPrototypeOf,h0=Object.prototype.hasOwnProperty;var Kt=(n=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(n,{get:(t,e)=>(typeof require<"u"?require:t)[e]}):n)(function(n){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+n+'" is not supported')});var Rr=(n,t)=>()=>(t||n((t={exports:{}}).exports,t),t.exports);var g0=(n,t,e,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let i of f0(t))!h0.call(n,i)&&i!==e&&km(n,i,{get:()=>t[i],enumerable:!(r=cy(t,i))||r.enumerable});return n};var _m=(n,t,e)=>(e=n!=null?p0(m0(n)):{},g0(t||!n||!n.__esModule?km(e,"default",{value:n,enumerable:!0}):e,n));var P=(n,t,e,r)=>{for(var i=r>1?void 0:r?cy(t,e):t,o=n.length-1,s;o>=0;o--)(s=n[o])&&(i=(r?s(t,e,i):s(i))||i);return r&&i&&km(t,e,i),i},g=(n,t)=>(e,r)=>t(e,r,n);var nS=Rr((pq,rS)=>{"use strict";function jT(n,t){var e=n;t.slice(0,-1).forEach(function(i){e=e[i]||{}});var r=t[t.length-1];return r in e}function eS(n){return typeof n=="number"||/^0x[0-9a-f]+$/i.test(n)?!0:/^[-+]?(?:\d+(?:\.\d*)?|\.\d+)(e[-+]?\d+)?$/.test(n)}function tS(n,t){return t==="constructor"&&typeof n[t]=="function"||t==="__proto__"}rS.exports=function(n,t){t||(t={});var e={bools:{},strings:{},unknownFn:null};typeof t.unknown=="function"&&(e.unknownFn=t.unknown),typeof t.boolean=="boolean"&&t.boolean?e.allBools=!0:[].concat(t.boolean).filter(Boolean).forEach(function(T){e.bools[T]=!0});var r={};function i(T){return r[T].some(function(N){return e.bools[N]})}Object.keys(t.alias||{}).forEach(function(T){r[T]=[].concat(t.alias[T]),r[T].forEach(function(N){r[N]=[T].concat(r[T].filter(function(J){return N!==J}))})}),[].concat(t.string).filter(Boolean).forEach(function(T){e.strings[T]=!0,r[T]&&[].concat(r[T]).forEach(function(N){e.strings[N]=!0})});var o=t.default||{},s={_:[]};function a(T,N){return e.allBools&&/^--[^=]+$/.test(N)||e.strings[T]||e.bools[T]||r[T]}function l(T,N,J){for(var H=T,Ke=0;Ke<N.length-1;Ke++){var re=N[Ke];if(tS(H,re))return;H[re]===void 0&&(H[re]={}),(H[re]===Object.prototype||H[re]===Number.prototype||H[re]===String.prototype)&&(H[re]={}),H[re]===Array.prototype&&(H[re]=[]),H=H[re]}var je=N[N.length-1];tS(H,je)||((H===Object.prototype||H===Number.prototype||H===String.prototype)&&(H={}),H===Array.prototype&&(H=[]),H[je]===void 0||e.bools[je]||typeof H[je]=="boolean"?H[je]=J:Array.isArray(H[je])?H[je].push(J):H[je]=[H[je],J])}function c(T,N,J){if(!(J&&e.unknownFn&&!a(T,J)&&e.unknownFn(J)===!1)){var H=!e.strings[T]&&eS(N)?Number(N):N;l(s,T.split("."),H),(r[T]||[]).forEach(function(Ke){l(s,Ke.split("."),H)})}}Object.keys(e.bools).forEach(function(T){c(T,o[T]===void 0?!1:o[T])});var d=[];n.indexOf("--")!==-1&&(d=n.slice(n.indexOf("--")+1),n=n.slice(0,n.indexOf("--")));for(var u=0;u<n.length;u++){var m=n[u],h,y;if(/^--.+=/.test(m)){var v=m.match(/^--([^=]+)=([\s\S]*)$/);h=v[1];var b=v[2];e.bools[h]&&(b=b!=="false"),c(h,b,m)}else if(/^--no-.+/.test(m))h=m.match(/^--no-(.+)/)[1],c(h,!1,m);else if(/^--.+/.test(m))h=m.match(/^--(.+)/)[1],y=n[u+1],y!==void 0&&!/^(-|--)[^-]/.test(y)&&!e.bools[h]&&!e.allBools&&(!r[h]||!i(h))?(c(h,y,m),u+=1):/^(true|false)$/.test(y)?(c(h,y==="true",m),u+=1):c(h,e.strings[h]?"":!0,m);else if(/^-[^-]+/.test(m)){for(var C=m.slice(1,-1).split(""),k=!1,_=0;_<C.length;_++){if(y=m.slice(_+2),y==="-"){c(C[_],y,m);continue}if(/[A-Za-z]/.test(C[_])&&y[0]==="="){c(C[_],y.slice(1),m),k=!0;break}if(/[A-Za-z]/.test(C[_])&&/-?\d+(\.\d*)?(e-?\d+)?$/.test(y)){c(C[_],y,m),k=!0;break}if(C[_+1]&&C[_+1].match(/\W/)){c(C[_],m.slice(_+2),m),k=!0;break}else c(C[_],e.strings[C[_]]?"":!0,m)}h=m.slice(-1)[0],!k&&h!=="-"&&(n[u+1]&&!/^(-|--)[^-]/.test(n[u+1])&&!e.bools[h]&&(!r[h]||!i(h))?(c(h,n[u+1],m),u+=1):n[u+1]&&/^(true|false)$/.test(n[u+1])?(c(h,n[u+1]==="true",m),u+=1):c(h,e.strings[h]?"":!0,m))}else if((!e.unknownFn||e.unknownFn(m)!==!1)&&s._.push(e.strings._||!eS(m)?m:Number(m)),t.stopEarly){s._.push.apply(s._,n.slice(u+1));break}}return Object.keys(o).forEach(function(T){jT(s,T.split("."))||(l(s,T.split("."),o[T]),(r[T]||[]).forEach(function(N){l(s,N.split("."),o[T])}))}),t["--"]?s["--"]=d.slice():d.forEach(function(T){s._.push(T)}),s}});var Fx=Rr((G7e,Ox)=>{"use strict";var sl=1e3,al=sl*60,ll=al*60,es=ll*24,cR=es*7,dR=es*365.25;Ox.exports=function(n,t){t=t||{};var e=typeof n;if(e==="string"&&n.length>0)return uR(n);if(e==="number"&&isFinite(n))return t.long?fR(n):pR(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function uR(n){if(n=String(n),!(n.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(t){var e=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return e*dR;case"weeks":case"week":case"w":return e*cR;case"days":case"day":case"d":return e*es;case"hours":case"hour":case"hrs":case"hr":case"h":return e*ll;case"minutes":case"minute":case"mins":case"min":case"m":return e*al;case"seconds":case"second":case"secs":case"sec":case"s":return e*sl;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return e;default:return}}}}function pR(n){var t=Math.abs(n);return t>=es?Math.round(n/es)+"d":t>=ll?Math.round(n/ll)+"h":t>=al?Math.round(n/al)+"m":t>=sl?Math.round(n/sl)+"s":n+"ms"}function fR(n){var t=Math.abs(n);return t>=es?cm(n,t,es,"day"):t>=ll?cm(n,t,ll,"hour"):t>=al?cm(n,t,al,"minute"):t>=sl?cm(n,t,sl,"second"):n+" ms"}function cm(n,t,e,r){var i=t>=e*1.5;return Math.round(n/e)+" "+r+(i?"s":"")}});var Qv=Rr((J7e,Lx)=>{"use strict";function mR(n){e.debug=e,e.default=e,e.coerce=l,e.disable=o,e.enable=i,e.enabled=s,e.humanize=Fx(),e.destroy=c,Object.keys(n).forEach(d=>{e[d]=n[d]}),e.names=[],e.skips=[],e.formatters={};function t(d){let u=0;for(let m=0;m<d.length;m++)u=(u<<5)-u+d.charCodeAt(m),u|=0;return e.colors[Math.abs(u)%e.colors.length]}e.selectColor=t;function e(d){let u,m=null,h,y;function v(...b){if(!v.enabled)return;let C=v,k=Number(new Date),_=k-(u||k);C.diff=_,C.prev=u,C.curr=k,u=k,b[0]=e.coerce(b[0]),typeof b[0]!="string"&&b.unshift("%O");let T=0;b[0]=b[0].replace(/%([a-zA-Z%])/g,(J,H)=>{if(J==="%%")return"%";T++;let Ke=e.formatters[H];if(typeof Ke=="function"){let re=b[T];J=Ke.call(C,re),b.splice(T,1),T--}return J}),e.formatArgs.call(C,b),(C.log||e.log).apply(C,b)}return v.namespace=d,v.useColors=e.useColors(),v.color=e.selectColor(d),v.extend=r,v.destroy=e.destroy,Object.defineProperty(v,"enabled",{enumerable:!0,configurable:!1,get:()=>m!==null?m:(h!==e.namespaces&&(h=e.namespaces,y=e.enabled(d)),y),set:b=>{m=b}}),typeof e.init=="function"&&e.init(v),v}function r(d,u){let m=e(this.namespace+(typeof u>"u"?":":u)+d);return m.log=this.log,m}function i(d){e.save(d),e.namespaces=d,e.names=[],e.skips=[];let u,m=(typeof d=="string"?d:"").split(/[\s,]+/),h=m.length;for(u=0;u<h;u++)m[u]&&(d=m[u].replace(/\*/g,".*?"),d[0]==="-"?e.skips.push(new RegExp("^"+d.slice(1)+"$")):e.names.push(new RegExp("^"+d+"$")))}function o(){let d=[...e.names.map(a),...e.skips.map(a).map(u=>"-"+u)].join(",");return e.enable(""),d}function s(d){if(d[d.length-1]==="*")return!0;let u,m;for(u=0,m=e.skips.length;u<m;u++)if(e.skips[u].test(d))return!1;for(u=0,m=e.names.length;u<m;u++)if(e.names[u].test(d))return!0;return!1}function a(d){return d.toString().substring(2,d.toString().length-2).replace(/\.\*\?$/,"*")}function l(d){return d instanceof Error?d.stack||d.message:d}function c(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}Lx.exports=mR});var Mx=Rr((Kr,dm)=>{"use strict";Kr.formatArgs=gR;Kr.save=vR;Kr.load=yR;Kr.useColors=hR;Kr.storage=IR();Kr.destroy=(()=>{let n=!1;return()=>{n||(n=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();Kr.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function hR(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let n;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(n=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(n[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function gR(n){if(n[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+n[0]+(this.useColors?"%c ":" ")+"+"+dm.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;n.splice(1,0,t,"color: inherit");let e=0,r=0;n[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(e++,i==="%c"&&(r=e))}),n.splice(r,0,t)}Kr.log=console.debug||console.log||(()=>{});function vR(n){try{n?Kr.storage.setItem("debug",n):Kr.storage.removeItem("debug")}catch{}}function yR(){let n;try{n=Kr.storage.getItem("debug")}catch{}return!n&&typeof process<"u"&&"env"in process&&(n=process.env.DEBUG),n}function IR(){try{return localStorage}catch{}}dm.exports=Qv()(Kr);var{formatters:bR}=dm.exports;bR.j=function(n){try{return JSON.stringify(n)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var Wx=Rr((Q7e,Ax)=>{"use strict";Ax.exports=(n,t)=>{t=t||process.argv;let e=n.startsWith("-")?"":n.length===1?"-":"--",r=t.indexOf(e+n),i=t.indexOf("--");return r!==-1&&(i===-1?!0:r<i)}});var Nx=Rr((Y7e,Ux)=>{"use strict";var wR=Kt("os"),gn=Wx(),ir=process.env,cl;gn("no-color")||gn("no-colors")||gn("color=false")?cl=!1:(gn("color")||gn("colors")||gn("color=true")||gn("color=always"))&&(cl=!0);"FORCE_COLOR"in ir&&(cl=ir.FORCE_COLOR.length===0||parseInt(ir.FORCE_COLOR,10)!==0);function SR(n){return n===0?!1:{level:n,hasBasic:!0,has256:n>=2,has16m:n>=3}}function xR(n){if(cl===!1)return 0;if(gn("color=16m")||gn("color=full")||gn("color=truecolor"))return 3;if(gn("color=256"))return 2;if(n&&!n.isTTY&&cl!==!0)return 0;let t=cl?1:0;if(process.platform==="win32"){let e=wR.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(e[0])>=10&&Number(e[2])>=10586?Number(e[2])>=14931?3:2:1}if("CI"in ir)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(e=>e in ir)||ir.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in ir)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(ir.TEAMCITY_VERSION)?1:0;if(ir.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in ir){let e=parseInt((ir.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(ir.TERM_PROGRAM){case"iTerm.app":return e>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(ir.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(ir.TERM)||"COLORTERM"in ir?1:(ir.TERM==="dumb",t)}function Yv(n){let t=xR(n);return SR(t)}Ux.exports={supportsColor:Yv,stdout:Yv(process.stdout),stderr:Yv(process.stderr)}});var Vx=Rr((Ut,pm)=>{"use strict";var ER=Kt("tty"),um=Kt("util");Ut.init=DR;Ut.log=kR;Ut.formatArgs=TR;Ut.save=_R;Ut.load=RR;Ut.useColors=PR;Ut.destroy=um.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");Ut.colors=[6,2,3,4,5,1];try{let n=Nx();n&&(n.stderr||n).level>=2&&(Ut.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}Ut.inspectOpts=Object.keys(process.env).filter(n=>/^debug_/i.test(n)).reduce((n,t)=>{let e=t.substring(6).toLowerCase().replace(/_([a-z])/g,(i,o)=>o.toUpperCase()),r=process.env[t];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),n[e]=r,n},{});function PR(){return"colors"in Ut.inspectOpts?!!Ut.inspectOpts.colors:ER.isatty(process.stderr.fd)}function TR(n){let{namespace:t,useColors:e}=this;if(e){let r=this.color,i="\x1B[3"+(r<8?r:"8;5;"+r),o=`  ${i};1m${t} \x1B[0m`;n[0]=o+n[0].split(`
`).join(`
`+o),n.push(i+"m+"+pm.exports.humanize(this.diff)+"\x1B[0m")}else n[0]=CR()+t+" "+n[0]}function CR(){return Ut.inspectOpts.hideDate?"":new Date().toISOString()+" "}function kR(...n){return process.stderr.write(um.formatWithOptions(Ut.inspectOpts,...n)+`
`)}function _R(n){n?process.env.DEBUG=n:delete process.env.DEBUG}function RR(){return process.env.DEBUG}function DR(n){n.inspectOpts={};let t=Object.keys(Ut.inspectOpts);for(let e=0;e<t.length;e++)n.inspectOpts[t[e]]=Ut.inspectOpts[t[e]]}pm.exports=Qv()(Ut);var{formatters:Bx}=pm.exports;Bx.o=function(n){return this.inspectOpts.colors=this.useColors,um.inspect(n,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};Bx.O=function(n){return this.inspectOpts.colors=this.useColors,um.inspect(n,this.inspectOpts)}});var fm=Rr((X7e,Xv)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Xv.exports=Mx():Xv.exports=Vx()});var zx=Rr(_r=>{"use strict";var OR=_r&&_r.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),FR=_r&&_r.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Kx=_r&&_r.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&OR(t,n,e);return FR(t,n),t};Object.defineProperty(_r,"__esModule",{value:!0});_r.req=_r.json=_r.toBuffer=void 0;var LR=Kx(Kt("http")),MR=Kx(Kt("https"));async function Hx(n){let t=0,e=[];for await(let r of n)t+=r.length,e.push(r);return Buffer.concat(e,t)}_r.toBuffer=Hx;async function AR(n){let e=(await Hx(n)).toString("utf8");try{return JSON.parse(e)}catch(r){let i=r;throw i.message+=` (input: ${e})`,i}}_r.json=AR;function WR(n,t={}){let r=((typeof n=="string"?n:n.href).startsWith("https:")?MR:LR).request(n,t),i=new Promise((o,s)=>{r.once("response",o).once("error",s).end()});return r.then=i.then.bind(i),r}_r.req=WR});var ey=Rr(Hr=>{"use strict";var $x=Hr&&Hr.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),UR=Hr&&Hr.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),jx=Hr&&Hr.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&$x(t,n,e);return UR(t,n),t},NR=Hr&&Hr.__exportStar||function(n,t){for(var e in n)e!=="default"&&!Object.prototype.hasOwnProperty.call(t,e)&&$x(t,n,e)};Object.defineProperty(Hr,"__esModule",{value:!0});Hr.Agent=void 0;var BR=jx(Kt("net")),qx=jx(Kt("http")),VR=Kt("https");NR(zx(),Hr);var zn=Symbol("AgentBaseInternalState"),Zv=class extends qx.Agent{constructor(t){super(t),this[zn]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}let{stack:e}=new Error;return typeof e!="string"?!1:e.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(t){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[t]||(this.sockets[t]=[]);let e=new BR.Socket({writable:!1});return this.sockets[t].push(e),this.totalSocketCount++,e}decrementSockets(t,e){if(!this.sockets[t]||e===null)return;let r=this.sockets[t],i=r.indexOf(e);i!==-1&&(r.splice(i,1),this.totalSocketCount--,r.length===0&&delete this.sockets[t])}getName(t){return(typeof t.secureEndpoint=="boolean"?t.secureEndpoint:this.isSecureEndpoint(t))?VR.Agent.prototype.getName.call(this,t):super.getName(t)}createSocket(t,e,r){let i={...e,secureEndpoint:this.isSecureEndpoint(e)},o=this.getName(i),s=this.incrementSockets(o);Promise.resolve().then(()=>this.connect(t,i)).then(a=>{if(this.decrementSockets(o,s),a instanceof qx.Agent)return a.addRequest(t,i);this[zn].currentSocket=a,super.createSocket(t,e,r)},a=>{this.decrementSockets(o,s),r(a)})}createConnection(){let t=this[zn].currentSocket;if(this[zn].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[zn].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[zn]&&(this[zn].defaultPort=t)}get protocol(){return this[zn].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[zn]&&(this[zn].protocol=t)}};Hr.Agent=Zv});var Qx=Rr(Xr=>{"use strict";var KR=Xr&&Xr.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),HR=Xr&&Xr.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),Jx=Xr&&Xr.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&KR(t,n,e);return HR(t,n),t},zR=Xr&&Xr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.HttpProxyAgent=void 0;var qR=Jx(Kt("net")),$R=Jx(Kt("tls")),jR=zR(fm()),GR=Kt("events"),JR=ey(),Gx=Kt("url"),dl=(0,jR.default)("http-proxy-agent"),mm=class extends JR.Agent{constructor(t,e){super(e),this.proxy=typeof t=="string"?new Gx.URL(t):t,this.proxyHeaders=e?.headers??{},dl("Creating new HttpProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...e?QR(e,"headers"):null,host:r,port:i}}addRequest(t,e){t._header=null,this.setRequestProps(t,e),super.addRequest(t,e)}setRequestProps(t,e){let{proxy:r}=this,i=e.secureEndpoint?"https:":"http:",o=t.getHeader("host")||"localhost",s=`${i}//${o}`,a=new Gx.URL(t.path,s);e.port!==80&&(a.port=String(e.port)),t.path=String(a);let l=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(r.username||r.password){let c=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;l["Proxy-Authorization"]=`Basic ${Buffer.from(c).toString("base64")}`}l["Proxy-Connection"]||(l["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let c of Object.keys(l)){let d=l[c];d&&t.setHeader(c,d)}}async connect(t,e){t._header=null,t.path.includes("://")||this.setRequestProps(t,e);let r,i;dl("Regenerating stored HTTP header string for request"),t._implicitHeader(),t.outputData&&t.outputData.length>0&&(dl("Patching connection write() output buffer with updated header"),r=t.outputData[0].data,i=r.indexOf(`\r
\r
`)+4,t.outputData[0].data=t._header+r.substring(i),dl("Output buffer: %o",t.outputData[0].data));let o;return this.proxy.protocol==="https:"?(dl("Creating `tls.Socket`: %o",this.connectOpts),o=$R.connect(this.connectOpts)):(dl("Creating `net.Socket`: %o",this.connectOpts),o=qR.connect(this.connectOpts)),await(0,GR.once)(o,"connect"),o}};mm.protocols=["http","https"];Xr.HttpProxyAgent=mm;function QR(n,...t){let e={},r;for(r in n)t.includes(r)||(e[r]=n[r]);return e}});var Yx=Rr(ul=>{"use strict";var YR=ul&&ul.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ul,"__esModule",{value:!0});ul.parseProxyResponse=void 0;var XR=YR(fm()),hm=(0,XR.default)("https-proxy-agent:parse-proxy-response");function ZR(n){return new Promise((t,e)=>{let r=0,i=[];function o(){let d=n.read();d?c(d):n.once("readable",o)}function s(){n.removeListener("end",a),n.removeListener("error",l),n.removeListener("readable",o)}function a(){s(),hm("onend"),e(new Error("Proxy connection ended before receiving CONNECT response"))}function l(d){s(),hm("onerror %o",d),e(d)}function c(d){i.push(d),r+=d.length;let u=Buffer.concat(i,r),m=u.indexOf(`\r
\r
`);if(m===-1){hm("have not received end of HTTP headers yet..."),o();return}let h=u.slice(0,m).toString("ascii").split(`\r
`),y=h.shift();if(!y)return n.destroy(),e(new Error("No header received from proxy CONNECT response"));let v=y.split(" "),b=+v[1],C=v.slice(2).join(" "),k={};for(let _ of h){if(!_)continue;let T=_.indexOf(":");if(T===-1)return n.destroy(),e(new Error(`Invalid header from proxy CONNECT response: "${_}"`));let N=_.slice(0,T).toLowerCase(),J=_.slice(T+1).trimStart(),H=k[N];typeof H=="string"?k[N]=[H,J]:Array.isArray(H)?H.push(J):k[N]=J}hm("got proxy server response: %o %o",y,k),s(),t({connect:{statusCode:b,statusText:C,headers:k},buffered:u})}n.on("error",l),n.on("end",a),o()})}ul.parseProxyResponse=ZR});var r0=Rr(Zr=>{"use strict";var eD=Zr&&Zr.__createBinding||(Object.create?function(n,t,e,r){r===void 0&&(r=e);var i=Object.getOwnPropertyDescriptor(t,e);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[e]}}),Object.defineProperty(n,r,i)}:function(n,t,e,r){r===void 0&&(r=e),n[r]=t[e]}),tD=Zr&&Zr.__setModuleDefault||(Object.create?function(n,t){Object.defineProperty(n,"default",{enumerable:!0,value:t})}:function(n,t){n.default=t}),e0=Zr&&Zr.__importStar||function(n){if(n&&n.__esModule)return n;var t={};if(n!=null)for(var e in n)e!=="default"&&Object.prototype.hasOwnProperty.call(n,e)&&eD(t,n,e);return tD(t,n),t},t0=Zr&&Zr.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(Zr,"__esModule",{value:!0});Zr.HttpsProxyAgent=void 0;var ty=e0(Kt("net")),Xx=e0(Kt("tls")),rD=t0(Kt("assert")),nD=t0(fm()),iD=ey(),oD=Kt("url"),sD=Yx(),ld=(0,nD.default)("https-proxy-agent"),gm=class extends iD.Agent{constructor(t,e){super(e),this.options={path:void 0},this.proxy=typeof t=="string"?new oD.URL(t):t,this.proxyHeaders=e?.headers??{},ld("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),i=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...e?Zx(e,"headers"):null,host:r,port:i}}async connect(t,e){let{proxy:r}=this;if(!e.host)throw new TypeError('No "host" provided');let i;if(r.protocol==="https:"){ld("Creating `tls.Socket`: %o",this.connectOpts);let m=this.connectOpts.servername||this.connectOpts.host;i=Xx.connect({...this.connectOpts,servername:m})}else ld("Creating `net.Socket`: %o",this.connectOpts),i=ty.connect(this.connectOpts);let o=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},s=ty.isIPv6(e.host)?`[${e.host}]`:e.host,a=`CONNECT ${s}:${e.port} HTTP/1.1\r
`;if(r.username||r.password){let m=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;o["Proxy-Authorization"]=`Basic ${Buffer.from(m).toString("base64")}`}o.Host=`${s}:${e.port}`,o["Proxy-Connection"]||(o["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let m of Object.keys(o))a+=`${m}: ${o[m]}\r
`;let l=(0,sD.parseProxyResponse)(i);i.write(`${a}\r
`);let{connect:c,buffered:d}=await l;if(t.emit("proxyConnect",c),this.emit("proxyConnect",c,t),c.statusCode===200){if(t.once("socket",aD),e.secureEndpoint){ld("Upgrading socket connection to TLS");let m=e.servername||e.host;return Xx.connect({...Zx(e,"host","path","port"),socket:i,servername:m})}return i}i.destroy();let u=new ty.Socket({writable:!1});return u.readable=!0,t.once("socket",m=>{ld("Replaying proxy buffer for failed request"),(0,rD.default)(m.listenerCount("data")>0),m.push(d),m.push(null)}),u}};gm.protocols=["http","https"];Zr.HttpsProxyAgent=gm;function aD(n){n.resume()}function Zx(n,...t){let e={},r;for(r in n)t.includes(r)||(e[r]=n[r]);return e}});function jn(){return globalThis._VSCODE_NLS_MESSAGES}function tn(){return globalThis._VSCODE_NLS_LANGUAGE}var v0=tn()==="pseudo"||typeof document<"u"&&document.location&&document.location.hash.indexOf("pseudo=true")>=0;function vd(n,t){let e;return t.length===0?e=n:e=n.replace(/\{(\d+)\}/g,(r,i)=>{let o=i[0],s=t[o],a=r;return typeof s=="string"?a=s:(typeof s=="number"||typeof s=="boolean"||s===void 0||s===null)&&(a=String(s)),a}),v0&&(e="\uFF3B"+e.replace(/[aouei]/g,"$&$&")+"\uFF3D"),e}function p(n,t,...e){return vd(typeof n=="number"?dy(n,t):t,e)}function dy(n,t){let e=jn()?.[n];if(typeof e!="string"){if(typeof t=="string")return t;throw new Error(`!!! NLS MISSING: ${n} !!!`)}return e}function In(n,t,...e){let r;typeof n=="number"?r=dy(n,t):r=t;let i=vd(r,e);return{value:i,original:t===r?i:vd(t,e)}}var ns="en",Il=!1,bl=!1,yl=!1,py=!1,fy=!1,Rm=!1,y0=!1,my=!1,hy=!1,I0=!1,yd,Id=ns,uy=ns,gy,Gn,Jn=globalThis,Dr;typeof Jn.vscode<"u"&&typeof Jn.vscode.process<"u"?Dr=Jn.vscode.process:typeof process<"u"&&typeof process?.versions?.node=="string"&&(Dr=process);var vy=typeof Dr?.versions?.electron=="string",b0=vy&&Dr?.type==="renderer";if(typeof Dr=="object"){Il=Dr.platform==="win32",bl=Dr.platform==="darwin",yl=Dr.platform==="linux",py=yl&&!!Dr.env.SNAP&&!!Dr.env.SNAP_REVISION,y0=vy,hy=!!Dr.env.CI||!!Dr.env.BUILD_ARTIFACTSTAGINGDIRECTORY,yd=ns,Id=ns;let n=Dr.env.VSCODE_NLS_CONFIG;if(n)try{let t=JSON.parse(n);yd=t.userLocale,uy=t.osLocale,Id=t.resolvedLanguage||ns,gy=t.languagePack?.translationsConfigFile}catch{}fy=!0}else typeof navigator=="object"&&!b0?(Gn=navigator.userAgent,Il=Gn.indexOf("Windows")>=0,bl=Gn.indexOf("Macintosh")>=0,my=(Gn.indexOf("Macintosh")>=0||Gn.indexOf("iPad")>=0||Gn.indexOf("iPhone")>=0)&&!!navigator.maxTouchPoints&&navigator.maxTouchPoints>0,yl=Gn.indexOf("Linux")>=0,I0=Gn?.indexOf("Mobi")>=0,Rm=!0,Id=tn()||ns,yd=navigator.language.toLowerCase(),uy=yd):console.error("Unable to resolve platform.");function wd(n){switch(n){case 0:return"Web";case 1:return"Mac";case 2:return"Linux";case 3:return"Windows"}}var bd=0;bl?bd=1:Il?bd=3:yl&&(bd=2);var U=Il,W=bl,Q=yl,Sd=py,xd=fy;var sr=Rm,w0=Rm&&typeof Jn.importScripts=="function",yy=w0?Jn.origin:void 0;var Iy=hy,mo=bd,bn=Gn,Or=Id,S0;(r=>{function n(){return Or}r.value=n;function t(){return Or.length===2?Or==="en":Or.length>=3?Or[0]==="e"&&Or[1]==="n"&&Or[2]==="-":!1}r.isDefaultVariant=t;function e(){return Or==="en"}r.isDefault=e})(S0||={});var Dm=gy,x0=typeof Jn.postMessage=="function"&&!Jn.importScripts,by=(()=>{if(x0){let n=[];Jn.addEventListener("message",e=>{if(e.data&&e.data.vscodeScheduleAsyncWork)for(let r=0,i=n.length;r<i;r++){let o=n[r];if(o.id===e.data.vscodeScheduleAsyncWork){n.splice(r,1),o.callback();return}}});let t=0;return e=>{let r=++t;n.push({id:r,callback:e}),Jn.postMessage({vscodeScheduleAsyncWork:r},"*")}}return n=>setTimeout(n)})();var xt=bl||my?2:Il?1:3;var Om=!!(bn&&bn.indexOf("Chrome")>=0),wy=!!(bn&&bn.indexOf("Firefox")>=0),Sy=!!(!Om&&bn&&bn.indexOf("Safari")>=0),xy=!!(bn&&bn.indexOf("Edg/")>=0),ED=!!(bn&&bn.indexOf("Android")>=0);function Ey(n){return parseFloat(n)>=20}function Py(n,t,e=0,r=n.length){let i=e,o=r;for(;i<o;){let s=Math.floor((i+o)/2);t(n[s])?o=s:i=s+1}return i}var Fm=class{unexpectedErrorHandler;listeners;constructor(){this.listeners=[],this.unexpectedErrorHandler=function(t){setTimeout(()=>{throw t.stack?rn.isErrorNoTelemetry(t)?new rn(t.message+`

`+t.stack):new Error(t.message+`

`+t.stack):t},0)}}addListener(t){return this.listeners.push(t),()=>{this._removeListener(t)}}emit(t){this.listeners.forEach(e=>{e(t)})}_removeListener(t){this.listeners.splice(this.listeners.indexOf(t),1)}setUnexpectedErrorHandler(t){this.unexpectedErrorHandler=t}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(t){this.unexpectedErrorHandler(t),this.emit(t)}onUnexpectedExternalError(t){this.unexpectedErrorHandler(t)}},Lm=new Fm;function Pd(n){Lm.setUnexpectedErrorHandler(n)}function Ty(n){if(!n||typeof n!="object")return!1;let t=n;return t.code==="EPIPE"&&t.syscall?.toUpperCase()==="WRITE"}function ss(n){Lm.onUnexpectedError(n)}function Je(n){Td(n)||Lm.onUnexpectedError(n)}var Ed="Canceled";function Td(n){return n instanceof at?!0:n instanceof Error&&n.name===Ed&&n.message===Ed}var at=class extends Error{constructor(){super(Ed),this.name=this.message}};function wn(){let n=new Error(Ed);return n.name=n.message,n}function Cd(n){return n?new Error(`Illegal state: ${n}`):new Error("Illegal state")}function Fr(n){return n?n.message?n.message:n.stack?n.stack.split(`
`)[0]:String(n):"Error"}var is=class extends Error{isExpected=!0},rn=class n extends Error{name;constructor(t){super(t),this.name="CodeExpectedError"}static fromError(t){if(t instanceof n)return t;let e=new n;return e.message=t.message,e.stack=t.stack,e}static isErrorNoTelemetry(t){return t.name==="CodeExpectedError"}},os=class n extends Error{constructor(t){super(t||"An unexpected bug occurred."),Object.setPrototypeOf(this,n.prototype)}};function as(n,t){let e=this,r=!1,i;return function(){if(r)return i;if(r=!0,t)try{i=n.apply(e,arguments)}finally{t()}else i=n.apply(e,arguments);return i}}var go,Mm=globalThis.vscode;if(typeof Mm<"u"&&typeof Mm.process<"u"){let n=Mm.process;go={get platform(){return n.platform},get arch(){return n.arch},get env(){return n.env},cwd(){return n.cwd()}}}else typeof process<"u"&&typeof process?.versions?.node=="string"?go={get platform(){return process.platform},get arch(){return process.arch},get env(){return process.env},cwd(){return process.env.VSCODE_CWD||process.cwd()}}:go={get platform(){return U?"win32":W?"darwin":"linux"},get arch(){},get env(){return{}},cwd(){return"/"}};var ar=go.cwd,_t=go.env,wl=go.platform,ky=go.arch;var E0=65,P0=97,T0=90,C0=122,xi=46,Rt=47,gr=92,wi=58,k0=63,kd=class extends Error{code;constructor(t,e,r){let i;typeof e=="string"&&e.indexOf("not ")===0?(i="must not be",e=e.replace(/^not /,"")):i="must be";let o=t.indexOf(".")!==-1?"property":"argument",s=`The "${t}" ${o} ${i} of type ${e}`;s+=`. Received type ${typeof r}`,super(s),this.code="ERR_INVALID_ARG_TYPE"}};function _0(n,t){if(n===null||typeof n!="object")throw new kd(t,"Object",n)}function mt(n,t){if(typeof n!="string")throw new kd(t,"string",n)}var vr=wl==="win32";function Ie(n){return n===Rt||n===gr}function Wm(n){return n===Rt}function Si(n){return n>=E0&&n<=T0||n>=P0&&n<=C0}function _d(n,t,e,r){let i="",o=0,s=-1,a=0,l=0;for(let c=0;c<=n.length;++c){if(c<n.length)l=n.charCodeAt(c);else{if(r(l))break;l=Rt}if(r(l)){if(!(s===c-1||a===1))if(a===2){if(i.length<2||o!==2||i.charCodeAt(i.length-1)!==xi||i.charCodeAt(i.length-2)!==xi){if(i.length>2){let d=i.lastIndexOf(e);d===-1?(i="",o=0):(i=i.slice(0,d),o=i.length-1-i.lastIndexOf(e)),s=c,a=0;continue}else if(i.length!==0){i="",o=0,s=c,a=0;continue}}t&&(i+=i.length>0?`${e}..`:"..",o=2)}else i.length>0?i+=`${e}${n.slice(s+1,c)}`:i=n.slice(s+1,c),o=c-s-1;s=c,a=0}else l===xi&&a!==-1?++a:a=-1}return i}function R0(n){return n?`${n[0]==="."?"":"."}${n}`:""}function _y(n,t){_0(t,"pathObject");let e=t.dir||t.root,r=t.base||`${t.name||""}${R0(t.ext)}`;return e?e===t.root?`${e}${r}`:`${e}${n}${r}`:r}var He={resolve(...n){let t="",e="",r=!1;for(let i=n.length-1;i>=-1;i--){let o;if(i>=0){if(o=n[i],mt(o,`paths[${i}]`),o.length===0)continue}else t.length===0?o=ar():(o=_t[`=${t}`]||ar(),(o===void 0||o.slice(0,2).toLowerCase()!==t.toLowerCase()&&o.charCodeAt(2)===gr)&&(o=`${t}\\`));let s=o.length,a=0,l="",c=!1,d=o.charCodeAt(0);if(s===1)Ie(d)&&(a=1,c=!0);else if(Ie(d))if(c=!0,Ie(o.charCodeAt(1))){let u=2,m=u;for(;u<s&&!Ie(o.charCodeAt(u));)u++;if(u<s&&u!==m){let h=o.slice(m,u);for(m=u;u<s&&Ie(o.charCodeAt(u));)u++;if(u<s&&u!==m){for(m=u;u<s&&!Ie(o.charCodeAt(u));)u++;(u===s||u!==m)&&(l=`\\\\${h}\\${o.slice(m,u)}`,a=u)}}}else a=1;else Si(d)&&o.charCodeAt(1)===wi&&(l=o.slice(0,2),a=2,s>2&&Ie(o.charCodeAt(2))&&(c=!0,a=3));if(l.length>0)if(t.length>0){if(l.toLowerCase()!==t.toLowerCase())continue}else t=l;if(r){if(t.length>0)break}else if(e=`${o.slice(a)}\\${e}`,r=c,c&&t.length>0)break}return e=_d(e,!r,"\\",Ie),r?`${t}\\${e}`:`${t}${e}`||"."},normalize(n){mt(n,"path");let t=n.length;if(t===0)return".";let e=0,r,i=!1,o=n.charCodeAt(0);if(t===1)return Wm(o)?"\\":n;if(Ie(o))if(i=!0,Ie(n.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Ie(n.charCodeAt(a));)a++;if(a<t&&a!==l){let c=n.slice(l,a);for(l=a;a<t&&Ie(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Ie(n.charCodeAt(a));)a++;if(a===t)return`\\\\${c}\\${n.slice(l)}\\`;a!==l&&(r=`\\\\${c}\\${n.slice(l,a)}`,e=a)}}}else e=1;else Si(o)&&n.charCodeAt(1)===wi&&(r=n.slice(0,2),e=2,t>2&&Ie(n.charCodeAt(2))&&(i=!0,e=3));let s=e<t?_d(n.slice(e),!i,"\\",Ie):"";return s.length===0&&!i&&(s="."),s.length>0&&Ie(n.charCodeAt(t-1))&&(s+="\\"),r===void 0?i?`\\${s}`:s:i?`${r}\\${s}`:`${r}${s}`},isAbsolute(n){mt(n,"path");let t=n.length;if(t===0)return!1;let e=n.charCodeAt(0);return Ie(e)||t>2&&Si(e)&&n.charCodeAt(1)===wi&&Ie(n.charCodeAt(2))},join(...n){if(n.length===0)return".";let t,e;for(let o=0;o<n.length;++o){let s=n[o];mt(s,"path"),s.length>0&&(t===void 0?t=e=s:t+=`\\${s}`)}if(t===void 0)return".";let r=!0,i=0;if(typeof e=="string"&&Ie(e.charCodeAt(0))){++i;let o=e.length;o>1&&Ie(e.charCodeAt(1))&&(++i,o>2&&(Ie(e.charCodeAt(2))?++i:r=!1))}if(r){for(;i<t.length&&Ie(t.charCodeAt(i));)i++;i>=2&&(t=`\\${t.slice(i)}`)}return He.normalize(t)},relative(n,t){if(mt(n,"from"),mt(t,"to"),n===t)return"";let e=He.resolve(n),r=He.resolve(t);if(e===r||(n=e.toLowerCase(),t=r.toLowerCase(),n===t))return"";let i=0;for(;i<n.length&&n.charCodeAt(i)===gr;)i++;let o=n.length;for(;o-1>i&&n.charCodeAt(o-1)===gr;)o--;let s=o-i,a=0;for(;a<t.length&&t.charCodeAt(a)===gr;)a++;let l=t.length;for(;l-1>a&&t.charCodeAt(l-1)===gr;)l--;let c=l-a,d=s<c?s:c,u=-1,m=0;for(;m<d;m++){let y=n.charCodeAt(i+m);if(y!==t.charCodeAt(a+m))break;y===gr&&(u=m)}if(m!==d){if(u===-1)return r}else{if(c>d){if(t.charCodeAt(a+m)===gr)return r.slice(a+m+1);if(m===2)return r.slice(a+m)}s>d&&(n.charCodeAt(i+m)===gr?u=m:m===2&&(u=3)),u===-1&&(u=0)}let h="";for(m=i+u+1;m<=o;++m)(m===o||n.charCodeAt(m)===gr)&&(h+=h.length===0?"..":"\\..");return a+=u,h.length>0?`${h}${r.slice(a,l)}`:(r.charCodeAt(a)===gr&&++a,r.slice(a,l))},toNamespacedPath(n){if(typeof n!="string"||n.length===0)return n;let t=He.resolve(n);if(t.length<=2)return n;if(t.charCodeAt(0)===gr){if(t.charCodeAt(1)===gr){let e=t.charCodeAt(2);if(e!==k0&&e!==xi)return`\\\\?\\UNC\\${t.slice(2)}`}}else if(Si(t.charCodeAt(0))&&t.charCodeAt(1)===wi&&t.charCodeAt(2)===gr)return`\\\\?\\${t}`;return n},dirname(n){mt(n,"path");let t=n.length;if(t===0)return".";let e=-1,r=0,i=n.charCodeAt(0);if(t===1)return Ie(i)?n:".";if(Ie(i)){if(e=r=1,Ie(n.charCodeAt(1))){let a=2,l=a;for(;a<t&&!Ie(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&Ie(n.charCodeAt(a));)a++;if(a<t&&a!==l){for(l=a;a<t&&!Ie(n.charCodeAt(a));)a++;if(a===t)return n;a!==l&&(e=r=a+1)}}}}else Si(i)&&n.charCodeAt(1)===wi&&(e=t>2&&Ie(n.charCodeAt(2))?3:2,r=e);let o=-1,s=!0;for(let a=t-1;a>=r;--a)if(Ie(n.charCodeAt(a))){if(!s){o=a;break}}else s=!1;if(o===-1){if(e===-1)return".";o=e}return n.slice(0,o)},basename(n,t){t!==void 0&&mt(t,"suffix"),mt(n,"path");let e=0,r=-1,i=!0,o;if(n.length>=2&&Si(n.charCodeAt(0))&&n.charCodeAt(1)===wi&&(e=2),t!==void 0&&t.length>0&&t.length<=n.length){if(t===n)return"";let s=t.length-1,a=-1;for(o=n.length-1;o>=e;--o){let l=n.charCodeAt(o);if(Ie(l)){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return e===r?r=a:r===-1&&(r=n.length),n.slice(e,r)}for(o=n.length-1;o>=e;--o)if(Ie(n.charCodeAt(o))){if(!i){e=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(e,r)},extname(n){mt(n,"path");let t=0,e=-1,r=0,i=-1,o=!0,s=0;n.length>=2&&n.charCodeAt(1)===wi&&Si(n.charCodeAt(0))&&(t=r=2);for(let a=n.length-1;a>=t;--a){let l=n.charCodeAt(a);if(Ie(l)){if(!o){r=a+1;break}continue}i===-1&&(o=!1,i=a+1),l===xi?e===-1?e=a:s!==1&&(s=1):e!==-1&&(s=-1)}return e===-1||i===-1||s===0||s===1&&e===i-1&&e===r+1?"":n.slice(e,i)},format:_y.bind(null,"\\"),parse(n){mt(n,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return t;let e=n.length,r=0,i=n.charCodeAt(0);if(e===1)return Ie(i)?(t.root=t.dir=n,t):(t.base=t.name=n,t);if(Ie(i)){if(r=1,Ie(n.charCodeAt(1))){let u=2,m=u;for(;u<e&&!Ie(n.charCodeAt(u));)u++;if(u<e&&u!==m){for(m=u;u<e&&Ie(n.charCodeAt(u));)u++;if(u<e&&u!==m){for(m=u;u<e&&!Ie(n.charCodeAt(u));)u++;u===e?r=u:u!==m&&(r=u+1)}}}}else if(Si(i)&&n.charCodeAt(1)===wi){if(e<=2)return t.root=t.dir=n,t;if(r=2,Ie(n.charCodeAt(2))){if(e===3)return t.root=t.dir=n,t;r=3}}r>0&&(t.root=n.slice(0,r));let o=-1,s=r,a=-1,l=!0,c=n.length-1,d=0;for(;c>=r;--c){if(i=n.charCodeAt(c),Ie(i)){if(!l){s=c+1;break}continue}a===-1&&(l=!1,a=c+1),i===xi?o===-1?o=c:d!==1&&(d=1):o!==-1&&(d=-1)}return a!==-1&&(o===-1||d===0||d===1&&o===a-1&&o===s+1?t.base=t.name=n.slice(s,a):(t.name=n.slice(s,o),t.base=n.slice(s,a),t.ext=n.slice(o,a))),s>0&&s!==r?t.dir=n.slice(0,s-1):t.dir=t.root,t},sep:"\\",delimiter:";",win32:null,posix:null},D0=(()=>{if(vr){let n=/\\/g;return()=>{let t=ar().replace(n,"/");return t.slice(t.indexOf("/"))}}return()=>ar()})(),ee={resolve(...n){let t="",e=!1;for(let r=n.length-1;r>=-1&&!e;r--){let i=r>=0?n[r]:D0();mt(i,`paths[${r}]`),i.length!==0&&(t=`${i}/${t}`,e=i.charCodeAt(0)===Rt)}return t=_d(t,!e,"/",Wm),e?`/${t}`:t.length>0?t:"."},normalize(n){if(mt(n,"path"),n.length===0)return".";let t=n.charCodeAt(0)===Rt,e=n.charCodeAt(n.length-1)===Rt;return n=_d(n,!t,"/",Wm),n.length===0?t?"/":e?"./":".":(e&&(n+="/"),t?`/${n}`:n)},isAbsolute(n){return mt(n,"path"),n.length>0&&n.charCodeAt(0)===Rt},join(...n){if(n.length===0)return".";let t;for(let e=0;e<n.length;++e){let r=n[e];mt(r,"path"),r.length>0&&(t===void 0?t=r:t+=`/${r}`)}return t===void 0?".":ee.normalize(t)},relative(n,t){if(mt(n,"from"),mt(t,"to"),n===t||(n=ee.resolve(n),t=ee.resolve(t),n===t))return"";let e=1,r=n.length,i=r-e,o=1,s=t.length-o,a=i<s?i:s,l=-1,c=0;for(;c<a;c++){let u=n.charCodeAt(e+c);if(u!==t.charCodeAt(o+c))break;u===Rt&&(l=c)}if(c===a)if(s>a){if(t.charCodeAt(o+c)===Rt)return t.slice(o+c+1);if(c===0)return t.slice(o+c)}else i>a&&(n.charCodeAt(e+c)===Rt?l=c:c===0&&(l=0));let d="";for(c=e+l+1;c<=r;++c)(c===r||n.charCodeAt(c)===Rt)&&(d+=d.length===0?"..":"/..");return`${d}${t.slice(o+l)}`},toNamespacedPath(n){return n},dirname(n){if(mt(n,"path"),n.length===0)return".";let t=n.charCodeAt(0)===Rt,e=-1,r=!0;for(let i=n.length-1;i>=1;--i)if(n.charCodeAt(i)===Rt){if(!r){e=i;break}}else r=!1;return e===-1?t?"/":".":t&&e===1?"//":n.slice(0,e)},basename(n,t){t!==void 0&&mt(t,"ext"),mt(n,"path");let e=0,r=-1,i=!0,o;if(t!==void 0&&t.length>0&&t.length<=n.length){if(t===n)return"";let s=t.length-1,a=-1;for(o=n.length-1;o>=0;--o){let l=n.charCodeAt(o);if(l===Rt){if(!i){e=o+1;break}}else a===-1&&(i=!1,a=o+1),s>=0&&(l===t.charCodeAt(s)?--s===-1&&(r=o):(s=-1,r=a))}return e===r?r=a:r===-1&&(r=n.length),n.slice(e,r)}for(o=n.length-1;o>=0;--o)if(n.charCodeAt(o)===Rt){if(!i){e=o+1;break}}else r===-1&&(i=!1,r=o+1);return r===-1?"":n.slice(e,r)},extname(n){mt(n,"path");let t=-1,e=0,r=-1,i=!0,o=0;for(let s=n.length-1;s>=0;--s){let a=n.charCodeAt(s);if(a===Rt){if(!i){e=s+1;break}continue}r===-1&&(i=!1,r=s+1),a===xi?t===-1?t=s:o!==1&&(o=1):t!==-1&&(o=-1)}return t===-1||r===-1||o===0||o===1&&t===r-1&&t===e+1?"":n.slice(t,r)},format:_y.bind(null,"/"),parse(n){mt(n,"path");let t={root:"",dir:"",base:"",ext:"",name:""};if(n.length===0)return t;let e=n.charCodeAt(0)===Rt,r;e?(t.root="/",r=1):r=0;let i=-1,o=0,s=-1,a=!0,l=n.length-1,c=0;for(;l>=r;--l){let d=n.charCodeAt(l);if(d===Rt){if(!a){o=l+1;break}continue}s===-1&&(a=!1,s=l+1),d===xi?i===-1?i=l:c!==1&&(c=1):i!==-1&&(c=-1)}if(s!==-1){let d=o===0&&e?1:o;i===-1||c===0||c===1&&i===s-1&&i===o+1?t.base=t.name=n.slice(d,s):(t.name=n.slice(d,i),t.base=n.slice(d,s),t.ext=n.slice(i,s))}return o>0?t.dir=n.slice(0,o-1):e&&(t.dir="/"),t},sep:"/",delimiter:":",win32:null,posix:null};ee.win32=He.win32=He;ee.posix=He.posix=ee;var lt=vr?He.normalize:ee.normalize,Lr=vr?He.isAbsolute:ee.isAbsolute,V=vr?He.join:ee.join,Sn=vr?He.resolve:ee.resolve,Ry=vr?He.relative:ee.relative,Ne=vr?He.dirname:ee.dirname,pe=vr?He.basename:ee.basename,ls=vr?He.extname:ee.extname,LD=vr?He.format:ee.format,MD=vr?He.parse:ee.parse,AD=vr?He.toNamespacedPath:ee.toNamespacedPath,ht=vr?He.sep:ee.sep,cs=vr?He.delimiter:ee.delimiter;var O0=/^\w[\w\d+.-]*$/,F0=/^\//,L0=/^\/\//;function M0(n,t){if(!n.scheme&&t)throw new Error(`[UriError]: Scheme is missing: {scheme: "", authority: "${n.authority}", path: "${n.path}", query: "${n.query}", fragment: "${n.fragment}"}`);if(n.scheme&&!O0.test(n.scheme))throw new Error("[UriError]: Scheme contains illegal characters.");if(n.path){if(n.authority){if(!F0.test(n.path))throw new Error('[UriError]: If a URI contains an authority component, then the path component must either be empty or begin with a slash ("/") character')}else if(L0.test(n.path))throw new Error('[UriError]: If a URI does not contain an authority component, then the path cannot begin with two slash characters ("//")')}}function A0(n,t){return!n&&!t?"file":n}function W0(n,t){switch(n){case"https":case"http":case"file":t?t[0]!==nn&&(t=nn+t):t=nn;break}return t}var Qe="",nn="/",U0=/^(([^:/?#]+?):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?/,x=class n{static isUri(t){return t instanceof n?!0:t?typeof t.authority=="string"&&typeof t.fragment=="string"&&typeof t.path=="string"&&typeof t.query=="string"&&typeof t.scheme=="string"&&typeof t.fsPath=="string"&&typeof t.with=="function"&&typeof t.toString=="function":!1}scheme;authority;path;query;fragment;constructor(t,e,r,i,o,s=!1){typeof t=="object"?(this.scheme=t.scheme||Qe,this.authority=t.authority||Qe,this.path=t.path||Qe,this.query=t.query||Qe,this.fragment=t.fragment||Qe):(this.scheme=A0(t,s),this.authority=e||Qe,this.path=W0(this.scheme,r||Qe),this.query=i||Qe,this.fragment=o||Qe,M0(this,s))}get fsPath(){return Sl(this,!1)}with(t){if(!t)return this;let{scheme:e,authority:r,path:i,query:o,fragment:s}=t;return e===void 0?e=this.scheme:e===null&&(e=Qe),r===void 0?r=this.authority:r===null&&(r=Qe),i===void 0?i=this.path:i===null&&(i=Qe),o===void 0?o=this.query:o===null&&(o=Qe),s===void 0?s=this.fragment:s===null&&(s=Qe),e===this.scheme&&r===this.authority&&i===this.path&&o===this.query&&s===this.fragment?this:new Ei(e,r,i,o,s)}static parse(t,e=!1){let r=U0.exec(t);return r?new Ei(r[2]||Qe,Rd(r[4]||Qe),Rd(r[5]||Qe),Rd(r[7]||Qe),Rd(r[9]||Qe),e):new Ei(Qe,Qe,Qe,Qe,Qe)}static file(t){let e=Qe;if(U&&(t=t.replace(/\\/g,nn)),t[0]===nn&&t[1]===nn){let r=t.indexOf(nn,2);r===-1?(e=t.substring(2),t=nn):(e=t.substring(2,r),t=t.substring(r)||nn)}return new Ei("file",e,t,Qe,Qe)}static from(t,e){return new Ei(t.scheme,t.authority,t.path,t.query,t.fragment,e)}static joinPath(t,...e){if(!t.path)throw new Error("[UriError]: cannot call joinPath on URI without path");let r;return U&&t.scheme==="file"?r=n.file(He.join(Sl(t,!0),...e)).path:r=ee.join(t.path,...e),t.with({path:r})}toString(t=!1){return Um(this,t)}toJSON(){return this}static revive(t){if(t){if(t instanceof n)return t;{let e=new Ei(t);return e._formatted=t.external??null,e._fsPath=t._sep===Ly?t.fsPath??null:null,e}}else return t}[Symbol.for("debug.description")](){return`URI(${this.toString()})`}};var Ly=U?1:void 0,Ei=class extends x{_formatted=null;_fsPath=null;get fsPath(){return this._fsPath||(this._fsPath=Sl(this,!1)),this._fsPath}toString(t=!1){return t?Um(this,!0):(this._formatted||(this._formatted=Um(this,!1)),this._formatted)}toJSON(){let t={$mid:1};return this._fsPath&&(t.fsPath=this._fsPath,t._sep=Ly),this._formatted&&(t.external=this._formatted),this.path&&(t.path=this.path),this.scheme&&(t.scheme=this.scheme),this.authority&&(t.authority=this.authority),this.query&&(t.query=this.query),this.fragment&&(t.fragment=this.fragment),t}},My={58:"%3A",47:"%2F",63:"%3F",35:"%23",91:"%5B",93:"%5D",64:"%40",33:"%21",36:"%24",38:"%26",39:"%27",40:"%28",41:"%29",42:"%2A",43:"%2B",44:"%2C",59:"%3B",61:"%3D",32:"%20"};function Dy(n,t,e){let r,i=-1;for(let o=0;o<n.length;o++){let s=n.charCodeAt(o);if(s>=97&&s<=122||s>=65&&s<=90||s>=48&&s<=57||s===45||s===46||s===95||s===126||t&&s===47||e&&s===91||e&&s===93||e&&s===58)i!==-1&&(r+=encodeURIComponent(n.substring(i,o)),i=-1),r!==void 0&&(r+=n.charAt(o));else{r===void 0&&(r=n.substr(0,o));let a=My[s];a!==void 0?(i!==-1&&(r+=encodeURIComponent(n.substring(i,o)),i=-1),r+=a):i===-1&&(i=o)}}return i!==-1&&(r+=encodeURIComponent(n.substring(i))),r!==void 0?r:n}function N0(n){let t;for(let e=0;e<n.length;e++){let r=n.charCodeAt(e);r===35||r===63?(t===void 0&&(t=n.substr(0,e)),t+=My[r]):t!==void 0&&(t+=n[e])}return t!==void 0?t:n}function Sl(n,t){let e;return n.authority&&n.path.length>1&&n.scheme==="file"?e=`//${n.authority}${n.path}`:n.path.charCodeAt(0)===47&&(n.path.charCodeAt(1)>=65&&n.path.charCodeAt(1)<=90||n.path.charCodeAt(1)>=97&&n.path.charCodeAt(1)<=122)&&n.path.charCodeAt(2)===58?t?e=n.path.substr(1):e=n.path[1].toLowerCase()+n.path.substr(2):e=n.path,U&&(e=e.replace(/\//g,"\\")),e}function Um(n,t){let e=t?N0:Dy,r="",{scheme:i,authority:o,path:s,query:a,fragment:l}=n;if(i&&(r+=i,r+=":"),(o||i==="file")&&(r+=nn,r+=nn),o){let c=o.indexOf("@");if(c!==-1){let d=o.substr(0,c);o=o.substr(c+1),c=d.lastIndexOf(":"),c===-1?r+=e(d,!1,!1):(r+=e(d.substr(0,c),!1,!1),r+=":",r+=e(d.substr(c+1),!1,!0)),r+="@"}o=o.toLowerCase(),c=o.lastIndexOf(":"),c===-1?r+=e(o,!1,!0):(r+=e(o.substr(0,c),!1,!0),r+=o.substr(c))}if(s){if(s.length>=3&&s.charCodeAt(0)===47&&s.charCodeAt(2)===58){let c=s.charCodeAt(1);c>=65&&c<=90&&(s=`/${String.fromCharCode(c+32)}:${s.substr(3)}`)}else if(s.length>=2&&s.charCodeAt(1)===58){let c=s.charCodeAt(0);c>=65&&c<=90&&(s=`${String.fromCharCode(c+32)}:${s.substr(2)}`)}r+=e(s,!0,!1)}return a&&(r+="?",r+=e(a,!1,!1)),l&&(r+="#",r+=t?l:Dy(l,!1,!1)),r}function Ay(n){try{return decodeURIComponent(n)}catch{return n.length>3?n.substr(0,3)+Ay(n.substr(3)):n}}var Oy=/(%[0-9A-Za-z][0-9A-Za-z])+/g;function Rd(n){return n.match(Oy)?n.replace(Oy,t=>Ay(t)):n}function Wy(n){let t=[];return n.forEach((e,r)=>{t.push(`${r} => ${e}`)}),`Map(${n.size}) {${t.join(", ")}}`}function Uy(n){let t=[];return n.forEach(e=>{t.push(e)}),`Set(${n.size}) {${t.join(", ")}}`}var Nm=class{constructor(t,e){this.uri=t;this.value=e}};function B0(n){return Array.isArray(n)}var Ue=class n{static defaultToKey=t=>t.toString();[Symbol.toStringTag]="ResourceMap";map;toKey;constructor(t,e){if(t instanceof n)this.map=new Map(t.map),this.toKey=e??n.defaultToKey;else if(B0(t)){this.map=new Map,this.toKey=e??n.defaultToKey;for(let[r,i]of t)this.set(r,i)}else this.map=new Map,this.toKey=t??n.defaultToKey}set(t,e){return this.map.set(this.toKey(t),new Nm(t,e)),this}get(t){return this.map.get(this.toKey(t))?.value}has(t){return this.map.has(this.toKey(t))}get size(){return this.map.size}clear(){this.map.clear()}delete(t){return this.map.delete(this.toKey(t))}forEach(t,e){typeof e<"u"&&(t=t.bind(e));for(let[r,i]of this.map)t(i.value,i.uri,this)}*values(){for(let t of this.map.values())yield t.value}*keys(){for(let t of this.map.values())yield t.uri}*entries(){for(let t of this.map.values())yield[t.uri,t.value]}*[Symbol.iterator](){for(let[,t]of this.map)yield[t.uri,t.value]}},Dd=class{[Symbol.toStringTag]="ResourceSet";_map;constructor(t,e){!t||typeof t=="function"?this._map=new Ue(t):(this._map=new Ue(e),t.forEach(this.add,this))}get size(){return this._map.size}add(t){return this._map.set(t,t),this}clear(){this._map.clear()}delete(t){return this._map.delete(t)}forEach(t,e){this._map.forEach((r,i)=>t.call(e,i,i,this))}has(t){return this._map.has(t)}entries(){return this._map.entries()}keys(){return this._map.keys()}values(){return this._map.keys()}[Symbol.iterator](){return this.keys()}};var Bm=class{[Symbol.toStringTag]="LinkedMap";_map;_head;_tail;_size;_state;constructor(){this._map=new Map,this._head=void 0,this._tail=void 0,this._size=0,this._state=0}clear(){this._map.clear(),this._head=void 0,this._tail=void 0,this._size=0,this._state++}isEmpty(){return!this._head&&!this._tail}get size(){return this._size}get first(){return this._head?.value}get last(){return this._tail?.value}has(t){return this._map.has(t)}get(t,e=0){let r=this._map.get(t);if(r)return e!==0&&this.touch(r,e),r.value}set(t,e,r=0){let i=this._map.get(t);if(i)i.value=e,r!==0&&this.touch(i,r);else{switch(i={key:t,value:e,next:void 0,previous:void 0},r){case 0:this.addItemLast(i);break;case 1:this.addItemFirst(i);break;case 2:this.addItemLast(i);break;default:this.addItemLast(i);break}this._map.set(t,i),this._size++}return this}delete(t){return!!this.remove(t)}remove(t){let e=this._map.get(t);if(e)return this._map.delete(t),this.removeItem(e),this._size--,e.value}shift(){if(!this._head&&!this._tail)return;if(!this._head||!this._tail)throw new Error("Invalid list");let t=this._head;return this._map.delete(t.key),this.removeItem(t),this._size--,t.value}forEach(t,e){let r=this._state,i=this._head;for(;i;){if(e?t.bind(e)(i.value,i.key,this):t(i.value,i.key,this),this._state!==r)throw new Error("LinkedMap got modified during iteration.");i=i.next}}keys(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.key,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}values(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:r.value,done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}entries(){let t=this,e=this._state,r=this._head,i={[Symbol.iterator](){return i},next(){if(t._state!==e)throw new Error("LinkedMap got modified during iteration.");if(r){let o={value:[r.key,r.value],done:!1};return r=r.next,o}else return{value:void 0,done:!0}}};return i}[Symbol.iterator](){return this.entries()}trimOld(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._head,r=this.size;for(;e&&r>t;)this._map.delete(e.key),e=e.next,r--;this._head=e,this._size=r,e&&(e.previous=void 0),this._state++}trimNew(t){if(t>=this.size)return;if(t===0){this.clear();return}let e=this._tail,r=this.size;for(;e&&r>t;)this._map.delete(e.key),e=e.previous,r--;this._tail=e,this._size=r,e&&(e.next=void 0),this._state++}addItemFirst(t){if(!this._head&&!this._tail)this._tail=t;else if(this._head)t.next=this._head,this._head.previous=t;else throw new Error("Invalid list");this._head=t,this._state++}addItemLast(t){if(!this._head&&!this._tail)this._head=t;else if(this._tail)t.previous=this._tail,this._tail.next=t;else throw new Error("Invalid list");this._tail=t,this._state++}removeItem(t){if(t===this._head&&t===this._tail)this._head=void 0,this._tail=void 0;else if(t===this._head){if(!t.next)throw new Error("Invalid list");t.next.previous=void 0,this._head=t.next}else if(t===this._tail){if(!t.previous)throw new Error("Invalid list");t.previous.next=void 0,this._tail=t.previous}else{let e=t.next,r=t.previous;if(!e||!r)throw new Error("Invalid list");e.previous=r,r.next=e}t.next=void 0,t.previous=void 0,this._state++}touch(t,e){if(!this._head||!this._tail)throw new Error("Invalid list");if(!(e!==1&&e!==2)){if(e===1){if(t===this._head)return;let r=t.next,i=t.previous;t===this._tail?(i.next=void 0,this._tail=i):(r.previous=i,i.next=r),t.previous=void 0,t.next=this._head,this._head.previous=t,this._head=t,this._state++}else if(e===2){if(t===this._tail)return;let r=t.next,i=t.previous;t===this._head?(r.previous=void 0,this._head=r):(r.previous=i,i.next=r),t.next=void 0,t.previous=this._tail,this._tail.next=t,this._tail=t,this._state++}}}toJSON(){let t=[];return this.forEach((e,r)=>{t.push([r,e])}),t}fromJSON(t){this.clear();for(let[e,r]of t)this.set(e,r)}},Vm=class extends Bm{_limit;_ratio;constructor(t,e=1){super(),this._limit=t,this._ratio=Math.min(Math.max(0,e),1)}get limit(){return this._limit}set limit(t){this._limit=t,this.checkTrim()}get ratio(){return this._ratio}set ratio(t){this._ratio=Math.min(Math.max(0,t),1),this.checkTrim()}get(t,e=2){return super.get(t,e)}peek(t){return super.get(t,0)}set(t,e){return super.set(t,e,2),this}checkTrim(){this.size>this._limit&&this.trim(Math.round(this._limit*this._ratio))}},Qn=class extends Vm{constructor(t,e=1){super(t,e)}trim(t){this.trimOld(t)}set(t,e){return super.set(t,e),this.checkTrim(),this}};var jr;(_=>{function n(T){return T&&typeof T=="object"&&typeof T[Symbol.iterator]=="function"}_.is=n;let t=Object.freeze([]);function e(){return t}_.empty=e;function*r(T){yield T}_.single=r;function i(T){return n(T)?T:r(T)}_.wrap=i;function o(T){return T||t}_.from=o;function*s(T){for(let N=T.length-1;N>=0;N--)yield T[N]}_.reverse=s;function a(T){return!T||T[Symbol.iterator]().next().done===!0}_.isEmpty=a;function l(T){return T[Symbol.iterator]().next().value}_.first=l;function c(T,N){let J=0;for(let H of T)if(N(H,J++))return!0;return!1}_.some=c;function d(T,N){for(let J of T)if(N(J))return J}_.find=d;function*u(T,N){for(let J of T)N(J)&&(yield J)}_.filter=u;function*m(T,N){let J=0;for(let H of T)yield N(H,J++)}_.map=m;function*h(T,N){let J=0;for(let H of T)yield*N(H,J++)}_.flatMap=h;function*y(...T){for(let N of T)yield*N}_.concat=y;function v(T,N,J){let H=J;for(let Ke of T)H=N(H,Ke);return H}_.reduce=v;function*b(T,N,J=T.length){for(N<0&&(N+=T.length),J<0?J+=T.length:J>T.length&&(J=T.length);N<J;N++)yield T[N]}_.slice=b;function C(T,N=Number.POSITIVE_INFINITY){let J=[];if(N===0)return[J,T];let H=T[Symbol.iterator]();for(let Ke=0;Ke<N;Ke++){let re=H.next();if(re.done)return[J,_.empty()];J.push(re.value)}return[J,{[Symbol.iterator](){return H}}]}_.consume=C;async function k(T){let N=[];for await(let J of T)N.push(J);return Promise.resolve(N)}_.asyncToArray=k})(jr||={});var V0=!1,ds=null;function K0(n){ds=n}if(V0){let n="__is_disposable_tracked__";K0(new class{trackDisposable(t){let e=new Error("Potentially leaked disposable").stack;setTimeout(()=>{t[n]||console.log(e)},3e3)}setParent(t,e){if(t&&t!==D.None)try{t[n]=!0}catch{}}markAsDisposed(t){if(t&&t!==D.None)try{t[n]=!0}catch{}}markAsSingleton(t){}})}function vo(n){return ds?.trackDisposable(n),n}function yo(n){ds?.markAsDisposed(n)}function xl(n,t){ds?.setParent(n,t)}function H0(n,t){if(ds)for(let e of n)ds.setParent(e,t)}function Od(n){return typeof n=="object"&&n!==null&&typeof n.dispose=="function"&&n.dispose.length===0}function ze(n){if(jr.is(n)){let t=[];for(let e of n)if(e)try{e.dispose()}catch(r){t.push(r)}if(t.length===1)throw t[0];if(t.length>1)throw new AggregateError(t,"Encountered errors while disposing of store");return Array.isArray(n)?[]:n}else if(n)return n.dispose(),n}function Fd(...n){let t=$(()=>ze(n));return H0(n,t),t}function $(n){let t=vo({dispose:as(()=>{yo(t),n()})});return t}var Y=class n{static DISABLE_DISPOSED_WARNING=!1;_toDispose=new Set;_isDisposed=!1;constructor(){vo(this)}dispose(){this._isDisposed||(yo(this),this._isDisposed=!0,this.clear())}get isDisposed(){return this._isDisposed}clear(){if(this._toDispose.size!==0)try{ze(this._toDispose)}finally{this._toDispose.clear()}}add(t){if(!t)return t;if(t===this)throw new Error("Cannot register a disposable on itself!");return xl(t,this),this._isDisposed?n.DISABLE_DISPOSED_WARNING||console.warn(new Error("Trying to add a disposable to a DisposableStore that has already been disposed of. The added object will be leaked!").stack):this._toDispose.add(t),t}delete(t){if(t){if(t===this)throw new Error("Cannot dispose a disposable on itself!");this._toDispose.delete(t),t.dispose()}}deleteAndLeak(t){t&&this._toDispose.has(t)&&(this._toDispose.delete(t),xl(t,null))}},D=class{static None=Object.freeze({dispose(){}});_store=new Y;constructor(){vo(this),xl(this._store,this)}dispose(){yo(this),this._store.dispose()}_register(t){if(t===this)throw new Error("Cannot register a disposable on itself!");return this._store.add(t)}},Mr=class{_value;_isDisposed=!1;constructor(){vo(this)}get value(){return this._isDisposed?void 0:this._value}set value(t){this._isDisposed||t===this._value||(this._value?.dispose(),t&&xl(t,this),this._value=t)}clear(){this.value=void 0}dispose(){this._isDisposed=!0,yo(this),this._value?.dispose(),this._value=void 0}clearAndLeak(){let t=this._value;return this._value=void 0,t&&xl(t,null),t}};var Yn=class{_store=new Map;_isDisposed=!1;constructor(){vo(this)}dispose(){yo(this),this._isDisposed=!0,this.clearAndDisposeAll()}clearAndDisposeAll(){if(this._store.size)try{ze(this._store.values())}finally{this._store.clear()}}has(t){return this._store.has(t)}get size(){return this._store.size}get(t){return this._store.get(t)}set(t,e,r=!1){this._isDisposed&&console.warn(new Error("Trying to add a disposable to a DisposableMap that has already been disposed of. The added object will be leaked!").stack),r||this._store.get(t)?.dispose(),this._store.set(t,e)}deleteAndDispose(t){this._store.get(t)?.dispose(),this._store.delete(t)}deleteAndLeak(t){let e=this._store.get(t);return this._store.delete(t),e}keys(){return this._store.keys()}values(){return this._store.values()}[Symbol.iterator](){return this._store[Symbol.iterator]()}};var tt=class n{static Undefined=new n(void 0);element;next;prev;constructor(t){this.element=t,this.next=n.Undefined,this.prev=n.Undefined}},Pi=class{_first=tt.Undefined;_last=tt.Undefined;_size=0;get size(){return this._size}isEmpty(){return this._first===tt.Undefined}clear(){let t=this._first;for(;t!==tt.Undefined;){let e=t.next;t.prev=tt.Undefined,t.next=tt.Undefined,t=e}this._first=tt.Undefined,this._last=tt.Undefined,this._size=0}unshift(t){return this._insert(t,!1)}push(t){return this._insert(t,!0)}_insert(t,e){let r=new tt(t);if(this._first===tt.Undefined)this._first=r,this._last=r;else if(e){let o=this._last;this._last=r,r.prev=o,o.next=r}else{let o=this._first;this._first=r,r.next=o,o.prev=r}this._size+=1;let i=!1;return()=>{i||(i=!0,this._remove(r))}}shift(){if(this._first!==tt.Undefined){let t=this._first.element;return this._remove(this._first),t}}pop(){if(this._last!==tt.Undefined){let t=this._last.element;return this._remove(this._last),t}}_remove(t){if(t.prev!==tt.Undefined&&t.next!==tt.Undefined){let e=t.prev;e.next=t.next,t.next.prev=e}else t.prev===tt.Undefined&&t.next===tt.Undefined?(this._first=tt.Undefined,this._last=tt.Undefined):t.next===tt.Undefined?(this._last=this._last.prev,this._last.next=tt.Undefined):t.prev===tt.Undefined&&(this._first=this._first.next,this._first.prev=tt.Undefined);this._size-=1}*[Symbol.iterator](){let t=this._first;for(;t!==tt.Undefined;)yield t.element,t=t.next}};var Io=(n,t)=>n===t;var sn=class{constructor(t,e,r){this.owner=t;this.debugNameSource=e;this.referenceFn=r}getDebugName(t){return Ky(t,this)}},Ny=new Map,Hm=new WeakMap;function Ky(n,t){let e=Hm.get(n);if(e)return e;let r=z0(n,t);if(r){let i=Ny.get(r)??0;i++,Ny.set(r,i);let o=i===1?r:`${r}#${i}`;return Hm.set(n,o),o}}function z0(n,t){let e=Hm.get(n);if(e)return e;let r=t.owner?$0(t.owner)+".":"",i,o=t.debugNameSource;if(o!==void 0)if(typeof o=="function"){if(i=o(),i!==void 0)return r+i}else return r+o;let s=t.referenceFn;if(s!==void 0&&(i=Ld(s),i!==void 0))return r+i;if(t.owner!==void 0){let a=q0(t.owner,n);if(a!==void 0)return r+a}}function q0(n,t){for(let e in n)if(n[e]===t)return e}var By=new Map,Vy=new WeakMap;function $0(n){let t=Vy.get(n);if(t)return t;let e=j0(n),r=By.get(e)??0;r++,By.set(e,r);let i=r===1?e:`${e}#${r}`;return Vy.set(n,i),i}function j0(n){let t=n.constructor;return t?t.name:"Object"}function Ld(n){let t=n.toString(),r=/\/\*\*\s*@description\s*([^*]*)\*\//.exec(t);return(r?r[1]:void 0)?.trim()}function Md(n,t){if(!n)throw new Error(t?`Assertion failed (${t})`:"Assertion Failed")}function Hy(n,t="Unreachable"){throw new Error(t)}function Ad(n){if(!n()){debugger;n(),Je(new os("Assertion Failed"))}}function El(n){return new Wd(new sn(void 0,void 0,n),n,void 0,void 0)}var Wd=class{constructor(t,e,r,i){this._debugNameData=t;this._runFn=e;this.createChangeSummary=r;this._handleChange=i;this.changeSummary=this.createChangeSummary?.(),Ar()?.handleAutorunCreated(this),this._runIfNeeded(),vo(this)}state=2;updateCount=0;disposed=!1;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}dispose(){this.disposed=!0;for(let t of this.dependencies)t.removeObserver(this);this.dependencies.clear(),yo(this)}_runIfNeeded(){if(this.state===3)return;let t=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=t,this.state=3;let e=this.disposed;try{if(!e){Ar()?.handleAutorunTriggered(this);let r=this.changeSummary;try{this.changeSummary=this.createChangeSummary?.(),this._runFn(this,r)}catch(i){ss(i)}}}finally{e||Ar()?.handleAutorunFinished(this);for(let r of this.dependenciesToBeRemoved)r.removeObserver(this);this.dependenciesToBeRemoved.clear()}}toString(){return`Autorun<${this.debugName}>`}beginUpdate(){this.state===3&&(this.state=1),this.updateCount++}endUpdate(){try{if(this.updateCount===1)do{if(this.state===1){this.state=3;for(let t of this.dependencies)if(t.reportChanges(),this.state===2)break}this._runIfNeeded()}while(this.state!==3)}finally{this.updateCount--}Ad(()=>this.updateCount>=0)}handlePossibleChange(t){this.state===3&&this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t)&&(this.state=1)}handleChange(t,e){if(this.dependencies.has(t)&&!this.dependenciesToBeRemoved.has(t))try{(this._handleChange?this._handleChange({changedObservable:t,change:e,didChange:i=>i===t},this.changeSummary):!0)&&(this.state=2)}catch(r){ss(r)}}readObservable(t){if(this.disposed)return t.get();t.addObserver(this);let e=t.get();return this.dependencies.add(t),this.dependenciesToBeRemoved.delete(t),e}};(t=>t.Observer=Wd)(El||={});function zm(n,t){return new Ud(new sn(n.owner,n.debugName,n.debugReferenceFn),t,void 0,void 0,n.onLastObserverRemoved,n.equalsFn??Io)}zy(zm);var Ud=class extends bo{constructor(e,r,i,o,s=void 0,a){super();this._debugNameData=e;this._computeFn=r;this.createChangeSummary=i;this._handleChange=o;this._handleLastObserverRemoved=s;this._equalityComparator=a;this.changeSummary=this.createChangeSummary?.(),Ar()?.handleDerivedCreated(this)}state=0;value=void 0;updateCount=0;dependencies=new Set;dependenciesToBeRemoved=new Set;changeSummary=void 0;get debugName(){return this._debugNameData.getDebugName(this)??"(anonymous)"}onLastObserverRemoved(){this.state=0,this.value=void 0;for(let e of this.dependencies)e.removeObserver(this);this.dependencies.clear(),this._handleLastObserverRemoved?.()}get(){if(this.observers.size===0){let e=this._computeFn(this,this.createChangeSummary?.());return this.onLastObserverRemoved(),e}else{do{if(this.state===1){for(let e of this.dependencies)if(e.reportChanges(),this.state===2)break}this.state===1&&(this.state=3),this._recomputeIfNeeded()}while(this.state!==3);return this.value}}_recomputeIfNeeded(){if(this.state===3)return;let e=this.dependenciesToBeRemoved;this.dependenciesToBeRemoved=this.dependencies,this.dependencies=e;let r=this.state!==0,i=this.value;this.state=3;let o=!1;try{let s=this.changeSummary;this.changeSummary=this.createChangeSummary?.();try{this.value=this._computeFn(this,s)}finally{for(let a of this.dependenciesToBeRemoved)a.removeObserver(this);this.dependenciesToBeRemoved.clear()}o=r&&!this._equalityComparator(i,this.value),Ar()?.handleDerivedRecomputed(this,{oldValue:i,newValue:this.value,change:void 0,didChange:o,hadValue:r})}catch(s){ss(s)}if(o)for(let s of this.observers)s.handleChange(this,void 0)}toString(){return`LazyDerived<${this.debugName}>`}beginUpdate(e){this.updateCount++;let r=this.updateCount===1;if(this.state===3&&(this.state=1,!r))for(let i of this.observers)i.handlePossibleChange(this);if(r)for(let i of this.observers)i.beginUpdate(this)}endUpdate(e){if(this.updateCount--,this.updateCount===0){let r=[...this.observers];for(let i of r)i.endUpdate(this)}Ad(()=>this.updateCount>=0)}handlePossibleChange(e){if(this.state===3&&this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){this.state=1;for(let r of this.observers)r.handlePossibleChange(this)}}handleChange(e,r){if(this.dependencies.has(e)&&!this.dependenciesToBeRemoved.has(e)){let i=!1;try{i=this._handleChange?this._handleChange({changedObservable:e,change:r,didChange:s=>s===e},this.changeSummary):!0}catch(s){ss(s)}let o=this.state===3;if(i&&(this.state===1||o)&&(this.state=2,o))for(let s of this.observers)s.handlePossibleChange(this)}}readObservable(e){e.addObserver(this);let r=e.get();return this.dependencies.add(e),this.dependenciesToBeRemoved.delete(e),r}addObserver(e){let r=!this.observers.has(e)&&this.updateCount>0;super.addObserver(e),r&&e.beginUpdate(this)}removeObserver(e){let r=this.observers.has(e)&&this.updateCount>0;super.removeObserver(e),r&&e.endUpdate(this)}};function qm(...n){let t,e,r;return n.length===3?[t,e,r]=n:[e,r]=n,new Ti(new sn(t,void 0,r),e,r,()=>Ti.globalTransaction,Io)}var Ti=class extends bo{constructor(e,r,i,o,s){super();this._debugNameData=e;this.event=r;this._getValue=i;this._getTransaction=o;this._equalityComparator=s}static globalTransaction;value;hasValue=!1;subscription;getDebugName(){return this._debugNameData.getDebugName(this)}get debugName(){let e=this.getDebugName();return"From Event"+(e?`: ${e}`:"")}onFirstObserverAdded(){this.subscription=this.event(this.handleEvent)}handleEvent=e=>{let r=this._getValue(e),i=this.value,o=!this.hasValue||!this._equalityComparator(i,r),s=!1;o&&(this.value=r,this.hasValue&&(s=!0,$m(this._getTransaction(),a=>{Ar()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:r,change:void 0,didChange:o,hadValue:this.hasValue});for(let l of this.observers)a.updateObserver(l,this),l.handleChange(this,void 0)},()=>{let a=this.getDebugName();return"Event fired"+(a?`: ${a}`:"")})),this.hasValue=!0),s||Ar()?.handleFromEventObservableTriggered(this,{oldValue:i,newValue:r,change:void 0,didChange:o,hadValue:this.hasValue})};onLastObserverRemoved(){this.subscription.dispose(),this.subscription=void 0,this.hasValue=!1,this.value=void 0}get(){return this.subscription?(this.hasValue||this.handleEvent(void 0),this.value):this._getValue(void 0)}};(e=>{e.Observer=Ti;function t(r,i){let o=!1;Ti.globalTransaction===void 0&&(Ti.globalTransaction=r,o=!0);try{i()}finally{o&&(Ti.globalTransaction=void 0)}}e.batchEventsGlobally=t})(qm||={});function $y(n){let t=new Nd(!1,void 0);return n.addObserver(t),$(()=>{n.removeObserver(t)})}Jy($y);function jy(n,t){let e=new Nd(!0,t);return n.addObserver(e),t?t(n.get()):n.reportChanges(),$(()=>{n.removeObserver(e)})}Gy(jy);var Nd=class{constructor(t,e){this._forceRecompute=t;this._handleValue=e}_counter=0;beginUpdate(t){this._counter++}endUpdate(t){this._counter--,this._counter===0&&this._forceRecompute&&(this._handleValue?this._handleValue(t.get()):t.reportChanges())}handlePossibleChange(t){}handleChange(t,e){}};var Yy;function Xy(n){Yy=n}function Ar(){return Yy}var Kd=class{indentation=0;textToConsoleArgs(t){return Y0([us(eE("|  ",this.indentation)),t])}formatInfo(t){return t.hadValue?t.didChange?[us(" "),an(Tl(t.oldValue,70),{color:"red",strikeThrough:!0}),us(" "),an(Tl(t.newValue,60),{color:"green"})]:[us(" (unchanged)")]:[us(" "),an(Tl(t.newValue,60),{color:"green"}),us(" (initial)")]}handleObservableChanged(t,e){console.log(...this.textToConsoleArgs([Pl("observable value changed"),an(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e)]))}changedObservablesSets=new WeakMap;formatChanges(t){if(t.size!==0)return an(" (changed deps: "+[...t].map(e=>e.debugName).join(", ")+")",{color:"gray"})}handleDerivedCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(r,i)=>(this.changedObservablesSets.get(t).add(r),e.apply(t,[r,i]))}handleDerivedRecomputed(t,e){let r=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([Pl("derived recomputed"),an(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),this.formatChanges(r),{data:[{fn:t._debugNameData.referenceFn??t._computeFn}]}])),r.clear()}handleFromEventObservableTriggered(t,e){console.log(...this.textToConsoleArgs([Pl("observable from event triggered"),an(t.debugName,{color:"BlueViolet"}),...this.formatInfo(e),{data:[{fn:t._getValue}]}]))}handleAutorunCreated(t){let e=t.handleChange;this.changedObservablesSets.set(t,new Set),t.handleChange=(r,i)=>(this.changedObservablesSets.get(t).add(r),e.apply(t,[r,i]))}handleAutorunTriggered(t){let e=this.changedObservablesSets.get(t);console.log(...this.textToConsoleArgs([Pl("autorun"),an(t.debugName,{color:"BlueViolet"}),this.formatChanges(e),{data:[{fn:t._debugNameData.referenceFn??t._runFn}]}])),e.clear(),this.indentation++}handleAutorunFinished(t){this.indentation--}handleBeginTransaction(t){let e=t.getDebugName();e===void 0&&(e=""),console.log(...this.textToConsoleArgs([Pl("transaction"),an(e,{color:"BlueViolet"}),{data:[{fn:t._fn}]}])),this.indentation++}handleEndTransaction(){this.indentation--}};function Y0(n){let t=new Array,e=[],r="";function i(s){if("length"in s)for(let a of s)a&&i(a);else"text"in s?(r+=`%c${s.text}`,t.push(s.style),s.data&&e.push(...s.data)):"data"in s&&e.push(...s.data)}i(n);let o=[r,...t];return o.push(...e),o}function us(n){return an(n,{color:"black"})}function Pl(n){return an(tE(`${n}: `,10),{color:"black",bold:!0})}function an(n,t={color:"black"}){function e(i){return Object.entries(i).reduce((o,[s,a])=>`${o}${s}:${a};`,"")}let r={color:t.color};return t.strikeThrough&&(r["text-decoration"]="line-through"),t.bold&&(r["font-weight"]="bold"),{text:n,style:e(r)}}function Tl(n,t){switch(typeof n){case"number":return""+n;case"string":return n.length+2<=t?`"${n}"`:`"${n.substr(0,t-7)}"+...`;case"boolean":return n?"true":"false";case"undefined":return"undefined";case"object":return n===null?"null":Array.isArray(n)?X0(n,t):Z0(n,t);case"symbol":return n.toString();case"function":return`[[Function${n.name?" "+n.name:""}]]`;default:return""+n}}function X0(n,t){let e="[ ",r=!0;for(let i of n){if(r||(e+=", "),e.length-5>t){e+="...";break}r=!1,e+=`${Tl(i,t-e.length)}`}return e+=" ]",e}function Z0(n,t){let e="{ ",r=!0;for(let[i,o]of Object.entries(n)){if(r||(e+=", "),e.length-5>t){e+="...";break}r=!1,e+=`${i}: ${Tl(o,t-e.length)}`}return e+=" }",e}function eE(n,t){let e="";for(let r=1;r<=t;r++)e+=n;return e}function tE(n,t){for(;n.length<t;)n+=" ";return n}var Zy;function Gy(n){Zy=n}var eI;function Jy(n){eI=n}var jm;function zy(n){jm=n}var Bd=class{get TChange(){return null}reportChanges(){this.get()}read(t){return t?t.readObservable(this):this.get()}map(t,e){let r=e===void 0?void 0:t,i=e===void 0?t:e;return jm({owner:r,debugName:()=>{let o=Ld(i);if(o!==void 0)return o;let a=/^\s*\(?\s*([a-zA-Z_$][a-zA-Z_$0-9]*)\s*\)?\s*=>\s*\1(?:\??)\.([a-zA-Z_$][a-zA-Z_$0-9]*)\s*$/.exec(i.toString());if(a)return`${this.debugName}.${a[2]}`;if(!r)return`${this.debugName} (mapped)`},debugReferenceFn:i},o=>i(this.read(o),o))}flatten(){return jm({owner:void 0,debugName:()=>`${this.debugName} (flattened)`},t=>this.read(t).read(t))}recomputeInitiallyAndOnChange(t,e){return t.add(Zy(this,e)),this}keepObserved(t){return t.add(eI(this)),this}get debugValue(){return this.get()}},bo=class extends Bd{observers=new Set;addObserver(t){let e=this.observers.size;this.observers.add(t),e===0&&this.onFirstObserverAdded()}removeObserver(t){this.observers.delete(t)&&this.observers.size===0&&this.onLastObserverRemoved()}onFirstObserverAdded(){}onLastObserverRemoved(){}};function Vd(n,t){let e=new Hd(n,t);try{n(e)}finally{e.finish()}}function $m(n,t,e){n?t(n):Vd(t,e)}var Hd=class{constructor(t,e){this._fn=t;this._getDebugName=e;Ar()?.handleBeginTransaction(this)}updatingObservers=[];getDebugName(){return this._getDebugName?this._getDebugName():Ld(this._fn)}updateObserver(t,e){this.updatingObservers.push({observer:t,observable:e}),t.beginUpdate(e)}finish(){let t=this.updatingObservers;for(let e=0;e<t.length;e++){let{observer:r,observable:i}=t[e];r.endUpdate(i)}this.updatingObservers=null,Ar()?.handleEndTransaction()}};var rE=!1;rE&&Xy(new Kd);var nE=globalThis.performance&&typeof globalThis.performance.now=="function",yr=class n{_startTime;_stopTime;_now;static create(t){return new n(t)}constructor(t){this._now=nE&&t===!1?Date.now:globalThis.performance.now.bind(globalThis.performance),this._startTime=this._now(),this._stopTime=-1}stop(){this._stopTime=this._now()}reset(){this._startTime=this._now(),this._stopTime=-1}elapsed(){return this._stopTime!==-1?this._stopTime-this._startTime:this._now()-this._startTime}};var tI=Symbol("MicrotaskDelay");var iE=!1,rI=!1,oE=!1,E;(qr=>{qr.None=()=>D.None;function t(j){if(oE){let{onDidAddListener:B}=j,G=Cl.create(),z=0;j.onDidAddListener=()=>{++z===2&&(console.warn("snapshotted emitter LIKELY used public and SHOULD HAVE BEEN created with DisposableStore. snapshotted here"),G.print()),B?.()}}}function e(j,B){return h(j,()=>{},0,void 0,!0,void 0,B)}qr.defer=e;function r(j){return(B,G=null,z)=>{let te=!1,he;return he=j(Ce=>{if(!te)return he?he.dispose():te=!0,B.call(G,Ce)},null,z),te&&he.dispose(),he}}qr.once=r;function i(j,B){return qr.once(qr.filter(j,B))}qr.onceIf=i;function o(j,B,G){return u((z,te=null,he)=>j(Ce=>z.call(te,B(Ce)),null,he),G)}qr.map=o;function s(j,B,G){return u((z,te=null,he)=>j(Ce=>{B(Ce),z.call(te,Ce)},null,he),G)}qr.forEach=s;function a(j,B,G){return u((z,te=null,he)=>j(Ce=>B(Ce)&&z.call(te,Ce),null,he),G)}qr.filter=a;function l(j){return j}qr.signal=l;function c(...j){return(B,G=null,z)=>{let te=Fd(...j.map(he=>he(Ce=>B.call(G,Ce))));return m(te,z)}}qr.any=c;function d(j,B,G,z){let te=G;return o(j,he=>(te=B(te,he),te),z)}qr.reduce=d;function u(j,B){let G,z={onWillAddFirstListener(){G=j(te.fire,te)},onDidRemoveLastListener(){G?.dispose()}};B||t(z);let te=new S(z);return B?.add(te),te.event}function m(j,B){return B instanceof Array?B.push(j):B&&B.add(j),j}function h(j,B,G=100,z=!1,te=!1,he,Ce){let ot,St,se,Ii=0,qn,bi={leakWarningThreshold:he,onWillAddFirstListener(){ot=j(ud=>{Ii++,St=B(St,ud),z&&!se&&(uo.fire(St),St=void 0),qn=()=>{let pd=St;St=void 0,se=void 0,(!z||Ii>1)&&uo.fire(pd),Ii=0},typeof G=="number"?(clearTimeout(se),se=setTimeout(qn,G)):se===void 0&&(se=0,queueMicrotask(qn))})},onWillRemoveListener(){te&&Ii>0&&qn?.()},onDidRemoveLastListener(){qn=void 0,ot.dispose()}};Ce||t(bi);let uo=new S(bi);return Ce?.add(uo),uo.event}qr.debounce=h;function y(j,B=0,G){return qr.debounce(j,(z,te)=>z?(z.push(te),z):[te],B,void 0,!0,void 0,G)}qr.accumulate=y;function v(j,B=(z,te)=>z===te,G){let z=!0,te;return a(j,he=>{let Ce=z||!B(he,te);return z=!1,te=he,Ce},G)}qr.latch=v;function b(j,B,G){return[qr.filter(j,B,G),qr.filter(j,z=>!B(z),G)]}qr.split=b;function C(j,B=!1,G=[],z){let te=G.slice(),he=j(St=>{te?te.push(St):ot.fire(St)});z&&z.add(he);let Ce=()=>{te?.forEach(St=>ot.fire(St)),te=null},ot=new S({onWillAddFirstListener(){he||(he=j(St=>ot.fire(St)),z&&z.add(he))},onDidAddFirstListener(){te&&(B?setTimeout(Ce):Ce())},onDidRemoveLastListener(){he&&he.dispose(),he=null}});return z&&z.add(ot),ot.event}qr.buffer=C;function k(j,B){return(z,te,he)=>{let Ce=B(new T);return j(function(ot){let St=Ce.evaluate(ot);St!==_&&z.call(te,St)},void 0,he)}}qr.chain=k;let _=Symbol("HaltChainable");class T{steps=[];map(B){return this.steps.push(B),this}forEach(B){return this.steps.push(G=>(B(G),G)),this}filter(B){return this.steps.push(G=>B(G)?G:_),this}reduce(B,G){let z=G;return this.steps.push(te=>(z=B(z,te),z)),this}latch(B=(G,z)=>G===z){let G=!0,z;return this.steps.push(te=>{let he=G||!B(te,z);return G=!1,z=te,he?te:_}),this}evaluate(B){for(let G of this.steps)if(B=G(B),B===_)break;return B}}function N(j,B,G=z=>z){let z=(...ot)=>Ce.fire(G(...ot)),te=()=>j.on(B,z),he=()=>j.removeListener(B,z),Ce=new S({onWillAddFirstListener:te,onDidRemoveLastListener:he});return Ce.event}qr.fromNodeEventEmitter=N;function J(j,B,G=z=>z){let z=(...ot)=>Ce.fire(G(...ot)),te=()=>j.addEventListener(B,z),he=()=>j.removeEventListener(B,z),Ce=new S({onWillAddFirstListener:te,onDidRemoveLastListener:he});return Ce.event}qr.fromDOMEventEmitter=J;function H(j){return new Promise(B=>r(j)(B))}qr.toPromise=H;function Ke(j){let B=new S;return j.then(G=>{B.fire(G)},()=>{B.fire(void 0)}).finally(()=>{B.dispose()}),B.event}qr.fromPromise=Ke;function re(j,B){return j(G=>B.fire(G))}qr.forward=re;function je(j,B,G){return B(G),j(z=>B(z))}qr.runAndSubscribe=je;class zr{constructor(B,G){this._observable=B;let z={onWillAddFirstListener:()=>{B.addObserver(this),this._observable.reportChanges()},onDidRemoveLastListener:()=>{B.removeObserver(this)}};G||t(z),this.emitter=new S(z),G&&G.add(this.emitter)}emitter;_counter=0;_hasChanged=!1;beginUpdate(B){this._counter++}handlePossibleChange(B){}handleChange(B,G){this._hasChanged=!0}endUpdate(B){this._counter--,this._counter===0&&(this._observable.reportChanges(),this._hasChanged&&(this._hasChanged=!1,this.emitter.fire(this._observable.get())))}}function Nt(j,B){return new zr(j,B).emitter.event}qr.fromObservable=Nt;function vn(j){return(B,G,z)=>{let te=0,he=!1,Ce={beginUpdate(){te++},endUpdate(){te--,te===0&&(j.reportChanges(),he&&(he=!1,B.call(G)))},handlePossibleChange(){},handleChange(){he=!0}};j.addObserver(Ce),j.reportChanges();let ot={dispose(){j.removeObserver(Ce)}};return z instanceof Y?z.add(ot):Array.isArray(z)&&z.push(ot),ot}}qr.fromObservableLight=vn})(E||={});var Gm=class n{static all=new Set;static _idPool=0;name;listenerCount=0;invocationCount=0;elapsedOverall=0;durations=[];_stopWatch;constructor(t){this.name=`${t}_${n._idPool++}`,n.all.add(this)}start(t){this._stopWatch=new yr,this.listenerCount=t}stop(){if(this._stopWatch){let t=this._stopWatch.elapsed();this.durations.push(t),this.elapsedOverall+=t,this.invocationCount+=1,this._stopWatch=void 0}}},nI=-1;var Jm=class n{constructor(t,e,r=(n._idPool++).toString(16).padStart(3,"0")){this._errorHandler=t;this.threshold=e;this.name=r}static _idPool=1;_stacks;_warnCountdown=0;dispose(){this._stacks?.clear()}check(t,e){let r=this.threshold;if(r<=0||e<r)return;this._stacks||(this._stacks=new Map);let i=this._stacks.get(t.value)||0;if(this._stacks.set(t.value,i+1),this._warnCountdown-=1,this._warnCountdown<=0){this._warnCountdown=r*.5;let[o,s]=this.getMostFrequentStack(),a=`[${this.name}] potential listener LEAK detected, having ${e} listeners already. MOST frequent listener (${s}):`;console.warn(a),console.warn(o);let l=new Qm(a,o);this._errorHandler(l)}return()=>{let o=this._stacks.get(t.value)||0;this._stacks.set(t.value,o-1)}}getMostFrequentStack(){if(!this._stacks)return;let t,e=0;for(let[r,i]of this._stacks)(!t||e<i)&&(t=[r,i],e=i);return t}},Cl=class n{constructor(t){this.value=t}static create(){let t=new Error;return new n(t.stack??"")}print(){console.warn(this.value.split(`
`).slice(2).join(`
`))}},Qm=class extends Error{constructor(t,e){super(t),this.name="ListenerLeakError",this.stack=e}},Ym=class extends Error{constructor(t,e){super(t),this.name="ListenerRefusalError",this.stack=e}},sE=0,ps=class{constructor(t){this.value=t}stack;id=sE++},aE=2,lE=(n,t)=>{if(n instanceof ps)t(n);else for(let e=0;e<n.length;e++){let r=n[e];r&&t(r)}},zd;if(iE){let n=[];setInterval(()=>{n.length!==0&&(console.warn("[LEAKING LISTENERS] GC'ed these listeners that were NOT yet disposed:"),console.warn(n.join(`
`)),n.length=0)},3e3),zd=new FinalizationRegistry(t=>{typeof t=="string"&&n.push(t)})}var S=class{_options;_leakageMon;_perfMon;_disposed;_event;_listeners;_deliveryQueue;_size=0;constructor(t){this._options=t,this._leakageMon=nI>0||this._options?.leakWarningThreshold?new Jm(t?.onListenerError??Je,this._options?.leakWarningThreshold??nI):void 0,this._perfMon=this._options?._profName?new Gm(this._options._profName):void 0,this._deliveryQueue=this._options?.deliveryQueue}dispose(){if(!this._disposed){if(this._disposed=!0,this._deliveryQueue?.current===this&&this._deliveryQueue.reset(),this._listeners){if(rI){let t=this._listeners;queueMicrotask(()=>{lE(t,e=>e.stack?.print())})}this._listeners=void 0,this._size=0}this._options?.onDidRemoveLastListener?.(),this._leakageMon?.dispose()}}get event(){return this._event??=(t,e,r)=>{if(this._leakageMon&&this._size>this._leakageMon.threshold**2){let l=`[${this._leakageMon.name}] REFUSES to accept new listeners because it exceeded its threshold by far (${this._size} vs ${this._leakageMon.threshold})`;console.warn(l);let c=this._leakageMon.getMostFrequentStack()??["UNKNOWN stack",-1],d=new Ym(`${l}. HINT: Stack shows most frequent listener (${c[1]}-times)`,c[0]);return(this._options?.onListenerError||Je)(d),D.None}if(this._disposed)return D.None;e&&(t=t.bind(e));let i=new ps(t),o,s;this._leakageMon&&this._size>=Math.ceil(this._leakageMon.threshold*.2)&&(i.stack=Cl.create(),o=this._leakageMon.check(i.stack,this._size+1)),rI&&(i.stack=s??Cl.create()),this._listeners?this._listeners instanceof ps?(this._deliveryQueue??=new Xm,this._listeners=[this._listeners,i]):this._listeners.push(i):(this._options?.onWillAddFirstListener?.(this),this._listeners=i,this._options?.onDidAddFirstListener?.(this)),this._size++;let a=$(()=>{zd?.unregister(a),o?.(),this._removeListener(i)});if(r instanceof Y?r.add(a):Array.isArray(r)&&r.push(a),zd){let l=new Error().stack.split(`
`).slice(2,3).join(`
`).trim(),c=/(file:|vscode-file:\/\/vscode-app)?(\/[^:]*:\d+:\d+)/.exec(l);zd.register(a,c?.[2]??l,a)}return a},this._event}_removeListener(t){if(this._options?.onWillRemoveListener?.(this),!this._listeners)return;if(this._size===1){this._listeners=void 0,this._options?.onDidRemoveLastListener?.(this),this._size=0;return}let e=this._listeners,r=e.indexOf(t);if(r===-1)throw console.log("disposed?",this._disposed),console.log("size?",this._size),console.log("arr?",JSON.stringify(this._listeners)),new Error("Attempted to dispose unknown listener");this._size--,e[r]=void 0;let i=this._deliveryQueue.current===this;if(this._size*aE<=e.length){let o=0;for(let s=0;s<e.length;s++)e[s]?e[o++]=e[s]:i&&(this._deliveryQueue.end--,o<this._deliveryQueue.i&&this._deliveryQueue.i--);e.length=o}}_deliver(t,e){if(!t)return;let r=this._options?.onListenerError||Je;if(!r){t.value(e);return}try{t.value(e)}catch(i){r(i)}}_deliverQueue(t){let e=t.current._listeners;for(;t.i<t.end;)this._deliver(e[t.i++],t.value);t.reset()}fire(t){if(this._deliveryQueue?.current&&(this._deliverQueue(this._deliveryQueue),this._perfMon?.stop()),this._perfMon?.start(this._size),this._listeners)if(this._listeners instanceof ps)this._deliver(this._listeners,t);else{let e=this._deliveryQueue;e.enqueue(this,t,this._listeners.length),this._deliverQueue(e)}this._perfMon?.stop()}hasListeners(){return this._size>0}};var Xm=class{i=-1;end=0;current;value;enqueue(t,e,r){this.i=0,this.end=r,this.current=t,this.value=e}reset(){this.i=this.end,this.current=void 0,this.value=void 0}};var wo=class extends S{_isPaused=0;_eventQueue=new Pi;_mergeFn;get isPaused(){return this._isPaused!==0}constructor(t){super(t),this._mergeFn=t?.merge}pause(){this._isPaused++}resume(){if(this._isPaused!==0&&--this._isPaused===0)if(this._mergeFn){if(this._eventQueue.size>0){let t=Array.from(this._eventQueue);this._eventQueue.clear(),super.fire(this._mergeFn(t))}}else for(;!this._isPaused&&this._eventQueue.size!==0;)super.fire(this._eventQueue.shift())}fire(t){this._size&&(this._isPaused!==0?this._eventQueue.push(t):super.fire(t))}};var qd=class{emitter;hasListeners=!1;events=[];constructor(){this.emitter=new S({onWillAddFirstListener:()=>this.onFirstListenerAdd(),onDidRemoveLastListener:()=>this.onLastListenerRemove()})}get event(){return this.emitter.event}add(t){let e={event:t,listener:null};return this.events.push(e),this.hasListeners&&this.hook(e),$(as(()=>{this.hasListeners&&this.unhook(e);let i=this.events.indexOf(e);this.events.splice(i,1)}))}onFirstListenerAdd(){this.hasListeners=!0,this.events.forEach(t=>this.hook(t))}onLastListenerRemove(){this.hasListeners=!1,this.events.forEach(t=>this.unhook(t))}hook(t){t.listener=t.event(e=>this.emitter.fire(e))}unhook(t){t.listener?.dispose(),t.listener=null}dispose(){this.emitter.dispose();for(let t of this.events)t.listener?.dispose();this.events=[]}};var kl=class{listening=!1;inputEvent=E.None;inputEventListener=D.None;emitter=new S({onDidAddFirstListener:()=>{this.listening=!0,this.inputEventListener=this.inputEvent(this.emitter.fire,this.emitter)},onDidRemoveLastListener:()=>{this.listening=!1,this.inputEventListener.dispose()}});event=this.emitter.event;set input(t){this.inputEvent=t,this.listening&&(this.inputEventListener.dispose(),this.inputEventListener=t(this.emitter.fire,this.emitter))}dispose(){this.inputEventListener.dispose(),this.emitter.dispose()}};var iI=Object.freeze(function(n,t){let e=setTimeout(n.bind(t),0);return{dispose(){clearTimeout(e)}}}),we;(r=>{function n(i){return i===r.None||i===r.Cancelled||i instanceof fs?!0:!i||typeof i!="object"?!1:typeof i.isCancellationRequested=="boolean"&&typeof i.onCancellationRequested=="function"}r.isCancellationToken=n,r.None=Object.freeze({isCancellationRequested:!1,onCancellationRequested:E.None}),r.Cancelled=Object.freeze({isCancellationRequested:!0,onCancellationRequested:iI})})(we||={});var fs=class{_isCancelled=!1;_emitter=null;cancel(){this._isCancelled||(this._isCancelled=!0,this._emitter&&(this._emitter.fire(void 0),this.dispose()))}get isCancellationRequested(){return this._isCancelled}get onCancellationRequested(){return this._isCancelled?iI:(this._emitter||(this._emitter=new S),this._emitter.event)}dispose(){this._emitter&&(this._emitter.dispose(),this._emitter=null)}},rt=class{_token=void 0;_parentListener=void 0;constructor(t){this._parentListener=t&&t.onCancellationRequested(this.cancel,this)}get token(){return this._token||(this._token=new fs),this._token}cancel(){this._token?this._token instanceof fs&&this._token.cancel():this._token=we.Cancelled}dispose(t=!1){t&&this.cancel(),this._parentListener?.dispose(),this._token?this._token instanceof fs&&this._token.dispose():this._token=we.None}};function Xn(n,t,e=(r,i)=>r===i){if(n===t)return!0;if(!n||!t||n.length!==t.length)return!1;for(let r=0,i=n.length;r<i;r++)if(!e(n[r],t[r]))return!1;return!0}function sI(n,t,e){if(e===0)return[];let r=n.slice(0,e).sort(t);return cE(n,t,r,e,n.length),r}function cE(n,t,e,r,i){for(let o=e.length;r<i;r++){let s=n[r];if(t(s,e[o-1])<0){e.pop();let a=Py(e,l=>t(s,l)<0);e.splice(a,0,s)}}}function Ye(n){return n.filter(t=>!!t)}function Qt(n,t=e=>e){let e=new Set;return n.filter(r=>{let i=t(r);return e.has(i)?!1:(e.add(i),!0)})}function Zm(n,t){return n.push(t),()=>dE(n,t)}function dE(n,t){let e=n.indexOf(t);if(e>-1)return n.splice(e,1),t}function eh(n,t){let e;if(typeof t=="number"){let r=t;e=()=>{let i=Math.sin(r++)*179426549;return i-Math.floor(i)}}else e=Math.random;for(let r=n.length-1;r>0;r-=1){let i=Math.floor(e()*(r+1)),o=n[r];n[r]=n[i],n[i]=o}}function aI(n){return n[Math.floor(Math.random()*n.length)]}var lI;(a=>{function n(l){return l<0}a.isLessThan=n;function t(l){return l<=0}a.isLessThanOrEqual=t;function e(l){return l>0}a.isGreaterThan=e;function r(l){return l===0}a.isNeitherLessOrGreaterThan=r,a.greaterThan=1,a.lessThan=-1,a.neitherLessOrGreaterThan=0})(lI||={});var oI=class n{constructor(t){this.iterate=t}static empty=new n(t=>{});forEach(t){this.iterate(e=>(t(e),!0))}toArray(){let t=[];return this.iterate(e=>(t.push(e),!0)),t}filter(t){return new n(e=>this.iterate(r=>t(r)?e(r):!0))}map(t){return new n(e=>this.iterate(r=>e(t(r))))}some(t){let e=!1;return this.iterate(r=>(e=t(r),!e)),e}findFirst(t){let e;return this.iterate(r=>t(r)?(e=r,!1):!0),e}findLast(t){let e;return this.iterate(r=>(t(r)&&(e=r),!0)),e}findLastMaxBy(t){let e,r=!0;return this.iterate(i=>((r||lI.isGreaterThan(t(i,e)))&&(r=!1,e=i),!0)),e}};function cI(n){let t=!1,e=new Map,r=new Map;if(uE(n,d=>{if(n===d)return!0;let u=JSON.stringify(d);if(u.length<30)return!0;let m=e.get(u);if(!m){let h={schemas:[d]};return e.set(u,h),r.set(d,h),!0}return m.schemas.push(d),r.set(d,m),t=!0,!1}),e.clear(),!t)return JSON.stringify(n);let o="$defs";for(;n.hasOwnProperty(o);)o+="_";let s=[];function a(d){return JSON.stringify(d,(u,m)=>{if(m!==d){let h=r.get(m);if(h&&h.schemas.length>1)return h.id||(h.id=`_${s.length}`,s.push(h.schemas[0])),{$ref:`#/${o}/${h.id}`}}return m})}let l=a(n),c=[];for(let d=0;d<s.length;d++)c.push(`"_${d}":${a(s[d])}`);return c.length?`${l.substring(0,l.length-1)},"${o}":{${c.join(",")}}}`:l}function ms(n){return typeof n=="object"&&n!==null}function uE(n,t){if(!n||typeof n!="object")return;let e=(...l)=>{for(let c of l)ms(c)&&s.push(c)},r=(...l)=>{for(let c of l)if(ms(c))for(let d in c){let u=c[d];ms(u)&&s.push(u)}},i=(...l)=>{for(let c of l)if(Array.isArray(c))for(let d of c)ms(d)&&s.push(d)},o=l=>{if(Array.isArray(l))for(let c of l)ms(c)&&s.push(c);else ms(l)&&s.push(l)},s=[n],a=s.pop();for(;a;)t(a)&&(e(a.additionalItems,a.additionalProperties,a.not,a.contains,a.propertyNames,a.if,a.then,a.else,a.unevaluatedItems,a.unevaluatedProperties),r(a.definitions,a.$defs,a.properties,a.patternProperties,a.dependencies,a.dependentSchemas),i(a.anyOf,a.allOf,a.oneOf,a.prefixItems),o(a.items)),a=s.pop()}function ke(n){return typeof n=="string"}function qe(n){return typeof n=="object"&&n!==null&&!Array.isArray(n)&&!(n instanceof RegExp)&&!(n instanceof Date)}function dI(n){let t=Object.getPrototypeOf(Uint8Array);return typeof n=="object"&&n instanceof t}function Ci(n){return typeof n=="number"&&!isNaN(n)}function $d(n){return n===!0||n===!1}function Gr(n){return typeof n>"u"}function ct(n){return Gr(n)||n===null}function th(n,t){if(!n)throw new Error(t?`Unexpected type, expected '${t}'`:"Unexpected type")}function Zn(n){if(ct(n))throw new Error("Assertion Failed: argument is undefined or null");return n}var pE=Object.prototype.hasOwnProperty;function hs(n){if(!qe(n))return!1;for(let t in n)if(pE.call(n,t))return!1;return!0}function jd(n){return typeof n=="function"}function uI(n,t){let e=Math.min(n.length,t.length);for(let r=0;r<e;r++)fE(n[r],t[r])}function fE(n,t){if(ke(t)){if(typeof n!==t)throw new Error(`argument does not match constraint: typeof ${t}`)}else if(jd(t)){try{if(n instanceof t)return}catch{}if(!ct(n)&&n.constructor===t||t.length===1&&t.call(void 0,n)===!0)return;throw new Error("argument does not match one of these constraints: arg instanceof constraint, arg.constructor === constraint, nor constraint(arg) === true")}}var le=class{ctor;staticArguments;supportsDelayedInstantiation;constructor(t,e=[],r=!1){this.ctor=t,this.staticArguments=e,this.supportsDelayedInstantiation=r}};var ki=class{_entries=new Map;constructor(...t){for(let[e,r]of t)this.set(e,r)}set(t,e){let r=this._entries.get(t);return this._entries.set(t,e),r}has(t){return this._entries.has(t)}get(t){return this._entries.get(t)}};var ln;(i=>{i.serviceIds=new Map,i.DI_TARGET="$di$target",i.DI_DEPENDENCIES="$di$dependencies";function r(o){return o[i.DI_DEPENDENCIES]||[]}i.getServiceDependencies=r})(ln||={});var Yt=F("instantiationService");function mE(n,t,e){t[ln.DI_TARGET]===t?t[ln.DI_DEPENDENCIES].push({id:n,index:e}):(t[ln.DI_DEPENDENCIES]=[{id:n,index:e}],t[ln.DI_TARGET]=t)}function F(n){if(ln.serviceIds.has(n))return ln.serviceIds.get(n);let t=function(e,r,i){if(arguments.length!==3)throw new Error("@IServiceName-decorator can only be used to decorate a parameter");mE(t,e,i)};return t.toString=()=>n,ln.serviceIds.set(n,t),t}function hE(n){return n}var Gd=class{lastCache=void 0;lastArgKey=void 0;_fn;_computeKey;constructor(t,e){typeof t=="function"?(this._fn=t,this._computeKey=hE):(this._fn=e,this._computeKey=t.getCacheKey)}get(t){let e=this._computeKey(t);return this.lastArgKey!==e&&(this.lastArgKey=e,this.lastCache=this._fn(t)),this.lastCache}};var Ir=class{constructor(t){this.executor=t}_didRun=!1;_value;_error;get hasValue(){return this._didRun}get value(){if(!this._didRun)try{this._value=this.executor()}catch(t){this._error=t}finally{this._didRun=!0}if(this._error)throw this._error;return this._value}get rawValue(){return this._value}};function mI(n){return!n||typeof n!="string"?!0:n.trim().length===0}function ei(n){return n.replace(/[\\\{\}\*\+\?\|\^\$\.\[\]\(\)]/g,"\\$&")}function rh(n,t=" "){let e=Jd(n,t);return cn(e,t)}function Jd(n,t){if(!n||!t)return n;let e=t.length;if(e===0||n.length===0)return n;let r=0;for(;n.indexOf(t,r)===r;)r=r+e;return n.substring(r)}function cn(n,t){if(!n||!t)return n;let e=t.length,r=n.length;if(e===0||r===0)return n;let i=r,o=-1;for(;o=n.lastIndexOf(t,i-1),!(o===-1||o+e!==i);){if(o===0)return"";i=o}return n.substring(0,i)}function _l(n,t){return n<t?-1:n>t?1:0}function Qd(n,t,e=0,r=n.length,i=0,o=t.length){for(;e<r&&i<o;e++,i++){let l=n.charCodeAt(e),c=t.charCodeAt(i);if(l<c)return-1;if(l>c)return 1}let s=r-e,a=o-i;return s<a?-1:s>a?1:0}function Rl(n,t){return vs(n,t,0,n.length,0,t.length)}function vs(n,t,e=0,r=n.length,i=0,o=t.length){for(;e<r&&i<o;e++,i++){let l=n.charCodeAt(e),c=t.charCodeAt(i);if(l===c)continue;if(l>=128||c>=128)return Qd(n.toLowerCase(),t.toLowerCase(),e,r,i,o);pI(l)&&(l-=32),pI(c)&&(c-=32);let d=l-c;if(d!==0)return d}let s=r-e,a=o-i;return s<a?-1:s>a?1:0}function pI(n){return n>=97&&n<=122}function nh(n){return n>=65&&n<=90}function Wr(n,t){return n.length===t.length&&vs(n,t)===0}function En(n,t){let e=t.length;return t.length>n.length?!1:vs(n,t,0,e)===0}function hI(n){return 55296<=n&&n<=56319}function ih(n){return 56320<=n&&n<=57343}function gI(n,t){return(n-55296<<10)+(t-56320)+65536}var LL=String.fromCharCode(65279);var fI=class n{constructor(t){this.confusableDictionary=t}static ambiguousCharacterData=new Ir(()=>JSON.parse('{"_common":[8232,32,8233,32,5760,32,8192,32,8193,32,8194,32,8195,32,8196,32,8197,32,8198,32,8200,32,8201,32,8202,32,8287,32,8199,32,8239,32,2042,95,65101,95,65102,95,65103,95,8208,45,8209,45,8210,45,65112,45,1748,45,8259,45,727,45,8722,45,10134,45,11450,45,1549,44,1643,44,8218,44,184,44,42233,44,894,59,2307,58,2691,58,1417,58,1795,58,1796,58,5868,58,65072,58,6147,58,6153,58,8282,58,1475,58,760,58,42889,58,8758,58,720,58,42237,58,451,33,11601,33,660,63,577,63,2429,63,5038,63,42731,63,119149,46,8228,46,1793,46,1794,46,42510,46,68176,46,1632,46,1776,46,42232,46,1373,96,65287,96,8219,96,8242,96,1370,96,1523,96,8175,96,65344,96,900,96,8189,96,8125,96,8127,96,8190,96,697,96,884,96,712,96,714,96,715,96,756,96,699,96,701,96,700,96,702,96,42892,96,1497,96,2036,96,2037,96,5194,96,5836,96,94033,96,94034,96,65339,91,10088,40,10098,40,12308,40,64830,40,65341,93,10089,41,10099,41,12309,41,64831,41,10100,123,119060,123,10101,125,65342,94,8270,42,1645,42,8727,42,66335,42,5941,47,8257,47,8725,47,8260,47,9585,47,10187,47,10744,47,119354,47,12755,47,12339,47,11462,47,20031,47,12035,47,65340,92,65128,92,8726,92,10189,92,10741,92,10745,92,119311,92,119355,92,12756,92,20022,92,12034,92,42872,38,708,94,710,94,5869,43,10133,43,66203,43,8249,60,10094,60,706,60,119350,60,5176,60,5810,60,5120,61,11840,61,12448,61,42239,61,8250,62,10095,62,707,62,119351,62,5171,62,94015,62,8275,126,732,126,8128,126,8764,126,65372,124,65293,45,120784,50,120794,50,120804,50,120814,50,120824,50,130034,50,42842,50,423,50,1000,50,42564,50,5311,50,42735,50,119302,51,120785,51,120795,51,120805,51,120815,51,120825,51,130035,51,42923,51,540,51,439,51,42858,51,11468,51,1248,51,94011,51,71882,51,120786,52,120796,52,120806,52,120816,52,120826,52,130036,52,5070,52,71855,52,120787,53,120797,53,120807,53,120817,53,120827,53,130037,53,444,53,71867,53,120788,54,120798,54,120808,54,120818,54,120828,54,130038,54,11474,54,5102,54,71893,54,119314,55,120789,55,120799,55,120809,55,120819,55,120829,55,130039,55,66770,55,71878,55,2819,56,2538,56,2666,56,125131,56,120790,56,120800,56,120810,56,120820,56,120830,56,130040,56,547,56,546,56,66330,56,2663,57,2920,57,2541,57,3437,57,120791,57,120801,57,120811,57,120821,57,120831,57,130041,57,42862,57,11466,57,71884,57,71852,57,71894,57,9082,97,65345,97,119834,97,119886,97,119938,97,119990,97,120042,97,120094,97,120146,97,120198,97,120250,97,120302,97,120354,97,120406,97,120458,97,593,97,945,97,120514,97,120572,97,120630,97,120688,97,120746,97,65313,65,119808,65,119860,65,119912,65,119964,65,120016,65,120068,65,120120,65,120172,65,120224,65,120276,65,120328,65,120380,65,120432,65,913,65,120488,65,120546,65,120604,65,120662,65,120720,65,5034,65,5573,65,42222,65,94016,65,66208,65,119835,98,119887,98,119939,98,119991,98,120043,98,120095,98,120147,98,120199,98,120251,98,120303,98,120355,98,120407,98,120459,98,388,98,5071,98,5234,98,5551,98,65314,66,8492,66,119809,66,119861,66,119913,66,120017,66,120069,66,120121,66,120173,66,120225,66,120277,66,120329,66,120381,66,120433,66,42932,66,914,66,120489,66,120547,66,120605,66,120663,66,120721,66,5108,66,5623,66,42192,66,66178,66,66209,66,66305,66,65347,99,8573,99,119836,99,119888,99,119940,99,119992,99,120044,99,120096,99,120148,99,120200,99,120252,99,120304,99,120356,99,120408,99,120460,99,7428,99,1010,99,11429,99,43951,99,66621,99,128844,67,71922,67,71913,67,65315,67,8557,67,8450,67,8493,67,119810,67,119862,67,119914,67,119966,67,120018,67,120174,67,120226,67,120278,67,120330,67,120382,67,120434,67,1017,67,11428,67,5087,67,42202,67,66210,67,66306,67,66581,67,66844,67,8574,100,8518,100,119837,100,119889,100,119941,100,119993,100,120045,100,120097,100,120149,100,120201,100,120253,100,120305,100,120357,100,120409,100,120461,100,1281,100,5095,100,5231,100,42194,100,8558,68,8517,68,119811,68,119863,68,119915,68,119967,68,120019,68,120071,68,120123,68,120175,68,120227,68,120279,68,120331,68,120383,68,120435,68,5024,68,5598,68,5610,68,42195,68,8494,101,65349,101,8495,101,8519,101,119838,101,119890,101,119942,101,120046,101,120098,101,120150,101,120202,101,120254,101,120306,101,120358,101,120410,101,120462,101,43826,101,1213,101,8959,69,65317,69,8496,69,119812,69,119864,69,119916,69,120020,69,120072,69,120124,69,120176,69,120228,69,120280,69,120332,69,120384,69,120436,69,917,69,120492,69,120550,69,120608,69,120666,69,120724,69,11577,69,5036,69,42224,69,71846,69,71854,69,66182,69,119839,102,119891,102,119943,102,119995,102,120047,102,120099,102,120151,102,120203,102,120255,102,120307,102,120359,102,120411,102,120463,102,43829,102,42905,102,383,102,7837,102,1412,102,119315,70,8497,70,119813,70,119865,70,119917,70,120021,70,120073,70,120125,70,120177,70,120229,70,120281,70,120333,70,120385,70,120437,70,42904,70,988,70,120778,70,5556,70,42205,70,71874,70,71842,70,66183,70,66213,70,66853,70,65351,103,8458,103,119840,103,119892,103,119944,103,120048,103,120100,103,120152,103,120204,103,120256,103,120308,103,120360,103,120412,103,120464,103,609,103,7555,103,397,103,1409,103,119814,71,119866,71,119918,71,119970,71,120022,71,120074,71,120126,71,120178,71,120230,71,120282,71,120334,71,120386,71,120438,71,1292,71,5056,71,5107,71,42198,71,65352,104,8462,104,119841,104,119945,104,119997,104,120049,104,120101,104,120153,104,120205,104,120257,104,120309,104,120361,104,120413,104,120465,104,1211,104,1392,104,5058,104,65320,72,8459,72,8460,72,8461,72,119815,72,119867,72,119919,72,120023,72,120179,72,120231,72,120283,72,120335,72,120387,72,120439,72,919,72,120494,72,120552,72,120610,72,120668,72,120726,72,11406,72,5051,72,5500,72,42215,72,66255,72,731,105,9075,105,65353,105,8560,105,8505,105,8520,105,119842,105,119894,105,119946,105,119998,105,120050,105,120102,105,120154,105,120206,105,120258,105,120310,105,120362,105,120414,105,120466,105,120484,105,618,105,617,105,953,105,8126,105,890,105,120522,105,120580,105,120638,105,120696,105,120754,105,1110,105,42567,105,1231,105,43893,105,5029,105,71875,105,65354,106,8521,106,119843,106,119895,106,119947,106,119999,106,120051,106,120103,106,120155,106,120207,106,120259,106,120311,106,120363,106,120415,106,120467,106,1011,106,1112,106,65322,74,119817,74,119869,74,119921,74,119973,74,120025,74,120077,74,120129,74,120181,74,120233,74,120285,74,120337,74,120389,74,120441,74,42930,74,895,74,1032,74,5035,74,5261,74,42201,74,119844,107,119896,107,119948,107,120000,107,120052,107,120104,107,120156,107,120208,107,120260,107,120312,107,120364,107,120416,107,120468,107,8490,75,65323,75,119818,75,119870,75,119922,75,119974,75,120026,75,120078,75,120130,75,120182,75,120234,75,120286,75,120338,75,120390,75,120442,75,922,75,120497,75,120555,75,120613,75,120671,75,120729,75,11412,75,5094,75,5845,75,42199,75,66840,75,1472,108,8739,73,9213,73,65512,73,1633,108,1777,73,66336,108,125127,108,120783,73,120793,73,120803,73,120813,73,120823,73,130033,73,65321,73,8544,73,8464,73,8465,73,119816,73,119868,73,119920,73,120024,73,120128,73,120180,73,120232,73,120284,73,120336,73,120388,73,120440,73,65356,108,8572,73,8467,108,119845,108,119897,108,119949,108,120001,108,120053,108,120105,73,120157,73,120209,73,120261,73,120313,73,120365,73,120417,73,120469,73,448,73,120496,73,120554,73,120612,73,120670,73,120728,73,11410,73,1030,73,1216,73,1493,108,1503,108,1575,108,126464,108,126592,108,65166,108,65165,108,1994,108,11599,73,5825,73,42226,73,93992,73,66186,124,66313,124,119338,76,8556,76,8466,76,119819,76,119871,76,119923,76,120027,76,120079,76,120131,76,120183,76,120235,76,120287,76,120339,76,120391,76,120443,76,11472,76,5086,76,5290,76,42209,76,93974,76,71843,76,71858,76,66587,76,66854,76,65325,77,8559,77,8499,77,119820,77,119872,77,119924,77,120028,77,120080,77,120132,77,120184,77,120236,77,120288,77,120340,77,120392,77,120444,77,924,77,120499,77,120557,77,120615,77,120673,77,120731,77,1018,77,11416,77,5047,77,5616,77,5846,77,42207,77,66224,77,66321,77,119847,110,119899,110,119951,110,120003,110,120055,110,120107,110,120159,110,120211,110,120263,110,120315,110,120367,110,120419,110,120471,110,1400,110,1404,110,65326,78,8469,78,119821,78,119873,78,119925,78,119977,78,120029,78,120081,78,120185,78,120237,78,120289,78,120341,78,120393,78,120445,78,925,78,120500,78,120558,78,120616,78,120674,78,120732,78,11418,78,42208,78,66835,78,3074,111,3202,111,3330,111,3458,111,2406,111,2662,111,2790,111,3046,111,3174,111,3302,111,3430,111,3664,111,3792,111,4160,111,1637,111,1781,111,65359,111,8500,111,119848,111,119900,111,119952,111,120056,111,120108,111,120160,111,120212,111,120264,111,120316,111,120368,111,120420,111,120472,111,7439,111,7441,111,43837,111,959,111,120528,111,120586,111,120644,111,120702,111,120760,111,963,111,120532,111,120590,111,120648,111,120706,111,120764,111,11423,111,4351,111,1413,111,1505,111,1607,111,126500,111,126564,111,126596,111,65259,111,65260,111,65258,111,65257,111,1726,111,64428,111,64429,111,64427,111,64426,111,1729,111,64424,111,64425,111,64423,111,64422,111,1749,111,3360,111,4125,111,66794,111,71880,111,71895,111,66604,111,1984,79,2534,79,2918,79,12295,79,70864,79,71904,79,120782,79,120792,79,120802,79,120812,79,120822,79,130032,79,65327,79,119822,79,119874,79,119926,79,119978,79,120030,79,120082,79,120134,79,120186,79,120238,79,120290,79,120342,79,120394,79,120446,79,927,79,120502,79,120560,79,120618,79,120676,79,120734,79,11422,79,1365,79,11604,79,4816,79,2848,79,66754,79,42227,79,71861,79,66194,79,66219,79,66564,79,66838,79,9076,112,65360,112,119849,112,119901,112,119953,112,120005,112,120057,112,120109,112,120161,112,120213,112,120265,112,120317,112,120369,112,120421,112,120473,112,961,112,120530,112,120544,112,120588,112,120602,112,120646,112,120660,112,120704,112,120718,112,120762,112,120776,112,11427,112,65328,80,8473,80,119823,80,119875,80,119927,80,119979,80,120031,80,120083,80,120187,80,120239,80,120291,80,120343,80,120395,80,120447,80,929,80,120504,80,120562,80,120620,80,120678,80,120736,80,11426,80,5090,80,5229,80,42193,80,66197,80,119850,113,119902,113,119954,113,120006,113,120058,113,120110,113,120162,113,120214,113,120266,113,120318,113,120370,113,120422,113,120474,113,1307,113,1379,113,1382,113,8474,81,119824,81,119876,81,119928,81,119980,81,120032,81,120084,81,120188,81,120240,81,120292,81,120344,81,120396,81,120448,81,11605,81,119851,114,119903,114,119955,114,120007,114,120059,114,120111,114,120163,114,120215,114,120267,114,120319,114,120371,114,120423,114,120475,114,43847,114,43848,114,7462,114,11397,114,43905,114,119318,82,8475,82,8476,82,8477,82,119825,82,119877,82,119929,82,120033,82,120189,82,120241,82,120293,82,120345,82,120397,82,120449,82,422,82,5025,82,5074,82,66740,82,5511,82,42211,82,94005,82,65363,115,119852,115,119904,115,119956,115,120008,115,120060,115,120112,115,120164,115,120216,115,120268,115,120320,115,120372,115,120424,115,120476,115,42801,115,445,115,1109,115,43946,115,71873,115,66632,115,65331,83,119826,83,119878,83,119930,83,119982,83,120034,83,120086,83,120138,83,120190,83,120242,83,120294,83,120346,83,120398,83,120450,83,1029,83,1359,83,5077,83,5082,83,42210,83,94010,83,66198,83,66592,83,119853,116,119905,116,119957,116,120009,116,120061,116,120113,116,120165,116,120217,116,120269,116,120321,116,120373,116,120425,116,120477,116,8868,84,10201,84,128872,84,65332,84,119827,84,119879,84,119931,84,119983,84,120035,84,120087,84,120139,84,120191,84,120243,84,120295,84,120347,84,120399,84,120451,84,932,84,120507,84,120565,84,120623,84,120681,84,120739,84,11430,84,5026,84,42196,84,93962,84,71868,84,66199,84,66225,84,66325,84,119854,117,119906,117,119958,117,120010,117,120062,117,120114,117,120166,117,120218,117,120270,117,120322,117,120374,117,120426,117,120478,117,42911,117,7452,117,43854,117,43858,117,651,117,965,117,120534,117,120592,117,120650,117,120708,117,120766,117,1405,117,66806,117,71896,117,8746,85,8899,85,119828,85,119880,85,119932,85,119984,85,120036,85,120088,85,120140,85,120192,85,120244,85,120296,85,120348,85,120400,85,120452,85,1357,85,4608,85,66766,85,5196,85,42228,85,94018,85,71864,85,8744,118,8897,118,65366,118,8564,118,119855,118,119907,118,119959,118,120011,118,120063,118,120115,118,120167,118,120219,118,120271,118,120323,118,120375,118,120427,118,120479,118,7456,118,957,118,120526,118,120584,118,120642,118,120700,118,120758,118,1141,118,1496,118,71430,118,43945,118,71872,118,119309,86,1639,86,1783,86,8548,86,119829,86,119881,86,119933,86,119985,86,120037,86,120089,86,120141,86,120193,86,120245,86,120297,86,120349,86,120401,86,120453,86,1140,86,11576,86,5081,86,5167,86,42719,86,42214,86,93960,86,71840,86,66845,86,623,119,119856,119,119908,119,119960,119,120012,119,120064,119,120116,119,120168,119,120220,119,120272,119,120324,119,120376,119,120428,119,120480,119,7457,119,1121,119,1309,119,1377,119,71434,119,71438,119,71439,119,43907,119,71919,87,71910,87,119830,87,119882,87,119934,87,119986,87,120038,87,120090,87,120142,87,120194,87,120246,87,120298,87,120350,87,120402,87,120454,87,1308,87,5043,87,5076,87,42218,87,5742,120,10539,120,10540,120,10799,120,65368,120,8569,120,119857,120,119909,120,119961,120,120013,120,120065,120,120117,120,120169,120,120221,120,120273,120,120325,120,120377,120,120429,120,120481,120,5441,120,5501,120,5741,88,9587,88,66338,88,71916,88,65336,88,8553,88,119831,88,119883,88,119935,88,119987,88,120039,88,120091,88,120143,88,120195,88,120247,88,120299,88,120351,88,120403,88,120455,88,42931,88,935,88,120510,88,120568,88,120626,88,120684,88,120742,88,11436,88,11613,88,5815,88,42219,88,66192,88,66228,88,66327,88,66855,88,611,121,7564,121,65369,121,119858,121,119910,121,119962,121,120014,121,120066,121,120118,121,120170,121,120222,121,120274,121,120326,121,120378,121,120430,121,120482,121,655,121,7935,121,43866,121,947,121,8509,121,120516,121,120574,121,120632,121,120690,121,120748,121,1199,121,4327,121,71900,121,65337,89,119832,89,119884,89,119936,89,119988,89,120040,89,120092,89,120144,89,120196,89,120248,89,120300,89,120352,89,120404,89,120456,89,933,89,978,89,120508,89,120566,89,120624,89,120682,89,120740,89,11432,89,1198,89,5033,89,5053,89,42220,89,94019,89,71844,89,66226,89,119859,122,119911,122,119963,122,120015,122,120067,122,120119,122,120171,122,120223,122,120275,122,120327,122,120379,122,120431,122,120483,122,7458,122,43923,122,71876,122,66293,90,71909,90,65338,90,8484,90,8488,90,119833,90,119885,90,119937,90,119989,90,120041,90,120197,90,120249,90,120301,90,120353,90,120405,90,120457,90,918,90,120493,90,120551,90,120609,90,120667,90,120725,90,5059,90,42204,90,71849,90,65282,34,65284,36,65285,37,65286,38,65290,42,65291,43,65294,46,65295,47,65296,48,65297,49,65298,50,65299,51,65300,52,65301,53,65302,54,65303,55,65304,56,65305,57,65308,60,65309,61,65310,62,65312,64,65316,68,65318,70,65319,71,65324,76,65329,81,65330,82,65333,85,65334,86,65335,87,65343,95,65346,98,65348,100,65350,102,65355,107,65357,109,65358,110,65361,113,65362,114,65364,116,65365,117,65367,119,65370,122,65371,123,65373,125,119846,109],"_default":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"cs":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"de":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"es":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"fr":[65374,126,65306,58,65281,33,8216,96,8245,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"it":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ja":[8211,45,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65292,44,65307,59],"ko":[8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pl":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"pt-BR":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"qps-ploc":[160,32,8211,45,65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"ru":[65374,126,65306,58,65281,33,8216,96,8217,96,8245,96,180,96,12494,47,305,105,921,73,1009,112,215,120,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"tr":[160,32,8211,45,65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65288,40,65289,41,65292,44,65307,59,65311,63],"zh-hans":[65374,126,65306,58,65281,33,8245,96,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65288,40,65289,41],"zh-hant":[8211,45,65374,126,180,96,12494,47,1047,51,1073,54,1072,97,1040,65,1068,98,1042,66,1089,99,1057,67,1077,101,1045,69,1053,72,305,105,1050,75,921,73,1052,77,1086,111,1054,79,1009,112,1088,112,1056,80,1075,114,1058,84,215,120,1093,120,1061,88,1091,121,1059,89,65283,35,65307,59]}'));static cache=new Gd({getCacheKey:JSON.stringify},t=>{function e(d){let u=new Map;for(let m=0;m<d.length;m+=2)u.set(d[m],d[m+1]);return u}function r(d,u){let m=new Map(d);for(let[h,y]of u)m.set(h,y);return m}function i(d,u){if(!d)return u;let m=new Map;for(let[h,y]of d)u.has(h)&&m.set(h,y);return m}let o=this.ambiguousCharacterData.value,s=t.filter(d=>!d.startsWith("_")&&d in o);s.length===0&&(s=["_default"]);let a;for(let d of s){let u=e(o[d]);a=i(a,u)}let l=e(o._common),c=r(l,a);return new n(c)});static getInstance(t){return n.cache.get(Array.from(t))}static _locales=new Ir(()=>Object.keys(n.ambiguousCharacterData.value).filter(t=>!t.startsWith("_")));static getLocales(){return n._locales.value}isAmbiguous(t){return this.confusableDictionary.has(t)}containsAmbiguousCharacter(t){for(let e=0;e<t.length;e++){let r=t.codePointAt(e);if(typeof r=="number"&&this.isAmbiguous(r))return!0}return!1}getPrimaryConfusable(t){return this.confusableDictionary.get(t)}getConfusableCodePoints(){return new Set(this.confusableDictionary.keys())}};var oh=class{_value="";_pos=0;reset(t){return this._value=t,this._pos=0,this}next(){return this._pos+=1,this}hasNext(){return this._pos<this._value.length-1}cmp(t){let e=t.charCodeAt(0),r=this._value.charCodeAt(this._pos);return e-r}value(){return this._value[this._pos]}},sh=class{constructor(t=!0){this._caseSensitive=t}_value;_from;_to;reset(t){return this._value=t,this._from=0,this._to=0,this.next()}hasNext(){return this._to<this._value.length}next(){this._from=this._to;let t=!0;for(;this._to<this._value.length;this._to++)if(this._value.charCodeAt(this._to)===46)if(t)this._from++;else break;else t=!1;return this}cmp(t){return this._caseSensitive?Qd(t,this._value,0,t.length,this._from,this._to):vs(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}},Yd=class{constructor(t=!0,e=!0){this._splitOnBackslash=t;this._caseSensitive=e}_value;_valueLen;_from;_to;reset(t){this._from=0,this._to=0,this._value=t,this._valueLen=t.length;for(let e=t.length-1;e>=0;e--,this._valueLen--){let r=this._value.charCodeAt(e);if(!(r===47||this._splitOnBackslash&&r===92))break}return this.next()}hasNext(){return this._to<this._valueLen}next(){this._from=this._to;let t=!0;for(;this._to<this._valueLen;this._to++){let e=this._value.charCodeAt(this._to);if(e===47||this._splitOnBackslash&&e===92)if(t)this._from++;else break;else t=!1}return this}cmp(t){return this._caseSensitive?Qd(t,this._value,0,t.length,this._from,this._to):vs(t,this._value,0,t.length,this._from,this._to)}value(){return this._value.substring(this._from,this._to)}};var ah=class{constructor(t,e){this._ignorePathCasing=t;this._ignoreQueryAndFragment=e}_pathIterator;_value;_states=[];_stateIdx=0;reset(t){return this._value=t,this._states=[],this._value.scheme&&this._states.push(1),this._value.authority&&this._states.push(2),this._value.path&&(this._pathIterator=new Yd(!1,!this._ignorePathCasing(t)),this._pathIterator.reset(t.path),this._pathIterator.value()&&this._states.push(3)),this._ignoreQueryAndFragment(t)||(this._value.query&&this._states.push(4),this._value.fragment&&this._states.push(5)),this._stateIdx=0,this}next(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()?this._pathIterator.next():this._stateIdx+=1,this}hasNext(){return this._states[this._stateIdx]===3&&this._pathIterator.hasNext()||this._stateIdx<this._states.length-1}cmp(t){if(this._states[this._stateIdx]===1)return Rl(t,this._value.scheme);if(this._states[this._stateIdx]===2)return Rl(t,this._value.authority);if(this._states[this._stateIdx]===3)return this._pathIterator.cmp(t);if(this._states[this._stateIdx]===4)return _l(t,this._value.query);if(this._states[this._stateIdx]===5)return _l(t,this._value.fragment);throw new Error}value(){if(this._states[this._stateIdx]===1)return this._value.scheme;if(this._states[this._stateIdx]===2)return this._value.authority;if(this._states[this._stateIdx]===3)return this._pathIterator.value();if(this._states[this._stateIdx]===4)return this._value.query;if(this._states[this._stateIdx]===5)return this._value.fragment;throw new Error}},ys=class{height=1;segment;value;key;left;mid;right;isEmpty(){return!this.left&&!this.mid&&!this.right&&!this.value}rotateLeft(){let t=this.right;return this.right=t.left,t.left=this,this.updateHeight(),t.updateHeight(),t}rotateRight(){let t=this.left;return this.left=t.right,t.right=this,this.updateHeight(),t.updateHeight(),t}updateHeight(){this.height=1+Math.max(this.heightLeft,this.heightRight)}balanceFactor(){return this.heightRight-this.heightLeft}get heightLeft(){return this.left?.height??0}get heightRight(){return this.right?.height??0}};var lr=class n{static forUris(t=()=>!1,e=()=>!1){return new n(new ah(t,e))}static forPaths(t=!1){return new n(new Yd(void 0,!t))}static forStrings(){return new n(new oh)}static forConfigKeys(){return new n(new sh)}_iter;_root;constructor(t){this._iter=t}clear(){this._root=void 0}fill(t,e){if(e){let r=e.slice(0);eh(r);for(let i of r)this.set(i,t)}else{let r=t.slice(0);eh(r);for(let i of r)this.set(i[0],i[1])}}set(t,e){let r=this._iter.reset(t),i;this._root||(this._root=new ys,this._root.segment=r.value());let o=[];for(i=this._root;;){let a=r.cmp(i.segment);if(a>0)i.left||(i.left=new ys,i.left.segment=r.value()),o.push([-1,i]),i=i.left;else if(a<0)i.right||(i.right=new ys,i.right.segment=r.value()),o.push([1,i]),i=i.right;else if(r.hasNext())r.next(),i.mid||(i.mid=new ys,i.mid.segment=r.value()),o.push([0,i]),i=i.mid;else break}let s=i.value;i.value=e,i.key=t;for(let a=o.length-1;a>=0;a--){let l=o[a][1];l.updateHeight();let c=l.balanceFactor();if(c<-1||c>1){let d=o[a][0],u=o[a+1][0];if(d===1&&u===1)o[a][1]=l.rotateLeft();else if(d===-1&&u===-1)o[a][1]=l.rotateRight();else if(d===1&&u===-1)l.right=o[a+1][1]=o[a+1][1].rotateRight(),o[a][1]=l.rotateLeft();else if(d===-1&&u===1)l.left=o[a+1][1]=o[a+1][1].rotateLeft(),o[a][1]=l.rotateRight();else throw new Error;if(a>0)switch(o[a-1][0]){case-1:o[a-1][1].left=o[a][1];break;case 1:o[a-1][1].right=o[a][1];break;case 0:o[a-1][1].mid=o[a][1];break}else this._root=o[0][1]}}return s}get(t){return this._getNode(t)?.value}_getNode(t){let e=this._iter.reset(t),r=this._root;for(;r;){let i=e.cmp(r.segment);if(i>0)r=r.left;else if(i<0)r=r.right;else if(e.hasNext())e.next(),r=r.mid;else break}return r}has(t){let e=this._getNode(t);return!(e?.value===void 0&&e?.mid===void 0)}delete(t){return this._delete(t,!1)}deleteSuperstr(t){return this._delete(t,!0)}_delete(t,e){let r=this._iter.reset(t),i=[],o=this._root;for(;o;){let s=r.cmp(o.segment);if(s>0)i.push([-1,o]),o=o.left;else if(s<0)i.push([1,o]),o=o.right;else if(r.hasNext())r.next(),i.push([0,o]),o=o.mid;else break}if(o){if(e?(o.left=void 0,o.mid=void 0,o.right=void 0,o.height=1):(o.key=void 0,o.value=void 0),!o.mid&&!o.value)if(o.left&&o.right){let s=this._min(o.right);if(s.key){let{key:a,value:l,segment:c}=s;this._delete(s.key,!1),o.key=a,o.value=l,o.segment=c}}else{let s=o.left??o.right;if(i.length>0){let[a,l]=i[i.length-1];switch(a){case-1:l.left=s;break;case 0:l.mid=s;break;case 1:l.right=s;break}}else this._root=s}for(let s=i.length-1;s>=0;s--){let a=i[s][1];a.updateHeight();let l=a.balanceFactor();if(l>1?(a.right.balanceFactor()>=0||(a.right=a.right.rotateRight()),i[s][1]=a.rotateLeft()):l<-1&&(a.left.balanceFactor()<=0||(a.left=a.left.rotateLeft()),i[s][1]=a.rotateRight()),s>0)switch(i[s-1][0]){case-1:i[s-1][1].left=i[s][1];break;case 1:i[s-1][1].right=i[s][1];break;case 0:i[s-1][1].mid=i[s][1];break}else this._root=i[0][1]}}}_min(t){for(;t.left;)t=t.left;return t}findSubstr(t){let e=this._iter.reset(t),r=this._root,i;for(;r;){let o=e.cmp(r.segment);if(o>0)r=r.left;else if(o<0)r=r.right;else if(e.hasNext())e.next(),i=r.value||i,r=r.mid;else break}return r&&r.value||i}findSuperstr(t){return this._findSuperstrOrElement(t,!1)}_findSuperstrOrElement(t,e){let r=this._iter.reset(t),i=this._root;for(;i;){let o=r.cmp(i.segment);if(o>0)i=i.left;else if(o<0)i=i.right;else if(r.hasNext())r.next(),i=i.mid;else return i.mid?this._entries(i.mid):e?i.value:void 0}}hasElementOrSubtree(t){return this._findSuperstrOrElement(t,!0)!==void 0}forEach(t){for(let[e,r]of this)t(r,e)}*[Symbol.iterator](){yield*this._entries(this._root)}_entries(t){let e=[];return this._dfsEntries(t,e),e[Symbol.iterator]()}_dfsEntries(t,e){t&&(t.left&&this._dfsEntries(t.left,e),t.value&&e.push([t.key,t.value]),t.mid&&this._dfsEntries(t.mid,e),t.right&&this._dfsEntries(t.right,e))}_isBalanced(){let t=e=>{if(!e)return!0;let r=e.balanceFactor();return r<-1||r>1?!1:t(e.left)&&t(e.right)};return t(this._root)}};function _i(n){return n===47||n===92}function Pn(n){return n.replace(/[\\/]/g,ee.sep)}function vI(n){return n.indexOf("/")===-1&&(n=Pn(n)),/^[a-zA-Z]:(\/|$)/.test(n)&&(n="/"+n),n}function lh(n,t=ee.sep){if(!n)return"";let e=n.length,r=n.charCodeAt(0);if(_i(r)){if(_i(n.charCodeAt(1))&&!_i(n.charCodeAt(2))){let o=3,s=o;for(;o<e&&!_i(n.charCodeAt(o));o++);if(s!==o&&!_i(n.charCodeAt(o+1))){for(o+=1;o<e;o++)if(_i(n.charCodeAt(o)))return n.slice(0,o+1).replace(/[\\/]/g,t)}}return t}else if(Xd(r)&&n.charCodeAt(1)===58)return _i(n.charCodeAt(2))?n.slice(0,2)+t:n.slice(0,2);let i=n.indexOf("://");if(i!==-1){for(i+=3;i<e;i++)if(_i(n.charCodeAt(i)))return n.slice(0,i+1)}return""}function yI(n){if(!U||!n||n.length<5)return!1;let t=n.charCodeAt(0);if(t!==92||(t=n.charCodeAt(1),t!==92))return!1;let e=2,r=e;for(;e<n.length&&(t=n.charCodeAt(e),t!==92);e++);return!(r===e||(t=n.charCodeAt(e+1),isNaN(t)||t===92))}var gE=/[\\/:\*\?"<>\|]/g,vE=/[/]/g,yE=/^(con|prn|aux|clock\$|nul|lpt[0-9]|com[0-9])(\.(.*?))?$/i;function II(n,t=U){let e=t?gE:vE;return!(!n||n.length===0||/^\s+$/.test(n)||(e.lastIndex=0,e.test(n))||t&&yE.test(n)||n==="."||n===".."||t&&n[n.length-1]==="."||t&&n.length!==n.trim().length||n.length>255)}function So(n,t,e){let r=n===t;return!e||r?r:!n||!t?!1:Wr(n,t)}function ti(n,t,e,r=ht){if(n===t)return!0;if(!n||!t||t.length>n.length)return!1;if(e){if(!En(n,t))return!1;if(t.length===n.length)return!0;let o=t.length;return t.charAt(t.length-1)===r&&o--,n.charAt(o)===r}return t.charAt(t.length-1)!==r&&(t+=r),n.indexOf(t)===0}function Xd(n){return n>=65&&n<=90||n>=97&&n<=122}function Zd(n,t){return U&&n.endsWith(":")&&(n+=ht),Lr(n)||(n=V(t,n)),n=lt(n),ch(n)}function ch(n){return U?(n=cn(n,ht),n.endsWith(":")&&(n+=ht)):(n=cn(n,ht),n||(n=ht)),n}function bI(n){let t=lt(n);return U?n.length>3?!1:dh(t)&&(n.length===2||t.charCodeAt(2)===92):t===ee.sep}function dh(n,t=U){return t?Xd(n.charCodeAt(0))&&n.charCodeAt(1)===58:!1}function Is(n){let t=n.split(":"),e,r,i;for(let o of t){let s=Number(o);Ci(s)?r===void 0?r=s:i===void 0&&(i=s):e=e?[e,o].join(":"):o}if(!e)throw new Error("Format for `--goto` should be: `FILE:LINE(:COLUMN)`");return{path:e,line:r!==void 0?r:void 0,column:i!==void 0?i:r!==void 0?1:void 0}}var IE="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",bE="BDEFGHIJKMOQRSTUVWXYZbdefghijkmoqrstuvwxyz0123456789";function bs(n,t,e=8){let r="";for(let o=0;o<e;o++){let s;o===0&&U&&!t&&(e===3||e===4)?s=bE:s=IE,r+=s.charAt(Math.floor(Math.random()*s.length))}let i;return t?i=`${t}-${r}`:i=r,n?V(n,i):i}var L;(se=>(se.inMemory="inmemory",se.vscode="vscode",se.internal="private",se.walkThrough="walkThrough",se.walkThroughSnippet="walkThroughSnippet",se.http="http",se.https="https",se.file="file",se.mailto="mailto",se.untitled="untitled",se.data="data",se.command="command",se.vscodeRemote="vscode-remote",se.vscodeRemoteResource="vscode-remote-resource",se.vscodeManagedRemoteResource="vscode-managed-remote-resource",se.vscodeUserData="vscode-userdata",se.vscodeCustomEditor="vscode-custom-editor",se.vscodeNotebookCell="vscode-notebook-cell",se.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",se.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",se.vscodeNotebookCellOutput="vscode-notebook-cell-output",se.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",se.vscodeNotebookMetadata="vscode-notebook-metadata",se.vscodeInteractiveInput="vscode-interactive-input",se.vscodeSettings="vscode-settings",se.vscodeWorkspaceTrust="vscode-workspace-trust",se.vscodeTerminal="vscode-terminal",se.vscodeChatCodeBlock="vscode-chat-code-block",se.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",se.vscodeChatSesssion="vscode-chat-editor",se.webviewPanel="webview-panel",se.vscodeWebview="vscode-webview",se.extension="extension",se.vscodeFileResource="vscode-file",se.tmp="tmp",se.vsls="vsls",se.vscodeSourceControl="vscode-scm",se.commentsInput="comment",se.codeSetting="code-setting",se.outputChannel="output"))(L||={});function SE(n,t){return x.isUri(n)?Wr(n.scheme,t):En(n,t+":")}function wI(n,...t){return t.some(e=>SE(n,e))}var xE="tkn",uh=class{_hosts=Object.create(null);_ports=Object.create(null);_connectionTokens=Object.create(null);_preferredWebSchema="http";_delegate=null;_serverRootPath="/";setPreferredWebSchema(t){this._preferredWebSchema=t}setDelegate(t){this._delegate=t}setServerRootPath(t,e){this._serverRootPath=EE(t,e)}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return ee.join(this._serverRootPath,L.vscodeRemoteResource)}set(t,e,r){this._hosts[t]=e,this._ports[t]=r}setConnectionToken(t,e){this._connectionTokens[t]=e}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(t){if(this._delegate)try{return this._delegate(t)}catch(a){return Je(a),t}let e=t.authority,r=this._hosts[e];r&&r.indexOf(":")!==-1&&r.indexOf("[")===-1&&(r=`[${r}]`);let i=this._ports[e],o=this._connectionTokens[e],s=`path=${encodeURIComponent(t.path)}`;return typeof o=="string"&&(s+=`&${xE}=${encodeURIComponent(o)}`),x.from({scheme:sr?this._preferredWebSchema:L.vscodeRemoteResource,authority:`${r}:${i}`,path:this._remoteResourcesPath,query:s})}},fh=new uh;function EE(n,t){return ee.join(t??"/",`${n.quality??"oss"}-${n.commit??"dev"}`)}var SI="vs/../../node_modules",xI="vs/../../node_modules.asar";var xo="vscode-app",ph=class n{static FALLBACK_AUTHORITY=xo;asBrowserUri(t){let e=this.toUri(t);return this.uriToBrowserUri(e)}uriToBrowserUri(t){return t.scheme===L.vscodeRemote?fh.rewrite(t):t.scheme===L.file&&(xd||yy===`${L.vscodeFileResource}://${n.FALLBACK_AUTHORITY}`)?t.with({scheme:L.vscodeFileResource,authority:t.authority||n.FALLBACK_AUTHORITY,query:null,fragment:null}):t}asFileUri(t){let e=this.toUri(t);return this.uriToFileUri(e)}uriToFileUri(t){return t.scheme===L.vscodeFileResource?t.with({scheme:L.file,authority:t.authority!==n.FALLBACK_AUTHORITY?t.authority:null,query:null,fragment:null}):t}toUri(t,e){if(x.isUri(t))return t;if(globalThis._VSCODE_FILE_ROOT){let r=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(r))return x.joinPath(x.parse(r,!0),t);let i=V(r,t);return x.file(i)}return x.parse(e.toUrl(t))}},Re=new ph,ws;(o=>{let n=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);o.CoopAndCoep=Object.freeze(n.get("3"));let e="vscode-coi";function r(s){let a;typeof s=="string"?a=new URL(s).searchParams:s instanceof URL?a=s.searchParams:x.isUri(s)&&(a=new URL(s.toString(!0)).searchParams);let l=a?.get(e);if(l)return n.get(l)}o.getHeadersFromQuery=r;function i(s,a,l){if(!globalThis.crossOriginIsolated)return;let c=a&&l?"3":l?"2":"1";s instanceof URLSearchParams?s.set(e,c):s[e]=c}o.addSearchParam=i})(ws||={});function Dt(n){return Sl(n,!0)}var Eo=class{constructor(t){this._ignorePathCasing=t}compare(t,e,r=!1){return t===e?0:_l(this.getComparisonKey(t,r),this.getComparisonKey(e,r))}isEqual(t,e,r=!1){return t===e?!0:!t||!e?!1:this.getComparisonKey(t,r)===this.getComparisonKey(e,r)}getComparisonKey(t,e=!1){return t.with({path:this._ignorePathCasing(t)?t.path.toLowerCase():void 0,fragment:e?null:void 0}).toString()}ignorePathCasing(t){return this._ignorePathCasing(t)}isEqualOrParent(t,e,r=!1){if(t.scheme===e.scheme){if(t.scheme===L.file)return ti(Dt(t),Dt(e),this._ignorePathCasing(t))&&t.query===e.query&&(r||t.fragment===e.fragment);if(Xt(t.authority,e.authority))return ti(t.path,e.path,this._ignorePathCasing(t),"/")&&t.query===e.query&&(r||t.fragment===e.fragment)}return!1}joinPath(t,...e){return x.joinPath(t,...e)}basenameOrAuthority(t){return cr(t)||t.authority}basename(t){return ee.basename(t.path)}extname(t){return ee.extname(t.path)}dirname(t){if(t.path.length===0)return t;let e;return t.scheme===L.file?e=x.file(Ne(Dt(t))).path:(e=ee.dirname(t.path),t.authority&&e.length&&e.charCodeAt(0)!==47&&(console.error(`dirname("${t.toString})) resulted in a relative path`),e="/")),t.with({path:e})}normalizePath(t){if(!t.path.length)return t;let e;return t.scheme===L.file?e=x.file(lt(Dt(t))).path:e=ee.normalize(t.path),t.with({path:e})}relativePath(t,e){if(t.scheme!==e.scheme||!Xt(t.authority,e.authority))return;if(t.scheme===L.file){let o=Ry(Dt(t),Dt(e));return U?Pn(o):o}let r=t.path||"/",i=e.path||"/";if(this._ignorePathCasing(t)){let o=0;for(let s=Math.min(r.length,i.length);o<s&&!(r.charCodeAt(o)!==i.charCodeAt(o)&&r.charAt(o).toLowerCase()!==i.charAt(o).toLowerCase());o++);r=i.substr(0,o)+r.substr(o)}return ee.relative(r,i)}resolvePath(t,e){if(t.scheme===L.file){let r=x.file(Sn(Dt(t),e));return t.with({authority:r.authority,path:r.path})}return e=vI(e),t.with({path:ee.resolve(t.path,e)})}isAbsolutePath(t){return!!t.path&&t.path[0]==="/"}isEqualAuthority(t,e){return t===e||t!==void 0&&e!==void 0&&Wr(t,e)}hasTrailingPathSeparator(t,e=ht){if(t.scheme===L.file){let r=Dt(t);return r.length>lh(r).length&&r[r.length-1]===e}else{let r=t.path;return r.length>1&&r.charCodeAt(r.length-1)===47&&!/^[a-zA-Z]:(\/$|\\$)/.test(t.fsPath)}}removeTrailingPathSeparator(t,e=ht){return EI(t,e)?t.with({path:t.path.substr(0,t.path.length-1)}):t}addTrailingPathSeparator(t,e=ht){let r=!1;if(t.scheme===L.file){let i=Dt(t);r=i!==void 0&&i.length===lh(i).length&&i[i.length-1]===e}else{e="/";let i=t.path;r=i.length===1&&i.charCodeAt(i.length-1)===47}return!r&&!EI(t,e)?t.with({path:t.path+"/"}):t}},Se=new Eo(()=>!1),Le=new Eo(n=>n.scheme===L.file?!Q:!0),eu=new Eo(n=>!0),tu=Se.isEqual.bind(Se),mh=Se.isEqualOrParent.bind(Se),eM=Se.getComparisonKey.bind(Se),PE=Se.basenameOrAuthority.bind(Se),cr=Se.basename.bind(Se),PI=Se.extname.bind(Se),TI=Se.dirname.bind(Se),ne=Se.joinPath.bind(Se),ru=Se.normalizePath.bind(Se),tM=Se.relativePath.bind(Se),rM=Se.resolvePath.bind(Se),CI=Se.isAbsolutePath.bind(Se),Xt=Se.isEqualAuthority.bind(Se),EI=Se.hasTrailingPathSeparator.bind(Se),kI=Se.removeTrailingPathSeparator.bind(Se),nM=Se.addTrailingPathSeparator.bind(Se);var TE;(o=>{o.META_DATA_LABEL="label",o.META_DATA_DESCRIPTION="description",o.META_DATA_SIZE="size",o.META_DATA_MIME="mime";function i(s){let a=new Map;s.path.substring(s.path.indexOf(";")+1,s.path.lastIndexOf(";")).split(";").forEach(d=>{let[u,m]=d.split(":");u&&m&&a.set(u,m)});let c=s.path.substring(0,s.path.indexOf(";"));return c&&a.set(o.META_DATA_MIME,c),a}o.parseMetaData=i})(TE||={});var dr=F("environmentService"),br=dr;var wM=F("contextService");function pt(n){let t=n;return typeof t?.id=="string"&&x.isUri(t.uri)}var CE={id:"ext-dev"},kE={id:"empty-window"};function Ri(n,t){if(typeof n=="string"||typeof n>"u")return typeof n=="string"?{id:pe(n)}:t?CE:kE;let e=n;return e.configuration?{id:e.id,configPath:e.configuration}:e.folders.length===1?{id:e.id,uri:e.folders[0].uri}:{id:e.id}}function Be(n){let t=n;return typeof t?.id=="string"&&x.isUri(t.configPath)}function _I(n){let t=n;if(t?.uri)return{id:t.id,uri:x.revive(t.uri)};let e=n;if(e?.configPath)return{id:e.id,configPath:x.revive(e.configPath)};if(n?.id)return{id:n.id}}var nu=class{constructor(t,e){this.raw=e;this.uri=t.uri,this.index=t.index,this.name=t.name}uri;name;index;toResource(t){return ne(this.uri,t)}toJSON(){return{uri:this.uri,name:this.name,index:this.index}}};var Ol="code-workspace",_E=`.${Ol}`,RI=[{name:p("codeWorkspace","Code Workspace"),extensions:[Ol]}],gh="workspace.json";function vh(n,t){return Le.isEqualOrParent(n,t.untitledWorkspacesHome)}function Tn(n){return(typeof n=="string"?ls(n):PI(n))===_E}var ce=F("configurationService");function iu(n){return n&&typeof n=="object"&&(!n.overrideIdentifier||typeof n.overrideIdentifier=="string")&&(!n.resource||n.resource instanceof x)}function DI(n){return n&&typeof n=="object"&&(!n.overrideIdentifiers||Array.isArray(n.overrideIdentifiers))&&!n.overrideIdentifier&&(!n.resource||n.resource instanceof x)}function ou(n,t){let e=Object.create(null);for(let r in n)yh(e,r,n[r],t);return e}function yh(n,t,e,r){let i=t.split("."),o=i.pop(),s=n;for(let a=0;a<i.length;a++){let l=i[a],c=s[l];switch(typeof c){case"undefined":c=s[l]=Object.create(null);break;case"object":if(c===null){r(`Ignoring ${t} as ${i.slice(0,a+1).join(".")} is null`);return}break;default:r(`Ignoring ${t} as ${i.slice(0,a+1).join(".")} is ${JSON.stringify(c)}`);return}s=c}if(typeof s=="object"&&s!==null)try{s[o]=e}catch{r(`Ignoring ${t} as ${i.join(".")} is ${JSON.stringify(s)}`)}else r(`Ignoring ${t} as ${i.join(".")} is ${JSON.stringify(s)}`)}function OI(n,t){let e=t.split(".");FI(n,e)}function FI(n,t){let e=t.shift();if(t.length===0){delete n[e];return}if(Object.keys(n).indexOf(e)!==-1){let r=n[e];typeof r=="object"&&!Array.isArray(r)&&(FI(r,t),Object.keys(r).length===0&&delete n[e])}}function Fl(n,t,e){function r(s,a){let l=s;for(let c of a){if(typeof l!="object"||l===null)return;l=l[c]}return l}let i=t.split("."),o=r(n,i);return typeof o>"u"?e:o}function LI(n){return n.replace(/[\[\]]/g,"")}var Ih=class{data=new Map;add(t,e){Md(ke(t)),Md(qe(e)),Md(!this.data.has(t),"There is already an extension with this id"),this.data.set(t,e)}knows(t){return this.data.has(t)}as(t){return this.data.get(t)||null}},De=new Ih;var Po={JSONContribution:"base.contributions.json"};function RE(n){return n.length>0&&n.charAt(n.length-1)==="#"?n.substring(0,n.length-1):n}var bh=class{schemasById;_onDidChangeSchema=new S;onDidChangeSchema=this._onDidChangeSchema.event;constructor(){this.schemasById={}}registerSchema(t,e){this.schemasById[RE(t)]=e,this._onDidChangeSchema.fire(t)}notifySchemaChanged(t){this._onDidChangeSchema.fire(t)}getSchemaContributions(){return{schemas:this.schemasById}}getSchemaContent(t){let e=this.schemasById[t];return e?cI(e):void 0}hasSchemaContent(t){return!!this.schemasById[t]}},DE=new bh;De.add(Po.JSONContribution,DE);var Jr=F("policy"),To=class extends D{_serviceBrand;policyDefinitions={};policies=new Map;_onDidChange=this._register(new S);onDidChange=this._onDidChange.event;async updatePolicyDefinitions(t){let e=Object.keys(this.policyDefinitions).length;return this.policyDefinitions={...t,...this.policyDefinitions},e!==Object.keys(this.policyDefinitions).length&&await this._updatePolicyDefinitions(t),jr.reduce(this.policies.entries(),(r,[i,o])=>({...r,[i]:o}),{})}getPolicyValue(t){return this.policies.get(t)}serialize(){return jr.reduce(Object.entries(this.policyDefinitions),(t,[e,r])=>({...t,[e]:{definition:r,value:this.policies.get(e)}}),{})}},Ss=class{_serviceBrand;onDidChange=E.None;async updatePolicyDefinitions(){return{}}getPolicyValue(){}serialize(){}};var Et={Configuration:"base.contributions.configuration"};var au={properties:{},patternProperties:{}},lu={properties:{},patternProperties:{}},cu={properties:{},patternProperties:{}},du={properties:{},patternProperties:{}},uu={properties:{},patternProperties:{}},Ll={properties:{},patternProperties:{}},Co="vscode://schemas/settings/resourceLanguage";var pu=De.as(Po.JSONContribution),wh=class{registeredConfigurationDefaults=[];configurationDefaultsOverrides;defaultLanguageConfigurationOverridesNode;configurationContributors;configurationProperties;policyConfigurations;excludedConfigurationProperties;resourceLanguageSettingsSchema;overrideIdentifiers=new Set;_onDidSchemaChange=new S;onDidSchemaChange=this._onDidSchemaChange.event;_onDidUpdateConfiguration=new S;onDidUpdateConfiguration=this._onDidUpdateConfiguration.event;constructor(){this.configurationDefaultsOverrides=new Map,this.defaultLanguageConfigurationOverridesNode={id:"defaultOverrides",title:p("defaultLanguageConfigurationOverrides.title","Default Language Configuration Overrides"),properties:{}},this.configurationContributors=[this.defaultLanguageConfigurationOverridesNode],this.resourceLanguageSettingsSchema={properties:{},patternProperties:{},additionalProperties:!0,allowTrailingCommas:!0,allowComments:!0},this.configurationProperties={},this.policyConfigurations=new Map,this.excludedConfigurationProperties={},pu.registerSchema(Co,this.resourceLanguageSettingsSchema),this.registerOverridePropertyPatternKey()}registerConfiguration(t,e=!0){this.registerConfigurations([t],e)}registerConfigurations(t,e=!0){let r=new Set;this.doRegisterConfigurations(t,e,r),pu.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r})}deregisterConfigurations(t){let e=new Set;this.doDeregisterConfigurations(t,e),pu.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e})}updateConfigurations({add:t,remove:e}){let r=new Set;this.doDeregisterConfigurations(e,r),this.doRegisterConfigurations(t,!1,r),pu.registerSchema(Co,this.resourceLanguageSettingsSchema),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r})}registerDefaultConfigurations(t){let e=new Set;this.doRegisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doRegisterDefaultConfigurations(t,e){this.registeredConfigurationDefaults.push(...t);let r=[];for(let{overrides:i,source:o}of t)for(let s in i){e.add(s);let a=this.configurationDefaultsOverrides.get(s)??this.configurationDefaultsOverrides.set(s,{configurationDefaultOverrides:[]}).get(s),l=i[s];if(a.configurationDefaultOverrides.push({value:l,source:o}),Cn.test(s)){let c=this.mergeDefaultConfigurationsForOverrideIdentifier(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c,this.updateDefaultOverrideProperty(s,c,o),r.push(...xs(s))}else{let c=this.mergeDefaultConfigurationsForConfigurationProperty(s,l,o,a.configurationDefaultOverrideValue);if(!c)continue;a.configurationDefaultOverrideValue=c;let d=this.configurationProperties[s];d&&(this.updatePropertyDefaultValue(s,d),this.updateSchema(s,d))}}this.doRegisterOverrideIdentifiers(r)}deregisterDefaultConfigurations(t){let e=new Set;this.doDeregisterDefaultConfigurations(t,e),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:e,defaultsOverrides:!0})}doDeregisterDefaultConfigurations(t,e){for(let r of t){let i=this.registeredConfigurationDefaults.indexOf(r);i!==-1&&this.registeredConfigurationDefaults.splice(i,1)}for(let{overrides:r,source:i}of t)for(let o in r){let s=this.configurationDefaultsOverrides.get(o);if(!s)continue;let a=s.configurationDefaultOverrides.findIndex(l=>i?l.source?.id===i.id:l.value===r[o]);if(a!==-1){if(s.configurationDefaultOverrides.splice(a,1),s.configurationDefaultOverrides.length===0&&this.configurationDefaultsOverrides.delete(o),Cn.test(o)){let l;for(let c of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForOverrideIdentifier(o,c.value,c.source,l);l&&!hs(l.value)?(s.configurationDefaultOverrideValue=l,this.updateDefaultOverrideProperty(o,l,i)):(this.configurationDefaultsOverrides.delete(o),delete this.configurationProperties[o],delete this.defaultLanguageConfigurationOverridesNode.properties[o])}else{let l;for(let d of s.configurationDefaultOverrides)l=this.mergeDefaultConfigurationsForConfigurationProperty(o,d.value,d.source,l);s.configurationDefaultOverrideValue=l;let c=this.configurationProperties[o];c&&(this.updatePropertyDefaultValue(o,c),this.updateSchema(o,c))}e.add(o)}}this.updateOverridePropertyPatternKey()}updateDefaultOverrideProperty(t,e,r){let i={type:"object",default:e.value,description:p("defaultLanguageConfiguration.description","Configure settings to be overridden for the {0} language.",LI(t)),$ref:Co,defaultDefaultValue:e.value,source:r,defaultValueSource:r};this.configurationProperties[t]=i,this.defaultLanguageConfigurationOverridesNode.properties[t]=i}mergeDefaultConfigurationsForOverrideIdentifier(t,e,r,i){let o=i?.value||{},s=i?.source??new Map;if(!(s instanceof Map)){console.error("objectConfigurationSources is not a Map");return}for(let a of Object.keys(e)){let l=e[a];if(qe(l)&&(Gr(o[a])||qe(o[a]))){if(o[a]={...o[a]??{},...l},r)for(let d in l)s.set(`${a}.${d}`,r)}else o[a]=l,r?s.set(a,r):s.delete(a)}return{value:o,source:s}}mergeDefaultConfigurationsForConfigurationProperty(t,e,r,i){let o=this.configurationProperties[t],s=i?.value??o?.defaultDefaultValue,a=r;if(qe(e)&&(o!==void 0&&o.type==="object"||o===void 0&&(Gr(s)||qe(s)))){if(a=i?.source??new Map,!(a instanceof Map)){console.error("defaultValueSource is not a Map");return}for(let c in e)r&&a.set(`${t}.${c}`,r);e={...qe(s)?s:{},...e}}return{value:e,source:a}}deltaConfiguration(t){let e=!1,r=new Set;t.removedDefaults&&(this.doDeregisterDefaultConfigurations(t.removedDefaults,r),e=!0),t.addedDefaults&&(this.doRegisterDefaultConfigurations(t.addedDefaults,r),e=!0),t.removedConfigurations&&this.doDeregisterConfigurations(t.removedConfigurations,r),t.addedConfigurations&&this.doRegisterConfigurations(t.addedConfigurations,!1,r),this._onDidSchemaChange.fire(),this._onDidUpdateConfiguration.fire({properties:r,defaultsOverrides:e})}notifyConfigurationSchemaUpdated(...t){this._onDidSchemaChange.fire()}registerOverrideIdentifiers(t){this.doRegisterOverrideIdentifiers(t),this._onDidSchemaChange.fire()}doRegisterOverrideIdentifiers(t){for(let e of t)this.overrideIdentifiers.add(e);this.updateOverridePropertyPatternKey()}doRegisterConfigurations(t,e,r){t.forEach(i=>{this.validateAndRegisterProperties(i,e,i.extensionInfo,i.restrictedProperties,void 0,r),this.configurationContributors.push(i),this.registerJSONConfiguration(i)})}doDeregisterConfigurations(t,e){let r=i=>{if(i.properties)for(let o in i.properties){e.add(o);let s=this.configurationProperties[o];s?.policy?.name&&this.policyConfigurations.delete(s.policy.name),delete this.configurationProperties[o],this.removeFromSchema(o,i.properties[o])}i.allOf?.forEach(o=>r(o))};for(let i of t){r(i);let o=this.configurationContributors.indexOf(i);o!==-1&&this.configurationContributors.splice(o,1)}}validateAndRegisterProperties(t,e=!0,r,i,o=3,s){o=ct(t.scope)?o:t.scope;let a=t.properties;if(a)for(let c in a){let d=a[c];if(e&&FE(c,d)){delete a[c];continue}if(d.source=r,d.defaultDefaultValue=a[c].default,this.updatePropertyDefaultValue(c,d),Cn.test(c)?d.scope=void 0:(d.scope=ct(d.scope)?o:d.scope,d.restricted=ct(d.restricted)?!!i?.includes(c):d.restricted),a[c].hasOwnProperty("included")&&!a[c].included){this.excludedConfigurationProperties[c]=a[c],delete a[c];continue}else this.configurationProperties[c]=a[c],a[c].policy?.name&&this.policyConfigurations.set(a[c].policy.name,c);!a[c].deprecationMessage&&a[c].markdownDeprecationMessage&&(a[c].deprecationMessage=a[c].markdownDeprecationMessage),s.add(c)}let l=t.allOf;if(l)for(let c of l)this.validateAndRegisterProperties(c,e,r,i,o,s)}getConfigurations(){return this.configurationContributors}getConfigurationProperties(){return this.configurationProperties}getPolicyConfigurations(){return this.policyConfigurations}getExcludedConfigurationProperties(){return this.excludedConfigurationProperties}getRegisteredDefaultConfigurations(){return[...this.registeredConfigurationDefaults]}getConfigurationDefaultsOverrides(){let t=new Map;for(let[e,r]of this.configurationDefaultsOverrides)r.configurationDefaultOverrideValue&&t.set(e,r.configurationDefaultOverrideValue);return t}registerJSONConfiguration(t){let e=r=>{let i=r.properties;if(i)for(let s in i)this.updateSchema(s,i[s]);r.allOf?.forEach(e)};e(t)}updateSchema(t,e){switch(au.properties[t]=e,e.scope){case 1:lu.properties[t]=e;break;case 2:cu.properties[t]=e;break;case 6:du.properties[t]=e;break;case 3:uu.properties[t]=e;break;case 4:Ll.properties[t]=e;break;case 5:Ll.properties[t]=e,this.resourceLanguageSettingsSchema.properties[t]=e;break}}removeFromSchema(t,e){switch(delete au.properties[t],e.scope){case 1:delete lu.properties[t];break;case 2:delete cu.properties[t];break;case 6:delete du.properties[t];break;case 3:delete uu.properties[t];break;case 4:case 5:delete Ll.properties[t],delete this.resourceLanguageSettingsSchema.properties[t];break}}updateOverridePropertyPatternKey(){for(let t of this.overrideIdentifiers.values()){let e=`[${t}]`,r={type:"object",description:p("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:p("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Co};this.updatePropertyDefaultValue(e,r),au.properties[e]=r,lu.properties[e]=r,cu.properties[e]=r,du.properties[e]=r,uu.properties[e]=r,Ll.properties[e]=r}}registerOverridePropertyPatternKey(){let t={type:"object",description:p("overrideSettings.defaultDescription","Configure editor settings to be overridden for a language."),errorMessage:p("overrideSettings.errorMessage","This setting does not support per-language configuration."),$ref:Co};au.patternProperties[ko]=t,lu.patternProperties[ko]=t,cu.patternProperties[ko]=t,du.patternProperties[ko]=t,uu.patternProperties[ko]=t,Ll.patternProperties[ko]=t,this._onDidSchemaChange.fire()}updatePropertyDefaultValue(t,e){let r=this.configurationDefaultsOverrides.get(t)?.configurationDefaultOverrideValue,i,o;r&&(!e.disallowConfigurationDefault||!r.source)&&(i=r.value,o=r.source),Gr(i)&&(i=e.defaultDefaultValue,o=void 0),Gr(i)&&(i=OE(e.type)),e.default=i,e.defaultValueSource=o}},AI="\\[([^\\]]+)\\]",MI=new RegExp(AI,"g"),ko=`^(${AI})+$`,Cn=new RegExp(ko);function xs(n){let t=[];if(Cn.test(n)){let e=MI.exec(n);for(;e?.length;){let r=e[1].trim();r&&t.push(r),e=MI.exec(n)}}return Qt(t)}function WI(n){return n.reduce((t,e)=>`${t}[${e}]`,"")}function OE(n){switch(Array.isArray(n)?n[0]:n){case"boolean":return!1;case"integer":case"number":return 0;case"string":return"";case"array":return[];case"object":return{};default:return null}}var fu=new wh;De.add(Et.Configuration,fu);function FE(n,t){return n.trim()?Cn.test(n)?p("config.property.languageDefault","Cannot register '{0}'. This matches property pattern '\\\\[.*\\\\]$' for describing language specific editor settings. Use 'configurationDefaults' contribution.",n):fu.getConfigurationProperties()[n]!==void 0?p("config.property.duplicate","Cannot register '{0}'. This property is already registered.",n):t.policy?.name&&fu.getPolicyConfigurations().get(t.policy?.name)!==void 0?p("config.policy.duplicate","Cannot register '{0}'. The associated policy {1} is already registered with {2}.",n,t.policy?.name,fu.getPolicyConfigurations().get(t.policy?.name)):null:p("config.property.empty","Cannot register an empty property")}var LE=De.as(Et.Configuration);LE.registerConfiguration({id:"update",order:15,title:p("updateConfigurationTitle","Update"),type:"object",properties:{"update.mode":{type:"string",enum:["none","manual","start","default"],default:"default",scope:1,description:p("updateMode","Configure whether you receive automatic updates. Requires a restart after change. The updates are fetched from a Microsoft online service."),tags:["usesOnlineServices"],enumDescriptions:[p("none","Disable updates."),p("manual","Disable automatic background update checks. Updates will be available if you manually check for updates."),p("start","Check for updates only on startup. Disable automatic background update checks."),p("default","Enable automatic update checks. Code will check for updates automatically and periodically.")],policy:{name:"UpdateMode",minimumVersion:"1.67"}},"update.channel":{type:"string",default:"default",scope:1,description:p("updateMode","Configure whether you receive automatic updates. Requires a restart after change. The updates are fetched from a Microsoft online service."),deprecationMessage:p("deprecated","This setting is deprecated, please use '{0}' instead.","update.mode")},"update.enableWindowsBackgroundUpdates":{type:"boolean",default:!0,scope:1,title:p("enableWindowsBackgroundUpdatesTitle","Enable Background Updates on Windows"),description:p("enableWindowsBackgroundUpdates","Enable to download and install new VS Code versions in the background on Windows."),included:U&&!sr},"update.showReleaseNotes":{type:"boolean",default:!0,scope:1,description:p("showReleaseNotes","Show Release Notes after an update. The Release Notes are fetched from a Microsoft online service."),tags:["usesOnlineServices"]}}});import{app as gD,dialog as vD}from"electron";import{unlinkSync as yD,promises as c0}from"fs";function Iu(n){return!!n&&typeof n.then=="function"}function ri(n){let t=new rt,e=n(t.token),r=new Promise((i,o)=>{let s=t.token.onCancellationRequested(()=>{s.dispose(),o(new at)});Promise.resolve(e).then(a=>{s.dispose(),t.dispose(),i(a)},a=>{s.dispose(),t.dispose(),o(a)})});return new class{cancel(){t.cancel(),t.dispose()}then(i,o){return r.then(i,o)}catch(i){return this.then(void 0,i)}finally(i){return r.finally(i)}}}function NI(n,t,e){let r,i=setTimeout(()=>{r?.(void 0),e?.()},t);return Promise.race([n.finally(()=>clearTimeout(i)),new Promise(o=>r=o)])}function BI(){let n,t;return{promise:new Promise((r,i)=>{n=r,t=i}),resolve:n,reject:t}}var Ml=class{activePromise;queuedPromise;queuedPromiseFactory;isDisposed=!1;constructor(){this.activePromise=null,this.queuedPromise=null,this.queuedPromiseFactory=null}queue(t){if(this.isDisposed)return Promise.reject(new Error("Throttler is disposed"));if(this.activePromise){if(this.queuedPromiseFactory=t,!this.queuedPromise){let e=()=>{if(this.queuedPromise=null,this.isDisposed)return;let r=this.queue(this.queuedPromiseFactory);return this.queuedPromiseFactory=null,r};this.queuedPromise=new Promise(r=>{this.activePromise.then(e,e).then(r)})}return new Promise((e,r)=>{this.queuedPromise.then(e,r)})}return this.activePromise=t(),new Promise((e,r)=>{this.activePromise.then(i=>{this.activePromise=null,e(i)},i=>{this.activePromise=null,r(i)})})}dispose(){this.isDisposed=!0}};var ME=(n,t)=>{let e=!0,r=setTimeout(()=>{e=!1,t()},n);return{isTriggered:()=>e,dispose:()=>{clearTimeout(r),e=!1}}},AE=n=>{let t=!0;return queueMicrotask(()=>{t&&(t=!1,n())}),{isTriggered:()=>t,dispose:()=>{t=!1}}},Al=class{constructor(t){this.defaultDelay=t;this.deferred=null,this.completionPromise=null,this.doResolve=null,this.doReject=null,this.task=null}deferred;completionPromise;doResolve;doReject;task;trigger(t,e=this.defaultDelay){this.task=t,this.cancelTimeout(),this.completionPromise||(this.completionPromise=new Promise((i,o)=>{this.doResolve=i,this.doReject=o}).then(()=>{if(this.completionPromise=null,this.doResolve=null,this.task){let i=this.task;return this.task=null,i()}}));let r=()=>{this.deferred=null,this.doResolve?.(null)};return this.deferred=e===tI?AE(r):ME(e,r),this.completionPromise}isTriggered(){return!!this.deferred?.isTriggered()}cancel(){this.cancelTimeout(),this.completionPromise&&(this.doReject?.(new at),this.completionPromise=null)}cancelTimeout(){this.deferred?.dispose(),this.deferred=null}dispose(){this.cancel()}},Ht=class{delayer;throttler;constructor(t){this.delayer=new Al(t),this.throttler=new Ml}trigger(t,e){return this.delayer.trigger(()=>this.throttler.queue(t),e)}isTriggered(){return this.delayer.isTriggered()}cancel(){this.delayer.cancel()}dispose(){this.delayer.dispose(),this.throttler.dispose()}},kn=class{_isOpen;_promise;_completePromise;constructor(){this._isOpen=!1,this._promise=new Promise((t,e)=>{this._completePromise=t})}isOpen(){return this._isOpen}open(){this._isOpen=!0,this._completePromise(!0)}wait(){return this._promise}};function nt(n,t){return t?new Promise((e,r)=>{let i=setTimeout(()=>{o.dispose(),e()},n),o=t.onCancellationRequested(()=>{clearTimeout(i),o.dispose(),r(new at)})}):ri(e=>nt(n,e))}function VI(n,t=0,e){let r=setTimeout(()=>{n(),e&&i.dispose()},t),i=$(()=>{clearTimeout(r),e?.deleteAndLeak(i)});return e?.add(i),i}function KI(n,t=r=>!!r,e=null){let r=0,i=n.length,o=()=>{if(r>=i)return Promise.resolve(e);let s=n[r++];return Promise.resolve(s()).then(l=>t(l)?Promise.resolve(l):o())};return o()}var Sh=class{_size=0;_isDisposed=!1;runningPromises;maxDegreeOfParalellism;outstandingPromises;_onDrained;constructor(t){this.maxDegreeOfParalellism=t,this.outstandingPromises=[],this.runningPromises=0,this._onDrained=new S}whenIdle(){return this.size>0?E.toPromise(this.onDrained):Promise.resolve()}get onDrained(){return this._onDrained.event}get size(){return this._size}queue(t){if(this._isDisposed)throw new Error("Object has been disposed");return this._size++,new Promise((e,r)=>{this.outstandingPromises.push({factory:t,c:e,e:r}),this.consume()})}consume(){for(;this.outstandingPromises.length&&this.runningPromises<this.maxDegreeOfParalellism;){let t=this.outstandingPromises.shift();this.runningPromises++;let e=t.factory();e.then(t.c,t.e),e.then(()=>this.consumed(),()=>this.consumed())}}consumed(){this._isDisposed||(this.runningPromises--,--this._size===0&&this._onDrained.fire(),this.outstandingPromises.length>0&&this.consume())}clear(){if(this._isDisposed)throw new Error("Object has been disposed");this.outstandingPromises.length=0,this._size=this.runningPromises}dispose(){this._isDisposed=!0,this.outstandingPromises.length=0,this._size=0,this._onDrained.dispose()}},_n=class extends Sh{constructor(){super(1)}};var Es=class{queues=new Map;drainers=new Set;drainListeners=void 0;drainListenerCount=0;async whenDrained(){if(this.isDrained())return;let t=new ur;return this.drainers.add(t),t.p}isDrained(){for(let[,t]of this.queues)if(t.size>0)return!1;return!0}queueSize(t,e=Se){let r=e.getComparisonKey(t);return this.queues.get(r)?.size??0}queueFor(t,e,r=Se){let i=r.getComparisonKey(t),o=this.queues.get(i);if(!o){o=new _n;let s=this.drainListenerCount++,a=E.once(o.onDrained)(()=>{o?.dispose(),this.queues.delete(i),this.onDidQueueDrain(),this.drainListeners?.deleteAndDispose(s),this.drainListeners?.size===0&&(this.drainListeners.dispose(),this.drainListeners=void 0)});this.drainListeners||(this.drainListeners=new Yn),this.drainListeners.set(s,a),this.queues.set(i,o)}return o.queue(e)}onDidQueueDrain(){this.isDrained()&&this.releaseDrainers()}releaseDrainers(){for(let t of this.drainers)t.complete();this.drainers.clear()}dispose(){for(let[,t]of this.queues)t.dispose();this.queues.clear(),this.releaseDrainers(),this.drainListeners?.dispose()}};var bt=class{runner;timeoutToken;timeout;timeoutHandler;constructor(t,e){this.timeoutToken=-1,this.runner=t,this.timeout=e,this.timeoutHandler=this.onTimeout.bind(this)}dispose(){this.cancel(),this.runner=null}cancel(){this.isScheduled()&&(clearTimeout(this.timeoutToken),this.timeoutToken=-1)}schedule(t=this.timeout){this.cancel(),this.timeoutToken=setTimeout(this.timeoutHandler,t)}get delay(){return this.timeout}set delay(t){this.timeout=t}isScheduled(){return this.timeoutToken!==-1}flush(){this.isScheduled()&&(this.cancel(),this.doRun())}onTimeout(){this.timeoutToken=-1,this.runner&&this.doRun()}doRun(){this.runner?.()}};var gu=class extends bt{units=[];constructor(t,e){super(t,e)}work(t){this.units.push(t),this.isScheduled()||this.schedule()}doRun(){let t=this.units;this.units=[],this.runner?.(t)}dispose(){this.units=[],super.dispose()}},vu=class extends D{constructor(e,r){super();this.options=e;this.handler=r}pendingWork=[];throttler=this._register(new Mr);disposed=!1;get pending(){return this.pendingWork.length}work(e){if(this.disposed)return!1;if(typeof this.options.maxBufferedWork=="number"){if(this.throttler.value){if(this.pending+e.length>this.options.maxBufferedWork)return!1}else if(this.pending+e.length-this.options.maxWorkChunkSize>this.options.maxBufferedWork)return!1}for(let r of e)this.pendingWork.push(r);return this.throttler.value||this.doWork(),!0}doWork(){this.handler(this.pendingWork.splice(0,this.options.maxWorkChunkSize)),this.pendingWork.length>0&&(this.throttler.value=new bt(()=>{this.throttler.clear(),this.doWork()},this.options.throttleDelay),this.throttler.value.schedule())}dispose(){super.dispose(),this.disposed=!0}},Wl,hu;(function(){typeof globalThis.requestIdleCallback!="function"||typeof globalThis.cancelIdleCallback!="function"?hu=(n,t)=>{by(()=>{if(e)return;let r=Date.now()+15;t(Object.freeze({didTimeout:!0,timeRemaining(){return Math.max(0,r-Date.now())}}))});let e=!1;return{dispose(){e||(e=!0)}}}:hu=(n,t,e)=>{let r=n.requestIdleCallback(t,typeof e=="number"?{timeout:e}:void 0),i=!1;return{dispose(){i||(i=!0,n.cancelIdleCallback(r))}}},Wl=n=>hu(globalThis,n)})();var xh=class{_executor;_handle;_didRun=!1;_value;_error;constructor(t,e){this._executor=()=>{try{this._value=e()}catch(r){this._error=r}finally{this._didRun=!0}},this._handle=hu(t,()=>this._executor())}dispose(){this._handle.dispose()}get value(){if(this._didRun||(this._handle.dispose(),this._executor()),this._error)throw this._error;return this._value}get isInitialized(){return this._didRun}},yu=class extends xh{constructor(t){super(globalThis,t)}};async function HI(n,t,e){let r;for(let i=0;i<e;i++)try{return await n()}catch(o){r=o,await nt(t)}throw r}var ur=class{completeCallback;errorCallback;outcome;get isRejected(){return this.outcome?.outcome===1}get isResolved(){return this.outcome?.outcome===0}get isSettled(){return!!this.outcome}get value(){return this.outcome?.outcome===0?this.outcome?.value:void 0}p;constructor(){this.p=new Promise((t,e)=>{this.completeCallback=t,this.errorCallback=e})}complete(t){return new Promise(e=>{this.completeCallback(t),this.outcome={outcome:0,value:t},e()})}error(t){return new Promise(e=>{this.errorCallback(t),this.outcome={outcome:1,value:t},e()})}cancel(){return this.error(new at)}},Xe;(e=>{async function n(r){let i,o=await Promise.all(r.map(s=>s.then(a=>a,a=>{i||(i=a)})));if(typeof i<"u")throw i;return o}e.settled=n;function t(r){return new Promise(async(i,o)=>{try{await r(i,o)}catch(s){o(s)}})}e.withAsyncBody=t})(Xe||={});var UI=class n{static fromArray(t){return new n(e=>{e.emitMany(t)})}static fromPromise(t){return new n(async e=>{e.emitMany(await t)})}static fromPromises(t){return new n(async e=>{await Promise.all(t.map(async r=>e.emitOne(await r)))})}static merge(t){return new n(async e=>{await Promise.all(t.map(async r=>{for await(let i of r)e.emitOne(i)}))})}static EMPTY=n.fromArray([]);_state;_results;_error;_onReturn;_onStateChanged;constructor(t,e){this._state=0,this._results=[],this._error=null,this._onReturn=e,this._onStateChanged=new S,queueMicrotask(async()=>{let r={emitOne:i=>this.emitOne(i),emitMany:i=>this.emitMany(i),reject:i=>this.reject(i)};try{await Promise.resolve(t(r)),this.resolve()}catch(i){this.reject(i)}finally{r.emitOne=void 0,r.emitMany=void 0,r.reject=void 0}})}[Symbol.asyncIterator](){let t=0;return{next:async()=>{do{if(this._state===2)throw this._error;if(t<this._results.length)return{done:!1,value:this._results[t++]};if(this._state===1)return{done:!0,value:void 0};await E.toPromise(this._onStateChanged.event)}while(!0)},return:async()=>(this._onReturn?.(),{done:!0,value:void 0})}}static map(t,e){return new n(async r=>{for await(let i of t)r.emitOne(e(i))})}map(t){return n.map(this,t)}static filter(t,e){return new n(async r=>{for await(let i of t)e(i)&&r.emitOne(i)})}filter(t){return n.filter(this,t)}static coalesce(t){return n.filter(t,e=>!!e)}coalesce(){return n.coalesce(this)}static async toPromise(t){let e=[];for await(let r of t)e.push(r);return e}toPromise(){return n.toPromise(this)}emitOne(t){this._state===0&&(this._results.push(t),this._onStateChanged.fire())}emitMany(t){this._state===0&&(this._results=this._results.concat(t),this._onStateChanged.fire())}resolve(){this._state===0&&(this._state=1,this._onStateChanged.fire())}reject(t){this._state===0&&(this._state=2,this._error=t,this._onStateChanged.fire())}};function Eh(n,t){return t&&(n.stack||n.stacktrace)?p("stackTrace.format","{0}: {1}",qI(n),zI(n.stack)||zI(n.stacktrace)):qI(n)}function zI(n){return Array.isArray(n)?n.join(`
`):n}function qI(n){return n.code==="ERR_UNC_HOST_NOT_ALLOWED"?`${n.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`:typeof n.code=="string"&&typeof n.errno=="number"&&typeof n.syscall=="string"?p("nodeExceptionMessage","A system error occurred ({0})",n.message):n.message||p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function zt(n=null,t=!1){if(!n)return p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.");if(Array.isArray(n)){let e=Ye(n),r=zt(e[0],t);return e.length>1?p("error.moreErrors","{0} ({1} errors in total)",r,e.length):r}if(ke(n))return n;if(n.detail){let e=n.detail;if(e.error)return Eh(e.error,t);if(e.exception)return Eh(e.exception,t)}return n.stack?Eh(n,t):n.message?n.message:p("error.defaultMessage","An unknown error occurred. Please consult the log for more details.")}function ni(n,t){let{os:e,tildify:r,relative:i}=t;if(i){let a=WE(n,i,e);if(typeof a=="string")return a}let o=n.fsPath;if(e===1&&!U?o=o.replace(/\//g,"\\"):e!==1&&U&&(o=o.replace(/\\/g,"/")),e!==1&&r?.userHome){let a=r.userHome.fsPath,l;n.scheme!==r.userHome.scheme&&n.path[0]===ee.sep&&n.path[1]!==ee.sep?l=r.userHome.with({path:n.path}).fsPath:l=o,o=UE(l,a,e)}return(e===1?He:ee).normalize(Nl(o,e===1))}function WE(n,t,e){let r=e===1?He:ee,i=e===3?Se:eu,o=t.getWorkspace(),s=o.folders.at(0);if(!s)return;n.scheme!==s.uri.scheme&&n.path[0]===ee.sep&&n.path[1]!==ee.sep&&(n=s.uri.with({path:n.path}));let a=t.getWorkspaceFolder(n);if(!a)return;let l;if(i.isEqual(a.uri,n)?l="":l=i.relativePath(a.uri,n)??"",l&&(l=r.normalize(l)),o.folders.length>1&&!t.noPrefix){let c=a.name?a.name:i.basenameOrAuthority(a.uri);l=l?`${c} \u2022 ${l}`:c}return l}function Nl(n,t=U){return dh(n,t)?n.charAt(0).toUpperCase()+n.slice(1):n}var Ph=Object.create(null);function UE(n,t,e=xt){if(e===1||!n||!t)return n;let r=Ph.original===t?Ph.normalized:void 0;r||(r=t,U&&(r=Pn(r)),r=`${cn(r,ee.sep)}${ee.sep}`,Ph={original:t,normalized:r});let i=n;return U&&(i=Pn(i)),(e===3?i.startsWith(r):En(i,r))?`~/${i.substr(r.length)}`:n}function jI(n,t){return W||t?n.replace(/\(&&\w\)|&&/g,"").replace(/&/g,W?"&":"&&"):n.replace(/&&|&/g,e=>e==="&"?"&&":"&")}function bu(n,t){return W||t?n.replace(/\(&&\w\)|&&/g,""):U?n.replace(/&&|&/g,e=>e==="&"?"&&":"&"):n.replace(/&&/g,"_")}function GI(n){if(n.endsWith("]")){let t=n.lastIndexOf(" [",n.length-2);if(t!==-1){let e=$I(n.substring(0,t)),r=n.substring(t);return{name:e.name+r,parentPath:e.parentPath}}}return $I(n)}function $I(n){let t=n.indexOf("/")!==-1?ee:He,e=t.basename(n),r=t.dirname(n);return e.length?{name:e,parentPath:r}:{name:r,parentPath:""}}var Bl={exports:{}};(function(){function t(o){let s=[];typeof o=="number"&&s.push("code/timeOrigin",o);function a(c){s.push(c,Date.now())}function l(){let c=[];for(let d=0;d<s.length;d+=2)c.push({name:s[d],startTime:s[d+1]});return c}return{mark:a,getMarks:l}}function e(){if(typeof performance=="object"&&typeof performance.mark=="function"&&!performance.nodeTiming)return typeof performance.timeOrigin!="number"&&!performance.timing?t():{mark(o){performance.mark(o)},getMarks(){let o=performance.timeOrigin;typeof o!="number"&&(o=performance.timing.navigationStart||performance.timing.redirectStart||performance.timing.fetchStart);let s=[{name:"code/timeOrigin",startTime:Math.round(o)}];for(let a of performance.getEntriesByType("mark"))s.push({name:a.name,startTime:Math.round(o+a.startTime)});return s}};if(typeof process=="object"){let o=performance?.timeOrigin;return t(o)}else return console.trace("perf-util loaded in UNKNOWN environment"),t()}function r(o){return o.MonacoPerformanceMarks||(o.MonacoPerformanceMarks=e()),o.MonacoPerformanceMarks}var i;typeof global=="object"?i=global:typeof self=="object"?i=self:i={},typeof Bl=="object"&&typeof Bl.exports=="object"?Bl.exports=r(i):(console.trace("perf-util defined in UNKNOWN context (neither requirejs or commonjs)"),i.perf=r(i))})();var gt=Bl.exports.mark,wu=Bl.exports.getMarks;import*as fe from"fs";import{tmpdir as HE}from"os";import{promisify as Su}from"util";var BE=new Qn(1e4);function Rn(n){return KE(n,"NFC",BE)}var VA=new Qn(1e4);var VE=/[^\u0000-\u0080]/;function KE(n,t,e){if(!n)return n;let r=e.get(n);if(r)return r;let i;return VE.test(n)?i=n.normalize(t):i=n,e.set(n,i),i}async function QI(n,t=0,e){if(bI(n))throw new Error("rimraf - will refuse to recursively delete root");return t===0?Th(n):zE(n,e)}async function zE(n,t=bs(HE())){try{try{await fe.promises.rename(n,t)}catch(e){return e.code==="ENOENT"?void 0:Th(n)}Th(t).catch(e=>{})}catch(e){if(e.code!=="ENOENT")throw e}}async function Th(n){return fe.promises.rm(n,{recursive:!0,force:!0,maxRetries:3})}async function xu(n,t){return $E(await(t?qE(n):fe.promises.readdir(n)))}async function qE(n){try{return await fe.promises.readdir(n,{withFileTypes:!0})}catch(r){console.warn("[node.js fs] readdir with filetypes failed with error: ",r)}let t=[],e=await xu(n);for(let r of e){let i=!1,o=!1,s=!1;try{let a=await fe.promises.lstat(V(n,r));i=a.isFile(),o=a.isDirectory(),s=a.isSymbolicLink()}catch(a){console.warn("[node.js fs] unexpected error from lstat after readdir: ",a)}t.push({name:r,isFile:()=>i,isDirectory:()=>o,isSymbolicLink:()=>s})}return t}function $E(n){return n.map(t=>typeof t=="string"?W?Rn(t):t:(t.name=W?Rn(t.name):t.name,t))}async function jE(n){let t=await xu(n),e=[];for(let r of t)await Pt.existsDirectory(V(n,r))&&e.push(r);return e}function YI(n,t=1e3){return new Promise(e=>{let r=!1,i=setInterval(()=>{r||(r=!0,fe.access(n,o=>{r=!1,o&&(clearInterval(i),e(void 0))}))},t)})}var Pt;(r=>{async function n(i){let o;try{if(o=await fe.promises.lstat(i),!o.isSymbolicLink())return{stat:o}}catch{}try{return{stat:await fe.promises.stat(i),symbolicLink:o?.isSymbolicLink()?{dangling:!1}:void 0}}catch(s){if(s.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};if(U&&s.code==="EACCES")try{return{stat:await fe.promises.stat(await fe.promises.readlink(i)),symbolicLink:{dangling:!1}}}catch(a){if(a.code==="ENOENT"&&o)return{stat:o,symbolicLink:{dangling:!0}};throw a}throw s}}r.stat=n;async function t(i){try{let{stat:o,symbolicLink:s}=await r.stat(i);return o.isFile()&&s?.dangling!==!0}catch{}return!1}r.existsFile=t;async function e(i){try{let{stat:o,symbolicLink:s}=await r.stat(i);return o.isDirectory()&&s?.dangling!==!0}catch{}return!1}r.existsDirectory=e})(Pt||={});var GE=new Es;function JE(n,t,e){return GE.queueFor(x.file(n),()=>{let r=XE(e);return new Promise((i,o)=>YE(n,t,r,s=>s?o(s):i()))},Le)}var XI=!0;function QE(n){XI=n}function YE(n,t,e,r){if(!XI)return fe.writeFile(n,t,{mode:e.mode,flag:e.flag},r);fe.open(n,e.flag,e.mode,(i,o)=>{if(i)return r(i);fe.writeFile(o,t,s=>{if(s)return fe.close(o,()=>r(s));fe.fdatasync(o,a=>(a&&(console.warn("[node.js fs] fdatasync is now disabled for this session because it failed: ",a),QE(!1)),fe.close(o,l=>r(l))))})})}function XE(n){return n?{mode:typeof n.mode=="number"?n.mode:438,flag:typeof n.flag=="string"?n.flag:"w"}:{mode:438,flag:"w"}}async function ZE(n,t,e=6e4){if(n!==t)try{U&&typeof e=="number"?await ZI(n,t,Date.now(),e):await fe.promises.rename(n,t)}catch(r){if(n.toLowerCase()!==t.toLowerCase()&&r.code==="EXDEV"||n.endsWith("."))await eb(n,t,{preserveSymlinks:!1}),await QI(n,1);else throw r}}async function ZI(n,t,e,r,i=0){try{return await fe.promises.rename(n,t)}catch(o){if(o.code!=="EACCES"&&o.code!=="EPERM"&&o.code!=="EBUSY")throw o;if(Date.now()-e>=r)throw console.error(`[node.js fs] rename failed after ${i} retries with error: ${o}`),o;if(i===0){let s=!1;try{let{stat:a}=await Pt.stat(t);a.isFile()||(s=!0)}catch{}if(s)throw o}return await nt(Math.min(100,i*10)),ZI(n,t,e,r,i+1)}}async function eb(n,t,e){return tb(n,t,{root:{source:n,target:t},options:e,handledSourcePaths:new Set})}var JI=511;async function tb(n,t,e){if(e.handledSourcePaths.has(n))return;e.handledSourcePaths.add(n);let{stat:r,symbolicLink:i}=await Pt.stat(n);if(i){if(e.options.preserveSymlinks)try{return await rP(n,t,e)}catch{}if(i.dangling)return}return r.isDirectory()?eP(n,t,r.mode&JI,e):tP(n,t,r.mode&JI)}async function eP(n,t,e,r){await fe.promises.mkdir(t,{recursive:!0,mode:e});let i=await xu(n);for(let o of i)await tb(V(n,o),V(t,o),r)}async function tP(n,t,e){await fe.promises.copyFile(n,t),await fe.promises.chmod(t,e)}async function rP(n,t,e){let r=await fe.promises.readlink(n);ti(r,e.root.source,!Q)&&(r=V(e.root.target,r.substr(e.root.source.length+1))),await fe.promises.symlink(r,t)}var q=new class{get read(){return(n,t,e,r,i)=>new Promise((o,s)=>{fe.read(n,t,e,r,i,(a,l,c)=>a?s(a):o({bytesRead:l,buffer:c}))})}get write(){return(n,t,e,r,i)=>new Promise((o,s)=>{fe.write(n,t,e,r,i,(a,l,c)=>a?s(a):o({bytesWritten:l,buffer:c}))})}get fdatasync(){return Su(fe.fdatasync)}get open(){return Su(fe.open)}get close(){return Su(fe.close)}get realpath(){return Su(fe.realpath)}async exists(n){try{return await fe.promises.access(n),!0}catch{return!1}}get readdir(){return xu}get readDirsInDir(){return jE}get writeFile(){return JE}get rm(){return QI}get rename(){return ZE}get copy(){return eb}};function Vl(n){let t=n;return t?[t.on,t.pause,t.resume,t.destroy].every(e=>typeof e=="function"):!1}function Eu(n){let t=n;return t?Vl(t.stream)&&Array.isArray(t.buffer)&&typeof t.ended=="boolean":!1}function Di(n,t){return new Ch(n,t)}var Ch=class{constructor(t,e){this.reducer=t;this.options=e}state={flowing:!1,ended:!1,destroyed:!1};buffer={data:[],error:[]};listeners={data:[],error:[],end:[]};pendingWritePromises=[];pause(){this.state.destroyed||(this.state.flowing=!1)}resume(){this.state.destroyed||this.state.flowing||(this.state.flowing=!0,this.flowData(),this.flowErrors(),this.flowEnd())}write(t){if(!this.state.destroyed){if(this.state.flowing)this.emitData(t);else if(this.buffer.data.push(t),typeof this.options?.highWaterMark=="number"&&this.buffer.data.length>this.options.highWaterMark)return new Promise(e=>this.pendingWritePromises.push(e))}}error(t){this.state.destroyed||(this.state.flowing?this.emitError(t):this.buffer.error.push(t))}end(t){this.state.destroyed||(typeof t<"u"&&this.write(t),this.state.flowing?(this.emitEnd(),this.destroy()):this.state.ended=!0)}emitData(t){this.listeners.data.slice(0).forEach(e=>e(t))}emitError(t){this.listeners.error.length===0?Je(t):this.listeners.error.slice(0).forEach(e=>e(t))}emitEnd(){this.listeners.end.slice(0).forEach(t=>t())}on(t,e){if(!this.state.destroyed)switch(t){case"data":this.listeners.data.push(e),this.resume();break;case"end":this.listeners.end.push(e),this.state.flowing&&this.flowEnd()&&this.destroy();break;case"error":this.listeners.error.push(e),this.state.flowing&&this.flowErrors();break}}removeListener(t,e){if(this.state.destroyed)return;let r;switch(t){case"data":r=this.listeners.data;break;case"end":r=this.listeners.end;break;case"error":r=this.listeners.error;break}if(r){let i=r.indexOf(e);i>=0&&r.splice(i,1)}}flowData(){if(this.buffer.data.length>0){let t=this.reducer(this.buffer.data);this.emitData(t),this.buffer.data.length=0;let e=[...this.pendingWritePromises];this.pendingWritePromises.length=0,e.forEach(r=>r())}}flowErrors(){if(this.listeners.error.length>0){for(let t of this.buffer.error)this.emitError(t);this.buffer.error.length=0}}flowEnd(){return this.state.ended?(this.emitEnd(),this.listeners.end.length>0):!1}destroy(){this.state.destroyed||(this.state.destroyed=!0,this.state.ended=!0,this.buffer.data.length=0,this.buffer.error.length=0,this.listeners.data.length=0,this.listeners.error.length=0,this.listeners.end.length=0,this.pendingWritePromises.length=0)}};function rb(n,t){let e=[],r;for(;(r=n.read())!==null;)e.push(r);return t(e)}function nb(n,t,e){let r=[],i;for(;(i=n.read())!==null&&r.length<e;)r.push(i);return i===null&&r.length>0?t(r):{read:()=>{if(r.length>0)return r.shift();if(typeof i<"u"){let o=i;return i=void 0,o}return n.read()}}}function Pu(n,t){return new Promise((e,r)=>{let i=[];Ts(n,{onData:o=>{t&&i.push(o)},onError:o=>{t?r(o):e(void 0)},onEnd:()=>{e(t?t(i):void 0)}})})}function Ts(n,t,e){n.on("error",r=>{e?.isCancellationRequested||t.onError(r)}),n.on("end",()=>{e?.isCancellationRequested||t.onEnd()}),n.on("data",r=>{e?.isCancellationRequested||t.onData(r)})}function ib(n,t){return new Promise((e,r)=>{let i=new Y,o=[],s=c=>{if(o.push(c),o.length>t)return i.dispose(),n.pause(),e({stream:n,buffer:o,ended:!1})},a=c=>(i.dispose(),r(c)),l=()=>(i.dispose(),e({stream:n,buffer:o,ended:!0}));i.add($(()=>n.removeListener("error",a))),n.on("error",a),i.add($(()=>n.removeListener("end",l))),n.on("end",l),i.add($(()=>n.removeListener("data",s))),n.on("data",s)})}function ob(n){let t=!1;return{read:()=>t?null:(t=!0,n)}}function Tu(n,t,e){let r=Di(e);return Ts(n,{onData:i=>r.write(t.data(i)),onError:i=>r.error(t.error?t.error(i):i),onEnd:()=>r.end()}),r}var Cu=typeof Buffer<"u",iP=new Ir(()=>new Uint8Array(256)),kh,_h,K=class n{static alloc(t){return Cu?new n(Buffer.allocUnsafe(t)):new n(new Uint8Array(t))}static wrap(t){return Cu&&!Buffer.isBuffer(t)&&(t=Buffer.from(t.buffer,t.byteOffset,t.byteLength)),new n(t)}static fromString(t,e){return!(e?.dontUseNodeBuffer||!1)&&Cu?new n(Buffer.from(t)):(kh||(kh=new TextEncoder),new n(kh.encode(t)))}static fromByteArray(t){let e=n.alloc(t.length);for(let r=0,i=t.length;r<i;r++)e.buffer[r]=t[r];return e}static concat(t,e){if(typeof e>"u"){e=0;for(let o=0,s=t.length;o<s;o++)e+=t[o].byteLength}let r=n.alloc(e),i=0;for(let o=0,s=t.length;o<s;o++){let a=t[o];r.set(a,i),i+=a.byteLength}return r}buffer;byteLength;constructor(t){this.buffer=t,this.byteLength=this.buffer.byteLength}clone(){let t=n.alloc(this.byteLength);return t.set(this),t}toString(){return Cu?this.buffer.toString():(_h||(_h=new TextDecoder),_h.decode(this.buffer))}slice(t,e){return new n(this.buffer.subarray(t,e))}set(t,e){if(t instanceof n)this.buffer.set(t.buffer,e);else if(t instanceof Uint8Array)this.buffer.set(t,e);else if(t instanceof ArrayBuffer)this.buffer.set(new Uint8Array(t),e);else if(ArrayBuffer.isView(t))this.buffer.set(new Uint8Array(t.buffer,t.byteOffset,t.byteLength),e);else throw new Error("Unknown argument 'array'")}readUInt32BE(t){return sP(this.buffer,t)}writeUInt32BE(t,e){aP(this.buffer,t,e)}readUInt32LE(t){return lP(this.buffer,t)}writeUInt32LE(t,e){cP(this.buffer,t,e)}readUInt8(t){return dP(this.buffer,t)}writeUInt8(t,e){uP(this.buffer,t,e)}indexOf(t,e=0){return oP(this.buffer,t instanceof n?t.buffer:t,e)}};function oP(n,t,e=0){let r=t.byteLength,i=n.byteLength;if(r===0)return 0;if(r===1)return n.indexOf(t[0]);if(r>i-e)return-1;let o=iP.value;o.fill(t.length);for(let c=0;c<t.length;c++)o[t[c]]=t.length-c-1;let s=e+t.length-1,a=s,l=-1;for(;s<i;)if(n[s]===t[a]){if(a===0){l=s;break}s--,a--}else s+=Math.max(t.length-a,o[n[s]]),a=t.length-1;return l}function sP(n,t){return n[t]*2**24+n[t+1]*2**16+n[t+2]*2**8+n[t+3]}function aP(n,t,e){n[e+3]=t,t=t>>>8,n[e+2]=t,t=t>>>8,n[e+1]=t,t=t>>>8,n[e]=t}function lP(n,t){return n[t+0]<<0>>>0|n[t+1]<<8>>>0|n[t+2]<<16>>>0|n[t+3]<<24>>>0}function cP(n,t,e){n[e+0]=t&255,t=t>>>8,n[e+1]=t&255,t=t>>>8,n[e+2]=t&255,t=t>>>8,n[e+3]=t&255}function dP(n,t){return n[t]}function uP(n,t,e){n[e]=t}function sb(n){return rb(n,t=>K.concat(t))}function ab(n){return ob(n)}function ii(n){return Pu(n,t=>K.concat(t))}async function lb(n){return n.ended?K.concat(n.buffer):K.concat([...n.buffer,await ii(n.stream)])}function cb(n){return Tu(n,{data:t=>typeof t=="string"?K.fromString(t):K.wrap(t)},t=>K.concat(t))}function db(n){return Di(t=>K.concat(t),n)}function ie(n,t,e){let r=null,i=null;if(typeof e.value=="function"?(r="value",i=e.value,i.length!==0&&console.warn("Memoize should only be used in functions with zero parameters")):typeof e.get=="function"&&(r="get",i=e.get),!i)throw new Error("not supported");let o=`$memoize$${t}`;e[r]=function(...s){return this.hasOwnProperty(o)||Object.defineProperty(this,o,{configurable:!1,enumerable:!1,writable:!1,value:i.apply(this,s)}),this[o]}}function ub(n){return JSON.stringify(n,pP)}function pb(n){let t=JSON.parse(n);return t=dn(t),t}function pP(n,t){return t instanceof RegExp?{$mid:2,source:t.source,flags:t.flags}:t}function dn(n,t=0){if(!n||t>200)return n;if(typeof n=="object"){switch(n.$mid){case 1:return x.revive(n);case 2:return new RegExp(n.source,n.flags);case 17:return new Date(n.source)}if(n instanceof K||n instanceof Uint8Array)return n;if(Array.isArray(n))for(let e=0;e<n.length;++e)n[e]=dn(n[e],t+1);else for(let e in n)Object.hasOwnProperty.call(n,e)&&(n[e]=dn(n[e],t+1))}return n}function _s(n){switch(n){case 100:return"req";case 101:return"cancel";case 102:return"subscribe";case 103:return"unsubscribe"}}function ku(n){switch(n){case 200:return"init";case 201:return"reply:";case 202:case 203:return"replyErr:";case 204:return"event:"}}function Cs(n){let t=0;for(let e=0;;e+=7){let r=n.read(1);if(t|=(r.buffer[0]&127)<<e,!(r.buffer[0]&128))return t}}var fP=Oi(0);function ks(n,t){if(t===0){n.write(fP);return}let e=0;for(let i=t;i!==0;i=i>>>7)e++;let r=K.alloc(e);for(let i=0;t!==0;i++)r.buffer[i]=t&127,t=t>>>7,t>0&&(r.buffer[i]|=128);n.write(r)}var Kl=class{constructor(t){this.buffer=t}pos=0;read(t){let e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=e.byteLength,e}},Hl=class{buffers=[];get buffer(){return K.concat(this.buffers)}write(t){this.buffers.push(t)}};function Oi(n){let t=K.alloc(1);return t.writeUInt8(n,0),t}var _o={Undefined:Oi(0),String:Oi(1),Buffer:Oi(2),VSBuffer:Oi(3),Array:Oi(4),Object:Oi(5),Uint:Oi(6)},mP=typeof Buffer<"u";function Rs(n,t){if(typeof t>"u")n.write(_o.Undefined);else if(typeof t=="string"){let e=K.fromString(t);n.write(_o.String),ks(n,e.byteLength),n.write(e)}else if(mP&&Buffer.isBuffer(t)){let e=K.wrap(t);n.write(_o.Buffer),ks(n,e.byteLength),n.write(e)}else if(t instanceof K)n.write(_o.VSBuffer),ks(n,t.byteLength),n.write(t);else if(Array.isArray(t)){n.write(_o.Array),ks(n,t.length);for(let e of t)Rs(n,e)}else if(typeof t=="number"&&(t|0)===t)n.write(_o.Uint),ks(n,t);else{let e=K.fromString(JSON.stringify(t));n.write(_o.Object),ks(n,e.byteLength),n.write(e)}}function Ds(n){switch(n.read(1).readUInt8(0)){case 0:return;case 1:return n.read(Cs(n)).toString();case 2:return n.read(Cs(n)).buffer;case 3:return n.read(Cs(n));case 4:{let e=Cs(n),r=[];for(let i=0;i<e;i++)r.push(Ds(n));return r}case 5:return JSON.parse(n.read(Cs(n)).toString());case 6:return Cs(n)}}var zl=class{constructor(t,e,r=null,i=1e3){this.protocol=t;this.ctx=e;this.logger=r;this.timeoutDelay=i;this.protocolListener=this.protocol.onMessage(o=>this.onRawMessage(o)),this.sendResponse({type:200})}channels=new Map;activeRequests=new Map;protocolListener;pendingRequests=new Map;registerChannel(t,e){this.channels.set(t,e),setTimeout(()=>this.flushPendingRequests(t),0)}sendResponse(t){switch(t.type){case 200:{let e=this.send([t.type]);this.logger?.logOutgoing(e,0,1,ku(t.type));return}case 201:case 202:case 204:case 203:{let e=this.send([t.type,t.id],t.data);this.logger?.logOutgoing(e,t.id,1,ku(t.type),t.data);return}}}send(t,e=void 0){let r=new Hl;return Rs(r,t),Rs(r,e),this.sendBuffer(r.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onRawMessage(t){let e=new Kl(t),r=Ds(e),i=Ds(e),o=r[0];switch(o){case 100:return this.logger?.logIncoming(t.byteLength,r[1],1,`${_s(o)}: ${r[2]}.${r[3]}`,i),this.onPromise({type:o,id:r[1],channelName:r[2],name:r[3],arg:i});case 102:return this.logger?.logIncoming(t.byteLength,r[1],1,`${_s(o)}: ${r[2]}.${r[3]}`,i),this.onEventListen({type:o,id:r[1],channelName:r[2],name:r[3],arg:i});case 101:return this.logger?.logIncoming(t.byteLength,r[1],1,`${_s(o)}`),this.disposeActiveRequest({type:o,id:r[1]});case 103:return this.logger?.logIncoming(t.byteLength,r[1],1,`${_s(o)}`),this.disposeActiveRequest({type:o,id:r[1]})}}onPromise(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let r=new rt,i;try{i=e.call(this.ctx,t.name,t.arg,r.token)}catch(a){i=Promise.reject(a)}let o=t.id;i.then(a=>{this.sendResponse({id:o,data:a,type:201})},a=>{a instanceof Error?this.sendResponse({id:o,data:{message:a.message,name:a.name,stack:a.stack?a.stack.split(`
`):void 0},type:202}):this.sendResponse({id:o,data:a,type:203})}).finally(()=>{s.dispose(),this.activeRequests.delete(t.id)});let s=$(()=>r.cancel());this.activeRequests.set(t.id,s)}onEventListen(t){let e=this.channels.get(t.channelName);if(!e){this.collectPendingRequest(t);return}let r=t.id,o=e.listen(this.ctx,t.name,t.arg)(s=>this.sendResponse({id:r,data:s,type:204}));this.activeRequests.set(t.id,o)}disposeActiveRequest(t){let e=this.activeRequests.get(t.id);e&&(e.dispose(),this.activeRequests.delete(t.id))}collectPendingRequest(t){let e=this.pendingRequests.get(t.channelName);e||(e=[],this.pendingRequests.set(t.channelName,e));let r=setTimeout(()=>{console.error(`Unknown channel: ${t.channelName}`),t.type===100&&this.sendResponse({id:t.id,data:{name:"Unknown channel",message:`Channel name '${t.channelName}' timed out after ${this.timeoutDelay}ms`,stack:void 0},type:202})},this.timeoutDelay);e.push({request:t,timeoutTimer:r})}flushPendingRequests(t){let e=this.pendingRequests.get(t);if(e){for(let r of e)switch(clearTimeout(r.timeoutTimer),r.request.type){case 100:this.onPromise(r.request);break;case 102:this.onEventListen(r.request);break}this.pendingRequests.delete(t)}}dispose(){this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),ze(this.activeRequests.values()),this.activeRequests.clear()}};var Ro=class{constructor(t,e=null){this.protocol=t;this.protocolListener=this.protocol.onMessage(r=>this.onBuffer(r)),this.logger=e}isDisposed=!1;state=0;activeRequests=new Set;handlers=new Map;lastRequestId=0;protocolListener;logger;_onDidInitialize=new S;onDidInitialize=this._onDidInitialize.event;getChannel(t){let e=this;return{call(r,i,o){return e.isDisposed?Promise.reject(new at):e.requestPromise(t,r,i,o)},listen(r,i){return e.isDisposed?E.None:e.requestEvent(t,r,i)}}}requestPromise(t,e,r,i=we.None){let o=this.lastRequestId++,a={id:o,type:100,channelName:t,name:e,arg:r};if(i.isCancellationRequested)return Promise.reject(new at);let l;return new Promise((d,u)=>{if(i.isCancellationRequested)return u(new at);let m=()=>{let b=C=>{switch(C.type){case 201:this.handlers.delete(o),d(C.data);break;case 202:{this.handlers.delete(o);let k=new Error(C.data.message);k.stack=Array.isArray(C.data.stack)?C.data.stack.join(`
`):C.data.stack,k.name=C.data.name,u(k);break}case 203:this.handlers.delete(o),u(C.data);break}};this.handlers.set(o,b),this.sendRequest(a)},h=null;this.state===1?m():(h=ri(b=>this.whenInitialized()),h.then(()=>{h=null,m()}));let y=()=>{h?(h.cancel(),h=null):this.sendRequest({id:o,type:101}),u(new at)},v=i.onCancellationRequested(y);l=Fd($(y),v),this.activeRequests.add(l)}).finally(()=>{l.dispose(),this.activeRequests.delete(l)})}requestEvent(t,e,r){let i=this.lastRequestId++,s={id:i,type:102,channelName:t,name:e,arg:r},a=null,l=new S({onWillAddFirstListener:()=>{a=ri(d=>this.whenInitialized()),a.then(()=>{a=null,this.activeRequests.add(l),this.sendRequest(s)})},onDidRemoveLastListener:()=>{a?(a.cancel(),a=null):(this.activeRequests.delete(l),this.sendRequest({id:i,type:103}))}}),c=d=>l.fire(d.data);return this.handlers.set(i,c),l.event}sendRequest(t){switch(t.type){case 100:case 102:{let e=this.send([t.type,t.id,t.channelName,t.name],t.arg);this.logger?.logOutgoing(e,t.id,0,`${_s(t.type)}: ${t.channelName}.${t.name}`,t.arg);return}case 101:case 103:{let e=this.send([t.type,t.id]);this.logger?.logOutgoing(e,t.id,0,_s(t.type));return}}}send(t,e=void 0){let r=new Hl;return Rs(r,t),Rs(r,e),this.sendBuffer(r.buffer)}sendBuffer(t){try{return this.protocol.send(t),t.byteLength}catch{return 0}}onBuffer(t){let e=new Kl(t),r=Ds(e),i=Ds(e),o=r[0];switch(o){case 200:return this.logger?.logIncoming(t.byteLength,0,0,ku(o)),this.onResponse({type:r[0]});case 201:case 202:case 204:case 203:return this.logger?.logIncoming(t.byteLength,r[1],0,ku(o),i),this.onResponse({type:r[0],id:r[1],data:i})}}onResponse(t){if(t.type===200){this.state=1,this._onDidInitialize.fire();return}this.handlers.get(t.id)?.(t)}get onDidInitializePromise(){return E.toPromise(this.onDidInitialize)}whenInitialized(){return this.state===1?Promise.resolve():this.onDidInitializePromise}dispose(){this.isDisposed=!0,this.protocolListener&&(this.protocolListener.dispose(),this.protocolListener=null),ze(this.activeRequests.values()),this.activeRequests.clear()}};P([ie],Ro.prototype,"onDidInitializePromise",1);var Os=class{channels=new Map;_connections=new Set;_onDidAddConnection=new S;onDidAddConnection=this._onDidAddConnection.event;_onDidRemoveConnection=new S;onDidRemoveConnection=this._onDidRemoveConnection.event;disposables=new Y;get connections(){let t=[];return this._connections.forEach(e=>t.push(e)),t}constructor(t,e,r){this.disposables.add(t(({protocol:i,onDidClientDisconnect:o})=>{let s=E.once(i.onMessage);this.disposables.add(s(a=>{let l=new Kl(a),c=Ds(l),d=new zl(i,c,e,r),u=new Ro(i,e);this.channels.forEach((h,y)=>d.registerChannel(y,h));let m={channelServer:d,channelClient:u,ctx:c};this._connections.add(m),this._onDidAddConnection.fire(m),this.disposables.add(o(()=>{d.dispose(),u.dispose(),this._connections.delete(m),this._onDidRemoveConnection.fire(m)}))}))}))}getChannel(t,e){let r=this;return{call(i,o,s){let a;if(jd(e)){let c=aI(r.connections.filter(e));a=c?Promise.resolve(c):E.toPromise(E.filter(r.onDidAddConnection,e))}else a=e.routeCall(r,i,o);let l=a.then(c=>c.channelClient.getChannel(t));return ql(l).call(i,o,s)},listen(i,o){if(jd(e))return r.getMulticastEvent(t,e,i,o);let s=e.routeEvent(r,i,o).then(a=>a.channelClient.getChannel(t));return ql(s).listen(i,o)}}}getMulticastEvent(t,e,r,i){let o=this,s,a=new S({onWillAddFirstListener:()=>{s=new Y;let l=new qd,c=new Map,d=m=>{let y=m.channelClient.getChannel(t).listen(r,i),v=l.add(y);c.set(m,v)},u=m=>{let h=c.get(m);h&&(h.dispose(),c.delete(m))};o.connections.filter(e).forEach(d),E.filter(o.onDidAddConnection,e)(d,void 0,s),o.onDidRemoveConnection(u,void 0,s),l.event(a.fire,a,s),s.add(l)},onDidRemoveLastListener:()=>{s?.dispose(),s=void 0}});return a.event}registerChannel(t,e){this.channels.set(t,e);for(let r of this._connections)r.channelServer.registerChannel(t,e)}dispose(){this.disposables.dispose();for(let t of this._connections)t.channelClient.dispose(),t.channelServer.dispose();this._connections.clear(),this.channels.clear(),this._onDidAddConnection.dispose(),this._onDidRemoveConnection.dispose()}},Fs=class{channelClient;channelServer;constructor(t,e,r=null){let i=new Hl;Rs(i,e),t.send(i.buffer),this.channelClient=new Ro(t,r),this.channelServer=new zl(t,e,r)}getChannel(t){return this.channelClient.getChannel(t)}registerChannel(t,e){this.channelServer.registerChannel(t,e)}dispose(){this.channelClient.dispose(),this.channelServer.dispose()}};function ql(n){return{call(t,e,r){return n.then(i=>i.call(t,e,r))},listen(t,e){let r=new kl;return n.then(i=>r.input=i.listen(t,e)),r.event}}}function fb(n){let t=!1;return{call(e,r,i){return t?n.call(e,r,i):nt(0).then(()=>t=!0).then(()=>n.call(e,r,i))},listen(e,r){if(t)return n.listen(e,r);let i=new kl;return nt(0).then(()=>t=!0).then(()=>i.input=n.listen(e,r)),i.event}}}var _u=class{constructor(t){this.fn=t}routeCall(t){return this.route(t)}routeEvent(t){return this.route(t)}async route(t){for(let e of t.connections)if(await Promise.resolve(this.fn(e.ctx)))return Promise.resolve(e);return await E.toPromise(t.onDidAddConnection),await this.route(t)}},$e;(i=>{function n(o,s,a){let l=o,c=a&&a.disableMarshalling,d=new Map;for(let u in l)e(u)&&d.set(u,E.buffer(l[u],!0,void 0,s));return new class{listen(u,m,h){let y=d.get(m);if(y)return y;let v=l[m];if(typeof v=="function"){if(r(m))return v.call(l,h);if(e(m))return d.set(m,E.buffer(l[m],!0,void 0,s)),d.get(m)}throw new rn(`Event not found: ${m}`)}call(u,m,h){let y=l[m];if(typeof y=="function"){if(!c&&Array.isArray(h))for(let b=0;b<h.length;b++)h[b]=dn(h[b]);let v=y.apply(l,h);return v instanceof Promise||(v=Promise.resolve(v)),v}throw new rn(`Method not found: ${m}`)}}}i.fromService=n;function t(o,s){let a=s&&s.disableMarshalling;return new Proxy({},{get(l,c){if(typeof c=="string")return s?.properties?.has(c)?s.properties.get(c):r(c)?function(d){return o.listen(c,d)}:e(c)?o.listen(c):async function(...d){let u;s&&!ct(s.context)?u=[s.context,...d]:u=d;let m=await o.call(c,u);return a?m:dn(m)};throw new rn(`Property not found: ${String(c)}`)}})}i.toService=t;function e(o){return o[0]==="o"&&o[1]==="n"&&nh(o.charCodeAt(2))}function r(o){return/^onDynamic/.test(o)&&nh(o.charCodeAt(9))}})($e||={});var Lh;(s=>{s.enableDiagnostics=!1,s.records=[];let e=new WeakMap,r=0;function i(a,l){if(!e.has(a)){let c=String(++r);e.set(a,c)}return e.get(a)}function o(a,l,c,d){}s.traceSocketEvent=o})(Lh||={});var Rh=null;function Fi(){return Rh||(Rh=K.alloc(0)),Rh}var Ru=class{_chunks;_totalLength;get byteLength(){return this._totalLength}constructor(){this._chunks=[],this._totalLength=0}acceptChunk(t){this._chunks.push(t),this._totalLength+=t.byteLength}read(t){return this._read(t,!0)}peek(t){return this._read(t,!1)}_read(t,e){if(t===0)return Fi();if(t>this._totalLength)throw new Error("Cannot read so many bytes!");if(this._chunks[0].byteLength===t){let s=this._chunks[0];return e&&(this._chunks.shift(),this._totalLength-=t),s}if(this._chunks[0].byteLength>t){let s=this._chunks[0].slice(0,t);return e&&(this._chunks[0]=this._chunks[0].slice(t),this._totalLength-=t),s}let r=K.alloc(t),i=0,o=0;for(;t>0;){let s=this._chunks[o];if(s.byteLength>t){let a=s.slice(0,t);r.set(a,i),i+=t,e&&(this._chunks[o]=s.slice(t),this._totalLength-=t),t-=t}else r.set(s,i),i+=s.byteLength,e?(this._chunks.shift(),this._totalLength-=s.byteLength):o++,t-=s.byteLength}return r}};function mb(n){switch(n){case 0:return"None";case 1:return"Regular";case 2:return"Control";case 3:return"Ack";case 5:return"Disconnect";case 6:return"ReplayRequest";case 7:return"PauseWriting";case 8:return"ResumeWriting";case 9:return"KeepAlive"}}var Ur=class{constructor(t,e,r,i){this.type=t;this.id=e;this.ack=r;this.data=i;this.writtenTime=0}writtenTime;get size(){return this.data.byteLength}},$l=class extends D{_socket;_isDisposed;_incomingData;lastReadTime;_onMessage=this._register(new S);onMessage=this._onMessage.event;_state={readHead:!0,readLen:13,messageType:0,id:0,ack:0};constructor(t){super(),this._socket=t,this._isDisposed=!1,this._incomingData=new Ru,this._register(this._socket.onData(e=>this.acceptChunk(e))),this.lastReadTime=Date.now()}acceptChunk(t){if(!(!t||t.byteLength===0))for(this.lastReadTime=Date.now(),this._incomingData.acceptChunk(t);this._incomingData.byteLength>=this._state.readLen;){let e=this._incomingData.read(this._state.readLen);if(this._state.readHead)this._state.readHead=!1,this._state.readLen=e.readUInt32BE(9),this._state.messageType=e.readUInt8(0),this._state.id=e.readUInt32BE(1),this._state.ack=e.readUInt32BE(5),this._socket.traceSocketEvent("protocolHeaderRead",{messageType:mb(this._state.messageType),id:this._state.id,ack:this._state.ack,messageSize:this._state.readLen});else{let r=this._state.messageType,i=this._state.id,o=this._state.ack;if(this._state.readHead=!0,this._state.readLen=13,this._state.messageType=0,this._state.id=0,this._state.ack=0,this._socket.traceSocketEvent("protocolMessageRead",e),this._onMessage.fire(new Ur(r,i,o,e)),this._isDisposed)break}}}readEntireBuffer(){return this._incomingData.read(this._incomingData.byteLength)}dispose(){this._isDisposed=!0,super.dispose()}},jl=class{_isDisposed;_isPaused;_socket;_data;_totalLength;lastWriteTime;constructor(t){this._isDisposed=!1,this._isPaused=!1,this._socket=t,this._data=[],this._totalLength=0,this.lastWriteTime=0}dispose(){try{this.flush()}catch{}this._isDisposed=!0}drain(){return this.flush(),this._socket.drain()}flush(){this._writeNow()}pause(){this._isPaused=!0}resume(){this._isPaused=!1,this._scheduleWriting()}write(t){if(this._isDisposed)return;t.writtenTime=Date.now(),this.lastWriteTime=Date.now();let e=K.alloc(13);e.writeUInt8(t.type,0),e.writeUInt32BE(t.id,1),e.writeUInt32BE(t.ack,5),e.writeUInt32BE(t.data.byteLength,9),this._socket.traceSocketEvent("protocolHeaderWrite",{messageType:mb(t.type),id:t.id,ack:t.ack,messageSize:t.data.byteLength}),this._socket.traceSocketEvent("protocolMessageWrite",t.data),this._writeSoon(e,t.data)}_bufferAdd(t,e){let r=this._totalLength===0;return this._data.push(t,e),this._totalLength+=t.byteLength+e.byteLength,r}_bufferTake(){let t=K.concat(this._data,this._totalLength);return this._data.length=0,this._totalLength=0,t}_writeSoon(t,e){this._bufferAdd(t,e)&&this._scheduleWriting()}_writeNowTimeout=null;_scheduleWriting(){this._writeNowTimeout||(this._writeNowTimeout=setTimeout(()=>{this._writeNowTimeout=null,this._writeNow()}))}_writeNow(){if(this._totalLength===0||this._isPaused)return;let t=this._bufferTake();this._socket.traceSocketEvent("protocolWrite",{byteLength:t.byteLength}),this._socket.write(t)}},Gl=class extends D{_socket;_socketWriter;_socketReader;_onMessage=new S;onMessage=this._onMessage.event;_onDidDispose=new S;onDidDispose=this._onDidDispose.event;constructor(t){super(),this._socket=t,this._socketWriter=this._register(new jl(this._socket)),this._socketReader=this._register(new $l(this._socket)),this._register(this._socketReader.onMessage(e=>{e.type===1&&this._onMessage.fire(e.data)})),this._register(this._socket.onClose(()=>this._onDidDispose.fire()))}drain(){return this._socketWriter.drain()}getSocket(){return this._socket}sendDisconnect(){}send(t){this._socketWriter.write(new Ur(1,0,0,t))}},Jl=class n extends Fs{constructor(e,r,i=null){super(e,r,i);this.protocol=e}static fromSocket(e,r){return new n(new Gl(e),r)}get onDidDispose(){return this.protocol.onDidDispose}dispose(){super.dispose();let e=this.protocol.getSocket();this.protocol.sendDisconnect(),this.protocol.dispose(),e.end()}},Do=class{_emitter;event;_hasListeners=!1;_isDeliveringMessages=!1;_bufferedMessages=[];constructor(){this._emitter=new S({onWillAddFirstListener:()=>{this._hasListeners=!0,queueMicrotask(()=>this._deliverMessages())},onDidRemoveLastListener:()=>{this._hasListeners=!1}}),this.event=this._emitter.event}_deliverMessages(){if(!this._isDeliveringMessages){for(this._isDeliveringMessages=!0;this._hasListeners&&this._bufferedMessages.length>0;)this._emitter.fire(this._bufferedMessages.shift());this._isDeliveringMessages=!1}}fire(t){this._hasListeners?this._bufferedMessages.length>0?this._bufferedMessages.push(t):this._emitter.fire(t):this._bufferedMessages.push(t)}flushBuffer(){this._bufferedMessages=[]}},Dh=class{data;next;constructor(t){this.data=t,this.next=null}},Oh=class{_first;_last;constructor(){this._first=null,this._last=null}length(){let t=0,e=this._first;for(;e;)e=e.next,t++;return t}peek(){return this._first?this._first.data:null}toArray(){let t=[],e=0,r=this._first;for(;r;)t[e++]=r.data,r=r.next;return t}pop(){if(this._first){if(this._first===this._last){this._first=null,this._last=null;return}this._first=this._first.next}}push(t){let e=new Dh(t);if(!this._first){this._first=e,this._last=e;return}this._last.next=e,this._last=e}},Fh=class n{static _HISTORY_LENGTH=10;static _INSTANCE=null;static getInstance(){return n._INSTANCE||(n._INSTANCE=new n),n._INSTANCE}lastRuns;constructor(){this.lastRuns=[];let t=Date.now();for(let e=0;e<n._HISTORY_LENGTH;e++)this.lastRuns[e]=t-1e3*e;setInterval(()=>{for(let e=n._HISTORY_LENGTH;e>=1;e--)this.lastRuns[e]=this.lastRuns[e-1];this.lastRuns[0]=Date.now()},1e3)}load(){let t=Date.now(),e=(1+n._HISTORY_LENGTH)*1e3,r=0;for(let i=0;i<n._HISTORY_LENGTH;i++)t-this.lastRuns[i]<=e&&r++;return 1-r/n._HISTORY_LENGTH}hasHighLoad(){return this.load()>=.5}},Du=class{_isReconnecting;_didSendDisconnect;_outgoingUnackMsg;_outgoingMsgId;_outgoingAckId;_outgoingAckTimeout;_incomingMsgId;_incomingAckId;_incomingMsgLastTime;_incomingAckTimeout;_keepAliveInterval;_lastReplayRequestTime;_lastSocketTimeoutTime;_socket;_socketWriter;_socketReader;_socketDisposables;_loadEstimator;_shouldSendKeepAlive;_onControlMessage=new Do;onControlMessage=this._onControlMessage.event;_onMessage=new Do;onMessage=this._onMessage.event;_onDidDispose=new Do;onDidDispose=this._onDidDispose.event;_onSocketClose=new Do;onSocketClose=this._onSocketClose.event;_onSocketTimeout=new Do;onSocketTimeout=this._onSocketTimeout.event;get unacknowledgedCount(){return this._outgoingMsgId-this._outgoingAckId}constructor(t){this._loadEstimator=t.loadEstimator??Fh.getInstance(),this._shouldSendKeepAlive=t.sendKeepAlive??!0,this._isReconnecting=!1,this._outgoingUnackMsg=new Oh,this._outgoingMsgId=0,this._outgoingAckId=0,this._outgoingAckTimeout=null,this._incomingMsgId=0,this._incomingAckId=0,this._incomingMsgLastTime=0,this._incomingAckTimeout=null,this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socketDisposables=new Y,this._socket=t.socket,this._socketWriter=this._socketDisposables.add(new jl(this._socket)),this._socketReader=this._socketDisposables.add(new $l(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(e=>this._receiveMessage(e))),this._socketDisposables.add(this._socket.onClose(e=>this._onSocketClose.fire(e))),t.initialChunk&&this._socketReader.acceptChunk(t.initialChunk),this._shouldSendKeepAlive?this._keepAliveInterval=setInterval(()=>{this._sendKeepAlive()},5e3):this._keepAliveInterval=null}dispose(){this._outgoingAckTimeout&&(clearTimeout(this._outgoingAckTimeout),this._outgoingAckTimeout=null),this._incomingAckTimeout&&(clearTimeout(this._incomingAckTimeout),this._incomingAckTimeout=null),this._keepAliveInterval&&(clearInterval(this._keepAliveInterval),this._keepAliveInterval=null),this._socketDisposables.dispose()}drain(){return this._socketWriter.drain()}sendDisconnect(){if(!this._didSendDisconnect){this._didSendDisconnect=!0;let t=new Ur(5,0,0,Fi());this._socketWriter.write(t),this._socketWriter.flush()}}sendPause(){let t=new Ur(7,0,0,Fi());this._socketWriter.write(t)}sendResume(){let t=new Ur(8,0,0,Fi());this._socketWriter.write(t)}pauseSocketWriting(){this._socketWriter.pause()}getSocket(){return this._socket}getMillisSinceLastIncomingData(){return Date.now()-this._socketReader.lastReadTime}beginAcceptReconnection(t,e){this._isReconnecting=!0,this._socketDisposables.dispose(),this._socketDisposables=new Y,this._onControlMessage.flushBuffer(),this._onSocketClose.flushBuffer(),this._onSocketTimeout.flushBuffer(),this._socket.dispose(),this._lastReplayRequestTime=0,this._lastSocketTimeoutTime=Date.now(),this._socket=t,this._socketWriter=this._socketDisposables.add(new jl(this._socket)),this._socketReader=this._socketDisposables.add(new $l(this._socket)),this._socketDisposables.add(this._socketReader.onMessage(r=>this._receiveMessage(r))),this._socketDisposables.add(this._socket.onClose(r=>this._onSocketClose.fire(r))),this._socketReader.acceptChunk(e)}endAcceptReconnection(){this._isReconnecting=!1,this._incomingAckId=this._incomingMsgId;let t=new Ur(3,0,this._incomingAckId,Fi());this._socketWriter.write(t);let e=this._outgoingUnackMsg.toArray();for(let r=0,i=e.length;r<i;r++)this._socketWriter.write(e[r]);this._recvAckCheck()}acceptDisconnect(){this._onDidDispose.fire()}_receiveMessage(t){if(t.ack>this._outgoingAckId){this._outgoingAckId=t.ack;do{let e=this._outgoingUnackMsg.peek();if(e&&e.id<=t.ack)this._outgoingUnackMsg.pop();else break}while(!0)}switch(t.type){case 0:break;case 1:{if(t.id>this._incomingMsgId)if(t.id!==this._incomingMsgId+1){let e=Date.now();e-this._lastReplayRequestTime>1e4&&(this._lastReplayRequestTime=e,this._socketWriter.write(new Ur(6,0,0,Fi())))}else this._incomingMsgId=t.id,this._incomingMsgLastTime=Date.now(),this._sendAckCheck(),this._onMessage.fire(t.data);break}case 2:{this._onControlMessage.fire(t.data);break}case 3:break;case 5:{this._onDidDispose.fire();break}case 6:{let e=this._outgoingUnackMsg.toArray();for(let r=0,i=e.length;r<i;r++)this._socketWriter.write(e[r]);this._recvAckCheck();break}case 7:{this._socketWriter.pause();break}case 8:{this._socketWriter.resume();break}case 9:break}}readEntireBuffer(){return this._socketReader.readEntireBuffer()}flush(){this._socketWriter.flush()}send(t){let e=++this._outgoingMsgId;this._incomingAckId=this._incomingMsgId;let r=new Ur(1,e,this._incomingAckId,t);this._outgoingUnackMsg.push(r),this._isReconnecting||(this._socketWriter.write(r),this._recvAckCheck())}sendControl(t){let e=new Ur(2,0,0,t);this._socketWriter.write(e)}_sendAckCheck(){if(this._incomingMsgId<=this._incomingAckId||this._incomingAckTimeout)return;let t=Date.now()-this._incomingMsgLastTime;if(t>=2e3){this._sendAck();return}this._incomingAckTimeout=setTimeout(()=>{this._incomingAckTimeout=null,this._sendAckCheck()},2e3-t+5)}_recvAckCheck(){if(this._outgoingMsgId<=this._outgoingAckId||this._outgoingAckTimeout||this._isReconnecting)return;let t=this._outgoingUnackMsg.peek(),e=Date.now()-t.writtenTime,r=Date.now()-this._socketReader.lastReadTime,i=Date.now()-this._lastSocketTimeoutTime;if(e>=2e4&&r>=2e4&&i>=2e4&&!this._loadEstimator.hasHighLoad()){this._lastSocketTimeoutTime=Date.now(),this._onSocketTimeout.fire({unacknowledgedMsgCount:this._outgoingUnackMsg.length(),timeSinceOldestUnacknowledgedMsg:e,timeSinceLastReceivedSomeData:r});return}let o=Math.max(2e4-e,2e4-r,2e4-i,500);this._outgoingAckTimeout=setTimeout(()=>{this._outgoingAckTimeout=null,this._recvAckCheck()},o)}_sendAck(){if(this._incomingMsgId<=this._incomingAckId)return;this._incomingAckId=this._incomingMsgId;let t=new Ur(3,0,this._incomingAckId,Fi());this._socketWriter.write(t)}_sendKeepAlive(){this._incomingAckId=this._incomingMsgId;let t=new Ur(9,0,this._incomingAckId,Fi());this._socketWriter.write(t)}};import{createHash as yP}from"crypto";import{createServer as IP,createConnection as bP}from"net";var hP=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i;function hb(n){return hP.test(n)}var Ze=function(){if(typeof crypto=="object"&&typeof crypto.randomUUID=="function")return crypto.randomUUID.bind(crypto);let n;typeof crypto=="object"&&typeof crypto.getRandomValues=="function"?n=crypto.getRandomValues.bind(crypto):n=function(r){for(let i=0;i<r.length;i++)r[i]=Math.floor(Math.random()*256);return r};let t=new Uint8Array(16),e=[];for(let r=0;r<256;r++)e.push(r.toString(16).padStart(2,"0"));return function(){n(t),t[6]=t[6]&15|64,t[8]=t[8]&63|128;let i=0,o="";return o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+="-",o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o+=e[t[i++]],o}}();var wP=3e4,Oo=class{debugLabel;socket;_errorListener;_closeListener;_endListener;_canWrite=!0;traceSocketEvent(t,e){Lh.traceSocketEvent(this.socket,this.debugLabel,t,e)}constructor(t,e=""){this.debugLabel=e,this.socket=t,this.traceSocketEvent("created",{type:"NodeSocket"}),this._errorListener=i=>{if(this.traceSocketEvent("error",{code:i?.code,message:i?.message}),i){if(i.code==="EPIPE")return;Je(i)}},this.socket.on("error",this._errorListener);let r;this._closeListener=i=>{this.traceSocketEvent("close",{hadError:i}),this._canWrite=!1,r&&clearTimeout(r)},this.socket.on("close",this._closeListener),this._endListener=()=>{this.traceSocketEvent("nodeEndReceived"),this._canWrite=!1,r=setTimeout(()=>t.destroy(),wP)},this.socket.on("end",this._endListener)}dispose(){this.socket.off("error",this._errorListener),this.socket.off("close",this._closeListener),this.socket.off("end",this._endListener),this.socket.destroy()}onData(t){let e=r=>{this.traceSocketEvent("read",r),t(K.wrap(r))};return this.socket.on("data",e),{dispose:()=>this.socket.off("data",e)}}onClose(t){let e=r=>{t({type:0,hadError:r,error:void 0})};return this.socket.on("close",e),{dispose:()=>this.socket.off("close",e)}}onEnd(t){let e=()=>{t()};return this.socket.on("end",e),{dispose:()=>this.socket.off("end",e)}}write(t){if(!(this.socket.destroyed||!this._canWrite))try{this.traceSocketEvent("write",t),this.socket.write(t.buffer,e=>{if(e){if(e.code==="EPIPE")return;Je(e)}})}catch(e){if(e.code==="EPIPE")return;Je(e)}}end(){this.traceSocketEvent("nodeEndSent"),this.socket.end()}drain(){return this.traceSocketEvent("nodeDrainBegin"),new Promise((t,e)=>{if(this.socket.bufferSize===0){this.traceSocketEvent("nodeDrainEnd"),t();return}let r=()=>{this.socket.off("close",r),this.socket.off("end",r),this.socket.off("error",r),this.socket.off("timeout",r),this.socket.off("drain",r),this.traceSocketEvent("nodeDrainEnd"),t()};this.socket.on("close",r),this.socket.on("end",r),this.socket.on("error",r),this.socket.on("timeout",r),this.socket.on("drain",r)})}};var Ou=process.env.XDG_RUNTIME_DIR,SP={2:107,1:103};function gb(n,t,e){let i=yP("sha256").update(n).digest("hex").substr(0,8);if(process.platform==="win32")return`\\\\.\\pipe\\${i}-${e}-${t}-sock`;let o=e.substr(0,4),s=t.substr(0,6),a;return process.platform!=="darwin"&&Ou&&!process.env.VSCODE_PORTABLE?a=V(Ou,`vscode-${i}-${o}-${s}.sock`):a=V(n,`${o}-${s}.sock`),xP(a),a}function xP(n){let t=SP[mo];typeof t=="number"&&n.length>=t&&console.warn(`WARNING: IPC handle "${n}" is longer than ${t} chars, try a shorter --user-data-dir`)}var Mh=class n extends Os{static toClientConnectionEvent(t){let e=E.fromNodeEventEmitter(t,"connection");return E.map(e,r=>({protocol:new Gl(new Oo(r,"ipc-server-connection")),onDidClientDisconnect:E.once(E.fromNodeEventEmitter(r,"close"))}))}server;constructor(t){super(n.toClientConnectionEvent(t)),this.server=t}dispose(){super.dispose(),this.server&&(this.server.close(),this.server=null)}};function vb(n){return new Promise((t,e)=>{let r=IP();r.on("error",e),r.listen(n,()=>{r.removeListener("error",e),t(new Mh(r))})})}function yb(n,t){return new Promise((e,r)=>{let i=bP(n,()=>{i.removeListener("error",r),e(Jl.fromSocket(new Oo(i,`ipc-client${t}`),t))});i.once("error",r)})}import{app as Xo,BrowserWindow as U_,protocol as Ix,session as Za,systemPreferences as bx}from"electron";var Li={exports:{}};(function(){function t(){function e(){return process.uncHostAllowlist}function r(c){let d=new Set;if(Array.isArray(c))for(let u of c)typeof u=="string"&&d.add(u);return Array.from(d)}function i(){let c=e();return c?Array.from(c):[]}function o(c){if(process.platform!=="win32")return;let d=e();if(d)if(typeof c=="string")d.add(c.toLowerCase());else for(let u of r(c))o(u)}function s(c){if(typeof c!="string")return;let d=["\\\\.\\UNC\\","\\\\?\\UNC\\","\\\\"],u;for(let m of d){if(c.indexOf(m)!==0)continue;let y=c.indexOf("\\",m.length);if(y===-1)continue;let v=c.substring(m.length,y);if(v){u=v;break}}return u}function a(){process.platform==="win32"&&(process.restrictUNCAccess=!1)}function l(){return process.platform!=="win32"?!0:process.restrictUNCAccess===!1}return{getUNCHostAllowlist:i,addUNCHostToAllowlist:o,getUNCHost:s,disableUNCAccessRestrictions:a,isUNCAccessRestrictionsDisabled:l}}typeof Li=="object"&&typeof Li.exports=="object"?Li.exports=t():console.trace("vs/base/node/unc defined in UNKNOWN context (neither requirejs or commonjs)")})();var Ib=Li.exports.getUNCHost,bb=Li.exports.getUNCHostAllowlist,Ls=Li.exports.addUNCHostToAllowlist,wb=Li.exports.disableUNCAccessRestrictions,Sb=Li.exports.isUNCAccessRestrictionsDisabled;import Ql from"electron";var Wh=class{mapListenerToWrapper=new WeakMap;on(t,e){let r=(i,...o)=>{this.validateEvent(t,i)&&e(i,...o)};return this.mapListenerToWrapper.set(e,r),Ql.ipcMain.on(t,r),this}once(t,e){return Ql.ipcMain.once(t,(r,...i)=>{this.validateEvent(t,r)&&e(r,...i)}),this}handle(t,e){return Ql.ipcMain.handle(t,(r,...i)=>this.validateEvent(t,r)?e(r,...i):Promise.reject(`Invalid channel '${t}' or sender for ipcMain.handle() usage.`)),this}removeHandler(t){return Ql.ipcMain.removeHandler(t),this}removeListener(t,e){let r=this.mapListenerToWrapper.get(e);return r&&(Ql.ipcMain.removeListener(t,r),this.mapListenerToWrapper.delete(e)),this}validateEvent(t,e){if(!t||!t.startsWith("vscode:"))return Je(`Refused to handle ipcMain event for channel '${t}' because the channel is unknown.`),!1;let r=e.senderFrame,i=r.url;if(!i||i==="about:blank")return!0;let o="unknown";try{o=new URL(i).host}catch{return Je(`Refused to handle ipcMain event for channel '${t}' because of a malformed URL '${i}'.`),!1}return o!==xo?(Je(`Refused to handle ipcMain event for channel '${t}' because of a bad origin of '${o}'.`),!1):r.parent!==null?(Je(`Refused to handle ipcMain event for channel '${t}' because sender of origin '${o}' is not a main frame.`),!1):!0}},_e=new Wh;import{hostname as N_,release as B_}from"os";var Yl={exports:{}};(function(){function t(){let e=/("[^"\\]*(?:\\.[^"\\]*)*")|('[^'\\]*(?:\\.[^'\\]*)*')|(\/\*[^\/\*]*(?:(?:\*|\/)[^\/\*]*)*?\*\/)|(\/{2,}.*?(?:(?:\r?\n)|$))|(,\s*[}\]])/g;function r(o){return o.replace(e,function(s,a,l,c,d,u){if(c)return"";if(d){let m=d.length;return d[m-1]===`
`?d[m-2]==="\r"?`\r
`:`
`:""}else return u?s.substring(1):s})}function i(o){let s=r(o);try{return JSON.parse(s)}catch{let l=s.replace(/,\s*([}\]])/g,"$1");return JSON.parse(l)}}return{stripComments:r,parse:i}}typeof Yl=="object"&&typeof Yl.exports=="object"?Yl.exports=t():console.trace("jsonc defined in UNKNOWN context (neither requirejs or commonjs)")})();var dW=Yl.exports.stripComments,xb=Yl.exports.parse;import{Menu as EP,MenuItem as Uh}from"electron";var Eb="vscode:contextmenu",Pb="vscode:onCloseContextMenu";function Tb(){_e.on(Eb,(n,t,e,r,i)=>{let o=Cb(n,r,e);o.popup({x:i?i.x:void 0,y:i?i.y:void 0,positioningItem:i?i.positioningItem:void 0,callback:()=>{o&&n.sender.send(Pb,t)}})})}function Cb(n,t,e){let r=new EP;return e.forEach(i=>{let o;i.type==="separator"?o=new Uh({type:i.type}):Array.isArray(i.submenu)?o=new Uh({submenu:Cb(n,t,i.submenu),label:i.label}):o=new Uh({label:i.label,type:i.type,accelerator:i.accelerator,checked:i.checked,enabled:i.enabled,visible:i.visible,click:(s,a,l)=>n.sender.send(t,i.id,l)}),r.append(o)}),r}import"electron";var Fu=class{constructor(t,e){this.sender=t;this.onMessage=e}send(t){try{this.sender.send("vscode:message",t.buffer)}catch{}}disconnect(){this.sender.send("vscode:disconnect",null)}};function kb(n,t){let e=E.fromNodeEventEmitter(_e,t,(i,o)=>({event:i,message:o})),r=E.filter(e,({event:i})=>i.sender.id===n);return E.map(r,({message:i})=>i&&K.wrap(i))}var Lu=class n extends Os{static Clients=new Map;static getOnDidClientConnect(){let t=E.fromNodeEventEmitter(_e,"vscode:hello",({sender:e})=>e);return E.map(t,e=>{let r=e.id;n.Clients.get(r)?.dispose();let o=new S;n.Clients.set(r,$(()=>o.fire()));let s=kb(r,"vscode:message"),a=E.any(E.signal(kb(r,"vscode:disconnect")),o.event);return{protocol:new Fu(e,s),onDidClientDisconnect:a}})}constructor(){super(n.getOnDidClientConnect())}};import"electron";var Nh=class{constructor(t){this.port=t;t.start()}onMessage=E.fromDOMEventEmitter(this.port,"message",t=>t.data?K.wrap(t.data):K.alloc(0));send(t){this.port.postMessage(t.buffer)}disconnect(){this.port.close()}},Mu=class extends Fs{protocol;constructor(t,e){let r=new Nh(t);super(r,e),this.protocol=r}dispose(){this.protocol.disconnect(),super.dispose()}};var Ms=class extends Mu{constructor(t,e){super({addEventListener:(r,i)=>t.addListener(r,i),removeEventListener:(r,i)=>t.removeListener(r,i),postMessage:r=>t.postMessage(r),start:()=>t.start(),close:()=>t.close()},e)}};import{app as IC}from"electron";function qt(n){return Vh(n,0)}function Vh(n,t){switch(typeof n){case"object":return n===null?oi(349,t):Array.isArray(n)?TP(n,t):CP(n,t);case"string":return Db(n,t);case"boolean":return PP(n,t);case"number":return oi(n,t);case"undefined":return oi(937,t);default:return oi(617,t)}}function oi(n,t){return(t<<5)-t+n|0}function PP(n,t){return oi(n?433:863,t)}function Db(n,t){t=oi(149417,t);for(let e=0,r=n.length;e<r;e++)t=oi(n.charCodeAt(e),t);return t}function TP(n,t){return t=oi(104579,t),n.reduce((e,r)=>Vh(r,e),t)}function CP(n,t){return t=oi(181387,t),Object.keys(n).sort().reduce((e,r)=>(e=Db(r,e),Vh(n[r],e)),t)}function Bh(n,t,e=32){let r=e-t,i=~((1<<r)-1);return(n<<t|(i&n)>>>r)>>>0}function _b(n,t=0,e=n.byteLength,r=0){for(let i=0;i<e;i++)n[t+i]=r}function kP(n,t,e="0"){for(;n.length<t;)n=e+n;return n}function Xl(n,t=32){return n instanceof ArrayBuffer?Array.from(new Uint8Array(n)).map(e=>e.toString(16).padStart(2,"0")).join(""):kP((n>>>0).toString(16),t/4)}var Rb=class n{static _bigBlock32=new DataView(new ArrayBuffer(320));_h0=1732584193;_h1=4023233417;_h2=2562383102;_h3=271733878;_h4=3285377520;_buff;_buffDV;_buffLen;_totalLen;_leftoverHighSurrogate;_finished;constructor(){this._buff=new Uint8Array(67),this._buffDV=new DataView(this._buff.buffer),this._buffLen=0,this._totalLen=0,this._leftoverHighSurrogate=0,this._finished=!1}update(t){let e=t.length;if(e===0)return;let r=this._buff,i=this._buffLen,o=this._leftoverHighSurrogate,s,a;for(o!==0?(s=o,a=-1,o=0):(s=t.charCodeAt(0),a=0);;){let l=s;if(hI(s))if(a+1<e){let c=t.charCodeAt(a+1);ih(c)?(a++,l=gI(s,c)):l=65533}else{o=s;break}else ih(s)&&(l=65533);if(i=this._push(r,i,l),a++,a<e)s=t.charCodeAt(a);else break}this._buffLen=i,this._leftoverHighSurrogate=o}_push(t,e,r){return r<128?t[e++]=r:r<2048?(t[e++]=192|(r&1984)>>>6,t[e++]=128|(r&63)>>>0):r<65536?(t[e++]=224|(r&61440)>>>12,t[e++]=128|(r&4032)>>>6,t[e++]=128|(r&63)>>>0):(t[e++]=240|(r&1835008)>>>18,t[e++]=128|(r&258048)>>>12,t[e++]=128|(r&4032)>>>6,t[e++]=128|(r&63)>>>0),e>=64&&(this._step(),e-=64,this._totalLen+=64,t[0]=t[64],t[1]=t[65],t[2]=t[66]),e}digest(){return this._finished||(this._finished=!0,this._leftoverHighSurrogate&&(this._leftoverHighSurrogate=0,this._buffLen=this._push(this._buff,this._buffLen,65533)),this._totalLen+=this._buffLen,this._wrapUp()),Xl(this._h0)+Xl(this._h1)+Xl(this._h2)+Xl(this._h3)+Xl(this._h4)}_wrapUp(){this._buff[this._buffLen++]=128,_b(this._buff,this._buffLen),this._buffLen>56&&(this._step(),_b(this._buff));let t=8*this._totalLen;this._buffDV.setUint32(56,Math.floor(t/4294967296),!1),this._buffDV.setUint32(60,t%4294967296,!1),this._step()}_step(){let t=n._bigBlock32,e=this._buffDV;for(let u=0;u<64;u+=4)t.setUint32(u,e.getUint32(u,!1),!1);for(let u=64;u<320;u+=4)t.setUint32(u,Bh(t.getUint32(u-12,!1)^t.getUint32(u-32,!1)^t.getUint32(u-56,!1)^t.getUint32(u-64,!1),1),!1);let r=this._h0,i=this._h1,o=this._h2,s=this._h3,a=this._h4,l,c,d;for(let u=0;u<80;u++)u<20?(l=i&o|~i&s,c=1518500249):u<40?(l=i^o^s,c=1859775393):u<60?(l=i&o|i&s|o&s,c=2400959708):(l=i^o^s,c=3395469782),d=Bh(r,5)+l+a+c+t.getUint32(u*4,!1)&4294967295,a=s,s=o,o=Bh(i,30),i=r,r=d;this._h0=this._h0+r&4294967295,this._h1=this._h1+i&4294967295,this._h2=this._h2+o&4294967295,this._h3=this._h3+s&4294967295,this._h4=this._h4+a&4294967295}};var i5=F("encryptionService"),Zl=F("encryptionMainService");import{homedir as LP,tmpdir as MP}from"os";var _P=60,RP=_P*60,Kh=RP*24,a5=Kh*7,l5=Kh*30,c5=Kh*365;function Ob(n){return n.getFullYear()+"-"+String(n.getMonth()+1).padStart(2,"0")+"-"+String(n.getDate()).padStart(2,"0")+"T"+String(n.getHours()).padStart(2,"0")+":"+String(n.getMinutes()).padStart(2,"0")+":"+String(n.getSeconds()).padStart(2,"0")+"."+(n.getMilliseconds()/1e3).toFixed(3).slice(2,5)+"Z"}var be=F("productService");var Fb=/^([^.]+\..+)[:=](.+)$/,Oe=class{constructor(t,e,r){this._args=t;this.paths=e;this.productService=r}get appRoot(){return Ne(Re.asFileUri("").fsPath)}get userHome(){return x.file(this.paths.homeDir)}get userDataPath(){return this.paths.userDataDir}get appSettingsHome(){return x.file(V(this.userDataPath,"User"))}get tmpDir(){return x.file(this.paths.tmpDir)}get cacheHome(){return x.file(this.userDataPath)}get stateResource(){return ne(this.appSettingsHome,"globalStorage","storage.json")}get userRoamingDataHome(){return this.appSettingsHome.with({scheme:L.vscodeUserData})}get userDataSyncHome(){return ne(this.appSettingsHome,"sync")}get logsHome(){if(!this.args.logsPath){let t=Ob(new Date).replace(/-|:|\.\d+Z$/g,"");this.args.logsPath=V(this.userDataPath,"logs",t)}return x.file(this.args.logsPath)}get sync(){return this.args.sync}get machineSettingsResource(){return ne(x.file(V(this.userDataPath,"Machine")),"settings.json")}get workspaceStorageHome(){return ne(this.appSettingsHome,"workspaceStorage")}get localHistoryHome(){return ne(this.appSettingsHome,"History")}get keyboardLayoutResource(){return ne(this.userRoamingDataHome,"keyboardLayout.json")}get argvResource(){let t=_t.VSCODE_PORTABLE;return t?x.file(V(t,"argv.json")):ne(this.userHome,this.productService.dataFolderName,"argv.json")}get isExtensionDevelopment(){return!!this.args.extensionDevelopmentPath}get untitledWorkspacesHome(){return x.file(V(this.userDataPath,"Workspaces"))}get builtinExtensionsPath(){let t=this.args["builtin-extensions-dir"];return t?Sn(t):lt(V(Re.asFileUri("").fsPath,"..","extensions"))}get extensionsDownloadLocation(){let t=this.args["extensions-download-dir"];return t?x.file(Sn(t)):x.file(V(this.userDataPath,"CachedExtensionVSIXs"))}get extensionsPath(){let t=this.args["extensions-dir"];if(t)return Sn(t);let e=_t.VSCODE_EXTENSIONS;if(e)return e;let r=_t.VSCODE_PORTABLE;return r?V(r,"extensions"):ne(this.userHome,this.productService.dataFolderName,"extensions").fsPath}get extensionDevelopmentLocationURI(){let t=this.args.extensionDevelopmentPath;if(Array.isArray(t))return t.map(e=>/^[^:/?#]+?:\/\//.test(e)?x.parse(e):x.file(lt(e)))}get extensionDevelopmentKind(){return this.args.extensionDevelopmentKind?.map(t=>t==="ui"||t==="workspace"||t==="web"?t:"workspace")}get extensionTestsLocationURI(){let t=this.args.extensionTestsPath;if(t)return/^[^:/?#]+?:\/\//.test(t)?x.parse(t):x.file(lt(t))}get disableExtensions(){if(this.args["disable-extensions"])return!0;let t=this.args["disable-extension"];if(t){if(typeof t=="string")return[t];if(Array.isArray(t)&&t.length>0)return t}return!1}get debugExtensionHost(){return DP(this.args,this.isBuilt)}get debugRenderer(){return!!this.args.debugRenderer}get isBuilt(){return!_t.VSCODE_DEV}get verbose(){return!!this.args.verbose}get logLevel(){return this.args.log?.find(t=>!Fb.test(t))}get extensionLogLevel(){let t=[];for(let e of this.args.log||[]){let r=Fb.exec(e);r&&r[1]&&r[2]&&t.push([r[1],r[2]])}return t.length?t:void 0}get serviceMachineIdResource(){return ne(x.file(this.userDataPath),"machineid")}get crashReporterId(){return this.args["crash-reporter-id"]}get crashReporterDirectory(){return this.args["crash-reporter-directory"]}get disableTelemetry(){return!!this.args["disable-telemetry"]}get disableWorkspaceTrust(){return!!this.args["disable-workspace-trust"]}get useInMemorySecretStorage(){return!!this.args["use-inmemory-secretstorage"]}get policyFile(){if(this.args["__enable-file-policy"]){let t=_t.VSCODE_PORTABLE;return t?x.file(V(t,"policy.json")):ne(this.userHome,this.productService.dataFolderName,"policy.json")}}editSessionId=this.args.editSessionId;get continueOn(){return this.args.continueOn}set continueOn(t){this.args.continueOn=t}get args(){return this._args}};P([ie],Oe.prototype,"appRoot",1),P([ie],Oe.prototype,"userHome",1),P([ie],Oe.prototype,"userDataPath",1),P([ie],Oe.prototype,"appSettingsHome",1),P([ie],Oe.prototype,"tmpDir",1),P([ie],Oe.prototype,"cacheHome",1),P([ie],Oe.prototype,"stateResource",1),P([ie],Oe.prototype,"userRoamingDataHome",1),P([ie],Oe.prototype,"userDataSyncHome",1),P([ie],Oe.prototype,"sync",1),P([ie],Oe.prototype,"machineSettingsResource",1),P([ie],Oe.prototype,"workspaceStorageHome",1),P([ie],Oe.prototype,"localHistoryHome",1),P([ie],Oe.prototype,"keyboardLayoutResource",1),P([ie],Oe.prototype,"argvResource",1),P([ie],Oe.prototype,"isExtensionDevelopment",1),P([ie],Oe.prototype,"untitledWorkspacesHome",1),P([ie],Oe.prototype,"builtinExtensionsPath",1),P([ie],Oe.prototype,"extensionsPath",1),P([ie],Oe.prototype,"extensionDevelopmentLocationURI",1),P([ie],Oe.prototype,"extensionDevelopmentKind",1),P([ie],Oe.prototype,"extensionTestsLocationURI",1),P([ie],Oe.prototype,"debugExtensionHost",1),P([ie],Oe.prototype,"logLevel",1),P([ie],Oe.prototype,"extensionLogLevel",1),P([ie],Oe.prototype,"serviceMachineIdResource",1),P([ie],Oe.prototype,"disableTelemetry",1),P([ie],Oe.prototype,"disableWorkspaceTrust",1),P([ie],Oe.prototype,"useInMemorySecretStorage",1),P([ie],Oe.prototype,"policyFile",1);function DP(n,t){return Au(n["inspect-extensions"],n["inspect-brk-extensions"],5870,t,n.debugId,n.extensionEnvironment)}function Au(n,t,e,r,i,o){let a=Number(t||n)||(r?null:e),l=a?!!t:!1,c;if(o)try{c=JSON.parse(o)}catch{}return{port:a,break:l,debugId:i,env:c}}import*as OP from"os";import*as FP from"path";var Wu={exports:{}};(function(){function t(e,r,i){function o(a,l){let c=s(a,l),d=[c];return e.isAbsolute(c)||d.unshift(i),e.resolve(...d)}function s(a,l){process.env.VSCODE_DEV&&(l="code-oss-dev");let c=process.env.VSCODE_PORTABLE;if(c)return e.join(c,"user-data");let d=process.env.VSCODE_APPDATA;if(d)return e.join(d,l);let u=a["user-data-dir"];if(u)return u;switch(process.platform){case"win32":if(d=process.env.APPDATA,!d){let m=process.env.USERPROFILE;if(typeof m!="string")throw new Error("Windows: Unexpected undefined %USERPROFILE% environment variable");d=e.join(m,"AppData","Roaming")}break;case"darwin":d=e.join(r.homedir(),"Library","Application Support");break;case"linux":d=process.env.XDG_CONFIG_HOME||e.join(r.homedir(),".config");break;default:throw new Error("Platform not supported")}return e.join(d,l)}return{getUserDataPath:o}}if(typeof Wu=="object"&&typeof Wu.exports=="object")Wu.exports=t(FP,OP,process.env.VSCODE_CWD||process.cwd());else throw new Error("Unknown context")})();var Lb=Wu.exports.getUserDataPath;var Uu=class extends Oe{constructor(t,e){super(t,{homeDir:LP(),tmpDir:MP(),userDataDir:Lb(t,e.nameShort)},e)}};function Mb(n,t){return Au(n["inspect-ptyhost"],n["inspect-brk-ptyhost"],5877,t,n.extensionEnvironment)}function Ab(n,t){return Au(n["inspect-sharedprocess"],n["inspect-brk-sharedprocess"],5879,t,n.extensionEnvironment)}var ge=dr,un=class extends Uu{_snapEnv={};get backupHome(){return V(this.userDataPath,"Backups")}get mainIPCHandle(){return gb(this.userDataPath,"main",this.productService.version)}get mainLockfile(){return V(this.userDataPath,"code.lock")}get disableUpdates(){return!!this.args["disable-updates"]}get crossOriginIsolated(){return!!this.args["enable-coi"]}get codeCachePath(){return process.env.VSCODE_CODE_CACHE_PATH||void 0}get useCodeCache(){return!!this.codeCachePath}unsetSnapExportedVariables(){if(Q){for(let t in process.env)if(t.endsWith("_VSCODE_SNAP_ORIG")){let e=t.slice(0,-17);if(this._snapEnv[e])continue;process.env[e]&&(this._snapEnv[e]=process.env[e]),process.env[t]?process.env[e]=process.env[t]:delete process.env[e]}}}restoreSnapExportedVariables(){if(Q)for(let t in this._snapEnv)process.env[t]=this._snapEnv[t],delete this._snapEnv[t]}};P([ie],un.prototype,"backupHome",1),P([ie],un.prototype,"mainIPCHandle",1),P([ie],un.prototype,"mainLockfile",1),P([ie],un.prototype,"disableUpdates",1),P([ie],un.prototype,"crossOriginIsolated",1),P([ie],un.prototype,"codeCachePath",1),P([ie],un.prototype,"useCodeCache",1);function Hh(...n){switch(n.length){case 1:return p("contextkey.scanner.hint.didYouMean1","Did you mean {0}?",n[0]);case 2:return p("contextkey.scanner.hint.didYouMean2","Did you mean {0} or {1}?",n[0],n[1]);case 3:return p("contextkey.scanner.hint.didYouMean3","Did you mean {0}, {1} or {2}?",n[0],n[1],n[2]);default:return}}var AP=p("contextkey.scanner.hint.didYouForgetToOpenOrCloseQuote","Did you forget to open or close the quote?"),WP=p("contextkey.scanner.hint.didYouForgetToEscapeSlash","Did you forget to escape the '/' (slash) character? Put two backslashes before it to escape, e.g., '\\\\/'."),Mi=class n{static getLexeme(t){switch(t.type){case 0:return"(";case 1:return")";case 2:return"!";case 3:return t.isTripleEq?"===":"==";case 4:return t.isTripleEq?"!==":"!=";case 5:return"<";case 6:return"<=";case 7:return">=";case 8:return">=";case 9:return"=~";case 10:return t.lexeme;case 11:return"true";case 12:return"false";case 13:return"in";case 14:return"not";case 15:return"&&";case 16:return"||";case 17:return t.lexeme;case 18:return t.lexeme;case 19:return t.lexeme;case 20:return"EOF";default:throw Cd(`unhandled token type: ${JSON.stringify(t)}; have you forgotten to add a case?`)}}static _regexFlags=new Set(["i","g","s","m","y","u"].map(t=>t.charCodeAt(0)));static _keywords=new Map([["not",14],["in",13],["false",12],["true",11]]);_input="";_start=0;_current=0;_tokens=[];_errors=[];get errors(){return this._errors}reset(t){return this._input=t,this._start=0,this._current=0,this._tokens=[],this._errors=[],this}scan(){for(;!this._isAtEnd();)switch(this._start=this._current,this._advance()){case 40:this._addToken(0);break;case 41:this._addToken(1);break;case 33:if(this._match(61)){let e=this._match(61);this._tokens.push({type:4,offset:this._start,isTripleEq:e})}else this._addToken(2);break;case 39:this._quotedString();break;case 47:this._regex();break;case 61:if(this._match(61)){let e=this._match(61);this._tokens.push({type:3,offset:this._start,isTripleEq:e})}else this._match(126)?this._addToken(9):this._error(Hh("==","=~"));break;case 60:this._addToken(this._match(61)?6:5);break;case 62:this._addToken(this._match(61)?8:7);break;case 38:this._match(38)?this._addToken(15):this._error(Hh("&&"));break;case 124:this._match(124)?this._addToken(16):this._error(Hh("||"));break;case 32:case 13:case 9:case 10:case 160:break;default:this._string()}return this._start=this._current,this._addToken(20),Array.from(this._tokens)}_match(t){return this._isAtEnd()||this._input.charCodeAt(this._current)!==t?!1:(this._current++,!0)}_advance(){return this._input.charCodeAt(this._current++)}_peek(){return this._isAtEnd()?0:this._input.charCodeAt(this._current)}_addToken(t){this._tokens.push({type:t,offset:this._start})}_error(t){let e=this._start,r=this._input.substring(this._start,this._current),i={type:19,offset:this._start,lexeme:r};this._errors.push({offset:e,lexeme:r,additionalInfo:t}),this._tokens.push(i)}stringRe=/[a-zA-Z0-9_<>\-\./\\:\*\?\+\[\]\^,#@;"%\$\p{L}-]+/uy;_string(){this.stringRe.lastIndex=this._start;let t=this.stringRe.exec(this._input);if(t){this._current=this._start+t[0].length;let e=this._input.substring(this._start,this._current),r=n._keywords.get(e);r?this._addToken(r):this._tokens.push({type:17,lexeme:e,offset:this._start})}}_quotedString(){for(;this._peek()!==39&&!this._isAtEnd();)this._advance();if(this._isAtEnd()){this._error(AP);return}this._advance(),this._tokens.push({type:18,lexeme:this._input.substring(this._start+1,this._current-1),offset:this._start+1})}_regex(){let t=this._current,e=!1,r=!1;for(;;){if(t>=this._input.length){this._current=t,this._error(WP);return}let o=this._input.charCodeAt(t);if(e)e=!1;else if(o===47&&!r){t++;break}else o===91?r=!0:o===92?e=!0:o===93&&(r=!1);t++}for(;t<this._input.length&&n._regexFlags.has(this._input.charCodeAt(t));)t++;this._current=t;let i=this._input.substring(this._start,this._current);this._tokens.push({type:10,lexeme:i,offset:this._start})}_isAtEnd(){return this._current>=this._input.length}};var Ct=new Map;Ct.set("false",!1);Ct.set("true",!0);Ct.set("isMac",W);Ct.set("isLinux",Q);Ct.set("isWindows",U);Ct.set("isWeb",sr);Ct.set("isMacNative",W&&!sr);Ct.set("isEdge",xy);Ct.set("isFirefox",wy);Ct.set("isChrome",Om);Ct.set("isSafari",Sy);var UP=Object.prototype.hasOwnProperty;var NP={regexParsingWithErrorRecovery:!0},BP=p("contextkey.parser.error.emptyString","Empty context key expression"),VP=p("contextkey.parser.error.emptyString.hint","Did you forget to write an expression? You can also put 'false' or 'true' to always evaluate to false or true, respectively."),KP=p("contextkey.parser.error.noInAfterNot","'in' after 'not'."),Wb=p("contextkey.parser.error.closingParenthesis","closing parenthesis ')'"),HP=p("contextkey.parser.error.unexpectedToken","Unexpected token"),zP=p("contextkey.parser.error.unexpectedToken.hint","Did you forget to put && or || before the token?"),qP=p("contextkey.parser.error.unexpectedEOF","Unexpected end of expression"),$P=p("contextkey.parser.error.unexpectedEOF.hint","Did you forget to put a context key?"),zh=class n{constructor(t=NP){this._config=t}static _parseError=new Error;_scanner=new Mi;_tokens=[];_current=0;_parsingErrors=[];get lexingErrors(){return this._scanner.errors}get parsingErrors(){return this._parsingErrors}parse(t){if(t===""){this._parsingErrors.push({message:BP,offset:0,lexeme:"",additionalInfo:VP});return}this._tokens=this._scanner.reset(t).scan(),this._current=0,this._parsingErrors=[];try{let e=this._expr();if(!this._isAtEnd()){let r=this._peek(),i=r.type===17?zP:void 0;throw this._parsingErrors.push({message:HP,offset:r.offset,lexeme:Mi.getLexeme(r),additionalInfo:i}),n._parseError}return e}catch(e){if(e!==n._parseError)throw e;return}}_expr(){return this._or()}_or(){let t=[this._and()];for(;this._matchOne(16);){let e=this._and();t.push(e)}return t.length===1?t[0]:Ot.or(...t)}_and(){let t=[this._term()];for(;this._matchOne(15);){let e=this._term();t.push(e)}return t.length===1?t[0]:Ot.and(...t)}_term(){if(this._matchOne(2)){let t=this._peek();switch(t.type){case 11:return this._advance(),$t.INSTANCE;case 12:return this._advance(),Zt.INSTANCE;case 0:{this._advance();let e=this._expr();return this._consume(1,Wb),e?.negate()}case 17:return this._advance(),Lo.create(t.lexeme);default:throw this._errExpectedButGot("KEY | true | false | '(' expression ')'",t)}}return this._primary()}_primary(){let t=this._peek();switch(t.type){case 11:return this._advance(),Ot.true();case 12:return this._advance(),Ot.false();case 0:{this._advance();let e=this._expr();return this._consume(1,Wb),e}case 17:{let e=t.lexeme;if(this._advance(),this._matchOne(9)){let i=this._peek();if(!this._config.regexParsingWithErrorRecovery){if(this._advance(),i.type!==10)throw this._errExpectedButGot("REGEX",i);let o=i.lexeme,s=o.lastIndexOf("/"),a=s===o.length-1?void 0:this._removeFlagsGY(o.substring(s+1)),l;try{l=new RegExp(o.substring(1,s),a)}catch{throw this._errExpectedButGot("REGEX",i)}return ac.create(e,l)}switch(i.type){case 10:case 19:{let o=[i.lexeme];this._advance();let s=this._peek(),a=0;for(let m=0;m<i.lexeme.length;m++)i.lexeme.charCodeAt(m)===40?a++:i.lexeme.charCodeAt(m)===41&&a--;for(;!this._isAtEnd()&&s.type!==15&&s.type!==16;){switch(s.type){case 0:a++;break;case 1:a--;break;case 10:case 18:for(let m=0;m<s.lexeme.length;m++)s.lexeme.charCodeAt(m)===40?a++:i.lexeme.charCodeAt(m)===41&&a--}if(a<0)break;o.push(Mi.getLexeme(s)),this._advance(),s=this._peek()}let l=o.join(""),c=l.lastIndexOf("/"),d=c===l.length-1?void 0:this._removeFlagsGY(l.substring(c+1)),u;try{u=new RegExp(l.substring(1,c),d)}catch{throw this._errExpectedButGot("REGEX",i)}return Ot.regex(e,u)}case 18:{let o=i.lexeme;this._advance();let s=null;if(!mI(o)){let a=o.indexOf("/"),l=o.lastIndexOf("/");if(a!==l&&a>=0){let c=o.slice(a+1,l),d=o[l+1]==="i"?"i":"";try{s=new RegExp(c,d)}catch{throw this._errExpectedButGot("REGEX",i)}}}if(s===null)throw this._errExpectedButGot("REGEX",i);return ac.create(e,s)}default:throw this._errExpectedButGot("REGEX",this._peek())}}if(this._matchOne(14)){this._consume(13,KP);let i=this._value();return Ot.notIn(e,i)}switch(this._peek().type){case 3:{this._advance();let i=this._value();if(this._previous().type===18)return Ot.equals(e,i);switch(i){case"true":return Ot.has(e);case"false":return Ot.not(e);default:return Ot.equals(e,i)}}case 4:{this._advance();let i=this._value();if(this._previous().type===18)return Ot.notEquals(e,i);switch(i){case"true":return Ot.not(e);case"false":return Ot.has(e);default:return Ot.notEquals(e,i)}}case 5:return this._advance(),oc.create(e,this._value());case 6:return this._advance(),sc.create(e,this._value());case 7:return this._advance(),nc.create(e,this._value());case 8:return this._advance(),ic.create(e,this._value());case 13:return this._advance(),Ot.in(e,this._value());default:return Ot.has(e)}}case 20:throw this._parsingErrors.push({message:qP,offset:t.offset,lexeme:"",additionalInfo:$P}),n._parseError;default:throw this._errExpectedButGot(`true | false | KEY 
	| KEY '=~' REGEX 
	| KEY ('==' | '!=' | '<' | '<=' | '>' | '>=' | 'in' | 'not' 'in') value`,this._peek())}}_value(){let t=this._peek();switch(t.type){case 17:case 18:return this._advance(),t.lexeme;case 11:return this._advance(),"true";case 12:return this._advance(),"false";case 13:return this._advance(),"in";default:return""}}_flagsGYRe=/g|y/g;_removeFlagsGY(t){return t.replaceAll(this._flagsGYRe,"")}_previous(){return this._tokens[this._current-1]}_matchOne(t){return this._check(t)?(this._advance(),!0):!1}_advance(){return this._isAtEnd()||this._current++,this._previous()}_consume(t,e){if(this._check(t))return this._advance();throw this._errExpectedButGot(e,this._peek())}_errExpectedButGot(t,e,r){let i=p("contextkey.parser.error.expectedButGot",`Expected: {0}
Received: '{1}'.`,t,Mi.getLexeme(e)),o=e.offset,s=Mi.getLexeme(e);return this._parsingErrors.push({message:i,offset:o,lexeme:s,additionalInfo:r}),n._parseError}_check(t){return this._peek().type===t}_peek(){return this._tokens[this._current]}_isAtEnd(){return this._peek().type===20}},Ot=class{static false(){return $t.INSTANCE}static true(){return Zt.INSTANCE}static has(t){return Fo.create(t)}static equals(t,e){return tc.create(t,e)}static notEquals(t,e){return rc.create(t,e)}static regex(t,e){return ac.create(t,e)}static in(t,e){return Nu.create(t,e)}static notIn(t,e){return Bu.create(t,e)}static not(t){return Lo.create(t)}static and(...t){return Vu.create(t,null,!0)}static or(...t){return lc.create(t,null,!0)}static greater(t,e){return nc.create(t,e)}static greaterEquals(t,e){return ic.create(t,e)}static smaller(t,e){return oc.create(t,e)}static smallerEquals(t,e){return sc.create(t,e)}static _parser=new zh({regexParsingWithErrorRecovery:!1});static deserialize(t){return t==null?void 0:this._parser.parse(t)}};function ec(n,t){return n.cmp(t)}var $t=class n{static INSTANCE=new n;type=0;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!1}serialize(){return"false"}keys(){return[]}map(t){return this}negate(){return Zt.INSTANCE}},Zt=class n{static INSTANCE=new n;type=1;constructor(){}cmp(t){return this.type-t.type}equals(t){return t.type===this.type}substituteConstants(){return this}evaluate(t){return!0}serialize(){return"true"}keys(){return[]}map(t){return this}negate(){return $t.INSTANCE}},Fo=class n{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let r=Ct.get(t);return typeof r=="boolean"?r?Zt.INSTANCE:$t.INSTANCE:new n(t,e)}type=2;cmp(t){return t.type!==this.type?this.type-t.type:Vb(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=Ct.get(this.key);return typeof t=="boolean"?t?Zt.INSTANCE:$t.INSTANCE:this}evaluate(t){return!!t.getValue(this.key)}serialize(){return this.key}keys(){return[this.key]}map(t){return t.mapDefined(this.key)}negate(){return this.negated||(this.negated=Lo.create(this.key,this)),this.negated}},tc=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){if(typeof e=="boolean")return e?Fo.create(t,r):Lo.create(t,r);let i=Ct.get(t);return typeof i=="boolean"?e===(i?"true":"false")?Zt.INSTANCE:$t.INSTANCE:new n(t,e,r)}type=4;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=Ct.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?Zt.INSTANCE:$t.INSTANCE}return this}evaluate(t){return t.getValue(this.key)==this.value}serialize(){return`${this.key} == '${this.value}'`}keys(){return[this.key]}map(t){return t.mapEquals(this.key,this.value)}negate(){return this.negated||(this.negated=rc.create(this.key,this.value,this)),this.negated}},Nu=class n{constructor(t,e){this.key=t;this.valueKey=e}static create(t,e){return new n(t,e)}type=10;negated=null;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.valueKey,t.key,t.valueKey)}equals(t){return t.type===this.type?this.key===t.key&&this.valueKey===t.valueKey:!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.valueKey),r=t.getValue(this.key);return Array.isArray(e)?e.includes(r):typeof r=="string"&&typeof e=="object"&&e!==null?UP.call(e,r):!1}serialize(){return`${this.key} in '${this.valueKey}'`}keys(){return[this.key,this.valueKey]}map(t){return t.mapIn(this.key,this.valueKey)}negate(){return this.negated||(this.negated=Bu.create(this.key,this.valueKey)),this.negated}},Bu=class n{constructor(t,e){this.key=t;this.valueKey=e;this._negated=Nu.create(t,e)}static create(t,e){return new n(t,e)}type=11;_negated;cmp(t){return t.type!==this.type?this.type-t.type:this._negated.cmp(t._negated)}equals(t){return t.type===this.type?this._negated.equals(t._negated):!1}substituteConstants(){return this}evaluate(t){return!this._negated.evaluate(t)}serialize(){return`${this.key} not in '${this.valueKey}'`}keys(){return this._negated.keys()}map(t){return t.mapNotIn(this.key,this.valueKey)}negate(){return this._negated}},rc=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){if(typeof e=="boolean")return e?Lo.create(t,r):Fo.create(t,r);let i=Ct.get(t);return typeof i=="boolean"?e===(i?"true":"false")?$t.INSTANCE:Zt.INSTANCE:new n(t,e,r)}type=5;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){let t=Ct.get(this.key);if(typeof t=="boolean"){let e=t?"true":"false";return this.value===e?$t.INSTANCE:Zt.INSTANCE}return this}evaluate(t){return t.getValue(this.key)!=this.value}serialize(){return`${this.key} != '${this.value}'`}keys(){return[this.key]}map(t){return t.mapNotEquals(this.key,this.value)}negate(){return this.negated||(this.negated=tc.create(this.key,this.value,this)),this.negated}},Lo=class n{constructor(t,e){this.key=t;this.negated=e}static create(t,e=null){let r=Ct.get(t);return typeof r=="boolean"?r?$t.INSTANCE:Zt.INSTANCE:new n(t,e)}type=3;cmp(t){return t.type!==this.type?this.type-t.type:Vb(this.key,t.key)}equals(t){return t.type===this.type?this.key===t.key:!1}substituteConstants(){let t=Ct.get(this.key);return typeof t=="boolean"?t?$t.INSTANCE:Zt.INSTANCE:this}evaluate(t){return!t.getValue(this.key)}serialize(){return`!${this.key}`}keys(){return[this.key]}map(t){return t.mapNot(this.key)}negate(){return this.negated||(this.negated=Fo.create(this.key,this)),this.negated}};function Ku(n,t){if(typeof n=="string"){let e=parseFloat(n);isNaN(e)||(n=e)}return typeof n=="string"||typeof n=="number"?t(n):$t.INSTANCE}var nc=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Ku(e,i=>new n(t,i,r))}type=12;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>this.value}serialize(){return`${this.key} > ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreater(this.key,this.value)}negate(){return this.negated||(this.negated=sc.create(this.key,this.value,this)),this.negated}},ic=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Ku(e,i=>new n(t,i,r))}type=13;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))>=this.value}serialize(){return`${this.key} >= ${this.value}`}keys(){return[this.key]}map(t){return t.mapGreaterEquals(this.key,this.value)}negate(){return this.negated||(this.negated=oc.create(this.key,this.value,this)),this.negated}},oc=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Ku(e,i=>new n(t,i,r))}type=14;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<this.value}serialize(){return`${this.key} < ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmaller(this.key,this.value)}negate(){return this.negated||(this.negated=ic.create(this.key,this.value,this)),this.negated}},sc=class n{constructor(t,e,r){this.key=t;this.value=e;this.negated=r}static create(t,e,r=null){return Ku(e,i=>new n(t,i,r))}type=15;cmp(t){return t.type!==this.type?this.type-t.type:Mo(this.key,this.value,t.key,t.value)}equals(t){return t.type===this.type?this.key===t.key&&this.value===t.value:!1}substituteConstants(){return this}evaluate(t){return typeof this.value=="string"?!1:parseFloat(t.getValue(this.key))<=this.value}serialize(){return`${this.key} <= ${this.value}`}keys(){return[this.key]}map(t){return t.mapSmallerEquals(this.key,this.value)}negate(){return this.negated||(this.negated=nc.create(this.key,this.value,this)),this.negated}},ac=class n{constructor(t,e){this.key=t;this.regexp=e}static create(t,e){return new n(t,e)}type=7;negated=null;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.key<t.key)return-1;if(this.key>t.key)return 1;let e=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return e<r?-1:e>r?1:0}equals(t){if(t.type===this.type){let e=this.regexp?this.regexp.source:"",r=t.regexp?t.regexp.source:"";return this.key===t.key&&e===r}return!1}substituteConstants(){return this}evaluate(t){let e=t.getValue(this.key);return this.regexp?this.regexp.test(e):!1}serialize(){let t=this.regexp?`/${this.regexp.source}/${this.regexp.flags}`:"/invalid/";return`${this.key} =~ ${t}`}keys(){return[this.key]}map(t){return t.mapRegex(this.key,this.regexp)}negate(){return this.negated||(this.negated=qh.create(this)),this.negated}},qh=class n{constructor(t){this._actual=t}static create(t){return new n(t)}type=8;cmp(t){return t.type!==this.type?this.type-t.type:this._actual.cmp(t._actual)}equals(t){return t.type===this.type?this._actual.equals(t._actual):!1}substituteConstants(){return this}evaluate(t){return!this._actual.evaluate(t)}serialize(){return`!(${this._actual.serialize()})`}keys(){return this._actual.keys()}map(t){return new n(this._actual.map(t))}negate(){return this._actual}};function Bb(n){let t=null;for(let e=0,r=n.length;e<r;e++){let i=n[e].substituteConstants();if(n[e]!==i&&t===null){t=[];for(let o=0;o<e;o++)t[o]=n[o]}t!==null&&(t[e]=i)}return t===null?n:t}var Vu=class n{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,r){return n._normalizeArr(t,e,r)}type=6;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,r=this.expr.length;e<r;e++){let i=ec(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=Bb(this.expr);return t===this.expr?this:n.create(t,this.negated,!1)}evaluate(t){for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].evaluate(t))return!1;return!0}static _normalizeArr(t,e,r){let i=[],o=!1;for(let s of t)if(s){if(s.type===1){o=!0;continue}if(s.type===0)return $t.INSTANCE;if(s.type===6){i.push(...s.expr);continue}i.push(s)}if(i.length===0&&o)return Zt.INSTANCE;if(i.length!==0){if(i.length===1)return i[0];i.sort(ec);for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];for(;i.length>1;){let s=i[i.length-1];if(s.type!==9)break;i.pop();let a=i.pop(),l=i.length===0,c=lc.create(s.expr.map(d=>n.create([d,a],null,r)),null,l);c&&(i.push(c),i.sort(ec))}if(i.length===1)return i[0];if(r){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return $t.INSTANCE;if(i.length===1)return i[0]}return new n(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" && ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new n(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());this.negated=lc.create(t,this,!0)}return this.negated}},lc=class n{constructor(t,e){this.expr=t;this.negated=e}static create(t,e,r){return n._normalizeArr(t,e,r)}type=9;cmp(t){if(t.type!==this.type)return this.type-t.type;if(this.expr.length<t.expr.length)return-1;if(this.expr.length>t.expr.length)return 1;for(let e=0,r=this.expr.length;e<r;e++){let i=ec(this.expr[e],t.expr[e]);if(i!==0)return i}return 0}equals(t){if(t.type===this.type){if(this.expr.length!==t.expr.length)return!1;for(let e=0,r=this.expr.length;e<r;e++)if(!this.expr[e].equals(t.expr[e]))return!1;return!0}return!1}substituteConstants(){let t=Bb(this.expr);return t===this.expr?this:n.create(t,this.negated,!1)}evaluate(t){for(let e=0,r=this.expr.length;e<r;e++)if(this.expr[e].evaluate(t))return!0;return!1}static _normalizeArr(t,e,r){let i=[],o=!1;if(t){for(let s=0,a=t.length;s<a;s++){let l=t[s];if(l){if(l.type===0){o=!0;continue}if(l.type===1)return Zt.INSTANCE;if(l.type===9){i=i.concat(l.expr);continue}i.push(l)}}if(i.length===0&&o)return $t.INSTANCE;i.sort(ec)}if(i.length!==0){if(i.length===1)return i[0];for(let s=1;s<i.length;s++)i[s-1].equals(i[s])&&(i.splice(s,1),s--);if(i.length===1)return i[0];if(r){for(let s=0;s<i.length;s++)for(let a=s+1;a<i.length;a++)if(i[s].negate().equals(i[a]))return Zt.INSTANCE;if(i.length===1)return i[0]}return new n(i,e)}}serialize(){return this.expr.map(t=>t.serialize()).join(" || ")}keys(){let t=[];for(let e of this.expr)t.push(...e.keys());return t}map(t){return new n(this.expr.map(e=>e.map(t)),null)}negate(){if(!this.negated){let t=[];for(let e of this.expr)t.push(e.negate());for(;t.length>1;){let e=t.shift(),r=t.shift(),i=[];for(let o of Ub(e))for(let s of Ub(r))i.push(Vu.create([o,s],null,!1));t.unshift(n.create(i,null,!1))}this.negated=n.create(t,this,!0)}return this.negated}},As=class n extends Fo{static _info=[];static all(){return n._info.values()}_defaultValue;constructor(t,e,r){super(t,null),this._defaultValue=e,typeof r=="object"?n._info.push({...r,key:t}):r!==!0&&n._info.push({key:t,description:r,type:e!=null?typeof e:void 0})}bindTo(t){return t.createKey(this.key,this._defaultValue)}getValue(t){return t.getContextKeyValue(this.key)}toNegated(){return this.negate()}isEqualTo(t){return tc.create(this.key,t)}notEqualsTo(t){return rc.create(this.key,t)}},vU=F("contextKeyService");function Vb(n,t){return n<t?-1:n>t?1:0}function Mo(n,t,e,r){return n<e?-1:n>e?1:t<r?-1:t>r?1:0}function Ub(n){return n.type===9?n.expr:[n]}var $h=Object.create(null);function f(n,t){if(ke(t)){let e=$h[t];if(e===void 0)throw new Error(`${n} references an unknown codicon: ${t}`);t=e}return $h[n]=t,{id:n}}function Kb(){return $h}var Hb={add:f("add",6e4),plus:f("plus",6e4),gistNew:f("gist-new",6e4),repoCreate:f("repo-create",6e4),lightbulb:f("lightbulb",60001),lightBulb:f("light-bulb",60001),repo:f("repo",60002),repoDelete:f("repo-delete",60002),gistFork:f("gist-fork",60003),repoForked:f("repo-forked",60003),gitPullRequest:f("git-pull-request",60004),gitPullRequestAbandoned:f("git-pull-request-abandoned",60004),recordKeys:f("record-keys",60005),keyboard:f("keyboard",60005),tag:f("tag",60006),gitPullRequestLabel:f("git-pull-request-label",60006),tagAdd:f("tag-add",60006),tagRemove:f("tag-remove",60006),person:f("person",60007),personFollow:f("person-follow",60007),personOutline:f("person-outline",60007),personFilled:f("person-filled",60007),gitBranch:f("git-branch",60008),gitBranchCreate:f("git-branch-create",60008),gitBranchDelete:f("git-branch-delete",60008),sourceControl:f("source-control",60008),mirror:f("mirror",60009),mirrorPublic:f("mirror-public",60009),star:f("star",60010),starAdd:f("star-add",60010),starDelete:f("star-delete",60010),starEmpty:f("star-empty",60010),comment:f("comment",60011),commentAdd:f("comment-add",60011),alert:f("alert",60012),warning:f("warning",60012),search:f("search",60013),searchSave:f("search-save",60013),logOut:f("log-out",60014),signOut:f("sign-out",60014),logIn:f("log-in",60015),signIn:f("sign-in",60015),eye:f("eye",60016),eyeUnwatch:f("eye-unwatch",60016),eyeWatch:f("eye-watch",60016),circleFilled:f("circle-filled",60017),primitiveDot:f("primitive-dot",60017),closeDirty:f("close-dirty",60017),debugBreakpoint:f("debug-breakpoint",60017),debugBreakpointDisabled:f("debug-breakpoint-disabled",60017),debugHint:f("debug-hint",60017),terminalDecorationSuccess:f("terminal-decoration-success",60017),primitiveSquare:f("primitive-square",60018),edit:f("edit",60019),pencil:f("pencil",60019),info:f("info",60020),issueOpened:f("issue-opened",60020),gistPrivate:f("gist-private",60021),gitForkPrivate:f("git-fork-private",60021),lock:f("lock",60021),mirrorPrivate:f("mirror-private",60021),close:f("close",60022),removeClose:f("remove-close",60022),x:f("x",60022),repoSync:f("repo-sync",60023),sync:f("sync",60023),clone:f("clone",60024),desktopDownload:f("desktop-download",60024),beaker:f("beaker",60025),microscope:f("microscope",60025),vm:f("vm",60026),deviceDesktop:f("device-desktop",60026),file:f("file",60027),fileText:f("file-text",60027),more:f("more",60028),ellipsis:f("ellipsis",60028),kebabHorizontal:f("kebab-horizontal",60028),mailReply:f("mail-reply",60029),reply:f("reply",60029),organization:f("organization",60030),organizationFilled:f("organization-filled",60030),organizationOutline:f("organization-outline",60030),newFile:f("new-file",60031),fileAdd:f("file-add",60031),newFolder:f("new-folder",60032),fileDirectoryCreate:f("file-directory-create",60032),trash:f("trash",60033),trashcan:f("trashcan",60033),history:f("history",60034),clock:f("clock",60034),folder:f("folder",60035),fileDirectory:f("file-directory",60035),symbolFolder:f("symbol-folder",60035),logoGithub:f("logo-github",60036),markGithub:f("mark-github",60036),github:f("github",60036),terminal:f("terminal",60037),console:f("console",60037),repl:f("repl",60037),zap:f("zap",60038),symbolEvent:f("symbol-event",60038),error:f("error",60039),stop:f("stop",60039),variable:f("variable",60040),symbolVariable:f("symbol-variable",60040),array:f("array",60042),symbolArray:f("symbol-array",60042),symbolModule:f("symbol-module",60043),symbolPackage:f("symbol-package",60043),symbolNamespace:f("symbol-namespace",60043),symbolObject:f("symbol-object",60043),symbolMethod:f("symbol-method",60044),symbolFunction:f("symbol-function",60044),symbolConstructor:f("symbol-constructor",60044),symbolBoolean:f("symbol-boolean",60047),symbolNull:f("symbol-null",60047),symbolNumeric:f("symbol-numeric",60048),symbolNumber:f("symbol-number",60048),symbolStructure:f("symbol-structure",60049),symbolStruct:f("symbol-struct",60049),symbolParameter:f("symbol-parameter",60050),symbolTypeParameter:f("symbol-type-parameter",60050),symbolKey:f("symbol-key",60051),symbolText:f("symbol-text",60051),symbolReference:f("symbol-reference",60052),goToFile:f("go-to-file",60052),symbolEnum:f("symbol-enum",60053),symbolValue:f("symbol-value",60053),symbolRuler:f("symbol-ruler",60054),symbolUnit:f("symbol-unit",60054),activateBreakpoints:f("activate-breakpoints",60055),archive:f("archive",60056),arrowBoth:f("arrow-both",60057),arrowDown:f("arrow-down",60058),arrowLeft:f("arrow-left",60059),arrowRight:f("arrow-right",60060),arrowSmallDown:f("arrow-small-down",60061),arrowSmallLeft:f("arrow-small-left",60062),arrowSmallRight:f("arrow-small-right",60063),arrowSmallUp:f("arrow-small-up",60064),arrowUp:f("arrow-up",60065),bell:f("bell",60066),bold:f("bold",60067),book:f("book",60068),bookmark:f("bookmark",60069),debugBreakpointConditionalUnverified:f("debug-breakpoint-conditional-unverified",60070),debugBreakpointConditional:f("debug-breakpoint-conditional",60071),debugBreakpointConditionalDisabled:f("debug-breakpoint-conditional-disabled",60071),debugBreakpointDataUnverified:f("debug-breakpoint-data-unverified",60072),debugBreakpointData:f("debug-breakpoint-data",60073),debugBreakpointDataDisabled:f("debug-breakpoint-data-disabled",60073),debugBreakpointLogUnverified:f("debug-breakpoint-log-unverified",60074),debugBreakpointLog:f("debug-breakpoint-log",60075),debugBreakpointLogDisabled:f("debug-breakpoint-log-disabled",60075),briefcase:f("briefcase",60076),broadcast:f("broadcast",60077),browser:f("browser",60078),bug:f("bug",60079),calendar:f("calendar",60080),caseSensitive:f("case-sensitive",60081),check:f("check",60082),checklist:f("checklist",60083),chevronDown:f("chevron-down",60084),chevronLeft:f("chevron-left",60085),chevronRight:f("chevron-right",60086),chevronUp:f("chevron-up",60087),chromeClose:f("chrome-close",60088),chromeMaximize:f("chrome-maximize",60089),chromeMinimize:f("chrome-minimize",60090),chromeRestore:f("chrome-restore",60091),circleOutline:f("circle-outline",60092),circle:f("circle",60092),debugBreakpointUnverified:f("debug-breakpoint-unverified",60092),terminalDecorationIncomplete:f("terminal-decoration-incomplete",60092),circleSlash:f("circle-slash",60093),circuitBoard:f("circuit-board",60094),clearAll:f("clear-all",60095),clippy:f("clippy",60096),closeAll:f("close-all",60097),cloudDownload:f("cloud-download",60098),cloudUpload:f("cloud-upload",60099),code:f("code",60100),collapseAll:f("collapse-all",60101),colorMode:f("color-mode",60102),commentDiscussion:f("comment-discussion",60103),creditCard:f("credit-card",60105),dash:f("dash",60108),dashboard:f("dashboard",60109),database:f("database",60110),debugContinue:f("debug-continue",60111),debugDisconnect:f("debug-disconnect",60112),debugPause:f("debug-pause",60113),debugRestart:f("debug-restart",60114),debugStart:f("debug-start",60115),debugStepInto:f("debug-step-into",60116),debugStepOut:f("debug-step-out",60117),debugStepOver:f("debug-step-over",60118),debugStop:f("debug-stop",60119),debug:f("debug",60120),deviceCameraVideo:f("device-camera-video",60121),deviceCamera:f("device-camera",60122),deviceMobile:f("device-mobile",60123),diffAdded:f("diff-added",60124),diffIgnored:f("diff-ignored",60125),diffModified:f("diff-modified",60126),diffRemoved:f("diff-removed",60127),diffRenamed:f("diff-renamed",60128),diff:f("diff",60129),diffSidebyside:f("diff-sidebyside",60129),discard:f("discard",60130),editorLayout:f("editor-layout",60131),emptyWindow:f("empty-window",60132),exclude:f("exclude",60133),extensions:f("extensions",60134),eyeClosed:f("eye-closed",60135),fileBinary:f("file-binary",60136),fileCode:f("file-code",60137),fileMedia:f("file-media",60138),filePdf:f("file-pdf",60139),fileSubmodule:f("file-submodule",60140),fileSymlinkDirectory:f("file-symlink-directory",60141),fileSymlinkFile:f("file-symlink-file",60142),fileZip:f("file-zip",60143),files:f("files",60144),filter:f("filter",60145),flame:f("flame",60146),foldDown:f("fold-down",60147),foldUp:f("fold-up",60148),fold:f("fold",60149),folderActive:f("folder-active",60150),folderOpened:f("folder-opened",60151),gear:f("gear",60152),gift:f("gift",60153),gistSecret:f("gist-secret",60154),gist:f("gist",60155),gitCommit:f("git-commit",60156),gitCompare:f("git-compare",60157),compareChanges:f("compare-changes",60157),gitMerge:f("git-merge",60158),githubAction:f("github-action",60159),githubAlt:f("github-alt",60160),globe:f("globe",60161),grabber:f("grabber",60162),graph:f("graph",60163),gripper:f("gripper",60164),heart:f("heart",60165),home:f("home",60166),horizontalRule:f("horizontal-rule",60167),hubot:f("hubot",60168),inbox:f("inbox",60169),issueReopened:f("issue-reopened",60171),issues:f("issues",60172),italic:f("italic",60173),jersey:f("jersey",60174),json:f("json",60175),kebabVertical:f("kebab-vertical",60176),key:f("key",60177),law:f("law",60178),lightbulbAutofix:f("lightbulb-autofix",60179),linkExternal:f("link-external",60180),link:f("link",60181),listOrdered:f("list-ordered",60182),listUnordered:f("list-unordered",60183),liveShare:f("live-share",60184),loading:f("loading",60185),location:f("location",60186),mailRead:f("mail-read",60187),mail:f("mail",60188),markdown:f("markdown",60189),megaphone:f("megaphone",60190),mention:f("mention",60191),milestone:f("milestone",60192),gitPullRequestMilestone:f("git-pull-request-milestone",60192),mortarBoard:f("mortar-board",60193),move:f("move",60194),multipleWindows:f("multiple-windows",60195),mute:f("mute",60196),noNewline:f("no-newline",60197),note:f("note",60198),octoface:f("octoface",60199),openPreview:f("open-preview",60200),package:f("package",60201),paintcan:f("paintcan",60202),pin:f("pin",60203),play:f("play",60204),run:f("run",60204),plug:f("plug",60205),preserveCase:f("preserve-case",60206),preview:f("preview",60207),project:f("project",60208),pulse:f("pulse",60209),question:f("question",60210),quote:f("quote",60211),radioTower:f("radio-tower",60212),reactions:f("reactions",60213),references:f("references",60214),refresh:f("refresh",60215),regex:f("regex",60216),remoteExplorer:f("remote-explorer",60217),remote:f("remote",60218),remove:f("remove",60219),replaceAll:f("replace-all",60220),replace:f("replace",60221),repoClone:f("repo-clone",60222),repoForcePush:f("repo-force-push",60223),repoPull:f("repo-pull",60224),repoPush:f("repo-push",60225),report:f("report",60226),requestChanges:f("request-changes",60227),rocket:f("rocket",60228),rootFolderOpened:f("root-folder-opened",60229),rootFolder:f("root-folder",60230),rss:f("rss",60231),ruby:f("ruby",60232),saveAll:f("save-all",60233),saveAs:f("save-as",60234),save:f("save",60235),screenFull:f("screen-full",60236),screenNormal:f("screen-normal",60237),searchStop:f("search-stop",60238),server:f("server",60240),settingsGear:f("settings-gear",60241),settings:f("settings",60242),shield:f("shield",60243),smiley:f("smiley",60244),sortPrecedence:f("sort-precedence",60245),splitHorizontal:f("split-horizontal",60246),splitVertical:f("split-vertical",60247),squirrel:f("squirrel",60248),starFull:f("star-full",60249),starHalf:f("star-half",60250),symbolClass:f("symbol-class",60251),symbolColor:f("symbol-color",60252),symbolConstant:f("symbol-constant",60253),symbolEnumMember:f("symbol-enum-member",60254),symbolField:f("symbol-field",60255),symbolFile:f("symbol-file",60256),symbolInterface:f("symbol-interface",60257),symbolKeyword:f("symbol-keyword",60258),symbolMisc:f("symbol-misc",60259),symbolOperator:f("symbol-operator",60260),symbolProperty:f("symbol-property",60261),wrench:f("wrench",60261),wrenchSubaction:f("wrench-subaction",60261),symbolSnippet:f("symbol-snippet",60262),tasklist:f("tasklist",60263),telescope:f("telescope",60264),textSize:f("text-size",60265),threeBars:f("three-bars",60266),thumbsdown:f("thumbsdown",60267),thumbsup:f("thumbsup",60268),tools:f("tools",60269),triangleDown:f("triangle-down",60270),triangleLeft:f("triangle-left",60271),triangleRight:f("triangle-right",60272),triangleUp:f("triangle-up",60273),twitter:f("twitter",60274),unfold:f("unfold",60275),unlock:f("unlock",60276),unmute:f("unmute",60277),unverified:f("unverified",60278),verified:f("verified",60279),versions:f("versions",60280),vmActive:f("vm-active",60281),vmOutline:f("vm-outline",60282),vmRunning:f("vm-running",60283),watch:f("watch",60284),whitespace:f("whitespace",60285),wholeWord:f("whole-word",60286),window:f("window",60287),wordWrap:f("word-wrap",60288),zoomIn:f("zoom-in",60289),zoomOut:f("zoom-out",60290),listFilter:f("list-filter",60291),listFlat:f("list-flat",60292),listSelection:f("list-selection",60293),selection:f("selection",60293),listTree:f("list-tree",60294),debugBreakpointFunctionUnverified:f("debug-breakpoint-function-unverified",60295),debugBreakpointFunction:f("debug-breakpoint-function",60296),debugBreakpointFunctionDisabled:f("debug-breakpoint-function-disabled",60296),debugStackframeActive:f("debug-stackframe-active",60297),circleSmallFilled:f("circle-small-filled",60298),debugStackframeDot:f("debug-stackframe-dot",60298),terminalDecorationMark:f("terminal-decoration-mark",60298),debugStackframe:f("debug-stackframe",60299),debugStackframeFocused:f("debug-stackframe-focused",60299),debugBreakpointUnsupported:f("debug-breakpoint-unsupported",60300),symbolString:f("symbol-string",60301),debugReverseContinue:f("debug-reverse-continue",60302),debugStepBack:f("debug-step-back",60303),debugRestartFrame:f("debug-restart-frame",60304),debugAlt:f("debug-alt",60305),callIncoming:f("call-incoming",60306),callOutgoing:f("call-outgoing",60307),menu:f("menu",60308),expandAll:f("expand-all",60309),feedback:f("feedback",60310),gitPullRequestReviewer:f("git-pull-request-reviewer",60310),groupByRefType:f("group-by-ref-type",60311),ungroupByRefType:f("ungroup-by-ref-type",60312),account:f("account",60313),gitPullRequestAssignee:f("git-pull-request-assignee",60313),bellDot:f("bell-dot",60314),debugConsole:f("debug-console",60315),library:f("library",60316),output:f("output",60317),runAll:f("run-all",60318),syncIgnored:f("sync-ignored",60319),pinned:f("pinned",60320),githubInverted:f("github-inverted",60321),serverProcess:f("server-process",60322),serverEnvironment:f("server-environment",60323),pass:f("pass",60324),issueClosed:f("issue-closed",60324),stopCircle:f("stop-circle",60325),playCircle:f("play-circle",60326),record:f("record",60327),debugAltSmall:f("debug-alt-small",60328),vmConnect:f("vm-connect",60329),cloud:f("cloud",60330),merge:f("merge",60331),export:f("export",60332),graphLeft:f("graph-left",60333),magnet:f("magnet",60334),notebook:f("notebook",60335),redo:f("redo",60336),checkAll:f("check-all",60337),pinnedDirty:f("pinned-dirty",60338),passFilled:f("pass-filled",60339),circleLargeFilled:f("circle-large-filled",60340),circleLarge:f("circle-large",60341),circleLargeOutline:f("circle-large-outline",60341),combine:f("combine",60342),gather:f("gather",60342),table:f("table",60343),variableGroup:f("variable-group",60344),typeHierarchy:f("type-hierarchy",60345),typeHierarchySub:f("type-hierarchy-sub",60346),typeHierarchySuper:f("type-hierarchy-super",60347),gitPullRequestCreate:f("git-pull-request-create",60348),runAbove:f("run-above",60349),runBelow:f("run-below",60350),notebookTemplate:f("notebook-template",60351),debugRerun:f("debug-rerun",60352),workspaceTrusted:f("workspace-trusted",60353),workspaceUntrusted:f("workspace-untrusted",60354),workspaceUnknown:f("workspace-unknown",60355),terminalCmd:f("terminal-cmd",60356),terminalDebian:f("terminal-debian",60357),terminalLinux:f("terminal-linux",60358),terminalPowershell:f("terminal-powershell",60359),terminalTmux:f("terminal-tmux",60360),terminalUbuntu:f("terminal-ubuntu",60361),terminalBash:f("terminal-bash",60362),arrowSwap:f("arrow-swap",60363),copy:f("copy",60364),personAdd:f("person-add",60365),filterFilled:f("filter-filled",60366),wand:f("wand",60367),debugLineByLine:f("debug-line-by-line",60368),inspect:f("inspect",60369),layers:f("layers",60370),layersDot:f("layers-dot",60371),layersActive:f("layers-active",60372),compass:f("compass",60373),compassDot:f("compass-dot",60374),compassActive:f("compass-active",60375),azure:f("azure",60376),issueDraft:f("issue-draft",60377),gitPullRequestClosed:f("git-pull-request-closed",60378),gitPullRequestDraft:f("git-pull-request-draft",60379),debugAll:f("debug-all",60380),debugCoverage:f("debug-coverage",60381),runErrors:f("run-errors",60382),folderLibrary:f("folder-library",60383),debugContinueSmall:f("debug-continue-small",60384),beakerStop:f("beaker-stop",60385),graphLine:f("graph-line",60386),graphScatter:f("graph-scatter",60387),pieChart:f("pie-chart",60388),bracket:f("bracket",60175),bracketDot:f("bracket-dot",60389),bracketError:f("bracket-error",60390),lockSmall:f("lock-small",60391),azureDevops:f("azure-devops",60392),verifiedFilled:f("verified-filled",60393),newline:f("newline",60394),layout:f("layout",60395),layoutActivitybarLeft:f("layout-activitybar-left",60396),layoutActivitybarRight:f("layout-activitybar-right",60397),layoutPanelLeft:f("layout-panel-left",60398),layoutPanelCenter:f("layout-panel-center",60399),layoutPanelJustify:f("layout-panel-justify",60400),layoutPanelRight:f("layout-panel-right",60401),layoutPanel:f("layout-panel",60402),layoutSidebarLeft:f("layout-sidebar-left",60403),layoutSidebarRight:f("layout-sidebar-right",60404),layoutStatusbar:f("layout-statusbar",60405),layoutMenubar:f("layout-menubar",60406),layoutCentered:f("layout-centered",60407),target:f("target",60408),indent:f("indent",60409),recordSmall:f("record-small",60410),errorSmall:f("error-small",60411),terminalDecorationError:f("terminal-decoration-error",60411),arrowCircleDown:f("arrow-circle-down",60412),arrowCircleLeft:f("arrow-circle-left",60413),arrowCircleRight:f("arrow-circle-right",60414),arrowCircleUp:f("arrow-circle-up",60415),layoutSidebarRightOff:f("layout-sidebar-right-off",60416),layoutPanelOff:f("layout-panel-off",60417),layoutSidebarLeftOff:f("layout-sidebar-left-off",60418),blank:f("blank",60419),heartFilled:f("heart-filled",60420),map:f("map",60421),mapHorizontal:f("map-horizontal",60421),foldHorizontal:f("fold-horizontal",60421),mapFilled:f("map-filled",60422),mapHorizontalFilled:f("map-horizontal-filled",60422),foldHorizontalFilled:f("fold-horizontal-filled",60422),circleSmall:f("circle-small",60423),bellSlash:f("bell-slash",60424),bellSlashDot:f("bell-slash-dot",60425),commentUnresolved:f("comment-unresolved",60426),gitPullRequestGoToChanges:f("git-pull-request-go-to-changes",60427),gitPullRequestNewChanges:f("git-pull-request-new-changes",60428),searchFuzzy:f("search-fuzzy",60429),commentDraft:f("comment-draft",60430),send:f("send",60431),sparkle:f("sparkle",60432),insert:f("insert",60433),mic:f("mic",60434),thumbsdownFilled:f("thumbsdown-filled",60435),thumbsupFilled:f("thumbsup-filled",60436),coffee:f("coffee",60437),snake:f("snake",60438),game:f("game",60439),vr:f("vr",60440),chip:f("chip",60441),piano:f("piano",60442),music:f("music",60443),micFilled:f("mic-filled",60444),repoFetch:f("repo-fetch",60445),copilot:f("copilot",60446),lightbulbSparkle:f("lightbulb-sparkle",60447),robot:f("robot",60448),sparkleFilled:f("sparkle-filled",60449),diffSingle:f("diff-single",60450),diffMultiple:f("diff-multiple",60451),surroundWith:f("surround-with",60452),share:f("share",60453),gitStash:f("git-stash",60454),gitStashApply:f("git-stash-apply",60455),gitStashPop:f("git-stash-pop",60456),vscode:f("vscode",60457),vscodeInsiders:f("vscode-insiders",60458),codeOss:f("code-oss",60459),runCoverage:f("run-coverage",60460),runAllCoverage:f("run-all-coverage",60461),coverage:f("coverage",60462),githubProject:f("github-project",60463),mapVertical:f("map-vertical",60464),foldVertical:f("fold-vertical",60464),mapVerticalFilled:f("map-vertical-filled",60465),foldVerticalFilled:f("fold-vertical-filled",60465),goToSearch:f("go-to-search",60466),percentage:f("percentage",60467),sortPercentage:f("sort-percentage",60467),attach:f("attach",60468)};function jh(){return Object.values(dt)}var jP={dialogError:f("dialog-error","error"),dialogWarning:f("dialog-warning","warning"),dialogInfo:f("dialog-info","info"),dialogClose:f("dialog-close","close"),treeItemExpanded:f("tree-item-expanded","chevron-down"),treeFilterOnTypeOn:f("tree-filter-on-type-on","list-filter"),treeFilterOnTypeOff:f("tree-filter-on-type-off","list-selection"),treeFilterClear:f("tree-filter-clear","close"),treeItemLoading:f("tree-item-loading","loading"),menuSelection:f("menu-selection","check"),menuSubmenu:f("menu-submenu","chevron-right"),menuBarMore:f("menubar-more","more"),scrollbarButtonLeft:f("scrollbar-button-left","triangle-left"),scrollbarButtonRight:f("scrollbar-button-right","triangle-right"),scrollbarButtonUp:f("scrollbar-button-up","triangle-up"),scrollbarButtonDown:f("scrollbar-button-down","triangle-down"),toolBarMore:f("toolbar-more","more"),quickInputBack:f("quick-input-back","arrow-left"),dropDownButton:f("drop-down-button",60084),symbolCustomColor:f("symbol-customcolor",60252),exportIcon:f("export",60332),workspaceUnspecified:f("workspace-unspecified",60355),newLine:f("newline",60394),thumbsDownFilled:f("thumbsdown-filled",60435),thumbsUpFilled:f("thumbsup-filled",60436),gitFetch:f("git-fetch",60445),lightbulbSparkleAutofix:f("lightbulb-sparkle-autofix",60447),debugBreakpointPending:f("debug-breakpoint-pending",60377)},dt={...Hb,...jP};var zb;(t=>{function n(e){return e&&typeof e=="object"&&typeof e.id=="string"}t.isThemeColor=n})(zb||={});var Ft;(v=>{v.iconNameSegment="[A-Za-z0-9]+",v.iconNameExpression="[A-Za-z0-9-]+",v.iconModifierExpression="~[A-Za-z]+",v.iconNameCharacter="[A-Za-z0-9~-]";let i=new RegExp(`^(${v.iconNameExpression})(${v.iconModifierExpression})?$`);function o(b){let C=i.exec(b.id);if(!C)return o(dt.error);let[,k,_]=C,T=["codicon","codicon-"+k];return _&&T.push("codicon-modifier-"+_.substring(1)),T}v.asClassNameArray=o;function s(b){return o(b).join(" ")}v.asClassName=s;function a(b){return"."+o(b).join(".")}v.asCSSSelector=a;function l(b){return b&&typeof b=="object"&&typeof b.id=="string"&&(typeof b.color>"u"||zb.isThemeColor(b.color))}v.isThemeIcon=l;let c=new RegExp(`^\\$\\((${v.iconNameExpression}(?:${v.iconModifierExpression})?)\\)$`);function d(b){let C=c.exec(b);if(!C)return;let[,k]=C;return{id:k}}v.fromString=d;function u(b){return{id:b}}v.fromId=u;function m(b,C){let k=b.id,_=k.lastIndexOf("~");return _!==-1&&(k=k.substring(0,_)),C&&(k=`${k}~${C}`),{id:k}}v.modify=m;function h(b){let C=b.id.lastIndexOf("~");if(C!==-1)return b.id.substring(C+1)}v.getModifier=h;function y(b,C){return b.id===C.id&&b.color?.id===C.color?.id}v.isEqual=y})(Ft||={});var FU=Object.freeze({View:In("view","View"),Help:In("help","Help"),Test:In("test","Test"),File:In("file","File"),Preferences:In("preferences","Preferences"),Developer:In({key:"developer",comment:["A developer on Code itself or someone diagnosing issues in Code"]},"Developer")});var GP=F("commandService"),qb=new class{_commands=new Map;_onDidRegisterCommand=new S;onDidRegisterCommand=this._onDidRegisterCommand.event;registerCommand(n,t){if(!n)throw new Error("invalid command");if(typeof n=="string"){if(!t)throw new Error("invalid command");return this.registerCommand({id:n,handler:t})}if(n.metadata&&Array.isArray(n.metadata.args)){let s=[];for(let l of n.metadata.args)s.push(l.constraint);let a=n.handler;n.handler=function(l,...c){return uI(c,s),a(l,...c)}}let{id:e}=n,r=this._commands.get(e);r||(r=new Pi,this._commands.set(e,r));let i=r.unshift(n),o=$(()=>{i(),this._commands.get(e)?.isEmpty()&&this._commands.delete(e)});return this._onDidRegisterCommand.fire(e),o}registerCommandAlias(n,t){return qb.registerCommand(n,(e,...r)=>e.get(GP).executeCommand(t,...r))}getCommand(n){let t=this._commands.get(n);if(!(!t||t.isEmpty()))return jr.first(t)}getCommands(){let n=new Map;for(let t of this._commands.keys()){let e=this.getCommand(t);e&&n.set(t,e)}return n}};qb.registerCommand("noop",()=>{});var A=F("logService"),Ai=F("loggerService");function Dn(){return new Date().toISOString()}function uc(n){return Ci(n)}var pc=3;function fc(n,t,e){switch(t){case 1:n.trace(e);break;case 2:n.debug(e);break;case 3:n.info(e);break;case 4:n.warn(e);break;case 5:n.error(e);break;case 0:break;default:throw new Error(`Invalid log level ${t}`)}}function Ws(n,t=!1){let e="";for(let r=0;r<n.length;r++){let i=n[r];if(i instanceof Error&&(i=zt(i,t)),typeof i=="object")try{i=JSON.stringify(i)}catch{}e+=(r>0?" ":"")+i}return e}var cc=class extends D{level=pc;_onDidChangeLogLevel=this._register(new S);onDidChangeLogLevel=this._onDidChangeLogLevel.event;setLevel(t){this.level!==t&&(this.level=t,this._onDidChangeLogLevel.fire(this.level))}getLevel(){return this.level}checkLogLevel(t){return this.level!==0&&this.level<=t}},Ao=class extends cc{constructor(e){super();this.logAlways=e}checkLogLevel(e){return this.logAlways||super.checkLogLevel(e)}trace(e,...r){this.checkLogLevel(1)&&this.log(1,Ws([e,...r],!0))}debug(e,...r){this.checkLogLevel(2)&&this.log(2,Ws([e,...r]))}info(e,...r){this.checkLogLevel(3)&&this.log(3,Ws([e,...r]))}warn(e,...r){this.checkLogLevel(4)&&this.log(4,Ws([e,...r]))}error(e,...r){if(this.checkLogLevel(5))if(e instanceof Error){let i=Array.prototype.slice.call(arguments);i[0]=e.stack,this.log(5,Ws(i))}else this.log(5,Ws([e,...r]))}flush(){}},Hu=class extends cc{useColors;constructor(t=pc){super(),this.setLevel(t),this.useColors=!U}trace(t,...e){this.checkLogLevel(1)&&(this.useColors?console.log(`\x1B[90m[main ${Dn()}]\x1B[0m`,t,...e):console.log(`[main ${Dn()}]`,t,...e))}debug(t,...e){this.checkLogLevel(2)&&(this.useColors?console.log(`\x1B[90m[main ${Dn()}]\x1B[0m`,t,...e):console.log(`[main ${Dn()}]`,t,...e))}info(t,...e){this.checkLogLevel(3)&&(this.useColors?console.log(`\x1B[90m[main ${Dn()}]\x1B[0m`,t,...e):console.log(`[main ${Dn()}]`,t,...e))}warn(t,...e){this.checkLogLevel(4)&&(this.useColors?console.warn(`\x1B[93m[main ${Dn()}]\x1B[0m`,t,...e):console.warn(`[main ${Dn()}]`,t,...e))}error(t,...e){this.checkLogLevel(5)&&(this.useColors?console.error(`\x1B[91m[main ${Dn()}]\x1B[0m`,t,...e):console.error(`[main ${Dn()}]`,t,...e))}flush(){}};var zu=class extends cc{constructor(e){super();this.loggers=e;e.length&&this.setLevel(e[0].getLevel())}setLevel(e){for(let r of this.loggers)r.setLevel(e);super.setLevel(e)}trace(e,...r){for(let i of this.loggers)i.trace(e,...r)}debug(e,...r){for(let i of this.loggers)i.debug(e,...r)}info(e,...r){for(let i of this.loggers)i.info(e,...r)}warn(e,...r){for(let i of this.loggers)i.warn(e,...r)}error(e,...r){for(let i of this.loggers)i.error(e,...r)}flush(){for(let e of this.loggers)e.flush()}dispose(){for(let e of this.loggers)e.dispose();super.dispose()}},dc=class extends D{constructor(e,r,i){super();this.logLevel=e;this.logsHome=r;if(i)for(let o of i)this._loggers.set(o.resource,{logger:void 0,info:o})}_loggers=new Ue;_onDidChangeLoggers=this._register(new S);onDidChangeLoggers=this._onDidChangeLoggers.event;_onDidChangeLogLevel=this._register(new S);onDidChangeLogLevel=this._onDidChangeLogLevel.event;_onDidChangeVisibility=this._register(new S);onDidChangeVisibility=this._onDidChangeVisibility.event;getLoggerEntry(e){return ke(e)?[...this._loggers.values()].find(r=>r.info.id===e):this._loggers.get(e)}getLogger(e){return this.getLoggerEntry(e)?.logger}createLogger(e,r){let i=this.toResource(e),o=ke(e)?e:r?.id??qt(i.toString()).toString(16),s=this._loggers.get(i)?.logger,a=r?.logLevel==="always"?1:r?.logLevel;s||(s=this.doCreateLogger(i,a??this.getLogLevel(i)??this.logLevel,{...r,id:o}));let l={logger:s,info:{resource:i,id:o,logLevel:a,name:r?.name,hidden:r?.hidden,extensionId:r?.extensionId,when:r?.when}};return this.registerLogger(l.info),this._loggers.set(i,l),s}toResource(e){return ke(e)?ne(this.logsHome,`${e}.log`):e}setLogLevel(e,r){if(x.isUri(e)){let i=e,o=r,s=this._loggers.get(i);s&&o!==s.info.logLevel&&(s.info.logLevel=o===this.logLevel?void 0:o,s.logger?.setLevel(o),this._loggers.set(s.info.resource,s),this._onDidChangeLogLevel.fire([i,o]))}else{this.logLevel=e;for(let[i,o]of this._loggers.entries())this._loggers.get(i)?.info.logLevel===void 0&&o.logger?.setLevel(this.logLevel);this._onDidChangeLogLevel.fire(this.logLevel)}}setVisibility(e,r){let i=this.getLoggerEntry(e);i&&r!==!i.info.hidden&&(i.info.hidden=!r,this._loggers.set(i.info.resource,i),this._onDidChangeVisibility.fire([i.info.resource,r]))}getLogLevel(e){let r;return e&&(r=this._loggers.get(e)?.info.logLevel),r??this.logLevel}registerLogger(e){let r=this._loggers.get(e.resource);r?r.info.hidden!==e.hidden&&this.setVisibility(e.resource,!e.hidden):(this._loggers.set(e.resource,{info:e,logger:void 0}),this._onDidChangeLoggers.fire({added:[e],removed:[]}))}deregisterLogger(e){let r=this._loggers.get(e);r&&(r.logger&&r.logger.dispose(),this._loggers.delete(e),this._onDidChangeLoggers.fire({added:[],removed:[r.info]}))}*getRegisteredLoggers(){for(let e of this._loggers.values())yield e.info}getRegisteredLogger(e){return this._loggers.get(e)?.info}dispose(){this._loggers.forEach(e=>e.logger?.dispose()),this._loggers.clear(),super.dispose()}},Gh=class{onDidChangeLogLevel=new S().event;setLevel(t){}getLevel(){return 3}trace(t,...e){}debug(t,...e){}info(t,...e){}warn(t,...e){}error(t,...e){}critical(t,...e){}dispose(){}flush(){}},qu=class extends Gh{};function $b(n){if(n.verbose)return 1;if(typeof n.logLevel=="string"){let t=QP(n.logLevel.toLowerCase());if(t!==void 0)return t}return pc}function JP(n){switch(n){case 1:return"trace";case 2:return"debug";case 3:return"info";case 4:return"warn";case 5:return"error";case 0:return"off"}}function QP(n){switch(n){case"trace":return 1;case"debug":return 2;case"info":return 3;case"warn":return 4;case"error":return 5;case"critical":return 5;case"off":return 0}}var C7=new As("logLevel",JP(3));var wr=F("requestService"),Qh=class{constructor(t){this.original=t}headers;toJSON(){if(!this.headers){let t=Object.create(null);for(let e in this.original)e.toLowerCase()==="authorization"||e.toLowerCase()==="proxy-authorization"?t[e]="*****":t[e]=this.original[e];this.headers=t}return this.headers}},$u=class extends D{constructor(e){super();this.logService=e}counter=0;async logAndRequest(e,r){let i=`[network] #${++this.counter}: ${e.url}`;this.logService.trace(`${i} - begin`,e.type,new Qh(e.headers??{}));try{let o=await r();return this.logService.trace(`${i} - end`,e.type,o.res.statusCode,o.res.headers),o}catch(o){throw this.logService.error(`${i} - error`,e.type,Fr(o)),o}}};function YP(n){return n.res.statusCode&&n.res.statusCode>=200&&n.res.statusCode<300||n.res.statusCode===1223}function XP(n){return n.res.statusCode===204}async function ju(n){if(!YP(n))throw new Error("Server returned "+n.res.statusCode);if(XP(n))return null;let e=(await ii(n.stream)).toString();try{return JSON.parse(e)}catch(r){throw r.message+=`:
`+e,r}}var Jh;function ZP(n){let t=De.as(Et.Configuration),e=Jh;Jh={id:"http",order:15,title:p("httpConfigurationTitle","HTTP"),type:"object",scope:n,properties:{"http.proxy":{type:"string",pattern:"^(https?|socks|socks4a?|socks5h?)://([^:]*(:[^@]*)?@)?([^:]+|\\[[:0-9a-fA-F]+\\])(:\\d+)?/?$|^$",markdownDescription:p("proxy","The proxy setting to use. If not set, will be inherited from the `http_proxy` and `https_proxy` environment variables."),restricted:!0},"http.proxyStrictSSL":{type:"boolean",default:!0,description:p("strictSSL","Controls whether the proxy server certificate should be verified against the list of supplied CAs."),restricted:!0},"http.proxyKerberosServicePrincipal":{type:"string",markdownDescription:p("proxyKerberosServicePrincipal","Overrides the principal service name for Kerberos authentication with the HTTP proxy. A default based on the proxy hostname is used when this is not set."),restricted:!0},"http.noProxy":{type:"array",items:{type:"string"},markdownDescription:p("noProxy","Specifies domain names for which proxy settings should be ignored for HTTP/HTTPS requests."),restricted:!0},"http.proxyAuthorization":{type:["null","string"],default:null,markdownDescription:p("proxyAuthorization","The value to send as the `Proxy-Authorization` header for every network request."),restricted:!0},"http.proxySupport":{type:"string",enum:["off","on","fallback","override"],enumDescriptions:[p("proxySupportOff","Disable proxy support for extensions."),p("proxySupportOn","Enable proxy support for extensions."),p("proxySupportFallback","Enable proxy support for extensions, fall back to request options, when no proxy found."),p("proxySupportOverride","Enable proxy support for extensions, override request options.")],default:"override",description:p("proxySupport","Use the proxy support for extensions."),restricted:!0},"http.systemCertificates":{type:"boolean",default:!0,description:p("systemCertificates","Controls whether CA certificates should be loaded from the OS. (On Windows and macOS, a reload of the window is required after turning this off.)"),restricted:!0},"http.experimental.systemCertificatesV2":{type:"boolean",tags:["experimental"],default:!1,description:p("systemCertificatesV2","Controls whether experimental loading of CA certificates from the OS should be enabled. This uses a more general approach than the default implemenation."),restricted:!0}}},t.updateConfigurations({add:[Jh],remove:e?[e]:[]})}ZP(1);var On=class n extends D{constructor(e,r=Object.create(null)){super();this.database=e;this.options=r;this.registerListeners()}static DEFAULT_FLUSH_DELAY=100;_onDidChangeStorage=this._register(new wo);onDidChangeStorage=this._onDidChangeStorage.event;state=0;cache=new Map;flushDelayer=this._register(new Ht(n.DEFAULT_FLUSH_DELAY));pendingDeletes=new Set;pendingInserts=new Map;pendingClose=void 0;whenFlushedCallbacks=[];registerListeners(){this._register(this.database.onDidChangeItemsExternal(e=>this.onDidChangeItemsExternal(e)))}onDidChangeItemsExternal(e){this._onDidChangeStorage.pause();try{e.changed?.forEach((r,i)=>this.acceptExternal(i,r)),e.deleted?.forEach(r=>this.acceptExternal(r,void 0))}finally{this._onDidChangeStorage.resume()}}acceptExternal(e,r){if(this.state===2)return;let i=!1;ct(r)?i=this.cache.delete(e):this.cache.get(e)!==r&&(this.cache.set(e,r),i=!0),i&&this._onDidChangeStorage.fire({key:e,external:!0})}get items(){return this.cache}get size(){return this.cache.size}async init(){this.state===0&&(this.state=1,this.options.hint!==0&&(this.cache=await this.database.getItems()))}get(e,r){let i=this.cache.get(e);return ct(i)?r:i}getBoolean(e,r){let i=this.get(e);return ct(i)?r:i==="true"}getNumber(e,r){let i=this.get(e);return ct(i)?r:parseInt(i,10)}getObject(e,r){let i=this.get(e);return ct(i)?r:pb(i)}async set(e,r,i=!1){if(this.state===2)return;if(ct(r))return this.delete(e,i);let o=qe(r)||Array.isArray(r)?ub(r):String(r);if(this.cache.get(e)!==o)return this.cache.set(e,o),this.pendingInserts.set(e,o),this.pendingDeletes.delete(e),this._onDidChangeStorage.fire({key:e,external:i}),this.doFlush()}async delete(e,r=!1){if(!(this.state===2||!this.cache.delete(e)))return this.pendingDeletes.has(e)||this.pendingDeletes.add(e),this.pendingInserts.delete(e),this._onDidChangeStorage.fire({key:e,external:r}),this.doFlush()}async optimize(){if(this.state!==2)return await this.flush(0),this.database.optimize()}async close(){return this.pendingClose||(this.pendingClose=this.doClose()),this.pendingClose}async doClose(){this.state=2;try{await this.doFlush(0)}catch{}await this.database.close(()=>this.cache)}get hasPending(){return this.pendingInserts.size>0||this.pendingDeletes.size>0}async flushPending(){if(!this.hasPending)return;let e={insert:this.pendingInserts,delete:this.pendingDeletes};return this.pendingDeletes=new Set,this.pendingInserts=new Map,this.database.updateItems(e).finally(()=>{if(!this.hasPending)for(;this.whenFlushedCallbacks.length;)this.whenFlushedCallbacks.pop()?.()})}async flush(e){if(!(this.state===2||this.pendingClose))return this.doFlush(e)}async doFlush(e){return this.options.hint===1?this.flushPending():this.flushDelayer.trigger(()=>this.flushPending(),e)}async whenFlushed(){if(this.hasPending)return new Promise(e=>this.whenFlushedCallbacks.push(e))}isInMemory(){return this.options.hint===1}},Us=class{onDidChangeItemsExternal=E.None;items=new Map;async getItems(){return this.items}async updateItems(t){t.insert?.forEach((e,r)=>this.items.set(r,e)),t.delete?.forEach(e=>this.items.delete(e))}async optimize(){}async close(){}};var Ns="**",jb="/",Gu="[/\\\\]",Ju="[^/\\\\]",eT=/\//g;function Gb(n,t){switch(n){case 0:return"";case 1:return`${Ju}*?`;default:return`(?:${Gu}|${Ju}+${Gu}${t?`|${Gu}${Ju}+`:""})*?`}}function Jb(n,t){if(!n)return[];let e=[],r=!1,i=!1,o="";for(let s of n){switch(s){case t:if(!r&&!i){e.push(o),o="";continue}break;case"{":r=!0;break;case"}":r=!1;break;case"[":i=!0;break;case"]":i=!1;break}o+=s}return o&&e.push(o),e}function ew(n){if(!n)return"";let t="",e=Jb(n,jb);if(e.every(r=>r===Ns))t=".*";else{let r=!1;e.forEach((i,o)=>{if(i===Ns){if(r)return;t+=Gb(2,o===e.length-1)}else{let s=!1,a="",l=!1,c="";for(let d of i){if(d!=="}"&&s){a+=d;continue}if(l&&(d!=="]"||!c)){let u;d==="-"?u=d:(d==="^"||d==="!")&&!c?u="^":d===jb?u="":u=ei(d),c+=u;continue}switch(d){case"{":s=!0;continue;case"[":l=!0;continue;case"}":{let m=`(?:${Jb(a,",").map(h=>ew(h)).join("|")})`;t+=m,s=!1,a="";break}case"]":{t+="["+c+"]",l=!1,c="";break}case"?":t+=Ju;continue;case"*":t+=Gb(1);continue;default:t+=ei(d)}}o<e.length-1&&(e[o+1]!==Ns||o+2<e.length)&&(t+=Gu)}r=i===Ns})}return t}var tT=/^\*\*\/\*\.[\w\.-]+$/,rT=/^\*\*\/([\w\.-]+)\/?$/,nT=/^{\*\*\/\*?[\w\.-]+\/?(,\*\*\/\*?[\w\.-]+\/?)*}$/,iT=/^{\*\*\/\*?[\w\.-]+(\/(\*\*)?)?(,\*\*\/\*?[\w\.-]+(\/(\*\*)?)?)*}$/,oT=/^\*\*((\/[\w\.-]+)+)\/?$/,sT=/^([\w\.-]+(\/[\w\.-]+)*)\/?$/,Qb=new Qn(1e4),Yb=function(){return!1},Fn=function(){return null};function Xh(n,t){if(!n)return Fn;let e;typeof n!="string"?e=n.pattern:e=n,e=e.trim();let r=`${e}_${!!t.trimForExclusions}`,i=Qb.get(r);if(i)return Xb(i,n);let o;return tT.test(e)?i=aT(e.substr(4),e):(o=rT.exec(Yh(e,t)))?i=lT(o[1],e):(t.trimForExclusions?iT:nT).test(e)?i=cT(e,t):(o=oT.exec(Yh(e,t)))?i=Zb(o[1].substr(1),e,!0):(o=sT.exec(Yh(e,t)))?i=Zb(o[1],e,!1):i=dT(e),Qb.set(r,i),Xb(i,n)}function Xb(n,t){if(typeof t=="string")return n;let e=function(r,i){return ti(r,t.base,!Q)?n(Jd(r.substr(t.base.length),ht),i):null};return e.allBasenames=n.allBasenames,e.allPaths=n.allPaths,e.basenames=n.basenames,e.patterns=n.patterns,e}function Yh(n,t){return t.trimForExclusions&&n.endsWith("/**")?n.substr(0,n.length-2):n}function aT(n,t){return function(e,r){return typeof e=="string"&&e.endsWith(n)?t:null}}function lT(n,t){let e=`/${n}`,r=`\\${n}`,i=function(s,a){return typeof s!="string"?null:a?a===n?t:null:s===n||s.endsWith(e)||s.endsWith(r)?t:null},o=[n];return i.basenames=o,i.patterns=[t],i.allBasenames=o,i}function cT(n,t){let e=rw(n.slice(1,-1).split(",").map(a=>Xh(a,t)).filter(a=>a!==Fn),n),r=e.length;if(!r)return Fn;if(r===1)return e[0];let i=function(a,l){for(let c=0,d=e.length;c<d;c++)if(e[c](a,l))return n;return null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function Zb(n,t,e){let r=ht===ee.sep,i=r?n:n.replace(eT,ht),o=ht+i,s=ee.sep+n,a;return e?a=function(l,c){return typeof l=="string"&&(l===i||l.endsWith(o)||!r&&(l===n||l.endsWith(s)))?t:null}:a=function(l,c){return typeof l=="string"&&(l===i||!r&&l===n)?t:null},a.allPaths=[(e?"*/":"./")+n],a}function dT(n){try{let t=new RegExp(`^${ew(n)}$`);return function(e){return t.lastIndex=0,typeof e=="string"&&t.test(e)?n:null}}catch{return Fn}}function tw(n,t={}){if(!n)return Yb;if(typeof n=="string"||uT(n)){let e=Xh(n,t);if(e===Fn)return Yb;let r=function(i,o){return!!e(i,o)};return e.allBasenames&&(r.allBasenames=e.allBasenames),e.allPaths&&(r.allPaths=e.allPaths),r}return pT(n,t)}function uT(n){let t=n;return t?typeof t.base=="string"&&typeof t.pattern=="string":!1}function pT(n,t){let e=rw(Object.getOwnPropertyNames(n).map(a=>fT(a,n[a],t)).filter(a=>a!==Fn)),r=e.length;if(!r)return Fn;if(!e.some(a=>!!a.requiresSiblings)){if(r===1)return e[0];let a=function(d,u){let m;for(let h=0,y=e.length;h<y;h++){let v=e[h](d,u);if(typeof v=="string")return v;Iu(v)&&(m||(m=[]),m.push(v))}return m?(async()=>{for(let h of m){let y=await h;if(typeof y=="string")return y}return null})():null},l=e.find(d=>!!d.allBasenames);l&&(a.allBasenames=l.allBasenames);let c=e.reduce((d,u)=>u.allPaths?d.concat(u.allPaths):d,[]);return c.length&&(a.allPaths=c),a}let i=function(a,l,c){let d,u;for(let m=0,h=e.length;m<h;m++){let y=e[m];y.requiresSiblings&&c&&(l||(l=pe(a)),d||(d=l.substr(0,l.length-ls(a).length)));let v=y(a,l,d,c);if(typeof v=="string")return v;Iu(v)&&(u||(u=[]),u.push(v))}return u?(async()=>{for(let m of u){let h=await m;if(typeof h=="string")return h}return null})():null},o=e.find(a=>!!a.allBasenames);o&&(i.allBasenames=o.allBasenames);let s=e.reduce((a,l)=>l.allPaths?a.concat(l.allPaths):a,[]);return s.length&&(i.allPaths=s),i}function fT(n,t,e){if(t===!1)return Fn;let r=Xh(n,e);if(r===Fn)return Fn;if(typeof t=="boolean")return r;if(t){let i=t.when;if(typeof i=="string"){let o=(s,a,l,c)=>{if(!c||!r(s,a))return null;let d=i.replace("$(basename)",()=>l),u=c(d);return Iu(u)?u.then(m=>m?n:null):u?n:null};return o.requiresSiblings=!0,o}}return r}function rw(n,t){let e=n.filter(a=>!!a.basenames);if(e.length<2)return n;let r=e.reduce((a,l)=>{let c=l.basenames;return c?a.concat(c):a},[]),i;if(t){i=[];for(let a=0,l=r.length;a<l;a++)i.push(t)}else i=e.reduce((a,l)=>{let c=l.patterns;return c?a.concat(c):a},[]);let o=function(a,l){if(typeof a!="string")return null;if(!l){let d;for(d=a.length;d>0;d--){let u=a.charCodeAt(d-1);if(u===47||u===92)break}l=a.substr(d)}let c=r.indexOf(l);return c!==-1?i[c]:null};o.basenames=r,o.patterns=i,o.allBasenames=r;let s=n.filter(a=>!a.basenames);return s.push(o),s}function Zh(n,t){return Xn(n,t,(e,r)=>typeof e=="string"&&typeof r=="string"?e===r:typeof e!="string"&&typeof r!="string"?e.base===r.base&&e.pattern===r.pattern:!1)}var p9=new Uint32Array(10);var f9=new Uint8Array([114,82,115,101,69,102,97,113,81,116,84,100,119,87,99,122,120,118,103]),m9=new Uint16Array([107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]),h9=new Uint16Array([114,82,29810,115,30579,26483,101,102,29286,24934,29030,29798,30822,30310,26470,97,113,29809,116,84,100,119,99,122,120,118,103]),g9=new Uint16Array([114,82,29810,115,30579,26483,101,69,102,29286,24934,29030,29798,30822,30310,26470,97,113,81,29809,116,84,100,119,87,99,122,120,118,103,107,111,105,79,106,112,117,80,104,27496,28520,27752,121,110,27246,28782,27758,98,109,27757,108]);function nw(...n){return function(t,e){for(let r=0,i=n.length;r<i;r++){let o=n[r](t,e);if(o)return o}return null}}var E9=ow.bind(void 0,!1),iw=ow.bind(void 0,!0);function ow(n,t,e){if(!e||e.length<t.length)return null;let r;return n?r=En(e,t):r=e.indexOf(t)===0,r?t.length>0?[{start:0,end:t.length}]:[]:null}function mT(n,t){let e=t.toLowerCase().indexOf(n.toLowerCase());return e===-1?null:[{start:e,end:e+n.length}]}function hT(n,t){return eg(n.toLowerCase(),t.toLowerCase(),0,0)}function eg(n,t,e,r){if(e===n.length)return[];if(r===t.length)return null;if(n[e]===t[r]){let i=null;return(i=eg(n,t,e+1,r+1))?aw({start:r,end:r+1},i):null}return eg(n,t,e,r+1)}function rg(n){return 97<=n&&n<=122}function Yu(n){return 65<=n&&n<=90}function ng(n){return 48<=n&&n<=57}function gT(n){return n===32||n===9||n===10||n===13}var vT=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(n=>vT.add(n.charCodeAt(0)));function sw(n){return rg(n)||Yu(n)||ng(n)}function aw(n,t){return t.length===0?t=[n]:n.end===t[0].start?t[0].start=n.start:t.unshift(n),t}function lw(n,t){for(let e=t;e<n.length;e++){let r=n.charCodeAt(e);if(Yu(r)||ng(r)||e>0&&!sw(n.charCodeAt(e-1)))return e}return n.length}function tg(n,t,e,r){if(e===n.length)return[];if(r===t.length)return null;if(n[e]!==t[r].toLowerCase())return null;{let i=null,o=r+1;for(i=tg(n,t,e+1,r+1);!i&&(o=lw(t,o))<t.length;)i=tg(n,t,e+1,o),o++;return i===null?null:aw({start:r,end:r+1},i)}}function yT(n){let t=0,e=0,r=0,i=0,o=0;for(let d=0;d<n.length;d++)o=n.charCodeAt(d),Yu(o)&&t++,rg(o)&&e++,sw(o)&&r++,ng(o)&&i++;let s=t/n.length,a=e/n.length,l=r/n.length,c=i/n.length;return{upperPercent:s,lowerPercent:a,alphaPercent:l,numericPercent:c}}function IT(n){let{upperPercent:t,lowerPercent:e}=n;return e===0&&t>.6}function bT(n){let{upperPercent:t,lowerPercent:e,alphaPercent:r,numericPercent:i}=n;return e>.2&&t<.8&&r>.6&&i<.2}function wT(n){let t=0,e=0,r=0,i=0;for(let o=0;o<n.length;o++)r=n.charCodeAt(o),Yu(r)&&t++,rg(r)&&e++,gT(r)&&i++;return(t===0||e===0)&&i===0?n.length<=30:t<=5}function cw(n,t){if(!t||(t=t.trim(),t.length===0)||!wT(n))return null;t.length>60&&(t=t.substring(0,60));let e=yT(t);if(!bT(e)){if(!IT(e))return null;t=t.toLowerCase()}let r=null,i=0;for(n=n.toLowerCase();i<t.length&&(r=tg(n,t,0,i))===null;)i=lw(t,i+1);return r}var P9=nw(iw,cw,mT),T9=nw(iw,cw,hT),C9=new Qn(1e4);var Qu=128;function ig(){let n=[],t=[];for(let e=0;e<=Qu;e++)t[e]=0;for(let e=0;e<=Qu;e++)n.push(t.slice(0));return n}function dw(n){let t=[];for(let e=0;e<=n;e++)t[e]=0;return t}var k9=dw(2*Qu),_9=dw(2*Qu),R9=ig(),D9=ig(),O9=ig();var ST;(e=>{e.Default=[-100,0];function t(r){return!r||r.length===2&&r[0]===-100&&r[1]===0}e.isDefault=t})(ST||={});var og=new RegExp(`\\$\\(${Ft.iconNameExpression}(?:${Ft.iconModifierExpression})?\\)`,"g"),N9=new RegExp(`(\\\\)?${og.source}`,"g");var B9=new RegExp(`\\\\${og.source}`,"g");var V9=new RegExp(`(\\s)?(\\\\)?${og.source}(\\s)?`,"g");var K9=new RegExp(`\\$\\(${Ft.iconNameCharacter}+\\)`,"g");var Pe=F("fileService");function Hs(n){return n.create===!0}function Nr(n){return!!(n.capabilities&2)}function mc(n){return!!(n.capabilities&8)}function Zu(n){return!!(n.capabilities&131072)}function ai(n){return!!(n.capabilities&4)}function ep(n){return!!(n.capabilities&16)}function tp(n){return Nr(n)?!!(n.capabilities&16384):!1}function sg(n){return Nr(n)?!!(n.capabilities&32768):!1}function uw(n){return!!(n.capabilities&65536)}var Bs=class n extends Error{constructor(e,r){super(e);this.code=r}static create(e,r){let i=new n(e.toString(),r);return xT(i,r),i}};function pr(n,t){return Bs.create(n,t)}function li(n){return n||pr(p("unknownError","Unknown Error"),"Unknown")}function xT(n,t){return n.name=t?`${t} (FileSystemError)`:"FileSystemError",n}function hc(n){if(!n)return"Unknown";if(n instanceof Bs)return n.code;let t=/^(.+) \(FileSystemError\)$/.exec(n.name);if(!t)return"Unknown";switch(t[1]){case"EntryExists":return"EntryExists";case"EntryIsADirectory":return"EntryIsADirectory";case"EntryNotADirectory":return"EntryNotADirectory";case"EntryNotFound":return"EntryNotFound";case"EntryTooLarge":return"EntryTooLarge";case"EntryWriteLocked":return"EntryWriteLocked";case"NoPermissions":return"NoPermissions";case"Unavailable":return"Unavailable"}return"Unknown"}function Sr(n){if(n instanceof Lt)return n.fileOperationResult;switch(hc(n)){case"EntryNotFound":return 1;case"EntryIsADirectory":return 0;case"EntryNotADirectory":return 9;case"EntryWriteLocked":return 5;case"NoPermissions":return 6;case"EntryExists":return 4;case"EntryTooLarge":return 7;default:return 10}}var si=class{constructor(t,e,r){this.resource=t;this.operation=e;this.target=r}isOperation(t){return this.operation===t}};var Xu=class n{constructor(t,e){this.ignorePathCasing=e;for(let r of t){switch(r.type){case 1:this.rawAdded.push(r.resource);break;case 0:this.rawUpdated.push(r.resource);break;case 2:this.rawDeleted.push(r.resource);break}this.correlationId!==n.MIXED_CORRELATION&&(typeof r.cId=="number"?this.correlationId===void 0?this.correlationId=r.cId:this.correlationId!==r.cId&&(this.correlationId=n.MIXED_CORRELATION):this.correlationId!==void 0&&(this.correlationId=n.MIXED_CORRELATION))}}static MIXED_CORRELATION=null;correlationId=void 0;added=new Ir(()=>{let t=lr.forUris(()=>this.ignorePathCasing);return t.fill(this.rawAdded.map(e=>[e,!0])),t});updated=new Ir(()=>{let t=lr.forUris(()=>this.ignorePathCasing);return t.fill(this.rawUpdated.map(e=>[e,!0])),t});deleted=new Ir(()=>{let t=lr.forUris(()=>this.ignorePathCasing);return t.fill(this.rawDeleted.map(e=>[e,!0])),t});contains(t,...e){return this.doContains(t,{includeChildren:!1},...e)}affects(t,...e){return this.doContains(t,{includeChildren:!0},...e)}doContains(t,e,...r){if(!t)return!1;let i=r.length>0;return!!((!i||r.includes(1))&&(this.added.value.get(t)||e.includeChildren&&this.added.value.findSuperstr(t))||(!i||r.includes(0))&&(this.updated.value.get(t)||e.includeChildren&&this.updated.value.findSuperstr(t))||(!i||r.includes(2))&&(this.deleted.value.findSubstr(t)||e.includeChildren&&this.deleted.value.findSuperstr(t)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(t){return this.correlationId===t}hasCorrelation(){return typeof this.correlationId=="number"}rawAdded=[];rawUpdated=[];rawDeleted=[]};function pw(n,t,e){return!n||!t||n===t||t.length>n.length?!1:(t.charAt(t.length-1)!==ht&&(t+=ht),e?En(n,t):n.indexOf(t)===0)}var Lt=class extends Error{constructor(e,r,i){super(e);this.fileOperationResult=r;this.options=i}},Vs=class extends Lt{constructor(e,r,i,o){super(e,r,o);this.fileOperationResult=r;this.size=i}},Ks=class extends Lt{constructor(e,r,i){super(e,2,i);this.stat=r}};var rp={OFF:"off",ON_EXIT:"onExit",ON_EXIT_AND_WINDOW_CLOSE:"onExitAndWindowClose"};var np="";function ag(n){if(!(typeof n.size!="number"||typeof n.mtime!="number"))return n.mtime.toString(29)+n.size.toString(31)}var Ln=class n{static KB=1024;static MB=n.KB*n.KB;static GB=n.MB*n.KB;static TB=n.GB*n.KB;static formatSize(t){return Ci(t)||(t=0),t<n.KB?p("sizeB","{0}B",t.toFixed(0)):t<n.MB?p("sizeKB","{0}KB",(t/n.KB).toFixed(2)):t<n.GB?p("sizeMB","{0}MB",(t/n.MB).toFixed(2)):t<n.TB?p("sizeGB","{0}GB",(t/n.GB).toFixed(2)):p("sizeTB","{0}TB",(t/n.TB).toFixed(2))}};var ut=F("IUriIdentityService");function fw(n){let t=n;return!!(t&&typeof t=="object"&&typeof t.id=="string"&&typeof t.isDefault=="boolean"&&typeof t.name=="string"&&x.isUri(t.location)&&x.isUri(t.globalStorageHome)&&x.isUri(t.settingsResource)&&x.isUri(t.keybindingsResource)&&x.isUri(t.tasksResource)&&x.isUri(t.snippetsHome)&&x.isUri(t.extensionsResource))}var jt=F("IUserDataProfilesService");function ip(n,t,e,r,i,o){return{id:n,name:t,location:e,isDefault:!1,shortName:i?.shortName,icon:i?.icon,globalStorageHome:o&&i?.useDefaultFlags?.globalState?o.globalStorageHome:ne(e,"globalStorage"),settingsResource:o&&i?.useDefaultFlags?.settings?o.settingsResource:ne(e,"settings.json"),keybindingsResource:o&&i?.useDefaultFlags?.keybindings?o.keybindingsResource:ne(e,"keybindings.json"),tasksResource:o&&i?.useDefaultFlags?.tasks?o.tasksResource:ne(e,"tasks.json"),snippetsHome:o&&i?.useDefaultFlags?.snippets?o.snippetsHome:ne(e,"snippets"),extensionsResource:o&&i?.useDefaultFlags?.extensions?o.extensionsResource:ne(e,"extensions.json"),cacheHome:ne(r,n),useDefaultFlags:i?.useDefaultFlags,isTransient:i?.transient}}var zs=class extends D{constructor(e,r,i,o){super();this.environmentService=e;this.fileService=r;this.uriIdentityService=i;this.logService=o;this.profilesHome=ne(this.environmentService.userRoamingDataHome,"profiles"),this.profilesCacheHome=ne(this.environmentService.cacheHome,"CachedProfilesData")}static PROFILES_KEY="userDataProfiles";static PROFILE_ASSOCIATIONS_KEY="profileAssociations";_serviceBrand;enabled=!0;profilesHome;profilesCacheHome;get defaultProfile(){return this.profiles[0]}get profiles(){return[...this.profilesObject.profiles,...this.transientProfilesObject.profiles]}_onDidChangeProfiles=this._register(new S);onDidChangeProfiles=this._onDidChangeProfiles.event;_onWillCreateProfile=this._register(new S);onWillCreateProfile=this._onWillCreateProfile.event;_onWillRemoveProfile=this._register(new S);onWillRemoveProfile=this._onWillRemoveProfile.event;_onDidResetWorkspaces=this._register(new S);onDidResetWorkspaces=this._onDidResetWorkspaces.event;profileCreationPromises=new Map;transientProfilesObject={profiles:[],folders:new Ue,workspaces:new Ue,emptyWindows:new Map};init(){this._profilesObject=void 0}setEnablement(e){this.enabled!==e&&(this._profilesObject=void 0,this.enabled=e)}isEnabled(){return this.enabled}_profilesObject;get profilesObject(){if(!this._profilesObject){let e=this.createDefaultProfile(),r=[e];if(this.enabled)try{for(let s of this.getStoredProfiles()){if(!s.name||!ke(s.name)||!s.location){this.logService.warn("Skipping the invalid stored profile",s.location||s.name);continue}r.push(ip(cr(s.location),s.name,s.location,this.profilesCacheHome,{shortName:s.shortName,icon:s.icon,useDefaultFlags:s.useDefaultFlags},e))}}catch(s){this.logService.error(s)}let i=new Ue,o=new Map;if(r.length)try{let s=this.getStoredProfileAssociations();if(s.workspaces)for(let[a,l]of Object.entries(s.workspaces)){let c=x.parse(a),d=r.find(u=>u.id===l);d&&i.set(c,d)}if(s.emptyWindows)for(let[a,l]of Object.entries(s.emptyWindows)){let c=r.find(d=>d.id===l);c&&o.set(a,c)}}catch(s){this.logService.error(s)}this._profilesObject={profiles:r,workspaces:i,emptyWindows:o}}return this._profilesObject}createDefaultProfile(){let e=ip("__default__profile__",p("defaultProfile","Default"),this.environmentService.userRoamingDataHome,this.profilesCacheHome);return{...e,extensionsResource:this.getDefaultProfileExtensionsLocation()??e.extensionsResource,isDefault:!0}}async createTransientProfile(e){let r="Temp",i=new RegExp(`${ei(r)}\\s(\\d+)`),o=0;for(let a of this.profiles){let l=i.exec(a.name),c=l?parseInt(l[1]):0;o=c>o?c:o}let s=`${r} ${o+1}`;return this.createProfile(qt(Ze()).toString(16),s,{transient:!0},e)}async createNamedProfile(e,r,i){return this.createProfile(qt(Ze()).toString(16),e,r,i)}async createProfile(e,r,i,o){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let s=await this.doCreateProfile(e,r,i);return o&&await this.setProfileForWorkspace(o,s),s}async doCreateProfile(e,r,i){if(!ke(r)||!r)throw new Error("Name of the profile is mandatory and must be of type `string`");let o=this.profileCreationPromises.get(r);return o||(o=(async()=>{try{if(this.profiles.find(c=>c.name===r||c.id===e))throw new Error(`Profile with ${r} name already exists`);let a=ip(e,r,ne(this.profilesHome,e),this.profilesCacheHome,i,this.defaultProfile);await this.fileService.createFolder(a.location);let l=[];return this._onWillCreateProfile.fire({profile:a,join(c){l.push(c)}}),await Xe.settled(l),this.updateProfiles([a],[],[]),a}finally{this.profileCreationPromises.delete(r)}})(),this.profileCreationPromises.set(r,o)),o}async updateProfile(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===e.id);if(!i)throw new Error(`Profile '${e.name}' does not exist`);return i=ip(i.id,r.name??i.name,i.location,this.profilesCacheHome,{shortName:r.shortName??i.shortName,icon:r.icon===null?void 0:r.icon??i.icon,transient:r.transient??i.isTransient,useDefaultFlags:r.useDefaultFlags??i.useDefaultFlags},this.defaultProfile),this.updateProfiles([],[],[i]),i}async removeProfile(e){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");if(e.isDefault)throw new Error("Cannot remove default profile");let r=this.profiles.find(o=>o.id===e.id);if(!r)throw new Error(`Profile '${e.name}' does not exist`);let i=[];this._onWillRemoveProfile.fire({profile:r,join(o){i.push(o)}});try{await Promise.allSettled(i)}catch(o){this.logService.error(o)}for(let o of[...this.profilesObject.emptyWindows.keys()])r.id===this.profilesObject.emptyWindows.get(o)?.id&&this.profilesObject.emptyWindows.delete(o);for(let o of[...this.profilesObject.workspaces.keys()])r.id===this.profilesObject.workspaces.get(o)?.id&&this.profilesObject.workspaces.delete(o);this.updateStoredProfileAssociations(),this.updateProfiles([],[r],[]);try{await this.fileService.del(r.cacheHome,{recursive:!0})}catch(o){Sr(o)!==1&&this.logService.error(o)}}async setProfileForWorkspace(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");let i=this.profiles.find(o=>o.id===r.id);if(!i)throw new Error(`Profile '${r.name}' does not exist`);this.updateWorkspaceAssociation(e,i)}unsetWorkspace(e,r){if(!this.enabled)throw new Error("Profiles are disabled in the current environment.");this.updateWorkspaceAssociation(e,void 0,r)}async resetWorkspaces(){this.transientProfilesObject.folders.clear(),this.transientProfilesObject.workspaces.clear(),this.transientProfilesObject.emptyWindows.clear(),this.profilesObject.workspaces.clear(),this.profilesObject.emptyWindows.clear(),this.updateStoredProfileAssociations(),this._onDidResetWorkspaces.fire()}async cleanUp(){if(this.enabled&&await this.fileService.exists(this.profilesHome)){let e=await this.fileService.resolve(this.profilesHome);await Promise.all((e.children||[]).filter(r=>r.isDirectory&&this.profiles.every(i=>!this.uriIdentityService.extUri.isEqual(i.location,r.resource))).map(r=>this.fileService.del(r.resource,{recursive:!0})))}}async cleanUpTransientProfiles(){if(!this.enabled)return;let e=this.transientProfilesObject.profiles.filter(r=>!this.isProfileAssociatedToWorkspace(r));await Promise.allSettled(e.map(r=>this.removeProfile(r)))}getProfileForWorkspace(e){let r=this.getWorkspace(e),i=x.isUri(r)?this.profilesObject.workspaces.get(r):this.profilesObject.emptyWindows.get(r);return i||(pt(e)?this.transientProfilesObject.folders.get(e.uri):Be(e)?this.transientProfilesObject.workspaces.get(e.configPath):this.transientProfilesObject.emptyWindows.get(e.id))}getWorkspace(e){return pt(e)?e.uri:Be(e)?e.configPath:e.id}isProfileAssociatedToWorkspace(e){return!!([...this.profilesObject.emptyWindows.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.profilesObject.workspaces.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.emptyWindows.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.workspaces.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location))||[...this.transientProfilesObject.folders.values()].some(r=>this.uriIdentityService.extUri.isEqual(r.location,e.location)))}updateProfiles(e,r,i){let o=[...this.profiles,...e],s=[],a=this.transientProfilesObject.profiles;this.transientProfilesObject.profiles=[];for(let l of o){if(l.isDefault||r.some(d=>l.id===d.id))continue;l=i.find(d=>l.id===d.id)??l;let c=a.find(d=>l.id===d.id);if(l.isTransient)this.transientProfilesObject.profiles.push(l);else{if(c){for(let[d,u]of this.transientProfilesObject.emptyWindows.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:d},l);break}for(let[d,u]of this.transientProfilesObject.workspaces.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:"",configPath:d},l);break}for(let[d,u]of this.transientProfilesObject.folders.entries())if(l.id===u.id){this.updateWorkspaceAssociation({id:"",uri:d},l);break}}s.push({location:l.location,name:l.name,shortName:l.shortName,icon:l.icon,useDefaultFlags:l.useDefaultFlags})}}this.saveStoredProfiles(s),this._profilesObject=void 0,this.triggerProfilesChanges(e,r,i)}triggerProfilesChanges(e,r,i){this._onDidChangeProfiles.fire({added:e,removed:r,updated:i,all:this.profiles})}updateWorkspaceAssociation(e,r,i){if(i=r?.isTransient?!0:i,i)pt(e)?(this.transientProfilesObject.folders.delete(e.uri),r&&this.transientProfilesObject.folders.set(e.uri,r)):Be(e)?(this.transientProfilesObject.workspaces.delete(e.configPath),r&&this.transientProfilesObject.workspaces.set(e.configPath,r)):(this.transientProfilesObject.emptyWindows.delete(e.id),r&&this.transientProfilesObject.emptyWindows.set(e.id,r));else{this.updateWorkspaceAssociation(e,void 0,!0);let o=this.getWorkspace(e);x.isUri(o)?(this.profilesObject.workspaces.delete(o),r&&this.profilesObject.workspaces.set(o,r)):(this.profilesObject.emptyWindows.delete(o),r&&this.profilesObject.emptyWindows.set(o,r)),this.updateStoredProfileAssociations()}}updateStoredProfileAssociations(){let e={};for(let[i,o]of this.profilesObject.workspaces.entries())e[i.toString()]=o.id;let r={};for(let[i,o]of this.profilesObject.emptyWindows.entries())r[i.toString()]=o.id;this.saveStoredProfileAssociations({workspaces:e,emptyWindows:r}),this._profilesObject=void 0}migrateStoredProfileAssociations(e){let r={},i=this.createDefaultProfile();if(e.workspaces)for(let[s,a]of Object.entries(e.workspaces)){let l=x.parse(a);r[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}let o={};if(e.emptyWindows)for(let[s,a]of Object.entries(e.emptyWindows)){let l=x.parse(a);o[s]=this.uriIdentityService.extUri.isEqual(l,i.location)?i.id:this.uriIdentityService.extUri.basename(l)}return{workspaces:r,emptyWindows:o}}getStoredProfiles(){return[]}saveStoredProfiles(e){throw new Error("not implemented")}getStoredProfileAssociations(){return{}}saveStoredProfileAssociations(e){throw new Error("not implemented")}getDefaultProfileExtensionsLocation(){}};zs=P([g(0,dr),g(1,Pe),g(2,ut),g(3,A)],zs);var vc="__$__isNewStorageMarker",ci="__$__targetStorageMarker",mw=F("storageService");function op(n){let t=n.get(ci);if(t)try{return JSON.parse(t)}catch{}return Object.create(null)}var $s=class n extends D{constructor(e={flushInterval:n.DEFAULT_FLUSH_INTERVAL}){super();this.options=e}static DEFAULT_FLUSH_INTERVAL=60*1e3;_onDidChangeValue=this._register(new wo);_onDidChangeTarget=this._register(new wo);onDidChangeTarget=this._onDidChangeTarget.event;_onWillSaveState=this._register(new S);onWillSaveState=this._onWillSaveState.event;initializationPromise;flushWhenIdleScheduler=this._register(new bt(()=>this.doFlushWhenIdle(),this.options.flushInterval));runFlushWhenIdle=this._register(new Mr);onDidChangeValue(e,r,i){return E.filter(this._onDidChangeValue.event,o=>o.scope===e&&(r===void 0||o.key===r),i)}doFlushWhenIdle(){this.runFlushWhenIdle.value=Wl(()=>{this.shouldFlushWhenIdle()&&this.flush(),this.flushWhenIdleScheduler.schedule()})}shouldFlushWhenIdle(){return!0}stopFlushWhenIdle(){ze([this.runFlushWhenIdle,this.flushWhenIdleScheduler])}initialize(){return this.initializationPromise||(this.initializationPromise=(async()=>{gt("code/willInitStorage");try{await this.doInitialize()}finally{gt("code/didInitStorage")}this.flushWhenIdleScheduler.schedule()})()),this.initializationPromise}emitDidChangeValue(e,r){let{key:i,external:o}=r;if(i===ci){switch(e){case-1:this._applicationKeyTargets=void 0;break;case 0:this._profileKeyTargets=void 0;break;case 1:this._workspaceKeyTargets=void 0;break}this._onDidChangeTarget.fire({scope:e})}else this._onDidChangeValue.fire({scope:e,key:i,target:this.getKeyTargets(e)[i],external:o})}emitWillSaveState(e){this._onWillSaveState.fire({reason:e})}get(e,r,i){return this.getStorage(r)?.get(e,i)}getBoolean(e,r,i){return this.getStorage(r)?.getBoolean(e,i)}getNumber(e,r,i){return this.getStorage(r)?.getNumber(e,i)}getObject(e,r,i){return this.getStorage(r)?.getObject(e,i)}storeAll(e,r){this.withPausedEmitters(()=>{for(let i of e)this.store(i.key,i.value,i.scope,i.target,r)})}store(e,r,i,o,s=!1){if(ct(r)){this.remove(e,i,s);return}this.withPausedEmitters(()=>{this.updateKeyTarget(e,i,o),this.getStorage(i)?.set(e,r,s)})}remove(e,r,i=!1){this.withPausedEmitters(()=>{this.updateKeyTarget(e,r,void 0),this.getStorage(r)?.delete(e,i)})}withPausedEmitters(e){this._onDidChangeValue.pause(),this._onDidChangeTarget.pause();try{e()}finally{this._onDidChangeValue.resume(),this._onDidChangeTarget.resume()}}keys(e,r){let i=[],o=this.getKeyTargets(e);for(let s of Object.keys(o))o[s]===r&&i.push(s);return i}updateKeyTarget(e,r,i,o=!1){let s=this.getKeyTargets(r);typeof i=="number"?s[e]!==i&&(s[e]=i,this.getStorage(r)?.set(ci,JSON.stringify(s),o)):typeof s[e]=="number"&&(delete s[e],this.getStorage(r)?.set(ci,JSON.stringify(s),o))}_workspaceKeyTargets=void 0;get workspaceKeyTargets(){return this._workspaceKeyTargets||(this._workspaceKeyTargets=this.loadKeyTargets(1)),this._workspaceKeyTargets}_profileKeyTargets=void 0;get profileKeyTargets(){return this._profileKeyTargets||(this._profileKeyTargets=this.loadKeyTargets(0)),this._profileKeyTargets}_applicationKeyTargets=void 0;get applicationKeyTargets(){return this._applicationKeyTargets||(this._applicationKeyTargets=this.loadKeyTargets(-1)),this._applicationKeyTargets}getKeyTargets(e){switch(e){case-1:return this.applicationKeyTargets;case 0:return this.profileKeyTargets;default:return this.workspaceKeyTargets}}loadKeyTargets(e){let r=this.getStorage(e);return r?op(r):Object.create(null)}isNew(e){return this.getBoolean(vc,e)===!0}async flush(e=0){this._onWillSaveState.fire({reason:e});let r=this.getStorage(-1),i=this.getStorage(0),o=this.getStorage(1);switch(e){case 0:await Xe.settled([r?.whenFlushed()??Promise.resolve(),i?.whenFlushed()??Promise.resolve(),o?.whenFlushed()??Promise.resolve()]);break;case 1:await Xe.settled([r?.flush(0)??Promise.resolve(),i?.flush(0)??Promise.resolve(),o?.flush(0)??Promise.resolve()]);break}}async log(){let e=this.getStorage(-1)?.items??new Map,r=this.getStorage(0)?.items??new Map,i=this.getStorage(1)?.items??new Map;return PT(e,r,i,this.getLogDetails(-1)??"",this.getLogDetails(0)??"",this.getLogDetails(1)??"")}async optimize(e){return await this.flush(),this.getStorage(e)?.optimize()}async switch(e,r){return this.emitWillSaveState(0),fw(e)?this.switchToProfile(e,r):this.switchToWorkspace(e,r)}canSwitchProfile(e,r){return!(e.id===r.id||gc(r)&&gc(e))}switchData(e,r,i){this.withPausedEmitters(()=>{let o=new Set;for(let[s,a]of e)o.add(s),r.get(s)!==a&&this.emitDidChangeValue(i,{key:s,external:!0});for(let[s]of r.items)o.has(s)||this.emitDidChangeValue(i,{key:s,external:!0})})}};function gc(n){return n.isDefault||!!n.useDefaultFlags?.globalState}async function PT(n,t,e,r,i,o){let s=v=>{try{return JSON.parse(v)}catch{return v}},a=new Map,l=new Map;n.forEach((v,b)=>{a.set(b,v),l.set(b,s(v))});let c=new Map,d=new Map;t.forEach((v,b)=>{c.set(b,v),d.set(b,s(v))});let u=new Map,m=new Map;e.forEach((v,b)=>{u.set(b,v),m.set(b,s(v))}),console.group(r!==i?`Storage: Application (path: ${r})`:`Storage: Application & Profile (path: ${r}, default profile)`);let h=[];if(a.forEach((v,b)=>{h.push({key:b,value:v})}),console.table(h),console.groupEnd(),console.log(l),r!==i){console.group(`Storage: Profile (path: ${i}, profile specific)`);let v=[];c.forEach((b,C)=>{v.push({key:C,value:b})}),console.table(v),console.groupEnd(),console.log(d)}console.group(`Storage: Workspace (path: ${o})`);let y=[];u.forEach((v,b)=>{y.push({key:b,value:v})}),console.table(y),console.groupEnd(),console.log(m)}import Vr from"electron";var sp=F("stateReadService"),et=F("stateService");import $T from"electron";function Ui(n,t){let e=Math.pow(10,t);return Math.round(n*e)/e}var de=class{_rgbaBrand=void 0;r;g;b;a;constructor(t,e,r,i=1){this.r=Math.min(255,Math.max(0,t))|0,this.g=Math.min(255,Math.max(0,e))|0,this.b=Math.min(255,Math.max(0,r))|0,this.a=Ui(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a}},Wi=class n{_hslaBrand=void 0;h;s;l;a;constructor(t,e,r,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Ui(Math.max(Math.min(1,e),0),3),this.l=Ui(Math.max(Math.min(1,r),0),3),this.a=Ui(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.l===e.l&&t.a===e.a}static fromRGBA(t){let e=t.r/255,r=t.g/255,i=t.b/255,o=t.a,s=Math.max(e,r,i),a=Math.min(e,r,i),l=0,c=0,d=(a+s)/2,u=s-a;if(u>0){switch(c=Math.min(d<=.5?u/(2*d):u/(2-2*d),1),s){case e:l=(r-i)/u+(r<i?6:0);break;case r:l=(i-e)/u+2;break;case i:l=(e-r)/u+4;break}l*=60,l=Math.round(l)}return new n(l,c,d,o)}static _hue2rgb(t,e,r){return r<0&&(r+=1),r>1&&(r-=1),r<1/6?t+(e-t)*6*r:r<1/2?e:r<2/3?t+(e-t)*(2/3-r)*6:t}static toRGBA(t){let e=t.h/360,{s:r,l:i,a:o}=t,s,a,l;if(r===0)s=a=l=i;else{let c=i<.5?i*(1+r):i+r-i*r,d=2*i-c;s=n._hue2rgb(d,c,e+1/3),a=n._hue2rgb(d,c,e),l=n._hue2rgb(d,c,e-1/3)}return new de(Math.round(s*255),Math.round(a*255),Math.round(l*255),o)}},js=class n{_hsvaBrand=void 0;h;s;v;a;constructor(t,e,r,i){this.h=Math.max(Math.min(360,t),0)|0,this.s=Ui(Math.max(Math.min(1,e),0),3),this.v=Ui(Math.max(Math.min(1,r),0),3),this.a=Ui(Math.max(Math.min(1,i),0),3)}static equals(t,e){return t.h===e.h&&t.s===e.s&&t.v===e.v&&t.a===e.a}static fromRGBA(t){let e=t.r/255,r=t.g/255,i=t.b/255,o=Math.max(e,r,i),s=Math.min(e,r,i),a=o-s,l=o===0?0:a/o,c;return a===0?c=0:o===e?c=((r-i)/a%6+6)%6:o===r?c=(i-e)/a+2:c=(e-r)/a+4,new n(Math.round(c*60),l,o,t.a)}static toRGBA(t){let{h:e,s:r,v:i,a:o}=t,s=i*r,a=s*(1-Math.abs(e/60%2-1)),l=i-s,[c,d,u]=[0,0,0];return e<60?(c=s,d=a):e<120?(c=a,d=s):e<180?(d=s,u=a):e<240?(d=a,u=s):e<300?(c=a,u=s):e<=360&&(c=s,u=a),c=Math.round((c+l)*255),d=Math.round((d+l)*255),u=Math.round((u+l)*255),new de(c,d,u,o)}},M=class n{static fromHex(t){return n.Format.CSS.parseHex(t)||n.red}static equals(t,e){return!t&&!e?!0:!t||!e?!1:t.equals(e)}rgba;_hsla;get hsla(){return this._hsla?this._hsla:Wi.fromRGBA(this.rgba)}_hsva;get hsva(){return this._hsva?this._hsva:js.fromRGBA(this.rgba)}constructor(t){if(t)if(t instanceof de)this.rgba=t;else if(t instanceof Wi)this._hsla=t,this.rgba=Wi.toRGBA(t);else if(t instanceof js)this._hsva=t,this.rgba=js.toRGBA(t);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(t){return!!t&&de.equals(this.rgba,t.rgba)&&Wi.equals(this.hsla,t.hsla)&&js.equals(this.hsva,t.hsva)}getRelativeLuminance(){let t=n._relativeLuminanceForComponent(this.rgba.r),e=n._relativeLuminanceForComponent(this.rgba.g),r=n._relativeLuminanceForComponent(this.rgba.b),i=.2126*t+.7152*e+.0722*r;return Ui(i,4)}static _relativeLuminanceForComponent(t){let e=t/255;return e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4)}getContrastRatio(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e>r?(e+.05)/(r+.05):(r+.05)/(e+.05)}isDarker(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3<128}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e>r}isDarkerThan(t){let e=this.getRelativeLuminance(),r=t.getRelativeLuminance();return e<r}lighten(t){return new n(new Wi(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*t,this.hsla.a))}darken(t){return new n(new Wi(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*t,this.hsla.a))}transparent(t){let{r:e,g:r,b:i,a:o}=this.rgba;return new n(new de(e,r,i,o*t))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new n(new de(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(t){let e=t.rgba,r=this.rgba.a,i=e.a,o=r+i*(1-r);if(o<1e-6)return n.transparent;let s=this.rgba.r*r/o+e.r*i*(1-r)/o,a=this.rgba.g*r/o+e.g*i*(1-r)/o,l=this.rgba.b*r/o+e.b*i*(1-r)/o;return new n(new de(s,a,l,o))}makeOpaque(t){if(this.isOpaque()||t.rgba.a!==1)return this;let{r:e,g:r,b:i,a:o}=this.rgba;return new n(new de(t.rgba.r-o*(t.rgba.r-e),t.rgba.g-o*(t.rgba.g-r),t.rgba.b-o*(t.rgba.b-i),1))}flatten(...t){let e=t.reduceRight((r,i)=>n._flatten(i,r));return n._flatten(this,e)}static _flatten(t,e){let r=1-t.rgba.a;return new n(new de(r*e.rgba.r+t.rgba.a*t.rgba.r,r*e.rgba.g+t.rgba.a*t.rgba.g,r*e.rgba.b+t.rgba.a*t.rgba.b))}_toString;toString(){return this._toString||(this._toString=n.Format.CSS.format(this)),this._toString}static getLighterColor(t,e,r){if(t.isLighterThan(e))return t;r=r||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return r=r*(o-i)/o,t.lighten(r)}static getDarkerColor(t,e,r){if(t.isDarkerThan(e))return t;r=r||.5;let i=t.getRelativeLuminance(),o=e.getRelativeLuminance();return r=r*(i-o)/i,t.darken(r)}static white=new n(new de(255,255,255,1));static black=new n(new de(0,0,0,1));static red=new n(new de(255,0,0,1));static blue=new n(new de(0,0,255,1));static green=new n(new de(0,255,0,1));static cyan=new n(new de(0,255,255,1));static lightgrey=new n(new de(211,211,211,1));static transparent=new n(new de(0,0,0,0))};(t=>{let n;(r=>{let e;(y=>{function i(v){return v.rgba.a===1?`rgb(${v.rgba.r}, ${v.rgba.g}, ${v.rgba.b})`:t.Format.CSS.formatRGBA(v)}y.formatRGB=i;function o(v){return`rgba(${v.rgba.r}, ${v.rgba.g}, ${v.rgba.b}, ${+v.rgba.a.toFixed(2)})`}y.formatRGBA=o;function s(v){return v.hsla.a===1?`hsl(${v.hsla.h}, ${(v.hsla.s*100).toFixed(2)}%, ${(v.hsla.l*100).toFixed(2)}%)`:t.Format.CSS.formatHSLA(v)}y.formatHSL=s;function a(v){return`hsla(${v.hsla.h}, ${(v.hsla.s*100).toFixed(2)}%, ${(v.hsla.l*100).toFixed(2)}%, ${v.hsla.a.toFixed(2)})`}y.formatHSLA=a;function l(v){let b=v.toString(16);return b.length!==2?"0"+b:b}function c(v){return`#${l(v.rgba.r)}${l(v.rgba.g)}${l(v.rgba.b)}`}y.formatHex=c;function d(v,b=!1){return b&&v.rgba.a===1?t.Format.CSS.formatHex(v):`#${l(v.rgba.r)}${l(v.rgba.g)}${l(v.rgba.b)}${l(Math.round(v.rgba.a*255))}`}y.formatHexA=d;function u(v){return v.isOpaque()?t.Format.CSS.formatHex(v):t.Format.CSS.formatRGBA(v)}y.format=u;function m(v){let b=v.length;if(b===0||v.charCodeAt(0)!==35)return null;if(b===7){let C=16*h(v.charCodeAt(1))+h(v.charCodeAt(2)),k=16*h(v.charCodeAt(3))+h(v.charCodeAt(4)),_=16*h(v.charCodeAt(5))+h(v.charCodeAt(6));return new t(new de(C,k,_,1))}if(b===9){let C=16*h(v.charCodeAt(1))+h(v.charCodeAt(2)),k=16*h(v.charCodeAt(3))+h(v.charCodeAt(4)),_=16*h(v.charCodeAt(5))+h(v.charCodeAt(6)),T=16*h(v.charCodeAt(7))+h(v.charCodeAt(8));return new t(new de(C,k,_,T/255))}if(b===4){let C=h(v.charCodeAt(1)),k=h(v.charCodeAt(2)),_=h(v.charCodeAt(3));return new t(new de(16*C+C,16*k+k,16*_+_))}if(b===5){let C=h(v.charCodeAt(1)),k=h(v.charCodeAt(2)),_=h(v.charCodeAt(3)),T=h(v.charCodeAt(4));return new t(new de(16*C+C,16*k+k,16*_+_,(16*T+T)/255))}return null}y.parseHex=m;function h(v){switch(v){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(e=r.CSS||={})})(n=t.Format||={})})(M||={});function TT(n){return n!==null&&typeof n=="object"&&"light"in n&&"dark"in n}var CT={ColorContribution:"base.contributions.colors"},kT="default",lg=class{_onDidChangeSchema=new S;onDidChangeSchema=this._onDidChangeSchema.event;colorsById;colorSchema={type:"object",properties:{}};colorReferenceSchema={type:"string",enum:[],enumDescriptions:[]};constructor(){this.colorsById={}}notifyThemeUpdate(t){for(let e of Object.keys(this.colorsById)){let r=t.getColor(e);r&&(this.colorSchema.properties[e].oneOf[0].defaultSnippets[0].body=`\${1:${r.toString()}}`)}this._onDidChangeSchema.fire()}registerColor(t,e,r,i=!1,o){let s={id:t,description:r,defaults:e,needsTransparency:i,deprecationMessage:o};this.colorsById[t]=s;let a={type:"string",format:"color-hex",defaultSnippets:[{body:"${1:#ff0000}"}]};return o&&(a.deprecationMessage=o),i&&(a.pattern="^#(?:(?<rgba>[0-9a-fA-f]{3}[0-9a-eA-E])|(?:[0-9a-fA-F]{6}(?:(?![fF]{2})(?:[0-9a-fA-F]{2}))))?$",a.patternErrorMessage=p("transparecyRequired","This color must be transparent or it will obscure content")),this.colorSchema.properties[t]={description:r,oneOf:[a,{type:"string",const:kT,description:p("useDefault","Use the default color.")}]},this.colorReferenceSchema.enum.push(t),this.colorReferenceSchema.enumDescriptions.push(r),this._onDidChangeSchema.fire(),t}deregisterColor(t){delete this.colorsById[t],delete this.colorSchema.properties[t];let e=this.colorReferenceSchema.enum.indexOf(t);e!==-1&&(this.colorReferenceSchema.enum.splice(e,1),this.colorReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChangeSchema.fire()}getColors(){return Object.keys(this.colorsById).map(t=>this.colorsById[t])}resolveDefaultColor(t,e){let r=this.colorsById[t];if(r?.defaults){let i=TT(r.defaults)?r.defaults[e.type]:r.defaults;return pn(i,e)}}getColorSchema(){return this.colorSchema}getColorReferenceSchema(){return this.colorReferenceSchema}toString(){let t=(e,r)=>{let i=e.indexOf(".")===-1?0:1,o=r.indexOf(".")===-1?0:1;return i!==o?i-o:e.localeCompare(r)};return Object.keys(this.colorsById).sort(t).map(e=>`- \`${e}\`: ${this.colorsById[e].description}`).join(`
`)}},ap=new lg;De.add(CT.ColorContribution,ap);function I(n,t,e,r,i){return ap.registerColor(n,t,e,r,i)}function _T(n,t){switch(n.op){case 0:return pn(n.value,t)?.darken(n.factor);case 1:return pn(n.value,t)?.lighten(n.factor);case 2:return pn(n.value,t)?.transparent(n.factor);case 3:{let e=pn(n.background,t);return e?pn(n.value,t)?.makeOpaque(e):pn(n.value,t)}case 4:for(let e of n.values){let r=pn(e,t);if(r)return r}return;case 6:return pn(t.defines(n.if)?n.then:n.else,t);case 5:{let e=pn(n.value,t);if(!e)return;let r=pn(n.background,t);return r?e.isDarkerThan(r)?M.getLighterColor(e,r,n.factor).transparent(n.transparency):M.getDarkerColor(e,r,n.factor).transparent(n.transparency):e.transparent(n.factor*n.transparency)}default:throw Hy(n)}}function Mn(n,t){return{op:0,value:n,factor:t}}function xr(n,t){return{op:1,value:n,factor:t}}function Z(n,t){return{op:2,value:n,factor:t}}function cg(...n){return{op:4,values:n}}function gw(n,t,e){return{op:6,if:n,then:t,else:e}}function dg(n,t,e,r){return{op:5,value:n,background:t,factor:e,transparency:r}}function pn(n,t){if(n!==null){if(typeof n=="string")return n[0]==="#"?M.fromHex(n):t.getColor(n);if(n instanceof M)return n;if(typeof n=="object")return _T(n,t)}}var vw="vscode://schemas/workbench-colors",yw=De.as(Po.JSONContribution);yw.registerSchema(vw,ap.getColorSchema());var hw=new bt(()=>yw.notifySchemaChanged(vw),200);ap.onDidChangeSchema(()=>{hw.isScheduled()||hw.schedule()});var ve=I("foreground",{dark:"#CCCCCC",light:"#616161",hcDark:"#FFFFFF",hcLight:"#292929"},p("foreground","Overall foreground color. This color is only used if not overridden by a component.")),$6=I("disabledForeground",{dark:"#CCCCCC80",light:"#61616180",hcDark:"#A5A5A5",hcLight:"#7F7F7F"},p("disabledForeground","Overall foreground for disabled elements. This color is only used if not overridden by a component.")),j6=I("errorForeground",{dark:"#F48771",light:"#A1260D",hcDark:"#F48771",hcLight:"#B5200D"},p("errorForeground","Overall foreground color for error messages. This color is only used if not overridden by a component.")),G6=I("descriptionForeground",{light:"#717171",dark:Z(ve,.7),hcDark:Z(ve,.7),hcLight:Z(ve,.7)},p("descriptionForeground","Foreground color for description text providing additional information, for example for a label.")),yc=I("icon.foreground",{dark:"#C5C5C5",light:"#424242",hcDark:"#FFFFFF",hcLight:"#292929"},p("iconForeground","The default color for icons in the workbench.")),Qr=I("focusBorder",{dark:"#007FD4",light:"#0090F1",hcDark:"#F38518",hcLight:"#006BBD"},p("focusBorder","Overall border color for focused elements. This color is only used if not overridden by a component.")),ye=I("contrastBorder",{light:null,dark:null,hcDark:"#6FC3DF",hcLight:"#0F4A85"},p("contrastBorder","An extra border around elements to separate them from others for greater contrast.")),Mt=I("contrastActiveBorder",{light:null,dark:null,hcDark:Qr,hcLight:Qr},p("activeContrastBorder","An extra border around active elements to separate them from others for greater contrast.")),J6=I("selection.background",null,p("selectionBackground","The background color of text selections in the workbench (e.g. for input fields or text areas). Note that this does not apply to selections within the editor.")),Q6=I("textLink.foreground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},p("textLinkForeground","Foreground color for links in text.")),Y6=I("textLink.activeForeground",{light:"#006AB1",dark:"#3794FF",hcDark:"#21A6FF",hcLight:"#0F4A85"},p("textLinkActiveForeground","Foreground color for links in text when clicked on and on mouse hover.")),X6=I("textSeparator.foreground",{light:"#0000002e",dark:"#ffffff2e",hcDark:M.black,hcLight:"#292929"},p("textSeparatorForeground","Color for text separators.")),Z6=I("textPreformat.foreground",{light:"#A31515",dark:"#D7BA7D",hcDark:"#000000",hcLight:"#FFFFFF"},p("textPreformatForeground","Foreground color for preformatted text segments.")),eN=I("textPreformat.background",{light:"#0000001A",dark:"#FFFFFF1A",hcDark:"#FFFFFF",hcLight:"#09345f"},p("textPreformatBackground","Background color for preformatted text segments.")),tN=I("textBlockQuote.background",{light:"#f2f2f2",dark:"#222222",hcDark:null,hcLight:"#F2F2F2"},p("textBlockQuoteBackground","Background color for block quotes in text.")),rN=I("textBlockQuote.border",{light:"#007acc80",dark:"#007acc80",hcDark:M.white,hcLight:"#292929"},p("textBlockQuoteBorder","Border color for block quotes in text.")),nN=I("textCodeBlock.background",{light:"#dcdcdc66",dark:"#0a0a0a66",hcDark:M.black,hcLight:"#F2F2F2"},p("textCodeBlockBackground","Background color for code blocks in text."));var lN=I("sash.hoverBorder",Qr,p("sashActiveBorder","Border color of active sashes.")),lp=I("badge.background",{dark:"#4D4D4D",light:"#C4C4C4",hcDark:M.black,hcLight:"#0F4A85"},p("badgeBackground","Badge background color. Badges are small information labels, e.g. for search results count.")),cN=I("badge.foreground",{dark:M.white,light:"#333",hcDark:M.white,hcLight:M.white},p("badgeForeground","Badge foreground color. Badges are small information labels, e.g. for search results count.")),Iw=I("scrollbar.shadow",{dark:"#000000",light:"#DDDDDD",hcDark:null,hcLight:null},p("scrollbarShadow","Scrollbar shadow to indicate that the view is scrolled.")),bw=I("scrollbarSlider.background",{dark:M.fromHex("#797979").transparent(.4),light:M.fromHex("#646464").transparent(.4),hcDark:Z(ye,.6),hcLight:Z(ye,.4)},p("scrollbarSliderBackground","Scrollbar slider background color.")),ww=I("scrollbarSlider.hoverBackground",{dark:M.fromHex("#646464").transparent(.7),light:M.fromHex("#646464").transparent(.7),hcDark:Z(ye,.8),hcLight:Z(ye,.8)},p("scrollbarSliderHoverBackground","Scrollbar slider background color when hovering.")),Sw=I("scrollbarSlider.activeBackground",{dark:M.fromHex("#BFBFBF").transparent(.4),light:M.fromHex("#000000").transparent(.6),hcDark:ye,hcLight:ye},p("scrollbarSliderActiveBackground","Scrollbar slider background color when clicked on.")),dN=I("progressBar.background",{dark:M.fromHex("#0E70C0"),light:M.fromHex("#0E70C0"),hcDark:ye,hcLight:ye},p("progressBarBackground","Background color of the progress bar that can show for long running operations."));var cp=I("editor.background",{light:"#ffffff",dark:"#1E1E1E",hcDark:M.black,hcLight:M.white},p("editorBackground","Editor background color.")),gN=I("editor.foreground",{light:"#333333",dark:"#BBBBBB",hcDark:M.white,hcLight:ve},p("editorForeground","Editor default foreground color.")),vN=I("editorStickyScroll.background",cp,p("editorStickyScrollBackground","Background color of sticky scroll in the editor")),yN=I("editorStickyScrollHover.background",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:null,hcLight:M.fromHex("#0F4A85").transparent(.1)},p("editorStickyScrollHoverBackground","Background color of sticky scroll on hover in the editor")),IN=I("editorStickyScroll.border",{dark:null,light:null,hcDark:ye,hcLight:ye},p("editorStickyScrollBorder","Border color of sticky scroll in the editor")),bN=I("editorStickyScroll.shadow",Iw,p("editorStickyScrollShadow"," Shadow color of sticky scroll in the editor")),Er=I("editorWidget.background",{dark:"#252526",light:"#F3F3F3",hcDark:"#0C141F",hcLight:M.white},p("editorWidgetBackground","Background color of editor widgets, such as find/replace.")),Ic=I("editorWidget.foreground",ve,p("editorWidgetForeground","Foreground color of editor widgets, such as find/replace.")),RT=I("editorWidget.border",{dark:"#454545",light:"#C8C8C8",hcDark:ye,hcLight:ye},p("editorWidgetBorder","Border color of editor widgets. The color is only used if the widget chooses to have a border and if the color is not overridden by a widget.")),wN=I("editorWidget.resizeBorder",null,p("editorWidgetResizeBorder","Border color of the resize bar of editor widgets. The color is only used if the widget chooses to have a resize border and if the color is not overridden by a widget.")),SN=I("editorError.background",null,p("editorError.background","Background color of error text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),mg=I("editorError.foreground",{dark:"#F14C4C",light:"#E51400",hcDark:"#F48771",hcLight:"#B5200D"},p("editorError.foreground","Foreground color of error squigglies in the editor.")),xN=I("editorError.border",{dark:null,light:null,hcDark:M.fromHex("#E47777").transparent(.8),hcLight:"#B5200D"},p("errorBorder","If set, color of double underlines for errors in the editor.")),EN=I("editorWarning.background",null,p("editorWarning.background","Background color of warning text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Ys=I("editorWarning.foreground",{dark:"#CCA700",light:"#BF8803",hcDark:"#FFD370",hcLight:"#895503"},p("editorWarning.foreground","Foreground color of warning squigglies in the editor.")),hg=I("editorWarning.border",{dark:null,light:null,hcDark:M.fromHex("#FFCC00").transparent(.8),hcLight:M.fromHex("#FFCC00").transparent(.8)},p("warningBorder","If set, color of double underlines for warnings in the editor.")),PN=I("editorInfo.background",null,p("editorInfo.background","Background color of info text in the editor. The color must not be opaque so as not to hide underlying decorations."),!0),Xs=I("editorInfo.foreground",{dark:"#3794FF",light:"#1a85ff",hcDark:"#3794FF",hcLight:"#1a85ff"},p("editorInfo.foreground","Foreground color of info squigglies in the editor.")),gg=I("editorInfo.border",{dark:null,light:null,hcDark:M.fromHex("#3794FF").transparent(.8),hcLight:"#292929"},p("infoBorder","If set, color of double underlines for infos in the editor.")),TN=I("editorHint.foreground",{dark:M.fromHex("#eeeeee").transparent(.7),light:"#6c6c6c",hcDark:null,hcLight:null},p("editorHint.foreground","Foreground color of hint squigglies in the editor.")),CN=I("editorHint.border",{dark:null,light:null,hcDark:M.fromHex("#eeeeee").transparent(.8),hcLight:"#292929"},p("hintBorder","If set, color of double underlines for hints in the editor.")),kN=I("editorLink.activeForeground",{dark:"#4E94CE",light:M.blue,hcDark:M.cyan,hcLight:"#292929"},p("activeLinkForeground","Color of active links.")),Gs=I("editor.selectionBackground",{light:"#ADD6FF",dark:"#264F78",hcDark:"#f3f518",hcLight:"#0F4A85"},p("editorSelectionBackground","Color of the editor selection.")),_N=I("editor.selectionForeground",{light:null,dark:null,hcDark:"#000000",hcLight:M.white},p("editorSelectionForeground","Color of the selected text for high contrast.")),RN=I("editor.inactiveSelectionBackground",{light:Z(Gs,.5),dark:Z(Gs,.5),hcDark:Z(Gs,.7),hcLight:Z(Gs,.5)},p("editorInactiveSelection","Color of the selection in an inactive editor. The color must not be opaque so as not to hide underlying decorations."),!0),DN=I("editor.selectionHighlightBackground",{light:dg(Gs,cp,.3,.6),dark:dg(Gs,cp,.3,.6),hcDark:null,hcLight:null},p("editorSelectionHighlight","Color for regions with the same content as the selection. The color must not be opaque so as not to hide underlying decorations."),!0),ON=I("editor.selectionHighlightBorder",{light:null,dark:null,hcDark:Mt,hcLight:Mt},p("editorSelectionHighlightBorder","Border color for regions with the same content as the selection.")),FN=I("editor.findMatchBackground",{light:"#A8AC94",dark:"#515C6A",hcDark:null,hcLight:null},p("editorFindMatch","Color of the current search match.")),LN=I("editor.findMatchForeground",null,p("editorFindMatchForeground","Text color of the current search match.")),Ni=I("editor.findMatchHighlightBackground",{light:"#EA5C0055",dark:"#EA5C0055",hcDark:null,hcLight:null},p("findMatchHighlight","Color of the other search matches. The color must not be opaque so as not to hide underlying decorations."),!0),MN=I("editor.findMatchHighlightForeground",null,p("findMatchHighlightForeground","Foreground color of the other search matches."),!0),AN=I("editor.findRangeHighlightBackground",{dark:"#3a3d4166",light:"#b4b4b44d",hcDark:null,hcLight:null},p("findRangeHighlight","Color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),WN=I("editor.findMatchBorder",{light:null,dark:null,hcDark:Mt,hcLight:Mt},p("editorFindMatchBorder","Border color of the current search match.")),Bi=I("editor.findMatchHighlightBorder",{light:null,dark:null,hcDark:Mt,hcLight:Mt},p("findMatchHighlightBorder","Border color of the other search matches.")),UN=I("editor.findRangeHighlightBorder",{dark:null,light:null,hcDark:Z(Mt,.4),hcLight:Z(Mt,.4)},p("findRangeHighlightBorder","Border color of the range limiting the search. The color must not be opaque so as not to hide underlying decorations."),!0),NN=I("editor.hoverHighlightBackground",{light:"#ADD6FF26",dark:"#264f7840",hcDark:"#ADD6FF26",hcLight:null},p("hoverHighlight","Highlight below the word for which a hover is shown. The color must not be opaque so as not to hide underlying decorations."),!0),xw=I("editorHoverWidget.background",Er,p("hoverBackground","Background color of the editor hover.")),BN=I("editorHoverWidget.foreground",Ic,p("hoverForeground","Foreground color of the editor hover.")),VN=I("editorHoverWidget.border",RT,p("hoverBorder","Border color of the editor hover.")),KN=I("editorHoverWidget.statusBarBackground",{dark:xr(xw,.2),light:Mn(xw,.05),hcDark:Er,hcLight:Er},p("statusBarBackground","Background color of the editor hover status bar.")),Rw=I("editorInlayHint.foreground",{dark:"#969696",light:"#969696",hcDark:M.white,hcLight:M.black},p("editorInlayHintForeground","Foreground color of inline hints")),Dw=I("editorInlayHint.background",{dark:Z(lp,.1),light:Z(lp,.1),hcDark:Z(M.white,.1),hcLight:Z(lp,.1)},p("editorInlayHintBackground","Background color of inline hints")),HN=I("editorInlayHint.typeForeground",Rw,p("editorInlayHintForegroundTypes","Foreground color of inline hints for types")),zN=I("editorInlayHint.typeBackground",Dw,p("editorInlayHintBackgroundTypes","Background color of inline hints for types")),qN=I("editorInlayHint.parameterForeground",Rw,p("editorInlayHintForegroundParameter","Foreground color of inline hints for parameters")),$N=I("editorInlayHint.parameterBackground",Dw,p("editorInlayHintBackgroundParameter","Background color of inline hints for parameters")),DT=I("editorLightBulb.foreground",{dark:"#FFCC00",light:"#DDB100",hcDark:"#FFCC00",hcLight:"#007ACC"},p("editorLightBulbForeground","The color used for the lightbulb actions icon.")),jN=I("editorLightBulbAutoFix.foreground",{dark:"#75BEFF",light:"#007ACC",hcDark:"#75BEFF",hcLight:"#007ACC"},p("editorLightBulbAutoFixForeground","The color used for the lightbulb auto fix actions icon.")),GN=I("editorLightBulbAi.foreground",DT,p("editorLightBulbAiForeground","The color used for the lightbulb AI icon.")),JN=I("editor.snippetTabstopHighlightBackground",{dark:new M(new de(124,124,124,.3)),light:new M(new de(10,50,100,.2)),hcDark:new M(new de(124,124,124,.3)),hcLight:new M(new de(10,50,100,.2))},p("snippetTabstopHighlightBackground","Highlight background color of a snippet tabstop.")),QN=I("editor.snippetTabstopHighlightBorder",null,p("snippetTabstopHighlightBorder","Highlight border color of a snippet tabstop.")),YN=I("editor.snippetFinalTabstopHighlightBackground",null,p("snippetFinalTabstopHighlightBackground","Highlight background color of the final tabstop of a snippet.")),XN=I("editor.snippetFinalTabstopHighlightBorder",{dark:"#525252",light:new M(new de(10,50,100,.5)),hcDark:"#525252",hcLight:"#292929"},p("snippetFinalTabstopHighlightBorder","Highlight border color of the final tabstop of a snippet.")),Ew=new M(new de(155,185,85,.2)),Pw=new M(new de(255,0,0,.2)),ZN=I("diffEditor.insertedTextBackground",{dark:"#9ccc2c33",light:"#9ccc2c40",hcDark:null,hcLight:null},p("diffEditorInserted","Background color for text that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),e3=I("diffEditor.removedTextBackground",{dark:"#ff000033",light:"#ff000033",hcDark:null,hcLight:null},p("diffEditorRemoved","Background color for text that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),t3=I("diffEditor.insertedLineBackground",{dark:Ew,light:Ew,hcDark:null,hcLight:null},p("diffEditorInsertedLines","Background color for lines that got inserted. The color must not be opaque so as not to hide underlying decorations."),!0),r3=I("diffEditor.removedLineBackground",{dark:Pw,light:Pw,hcDark:null,hcLight:null},p("diffEditorRemovedLines","Background color for lines that got removed. The color must not be opaque so as not to hide underlying decorations."),!0),n3=I("diffEditorGutter.insertedLineBackground",null,p("diffEditorInsertedLineGutter","Background color for the margin where lines got inserted.")),i3=I("diffEditorGutter.removedLineBackground",null,p("diffEditorRemovedLineGutter","Background color for the margin where lines got removed.")),o3=I("diffEditorOverview.insertedForeground",null,p("diffEditorOverviewInserted","Diff overview ruler foreground for inserted content.")),s3=I("diffEditorOverview.removedForeground",null,p("diffEditorOverviewRemoved","Diff overview ruler foreground for removed content.")),a3=I("diffEditor.insertedTextBorder",{dark:null,light:null,hcDark:"#33ff2eff",hcLight:"#374E06"},p("diffEditorInsertedOutline","Outline color for the text that got inserted.")),l3=I("diffEditor.removedTextBorder",{dark:null,light:null,hcDark:"#FF008F",hcLight:"#AD0707"},p("diffEditorRemovedOutline","Outline color for text that got removed.")),c3=I("diffEditor.border",{dark:null,light:null,hcDark:ye,hcLight:ye},p("diffEditorBorder","Border color between the two text editors.")),d3=I("diffEditor.diagonalFill",{dark:"#cccccc33",light:"#22222233",hcDark:null,hcLight:null},p("diffDiagonalFill","Color of the diff editor's diagonal fill. The diagonal fill is used in side-by-side diff views.")),u3=I("diffEditor.unchangedRegionBackground","sideBar.background",p("diffEditor.unchangedRegionBackground","The background color of unchanged blocks in the diff editor.")),p3=I("diffEditor.unchangedRegionForeground","foreground",p("diffEditor.unchangedRegionForeground","The foreground color of unchanged blocks in the diff editor.")),f3=I("diffEditor.unchangedCodeBackground",{dark:"#74747429",light:"#b8b8b829",hcDark:null,hcLight:null},p("diffEditor.unchangedCodeBackground","The background color of unchanged code in the diff editor.")),Ow=I("widget.shadow",{dark:Z(M.black,.36),light:Z(M.black,.16),hcDark:null,hcLight:null},p("widgetShadow","Shadow color of widgets such as find/replace inside the editor.")),m3=I("widget.border",{dark:null,light:null,hcDark:ye,hcLight:ye},p("widgetBorder","Border color of widgets such as find/replace inside the editor.")),Tw=I("toolbar.hoverBackground",{dark:"#5a5d5e50",light:"#b8b8b850",hcDark:null,hcLight:null},p("toolbarHoverBackground","Toolbar background when hovering over actions using the mouse")),h3=I("toolbar.hoverOutline",{dark:null,light:null,hcDark:Mt,hcLight:Mt},p("toolbarHoverOutline","Toolbar outline when hovering over actions using the mouse")),g3=I("toolbar.activeBackground",{dark:xr(Tw,.1),light:Mn(Tw,.1),hcDark:null,hcLight:null},p("toolbarActiveBackground","Toolbar background when holding the mouse over actions")),v3=I("breadcrumb.foreground",Z(ve,.8),p("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),y3=I("breadcrumb.background",cp,p("breadcrumbsBackground","Background color of breadcrumb items.")),I3=I("breadcrumb.focusForeground",{light:Mn(ve,.2),dark:xr(ve,.1),hcDark:xr(ve,.1),hcLight:xr(ve,.1)},p("breadcrumbsFocusForeground","Color of focused breadcrumb items.")),b3=I("breadcrumb.activeSelectionForeground",{light:Mn(ve,.2),dark:xr(ve,.1),hcDark:xr(ve,.1),hcLight:xr(ve,.1)},p("breadcrumbsSelectedForeground","Color of selected breadcrumb items.")),w3=I("breadcrumbPicker.background",Er,p("breadcrumbsSelectedBackground","Background color of breadcrumb item picker.")),Fw=.5,Cw=M.fromHex("#40C8AE").transparent(Fw),kw=M.fromHex("#40A6FF").transparent(Fw),_w=M.fromHex("#606060").transparent(.4),vg=.4,Js=1,ug=I("merge.currentHeaderBackground",{dark:Cw,light:Cw,hcDark:null,hcLight:null},p("mergeCurrentHeaderBackground","Current header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),S3=I("merge.currentContentBackground",Z(ug,vg),p("mergeCurrentContentBackground","Current content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),pg=I("merge.incomingHeaderBackground",{dark:kw,light:kw,hcDark:null,hcLight:null},p("mergeIncomingHeaderBackground","Incoming header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),x3=I("merge.incomingContentBackground",Z(pg,vg),p("mergeIncomingContentBackground","Incoming content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),fg=I("merge.commonHeaderBackground",{dark:_w,light:_w,hcDark:null,hcLight:null},p("mergeCommonHeaderBackground","Common ancestor header background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),E3=I("merge.commonContentBackground",Z(fg,vg),p("mergeCommonContentBackground","Common ancestor content background in inline merge-conflicts. The color must not be opaque so as not to hide underlying decorations."),!0),Qs=I("merge.border",{dark:null,light:null,hcDark:"#C3DF6F",hcLight:"#007ACC"},p("mergeBorder","Border color on headers and the splitter in inline merge-conflicts.")),P3=I("editorOverviewRuler.currentContentForeground",{dark:Z(ug,Js),light:Z(ug,Js),hcDark:Qs,hcLight:Qs},p("overviewRulerCurrentContentForeground","Current overview ruler foreground for inline merge-conflicts.")),T3=I("editorOverviewRuler.incomingContentForeground",{dark:Z(pg,Js),light:Z(pg,Js),hcDark:Qs,hcLight:Qs},p("overviewRulerIncomingContentForeground","Incoming overview ruler foreground for inline merge-conflicts.")),C3=I("editorOverviewRuler.commonContentForeground",{dark:Z(fg,Js),light:Z(fg,Js),hcDark:Qs,hcLight:Qs},p("overviewRulerCommonContentForeground","Common ancestor overview ruler foreground for inline merge-conflicts.")),k3=I("editorOverviewRuler.findMatchForeground",{dark:"#d186167e",light:"#d186167e",hcDark:"#AB5A00",hcLight:"#AB5A00"},p("overviewRulerFindMatchForeground","Overview ruler marker color for find matches. The color must not be opaque so as not to hide underlying decorations."),!0),_3=I("editorOverviewRuler.selectionHighlightForeground","#A0A0A0CC",p("overviewRulerSelectionHighlightForeground","Overview ruler marker color for selection highlights. The color must not be opaque so as not to hide underlying decorations."),!0),R3=I("problemsErrorIcon.foreground",mg,p("problemsErrorIconForeground","The color used for the problems error icon.")),D3=I("problemsWarningIcon.foreground",Ys,p("problemsWarningIconForeground","The color used for the problems warning icon.")),O3=I("problemsInfoIcon.foreground",Xs,p("problemsInfoIconForeground","The color used for the problems info icon."));var Lw=I("minimap.findMatchHighlight",{light:"#d18616",dark:"#d18616",hcDark:"#AB5A00",hcLight:"#0F4A85"},p("minimapFindMatchHighlight","Minimap marker color for find matches."),!0),U3=I("minimap.selectionOccurrenceHighlight",{light:"#c9c9c9",dark:"#676767",hcDark:"#ffffff",hcLight:"#0F4A85"},p("minimapSelectionOccurrenceHighlight","Minimap marker color for repeating editor selections."),!0),N3=I("minimap.selectionHighlight",{light:"#ADD6FF",dark:"#264F78",hcDark:"#ffffff",hcLight:"#0F4A85"},p("minimapSelectionHighlight","Minimap marker color for the editor selection."),!0),B3=I("minimap.infoHighlight",{dark:Xs,light:Xs,hcDark:gg,hcLight:gg},p("minimapInfo","Minimap marker color for infos.")),V3=I("minimap.warningHighlight",{dark:Ys,light:Ys,hcDark:hg,hcLight:hg},p("overviewRuleWarning","Minimap marker color for warnings.")),K3=I("minimap.errorHighlight",{dark:new M(new de(255,18,18,.7)),light:new M(new de(255,18,18,.7)),hcDark:new M(new de(255,50,50,1)),hcLight:"#B5200D"},p("minimapError","Minimap marker color for errors.")),H3=I("minimap.background",null,p("minimapBackground","Minimap background color.")),z3=I("minimap.foregroundOpacity",M.fromHex("#000f"),p("minimapForegroundOpacity",'Opacity of foreground elements rendered in the minimap. For example, "#000000c0" will render the elements with 75% opacity.')),q3=I("minimapSlider.background",Z(bw,.5),p("minimapSliderBackground","Minimap slider background color.")),$3=I("minimapSlider.hoverBackground",Z(ww,.5),p("minimapSliderHoverBackground","Minimap slider background color when hovering.")),j3=I("minimapSlider.activeBackground",Z(Sw,.5),p("minimapSliderActiveBackground","Minimap slider background color when clicked on."));var Z3=I("charts.foreground",ve,p("chartsForeground","The foreground color used in charts.")),eB=I("charts.lines",Z(ve,.5),p("chartsLines","The color used for horizontal lines in charts.")),tB=I("charts.red",mg,p("chartsRed","The red color used in chart visualizations.")),rB=I("charts.blue",Xs,p("chartsBlue","The blue color used in chart visualizations.")),nB=I("charts.yellow",Ys,p("chartsYellow","The yellow color used in chart visualizations.")),iB=I("charts.orange",Lw,p("chartsOrange","The orange color used in chart visualizations.")),oB=I("charts.green",{dark:"#89D185",light:"#388A34",hcDark:"#89D185",hcLight:"#374e06"},p("chartsGreen","The green color used in chart visualizations.")),sB=I("charts.purple",{dark:"#B180D7",light:"#652D90",hcDark:"#B180D7",hcLight:"#652D90"},p("chartsPurple","The purple color used in chart visualizations."));var pB=I("input.background",{dark:"#3C3C3C",light:M.white,hcDark:M.black,hcLight:M.white},p("inputBoxBackground","Input box background.")),fB=I("input.foreground",ve,p("inputBoxForeground","Input box foreground.")),mB=I("input.border",{dark:null,light:null,hcDark:ye,hcLight:ye},p("inputBoxBorder","Input box border.")),OT=I("inputOption.activeBorder",{dark:"#007ACC",light:"#007ACC",hcDark:ye,hcLight:ye},p("inputBoxActiveOptionBorder","Border color of activated options in input fields.")),FT=I("inputOption.hoverBackground",{dark:"#5a5d5e80",light:"#b8b8b850",hcDark:null,hcLight:null},p("inputOption.hoverBackground","Background color of activated options in input fields.")),LT=I("inputOption.activeBackground",{dark:Z(Qr,.4),light:Z(Qr,.2),hcDark:M.transparent,hcLight:M.transparent},p("inputOption.activeBackground","Background hover color of options in input fields.")),MT=I("inputOption.activeForeground",{dark:M.white,light:M.black,hcDark:ve,hcLight:ve},p("inputOption.activeForeground","Foreground color of activated options in input fields.")),hB=I("input.placeholderForeground",{light:Z(ve,.5),dark:Z(ve,.5),hcDark:Z(ve,.7),hcLight:Z(ve,.7)},p("inputPlaceholderForeground","Input box foreground color for placeholder text.")),gB=I("inputValidation.infoBackground",{dark:"#063B49",light:"#D6ECF2",hcDark:M.black,hcLight:M.white},p("inputValidationInfoBackground","Input validation background color for information severity.")),vB=I("inputValidation.infoForeground",{dark:null,light:null,hcDark:null,hcLight:ve},p("inputValidationInfoForeground","Input validation foreground color for information severity.")),yB=I("inputValidation.infoBorder",{dark:"#007acc",light:"#007acc",hcDark:ye,hcLight:ye},p("inputValidationInfoBorder","Input validation border color for information severity.")),IB=I("inputValidation.warningBackground",{dark:"#352A05",light:"#F6F5D2",hcDark:M.black,hcLight:M.white},p("inputValidationWarningBackground","Input validation background color for warning severity.")),bB=I("inputValidation.warningForeground",{dark:null,light:null,hcDark:null,hcLight:ve},p("inputValidationWarningForeground","Input validation foreground color for warning severity.")),wB=I("inputValidation.warningBorder",{dark:"#B89500",light:"#B89500",hcDark:ye,hcLight:ye},p("inputValidationWarningBorder","Input validation border color for warning severity.")),SB=I("inputValidation.errorBackground",{dark:"#5A1D1D",light:"#F2DEDE",hcDark:M.black,hcLight:M.white},p("inputValidationErrorBackground","Input validation background color for error severity.")),xB=I("inputValidation.errorForeground",{dark:null,light:null,hcDark:null,hcLight:ve},p("inputValidationErrorForeground","Input validation foreground color for error severity.")),EB=I("inputValidation.errorBorder",{dark:"#BE1100",light:"#BE1100",hcDark:ye,hcLight:ye},p("inputValidationErrorBorder","Input validation border color for error severity.")),pp=I("dropdown.background",{dark:"#3C3C3C",light:M.white,hcDark:M.black,hcLight:M.white},p("dropdownBackground","Dropdown background.")),PB=I("dropdown.listBackground",{dark:null,light:null,hcDark:M.black,hcLight:M.white},p("dropdownListBackground","Dropdown list background.")),yg=I("dropdown.foreground",{dark:"#F0F0F0",light:ve,hcDark:M.white,hcLight:ve},p("dropdownForeground","Dropdown foreground.")),AT=I("dropdown.border",{dark:pp,light:"#CECECE",hcDark:ye,hcLight:ye},p("dropdownBorder","Dropdown border.")),WT=I("button.foreground",M.white,p("buttonForeground","Button foreground color.")),TB=I("button.separator",Z(WT,.4),p("buttonSeparator","Button separator color.")),dp=I("button.background",{dark:"#0E639C",light:"#007ACC",hcDark:null,hcLight:"#0F4A85"},p("buttonBackground","Button background color.")),CB=I("button.hoverBackground",{dark:xr(dp,.2),light:Mn(dp,.2),hcDark:dp,hcLight:dp},p("buttonHoverBackground","Button background color when hovering.")),kB=I("button.border",ye,p("buttonBorder","Button border color.")),_B=I("button.secondaryForeground",{dark:M.white,light:M.white,hcDark:M.white,hcLight:ve},p("buttonSecondaryForeground","Secondary button foreground color.")),Mw=I("button.secondaryBackground",{dark:"#3A3D41",light:"#5F6A79",hcDark:null,hcLight:M.white},p("buttonSecondaryBackground","Secondary button background color.")),RB=I("button.secondaryHoverBackground",{dark:xr(Mw,.2),light:Mn(Mw,.2),hcDark:null,hcLight:null},p("buttonSecondaryHoverBackground","Secondary button background color when hovering.")),up=I("radio.activeForeground",MT,p("radioActiveForeground","Foreground color of active radio option.")),DB=I("radio.activeBackground",LT,p("radioBackground","Background color of active radio option.")),OB=I("radio.activeBorder",OT,p("radioActiveBorder","Border color of the active radio option.")),FB=I("radio.inactiveForeground",null,p("radioInactiveForeground","Foreground color of inactive radio option.")),LB=I("radio.inactiveBackground",null,p("radioInactiveBackground","Background color of inactive radio option.")),MB=I("radio.inactiveBorder",{light:Z(up,.2),dark:Z(up,.2),hcDark:Z(up,.4),hcLight:Z(up,.2)},p("radioInactiveBorder","Border color of the inactive radio option.")),AB=I("radio.inactiveHoverBackground",FT,p("radioHoverBackground","Background color of inactive active radio option when hovering.")),WB=I("checkbox.background",pp,p("checkbox.background","Background color of checkbox widget.")),UB=I("checkbox.selectBackground",Er,p("checkbox.select.background","Background color of checkbox widget when the element it's in is selected.")),NB=I("checkbox.foreground",yg,p("checkbox.foreground","Foreground color of checkbox widget.")),BB=I("checkbox.border",AT,p("checkbox.border","Border color of checkbox widget.")),VB=I("checkbox.selectBorder",yc,p("checkbox.select.border","Border color of checkbox widget when the element it's in is selected.")),KB=I("keybindingLabel.background",{dark:new M(new de(128,128,128,.17)),light:new M(new de(221,221,221,.4)),hcDark:M.transparent,hcLight:M.transparent},p("keybindingLabelBackground","Keybinding label background color. The keybinding label is used to represent a keyboard shortcut.")),HB=I("keybindingLabel.foreground",{dark:M.fromHex("#CCCCCC"),light:M.fromHex("#555555"),hcDark:M.white,hcLight:ve},p("keybindingLabelForeground","Keybinding label foreground color. The keybinding label is used to represent a keyboard shortcut.")),zB=I("keybindingLabel.border",{dark:new M(new de(51,51,51,.6)),light:new M(new de(204,204,204,.4)),hcDark:new M(new de(111,195,223)),hcLight:ye},p("keybindingLabelBorder","Keybinding label border color. The keybinding label is used to represent a keyboard shortcut.")),qB=I("keybindingLabel.bottomBorder",{dark:new M(new de(68,68,68,.6)),light:new M(new de(187,187,187,.4)),hcDark:new M(new de(111,195,223)),hcLight:ve},p("keybindingLabelBottomBorder","Keybinding label border bottom color. The keybinding label is used to represent a keyboard shortcut."));var YB=I("list.focusBackground",null,p("listFocusBackground","List/Tree background color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),XB=I("list.focusForeground",null,p("listFocusForeground","List/Tree foreground color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),ZB=I("list.focusOutline",{dark:Qr,light:Qr,hcDark:Mt,hcLight:Mt},p("listFocusOutline","List/Tree outline color for the focused item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),eV=I("list.focusAndSelectionOutline",null,p("listFocusAndSelectionOutline","List/Tree outline color for the focused item when the list/tree is active and selected. An active list/tree has keyboard focus, an inactive does not.")),Wo=I("list.activeSelectionBackground",{dark:"#04395E",light:"#0060C0",hcDark:null,hcLight:M.fromHex("#0F4A85").transparent(.1)},p("listActiveSelectionBackground","List/Tree background color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),bc=I("list.activeSelectionForeground",{dark:M.white,light:M.white,hcDark:null,hcLight:null},p("listActiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),Aw=I("list.activeSelectionIconForeground",null,p("listActiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is active. An active list/tree has keyboard focus, an inactive does not.")),tV=I("list.inactiveSelectionBackground",{dark:"#37373D",light:"#E4E6F1",hcDark:null,hcLight:M.fromHex("#0F4A85").transparent(.1)},p("listInactiveSelectionBackground","List/Tree background color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),rV=I("list.inactiveSelectionForeground",null,p("listInactiveSelectionForeground","List/Tree foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),nV=I("list.inactiveSelectionIconForeground",null,p("listInactiveSelectionIconForeground","List/Tree icon foreground color for the selected item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),iV=I("list.inactiveFocusBackground",null,p("listInactiveFocusBackground","List/Tree background color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),oV=I("list.inactiveFocusOutline",null,p("listInactiveFocusOutline","List/Tree outline color for the focused item when the list/tree is inactive. An active list/tree has keyboard focus, an inactive does not.")),sV=I("list.hoverBackground",{dark:"#2A2D2E",light:"#F0F0F0",hcDark:M.white.transparent(.1),hcLight:M.fromHex("#0F4A85").transparent(.1)},p("listHoverBackground","List/Tree background when hovering over items using the mouse.")),aV=I("list.hoverForeground",null,p("listHoverForeground","List/Tree foreground when hovering over items using the mouse.")),lV=I("list.dropBackground",{dark:"#062F4A",light:"#D6EBFF",hcDark:null,hcLight:null},p("listDropBackground","List/Tree drag and drop background when moving items over other items when using the mouse.")),cV=I("list.dropBetweenBackground",{dark:yc,light:yc,hcDark:null,hcLight:null},p("listDropBetweenBackground","List/Tree drag and drop border color when moving items between items when using the mouse.")),fp=I("list.highlightForeground",{dark:"#2AAAFF",light:"#0066BF",hcDark:Qr,hcLight:Qr},p("highlight","List/Tree foreground color of the match highlights when searching inside the list/tree.")),dV=I("list.focusHighlightForeground",{dark:fp,light:gw(Wo,fp,"#BBE7FF"),hcDark:fp,hcLight:fp},p("listFocusHighlightForeground","List/Tree foreground color of the match highlights on actively focused items when searching inside the list/tree.")),uV=I("list.invalidItemForeground",{dark:"#B89500",light:"#B89500",hcDark:"#B89500",hcLight:"#B5200D"},p("invalidItemForeground","List/Tree foreground color for invalid items, for example an unresolved root in explorer.")),pV=I("list.errorForeground",{dark:"#F88070",light:"#B01011",hcDark:null,hcLight:null},p("listErrorForeground","Foreground color of list items containing errors.")),fV=I("list.warningForeground",{dark:"#CCA700",light:"#855F00",hcDark:null,hcLight:null},p("listWarningForeground","Foreground color of list items containing warnings.")),mV=I("listFilterWidget.background",{light:Mn(Er,0),dark:xr(Er,0),hcDark:Er,hcLight:Er},p("listFilterWidgetBackground","Background color of the type filter widget in lists and trees.")),hV=I("listFilterWidget.outline",{dark:M.transparent,light:M.transparent,hcDark:"#f38518",hcLight:"#007ACC"},p("listFilterWidgetOutline","Outline color of the type filter widget in lists and trees.")),gV=I("listFilterWidget.noMatchesOutline",{dark:"#BE1100",light:"#BE1100",hcDark:ye,hcLight:ye},p("listFilterWidgetNoMatchesOutline","Outline color of the type filter widget in lists and trees, when there are no matches.")),vV=I("listFilterWidget.shadow",Ow,p("listFilterWidgetShadow","Shadow color of the type filter widget in lists and trees.")),yV=I("list.filterMatchBackground",{dark:Ni,light:Ni,hcDark:null,hcLight:null},p("listFilterMatchHighlight","Background color of the filtered match.")),IV=I("list.filterMatchBorder",{dark:Bi,light:Bi,hcDark:ye,hcLight:Mt},p("listFilterMatchHighlightBorder","Border color of the filtered match.")),bV=I("list.deemphasizedForeground",{dark:"#8C8C8C",light:"#8E8E90",hcDark:"#A7A8A9",hcLight:"#666666"},p("listDeemphasizedForeground","List/Tree foreground color for items that are deemphasized.")),UT=I("tree.indentGuidesStroke",{dark:"#585858",light:"#a9a9a9",hcDark:"#a9a9a9",hcLight:"#a5a5a5"},p("treeIndentGuidesStroke","Tree stroke color for the indentation guides.")),wV=I("tree.inactiveIndentGuidesStroke",Z(UT,.4),p("treeInactiveIndentGuidesStroke","Tree stroke color for the indentation guides that are not active.")),SV=I("tree.tableColumnsBorder",{dark:"#CCCCCC20",light:"#61616120",hcDark:null,hcLight:null},p("tableColumnsBorder","Table border color between columns.")),xV=I("tree.tableOddRowsBackground",{dark:Z(ve,.04),light:Z(ve,.04),hcDark:null,hcLight:null},p("tableOddRowsBackgroundColor","Background color for odd table rows.")),EV=I("editorActionList.background",Er,p("editorActionListBackground","Action List background color.")),PV=I("editorActionList.foreground",Ic,p("editorActionListForeground","Action List foreground color.")),TV=I("editorActionList.focusForeground",bc,p("editorActionListFocusForeground","Action List foreground color for the focused item.")),CV=I("editorActionList.focusBackground",Wo,p("editorActionListFocusBackground","Action List background color for the focused item."));var FV=I("menu.border",{dark:null,light:null,hcDark:ye,hcLight:ye},p("menuBorder","Border color of menus.")),LV=I("menu.foreground",yg,p("menuForeground","Foreground color of menu items.")),MV=I("menu.background",pp,p("menuBackground","Background color of menu items.")),AV=I("menu.selectionForeground",bc,p("menuSelectionForeground","Foreground color of the selected menu item in menus.")),WV=I("menu.selectionBackground",Wo,p("menuSelectionBackground","Background color of the selected menu item in menus.")),UV=I("menu.selectionBorder",{dark:null,light:null,hcDark:Mt,hcLight:Mt},p("menuSelectionBorder","Border color of the selected menu item in menus.")),NV=I("menu.separatorBackground",{dark:"#606060",light:"#D4D4D4",hcDark:ye,hcLight:ye},p("menuSeparatorBackground","Color of a separator menu item in menus."));var qV=I("quickInput.background",Er,p("pickerBackground","Quick picker background color. The quick picker widget is the container for pickers like the command palette.")),$V=I("quickInput.foreground",Ic,p("pickerForeground","Quick picker foreground color. The quick picker widget is the container for pickers like the command palette.")),jV=I("quickInputTitle.background",{dark:new M(new de(255,255,255,.105)),light:new M(new de(0,0,0,.06)),hcDark:"#000000",hcLight:M.white},p("pickerTitleBackground","Quick picker title background color. The quick picker widget is the container for pickers like the command palette.")),GV=I("pickerGroup.foreground",{dark:"#3794FF",light:"#0066BF",hcDark:M.white,hcLight:"#0F4A85"},p("pickerGroupForeground","Quick picker color for grouping labels.")),JV=I("pickerGroup.border",{dark:"#3F3F46",light:"#CCCEDB",hcDark:M.white,hcLight:"#0F4A85"},p("pickerGroupBorder","Quick picker color for grouping borders.")),Ww=I("quickInput.list.focusBackground",null,"",void 0,p("quickInput.list.focusBackground deprecation","Please use quickInputList.focusBackground instead")),QV=I("quickInputList.focusForeground",bc,p("quickInput.listFocusForeground","Quick picker foreground color for the focused item.")),YV=I("quickInputList.focusIconForeground",Aw,p("quickInput.listFocusIconForeground","Quick picker icon foreground color for the focused item.")),XV=I("quickInputList.focusBackground",{dark:cg(Ww,Wo),light:cg(Ww,Wo),hcDark:null,hcLight:null},p("quickInput.listFocusBackground","Quick picker background color for the focused item."));var nK=I("search.resultsInfoForeground",{light:ve,dark:Z(ve,.65),hcDark:ve,hcLight:ve},p("search.resultsInfoForeground","Color of the text in the search viewlet's completion message.")),iK=I("searchEditor.findMatchBackground",{light:Z(Ni,.66),dark:Z(Ni,.66),hcDark:Ni,hcLight:Ni},p("searchEditor.queryMatch","Color of the Search Editor query matches.")),oK=I("searchEditor.findMatchBorder",{light:Z(Bi,.66),dark:Z(Bi,.66),hcDark:Bi,hcLight:Bi},p("searchEditor.editorFindMatchBorder","Border color of the Search Editor query matches."));var NT={IconContribution:"base.contributions.icons"},BT;(t=>{function n(e,r){let i=e.defaults;for(;Ft.isThemeIcon(i);){let o=Zs.getIcon(i.id);if(!o)return;i=o.defaults}return i}t.getDefinition=n})(BT||={});var VT;(e=>{function n(r){return{weight:r.weight,style:r.style,src:r.src.map(i=>({format:i.format,location:i.location.toString()}))}}e.toJSONObject=n;function t(r){let i=o=>ke(o)?o:void 0;if(r&&Array.isArray(r.src)&&r.src.every(o=>ke(o.format)&&ke(o.location)))return{weight:i(r.weight),style:i(r.style),src:r.src.map(o=>({format:o.format,location:x.parse(o.location)}))}}e.fromJSONObject=t})(VT||={});var Ig=class{_onDidChange=new S;onDidChange=this._onDidChange.event;iconsById;iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:p("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:p("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}};iconReferenceSchema={type:"string",pattern:`^${Ft.iconNameExpression}$`,enum:[],enumDescriptions:[]};iconFontsById;constructor(){this.iconsById={},this.iconFontsById={}}registerIcon(t,e,r,i){let o=this.iconsById[t];if(o){if(r&&!o.description){o.description=r,this.iconSchema.properties[t].markdownDescription=`${r} $(${t})`;let l=this.iconReferenceSchema.enum.indexOf(t);l!==-1&&(this.iconReferenceSchema.enumDescriptions[l]=r),this._onDidChange.fire()}return o}let s={id:t,description:r,defaults:e,deprecationMessage:i};this.iconsById[t]=s;let a={$ref:"#/definitions/icons"};return i&&(a.deprecationMessage=i),r&&(a.markdownDescription=`${r}: $(${t})`),this.iconSchema.properties[t]=a,this.iconReferenceSchema.enum.push(t),this.iconReferenceSchema.enumDescriptions.push(r||""),this._onDidChange.fire(),{id:t}}deregisterIcon(t){delete this.iconsById[t],delete this.iconSchema.properties[t];let e=this.iconReferenceSchema.enum.indexOf(t);e!==-1&&(this.iconReferenceSchema.enum.splice(e,1),this.iconReferenceSchema.enumDescriptions.splice(e,1)),this._onDidChange.fire()}getIcons(){return Object.keys(this.iconsById).map(t=>this.iconsById[t])}getIcon(t){return this.iconsById[t]}getIconSchema(){return this.iconSchema}getIconReferenceSchema(){return this.iconReferenceSchema}registerIconFont(t,e){let r=this.iconFontsById[t];return r||(this.iconFontsById[t]=e,this._onDidChange.fire(),e)}deregisterIconFont(t){delete this.iconFontsById[t]}getIconFont(t){return this.iconFontsById[t]}toString(){let t=(o,s)=>o.id.localeCompare(s.id),e=o=>{for(;Ft.isThemeIcon(o.defaults);)o=this.iconsById[o.defaults.id];return`codicon codicon-${o?o.id:""}`},r=[];r.push("| preview     | identifier                        | default codicon ID                | description"),r.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");let i=Object.keys(this.iconsById).map(o=>this.iconsById[o]);for(let o of i.filter(s=>!!s.description).sort(t))r.push(`|<i class="${e(o)}"></i>|${o.id}|${Ft.isThemeIcon(o.defaults)?o.defaults.id:o.id}|${o.description||""}|`);r.push("| preview     | identifier                        "),r.push("| ----------- | --------------------------------- |");for(let o of i.filter(s=>!Ft.isThemeIcon(s.defaults)).sort(t))r.push(`|<i class="${e(o)}"></i>|${o.id}|`);return r.join(`
`)}},Zs=new Ig;De.add(NT.IconContribution,Zs);function bg(n,t,e,r){return Zs.registerIcon(n,t,e,r)}function KT(){let n=Kb();for(let t in n){let e="\\"+n[t].toString(16);Zs.registerIcon(t,{fontCharacter:e})}}KT();var Nw="vscode://schemas/icons",Bw=De.as(Po.JSONContribution);Bw.registerSchema(Nw,Zs.getIconSchema());var Uw=new bt(()=>Bw.notifySchemaChanged(Nw),200);Zs.onDidChange(()=>{Uw.isScheduled()||Uw.schedule()});var LK=bg("widget-close",dt.close,p("widgetClose","Icon for the close action in widgets.")),MK=bg("goto-previous-location",dt.arrowUp,p("previousChangeIcon","Icon for goto previous editor location.")),AK=bg("goto-next-location",dt.arrowDown,p("nextChangeIcon","Icon for goto next editor location.")),WK=Ft.modify(dt.sync,"spin"),UK=Ft.modify(dt.loading,"spin");var iH=F("themeService");var oH=dt.file,sH=dt.folder;var HT={ThemingContribution:"base.contributions.theming"},wg=class{themingParticipants=[];onThemingParticipantAddedEmitter;constructor(){this.themingParticipants=[],this.onThemingParticipantAddedEmitter=new S}onColorThemeChange(t){return this.themingParticipants.push(t),this.onThemingParticipantAddedEmitter.fire(t),$(()=>{let e=this.themingParticipants.indexOf(t);this.themingParticipants.splice(e,1)})}get onThemingParticipantAdded(){return this.onThemingParticipantAddedEmitter.event}getThemingParticipants(){return this.themingParticipants}},zT=new wg;De.add(HT.ThemingContribution,zT);var Sg={WIDTH:400,WIDTH_WITH_VERTICAL_PANEL:600,HEIGHT:270};function wc(n){return!!n.workspaceUri}function mp(n){return!!n.folderUri}function xg(n){return!!n.fileUri}function Vw(n){let t=fn(n),e=n.getValue("window.menuBarVisibility");return e==="default"||t&&e==="compact"||W&&xd?"classic":e}function fn(n,t){return t||(t=qT(n)),t==="native"}function qT(n){if(sr)return"custom";let t=n.getValue("window");if(t){if(W&&t.nativeTabs===!0||W&&t.nativeFullScreen===!1)return"native";let i=t.titleBarStyle;if(i==="native"||i==="custom")return i}return Q?"native":"custom"}var Kw=35;function Vi(n){if(W||sr||fn(n))return!1;if(Q){let t=n.getValue("window.experimentalControlOverlay");if(typeof t=="boolean")return t}return!0}function hp(n){let t=n.getValue("window");return!t||typeof t.nativeFullScreen!="boolean"||t.nativeTabs?!0:t.nativeFullScreen!==!1}function ea(n=0){return Math.pow(1.2,n)}var Ki=function(n=1){return{width:1024,height:768,mode:n}},Hw=function(){let e=$T.screen.getPrimaryDisplay().workArea,r=Math.max(e.x+e.width/2-800/2,0),i=Math.max(e.y+e.height/2-600/2,0);return{x:r,y:i,width:800,height:600,mode:1}};import{BrowserWindow as gC}from"electron";import Br from"electron";import{release as hC}from"os";function zw(n){return n&&n.hasOwnProperty("folderUri")}function qw(n){return typeof n?.backupFolder=="string"}function $w(n){let t=[];try{Array.isArray(n.workspaces)&&(t=n.workspaces.map(e=>({workspace:{id:e.id,configPath:x.parse(e.configURIPath)},remoteAuthority:e.remoteAuthority})))}catch{}return t}function jw(n){let t=[];try{Array.isArray(n.folders)&&(t=n.folders.map(e=>({folderUri:x.parse(e.folderUri),remoteAuthority:e.remoteAuthority})))}catch{}return t}var An=F("backupMainService");import Uo from"electron";var gp=(i=>(i[i.Ignore=0]="Ignore",i[i.Info=1]="Info",i[i.Warning=2]="Warning",i[i.Error=3]="Error",i))(gp||{});(a=>{let n="error",t="warning",e="warn",r="info",i="ignore";function o(l){return l?Wr(n,l)?3:Wr(t,l)||Wr(e,l)?2:Wr(r,l)?1:0:0}a.fromValue=o;function s(l){switch(l){case 3:return n;case 2:return t;case 1:return r;default:return i}}a.toString=s})(gp||={});var Te=gp;var Ve=F("telemetryService"),xz=F("customEndpointTelemetryService"),Eg="telemetry.currentSessionDate",Pg="telemetry.firstSessionDate",Gw="telemetry.lastSessionDate",vp="telemetry.machineId",yp="telemetry.sqmId",Ip="telemetry.devDeviceId",Tg="telemetry",ta="telemetry.telemetryLevel",bp="telemetry.enableCrashReporter",Sc="telemetry.enableTelemetry";function er(n){if(!n||typeof n!="object"||n instanceof RegExp)return n;let t=Array.isArray(n)?[]:{};return Object.entries(n).forEach(([e,r])=>{t[e]=r&&typeof r=="object"?er(r):r}),t}function Jw(n){if(!n||typeof n!="object")return n;let t=[n];for(;t.length>0;){let e=t.shift();Object.freeze(e);for(let r in e)if(Qw.call(e,r)){let i=e[r];typeof i=="object"&&!Object.isFrozen(i)&&!dI(i)&&t.push(i)}}return n}var Qw=Object.prototype.hasOwnProperty;function Yw(n,t){return Cg(n,t,new Set)}function Cg(n,t,e){if(ct(n))return n;let r=t(n);if(typeof r<"u")return r;if(Array.isArray(n)){let i=[];for(let o of n)i.push(Cg(o,t,e));return i}if(qe(n)){if(e.has(n))throw new Error("Cannot clone recursive data-structure");e.add(n);let i={};for(let o in n)Qw.call(n,o)&&(i[o]=Cg(n[o],t,e));return e.delete(n),i}return n}function wp(n,t,e=!0){return qe(n)?(qe(t)&&Object.keys(t).forEach(r=>{r in n?e&&(qe(n[r])&&qe(t[r])?wp(n[r],t[r],e):n[r]=t[r]):n[r]=t[r]}),n):t}function Pr(n,t){if(n===t)return!0;if(n==null||t===null||t===void 0||typeof n!=typeof t||typeof n!="object"||Array.isArray(n)!==Array.isArray(t))return!1;let e,r;if(Array.isArray(n)){if(n.length!==t.length)return!1;for(e=0;e<n.length;e++)if(!Pr(n[e],t[e]))return!1}else{let i=[];for(r in n)i.push(r);i.sort();let o=[];for(r in t)o.push(r);if(o.sort(),!Pr(i,o))return!1;for(e=0;e<i.length;e++)if(!Pr(n[i[e]],t[i[e]]))return!1}return!0}function Xw(n,t){let e=t.toLowerCase(),r=Object.keys(n).find(i=>i.toLowerCase()===e);return r?n[r]:n[t]}var qz=F("dialogService");var $z=F("fileDialogService");function Sp(n,t){let e=er(n),r=(e.buttons??[]).map(a=>bu(a)),i=(n.buttons||[]).map((a,l)=>l),o=0,s=e.cancelId??r.length-1;if(r.length>1){let a=typeof s=="number"?r[s]:void 0;if(Q||W){if(typeof a=="string"&&r.length>1&&s!==1){r.splice(s,1),r.splice(1,0,a);let l=i[s];i.splice(s,1),i.splice(1,0,l),s=1}Q&&r.length>1&&(r=r.reverse(),i=i.reverse(),o=r.length-1,typeof a=="string"&&(s=o-1))}else if(U&&typeof a=="string"&&r.length>1&&s!==r.length-1){r.splice(s,1),r.push(a);let l=i[s];i.splice(s,1),i.push(l),s=r.length-1}}return e.buttons=r,e.defaultId=o,e.cancelId=s,e.noLink=!0,e.title=e.title||t.nameLong,{options:e,buttonIndeces:i}}var Gt=F("dialogMainService"),ra=class{constructor(t,e){this.logService=t;this.productService=e}windowFileDialogLocks=new Map;windowDialogQueues=new Map;noWindowDialogueQueue=new _n;pickFileFolder(t,e){return this.doPick({...t,pickFolders:!0,pickFiles:!0,title:p("open","Open")},e)}pickFolder(t,e){return this.doPick({...t,pickFolders:!0,title:p("openFolder","Open Folder")},e)}pickFile(t,e){return this.doPick({...t,pickFiles:!0,title:p("openFile","Open File")},e)}pickWorkspace(t,e){let r=p("openWorkspaceTitle","Open Workspace from File"),i=bu(p({key:"openWorkspace",comment:["&& denotes a mnemonic"]},"&&Open")),o=RI;return this.doPick({...t,pickFiles:!0,title:r,filters:o,buttonLabel:i},e)}async doPick(t,e){let r={title:t.title,buttonLabel:t.buttonLabel,filters:t.filters,defaultPath:t.defaultPath};(typeof t.pickFiles=="boolean"||typeof t.pickFolders=="boolean")&&(r.properties=void 0,t.pickFiles&&t.pickFolders&&(r.properties=["multiSelections","openDirectory","openFile","createDirectory"])),r.properties||(r.properties=["multiSelections",t.pickFolders?"openDirectory":"openFile","createDirectory"]),W&&r.properties.push("treatPackageAsDirectory");let i=await this.showOpenDialog(r,(e||Uo.BrowserWindow.getFocusedWindow())??void 0);if(i&&i.filePaths&&i.filePaths.length>0)return i.filePaths}getWindowDialogQueue(t){if(t){let e=this.windowDialogQueues.get(t.id);return e||(e=new _n,this.windowDialogQueues.set(t.id,e)),e}else return this.noWindowDialogueQueue}showMessageBox(t,e){return this.getWindowDialogQueue(e).queue(async()=>{let{options:r,buttonIndeces:i}=Sp(t,this.productService),o;return e?o=await Uo.dialog.showMessageBox(e,r):o=await Uo.dialog.showMessageBox(r),{response:i[o.response],checkboxChecked:o.checkboxChecked}})}async showSaveDialog(t,e){let r=this.acquireFileDialogLock(t,e);if(!r)return this.logService.error("[DialogMainService]: file save dialog is already or will be showing for the window with the same configuration"),{canceled:!0,filePath:""};try{return await this.getWindowDialogQueue(e).queue(async()=>{let i;return e?i=await Uo.dialog.showSaveDialog(e,t):i=await Uo.dialog.showSaveDialog(t),i.filePath=this.normalizePath(i.filePath),i})}finally{ze(r)}}normalizePath(t){return t&&W&&(t=Rn(t)),t}normalizePaths(t){return t.map(e=>this.normalizePath(e))}async showOpenDialog(t,e){t.defaultPath&&(await q.exists(t.defaultPath)||(t.defaultPath=void 0));let r=this.acquireFileDialogLock(t,e);if(!r)return this.logService.error("[DialogMainService]: file open dialog is already or will be showing for the window with the same configuration"),{canceled:!0,filePaths:[]};try{return await this.getWindowDialogQueue(e).queue(async()=>{let i;return e?i=await Uo.dialog.showOpenDialog(e,t):i=await Uo.dialog.showOpenDialog(t),i.filePaths=this.normalizePaths(i.filePaths),i})}finally{ze(r)}}acquireFileDialogLock(t,e){if(!e)return D.None;this.logService.trace("[DialogMainService]: request to acquire file dialog lock",t);let r=this.windowFileDialogLocks.get(e.id);r||(r=new Set,this.windowFileDialogLocks.set(e.id,r));let i=qt(t);if(!r.has(i))return this.logService.trace("[DialogMainService]: new file dialog lock created",t),r.add(i),$(()=>{this.logService.trace("[DialogMainService]: file dialog lock disposed",t),r?.delete(i),r?.size===0&&this.windowFileDialogLocks.delete(e.id)})}};ra=P([g(0,A),g(1,be)],ra);import JT from"assert";var iS=_m(nS());var hq={o:p("optionsUpperCase","Options"),e:p("extensionsManagement","Extensions Management"),t:p("troubleshooting","Troubleshooting")},kg=["tunnel","serve-web"],xp={tunnel:{type:"subcommand",description:"Make the current machine accessible from vscode.dev or other machines through a secure tunnel",options:{"cli-data-dir":{type:"string",args:"dir",description:p("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"},user:{type:"subcommand",options:{login:{type:"subcommand",options:{provider:{type:"string"},"access-token":{type:"string"}}}}}}},"serve-web":{type:"subcommand",description:"Run a server that displays the editor UI in browsers.",options:{"cli-data-dir":{type:"string",args:"dir",description:p("cliDataDir","Directory where CLI metadata should be stored.")},"disable-telemetry":{type:"boolean"},"telemetry-level":{type:"string"}}},diff:{type:"boolean",cat:"o",alias:"d",args:["file","file"],description:p("diff","Compare two files with each other.")},merge:{type:"boolean",cat:"o",alias:"m",args:["path1","path2","base","result"],description:p("merge","Perform a three-way merge by providing paths for two modified versions of a file, the common origin of both modified versions and the output file to save merge results.")},add:{type:"boolean",cat:"o",alias:"a",args:"folder",description:p("add","Add folder(s) to the last active window.")},goto:{type:"boolean",cat:"o",alias:"g",args:"file:line[:character]",description:p("goto","Open a file at the path on the specified line and character position.")},"new-window":{type:"boolean",cat:"o",alias:"n",description:p("newWindow","Force to open a new window.")},"reuse-window":{type:"boolean",cat:"o",alias:"r",description:p("reuseWindow","Force to open a file or folder in an already opened window.")},wait:{type:"boolean",cat:"o",alias:"w",description:p("wait","Wait for the files to be closed before returning.")},waitMarkerFilePath:{type:"string"},locale:{type:"string",cat:"o",args:"locale",description:p("locale","The locale to use (e.g. en-US or zh-TW).")},"user-data-dir":{type:"string",cat:"o",args:"dir",description:p("userDataDir","Specifies the directory that user data is kept in. Can be used to open multiple distinct instances of Code.")},profile:{type:"string",cat:"o",args:"profileName",description:p("profileName","Opens the provided folder or workspace with the given profile and associates the profile with the workspace. If the profile does not exist, a new empty one is created.")},help:{type:"boolean",cat:"o",alias:"h",description:p("help","Print usage.")},"extensions-dir":{type:"string",deprecates:["extensionHomePath"],cat:"e",args:"dir",description:p("extensionHomePath","Set the root path for extensions.")},"extensions-download-dir":{type:"string"},"builtin-extensions-dir":{type:"string"},"list-extensions":{type:"boolean",cat:"e",description:p("listExtensions","List the installed extensions.")},"show-versions":{type:"boolean",cat:"e",description:p("showVersions","Show versions of installed extensions, when using --list-extensions.")},category:{type:"string",allowEmptyValue:!0,cat:"e",description:p("category","Filters installed extensions by provided category, when using --list-extensions."),args:"category"},"install-extension":{type:"string[]",cat:"e",args:"ext-id | path",description:p("installExtension","Installs or updates an extension. The argument is either an extension id or a path to a VSIX. The identifier of an extension is '${publisher}.${name}'. Use '--force' argument to update to latest version. To install a specific version provide '@${version}'. For example: 'vscode.csharp@1.2.3'.")},"pre-release":{type:"boolean",cat:"e",description:p("install prerelease","Installs the pre-release version of the extension, when using --install-extension")},"uninstall-extension":{type:"string[]",cat:"e",args:"ext-id",description:p("uninstallExtension","Uninstalls an extension.")},"update-extensions":{type:"boolean",cat:"e",description:p("updateExtensions","Update the installed extensions.")},"enable-proposed-api":{type:"string[]",allowEmptyValue:!0,cat:"e",args:"ext-id",description:p("experimentalApis","Enables proposed API features for extensions. Can receive one or more extension IDs to enable individually.")},version:{type:"boolean",cat:"t",alias:"v",description:p("version","Print version.")},verbose:{type:"boolean",cat:"t",global:!0,description:p("verbose","Print verbose output (implies --wait).")},log:{type:"string[]",cat:"t",args:"level",global:!0,description:p("log","Log level to use. Default is 'info'. Allowed values are 'critical', 'error', 'warn', 'info', 'debug', 'trace', 'off'. You can also configure the log level of an extension by passing extension id and log level in the following format: '${publisher}.${name}:${logLevel}'. For example: 'vscode.csharp:trace'. Can receive one or more such entries.")},status:{type:"boolean",alias:"s",cat:"t",description:p("status","Print process usage and diagnostics information.")},"prof-startup":{type:"boolean",cat:"t",description:p("prof-startup","Run CPU profiler during startup.")},"prof-append-timers":{type:"string"},"prof-duration-markers":{type:"string[]"},"prof-duration-markers-file":{type:"string"},"no-cached-data":{type:"boolean"},"prof-startup-prefix":{type:"string"},"prof-v8-extensions":{type:"boolean"},"disable-extensions":{type:"boolean",deprecates:["disableExtensions"],cat:"t",description:p("disableExtensions","Disable all installed extensions. This option is not persisted and is effective only when the command opens a new window.")},"disable-extension":{type:"string[]",cat:"t",args:"ext-id",description:p("disableExtension","Disable the provided extension. This option is not persisted and is effective only when the command opens a new window.")},sync:{type:"string",cat:"t",description:p("turn sync","Turn sync on or off."),args:["on | off"]},"inspect-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugPluginHost"],args:"port",cat:"t",description:p("inspect-extensions","Allow debugging and profiling of extensions. Check the developer tools for the connection URI.")},"inspect-brk-extensions":{type:"string",allowEmptyValue:!0,deprecates:["debugBrkPluginHost"],args:"port",cat:"t",description:p("inspect-brk-extensions","Allow debugging and profiling of extensions with the extension host being paused after start. Check the developer tools for the connection URI.")},"disable-lcd-text":{type:"boolean",cat:"t",description:p("disableLCDText","Disable LCD font rendering.")},"disable-gpu":{type:"boolean",cat:"t",description:p("disableGPU","Disable GPU hardware acceleration.")},"disable-chromium-sandbox":{type:"boolean",cat:"t",description:p("disableChromiumSandbox","Use this option only when there is requirement to launch the application as sudo user on Linux or when running as an elevated user in an applocker environment on Windows.")},sandbox:{type:"boolean"},telemetry:{type:"boolean",cat:"t",description:p("telemetry","Shows all telemetry events which VS code collects.")},remote:{type:"string",allowEmptyValue:!0},"folder-uri":{type:"string[]",cat:"o",args:"uri"},"file-uri":{type:"string[]",cat:"o",args:"uri"},"locate-extension":{type:"string[]"},extensionDevelopmentPath:{type:"string[]"},extensionDevelopmentKind:{type:"string[]"},extensionTestsPath:{type:"string"},extensionEnvironment:{type:"string"},debugId:{type:"string"},debugRenderer:{type:"boolean"},"inspect-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-brk-ptyhost":{type:"string",allowEmptyValue:!0},"inspect-search":{type:"string",deprecates:["debugSearch"],allowEmptyValue:!0},"inspect-brk-search":{type:"string",deprecates:["debugBrkSearch"],allowEmptyValue:!0},"inspect-sharedprocess":{type:"string",allowEmptyValue:!0},"inspect-brk-sharedprocess":{type:"string",allowEmptyValue:!0},"export-default-configuration":{type:"string"},"install-source":{type:"string"},"enable-smoke-test-driver":{type:"boolean"},logExtensionHostCommunication:{type:"boolean"},"skip-release-notes":{type:"boolean"},"skip-welcome":{type:"boolean"},"disable-telemetry":{type:"boolean"},"disable-updates":{type:"boolean"},"use-inmemory-secretstorage":{type:"boolean",deprecates:["disable-keytar"]},"password-store":{type:"string"},"disable-workspace-trust":{type:"boolean"},"disable-crash-reporter":{type:"boolean"},"crash-reporter-directory":{type:"string"},"crash-reporter-id":{type:"string"},"skip-add-to-recently-opened":{type:"boolean"},"open-url":{type:"boolean"},"file-write":{type:"boolean"},"file-chmod":{type:"boolean"},"install-builtin-extension":{type:"string[]"},force:{type:"boolean"},"do-not-sync":{type:"boolean"},trace:{type:"boolean"},"trace-category-filter":{type:"string"},"trace-options":{type:"string"},"preserve-env":{type:"boolean"},"force-user-env":{type:"boolean"},"force-disable-user-env":{type:"boolean"},"open-devtools":{type:"boolean"},"disable-gpu-sandbox":{type:"boolean"},logsPath:{type:"string"},"__enable-file-policy":{type:"boolean"},editSessionId:{type:"string"},continueOn:{type:"string"},"locate-shell-integration-path":{type:"string",args:["bash","pwsh","zsh","fish"]},"enable-coi":{type:"boolean"},"no-proxy-server":{type:"boolean"},"no-sandbox":{type:"boolean",alias:"sandbox"},"proxy-server":{type:"string"},"proxy-bypass-list":{type:"string"},"proxy-pac-url":{type:"string"},"js-flags":{type:"string"},inspect:{type:"string",allowEmptyValue:!0},"inspect-brk":{type:"string",allowEmptyValue:!0},nolazy:{type:"boolean"},"force-device-scale-factor":{type:"string"},"force-renderer-accessibility":{type:"boolean"},"ignore-certificate-errors":{type:"boolean"},"allow-insecure-localhost":{type:"boolean"},"log-net-log":{type:"string"},vmodule:{type:"string"},_urls:{type:"string[]"},"disable-dev-shm-usage":{type:"boolean"},"profile-temp":{type:"boolean"},"ozone-platform":{type:"string"},"enable-tracing":{type:"string"},"trace-startup-format":{type:"string"},"trace-startup-file":{type:"string"},"trace-startup-duration":{type:"string"},_:{type:"string[]"}},GT={onUnknownOption:()=>{},onMultipleValues:()=>{},onEmptyValue:()=>{},onDeprecatedOption:()=>{}};function xc(n,t,e=GT){let r=n.find(m=>m.length>0&&m[0]!=="-"),i={},o=["_"],s=[],a={},l;for(let m in t){let h=t[m];h.type==="subcommand"?m===r&&(l=h):(h.alias&&(i[m]=h.alias),h.type==="string"||h.type==="string[]"?(o.push(m),h.deprecates&&o.push(...h.deprecates)):h.type==="boolean"&&(s.push(m),h.deprecates&&s.push(...h.deprecates)),h.global&&(a[m]=h))}if(l&&r){let m=a;for(let b in l.options)m[b]=l.options[b];let h=n.filter(b=>b!==r),y=e.getSubcommandReporter?e.getSubcommandReporter(r):void 0,v=xc(h,m,y);return{[r]:v,_:[]}}let c=(0,iS.default)(n,{string:o,boolean:s,alias:i}),d={},u=c;d._=c._.map(m=>String(m)).filter(m=>m.length>0),delete u._;for(let m in t){let h=t[m];if(h.type==="subcommand")continue;h.alias&&delete u[h.alias];let y=u[m];if(h.deprecates)for(let v of h.deprecates)u.hasOwnProperty(v)&&(y||(y=u[v],y&&e.onDeprecatedOption(v,h.deprecationMessage||p("deprecated.useInstead","Use {0} instead.",m))),delete u[v]);if(typeof y<"u"){if(h.type==="string[]"){if(Array.isArray(y)||(y=[y]),!h.allowEmptyValue){let v=y.filter(b=>b.length>0);v.length!==y.length&&(e.onEmptyValue(m),y=v.length>0?v:void 0)}}else h.type==="string"&&(Array.isArray(y)?(y=y.pop(),e.onMultipleValues(m,y)):!y&&!h.allowEmptyValue&&(e.onEmptyValue(m),y=void 0));d[m]=y,h.deprecationMessage&&e.onDeprecatedOption(m,h.deprecationMessage)}delete u[m]}for(let m in u)e.onUnknownOption(m);return d}function QT(n,t){let e=(l,c)=>{console.warn(p("multipleValues","Option '{0}' is defined more than once. Using value '{1}'.",l,c))},r=l=>{console.warn(p("emptyValue","Option '{0}' requires a non empty value. Ignoring the option.",l))},i=(l,c)=>{console.warn(p("deprecatedArgument","Option '{0}' is deprecated: {1}",l,c))},o=l=>({onUnknownOption:c=>{kg.includes(l)||console.warn(p("unknownSubCommandOption","Warning: '{0}' is not in the list of known options for subcommand '{1}'",c,l))},onMultipleValues:e,onEmptyValue:r,onDeprecatedOption:i,getSubcommandReporter:kg.includes(l)?o:void 0}),a=xc(n,xp,t?{onUnknownOption:l=>{console.warn(p("unknownOption","Warning: '{0}' is not in the list of known options, but still passed to Electron/Chromium.",l))},onMultipleValues:e,onEmptyValue:r,onDeprecatedOption:i,getSubcommandReporter:o}:void 0);return a.goto&&a._.forEach(l=>JT(/^(\w:)?[^:]+(:\d*){0,2}:?$/.test(l),p("gotoValidation","Arguments in `--goto` mode should be in the format of `FILE(:LINE(:CHARACTER))`."))),a}function YT(n){let t=n.findIndex(e=>!/^-/.test(e));if(t>-1)return[...n.slice(0,t),...n.slice(t+1)]}function oS(n){let[,...t]=n;process.env.VSCODE_DEV&&(t=YT(t)||[]);let e=!mn(process.env);return QT(t,e)}function sS(n,...t){let e=n.indexOf("--");return e===-1?n.push(...t):n.splice(e,0,...t),n}function mn(n){return n.VSCODE_CLI==="1"}var Wn=F("protocolMainService");async function aS(n,t,e){let r=e&&e.get("storage.serviceMachineId",-1)||null;if(r)return r;try{let o=(await t.readFile(n.serviceMachineIdResource)).value.toString();r=hb(o)?o:null}catch{r=null}if(!r){r=Ze();try{await t.writeFile(n.serviceMachineIdResource,K.fromString(r))}catch{}}return e?.store("storage.serviceMachineId",r,-1,1),r}function di(n){return n.scheme===L.vscodeRemote?n.authority:void 0}function XT(n){if(mo===2&&/^penguin(\.|$)/i.test(n))return"chromebook"}function lS(n,t,e,r,i,o,s,a,l,c){let d=Object.create(null);d["common.machineId"]=o,d["common.sqmId"]=s,d["common.devDeviceId"]=a,d.sessionID=Ze()+Date.now(),d.commitHash=r,d.version=i,d["common.platformVersion"]=(n||"").replace(/^(\d+)(\.\d+)?(\.\d+)?(.*)/,"$1$2$3"),d["common.platform"]=wd(mo),d["common.nodePlatform"]=wl,d["common.nodeArch"]=e,d["common.product"]=c||"desktop",l&&(d["common.msftInternal"]=l);let u=0,m=Date.now();Object.defineProperties(d,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-m,enumerable:!0},"common.sequence":{get:()=>u++,enumerable:!0}}),Sd&&(d["common.snap"]="true");let h=XT(t);return h&&(d["common.platformDetail"]=h),d}function cS(n){let t=_t.USERDNSDOMAIN;if(!t)return!1;let e=t.toLowerCase();return n.some(r=>e===r)}var Ep=class{constructor(t){this.value=t}isTrustedTelemetryValue=!0},Rg=class{telemetryLevel=0;sessionId="someValue.sessionId";machineId="someValue.machineId";sqmId="someValue.sqmId";devDeviceId="someValue.devDeviceId";firstSessionDate="someValue.firstSessionDate";sendErrorTelemetry=!1;publicLog(){}publicLog2(){}publicLogError(){}publicLogError2(){}setExperimentProperty(){}},Hi=new Rg;function Pp(n,t){return!t.isBuilt&&!t.disableTelemetry?!0:!(t.disableTelemetry||!n.enableTelemetry)}function na(n){let t=n.getValue(ta),e=n.getValue(bp);if(n.getValue(Sc)===!1||e===!1)return 0;switch(t??"all"){case"all":return 3;case"error":return 2;case"crash":return 1;case"off":return 0}}function dS(n,t){let e=n.msftInternalDomains||[],r=t.getValue("telemetry.internalTesting");return cS(e)||r}function uS(n){return[n.appRoot,n.extensionsPath,n.userHome.fsPath,n.tmpDir.fsPath,n.userDataPath]}function tC(n,t){if(!n||!n.includes("/")&&!n.includes("\\"))return n;let e=n,r=[];for(let a of t)for(;;){let l=a.exec(n);if(!l)break;r.push([l.index,a.lastIndex])}let i=/^[\\\/]?(node_modules|node_modules\.asar)[\\\/]/,o=/(file:\/\/)?([a-zA-Z]:(\\\\|\\|\/)|(\\\\|\\|\/))?([\w-\._]+(\\\\|\\|\/))+[\w-\._]*/g,s=0;for(e="";;){let a=o.exec(n);if(!a)break;let l=r.some(([c,d])=>a.index<d&&c<o.lastIndex);!i.test(a[0])&&!l&&(e+=n.substring(s,a.index)+"<REDACTED: user-file-path>",s=o.lastIndex)}return s<n.length&&(e+=n.substr(s)),e}function rC(n){if(!n)return n;let t=[{label:"Google API Key",regex:/AIza[A-Za-z0-9_\\\-]{35}/},{label:"Slack Token",regex:/xox[pbar]\-[A-Za-z0-9]/},{label:"GitHub Token",regex:/(gh[psuro]_[a-zA-Z0-9]{36}|github_pat_[a-zA-Z0-9]{22}_[a-zA-Z0-9]{59})/},{label:"Generic Secret",regex:/(key|token|sig|secret|signature|password|passwd|pwd|android:value)[^a-zA-Z0-9]/i},{label:"CLI Credentials",regex:/((login|psexec|(certutil|psexec)\.exe).{1,50}(\s-u(ser(name)?)?\s+.{3,100})?\s-(admin|user|vm|root)?p(ass(word)?)?\s+["']?[^$\-\/\s]|(^|[\s\r\n\\])net(\.exe)?.{1,5}(user\s+|share\s+\/user:| user -? secrets ? set) \s + [^ $\s \/])/},{label:"Email",regex:/@[a-zA-Z0-9-]+\.[a-zA-Z0-9-]+/}];for(let e of t)if(e.regex.test(n))return`<REDACTED: ${e.label}>`;return n}function pS(n,t){return Yw(n,e=>{if(e instanceof Ep||Object.hasOwnProperty.call(e,"isTrustedTelemetryValue"))return e.value;if(typeof e=="string"){let r=e.replaceAll("%20"," ");r=tC(r,t);for(let i of t)r=r.replace(i,"");return r=rC(r),r}})}async function fS(n,t,e,r,i,o,s){let a={"X-Market-Client-Id":`VSCode ${n}`,"User-Agent":`VSCode ${n} (${t.nameShort})`};if(Pp(t,e)&&na(r)===3){let l=await aS(e,i,o);a["X-Market-User-Id"]=l,a["VSCode-SessionId"]=s.machineId||l}return a}import tr from"electron";var nC="#FFFFFF",iC="#1F1F1F",mS="#000000",hS="#FFFFFF",gS="theme",vS="themeBackground",yS="windowSplash",Pc;(e=>(e.DETECT_COLOR_SCHEME="window.autoDetectColorScheme",e.SYSTEM_COLOR_THEME="window.systemColorTheme"))(Pc||={});var Un=F("themeMainService"),ia=class extends D{constructor(e,r){super();this.stateService=e;this.configurationService=r;Q||this._register(this.configurationService.onDidChangeConfiguration(i=>{(i.affectsConfiguration(Pc.SYSTEM_COLOR_THEME)||i.affectsConfiguration(Pc.DETECT_COLOR_SCHEME))&&this.updateSystemColorTheme()})),this.updateSystemColorTheme(),this._register(E.fromNodeEventEmitter(tr.nativeTheme,"updated")(()=>this._onDidChangeColorScheme.fire(this.getColorScheme())))}_onDidChangeColorScheme=this._register(new S);onDidChangeColorScheme=this._onDidChangeColorScheme.event;updateSystemColorTheme(){if(Q||this.configurationService.getValue(Pc.DETECT_COLOR_SCHEME))tr.nativeTheme.themeSource="system";else switch(this.configurationService.getValue(Pc.SYSTEM_COLOR_THEME)){case"dark":tr.nativeTheme.themeSource="dark";break;case"light":tr.nativeTheme.themeSource="light";break;case"auto":switch(this.getBaseTheme()){case"vs":tr.nativeTheme.themeSource="light";break;case"vs-dark":tr.nativeTheme.themeSource="dark";break;default:tr.nativeTheme.themeSource="system"}break;default:tr.nativeTheme.themeSource="system";break}}getColorScheme(){if(U){if(tr.nativeTheme.shouldUseHighContrastColors)return{dark:tr.nativeTheme.shouldUseInvertedColorScheme,highContrast:!0}}else if(W){if(tr.nativeTheme.shouldUseInvertedColorScheme||tr.nativeTheme.shouldUseHighContrastColors)return{dark:tr.nativeTheme.shouldUseDarkColors,highContrast:!0}}else if(Q&&tr.nativeTheme.shouldUseHighContrastColors)return{dark:!0,highContrast:!0};return{dark:tr.nativeTheme.shouldUseDarkColors,highContrast:!1}}getBackgroundColor(){let e=this.getColorScheme();if(e.highContrast&&this.configurationService.getValue("window.autoDetectHighContrast"))return e.dark?mS:hS;let r=this.stateService.getItem(vS,null);if(!r)switch(this.getBaseTheme()){case"vs":r=nC;break;case"hc-black":r=mS;break;case"hc-light":r=hS;break;default:r=iC}return r}getBaseTheme(){switch(this.stateService.getItem(gS,"vs-dark").split(" ")[0]){case"vs":return"vs";case"hc-black":return"hc-black";case"hc-light":return"hc-light";default:return"vs-dark"}}saveWindowSplash(e,r){this.stateService.setItems([{key:gS,data:r.baseTheme},{key:vS,data:r.colorInfo.background},{key:yS,data:r}]),typeof e=="number"&&this.updateBackgroundColor(e,r),this.updateSystemColorTheme()}updateBackgroundColor(e,r){for(let i of tr.BrowserWindow.getAllWindows())if(i.id===e){i.setBackgroundColor(r.colorInfo.background);break}}getWindowSplash(){return this.stateService.getItem(yS)}};ia=P([g(0,et),g(1,ce)],ia);import IS from"electron";var Fe=F("windowsMainService");function Cp(n,t,e,r){let i=n.get(Un),o=n.get(be),s=n.get(ce),a=n.get(ge),l=s.getValue("window"),c={backgroundColor:i.getBackgroundColor(),minWidth:Sg.WIDTH,minHeight:Sg.HEIGHT,title:o.nameLong,show:t.mode!==0&&t.mode!==3,x:t.x,y:t.y,width:t.width,height:t.height,webPreferences:{...r,enableWebSQL:!1,spellcheck:!1,zoomFactor:ea(t.zoomLevel??l?.zoomLevel),autoplayPolicy:"user-gesture-required",enableBlinkFeatures:"HighlightAPI",sandbox:!0},experimentalDarkMode:!0};if(Q?c.icon=V(a.appRoot,"resources/linux/code.png"):U&&!a.isBuilt&&(c.icon=V(a.appRoot,"resources/win32/code_150x150.png")),W&&(c.acceptFirstMouse=!0,l?.clickThroughInactive===!1&&(c.acceptFirstMouse=!1)),e?.disableFullscreen?c.fullscreen=!1:W&&!hp(s)&&(c.fullscreenable=!1),W&&l?.nativeTabs===!0&&(c.tabbingIdentifier=o.nameShort),!fn(s,e?.forceNativeTitlebar?"native":void 0)&&(c.titleBarStyle="hidden",W||(c.frame=!1),Vi(s))){let m=i.getWindowSplash()?.colorInfo.titleBarBackground??i.getBackgroundColor(),h=M.fromHex(m).isDarker()?"#FFFFFF":"#000000";c.titleBarOverlay={height:29,color:m,symbolColor:h}}return c}function kp(n){let t,e=Number.MIN_VALUE;for(let r of n)r.lastFocusTime>e&&(e=r.lastFocusTime,t=r);return t}var Tc;(e=>{function n(r,i,o=IS.screen.getAllDisplays()){if(r.trace(`window#validateWindowState: validating window state on ${o.length} display(s)`,i),typeof i.x!="number"||typeof i.y!="number"||typeof i.width!="number"||typeof i.height!="number"){r.trace("window#validateWindowState: unexpected type of state values");return}if(i.width<=0||i.height<=0){r.trace("window#validateWindowState: unexpected negative values");return}if(o.length===1){let c=t(o[0]);if(r.trace("window#validateWindowState: single monitor working area",c),c){let d=function(){!i||typeof i.x!="number"||typeof i.y!="number"||!c||(i.x<c.x&&(i.x=c.x),i.y<c.y&&(i.y=c.y))};var l=d;d(),i.width>c.width&&(i.width=c.width),i.height>c.height&&(i.height=c.height),i.x>c.x+c.width-128&&(i.x=c.x+c.width-i.width),i.y>c.y+c.height-128&&(i.y=c.y+c.height-i.height),d()}return i}if(i.display&&i.mode===3){let c=o.find(d=>d.id===i.display);if(c&&typeof c.bounds?.x=="number"&&typeof c.bounds?.y=="number"){r.trace("window#validateWindowState: restoring fullscreen to previous display");let d=Ki(3);return d.x=c.bounds.x,d.y=c.bounds.y,d}}let s,a;try{s=IS.screen.getDisplayMatching({x:i.x,y:i.y,width:i.width,height:i.height}),a=t(s),r.trace("window#validateWindowState: multi-monitor working area",a)}catch(c){r.error("window#validateWindowState: error finding display for window state",c)}if(s&&a&&i.x+i.width>a.x&&i.y+i.height>a.y&&i.x<a.x+a.width&&i.y<a.y+a.height)return i;r.trace("window#validateWindowState: state is outside of the multi-monitor working area")}e.validateWindowState=n;function t(r){if(r.workArea.width>0&&r.workArea.height>0)return r.workArea;if(r.bounds.width>0&&r.bounds.height>0)return r.bounds}})(Tc||={});import*as Kg from"fs";import pC from"electron";var Rp;(t=>t.DEFAULT={allowTrailingComma:!0})(Rp||={});function Fg(n,t=!1){let e=0,r=n.length,i="",o=0,s=16,a=0;function l(v){let b=0,C=0;for(;b<v;){let k=n.charCodeAt(e);if(k>=48&&k<=57)C=C*16+k-48;else if(k>=65&&k<=70)C=C*16+k-65+10;else if(k>=97&&k<=102)C=C*16+k-97+10;else break;e++,b++}return b<v&&(C=-1),C}function c(v){e=v,i="",o=0,s=16,a=0}function d(){let v=e;if(n.charCodeAt(e)===48)e++;else for(e++;e<n.length&&oa(n.charCodeAt(e));)e++;if(e<n.length&&n.charCodeAt(e)===46)if(e++,e<n.length&&oa(n.charCodeAt(e)))for(e++;e<n.length&&oa(n.charCodeAt(e));)e++;else return a=3,n.substring(v,e);let b=e;if(e<n.length&&(n.charCodeAt(e)===69||n.charCodeAt(e)===101))if(e++,(e<n.length&&n.charCodeAt(e)===43||n.charCodeAt(e)===45)&&e++,e<n.length&&oa(n.charCodeAt(e))){for(e++;e<n.length&&oa(n.charCodeAt(e));)e++;b=e}else a=3;return n.substring(v,b)}function u(){let v="",b=e;for(;;){if(e>=r){v+=n.substring(b,e),a=2;break}let C=n.charCodeAt(e);if(C===34){v+=n.substring(b,e),e++;break}if(C===92){if(v+=n.substring(b,e),e++,e>=r){a=2;break}switch(n.charCodeAt(e++)){case 34:v+='"';break;case 92:v+="\\";break;case 47:v+="/";break;case 98:v+="\b";break;case 102:v+="\f";break;case 110:v+=`
`;break;case 114:v+="\r";break;case 116:v+="	";break;case 117:{let _=l(4);_>=0?v+=String.fromCharCode(_):a=4;break}default:a=5}b=e;continue}if(C>=0&&C<=31)if(_p(C)){v+=n.substring(b,e),a=2;break}else a=6;e++}return v}function m(){if(i="",a=0,o=e,e>=r)return o=r,s=17;let v=n.charCodeAt(e);if(Og(v)){do e++,i+=String.fromCharCode(v),v=n.charCodeAt(e);while(Og(v));return s=15}if(_p(v))return e++,i+=String.fromCharCode(v),v===13&&n.charCodeAt(e)===10&&(e++,i+=`
`),s=14;switch(v){case 123:return e++,s=1;case 125:return e++,s=2;case 91:return e++,s=3;case 93:return e++,s=4;case 58:return e++,s=6;case 44:return e++,s=5;case 34:return e++,i=u(),s=10;case 47:{let b=e-1;if(n.charCodeAt(e+1)===47){for(e+=2;e<r&&!_p(n.charCodeAt(e));)e++;return i=n.substring(b,e),s=12}if(n.charCodeAt(e+1)===42){e+=2;let C=r-1,k=!1;for(;e<C;){if(n.charCodeAt(e)===42&&n.charCodeAt(e+1)===47){e+=2,k=!0;break}e++}return k||(e++,a=1),i=n.substring(b,e),s=13}return i+=String.fromCharCode(v),e++,s=16}case 45:if(i+=String.fromCharCode(v),e++,e===r||!oa(n.charCodeAt(e)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=d(),s=11;default:for(;e<r&&h(v);)e++,v=n.charCodeAt(e);if(o!==e){switch(i=n.substring(o,e),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(v),e++,s=16}}function h(v){if(Og(v)||_p(v))return!1;switch(v){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function y(){let v;do v=m();while(v>=12&&v<=15);return v}return{setPosition:c,getPosition:()=>e,scan:t?y:m,getToken:()=>s,getTokenValue:()=>i,getTokenOffset:()=>o,getTokenLength:()=>e-o,getTokenError:()=>a}}function Og(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function _p(n){return n===10||n===13||n===8232||n===8233}function oa(n){return n>=48&&n<=57}function Yr(n,t=[],e=Rp.DEFAULT){let r=null,i=[],o=[];function s(l){Array.isArray(i)?i.push(l):r!==null&&(i[r]=l)}return Dp(n,{onObjectBegin:()=>{let l={};s(l),o.push(i),i=l,r=null},onObjectProperty:l=>{r=l},onObjectEnd:()=>{i=o.pop()},onArrayBegin:()=>{let l=[];s(l),o.push(i),i=l,r=null},onArrayEnd:()=>{i=o.pop()},onLiteralValue:s,onError:(l,c,d)=>{t.push({error:l,offset:c,length:d})}},e),i[0]}function wS(n,t=[],e=Rp.DEFAULT){let r={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(l){r.type==="property"&&(r.length=l-r.offset,r=r.parent)}function o(l){return r.children.push(l),l}Dp(n,{onObjectBegin:l=>{r=o({type:"object",offset:l,length:-1,parent:r,children:[]})},onObjectProperty:(l,c,d)=>{r=o({type:"property",offset:c,length:-1,parent:r,children:[]}),r.children.push({type:"string",value:l,offset:c,length:d,parent:r})},onObjectEnd:(l,c)=>{r.length=l+c-r.offset,r=r.parent,i(l+c)},onArrayBegin:(l,c)=>{r=o({type:"array",offset:l,length:-1,parent:r,children:[]})},onArrayEnd:(l,c)=>{r.length=l+c-r.offset,r=r.parent,i(l+c)},onLiteralValue:(l,c,d)=>{o({type:zi(l),offset:c,length:d,parent:r,value:l}),i(c+d)},onSeparator:(l,c,d)=>{r.type==="property"&&(l===":"?r.colonOffset=c:l===","&&i(c))},onError:(l,c,d)=>{t.push({error:l,offset:c,length:d})}},e);let a=r.children[0];return a&&delete a.parent,a}function Lg(n,t){if(!n)return;let e=n;for(let r of t)if(typeof r=="string"){if(e.type!=="object"||!Array.isArray(e.children))return;let i=!1;for(let o of e.children)if(Array.isArray(o.children)&&o.children[0].value===r){e=o.children[1],i=!0;break}if(!i)return}else{let i=r;if(e.type!=="array"||i<0||!Array.isArray(e.children)||i>=e.children.length)return;e=e.children[i]}return e}function Dp(n,t,e=Rp.DEFAULT){let r=Fg(n,!1);function i(re){return re?()=>re(r.getTokenOffset(),r.getTokenLength()):()=>!0}function o(re){return re?je=>re(je,r.getTokenOffset(),r.getTokenLength()):()=>!0}let s=i(t.onObjectBegin),a=o(t.onObjectProperty),l=i(t.onObjectEnd),c=i(t.onArrayBegin),d=i(t.onArrayEnd),u=o(t.onLiteralValue),m=o(t.onSeparator),h=i(t.onComment),y=o(t.onError),v=e&&e.disallowComments,b=e&&e.allowTrailingComma;function C(){for(;;){let re=r.scan();switch(r.getTokenError()){case 4:k(14);break;case 5:k(15);break;case 3:k(13);break;case 1:v||k(11);break;case 2:k(12);break;case 6:k(16);break}switch(re){case 12:case 13:v?k(10):h();break;case 16:k(1);break;case 15:case 14:break;default:return re}}}function k(re,je=[],zr=[]){if(y(re),je.length+zr.length>0){let Nt=r.getToken();for(;Nt!==17;){if(je.indexOf(Nt)!==-1){C();break}else if(zr.indexOf(Nt)!==-1)break;Nt=C()}}}function _(re){let je=r.getTokenValue();return re?u(je):a(je),C(),!0}function T(){switch(r.getToken()){case 11:{let re=0;try{re=JSON.parse(r.getTokenValue()),typeof re!="number"&&(k(2),re=0)}catch{k(2)}u(re);break}case 7:u(null);break;case 8:u(!0);break;case 9:u(!1);break;default:return!1}return C(),!0}function N(){return r.getToken()!==10?(k(3,[],[2,5]),!1):(_(!1),r.getToken()===6?(m(":"),C(),Ke()||k(4,[],[2,5])):k(5,[],[2,5]),!0)}function J(){s(),C();let re=!1;for(;r.getToken()!==2&&r.getToken()!==17;){if(r.getToken()===5){if(re||k(4,[],[]),m(","),C(),r.getToken()===2&&b)break}else re&&k(6,[],[]);N()||k(4,[],[2,5]),re=!0}return l(),r.getToken()!==2?k(7,[2],[]):C(),!0}function H(){c(),C();let re=!1;for(;r.getToken()!==4&&r.getToken()!==17;){if(r.getToken()===5){if(re||k(4,[],[]),m(","),C(),r.getToken()===4&&b)break}else re&&k(6,[],[]);Ke()||k(4,[],[4,5]),re=!0}return d(),r.getToken()!==4?k(8,[4],[]):C(),!0}function Ke(){switch(r.getToken()){case 3:return H();case 1:return J();case 10:return _(!0);default:return T()}}return C(),r.getToken()===17?e.allowEmptyContent?!0:(k(4,[],[]),!1):Ke()?(r.getToken()!==17&&k(9,[],[]),!0):(k(4,[],[]),!1)}function zi(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}var Mg=class extends D{constructor(e,r,i,o){super();this.storagePath=e;this.saveStrategy=r;this.logService=i;this.fileService=o}storage=Object.create(null);lastSavedStorageContents="";flushDelayer=this._register(new Ht(this.saveStrategy===0?0:100));initializing=void 0;closing=void 0;init(){return this.initializing||(this.initializing=this.doInit()),this.initializing}async doInit(){try{this.lastSavedStorageContents=(await this.fileService.readFile(this.storagePath)).value.toString(),this.storage=JSON.parse(this.lastSavedStorageContents)}catch(e){e.fileOperationResult!==1&&this.logService.error(e)}}getItem(e,r){let i=this.storage[e];return ct(i)?r:i}setItem(e,r){this.setItems([{key:e,data:r}])}setItems(e){let r=!1;for(let{key:i,data:o}of e)this.storage[i]!==o&&(ct(o)?Gr(this.storage[i])||(this.storage[i]=void 0,r=!0):(this.storage[i]=o,r=!0));r&&this.save()}removeItem(e){Gr(this.storage[e])||(this.storage[e]=void 0,this.save())}async save(){if(!this.closing)return this.flushDelayer.trigger(()=>this.doSave())}async doSave(){if(!this.initializing)return;await this.initializing;let e=JSON.stringify(this.storage,null,4);if(e!==this.lastSavedStorageContents)try{await this.fileService.writeFile(this.storagePath,K.fromString(e),{atomic:{postfix:".vsctmp"}}),this.lastSavedStorageContents=e}catch(r){this.logService.error(r)}}async close(){return this.closing||(this.closing=this.flushDelayer.trigger(()=>this.doSave(),0)),this.closing}},Cc=class extends D{fileStorage;constructor(t,e,r,i){super(),this.fileStorage=this._register(new Mg(e.stateResource,t,r,i))}async init(){await this.fileStorage.init()}getItem(t,e){return this.fileStorage.getItem(t,e)}};Cc=P([g(1,dr),g(2,A),g(3,Pe)],Cc);var sa=class extends Cc{setItem(t,e){this.fileStorage.setItem(t,e)}setItems(t){this.fileStorage.setItems(t)}removeItem(t){this.fileStorage.removeItem(t)}close(){return this.fileStorage.close()}};var ui=class extends zs{constructor(e,r,i,o,s){super(i,o,r,s);this.stateReadonlyService=e;this.nativeEnvironmentService=i}static PROFILE_ASSOCIATIONS_MIGRATION_KEY="profileAssociationsMigration";getStoredProfiles(){return this.stateReadonlyService.getItem(ui.PROFILES_KEY,[]).map(r=>({...r,location:ke(r.location)?this.uriIdentityService.extUri.joinPath(this.profilesHome,r.location):x.revive(r.location)}))}getStoredProfileAssociations(){let e=this.stateReadonlyService.getItem(ui.PROFILE_ASSOCIATIONS_KEY,{});return this.stateReadonlyService.getItem(ui.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!1)?e:this.migrateStoredProfileAssociations(e)}getDefaultProfileExtensionsLocation(){return this.uriIdentityService.extUri.joinPath(x.file(this.nativeEnvironmentService.extensionsPath).with({scheme:this.profilesHome.scheme}),"extensions.json")}};ui=P([g(0,sp),g(1,ut),g(2,br),g(3,Pe),g(4,A)],ui);var fr=class extends ui{constructor(e,r,i,o,s){super(e,r,i,o,s);this.stateService=e}saveStoredProfiles(e){e.length?this.stateService.setItem(fr.PROFILES_KEY,e.map(r=>({...r,location:this.uriIdentityService.extUri.basename(r.location)}))):this.stateService.removeItem(fr.PROFILES_KEY)}getStoredProfiles(){let e=super.getStoredProfiles();return this.stateService.getItem("userDataProfilesMigration",!1)||(this.saveStoredProfiles(e),this.stateService.setItem("userDataProfilesMigration",!0)),e}saveStoredProfileAssociations(e){e.emptyWindows||e.workspaces?this.stateService.setItem(fr.PROFILE_ASSOCIATIONS_KEY,e):this.stateService.removeItem(fr.PROFILE_ASSOCIATIONS_KEY)}getStoredProfileAssociations(){let e="workspaceAndProfileInfo",r=this.stateService.getItem(e,void 0);if(r){this.stateService.removeItem(e);let o=r.reduce((s,{workspace:a,profile:l})=>(s[x.revive(a).toString()]=x.revive(l).toString(),s),{});this.stateService.setItem(fr.PROFILE_ASSOCIATIONS_KEY,{workspaces:o})}let i=super.getStoredProfileAssociations();return this.stateService.getItem(fr.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!1)||(this.saveStoredProfileAssociations(i),this.stateService.setItem(fr.PROFILE_ASSOCIATIONS_MIGRATION_KEY,!0)),i}};fr=P([g(0,et),g(1,ut),g(2,br),g(3,Pe),g(4,A)],fr);var Op=class extends fr{constructor(t,e,r,i){super(new sa(0,e,i,r),t,e,r,i)}async init(){return await this.stateService.init(),super.init()}};Op=P([g(0,ut),g(1,br),g(2,Pe),g(3,A)],Op);var rr=jt,aa=class extends fr{constructor(t,e,r,i,o){super(t,e,r,i,o)}getAssociatedEmptyWindows(){let t=[];for(let e of this.profilesObject.emptyWindows.keys())t.push({id:e});return t}};aa=P([g(0,et),g(1,ut),g(2,br),g(3,Pe),g(4,A)],aa);async function xS(n,t,e){for(let i of n){let o=i.openedWorkspace;if(Be(o)){let s=await e(o);if(s){if(s.folders.some(a=>Le.isEqualOrParent(t,a.uri)))return i}else if(Le.isEqualOrParent(t,o.configPath))return i}}let r=n.filter(i=>pt(i.openedWorkspace)&&Le.isEqualOrParent(t,i.openedWorkspace.uri));if(r.length)return r.sort((i,o)=>-(i.openedWorkspace.uri.path.length-o.openedWorkspace.uri.path.length))[0]}function qi(n,t){for(let e of n)if(Be(e.openedWorkspace)&&Le.isEqual(e.openedWorkspace.configPath,t)||pt(e.openedWorkspace)&&Le.isEqual(e.openedWorkspace.uri,t))return e}function ES(n,t){let e=r=>t.some(i=>Le.isEqual(x.file(i),x.file(r)));for(let r of n)if(r.config?.extensionDevelopmentPath?.some(i=>e(i)))return r}function PS(n,t,e){let r,i,o,s,a;if(t){for(s=t.offset,a=s+t.length,o=s;o>0&&!kc(n,o-1);)o--;let _=a;for(;_<n.length&&!kc(n,_);)_++;i=n.substring(o,_),r=sC(i,e)}else i=n,r=0,o=0,s=0,a=n.length;let l=aC(e,n),c=!1,d=0,u;e.insertSpaces?u=Ag(" ",e.tabSize||4):u="	";let m=Fg(i,!1),h=!1;function y(){return l+Ag(u,r+d)}function v(){let _=m.scan();for(c=!1;_===15||_===14;)c=c||_===14,_=m.scan();return h=_===16||m.getTokenError()!==0,_}let b=[];function C(_,T,N){!h&&T<a&&N>s&&n.substring(T,N)!==_&&b.push({offset:T,length:N-T,content:_})}let k=v();if(k!==17){let _=m.getTokenOffset()+o,T=Ag(u,r);C(T,o,_)}for(;k!==17;){let _=m.getTokenOffset()+m.getTokenLength()+o,T=v(),N="";for(;!c&&(T===12||T===13);){let H=m.getTokenOffset()+o;C(" ",_,H),_=m.getTokenOffset()+m.getTokenLength()+o,N=T===12?y():"",T=v()}if(T===2)k!==1&&(d--,N=y());else if(T===4)k!==3&&(d--,N=y());else{switch(k){case 3:case 1:d++,N=y();break;case 5:case 12:N=y();break;case 13:c?N=y():N=" ";break;case 6:N=" ";break;case 10:if(T===6){N="";break}case 7:case 8:case 9:case 11:case 2:case 4:T===12||T===13?N=" ":T!==5&&T!==17&&(h=!0);break;case 16:h=!0;break}c&&(T===12||T===13)&&(N=y())}let J=m.getTokenOffset()+o;C(N,_,J),k=T}return b}function Ag(n,t){let e="";for(let r=0;r<t;r++)e+=n;return e}function sC(n,t){let e=0,r=0,i=t.tabSize||4;for(;e<n.length;){let o=n.charAt(e);if(o===" ")r++;else if(o==="	")r+=i;else break;e++}return Math.floor(r/i)}function aC(n,t){for(let e=0;e<t.length;e++){let r=t.charAt(e);if(r==="\r")return e+1<t.length&&t.charAt(e+1)===`
`?`\r
`:"\r";if(r===`
`)return`
`}return n&&n.eol||`
`}function kc(n,t){return`\r
`.indexOf(n.charAt(t))!==-1}function Ug(n,t,e,r,i){let o=t.slice(),a=wS(n,[]),l,c;for(;o.length>0&&(c=o.pop(),l=Lg(a,o),l===void 0&&e!==void 0);)typeof c=="string"?e={[c]:e}:e=[e];if(l)if(l.type==="object"&&typeof c=="string"&&Array.isArray(l.children)){let d=Lg(l,[c]);if(d!==void 0)if(e===void 0){if(!d.parent)throw new Error("Malformed AST");let u=l.children.indexOf(d.parent),m,h=d.parent.offset+d.parent.length;if(u>0){let y=l.children[u-1];m=y.offset+y.length}else m=l.offset+1,l.children.length>1&&(h=l.children[1].offset);return la(n,{offset:m,length:h-m,content:""},r)}else return la(n,{offset:d.offset,length:d.length,content:JSON.stringify(e)},r);else{if(e===void 0)return[];let u=`${JSON.stringify(c)}: ${JSON.stringify(e)}`,m=i?i(l.children.map(y=>y.children[0].value)):l.children.length,h;if(m>0){let y=l.children[m-1];h={offset:y.offset+y.length,length:0,content:","+u}}else l.children.length===0?h={offset:l.offset+1,length:0,content:u}:h={offset:l.offset+1,length:0,content:u+","};return la(n,h,r)}}else if(l.type==="array"&&typeof c=="number"&&Array.isArray(l.children))if(e!==void 0){let d=`${JSON.stringify(e)}`,u;if(l.children.length===0||c===0)u={offset:l.offset+1,length:0,content:l.children.length===0?d:d+","};else{let m=c===-1||c>l.children.length?l.children.length:c,h=l.children[m-1];u={offset:h.offset+h.length,length:0,content:","+d}}return la(n,u,r)}else{let d=c,u=l.children[d],m;if(l.children.length===1)m={offset:l.offset+1,length:l.length-2,content:""};else if(l.children.length-1===d){let h=l.children[d-1],y=h.offset+h.length,v=l.offset+l.length;m={offset:y,length:v-2-y,content:""}}else m={offset:u.offset,length:l.children[d+1].offset-u.offset,content:""};return la(n,m,r)}else throw new Error(`Can not add ${typeof c!="number"?"index":"property"} to parent of type ${l.type}`);else return e===void 0?[]:la(n,{offset:a?a.offset:0,length:a?a.length:0,content:JSON.stringify(e)},r)}function la(n,t,e){let r=Wg(n,t),i=t.offset,o=t.offset+t.content.length;if(t.length===0||t.content.length===0){for(;i>0&&!kc(r,i-1);)i--;for(;o<r.length&&!kc(r,o);)o++}let s=PS(r,{offset:i,length:o-i},e);for(let l=s.length-1;l>=0;l--){let c=s[l];r=Wg(r,c),i=Math.min(i,c.offset),o=Math.max(o,c.offset+c.length),o+=c.content.length-c.length}let a=n.length-(r.length-o)-i;return[{offset:i,length:a,content:r.substring(i,o)}]}function Wg(n,t){return n.substring(0,t.offset)+t.content+n.substring(t.offset+t.length)}function Ng(n,t){let e=t.slice(0).sort((i,o)=>{let s=i.offset-o.offset;return s===0?i.length-o.length:s}),r=n.length;for(let i=e.length-1;i>=0;i--){let o=e[i];if(o.offset+o.length<=r)n=Wg(n,o);else throw new Error("Overlapping edit");r=o.offset}return n}var Bg=F("workspacesService");function Fp(n){return n.hasOwnProperty("workspace")}function _c(n){return n.hasOwnProperty("folderUri")}function CS(n){return n.hasOwnProperty("fileUri")}function kS(n){return _S(n)||RS(n)}function _S(n){let t=n;return typeof t?.path=="string"&&(!t.name||typeof t.name=="string")}function RS(n){let t=n;return typeof t?.uri=="string"&&(!t.name||typeof t.name=="string")}function DS(n,t,e,r,i){if(n.scheme!==r.scheme)return{name:e,uri:n.toString(!0)};let o=t?void 0:i.relativePath(r,n);if(o!==void 0)o.length===0?o=".":U&&(o=TS(o));else if(n.scheme===L.file)o=n.fsPath,U&&(o=TS(o));else if(i.isEqualAuthority(n.authority,r.authority))o=n.path;else return{name:e,uri:n.toString(!0)};return{name:e,path:o}}function TS(n){return n=Nl(n),yI(n)||(n=Pn(n)),n}function OS(n,t,e){let r=[],i=new Set,o=e.dirname(t);for(let s of n){let a;if(_S(s))s.path&&(a=e.resolvePath(o,s.path));else if(RS(s))try{a=x.parse(s.uri),a.path[0]!==ee.sep&&(a=a.with({path:ee.sep+a.path}))}catch(l){console.warn(l)}if(a){let l=e.getComparisonKey(a);if(!i.has(l)){i.add(l);let c=s.name||e.basenameOrAuthority(a);r.push(new nu({uri:a,name:c,index:r.length},s))}}}return r}function cC(n){return n.workspace&&typeof n.workspace=="object"&&typeof n.workspace.id=="string"&&typeof n.workspace.configPath=="string"}function dC(n){return typeof n.folderUri=="string"}function uC(n){return typeof n.fileUri=="string"}function FS(n,t){let e={workspaces:[],files:[]};if(n){let r=function(o,s){for(let a=0;a<o.length;a++)try{s(o[a],a)}catch(l){t.warn(`Error restoring recent entry ${JSON.stringify(o[a])}: ${l.toString()}. Skip entry.`)}},i=n;Array.isArray(i.entries)&&r(i.entries,o=>{let s=o.label,a=o.remoteAuthority;cC(o)?e.workspaces.push({label:s,remoteAuthority:a,workspace:{id:o.workspace.id,configPath:x.parse(o.workspace.configPath)}}):dC(o)?e.workspaces.push({label:s,remoteAuthority:a,folderUri:x.parse(o.folderUri)}):uC(o)&&e.files.push({label:s,remoteAuthority:a,fileUri:x.parse(o.fileUri)})})}return e}function LS(n){let t={entries:[]};for(let e of n.workspaces)_c(e)?t.entries.push({folderUri:e.folderUri.toString(),label:e.label,remoteAuthority:e.remoteAuthority}):t.entries.push({workspace:{id:e.workspace.id,configPath:e.workspace.configPath.toString()},label:e.label,remoteAuthority:e.remoteAuthority});for(let e of n.files)t.entries.push({fileUri:e.fileUri.toString(),label:e.label,remoteAuthority:e.remoteAuthority});return t}import{createHash as Vg}from"crypto";var vJ=128/4;function pi(n){function t(){let e=n.scheme===L.file?Dt(n):n.toString();return Q||(e=e.toLowerCase()),Vg("md5").update(e).digest("hex")}return{id:t(),configPath:n}}function Lp(n,t){function e(){if(n.scheme!==L.file)return Vg("md5").update(n.toString()).digest("hex");if(!t)return;let i;return Q?i=t.ino:W?i=t.birthtime.getTime():U&&(typeof t.birthtimeMs=="number"?i=Math.floor(t.birthtimeMs):i=t.birthtime.getTime()),Vg("md5").update(n.fsPath).update(i?String(i):"").digest("hex")}let r=e();if(typeof r=="string")return{id:r,uri:n}}function Rc(){return{id:(Date.now()+Math.round(Math.random()*1e3)).toString()}}var Tr=F("workspacesManagementMainService"),ca=class extends D{constructor(e,r,i,o,s){super();this.environmentMainService=e;this.logService=r;this.userDataProfilesMainService=i;this.backupMainService=o;this.dialogMainService=s}_onDidDeleteUntitledWorkspace=this._register(new S);onDidDeleteUntitledWorkspace=this._onDidDeleteUntitledWorkspace.event;_onDidEnterWorkspace=this._register(new S);onDidEnterWorkspace=this._onDidEnterWorkspace.event;untitledWorkspacesHome=this.environmentMainService.untitledWorkspacesHome;untitledWorkspaces=[];async initialize(){this.untitledWorkspaces=[];try{let e=(await q.readdir(this.untitledWorkspacesHome.with({scheme:L.file}).fsPath)).map(r=>ne(this.untitledWorkspacesHome,r,gh));for(let r of e){let i=pi(r),o=await this.resolveLocalWorkspace(r);o?this.untitledWorkspaces.push({workspace:i,remoteAuthority:o.remoteAuthority}):await this.deleteUntitledWorkspace(i)}}catch(e){e.code!=="ENOENT"&&this.logService.warn(`Unable to read folders in ${this.untitledWorkspacesHome} (${e}).`)}}resolveLocalWorkspace(e){return this.doResolveLocalWorkspace(e,r=>Kg.promises.readFile(r,"utf8"))}doResolveLocalWorkspace(e,r){if(this.isWorkspacePath(e)&&e.scheme===L.file)try{let i=r(e.fsPath);return i instanceof Promise?i.then(o=>this.doResolveWorkspace(e,o),o=>{}):this.doResolveWorkspace(e,i)}catch{return}}isWorkspacePath(e){return vh(e,this.environmentMainService)||Tn(e)}doResolveWorkspace(e,r){try{let i=this.doParseStoredWorkspace(e,r),o=pi(e);return{id:o.id,configPath:o.configPath,folders:OS(i.folders,o.configPath,Le),remoteAuthority:i.remoteAuthority,transient:i.transient}}catch(i){this.logService.warn(i.toString())}}doParseStoredWorkspace(e,r){let i=Yr(r);if(i&&Array.isArray(i.folders))i.folders=i.folders.filter(o=>kS(o));else throw new Error(`${e.toString(!0)} looks like an invalid workspace file.`);return i}async createUntitledWorkspace(e,r){let{workspace:i,storedWorkspace:o}=this.newUntitledWorkspace(e,r),s=i.configPath.fsPath;return await Kg.promises.mkdir(Ne(s),{recursive:!0}),await q.writeFile(s,JSON.stringify(o,null,"	")),this.untitledWorkspaces.push({workspace:i,remoteAuthority:r}),i}newUntitledWorkspace(e=[],r){let i=(Date.now()+Math.round(Math.random()*1e3)).toString(),o=ne(this.untitledWorkspacesHome,i),s=ne(o,gh),a=[];for(let l of e)a.push(DS(l.uri,!0,l.name,o,Le));return{workspace:pi(s),storedWorkspace:{folders:a,remoteAuthority:r}}}async getWorkspaceIdentifier(e){return pi(e)}isUntitledWorkspace(e){return vh(e.configPath,this.environmentMainService)}async deleteUntitledWorkspace(e){this.isUntitledWorkspace(e)&&(await this.doDeleteUntitledWorkspace(e),this.userDataProfilesMainService.isEnabled()&&this.userDataProfilesMainService.unsetWorkspace(e),this._onDidDeleteUntitledWorkspace.fire(e))}async doDeleteUntitledWorkspace(e){let r=Dt(e.configPath);try{await q.rm(Ne(r));let i=V(this.environmentMainService.workspaceStorageHome.with({scheme:L.file}).fsPath,e.id);await q.exists(i)&&await q.writeFile(V(i,"obsolete"),""),this.untitledWorkspaces=this.untitledWorkspaces.filter(o=>o.workspace.id!==e.id)}catch(i){this.logService.warn(`Unable to delete untitled workspace ${r} (${i}).`)}}getUntitledWorkspaces(){return this.untitledWorkspaces}async enterWorkspace(e,r,i){if(!e||!e.win||!e.isReady||!await this.isValidTargetWorkspacePath(e,r,i))return;let s=await this.doEnterWorkspace(e,pi(i));if(s)return this._onDidEnterWorkspace.fire({window:e,workspace:s.workspace}),s}async isValidTargetWorkspacePath(e,r,i){return i?Be(e.openedWorkspace)&&Le.isEqual(e.openedWorkspace.configPath,i)?!1:qi(r,i)?(await this.dialogMainService.showMessageBox({type:"info",buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK")],message:p("workspaceOpenedMessage","Unable to save workspace '{0}'",cr(i)),detail:p("workspaceOpenedDetail","The workspace is already opened in another window. Please close that window first and then try again.")},pC.BrowserWindow.getFocusedWindow()??void 0),!1):!0:!0}async doEnterWorkspace(e,r){if(!e.config)return;e.focus();let i;return e.config.extensionDevelopmentPath||(e.config.backupPath?i=await this.backupMainService.registerWorkspaceBackup({workspace:r,remoteAuthority:e.remoteAuthority},e.config.backupPath):i=this.backupMainService.registerWorkspaceBackup({workspace:r,remoteAuthority:e.remoteAuthority})),Be(e.openedWorkspace)&&this.isUntitledWorkspace(e.openedWorkspace)&&await this.deleteUntitledWorkspace(e.openedWorkspace),e.config.workspace=r,e.config.backupPath=i,{workspace:r,backupPath:i}}};ca=P([g(0,ge),g(1,A),g(2,rr),g(3,An),g(4,Gt)],ca);async function fC(n,t,e,r,i){try{let o=await import("@vscode/spdlog");o.setFlushOn(0);let s=await o.createAsyncRotatingLogger(n,t,e,r);return i?s.clearFormatters():s.setPattern("%Y-%m-%d %H:%M:%S.%e [%l] %v"),s}catch(o){console.error(o)}return null}function MS(n,t,e){switch(t){case 1:n.trace(e);break;case 2:n.debug(e);break;case 3:n.info(e);break;case 4:n.warn(e);break;case 5:n.error(e);break;case 0:break;default:throw new Error(`Invalid log level ${t}`)}}function AS(n,t){switch(t){case 1:n.setLevel(0);break;case 2:n.setLevel(1);break;case 3:n.setLevel(2);break;case 4:n.setLevel(3);break;case 5:n.setLevel(4);break;case 0:n.setLevel(6);break;default:throw new Error(`Invalid log level ${t}`)}}var Mp=class extends Ao{buffer=[];_loggerCreationPromise;_logger;constructor(t,e,r,i,o){super(),this.setLevel(o),this._loggerCreationPromise=this._createSpdLogLogger(t,e,r,i),this._register(this.onDidChangeLogLevel(s=>{this._logger&&AS(this._logger,s)}))}async _createSpdLogLogger(t,e,r,i){let o=r?6:1,s=30/o*Ln.MB,a=await fC(t,e,s,o,i);if(a){this._logger=a,AS(this._logger,this.getLevel());for(let{level:l,message:c}of this.buffer)MS(this._logger,l,c);this.buffer=[]}}log(t,e){this._logger?MS(this._logger,t,e):this.getLevel()<=t&&this.buffer.push({level:t,message:e})}flush(){this._logger?this._logger.flush():this._loggerCreationPromise.then(()=>this.flush())}dispose(){this._logger?this.disposeLogger():this._loggerCreationPromise.then(()=>this.disposeLogger()),super.dispose()}disposeLogger(){this._logger&&(this._logger.drop(),this._logger=void 0)}};var Wp=class extends dc{doCreateLogger(t,e,r){return new Mp(Ze(),t.fsPath,!r?.donotRotate,!!r?.donotUseFormatters,e)}};var Nn=Ai,Up=class extends Wp{loggerResourcesByWindow=new Ue;createLogger(t,e,r){r!==void 0&&this.loggerResourcesByWindow.set(this.toResource(t),r);try{return super.createLogger(t,e)}catch(i){throw this.loggerResourcesByWindow.delete(this.toResource(t)),i}}registerLogger(t,e){e!==void 0&&this.loggerResourcesByWindow.set(t.resource,e),super.registerLogger(t)}deregisterLogger(t){this.loggerResourcesByWindow.delete(t),super.deregisterLogger(t)}getRegisteredLoggers(t){let e=[];for(let r of super.getRegisteredLoggers())t===this.loggerResourcesByWindow.get(r.resource)&&e.push(r);return e}getOnDidChangeLogLevelEvent(t){return E.filter(this.onDidChangeLogLevel,e=>uc(e)||this.isInterestedLoggerResource(e[0],t))}getOnDidChangeVisibilityEvent(t){return E.filter(this.onDidChangeVisibility,([e])=>this.isInterestedLoggerResource(e,t))}getOnDidChangeLoggersEvent(t){return E.filter(E.map(this.onDidChangeLoggers,e=>({added:[...e.added].filter(i=>this.isInterestedLoggerResource(i.resource,t)),removed:[...e.removed].filter(i=>this.isInterestedLoggerResource(i.resource,t))})),e=>e.added.length>0||e.removed.length>0)}deregisterLoggers(t){for(let[e,r]of this.loggerResourcesByWindow)r===t&&this.deregisterLogger(e)}isInterestedLoggerResource(t,e){let r=this.loggerResourcesByWindow.get(t);return r===void 0||r===e}dispose(){super.dispose(),this.loggerResourcesByWindow.clear()}};var Dc=class n extends D{constructor(e,r,i,o){super();this.configurationService=e;this.stateService=r;this.environmentMainService=i;this.logService=o}_onDidClose=this._register(new S);onDidClose=this._onDidClose.event;_onDidMaximize=this._register(new S);onDidMaximize=this._onDidMaximize.event;_onDidUnmaximize=this._register(new S);onDidUnmaximize=this._onDidUnmaximize.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;_onDidEnterFullScreen=this._register(new S);onDidEnterFullScreen=this._onDidEnterFullScreen.event;_onDidLeaveFullScreen=this._register(new S);onDidLeaveFullScreen=this._onDidLeaveFullScreen.event;_lastFocusTime=Date.now();get lastFocusTime(){return this._lastFocusTime}_win=null;get win(){return this._win}setWin(e,r){this._win=e,this._register(E.fromNodeEventEmitter(e,"maximize")(()=>this._onDidMaximize.fire())),this._register(E.fromNodeEventEmitter(e,"unmaximize")(()=>this._onDidUnmaximize.fire())),this._register(E.fromNodeEventEmitter(e,"closed")(()=>{this._onDidClose.fire(),this.dispose()})),this._register(E.fromNodeEventEmitter(e,"focus")(()=>{this._lastFocusTime=Date.now()})),this._register(E.fromNodeEventEmitter(this._win,"enter-full-screen")(()=>this._onDidEnterFullScreen.fire())),this._register(E.fromNodeEventEmitter(this._win,"leave-full-screen")(()=>this._onDidLeaveFullScreen.fire()));let i=!fn(this.configurationService,r?.titleBarStyle==="hidden"?"custom":void 0);if(W&&i&&e.setSheetOffset(Ey(hC())?28:22),i&&(Vi(this.configurationService)||W)){let o=this.stateService.getItem(n.windowControlHeightStateStorageKey);o?this.updateWindowControls({height:o}):this.updateWindowControls({height:Kw})}U&&i&&e.hookWindowMessage(278,()=>{let[s,a]=e.getPosition(),l=Br.screen.getCursorScreenPoint(),c=l.x-s,d=l.y-a;return!(c>30&&d>=0&&d<=Math.max(e.getBounds().height*.15,35))||(e.setEnabled(!1),e.setEnabled(!0),this._onDidTriggerSystemContextMenu.fire({x:c,y:d})),0}),this.environmentMainService.args["open-devtools"]===!0&&e.webContents.openDevTools(),W&&(this._register(this.onDidEnterFullScreen(()=>{this.joinNativeFullScreenTransition?.complete(!0)})),this._register(this.onDidLeaveFullScreen(()=>{this.joinNativeFullScreenTransition?.complete(!0)})))}applyState(e,r=Br.screen.getAllDisplays().length>0){let i=this.configurationService.getValue("window"),o=W&&i?.nativeTabs===!0;(W||U)&&r&&(!o||Br.BrowserWindow.getAllWindows().length===1)&&[e.width,e.height,e.x,e.y].every(s=>typeof s=="number")&&this._win?.setBounds({width:e.width,height:e.height,x:e.x,y:e.y}),(e.mode===0||e.mode===3)&&(this._win?.maximize(),e.mode===3&&this.setFullScreen(!0,!0),this._win?.show())}representedFilename;setRepresentedFilename(e){W?this.win?.setRepresentedFilename(e):this.representedFilename=e}getRepresentedFilename(){return W?this.win?.getRepresentedFilename():this.representedFilename}documentEdited;setDocumentEdited(e){W&&this.win?.setDocumentEdited(e),this.documentEdited=e}isDocumentEdited(){return W?!!this.win?.isDocumentEdited():!!this.documentEdited}focus(e){W&&e?.force&&Br.app.focus({steal:!0});let r=this.win;r&&(r.isMinimized()&&r.restore(),r.focus())}handleTitleDoubleClick(){let e=this.win;if(e)if(W)switch(Br.systemPreferences.getUserDefault("AppleActionOnDoubleClick","string")){case"Minimize":e.minimize();break;case"None":break;case"Maximize":default:e.isMaximized()?e.unmaximize():e.maximize()}else e.isMaximized()?e.unmaximize():e.maximize()}static windowControlHeightStateStorageKey="windowControlHeight";hasWindowControlOverlay=Vi(this.configurationService);updateWindowControls(e){let r=this.win;if(r){if(e.height&&this.stateService.setItem(No.windowControlHeightStateStorageKey,e.height),this.hasWindowControlOverlay)r.setTitleBarOverlay({color:e.backgroundColor?.trim()===""?void 0:e.backgroundColor,symbolColor:e.foregroundColor?.trim()===""?void 0:e.foregroundColor,height:e.height?e.height-1:void 0});else if(W&&e.height!==void 0){let i=(e.height-15)/2;i?r.setWindowButtonPosition({x:i,y:i}):r.setWindowButtonPosition(null)}}}transientIsNativeFullScreen=void 0;joinNativeFullScreenTransition=void 0;toggleFullScreen(){this.setFullScreen(!this.isFullScreen,!1)}setFullScreen(e,r){hp(this.configurationService)?this.setNativeFullScreen(e,r):this.setSimpleFullScreen(e)}get isFullScreen(){if(W&&typeof this.transientIsNativeFullScreen=="boolean")return this.transientIsNativeFullScreen;let e=this.win,r=e?.isFullScreen(),i=e?.isSimpleFullScreen();return!!(r||i)}setNativeFullScreen(e,r){let i=this.win;i?.isSimpleFullScreen()&&i?.setSimpleFullScreen(!1),this.doSetNativeFullScreen(e,r)}doSetNativeFullScreen(e,r){if(W){this.transientIsNativeFullScreen=e;let o=this.joinNativeFullScreenTransition=new ur;(async()=>{let s=await Promise.race([o.p,nt(1e4).then(()=>!1)]);this.joinNativeFullScreenTransition===o&&(this.transientIsNativeFullScreen=void 0,this.joinNativeFullScreenTransition=void 0,!s&&e&&r&&this.win&&!this.win.isFullScreen()&&(this.logService.warn("window: native macOS fullscreen transition did not happen within 10s from restoring"),this._onDidLeaveFullScreen.fire()))})()}this.win?.setFullScreen(e)}setSimpleFullScreen(e){let r=this.win;r?.isFullScreen()&&this.doSetNativeFullScreen(!1,!1),r?.setSimpleFullScreen(e),r?.webContents.focus()}dispose(){super.dispose(),this._win=null}},No=class extends Dc{constructor(e,r,i,o,s,a,l,c,d,u,m,h,y,v,b,C,k,_,T,N,J){super(u,N,o,r);this.loggerMainService=i;this.policyService=s;this.userDataProfilesService=a;this.fileService=l;this.applicationStorageMainService=c;this.storageMainService=d;this.themeMainService=m;this.workspacesManagementMainService=h;this.backupMainService=y;this.telemetryService=v;this.dialogMainService=b;this.lifecycleMainService=C;this.productService=k;this.protocolMainService=_;this.windowsMainService=T;{let[H,Ke]=this.restoreWindowState(e.state);this.windowState=H,this.logService.trace("window#ctor: using window state",H);let re=J.invokeFunction(Cp,this.windowState,void 0,{preload:Re.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${this.configObjectUrl.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none"});gt("code/willCreateCodeBrowserWindow"),this._win=new Br.BrowserWindow(re),gt("code/didCreateCodeBrowserWindow"),this._id=this._win.id,this.setWin(this._win,re),this.applyState(this.windowState,Ke),this._lastFocusTime=Date.now()}this.onConfigurationUpdated(),this.createTouchBar(),this.registerListeners()}_onWillLoad=this._register(new S);onWillLoad=this._onWillLoad.event;_onDidSignalReady=this._register(new S);onDidSignalReady=this._onDidSignalReady.event;_onDidDestroy=this._register(new S);onDidDestroy=this._onDidDestroy.event;_id;get id(){return this._id}_win;get backupPath(){return this._config?.backupPath}get openedWorkspace(){return this._config?.workspace}get profile(){if(!this.config)return;let e=this.userDataProfilesService.profiles.find(r=>r.id===this.config?.profiles.profile.id);return this.isExtensionDevelopmentHost&&e?e:this.userDataProfilesService.getProfileForWorkspace(this.config.workspace??Ri(this.backupPath,this.isExtensionDevelopmentHost))??this.userDataProfilesService.defaultProfile}get remoteAuthority(){return this._config?.remoteAuthority}_config;get config(){return this._config}get isExtensionDevelopmentHost(){return!!this._config?.extensionDevelopmentPath}get isExtensionTestHost(){return!!this._config?.extensionTestsPath}get isExtensionDevelopmentTestFromCli(){return this.isExtensionDevelopmentHost&&this.isExtensionTestHost&&!this._config?.debugId}windowState;currentMenuBarVisibility;whenReadyCallbacks=[];touchBarGroups=[];currentHttpProxy=void 0;currentNoProxy=void 0;customZoomLevel=void 0;configObjectUrl=this._register(this.protocolMainService.createIPCObjectUrl());pendingLoadConfig;wasLoaded=!1;readyState=0;setReady(){for(this.logService.trace(`window#load: window reported ready (id: ${this._id})`),this.readyState=2;this.whenReadyCallbacks.length;)this.whenReadyCallbacks.pop()(this);this._onDidSignalReady.fire()}ready(){return new Promise(e=>{if(this.isReady)return e(this);this.whenReadyCallbacks.push(e)})}get isReady(){return this.readyState===2}get whenClosedOrLoaded(){return new Promise(e=>{function r(){i.dispose(),o.dispose(),e()}let i=this.onDidClose(()=>r()),o=this.onWillLoad(()=>r())})}registerListeners(){this._register(E.fromNodeEventEmitter(this._win,"unresponsive")(()=>this.onWindowError(1))),this._register(E.fromNodeEventEmitter(this._win.webContents,"render-process-gone",(r,i)=>i)(r=>this.onWindowError(2,{...r}))),this._register(E.fromNodeEventEmitter(this._win.webContents,"did-fail-load",(r,i,o)=>({exitCode:i,reason:o}))(({exitCode:r,reason:i})=>this.onWindowError(3,{reason:i,exitCode:r}))),this._register(E.fromNodeEventEmitter(this._win.webContents,"will-prevent-unload")(r=>r.preventDefault())),this._register(E.fromNodeEventEmitter(this._win.webContents,"did-finish-load")(()=>{this.pendingLoadConfig&&(this._config=this.pendingLoadConfig,this.pendingLoadConfig=void 0)})),this._register(this.onDidMaximize(()=>{this._config&&(this._config.maximized=!0)})),this._register(this.onDidUnmaximize(()=>{this._config&&(this._config.maximized=!1)})),this._register(this.onDidEnterFullScreen(()=>{this.sendWhenReady("vscode:enterFullScreen",we.None)})),this._register(this.onDidLeaveFullScreen(()=>{this.sendWhenReady("vscode:leaveFullScreen",we.None)})),this._register(this.configurationService.onDidChangeConfiguration(r=>this.onConfigurationUpdated(r))),this._register(this.workspacesManagementMainService.onDidDeleteUntitledWorkspace(r=>this.onDidDeleteUntitledWorkspace(r)));let e=["https://marketplace.visualstudio.com/*","https://*.vsassets.io/*"];this._win.webContents.session.webRequest.onBeforeSendHeaders({urls:e},async(r,i)=>{let o=await this.getMarketplaceHeaders();i({cancel:!1,requestHeaders:Object.assign(r.requestHeaders,o)})})}marketplaceHeadersPromise;getMarketplaceHeaders(){return this.marketplaceHeadersPromise||(this.marketplaceHeadersPromise=fS(this.productService.version,this.productService,this.environmentMainService,this.configurationService,this.fileService,this.applicationStorageMainService,this.telemetryService)),this.marketplaceHeadersPromise}async onWindowError(e,r){switch(e){case 2:this.logService.error(`CodeWindow: renderer process gone (reason: ${r?.reason||"<unknown>"}, code: ${r?.exitCode||"<unknown>"})`);break;case 1:this.logService.error("CodeWindow: detected unresponsive");break;case 3:this.logService.error(`CodeWindow: failed to load (reason: ${r?.reason||"<unknown>"}, code: ${r?.exitCode||"<unknown>"})`);break}switch(this.telemetryService.publicLog2("windowerror",{type:e,reason:r?.reason,code:r?.exitCode}),e){case 1:case 2:if(this.isExtensionDevelopmentTestFromCli){this.lifecycleMainService.kill(1);return}if(this.environmentMainService.args["enable-smoke-test-driver"]){await this.destroyWindow(!1,!1),this.lifecycleMainService.quit();return}if(e===1){if(this.isExtensionDevelopmentHost||this.isExtensionTestHost||this._win&&this._win.webContents&&this._win.webContents.isDevToolsOpened())return;let{response:i,checkboxChecked:o}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"reopen",comment:["&& denotes a mnemonic"]},"&&Reopen"),p({key:"close",comment:["&& denotes a mnemonic"]},"&&Close"),p({key:"wait",comment:["&& denotes a mnemonic"]},"&&Keep Waiting")],message:p("appStalled","The window is not responding"),detail:p("appStalledDetail","You can reopen or close the window or keep waiting."),checkboxLabel:this._config?.workspace?p("doNotRestoreEditors","Don't restore editors"):void 0},this._win);if(i!==2){let s=i===0;await this.destroyWindow(s,o)}}else if(e===2){let i;r?i=p("appGoneDetails","The window terminated unexpectedly (reason: '{0}', code: '{1}')",r.reason,r.exitCode??"<unknown>"):i=p("appGone","The window terminated unexpectedly");let{response:o,checkboxChecked:s}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[this._config?.workspace?p({key:"reopen",comment:["&& denotes a mnemonic"]},"&&Reopen"):p({key:"newWindow",comment:["&& denotes a mnemonic"]},"&&New Window"),p({key:"close",comment:["&& denotes a mnemonic"]},"&&Close")],message:i,detail:this._config?.workspace?p("appGoneDetailWorkspace","We are sorry for the inconvenience. You can reopen the window to continue where you left off."):p("appGoneDetailEmptyWindow","We are sorry for the inconvenience. You can open a new empty window to start again."),checkboxLabel:this._config?.workspace?p("doNotRestoreEditors","Don't restore editors"):void 0},this._win),a=o===0;await this.destroyWindow(a,s)}break}}async destroyWindow(e,r){let i=this._config?.workspace;if(r&&i)try{let o=this.storageMainService.workspaceStorage(i);await o.init(),o.delete("memento/workbench.parts.editor"),await o.close()}catch(o){this.logService.error(o)}this._onDidDestroy.fire();try{if(e&&this._config){let o,s;pt(i)?o={folderUri:i.uri}:Be(i)?o={workspaceUri:i.configPath}:s=!0,(await this.windowsMainService.open({context:5,userEnv:this._config.userEnv,cli:{...this.environmentMainService.args,_:[]},urisToOpen:o?[o]:void 0,forceEmpty:s,forceNewWindow:!0,remoteAuthority:this.remoteAuthority})).at(0)?.focus()}}finally{this._win?.destroy()}}onDidDeleteUntitledWorkspace(e){this._config?.workspace?.id===e.id&&(this._config.workspace=void 0)}onConfigurationUpdated(e){if(!e||e.affectsConfiguration("window.menuBarVisibility")){let r=this.getMenuBarVisibility();r!==this.currentMenuBarVisibility&&(this.currentMenuBarVisibility=r,this.setMenuBarVisibility(r))}if(!e||e.affectsConfiguration("http.proxy")||e.affectsConfiguration("http.noProxy")){let r=(this.configurationService.getValue("http.proxy")||"").trim()||(process.env.https_proxy||process.env.HTTPS_PROXY||process.env.http_proxy||process.env.HTTP_PROXY||"").trim()||void 0;if(r?.indexOf("@")!==-1){let o=x.parse(r),s=o.authority.indexOf("@");s!==-1&&(r=o.with({authority:o.authority.substring(s+1)}).toString())}r?.endsWith("/")&&(r=r.substr(0,r.length-1));let i=(this.configurationService.getValue("http.noProxy")||[]).map(o=>o.trim()).join(",")||(process.env.no_proxy||process.env.NO_PROXY||"").trim()||void 0;if((r||"").indexOf("@")===-1&&(r!==this.currentHttpProxy||i!==this.currentNoProxy)){this.currentHttpProxy=r,this.currentNoProxy=i;let o=r||"",s=i?`${i},<local>`:"<local>";this.logService.trace(`Setting proxy to '${o}', bypassing '${s}'`),this._win.webContents.session.setProxy({proxyRules:o,proxyBypassRules:s,pacScript:""}),Br.app.setProxy({proxyRules:o,proxyBypassRules:s,pacScript:""})}}}addTabbedWindow(e){W&&e.win&&this._win.addTabbedWindow(e.win)}load(e,r=Object.create(null)){this.logService.trace(`window#load: attempt to load window (id: ${this._id})`),this.isDocumentEdited()&&(!r.isReload||!this.backupMainService.isHotExitEnabled())&&this.setDocumentEdited(!1),r.isReload||(this.getRepresentedFilename()&&this.setRepresentedFilename(""),this._win.setTitle(this.productService.nameLong)),this.updateConfiguration(e,r),this.readyState===0?this._config=e:this.pendingLoadConfig=e,this.readyState=1,this._win.loadURL(Re.asBrowserUri(`vs/code/electron-sandbox/workbench/workbench${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0));let i=this.wasLoaded;this.wasLoaded=!0,!this.environmentMainService.isBuilt&&!this.environmentMainService.extensionTestsLocationURI&&this._register(new bt(()=>{this._win&&!this._win.isVisible()&&!this._win.isMinimized()&&(this._win.show(),this.focus({force:!0}),this._win.webContents.openDevTools())},1e4)).schedule(),this._onWillLoad.fire({workspace:e.workspace,reason:r.isReload?3:i?2:1})}updateConfiguration(e,r){let i=(this._config??this.pendingLoadConfig)?.userEnv;if(i){let o=mn(i)&&!mn(e.userEnv),s=this.isExtensionDevelopmentHost;(o||s)&&(e.userEnv={...i,...e.userEnv})}process.env.CHROME_CRASHPAD_PIPE_NAME&&Object.assign(e.userEnv,{CHROME_CRASHPAD_PIPE_NAME:process.env.CHROME_CRASHPAD_PIPE_NAME}),r.disableExtensions!==void 0&&(e["disable-extensions"]=r.disableExtensions),e.fullscreen=this.isFullScreen,e.maximized=this._win.isMaximized(),e.partsSplash=this.themeMainService.getWindowSplash(),e.zoomLevel=this.getZoomLevel(),e.isCustomZoomLevel=typeof this.customZoomLevel=="number",e.isCustomZoomLevel&&e.partsSplash&&(e.partsSplash.zoomLevel=e.zoomLevel),gt("code/willOpenNewWindow"),e.perfMarks=wu(),this.configObjectUrl.update(e)}async reload(e){let r=Object.assign({},this._config);r.workspace=await this.validateWorkspaceBeforeReload(r),delete r.filesToOpenOrCreate,delete r.filesToDiff,delete r.filesToMerge,delete r.filesToWait,this.isExtensionDevelopmentHost&&e&&(r.verbose=e.verbose,r.debugId=e.debugId,r.extensionEnvironment=e.extensionEnvironment,r["inspect-extensions"]=e["inspect-extensions"],r["inspect-brk-extensions"]=e["inspect-brk-extensions"],r["extensions-dir"]=e["extensions-dir"]),r.accessibilitySupport=Br.app.isAccessibilitySupportEnabled(),r.isInitialStartup=!1,r.policiesData=this.policyService.serialize(),r.continueOn=this.environmentMainService.continueOn,r.profiles={all:this.userDataProfilesService.profiles,profile:this.profile||this.userDataProfilesService.defaultProfile,home:this.userDataProfilesService.profilesHome},r.logLevel=this.loggerMainService.getLogLevel(),r.loggers={window:this.loggerMainService.getRegisteredLoggers(this.id),global:this.loggerMainService.getRegisteredLoggers()},this.load(r,{isReload:!0,disableExtensions:e?.["disable-extensions"]})}async validateWorkspaceBeforeReload(e){if(Be(e.workspace)){let r=e.workspace.configPath;if(r.scheme===L.file&&!await this.fileService.exists(r))return}else if(pt(e.workspace)){let r=e.workspace.uri;if(r.scheme===L.file&&!await this.fileService.exists(r))return}return e.workspace}serializeWindowState(){if(!this._win)return Ki();if(this.isFullScreen){let i;try{i=Br.screen.getDisplayMatching(this.getBounds())}catch{}let o=Ki();return{mode:3,display:i?i.id:void 0,width:this.windowState.width||o.width,height:this.windowState.height||o.height,x:this.windowState.x||0,y:this.windowState.y||0,zoomLevel:this.customZoomLevel}}let e=Object.create(null),r;if(!W&&this._win.isMaximized()?r=0:r=1,r===0?e.mode=0:e.mode=1,r===1||r===0){let i;r===1?i=this.getBounds():i=this._win.getNormalBounds(),e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height}return e.zoomLevel=this.customZoomLevel,e}restoreWindowState(e){gt("code/willRestoreCodeWindowState");let r=!1;if(e){this.customZoomLevel=e.zoomLevel;try{let i=Br.screen.getAllDisplays();r=i.length>1,e=Tc.validateWindowState(this.logService,e,i)}catch(i){this.logService.warn(`Unexpected error validating window state: ${i}
${i.stack}`)}}return gt("code/didRestoreCodeWindowState"),[e||Ki(),r]}getBounds(){let[e,r]=this._win.getPosition(),[i,o]=this._win.getSize();return{x:e,y:r,width:i,height:o}}setFullScreen(e,r){super.setFullScreen(e,r),this.sendWhenReady(e?"vscode:enterFullScreen":"vscode:leaveFullScreen",we.None),this.currentMenuBarVisibility&&this.setMenuBarVisibility(this.currentMenuBarVisibility,!1)}getMenuBarVisibility(){let e=Vw(this.configurationService);return["visible","toggle","hidden"].indexOf(e)<0&&(e="classic"),e}setMenuBarVisibility(e,r=!0){W||(e==="toggle"&&r&&this.send("vscode:showInfoMessage",p("hiddenMenuBar","You can still access the menu bar by pressing the Alt-key.")),e==="hidden"?setTimeout(()=>{this.doSetMenuBarVisibility(e)}):this.doSetMenuBarVisibility(e))}doSetMenuBarVisibility(e){let r=this.isFullScreen;switch(e){case"classic":this._win.setMenuBarVisibility(!r),this._win.autoHideMenuBar=r;break;case"visible":this._win.setMenuBarVisibility(!0),this._win.autoHideMenuBar=!1;break;case"toggle":this._win.setMenuBarVisibility(!1),this._win.autoHideMenuBar=!0;break;case"hidden":this._win.setMenuBarVisibility(!1),this._win.autoHideMenuBar=!1;break}}notifyZoomLevel(e){this.customZoomLevel=e}getZoomLevel(){return typeof this.customZoomLevel=="number"?this.customZoomLevel:this.configurationService.getValue("window")?.zoomLevel}close(){this._win?.close()}sendWhenReady(e,r,...i){this.isReady?this.send(e,...i):this.ready().then(()=>{r.isCancellationRequested||this.send(e,...i)})}send(e,...r){if(this._win){if(this._win.isDestroyed()||this._win.webContents.isDestroyed()){this.logService.warn(`Sending IPC message to channel '${e}' for window that is destroyed`);return}try{this._win.webContents.send(e,...r)}catch(i){this.logService.warn(`Error sending IPC message to channel '${e}' of window ${this._id}: ${zt(i)}`)}}}updateTouchBar(e){W&&this.touchBarGroups.forEach((r,i)=>{let o=e[i];r.segments=this.createTouchBarGroupSegments(o)})}createTouchBar(){if(W){for(let e=0;e<10;e++){let r=this.createTouchBarGroup();this.touchBarGroups.push(r)}this._win.setTouchBar(new Br.TouchBar({items:this.touchBarGroups}))}}createTouchBarGroup(e=[]){let r=this.createTouchBarGroupSegments(e),i=new Br.TouchBar.TouchBarSegmentedControl({segments:r,mode:"buttons",segmentStyle:"automatic",change:o=>{this.sendWhenReady("vscode:runAction",we.None,{id:i.segments[o].id,from:"touchbar"})}});return i}createTouchBarGroupSegments(e=[]){return e.map(i=>{let o;i.icon&&!Ft.isThemeIcon(i.icon)&&i.icon?.dark?.scheme===L.file&&(o=Br.nativeImage.createFromPath(x.revive(i.icon.dark).fsPath),o.isEmpty()&&(o=void 0));let s;return typeof i.title=="string"?s=i.title:s=i.title.value,{id:i.id,label:o?void 0:s,icon:o}})}matches(e){return this._win?.webContents.id===e.id}dispose(){super.dispose(),this.loggerMainService.deregisterLoggers(this.id)}};No=P([g(1,A),g(2,Nn),g(3,ge),g(4,Jr),g(5,rr),g(6,Pe),g(7,$i),g(8,Bo),g(9,ce),g(10,Un),g(11,Tr),g(12,An),g(13,Ve),g(14,Gt),g(15,oe),g(16,be),g(17,Wn),g(18,Fe),g(19,et),g(20,Yt)],No);var ua=class extends Dc{constructor(e,r,i,o,s,a){super(o,s,r,i);this.webContents=e;this.lifecycleMainService=a;this.tryClaimWindow()}id=this.webContents.id;parentId=-1;get win(){return super.win||this.tryClaimWindow(),super.win}stateApplied=!1;tryClaimWindow(e){this._store.isDisposed||this.webContents.isDestroyed()||(this.doTryClaimWindow(e),e&&!this.stateApplied&&(this.stateApplied=!0,this.applyState({x:e.x,y:e.y,width:e.width,height:e.height,mode:e.show===!1?0:1})))}doTryClaimWindow(e){if(this._win)return;let r=gC.fromWebContents(this.webContents);r&&(this.logService.trace("[aux window] Claimed browser window instance"),this.setWin(r,e),r.setMenu(null),(U||Q)&&fn(this.configurationService,e?.titleBarStyle==="hidden"?"custom":void 0)&&r.setAutoHideMenuBar(!0),this.lifecycleMainService.registerAuxWindow(this))}matches(e){return this.webContents.id===e.id}};ua=P([g(1,ge),g(2,A),g(3,ce),g(4,et),g(5,oe)],ua);var oe=F("lifecycleMainService");var Vn=class extends D{constructor(e,r,i){super();this.logService=e;this.stateService=r;this.environmentMainService=i;this.resolveRestarted(),this.when(2).then(()=>this.registerListeners())}static QUIT_AND_RESTART_KEY="lifecycle.quitAndRestart";_onBeforeShutdown=this._register(new S);onBeforeShutdown=this._onBeforeShutdown.event;_onWillShutdown=this._register(new S);onWillShutdown=this._onWillShutdown.event;_onWillLoadWindow=this._register(new S);onWillLoadWindow=this._onWillLoadWindow.event;_onBeforeCloseWindow=this._register(new S);onBeforeCloseWindow=this._onBeforeCloseWindow.event;_quitRequested=!1;get quitRequested(){return this._quitRequested}_wasRestarted=!1;get wasRestarted(){return this._wasRestarted}_phase=1;get phase(){return this._phase}windowToCloseRequest=new Set;oneTimeListenerTokenGenerator=0;windowCounter=0;pendingQuitPromise=void 0;pendingQuitPromiseResolve=void 0;pendingWillShutdownPromise=void 0;mapWindowIdToPendingUnload=new Map;phaseWhen=new Map;relaunchHandler=void 0;resolveRestarted(){this._wasRestarted=!!this.stateService.getItem(Vn.QUIT_AND_RESTART_KEY),this._wasRestarted&&this.stateService.removeItem(Vn.QUIT_AND_RESTART_KEY)}registerListeners(){let e=()=>{this._quitRequested||(this.trace("Lifecycle#app.on(before-quit)"),this._quitRequested=!0,this.trace("Lifecycle#onBeforeShutdown.fire()"),this._onBeforeShutdown.fire(),W&&this.windowCounter===0&&this.fireOnWillShutdown(1))};Vr.app.addListener("before-quit",e);let r=()=>{this.trace("Lifecycle#app.on(window-all-closed)"),(this._quitRequested||!W)&&Vr.app.quit()};Vr.app.addListener("window-all-closed",r),Vr.app.once("will-quit",i=>{this.trace("Lifecycle#app.on(will-quit) - begin"),i.preventDefault(),this.fireOnWillShutdown(1).finally(()=>{this.trace("Lifecycle#app.on(will-quit) - after fireOnWillShutdown"),this.resolvePendingQuitPromise(!1),Vr.app.removeListener("before-quit",e),Vr.app.removeListener("window-all-closed",r),this.trace("Lifecycle#app.on(will-quit) - calling app.quit()"),Vr.app.quit()})})}fireOnWillShutdown(e){if(this.pendingWillShutdownPromise)return this.pendingWillShutdownPromise;let r=this.logService;this.trace("Lifecycle#onWillShutdown.fire()");let i=[];return this._onWillShutdown.fire({reason:e,join(o,s){r.trace(`Lifecycle#onWillShutdown - begin '${o}'`),i.push(s.finally(()=>{r.trace(`Lifecycle#onWillShutdown - end '${o}'`)}))}}),this.pendingWillShutdownPromise=(async()=>{try{await Xe.settled(i)}catch(o){this.logService.error(o)}try{await this.stateService.close()}catch(o){this.logService.error(o)}})(),this.pendingWillShutdownPromise}set phase(e){if(e<this.phase)throw new Error("Lifecycle cannot go backwards");if(this._phase===e)return;this.trace(`lifecycle (main): phase changed (value: ${e})`),this._phase=e;let r=this.phaseWhen.get(this._phase);r&&(r.open(),this.phaseWhen.delete(this._phase))}async when(e){if(e<=this._phase)return;let r=this.phaseWhen.get(e);r||(r=new kn,this.phaseWhen.set(e,r)),await r.wait()}registerWindow(e){let r=new Y;this.windowCounter++,r.add(e.onWillLoad(o=>this._onWillLoadWindow.fire({window:e,workspace:o.workspace,reason:o.reason})));let i=Zn(e.win);r.add(E.fromNodeEventEmitter(i,"close")(o=>{let s=e.id;if(this.windowToCloseRequest.has(s)){this.windowToCloseRequest.delete(s);return}this.trace(`Lifecycle#window.on('close') - window ID ${e.id}`),o.preventDefault(),this.unload(e,1).then(a=>{if(a){this.windowToCloseRequest.delete(s);return}this.windowToCloseRequest.add(s),this.trace(`Lifecycle#onBeforeCloseWindow.fire() - window ID ${s}`),this._onBeforeCloseWindow.fire(e),e.close()})})),r.add(E.fromNodeEventEmitter(i,"closed")(()=>{this.trace(`Lifecycle#window.on('closed') - window ID ${e.id}`),this.windowCounter--,r.dispose(),this.windowCounter===0&&(!W||this._quitRequested)&&this.fireOnWillShutdown(1)}))}registerAuxWindow(e){let r=Zn(e.win),i=new Y;i.add(E.fromNodeEventEmitter(r,"close")(o=>{this.trace(`Lifecycle#auxWindow.on('close') - window ID ${e.id}`),this._quitRequested&&(this.trace("Lifecycle#auxWindow.on('close') - preventDefault() because quit requested"),o.preventDefault())})),i.add(E.fromNodeEventEmitter(r,"closed")(()=>{this.trace(`Lifecycle#auxWindow.on('closed') - window ID ${e.id}`),i.dispose()}))}async reload(e,r){await this.unload(e,3)||e.reload(r)}unload(e,r){let i=this.mapWindowIdToPendingUnload.get(e.id);if(i)return i;let o=this.doUnload(e,r).finally(()=>{this.mapWindowIdToPendingUnload.delete(e.id)});return this.mapWindowIdToPendingUnload.set(e.id,o),o}async doUnload(e,r){if(!e.isReady)return!1;this.trace(`Lifecycle#unload() - window ID ${e.id}`);let i=this._quitRequested?2:r,o=await this.onBeforeUnloadWindowInRenderer(e,i);return o?(this.trace(`Lifecycle#unload() - veto in renderer (window ID ${e.id})`),this.handleWindowUnloadVeto(o)):(await this.onWillUnloadWindowInRenderer(e,i),!1)}handleWindowUnloadVeto(e){return e?(this.resolvePendingQuitPromise(!0),this._quitRequested=!1,!0):!1}resolvePendingQuitPromise(e){this.pendingQuitPromiseResolve&&(this.pendingQuitPromiseResolve(e),this.pendingQuitPromiseResolve=void 0,this.pendingQuitPromise=void 0)}onBeforeUnloadWindowInRenderer(e,r){return new Promise(i=>{let o=this.oneTimeListenerTokenGenerator++,s=`vscode:ok${o}`,a=`vscode:cancel${o}`;_e.once(s,()=>{i(!1)}),_e.once(a,()=>{i(!0)}),e.send("vscode:onBeforeUnload",{okChannel:s,cancelChannel:a,reason:r})})}onWillUnloadWindowInRenderer(e,r){return new Promise(i=>{let s=`vscode:reply${this.oneTimeListenerTokenGenerator++}`;_e.once(s,()=>i()),e.send("vscode:onWillUnload",{replyChannel:s,reason:r})})}quit(e){return this.doQuit(e).then(r=>{if(!r&&e)try{if(U){let i=ar();i!==process.cwd()&&process.chdir(i)}}catch(i){this.logService.error(i)}return r})}doQuit(e){return this.trace(`Lifecycle#quit() - begin (willRestart: ${e})`),this.pendingQuitPromise?(this.trace("Lifecycle#quit() - returning pending quit promise"),this.pendingQuitPromise):(e&&this.stateService.setItem(Vn.QUIT_AND_RESTART_KEY,!0),this.pendingQuitPromise=new Promise(r=>{this.pendingQuitPromiseResolve=r,this.trace("Lifecycle#quit() - calling app.quit()"),Vr.app.quit()}),this.pendingQuitPromise)}trace(e){this.environmentMainService.args["enable-smoke-test-driver"]?this.logService.info(e):this.logService.trace(e)}setRelaunchHandler(e){this.relaunchHandler=e}async relaunch(e){this.trace("Lifecycle#relaunch()");let r=process.argv.slice(1);if(e?.addArgs&&r.push(...e.addArgs),e?.removeArgs)for(let s of e.removeArgs){let a=r.indexOf(s);a>=0&&r.splice(a,1)}let i=()=>{this.relaunchHandler?.handleRelaunch(e)||(this.trace("Lifecycle#relaunch() - calling app.relaunch()"),Vr.app.relaunch({args:r}))};Vr.app.once("quit",i),await this.quit(!0)&&Vr.app.removeListener("quit",i)}async kill(e){this.trace("Lifecycle#kill()"),await this.fireOnWillShutdown(2),await Promise.race([nt(1e3),(async()=>{for(let r of Vr.BrowserWindow.getAllWindows())if(r&&!r.isDestroyed()){let i;r.webContents&&!r.webContents.isDestroyed()?i=new Promise(o=>r.once("closed",o)):i=Promise.resolve(),r.destroy(),await i}})()]),Vr.app.exit(e)}};Vn=P([g(0,A),g(1,et),g(2,ge)],Vn);import*as WS from"fs";import*as Hg from"fs";var Vo=class n{constructor(t,e=Object.create(null)){this.path=t;this.options=e}static IN_MEMORY_PATH=":memory:";get onDidChangeItemsExternal(){return E.None}static BUSY_OPEN_TIMEOUT=2e3;static MAX_HOST_PARAMETERS=256;name=pe(this.path);logger=new zg(this.options.logging);whenConnected=this.connect(this.path);async getItems(){let t=await this.whenConnected,e=new Map;return(await this.all(t,"SELECT * FROM ItemTable")).forEach(i=>e.set(i.key,i.value)),this.logger.isTracing&&this.logger.trace(`[storage ${this.name}] getItems(): ${e.size} rows`),e}async updateItems(t){let e=await this.whenConnected;return this.doUpdateItems(e,t)}doUpdateItems(t,e){return this.logger.isTracing&&this.logger.trace(`[storage ${this.name}] updateItems(): insert(${e.insert?Wy(e.insert):"0"}), delete(${e.delete?Uy(e.delete):"0"})`),this.transaction(t,()=>{let r=e.insert,i=e.delete;if(r&&r.size>0){let o=[];o.push([]);let s=0;r.forEach((a,l)=>{let c=o[s];c.length>n.MAX_HOST_PARAMETERS&&(s++,c=[],o.push(c)),c.push(l,a)}),o.forEach(a=>{this.prepare(t,`INSERT INTO ItemTable VALUES ${new Array(a.length/2).fill("(?,?)").join(",")}`,l=>l.run(a),()=>{let l=[],c=0;return r.forEach((d,u)=>{l.push(u),c+=d.length}),`Keys: ${l.join(", ")} Length: ${c}`})})}if(i&&i.size){let o=[];o.push([]);let s=0;i.forEach(a=>{let l=o[s];l.length>n.MAX_HOST_PARAMETERS&&(s++,l=[],o.push(l)),l.push(a)}),o.forEach(a=>{this.prepare(t,`DELETE FROM ItemTable WHERE key IN (${new Array(a.length).fill("?").join(",")})`,l=>l.run(a),()=>{let l=[];return i.forEach(c=>{l.push(c)}),`Keys: ${l.join(", ")}`})})}})}async optimize(){this.logger.trace(`[storage ${this.name}] vacuum()`);let t=await this.whenConnected;return this.exec(t,"VACUUM")}async close(t){this.logger.trace(`[storage ${this.name}] close()`);let e=await this.whenConnected;return this.doClose(e,t)}doClose(t,e){return new Promise((r,i)=>{t.db.close(o=>(o&&this.handleSQLiteError(t,`[storage ${this.name}] close(): ${o}`),this.path===n.IN_MEMORY_PATH?r():!t.isErroneous&&!t.isInMemory?this.backup().then(r,s=>(this.logger.error(`[storage ${this.name}] backup(): ${s}`),r())):typeof e=="function"?Hg.promises.unlink(this.path).then(()=>this.doConnect(this.path).then(s=>{let a=()=>this.doClose(s,void 0);return this.doUpdateItems(s,{insert:e()}).then(()=>a(),l=>(a(),Promise.reject(l)))})).then(r,i):i(o||new Error("Database has errors or is in-memory without recovery option"))))})}backup(){let t=this.toBackupPath(this.path);return q.copy(this.path,t,{preserveSymlinks:!1})}toBackupPath(t){return`${t}.backup`}async checkIntegrity(t){this.logger.trace(`[storage ${this.name}] checkIntegrity(full: ${t})`);let e=await this.whenConnected,r=await this.get(e,t?"PRAGMA integrity_check":"PRAGMA quick_check"),i=t?r.integrity_check:r.quick_check;return e.isErroneous?`${i} (last error: ${e.lastError})`:e.isInMemory?`${i} (in-memory!)`:i}async connect(t,e=!0){this.logger.trace(`[storage ${this.name}] open(${t}, retryOnBusy: ${e})`);try{return await this.doConnect(t)}catch(r){if(this.logger.error(`[storage ${this.name}] open(): Unable to open DB due to ${r}`),r.code==="SQLITE_BUSY"&&e)return await nt(n.BUSY_OPEN_TIMEOUT),this.connect(t,!1);try{await Hg.promises.unlink(t);try{await q.rename(this.toBackupPath(t),t,!1)}catch{}return await this.doConnect(t)}catch(i){return this.logger.error(`[storage ${this.name}] open(): Unable to use backup due to ${i}`),this.doConnect(n.IN_MEMORY_PATH)}}}handleSQLiteError(t,e){t.isErroneous=!0,t.lastError=e,this.logger.error(e)}doConnect(t){return new Promise((e,r)=>{import("@vscode/sqlite3").then(i=>{let o=this.logger.isTracing?i.default.verbose().Database:i.default.Database,s={db:new o(t,a=>a?s.db&&a.code!=="SQLITE_CANTOPEN"?s.db.close(()=>r(a)):r(a):this.exec(s,["PRAGMA user_version = 1;","CREATE TABLE IF NOT EXISTS ItemTable (key TEXT UNIQUE ON CONFLICT REPLACE, value BLOB)"].join("")).then(()=>e(s),l=>s.db.close(()=>r(l)))),isInMemory:t===n.IN_MEMORY_PATH};s.db.on("error",a=>this.handleSQLiteError(s,`[storage ${this.name}] Error (event): ${a}`)),this.logger.isTracing&&s.db.on("trace",a=>this.logger.trace(`[storage ${this.name}] Trace (event): ${a}`))},r)})}exec(t,e){return new Promise((r,i)=>{t.db.exec(e,o=>o?(this.handleSQLiteError(t,`[storage ${this.name}] exec(): ${o}`),i(o)):r())})}get(t,e){return new Promise((r,i)=>{t.db.get(e,(o,s)=>o?(this.handleSQLiteError(t,`[storage ${this.name}] get(): ${o}`),i(o)):r(s))})}all(t,e){return new Promise((r,i)=>{t.db.all(e,(o,s)=>o?(this.handleSQLiteError(t,`[storage ${this.name}] all(): ${o}`),i(o)):r(s))})}transaction(t,e){return new Promise((r,i)=>{t.db.serialize(()=>{t.db.run("BEGIN TRANSACTION"),e(),t.db.run("END TRANSACTION",o=>o?(this.handleSQLiteError(t,`[storage ${this.name}] transaction(): ${o}`),i(o)):r())})})}prepare(t,e,r,i){let o=t.db.prepare(e),s=a=>{this.handleSQLiteError(t,`[storage ${this.name}] prepare(): ${a} (${e}). Details: ${i()}`)};o.on("error",s),r(o),o.finalize(a=>{a&&s(a),o.removeListener("error",s)})}},zg=class n{static VSCODE_TRACE_STORAGE="VSCODE_TRACE_STORAGE";logTrace;logError;constructor(t){t&&typeof t.logTrace=="function"&&process.env[n.VSCODE_TRACE_STORAGE]&&(this.logTrace=t.logTrace),t&&typeof t.logError=="function"&&(this.logError=t.logError)}get isTracing(){return!!this.logTrace}trace(t){this.logTrace?.(t)}error(t){this.logError?.(t)}};var Oc=class n extends D{constructor(e,r){super();this.logService=e;this.fileService=r}static LOG_SLOW_CLOSE_THRESHOLD=2e3;_onDidChangeStorage=this._register(new S);onDidChangeStorage=this._onDidChangeStorage.event;_onDidCloseStorage=this._register(new S);onDidCloseStorage=this._onDidCloseStorage.event;_storage=this._register(new On(new Us,{hint:1}));get storage(){return this._storage}initializePromise=void 0;whenInitPromise=new ur;whenInit=this.whenInitPromise.p;state=0;isInMemory(){return this._storage.isInMemory()}init(){return this.initializePromise||(this.initializePromise=(async()=>{if(this.state===0)try{let e=this._register(await this.doCreate());this._storage.dispose(),this._storage=e,this._register(e.onDidChangeStorage(i=>this._onDidChangeStorage.fire(i))),await this.doInit(e);let r=e.getBoolean(vc);r===void 0?e.set(vc,!0):r&&e.set(vc,!1)}catch(e){this.logService.error(`[storage main] initialize(): Unable to init storage due to ${e}`)}finally{this.state=1,this.whenInitPromise.complete()}})()),this.initializePromise}createLoggingOptions(){return{logTrace:this.logService.getLevel()===1?e=>this.logService.trace(e):void 0,logError:e=>this.logService.error(e)}}doInit(e){return e.init()}get items(){return this._storage.items}get(e,r){return this._storage.get(e,r)}set(e,r){return this._storage.set(e,r)}delete(e){return this._storage.delete(e)}optimize(){return this._storage.optimize()}async close(){let e=new yr(!1);await this.doClose(),e.stop(),e.elapsed()>n.LOG_SLOW_CLOSE_THRESHOLD&&await this.logSlowClose(e),this._onDidCloseStorage.fire()}async logSlowClose(e){if(this.path)try{let r=sI(Array.from(this._storage.items.entries()).map(([o,s])=>({key:o,length:s.length})),(o,s)=>s.length-o.length,5).map(o=>`${o.key}:${o.length}`).join(", "),i=(await this.fileService.stat(x.file(this.path))).size;this.logService.warn(`[storage main] detected slow close() operation: Time: ${e.elapsed()}ms, DB size: ${i}b, Large Keys: ${r}`)}catch(r){this.logService.error("[storage main] figuring out stats for slow DB on close() resulted in an error",r)}}async doClose(){this.initializePromise&&await this.initializePromise,this.state=2,await this._storage.close()}},Np=class n extends Oc{constructor(e,r,i,o){super(i,o);this.profile=e;this.options=r}static STORAGE_NAME="state.vscdb";get path(){if(!this.options.useInMemoryStorage)return V(this.profile.globalStorageHome.with({scheme:L.file}).fsPath,n.STORAGE_NAME)}async doCreate(){return new On(new Vo(this.path??Vo.IN_MEMORY_PATH,{logging:this.createLoggingOptions()}),this.path?void 0:{hint:1})}},Bp=class extends Np{constructor(t,e,r,i){super(t,e,r,i)}},Vp=class extends Np{constructor(t,e,r,i){super(e.defaultProfile,t,r,i)}async doInit(t){await super.doInit(t),this.updateTelemetryState(t)}updateTelemetryState(t){t.get(Pg,void 0)===void 0&&t.set(Pg,new Date().toUTCString());let r=t.get(Eg,void 0),i=new Date().toUTCString();t.set(Gw,typeof r>"u"?null:r),t.set(Eg,i)}},Kp=class n extends Oc{constructor(e,r,i,o,s){super(i,s);this.workspace=e;this.options=r;this.environmentService=o}static WORKSPACE_STORAGE_NAME="state.vscdb";static WORKSPACE_META_NAME="workspace.json";get path(){if(!this.options.useInMemoryStorage)return V(this.environmentService.workspaceStorageHome.with({scheme:L.file}).fsPath,this.workspace.id,n.WORKSPACE_STORAGE_NAME)}async doCreate(){let{storageFilePath:e,wasCreated:r}=await this.prepareWorkspaceStorageFolder();return new On(new Vo(e,{logging:this.createLoggingOptions()}),{hint:this.options.useInMemoryStorage?1:r?0:void 0})}async prepareWorkspaceStorageFolder(){if(this.options.useInMemoryStorage)return{storageFilePath:Vo.IN_MEMORY_PATH,wasCreated:!0};let e=V(this.environmentService.workspaceStorageHome.with({scheme:L.file}).fsPath,this.workspace.id),r=V(e,n.WORKSPACE_STORAGE_NAME);return await q.exists(e)?{storageFilePath:r,wasCreated:!1}:(await WS.promises.mkdir(e,{recursive:!0}),this.ensureWorkspaceStorageFolderMeta(e),{storageFilePath:r,wasCreated:!0})}async ensureWorkspaceStorageFolderMeta(e){let r;if(pt(this.workspace)?r={folder:this.workspace.uri.toString()}:Be(this.workspace)&&(r={workspace:this.workspace.configPath.toString()}),r)try{let i=V(e,n.WORKSPACE_META_NAME);await q.exists(i)||await q.writeFile(i,JSON.stringify(r,void 0,2))}catch(i){this.logService.error(`[storage main] ensureWorkspaceStorageFolderMeta(): Unable to create workspace storage metadata due to ${i}`)}}},Fc=class extends Oc{get path(){}async doCreate(){return new On(new Us,{hint:1})}};var Bo=F("storageMainService"),pa=class extends D{constructor(e,r,i,o,s,a){super();this.logService=e;this.environmentService=r;this.userDataProfilesService=i;this.lifecycleMainService=o;this.fileService=s;this.uriIdentityService=a;this.registerListeners()}shutdownReason=void 0;_onDidChangeProfileStorage=this._register(new S);onDidChangeProfileStorage=this._onDidChangeProfileStorage.event;getStorageOptions(){return{useInMemoryStorage:!!this.environmentService.extensionTestsLocationURI}}registerListeners(){(async()=>(await this.lifecycleMainService.when(3),this.applicationStorage.init()))(),this._register(this.lifecycleMainService.onWillLoadWindow(e=>{e.window.profile&&this.profileStorage(e.window.profile).init(),e.workspace&&this.workspaceStorage(e.workspace).init()})),this._register(this.lifecycleMainService.onWillShutdown(e=>{this.logService.trace("storageMainService#onWillShutdown()"),this.shutdownReason=e.reason,e.join("applicationStorage",this.applicationStorage.close());for(let[,r]of this.mapProfileToStorage)e.join("profileStorage",r.close());for(let[,r]of this.mapWorkspaceToStorage)e.join("workspaceStorage",r.close())})),this._register(this.userDataProfilesService.onWillCreateProfile(e=>{e.join((async()=>{await this.fileService.exists(e.profile.globalStorageHome)||await this.fileService.createFolder(e.profile.globalStorageHome)})())})),this._register(this.userDataProfilesService.onWillRemoveProfile(e=>{let r=this.mapProfileToStorage.get(e.profile.id);r&&e.join(r.close())}))}applicationStorage=this._register(this.createApplicationStorage());createApplicationStorage(){this.logService.trace("StorageMainService: creating application storage");let e=new Vp(this.getStorageOptions(),this.userDataProfilesService,this.logService,this.fileService);return this._register(E.once(e.onDidCloseStorage)(()=>{this.logService.trace("StorageMainService: closed application storage")})),e}mapProfileToStorage=new Map;profileStorage(e){if(gc(e))return this.applicationStorage;let r=this.mapProfileToStorage.get(e.id);if(!r){this.logService.trace(`StorageMainService: creating profile storage (${e.name})`),r=this._register(this.createProfileStorage(e)),this.mapProfileToStorage.set(e.id,r);let i=this._register(r.onDidChangeStorage(o=>this._onDidChangeProfileStorage.fire({...o,storage:r,profile:e})));this._register(E.once(r.onDidCloseStorage)(()=>{this.logService.trace(`StorageMainService: closed profile storage (${e.name})`),this.mapProfileToStorage.delete(e.id),i.dispose()}))}return r}createProfileStorage(e){return this.shutdownReason===2?new Fc(this.logService,this.fileService):new Bp(e,this.getStorageOptions(),this.logService,this.fileService)}mapWorkspaceToStorage=new Map;workspaceStorage(e){let r=this.mapWorkspaceToStorage.get(e.id);return r||(this.logService.trace(`StorageMainService: creating workspace storage (${e.id})`),r=this._register(this.createWorkspaceStorage(e)),this.mapWorkspaceToStorage.set(e.id,r),this._register(E.once(r.onDidCloseStorage)(()=>{this.logService.trace(`StorageMainService: closed workspace storage (${e.id})`),this.mapWorkspaceToStorage.delete(e.id)}))),r}createWorkspaceStorage(e){return this.shutdownReason===2?new Fc(this.logService,this.fileService):new Kp(e,this.getStorageOptions(),this.logService,this.environmentService,this.fileService)}isUsed(e){let r=x.file(e);for(let i of[this.applicationStorage,...this.mapProfileToStorage.values(),...this.mapWorkspaceToStorage.values()])if(i.path&&this.uriIdentityService.extUri.isEqualOrParent(x.file(i.path),r))return!0;return!1}};pa=P([g(0,A),g(1,dr),g(2,rr),g(3,oe),g(4,Pe),g(5,ut)],pa);var $i=F("applicationStorageMainService"),fa=class extends $s{constructor(e,r){super();this.userDataProfilesService=e;this.storageMainService=r}whenReady=this.storageMainService.applicationStorage.whenInit;doInitialize(){return this.storageMainService.applicationStorage.whenInit}getStorage(e){if(e===-1)return this.storageMainService.applicationStorage.storage}getLogDetails(e){if(e===-1)return this.userDataProfilesService.defaultProfile.globalStorageHome.with({scheme:L.file}).fsPath}shouldFlushWhenIdle(){return!1}switch(){throw new Error("Migrating storage is unsupported from main process")}switchToProfile(){throw new Error("Switching storage profile is unsupported from main process")}switchToWorkspace(){throw new Error("Switching storage workspace is unsupported from main process")}hasScope(){throw new Error("Main process is never profile or workspace scoped")}};fa=P([g(0,jt),g(1,Bo)],fa);var Mc=F("proxyAuthService"),ma=class extends D{constructor(e,r,i,o,s,a){super();this.logService=e;this.windowsMainService=r;this.encryptionMainService=i;this.applicationStorageMainService=o;this.configurationService=s;this.environmentMainService=a;this.registerListeners()}PROXY_CREDENTIALS_SERVICE_KEY="proxy-credentials://";pendingProxyResolves=new Map;currentDialog=void 0;cancelledAuthInfoHashes=new Set;sessionCredentials=new Map;registerListeners(){let e=E.fromNodeEventEmitter(IC,"login",(r,i,o,s,a)=>({event:r,authInfo:{...s,attempt:o.firstAuthAttempt?1:2},callback:a}));this._register(e(this.onLogin,this))}async lookupAuthorization(e){return this.onLogin({authInfo:e})}async onLogin({event:e,authInfo:r,callback:i}){if(!r.isProxy)return;e?.preventDefault();let o=String(qt({scheme:r.scheme,host:r.host,port:r.port})),s,a=this.pendingProxyResolves.get(o);if(a)this.logService.trace("auth#onLogin (proxy) - pending proxy handling found"),s=await a;else{this.logService.trace("auth#onLogin (proxy) - no pending proxy handling found, starting new"),a=this.resolveProxyCredentials(r,o),this.pendingProxyResolves.set(o,a);try{s=await a}finally{this.pendingProxyResolves.delete(o)}}return i?.(s?.username,s?.password),s}async resolveProxyCredentials(e,r){this.logService.trace("auth#resolveProxyCredentials (proxy) - enter");try{let i=await this.doResolveProxyCredentials(e,r);if(i)return this.logService.trace("auth#resolveProxyCredentials (proxy) - got credentials"),i;this.logService.trace("auth#resolveProxyCredentials (proxy) - did not get credentials")}finally{this.logService.trace("auth#resolveProxyCredentials (proxy) - exit")}}async doResolveProxyCredentials(e,r){if(this.logService.trace("auth#doResolveProxyCredentials - enter",e),this.environmentMainService.extensionTestsLocationURI){let d=this.configurationService.getValue("integration-test.http.proxyAuth");if(d){let u=d.indexOf(":");return u!==-1?{username:d.substring(0,u),password:d.substring(u+1)}:{username:d,password:""}}return}let i=(this.configurationService.getValue("http.proxy")||"").trim()||(process.env.https_proxy||process.env.HTTPS_PROXY||process.env.http_proxy||process.env.HTTP_PROXY||"").trim()||void 0;if(i?.indexOf("@")!==-1){let d=x.parse(i),u=d.authority.indexOf("@");if(u!==-1){if(e.attempt>1){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - ignoring previously used config/envvar credentials");return}this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found config/envvar credentials to use");let m=d.authority.substring(0,u),h=m.indexOf(":");return h!==-1?{username:m.substring(0,h),password:m.substring(h+1)}:{username:m,password:""}}}let o=e.attempt===1&&this.sessionCredentials.get(r);if(o){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found session credentials to use");let{username:d,password:u}=o;return{username:d,password:u}}let s,a;try{let d=this.applicationStorageMainService.get(this.PROXY_CREDENTIALS_SERVICE_KEY+r,-1);if(d){let u=JSON.parse(await this.encryptionMainService.decrypt(d));s=u.username,a=u.password}}catch(d){this.logService.error(d)}if(e.attempt===1&&typeof s=="string"&&typeof a=="string")return this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - found stored credentials to use"),this.sessionCredentials.set(r,{username:s,password:a}),{username:s,password:a};let l=this.currentDialog,c=this.currentDialog=(async()=>{await l;let d=await this.showProxyCredentialsDialog(e,r,s,a);return this.currentDialog===c&&(this.currentDialog=void 0),d})();return c}async showProxyCredentialsDialog(e,r,i,o){if(this.cancelledAuthInfoHashes.has(r)){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - login dialog was cancelled before, not showing again");return}let s=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(!s){this.logService.trace("auth#doResolveProxyCredentials (proxy) - exit - no opened window found to show dialog in");return}this.logService.trace(`auth#doResolveProxyCredentials (proxy) - asking window ${s.id} to handle proxy login`);let a=this.sessionCredentials.get(r),l={authInfo:e,username:a?.username??i,password:a?.password??o,replyChannel:`vscode:proxyAuthResponse:${Ze()}`};s.sendWhenReady("vscode:openProxyAuthenticationDialog",we.None,l);let c=await new Promise(d=>{let u=async(m,h,y)=>{if(h===l.replyChannel)if(this.logService.trace(`auth#doResolveProxyCredentials - exit - received credentials from window ${s.id}`),s.win?.webContents.off("ipc-message",u),y){let v={username:y.username,password:y.password};try{if(y.remember){let b=await this.encryptionMainService.encrypt(JSON.stringify(v));this.applicationStorageMainService.store(this.PROXY_CREDENTIALS_SERVICE_KEY+r,b,-1,1)}else this.applicationStorageMainService.remove(this.PROXY_CREDENTIALS_SERVICE_KEY+r,-1)}catch(b){this.logService.error(b)}d({username:v.username,password:v.password})}else this.cancelledAuthInfoHashes.add(r),d(void 0)};s.win?.webContents.on("ipc-message",u)});return this.sessionCredentials.set(r,c),c}};ma=P([g(0,A),g(1,Fe),g(2,Zl),g(3,$i),g(4,ce),g(5,ge)],ma);import{createHash as wC}from"crypto";var fi=class{constructor(t,e,r,i){this.environmentMainService=t;this.configurationService=e;this.logService=r;this.stateService=i}static backupWorkspacesMetadataStorageKey="backupWorkspaces";backupHome=this.environmentMainService.backupHome;workspaces=[];folders=[];emptyWindows=[];backupUriComparer=Le;backupPathComparer={isEqual:(t,e)=>So(t,e,!Q)};async initialize(){let t=this.stateService.getItem(fi.backupWorkspacesMetadataStorageKey)??{workspaces:[],folders:[],emptyWindows:[]};this.emptyWindows=await this.validateEmptyWorkspaces(t.emptyWindows),this.workspaces=await this.validateWorkspaces($w(t)),this.folders=await this.validateFolders(jw(t)),this.storeWorkspacesMetadata()}getWorkspaceBackups(){return this.isHotExitOnExitAndWindowClose()?[]:this.workspaces.slice(0)}getFolderBackups(){return this.isHotExitOnExitAndWindowClose()?[]:this.folders.slice(0)}isHotExitEnabled(){return this.getHotExitConfig()!==rp.OFF}isHotExitOnExitAndWindowClose(){return this.getHotExitConfig()===rp.ON_EXIT_AND_WINDOW_CLOSE}getHotExitConfig(){return this.configurationService.getValue()?.files?.hotExit||rp.ON_EXIT}getEmptyWindowBackups(){return this.emptyWindows.slice(0)}registerWorkspaceBackup(t,e){this.workspaces.some(i=>t.workspace.id===i.workspace.id)||(this.workspaces.push(t),this.storeWorkspacesMetadata());let r=V(this.backupHome,t.workspace.id);return e?this.moveBackupFolder(r,e).then(()=>r):r}async moveBackupFolder(t,e){if(await q.exists(t)&&await this.convertToEmptyWindowBackup(t),await q.exists(e))try{await q.rename(e,t,!1)}catch(r){this.logService.error(`Backup: Could not move backup folder to new location: ${r.toString()}`)}}registerFolderBackup(t){return this.folders.some(e=>this.backupUriComparer.isEqual(t.folderUri,e.folderUri))||(this.folders.push(t),this.storeWorkspacesMetadata()),V(this.backupHome,this.getFolderHash(t))}registerEmptyWindowBackup(t){return this.emptyWindows.some(e=>!!e.backupFolder&&this.backupPathComparer.isEqual(e.backupFolder,t.backupFolder))||(this.emptyWindows.push(t),this.storeWorkspacesMetadata()),V(this.backupHome,t.backupFolder)}async validateWorkspaces(t){if(!Array.isArray(t))return[];let e=new Set,r=[];for(let i of t){let o=i.workspace;if(!Be(o))return[];if(!e.has(o.id)){e.add(o.id);let s=V(this.backupHome,o.id);await this.doHasBackups(s)?o.configPath.scheme!==L.file||await q.exists(o.configPath.fsPath)?r.push(i):await this.convertToEmptyWindowBackup(s):await this.deleteStaleBackup(s)}}return r}async validateFolders(t){if(!Array.isArray(t))return[];let e=[],r=new Set;for(let i of t){let o=i.folderUri,s=this.backupUriComparer.getComparisonKey(o);if(!r.has(s)){r.add(s);let a=V(this.backupHome,this.getFolderHash(i));await this.doHasBackups(a)?o.scheme!==L.file||await q.exists(o.fsPath)?e.push(i):await this.convertToEmptyWindowBackup(a):await this.deleteStaleBackup(a)}}return e}async validateEmptyWorkspaces(t){if(!Array.isArray(t))return[];let e=[],r=new Set;for(let i of t){let o=i.backupFolder;if(typeof o!="string")return[];if(!r.has(o)){r.add(o);let s=V(this.backupHome,o);await this.doHasBackups(s)?e.push(i):await this.deleteStaleBackup(s)}}return e}async deleteStaleBackup(t){try{await q.rm(t,1)}catch(e){this.logService.error(`Backup: Could not delete stale backup: ${e.toString()}`)}}prepareNewEmptyWindowBackup(){let t=Rc();for(;this.emptyWindows.some(e=>!!e.backupFolder&&this.backupPathComparer.isEqual(e.backupFolder,t.id));)t=Rc();return{backupFolder:t.id}}async convertToEmptyWindowBackup(t){let e=this.prepareNewEmptyWindowBackup(),r=V(this.backupHome,e.backupFolder);try{await q.rename(t,r,!1)}catch(i){return this.logService.error(`Backup: Could not rename backup folder: ${i.toString()}`),!1}return this.emptyWindows.push(e),!0}async getDirtyWorkspaces(){let t=[];for(let e of this.workspaces)await this.hasBackups(e)&&t.push(e);for(let e of this.folders)await this.hasBackups(e)&&t.push(e);return t}hasBackups(t){let e;return qw(t)?e=V(this.backupHome,t.backupFolder):zw(t)?e=V(this.backupHome,this.getFolderHash(t)):e=V(this.backupHome,t.workspace.id),this.doHasBackups(e)}async doHasBackups(t){try{let e=await q.readdir(t);for(let r of e)try{if((await q.readdir(V(t,r))).length>0)return!0}catch{}}catch{}return!1}storeWorkspacesMetadata(){let t={workspaces:this.workspaces.map(({workspace:e,remoteAuthority:r})=>{let i={id:e.id,configURIPath:e.configPath.toString()};return r&&(i.remoteAuthority=r),i}),folders:this.folders.map(({folderUri:e,remoteAuthority:r})=>{let i={folderUri:e.toString()};return r&&(i.remoteAuthority=r),i}),emptyWindows:this.emptyWindows.map(({backupFolder:e,remoteAuthority:r})=>{let i={backupFolder:e};return r&&(i.remoteAuthority=r),i})};this.stateService.setItem(fi.backupWorkspacesMetadataStorageKey,t)}getFolderHash(t){let e=t.folderUri,r;return e.scheme===L.file?r=Q?e.fsPath:e.fsPath.toLowerCase():r=e.toString().toLowerCase(),wC("md5").update(r).digest("hex")}};fi=P([g(0,ge),g(1,ce),g(2,A),g(3,et)],fi);import{createServer as SC}from"net";var Cee=F("extensionHostDebugService");var Hp=class{static ChannelName="extensionhostdebugservice";_onCloseEmitter=new S;_onReloadEmitter=new S;_onTerminateEmitter=new S;_onAttachEmitter=new S;call(t,e,r){switch(e){case"close":return Promise.resolve(this._onCloseEmitter.fire({sessionId:r[0]}));case"reload":return Promise.resolve(this._onReloadEmitter.fire({sessionId:r[0]}));case"terminate":return Promise.resolve(this._onTerminateEmitter.fire({sessionId:r[0]}));case"attach":return Promise.resolve(this._onAttachEmitter.fire({sessionId:r[0],port:r[1],subId:r[2]}))}throw new Error("Method not implemented.")}listen(t,e,r){switch(e){case"close":return this._onCloseEmitter.event;case"reload":return this._onReloadEmitter.event;case"terminate":return this._onTerminateEmitter.event;case"attach":return this._onAttachEmitter.event}throw new Error("Method not implemented.")}};var zp=class extends Hp{constructor(e){super();this.windowsMainService=e}call(e,r,i){return r==="openExtensionDevelopmentHostWindow"?this.openExtensionDevelopmentHostWindow(i[0],i[1]):super.call(e,r,i)}async openExtensionDevelopmentHostWindow(e,r){let i=xc(e,xp);i.debugRenderer=r;let o=i.extensionDevelopmentPath;if(!o)return{success:!1};let[s]=await this.windowsMainService.openExtensionDevelopmentHostWindow(o,{context:5,cli:i,forceProfile:i.profile,forceTempProfile:i["profile-temp"]});if(!r)return{success:!0};let a=s.win;if(!a)return{success:!0};let l=a.webContents.debugger,c=l.isAttached()?1/0:0,d=SC(u=>{c++===0&&l.attach();let m=!1,h=b=>{m||u.write(JSON.stringify(b)+"\0")},y=(b,C,k,_)=>h({method:C,params:k,sessionId:_});a.on("close",()=>{l.removeListener("message",y),u.end(),m=!0}),l.addListener("message",y);let v=Buffer.alloc(0);u.on("data",b=>{v=Buffer.concat([v,b]);for(let C=v.indexOf(0);C!==-1;C=v.indexOf(0)){let k;try{let _=v.slice(0,C).toString("utf8");v=v.slice(C+1),k=JSON.parse(_)}catch(_){console.error("error reading cdp line",_)}l.sendCommand(k.method,k.params,k.sessionId).then(_=>h({id:k.id,sessionId:k.sessionId,result:_})).catch(_=>h({id:k.id,sessionId:k.sessionId,error:{code:0,message:_.message}}))}}),u.on("error",b=>{console.error("error on cdp pipe:",b)}),u.on("close",()=>{m=!0,--c===0&&l.detach()})});return await new Promise(u=>d.listen(0,u)),a.on("close",()=>d.close()),{rendererDebugPort:d.address().port,success:!0}}};function US(n,...t){let e=t.reduce((o,s)=>(o[s]=!0,o),{}),r=[/^ELECTRON_.+$/,/^VSCODE_(?!(PORTABLE|SHELL_LOGIN|ENV_REPLACE|ENV_APPEND|ENV_PREPEND)).+$/,/^SNAP(|_.*)$/,/^GDK_PIXBUF_.+$/];Object.keys(n).filter(o=>!e[o]).forEach(o=>{for(let s=0;s<r.length;s++)if(o.search(r[s])!==-1){delete n[o];break}})}function qp(n){n&&(delete n.DEBUG,Q&&delete n.LD_PRELOAD)}var xC="diagnosticsService",$p=F(xC);function Ac(n){return!!n.hostName&&!!n.errorMessage}import{app as BS,BrowserWindow as kC}from"electron";import{MessageChannelMain as EC,app as PC,utilityProcess as TC}from"electron";import{StringDecoder as NS}from"string_decoder";function CC(n){return typeof n.responseWindowId=="number"}var At=class extends D{constructor(e,r,i){super();this.logService=e;this.telemetryService=r;this.lifecycleMainService=i}static ID_COUNTER=0;static all=new Map;static getAll(){return Array.from(At.all.values())}id=String(++At.ID_COUNTER);_onStdout=this._register(new S);onStdout=this._onStdout.event;_onStderr=this._register(new S);onStderr=this._onStderr.event;_onMessage=this._register(new S);onMessage=this._onMessage.event;_onSpawn=this._register(new S);onSpawn=this._onSpawn.event;_onExit=this._register(new S);onExit=this._onExit.event;_onCrash=this._register(new S);onCrash=this._onCrash.event;process=void 0;processPid=void 0;configuration=void 0;killed=!1;log(e,r){let i;switch(this.configuration?.correlationId?i=`[UtilityProcess id: ${this.configuration?.correlationId}, type: ${this.configuration?.type}, pid: ${this.processPid??"<none>"}]: ${e}`:i=`[UtilityProcess type: ${this.configuration?.type}, pid: ${this.processPid??"<none>"}]: ${e}`,r){case Te.Error:this.logService.error(i);break;case Te.Warning:this.logService.warn(i);break;case Te.Info:this.logService.trace(i);break}}validateCanStart(){return this.process?(this.log("Cannot start utility process because it is already running...",Te.Error),!1):!0}start(e){let r=this.doStart(e);return r&&e.payload&&this.postMessage(e.payload)&&this.log("payload sent via postMessage()",Te.Info),r}doStart(e){if(!this.validateCanStart())return!1;this.configuration=e;let r=`${this.configuration.type}-${this.id}`,i=Re.asFileUri("bootstrap-fork.js").fsPath,o=this.configuration.args??[],s=this.configuration.execArgv??[],a=this.configuration.allowLoadingUnsignedLibraries,l=this.configuration.forceAllocationsToV8Sandbox,c=this.configuration.respondToAuthRequestsFromMainProcess,d="pipe",u=this.createEnv(e);return this.log("creating new...",Te.Info),this.process=TC.fork(i,o,{serviceName:r,env:u,execArgv:s,allowLoadingUnsignedLibraries:a,forceAllocationsToV8Sandbox:l,respondToAuthRequestsFromMainProcess:c,stdio:d}),this.registerListeners(this.process,this.configuration,r),!0}createEnv(e){let r=e.env?{...e.env}:{...er(process.env)};r.VSCODE_AMD_ENTRYPOINT=e.entryPoint,typeof e.parentLifecycleBound=="number"&&(r.VSCODE_PARENT_PID=String(e.parentLifecycleBound)),r.VSCODE_CRASH_REPORTER_PROCESS_TYPE=e.type,U&&(Sb()?r.NODE_DISABLE_UNC_ACCESS_CHECKS="1":r.NODE_UNC_HOST_ALLOWLIST=bb().join("\\")),qp(r);for(let i of Object.keys(r))r[i]=String(r[i]);return r}registerListeners(e,r,i){if(e.stdout){let o=new NS("utf-8");this._register(E.fromNodeEventEmitter(e.stdout,"data")(s=>this._onStdout.fire(typeof s=="string"?s:o.write(s))))}if(e.stderr){let o=new NS("utf-8");this._register(E.fromNodeEventEmitter(e.stderr,"data")(s=>this._onStderr.fire(typeof s=="string"?s:o.write(s))))}this._register(E.fromNodeEventEmitter(e,"message")(o=>this._onMessage.fire(o))),this._register(E.fromNodeEventEmitter(e,"spawn")(()=>{this.processPid=e.pid,typeof e.pid=="number"&&At.all.set(e.pid,{pid:e.pid,name:CC(r)?`${r.type} [${r.responseWindowId}]`:r.type}),this.log("successfully created",Te.Info),this._onSpawn.fire(e.pid)})),this._register(E.fromNodeEventEmitter(e,"exit")(o=>{let s=this.isNormalExit(o)?0:o;this.log(`received exit event with code ${s}`,Te.Info),this._onExit.fire({pid:this.processPid,code:s,signal:"unknown"}),this.onDidExitOrCrashOrKill()})),this._register(E.fromNodeEventEmitter(PC,"child-process-gone",(o,s)=>({event:o,details:s}))(({details:o})=>{o.type==="Utility"&&o.name===i&&!this.isNormalExit(o.exitCode)&&(this.log(`crashed with code ${o.exitCode} and reason '${o.reason}'`,Te.Error),this.telemetryService.publicLog2("utilityprocesscrash",{type:r.type,reason:o.reason,code:o.exitCode}),this._onCrash.fire({pid:this.processPid,code:o.exitCode,reason:o.reason}),this.onDidExitOrCrashOrKill())}))}once(e,r){let i=this._register(this._onMessage.event(o=>{o===e&&(i.dispose(),r())}))}postMessage(e,r){return this.process?(this.process.postMessage(e,r),!0):!1}connect(e){let{port1:r,port2:i}=new EC;return this.postMessage(e,[i]),r}enableInspectPort(){if(!this.process||typeof this.processPid!="number")return!1;this.log("enabling inspect port",Te.Info);let e=process;return typeof e._debugProcess=="function"?(e._debugProcess(this.processPid),!0):!1}kill(){if(!this.process)return;this.log("attempting to kill the process...",Te.Info),this.process.kill()?(this.log("successfully killed the process",Te.Info),this.killed=!0,this.onDidExitOrCrashOrKill()):this.log("unable to kill the process",Te.Warning)}isNormalExit(e){return e===0?!0:this.killed&&e===15}onDidExitOrCrashOrKill(){typeof this.processPid=="number"&&At.all.delete(this.processPid),this.process=void 0}async waitForExit(e){this.process&&(this.log("waiting to exit...",Te.Info),await Promise.race([E.toPromise(this.onExit),nt(e)]),this.process&&(this.log(`did not exit within ${e}ms, will kill it now...`,Te.Info),this.kill()))}};At=P([g(0,A),g(1,Ve),g(2,oe)],At);var ji=class extends At{constructor(e,r,i,o){super(e,i,o);this.windowsMainService=r}start(e){let r=this.windowsMainService.getWindowById(e.responseWindowId);if(!r?.win||r.win.isDestroyed()||r.win.webContents.isDestroyed())return this.log("Refusing to start utility process because requesting window cannot be found or is destroyed...",Te.Error),!0;if(!super.doStart(e))return!1;this.registerWindowListeners(r.win,e);let o=this.connect(e.payload);return r.win.webContents.postMessage(e.responseChannel,e.responseNonce,[o]),!0}registerWindowListeners(e,r){r.windowLifecycleBound&&(this._register(E.filter(this.lifecycleMainService.onWillLoadWindow,i=>i.window.win===e)(()=>this.kill())),this._register(E.fromNodeEventEmitter(e,"closed")(()=>this.kill())))}};ji=P([g(0,A),g(1,Fe),g(2,Ve),g(3,oe)],ji);var _C="diagnosticsMainService",Wc=F(_C),ha=class{constructor(t,e,r){this.windowsMainService=t;this.workspacesManagementMainService=e;this.logService=r}async getRemoteDiagnostics(t){let e=this.windowsMainService.getWindows();return(await Promise.all(e.map(async i=>{let o=i.remoteAuthority;if(!o)return;let s=`vscode:getDiagnosticInfoResponse${i.id}`,a={includeProcesses:t.includeProcesses,folders:t.includeWorkspaceMetadata?await this.getFolderURIs(i):void 0};return new Promise(l=>{i.sendWhenReady("vscode:getDiagnosticInfo",we.None,{replyChannel:s,args:a}),_e.once(s,(c,d)=>{d||l({hostName:o,errorMessage:`Unable to resolve connection to '${o}'.`}),l(d)}),setTimeout(()=>{l({hostName:o,errorMessage:`Connection to '${o}' could not be established`})},5e3)})}))).filter(i=>!!i)}async getMainDiagnostics(){this.logService.trace("Received request for main process info from other instance.");let t=[];for(let r of kC.getAllWindows()){let i=this.windowsMainService.getWindowById(r.id);i?t.push(await this.codeWindowToInfo(i)):t.push(this.browserWindowToInfo(r))}let e=[];for(let{pid:r,name:i}of At.getAll())e.push({pid:r,name:i});return{mainPID:process.pid,mainArguments:process.argv.slice(1),windows:t,pidToNames:e,screenReader:!!BS.accessibilitySupportEnabled,gpuFeatureStatus:BS.getGPUFeatureStatus()}}async codeWindowToInfo(t){let e=await this.getFolderURIs(t),r=Zn(t.win);return this.browserWindowToInfo(r,e,t.remoteAuthority)}browserWindowToInfo(t,e=[],r){return{id:t.id,pid:t.webContents.getOSProcessId(),title:t.getTitle(),folderURIs:e,remoteAuthority:r}}async getFolderURIs(t){let e=[],r=t.openedWorkspace;if(pt(r))e.push(r.uri);else if(Be(r)){let i=await this.workspacesManagementMainService.resolveLocalWorkspace(r.configPath);i&&i.folders.forEach(s=>{e.push(s.uri)})}return e}};ha=P([g(0,Fe),g(1,Tr),g(2,A)],ha);import{safeStorage as RC,app as DC}from"electron";var Gi=RC,ga=class{constructor(t){this.logService=t;DC.commandLine.getSwitchValue("password-store")==="basic"&&(this.logService.trace("[EncryptionMainService] setting usePlainTextEncryption to true..."),Gi.setUsePlainTextEncryption?.(!0),this.logService.trace("[EncryptionMainService] set usePlainTextEncryption to true"))}_serviceBrand;async encrypt(t){this.logService.trace("[EncryptionMainService] Encrypting value...");try{let e=JSON.stringify(Gi.encryptString(t));return this.logService.trace("[EncryptionMainService] Encrypted value."),e}catch(e){throw this.logService.error(e),e}}async decrypt(t){let e;try{if(e=JSON.parse(t),!e.data)throw new Error(`[EncryptionMainService] Invalid encrypted value: ${t}`);let r=Buffer.from(e.data);this.logService.trace("[EncryptionMainService] Decrypting value...");let i=Gi.decryptString(r);return this.logService.trace("[EncryptionMainService] Decrypted value."),i}catch(r){throw this.logService.error(r),r}}isEncryptionAvailable(){this.logService.trace("[EncryptionMainService] Checking if encryption is available...");let t=Gi.isEncryptionAvailable();return this.logService.trace("[EncryptionMainService] Encryption is available: ",t),Promise.resolve(t)}getKeyStorageProvider(){if(U)return Promise.resolve("dpapi");if(W)return Promise.resolve("keychain_access");if(Gi.getSelectedStorageBackend)try{this.logService.trace("[EncryptionMainService] Getting selected storage backend...");let t=Gi.getSelectedStorageBackend();return this.logService.trace("[EncryptionMainService] Selected storage backend: ",t),Promise.resolve(t)}catch(t){this.logService.error(t)}return Promise.resolve("unknown")}async setUsePlainTextEncryption(){if(U)throw new Error("Setting plain text encryption is not supported on Windows.");if(W)throw new Error("Setting plain text encryption is not supported on macOS.");if(!Gi.setUsePlainTextEncryption)throw new Error("Setting plain text encryption is not supported.");this.logService.trace("[EncryptionMainService] Setting usePlainTextEncryption to true..."),Gi.setUsePlainTextEncryption(!0),this.logService.trace("[EncryptionMainService] Set usePlainTextEncryption to true")}};ga=P([g(0,A)],ga);import{spawn as VC}from"child_process";import{userInfo as UC}from"os";import*as HS from"os";var VS=/^\d+$/,OC=/^Microsoft.PowerShell_.*/,FC=/^Microsoft.PowerShellPreview_.*/;var Uc;switch(process.arch){case"ia32":Uc=1;break;case"arm":case"arm64":Uc=2;break;default:Uc=0;break}var va;process.env.PROCESSOR_ARCHITEW6432?va=process.env.PROCESSOR_ARCHITEW6432==="ARM64"?2:0:process.env.PROCESSOR_ARCHITECTURE==="ARM64"?va=2:process.env.PROCESSOR_ARCHITECTURE==="X86"?va=1:va=0;var ya=class{constructor(t,e,r){this.exePath=t;this.displayName=e;this.knownToExist=r}async exists(){return this.knownToExist===void 0&&(this.knownToExist=await Pt.existsFile(this.exePath)),this.knownToExist}};function LC({useAlternateBitness:n=!1}={}){return n?Uc===0?process.env["ProgramFiles(x86)"]||null:va===0&&process.env.ProgramW6432||null:process.env.ProgramFiles||null}async function jp({useAlternateBitness:n=!1,findPreview:t=!1}={}){let e=LC({useAlternateBitness:n});if(!e)return null;let r=V(e,"PowerShell");if(!await Pt.existsDirectory(r))return null;let i=-1,o=null;for(let l of await q.readdir(r)){let c=-1;if(t){let u=l.indexOf("-");if(u<0)continue;let m=l.substring(0,u);if(!VS.test(m)||l.substring(u+1)!=="preview")continue;c=parseInt(m,10)}else{if(!VS.test(l))continue;c=parseInt(l,10)}if(c<=i)continue;let d=V(r,l,"pwsh.exe");await Pt.existsFile(d)&&(o=d,i=c)}if(!o)return null;let s=e.includes("x86")?" (x86)":"",a=t?" Preview":"";return new ya(o,`PowerShell${a}${s}`,!0)}async function KS({findPreview:n}={}){if(!process.env.LOCALAPPDATA)return null;let t=V(process.env.LOCALAPPDATA,"Microsoft","WindowsApps");if(!await Pt.existsDirectory(t))return null;let{pwshMsixDirRegex:e,pwshMsixName:r}=n?{pwshMsixDirRegex:FC,pwshMsixName:"PowerShell Preview (Store)"}:{pwshMsixDirRegex:OC,pwshMsixName:"PowerShell (Store)"};for(let i of await q.readdir(t))if(e.test(i)){let o=V(t,i,"pwsh.exe");return new ya(o,r)}return null}function MC(){let n=V(HS.homedir(),".dotnet","tools","pwsh.exe");return new ya(n,".NET Core PowerShell Global Tool")}function AC(){let n=V(process.env.windir,Uc===1&&va!==1?"SysNative":"System32","WindowsPowerShell","v1.0","powershell.exe");return new ya(n,"Windows PowerShell",!0)}async function*WC(){let n=await jp();n&&(yield n),n=await jp({useAlternateBitness:!0}),n&&(yield n),n=await KS(),n&&(yield n),n=MC(),n&&(yield n),n=await jp({findPreview:!0}),n&&(yield n),n=await KS({findPreview:!0}),n&&(yield n),n=await jp({useAlternateBitness:!0,findPreview:!0}),n&&(yield n),n=AC(),n&&(yield n)}async function*qg(){for await(let n of WC())await n.exists()&&(yield n)}async function zS(){for await(let n of qg())return n;return null}import{promises as qS}from"fs";function Gp(n=_t){return n.comspec||"cmd.exe"}function $S(n){let t=[],e=!1,r=function(i){if(e){t.push(i);return}(!n.send(i,s=>{if(s&&console.error(s),e=!1,t.length>0){let a=t.slice(0);t=[],a.forEach(l=>r(l))}})||U)&&(e=!0)};return{send:r}}var $g;(t=>{async function n(e,r,i){if(Lr(e))return e;if(r===void 0&&(r=ar()),Ne(e)!==".")return V(r,e);if(i===void 0&&ke(_t.PATH)&&(i=_t.PATH.split(cs)),i===void 0||i.length===0)return V(r,e);async function s(a){if(await q.exists(a)){let l;try{l=await qS.stat(a)}catch(c){c.message.startsWith("EACCES")&&(l=await qS.lstat(a))}return l?!l.isDirectory():!1}return!1}for(let a of i){let l;if(Lr(a)?l=V(a,e):l=V(r,a,e),await s(l))return l;let c=l+".com";if(await s(c)||(c=l+".exe",await s(c)))return c}return V(r,e)}t.findExecutable=n})($g||={});async function Jp(n,t){return n===1?U?BC():Gp(t):NC(n,t)}var jg=null;function NC(n,t){if(Q&&n===2||W&&n===3)return"/bin/bash";if(!jg){let e;if(U)e="/bin/bash";else{if(e=t.SHELL,!e)try{e=UC().shell}catch{}e||(e="sh"),e==="/bin/false"&&(e="/bin/bash")}jg=e}return jg}var Gg=null;async function BC(){return Gg||(Gg=(await zS()).exePath),Gg}function GS(n,t,e){return Math.min(Math.max(n,t),e)}var Jg;async function Ia(n,t,e,r){return e["force-disable-user-env"]?(t.trace("resolveShellEnv(): skipped (--force-disable-user-env)"),{}):U?(t.trace("resolveShellEnv(): skipped (Windows)"),{}):mn(r)&&!e["force-user-env"]?(t.trace("resolveShellEnv(): skipped (VSCODE_CLI is set)"),{}):(mn(r)?t.trace("resolveShellEnv(): running (--force-user-env)"):t.trace("resolveShellEnv(): running (macOS/Linux)"),Jg||(Jg=Xe.withAsyncBody(async(i,o)=>{let s=new rt,a=1e4,l=n.getValue("application.shellEnvironmentResolutionTimeout");typeof l=="number"&&(a=GS(l,1,120)*1e3);let c=setTimeout(()=>{s.dispose(!0),o(new Error(p("resolveShellEnvTimeout","Unable to resolve your shell environment in a reasonable time. Please review your shell configuration and restart.")))},a);try{i(await KC(t,s.token))}catch(d){!Td(d)&&!s.token.isCancellationRequested?o(new Error(p("resolveShellEnvError","Unable to resolve your shell environment: {0}",zt(d)))):i({})}finally{clearTimeout(c),s.dispose()}})),Jg)}async function KC(n,t){let e=process.env.ELECTRON_RUN_AS_NODE;n.trace("getUnixShellEnvironment#runAsNode",e);let r=process.env.ELECTRON_NO_ATTACH_CONSOLE;n.trace("getUnixShellEnvironment#noAttach",r);let i=Ze().replace(/-/g,"").substr(0,12),o=new RegExp(i+"({.*})"+i),s={...process.env,ELECTRON_RUN_AS_NODE:"1",ELECTRON_NO_ATTACH_CONSOLE:"1",VSCODE_RESOLVING_ENVIRONMENT:"1"};n.trace("getUnixShellEnvironment#env",s);let a=await Jp(xt,s);return n.trace("getUnixShellEnvironment#shell",a),new Promise((l,c)=>{if(t.isCancellationRequested)return c(new at);let d=pe(a),u,m,h="";/^pwsh(-preview)?$/.test(d)?(u=`& '${process.execPath}' ${h} -p '''${i}'' + JSON.stringify(process.env) + ''${i}'''`,m=["-Login","-Command"]):d==="nu"?(u=`^'${process.execPath}' ${h} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,m=["-i","-l","-c"]):d==="xonsh"?(u=`import os, json; print("${i}", json.dumps(dict(os.environ)), "${i}")`,m=["-i","-l","-c"]):(u=`'${process.execPath}' ${h} -p '"${i}" + JSON.stringify(process.env) + "${i}"'`,d==="tcsh"||d==="csh"?m=["-ic"]:m=["-i","-l","-c"]),n.trace("getUnixShellEnvironment#spawn",JSON.stringify(m),u);let y=VC(a,[...m,u],{detached:!0,stdio:["ignore","pipe","pipe"],env:s});t.onCancellationRequested(()=>(y.kill(),c(new at))),y.on("error",C=>{n.error("getUnixShellEnvironment#errorChildProcess",zt(C)),c(C)});let v=[];y.stdout.on("data",C=>v.push(C));let b=[];y.stderr.on("data",C=>b.push(C)),y.on("close",(C,k)=>{let _=Buffer.concat(v).toString("utf8");n.trace("getUnixShellEnvironment#raw",_);let T=Buffer.concat(b).toString("utf8");if(T.trim()&&n.trace("getUnixShellEnvironment#stderr",T),C||k)return c(new Error(p("resolveShellEnvExitError","Unexpected exit code from spawned shell (code {0}, signal {1})",C,k)));let N=o.exec(_),J=N?N[1]:"{}";try{let H=JSON.parse(J);e?H.ELECTRON_RUN_AS_NODE=e:delete H.ELECTRON_RUN_AS_NODE,r?H.ELECTRON_NO_ATTACH_CONSOLE=r:delete H.ELECTRON_NO_ATTACH_CONSOLE,delete H.VSCODE_RESOLVING_ENVIRONMENT,delete H.XDG_RUNTIME_DIR,n.trace("getUnixShellEnvironment#result",H),l(H)}catch(H){n.error("getUnixShellEnvironment#errorCaught",zt(H)),c(H)}})})}var Qg=F("extensionHostStarter"),JS="extensionHostStarter";var Ji=class extends D{constructor(e,r,i,o){super();this._logService=e;this._lifecycleMainService=r;this._windowsMainService=i;this._telemetryService=o;this._register(this._lifecycleMainService.onWillShutdown(s=>{this._shutdown=!0,s.join("extHostStarter",this._waitForAllExit(6e3))}))}_serviceBrand;static _lastId=0;_extHosts=new Map;_shutdown=!1;dispose(){super.dispose()}_getExtHost(e){let r=this._extHosts.get(e);if(!r)throw new Error("Unknown extension host!");return r}onDynamicStdout(e){return this._getExtHost(e).onStdout}onDynamicStderr(e){return this._getExtHost(e).onStderr}onDynamicMessage(e){return this._getExtHost(e).onMessage}onDynamicExit(e){return this._getExtHost(e).onExit}async createExtensionHost(){if(this._shutdown)throw wn();let e=String(++Ji._lastId),r=new ji(this._logService,this._windowsMainService,this._telemetryService,this._lifecycleMainService);this._extHosts.set(e,r);let i=r.onExit(({pid:o,code:s,signal:a})=>{i.dispose(),this._logService.info(`Extension host with pid ${o} exited with code: ${s}, signal: ${a}.`),setTimeout(()=>{r.dispose(),this._extHosts.delete(e)}),setTimeout(()=>{try{process.kill(o,0),this._logService.error(`Extension host with pid ${o} still exists, forcefully killing it...`),process.kill(o)}catch{}},1e3)});return{id:e}}async start(e,r){if(this._shutdown)throw wn();let i=this._getExtHost(e);return i.start({...r,type:"extensionHost",entryPoint:"vs/workbench/api/node/extensionHostProcess",args:["--skipWorkspaceStorageLock"],execArgv:r.execArgv,allowLoadingUnsignedLibraries:!0,forceAllocationsToV8Sandbox:!0,respondToAuthRequestsFromMainProcess:!0,correlationId:e}),{pid:await E.toPromise(i.onSpawn)}}async enableInspectPort(e){if(this._shutdown)throw wn();let r=this._extHosts.get(e);return r?r.enableInspectPort():!1}async kill(e){if(this._shutdown)throw wn();let r=this._extHosts.get(e);r&&r.kill()}async _killAllNow(){for(let[,e]of this._extHosts)e.kill()}async _waitForAllExit(e){let r=[];for(let[,i]of this._extHosts)r.push(i.waitForExit(e));return Xe.settled(r).then(()=>{})}};Ji=P([g(0,A),g(1,oe),g(2,Fe),g(3,Ve)],Ji);var kie=new As("terminalTabFocusMode",!1,!0);var _ie=F("ptyService");var HC={Backend:"workbench.contributions.terminal.processBackend"},Yg=class{_backends=new Map;get backends(){return this._backends}registerTerminalBackend(t){let e=this._sanitizeRemoteAuthority(t.remoteAuthority);if(this._backends.has(e))throw new Error(`A terminal backend with remote authority '${e}' was already registered.`);this._backends.set(e,t)}getTerminalBackend(t){return this._backends.get(this._sanitizeRemoteAuthority(t))}_sanitizeRemoteAuthority(t){return t?.toLowerCase()??""}};De.add(HC.Backend,new Yg);var Xg=F("localPtyService"),Rie=F("terminalLogService");var Mie=F("externalTerminal"),Nc="Terminal.app";var Bc=F("externalTerminal");import*as Ko from"child_process";var QS=p("console.title","VS Code Console"),Vc=class{_serviceBrand;async getDefaultTerminalForPlatforms(){return{windows:Kc.getDefaultTerminalWindows(),linux:await Hc.getDefaultTerminalLinuxReady(),osx:"xterm"}}},hn=class hn extends Vc{static CMD="cmd.exe";static _DEFAULT_TERMINAL_WINDOWS;openTerminal(t,e){return this.spawnTerminal(Ko,t,Gp(),e)}spawnTerminal(t,e,r,i){let o=e.windowsExec||hn.getDefaultTerminalWindows();i&&i[1]===":"&&(i=i[0].toUpperCase()+i.substr(1));let s=pe(o,".exe").toLowerCase();if(s==="cmder")return t.spawn(o,i?[i]:void 0),Promise.resolve(void 0);let a=["/c","start","/wait"];return o.indexOf(" ")>=0&&a.push(o),a.push(o),s==="wt"&&a.push("-d ."),new Promise((l,c)=>{let d=ba(process),u=t.spawn(r,a,{cwd:i,env:d,detached:!0});u.on("error",c),u.on("exit",()=>l())})}async runInTerminal(t,e,r,i,o){let s="windowsExec"in o&&o.windowsExec?o.windowsExec:hn.getDefaultTerminalWindows(),a=await hn.getWtExePath();return new Promise((l,c)=>{let d=`"${e} - ${QS}"`,u=`"${r.join('" "')}" & pause`,m=Object.assign({},ba(process),i);Object.keys(m).filter(C=>m[C]===null).forEach(C=>delete m[C]);let h={cwd:e,env:m,windowsVerbatimArguments:!0},y,v;pe(s,".exe")==="wt"?(y=s,v=["-d",".",hn.CMD,"/c",u]):a?(y=a,v=["-d",".",s,"/c",u]):(y=hn.CMD,v=["/c","start",d,"/wait",s,"/c",`"${u}"`]),Ko.spawn(y,v,h).on("error",C=>{c(Zg(C))}),l(void 0)})}static getDefaultTerminalWindows(){if(!hn._DEFAULT_TERMINAL_WINDOWS){let t=!!process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432");hn._DEFAULT_TERMINAL_WINDOWS=`${process.env.windir?process.env.windir:"C:\\Windows"}\\${t?"Sysnative":"System32"}\\cmd.exe`}return hn._DEFAULT_TERMINAL_WINDOWS}static async getWtExePath(){try{let t=await $g.findExecutable("wt");return await q.exists(t)?t:void 0}catch{return}}};P([ie],hn,"getWtExePath",1);var Kc=hn,Qp=class n extends Vc{static OSASCRIPT="/usr/bin/osascript";openTerminal(t,e){return this.spawnTerminal(Ko,t,e)}runInTerminal(t,e,r,i,o){let s=o.osxExec||Nc;return new Promise((a,l)=>{if(s===Nc||s==="iTerm.app"){let c=s===Nc?"TerminalHelper":"iTermHelper",u=[Re.asFileUri(`vs/workbench/contrib/externalTerminal/node/${c}.scpt`).fsPath,"-t",t||QS,"-w",e];for(let y of r)u.push("-a"),u.push(y);if(i){let y=Object.assign({},ba(process),i);for(let v in y){let b=y[v];b===null?(u.push("-u"),u.push(v)):(u.push("-e"),u.push(`${v}=${b}`))}}let m="",h=Ko.spawn(n.OSASCRIPT,u);h.on("error",y=>{l(Zg(y))}),h.stderr.on("data",y=>{m+=y.toString()}),h.on("exit",y=>{if(y===0)a(void 0);else if(m){let v=m.split(`
`,1);l(new Error(v[0]))}else l(new Error(p("mac.terminal.script.failed","Script '{0}' failed with exit code {1}",c,y)))})}else l(new Error(p("mac.terminal.type.not.supported","'{0}' not supported",s)))})}spawnTerminal(t,e,r){let i=e.osxExec||Nc;return new Promise((o,s)=>{let a=["-a",i];r&&a.push(r);let l=ba(process),c=t.spawn("/usr/bin/open",a,{cwd:r,env:l});c.on("error",s),c.on("exit",()=>o())})}},Hc=class n extends Vc{static WAIT_MESSAGE=p("press.any.key","Press any key to continue...");openTerminal(t,e){return this.spawnTerminal(Ko,t,e)}runInTerminal(t,e,r,i,o){let s=o.linuxExec?Promise.resolve(o.linuxExec):n.getDefaultTerminalLinuxReady();return new Promise((a,l)=>{let c=[];s.then(d=>{d.indexOf("gnome-terminal")>=0?c.push("-x"):c.push("-e"),c.push("bash"),c.push("-c");let u=`${zC(r)}; echo; read -p "${n.WAIT_MESSAGE}" -n1;`;c.push(`''${u}''`);let m=Object.assign({},ba(process),i);Object.keys(m).filter(b=>m[b]===null).forEach(b=>delete m[b]);let h={cwd:e,env:m},y="",v=Ko.spawn(d,c,h);v.on("error",b=>{l(Zg(b))}),v.stderr.on("data",b=>{y+=b.toString()}),v.on("exit",b=>{if(b===0)a(void 0);else if(y){let C=y.split(`
`,1);l(new Error(C[0]))}else l(new Error(p("linux.term.failed","'{0}' failed with exit code {1}",d,b)))})})})}static _DEFAULT_TERMINAL_LINUX_READY;static async getDefaultTerminalLinuxReady(){if(!n._DEFAULT_TERMINAL_LINUX_READY)if(!Q)n._DEFAULT_TERMINAL_LINUX_READY=Promise.resolve("xterm");else{let t=await q.exists("/etc/debian_version");n._DEFAULT_TERMINAL_LINUX_READY=new Promise(e=>{t?e("x-terminal-emulator"):process.env.DESKTOP_SESSION==="gnome"||process.env.DESKTOP_SESSION==="gnome-classic"?e("gnome-terminal"):process.env.DESKTOP_SESSION==="kde-plasma"?e("konsole"):process.env.COLORTERM?e(process.env.COLORTERM):process.env.TERM?e(process.env.TERM):e("xterm")})}return n._DEFAULT_TERMINAL_LINUX_READY}spawnTerminal(t,e,r){let i=e.linuxExec?Promise.resolve(e.linuxExec):n.getDefaultTerminalLinuxReady();return new Promise((o,s)=>{i.then(a=>{let l=ba(process),c=t.spawn(a,[],{cwd:r,env:l});c.on("error",s),c.on("exit",()=>o())})})}};function ba(n){let t={...n.env};return US(t),t}function Zg(n){return"errno"in n&&n.errno==="ENOENT"&&"path"in n&&typeof n.path=="string"?new Error(p("ext.term.app.not.found","can't find terminal application '{0}'",n.path)):n}function zC(n){let t="";for(let e of n)e.indexOf(" ")>=0?t+='"'+e+'"':t+=e,t+=" ";return t}function ef(n){return typeof n.correlationId=="number"}function tv(n){return n.recursive===!0}var Yp=class n extends D{constructor(e,r,i,o){super();this.onFileChanges=e;this.onLogMessage=r;this.verboseLogging=i;this.options=o}static MAX_RESTARTS=5;watcher;watcherDisposables=this._register(new Mr);requests=void 0;restartCounter=0;init(){let e=new Y;this.watcherDisposables.value=e,this.watcher=this.createWatcher(e),this.watcher.setVerboseLogging(this.verboseLogging),e.add(this.watcher.onDidChangeFile(r=>this.onFileChanges(r))),e.add(this.watcher.onDidLogMessage(r=>this.onLogMessage(r))),e.add(this.watcher.onDidError(r=>this.onError(r.error,r.request)))}onError(e,r){this.canRestart(e,r)?this.restartCounter<n.MAX_RESTARTS&&this.requests?(this.error(`restarting watcher after unexpected error: ${e}`),this.restart(this.requests)):this.error(`gave up attempting to restart watcher after unexpected error: ${e}`):this.error(e)}canRestart(e,r){return!(!this.options.restartOnError||r||e.indexOf("No space left on device")!==-1||e.indexOf("EMFILE")!==-1)}restart(e){this.restartCounter++,this.init(),this.watch(e)}async watch(e){this.requests=e,await this.watcher?.watch(e)}async setVerboseLogging(e){this.verboseLogging=e,await this.watcher?.setVerboseLogging(e)}error(e){this.onLogMessage({type:"error",message:`[File Watcher (${this.options.type})] ${e}`})}trace(e){this.onLogMessage({type:"trace",message:`[File Watcher (${this.options.type})] ${e}`})}dispose(){return this.watcher=void 0,super.dispose()}},Xp=class extends Yp{constructor(t,e,r){super(t,e,r,{type:"node.js",restartOnError:!1})}},Zp=class extends Yp{constructor(t,e,r){super(t,e,r,{type:"universal",restartOnError:!0})}};function tf(n){return n.map(t=>({type:t.type,resource:x.revive(t.resource),cId:t.cId}))}function XS(n){let t=new ev;for(let e of n)t.processEvent(e);return t.coalesce()}function qC(n,t){return typeof t=="string"&&!t.startsWith(Ns)&&!Lr(t)?{base:n,pattern:t}:t}function rv(n,t){let e=[];for(let r of t)e.push(tw(qC(n,r)));return e}var ev=class{coalesced=new Set;mapPathToChange=new Map;toKey(t){return Q?t.resource.fsPath:t.resource.fsPath.toLowerCase()}processEvent(t){let e=this.mapPathToChange.get(this.toKey(t)),r=!1;if(e){let i=e.type,o=t.type;e.resource.fsPath!==t.resource.fsPath&&(t.type===2||t.type===1)?r=!0:i===1&&o===2?(this.mapPathToChange.delete(this.toKey(t)),this.coalesced.delete(e)):i===2&&o===1?e.type=0:i===1&&o===0||(e.type=o)}else r=!0;r&&(this.coalesced.add(t),this.mapPathToChange.set(this.toKey(t),t))}coalesce(){let t=[],e=[];return Array.from(this.coalesced).filter(r=>r.type!==2?(t.push(r),!1):!0).sort((r,i)=>r.resource.fsPath.length-i.resource.fsPath.length).filter(r=>e.some(i=>pw(r.resource.fsPath,i,!Q))?!1:(e.push(r.resource.fsPath),!0)).concat(t)}};function ZS(n,t){if(typeof t=="number")switch(n.type){case 1:return(t&4)===0;case 2:return(t&8)===0;case 0:return(t&2)===0}return!1}function e1(n){if(typeof n=="number"){let t=[];return n&4&&t.push("Added"),n&8&&t.push("Deleted"),n&2&&t.push("Updated"),t.length===0?"<all>":`[${t.join(", ")}]`}return"<none>"}var nv="localFilesystem";import{shell as nk}from"electron";import{promises as Qi}from"fs";async function of(n,t,e,r,i,o){let s;try{await $C(n,t,e,r,i,o)}catch(a){s=a}finally{s&&i.errorTransformer&&(s=i.errorTransformer(s)),typeof s<"u"&&e.error(s),e.end()}}async function $C(n,t,e,r,i,o){iv(o);let s=await n.open(t,{create:!1});try{iv(o);let a=0,l=0,c=i&&typeof i.length=="number"?i.length:void 0,d=K.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),u=i&&typeof i.position=="number"?i.position:0,m=0;do l=await n.read(s,u,d.buffer,m,d.byteLength-m),u+=l,m+=l,a+=l,typeof c=="number"&&(c-=l),m===d.byteLength&&(await e.write(r(d)),d=K.alloc(Math.min(i.bufferSize,typeof c=="number"?c:i.bufferSize)),m=0);while(l>0&&(typeof c!="number"||c>0)&&iv(o)&&jC(a,i));if(m>0){let h=m;typeof c=="number"&&(h=Math.min(m,c)),e.write(r(d.slice(0,h)))}}catch(a){throw li(a)}finally{await n.close(s)}}function iv(n){if(n.isCancellationRequested)throw wn();return!0}function jC(n,t){if(typeof t?.limits?.size=="number"&&n>t.limits.size)throw pr(p("fileTooLargeError","File is too large to open"),"EntryTooLarge");return!0}var sf=class extends D{constructor(e,r){super();this.logService=e;this.options=r}_onDidChangeFile=this._register(new S);onDidChangeFile=this._onDidChangeFile.event;_onDidWatchError=this._register(new S);onDidWatchError=this._onDidWatchError.event;watch(e,r){return r.recursive||this.options?.watcher?.forceUniversal?this.watchUniversal(e,r):this.watchNonRecursive(e,r)}universalWatcher;universalWatchRequests=[];universalWatchRequestDelayer=this._register(new Ht(0));watchUniversal(e,r){let i={path:this.toWatchPath(e),excludes:r.excludes,includes:r.includes,recursive:r.recursive,filter:r.filter,correlationId:r.correlationId},o=Zm(this.universalWatchRequests,i);return this.refreshUniversalWatchers(),$(()=>{o(),this.refreshUniversalWatchers()})}refreshUniversalWatchers(){this.universalWatchRequestDelayer.trigger(()=>this.doRefreshUniversalWatchers()).catch(e=>Je(e))}doRefreshUniversalWatchers(){this.universalWatcher||(this.universalWatcher=this._register(this.createUniversalWatcher(r=>this._onDidChangeFile.fire(tf(r)),r=>this.onWatcherLogMessage(r),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.universalWatcher?.setVerboseLogging(this.logService.getLevel()===1)})));let e=this.options?.watcher?.recursive?.usePolling;if(e===!0)for(let r of this.universalWatchRequests)tv(r)&&(r.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);else if(Array.isArray(e))for(let r of this.universalWatchRequests)tv(r)&&e.includes(r.path)&&(r.pollingInterval=this.options?.watcher?.recursive?.pollingInterval??5e3);return this.universalWatcher.watch(this.universalWatchRequests)}nonRecursiveWatcher;nonRecursiveWatchRequests=[];nonRecursiveWatchRequestDelayer=this._register(new Ht(0));watchNonRecursive(e,r){let i={path:this.toWatchPath(e),excludes:r.excludes,includes:r.includes,recursive:!1,filter:r.filter,correlationId:r.correlationId},o=Zm(this.nonRecursiveWatchRequests,i);return this.refreshNonRecursiveWatchers(),$(()=>{o(),this.refreshNonRecursiveWatchers()})}refreshNonRecursiveWatchers(){this.nonRecursiveWatchRequestDelayer.trigger(()=>this.doRefreshNonRecursiveWatchers()).catch(e=>Je(e))}doRefreshNonRecursiveWatchers(){return this.nonRecursiveWatcher||(this.nonRecursiveWatcher=this._register(this.createNonRecursiveWatcher(e=>this._onDidChangeFile.fire(tf(e)),e=>this.onWatcherLogMessage(e),this.logService.getLevel()===1)),this._register(this.logService.onDidChangeLogLevel(()=>{this.nonRecursiveWatcher?.setVerboseLogging(this.logService.getLevel()===1)}))),this.nonRecursiveWatcher.watch(this.nonRecursiveWatchRequests)}onWatcherLogMessage(e){e.type==="error"&&this._onDidWatchError.fire(e.message),this.logWatcherMessage(e)}logWatcherMessage(e){this.logService[e.type](e.message)}toFilePath(e){return lt(e.fsPath)}toWatchPath(e){let r=this.toFilePath(e);return ch(r)}};import{fork as QC}from"child_process";function t1(n){let t=n;return t&&typeof t.type=="string"&&typeof t.severity=="string"}function GC(n){let t=[],e;try{let r=JSON.parse(n.arguments),i=r[r.length-1];i&&i.__$stack&&(r.pop(),e=i.__$stack),t.push(...r)}catch{t.push("Unable to log remote console arguments",n.arguments)}return{args:t,stack:e}}function JC(n){if(!n)return n;let t=n.indexOf(`
`);return t===-1?n:n.substring(0,t)}function r1(n,t){let{args:e,stack:r}=GC(n),i=typeof e[0]=="string"&&e.length===1,o=JC(r);o&&(o=`(${o.trim()})`);let s=[];if(typeof e[0]=="string"?o&&i?s=[`%c[${t}] %c${e[0]} %c${o}`,wa("blue"),wa(""),wa("grey")]:s=[`%c[${t}] %c${e[0]}`,wa("blue"),wa(""),...e.slice(1)]:s=[`%c[${t}]%`,wa("blue"),...e],o&&!i&&s.push(o),typeof console[n.severity]!="function")throw new Error("Unknown console method");console[n.severity].apply(console,s)}function wa(n){return`color: ${n}`}var af=class{constructor(t,e){this.modulePath=t;this.options=e;let r=e&&e.timeout?e.timeout:6e4;this.disposeDelayer=new Al(r),this.child=null,this._client=null}disposeDelayer;activeRequests=new Set;child;_client;channels=new Map;_onDidProcessExit=new S;onDidProcessExit=this._onDidProcessExit.event;getChannel(t){let e=this;return{call(r,i,o){return e.requestPromise(t,r,i,o)},listen(r,i){return e.requestEvent(t,r,i)}}}requestPromise(t,e,r,i=we.None){if(!this.disposeDelayer)return Promise.reject(new Error("disposed"));if(i.isCancellationRequested)return Promise.reject(wn());this.disposeDelayer.cancel();let o=this.getCachedChannel(t),s=ri(c=>o.call(e,r,c)),a=i.onCancellationRequested(()=>s.cancel()),l=$(()=>s.cancel());return this.activeRequests.add(l),s.finally(()=>{a.dispose(),this.activeRequests.delete(l),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}),s}requestEvent(t,e,r){if(!this.disposeDelayer)return E.None;this.disposeDelayer.cancel();let i,o=new S({onWillAddFirstListener:()=>{i=this.getCachedChannel(t).listen(e,r)(o.fire,o),this.activeRequests.add(i)},onDidRemoveLastListener:()=>{this.activeRequests.delete(i),i.dispose(),this.activeRequests.size===0&&this.disposeDelayer&&this.disposeDelayer.trigger(()=>this.disposeClient())}});return o.event}get client(){if(!this._client){let t=this.options&&this.options.args?this.options.args:[],e=Object.create(null);e.env={...er(process.env),VSCODE_PARENT_PID:String(process.pid)},this.options&&this.options.env&&(e.env={...e.env,...this.options.env}),this.options&&this.options.freshExecArgv&&(e.execArgv=[]),this.options&&typeof this.options.debug=="number"&&(e.execArgv=["--nolazy","--inspect="+this.options.debug]),this.options&&typeof this.options.debugBrk=="number"&&(e.execArgv=["--nolazy","--inspect-brk="+this.options.debugBrk]),e.execArgv===void 0&&(e.execArgv=process.execArgv.filter(u=>!/^--inspect(-brk)?=/.test(u)).filter(u=>!u.startsWith("--vscode-"))),qp(e.env),this.child=QC(this.modulePath,t,e);let r=new S,o=E.fromNodeEventEmitter(this.child,"message",u=>u)(u=>{if(t1(u)){r1(u,`IPC Library: ${this.options.serverName}`);return}r.fire(K.wrap(Buffer.from(u,"base64")))}),s=this.options.useQueue?$S(this.child):this.child,a=u=>this.child&&this.child.connected&&s.send(u.buffer.toString("base64")),l=r.event,c={send:a,onMessage:l};this._client=new Ro(c);let d=()=>this.disposeClient();process.once("exit",d),this.child.on("error",u=>console.warn('IPC "'+this.options.serverName+'" errored with '+u)),this.child.on("exit",(u,m)=>{process.removeListener("exit",d),o.dispose(),this.activeRequests.forEach(h=>ze(h)),this.activeRequests.clear(),u!==0&&m!=="SIGTERM"&&console.warn('IPC "'+this.options.serverName+'" crashed with exit code '+u+" and signal "+m),this.disposeDelayer?.cancel(),this.disposeClient(),this._onDidProcessExit.fire({code:u,signal:m})})}return this._client}getCachedChannel(t){let e=this.channels.get(t);return e||(e=this.client.getChannel(t),this.channels.set(t,e)),e}disposeClient(){this._client&&(this.child&&(this.child.kill(),this.child=null),this._client=null,this.channels.clear())}dispose(){this._onDidProcessExit.dispose(),this.disposeDelayer?.cancel(),this.disposeDelayer=void 0,this.disposeClient(),this.activeRequests.clear()}};var lf=class extends Zp{constructor(t,e,r){super(t,e,r),this.init()}createWatcher(t){let e=t.add(new af(Re.asFileUri("bootstrap-fork").fsPath,{serverName:"File Watcher",args:["--type=fileWatcher"],env:{VSCODE_AMD_ENTRYPOINT:"vs/platform/files/node/watcher/watcherMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true"}}));return t.add(e.onDidProcessExit(({code:r,signal:i})=>this.onError(`terminated by itself with code ${r}, signal: ${i} (ETERM)`))),$e.toService(fb(e.getChannel("watcher")))}};import{watchFile as YC,unwatchFile as XC}from"fs";var cf=class extends D{_onDidChangeFile=this._register(new S);onDidChangeFile=this._onDidChangeFile.event;_onDidLogMessage=this._register(new S);onDidLogMessage=this._onDidLogMessage.event;_onDidWatchFail=this._register(new S);onDidWatchFail=this._onDidWatchFail.event;allNonCorrelatedWatchRequests=new Set;allCorrelatedWatchRequests=new Map;suspendedWatchRequests=this._register(new Yn);suspendedWatchRequestsWithPolling=new Set;updateWatchersDelayer=this._register(new Ht(this.getUpdateWatchersDelay()));suspendedWatchRequestPollingInterval=5007;joinWatch=new ur;constructor(){super(),this._register(this.onDidWatchFail(t=>this.handleDidWatchFail(t)))}handleDidWatchFail(t){this.isCorrelated(t)&&this.suspendWatchRequest(t)}isCorrelated(t){return ef(t)}async watch(t){this.joinWatch.isSettled||this.joinWatch.complete(),this.joinWatch=new ur;try{this.allCorrelatedWatchRequests.clear(),this.allNonCorrelatedWatchRequests.clear();for(let e of t)this.isCorrelated(e)?this.allCorrelatedWatchRequests.set(e.correlationId,e):this.allNonCorrelatedWatchRequests.add(e);for(let[e]of this.suspendedWatchRequests)this.allCorrelatedWatchRequests.has(e)||(this.suspendedWatchRequests.deleteAndDispose(e),this.suspendedWatchRequestsWithPolling.delete(e));return await this.updateWatchers(!1)}finally{this.joinWatch.complete()}}updateWatchers(t){return this.updateWatchersDelayer.trigger(()=>this.doWatch([...this.allNonCorrelatedWatchRequests,...Array.from(this.allCorrelatedWatchRequests.values()).filter(e=>!this.suspendedWatchRequests.has(e.correlationId))]),t?this.getUpdateWatchersDelay():0)}getUpdateWatchersDelay(){return 800}isSuspended(t){return typeof t.correlationId!="number"?!1:this.suspendedWatchRequestsWithPolling.has(t.correlationId)?"polling":this.suspendedWatchRequests.has(t.correlationId)}async suspendWatchRequest(t){if(this.suspendedWatchRequests.has(t.correlationId))return;let e=new Y;this.suspendedWatchRequests.set(t.correlationId,e),await this.joinWatch.p,!e.isDisposed&&(this.monitorSuspendedWatchRequest(t,e),this.updateWatchers(!0))}resumeWatchRequest(t){this.suspendedWatchRequests.deleteAndDispose(t.correlationId),this.suspendedWatchRequestsWithPolling.delete(t.correlationId),this.updateWatchers(!1)}monitorSuspendedWatchRequest(t,e){this.doMonitorWithExistingWatcher(t,e)?(this.trace(`reusing an existing recursive watcher to monitor ${t.path}`),this.suspendedWatchRequestsWithPolling.delete(t.correlationId)):(this.doMonitorWithNodeJS(t,e),this.suspendedWatchRequestsWithPolling.add(t.correlationId))}doMonitorWithExistingWatcher(t,e){let r=this.recursiveWatcher?.subscribe(t.path,(i,o)=>{e.isDisposed||(i?this.monitorSuspendedWatchRequest(t,e):o?.type===1&&this.onMonitoredPathAdded(t))});return r?(e.add(r),!0):!1}doMonitorWithNodeJS(t,e){let r=!1,i=(o,s)=>{if(e.isDisposed)return;let a=this.isPathNotFound(o),l=this.isPathNotFound(s),c=r;r=a,!a&&(l||c)&&this.onMonitoredPathAdded(t)};this.trace(`starting fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{YC(t.path,{persistent:!1,interval:this.suspendedWatchRequestPollingInterval},i)}catch(o){this.warn(`fs.watchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}e.add($(()=>{this.trace(`stopping fs.watchFile() on ${t.path} (correlationId: ${t.correlationId})`);try{XC(t.path,i)}catch(o){this.warn(`fs.unwatchFile() failed with error ${o} on path ${t.path} (correlationId: ${t.correlationId})`)}}))}onMonitoredPathAdded(t){this.trace(`detected ${t.path} exists again, resuming watcher (correlationId: ${t.correlationId})`);let e={resource:x.file(t.path),type:1,cId:t.correlationId};this._onDidChangeFile.fire([e]),this.traceEvent(e,t),this.resumeWatchRequest(t)}isPathNotFound(t){return t.ctimeMs===0&&t.ino===0}async stop(){this.suspendedWatchRequests.clearAndDisposeAll(),this.suspendedWatchRequestsWithPolling.clear()}traceEvent(t,e){if(this.verboseLogging){let r=` >> normalized ${t.type===1?"[ADDED]":t.type===2?"[DELETED]":"[CHANGED]"} ${t.resource.fsPath}`;this.traceWithCorrelation(r,e)}}traceWithCorrelation(t,e){this.verboseLogging&&this.trace(`${t}${typeof e.correlationId=="number"?` <${e.correlationId}> `:""}`)}requestToString(t){return`${t.path} (excludes: ${t.excludes.length>0?t.excludes:"<none>"}, includes: ${t.includes&&t.includes.length>0?JSON.stringify(t.includes):"<all>"}, filter: ${e1(t.filter)}, correlationId: ${typeof t.correlationId=="number"?t.correlationId:"<none>"})`}verboseLogging=!1;async setVerboseLogging(t){this.verboseLogging=t}};import{watch as ek,promises as tk}from"fs";import*as Sa from"fs";async function df(n,t){if(Q)return n;let e=Ne(n);if(n===e)return n;let r=(pe(n)||n).toLowerCase();try{if(t?.isCancellationRequested)return null;let o=(await q.readdir(e)).filter(s=>s.toLowerCase()===r);if(o.length===1){let s=await df(e,t);if(s)return V(s,o[0])}else if(o.length>1){let s=o.indexOf(r);if(s>=0){let a=await df(e,t);if(a)return V(a,o[s])}}}catch{}return null}async function n1(n){try{return await q.realpath(n)}catch{let e=ZC(n);return await Sa.promises.access(e,Sa.constants.R_OK),e}}function ZC(n){return cn(lt(n),ht)}var uf=class n extends D{constructor(e,r,i,o,s,a){super();this.request=e;this.recursiveWatcher=r;this.onDidFilesChange=i;this.onDidWatchFail=o;this.onLogMessage=s;this.verboseLogging=a}static FILE_DELETE_HANDLER_DELAY=100;static FILE_CHANGES_HANDLER_DELAY=75;throttledFileChangesEmitter=this._register(new vu({maxWorkChunkSize:100,throttleDelay:200,maxBufferedWork:1e4},e=>this.onDidFilesChange(e)));fileChangesAggregator=this._register(new gu(e=>this.handleFileChanges(e),n.FILE_CHANGES_HANDLER_DELAY));excludes=rv(this.request.path,this.request.excludes);includes=this.request.includes?rv(this.request.path,this.request.includes):void 0;filter=ef(this.request)?this.request.filter:void 0;cts=new rt;ready=this.watch();_isReusingRecursiveWatcher=!1;get isReusingRecursiveWatcher(){return this._isReusingRecursiveWatcher}didFail=!1;get failed(){return this.didFail}async watch(){try{let e=await this.normalizePath(this.request);if(this.cts.token.isCancellationRequested)return;let r=await tk.stat(e);if(this.cts.token.isCancellationRequested)return;this._register(await this.doWatch(e,r.isDirectory()))}catch(e){e.code!=="ENOENT"?this.error(e):this.trace(`ignoring a path for watching who's stat info failed to resolve: ${this.request.path} (error: ${e})`),this.notifyWatchFailed()}}notifyWatchFailed(){this.didFail=!0,this.onDidWatchFail?.()}async normalizePath(e){let r=e.path;try{r=await q.realpath(e.path),e.path===r&&(r=await df(e.path,this.cts.token)??e.path),e.path!==r&&this.trace(`correcting a path to watch that seems to be a symbolic link or wrong casing (original: ${e.path}, real: ${r})`)}catch{}return r}async doWatch(e,r){let i=new Y;return this.doWatchWithExistingWatcher(e,r,i)?(this.trace(`reusing an existing recursive watcher for ${this.request.path}`),this._isReusingRecursiveWatcher=!0):(this._isReusingRecursiveWatcher=!1,await this.doWatchWithNodeJS(e,r,i)),i}doWatchWithExistingWatcher(e,r,i){if(r)return!1;let o=x.file(this.request.path),s=this.recursiveWatcher?.subscribe(this.request.path,async(a,l)=>{if(!i.isDisposed)if(a){let c=await this.doWatch(e,r);i.isDisposed?c.dispose():i.add(c)}else l&&(typeof l.cId=="number"||typeof this.request.correlationId=="number")&&this.onFileChange({resource:o,type:l.type,cId:this.request.correlationId},!0)});return s?(i.add(s),!0):!1}async doWatchWithNodeJS(e,r,i){if(W&&ti(e,"/Volumes/",!0)){this.error(`Refusing to watch ${e} for changes using fs.watch() for possibly being a network share where watching is unreliable and unstable.`);return}let o=new rt(this.cts.token);i.add($(()=>o.dispose(!0)));let s=new Y;i.add(s);try{let a=x.file(this.request.path),l=pe(e),c=ek(e);s.add($(()=>{c.removeAllListeners(),c.close()})),this.trace(`Started watching: '${e}'`);let d=new Set;if(r)try{for(let m of await q.readdir(e))d.add(m)}catch(m){this.error(m)}if(o.token.isCancellationRequested)return;let u=new Map;s.add($(()=>{for(let[,m]of u)m.dispose();u.clear()})),c.on("error",(m,h)=>{o.token.isCancellationRequested||(this.error(`Failed to watch ${e} for changes using fs.watch() (${m}, ${h})`),this.notifyWatchFailed())}),c.on("change",(m,h)=>{if(o.token.isCancellationRequested)return;this.verboseLogging&&this.traceWithCorrelation(`[raw] ["${m}"] ${h}`);let y="";if(h&&(y=h.toString(),W&&(y=Rn(y))),!(!y||m!=="change"&&m!=="rename"))if(r)if(m==="rename"){u.get(y)?.dispose();let v=setTimeout(async()=>{if(u.delete(y),y===l&&!await q.exists(e)){this.onWatchedPathDeleted(a);return}if(o.token.isCancellationRequested)return;let b=await this.existsChildStrictCase(V(e,y));if(o.token.isCancellationRequested)return;let C;b?d.has(y)?C=0:(C=1,d.add(y)):(d.delete(y),C=2),this.onFileChange({resource:ne(a,y),type:C,cId:this.request.correlationId})},n.FILE_DELETE_HANDLER_DELAY);u.set(y,$(()=>clearTimeout(v)))}else{let v;d.has(y)?v=0:(v=1,d.add(y)),this.onFileChange({resource:ne(a,y),type:v,cId:this.request.correlationId})}else if(m==="rename"||y!==l){let v=setTimeout(async()=>{let b=await q.exists(e);o.token.isCancellationRequested||(b?(this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0),s.add(await this.doWatch(e,!1))):this.onWatchedPathDeleted(a))},n.FILE_DELETE_HANDLER_DELAY);s.clear(),s.add($(()=>clearTimeout(v)))}else this.onFileChange({resource:a,type:0,cId:this.request.correlationId},!0)})}catch(a){o.token.isCancellationRequested||this.error(`Failed to watch ${e} for changes using fs.watch() (${a.toString()})`),this.notifyWatchFailed()}}onWatchedPathDeleted(e){this.warn("Watcher shutdown because watched path got deleted"),this.onFileChange({resource:e,type:2,cId:this.request.correlationId},!0),this.fileChangesAggregator.flush(),this.notifyWatchFailed()}onFileChange(e,r=!1){this.cts.token.isCancellationRequested||(this.verboseLogging&&this.traceWithCorrelation(`${e.type===1?"[ADDED]":e.type===2?"[DELETED]":"[CHANGED]"} ${e.resource.fsPath}`),!r&&this.excludes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (excluded) ${e.resource.fsPath}`):!r&&this.includes&&this.includes.length>0&&!this.includes.some(i=>i(e.resource.fsPath))?this.verboseLogging&&this.traceWithCorrelation(` >> ignored (not included) ${e.resource.fsPath}`):this.fileChangesAggregator.work(e))}handleFileChanges(e){let r=XS(e),i=[];for(let s of r){if(ZS(s,this.filter)){this.verboseLogging&&this.traceWithCorrelation(` >> ignored (filtered) ${s.resource.fsPath}`);continue}i.push(s)}if(i.length===0)return;if(this.verboseLogging)for(let s of i)this.traceWithCorrelation(` >> normalized ${s.type===1?"[ADDED]":s.type===2?"[DELETED]":"[CHANGED]"} ${s.resource.fsPath}`);this.throttledFileChangesEmitter.work(i)?this.throttledFileChangesEmitter.pending>0&&this.trace(`started throttling events due to large amount of file change events at once (pending: ${this.throttledFileChangesEmitter.pending}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`):this.warn(`started ignoring events due to too many file change events at once (incoming: ${i.length}, most recent change: ${i[0].resource.fsPath}). Use 'files.watcherExclude' setting to exclude folders with lots of changing files (e.g. compilation output).`)}async existsChildStrictCase(e){if(Q)return q.exists(e);try{let r=pe(e);return(await q.readdir(Ne(e))).some(o=>o===r)}catch(r){return this.trace(r),!1}}setVerboseLogging(e){this.verboseLogging=e}error(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"error",message:`[File Watcher (node.js)] ${e}`})}warn(e){this.cts.token.isCancellationRequested||this.onLogMessage?.({type:"warn",message:`[File Watcher (node.js)] ${e}`})}trace(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.onLogMessage?.({type:"trace",message:`[File Watcher (node.js)] ${e}`})}traceWithCorrelation(e){!this.cts.token.isCancellationRequested&&this.verboseLogging&&this.trace(`${e}${typeof this.request.correlationId=="number"?` <${this.request.correlationId}> `:""}`)}dispose(){this.cts.dispose(!0),super.dispose()}};var pf=class extends cf{constructor(e){super();this.recursiveWatcher=e}onDidError=E.None;watchers=new Set;async doWatch(e){e=this.removeDuplicateRequests(e);let r=[],i=new Set(Array.from(this.watchers));for(let o of e){let s=this.findWatcher(o);s&&Zh(s.request.excludes,o.excludes)&&Zh(s.request.includes,o.includes)?i.delete(s):r.push(o)}r.length&&this.trace(`Request to start watching: ${r.map(o=>this.requestToString(o)).join(",")}`),i.size&&this.trace(`Request to stop watching: ${Array.from(i).map(o=>this.requestToString(o.request)).join(",")}`);for(let o of i)this.stopWatching(o);for(let o of r)this.startWatching(o)}findWatcher(e){for(let r of this.watchers)if(typeof e.correlationId=="number"||typeof r.request.correlationId=="number"){if(r.request.correlationId===e.correlationId)return r}else if(So(r.request.path,e.path,!Q))return r}startWatching(e){let r=new uf(e,this.recursiveWatcher,o=>this._onDidChangeFile.fire(o),()=>this._onDidWatchFail.fire(e),o=>this._onDidLogMessage.fire(o),this.verboseLogging),i={request:e,instance:r};this.watchers.add(i)}async stop(){await super.stop();for(let e of this.watchers)this.stopWatching(e)}stopWatching(e){this.trace("stopping file watcher",e),this.watchers.delete(e),e.instance.dispose()}removeDuplicateRequests(e){let r=new Map;for(let i of e){let o=Q?i.path:i.path.toLowerCase(),s=r.get(i.correlationId);s||(s=new Map,r.set(i.correlationId,s)),s.has(o)&&this.trace(`ignoring a request for watching who's path is already watched: ${this.requestToString(i)}`),s.set(o,i)}return Array.from(r.values()).map(i=>Array.from(i.values())).flat()}async setVerboseLogging(e){super.setVerboseLogging(e);for(let r of this.watchers)r.instance.setVerboseLogging(e)}trace(e,r){this.verboseLogging&&this._onDidLogMessage.fire({type:"trace",message:this.toMessage(e,r)})}warn(e){this._onDidLogMessage.fire({type:"warn",message:this.toMessage(e)})}toMessage(e,r){return r?`[File Watcher (node.js)] ${e} (${this.requestToString(r.request)})`:`[File Watcher (node.js)] ${e}`}};var ff=class extends Xp{constructor(t,e,r){super(t,e,r),this.init()}createWatcher(t){return t.add(new pf(void 0))}};var Yi=class n extends sf{static TRACE_LOG_RESOURCE_LOCKS=!1;constructor(t,e){super(t,e)}onDidChangeCapabilities=E.None;_capabilities;get capabilities(){return this._capabilities||(this._capabilities=253982,Q&&(this._capabilities|=1024)),this._capabilities}async stat(t){try{let{stat:e,symbolicLink:r}=await Pt.stat(this.toFilePath(t));return{type:this.toType(e,r),ctime:e.birthtime.getTime(),mtime:e.mtime.getTime(),size:e.size,permissions:e.mode&128?void 0:2}}catch(e){throw this.toFileSystemProviderError(e)}}async statIgnoreError(t){try{return await this.stat(t)}catch{return}}async readdir(t){try{let e=await q.readdir(this.toFilePath(t),{withFileTypes:!0}),r=[];return await Promise.all(e.map(async i=>{try{let o;i.isSymbolicLink()?o=(await this.stat(ne(t,i.name))).type:o=this.toType(i),r.push([i.name,o])}catch(o){this.logService.trace(o)}})),r}catch(e){throw this.toFileSystemProviderError(e)}}toType(t,e){let r;return e?.dangling?r=0:t.isFile()?r=1:t.isDirectory()?r=2:r=0,e&&(r|=64),r}resourceLocks=new Ue(t=>Le.getComparisonKey(t));async createResourceLock(t){let e=this.toFilePath(t);this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - request to acquire resource lock (${e})`);let r;for(;r=this.resourceLocks.get(t);)this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - waiting for resource lock to be released (${e})`),await r.wait();let i=new kn;return this.resourceLocks.set(t,i),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - new resource lock created (${e})`),$(()=>{this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock dispose() (${e})`),this.resourceLocks.get(t)===i&&(this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock removed from resource-lock map (${e})`),this.resourceLocks.delete(t)),this.traceLock(`[Disk FileSystemProvider]: createResourceLock() - resource lock barrier open() (${e})`),i.open()})}async readFile(t,e){let r;try{e?.atomic&&(this.traceLock(`[Disk FileSystemProvider]: atomic read operation started (${this.toFilePath(t)})`),r=await this.createResourceLock(t));let i=this.toFilePath(t);return await Qi.readFile(i)}catch(i){throw this.toFileSystemProviderError(i)}finally{r?.dispose()}}traceLock(t){n.TRACE_LOG_RESOURCE_LOCKS&&this.logService.trace(t)}readFileStream(t,e,r){let i=Di(o=>K.concat(o.map(s=>K.wrap(s))).buffer);return of(this,t,i,o=>o.buffer,{...e,bufferSize:256*1024},r),i}async writeFile(t,e,r){return r?.atomic!==!1&&r?.atomic?.postfix&&await this.canWriteFileAtomic(t)?this.doWriteFileAtomic(t,ne(TI(t),`${cr(t)}${r.atomic.postfix}`),e,r):this.doWriteFile(t,e,r)}async canWriteFileAtomic(t){try{let e=this.toFilePath(t),{symbolicLink:r}=await Pt.stat(e);if(r)return!1}catch{}return!0}async doWriteFileAtomic(t,e,r,i){let o=new Y;try{o.add(await this.createResourceLock(t)),o.add(await this.createResourceLock(e)),await this.doWriteFile(e,r,i,!0);try{await this.rename(e,t,{overwrite:!0})}catch(s){try{await this.delete(e,{recursive:!1,useTrash:!1,atomic:!1})}catch{}throw s}}finally{o.dispose()}}async doWriteFile(t,e,r,i){let o;try{let s=this.toFilePath(t);if(!r.create||!r.overwrite){if(await q.exists(s)){if(!r.overwrite)throw pr(p("fileExists","File already exists"),"EntryExists")}else if(!r.create)throw pr(p("fileNotExists","File does not exist"),"EntryNotFound")}o=await this.open(t,{create:!0,unlock:r.unlock},i),await this.write(o,0,e,0,e.byteLength)}catch(s){throw await this.toFileSystemProviderWriteError(t,s)}finally{typeof o=="number"&&await this.close(o)}}mapHandleToPos=new Map;mapHandleToLock=new Map;writeHandles=new Map;static canFlush=!0;static configureFlushOnWrite(t){n.canFlush=t}async open(t,e,r){let i=this.toFilePath(t),o;Hs(e)&&!r&&(o=await this.createResourceLock(t));let s;try{if(Hs(e)&&e.unlock)try{let{stat:l}=await Pt.stat(i);l.mode&128||await Qi.chmod(i,l.mode|128)}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}let a;if(Hs(e)){if(U)try{await Qi.truncate(i,0),a="r+"}catch(l){l.code!=="ENOENT"&&this.logService.trace(l)}a||(a="w")}else a="r";s=await q.open(i,a)}catch(a){throw o?.dispose(),Hs(e)?await this.toFileSystemProviderWriteError(t,a):this.toFileSystemProviderError(a)}if(this.mapHandleToPos.set(s,0),Hs(e)&&this.writeHandles.set(s,t),o){let a=this.mapHandleToLock.get(s);this.traceLock(`[Disk FileSystemProvider]: open() - storing lock for handle ${s} (${i})`),this.mapHandleToLock.set(s,o),a&&(this.traceLock(`[Disk FileSystemProvider]: open() - disposing a previous lock that was still stored on same handle ${s} (${i})`),a.dispose())}return s}async close(t){let e=this.mapHandleToLock.get(t);try{if(this.mapHandleToPos.delete(t),this.writeHandles.delete(t)&&n.canFlush)try{await q.fdatasync(t)}catch(r){n.configureFlushOnWrite(!1),this.logService.error(r)}return await q.close(t)}catch(r){throw this.toFileSystemProviderError(r)}finally{e&&(this.mapHandleToLock.get(t)===e&&(this.traceLock(`[Disk FileSystemProvider]: close() - resource lock removed from handle-lock map ${t}`),this.mapHandleToLock.delete(t)),this.traceLock(`[Disk FileSystemProvider]: close() - disposing lock for handle ${t}`),e.dispose())}}async read(t,e,r,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await q.read(t,r,i,o,s)).bytesRead}catch(l){throw this.toFileSystemProviderError(l)}finally{this.updatePos(t,s,a)}return a}normalizePos(t,e){return e===this.mapHandleToPos.get(t)?null:e}updatePos(t,e,r){let i=this.mapHandleToPos.get(t);typeof i=="number"&&(typeof e=="number"||(typeof r=="number"?this.mapHandleToPos.set(t,i+r):this.mapHandleToPos.delete(t)))}async write(t,e,r,i,o){return HI(()=>this.doWrite(t,e,r,i,o),100,3)}async doWrite(t,e,r,i,o){let s=this.normalizePos(t,e),a=null;try{a=(await q.write(t,r,i,o,s)).bytesWritten}catch(l){throw await this.toFileSystemProviderWriteError(this.writeHandles.get(t),l)}finally{this.updatePos(t,s,a)}return a}async mkdir(t){try{await Qi.mkdir(this.toFilePath(t))}catch(e){throw this.toFileSystemProviderError(e)}}async delete(t,e){try{let r=this.toFilePath(t);if(e.recursive){let i;e?.atomic!==!1&&e.atomic.postfix&&(i=V(Ne(r),`${pe(r)}${e.atomic.postfix}`)),await q.rm(r,1,i)}else try{await Qi.unlink(r)}catch(i){if(i.code==="EPERM"||i.code==="EISDIR"){let o=!1;try{let{stat:s,symbolicLink:a}=await Pt.stat(r);o=s.isDirectory()&&!a}catch{}if(o)await Qi.rmdir(r);else throw i}else throw i}}catch(r){throw this.toFileSystemProviderError(r)}}async rename(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"move",r.overwrite),await q.rename(i,o)}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(p("moveError","Unable to move '{0}' into '{1}' ({2}).",pe(i),pe(Ne(o)),s.toString()))),this.toFileSystemProviderError(s)}}async copy(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e);if(i!==o)try{await this.validateMoveCopy(t,e,"copy",r.overwrite),await q.copy(i,o,{preserveSymlinks:!0})}catch(s){throw(s.code==="EINVAL"||s.code==="EBUSY"||s.code==="ENAMETOOLONG")&&(s=new Error(p("copyError","Unable to copy '{0}' into '{1}' ({2}).",pe(i),pe(Ne(o)),s.toString()))),this.toFileSystemProviderError(s)}}async validateMoveCopy(t,e,r,i){let o=this.toFilePath(t),s=this.toFilePath(e),a=!1;if(!!(this.capabilities&1024)||(a=So(o,s,!0)),a){if(r==="copy")throw pr(p("fileCopyErrorPathCase","File cannot be copied to same path with different path case"),"EntryExists");if(r==="move")return}let c=await this.statIgnoreError(t);if(!c)throw pr(p("fileMoveCopyErrorNotFound","File to move/copy does not exist"),"EntryNotFound");let d=await this.statIgnoreError(e);if(d){if(!i)throw pr(p("fileMoveCopyErrorExists","File at target already exists and thus will not be moved/copied to unless overwrite is specified"),"EntryExists");c.type&1&&d.type&1||await this.delete(e,{recursive:!0,useTrash:!1,atomic:!1})}}async cloneFile(t,e){return this.doCloneFile(t,e,!1)}async doCloneFile(t,e,r){let i=this.toFilePath(t),o=this.toFilePath(e),s=!!(this.capabilities&1024);if(So(i,o,!s))return;let a=new Y;try{a.add(await this.createResourceLock(t)),a.add(await this.createResourceLock(e)),r&&await Qi.mkdir(Ne(o),{recursive:!0}),await Qi.copyFile(i,o)}catch(l){if(l.code==="ENOENT"&&!r)return this.doCloneFile(t,e,!0);throw this.toFileSystemProviderError(l)}finally{a.dispose()}}createUniversalWatcher(t,e,r){return new lf(i=>t(i),i=>e(i),r)}createNonRecursiveWatcher(t,e,r){return new ff(i=>t(i),i=>e(i),r)}toFileSystemProviderError(t){if(t instanceof Bs)return t;let e=t,r;switch(t.code){case"ENOENT":r="EntryNotFound";break;case"EISDIR":r="EntryIsADirectory";break;case"ENOTDIR":r="EntryNotADirectory";break;case"EEXIST":r="EntryExists";break;case"EPERM":case"EACCES":r="NoPermissions";break;case"ERR_UNC_HOST_NOT_ALLOWED":e=`${t.message}. Please update the 'security.allowedUNCHosts' setting if you want to allow this host.`,r="Unknown";break;default:r="Unknown"}return pr(e,r)}async toFileSystemProviderWriteError(t,e){let r=this.toFileSystemProviderError(e);if(t&&r.code==="NoPermissions")try{let{stat:i}=await Pt.stat(this.toFilePath(t));i.mode&128||(r=pr(e,"EntryWriteLocked"))}catch(i){this.logService.trace(i)}return r}};var o1=new class{transformIncoming(n){return n}transformOutgoing(n){return n}transformOutgoingURI(n){return n}transformOutgoingScheme(n){return n}};var mf=class extends D{constructor(e,r){super();this.provider=e;this.logService=r}call(e,r,i){let o=this.getUriTransformer(e);switch(r){case"stat":return this.stat(o,i[0]);case"readdir":return this.readdir(o,i[0]);case"open":return this.open(o,i[0],i[1]);case"close":return this.close(i[0]);case"read":return this.read(i[0],i[1],i[2]);case"readFile":return this.readFile(o,i[0],i[1]);case"write":return this.write(i[0],i[1],i[2],i[3],i[4]);case"writeFile":return this.writeFile(o,i[0],i[1],i[2]);case"rename":return this.rename(o,i[0],i[1],i[2]);case"copy":return this.copy(o,i[0],i[1],i[2]);case"cloneFile":return this.cloneFile(o,i[0],i[1]);case"mkdir":return this.mkdir(o,i[0]);case"delete":return this.delete(o,i[0],i[1]);case"watch":return this.watch(o,i[0],i[1],i[2],i[3]);case"unwatch":return this.unwatch(i[0],i[1])}throw new Error(`IPC Command ${r} not found`)}listen(e,r,i){let o=this.getUriTransformer(e);switch(r){case"fileChange":return this.onFileChange(o,i[0]);case"readFileStream":return this.onReadFileStream(o,i[0],i[1])}throw new Error(`Unknown event ${r}`)}stat(e,r){let i=this.transformIncoming(e,r,!0);return this.provider.stat(i)}readdir(e,r){let i=this.transformIncoming(e,r);return this.provider.readdir(i)}async readFile(e,r,i){let o=this.transformIncoming(e,r,!0),s=await this.provider.readFile(o,i);return K.wrap(s)}onReadFileStream(e,r,i){let o=this.transformIncoming(e,r,!0),s=new rt,a=new S({onDidRemoveLastListener:()=>{s.cancel()}}),l=this.provider.readFileStream(o,i,s.token);return Ts(l,{onData:c=>a.fire(K.wrap(c)),onError:c=>a.fire(c),onEnd:()=>{a.fire("end"),a.dispose(),s.dispose()}}),a.event}writeFile(e,r,i,o){let s=this.transformIncoming(e,r);return this.provider.writeFile(s,i.buffer,o)}open(e,r,i){let o=this.transformIncoming(e,r,!0);return this.provider.open(o,i)}close(e){return this.provider.close(e)}async read(e,r,i){let o=K.alloc(i),a=await this.provider.read(e,r,o.buffer,0,i);return[o,a]}write(e,r,i,o,s){return this.provider.write(e,r,i.buffer,o,s)}mkdir(e,r){let i=this.transformIncoming(e,r);return this.provider.mkdir(i)}delete(e,r,i){let o=this.transformIncoming(e,r);return this.provider.delete(o,i)}rename(e,r,i,o){let s=this.transformIncoming(e,r),a=this.transformIncoming(e,i);return this.provider.rename(s,a,o)}copy(e,r,i,o){let s=this.transformIncoming(e,r),a=this.transformIncoming(e,i);return this.provider.copy(s,a,o)}cloneFile(e,r,i){let o=this.transformIncoming(e,r),s=this.transformIncoming(e,i);return this.provider.cloneFile(o,s)}sessionToWatcher=new Map;watchRequests=new Map;onFileChange(e,r){let i=new S({onWillAddFirstListener:()=>{this.sessionToWatcher.set(r,this.createSessionFileWatcher(e,i))},onDidRemoveLastListener:()=>{ze(this.sessionToWatcher.get(r)),this.sessionToWatcher.delete(r)}});return i.event}async watch(e,r,i,o,s){let a=this.sessionToWatcher.get(r);if(a){let l=this.transformIncoming(e,o),c=a.watch(i,l,s);this.watchRequests.set(r+i,c)}}async unwatch(e,r){let i=e+r,o=this.watchRequests.get(i);o&&(ze(o),this.watchRequests.delete(i))}dispose(){super.dispose();for(let[,e]of this.watchRequests)e.dispose();this.watchRequests.clear();for(let[,e]of this.sessionToWatcher)e.dispose();this.sessionToWatcher.clear()}},hf=class extends D{constructor(e,r,i,o){super();this.uriTransformer=e;this.logService=i;this.environmentService=o;this.registerListeners(r)}watcherRequests=new Map;fileWatcher=this._register(new Yi(this.logService,{watcher:{recursive:this.getRecursiveWatcherOptions(this.environmentService)}}));registerListeners(e){let r=this._register(new S);this._register(r.event(i=>{e.fire(i.map(o=>({resource:this.uriTransformer.transformOutgoingURI(o.resource),type:o.type,cId:o.cId})))})),this._register(this.fileWatcher.onDidChangeFile(i=>r.fire(i))),this._register(this.fileWatcher.onDidWatchError(i=>e.fire(i)))}getRecursiveWatcherOptions(e){}getExtraExcludes(e){}watch(e,r,i){let o=this.getExtraExcludes(this.environmentService);return Array.isArray(o)&&(i.excludes=[...i.excludes,...o]),this.watcherRequests.set(e,this.fileWatcher.watch(r,i)),$(()=>{ze(this.watcherRequests.get(e)),this.watcherRequests.delete(e)})}dispose(){for(let[,e]of this.watcherRequests)e.dispose();this.watcherRequests.clear(),super.dispose()}};var gf=class extends mf{constructor(e,r,i){super(e,r);this.environmentService=i}getUriTransformer(e){return o1}transformIncoming(e,r){return x.revive(r)}async delete(e,r,i){if(!i.useTrash)return super.delete(e,r,i);let o=this.transformIncoming(e,r),s=lt(o.fsPath);try{await nk.trashItem(s)}catch(a){throw pr(U?p("binFailed","Failed to move '{0}' to the recycle bin ({1})",pe(s),zt(a)):p("trashFailed","Failed to move '{0}' to the trash ({1})",pe(s),zt(a)),"Unknown")}}createSessionFileWatcher(e,r){return new ov(e,r,this.logService,this.environmentService)}},ov=class extends hf{watch(t,e,r){if(r.recursive)throw pr("Recursive file watching is not supported from main process for performance reasons.","Unavailable");return super.watch(t,e,r)}};var sv=F("issueService"),av=F("processService");import{BrowserWindow as w1,screen as Gc}from"electron";import{arch as Ck,release as kk,type as _k}from"os";import*as yf from"fs";import{exec as I1}from"child_process";import{app as qc,clipboard as Ho,Menu as $c,powerMonitor as hk,screen as jc,shell as zo,webContents as gk}from"electron";import{arch as vk,cpus as yk,freemem as Ik,loadavg as bk,platform as wk,release as Sk,totalmem as xk,type as Ek}from"os";import{promisify as b1}from"util";import{networkInterfaces as ak}from"os";import{networkInterfaces as ik}from"os";var ok=new Set(["00:00:00:00:00:00","ff:ff:ff:ff:ff:ff","ac:de:48:00:11:22"]);function sk(n){let t=n.replace(/\-/g,":").toLowerCase();return!ok.has(t)}function s1(){let n=ik();for(let t in n){let e=n[t];if(e){for(let{mac:r}of e)if(sk(r))return r}}throw new Error("Unable to retrieve mac address (unexpected format)")}var zc=new class{_virtualMachineOUIs;_value;_isVirtualMachineMacAddress(n){return this._virtualMachineOUIs||(this._virtualMachineOUIs=lr.forStrings(),this._virtualMachineOUIs.set("00-50-56",!0),this._virtualMachineOUIs.set("00-0C-29",!0),this._virtualMachineOUIs.set("00-05-69",!0),this._virtualMachineOUIs.set("00-03-FF",!0),this._virtualMachineOUIs.set("00-1C-42",!0),this._virtualMachineOUIs.set("00-16-3E",!0),this._virtualMachineOUIs.set("08-00-27",!0),this._virtualMachineOUIs.set("00:50:56",!0),this._virtualMachineOUIs.set("00:0C:29",!0),this._virtualMachineOUIs.set("00:05:69",!0),this._virtualMachineOUIs.set("00:03:FF",!0),this._virtualMachineOUIs.set("00:1C:42",!0),this._virtualMachineOUIs.set("00:16:3E",!0),this._virtualMachineOUIs.set("08:00:27",!0)),!!this._virtualMachineOUIs.findSubstr(n)}value(){if(this._value===void 0){let n=0,t=0,e=ak();for(let r in e){let i=e[r];if(i)for(let{mac:o,internal:s}of i)s||(t+=1,this._isVirtualMachineMacAddress(o.toUpperCase())&&(n+=1))}this._value=t>0?n/t:0}return this._value}},lv;async function a1(n){return lv||(lv=(async()=>await lk(n)||Ze())()),lv}async function lk(n){try{let t=await import("crypto"),e=s1();return t.createHash("sha256").update(e,"utf8").digest("hex")}catch(t){n(t);return}}var ck="Software\\Microsoft\\SQMClient";async function l1(n){if(U){let t=await import("@vscode/windows-registry");try{return t.GetStringRegKey("HKEY_LOCAL_MACHINE",ck,"MachineId")||""}catch(e){return n(e),""}}return""}async function c1(n){try{return await(await import("@vscode/deviceid")).getDeviceId()}catch(t){return n(t),""}}import*as vf from"net";function u1(n,t,e,r=1){let i=!1;return new Promise(o=>{let s=setTimeout(()=>{if(!i)return i=!0,o(0)},e);cv(n,t,r,a=>{if(!i)return i=!0,clearTimeout(s),o(a)})})}function cv(n,t,e,r){if(t===0)return r(0);let i=new vf.Socket;i.once("connect",()=>(d1(i),cv(n+e,t-1,e,r))),i.once("data",()=>{}),i.once("error",o=>(d1(i),o.code!=="ECONNREFUSED"?cv(n+e,t-1,e,r):r(n))),i.connect(n,"127.0.0.1")}var dv={1:!0,7:!0,9:!0,11:!0,13:!0,15:!0,17:!0,19:!0,20:!0,21:!0,22:!0,23:!0,25:!0,37:!0,42:!0,43:!0,53:!0,69:!0,77:!0,79:!0,87:!0,95:!0,101:!0,102:!0,103:!0,104:!0,109:!0,110:!0,111:!0,113:!0,115:!0,117:!0,119:!0,123:!0,135:!0,137:!0,139:!0,143:!0,161:!0,179:!0,389:!0,427:!0,465:!0,512:!0,513:!0,514:!0,515:!0,526:!0,530:!0,531:!0,532:!0,540:!0,548:!0,554:!0,556:!0,563:!0,587:!0,601:!0,636:!0,989:!0,990:!0,993:!0,995:!0,1719:!0,1720:!0,1723:!0,2049:!0,3659:!0,4045:!0,5060:!0,5061:!0,6e3:!0,6566:!0,6665:!0,6666:!0,6667:!0,6668:!0,6669:!0,6697:!0,10080:!0};function p1(n,t,e,r="127.0.0.1"){let i=!1,o,s=1,a=vf.createServer({pauseOnConnect:!0});function l(c,d){i||(i=!0,a.removeAllListeners(),a.close(),o&&clearTimeout(o),d(c))}return new Promise(c=>{o=setTimeout(()=>{l(0,c)},e),a.on("listening",()=>{l(n,c)}),a.on("error",d=>{d&&(d.code==="EADDRINUSE"||d.code==="EACCES")&&s<t?(n++,s++,a.listen(n,r)):l(0,c)}),a.on("close",()=>{l(0,c)}),a.listen(n,r)})}function d1(n){try{n.removeAllListeners("connect"),n.removeAllListeners("error"),n.end(),n.destroy(),n.unref()}catch(t){console.error(t)}}var Yde=F("IV8InspectProfilingService"),dk;(e=>{function n(r){return!!(r.samples&&r.timeDeltas)}e.isValidProfile=n;function t(r,i="noAbsolutePaths"){for(let o of r.nodes)o.callFrame&&o.callFrame.url&&(Lr(o.callFrame.url)||/^\w[\w\d+.-]*:\/\/\/?/.test(o.callFrame.url))&&(o.callFrame.url=V(i,pe(o.callFrame.url)));return r}e.rewriteAbsolutePaths=t})(dk||={});var Tue=F("nativeHostService");import*as f1 from"fs";import*as m1 from"os";import*as h1 from"child_process";import*as g1 from"path";var uv;async function v1(n=!1){return(uv===void 0||n)&&(uv=uk()),uv}async function uk(){let n=pk();if(n===void 0)return!1;if(n>=22e3){let t=fk();if(t)return new Promise(e=>{try{h1.execFile(t,["--status"],r=>e(!r))}catch{e(!1)}})}else{let t=mk();if(t)try{if((await f1.promises.stat(t)).isFile())return!0}catch{}}return!1}function pk(){let n=/(\d+)\.(\d+)\.(\d+)/g.exec(m1.release());if(n)return parseInt(n[3])}function y1(n){let t=process.env.SystemRoot;if(t){let e=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432");return g1.join(t,e?"Sysnative":"System32",n)}}function fk(){return y1("wsl.exe")}function mk(){return y1("lxss\\LxssManager.dll")}import"electron";var xa=class{constructor(t,e,r){this._window=t;this._sessionId=e;this._logService=r}async inspect(t){await this._connect();let e=this._window.webContents.debugger;await e.sendCommand("Profiler.start"),this._logService.warn("[perf] profiling STARTED",this._sessionId),await nt(t);let r=await e.sendCommand("Profiler.stop");return this._logService.warn("[perf] profiling DONE",this._sessionId),await this._disconnect(),r.profile}async _connect(){let t=this._window.webContents.debugger;t.attach(),await t.sendCommand("Profiler.enable")}async _disconnect(){let t=this._window.webContents.debugger;await t.sendCommand("Profiler.disable"),t.detach()}};xa=P([g(2,A)],xa);import"electron";var mi=F("auxiliaryWindowsMainService");var Cr=F("nativeHostMainService"),qo=class extends D{constructor(e,r,i,o,s,a,l,c,d,u,m,h){super();this.windowsMainService=e;this.auxiliaryWindowsMainService=r;this.dialogMainService=i;this.lifecycleMainService=o;this.environmentMainService=s;this.logService=a;this.productService=l;this.themeMainService=c;this.workspacesManagementMainService=d;this.configurationService=u;this.requestService=m;this.proxyAuthService=h}get windowId(){throw new Error("Not implemented in electron-main")}onDidOpenMainWindow=E.map(this.windowsMainService.onDidOpenWindow,e=>e.id);onDidTriggerWindowSystemContextMenu=E.any(E.map(this.windowsMainService.onDidTriggerSystemContextMenu,({window:e,x:r,y:i})=>({windowId:e.id,x:r,y:i})),E.map(this.auxiliaryWindowsMainService.onDidTriggerSystemContextMenu,({window:e,x:r,y:i})=>({windowId:e.id,x:r,y:i})));onDidMaximizeWindow=E.any(E.map(this.windowsMainService.onDidMaximizeWindow,e=>e.id),E.map(this.auxiliaryWindowsMainService.onDidMaximizeWindow,e=>e.id));onDidUnmaximizeWindow=E.any(E.map(this.windowsMainService.onDidUnmaximizeWindow,e=>e.id),E.map(this.auxiliaryWindowsMainService.onDidUnmaximizeWindow,e=>e.id));onDidChangeWindowFullScreen=E.any(E.map(this.windowsMainService.onDidChangeFullScreen,e=>({windowId:e.window.id,fullscreen:e.fullscreen})),E.map(this.auxiliaryWindowsMainService.onDidChangeFullScreen,e=>({windowId:e.window.id,fullscreen:e.fullscreen})));onDidBlurMainWindow=E.filter(E.fromNodeEventEmitter(qc,"browser-window-blur",(e,r)=>r.id),e=>!!this.windowsMainService.getWindowById(e));onDidFocusMainWindow=E.any(E.map(E.filter(E.map(this.windowsMainService.onDidChangeWindowsCount,()=>this.windowsMainService.getLastActiveWindow()),e=>!!e),e=>e.id),E.filter(E.fromNodeEventEmitter(qc,"browser-window-focus",(e,r)=>r.id),e=>!!this.windowsMainService.getWindowById(e)));onDidBlurMainOrAuxiliaryWindow=E.any(this.onDidBlurMainWindow,E.map(E.filter(E.fromNodeEventEmitter(qc,"browser-window-blur",(e,r)=>this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents)),e=>!!e),e=>e.id));onDidFocusMainOrAuxiliaryWindow=E.any(this.onDidFocusMainWindow,E.map(E.filter(E.fromNodeEventEmitter(qc,"browser-window-focus",(e,r)=>this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents)),e=>!!e),e=>e.id));onDidResumeOS=E.fromNodeEventEmitter(hk,"resume");onDidChangeColorScheme=this.themeMainService.onDidChangeColorScheme;_onDidChangePassword=this._register(new S);onDidChangePassword=this._onDidChangePassword.event;onDidChangeDisplay=E.debounce(E.any(E.filter(E.fromNodeEventEmitter(jc,"display-metrics-changed",(e,r,i)=>i),e=>!(Array.isArray(e)&&e.length===1&&e[0]==="workArea")),E.fromNodeEventEmitter(jc,"display-added"),E.fromNodeEventEmitter(jc,"display-removed")),()=>{},100);async getWindows(e,r){let i=this.windowsMainService.getWindows().map(s=>({id:s.id,workspace:s.openedWorkspace??Ri(s.backupPath,s.isExtensionDevelopmentHost),title:s.win?.getTitle()??"",filename:s.getRepresentedFilename(),dirty:s.isDocumentEdited()})),o=[];return r.includeAuxiliaryWindows&&o.push(...this.auxiliaryWindowsMainService.getWindows().map(s=>({id:s.id,parentId:s.parentId,title:s.win?.getTitle()??"",filename:s.getRepresentedFilename()}))),[...i,...o]}async getWindowCount(e){return this.windowsMainService.getWindowCount()}async getActiveWindowId(e){let r=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(r)return r.id}async getActiveWindowPosition(){let e=this.windowsMainService.getFocusedWindow()||this.windowsMainService.getLastActiveWindow();if(e)return e.getBounds()}openWindow(e,r,i){return Array.isArray(r)?this.doOpenWindow(e,r,i):this.doOpenEmptyWindow(e,r)}async doOpenWindow(e,r,i=Object.create(null)){r.length>0&&await this.windowsMainService.open({context:5,contextWindowId:e,urisToOpen:r,cli:this.environmentMainService.args,forceNewWindow:i.forceNewWindow,forceReuseWindow:i.forceReuseWindow,preferNewWindow:i.preferNewWindow,diffMode:i.diffMode,mergeMode:i.mergeMode,addMode:i.addMode,gotoLineMode:i.gotoLineMode,noRecentEntry:i.noRecentEntry,waitMarkerFileURI:i.waitMarkerFileURI,remoteAuthority:i.remoteAuthority||void 0,forceProfile:i.forceProfile,forceTempProfile:i.forceTempProfile})}async doOpenEmptyWindow(e,r){await this.windowsMainService.openEmptyWindow({context:5,contextWindowId:e},r)}async isFullScreen(e,r){return this.windowById(r?.targetWindowId,e)?.isFullScreen??!1}async toggleFullScreen(e,r){this.windowById(r?.targetWindowId,e)?.toggleFullScreen()}async handleTitleDoubleClick(e,r){this.windowById(r?.targetWindowId,e)?.handleTitleDoubleClick()}async getCursorScreenPoint(e){let r=jc.getCursorScreenPoint(),i=jc.getDisplayNearestPoint(r);return{point:r,display:i.bounds}}async isMaximized(e,r){return this.windowById(r?.targetWindowId,e)?.win?.isMaximized()??!1}async maximizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.maximize()}async unmaximizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.unmaximize()}async minimizeWindow(e,r){this.windowById(r?.targetWindowId,e)?.win?.minimize()}async moveWindowTop(e,r){this.windowById(r?.targetWindowId,e)?.win?.moveTop()}async positionWindow(e,r,i){let o=this.windowById(i?.targetWindowId,e);if(o?.win){if(o.win.isFullScreen()){let s=E.toPromise(E.once(E.fromNodeEventEmitter(o.win,"leave-full-screen")));o.win.setFullScreen(!1),await s}o.win.setBounds(r)}}async updateWindowControls(e,r){this.windowById(r?.targetWindowId,e)?.updateWindowControls(r)}async focusWindow(e,r){this.windowById(r?.targetWindowId,e)?.focus({force:r?.force??!1})}async setMinimumSize(e,r,i){let o=this.codeWindowById(e);if(o?.win){let[s,a]=o.win.getSize(),[l,c]=o.win.getMinimumSize(),[d,u]=[r??l,i??c],[m,h]=[Math.max(s,d),Math.max(a,u)];(l!==d||c!==u)&&o.win.setMinimumSize(d,u),(s!==m||a!==h)&&o.win.setSize(m,h)}}async saveWindowSplash(e,r){this.themeMainService.saveWindowSplash(e,r)}async installShellCommand(e){let{source:r,target:i}=await this.getShellCommandLink();try{let{symbolicLink:o}=await Pt.stat(r);if(o&&!o.dangling){let s=await n1(r);if(i===s)return}await yf.promises.unlink(r)}catch(o){if(o.code!=="ENOENT")throw o}try{await yf.promises.symlink(i,r)}catch(o){if(o.code!=="EACCES"&&o.code!=="ENOENT")throw o;let{response:s}=await this.showMessageBox(e,{type:"info",message:p("warnEscalation","{0} will now prompt with 'osascript' for Administrator privileges to install the shell command.",this.productService.nameShort),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]});if(s===1)throw new at;try{let a=`osascript -e "do shell script \\"mkdir -p /usr/local/bin && ln -sf '${i}' '${r}'\\" with administrator privileges"`;await b1(I1)(a)}catch{throw new Error(p("cantCreateBinFolder","Unable to install the shell command '{0}'.",r))}}}async uninstallShellCommand(e){let{source:r}=await this.getShellCommandLink();try{await yf.promises.unlink(r)}catch(i){switch(i.code){case"EACCES":{let{response:o}=await this.showMessageBox(e,{type:"info",message:p("warnEscalationUninstall","{0} will now prompt with 'osascript' for Administrator privileges to uninstall the shell command.",this.productService.nameShort),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]});if(o===1)throw new at;try{let s=`osascript -e "do shell script \\"rm '${r}'\\" with administrator privileges"`;await b1(I1)(s)}catch{throw new Error(p("cantUninstall","Unable to uninstall the shell command '{0}'.",r))}break}case"ENOENT":break;default:throw i}}}async getShellCommandLink(){let e=Sn(this.environmentMainService.appRoot,"bin","code"),r=`/usr/local/bin/${this.productService.applicationName}`;if(!await q.exists(e))throw new Error(p("sourceMissing","Unable to find shell script in '{0}'",e));return{source:r,target:e}}async showMessageBox(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showMessageBox(r,i?.win??void 0)}async showSaveDialog(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showSaveDialog(r,i?.win??void 0)}async showOpenDialog(e,r){let i=this.windowById(r?.targetWindowId,e);return this.dialogMainService.showOpenDialog(r,i?.win??void 0)}async pickFileFolderAndOpen(e,r){let i=await this.dialogMainService.pickFileFolder(r);i&&await this.doOpenPicked(await Promise.all(i.map(async o=>await Pt.existsDirectory(o)?{folderUri:x.file(o)}:{fileUri:x.file(o)})),r,e)}async pickFolderAndOpen(e,r){let i=await this.dialogMainService.pickFolder(r);i&&await this.doOpenPicked(i.map(o=>({folderUri:x.file(o)})),r,e)}async pickFileAndOpen(e,r){let i=await this.dialogMainService.pickFile(r);i&&await this.doOpenPicked(i.map(o=>({fileUri:x.file(o)})),r,e)}async pickWorkspaceAndOpen(e,r){let i=await this.dialogMainService.pickWorkspace(r);i&&await this.doOpenPicked(i.map(o=>({workspaceUri:x.file(o)})),r,e)}async doOpenPicked(e,r,i){await this.windowsMainService.open({context:3,contextWindowId:i,cli:this.environmentMainService.args,urisToOpen:e,forceNewWindow:r.forceNewWindow})}async showItemInFolder(e,r){zo.showItemInFolder(r)}async setRepresentedFilename(e,r,i){this.windowById(i?.targetWindowId,e)?.setRepresentedFilename(r)}async setDocumentEdited(e,r,i){this.windowById(i?.targetWindowId,e)?.setDocumentEdited(r)}async openExternal(e,r,i){this.environmentMainService.unsetSnapExportedVariables();try{wI(r,L.http,L.https)?this.openExternalBrowser(r,i):zo.openExternal(r)}finally{this.environmentMainService.restoreSnapExportedVariables()}return!0}async openExternalBrowser(e,r){let i=r??this.configurationService.getValue("workbench.externalBrowser");if(!i)return zo.openExternal(e);if((i.includes(ee.sep)||i.includes(He.sep))&&!await q.exists(i))return this.logService.error(`Configured external browser path does not exist: ${i}`),zo.openExternal(e);try{let{default:o}=await import("open");(await o(e,{app:{name:Object.hasOwn(o.apps,i)?o.apps[i]:i}})).stderr?.once("data",a=>(this.logService.error(`Error openening external URL '${e}' using browser '${i}': ${a.toString()}`),zo.openExternal(e)))}catch(o){return this.logService.error(`Unable to open external URL '${e}' using browser '${i}' due to ${o}.`),zo.openExternal(e)}}moveItemToTrash(e,r){return zo.trashItem(r)}async isAdmin(){let e;return U?e=(await import("native-is-elevated")).default():e=process.getuid?.()===0,e}async writeElevated(e,r,i,o){let s=await import("@vscode/sudo-prompt");return new Promise((a,l)=>{let c=[`"${this.cliPath}"`];o?.unlock&&c.push("--file-chmod"),c.push("--file-write",`"${r.fsPath}"`,`"${i.fsPath}"`);let d={name:this.productService.nameLong.replace("-",""),icns:W&&this.environmentMainService.isBuilt?V(Ne(this.environmentMainService.appRoot),`${this.productService.nameShort}.icns`):void 0};s.exec(c.join(" "),d,(u,m,h)=>{m&&this.logService.trace(`[sudo-prompt] received stdout: ${m}`),h&&this.logService.trace(`[sudo-prompt] received stderr: ${h}`),u?l(u):a(void 0)})})}async isRunningUnderARM64Translation(){return Q||U?!1:qc.runningUnderARM64Translation}get cliPath(){return U?this.environmentMainService.isBuilt?V(Ne(process.execPath),"bin",`${this.productService.applicationName}.cmd`):V(this.environmentMainService.appRoot,"scripts","code-cli.bat"):Q?this.environmentMainService.isBuilt?V(Ne(process.execPath),"bin",`${this.productService.applicationName}`):V(this.environmentMainService.appRoot,"scripts","code-cli.sh"):this.environmentMainService.isBuilt?V(this.environmentMainService.appRoot,"bin","code"):V(this.environmentMainService.appRoot,"scripts","code-cli.sh")}async getOSStatistics(){return{totalmem:xk(),freemem:Ik(),loadavg:bk()}}async getOSProperties(){return{arch:vk(),platform:wk(),release:Sk(),type:Ek(),cpus:yk()}}async getOSVirtualMachineHint(){return zc.value()}async getOSColorScheme(){return this.themeMainService.getColorScheme()}async hasWSLFeatureInstalled(){return U&&v1()}async getProcessId(e){return this.windowById(void 0,e)?.win?.webContents.getOSProcessId()}async killProcess(e,r,i){process.kill(r,i)}async readClipboardText(e,r){return Ho.readText(r)}async writeClipboardText(e,r,i){return Ho.writeText(r,i)}async readClipboardFindText(e){return Ho.readFindText()}async writeClipboardFindText(e,r){return Ho.writeFindText(r)}async writeClipboardBuffer(e,r,i,o){return Ho.writeBuffer(r,Buffer.from(i.buffer),o)}async readClipboardBuffer(e,r){return K.wrap(Ho.readBuffer(r))}async hasClipboard(e,r,i){return Ho.has(r,i)}async newWindowTab(){await this.windowsMainService.open({context:5,cli:this.environmentMainService.args,forceNewTabbedWindow:!0,forceEmpty:!0,remoteAuthority:this.environmentMainService.args.remote||void 0})}async showPreviousWindowTab(){$c.sendActionToFirstResponder("selectPreviousTab:")}async showNextWindowTab(){$c.sendActionToFirstResponder("selectNextTab:")}async moveWindowTabToNewWindow(){$c.sendActionToFirstResponder("moveTabToNewWindow:")}async mergeAllWindowTabs(){$c.sendActionToFirstResponder("mergeAllWindows:")}async toggleWindowTabsBar(){$c.sendActionToFirstResponder("toggleTabBar:")}async updateTouchBar(e,r){this.codeWindowById(e)?.updateTouchBar(r)}async notifyReady(e){this.codeWindowById(e)?.setReady()}async relaunch(e,r){return this.lifecycleMainService.relaunch(r)}async reload(e,r){let i=this.codeWindowById(e);if(i){if(Be(i.openedWorkspace)){let o=i.openedWorkspace.configPath;if(o.scheme===L.file&&(await this.workspacesManagementMainService.resolveLocalWorkspace(o))?.transient)return this.openWindow(i.id,{forceReuseWindow:!0})}return this.lifecycleMainService.reload(i,r?.disableExtensions!==void 0?{_:[],"disable-extensions":r.disableExtensions}:void 0)}}async closeWindow(e,r){return this.windowById(r?.targetWindowId,e)?.win?.close()}async quit(e){let r=this.windowsMainService.getLastActiveWindow();r?.isExtensionDevelopmentHost&&this.windowsMainService.getWindowCount()>1&&r.win?r.win.close():this.lifecycleMainService.quit()}async exit(e,r){await this.lifecycleMainService.kill(r)}async resolveProxy(e,r){if(this.environmentMainService.extensionTestsLocationURI){let s=this.configurationService.getValue("integration-test.http.proxy");if(s)return s}return this.codeWindowById(e)?.win?.webContents?.session?.resolveProxy(r)}async lookupAuthorization(e,r){return this.proxyAuthService.lookupAuthorization(r)}async lookupKerberosAuthorization(e,r){return this.requestService.lookupKerberosAuthorization(r)}async loadCertificates(e){return this.requestService.loadCertificates()}findFreePort(e,r,i,o,s=1){return u1(r,i,o,s)}async openDevTools(e,r){let i=this.windowById(r?.targetWindowId,e),o;Q&&Vi(this.configurationService)&&(o="bottom"),i?.win?.webContents.openDevTools(o?{mode:o}:void 0)}async toggleDevTools(e,r){let o=this.windowById(r?.targetWindowId,e)?.win?.webContents;o&&(Q&&Vi(this.configurationService)&&!o.isDevToolsOpened()?o.openDevTools({mode:"bottom"}):o.toggleDevTools())}async profileRenderer(e,r,i){let o=this.codeWindowById(e);if(!o||!o.win)throw new Error;return await new xa(o.win,r,this.logService).inspect(i)}async windowsGetStringRegKey(e,r,i,o){if(!U)return;let s=await import("@vscode/windows-registry");try{return s.GetStringRegKey(r,i,o)}catch{return}}windowById(e,r){return this.codeWindowById(e)??this.auxiliaryWindowById(e)??this.codeWindowById(r)}codeWindowById(e){if(typeof e=="number")return this.windowsMainService.getWindowById(e)}auxiliaryWindowById(e){if(typeof e!="number")return;let r=gk.fromId(e);if(r)return this.auxiliaryWindowsMainService.getWindowByWebContents(r)}};P([ie],qo.prototype,"cliPath",1),qo=P([g(0,Fe),g(1,mi),g(2,Gt),g(3,oe),g(4,ge),g(5,A),g(6,be),g(7,Un),g(8,Tr),g(9,ce),g(10,wr),g(11,Mc)],qo);var kr,pv=globalThis.vscode;if(typeof pv<"u"&&typeof pv.context<"u"){let n=pv.context.configuration();if(n)kr=n.product;else throw new Error("Sandbox: unable to resolve product configuration from preload script.")}else if(globalThis._VSCODE_PRODUCT_JSON&&globalThis._VSCODE_PACKAGE_JSON){if(kr=globalThis._VSCODE_PRODUCT_JSON,_t.VSCODE_DEV&&Object.assign(kr,{nameShort:`${kr.nameShort} Dev`,nameLong:`${kr.nameLong} Dev`,dataFolderName:`${kr.dataFolderName}-dev`,serverDataFolderName:kr.serverDataFolderName?`${kr.serverDataFolderName}-dev`:void 0}),!kr.version){let n=globalThis._VSCODE_PACKAGE_JSON;Object.assign(kr,{version:n.version})}}else kr={},Object.keys(kr).length===0&&Object.assign(kr,{version:"1.94.0-dev",nameShort:"Code - OSS Dev",nameLong:"Code - OSS Dev",applicationName:"code-oss",dataFolderName:".vscode-oss",urlProtocol:"code-oss",reportIssueUrl:"https://github.com/microsoft/vscode/issues/new",licenseName:"MIT",licenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt",serverLicenseUrl:"https://github.com/microsoft/vscode/blob/main/LICENSE.txt"});var nr=kr;import{spawn as Pk}from"child_process";import{relative as Tk}from"path";var Xi=F("ICSSDevelopmentService"),Ea=class{constructor(t,e){this.envService=t;this.logService=e}_cssModules;get isEnabled(){return!this.envService.isBuilt&&!0}getCssModules(){return this._cssModules??=this.computeCssModules(),this._cssModules}async computeCssModules(){if(!this.isEnabled)return[];let t=await import("@vscode/ripgrep");return await new Promise(e=>{let r=yr.create(),i=[],o=new TextDecoder,s=Re.asFileUri("").fsPath,a=Pk(t.rgPath,["-g","**/*.css","--files","--no-ignore",s],{});a.stdout.on("data",l=>{let c=o.decode(l,{stream:!0});i.push(c.split(`
`).filter(Boolean))}),a.on("error",l=>{this.logService.error("[CSS_DEV] FAILED to compute CSS data",l),e([])}),a.on("close",()=>{let l=i.flat().map(c=>Tk(s,c).replace(/\\/g,"/")).filter(Boolean).sort();e(l),this.logService.info(`[CSS_DEV] DONE, ${l.length} css modules (${Math.round(r.elapsed())}ms)`)})})}};Ea=P([g(0,dr),g(1,A)],Ea);var Zi=class{constructor(t,e,r,i,o,s,a,l){this.userEnv=t;this.environmentMainService=e;this.logService=r;this.dialogMainService=i;this.nativeHostMainService=o;this.protocolMainService=s;this.windowsMainService=a;this.cssDevelopmentService=l}static DEFAULT_BACKGROUND_COLOR="#1E1E1E";issueReporterWindow=null;issueReporterParentWindow=null;async openReporter(t){if(this.issueReporterWindow)this.issueReporterWindow&&this.focusWindow(this.issueReporterWindow);else if(this.issueReporterParentWindow=w1.getFocusedWindow(),this.issueReporterParentWindow){let e=new Y,r=e.add(this.protocolMainService.createIPCObjectUrl()),i=this.getWindowPosition(this.issueReporterParentWindow,700,800);this.issueReporterWindow=this.createBrowserWindow(i,r,{backgroundColor:t.styles.backgroundColor,title:p("issueReporter","Issue Reporter"),zoomLevel:t.zoomLevel,alwaysOnTop:!1},"issue-reporter"),r.update({appRoot:this.environmentMainService.appRoot,windowId:this.issueReporterWindow.id,userEnv:this.userEnv,data:t,disableExtensions:!!this.environmentMainService.disableExtensions,os:{type:_k(),arch:Ck(),release:kk()},product:nr,nls:{messages:jn(),language:tn()},cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0}),this.issueReporterWindow.loadURL(Re.asBrowserUri(`vs/workbench/contrib/issue/electron-sandbox/issueReporter${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0)),this.issueReporterWindow.on("close",()=>{this.issueReporterWindow=null,e.dispose()}),this.issueReporterParentWindow.on("closed",()=>{this.issueReporterWindow&&(this.issueReporterWindow.close(),this.issueReporterWindow=null,e.dispose())})}}async $reloadWithExtensionsDisabled(){if(this.issueReporterParentWindow)try{await this.nativeHostMainService.reload(this.issueReporterParentWindow.id,{disableExtensions:!0})}catch(t){this.logService.error(t)}}async $showConfirmCloseDialog(){if(this.issueReporterWindow){let{response:t}=await this.dialogMainService.showMessageBox({type:"warning",message:p("confirmCloseIssueReporter","Your input will not be saved. Are you sure you want to close this window?"),buttons:[p({key:"yes",comment:["&& denotes a mnemonic"]},"&&Yes"),p("cancel","Cancel")]},this.issueReporterWindow);t===0&&this.issueReporterWindow&&(this.issueReporterWindow.destroy(),this.issueReporterWindow=null)}}async $showClipboardDialog(){if(this.issueReporterWindow){let{response:t}=await this.dialogMainService.showMessageBox({type:"warning",message:p("issueReporterWriteToClipboard","There is too much data to send to GitHub directly. The data will be copied to the clipboard, please paste it into the GitHub issue page that is opened."),buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),p("cancel","Cancel")]},this.issueReporterWindow);return t===0}return!1}issueReporterWindowCheck(){if(!this.issueReporterParentWindow)throw new Error("Issue reporter window not available");let t=this.windowsMainService.getWindowById(this.issueReporterParentWindow.id);if(!t)throw new Error("Window not found");return t}async $sendReporterMenu(t,e){let r=this.issueReporterWindowCheck(),i="vscode:triggerReporterMenu",o=new rt;return r.sendWhenReady(i,o.token,{replyChannel:i,extensionId:t,extensionName:e}),await NI(new Promise(a=>_e.once(`vscode:triggerReporterMenuResponse:${t}`,(l,c)=>a(c))),5e3,()=>{this.logService.error(`Error: Extension ${t} timed out waiting for menu response`),o.cancel()})}async $closeReporter(){this.issueReporterWindow?.close()}focusWindow(t){t.isMinimized()&&t.restore(),t.focus()}createBrowserWindow(t,e,r,i){let o=new w1({fullscreen:!1,skipTaskbar:!1,resizable:!0,width:t.width,height:t.height,minWidth:300,minHeight:200,x:t.x,y:t.y,title:r.title,backgroundColor:r.backgroundColor||Zi.DEFAULT_BACKGROUND_COLOR,webPreferences:{preload:Re.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${e.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none",enableWebSQL:!1,spellcheck:!1,zoomFactor:ea(r.zoomLevel),sandbox:!0},alwaysOnTop:r.alwaysOnTop,experimentalDarkMode:!0});return o.setMenuBarVisibility(!1),o}getWindowPosition(t,e,r){let i,o=Gc.getAllDisplays();if(o.length===1)i=o[0];else{if(W){let l=Gc.getCursorScreenPoint();i=Gc.getDisplayNearestPoint(l)}!i&&t&&(i=Gc.getDisplayMatching(t.getBounds())),i||(i=Gc.getPrimaryDisplay()||o[0])}let s=i.bounds,a={width:e,height:r,x:s.x+s.width/2-e/2,y:s.y+s.height/2-r/2};return s.width>0&&s.height>0&&(a.x<s.x&&(a.x=s.x),a.y<s.y&&(a.y=s.y),a.x>s.x+s.width&&(a.x=s.x),a.y>s.y+s.height&&(a.y=s.y),a.width>s.width&&(a.width=s.width),a.height>s.height&&(a.height=s.height)),a}};Zi=P([g(1,ge),g(2,A),g(3,Gt),g(4,Cr),g(5,Wn),g(6,Fe),g(7,Xi)],Zi);import{BrowserWindow as fv,contentTracing as Rk,screen as Qc}from"electron";import{exec as If}from"child_process";function Jc(n){return new Promise((t,e)=>{let r,i=new Map;function o(l,c,d,u,m){let h=i.get(c);if(l===n||h){let y={name:s(d),cmd:d,pid:l,ppid:c,load:u,mem:m};i.set(l,y),l===n&&(r=y),h&&(h.children||(h.children=[]),h.children.push(y),h.children.length>1&&(h.children=h.children.sort((v,b)=>v.pid-b.pid)))}}function s(l){let c=/--utility-sub-type=network/i,d=/--crashes-directory/i,u=/\\pipe\\winpty-control/i,m=/conhost\.exe.+--headless/i,h=/--type=([a-zA-Z-]+)/;if(d.exec(l))return"electron-crash-reporter";if(u.exec(l))return"winpty-agent";if(m.exec(l))return"conpty-agent";let y=h.exec(l);if(y&&y.length===2)return y[1]==="renderer"?"window":y[1]==="utility"?c.exec(l)?"utility-network-service":"utility-process":y[1]==="extensionHost"?"extension-host":y[1];let v=/[a-zA-Z-]+\.js/g,b="";do y=v.exec(l),y&&(b+=y+" ");while(y);return b&&l.indexOf("node ")<0&&l.indexOf("node.exe")<0?`electron-nodejs (${b})`:l}if(process.platform==="win32"){let l=c=>c.indexOf("\\\\?\\")===0||c.indexOf("\\??\\")===0?c.substring(4):c.indexOf('"\\\\?\\')===0||c.indexOf('"\\??\\')===0?'"'+c.substring(5):c;import("@vscode/windows-process-tree").then(c=>{c.getProcessList(n,d=>{if(!d){e(new Error(`Root process ${n} not found`));return}c.getProcessCpuUsage(d,u=>{let m=new Map;u.forEach(h=>{let y=l(h.commandLine||"");m.set(h.pid,{name:s(y),cmd:y,pid:h.pid,ppid:h.ppid,load:h.cpu||0,mem:h.memory||0})}),r=m.get(n),r?(m.forEach(h=>{let y=m.get(h.ppid);y&&(y.children||(y.children=[]),y.children.push(h))}),m.forEach(h=>{h.children&&(h.children=h.children.sort((y,v)=>y.pid-v.pid))}),t(r)):e(new Error(`Root process ${n} not found`))})},c.ProcessDataFlag.CommandLine|c.ProcessDataFlag.Memory)})}else{let l=function(){let c=[r],d=[];for(;c.length;){let m=c.shift();m&&(d.push(m.pid),m.children&&(c=c.concat(m.children)))}let u=JSON.stringify(Re.asFileUri("vs/base/node/cpuUsage.sh").fsPath);u+=" "+d.join(" "),If(u,{},(m,h,y)=>{if(m||y)e(m||new Error(y.toString()));else{let v=h.toString().split(`
`);for(let b=0;b<d.length;b++){let C=i.get(d[b]);C.load=parseFloat(v[b])}if(!r){e(new Error(`Root process ${n} not found`));return}t(r)}})};var a=l;If("which ps",{},(c,d,u)=>{if(c||u)if(process.platform!=="linux")e(c||new Error(u.toString()));else{let m=JSON.stringify(Re.asFileUri("vs/base/node/ps.sh").fsPath);If(m,{},(h,y,v)=>{h||v?e(h||new Error(v.toString())):(S1(y,o),l())})}else{let m=d.toString().trim();If(`${m} -ax -o pid=,ppid=,pcpu=,pmem=,command=`,{maxBuffer:1e3*1024,env:{LC_NUMERIC:"en_US.UTF-8"}},(y,v,b)=>{y||b&&!b.includes("screen size is bogus")?e(y||new Error(b.toString())):(S1(v,o),process.platform==="linux"?l():r?t(r):e(new Error(`Root process ${n} not found`)))})}})}})}function S1(n,t){let e=/^\s*([0-9]+)\s+([0-9]+)\s+([0-9]+\.[0-9]+)\s+([0-9]+\.[0-9]+)\s+(.+)$/,r=n.toString().split(`
`);for(let i of r){let o=e.exec(i.trim());o&&o.length===6&&t(parseInt(o[1]),parseInt(o[2]),o[5],parseFloat(o[3]),parseFloat(o[4]))}}var x1="issue.processExplorerWindowState",eo=class{constructor(t,e,r,i,o,s,a,l,c,d,u){this.userEnv=t;this.environmentMainService=e;this.logService=r;this.diagnosticsService=i;this.diagnosticsMainService=o;this.dialogMainService=s;this.nativeHostMainService=a;this.protocolMainService=l;this.productService=c;this.stateService=d;this.cssDevelopmentService=u;this.registerListeners()}static DEFAULT_BACKGROUND_COLOR="#1E1E1E";processExplorerWindow=null;processExplorerParentWindow=null;registerListeners(){_e.on("vscode:listProcesses",async t=>{let e=[];try{e.push({name:p("local","Local"),rootProcess:await Jc(process.pid)}),(await this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!0})).forEach(i=>{Ac(i)?e.push({name:i.hostName,rootProcess:i}):i.processes&&e.push({name:i.hostName,rootProcess:i.processes})})}catch(r){this.logService.error(`Listing processes failed: ${r}`)}this.safeSend(t,"vscode:listProcessesResponse",e)}),_e.on("vscode:workbenchCommand",(t,e)=>{let{id:r,from:i,args:o}=e,s;switch(i){case"processExplorer":s=this.processExplorerParentWindow;break;default:throw new Error(`Unexpected command source: ${i}`)}s?.webContents.send("vscode:runAction",{id:r,from:i,args:o})}),_e.on("vscode:closeProcessExplorer",t=>{this.processExplorerWindow?.close()}),_e.on("vscode:pidToNameRequest",async t=>{let e=await this.diagnosticsMainService.getMainDiagnostics(),r=[];for(let i of e.windows)r.push([i.pid,`window [${i.id}] (${i.title})`]);for(let{pid:i,name:o}of At.getAll())r.push([i,o]);this.safeSend(t,"vscode:pidToNameResponse",r)})}async openProcessExplorer(t){if(!this.processExplorerWindow&&(this.processExplorerParentWindow=fv.getFocusedWindow(),this.processExplorerParentWindow)){let e=new Y,r=e.add(this.protocolMainService.createIPCObjectUrl()),i=this.stateService.getItem(x1,void 0),o=Dk(i)?i:this.getWindowPosition(this.processExplorerParentWindow,800,500);this.processExplorerWindow=this.createBrowserWindow(o,r,{backgroundColor:t.styles.backgroundColor,title:p("processExplorer","Process Explorer"),zoomLevel:t.zoomLevel,alwaysOnTop:!0},"process-explorer"),r.update({appRoot:this.environmentMainService.appRoot,windowId:this.processExplorerWindow.id,userEnv:this.userEnv,data:t,product:nr,nls:{messages:jn(),language:tn()},cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0}),this.processExplorerWindow.loadURL(Re.asBrowserUri(`vs/code/electron-sandbox/processExplorer/processExplorer${this.environmentMainService.isBuilt?"":"-dev"}.${"esm."}html`).toString(!0)),this.processExplorerWindow.on("close",()=>{this.processExplorerWindow=null,e.dispose()}),this.processExplorerParentWindow.on("close",()=>{this.processExplorerWindow&&(this.processExplorerWindow.close(),this.processExplorerWindow=null,e.dispose())});let s=()=>{if(!this.processExplorerWindow)return;let a=this.processExplorerWindow.getSize(),l=this.processExplorerWindow.getPosition();if(!a||!l)return;let c={width:a[0],height:a[1],x:l[0],y:l[1]};this.stateService.setItem(x1,c)};this.processExplorerWindow.on("moved",s),this.processExplorerWindow.on("resized",s)}this.processExplorerWindow&&this.focusWindow(this.processExplorerWindow)}focusWindow(t){t.isMinimized()&&t.restore(),t.focus()}getWindowPosition(t,e,r){let i,o=Qc.getAllDisplays();if(o.length===1)i=o[0];else{if(W){let l=Qc.getCursorScreenPoint();i=Qc.getDisplayNearestPoint(l)}!i&&t&&(i=Qc.getDisplayMatching(t.getBounds())),i||(i=Qc.getPrimaryDisplay()||o[0])}let s=i.bounds,a={width:e,height:r,x:s.x+s.width/2-e/2,y:s.y+s.height/2-r/2};return s.width>0&&s.height>0&&(a.x<s.x&&(a.x=s.x),a.y<s.y&&(a.y=s.y),a.x>s.x+s.width&&(a.x=s.x),a.y>s.y+s.height&&(a.y=s.y),a.width>s.width&&(a.width=s.width),a.height>s.height&&(a.height=s.height)),a}async stopTracing(){if(!this.environmentMainService.args.trace)return;let t=await Rk.stopRecording(`${bs(this.environmentMainService.userHome.fsPath,this.productService.applicationName)}.trace.txt`);await this.dialogMainService.showMessageBox({type:"info",message:p("trace.message","Successfully created the trace file"),detail:p("trace.detail",`Please create an issue and manually attach the following file:
{0}`,t),buttons:[p({key:"trace.ok",comment:["&& denotes a mnemonic"]},"&&OK")]},fv.getFocusedWindow()??void 0),this.nativeHostMainService.showItemInFolder(void 0,t)}async getSystemStatus(){let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!1,includeWorkspaceMetadata:!1})]);return this.diagnosticsService.getDiagnostics(t,e)}async $getSystemInfo(){let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!1,includeWorkspaceMetadata:!1})]);return await this.diagnosticsService.getSystemInfo(t,e)}async $getPerformanceInfo(){try{let[t,e]=await Promise.all([this.diagnosticsMainService.getMainDiagnostics(),this.diagnosticsMainService.getRemoteDiagnostics({includeProcesses:!0,includeWorkspaceMetadata:!0})]);return await this.diagnosticsService.getPerformanceInfo(t,e)}catch(t){throw this.logService.warn("issueService#getPerformanceInfo ",t.message),t}}createBrowserWindow(t,e,r,i){let o=new fv({fullscreen:!1,skipTaskbar:!1,resizable:!0,width:t.width,height:t.height,minWidth:300,minHeight:200,x:t.x,y:t.y,title:r.title,backgroundColor:r.backgroundColor||eo.DEFAULT_BACKGROUND_COLOR,webPreferences:{preload:Re.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload.js").fsPath,additionalArguments:[`--vscode-window-config=${e.resource.toString()}`],v8CacheOptions:this.environmentMainService.useCodeCache?"bypassHeatCheck":"none",enableWebSQL:!1,spellcheck:!1,zoomFactor:ea(r.zoomLevel),sandbox:!0},alwaysOnTop:r.alwaysOnTop,experimentalDarkMode:!0});return o.setMenuBarVisibility(!1),o}safeSend(t,e,...r){t.sender.isDestroyed()||t.sender.send(e,...r)}async closeProcessExplorer(){this.processExplorerWindow?.close()}};eo=P([g(1,ge),g(2,A),g(3,$p),g(4,Wc),g(5,Gt),g(6,Cr),g(7,Wn),g(8,be),g(9,et),g(10,Xi)],eo);function Dk(n){return typeof n!="object"||n===null?!1:"x"in n&&"y"in n&&"width"in n&&"height"in n}var Yc=class{_keyCodeToStr;_strToKeyCode;constructor(){this._keyCodeToStr=[],this._strToKeyCode=Object.create(null)}define(t,e){this._keyCodeToStr[t]=e,this._strToKeyCode[e.toLowerCase()]=t}keyCodeToStr(t){return this._keyCodeToStr[t]}strToKeyCode(t){return this._strToKeyCode[t.toLowerCase()]||0}},bf=new Yc,mv=new Yc,hv=new Yc,Ok=new Array(230),Fk={},Lk=[],Mk=Object.create(null),Ak=Object.create(null);var E1=[],gv=[];for(let n=0;n<=193;n++)E1[n]=-1;for(let n=0;n<=132;n++)gv[n]=-1;(function(){let n="",t=[[1,0,"None",0,"unknown",0,"VK_UNKNOWN",n,n],[1,1,"Hyper",0,n,0,n,n,n],[1,2,"Super",0,n,0,n,n,n],[1,3,"Fn",0,n,0,n,n,n],[1,4,"FnLock",0,n,0,n,n,n],[1,5,"Suspend",0,n,0,n,n,n],[1,6,"Resume",0,n,0,n,n,n],[1,7,"Turbo",0,n,0,n,n,n],[1,8,"Sleep",0,n,0,"VK_SLEEP",n,n],[1,9,"WakeUp",0,n,0,n,n,n],[0,10,"KeyA",31,"A",65,"VK_A",n,n],[0,11,"KeyB",32,"B",66,"VK_B",n,n],[0,12,"KeyC",33,"C",67,"VK_C",n,n],[0,13,"KeyD",34,"D",68,"VK_D",n,n],[0,14,"KeyE",35,"E",69,"VK_E",n,n],[0,15,"KeyF",36,"F",70,"VK_F",n,n],[0,16,"KeyG",37,"G",71,"VK_G",n,n],[0,17,"KeyH",38,"H",72,"VK_H",n,n],[0,18,"KeyI",39,"I",73,"VK_I",n,n],[0,19,"KeyJ",40,"J",74,"VK_J",n,n],[0,20,"KeyK",41,"K",75,"VK_K",n,n],[0,21,"KeyL",42,"L",76,"VK_L",n,n],[0,22,"KeyM",43,"M",77,"VK_M",n,n],[0,23,"KeyN",44,"N",78,"VK_N",n,n],[0,24,"KeyO",45,"O",79,"VK_O",n,n],[0,25,"KeyP",46,"P",80,"VK_P",n,n],[0,26,"KeyQ",47,"Q",81,"VK_Q",n,n],[0,27,"KeyR",48,"R",82,"VK_R",n,n],[0,28,"KeyS",49,"S",83,"VK_S",n,n],[0,29,"KeyT",50,"T",84,"VK_T",n,n],[0,30,"KeyU",51,"U",85,"VK_U",n,n],[0,31,"KeyV",52,"V",86,"VK_V",n,n],[0,32,"KeyW",53,"W",87,"VK_W",n,n],[0,33,"KeyX",54,"X",88,"VK_X",n,n],[0,34,"KeyY",55,"Y",89,"VK_Y",n,n],[0,35,"KeyZ",56,"Z",90,"VK_Z",n,n],[0,36,"Digit1",22,"1",49,"VK_1",n,n],[0,37,"Digit2",23,"2",50,"VK_2",n,n],[0,38,"Digit3",24,"3",51,"VK_3",n,n],[0,39,"Digit4",25,"4",52,"VK_4",n,n],[0,40,"Digit5",26,"5",53,"VK_5",n,n],[0,41,"Digit6",27,"6",54,"VK_6",n,n],[0,42,"Digit7",28,"7",55,"VK_7",n,n],[0,43,"Digit8",29,"8",56,"VK_8",n,n],[0,44,"Digit9",30,"9",57,"VK_9",n,n],[0,45,"Digit0",21,"0",48,"VK_0",n,n],[1,46,"Enter",3,"Enter",13,"VK_RETURN",n,n],[1,47,"Escape",9,"Escape",27,"VK_ESCAPE",n,n],[1,48,"Backspace",1,"Backspace",8,"VK_BACK",n,n],[1,49,"Tab",2,"Tab",9,"VK_TAB",n,n],[1,50,"Space",10,"Space",32,"VK_SPACE",n,n],[0,51,"Minus",88,"-",189,"VK_OEM_MINUS","-","OEM_MINUS"],[0,52,"Equal",86,"=",187,"VK_OEM_PLUS","=","OEM_PLUS"],[0,53,"BracketLeft",92,"[",219,"VK_OEM_4","[","OEM_4"],[0,54,"BracketRight",94,"]",221,"VK_OEM_6","]","OEM_6"],[0,55,"Backslash",93,"\\",220,"VK_OEM_5","\\","OEM_5"],[0,56,"IntlHash",0,n,0,n,n,n],[0,57,"Semicolon",85,";",186,"VK_OEM_1",";","OEM_1"],[0,58,"Quote",95,"'",222,"VK_OEM_7","'","OEM_7"],[0,59,"Backquote",91,"`",192,"VK_OEM_3","`","OEM_3"],[0,60,"Comma",87,",",188,"VK_OEM_COMMA",",","OEM_COMMA"],[0,61,"Period",89,".",190,"VK_OEM_PERIOD",".","OEM_PERIOD"],[0,62,"Slash",90,"/",191,"VK_OEM_2","/","OEM_2"],[1,63,"CapsLock",8,"CapsLock",20,"VK_CAPITAL",n,n],[1,64,"F1",59,"F1",112,"VK_F1",n,n],[1,65,"F2",60,"F2",113,"VK_F2",n,n],[1,66,"F3",61,"F3",114,"VK_F3",n,n],[1,67,"F4",62,"F4",115,"VK_F4",n,n],[1,68,"F5",63,"F5",116,"VK_F5",n,n],[1,69,"F6",64,"F6",117,"VK_F6",n,n],[1,70,"F7",65,"F7",118,"VK_F7",n,n],[1,71,"F8",66,"F8",119,"VK_F8",n,n],[1,72,"F9",67,"F9",120,"VK_F9",n,n],[1,73,"F10",68,"F10",121,"VK_F10",n,n],[1,74,"F11",69,"F11",122,"VK_F11",n,n],[1,75,"F12",70,"F12",123,"VK_F12",n,n],[1,76,"PrintScreen",0,n,0,n,n,n],[1,77,"ScrollLock",84,"ScrollLock",145,"VK_SCROLL",n,n],[1,78,"Pause",7,"PauseBreak",19,"VK_PAUSE",n,n],[1,79,"Insert",19,"Insert",45,"VK_INSERT",n,n],[1,80,"Home",14,"Home",36,"VK_HOME",n,n],[1,81,"PageUp",11,"PageUp",33,"VK_PRIOR",n,n],[1,82,"Delete",20,"Delete",46,"VK_DELETE",n,n],[1,83,"End",13,"End",35,"VK_END",n,n],[1,84,"PageDown",12,"PageDown",34,"VK_NEXT",n,n],[1,85,"ArrowRight",17,"RightArrow",39,"VK_RIGHT","Right",n],[1,86,"ArrowLeft",15,"LeftArrow",37,"VK_LEFT","Left",n],[1,87,"ArrowDown",18,"DownArrow",40,"VK_DOWN","Down",n],[1,88,"ArrowUp",16,"UpArrow",38,"VK_UP","Up",n],[1,89,"NumLock",83,"NumLock",144,"VK_NUMLOCK",n,n],[1,90,"NumpadDivide",113,"NumPad_Divide",111,"VK_DIVIDE",n,n],[1,91,"NumpadMultiply",108,"NumPad_Multiply",106,"VK_MULTIPLY",n,n],[1,92,"NumpadSubtract",111,"NumPad_Subtract",109,"VK_SUBTRACT",n,n],[1,93,"NumpadAdd",109,"NumPad_Add",107,"VK_ADD",n,n],[1,94,"NumpadEnter",3,n,0,n,n,n],[1,95,"Numpad1",99,"NumPad1",97,"VK_NUMPAD1",n,n],[1,96,"Numpad2",100,"NumPad2",98,"VK_NUMPAD2",n,n],[1,97,"Numpad3",101,"NumPad3",99,"VK_NUMPAD3",n,n],[1,98,"Numpad4",102,"NumPad4",100,"VK_NUMPAD4",n,n],[1,99,"Numpad5",103,"NumPad5",101,"VK_NUMPAD5",n,n],[1,100,"Numpad6",104,"NumPad6",102,"VK_NUMPAD6",n,n],[1,101,"Numpad7",105,"NumPad7",103,"VK_NUMPAD7",n,n],[1,102,"Numpad8",106,"NumPad8",104,"VK_NUMPAD8",n,n],[1,103,"Numpad9",107,"NumPad9",105,"VK_NUMPAD9",n,n],[1,104,"Numpad0",98,"NumPad0",96,"VK_NUMPAD0",n,n],[1,105,"NumpadDecimal",112,"NumPad_Decimal",110,"VK_DECIMAL",n,n],[0,106,"IntlBackslash",97,"OEM_102",226,"VK_OEM_102",n,n],[1,107,"ContextMenu",58,"ContextMenu",93,n,n,n],[1,108,"Power",0,n,0,n,n,n],[1,109,"NumpadEqual",0,n,0,n,n,n],[1,110,"F13",71,"F13",124,"VK_F13",n,n],[1,111,"F14",72,"F14",125,"VK_F14",n,n],[1,112,"F15",73,"F15",126,"VK_F15",n,n],[1,113,"F16",74,"F16",127,"VK_F16",n,n],[1,114,"F17",75,"F17",128,"VK_F17",n,n],[1,115,"F18",76,"F18",129,"VK_F18",n,n],[1,116,"F19",77,"F19",130,"VK_F19",n,n],[1,117,"F20",78,"F20",131,"VK_F20",n,n],[1,118,"F21",79,"F21",132,"VK_F21",n,n],[1,119,"F22",80,"F22",133,"VK_F22",n,n],[1,120,"F23",81,"F23",134,"VK_F23",n,n],[1,121,"F24",82,"F24",135,"VK_F24",n,n],[1,122,"Open",0,n,0,n,n,n],[1,123,"Help",0,n,0,n,n,n],[1,124,"Select",0,n,0,n,n,n],[1,125,"Again",0,n,0,n,n,n],[1,126,"Undo",0,n,0,n,n,n],[1,127,"Cut",0,n,0,n,n,n],[1,128,"Copy",0,n,0,n,n,n],[1,129,"Paste",0,n,0,n,n,n],[1,130,"Find",0,n,0,n,n,n],[1,131,"AudioVolumeMute",117,"AudioVolumeMute",173,"VK_VOLUME_MUTE",n,n],[1,132,"AudioVolumeUp",118,"AudioVolumeUp",175,"VK_VOLUME_UP",n,n],[1,133,"AudioVolumeDown",119,"AudioVolumeDown",174,"VK_VOLUME_DOWN",n,n],[1,134,"NumpadComma",110,"NumPad_Separator",108,"VK_SEPARATOR",n,n],[0,135,"IntlRo",115,"ABNT_C1",193,"VK_ABNT_C1",n,n],[1,136,"KanaMode",0,n,0,n,n,n],[0,137,"IntlYen",0,n,0,n,n,n],[1,138,"Convert",0,n,0,n,n,n],[1,139,"NonConvert",0,n,0,n,n,n],[1,140,"Lang1",0,n,0,n,n,n],[1,141,"Lang2",0,n,0,n,n,n],[1,142,"Lang3",0,n,0,n,n,n],[1,143,"Lang4",0,n,0,n,n,n],[1,144,"Lang5",0,n,0,n,n,n],[1,145,"Abort",0,n,0,n,n,n],[1,146,"Props",0,n,0,n,n,n],[1,147,"NumpadParenLeft",0,n,0,n,n,n],[1,148,"NumpadParenRight",0,n,0,n,n,n],[1,149,"NumpadBackspace",0,n,0,n,n,n],[1,150,"NumpadMemoryStore",0,n,0,n,n,n],[1,151,"NumpadMemoryRecall",0,n,0,n,n,n],[1,152,"NumpadMemoryClear",0,n,0,n,n,n],[1,153,"NumpadMemoryAdd",0,n,0,n,n,n],[1,154,"NumpadMemorySubtract",0,n,0,n,n,n],[1,155,"NumpadClear",131,"Clear",12,"VK_CLEAR",n,n],[1,156,"NumpadClearEntry",0,n,0,n,n,n],[1,0,n,5,"Ctrl",17,"VK_CONTROL",n,n],[1,0,n,4,"Shift",16,"VK_SHIFT",n,n],[1,0,n,6,"Alt",18,"VK_MENU",n,n],[1,0,n,57,"Meta",91,"VK_COMMAND",n,n],[1,157,"ControlLeft",5,n,0,"VK_LCONTROL",n,n],[1,158,"ShiftLeft",4,n,0,"VK_LSHIFT",n,n],[1,159,"AltLeft",6,n,0,"VK_LMENU",n,n],[1,160,"MetaLeft",57,n,0,"VK_LWIN",n,n],[1,161,"ControlRight",5,n,0,"VK_RCONTROL",n,n],[1,162,"ShiftRight",4,n,0,"VK_RSHIFT",n,n],[1,163,"AltRight",6,n,0,"VK_RMENU",n,n],[1,164,"MetaRight",57,n,0,"VK_RWIN",n,n],[1,165,"BrightnessUp",0,n,0,n,n,n],[1,166,"BrightnessDown",0,n,0,n,n,n],[1,167,"MediaPlay",0,n,0,n,n,n],[1,168,"MediaRecord",0,n,0,n,n,n],[1,169,"MediaFastForward",0,n,0,n,n,n],[1,170,"MediaRewind",0,n,0,n,n,n],[1,171,"MediaTrackNext",124,"MediaTrackNext",176,"VK_MEDIA_NEXT_TRACK",n,n],[1,172,"MediaTrackPrevious",125,"MediaTrackPrevious",177,"VK_MEDIA_PREV_TRACK",n,n],[1,173,"MediaStop",126,"MediaStop",178,"VK_MEDIA_STOP",n,n],[1,174,"Eject",0,n,0,n,n,n],[1,175,"MediaPlayPause",127,"MediaPlayPause",179,"VK_MEDIA_PLAY_PAUSE",n,n],[1,176,"MediaSelect",128,"LaunchMediaPlayer",181,"VK_MEDIA_LAUNCH_MEDIA_SELECT",n,n],[1,177,"LaunchMail",129,"LaunchMail",180,"VK_MEDIA_LAUNCH_MAIL",n,n],[1,178,"LaunchApp2",130,"LaunchApp2",183,"VK_MEDIA_LAUNCH_APP2",n,n],[1,179,"LaunchApp1",0,n,0,"VK_MEDIA_LAUNCH_APP1",n,n],[1,180,"SelectTask",0,n,0,n,n,n],[1,181,"LaunchScreenSaver",0,n,0,n,n,n],[1,182,"BrowserSearch",120,"BrowserSearch",170,"VK_BROWSER_SEARCH",n,n],[1,183,"BrowserHome",121,"BrowserHome",172,"VK_BROWSER_HOME",n,n],[1,184,"BrowserBack",122,"BrowserBack",166,"VK_BROWSER_BACK",n,n],[1,185,"BrowserForward",123,"BrowserForward",167,"VK_BROWSER_FORWARD",n,n],[1,186,"BrowserStop",0,n,0,"VK_BROWSER_STOP",n,n],[1,187,"BrowserRefresh",0,n,0,"VK_BROWSER_REFRESH",n,n],[1,188,"BrowserFavorites",0,n,0,"VK_BROWSER_FAVORITES",n,n],[1,189,"ZoomToggle",0,n,0,n,n,n],[1,190,"MailReply",0,n,0,n,n,n],[1,191,"MailForward",0,n,0,n,n,n],[1,192,"MailSend",0,n,0,n,n,n],[1,0,n,114,"KeyInComposition",229,n,n,n],[1,0,n,116,"ABNT_C2",194,"VK_ABNT_C2",n,n],[1,0,n,96,"OEM_8",223,"VK_OEM_8",n,n],[1,0,n,0,n,0,"VK_KANA",n,n],[1,0,n,0,n,0,"VK_HANGUL",n,n],[1,0,n,0,n,0,"VK_JUNJA",n,n],[1,0,n,0,n,0,"VK_FINAL",n,n],[1,0,n,0,n,0,"VK_HANJA",n,n],[1,0,n,0,n,0,"VK_KANJI",n,n],[1,0,n,0,n,0,"VK_CONVERT",n,n],[1,0,n,0,n,0,"VK_NONCONVERT",n,n],[1,0,n,0,n,0,"VK_ACCEPT",n,n],[1,0,n,0,n,0,"VK_MODECHANGE",n,n],[1,0,n,0,n,0,"VK_SELECT",n,n],[1,0,n,0,n,0,"VK_PRINT",n,n],[1,0,n,0,n,0,"VK_EXECUTE",n,n],[1,0,n,0,n,0,"VK_SNAPSHOT",n,n],[1,0,n,0,n,0,"VK_HELP",n,n],[1,0,n,0,n,0,"VK_APPS",n,n],[1,0,n,0,n,0,"VK_PROCESSKEY",n,n],[1,0,n,0,n,0,"VK_PACKET",n,n],[1,0,n,0,n,0,"VK_DBE_SBCSCHAR",n,n],[1,0,n,0,n,0,"VK_DBE_DBCSCHAR",n,n],[1,0,n,0,n,0,"VK_ATTN",n,n],[1,0,n,0,n,0,"VK_CRSEL",n,n],[1,0,n,0,n,0,"VK_EXSEL",n,n],[1,0,n,0,n,0,"VK_EREOF",n,n],[1,0,n,0,n,0,"VK_PLAY",n,n],[1,0,n,0,n,0,"VK_ZOOM",n,n],[1,0,n,0,n,0,"VK_NONAME",n,n],[1,0,n,0,n,0,"VK_PA1",n,n],[1,0,n,0,n,0,"VK_OEM_CLEAR",n,n]],e=[],r=[];for(let i of t){let[o,s,a,l,c,d,u,m,h]=i;if(r[s]||(r[s]=!0,Lk[s]=a,Mk[a]=s,Ak[a.toLowerCase()]=s,o&&(E1[s]=l,l!==0&&l!==3&&l!==5&&l!==4&&l!==6&&l!==57&&(gv[l]=s))),!e[l]){if(e[l]=!0,!c)throw new Error(`String representation missing for key code ${l} around scan code ${a}`);bf.define(l,c),mv.define(l,m||c),hv.define(l,h||m||c)}d&&(Ok[d]=l),u&&(Fk[u]=l)}gv[3]=46})();var Wk;(s=>{function n(a){return bf.keyCodeToStr(a)}s.toString=n;function t(a){return bf.strToKeyCode(a)}s.fromString=t;function e(a){return mv.keyCodeToStr(a)}s.toUserSettingsUS=e;function r(a){return hv.keyCodeToStr(a)}s.toUserSettingsGeneral=r;function i(a){return mv.strToKeyCode(a)||hv.strToKeyCode(a)}s.fromUserSettings=i;function o(a){if(a>=98&&a<=113)return null;switch(a){case 16:return"Up";case 18:return"Down";case 15:return"Left";case 17:return"Right"}return bf.keyCodeToStr(a)}s.toElectronAccelerator=o})(Wk||={});var Mhe=F("keybindingService");var Xhe=F("keyboardLayoutService");var vv=F("keyboardLayoutMainService"),Pa=class extends D{_onDidChangeKeyboardLayout=this._register(new S);onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;_initPromise;_keyboardLayoutData;constructor(t){super(),this._initPromise=null,this._keyboardLayoutData=null,t.when(3).then(()=>this._initialize())}_initialize(){return this._initPromise||(this._initPromise=this._doInitialize()),this._initPromise}async _doInitialize(){let t=await import("native-keymap");this._keyboardLayoutData=P1(t),Iy||t.onDidChangeKeyboardLayout(()=>{this._keyboardLayoutData=P1(t),this._onDidChangeKeyboardLayout.fire(this._keyboardLayoutData)})}async getKeyboardLayoutData(){return await this._initialize(),this._keyboardLayoutData}};Pa=P([g(0,oe)],Pa);function P1(n){let t=n.getKeyMap(),e=n.getCurrentKeyboardLayout();return{keyboardMapping:t,keyboardLayoutInfo:e}}import{app as Nk}from"electron";var Ta=F("urlService");var Bk="launchMainService",yv=F(Bk),Ca=class{constructor(t,e,r,i){this.logService=t;this.windowsMainService=e;this.urlService=r;this.configurationService=i}async start(t,e){this.logService.trace("Received data from other instance: ",t,e),W&&Nk.focus({steal:!0});let r=this.parseOpenUrl(t);if(r.length){let i=Promise.resolve();if(this.windowsMainService.getWindowCount()===0){let o=(await this.windowsMainService.openEmptyWindow({context:4})).at(0);o&&(i=o.ready())}i.then(()=>{for(let{uri:o,originalUrl:s}of r)this.urlService.open(o,{originalUrl:s})})}else return this.startOpenWindow(t,e)}parseOpenUrl(t){return t["open-url"]&&t._urls&&t._urls.length>0?Ye(t._urls.map(e=>{try{return{uri:x.parse(e),originalUrl:e}}catch{return null}})):[]}async startOpenWindow(t,e){let r=mn(e)?0:4,i=[],o=t.wait&&t.waitMarkerFilePath?x.file(t.waitMarkerFilePath):void 0,s=t.remote||void 0,a={context:r,cli:t,userEnv:t["preserve-env"]||r===0?e:void 0,waitMarkerFileURI:o,remoteAuthority:s,forceProfile:t.profile,forceTempProfile:t["profile-temp"]};if(t.extensionDevelopmentPath)await this.windowsMainService.openExtensionDevelopmentHostWindow(t.extensionDevelopmentPath,a);else if(!t._.length&&!t["folder-uri"]&&!t["file-uri"]){let l=!1;if(t["new-window"]||a.forceProfile||a.forceTempProfile)l=!0;else if(t["reuse-window"])l=!1;else switch(this.configurationService.getValue("window")?.openWithoutArgumentsInNewWindow||"default"){case"on":l=!0;break;case"off":l=!1;break;default:l=!W}if(l)i=await this.windowsMainService.open({...a,forceNewWindow:!0,forceEmpty:!0});else{let c=this.windowsMainService.getLastActiveWindow();c?(this.windowsMainService.openExistingWindow(c,a),i=[c]):i=await this.windowsMainService.open({...a,forceEmpty:!0})}}else i=await this.windowsMainService.open({...a,forceNewWindow:t["new-window"],preferNewWindow:!t["reuse-window"]&&!t.wait,forceReuseWindow:t["reuse-window"],diffMode:t.diff,mergeMode:t.merge,addMode:t.add,noRecentEntry:!!t["skip-add-to-recently-opened"],gotoLineMode:t.goto});if(o&&i.length===1&&i[0])return Promise.race([i[0].whenClosedOrLoaded,YI(o.fsPath)]).then(()=>{},()=>{})}async getMainProcessId(){return this.logService.trace("Received request for process ID from other instance."),process.pid}};Ca=P([g(0,A),g(1,Fe),g(2,Ta),g(3,ce)],Ca);function Iv(n){return n.submenu!==void 0}function bv(n){return n.id==="vscode.menubar.separator"}function wv(n){return n.uri!==void 0}function T1(n){return!Iv(n)&&!bv(n)&&!wv(n)}import{app as Vk,BrowserWindow as wf,Menu as wt,MenuItem as Me}from"electron";var me={Uninitialized:{type:"uninitialized"},Disabled:n=>({type:"disabled",reason:n}),Idle:(n,t)=>({type:"idle",updateType:n,error:t}),CheckingForUpdates:n=>({type:"checking for updates",explicit:n}),AvailableForDownload:n=>({type:"available for download",update:n}),Downloading:{type:"downloading"},Downloaded:n=>({type:"downloaded",update:n}),Updating:n=>({type:"updating",update:n}),Ready:n=>({type:"ready",update:n})},to=F("updateService");import{app as $o}from"electron";var ro=F("workspacesHistoryMainService"),Wt=class extends D{constructor(e,r,i,o,s){super();this.logService=e;this.workspacesManagementMainService=r;this.lifecycleMainService=i;this.applicationStorageMainService=o;this.dialogMainService=s;this.registerListeners()}static MAX_TOTAL_RECENT_ENTRIES=500;static RECENTLY_OPENED_STORAGE_KEY="history.recentlyOpenedPathsList";_onDidChangeRecentlyOpened=this._register(new S);onDidChangeRecentlyOpened=this._onDidChangeRecentlyOpened.event;registerListeners(){this.lifecycleMainService.when(4).then(()=>this.handleWindowsJumpList()),this._register(this.workspacesManagementMainService.onDidEnterWorkspace(e=>this.addRecentlyOpened([{workspace:e.workspace,remoteAuthority:e.window.remoteAuthority}])))}async addRecentlyOpened(e){let r=[],i=[];for(let s of e)if(Fp(s))!this.workspacesManagementMainService.isUntitledWorkspace(s.workspace)&&!this.containsWorkspace(r,s.workspace)&&r.push(s);else if(_c(s))this.containsFolder(r,s.folderUri)||r.push(s);else{let a=this.containsFile(i,s.fileUri),l=s.fileUri.scheme===L.file&&Wt.COMMON_FILES_FILTER.indexOf(cr(s.fileUri))>=0;!a&&!l&&(i.push(s),U&&s.fileUri.scheme===L.file&&$o.addRecentDocument(s.fileUri.fsPath))}let o=await this.mergeEntriesFromStorage({workspaces:r,files:i});r=o.workspaces,i=o.files,r.length>Wt.MAX_TOTAL_RECENT_ENTRIES&&(r.length=Wt.MAX_TOTAL_RECENT_ENTRIES),i.length>Wt.MAX_TOTAL_RECENT_ENTRIES&&(i.length=Wt.MAX_TOTAL_RECENT_ENTRIES),await this.saveRecentlyOpened({workspaces:r,files:i}),this._onDidChangeRecentlyOpened.fire(),W&&this.macOSRecentDocumentsUpdater.trigger(()=>this.updateMacOSRecentDocuments())}async removeRecentlyOpened(e){let r=a=>{let l=this.location(a);for(let c of e)if(Le.isEqual(c,l))return!1;return!0},i=await this.getRecentlyOpened(),o=i.workspaces.filter(r),s=i.files.filter(r);(o.length!==i.workspaces.length||s.length!==i.files.length)&&(await this.saveRecentlyOpened({files:s,workspaces:o}),this._onDidChangeRecentlyOpened.fire(),W&&this.macOSRecentDocumentsUpdater.trigger(()=>this.updateMacOSRecentDocuments()))}async clearRecentlyOpened(e){if(e?.confirm){let{response:r}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"clearButtonLabel",comment:["&& denotes a mnemonic"]},"&&Clear"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&Cancel")],message:p("confirmClearRecentsMessage","Do you want to clear all recently opened files and workspaces?"),detail:p("confirmClearDetail","This action is irreversible!"),cancelId:1});if(r!==0)return}await this.saveRecentlyOpened({workspaces:[],files:[]}),$o.clearRecentDocuments(),this._onDidChangeRecentlyOpened.fire()}async getRecentlyOpened(){return this.mergeEntriesFromStorage()}async mergeEntriesFromStorage(e){let r=new Ue(s=>Le.getComparisonKey(s));if(e?.workspaces)for(let s of e.workspaces)r.set(this.location(s),s);let i=new Ue(s=>Le.getComparisonKey(s));if(e?.files)for(let s of e.files)i.set(this.location(s),s);let o=await this.getRecentlyOpenedFromStorage();for(let s of o.workspaces){let a=r.get(this.location(s));a?a.label=a.label??s.label:r.set(this.location(s),s)}for(let s of o.files){let a=i.get(this.location(s));a?a.label=a.label??s.label:i.set(this.location(s),s)}return{workspaces:[...r.values()],files:[...i.values()]}}async getRecentlyOpenedFromStorage(){await this.applicationStorageMainService.whenReady;let e,r=this.applicationStorageMainService.get(Wt.RECENTLY_OPENED_STORAGE_KEY,-1);if(typeof r=="string")try{e=JSON.parse(r)}catch(i){this.logService.error("Unexpected error parsing opened paths list",i)}return FS(e,this.logService)}async saveRecentlyOpened(e){await this.applicationStorageMainService.whenReady,this.applicationStorageMainService.store(Wt.RECENTLY_OPENED_STORAGE_KEY,JSON.stringify(LS(e)),-1,1)}location(e){return _c(e)?e.folderUri:CS(e)?e.fileUri:e.workspace.configPath}containsWorkspace(e,r){return!!e.find(i=>Fp(i)&&i.workspace.id===r.id)}containsFolder(e,r){return!!e.find(i=>_c(i)&&Le.isEqual(i.folderUri,r))}containsFile(e,r){return!!e.find(i=>Le.isEqual(i.fileUri,r))}static MAX_MACOS_DOCK_RECENT_WORKSPACES=7;static MAX_MACOS_DOCK_RECENT_ENTRIES_TOTAL=10;static MAX_WINDOWS_JUMP_LIST_ENTRIES=7;static COMMON_FILES_FILTER=["COMMIT_EDITMSG","MERGE_MSG","git-rebase-todo"];macOSRecentDocumentsUpdater=this._register(new Ht(800));async handleWindowsJumpList(){U&&(await this.updateWindowsJumpList(),this._register(this.onDidChangeRecentlyOpened(()=>this.updateWindowsJumpList())))}async updateWindowsJumpList(){if(!U)return;let e=[];if(e.push({type:"tasks",items:[{type:"task",title:p("newWindow","New Window"),description:p("newWindowDesc","Opens a new window"),program:process.execPath,args:"-n",iconPath:process.execPath,iconIndex:0}]}),(await this.getRecentlyOpened()).workspaces.length>0){let r=[];for(let s of $o.getJumpListSettings().removedItems){let a=s.args;if(a){let l=/^--(folder|file)-uri\s+"([^"]+)"$/.exec(a);l&&r.push(x.parse(l[2]))}}await this.removeRecentlyOpened(r);let i=!1,o=Ye((await this.getRecentlyOpened()).workspaces.slice(0,Wt.MAX_WINDOWS_JUMP_LIST_ENTRIES).map(s=>{let a=Fp(s)?s.workspace:s.folderUri,{title:l,description:c}=this.getWindowsJumpListLabel(a,s.label),d;return x.isUri(a)?d=`--folder-uri "${a.toString()}"`:(i=!0,d=`--file-uri "${a.configPath.toString()}"`),{type:"task",title:l.substr(0,255),description:c.substr(0,255),program:process.execPath,args:d,iconPath:"explorer.exe",iconIndex:0}}));o.length>0&&e.push({type:"custom",name:i?p("recentFoldersAndWorkspaces","Recent Folders & Workspaces"):p("recentFolders","Recent Folders"),items:o})}e.push({type:"recent"});try{let r=$o.setJumpList(e);r&&r!=="ok"&&this.logService.warn(`updateWindowsJumpList#setJumpList unexpected result: ${r}`)}catch(r){this.logService.warn("updateWindowsJumpList#setJumpList",r)}}getWindowsJumpListLabel(e,r){if(r)return{title:GI(r).name,description:r};if(x.isUri(e))return{title:cr(e),description:this.renderJumpListPathDescription(e)};if(this.workspacesManagementMainService.isUntitledWorkspace(e))return{title:p("untitledWorkspace","Untitled (Workspace)"),description:""};let i=cr(e.configPath);return i.endsWith(Ol)&&(i=i.substr(0,i.length-Ol.length-1)),{title:p("workspaceName","{0} (Workspace)",i),description:this.renderJumpListPathDescription(e.configPath)}}renderJumpListPathDescription(e){return e.scheme==="file"?Nl(e.fsPath):e.toString()}async updateMacOSRecentDocuments(){if(!W)return;$o.clearRecentDocuments();let e=await this.getRecentlyOpened(),r=[],i=0;for(let s=0;s<e.workspaces.length&&i<Wt.MAX_MACOS_DOCK_RECENT_WORKSPACES;s++){let a=this.location(e.workspaces[s]);if(a.scheme===L.file){let l=Dt(a);await q.exists(l)&&(r.push(l),i++)}}let o=[];for(let s=0;s<e.files.length&&i<Wt.MAX_MACOS_DOCK_RECENT_ENTRIES_TOTAL;s++){let a=this.location(e.files[s]);if(a.scheme===L.file){let l=Dt(a);if(Wt.COMMON_FILES_FILTER.includes(cr(a))||r.includes(l))continue;await q.exists(l)&&(o.push(l),i++)}}o.reverse().forEach(s=>$o.addRecentDocument(s)),r.reverse().forEach(s=>$o.addRecentDocument(s))}};Wt=P([g(0,A),g(1,Tr),g(2,oe),g(3,$i),g(4,Gt)],Wt);var Sf="menu",gi=class extends D{constructor(e,r,i,o,s,a,l,c,d,u,m,h){super();this.updateService=e;this.configurationService=r;this.windowsMainService=i;this.environmentMainService=o;this.telemetryService=s;this.workspacesHistoryMainService=a;this.stateService=l;this.lifecycleMainService=c;this.logService=d;this.nativeHostMainService=u;this.productService=m;this.auxiliaryWindowsMainService=h;this.menuUpdater=new bt(()=>this.doUpdateMenu(),0),this.menuGC=new bt(()=>{this.oldMenus=[]},1e4),this.menubarMenus=Object.create(null),this.keybindings=Object.create(null),(W||fn(r))&&this.restoreCachedMenubarData(),this.addFallbackHandlers(),this.closedLastWindow=!1,this.noActiveMainWindow=!1,this.oldMenus=[],this.install(),this.registerListeners()}static lastKnownMenubarStorageKey="lastKnownMenubarData";willShutdown;appMenuInstalled;closedLastWindow;noActiveMainWindow;menuUpdater;menuGC;oldMenus;menubarMenus;keybindings;fallbackMenuHandlers=Object.create(null);restoreCachedMenubarData(){let e=this.stateService.getItem(gi.lastKnownMenubarStorageKey);e&&(e.menus&&(this.menubarMenus=e.menus),e.keybindings&&(this.keybindings=e.keybindings))}addFallbackHandlers(){this.fallbackMenuHandlers["workbench.action.files.newUntitledFile"]=(a,l,c)=>{this.runActionInRenderer({type:"commandId",commandId:"workbench.action.files.newUntitledFile"})||this.windowsMainService.openEmptyWindow({context:2,contextWindowId:l?.id})},this.fallbackMenuHandlers["workbench.action.newWindow"]=(a,l,c)=>this.windowsMainService.openEmptyWindow({context:2,contextWindowId:l?.id}),this.fallbackMenuHandlers["workbench.action.files.openFileFolder"]=(a,l,c)=>this.nativeHostMainService.pickFileFolderAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:Sf}}),this.fallbackMenuHandlers["workbench.action.files.openFolder"]=(a,l,c)=>this.nativeHostMainService.pickFolderAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:Sf}}),this.fallbackMenuHandlers["workbench.action.openWorkspace"]=(a,l,c)=>this.nativeHostMainService.pickWorkspaceAndOpen(void 0,{forceNewWindow:this.isOptionClick(c),telemetryExtraData:{from:Sf}}),this.fallbackMenuHandlers["workbench.action.clearRecentFiles"]=()=>this.workspacesHistoryMainService.clearRecentlyOpened({confirm:!0});let e=this.productService.youTubeUrl;e&&(this.fallbackMenuHandlers["workbench.action.openYouTubeUrl"]=()=>this.openUrl(e,"openYouTubeUrl"));let r=this.productService.requestFeatureUrl;r&&(this.fallbackMenuHandlers["workbench.action.openRequestFeatureUrl"]=()=>this.openUrl(r,"openUserVoiceUrl"));let i=this.productService.reportIssueUrl;i&&(this.fallbackMenuHandlers["workbench.action.openIssueReporter"]=()=>this.openUrl(i,"openReportIssues"));let o=this.productService.licenseUrl;o&&(this.fallbackMenuHandlers["workbench.action.openLicenseUrl"]=()=>{if(Or){let a=o.indexOf("?")>0?"&":"?";this.openUrl(`${o}${a}lang=${Or}`,"openLicenseUrl")}else this.openUrl(o,"openLicenseUrl")});let s=this.productService.privacyStatementUrl;s&&o&&(this.fallbackMenuHandlers["workbench.action.openPrivacyStatementUrl"]=()=>{this.openUrl(s,"openPrivacyStatement")})}registerListeners(){this._register(this.lifecycleMainService.onWillShutdown(()=>this.willShutdown=!0)),this._register(this.windowsMainService.onDidChangeWindowsCount(e=>this.onDidChangeWindowsCount(e))),this._register(this.nativeHostMainService.onDidBlurMainWindow(()=>this.onDidChangeWindowFocus())),this._register(this.nativeHostMainService.onDidFocusMainWindow(()=>this.onDidChangeWindowFocus()))}get currentEnableMenuBarMnemonics(){let e=this.configurationService.getValue("window.enableMenuBarMnemonics");return typeof e!="boolean"?!0:e}get currentEnableNativeTabs(){if(!W)return!1;let e=this.configurationService.getValue("window.nativeTabs");return typeof e!="boolean"?!1:e}updateMenu(e,r){this.menubarMenus=e.menus,this.keybindings=e.keybindings,this.stateService.setItem(gi.lastKnownMenubarStorageKey,e),this.scheduleUpdateMenu()}scheduleUpdateMenu(){this.menuUpdater.schedule()}doUpdateMenu(){this.willShutdown||setTimeout(()=>{this.willShutdown||this.install()},10)}onDidChangeWindowsCount(e){W&&(e.oldCount===0&&e.newCount>0||e.oldCount>0&&e.newCount===0)&&(this.closedLastWindow=e.newCount===0,this.scheduleUpdateMenu())}onDidChangeWindowFocus(){if(!W)return;let e=wf.getFocusedWindow();this.noActiveMainWindow=!e||!!this.auxiliaryWindowsMainService.getWindowByWebContents(e.webContents),this.scheduleUpdateMenu()}install(){let e=wt.getApplicationMenu();if(e&&this.oldMenus.push(e),Object.keys(this.menubarMenus).length===0){this.doSetApplicationMenu(W?new wt:null);return}let r=new wt,i;if(W){let s=new wt;i=new Me({label:this.productService.nameShort,submenu:s}),this.setMacApplicationMenu(s),r.append(i)}if(W&&!this.appMenuInstalled){this.appMenuInstalled=!0;let s=new wt;s.append(new Me({label:this.mnemonicLabel(p({key:"miNewWindow",comment:["&& denotes a mnemonic"]},"New &&Window")),click:()=>this.windowsMainService.openEmptyWindow({context:1})})),Vk.dock.setMenu(s)}if(this.shouldDrawMenu("File")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mFile",comment:["&& denotes a mnemonic"]},"&&File")),submenu:s});this.setMenuById(s,"File"),r.append(a)}if(this.shouldDrawMenu("Edit")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mEdit",comment:["&& denotes a mnemonic"]},"&&Edit")),submenu:s});this.setMenuById(s,"Edit"),r.append(a)}if(this.shouldDrawMenu("Selection")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mSelection",comment:["&& denotes a mnemonic"]},"&&Selection")),submenu:s});this.setMenuById(s,"Selection"),r.append(a)}if(this.shouldDrawMenu("View")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mView",comment:["&& denotes a mnemonic"]},"&&View")),submenu:s});this.setMenuById(s,"View"),r.append(a)}if(this.shouldDrawMenu("Go")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mGoto",comment:["&& denotes a mnemonic"]},"&&Go")),submenu:s});this.setMenuById(s,"Go"),r.append(a)}if(this.shouldDrawMenu("Run")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mRun",comment:["&& denotes a mnemonic"]},"&&Run")),submenu:s});this.setMenuById(s,"Run"),r.append(a)}if(this.shouldDrawMenu("Terminal")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal")),submenu:s});this.setMenuById(s,"Terminal"),r.append(a)}let o;if(this.shouldDrawMenu("Window")){let s=new wt;o=new Me({label:this.mnemonicLabel(p("mWindow","Window")),submenu:s,role:"window"}),this.setMacWindowMenu(s)}if(o&&r.append(o),this.shouldDrawMenu("Help")){let s=new wt,a=new Me({label:this.mnemonicLabel(p({key:"mHelp",comment:["&& denotes a mnemonic"]},"&&Help")),submenu:s,role:"help"});this.setMenuById(s,"Help"),r.append(a)}r.items&&r.items.length>0?this.doSetApplicationMenu(r):this.doSetApplicationMenu(null),this.menuGC.schedule()}doSetApplicationMenu(e){if(wt.setApplicationMenu(e),e)for(let r of this.auxiliaryWindowsMainService.getWindows())r.win?.setMenu(null)}setMacApplicationMenu(e){let r=this.createMenuItem(p("mAbout","About {0}",this.productService.nameLong),"workbench.action.showAboutDialog"),i=this.getUpdateMenuItems(),o;if(this.shouldDrawMenu("Preferences")){let h=new wt;this.setMenuById(h,"Preferences"),o=new Me({label:this.mnemonicLabel(p({key:"miPreferences",comment:["&& denotes a mnemonic"]},"&&Preferences")),submenu:h})}let s=new wt,a=new Me({label:p("mServices","Services"),role:"services",submenu:s}),l=new Me({label:p("mHide","Hide {0}",this.productService.nameLong),role:"hide",accelerator:"Command+H"}),c=new Me({label:p("mHideOthers","Hide Others"),role:"hideOthers",accelerator:"Command+Alt+H"}),d=new Me({label:p("mShowAll","Show All"),role:"unhide"}),u=new Me(this.likeAction("workbench.action.quit",{label:p("miQuit","Quit {0}",this.productService.nameLong),click:async(h,y,v)=>{let b=this.windowsMainService.getLastActiveWindow();(this.windowsMainService.getWindowCount()===0||wf.getFocusedWindow()||b?.win?.isMinimized())&&await this.confirmBeforeQuit(v)&&this.nativeHostMainService.quit(void 0)}})),m=[r];m.push(...i),o&&m.push(hi(),o),m.push(hi(),a,hi(),l,c,d,hi(),u),m.forEach(h=>e.append(h))}async confirmBeforeQuit(e){if(this.windowsMainService.getWindowCount()===0)return!0;let r=this.configurationService.getValue("window.confirmBeforeClose");if(r==="always"||r==="keyboardOnly"&&this.isKeyboardEvent(e)){let{response:i}=await this.nativeHostMainService.showMessageBox(this.windowsMainService.getFocusedWindow()?.id,{type:"question",buttons:[p({key:"quit",comment:["&& denotes a mnemonic"]},"&&Quit"),p("cancel","Cancel")],message:p("quitMessage","Are you sure you want to quit?")});return i===0}return!0}shouldDrawMenu(e){if(!W&&!fn(this.configurationService))return!1;switch(e){case"File":case"Help":if(W)return this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow||!!this.menubarMenus&&!!this.menubarMenus[e];case"Window":if(W)return this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow||!!this.menubarMenus;default:return this.windowsMainService.getWindowCount()>0&&!!this.menubarMenus&&!!this.menubarMenus[e]}}setMenu(e,r){r.forEach(i=>{if(bv(i))e.append(hi());else if(Iv(i)){let o=new wt,s=new Me({label:this.mnemonicLabel(i.label),submenu:o});this.setMenu(o,i.submenu.items),e.append(s)}else wv(i)?e.append(this.createOpenRecentMenuItem(i)):T1(i)&&(i.id==="workbench.action.showAboutDialog"&&this.insertCheckForUpdatesItems(e),W?this.windowsMainService.getWindowCount()===0&&this.closedLastWindow||this.windowsMainService.getWindowCount()>0&&this.noActiveMainWindow?this.fallbackMenuHandlers[i.id]?e.append(new Me(this.likeAction(i.id,{label:this.mnemonicLabel(i.label),click:this.fallbackMenuHandlers[i.id]}))):e.append(this.createMenuItem(i.label,i.id,!1,i.checked)):e.append(this.createMenuItem(i.label,i.id,i.enabled!==!1,!!i.checked)):e.append(this.createMenuItem(i.label,i.id,i.enabled!==!1,!!i.checked)))})}setMenuById(e,r){this.menubarMenus&&this.menubarMenus[r]&&this.setMenu(e,this.menubarMenus[r].items)}insertCheckForUpdatesItems(e){let r=this.getUpdateMenuItems();r.length&&(r.forEach(i=>e.append(i)),e.append(hi()))}createOpenRecentMenuItem(e){let r=x.revive(e.uri),i=e.id,o=i==="openRecentFile"?{fileUri:r}:i==="openRecentWorkspace"?{workspaceUri:r}:{folderUri:r};return new Me(this.likeAction(i,{label:e.label,click:async(s,a,l)=>{let c=this.isOptionClick(l);(await this.windowsMainService.open({context:2,cli:this.environmentMainService.args,urisToOpen:[o],forceNewWindow:c,gotoLineMode:!1,remoteAuthority:e.remoteAuthority})).length>0||await this.workspacesHistoryMainService.removeRecentlyOpened([r])}},!1))}isOptionClick(e){return!!(e&&(!W&&(e.ctrlKey||e.shiftKey)||W&&(e.metaKey||e.altKey)))}isKeyboardEvent(e){return!!(e.triggeredByAccelerator||e.altKey||e.ctrlKey||e.metaKey||e.shiftKey)}createRoleMenuItem(e,r,i){let o={label:this.mnemonicLabel(e),role:i,enabled:!0};return new Me(this.withKeybinding(r,o))}setMacWindowMenu(e){let r=new Me({label:p("mMinimize","Minimize"),role:"minimize",accelerator:"Command+M",enabled:this.windowsMainService.getWindowCount()>0}),i=new Me({label:p("mZoom","Zoom"),role:"zoom",enabled:this.windowsMainService.getWindowCount()>0}),o=new Me({label:p("mBringToFront","Bring All to Front"),role:"front",enabled:this.windowsMainService.getWindowCount()>0}),s=this.createMenuItem(p({key:"miSwitchWindow",comment:["&& denotes a mnemonic"]},"Switch &&Window..."),"workbench.action.switchWindow"),a=[];this.currentEnableNativeTabs&&(a.push(hi()),a.push(this.createMenuItem(p("mNewTab","New Tab"),"workbench.action.newWindowTab")),a.push(this.createRoleMenuItem(p("mShowPreviousTab","Show Previous Tab"),"workbench.action.showPreviousWindowTab","selectPreviousTab")),a.push(this.createRoleMenuItem(p("mShowNextTab","Show Next Tab"),"workbench.action.showNextWindowTab","selectNextTab")),a.push(this.createRoleMenuItem(p("mMoveTabToNewWindow","Move Tab to New Window"),"workbench.action.moveWindowTabToNewWindow","moveTabToNewWindow")),a.push(this.createRoleMenuItem(p("mMergeAllWindows","Merge All Windows"),"workbench.action.mergeAllWindowTabs","mergeAllWindows"))),[r,i,hi(),s,...a,hi(),o].forEach(l=>e.append(l))}getUpdateMenuItems(){switch(this.updateService.state.type){case"idle":return[new Me({label:this.mnemonicLabel(p("miCheckForUpdates","Check for &&Updates...")),click:()=>setTimeout(()=>{this.reportMenuActionTelemetry("CheckForUpdate"),this.updateService.checkForUpdates(!0)},0)})];case"checking for updates":return[new Me({label:p("miCheckingForUpdates","Checking for Updates..."),enabled:!1})];case"available for download":return[new Me({label:this.mnemonicLabel(p("miDownloadUpdate","D&&ownload Available Update")),click:()=>{this.updateService.downloadUpdate()}})];case"downloading":return[new Me({label:p("miDownloadingUpdate","Downloading Update..."),enabled:!1})];case"downloaded":return W?[]:[new Me({label:this.mnemonicLabel(p("miInstallUpdate","Install &&Update...")),click:()=>{this.reportMenuActionTelemetry("InstallUpdate"),this.updateService.applyUpdate()}})];case"updating":return[new Me({label:p("miInstallingUpdate","Installing Update..."),enabled:!1})];case"ready":return[new Me({label:this.mnemonicLabel(p("miRestartToUpdate","Restart to &&Update")),click:()=>{this.reportMenuActionTelemetry("RestartToUpdate"),this.updateService.quitAndInstall()}})];default:return[]}}createMenuItem(e,r,i,o){let s=this.mnemonicLabel(e),a=typeof r=="function"?r:(m,h,y)=>{let v=m?m.userSettingsLabel:null,b=r;Array.isArray(r)&&(b=this.isOptionClick(y)?r[1]:r[0]),v&&y.triggeredByAccelerator?this.runActionInRenderer({type:"keybinding",userSettingsLabel:v}):this.runActionInRenderer({type:"commandId",commandId:b})},l=typeof i=="boolean"?i:this.windowsMainService.getWindowCount()>0,c=typeof o=="boolean"?o:!1,d={label:s,click:a,enabled:l};c&&(d.type="checkbox",d.checked=c);let u;return typeof r=="string"?u=r:Array.isArray(r)&&(u=r[0]),W&&(u==="editor.action.clipboardCutAction"?d.role="cut":u==="editor.action.clipboardCopyAction"?d.role="copy":u==="editor.action.clipboardPasteAction"&&(d.role="paste"),u==="undo"?d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.undo(),inNoWindow:()=>wt.sendActionToFirstResponder("undo:")}):u==="redo"?d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.redo(),inNoWindow:()=>wt.sendActionToFirstResponder("redo:")}):u==="editor.action.selectAll"&&(d.click=this.makeContextAwareClickHandler(a,{inDevTools:m=>m.selectAll(),inNoWindow:()=>wt.sendActionToFirstResponder("selectAll:")}))),new Me(this.withKeybinding(u,d))}makeContextAwareClickHandler(e,r){return(i,o,s)=>{let a=wf.getFocusedWindow();if(!a)return r.inNoWindow();if(a.webContents.isDevToolsFocused()&&a.webContents.devToolsWebContents)return r.inDevTools(a.webContents.devToolsWebContents);e(i,o||a,s)}}runActionInRenderer(e){let r=wf.getFocusedWindow();if(r){let o=this.auxiliaryWindowsMainService.getWindowByWebContents(r.webContents);o&&(r=this.windowsMainService.getWindowById(o.parentId)?.win??null)}if(!r){let o=this.windowsMainService.getLastActiveWindow();o?.win?.isMinimized()&&(r=o.win)}let i=r?this.windowsMainService.getWindowById(r.id):void 0;if(i){if(this.logService.trace("menubar#runActionInRenderer",e),W&&!this.environmentMainService.isBuilt&&!i.isReady&&(e.type==="commandId"&&e.commandId==="workbench.action.toggleDevTools"||e.type!=="commandId"&&e.userSettingsLabel==="alt+cmd+i"))return!1;if(e.type==="commandId"){let o={id:e.commandId,from:"menu"};i.sendWhenReady("vscode:runAction",we.None,o)}else{let o={userSettingsLabel:e.userSettingsLabel};i.sendWhenReady("vscode:runKeybinding",we.None,o)}return!0}else return this.logService.trace("menubar#runActionInRenderer: no active window found",e),!1}withKeybinding(e,r){let i=typeof e=="string"?this.keybindings[e]:void 0;if(i?.label){if(i.isNative!==!1)r.accelerator=i.label,r.userSettingsLabel=i.userSettingsLabel;else if(typeof r.label=="string"){let o=r.label.indexOf("[");o>=0?r.label=`${r.label.substr(0,o)} [${i.label}]`:r.label=`${r.label} [${i.label}]`}}else r.accelerator=void 0;return r}likeAction(e,r,i=!r.accelerator){i&&(r=this.withKeybinding(e,r));let o=r.click;return r.click=(s,a,l)=>{this.reportMenuActionTelemetry(e),o?.(s,a,l)},r}openUrl(e,r){this.nativeHostMainService.openExternal(void 0,e),this.reportMenuActionTelemetry(r)}reportMenuActionTelemetry(e){this.telemetryService.publicLog2("workbenchActionExecuted",{id:e,from:Sf})}mnemonicLabel(e){return jI(e,!this.currentEnableMenuBarMnemonics)}};gi=P([g(0,to),g(1,ce),g(2,Fe),g(3,ge),g(4,Ve),g(5,ro),g(6,et),g(7,oe),g(8,A),g(9,Cr),g(10,be),g(11,mi)],gi);function hi(){return new Me({type:"separator"})}var Sv=F("menubarMainService"),ka=class extends D{constructor(e,r,i){super();this.instantiationService=e;this.lifecycleMainService=r;this.logService=i}menubar=this.installMenuBarAfterWindowOpen();async installMenuBarAfterWindowOpen(){return await this.lifecycleMainService.when(3),this._register(this.instantiationService.createInstance(gi))}async updateMenubar(e,r){this.logService.trace("menubarService#updateMenubar",e),(await this.menubar).updateMenu(r,e)}};ka=P([g(0,Yt),g(1,oe),g(2,A)],ka);import"electron";var Ef={exit:"vscode:electron-main->shared-process=exit",ipcReady:"vscode:shared-process->electron-main=ipc-ready",initDone:"vscode:shared-process->electron-main=init-done"},xv={request:"vscode:createSharedProcessChannelConnection",response:"vscode:createSharedProcessChannelConnectionResult"},Ev={request:"vscode:createSharedProcessRawConnection",response:"vscode:createSharedProcessRawConnectionResult"};var _a=class extends D{constructor(e,r,i,o,s,a,l,c,d){super();this.machineId=e;this.sqmId=r;this.devDeviceId=i;this.environmentMainService=o;this.userDataProfilesService=s;this.lifecycleMainService=a;this.logService=l;this.loggerMainService=c;this.policyService=d;this.registerListeners()}firstWindowConnectionBarrier=new kn;utilityProcess=void 0;utilityProcessLogListener=void 0;_onDidCrash=this._register(new S);onDidCrash=this._onDidCrash.event;registerListeners(){_e.on(xv.request,(e,r)=>this.onWindowConnection(e,r,xv.response)),_e.on(Ev.request,(e,r)=>this.onWindowConnection(e,r,Ev.response)),this._register(this.lifecycleMainService.onWillShutdown(()=>this.onWillShutdown()))}async onWindowConnection(e,r,i){this.logService.trace(`[SharedProcess] onWindowConnection for: ${i}`),this.firstWindowConnectionBarrier.isOpen()||this.firstWindowConnectionBarrier.open(),await this.whenReady();let o=await this.connect(i);if(e.sender.isDestroyed())return o.close();e.sender.postMessage(i,r,[o])}onWillShutdown(){this.logService.trace("[SharedProcess] onWillShutdown"),this.utilityProcess?.postMessage(Ef.exit),this.utilityProcess=void 0}_whenReady=void 0;whenReady(){return this._whenReady||(this._whenReady=(async()=>{await this.whenIpcReady;let e=new ur;this.utilityProcess?.once(Ef.initDone,()=>e.complete()),await e.p,this.utilityProcessLogListener?.dispose(),this.logService.trace("[SharedProcess] Overall ready")})()),this._whenReady}_whenIpcReady=void 0;get whenIpcReady(){return this._whenIpcReady||(this._whenIpcReady=(async()=>{await this.firstWindowConnectionBarrier.wait(),this.createUtilityProcess();let e=new ur;this.utilityProcess?.once(Ef.ipcReady,()=>e.complete()),await e.p,this.logService.trace("[SharedProcess] IPC ready")})()),this._whenIpcReady}createUtilityProcess(){this.utilityProcess=this._register(new At(this.logService,Hi,this.lifecycleMainService)),this.utilityProcessLogListener=this.utilityProcess.onMessage(i=>{typeof i.warning=="string"?this.logService.warn(i.warning):typeof i.error=="string"&&this.logService.error(i.error)});let e=Ab(this.environmentMainService.args,this.environmentMainService.isBuilt),r;e.port&&(r=["--nolazy"],e.break?r.push(`--inspect-brk=${e.port}`):r.push(`--inspect=${e.port}`)),this.utilityProcess.start({type:"shared-process",entryPoint:"vs/code/electron-utility/sharedProcess/sharedProcessMain",payload:this.createSharedProcessConfiguration(),respondToAuthRequestsFromMainProcess:!0,execArgv:r}),this._register(this.utilityProcess.onCrash(()=>this._onDidCrash.fire()))}createSharedProcessConfiguration(){return{machineId:this.machineId,sqmId:this.sqmId,devDeviceId:this.devDeviceId,codeCachePath:this.environmentMainService.codeCachePath,profiles:{home:this.userDataProfilesService.profilesHome,all:this.userDataProfilesService.profiles},args:this.environmentMainService.args,logLevel:this.loggerMainService.getLogLevel(),loggers:this.loggerMainService.getRegisteredLoggers(),policiesData:this.policyService.serialize()}}async connect(e){return await this.whenIpcReady,Zn(this.utilityProcess).connect(e)}};_a=P([g(3,ge),g(4,jt),g(5,oe),g(6,A),g(7,Nn),g(8,Jr)],_a);var Kk="signService",no=F(Kk);var Pf=class n extends D{constructor(e,r){super();this.logService=e;this.storageMainService=r;this.registerStorageChangeListeners(r.applicationStorage,this.onDidChangeApplicationStorageEmitter)}static STORAGE_CHANGE_DEBOUNCE_TIME=100;onDidChangeApplicationStorageEmitter=this._register(new S);mapProfileToOnDidChangeProfileStorageEmitter=new Map;registerStorageChangeListeners(e,r){this._register(E.debounce(e.onDidChangeStorage,(i,o)=>(i?i.push(o):i=[o],i),n.STORAGE_CHANGE_DEBOUNCE_TIME)(i=>{i.length&&r.fire(this.serializeStorageChangeEvents(i,e))}))}serializeStorageChangeEvents(e,r){let i=new Map,o=new Set;return e.forEach(s=>{let a=r.get(s.key);typeof a=="string"?i.set(s.key,a):o.add(s.key)}),{changed:Array.from(i.entries()),deleted:Array.from(o.values())}}listen(e,r,i){switch(r){case"onDidChangeStorage":{let o=i.profile?dn(i.profile):void 0;if(!o)return this.onDidChangeApplicationStorageEmitter.event;let s=this.mapProfileToOnDidChangeProfileStorageEmitter.get(o.id);return s||(s=this._register(new S),this.registerStorageChangeListeners(this.storageMainService.profileStorage(o),s),this.mapProfileToOnDidChangeProfileStorageEmitter.set(o.id,s)),s.event}}throw new Error(`Event not found: ${r}`)}async call(e,r,i){let o=i.profile?dn(i.profile):void 0,s=_I(i.workspace),a=await this.withStorageInitialized(o,s);switch(r){case"getItems":return Array.from(a.items.entries());case"updateItems":{let l=i;if(l.insert)for(let[c,d]of l.insert)a.set(c,d);l.delete?.forEach(c=>a.delete(c));break}case"optimize":return a.optimize();case"isUsed":{let l=i.payload;if(typeof l=="string")return this.storageMainService.isUsed(l)}default:throw new Error(`Call not found: ${r}`)}}async withStorageInitialized(e,r){let i;r?i=this.storageMainService.workspaceStorage(r):e?i=this.storageMainService.profileStorage(e):i=this.storageMainService.applicationStorage;try{await i.init()}catch(o){this.logService.error(`StorageIPC#init: Unable to init ${r?"workspace":e?"profile":"application"} storage due to ${o}`)}return i}};var Tf=class{constructor(t){this.channel=t}log(t,e){return this.channel.call("log",{eventName:t,data:e}).then(void 0,r=>`Failed to log telemetry: ${console.warn(r)}`),Promise.resolve(null)}flush(){return Promise.resolve()}};var Ra=class{constructor(t,e,r){this._configurationService=e;this._productService=r;this._appenders=t.appenders,this._commonProperties=t.commonProperties??Object.create(null),this.sessionId=this._commonProperties.sessionID,this.machineId=this._commonProperties["common.machineId"],this.sqmId=this._commonProperties["common.sqmId"],this.devDeviceId=this._commonProperties["common.devDeviceId"],this.firstSessionDate=this._commonProperties["common.firstSessionDate"],this.msftInternal=this._commonProperties["common.msftInternal"],this._piiPaths=t.piiPaths||[],this._telemetryLevel=3,this._sendErrorTelemetry=!!t.sendErrorTelemetry,this._cleanupPatterns=[/(vscode-)?file:\/\/\/.*?\/resources\/app\//gi];for(let i of this._piiPaths)this._cleanupPatterns.push(new RegExp(ei(i),"gi")),i.indexOf("\\")>=0&&this._cleanupPatterns.push(new RegExp(ei(i.replace(/\\/g,"/")),"gi"));this._updateTelemetryLevel(),this._disposables.add(this._configurationService.onDidChangeConfiguration(i=>{(i.affectsConfiguration(ta)||i.affectsConfiguration(Sc)||i.affectsConfiguration(bp))&&this._updateTelemetryLevel()}))}static IDLE_START_EVENT_NAME="UserIdleStart";static IDLE_STOP_EVENT_NAME="UserIdleStop";sessionId;machineId;sqmId;devDeviceId;firstSessionDate;msftInternal;_appenders;_commonProperties;_experimentProperties={};_piiPaths;_telemetryLevel;_sendErrorTelemetry;_disposables=new Y;_cleanupPatterns=[];setExperimentProperty(t,e){this._experimentProperties[t]=e}_updateTelemetryLevel(){let t=na(this._configurationService),e=this._productService.enabledTelemetryLevels;if(e){this._sendErrorTelemetry=this.sendErrorTelemetry?e.error:!1;let r=e.usage?3:e.error?2:0;t=Math.min(t,r)}this._telemetryLevel=t}get sendErrorTelemetry(){return this._sendErrorTelemetry}get telemetryLevel(){return this._telemetryLevel}dispose(){this._disposables.dispose()}_log(t,e,r){this._telemetryLevel<e||(r=wp(r,this._experimentProperties),r=pS(r,this._cleanupPatterns),r=wp(r,this._commonProperties),this._appenders.forEach(i=>i.log(t,r)))}publicLog(t,e){this._log(t,3,e)}publicLog2(t,e){this.publicLog(t,e)}publicLogError(t,e){this._sendErrorTelemetry&&this._log(t,2,e)}publicLogError2(t,e){this.publicLogError(t,e)}};Ra=P([g(1,ce),g(2,be)],Ra);function Hk(){let n=p("telemetry.telemetryLevelMd","Controls {0} telemetry, first-party extension telemetry, and participating third-party extension telemetry. Some third party extensions might not respect this setting. Consult the specific extension's documentation to be sure. Telemetry helps us better understand how {0} is performing, where improvements need to be made, and how features are being used.",nr.nameLong),t=nr.privacyStatementUrl?p("telemetry.docsAndPrivacyStatement","Read more about the [data we collect]({0}) and our [privacy statement]({1}).","https://aka.ms/vscode-telemetry",nr.privacyStatementUrl):p("telemetry.docsStatement","Read more about the [data we collect]({0}).","https://aka.ms/vscode-telemetry"),e=sr?"":p("telemetry.restart","A full restart of the application is necessary for crash reporting changes to take effect."),r=p("telemetry.crashReports","Crash Reports"),i=p("telemetry.errors","Error Telemetry"),o=p("telemetry.usage","Usage Data"),s=p("telemetry.telemetryLevel.tableDescription","The following table outlines the data sent with each setting:"),a=`
|       | ${r} | ${i} | ${o} |
|:------|:---------------------:|:---------------:|:--------------:|
| all   |            \u2713          |        \u2713        |        \u2713       |
| error |            \u2713          |        \u2713        |        -       |
| crash |            \u2713          |        -        |        -       |
| off   |            -          |        -        |        -       |
`,l=p("telemetry.telemetryLevel.deprecated","****Note:*** If this setting is 'off', no telemetry will be sent regardless of other telemetry settings. If this setting is set to anything except 'off' and telemetry is disabled with deprecated settings, no telemetry will be sent.*");return`
${n} ${t} ${e}

&nbsp;

${s}
${a}

&nbsp;

${l}
`}De.as(Et.Configuration).registerConfiguration({id:Tg,order:1,type:"object",title:p("telemetryConfigurationTitle","Telemetry"),properties:{[ta]:{type:"string",enum:["all","error","crash","off"],enumDescriptions:[p("telemetry.telemetryLevel.default","Sends usage data, errors, and crash reports."),p("telemetry.telemetryLevel.error","Sends general error telemetry and crash reports."),p("telemetry.telemetryLevel.crash","Sends OS level crash reports."),p("telemetry.telemetryLevel.off","Disables all product telemetry.")],markdownDescription:Hk(),default:"all",restricted:!0,scope:1,tags:["usesOnlineServices","telemetry"]}}});De.as(Et.Configuration).registerConfiguration({id:Tg,order:110,type:"object",title:p("telemetryConfigurationTitle","Telemetry"),properties:{[Sc]:{type:"boolean",markdownDescription:nr.privacyStatementUrl?p("telemetry.enableTelemetryMd","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made. [Read more]({1}) about what we collect and our privacy statement.",nr.nameLong,nr.privacyStatementUrl):p("telemetry.enableTelemetry","Enable diagnostic data to be collected. This helps us to better understand how {0} is performing and where improvements need to be made.",nr.nameLong),default:!0,restricted:!0,markdownDeprecationMessage:p("enableTelemetryDeprecated","If this setting is false, no telemetry will be sent regardless of the new setting's value. Deprecated in favor of the {0} setting.",`\`#${ta}#\``),scope:1,tags:["usesOnlineServices","telemetry"]}}});var Cf=class{constructor(t){this.service=t}listen(t,e){switch(e){case"onStateChange":return this.service.onStateChange}throw new Error(`Event not found: ${e}`)}call(t,e,r){switch(e){case"checkForUpdates":return this.service.checkForUpdates(r);case"downloadUpdate":return this.service.downloadUpdate();case"applyUpdate":return this.service.applyUpdate();case"quitAndInstall":return this.service.quitAndInstall();case"_getInitialState":return Promise.resolve(this.service.state);case"isLatestVersion":return this.service.isLatestVersion();case"_applySpecificUpdate":return this.service._applySpecificUpdate(r)}throw new Error(`Call not found: ${e}`)}};import*as io from"electron";function Da(n,t,e){return`${e.updateUrl}/api/update/${n}/${t}/${e.commit}`}var Kn=class{constructor(t,e,r,i,o,s){this.lifecycleMainService=t;this.configurationService=e;this.environmentMainService=r;this.requestService=i;this.logService=o;this.productService=s;t.when(3).finally(()=>this.initialize())}url;_state=me.Uninitialized;_onStateChange=new S;onStateChange=this._onStateChange.event;get state(){return this._state}setState(t){this.logService.info("update#setState",t.type),this._state=t,this._onStateChange.fire(t)}async initialize(){if(!this.environmentMainService.isBuilt){this.setState(me.Disabled(0));return}if(this.environmentMainService.disableUpdates){this.setState(me.Disabled(1)),this.logService.info("update#ctor - updates are disabled by the environment");return}if(!this.productService.updateUrl||!this.productService.commit){this.setState(me.Disabled(3)),this.logService.info("update#ctor - updates are disabled as there is no update URL");return}let t=this.configurationService.getValue("update.mode"),e=this.getProductQuality(t);if(!e){this.setState(me.Disabled(2)),this.logService.info("update#ctor - updates are disabled by user preference");return}if(this.url=this.buildUpdateFeedUrl(e),!this.url){this.setState(me.Disabled(4)),this.logService.info("update#ctor - updates are disabled as the update URL is badly formed");return}if(this.configurationService.getValue("_update.prss")){let r=new URL(this.url);r.searchParams.set("prss","true"),this.url=r.toString()}if(this.setState(me.Idle(this.getUpdateType())),t==="manual"){this.logService.info("update#ctor - manual checks only; automatic updates are disabled by user preference");return}t==="start"?(this.logService.info("update#ctor - startup checks only; automatic updates are disabled by user preference"),setTimeout(()=>this.checkForUpdates(!1),30*1e3)):this.scheduleCheckForUpdates(30*1e3).then(void 0,r=>this.logService.error(r))}getProductQuality(t){return t==="none"?void 0:this.productService.quality}scheduleCheckForUpdates(t=60*60*1e3){return nt(t).then(()=>this.checkForUpdates(!1)).then(()=>this.scheduleCheckForUpdates(60*60*1e3))}async checkForUpdates(t){this.logService.trace("update#checkForUpdates, state = ",this.state.type),this.state.type==="idle"&&this.doCheckForUpdates(t)}async downloadUpdate(){this.logService.trace("update#downloadUpdate, state = ",this.state.type),this.state.type==="available for download"&&await this.doDownloadUpdate(this.state)}async doDownloadUpdate(t){}async applyUpdate(){this.logService.trace("update#applyUpdate, state = ",this.state.type),this.state.type==="downloaded"&&await this.doApplyUpdate()}async doApplyUpdate(){}quitAndInstall(){return this.logService.trace("update#quitAndInstall, state = ",this.state.type),this.state.type!=="ready"||(this.logService.trace("update#quitAndInstall(): before lifecycle quit()"),this.lifecycleMainService.quit(!0).then(t=>{this.logService.trace(`update#quitAndInstall(): after lifecycle quit() with veto: ${t}`),!t&&(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.doQuitAndInstall())})),Promise.resolve(void 0)}async isLatestVersion(){if(!this.url)return;if(this.configurationService.getValue("update.mode")==="none")return!1;try{return(await this.requestService.request({url:this.url},we.None)).res.statusCode===204}catch(e){this.logService.error("update#isLatestVersion(): failed to check for updates"),this.logService.error(e);return}}async _applySpecificUpdate(t){}getUpdateType(){return 1}doQuitAndInstall(){}};Kn=P([g(0,oe),g(1,ce),g(2,ge),g(3,wr),g(4,A),g(5,be)],Kn);var Hn=class extends Kn{constructor(e,r,i,o,s,a,l){super(e,r,o,s,a,l);this.telemetryService=i;e.setRelaunchHandler(this)}disposables=new Y;get onRawError(){return E.fromNodeEventEmitter(io.autoUpdater,"error",(e,r)=>r)}get onRawUpdateNotAvailable(){return E.fromNodeEventEmitter(io.autoUpdater,"update-not-available")}get onRawUpdateAvailable(){return E.fromNodeEventEmitter(io.autoUpdater,"update-available")}get onRawUpdateDownloaded(){return E.fromNodeEventEmitter(io.autoUpdater,"update-downloaded",(e,r,i,o)=>({version:i,productVersion:i,timestamp:o}))}handleRelaunch(e){return e?.addArgs||e?.removeArgs||this.state.type!=="ready"?!1:(this.logService.trace("update#handleRelaunch(): running raw#quitAndInstall()"),this.doQuitAndInstall(),!0)}async initialize(){await super.initialize(),this.onRawError(this.onError,this,this.disposables),this.onRawUpdateAvailable(this.onUpdateAvailable,this,this.disposables),this.onRawUpdateDownloaded(this.onUpdateDownloaded,this,this.disposables),this.onRawUpdateNotAvailable(this.onUpdateNotAvailable,this,this.disposables)}onError(e){this.telemetryService.publicLog2("update:error",{messageHash:String(qt(String(e)))}),this.logService.error("UpdateService error:",e);let r=this.state.type==="checking for updates"&&this.state.explicit?e:void 0;this.setState(me.Idle(1,r))}buildUpdateFeedUrl(e){let r;this.productService.darwinUniversalAssetId?r=this.productService.darwinUniversalAssetId:r=process.arch==="x64"?"darwin":"darwin-arm64";let i=Da(r,e,this.productService);try{io.autoUpdater.setFeedURL({url:i})}catch(o){this.logService.error("Failed to set update feed URL",o);return}return i}doCheckForUpdates(e){this.setState(me.CheckingForUpdates(e)),io.autoUpdater.checkForUpdates()}onUpdateAvailable(){this.state.type==="checking for updates"&&this.setState(me.Downloading)}onUpdateDownloaded(e){this.state.type==="downloading"&&(this.setState(me.Downloaded(e)),this.telemetryService.publicLog2("update:downloaded",{version:e.version}),this.setState(me.Ready(e)))}onUpdateNotAvailable(){this.state.type==="checking for updates"&&(this.telemetryService.publicLog2("update:notAvailable",{explicit:this.state.explicit}),this.setState(me.Idle(1)))}doQuitAndInstall(){this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),io.autoUpdater.quitAndInstall()}dispose(){this.disposables.dispose()}};P([ie],Hn.prototype,"onRawError",1),P([ie],Hn.prototype,"onRawUpdateNotAvailable",1),P([ie],Hn.prototype,"onRawUpdateAvailable",1),P([ie],Hn.prototype,"onRawUpdateDownloaded",1),Hn=P([g(0,oe),g(1,ce),g(2,Ve),g(3,ge),g(4,wr),g(5,A),g(6,be)],Hn);var Oa=class extends Kn{constructor(e,r,i,o,s,a,l,c){super(e,r,o,s,a,c);this.telemetryService=i;this.nativeHostMainService=l}buildUpdateFeedUrl(e){return Da(`linux-${process.arch}`,e,this.productService)}doCheckForUpdates(e){this.url&&(this.setState(me.CheckingForUpdates(e)),this.requestService.request({url:this.url},we.None).then(ju).then(r=>{!r||!r.url||!r.version||!r.productVersion?(this.telemetryService.publicLog2("update:notAvailable",{explicit:!!e}),this.setState(me.Idle(1))):this.setState(me.AvailableForDownload(r))}).then(void 0,r=>{this.logService.error(r);let i=e?r.message||r:void 0;this.setState(me.Idle(1,i))}))}async doDownloadUpdate(e){this.productService.downloadUrl&&this.productService.downloadUrl.length>0?this.nativeHostMainService.openExternal(void 0,this.productService.downloadUrl):e.update.url&&this.nativeHostMainService.openExternal(void 0,e.update.url),this.setState(me.Idle(1))}};Oa=P([g(0,oe),g(1,ce),g(2,Ve),g(3,ge),g(4,wr),g(5,A),g(6,Cr),g(7,be)],Oa);import{spawn as qk}from"child_process";import{realpath as $k,watch as jk}from"fs";var Xc=class{constructor(t,e,r){this.lifecycleMainService=t;this.logService=r;if(e.disableUpdates){this.logService.info("update#ctor - updates are disabled");return}this.setState(me.Idle(this.getUpdateType())),this.scheduleCheckForUpdates(30*1e3).then(void 0,i=>this.logService.error(i))}_state=me.Uninitialized;_onStateChange=new S;onStateChange=this._onStateChange.event;get state(){return this._state}setState(t){this.logService.info("update#setState",t.type),this._state=t,this._onStateChange.fire(t)}scheduleCheckForUpdates(t=60*60*1e3){return nt(t).then(()=>this.checkForUpdates(!1)).then(()=>this.scheduleCheckForUpdates(60*60*1e3))}async checkForUpdates(t){this.logService.trace("update#checkForUpdates, state = ",this.state.type),this.state.type==="idle"&&this.doCheckForUpdates(t)}async downloadUpdate(){this.logService.trace("update#downloadUpdate, state = ",this.state.type),this.state.type==="available for download"&&await this.doDownloadUpdate(this.state)}doDownloadUpdate(t){return Promise.resolve(void 0)}async applyUpdate(){this.logService.trace("update#applyUpdate, state = ",this.state.type),this.state.type==="downloaded"&&await this.doApplyUpdate()}doApplyUpdate(){return Promise.resolve(void 0)}quitAndInstall(){return this.logService.trace("update#quitAndInstall, state = ",this.state.type),this.state.type!=="ready"||(this.logService.trace("update#quitAndInstall(): before lifecycle quit()"),this.lifecycleMainService.quit(!0).then(t=>{this.logService.trace(`update#quitAndInstall(): after lifecycle quit() with veto: ${t}`),!t&&(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.doQuitAndInstall())})),Promise.resolve(void 0)}getUpdateType(){return 2}doQuitAndInstall(){}async _applySpecificUpdate(t){}};Xc=P([g(0,oe),g(1,ge),g(2,A)],Xc);var Fa=class extends Xc{constructor(e,r,i,o,s,a){super(i,o,s);this.snap=e;this.snapRevision=r;this.telemetryService=a;let l=jk(Ne(this.snap)),c=E.fromNodeEventEmitter(l,"change",(h,y)=>y),d=E.filter(c,h=>h==="current"),m=E.debounce(d,(h,y)=>y,2e3)(()=>this.checkForUpdates(!1));i.onWillShutdown(()=>{m.dispose(),l.close()})}doCheckForUpdates(){this.setState(me.CheckingForUpdates(!1)),this.isUpdateAvailable().then(e=>{e?this.setState(me.Ready({version:"something"})):(this.telemetryService.publicLog2("update:notAvailable",{explicit:!1}),this.setState(me.Idle(2)))},e=>{this.logService.error(e),this.telemetryService.publicLog2("update:notAvailable",{explicit:!1}),this.setState(me.Idle(2,e.message||e))})}doQuitAndInstall(){this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),qk("sleep 3 && "+pe(process.argv[0]),{shell:!0,detached:!0,stdio:"ignore"})}async isUpdateAvailable(){let e=await new Promise((i,o)=>$k(`${Ne(this.snap)}/current`,(s,a)=>s?o(s):i(a))),r=pe(e);return this.snapRevision!==r}isLatestVersion(){return this.isUpdateAvailable().then(void 0,e=>{this.logService.error("update#checkForSnapUpdate(): Could not get realpath of application.")})}};Fa=P([g(2,oe),g(3,ge),g(4,A),g(5,Ve)],Fa);import{spawn as R1}from"child_process";import*as Go from"fs";import{tmpdir as Gk}from"os";import*as C1 from"crypto";import*as k1 from"fs";async function _1(n,t){if(await new Promise((i,o)=>{let s=k1.createReadStream(n),a=C1.createHash("sha256");s.pipe(a);let l=as((c,d)=>{s.removeAllListeners(),a.removeAllListeners(),c?o(c):i(d)});s.once("error",l),s.once("end",l),a.once("error",l),a.once("data",c=>l(void 0,c.toString("hex")))})!==t)throw new Error("Hash mismatch")}async function Jk(n,t=1e3){for(;!n();)await nt(t)}var Pv;function La(){return typeof Pv>"u"&&(Pv=Go.existsSync(V(Ne(process.execPath),"unins000.exe"))?0:1),Pv}var jo=class extends Kn{constructor(e,r,i,o,s,a,l,c,d){super(e,r,o,s,a,d);this.telemetryService=i;this.fileService=l;this.nativeHostMainService=c;e.setRelaunchHandler(this)}availableUpdate;get cachePath(){let e=V(Gk(),`vscode-${this.productService.quality}-${this.productService.target}-${process.arch}`);return Go.promises.mkdir(e,{recursive:!0}).then(()=>e)}handleRelaunch(e){return e?.addArgs||e?.removeArgs||this.state.type!=="ready"||!this.availableUpdate?!1:(this.logService.trace("update#handleRelaunch(): running raw#quitAndInstall()"),this.doQuitAndInstall(),!0)}async initialize(){if(this.productService.target==="user"&&await this.nativeHostMainService.isAdmin(void 0)){this.setState(me.Disabled(5)),this.logService.info("update#ctor - updates are disabled due to running as Admin in user setup");return}await super.initialize()}buildUpdateFeedUrl(e){let r=`win32-${process.arch}`;return La()===1?r+="-archive":this.productService.target==="user"&&(r+="-user"),Da(r,e,this.productService)}doCheckForUpdates(e){this.url&&(this.setState(me.CheckingForUpdates(e)),this.requestService.request({url:this.url},we.None).then(ju).then(r=>{let i=La();return!r||!r.url||!r.version||!r.productVersion?(this.telemetryService.publicLog2("update:notAvailable",{explicit:!!e}),this.setState(me.Idle(i)),Promise.resolve(null)):i===1?(this.setState(me.AvailableForDownload(r)),Promise.resolve(null)):(this.setState(me.Downloading),this.cleanup(r.version).then(()=>this.getUpdatePackagePath(r.version).then(o=>q.exists(o).then(s=>{if(s)return Promise.resolve(o);let a=`${o}.tmp`;return this.requestService.request({url:r.url},we.None).then(l=>this.fileService.writeFile(x.file(a),l.stream)).then(r.sha256hash?()=>_1(a,r.sha256hash):()=>{}).then(()=>q.rename(a,o,!1)).then(()=>o)})).then(o=>{this.availableUpdate={packagePath:o},this.setState(me.Downloaded(r)),this.configurationService.getValue("update.enableWindowsBackgroundUpdates")?this.productService.target==="user"&&this.doApplyUpdate():this.setState(me.Ready(r))})))}).then(void 0,r=>{this.telemetryService.publicLog2("update:error",{messageHash:String(qt(String(r)))}),this.logService.error(r);let i=e?r.message||r:void 0;this.setState(me.Idle(La(),i))}))}async doDownloadUpdate(e){e.update.url&&this.nativeHostMainService.openExternal(void 0,e.update.url),this.setState(me.Idle(La()))}async getUpdatePackagePath(e){let r=await this.cachePath;return V(r,`CodeSetup-${this.productService.quality}-${e}.exe`)}async cleanup(e=null){let r=e?a=>!new RegExp(`${this.productService.quality}-${e}\\.exe$`).test(a):()=>!0,i=await this.cachePath,s=(await q.readdir(i)).filter(r).map(async a=>{try{await Go.promises.unlink(V(i,a))}catch{}});await Promise.all(s)}async doApplyUpdate(){if(this.state.type!=="downloaded"||!this.availableUpdate)return Promise.resolve(void 0);let e=this.state.update;this.setState(me.Updating(e));let r=await this.cachePath;this.availableUpdate.updateFilePath=V(r,`CodeSetup-${this.productService.quality}-${e.version}.flag`),await q.writeFile(this.availableUpdate.updateFilePath,"flag"),R1(this.availableUpdate.packagePath,["/verysilent","/log",`/update="${this.availableUpdate.updateFilePath}"`,"/nocloseapplications","/mergetasks=runcode,!desktopicon,!quicklaunchicon"],{detached:!0,stdio:["ignore","ignore","ignore"],windowsVerbatimArguments:!0}).once("exit",()=>{this.availableUpdate=void 0,this.setState(me.Idle(La()))});let o=`${this.productService.win32MutexName}-ready`,s=await import("@vscode/windows-mutex");Jk(()=>s.isActive(o)).then(()=>this.setState(me.Ready(e)))}doQuitAndInstall(){this.state.type!=="ready"||!this.availableUpdate||(this.logService.trace("update#quitAndInstall(): running raw#quitAndInstall()"),this.availableUpdate.updateFilePath?Go.unlinkSync(this.availableUpdate.updateFilePath):R1(this.availableUpdate.packagePath,["/silent","/log","/mergetasks=runcode,!desktopicon,!quicklaunchicon"],{detached:!0,stdio:["ignore","ignore","ignore"]}))}getUpdateType(){return La()}async _applySpecificUpdate(e){if(this.state.type!=="idle")return;let r=this.configurationService.getValue("update.enableWindowsBackgroundUpdates"),i={version:"unknown",productVersion:"unknown"};this.setState(me.Downloading),this.availableUpdate={packagePath:e},this.setState(me.Downloaded(i)),r?this.productService.target==="user"&&this.doApplyUpdate():this.setState(me.Ready(i))}};P([ie],jo.prototype,"cachePath",1),jo=P([g(0,oe),g(1,ce),g(2,Ve),g(3,ge),g(4,wr),g(5,A),g(6,Pe),g(7,Cr),g(8,be)],jo);var _f=class{constructor(t){this.channel=t}handleURL(t,e){return this.channel.call("handleURL",[t.toJSON(),e])}},Rf=class{constructor(t,e){this.next=t;this.logService=e}async routeCall(t,e,r,i){if(e!=="handleURL")throw new Error(`Call not found: ${e}`);if(Array.isArray(r)&&r.length>0){let o=x.revive(r[0]);if(this.logService.trace("URLHandlerRouter#routeCall() with URI argument",o.toString(!0)),o.query){let s=/\bwindowId=(\d+)/.exec(o.query);if(s){let a=s[1];this.logService.trace(`URLHandlerRouter#routeCall(): found windowId query parameter with value "${a}"`,o.toString(!0));let l=new RegExp(`window:${a}`),c=t.connections.find(d=>(this.logService.trace("URLHandlerRouter#routeCall(): testing connection",d.ctx),l.test(d.ctx)));if(c)return this.logService.trace("URLHandlerRouter#routeCall(): found a connection to route",o.toString(!0)),c;this.logService.trace("URLHandlerRouter#routeCall(): did not find a connection to route",o.toString(!0))}else this.logService.trace("URLHandlerRouter#routeCall(): did not find windowId query parameter",o.toString(!0))}}else this.logService.trace("URLHandlerRouter#routeCall() without URI argument");return this.next.routeCall(t,e,r,i)}routeEvent(t,e){throw new Error(`Event not found: ${e}`)}};var Tv=class extends D{handlers=new Set;open(t,e){let r=[...this.handlers.values()];return KI(r.map(i=>()=>i.handleURL(t,e)),void 0,!1).then(i=>i||!1)}registerHandler(t){return this.handlers.add(t),$(()=>this.handlers.delete(t))}},Ma=class extends Tv{constructor(e){super();this.productService=e}create(e){let{authority:r,path:i,query:o,fragment:s}=e||{authority:void 0,path:void 0,query:void 0,fragment:void 0};return r&&i&&i.indexOf("/")!==0&&(i=`/${i}`),x.from({scheme:this.productService.urlProtocol,authority:r,path:i,query:o,fragment:s})}};Ma=P([g(0,be)],Ma);import{app as D1}from"electron";var Df=class extends D{constructor(e,r,i,o,s,a){super();this.urlService=r;this.logService=a;if(e&&(a.trace("ElectronURLListener initialUrisToHandle:",e.map(d=>d.originalUrl)),this.uris=e),U){let d=o.isBuilt?[]:[`"${o.appRoot}"`];d.push("--open-url","--"),D1.setAsDefaultProtocolClient(s.urlProtocol,process.execPath,d)}let l=E.map(E.fromNodeEventEmitter(D1,"open-url",(d,u)=>({event:d,url:u})),({event:d,url:u})=>(d.preventDefault(),u));this._register(l(d=>{let u=this.uriFromRawUrl(d);u&&this.urlService.open(u,{originalUrl:d})})),i.getWindows().filter(d=>d.isReady).length>0?(a.trace("ElectronURLListener: window is ready to handle URLs"),this.flush()):(a.trace("ElectronURLListener: waiting for window to be ready to handle URLs..."),this._register(E.once(i.onDidSignalReadyWindow)(()=>this.flush())))}uris=[];retryCount=0;uriFromRawUrl(e){try{return x.parse(e)}catch{return}}async flush(){if(this.retryCount++>10){this.logService.trace("ElectronURLListener#flush(): giving up after 10 retries");return}this.logService.trace("ElectronURLListener#flush(): flushing URLs");let e=[];for(let r of this.uris)await this.urlService.open(r.uri,{originalUrl:r.originalUrl})?this.logService.trace("ElectronURLListener#flush(): URL was handled",r.originalUrl):(this.logService.trace("ElectronURLListener#flush(): URL was not yet handled",r.originalUrl),e.push(r));e.length!==0&&(this.uris=e,VI(()=>this.flush(),500,this._store))}};var Cv=F("webviewManagerService");import{webContents as Yk}from"electron";import{protocol as Qk}from"electron";var Of=class n extends D{static validWebviewFilePaths=new Map([["/index.html","index.html"],["/fake.html","fake.html"],["/service-worker.js","service-worker.js"]]);constructor(){super();let t=this.handleWebviewRequest.bind(this);Qk.registerFileProtocol(L.vscodeWebview,t)}handleWebviewRequest(t,e){try{let r=x.parse(t.url),i=n.validWebviewFilePaths.get(r.path);if(typeof i=="string"){let o=`vs/workbench/contrib/webview/browser/pre/${i}`,s=Re.asFileUri(o);return e({path:s.fsPath,headers:{...ws.getHeadersFromQuery(t.url),"Cross-Origin-Resource-Policy":"cross-origin"}})}else return e({error:-10})}catch{}return e({error:-2})}};var Aa=class extends D{constructor(e){super();this.windowsMainService=e;this._register(new Of)}_onFoundInFrame=this._register(new S);onFoundInFrame=this._onFoundInFrame.event;async setIgnoreMenuShortcuts(e,r){let i;if(typeof e.windowId=="number"){let{windowId:o}=e,s=this.windowsMainService.getWindowById(o);if(!s?.win)throw new Error(`Invalid windowId: ${o}`);i=s.win.webContents}else{let{webContentsId:o}=e;if(i=Yk.fromId(o),!i)throw new Error(`Invalid webContentsId: ${o}`)}i.isDestroyed()||i.setIgnoreMenuShortcuts(r)}async findInFrame(e,r,i,o){let a=this.getFrameByName(e,r);if(typeof a.findInFrame=="function"){a.findInFrame(i,{findNext:o.findNext,forward:o.forward});let l=(c,d)=>{d.finalUpdate&&(this._onFoundInFrame.fire(d),a.removeListener("found-in-frame",l))};a.on("found-in-frame",l)}}async stopFindInFrame(e,r,i){let s=this.getFrameByName(e,r);typeof s.stopFindInFrame=="function"&&s.stopFindInFrame(i.keepSelection?"keepSelection":"clearSelection")}getFrameByName(e,r){let i=this.windowsMainService.getWindowById(e.windowId);if(!i?.win)throw new Error(`Invalid windowId: ${e}`);let o=i.win.webContents.mainFrame.framesInSubtree.find(s=>s.name===r);if(!o)throw new Error(`Unknown frame: ${r}`);return o}};Aa=P([g(0,Fe)],Aa);import*as O1 from"fs";import{app as e_,BrowserWindow as Ff,shell as t_}from"electron";import{hostname as r_,release as n_,arch as i_}from"os";import Wa from"electron";var vi=class extends D{constructor(e,r,i,o,s){super();this.windowsMainService=e;this.stateService=r;this.lifecycleMainService=i;this.logService=o;this.configurationService=s;this.registerListeners()}static windowsStateStorageKey="windowsState";get state(){return this._state}_state=Xk(this.stateService.getItem(vi.windowsStateStorageKey));lastClosedState=void 0;shuttingDown=!1;registerListeners(){Wa.app.on("browser-window-blur",()=>{this.shuttingDown||this.saveWindowsState()}),this._register(this.lifecycleMainService.onBeforeCloseWindow(e=>this.onBeforeCloseWindow(e))),this._register(this.lifecycleMainService.onBeforeShutdown(()=>this.onBeforeShutdown())),this._register(this.windowsMainService.onDidChangeWindowsCount(e=>{e.newCount-e.oldCount>0&&(this.lastClosedState=void 0)})),this._register(this.windowsMainService.onDidDestroyWindow(e=>this.onBeforeCloseWindow(e)))}onBeforeShutdown(){this.shuttingDown=!0,this.saveWindowsState()}saveWindowsState(){let e=new Set,r={openedWindows:[],lastPluginDevelopmentHostWindow:this._state.lastPluginDevelopmentHostWindow,lastActiveWindow:this.lastClosedState};if(!r.lastActiveWindow){let s=this.windowsMainService.getLastActiveWindow();(!s||s.isExtensionDevelopmentHost)&&(s=this.windowsMainService.getWindows().find(a=>!a.isExtensionDevelopmentHost)),s&&(r.lastActiveWindow=this.toWindowState(s),r.lastActiveWindow.uiState.mode===3&&e.add(r.lastActiveWindow.uiState.display))}let i=this.windowsMainService.getWindows().find(s=>s.isExtensionDevelopmentHost&&!s.isExtensionTestHost);i&&(r.lastPluginDevelopmentHostWindow=this.toWindowState(i),r.lastPluginDevelopmentHostWindow.uiState.mode===3&&(e.has(r.lastPluginDevelopmentHostWindow.uiState.display)?W&&!i.win?.isSimpleFullScreen()&&(r.lastPluginDevelopmentHostWindow.uiState.mode=1):e.add(r.lastPluginDevelopmentHostWindow.uiState.display))),this.windowsMainService.getWindowCount()>1&&(r.openedWindows=this.windowsMainService.getWindows().filter(s=>!s.isExtensionDevelopmentHost).map(s=>{let a=this.toWindowState(s);return a.uiState.mode===3&&(e.has(a.uiState.display)?W&&a.windowId!==r.lastActiveWindow?.windowId&&!s.win?.isSimpleFullScreen()&&(a.uiState.mode=1):e.add(a.uiState.display)),a}));let o=Zk(r);this.stateService.setItem(vi.windowsStateStorageKey,o),this.shuttingDown&&this.logService.trace("[WindowsStateHandler] onBeforeShutdown",o)}onBeforeCloseWindow(e){if(this.lifecycleMainService.quitRequested)return;let r=this.toWindowState(e);e.isExtensionDevelopmentHost&&!e.isExtensionTestHost?this._state.lastPluginDevelopmentHostWindow=r:!e.isExtensionDevelopmentHost&&e.openedWorkspace&&this._state.openedWindows.forEach(i=>{let o=Be(e.openedWorkspace)&&i.workspace?.id===e.openedWorkspace.id,s=pt(e.openedWorkspace)&&i.folderUri&&Le.isEqual(i.folderUri,e.openedWorkspace.uri);(o||s)&&(i.uiState=r.uiState)}),this.windowsMainService.getWindowCount()===1&&(this.lastClosedState=r)}toWindowState(e){return{windowId:e.id,workspace:Be(e.openedWorkspace)?e.openedWorkspace:void 0,folderUri:pt(e.openedWorkspace)?e.openedWorkspace.uri:void 0,backupPath:e.backupPath,remoteAuthority:e.remoteAuthority,uiState:e.serializeWindowState()}}getNewWindowState(e){let r=this.doGetNewWindowState(e),i=this.configurationService.getValue("window");if(r.mode===3){let o;r.hasDefaultState?o=!!(i?.newWindowDimensions&&["fullscreen","inherit","offset"].indexOf(i.newWindowDimensions)>=0):o=!!(this.lifecycleMainService.wasRestarted||i?.restoreFullscreen),o||(r.mode=1)}return r}doGetNewWindowState(e){let r=this.windowsMainService.getLastActiveWindow();if(!e.extensionTestsPath){if(e.extensionDevelopmentPath&&this.state.lastPluginDevelopmentHostWindow)return this.state.lastPluginDevelopmentHostWindow.uiState;let c=e.workspace;if(Be(c)){let u=this.state.openedWindows.filter(m=>m.workspace&&m.workspace.id===c.id).map(m=>m.uiState);if(u.length)return u[0]}if(pt(c)){let u=this.state.openedWindows.filter(m=>m.folderUri&&Le.isEqual(m.folderUri,c.uri)).map(m=>m.uiState);if(u.length)return u[0]}else if(e.backupPath){let u=this.state.openedWindows.filter(m=>m.backupPath===e.backupPath).map(m=>m.uiState);if(u.length)return u[0]}let d=this.lastClosedState||this.state.lastActiveWindow;if(!r&&d)return d.uiState}let i,o=Wa.screen.getAllDisplays();if(o.length===1)i=o[0];else{if(W){let c=Wa.screen.getCursorScreenPoint();i=Wa.screen.getDisplayNearestPoint(c)}!i&&r&&(i=Wa.screen.getDisplayMatching(r.getBounds())),i||(i=Wa.screen.getPrimaryDisplay()||o[0])}let s=Ki();s.x=Math.round(i.bounds.x+i.bounds.width/2-s.width/2),s.y=Math.round(i.bounds.y+i.bounds.height/2-s.height/2);let a=this.configurationService.getValue("window"),l=!0;if(a?.newWindowDimensions){if(a.newWindowDimensions==="maximized")s.mode=0,l=!1;else if(a.newWindowDimensions==="fullscreen")s.mode=3,l=!1;else if((a.newWindowDimensions==="inherit"||a.newWindowDimensions==="offset")&&r){let c=r.serializeWindowState();c.mode===3?s.mode=3:s={...c,zoomLevel:void 0},l=s.mode!==3&&a.newWindowDimensions==="offset"}}return l&&(s=this.ensureNoOverlap(s)),s.hasDefaultState=!0,s}ensureNoOverlap(e){if(this.windowsMainService.getWindows().length===0)return e;e.x=typeof e.x=="number"?e.x:0,e.y=typeof e.y=="number"?e.y:0;let r=this.windowsMainService.getWindows().map(i=>i.getBounds());for(;r.some(i=>i.x===e.x||i.y===e.y);)e.x+=30,e.y+=30;return e}};vi=P([g(0,Fe),g(1,et),g(2,oe),g(3,A),g(4,ce)],vi);function Xk(n){let t={openedWindows:[]},e=n||{openedWindows:[]};return e.lastActiveWindow&&(t.lastActiveWindow=kv(e.lastActiveWindow)),e.lastPluginDevelopmentHostWindow&&(t.lastPluginDevelopmentHostWindow=kv(e.lastPluginDevelopmentHostWindow)),Array.isArray(e.openedWindows)&&(t.openedWindows=e.openedWindows.map(r=>kv(r))),t}function kv(n){let t={uiState:n.uiState};return n.backupPath&&(t.backupPath=n.backupPath),n.remoteAuthority&&(t.remoteAuthority=n.remoteAuthority),n.folder&&(t.folderUri=x.parse(n.folder)),n.workspaceIdentifier&&(t.workspace={id:n.workspaceIdentifier.id,configPath:x.parse(n.workspaceIdentifier.configURIPath)}),t}function Zk(n){return{lastActiveWindow:n.lastActiveWindow&&_v(n.lastActiveWindow),lastPluginDevelopmentHostWindow:n.lastPluginDevelopmentHostWindow&&_v(n.lastPluginDevelopmentHostWindow),openedWindows:n.openedWindows.map(t=>_v(t))}}function _v(n){return{workspaceIdentifier:n.workspace&&{id:n.workspace.id,configURIPath:n.workspace.configPath.toString()},folder:n.folderUri&&n.folderUri.toString(),backupPath:n.backupPath,remoteAuthority:n.remoteAuthority,uiState:n.uiState}}function Lf(n){return Be(n?.workspace)}function Ua(n){return pt(n?.workspace)}var Na=class extends D{constructor(e,r,i,o,s,a,l,c,d,u,m,h,y,v,b,C,k,_,T,N,J,H){super();this.machineId=e;this.sqmId=r;this.devDeviceId=i;this.initialUserEnv=o;this.logService=s;this.loggerService=a;this.stateService=l;this.policyService=c;this.environmentMainService=d;this.userDataProfilesMainService=u;this.lifecycleMainService=m;this.backupMainService=h;this.configurationService=y;this.workspacesHistoryMainService=v;this.workspacesManagementMainService=b;this.instantiationService=C;this.dialogMainService=k;this.fileService=_;this.protocolMainService=T;this.themeMainService=N;this.auxiliaryWindowsMainService=J;this.cssDevelopmentService=H;this.registerListeners()}_onDidOpenWindow=this._register(new S);onDidOpenWindow=this._onDidOpenWindow.event;_onDidSignalReadyWindow=this._register(new S);onDidSignalReadyWindow=this._onDidSignalReadyWindow.event;_onDidDestroyWindow=this._register(new S);onDidDestroyWindow=this._onDidDestroyWindow.event;_onDidChangeWindowsCount=this._register(new S);onDidChangeWindowsCount=this._onDidChangeWindowsCount.event;_onDidMaximizeWindow=this._register(new S);onDidMaximizeWindow=this._onDidMaximizeWindow.event;_onDidUnmaximizeWindow=this._register(new S);onDidUnmaximizeWindow=this._onDidUnmaximizeWindow.event;_onDidChangeFullScreen=this._register(new S);onDidChangeFullScreen=this._onDidChangeFullScreen.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;windows=new Map;windowsStateHandler=this._register(new vi(this,this.stateService,this.lifecycleMainService,this.logService,this.configurationService));registerListeners(){this._register(this.workspacesManagementMainService.onDidEnterWorkspace(e=>this._onDidSignalReadyWindow.fire(e.window))),this._register(this.onDidSignalReadyWindow(e=>{if(e.config?.extensionDevelopmentPath||e.config?.extensionTestsPath){let r=new Y;if(r.add(E.any(e.onDidClose,e.onDidDestroy)(()=>r.dispose())),e.config.extensionDevelopmentPath)for(let i of e.config.extensionDevelopmentPath)r.add(this.protocolMainService.addValidFileRoot(i));e.config.extensionTestsPath&&r.add(this.protocolMainService.addValidFileRoot(e.config.extensionTestsPath))}}))}openEmptyWindow(e,r){let i=this.environmentMainService.args,o=r?.remoteAuthority||void 0,s=!0,a=r?.forceReuseWindow,l=!a;return this.open({...e,cli:i,forceEmpty:s,forceNewWindow:l,forceReuseWindow:a,remoteAuthority:o,forceTempProfile:r?.forceTempProfile,forceProfile:r?.forceProfile})}openExistingWindow(e,r){e.focus(),this.handleWaitMarkerFile(r,[e])}async open(e){this.logService.trace("windowsManager#open"),e.addMode&&(e.initialStartup||!this.getLastActiveWindow())&&(e.addMode=!1);let r=[],i=[],o=[],s=[],a=[],l,c=!1,d=await this.getPathsToOpen(e);this.logService.trace("windowsManager#open pathsToOpen",d);for(let v of d)Ua(v)?e.addMode?r.push(v):i.push(v):Lf(v)?o.push(v):v.fileUri?(l||(l={filesToOpenOrCreate:[],filesToDiff:[],filesToMerge:[],remoteAuthority:v.remoteAuthority}),l.filesToOpenOrCreate.push(v)):v.backupPath?a.push({backupFolder:pe(v.backupPath),remoteAuthority:v.remoteAuthority}):c=!0;e.diffMode&&l&&l.filesToOpenOrCreate.length>=2&&(l.filesToDiff=l.filesToOpenOrCreate.slice(0,2),l.filesToOpenOrCreate=[]),e.mergeMode&&l&&l.filesToOpenOrCreate.length===4&&(l.filesToMerge=l.filesToOpenOrCreate.slice(0,4),l.filesToOpenOrCreate=[],l.filesToDiff=[]),l&&e.waitMarkerFileURI&&(l.filesToWait={paths:Ye([...l.filesToDiff,l.filesToMerge[3],...l.filesToOpenOrCreate]),waitMarkerFileUri:e.waitMarkerFileURI}),e.initialStartup?(s.push(...this.workspacesManagementMainService.getUntitledWorkspaces()),o.push(...s),a.push(...this.backupMainService.getEmptyWindowBackups())):a.length=0;let{windows:u,filesOpenedInWindow:m}=await this.doOpen(e,o,i,a,c,l,r);if(this.logService.trace(`windowsManager#open used window count ${u.length} (workspacesToOpen: ${o.length}, foldersToOpen: ${i.length}, emptyToRestore: ${a.length}, openOneEmptyWindow: ${c})`),u.length>1)if(m)m.focus();else{let v=this.windowsStateHandler.state.lastActiveWindow&&!e.forceEmpty&&!e.cli._.length&&!e.cli["file-uri"]&&!e.cli["folder-uri"]&&!(e.urisToOpen&&e.urisToOpen.length),b=!0,C=!0;if(v){let k=u.filter(_=>this.windowsStateHandler.state.lastActiveWindow&&_.backupPath===this.windowsStateHandler.state.lastActiveWindow.backupPath);k.length&&(k[0].focus(),b=!1,C=!1)}if(b)for(let k=u.length-1;k>=0;k--){let _=u[k];if(!(_.openedWorkspace&&s.some(T=>_.openedWorkspace&&T.workspace.id===_.openedWorkspace.id)||_.backupPath&&a.some(T=>_.backupPath&&T.backupFolder===pe(_.backupPath)))){_.focus(),C=!1;break}}C&&u[u.length-1].focus()}let h=l&&l.filesToDiff.length>0,y=l&&l.filesToMerge.length>0;if(!u.some(v=>v.isExtensionDevelopmentHost)&&!h&&!y&&!e.noRecentEntry){let v=[];for(let b of d)Lf(b)&&!b.transient?v.push({label:b.label,workspace:b.workspace,remoteAuthority:b.remoteAuthority}):Ua(b)?v.push({label:b.label,folderUri:b.workspace.uri,remoteAuthority:b.remoteAuthority}):b.fileUri&&v.push({label:b.label,fileUri:b.fileUri,remoteAuthority:b.remoteAuthority});this.workspacesHistoryMainService.addRecentlyOpened(v)}return this.handleWaitMarkerFile(e,u),u}handleWaitMarkerFile(e,r){let i=e.waitMarkerFileURI;e.context===0&&i&&r.length===1&&r[0]&&(async()=>{await r[0].whenClosedOrLoaded;try{await this.fileService.del(i)}catch{}})()}async doOpen(e,r,i,o,s,a,l){let c=[],d;function u(k,_){c.push(k),_&&(d=k,a=void 0)}let{openFolderInNewWindow:m,openFilesInNewWindow:h}=this.shouldOpenNewWindow(e);if(!e.initialStartup&&l.length>0){let k=l[0].remoteAuthority,_=this.getLastActiveWindowForAuthority(k);_&&u(this.doAddFoldersToExistingWindow(_,l.map(T=>T.workspace.uri)))}let y=i.length+r.length+o.length;if(a&&y===0){let k=a.filesToOpenOrCreate[0]||a.filesToDiff[0]||a.filesToMerge[3],_=this.getWindows().filter(N=>a&&Xt(N.remoteAuthority,a.remoteAuthority)),T;k?.fileUri&&!h&&((e.context===4||e.context===0||e.context===1||e.context===6)&&(T=await xS(_,k.fileUri,async N=>N.configPath.scheme===L.file?this.workspacesManagementMainService.resolveLocalWorkspace(N.configPath):void 0)),T||(T=this.doGetLastActiveWindow(_))),T?Be(T.openedWorkspace)?r.push({workspace:T.openedWorkspace,remoteAuthority:T.remoteAuthority}):pt(T.openedWorkspace)?i.push({workspace:T.openedWorkspace,remoteAuthority:T.remoteAuthority}):u(this.doOpenFilesInExistingWindow(e,T,a),!0):u(await this.openInBrowserWindow({userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,filesToOpen:a,forceNewWindow:!0,remoteAuthority:a.remoteAuthority,forceNewTabbedWindow:e.forceNewTabbedWindow,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile}),!0)}let v=Qt(r,k=>k.workspace.id);if(v.length>0){let k=Ye(v.map(_=>qi(this.getWindows(),_.workspace.configPath)));if(k.length>0){let _=k[0],T=Xt(a?.remoteAuthority,_.remoteAuthority)?a:void 0;u(this.doOpenFilesInExistingWindow(e,_,T),!!T),m=!0}for(let _ of v){if(k.some(J=>J.openedWorkspace&&J.openedWorkspace.id===_.workspace.id))continue;let T=_.remoteAuthority,N=Xt(a?.remoteAuthority,T)?a:void 0;u(await this.doOpenFolderOrWorkspace(e,_,m,N),!!N),m=!0}}let b=Qt(i,k=>Le.getComparisonKey(k.workspace.uri));if(b.length>0){let k=Ye(b.map(_=>qi(this.getWindows(),_.workspace.uri)));if(k.length>0){let _=k[0],T=Xt(a?.remoteAuthority,_.remoteAuthority)?a:void 0;u(this.doOpenFilesInExistingWindow(e,_,T),!!T),m=!0}for(let _ of b){if(k.some(J=>pt(J.openedWorkspace)&&Le.isEqual(J.openedWorkspace.uri,_.workspace.uri)))continue;let T=_.remoteAuthority,N=Xt(a?.remoteAuthority,T)?a:void 0;u(await this.doOpenFolderOrWorkspace(e,_,m,N),!!N),m=!0}}let C=Qt(o,k=>k.backupFolder);if(C.length>0)for(let k of C){let _=k.remoteAuthority,T=Xt(a?.remoteAuthority,_)?a:void 0;u(await this.doOpenEmpty(e,!0,_,T,k),!!T),m=!0}if(a||s){let k=a?a.remoteAuthority:e.remoteAuthority;u(await this.doOpenEmpty(e,m,k,a),!!a)}return{windows:Qt(c),filesOpenedInWindow:d}}doOpenFilesInExistingWindow(e,r,i){this.logService.trace("windowsManager#doOpenFilesInExistingWindow",{filesToOpen:i}),this.focusMainOrChildWindow(r);let o={filesToOpenOrCreate:i?.filesToOpenOrCreate,filesToDiff:i?.filesToDiff,filesToMerge:i?.filesToMerge,filesToWait:i?.filesToWait,termProgram:e?.userEnv?.TERM_PROGRAM};return r.sendWhenReady("vscode:openFiles",we.None,o),r}focusMainOrChildWindow(e){let r=e,i=Ff.getFocusedWindow();if(i&&i.id!==e.id){let o=this.auxiliaryWindowsMainService.getWindowByWebContents(i.webContents);o&&o.parentId===e.id&&(r=o)}r.focus()}doAddFoldersToExistingWindow(e,r){this.logService.trace("windowsManager#doAddFoldersToExistingWindow",{foldersToAdd:r}),e.focus();let i={foldersToAdd:r};return e.sendWhenReady("vscode:addFolders",we.None,i),e}doOpenEmpty(e,r,i,o,s){this.logService.trace("windowsManager#doOpenEmpty",{restore:!!s,remoteAuthority:i,filesToOpen:o,forceNewWindow:r});let a;return!r&&typeof e.contextWindowId=="number"&&(a=this.getWindowById(e.contextWindowId)),this.openInBrowserWindow({userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,remoteAuthority:i,forceNewWindow:r,forceNewTabbedWindow:e.forceNewTabbedWindow,filesToOpen:o,windowToUse:a,emptyWindowBackupInfo:s,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile})}doOpenFolderOrWorkspace(e,r,i,o,s){return this.logService.trace("windowsManager#doOpenFolderOrWorkspace",{folderOrWorkspace:r,filesToOpen:o}),!i&&!s&&typeof e.contextWindowId=="number"&&(s=this.getWindowById(e.contextWindowId)),this.openInBrowserWindow({workspace:r.workspace,userEnv:e.userEnv,cli:e.cli,initialStartup:e.initialStartup,remoteAuthority:r.remoteAuthority,forceNewWindow:i,forceNewTabbedWindow:e.forceNewTabbedWindow,filesToOpen:o,windowToUse:s,forceProfile:e.forceProfile,forceTempProfile:e.forceTempProfile})}async getPathsToOpen(e){let r,i=!1,o=!1;if(e.urisToOpen&&e.urisToOpen.length>0?(r=await this.doExtractPathsFromAPI(e),i=!0):e.forceEmpty?r=[Object.create(null)]:e.cli._.length||e.cli["folder-uri"]||e.cli["file-uri"]?(r=await this.doExtractPathsFromCLI(e.cli),r.length===0&&r.push(Object.create(null)),i=!0):(r=await this.doGetPathsFromLastSession(),r.length===0&&r.push(Object.create(null)),o=!0),!e.addMode&&i){let s=r.filter(a=>Ua(a));if(s.length>1){let a=s[0].remoteAuthority;if(s.every(l=>Xt(l.remoteAuthority,a))){let l=await this.workspacesManagementMainService.createUntitledWorkspace(s.map(c=>({uri:c.workspace.uri})));r.push({workspace:l,remoteAuthority:a}),r=r.filter(c=>!Ua(c))}}}if(e.initialStartup&&!o&&this.configurationService.getValue("window")?.restoreWindows==="preserve"){let s=await this.doGetPathsFromLastSession();r.unshift(...s.filter(a=>Lf(a)||Ua(a)||a.backupPath))}return r}async doExtractPathsFromAPI(e){let r={gotoLineMode:e.gotoLineMode,remoteAuthority:e.remoteAuthority},i=await Promise.all(Ye(e.urisToOpen||[]).map(async o=>{let s=await this.resolveOpenable(o,r);if(s)return s.label=o.label,s;let a=this.resourceFromOpenable(o);this.dialogMainService.showMessageBox({type:"info",buttons:[p({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK")],message:a.scheme===L.file?p("pathNotExistTitle","Path does not exist"):p("uriInvalidTitle","URI can not be opened"),detail:a.scheme===L.file?p("pathNotExistDetail","The path '{0}' does not exist on this computer.",ni(a,{os:xt,tildify:this.environmentMainService})):p("uriInvalidDetail","The URI '{0}' is not valid and can not be opened.",a.toString(!0))},Ff.getFocusedWindow()??void 0)}));return Ye(i)}async doExtractPathsFromCLI(e){let r=[],i={ignoreFileNotFound:!0,gotoLineMode:e.goto,remoteAuthority:e.remote||void 0,forceOpenWorkspaceAsFile:e.diff&&e._.length===2||e.merge&&e._.length===4},o=e["folder-uri"];if(o){let l=await Promise.all(o.map(c=>{let d=this.cliArgToUri(c);if(d)return this.resolveOpenable({folderUri:d},i)}));r.push(...Ye(l))}let s=e["file-uri"];if(s){let l=await Promise.all(s.map(c=>{let d=this.cliArgToUri(c);if(d)return this.resolveOpenable(Tn(c)?{workspaceUri:d}:{fileUri:d},i)}));r.push(...Ye(l))}let a=await Promise.all(e._.map(l=>i.remoteAuthority?this.doResolveRemotePath(l,i):this.doResolveFilePath(l,i)));return r.push(...Ye(a)),r}cliArgToUri(e){try{let r=x.parse(e);if(!r.scheme){this.logService.error(`Invalid URI input string, scheme missing: ${e}`);return}return r.path?r:r.with({path:"/"})}catch(r){this.logService.error(`Invalid URI input string: ${e}, ${r.message}`)}}async doGetPathsFromLastSession(){let e=this.getRestoreWindowsSetting();switch(e){case"none":return[];case"one":case"all":case"preserve":case"folders":{let r=[];e!=="one"&&r.push(...this.windowsStateHandler.state.openedWindows),this.windowsStateHandler.state.lastActiveWindow&&r.push(this.windowsStateHandler.state.lastActiveWindow);let i=await Promise.all(r.map(async o=>{if(o.workspace){let s=await this.resolveOpenable({workspaceUri:o.workspace.configPath},{remoteAuthority:o.remoteAuthority,rejectTransientWorkspaces:!0});if(Lf(s))return s}else if(o.folderUri){let s=await this.resolveOpenable({folderUri:o.folderUri},{remoteAuthority:o.remoteAuthority});if(Ua(s))return s}else if(e!=="folders"&&o.backupPath)return{backupPath:o.backupPath,remoteAuthority:o.remoteAuthority}}));return Ye(i)}}}getRestoreWindowsSetting(){let e;return this.lifecycleMainService.wasRestarted?e="all":(e=this.configurationService.getValue("window")?.restoreWindows||"all",["preserve","all","folders","one","none"].includes(e)||(e="all")),e}async resolveOpenable(e,r=Object.create(null)){let i=this.resourceFromOpenable(e);return i.scheme===L.file?(xg(e)&&(r={...r,forceOpenWorkspaceAsFile:!0}),this.doResolveFilePath(i.fsPath,r)):this.doResolveRemoteOpenable(e,r)}doResolveRemoteOpenable(e,r){let i=this.resourceFromOpenable(e),o=di(i)||r.remoteAuthority;if(i=kI(ru(i)),xg(e)){if(r.gotoLineMode){let{path:s,line:a,column:l}=Is(i.path);return{fileUri:i.with({path:s}),options:{selection:a?{startLineNumber:a,startColumn:l||1}:void 0},remoteAuthority:o}}return{fileUri:i,remoteAuthority:o}}else if(wc(e))return{workspace:pi(i),remoteAuthority:o};return{workspace:Lp(i),remoteAuthority:o}}resourceFromOpenable(e){return wc(e)?e.workspaceUri:mp(e)?e.folderUri:e.fileUri}async doResolveFilePath(e,r,i){let o,s;r.gotoLineMode&&({path:e,line:o,column:s}=Is(e)),e=Zd(lt(e),ar());try{let a=await O1.promises.stat(e);if(a.isFile()){if(!r.forceOpenWorkspaceAsFile){let l=await this.workspacesManagementMainService.resolveLocalWorkspace(x.file(e));if(l)return l.transient&&r.rejectTransientWorkspaces?void 0:{workspace:{id:l.id,configPath:l.configPath},type:1,exists:!0,remoteAuthority:l.remoteAuthority,transient:l.transient}}return{fileUri:x.file(e),type:1,exists:!0,options:{selection:o?{startLineNumber:o,startColumn:s||1}:void 0}}}else{if(a.isDirectory())return{workspace:Lp(x.file(e),a),type:2,exists:!0};if(!U&&e==="/dev/null")return{fileUri:x.file(e),type:1,exists:!0}}}catch(a){if(a.code==="ERR_UNC_HOST_NOT_ALLOWED"&&!i)return this.onUNCHostNotAllowed(e,r);let l=x.file(e);if(this.workspacesHistoryMainService.removeRecentlyOpened([l]),r.ignoreFileNotFound)return{fileUri:l,type:1,exists:!1}}}async onUNCHostNotAllowed(e,r){let i=x.file(e),{response:o,checkboxChecked:s}=await this.dialogMainService.showMessageBox({type:"warning",buttons:[p({key:"allow",comment:["&& denotes a mnemonic"]},"&&Allow"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&Cancel"),p({key:"learnMore",comment:["&& denotes a mnemonic"]},"&&Learn More")],message:p("confirmOpenMessage","The host '{0}' was not found in the list of allowed hosts. Do you want to allow it anyway?",i.authority),detail:p("confirmOpenDetail","The path '{0}' uses a host that is not allowed. Unless you trust the host, you should press 'Cancel'",ni(i,{os:xt,tildify:this.environmentMainService})),checkboxLabel:p("doNotAskAgain","Permanently allow host '{0}'",i.authority),cancelId:1});if(o===0){if(Ls(i.authority),s){let a={channel:"vscode:configureAllowedUNCHost",args:i.authority};this.sendToFocused(a.channel,a.args),this.sendToOpeningWindow(a.channel,a.args)}return this.doResolveFilePath(e,r,!0)}if(o===2)return t_.openExternal("https://aka.ms/vscode-windows-unc"),this.onUNCHostNotAllowed(e,r)}doResolveRemotePath(e,r){let i=e.charCodeAt(0),o=r.remoteAuthority,s,a;r.gotoLineMode&&({path:e,line:s,column:a}=Is(e)),i!==47&&(Xd(i)&&e.charCodeAt(e.charCodeAt(1))===58&&(e=Pn(e)),e=`/${e}`);let l=x.from({scheme:L.vscodeRemote,authority:o,path:e});if(e.charCodeAt(e.length-1)!==47){if(Tn(e))return r.forceOpenWorkspaceAsFile?{fileUri:l,options:{selection:s?{startLineNumber:s,startColumn:a||1}:void 0},remoteAuthority:r.remoteAuthority}:{workspace:pi(l),remoteAuthority:o};if(r.gotoLineMode||ee.basename(e).indexOf(".")!==-1)return{fileUri:l,options:{selection:s?{startLineNumber:s,startColumn:a||1}:void 0},remoteAuthority:o}}return{workspace:Lp(l),remoteAuthority:o}}shouldOpenNewWindow(e){let r=this.configurationService.getValue("window"),i=r?.openFoldersInNewWindow||"default",o=r?.openFilesInNewWindow||"off",s=(e.preferNewWindow||e.forceNewWindow)&&!e.forceReuseWindow;!e.forceNewWindow&&!e.forceReuseWindow&&(i==="on"||i==="off")&&(s=i==="on");let a=!1;return e.forceNewWindow||e.forceReuseWindow?a=!!e.forceNewWindow&&!e.forceReuseWindow:(W?e.context===1&&(a=!0):e.context!==3&&e.context!==2&&!(e.userEnv&&e.userEnv.TERM_PROGRAM==="vscode")&&(a=!0),!e.cli.extensionDevelopmentPath&&(o==="on"||o==="off")&&(a=o==="on")),{openFolderInNewWindow:!!s,openFilesInNewWindow:a}}async openExtensionDevelopmentHostWindow(e,r){let i=ES(this.getWindows(),e);if(i)return this.lifecycleMainService.reload(i,r.cli),i.focus(),[i];let o=r.cli["folder-uri"]||[],s=r.cli["file-uri"]||[],a=r.cli._;if(!a.length&&!o.length&&!s.length&&!r.cli.extensionTestsPath){let d=this.windowsStateHandler.state.lastPluginDevelopmentHostWindow,u=d?.workspace??d?.folderUri;u&&(x.isUri(u)?u.scheme===L.file?a=[u.fsPath]:o=[u.toString()]:u.configPath.scheme===L.file?a=[Dt(u.configPath)]:s=[u.configPath.toString()])}let l=r.remoteAuthority;for(let d of e)if(d.match(/^[a-zA-Z][a-zA-Z0-9\+\-\.]+:/)){let u=x.parse(d),m=di(u);m&&(l?Xt(m,l)||this.logService.error("more than one extension development path authority"):l=m)}a=a.filter(d=>{let u=x.file(d);return qi(this.getWindows(),u)?!1:Xt(di(u),l)}),o=o.filter(d=>{let u=this.cliArgToUri(d);return u&&qi(this.getWindows(),u)?!1:u?Xt(di(u),l):!1}),s=s.filter(d=>{let u=this.cliArgToUri(d);return u&&qi(this.getWindows(),u)?!1:u?Xt(di(u),l):!1}),r.cli._=a,r.cli["folder-uri"]=o,r.cli["file-uri"]=s;let c={context:r.context,cli:r.cli,forceNewWindow:!0,forceEmpty:!a.length&&!o.length&&!s.length,userEnv:r.userEnv,noRecentEntry:!0,waitMarkerFileURI:r.waitMarkerFileURI,remoteAuthority:l,forceProfile:r.forceProfile,forceTempProfile:r.forceTempProfile};return this.open(c)}async openInBrowserWindow(e){let r=this.configurationService.getValue("window"),i=this.getLastActiveWindow(),s=(r?.newWindowProfile?this.userDataProfilesMainService.profiles.find(c=>c.name===r.newWindowProfile):void 0)??i?.profile??this.userDataProfilesMainService.defaultProfile,a;!e.forceNewWindow&&!e.forceNewTabbedWindow&&(a=e.windowToUse||i,a&&a.focus());let l={...this.environmentMainService.args,...e.cli,machineId:this.machineId,sqmId:this.sqmId,devDeviceId:this.devDeviceId,windowId:-1,mainPid:process.pid,appRoot:this.environmentMainService.appRoot,execPath:process.execPath,codeCachePath:this.environmentMainService.codeCachePath,backupPath:e.emptyWindowBackupInfo?V(this.environmentMainService.backupHome,e.emptyWindowBackupInfo.backupFolder):void 0,profiles:{home:this.userDataProfilesMainService.profilesHome,all:this.userDataProfilesMainService.profiles,profile:s},homeDir:this.environmentMainService.userHome.with({scheme:L.file}).fsPath,tmpDir:this.environmentMainService.tmpDir.with({scheme:L.file}).fsPath,userDataDir:this.environmentMainService.userDataPath,remoteAuthority:e.remoteAuthority,workspace:e.workspace,userEnv:{...this.initialUserEnv,...e.userEnv},nls:{messages:jn(),language:tn()},filesToOpenOrCreate:e.filesToOpen?.filesToOpenOrCreate,filesToDiff:e.filesToOpen?.filesToDiff,filesToMerge:e.filesToOpen?.filesToMerge,filesToWait:e.filesToOpen?.filesToWait,logLevel:this.loggerService.getLogLevel(),loggers:{window:[],global:this.loggerService.getRegisteredLoggers()},logsPath:this.environmentMainService.logsHome.with({scheme:L.file}).fsPath,product:nr,isInitialStartup:e.initialStartup,perfMarks:wu(),os:{release:n_(),hostname:r_(),arch:i_()},autoDetectHighContrast:r?.autoDetectHighContrast??!0,autoDetectColorScheme:r?.autoDetectColorScheme??!1,accessibilitySupport:e_.accessibilitySupportEnabled,colorScheme:this.themeMainService.getColorScheme(),policiesData:this.policyService.serialize(),continueOn:this.environmentMainService.continueOn,cssModules:this.cssDevelopmentService.isEnabled?await this.cssDevelopmentService.getCssModules():void 0};if(a){let c=a.config;!l.extensionDevelopmentPath&&c?.extensionDevelopmentPath&&(l.extensionDevelopmentPath=c.extensionDevelopmentPath,l.extensionDevelopmentKind=c.extensionDevelopmentKind,l["enable-proposed-api"]=c["enable-proposed-api"],l.verbose=c.verbose,l["inspect-extensions"]=c["inspect-extensions"],l["inspect-brk-extensions"]=c["inspect-brk-extensions"],l.debugId=c.debugId,l.extensionEnvironment=c.extensionEnvironment,l["extensions-dir"]=c["extensions-dir"],l["disable-extensions"]=c["disable-extensions"]),l.loggers={global:l.loggers.global,window:c?.loggers.window??l.loggers.window}}else{let c=this.windowsStateHandler.getNewWindowState(l);gt("code/willCreateCodeWindow");let d=a=this.instantiationService.createInstance(No,{state:c,extensionDevelopmentPath:l.extensionDevelopmentPath,isExtensionTestHost:!!l.extensionTestsPath});gt("code/didCreateCodeWindow"),e.forceNewTabbedWindow&&this.getLastActiveWindow()?.addTabbedWindow(d),this.windows.set(d.id,d),this._onDidOpenWindow.fire(d),this._onDidChangeWindowsCount.fire({oldCount:this.getWindowCount()-1,newCount:this.getWindowCount()});let u=new Y;u.add(d.onDidSignalReady(()=>this._onDidSignalReadyWindow.fire(d))),u.add(E.once(d.onDidClose)(()=>this.onWindowClosed(d,u))),u.add(E.once(d.onDidDestroy)(()=>this.onWindowDestroyed(d))),u.add(d.onDidMaximize(()=>this._onDidMaximizeWindow.fire(d))),u.add(d.onDidUnmaximize(()=>this._onDidUnmaximizeWindow.fire(d))),u.add(d.onDidEnterFullScreen(()=>this._onDidChangeFullScreen.fire({window:d,fullscreen:!0}))),u.add(d.onDidLeaveFullScreen(()=>this._onDidChangeFullScreen.fire({window:d,fullscreen:!1}))),u.add(d.onDidTriggerSystemContextMenu(({x:h,y})=>this._onDidTriggerSystemContextMenu.fire({window:d,x:h,y})));let m=Zn(d.win?.webContents);m.removeAllListeners("devtools-reload-page"),u.add(E.fromNodeEventEmitter(m,"devtools-reload-page")(()=>this.lifecycleMainService.reload(d))),this.lifecycleMainService.registerWindow(d)}return l.windowId=a.id,a.isReady?this.lifecycleMainService.unload(a,4).then(async c=>{c||await this.doOpenInBrowserWindow(a,l,e,s)}):await this.doOpenInBrowserWindow(a,l,e,s),a}async doOpenInBrowserWindow(e,r,i,o){if(r.extensionDevelopmentPath||(Be(r.workspace)?r.backupPath=this.backupMainService.registerWorkspaceBackup({workspace:r.workspace,remoteAuthority:r.remoteAuthority}):pt(r.workspace)?r.backupPath=this.backupMainService.registerFolderBackup({folderUri:r.workspace.uri,remoteAuthority:r.remoteAuthority}):r.backupPath=this.backupMainService.registerEmptyWindowBackup({backupFolder:i.emptyWindowBackupInfo?.backupFolder??Rc().id,remoteAuthority:r.remoteAuthority})),this.userDataProfilesMainService.isEnabled()){let s=r.workspace??Ri(r.backupPath,!1),a=this.resolveProfileForBrowserWindow(i,s,o),l=a instanceof Promise?await a:a;r.profiles.profile=l,r.extensionDevelopmentPath||await this.userDataProfilesMainService.setProfileForWorkspace(s,l)}e.load(r)}resolveProfileForBrowserWindow(e,r,i){return e.forceProfile?this.userDataProfilesMainService.profiles.find(o=>o.name===e.forceProfile)??this.userDataProfilesMainService.createNamedProfile(e.forceProfile):e.forceTempProfile?this.userDataProfilesMainService.createTransientProfile():this.userDataProfilesMainService.getProfileForWorkspace(r)??i}onWindowClosed(e,r){this.windows.delete(e.id),this._onDidChangeWindowsCount.fire({oldCount:this.getWindowCount()+1,newCount:this.getWindowCount()}),r.dispose()}onWindowDestroyed(e){this.windows.delete(e.id),this._onDidDestroyWindow.fire(e)}getFocusedWindow(){let e=Ff.getFocusedWindow();if(e)return this.getWindowById(e.id)}getLastActiveWindow(){return this.doGetLastActiveWindow(this.getWindows())}getLastActiveWindowForAuthority(e){return this.doGetLastActiveWindow(this.getWindows().filter(r=>Xt(r.remoteAuthority,e)))}doGetLastActiveWindow(e){return kp(e)}sendToFocused(e,...r){(this.getFocusedWindow()||this.getLastActiveWindow())?.sendWhenReady(e,we.None,...r)}sendToOpeningWindow(e,...r){this._register(E.once(this.onDidSignalReadyWindow)(i=>{i.sendWhenReady(e,we.None,...r)}))}sendToAll(e,r,i){for(let o of this.getWindows())i&&i.indexOf(o.id)>=0||o.sendWhenReady(e,we.None,r)}getWindows(){return Array.from(this.windows.values())}getWindowCount(){return this.windows.size}getWindowById(e){return this.windows.get(e)}getWindowByWebContents(e){let r=Ff.fromWebContents(e);if(!r)return;let i=this.getWindowById(r.id);return i?.matches(e)?i:void 0}};Na=P([g(4,A),g(5,Nn),g(6,et),g(7,Jr),g(8,ge),g(9,rr),g(10,oe),g(11,An),g(12,ce),g(13,ro),g(14,Tr),g(15,Yt),g(16,Gt),g(17,Pe),g(18,Wn),g(19,Un),g(20,mi),g(21,Xi)],Na);var Mf=class extends D{disposables=this._register(new Y);firstActiveWindowIdPromise;activeWindowId;constructor({onDidOpenMainWindow:t,onDidFocusMainWindow:e,getActiveWindowId:r}){super(),E.latch(E.any(t,e))(this.setActiveWindow,this,this.disposables),this.firstActiveWindowIdPromise=ri(()=>r()),(async()=>{try{let o=await this.firstActiveWindowIdPromise;this.activeWindowId=typeof this.activeWindowId=="number"?this.activeWindowId:o}catch{}finally{this.firstActiveWindowIdPromise=void 0}})()}setActiveWindow(t){this.firstActiveWindowIdPromise&&(this.firstActiveWindowIdPromise.cancel(),this.firstActiveWindowIdPromise=void 0),this.activeWindowId=t}async getActiveClientId(){return`window:${this.firstActiveWindowIdPromise?await this.firstActiveWindowIdPromise:this.activeWindowId}`}};var Ba=class{constructor(t,e,r,i){this.workspacesManagementMainService=t;this.windowsMainService=e;this.workspacesHistoryMainService=r;this.backupMainService=i}async enterWorkspace(t,e){let r=this.windowsMainService.getWindowById(t);if(r)return this.workspacesManagementMainService.enterWorkspace(r,this.windowsMainService.getWindows(),e)}createUntitledWorkspace(t,e,r){return this.workspacesManagementMainService.createUntitledWorkspace(e,r)}deleteUntitledWorkspace(t,e){return this.workspacesManagementMainService.deleteUntitledWorkspace(e)}getWorkspaceIdentifier(t,e){return this.workspacesManagementMainService.getWorkspaceIdentifier(e)}onDidChangeRecentlyOpened=this.workspacesHistoryMainService.onDidChangeRecentlyOpened;getRecentlyOpened(t){return this.workspacesHistoryMainService.getRecentlyOpened()}addRecentlyOpened(t,e){return this.workspacesHistoryMainService.addRecentlyOpened(e)}removeRecentlyOpened(t,e){return this.workspacesHistoryMainService.removeRecentlyOpened(e)}clearRecentlyOpened(t){return this.workspacesHistoryMainService.clearRecentlyOpened()}async getDirtyWorkspaces(){return this.backupMainService.getDirtyWorkspaces()}};Ba=P([g(0,Tr),g(1,Fe),g(2,ro),g(3,An)],Ba);var Af=class{constructor(t){this.service=t}disposables=new Y;listen(t,e){switch(e){case"onDidChange":return E.map(this.service.onDidChange,r=>r.reduce((i,o)=>({...i,[o]:this.service.getPolicyValue(o)??null}),{}),this.disposables)}throw new Error(`Event not found: ${e}`)}call(t,e,r){switch(e){case"updatePolicyDefinitions":return this.service.updatePolicyDefinitions(r)}throw new Error(`Call not found: ${e}`)}dispose(){this.disposables.dispose()}};var Wf=class{constructor(t){this.service=t}listen(t,e){throw new Error("Invalid listen")}call(t,e,r,i=we.None){switch(e){case"request":return this.service.request(r[0],i).then(async({res:o,stream:s})=>{let a=await ii(s);return[{statusCode:o.statusCode,headers:o.headers},a]});case"resolveProxy":return this.service.resolveProxy(r[0]);case"lookupAuthorization":return this.service.lookupAuthorization(r[0]);case"lookupKerberosAuthorization":return this.service.lookupKerberosAuthorization(r[0]);case"loadCertificates":return this.service.loadCertificates()}throw new Error("Invalid call")}};var F1="extensions.user.cache",L1="extensions.builtin.cache",Nf="undefined_publisher";var yi=class{value;_lower;constructor(t){this.value=t,this._lower=t.toLowerCase()}static equals(t,e){if(typeof t>"u"||t===null)return typeof e>"u"||e===null;if(typeof e>"u"||e===null)return!1;if(typeof t=="string"||typeof e=="string"){let r=typeof t=="string"?t:t.value,i=typeof e=="string"?e:e.value;return Wr(r,i)}return t._lower===e._lower}static toKey(t){return typeof t=="string"?t.toLowerCase():t._lower}};var Uf=class{_map=new Map;clear(){this._map.clear()}delete(t){this._map.delete(yi.toKey(t))}get(t){return this._map.get(yi.toKey(t))}has(t){return this._map.has(yi.toKey(t))}set(t,e){this._map.set(yi.toKey(t),e)}values(){return this._map.values()}forEach(t){this._map.forEach(t)}[Symbol.iterator](){return this._map[Symbol.iterator]()}};function M1(n){return n.map(t=>{let[e,r]=t.split("@");return{proposalName:e,version:r?parseInt(r):void 0}})}function A1(n){return n.map(t=>t.split("@")[0])}var YEe=F("IBuiltinExtensionsScannerService");var o_="^([a-z0-9A-Z][a-z0-9-A-Z]*)\\.([a-z0-9A-Z][a-z0-9-A-Z]*)$",gPe=new RegExp(o_);function U1(n,t){switch(n){case 3:return t==="x64"?"win32-x64":t==="arm64"?"win32-arm64":"unknown";case 2:return t==="x64"?"linux-x64":t==="arm64"?"linux-arm64":t==="arm"?"linux-armhf":"unknown";case"alpine":return t==="x64"?"alpine-x64":t==="arm64"?"alpine-arm64":"unknown";case 1:return t==="x64"?"darwin-x64":t==="arm64"?"darwin-arm64":"unknown";case 0:return"web"}}function N1(n){return n&&typeof n=="object"&&typeof n.id=="string"&&(!n.uuid||typeof n.uuid=="string")}var vPe=F("extensionGalleryService");var yPe=F("extensionManagementService");var IPe=F("IGlobalExtensionEnablementService"),bPe=F("IExtensionTipsService"),wPe=In("extensions","Extensions"),SPe=In("preferences","Preferences");function oo(n,t){return n.uuid&&t.uuid?n.uuid===t.uuid:n.id===t.id?!0:Rl(n.id,t.id)===0}var s_=/^([^.]+\..+)-(\d+\.\d+\.\d+)(-(.+))?$/,Bf=class n{constructor(t,e,r="undefined"){this.identifier=t;this.version=e;this.targetPlatform=r;this.id=t.id}static create(t){let e=t.manifest?t.manifest.version:t.version,r=t.manifest?t.targetPlatform:t.properties.targetPlatform;return new n(t.identifier,e,r)}static parse(t){let e=s_.exec(t);return e&&e[1]&&e[2]?new n({id:e[1]},e[2],e[4]||void 0):null}id;toString(){return`${this.id}-${this.version}${this.targetPlatform!=="undefined"?`-${this.targetPlatform}`:""}`}equals(t){return t instanceof n?oo(this,t)&&this.version===t.version&&this.targetPlatform===t.targetPlatform:!1}};function B1(n,t){return`${n}.${t}`}function a_(n){return n.toLowerCase()}function V1(n,t){return a_(B1(n??Nf,t))}var BPe=new yi("pprice.better-merge");async function l_(n,t){if(!Q)return!1;let e;try{e=(await n.readFile(x.file("/etc/os-release"))).value.toString()}catch{try{e=(await n.readFile(x.file("/usr/lib/os-release"))).value.toString()}catch(i){t.debug("Error while getting the os-release file.",Fr(i))}}return!!e&&(e.match(/^ID=([^\u001b\r\n]*)/m)||[])[1]==="alpine"}async function K1(n,t){let e=await l_(n,t),r=U1(e?"alpine":mo,ky);return t.debug("ComputeTargetPlatform:",r),r}var Jo=class extends Error{constructor(e,r){super(e);this.code=r}},so=F("IExtensionsProfileScannerService"),Va=class extends D{constructor(e,r,i,o,s,a){super();this.extensionsLocation=e;this.fileService=r;this.userDataProfilesService=i;this.uriIdentityService=o;this.telemetryService=s;this.logService=a}_serviceBrand;_onAddExtensions=this._register(new S);onAddExtensions=this._onAddExtensions.event;_onDidAddExtensions=this._register(new S);onDidAddExtensions=this._onDidAddExtensions.event;_onRemoveExtensions=this._register(new S);onRemoveExtensions=this._onRemoveExtensions.event;_onDidRemoveExtensions=this._register(new S);onDidRemoveExtensions=this._onDidRemoveExtensions.event;resourcesAccessQueueMap=new Ue;scanProfileExtensions(e,r){return this.withProfileExtensions(e,void 0,r)}async addExtensionsToProfile(e,r,i){let o=[],s=[];try{return await this.withProfileExtensions(r,a=>{let l=[];if(i)l.push(...a);else for(let c of a)e.some(([d])=>oo(d.identifier,c.identifier)&&d.manifest.version!==c.version)?o.push(c):l.push(c);for(let[c,d]of e){let u=l.findIndex(h=>oo(h.identifier,c.identifier)&&h.version===c.manifest.version),m={identifier:c.identifier,version:c.manifest.version,location:c.location,metadata:d};u===-1?(s.push(m),l.push(m)):l.splice(u,1,m)}return s.length&&this._onAddExtensions.fire({extensions:s,profileLocation:r}),o.length&&this._onRemoveExtensions.fire({extensions:o,profileLocation:r}),l}),s.length&&this._onDidAddExtensions.fire({extensions:s,profileLocation:r}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,profileLocation:r}),s}catch(a){throw s.length&&this._onDidAddExtensions.fire({extensions:s,error:a,profileLocation:r}),o.length&&this._onDidRemoveExtensions.fire({extensions:o,error:a,profileLocation:r}),a}}async updateMetadata(e,r){let i=[];return await this.withProfileExtensions(r,o=>{let s=[];for(let a of o){let l=e.find(([c])=>oo(c.identifier,a.identifier)&&c.manifest.version===a.version);l&&(a.metadata={...a.metadata,...l[1]},i.push(a)),s.push(a)}return s}),i}async removeExtensionFromProfile(e,r){let i=[];try{await this.withProfileExtensions(r,o=>{let s=[];for(let a of o)oo(a.identifier,e.identifier)?i.push(a):s.push(a);return i.length&&this._onRemoveExtensions.fire({extensions:i,profileLocation:r}),s}),i.length&&this._onDidRemoveExtensions.fire({extensions:i,profileLocation:r})}catch(o){throw i.length&&this._onDidRemoveExtensions.fire({extensions:i,error:o,profileLocation:r}),o}}async withProfileExtensions(e,r,i){return this.getResourceAccessQueue(e).queue(async()=>{let o=[],s;try{let a=await this.fileService.readFile(e);s=JSON.parse(a.value.toString().trim()||"[]")}catch(a){if(Sr(a)!==1)throw a;if(this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)&&(s=await this.migrateFromOldDefaultProfileExtensionsLocation()),!s&&i?.bailOutWhenFileNotFound)throw new Jo(Fr(a),"ERROR_PROFILE_NOT_FOUND")}if(s){Array.isArray(s)||this.reportAndThrowInvalidConentError(e);let a=!1;for(let l of s){H1(l)||this.reportAndThrowInvalidConentError(e);let c;if(ke(l.relativeLocation)&&l.relativeLocation)c=this.resolveExtensionLocation(l.relativeLocation);else if(ke(l.location)){this.logService.warn(`Extensions profile: Ignoring extension with invalid location: ${l.location}`);continue}else{c=x.revive(l.location);let d=this.toRelativePath(c);d&&(a=!0,l.relativeLocation=d)}Gr(l.metadata?.hasPreReleaseVersion)&&l.metadata?.preRelease&&(a=!0,l.metadata.hasPreReleaseVersion=!0),o.push({identifier:l.identifier,location:c,version:l.version,metadata:l.metadata})}a&&await this.fileService.writeFile(e,K.fromString(JSON.stringify(s)))}if(r){o=r(o);let a=o.map(l=>({identifier:l.identifier,version:l.version,location:l.location.toJSON(),relativeLocation:this.toRelativePath(l.location),metadata:l.metadata}));await this.fileService.writeFile(e,K.fromString(JSON.stringify(a)))}return o})}reportAndThrowInvalidConentError(e){let r=new Jo(`Invalid extensions content in ${e.toString()}`,"ERROR_INVALID_CONTENT");throw this.telemetryService.publicLogError2("extensionsProfileScanningError",{code:r.code}),r}toRelativePath(e){return this.uriIdentityService.extUri.isEqual(this.uriIdentityService.extUri.dirname(e),this.extensionsLocation)?this.uriIdentityService.extUri.basename(e):void 0}resolveExtensionLocation(e){return this.uriIdentityService.extUri.joinPath(this.extensionsLocation,e)}_migrationPromise;async migrateFromOldDefaultProfileExtensionsLocation(){return this._migrationPromise||(this._migrationPromise=(async()=>{let e=this.uriIdentityService.extUri.joinPath(this.userDataProfilesService.defaultProfile.location,"extensions.json"),r=this.uriIdentityService.extUri.joinPath(this.extensionsLocation,".init-default-profile-extensions"),i;try{i=(await this.fileService.readFile(e)).value.toString()}catch(s){if(Sr(s)===1)return;throw s}this.logService.info("Migrating extensions from old default profile location",e.toString());let o;try{let s=JSON.parse(i);Array.isArray(s)&&s.every(a=>H1(a))?o=s:this.logService.warn("Skipping migrating from old default profile locaiton: Found invalid data",s)}catch(s){this.logService.error(s)}if(o)try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,K.fromString(JSON.stringify(o)),{overwrite:!1}),this.logService.info("Migrated extensions from old default profile location to new location",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString())}catch(s){if(Sr(s)===3)this.logService.info("Migration from old default profile location to new location is done by another window",e.toString(),this.userDataProfilesService.defaultProfile.extensionsResource.toString());else throw s}try{await this.fileService.del(e)}catch(s){Sr(s)!==1&&this.logService.error(s)}try{await this.fileService.del(r)}catch(s){Sr(s)!==1&&this.logService.error(s)}return o})()),this._migrationPromise}getResourceAccessQueue(e){let r=this.resourcesAccessQueueMap.get(e);return r||(r=new _n,this.resourcesAccessQueueMap.set(e,r)),r}};Va=P([g(1,Pe),g(2,jt),g(3,ut),g(4,Ve),g(5,A)],Va);function H1(n){return qe(n)&&N1(n.identifier)&&(c_(n.location)||ke(n.location)&&n.location)&&(Gr(n.relativeLocation)||ke(n.relativeLocation))&&n.version&&ke(n.version)}function c_(n){return n?ke(n.path)&&ke(n.scheme):!1}function Vf(n){switch(n){case 1:return p("error.invalidSymbol","Invalid symbol");case 2:return p("error.invalidNumberFormat","Invalid number format");case 3:return p("error.propertyNameExpected","Property name expected");case 4:return p("error.valueExpected","Value expected");case 5:return p("error.colonExpected","Colon expected");case 6:return p("error.commaExpected","Comma expected");case 7:return p("error.closeBraceExpected","Closing brace expected");case 8:return p("error.closeBracketExpected","Closing bracket expected");case 9:return p("error.endOfFileExpected","End of file expected");default:return""}}var Kf={},xe={exports:Kf};(function(n,t){if(typeof Kf=="object"&&typeof xe=="object")xe.exports=t();else if(typeof define=="function"&&define.amd)define([],t);else{var e=t();for(var r in e)(typeof Kf=="object"?Kf:n)[r]=e[r]}})(typeof self<"u"?self:void 0,function(){return function(n){var t={};function e(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return n[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}return e.m=n,e.c=t,e.d=function(r,i,o){e.o(r,i)||Object.defineProperty(r,i,{enumerable:!0,get:o})},e.r=function(r){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(r,"__esModule",{value:!0})},e.t=function(r,i){if(1&i&&(r=e(r)),8&i||4&i&&typeof r=="object"&&r&&r.__esModule)return r;var o=Object.create(null);if(e.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:r}),2&i&&typeof r!="string")for(var s in r)e.d(o,s,function(a){return r[a]}.bind(null,s));return o},e.n=function(r){var i=r&&r.__esModule?function(){return r.default}:function(){return r};return e.d(i,"a",i),i},e.o=function(r,i){return Object.prototype.hasOwnProperty.call(r,i)},e.p="",e(e.s=0)}([function(n,t,e){(function(r){var i;t=n.exports=Ae,i=typeof r=="object"&&r.env&&r.env.NODE_DEBUG&&/\bsemver\b/i.test(r.env.NODE_DEBUG)?function(){var w=Array.prototype.slice.call(arguments,0);w.unshift("SEMVER"),console.log.apply(console,w)}:function(){},t.SEMVER_SPEC_VERSION="2.0.0";var o=256,s=Number.MAX_SAFE_INTEGER||9007199254740991,a=t.re=[],l=t.src=[],c=0,d=c++;l[d]="0|[1-9]\\d*";var u=c++;l[u]="[0-9]+";var m=c++;l[m]="\\d*[a-zA-Z-][a-zA-Z0-9-]*";var h=c++;l[h]="("+l[d]+")\\.("+l[d]+")\\.("+l[d]+")";var y=c++;l[y]="("+l[u]+")\\.("+l[u]+")\\.("+l[u]+")";var v=c++;l[v]="(?:"+l[d]+"|"+l[m]+")";var b=c++;l[b]="(?:"+l[u]+"|"+l[m]+")";var C=c++;l[C]="(?:-("+l[v]+"(?:\\."+l[v]+")*))";var k=c++;l[k]="(?:-?("+l[b]+"(?:\\."+l[b]+")*))";var _=c++;l[_]="[0-9A-Za-z-]+";var T=c++;l[T]="(?:\\+("+l[_]+"(?:\\."+l[_]+")*))";var N=c++,J="v?"+l[h]+l[C]+"?"+l[T]+"?";l[N]="^"+J+"$";var H="[v=\\s]*"+l[y]+l[k]+"?"+l[T]+"?",Ke=c++;l[Ke]="^"+H+"$";var re=c++;l[re]="((?:<|>)?=?)";var je=c++;l[je]=l[u]+"|x|X|\\*";var zr=c++;l[zr]=l[d]+"|x|X|\\*";var Nt=c++;l[Nt]="[v=\\s]*("+l[zr]+")(?:\\.("+l[zr]+")(?:\\.("+l[zr]+")(?:"+l[C]+")?"+l[T]+"?)?)?";var vn=c++;l[vn]="[v=\\s]*("+l[je]+")(?:\\.("+l[je]+")(?:\\.("+l[je]+")(?:"+l[k]+")?"+l[T]+"?)?)?";var qr=c++;l[qr]="^"+l[re]+"\\s*"+l[Nt]+"$";var j=c++;l[j]="^"+l[re]+"\\s*"+l[vn]+"$";var B=c++;l[B]="(?:^|[^\\d])(\\d{1,16})(?:\\.(\\d{1,16}))?(?:\\.(\\d{1,16}))?(?:$|[^\\d])";var G=c++;l[G]="(?:~>?)";var z=c++;l[z]="(\\s*)"+l[G]+"\\s+",a[z]=new RegExp(l[z],"g");var te=c++;l[te]="^"+l[G]+l[Nt]+"$";var he=c++;l[he]="^"+l[G]+l[vn]+"$";var Ce=c++;l[Ce]="(?:\\^)";var ot=c++;l[ot]="(\\s*)"+l[Ce]+"\\s+",a[ot]=new RegExp(l[ot],"g");var St=c++;l[St]="^"+l[Ce]+l[Nt]+"$";var se=c++;l[se]="^"+l[Ce]+l[vn]+"$";var Ii=c++;l[Ii]="^"+l[re]+"\\s*("+H+")$|^$";var qn=c++;l[qn]="^"+l[re]+"\\s*("+J+")$|^$";var bi=c++;l[bi]="(\\s*)"+l[re]+"\\s*("+H+"|"+l[Nt]+")",a[bi]=new RegExp(l[bi],"g");var uo=c++;l[uo]="^\\s*("+l[Nt]+")\\s+-\\s+("+l[Nt]+")\\s*$";var ud=c++;l[ud]="^\\s*("+l[vn]+")\\s+-\\s+("+l[vn]+")\\s*$";var pd=c++;l[pd]="(<|>)?=?\\s*\\*";for(var po=0;po<35;po++)i(po,l[po]),a[po]||(a[po]=new RegExp(l[po]));function fo(w,R){if(w instanceof Ae)return w;if(typeof w!="string"||w.length>o||!(R?a[Ke]:a[N]).test(w))return null;try{return new Ae(w,R)}catch{return null}}function Ae(w,R){if(w instanceof Ae){if(w.loose===R)return w;w=w.version}else if(typeof w!="string")throw new TypeError("Invalid Version: "+w);if(w.length>o)throw new TypeError("version is longer than "+o+" characters");if(!(this instanceof Ae))return new Ae(w,R);i("SemVer",w,R),this.loose=R;var O=w.trim().match(R?a[Ke]:a[N]);if(!O)throw new TypeError("Invalid Version: "+w);if(this.raw=w,this.major=+O[1],this.minor=+O[2],this.patch=+O[3],this.major>s||this.major<0)throw new TypeError("Invalid major version");if(this.minor>s||this.minor<0)throw new TypeError("Invalid minor version");if(this.patch>s||this.patch<0)throw new TypeError("Invalid patch version");O[4]?this.prerelease=O[4].split(".").map(function(X){if(/^[0-9]+$/.test(X)){var ae=+X;if(ae>=0&&ae<s)return ae}return X}):this.prerelease=[],this.build=O[5]?O[5].split("."):[],this.format()}t.parse=fo,t.valid=function(w,R){var O=fo(w,R);return O?O.version:null},t.clean=function(w,R){var O=fo(w.trim().replace(/^[=v]+/,""),R);return O?O.version:null},t.SemVer=Ae,Ae.prototype.format=function(){return this.version=this.major+"."+this.minor+"."+this.patch,this.prerelease.length&&(this.version+="-"+this.prerelease.join(".")),this.version},Ae.prototype.toString=function(){return this.version},Ae.prototype.compare=function(w){return i("SemVer.compare",this.version,this.loose,w),w instanceof Ae||(w=new Ae(w,this.loose)),this.compareMain(w)||this.comparePre(w)},Ae.prototype.compareMain=function(w){return w instanceof Ae||(w=new Ae(w,this.loose)),rs(this.major,w.major)||rs(this.minor,w.minor)||rs(this.patch,w.patch)},Ae.prototype.comparePre=function(w){if(w instanceof Ae||(w=new Ae(w,this.loose)),this.prerelease.length&&!w.prerelease.length)return-1;if(!this.prerelease.length&&w.prerelease.length)return 1;if(!this.prerelease.length&&!w.prerelease.length)return 0;var R=0;do{var O=this.prerelease[R],X=w.prerelease[R];if(i("prerelease compare",R,O,X),O===void 0&&X===void 0)return 0;if(X===void 0)return 1;if(O===void 0)return-1;if(O!==X)return rs(O,X)}while(++R)},Ae.prototype.inc=function(w,R){switch(w){case"premajor":this.prerelease.length=0,this.patch=0,this.minor=0,this.major++,this.inc("pre",R);break;case"preminor":this.prerelease.length=0,this.patch=0,this.minor++,this.inc("pre",R);break;case"prepatch":this.prerelease.length=0,this.inc("patch",R),this.inc("pre",R);break;case"prerelease":this.prerelease.length===0&&this.inc("patch",R),this.inc("pre",R);break;case"major":this.minor===0&&this.patch===0&&this.prerelease.length!==0||this.major++,this.minor=0,this.patch=0,this.prerelease=[];break;case"minor":this.patch===0&&this.prerelease.length!==0||this.minor++,this.patch=0,this.prerelease=[];break;case"patch":this.prerelease.length===0&&this.patch++,this.prerelease=[];break;case"pre":if(this.prerelease.length===0)this.prerelease=[0];else{for(var O=this.prerelease.length;--O>=0;)typeof this.prerelease[O]=="number"&&(this.prerelease[O]++,O=-2);O===-1&&this.prerelease.push(0)}R&&(this.prerelease[0]===R?isNaN(this.prerelease[1])&&(this.prerelease=[R,0]):this.prerelease=[R,0]);break;default:throw new Error("invalid increment argument: "+w)}return this.format(),this.raw=this.version,this},t.inc=function(w,R,O,X){typeof O=="string"&&(X=O,O=void 0);try{return new Ae(w,O).inc(R,X).version}catch{return null}},t.diff=function(w,R){if(Em(w,R))return null;var O=fo(w),X=fo(R);if(O.prerelease.length||X.prerelease.length){for(var ae in O)if((ae==="major"||ae==="minor"||ae==="patch")&&O[ae]!==X[ae])return"pre"+ae;return"prerelease"}for(var ae in O)if((ae==="major"||ae==="minor"||ae==="patch")&&O[ae]!==X[ae])return ae},t.compareIdentifiers=rs;var sy=/^[0-9]+$/;function rs(w,R){var O=sy.test(w),X=sy.test(R);return O&&X&&(w=+w,R=+R),O&&!X?-1:X&&!O?1:w<R?-1:w>R?1:0}function $n(w,R,O){return new Ae(w,O).compare(new Ae(R,O))}function fd(w,R,O){return $n(w,R,O)>0}function md(w,R,O){return $n(w,R,O)<0}function Em(w,R,O){return $n(w,R,O)===0}function ay(w,R,O){return $n(w,R,O)!==0}function Pm(w,R,O){return $n(w,R,O)>=0}function Tm(w,R,O){return $n(w,R,O)<=0}function hd(w,R,O,X){var ae;switch(R){case"===":typeof w=="object"&&(w=w.version),typeof O=="object"&&(O=O.version),ae=w===O;break;case"!==":typeof w=="object"&&(w=w.version),typeof O=="object"&&(O=O.version),ae=w!==O;break;case"":case"=":case"==":ae=Em(w,O,X);break;case"!=":ae=ay(w,O,X);break;case">":ae=fd(w,O,X);break;case">=":ae=Pm(w,O,X);break;case"<":ae=md(w,O,X);break;case"<=":ae=Tm(w,O,X);break;default:throw new TypeError("Invalid operator: "+R)}return ae}function $r(w,R){if(w instanceof $r){if(w.loose===R)return w;w=w.value}if(!(this instanceof $r))return new $r(w,R);i("comparator",w,R),this.loose=R,this.parse(w),this.semver===hl?this.value="":this.value=this.operator+this.semver.version,i("comp",this)}t.rcompareIdentifiers=function(w,R){return rs(R,w)},t.major=function(w,R){return new Ae(w,R).major},t.minor=function(w,R){return new Ae(w,R).minor},t.patch=function(w,R){return new Ae(w,R).patch},t.compare=$n,t.compareLoose=function(w,R){return $n(w,R,!0)},t.rcompare=function(w,R,O){return $n(R,w,O)},t.sort=function(w,R){return w.sort(function(O,X){return t.compare(O,X,R)})},t.rsort=function(w,R){return w.sort(function(O,X){return t.rcompare(O,X,R)})},t.gt=fd,t.lt=md,t.eq=Em,t.neq=ay,t.gte=Pm,t.lte=Tm,t.cmp=hd,t.Comparator=$r;var hl={};function ft(w,R){if(w instanceof ft)return w.loose===R?w:new ft(w.raw,R);if(w instanceof $r)return new ft(w.value,R);if(!(this instanceof ft))return new ft(w,R);if(this.loose=R,this.raw=w,this.set=w.split(/\s*\|\|\s*/).map(function(O){return this.parseRange(O.trim())},this).filter(function(O){return O.length}),!this.set.length)throw new TypeError("Invalid SemVer Range: "+w);this.format()}function or(w){return!w||w.toLowerCase()==="x"||w==="*"}function d0(w,R,O,X,ae,kt,We,mr,yt,Jt,yn,It,Bt){return((R=or(O)?"":or(X)?">="+O+".0.0":or(ae)?">="+O+"."+X+".0":">="+R)+" "+(mr=or(yt)?"":or(Jt)?"<"+(+yt+1)+".0.0":or(yn)?"<"+yt+"."+(+Jt+1)+".0":It?"<="+yt+"."+Jt+"."+yn+"-"+It:"<="+mr)).trim()}function u0(w,R){for(var O=0;O<w.length;O++)if(!w[O].test(R))return!1;if(R.prerelease.length){for(O=0;O<w.length;O++)if(i(w[O].semver),w[O].semver!==hl&&w[O].semver.prerelease.length>0){var X=w[O].semver;if(X.major===R.major&&X.minor===R.minor&&X.patch===R.patch)return!0}return!1}return!0}function gd(w,R,O){try{R=new ft(R,O)}catch{return!1}return R.test(w)}function Cm(w,R,O,X){var ae,kt,We,mr,yt;switch(w=new Ae(w,X),R=new ft(R,X),O){case">":ae=fd,kt=Tm,We=md,mr=">",yt=">=";break;case"<":ae=md,kt=Pm,We=fd,mr="<",yt="<=";break;default:throw new TypeError('Must provide a hilo val of "<" or ">"')}if(gd(w,R,X))return!1;for(var Jt=0;Jt<R.set.length;++Jt){var yn=R.set[Jt],It=null,Bt=null;if(yn.forEach(function(hr){hr.semver===hl&&(hr=new $r(">=0.0.0")),It=It||hr,Bt=Bt||hr,ae(hr.semver,It.semver,X)?It=hr:We(hr.semver,Bt.semver,X)&&(Bt=hr)}),It.operator===mr||It.operator===yt||(!Bt.operator||Bt.operator===mr)&&kt(w,Bt.semver)||Bt.operator===yt&&We(w,Bt.semver))return!1}return!0}$r.prototype.parse=function(w){var R=this.loose?a[Ii]:a[qn],O=w.match(R);if(!O)throw new TypeError("Invalid comparator: "+w);this.operator=O[1],this.operator==="="&&(this.operator=""),O[2]?this.semver=new Ae(O[2],this.loose):this.semver=hl},$r.prototype.toString=function(){return this.value},$r.prototype.test=function(w){return i("Comparator.test",w,this.loose),this.semver===hl||(typeof w=="string"&&(w=new Ae(w,this.loose)),hd(w,this.operator,this.semver,this.loose))},$r.prototype.intersects=function(w,R){if(!(w instanceof $r))throw new TypeError("a Comparator is required");var O;if(this.operator==="")return O=new ft(w.value,R),gd(this.value,O,R);if(w.operator==="")return O=new ft(this.value,R),gd(w.semver,O,R);var X=!(this.operator!==">="&&this.operator!==">"||w.operator!==">="&&w.operator!==">"),ae=!(this.operator!=="<="&&this.operator!=="<"||w.operator!=="<="&&w.operator!=="<"),kt=this.semver.version===w.semver.version,We=!(this.operator!==">="&&this.operator!=="<="||w.operator!==">="&&w.operator!=="<="),mr=hd(this.semver,"<",w.semver,R)&&(this.operator===">="||this.operator===">")&&(w.operator==="<="||w.operator==="<"),yt=hd(this.semver,">",w.semver,R)&&(this.operator==="<="||this.operator==="<")&&(w.operator===">="||w.operator===">");return X||ae||kt&&We||mr||yt},t.Range=ft,ft.prototype.format=function(){return this.range=this.set.map(function(w){return w.join(" ").trim()}).join("||").trim(),this.range},ft.prototype.toString=function(){return this.range},ft.prototype.parseRange=function(w){var R=this.loose;w=w.trim(),i("range",w,R);var O=R?a[ud]:a[uo];w=w.replace(O,d0),i("hyphen replace",w),w=w.replace(a[bi],"$1$2$3"),i("comparator trim",w,a[bi]),w=(w=(w=w.replace(a[z],"$1~")).replace(a[ot],"$1^")).split(/\s+/).join(" ");var X=R?a[Ii]:a[qn],ae=w.split(" ").map(function(kt){return function(We,mr){return i("comp",We),We=function(yt,Jt){return yt.trim().split(/\s+/).map(function(yn){return function(It,Bt){i("caret",It,Bt);var hr=Bt?a[se]:a[St];return It.replace(hr,function(en,ue,Ee,Ge,st){var Vt;return i("caret",It,en,ue,Ee,Ge,st),or(ue)?Vt="":or(Ee)?Vt=">="+ue+".0.0 <"+(+ue+1)+".0.0":or(Ge)?Vt=ue==="0"?">="+ue+"."+Ee+".0 <"+ue+"."+(+Ee+1)+".0":">="+ue+"."+Ee+".0 <"+(+ue+1)+".0.0":st?(i("replaceCaret pr",st),st.charAt(0)!=="-"&&(st="-"+st),Vt=ue==="0"?Ee==="0"?">="+ue+"."+Ee+"."+Ge+st+" <"+ue+"."+Ee+"."+(+Ge+1):">="+ue+"."+Ee+"."+Ge+st+" <"+ue+"."+(+Ee+1)+".0":">="+ue+"."+Ee+"."+Ge+st+" <"+(+ue+1)+".0.0"):(i("no pr"),Vt=ue==="0"?Ee==="0"?">="+ue+"."+Ee+"."+Ge+" <"+ue+"."+Ee+"."+(+Ge+1):">="+ue+"."+Ee+"."+Ge+" <"+ue+"."+(+Ee+1)+".0":">="+ue+"."+Ee+"."+Ge+" <"+(+ue+1)+".0.0"),i("caret return",Vt),Vt})}(yn,Jt)}).join(" ")}(We,mr),i("caret",We),We=function(yt,Jt){return yt.trim().split(/\s+/).map(function(yn){return function(It,Bt){var hr=Bt?a[he]:a[te];return It.replace(hr,function(en,ue,Ee,Ge,st){var Vt;return i("tilde",It,en,ue,Ee,Ge,st),or(ue)?Vt="":or(Ee)?Vt=">="+ue+".0.0 <"+(+ue+1)+".0.0":or(Ge)?Vt=">="+ue+"."+Ee+".0 <"+ue+"."+(+Ee+1)+".0":st?(i("replaceTilde pr",st),st.charAt(0)!=="-"&&(st="-"+st),Vt=">="+ue+"."+Ee+"."+Ge+st+" <"+ue+"."+(+Ee+1)+".0"):Vt=">="+ue+"."+Ee+"."+Ge+" <"+ue+"."+(+Ee+1)+".0",i("tilde return",Vt),Vt})}(yn,Jt)}).join(" ")}(We,mr),i("tildes",We),We=function(yt,Jt){return i("replaceXRanges",yt,Jt),yt.split(/\s+/).map(function(yn){return function(It,Bt){It=It.trim();var hr=Bt?a[j]:a[qr];return It.replace(hr,function(en,ue,Ee,Ge,st,Vt){i("xRange",It,en,ue,Ee,Ge,st,Vt);var ly=or(Ee),gl=ly||or(Ge),vl=gl||or(st);return ue==="="&&vl&&(ue=""),ly?en=ue===">"||ue==="<"?"<0.0.0":"*":ue&&vl?(gl&&(Ge=0),vl&&(st=0),ue===">"?(ue=">=",gl?(Ee=+Ee+1,Ge=0,st=0):vl&&(Ge=+Ge+1,st=0)):ue==="<="&&(ue="<",gl?Ee=+Ee+1:Ge=+Ge+1),en=ue+Ee+"."+Ge+"."+st):gl?en=">="+Ee+".0.0 <"+(+Ee+1)+".0.0":vl&&(en=">="+Ee+"."+Ge+".0 <"+Ee+"."+(+Ge+1)+".0"),i("xRange return",en),en})}(yn,Jt)}).join(" ")}(We,mr),i("xrange",We),We=function(yt,Jt){return i("replaceStars",yt,Jt),yt.trim().replace(a[pd],"")}(We,mr),i("stars",We),We}(kt,R)}).join(" ").split(/\s+/);return this.loose&&(ae=ae.filter(function(kt){return!!kt.match(X)})),ae=ae.map(function(kt){return new $r(kt,R)})},ft.prototype.intersects=function(w,R){if(!(w instanceof ft))throw new TypeError("a Range is required");return this.set.some(function(O){return O.every(function(X){return w.set.some(function(ae){return ae.every(function(kt){return X.intersects(kt,R)})})})})},t.toComparators=function(w,R){return new ft(w,R).set.map(function(O){return O.map(function(X){return X.value}).join(" ").trim().split(" ")})},ft.prototype.test=function(w){if(!w)return!1;typeof w=="string"&&(w=new Ae(w,this.loose));for(var R=0;R<this.set.length;R++)if(u0(this.set[R],w))return!0;return!1},t.satisfies=gd,t.maxSatisfying=function(w,R,O){var X=null,ae=null;try{var kt=new ft(R,O)}catch{return null}return w.forEach(function(We){kt.test(We)&&(X&&ae.compare(We)!==-1||(ae=new Ae(X=We,O)))}),X},t.minSatisfying=function(w,R,O){var X=null,ae=null;try{var kt=new ft(R,O)}catch{return null}return w.forEach(function(We){kt.test(We)&&(X&&ae.compare(We)!==1||(ae=new Ae(X=We,O)))}),X},t.validRange=function(w,R){try{return new ft(w,R).range||"*"}catch{return null}},t.ltr=function(w,R,O){return Cm(w,R,"<",O)},t.gtr=function(w,R,O){return Cm(w,R,">",O)},t.outside=Cm,t.prerelease=function(w,R){var O=fo(w,R);return O&&O.prerelease.length?O.prerelease:null},t.intersects=function(w,R,O){return w=new ft(w,O),R=new ft(R,O),w.intersects(R)},t.coerce=function(w){if(w instanceof Ae)return w;if(typeof w!="string")return null;var R=w.match(a[B]);return R==null?null:fo((R[1]||"0")+"."+(R[2]||"0")+"."+(R[3]||"0"))}}).call(this,e(1))},function(n,t){var e,r,i=n.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(b){if(e===setTimeout)return setTimeout(b,0);if((e===o||!e)&&setTimeout)return e=setTimeout,setTimeout(b,0);try{return e(b,0)}catch{try{return e.call(null,b,0)}catch{return e.call(this,b,0)}}}(function(){try{e=typeof setTimeout=="function"?setTimeout:o}catch{e=o}try{r=typeof clearTimeout=="function"?clearTimeout:s}catch{r=s}})();var l,c=[],d=!1,u=-1;function m(){d&&l&&(d=!1,l.length?c=l.concat(c):u=-1,c.length&&h())}function h(){if(!d){var b=a(m);d=!0;for(var C=c.length;C;){for(l=c,c=[];++u<C;)l&&l[u].run();u=-1,C=c.length}l=null,d=!1,function(k){if(r===clearTimeout)return clearTimeout(k);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(k);try{r(k)}catch{try{return r.call(null,k)}catch{return r.call(this,k)}}}(b)}}function y(b,C){this.fun=b,this.array=C}function v(){}i.nextTick=function(b){var C=new Array(arguments.length-1);if(arguments.length>1)for(var k=1;k<arguments.length;k++)C[k-1]=arguments[k];c.push(new y(b,C)),c.length!==1||d||a(h)},y.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=v,i.addListener=v,i.once=v,i.off=v,i.removeListener=v,i.removeAllListeners=v,i.emit=v,i.prependListener=v,i.prependOnceListener=v,i.listeners=function(b){return[]},i.binding=function(b){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(b){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}}])});var vTe=xe.exports.SEMVER_SPEC_VERSION,yTe=xe.exports.parse,z1=xe.exports.valid,ITe=xe.exports.coerce,bTe=xe.exports.clean,wTe=xe.exports.inc,STe=xe.exports.major,xTe=xe.exports.minor,ETe=xe.exports.patch,PTe=xe.exports.prerelease,q1=xe.exports.gt,TTe=xe.exports.gte,CTe=xe.exports.lt,kTe=xe.exports.lte,$1=xe.exports.eq,_Te=xe.exports.neq,RTe=xe.exports.cmp,DTe=xe.exports.compare,OTe=xe.exports.rcompare,FTe=xe.exports.compareIdentifiers,LTe=xe.exports.rcompareIdentifiers,MTe=xe.exports.compareBuild,ATe=xe.exports.sort,WTe=xe.exports.rsort,UTe=xe.exports.diff,NTe=xe.exports.validRange,BTe=xe.exports.satisfies,VTe=xe.exports.maxSatisfying,KTe=xe.exports.minSatisfying,HTe=xe.exports.minVersion,zTe=xe.exports.gtr,qTe=xe.exports.ltr,$Te=xe.exports.outside,jTe=xe.exports.intersects,GTe=xe.exports.SemVer,JTe=xe.exports.Comparator,QTe=xe.exports.Range;var d_={activeComment:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.activeComment.d.ts"},aiRelatedInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiRelatedInformation.d.ts"},aiTextSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProvider.d.ts"},aiTextSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.aiTextSearchProviderNew.d.ts"},attributableCoverage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.attributableCoverage.d.ts"},authLearnMore:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authLearnMore.d.ts"},authSession:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.authSession.d.ts"},canonicalUriProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.canonicalUriProvider.d.ts"},chatParticipantAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantAdditions.d.ts"},chatParticipantPrivate:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatParticipantPrivate.d.ts",version:2},chatProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatProvider.d.ts"},chatTab:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatTab.d.ts"},chatVariableResolver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.chatVariableResolver.d.ts"},codeActionAI:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionAI.d.ts"},codeActionRanges:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codeActionRanges.d.ts"},codiconDecoration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.codiconDecoration.d.ts"},commentReactor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReactor.d.ts"},commentReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentReveal.d.ts"},commentThreadApplicability:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentThreadApplicability.d.ts"},commentingRangeHint:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentingRangeHint.d.ts"},commentsDraftState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.commentsDraftState.d.ts"},contribAccessibilityHelpContent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribAccessibilityHelpContent.d.ts"},contribChatParticipantDetection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribChatParticipantDetection.d.ts"},contribCommentEditorActionsMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentEditorActionsMenu.d.ts"},contribCommentPeekContext:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentPeekContext.d.ts"},contribCommentThreadAdditionalMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentThreadAdditionalMenu.d.ts"},contribCommentsViewThreadMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribCommentsViewThreadMenus.d.ts"},contribDebugCreateConfiguration:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDebugCreateConfiguration.d.ts"},contribDiffEditorGutterToolBarMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribDiffEditorGutterToolBarMenus.d.ts"},contribEditSessions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditSessions.d.ts"},contribEditorContentMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribEditorContentMenu.d.ts"},contribIssueReporter:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribIssueReporter.d.ts"},contribLabelFormatterWorkspaceTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribLabelFormatterWorkspaceTooltip.d.ts"},contribMenuBarHome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMenuBarHome.d.ts"},contribMergeEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMergeEditorMenus.d.ts"},contribMultiDiffEditorMenus:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribMultiDiffEditorMenus.d.ts"},contribNotebookStaticPreloads:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribNotebookStaticPreloads.d.ts"},contribRemoteHelp:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribRemoteHelp.d.ts"},contribShareMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribShareMenu.d.ts"},contribSourceControlHistoryItemMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryItemMenu.d.ts"},contribSourceControlHistoryTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlHistoryTitleMenu.d.ts"},contribSourceControlInputBoxMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlInputBoxMenu.d.ts"},contribSourceControlTitleMenu:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribSourceControlTitleMenu.d.ts"},contribStatusBarItems:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribStatusBarItems.d.ts"},contribViewContainerTitle:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewContainerTitle.d.ts"},contribViewsRemote:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsRemote.d.ts"},contribViewsWelcome:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.contribViewsWelcome.d.ts"},createFileSystemWatcher:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.createFileSystemWatcher.d.ts"},customEditorMove:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.customEditorMove.d.ts"},debugVisualization:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.debugVisualization.d.ts"},defaultChatParticipant:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.defaultChatParticipant.d.ts"},diffCommand:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffCommand.d.ts"},diffContentOptions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.diffContentOptions.d.ts"},documentFiltersExclusive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentFiltersExclusive.d.ts"},documentPaste:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.documentPaste.d.ts"},editSessionIdentityProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editSessionIdentityProvider.d.ts"},editorHoverVerbosityLevel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorHoverVerbosityLevel.d.ts"},editorInsets:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.editorInsets.d.ts"},embeddings:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.embeddings.d.ts"},extensionRuntime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionRuntime.d.ts"},extensionsAny:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.extensionsAny.d.ts"},externalUriOpener:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.externalUriOpener.d.ts"},fileComments:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileComments.d.ts"},fileSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProvider.d.ts"},fileSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fileSearchProviderNew.d.ts"},findFiles2:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2.d.ts"},findFiles2New:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findFiles2New.d.ts"},findTextInFiles:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFiles.d.ts"},findTextInFilesNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.findTextInFilesNew.d.ts"},fsChunks:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.fsChunks.d.ts"},idToken:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.idToken.d.ts"},inlineCompletionsAdditions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineCompletionsAdditions.d.ts"},inlineEdit:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.inlineEdit.d.ts"},interactive:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactive.d.ts"},interactiveWindow:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.interactiveWindow.d.ts"},ipc:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.ipc.d.ts"},languageModelSystem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageModelSystem.d.ts"},languageStatusText:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.languageStatusText.d.ts"},lmTools:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.lmTools.d.ts",version:6},mappedEditsProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.mappedEditsProvider.d.ts"},multiDocumentHighlightProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.multiDocumentHighlightProvider.d.ts"},newSymbolNamesProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.newSymbolNamesProvider.d.ts"},notebookCellExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecution.d.ts"},notebookCellExecutionState:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookCellExecutionState.d.ts"},notebookControllerAffinityHidden:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookControllerAffinityHidden.d.ts"},notebookDeprecated:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookDeprecated.d.ts"},notebookExecution:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookExecution.d.ts"},notebookKernelSource:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookKernelSource.d.ts"},notebookLiveShare:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookLiveShare.d.ts"},notebookMessaging:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMessaging.d.ts"},notebookMime:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookMime.d.ts"},notebookReplDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookReplDocument.d.ts"},notebookVariableProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.notebookVariableProvider.d.ts"},portsAttributes:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.portsAttributes.d.ts"},profileContentHandlers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.profileContentHandlers.d.ts"},quickDiffProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickDiffProvider.d.ts"},quickInputButtonLocation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickInputButtonLocation.d.ts"},quickPickItemTooltip:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickItemTooltip.d.ts"},quickPickSortByLabel:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.quickPickSortByLabel.d.ts"},resolvers:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.resolvers.d.ts"},scmActionButton:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmActionButton.d.ts"},scmHistoryProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmHistoryProvider.d.ts"},scmMultiDiffEditor:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmMultiDiffEditor.d.ts"},scmSelectedProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmSelectedProvider.d.ts"},scmTextDocument:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmTextDocument.d.ts"},scmValidation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.scmValidation.d.ts"},shareProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.shareProvider.d.ts"},showLocal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.showLocal.d.ts"},speech:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.speech.d.ts"},tabInputMultiDiff:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputMultiDiff.d.ts"},tabInputTextMerge:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tabInputTextMerge.d.ts"},taskPresentationGroup:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.taskPresentationGroup.d.ts"},telemetry:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.telemetry.d.ts"},terminalDataWriteEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDataWriteEvent.d.ts"},terminalDimensions:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalDimensions.d.ts"},terminalExecuteCommandEvent:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalExecuteCommandEvent.d.ts"},terminalQuickFixProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalQuickFixProvider.d.ts"},terminalSelection:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.terminalSelection.d.ts"},testObserver:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testObserver.d.ts"},testRelatedCode:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.testRelatedCode.d.ts"},textSearchCompleteNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchCompleteNew.d.ts"},textSearchProvider:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProvider.d.ts"},textSearchProviderNew:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.textSearchProviderNew.d.ts"},timeline:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.timeline.d.ts"},tokenInformation:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tokenInformation.d.ts"},treeViewActiveItem:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewActiveItem.d.ts"},treeViewMarkdownMessage:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewMarkdownMessage.d.ts"},treeViewReveal:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.treeViewReveal.d.ts"},tunnelFactory:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnelFactory.d.ts"},tunnels:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.tunnels.d.ts"},workspaceTrust:{proposal:"https://raw.githubusercontent.com/microsoft/vscode/main/src/vscode-dts/vscode.proposed.workspaceTrust.d.ts"}},G1=Object.freeze(d_);var Q1=/^(\^|>=)?((\d+)|x)\.((\d+)|x)\.((\d+)|x)(\-.*)?$/,u_=/^-(\d{4})(\d{2})(\d{2})$/;function p_(n){return n=n.trim(),n==="*"||Q1.test(n)}function Rv(n){if(!p_(n))return null;if(n=n.trim(),n==="*")return{hasCaret:!1,hasGreaterEquals:!1,majorBase:0,majorMustEqual:!1,minorBase:0,minorMustEqual:!1,patchBase:0,patchMustEqual:!1,preRelease:null};let t=n.match(Q1);return t?{hasCaret:t[1]==="^",hasGreaterEquals:t[1]===">=",majorBase:t[2]==="x"?0:parseInt(t[2],10),majorMustEqual:t[2]!=="x",minorBase:t[4]==="x"?0:parseInt(t[4],10),minorMustEqual:t[4]!=="x",patchBase:t[6]==="x"?0:parseInt(t[6],10),patchMustEqual:t[6]!=="x",preRelease:t[8]||null}:null}function Dv(n){if(!n)return null;let t=n.majorBase,e=n.majorMustEqual,r=n.minorBase,i=n.minorMustEqual,o=n.patchBase,s=n.patchMustEqual;n.hasCaret&&(t===0||(i=!1),s=!1);let a=0;if(n.preRelease){let l=u_.exec(n.preRelease);if(l){let[,c,d,u]=l;a=Date.UTC(Number(c),Number(d)-1,Number(u))}}return{majorBase:t,majorMustEqual:e,minorBase:r,minorMustEqual:i,patchBase:o,patchMustEqual:s,isMinimum:n.hasGreaterEquals,notBefore:a}}function f_(n,t,e){let r;typeof n=="string"?r=Dv(Rv(n)):r=n;let i;t instanceof Date?i=t.getTime():typeof t=="string"&&(i=new Date(t).getTime());let o;if(typeof e=="string"?o=Dv(Rv(e)):o=e,!r||!o)return!1;let s=r.majorBase,a=r.minorBase,l=r.patchBase,c=o.majorBase,d=o.minorBase,u=o.patchBase,m=o.notBefore,h=o.majorMustEqual,y=o.minorMustEqual,v=o.patchMustEqual;return o.isMinimum?s>c?!0:s<c?!1:a>d?!0:a<d||i&&i<m?!1:l>=u:(s===1&&c===0&&(!h||!y||!v)&&(c=1,d=0,u=0,h=!0,y=!1,v=!1),s<c?!1:s>c?!h:a<d?!1:a>d?!y:l<u?!1:l>u?!v:!(i&&i<m))}function Y1(n,t,e,r,i,o){let s=[];if(typeof r.publisher<"u"&&typeof r.publisher!="string")return s.push([Te.Error,p("extensionDescription.publisher","property publisher must be of type `string`.")]),s;if(typeof r.name!="string")return s.push([Te.Error,p("extensionDescription.name","property `{0}` is mandatory and must be of type `string`","name")]),s;if(typeof r.version!="string")return s.push([Te.Error,p("extensionDescription.version","property `{0}` is mandatory and must be of type `string`","version")]),s;if(!r.engines)return s.push([Te.Error,p("extensionDescription.engines","property `{0}` is mandatory and must be of type `object`","engines")]),s;if(typeof r.engines.vscode!="string")return s.push([Te.Error,p("extensionDescription.engines.vscode","property `{0}` is mandatory and must be of type `string`","engines.vscode")]),s;if(typeof r.extensionDependencies<"u"&&!J1(r.extensionDependencies))return s.push([Te.Error,p("extensionDescription.extensionDependencies","property `{0}` can be omitted or must be of type `string[]`","extensionDependencies")]),s;if(typeof r.activationEvents<"u"){if(!J1(r.activationEvents))return s.push([Te.Error,p("extensionDescription.activationEvents1","property `{0}` can be omitted or must be of type `string[]`","activationEvents")]),s;if(typeof r.main>"u"&&typeof r.browser>"u")return s.push([Te.Error,p("extensionDescription.activationEvents2","property `{0}` should be omitted if the extension doesn't have a `{1}` or `{2}` property.","activationEvents","main","browser")]),s}if(typeof r.extensionKind<"u"&&typeof r.main>"u"&&s.push([Te.Warning,p("extensionDescription.extensionKind","property `{0}` can be defined only if property `main` is also defined.","extensionKind")]),typeof r.main<"u"){if(typeof r.main!="string")return s.push([Te.Error,p("extensionDescription.main1","property `{0}` can be omitted or must be of type `string`","main")]),s;{let c=ne(e,r.main);mh(c,e)||s.push([Te.Warning,p("extensionDescription.main2","Expected `main` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(typeof r.browser<"u"){if(typeof r.browser!="string")return s.push([Te.Error,p("extensionDescription.browser1","property `{0}` can be omitted or must be of type `string`","browser")]),s;{let c=ne(e,r.browser);mh(c,e)||s.push([Te.Warning,p("extensionDescription.browser2","Expected `browser` ({0}) to be included inside extension's folder ({1}). This might make the extension non-portable.",c.path,e.path)])}}if(!z1(r.version))return s.push([Te.Error,p("notSemver","Extension version is not semver compatible.")]),s;let a=[];if(!m_(n,t,r,i,a))for(let c of a)s.push([Te.Error,c]);if(o&&r.enabledApiProposals?.length){let c=[];if(!h_([...r.enabledApiProposals],c))for(let d of c)s.push([Te.Error,d])}return s}function m_(n,t,e,r,i){return r||typeof e.main>"u"&&typeof e.browser>"u"?!0:g_(n,t,e.engines.vscode,i)}function h_(n,t){if(n.length===0)return!0;let e=Array.isArray(t)?t:void 0,r=(e?void 0:t)??G1,i=[],o=M1(n);for(let{proposalName:s,version:a}of o){let l=r[s];l&&a&&l.version!==a&&i.push(p("apiProposalMismatch","Extension is using an API proposal '{0}' that is not compatible with the current version of VS Code.",s))}return e?.push(...i),i.length===0}function g_(n,t,e,r=[]){let i=Dv(Rv(e));if(!i)return r.push(p("versionSyntax","Could not parse `engines.vscode` value {0}. Please use, for example: ^1.22.0, ^1.22.x, etc.",e)),!1;if(i.majorBase===0){if(!i.majorMustEqual||!i.minorMustEqual)return r.push(p("versionSpecificity1","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions before 1.0.0, please define at a minimum the major and minor desired version. E.g. ^0.10.0, 0.10.x, 0.11.0, etc.",e)),!1}else if(!i.majorMustEqual)return r.push(p("versionSpecificity2","Version specified in `engines.vscode` ({0}) is not specific enough. For vscode versions after 1.0.0, please define at a minimum the major desired version. E.g. ^1.10.0, 1.10.x, 1.x.x, 2.x.x, etc.",e)),!1;return f_(n,t,i)?!0:(r.push(p("versionMismatch","Extension is not compatible with Code {0}. Extension requires: {1}.",n,e)),!1)}function J1(n){if(!Array.isArray(n))return!1;for(let t=0,e=n.length;t<e;t++)if(typeof n[t]!="string")return!1;return!0}function X1(n,t,e,r){try{v_(n,t,e,r)}catch(i){n.error(i?.message??i)}return t}function v_(n,t,e,r){let i=(o,s,a)=>{let l=o[s];if(ke(l)){let c=l,d=c.length;if(d>1&&c[0]==="%"&&c[d-1]==="%"){let u=c.substr(1,d-2),m=e[u];m===void 0&&r&&(m=r[u]);let h=typeof m=="string"?m:m?.message,y=r?.[u],v=typeof y=="string"?y:y?.message;if(!h){v||n.warn(`[${t.name}]: ${p("missingNLSKey","Couldn't find message for key {0}.",u)}`);return}if(a&&(s==="title"||s==="category")&&v&&v!==h){let b={value:h,original:v};o[s]=b}else o[s]=h}}else if(qe(l))for(let c in l)l.hasOwnProperty(c)&&(c==="commands"?i(l,c,!0):i(l,c,a));else if(Array.isArray(l))for(let c=0;c<l.length;c++)i(l,c,a)};for(let o in t)t.hasOwnProperty(o)&&i(t,o)}var Z1;(t=>{function n(e,r){if(e===r)return!0;let i=Object.keys(e),o=new Set;for(let s of Object.keys(r))o.add(s);if(i.length!==o.size)return!1;for(let s of i){if(e[s]!==r[s])return!1;o.delete(s)}return o.size===0}t.equals=n})(Z1||={});var ex=F("IExtensionsScannerService"),Zc=class extends D{constructor(e,r,i,o,s,a,l,c,d,u,m,h){super();this.systemExtensionsLocation=e;this.userExtensionsLocation=r;this.extensionsControlLocation=i;this.currentProfile=o;this.userDataProfilesService=s;this.extensionsProfileScannerService=a;this.fileService=l;this.logService=c;this.environmentService=d;this.productService=u;this.uriIdentityService=m;this.instantiationService=h;this._register(this.systemExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(0))),this._register(this.userExtensionsCachedScanner.onDidChangeCache(()=>this._onDidChangeCache.fire(1)))}_serviceBrand;_onDidChangeCache=this._register(new S);onDidChangeCache=this._onDidChangeCache.event;obsoleteFile=ne(this.userExtensionsLocation,".obsolete");systemExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Ha,this.currentProfile,this.obsoleteFile));userExtensionsCachedScanner=this._register(this.instantiationService.createInstance(Ha,this.currentProfile,this.obsoleteFile));extensionsScanner=this._register(this.instantiationService.createInstance(Ka,this.obsoleteFile));_targetPlatformPromise;getTargetPlatform(){return this._targetPlatformPromise||(this._targetPlatformPromise=K1(this.fileService,this.logService)),this._targetPlatformPromise}async scanAllExtensions(e,r,i){let[o,s]=await Promise.all([this.scanSystemExtensions(e),this.scanUserExtensions(r)]),a=i?await this.scanExtensionsUnderDevelopment(e,[...o,...s]):[];return this.dedupExtensions(o,s,a,await this.getTargetPlatform(),!0)}async scanSystemExtensions(e){let r=[];r.push(this.scanDefaultSystemExtensions(!!e.useCache,e.language)),r.push(this.scanDevSystemExtensions(e.language,!!e.checkControlFile));let[i,o]=await Promise.all(r);return this.applyScanOptions([...i,...o],0,e,!1)}async scanUserExtensions(e){let r=e.profileLocation??this.userExtensionsLocation;this.logService.trace("Started scanning user extensions",r);let i=this.uriIdentityService.extUri.isEqual(e.profileLocation,this.userDataProfilesService.defaultProfile.extensionsResource)?{bailOutWhenFileNotFound:!0}:void 0,o=await this.createExtensionScannerInput(r,!!e.profileLocation,1,!e.includeUninstalled,e.language,!0,i,e.productVersion??this.getProductVersion()),s=e.useCache&&!o.devMode&&o.excludeObsolete?this.userExtensionsCachedScanner:this.extensionsScanner,a;try{a=await s.scanExtensions(o)}catch(l){if(l instanceof Jo&&l.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions(),a=await s.scanExtensions(o);else throw l}return a=await this.applyScanOptions(a,1,e,!0),this.logService.trace("Scanned user extensions:",a.length),a}async scanExtensionsUnderDevelopment(e,r){if(this.environmentService.isExtensionDevelopment&&this.environmentService.extensionDevelopmentLocationURI){let i=(await Promise.all(this.environmentService.extensionDevelopmentLocationURI.filter(o=>o.scheme===L.file).map(async o=>{let s=await this.createExtensionScannerInput(o,!1,1,!0,e.language,!1,void 0,e.productVersion??this.getProductVersion());return(await this.extensionsScanner.scanOneOrMultipleExtensions(s)).map(l=>(l.type=r.find(c=>oo(c.identifier,l.identifier))?.type??l.type,this.extensionsScanner.validate(l,s)))}))).flat();return this.applyScanOptions(i,"development",e,!0)}return[]}async scanExistingExtension(e,r,i){let o=await this.createExtensionScannerInput(e,!1,r,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanExtension(o);return!s||!i.includeInvalid&&!s.isValid?null:s}async scanOneOrMultipleExtensions(e,r,i){let o=await this.createExtensionScannerInput(e,!1,r,!0,i.language,!0,void 0,i.productVersion??this.getProductVersion()),s=await this.extensionsScanner.scanOneOrMultipleExtensions(o);return this.applyScanOptions(s,r,i,!0)}async scanMultipleExtensions(e,r,i){let o=[];return await Promise.all(e.map(async s=>{let a=await this.scanOneOrMultipleExtensions(s,r,i);o.push(...a)})),this.applyScanOptions(o,r,i,!0)}async scanMetadata(e){let r=ne(e,"package.json"),i=(await this.fileService.readFile(r)).value.toString();return JSON.parse(i).__metadata}async updateMetadata(e,r){let i=ne(e,"package.json"),o=(await this.fileService.readFile(i)).value.toString(),s=JSON.parse(o);r.isMachineScoped===!1&&delete r.isMachineScoped,r.isBuiltin===!1&&delete r.isBuiltin,s.__metadata={...s.__metadata,...r},await this.fileService.writeFile(ne(e,"package.json"),K.fromString(JSON.stringify(s,null,"	")))}async initializeDefaultProfileExtensions(){try{await this.extensionsProfileScannerService.scanProfileExtensions(this.userDataProfilesService.defaultProfile.extensionsResource,{bailOutWhenFileNotFound:!0})}catch(e){if(e instanceof Jo&&e.code==="ERROR_PROFILE_NOT_FOUND")await this.doInitializeDefaultProfileExtensions();else throw e}}initializeDefaultProfileExtensionsPromise=void 0;async doInitializeDefaultProfileExtensions(){return this.initializeDefaultProfileExtensionsPromise||(this.initializeDefaultProfileExtensionsPromise=(async()=>{try{this.logService.info("Started initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString());let e=await this.scanUserExtensions({includeInvalid:!0});if(e.length)await this.extensionsProfileScannerService.addExtensionsToProfile(e.map(r=>[r,r.metadata]),this.userDataProfilesService.defaultProfile.extensionsResource);else try{await this.fileService.createFile(this.userDataProfilesService.defaultProfile.extensionsResource,K.fromString(JSON.stringify([])))}catch(r){Sr(r)!==1&&this.logService.warn("Failed to create default profile extensions manifest in extensions installation folder.",this.userExtensionsLocation.toString(),Fr(r))}this.logService.info("Completed initializing default profile extensions in extensions installation folder.",this.userExtensionsLocation.toString())}catch(e){this.logService.error(e)}finally{this.initializeDefaultProfileExtensionsPromise=void 0}})()),this.initializeDefaultProfileExtensionsPromise}async applyScanOptions(e,r,i,o){return i.includeAllVersions||(e=this.dedupExtensions(r===0?e:void 0,r===1?e:void 0,r==="development"?e:void 0,await this.getTargetPlatform(),o)),i.includeInvalid||(e=e.filter(s=>s.isValid)),e.sort((s,a)=>{let l=pe(s.location.fsPath),c=pe(a.location.fsPath);return l<c?-1:l>c?1:0})}dedupExtensions(e,r,i,o,s){let a=(c,d,u)=>{if(c.isValid&&!d.isValid)return!1;if(c.isValid===d.isValid){if(s&&q1(c.manifest.version,d.manifest.version))return this.logService.debug(`Skipping extension ${d.location.path} with lower version ${d.manifest.version} in favour of ${c.location.path} with version ${c.manifest.version}`),!1;if($1(c.manifest.version,d.manifest.version)){if(c.type===0)return this.logService.debug(`Skipping extension ${d.location.path} in favour of system extension ${c.location.path} with same version`),!1;if(c.targetPlatform===o)return this.logService.debug(`Skipping extension ${d.location.path} from different target platform ${d.targetPlatform}`),!1}}return u?this.logService.warn(`Overwriting user extension ${c.location.path} with ${d.location.path}.`):this.logService.debug(`Overwriting user extension ${c.location.path} with ${d.location.path}.`),!0},l=new Uf;return e?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),r?.forEach(c=>{let d=l.get(c.identifier.id);if(!d&&e&&c.type===0){this.logService.debug(`Skipping obsolete system extension ${c.location.path}.`);return}(!d||a(d,c,!1))&&l.set(c.identifier.id,c)}),i?.forEach(c=>{let d=l.get(c.identifier.id);(!d||a(d,c,!0))&&l.set(c.identifier.id,c),l.set(c.identifier.id,c)}),[...l.values()]}async scanDefaultSystemExtensions(e,r){this.logService.trace("Started scanning system extensions");let i=await this.createExtensionScannerInput(this.systemExtensionsLocation,!1,0,!0,r,!0,void 0,this.getProductVersion()),s=await(e&&!i.devMode?this.systemExtensionsCachedScanner:this.extensionsScanner).scanExtensions(i);return this.logService.trace("Scanned system extensions:",s.length),s}async scanDevSystemExtensions(e,r){let i=this.environmentService.isBuilt?[]:this.productService.builtInExtensions;if(!i?.length)return[];this.logService.trace("Started scanning dev system extensions");let o=r?await this.getBuiltInExtensionControl():{},s=[],a=x.file(lt(V(Re.asFileUri("").fsPath,"..",".build","builtInExtensions")));for(let c of i){let d=o[c.name]||"marketplace";switch(d){case"disabled":break;case"marketplace":s.push(ne(a,c.name));break;default:s.push(x.file(d));break}}let l=await Promise.all(s.map(async c=>this.extensionsScanner.scanExtension(await this.createExtensionScannerInput(c,!1,0,!0,e,!0,void 0,this.getProductVersion()))));return this.logService.trace("Scanned dev system extensions:",l.length),Ye(l)}async getBuiltInExtensionControl(){try{let e=await this.fileService.readFile(this.extensionsControlLocation);return JSON.parse(e.value.toString())}catch{return{}}}async createExtensionScannerInput(e,r,i,o,s,a,l,c){let d=await this.getTranslations(s??Or),u=await this.getMtime(e),m=r&&!this.uriIdentityService.extUri.isEqual(e,this.userDataProfilesService.defaultProfile.extensionsResource)?this.userDataProfilesService.defaultProfile.extensionsResource:void 0,h=m?await this.getMtime(m):void 0;return new Qo(e,u,m,h,r,l,i,o,a,c.version,c.date,this.productService.commit,!this.environmentService.isBuilt,s,d)}async getMtime(e){try{let r=await this.fileService.stat(e);if(typeof r.mtime=="number")return r.mtime}catch{}}getProductVersion(){return{version:this.productService.version,date:this.productService.date}}};Zc=P([g(4,jt),g(5,so),g(6,Pe),g(7,A),g(8,dr),g(9,be),g(10,ut),g(11,Yt)],Zc);var Qo=class{constructor(t,e,r,i,o,s,a,l,c,d,u,m,h,y,v){this.location=t;this.mtime=e;this.applicationExtensionslocation=r;this.applicationExtensionslocationMtime=i;this.profile=o;this.profileScanOptions=s;this.type=a;this.excludeObsolete=l;this.validate=c;this.productVersion=d;this.productDate=u;this.productCommit=m;this.devMode=h;this.language=y;this.translations=v}static createNlsConfiguration(t){return{language:t.language,pseudo:t.language==="pseudo",devMode:t.devMode,translations:t.translations}}static equals(t,e){return tu(t.location,e.location)&&t.mtime===e.mtime&&tu(t.applicationExtensionslocation,e.applicationExtensionslocation)&&t.applicationExtensionslocationMtime===e.applicationExtensionslocationMtime&&t.profile===e.profile&&Pr(t.profileScanOptions,e.profileScanOptions)&&t.type===e.type&&t.excludeObsolete===e.excludeObsolete&&t.validate===e.validate&&t.productVersion===e.productVersion&&t.productDate===e.productDate&&t.productCommit===e.productCommit&&t.devMode===e.devMode&&t.language===e.language&&Z1.equals(t.translations,e.translations)}},Ka=class extends D{constructor(e,r,i,o,s,a,l){super();this.obsoleteFile=e;this.extensionsProfileScannerService=r;this.uriIdentityService=i;this.fileService=o;this.environmentService=a;this.logService=l;this.extensionsEnabledWithApiProposalVersion=s.extensionsEnabledWithApiProposalVersion?.map(c=>c.toLowerCase())??[]}extensionsEnabledWithApiProposalVersion;async scanExtensions(e){let r=e.profile?await this.scanExtensionsFromProfile(e):await this.scanExtensionsFromLocation(e),i={};if(e.excludeObsolete&&e.type===1)try{let o=(await this.fileService.readFile(this.obsoleteFile)).value.toString();i=JSON.parse(o)}catch{}return hs(i)?r:r.filter(o=>!i[Bf.create(o).toString()])}async scanExtensionsFromLocation(e){let r=await this.fileService.resolve(e.location);if(!r.children?.length)return[];let i=await Promise.all(r.children.map(async o=>{if(!o.isDirectory||e.type===1&&cr(o.resource).indexOf(".")===0)return null;let s=new Qo(o.resource,e.mtime,e.applicationExtensionslocation,e.applicationExtensionslocationMtime,e.profile,e.profileScanOptions,e.type,e.excludeObsolete,e.validate,e.productVersion,e.productDate,e.productCommit,e.devMode,e.language,e.translations);return this.scanExtension(s)}));return Ye(i).sort((o,s)=>o.location.path<s.location.path?-1:1)}async scanExtensionsFromProfile(e){let r=await this.scanExtensionsFromProfileResource(e.location,()=>!0,e);if(e.applicationExtensionslocation&&!this.uriIdentityService.extUri.isEqual(e.location,e.applicationExtensionslocation)){r=r.filter(o=>!o.metadata?.isApplicationScoped);let i=await this.scanExtensionsFromProfileResource(e.applicationExtensionslocation,o=>!!o.metadata?.isBuiltin||!!o.metadata?.isApplicationScoped,e);r.push(...i)}return r}async scanExtensionsFromProfileResource(e,r,i){let o=await this.extensionsProfileScannerService.scanProfileExtensions(e,i.profileScanOptions);if(!o.length)return[];let s=await Promise.all(o.map(async a=>{if(r(a)){let l=new Qo(a.location,i.mtime,i.applicationExtensionslocation,i.applicationExtensionslocationMtime,i.profile,i.profileScanOptions,i.type,i.excludeObsolete,i.validate,i.productVersion,i.productDate,i.productCommit,i.devMode,i.language,i.translations);return this.scanExtension(l,a.metadata)}return null}));return Ye(s)}async scanOneOrMultipleExtensions(e){try{if(await this.fileService.exists(ne(e.location,"package.json"))){let r=await this.scanExtension(e);return r?[r]:[]}else return await this.scanExtensions(e)}catch(r){return this.logService.error(`Error scanning extensions at ${e.location.path}:`,Fr(r)),[]}}async scanExtension(e,r){try{let i=await this.scanExtensionManifest(e.location);if(i){i.publisher||(i.publisher=Nf),r=r??i.__metadata,delete i.__metadata;let o=V1(i.publisher,i.name),s=r?.id?{id:o,uuid:r.id}:{id:o},a=r?.isSystem?0:e.type,l=a===0||!!r?.isBuiltin;i=await this.translateManifest(e.location,i,Qo.createNlsConfiguration(e));let c={type:a,identifier:s,manifest:i,location:e.location,isBuiltin:l,targetPlatform:r?.targetPlatform??"undefined",publisherDisplayName:r?.publisherDisplayName,metadata:r,isValid:!0,validations:[]};return e.validate&&(c=this.validate(c,e)),i.enabledApiProposals&&(!this.environmentService.isBuilt||this.extensionsEnabledWithApiProposalVersion.includes(o.toLowerCase()))&&(i.originalEnabledApiProposals=i.enabledApiProposals,i.enabledApiProposals=A1([...i.enabledApiProposals])),c}}catch(i){e.type!==0&&this.logService.error(i)}return null}validate(e,r){let i=!0,o=this.environmentService.isBuilt&&this.extensionsEnabledWithApiProposalVersion.includes(e.identifier.id.toLowerCase()),s=Y1(r.productVersion,r.productDate,r.location,e.manifest,e.isBuiltin,o);for(let[a,l]of s)a===Te.Error&&(i=!1,this.logService.error(this.formatMessage(r.location,l)));return e.isValid=i,e.validations=s,e}async scanExtensionManifest(e){let r=ne(e,"package.json"),i;try{i=(await this.fileService.readFile(r)).value.toString()}catch(s){return Sr(s)!==1&&this.logService.error(this.formatMessage(e,p("fileReadFail","Cannot read file {0}: {1}.",r.path,s.message))),null}let o;try{o=JSON.parse(i)}catch{let a=[];Yr(i,a);for(let l of a)this.logService.error(this.formatMessage(e,p("jsonParseFail","Failed to parse {0}: [{1}, {2}] {3}.",r.path,l.offset,l.length,Vf(l.error))));return null}return zi(o)!=="object"?(this.logService.error(this.formatMessage(e,p("jsonParseInvalidType","Invalid manifest file {0}: Not a JSON object.",r.path))),null):o}async translateManifest(e,r,i){let o=await this.getLocalizedMessages(e,r,i);if(o)try{let s=[],a=await this.resolveOriginalMessageBundle(o.default,s);if(s.length>0)return s.forEach(c=>{this.logService.error(this.formatMessage(e,p("jsonsParseReportErrors","Failed to parse {0}: {1}.",o.default?.path,Vf(c.error))))}),r;if(zi(o)!=="object")return this.logService.error(this.formatMessage(e,p("jsonInvalidFormat","Invalid format {0}: JSON object expected.",o.default?.path))),r;let l=o.values||Object.create(null);return X1(this.logService,r,l,a)}catch{}return r}async getLocalizedMessages(e,r,i){let o=ne(e,"package.nls.json"),s=(d,u)=>{u.forEach(m=>{this.logService.error(this.formatMessage(e,p("jsonsParseReportErrors","Failed to parse {0}: {1}.",d?.path,Vf(m.error))))})},a=d=>{this.logService.error(this.formatMessage(e,p("jsonInvalidFormat","Invalid format {0}: JSON object expected.",d?.path)))},l=`${r.publisher}.${r.name}`,c=i.translations[l];if(c)try{let d=x.file(c),u=(await this.fileService.readFile(d)).value.toString(),m=[],h=Yr(u,m);return m.length>0?(s(d,m),{values:void 0,default:o}):zi(h)!=="object"?(a(d),{values:void 0,default:o}):{values:h.contents?h.contents.package:void 0,default:o}}catch{return{values:void 0,default:o}}else{if(!await this.fileService.exists(o))return;let u;try{u=await this.findMessageBundles(e,i)}catch{return}if(!u.localized)return{values:void 0,default:u.original};try{let m=(await this.fileService.readFile(u.localized)).value.toString(),h=[],y=Yr(m,h);return h.length>0?(s(u.localized,h),{values:void 0,default:u.original}):zi(y)!=="object"?(a(u.localized),{values:void 0,default:u.original}):{values:y,default:u.original}}catch{return{values:void 0,default:u.original}}}}async resolveOriginalMessageBundle(e,r){if(e)try{let i=(await this.fileService.readFile(e)).value.toString();return Yr(i,r)}catch{}}findMessageBundles(e,r){return new Promise((i,o)=>{let s=a=>{let l=ne(e,`package.nls.${a}.json`);this.fileService.exists(l).then(c=>{c&&i({localized:l,original:ne(e,"package.nls.json")});let d=a.lastIndexOf("-");d===-1?i({localized:ne(e,"package.nls.json"),original:null}):(a=a.substring(0,d),s(a))})};if(r.devMode||r.pseudo||!r.language)return i({localized:ne(e,"package.nls.json"),original:null});s(r.language)})}formatMessage(e,r){return`[${e.path}]: ${r}`}};Ka=P([g(1,so),g(2,ut),g(3,Pe),g(4,be),g(5,dr),g(6,A)],Ka);var Ha=class extends Ka{constructor(e,r,i,o,s,a,l,c,d){super(r,o,s,a,l,c,d);this.currentProfile=e;this.userDataProfilesService=i}input;cacheValidatorThrottler=this._register(new Ht(3e3));_onDidChangeCache=this._register(new S);onDidChangeCache=this._onDidChangeCache.event;async scanExtensions(e){let r=this.getCacheFile(e),i=await this.readExtensionCache(r);if(this.input=e,i&&i.input&&Qo.equals(i.input,this.input))return this.logService.debug("Using cached extensions scan result",e.type===0?"system":"user",e.location.toString()),this.cacheValidatorThrottler.trigger(()=>this.validateCache()),i.result.map(s=>(s.location=x.revive(s.location),s));let o=await super.scanExtensions(e);return await this.writeExtensionCache(r,{input:e,result:o}),o}async readExtensionCache(e){try{let r=await this.fileService.readFile(e),i=JSON.parse(r.value.toString());return{result:i.result,input:dn(i.input)}}catch(r){this.logService.debug("Error while reading the extension cache file:",e.path,Fr(r))}return null}async writeExtensionCache(e,r){try{await this.fileService.writeFile(e,K.fromString(JSON.stringify(r)))}catch(i){this.logService.debug("Error while writing the extension cache file:",e.path,Fr(i))}}async validateCache(){if(!this.input)return;let e=this.getCacheFile(this.input),r=await this.readExtensionCache(e);if(!r)return;let i=r.result,o=JSON.parse(JSON.stringify(await super.scanExtensions(this.input)));if(!Pr(o,i))try{this.logService.info("Invalidating Cache",i,o),await this.fileService.del(e),this._onDidChangeCache.fire()}catch(s){this.logService.error(s)}}getCacheFile(e){let r=this.getProfile(e);return this.uriIdentityService.extUri.joinPath(r.cacheHome,e.type===0?L1:F1)}getProfile(e){return e.type===0?this.userDataProfilesService.defaultProfile:e.profile?this.uriIdentityService.extUri.isEqual(e.location,this.currentProfile.extensionsResource)?this.currentProfile:this.userDataProfilesService.profiles.find(r=>this.uriIdentityService.extUri.isEqual(e.location,r.extensionsResource))??this.currentProfile:this.userDataProfilesService.defaultProfile}};Ha=P([g(2,jt),g(3,so),g(4,ut),g(5,Pe),g(6,be),g(7,dr),g(8,A)],Ha);var Hf=class extends Zc{translationsPromise;constructor(t,e,r,i,o,s,a,l,c,d,u,m){super(t,e,ne(r,".vscode-oss-dev","extensions","control.json"),i,o,s,a,l,c,d,u,m),this.translationsPromise=(async()=>{if(Dm)try{let h=await this.fileService.readFile(x.file(Dm));return JSON.parse(h.value.toString())}catch{}return Object.create(null)})()}getTranslations(t){return this.translationsPromise}};var za=class extends Hf{constructor(t,e,r,i,o,s,a,l){super(x.file(o.builtinExtensionsPath),x.file(o.extensionsPath),o.userHome,t.defaultProfile,t,e,r,i,o,s,a,l)}};za=P([g(0,jt),g(1,so),g(2,Pe),g(3,A),g(4,br),g(5,be),g(6,ut),g(7,Yt)],za);var qa=class extends D{constructor(e,r,i){super();this.userDataProfilesService=r;this.windowsMainService=i;this._register(e.onWillLoadWindow(o=>{o.reason===2&&this.unsetProfileForWorkspace(o.window)})),this._register(e.onBeforeCloseWindow(o=>this.unsetProfileForWorkspace(o))),this._register(new bt(()=>this.cleanUpEmptyWindowAssociations(),30*1e3)).schedule()}async unsetProfileForWorkspace(e){let r=this.getWorkspace(e),i=this.userDataProfilesService.getProfileForWorkspace(r);i?.isTransient&&(this.userDataProfilesService.unsetWorkspace(r,i.isTransient),i.isTransient&&await this.userDataProfilesService.cleanUpTransientProfiles())}getWorkspace(e){return e.openedWorkspace??Ri(e.backupPath,e.isExtensionDevelopmentHost)}cleanUpEmptyWindowAssociations(){let e=this.userDataProfilesService.getAssociatedEmptyWindows();if(e.length===0)return;let r=this.windowsMainService.getWindows().map(i=>this.getWorkspace(i));for(let i of e)r.some(o=>o.id===i.id)||this.userDataProfilesService.unsetWorkspace(i,!1)}};qa=P([g(0,oe),g(1,rr),g(2,Fe)],qa);var Zke=F("IUserDataProfileStorageService"),zf=class extends D{constructor(e,r){super();this.storageService=r;e&&(this.storageServicesMap=this._register(new Yn))}_serviceBrand;storageServicesMap;async readStorageData(e){return this.withProfileScopedStorageService(e,async r=>this.getItems(r))}async updateStorageData(e,r,i){return this.withProfileScopedStorageService(e,async o=>this.writeItems(o,r,i))}async withProfileScopedStorageService(e,r){if(this.storageService.hasScope(e))return r(this.storageService);let i=this.storageServicesMap?.get(e.id);if(!i){i=new Ov(this.createStorageDatabase(e)),this.storageServicesMap?.set(e.id,i);try{await i.initialize()}catch(o){throw this.storageServicesMap?.has(e.id)?this.storageServicesMap.deleteAndDispose(e.id):i.dispose(),o}}try{let o=await r(i);return await i.flush(),o}finally{this.storageServicesMap?.has(e.id)||i.dispose()}}getItems(e){let r=new Map,i=o=>{for(let s of e.keys(0,o))r.set(s,{value:e.get(s,0),target:o})};return i(0),i(1),r}writeItems(e,r,i){e.storeAll(Array.from(r.entries()).map(([o,s])=>({key:o,value:s,scope:0,target:i})),!0)}};zf=P([g(1,mw)],zf);var Ov=class extends $s{constructor(e){super({flushInterval:100});this.profileStorageDatabase=e}profileStorage;async doInitialize(){let e=await this.profileStorageDatabase,r=new On(e);return this._register(r.onDidChangeStorage(i=>{this.emitDidChangeValue(0,i)})),this._register($(()=>{r.close(),r.dispose(),Od(e)&&e.dispose()})),this.profileStorage=r,this.profileStorage.init()}getStorage(e){return e===0?this.profileStorage:void 0}getLogDetails(){}async switchToProfile(){}async switchToWorkspace(){}hasScope(){return!1}};var qf=class extends D{constructor(e,r,i){super();this.storageMainService=e;this.userDataProfilesService=r;this.logService=i;let o=this._register(new Mr);this._onDidChange=this._register(new S({onWillAddFirstListener:()=>o.value=this.registerStorageChangeListeners(),onDidRemoveLastListener:()=>o.value=void 0}))}_onDidChange;registerStorageChangeListeners(){this.logService.debug("ProfileStorageChangesListenerChannel#registerStorageChangeListeners");let e=new Y;return e.add(E.debounce(this.storageMainService.applicationStorage.onDidChangeStorage,(r,i)=>(r?r.push(i.key):r=[i.key],r),100)(r=>this.onDidChangeApplicationStorage(r))),e.add(E.debounce(this.storageMainService.onDidChangeProfileStorage,(r,i)=>{r||(r=new Map);let o=r.get(i.profile.id);return o||r.set(i.profile.id,o={profile:i.profile,keys:[],storage:i.storage}),o.keys.push(i.key),r},100)(r=>this.onDidChangeProfileStorage(r))),e}onDidChangeApplicationStorage(e){let r=e.includes(ci)?[this.userDataProfilesService.defaultProfile]:[],i=[];if(e=e.filter(o=>o!==ci),e.length){let o=op(this.storageMainService.applicationStorage.storage);i.push({profile:this.userDataProfilesService.defaultProfile,changes:e.map(s=>({key:s,scope:0,target:o[s]}))})}this.triggerEvents(r,i)}onDidChangeProfileStorage(e){let r=[],i=new Map;for(let[o,s]of e.entries()){s.keys.includes(ci)&&r.push(s.profile);let a=s.keys.filter(l=>l!==ci);if(a.length){let l=op(s.storage.storage);i.set(o,{profile:s.profile,changes:a.map(c=>({key:c,scope:0,target:l[c]}))})}}this.triggerEvents(r,[...i.values()])}triggerEvents(e,r){(e.length||r.length)&&this._onDidChange.fire({valueChanges:r,targetChanges:e})}listen(e,r,i){switch(r){case"onDidChange":return this._onDidChange.event}throw new Error(`[ProfileStorageChangesListenerChannel] Event not found: ${r}`)}async call(e,r){throw new Error(`Call not found: ${r}`)}};async function tx(n,t){let e=n.getItem(vp);return(typeof e!="string"||W&&e==="6c9d2bc8f91b89624add29c0abeae7fb42bf539fa1cdb2e3e57cd668fa9bcead")&&(e=await a1(t.error.bind(t))),e}async function rx(n,t){let e=n.getItem(yp);return typeof e!="string"&&(e=await l1(t.error.bind(t))),e}async function nx(n,t){let e=n.getItem(Ip);return typeof e!="string"&&(e=await c1(t.error.bind(t))),e}async function ix(n,t){let e=await tx(n,t);return n.setItem(vp,e),e}async function ox(n,t){let e=await rx(n,t);return n.setItem(yp,e),e}async function sx(n,t){let e=await nx(n,t);return n.setItem(Ip,e),e}var $a=class extends Va{constructor(t,e,r,i,o,s){super(x.file(t.extensionsPath),e,r,i,o,s)}};$a=P([g(0,br),g(1,Pe),g(2,jt),g(3,ut),g(4,Ve),g(5,A)],$a);var $f=class{constructor(t){this.loggerService=t}loggers=new Ue;listen(t,e,r){switch(e){case"onDidChangeLoggers":return r?this.loggerService.getOnDidChangeLoggersEvent(r):this.loggerService.onDidChangeLoggers;case"onDidChangeLogLevel":return r?this.loggerService.getOnDidChangeLogLevelEvent(r):this.loggerService.onDidChangeLogLevel;case"onDidChangeVisibility":return r?this.loggerService.getOnDidChangeVisibilityEvent(r):this.loggerService.onDidChangeVisibility}throw new Error(`Event not found: ${e}`)}async call(t,e,r){switch(e){case"createLogger":this.createLogger(x.revive(r[0]),r[1],r[2]);return;case"log":return this.log(x.revive(r[0]),r[1]);case"consoleLog":return this.consoleLog(r[0],r[1]);case"setLogLevel":return uc(r[0])?this.loggerService.setLogLevel(r[0]):this.loggerService.setLogLevel(x.revive(r[0]),r[1]);case"setVisibility":return this.loggerService.setVisibility(x.revive(r[0]),r[1]);case"registerLogger":return this.loggerService.registerLogger({...r[0],resource:x.revive(r[0].resource)},r[1]);case"deregisterLogger":return this.loggerService.deregisterLogger(x.revive(r[0]))}throw new Error(`Call not found: ${e}`)}createLogger(t,e,r){this.loggers.set(t,this.loggerService.createLogger(t,e,r))}consoleLog(t,e){let r=console.log;switch(t){case 5:r=console.error;break;case 4:r=console.warn;break;case 3:r=console.info;break}r.call(console,...e)}log(t,e){let r=this.loggers.get(t);if(!r)throw new Error("Create the logger before logging");for(let[i,o]of e)fc(r,i,o)}};var ax="utilityProcessWorker";var Fv=F("utilityProcessWorker"),ja=class extends D{constructor(e,r,i,o){super();this.logService=e;this.windowsMainService=r;this.telemetryService=i;this.lifecycleMainService=o}workers=new Map;async createWorker(e){let r=`window: ${e.reply.windowId}, moduleId: ${e.process.moduleId}`;this.logService.trace(`[UtilityProcessWorker]: createWorker(${r})`);let i=this.hash(e);this.workers.has(i)&&(this.logService.warn(`[UtilityProcessWorker]: createWorker() found an existing worker that will be terminated (${r})`),this.disposeWorker(e));let o=new ed(this.logService,this.windowsMainService,this.telemetryService,this.lifecycleMainService,e);if(!o.spawn())return{reason:{code:1,signal:"EINVALID"}};this.workers.set(i,o);let s=new ur;return E.once(o.onDidTerminate)(a=>{a.code===0?this.logService.trace(`[UtilityProcessWorker]: terminated normally with code ${a.code}, signal: ${a.signal}`):this.logService.error(`[UtilityProcessWorker]: terminated unexpectedly with code ${a.code}, signal: ${a.signal}`),this.workers.delete(i),s.complete({reason:a})}),s.p}hash(e){return qt({moduleId:e.process.moduleId,windowId:e.reply.windowId})}async disposeWorker(e){let r=this.hash(e),i=this.workers.get(r);i&&(this.logService.trace(`[UtilityProcessWorker]: disposeWorker(window: ${e.reply.windowId}, moduleId: ${e.process.moduleId})`),i.kill(),i.dispose(),this.workers.delete(r))}};ja=P([g(0,A),g(1,Fe),g(2,Ve),g(3,oe)],ja);var ed=class extends D{constructor(e,r,i,o,s){super();this.logService=e;this.windowsMainService=r;this.telemetryService=i;this.lifecycleMainService=o;this.configuration=s;this.registerListeners()}_onDidTerminate=this._register(new S);onDidTerminate=this._onDidTerminate.event;utilityProcess=this._register(new ji(this.logService,this.windowsMainService,this.telemetryService,this.lifecycleMainService));registerListeners(){this._register(this.utilityProcess.onExit(e=>this._onDidTerminate.fire({code:e.code,signal:e.signal}))),this._register(this.utilityProcess.onCrash(e=>this._onDidTerminate.fire({code:e.code,signal:"ECRASH"})))}spawn(){let r=this.windowsMainService.getWindowById(this.configuration.reply.windowId)?.win?.webContents.getOSProcessId();return this.utilityProcess.start({type:this.configuration.process.type,entryPoint:this.configuration.process.moduleId,parentLifecycleBound:r,windowLifecycleBound:!0,correlationId:`${this.configuration.reply.windowId}`,responseWindowId:this.configuration.reply.windowId,responseChannel:this.configuration.reply.channel,responseNonce:this.configuration.reply.nonce})}kill(){this.utilityProcess.kill()}};ed=P([g(0,A),g(1,Fe),g(2,Ve),g(3,oe)],ed);import"electron";var Ga=class extends D{constructor(e,r,i,o,s){super();this._reconnectConstants=e;this._configurationService=r;this._environmentMainService=i;this._lifecycleMainService=o;this._logService=s;this._register(this._lifecycleMainService.onWillShutdown(()=>this._onWillShutdown.fire())),_e.on("vscode:createPtyHostMessageChannel",(a,l)=>this._onWindowConnection(a,l)),this._register($(()=>{_e.removeHandler("vscode:createPtyHostMessageChannel")}))}utilityProcess=void 0;_onRequestConnection=new S;onRequestConnection=this._onRequestConnection.event;_onWillShutdown=new S;onWillShutdown=this._onWillShutdown.event;start(){this.utilityProcess=new At(this._logService,Hi,this._lifecycleMainService);let e=Mb(this._environmentMainService.args,this._environmentMainService.isBuilt),r=e.port?["--nolazy",`--inspect${e.break?"-brk":""}=${e.port}`]:void 0;this.utilityProcess.start({type:"ptyHost",entryPoint:"vs/platform/terminal/node/ptyHostMain",execArgv:r,args:["--logsPath",this._environmentMainService.logsHome.with({scheme:L.file}).fsPath],env:this._createPtyHostConfiguration()});let i=this.utilityProcess.connect(),o=new Ms(i,"ptyHost"),s=new Y;return s.add(o),s.add($(()=>{this.utilityProcess?.kill(),this.utilityProcess?.dispose(),this.utilityProcess=void 0})),{client:o,store:s,onDidProcessExit:this.utilityProcess.onExit}}_createPtyHostConfiguration(){this._environmentMainService.unsetSnapExportedVariables();let e={...er(process.env),VSCODE_AMD_ENTRYPOINT:"vs/platform/terminal/node/ptyHostMain",VSCODE_PIPE_LOGGING:"true",VSCODE_VERBOSE_LOGGING:"true",VSCODE_RECONNECT_GRACE_TIME:String(this._reconnectConstants.graceTime),VSCODE_RECONNECT_SHORT_GRACE_TIME:String(this._reconnectConstants.shortGraceTime),VSCODE_RECONNECT_SCROLLBACK:String(this._reconnectConstants.scrollback)},r=this._configurationService.getValue("terminal.integrated.developer.ptyHost.latency");r&&typeof r=="number"&&(e.VSCODE_LATENCY=String(r));let i=this._configurationService.getValue("terminal.integrated.developer.ptyHost.startupDelay");return i&&typeof i=="number"&&(e.VSCODE_STARTUP_DELAY=String(i)),this._environmentMainService.restoreSnapExportedVariables(),e}_onWindowConnection(e,r){this._onRequestConnection.fire();let i=this.utilityProcess.connect();if(e.sender.isDestroyed()){i.close();return}e.sender.postMessage("vscode:createPtyHostMessageChannelResult",r,[i])}};Ga=P([g(1,ce),g(2,ge),g(3,oe),g(4,A)],Ga);var Gf=class extends D{constructor(t,e){super(),e.call("setLogLevel",[t.getLogLevel()]),this._register(t.onDidChangeLogLevel(r=>e.call("setLogLevel",[r]))),e.call("getRegisteredLoggers").then(r=>{for(let i of r)t.registerLogger({...i,resource:x.revive(i.resource)})}),this._register(e.listen("onDidChangeVisibility")(([r,i])=>t.setVisibility(x.revive(r),i))),this._register(e.listen("onDidChangeLoggers")(({added:r,removed:i})=>{for(let o of r)t.registerLogger({...o,resource:x.revive(o.resource)});for(let o of i)t.deregisterLogger(o.resource)}))}};var Ja=class extends D{constructor(e,r){super();this._logService=r;this._timeout=e===void 0?15e3:e,this._register($(()=>{for(let i of this._pendingRequestDisposables.values())ze(i)}))}_lastRequestId=0;_timeout;_pendingRequests=new Map;_pendingRequestDisposables=new Map;_onCreateRequest=this._register(new S);onCreateRequest=this._onCreateRequest.event;createRequest(e){return new Promise((r,i)=>{let o=++this._lastRequestId;this._pendingRequests.set(o,r),this._onCreateRequest.fire({requestId:o,...e});let s=new rt;nt(this._timeout,s.token).then(()=>i(`Request ${o} timed out (${this._timeout}ms)`)),this._pendingRequestDisposables.set(o,[$(()=>s.cancel())])})}acceptReply(e,r){let i=this._pendingRequests.get(e);i?(this._pendingRequests.delete(e),ze(this._pendingRequestDisposables.get(e)||[]),this._pendingRequestDisposables.delete(e),i(r)):this._logService.warn(`RequestStore#acceptReply was called without receiving a matching request ${e}`)}};Ja=P([g(1,A)],Ja);function lx(n,t){let e=[{name:null,description:p("terminalAutomaticProfile","Automatically detect the default")}];return e.push(...n.map(r=>({name:r.profileName,description:y_(r)}))),t&&e.push(...t.map(r=>({name:r.title,description:I_(r)}))),{values:e.map(r=>r.name),markdownDescriptions:e.map(r=>r.description)}}function y_(n){let t=`$(${Ft.isThemeIcon(n.icon)?n.icon.id:n.icon?n.icon:dt.terminal.id}) ${n.profileName}
- path: ${n.path}`;return n.args&&(typeof n.args=="string"?t+=`
- args: "${n.args}"`:t+=`
- args: [${n.args.length===0?"":`'${n.args.join("','")}'`}]`),n.overrideName!==void 0&&(t+=`
- overrideName: ${n.overrideName}`),n.color&&(t+=`
- color: ${n.color}`),n.env&&(t+=`
- env: ${JSON.stringify(n.env)}`),t}function I_(n){return`$(${Ft.isThemeIcon(n.icon)?n.icon.id:n.icon?n.icon:dt.terminal.id}) ${n.title}
- extensionIdentifier: ${n.extensionIdentifier}`}var b_={type:["string","null"],enum:["terminal.ansiBlack","terminal.ansiRed","terminal.ansiGreen","terminal.ansiYellow","terminal.ansiBlue","terminal.ansiMagenta","terminal.ansiCyan","terminal.ansiWhite"],default:null},w_={type:"string",enum:Array.from(jh(),n=>n.id),markdownEnumDescriptions:Array.from(jh(),n=>`$(${n.id})`)},Qa={args:{description:p("terminalProfile.args","An optional set of arguments to run the shell executable with."),type:"array",items:{type:"string"}},overrideName:{description:p("terminalProfile.overrideName","Whether or not to replace the dynamic terminal title that detects what program is running with the static profile name."),type:"boolean"},icon:{description:p("terminalProfile.icon","A codicon ID to associate with the terminal icon."),...w_},color:{description:p("terminalProfile.color","A theme color ID to associate with the terminal icon."),...b_},env:{markdownDescription:p("terminalProfile.env","An object with environment variables that will be added to the terminal profile process. Set to `null` to delete environment variables from the base environment."),type:"object",additionalProperties:{type:["string","null"]},default:{}}},Lv={type:"object",required:["path"],properties:{path:{description:p("terminalProfile.path","A single path to a shell executable or an array of paths that will be used as fallbacks when one fails."),type:["string","array"],items:{type:"string"}},...Qa}},Mv={type:"object",required:["path"],properties:{path:{description:p("terminalAutomationProfile.path","A single path to a shell executable."),type:["string"],items:{type:"string"}},...Qa}};function Av(n){let t=n===2?"linux":n===1?"osx":"windows";return p({key:"terminal.integrated.profile",comment:["{0} is the platform, {1} is a code block, {2} and {3} are a link start and end"]},`A set of terminal profile customizations for {0} which allows adding, removing or changing how terminals are launched. Profiles are made up of a mandatory path, optional arguments and other presentation options.

To override an existing profile use its profile name as the key, for example:

{1}

{2}Read more about configuring profiles{3}.`,wd(n),'```json\n"terminal.integrated.profile.'+t+'": {\n  "bash": null\n}\n```',"[","](https://code.visualstudio.com/docs/terminal/profiles)")}var S_={id:"terminal",order:100,title:p("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.automationProfile.linux":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.linux","The terminal profile to use on Linux for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},Mv],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.osx":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.osx","The terminal profile to use on macOS for automation-related terminal usage like tasks and debug."),type:["object","null"],default:null,anyOf:[{type:"null"},Mv],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.automationProfile.windows":{restricted:!0,markdownDescription:p("terminal.integrated.automationProfile.windows","The terminal profile to use for automation-related terminal usage like tasks and debug. This setting will currently be ignored if {0} (now deprecated) is set.","`terminal.integrated.automationShell.windows`"),type:["object","null"],default:null,anyOf:[{type:"null"},Mv],defaultSnippets:[{body:{path:"${1}",icon:"${2}"}}]},"terminal.integrated.profiles.windows":{restricted:!0,markdownDescription:Av(3),type:"object",default:{PowerShell:{source:"PowerShell",icon:"terminal-powershell"},"Command Prompt":{path:["${env:windir}\\Sysnative\\cmd.exe","${env:windir}\\System32\\cmd.exe"],args:[],icon:"terminal-cmd"},"Git Bash":{source:"Git Bash"}},additionalProperties:{anyOf:[{type:"object",required:["source"],properties:{source:{description:p("terminalProfile.windowsSource","A profile source that will auto detect the paths to the shell. Note that non-standard executable locations are not supported and must be created manually in a new profile."),enum:["PowerShell","Git Bash"]},...Qa}},{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.windowsExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.windowsExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.windowsExtensionTitle","The name of the extension terminal"),type:"string"},...Qa}},{type:"null"},Lv]}},"terminal.integrated.profiles.osx":{restricted:!0,markdownDescription:Av(1),type:"object",default:{bash:{path:"bash",args:["-l"],icon:"terminal-bash"},zsh:{path:"zsh",args:["-l"]},fish:{path:"fish",args:["-l"]},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.osxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.osxExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.osxExtensionTitle","The name of the extension terminal"),type:"string"},...Qa}},{type:"null"},Lv]}},"terminal.integrated.profiles.linux":{restricted:!0,markdownDescription:Av(2),type:"object",default:{bash:{path:"bash",icon:"terminal-bash"},zsh:{path:"zsh"},fish:{path:"fish"},tmux:{path:"tmux",icon:"terminal-tmux"},pwsh:{path:"pwsh",icon:"terminal-powershell"}},additionalProperties:{anyOf:[{type:"object",required:["extensionIdentifier","id","title"],properties:{extensionIdentifier:{description:p("terminalProfile.linuxExtensionIdentifier","The extension that contributed this profile."),type:"string"},id:{description:p("terminalProfile.linuxExtensionId","The id of the extension terminal"),type:"string"},title:{description:p("terminalProfile.linuxExtensionTitle","The name of the extension terminal"),type:"string"},...Qa}},{type:"null"},Lv]}},"terminal.integrated.useWslProfiles":{description:p("terminal.integrated.useWslProfiles","Controls whether or not WSL distros are shown in the terminal dropdown"),type:"boolean",default:!0},"terminal.integrated.inheritEnv":{scope:1,description:p("terminal.integrated.inheritEnv","Whether new shells should inherit their environment from VS Code, which may source a login shell to ensure $PATH and other development variables are initialized. This has no effect on Windows."),type:"boolean",default:!0},"terminal.integrated.persistentSessionScrollback":{scope:1,markdownDescription:p("terminal.integrated.persistentSessionScrollback","Controls the maximum amount of lines that will be restored when reconnecting to a persistent terminal session. Increasing this will restore more lines of scrollback at the cost of more memory and increase the time it takes to connect to terminals on start up. This setting requires a restart to take effect and should be set to a value less than or equal to `#terminal.integrated.scrollback#`."),type:"number",default:100},"terminal.integrated.showLinkHover":{scope:1,description:p("terminal.integrated.showLinkHover","Whether to show hovers for links in the terminal output."),type:"boolean",default:!0},"terminal.integrated.ignoreProcessNames":{markdownDescription:p("terminal.integrated.confirmIgnoreProcesses","A set of process names to ignore when using the {0} setting.","`#terminal.integrated.confirmOnKill#`"),type:"array",items:{type:"string",uniqueItems:!0},default:["starship","oh-my-posh","bash","zsh"]}}};function cx(){De.as(Et.Configuration).registerConfiguration(S_),x_()}var Wv;function x_(n,t){let e=De.as(Et.Configuration),r;n&&(r=lx(n?.profiles,t));let i=Wv;Wv={id:"terminal",order:100,title:p("terminalIntegratedConfigurationTitle","Integrated Terminal"),type:"object",properties:{"terminal.integrated.defaultProfile.linux":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.linux","The default terminal profile on Linux."),type:["string","null"],default:null,enum:n?.os===3?r?.values:void 0,markdownEnumDescriptions:n?.os===3?r?.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.osx":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.osx","The default terminal profile on macOS."),type:["string","null"],default:null,enum:n?.os===2?r?.values:void 0,markdownEnumDescriptions:n?.os===2?r?.markdownDescriptions:void 0},"terminal.integrated.defaultProfile.windows":{restricted:!0,markdownDescription:p("terminal.integrated.defaultProfile.windows","The default terminal profile on Windows."),type:["string","null"],default:null,enum:n?.os===1?r?.values:void 0,markdownEnumDescriptions:n?.os===1?r?.markdownDescriptions:void 0}}},e.updateConfigurations({add:[Wv],remove:i?[i]:[]})}import*as fx from"fs";import*as mx from"child_process";import*as td from"os";var f2e=new Map([[2,"APPEND"],[3,"PREPEND"],[1,"REPLACE"]]);function dx(){let n=/(\d+)\.(\d+)\.(\d+)/g.exec(td.release()),t=0;return n&&n.length===4&&(t=parseInt(n[3])),t}async function Uv(n,t,e,r=_t,i=q.exists){if(Lr(n))return await i(n)?n:void 0;if(t===void 0&&(t=ar()),Ne(n)!=="."){let l=V(t,n);return await i(l)?l:void 0}let s=Xw(r,"PATH");if(e===void 0&&ke(s)&&(e=s.split(cs)),e===void 0||e.length===0){let l=V(t,n);return await i(l)?l:void 0}for(let l of e){let c;if(Lr(l)?c=V(l,n):c=V(t,l,n),await i(c))return c;if(U){let d=c+".com";if(await i(d)||(d=c+".exe",await i(d)))return d}}let a=V(t,n);return await i(a)?a:void 0}var Yo=new Map;Yo.set("windows-pwsh",["-noexit","-command",'try { . "{0}\\out\\vs\\workbench\\contrib\\terminal\\common\\scripts\\shellIntegration.ps1" } catch {}{1}']);Yo.set("windows-pwsh-login",["-l","-noexit","-command",'try { . "{0}\\out\\vs\\workbench\\contrib\\terminal\\common\\scripts\\shellIntegration.ps1" } catch {}{1}']);Yo.set("pwsh",["-noexit","-command",'. "{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1"{1}']);Yo.set("pwsh-login",["-l","-noexit","-command",'. "{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration.ps1"']);Yo.set("zsh",["-i"]);Yo.set("zsh-login",["-il"]);Yo.set("bash",["--init-file","{0}/out/vs/workbench/contrib/terminal/common/scripts/shellIntegration-bash.sh"]);import{dirname as P_,resolve as T_}from"path";var rd,ux=!0;function hx(n,t,e,r,i=process.env,o,s,a,l){return o=o||{existsFile:Pt.existsFile,readFile:fx.promises.readFile},U?C_(e,o,i,s,r.getValue("terminal.integrated.useWslProfiles")!==!1,n&&typeof n=="object"?{...n}:r.getValue("terminal.integrated.profiles.windows"),typeof t=="string"?t:r.getValue("terminal.integrated.defaultProfile.windows"),l,a):L_(o,s,e,n&&typeof n=="object"?{...n}:r.getValue(Q?"terminal.integrated.profiles.linux":"terminal.integrated.profiles.osx"),typeof t=="string"?t:r.getValue(Q?"terminal.integrated.defaultProfile.linux":"terminal.integrated.defaultProfile.osx"),l,a,i)}async function C_(n,t,e,r,i,o,s,a,l){let c=process.env.hasOwnProperty("PROCESSOR_ARCHITEW6432"),d=`${process.env.windir}\\${c?"Sysnative":"System32"}`,u=!1;dx()>=16299&&(u=!0),await __(a);let m=new Map;if(n){m.set("PowerShell",{source:"PowerShell",icon:dt.terminalPowershell,isAutoDetected:!0}),m.set("Windows PowerShell",{path:`${d}\\WindowsPowerShell\\v1.0\\powershell.exe`,icon:dt.terminalPowershell,isAutoDetected:!0}),m.set("Git Bash",{source:"Git Bash",isAutoDetected:!0}),m.set("Command Prompt",{path:`${d}\\cmd.exe`,icon:dt.terminalCmd,isAutoDetected:!0}),m.set("Cygwin",{path:[{path:`${process.env.HOMEDRIVE}\\cygwin64\\bin\\bash.exe`,isUnsafe:!0},{path:`${process.env.HOMEDRIVE}\\cygwin\\bin\\bash.exe`,isUnsafe:!0}],args:["--login"],isAutoDetected:!0}),m.set("bash (MSYS2)",{path:[{path:`${process.env.HOMEDRIVE}\\msys64\\usr\\bin\\bash.exe`,isUnsafe:!0}],args:["--login","-i"],env:{CHERE_INVOKING:"1"},icon:dt.terminalBash,isAutoDetected:!0});let y=`${process.env.CMDER_ROOT||`${process.env.HOMEDRIVE}\\cmder`}\\vendor\\bin\\vscode_init.cmd`;m.set("Cmder",{path:`${d}\\cmd.exe`,args:["/K",y],requiresPath:process.env.CMDER_ROOT?y:{path:y,isUnsafe:!0},isAutoDetected:!0})}vx(o,m);let h=await gx(m.entries(),s,t,e,r,l);if(n&&i)try{let y=await O_(`${d}\\${u?"wsl":"bash"}.exe`,s);for(let v of y)(!o||!(v.profileName in o))&&h.push(v)}catch{ux&&(r?.trace("WSL is not installed, so could not detect WSL profiles"),ux=!1)}return h}async function gx(n,t,e,r=process.env,i,o){let s=[];for(let[a,l]of n)s.push(k_(a,l,t,e,r,i,o));return(await Promise.all(s)).filter(a=>!!a)}async function k_(n,t,e,r,i=process.env,o,s){if(t===null)return;let a,l,c;if("source"in t&&!("path"in t)){let h=rd?.get(t.source);if(!h)return;a=h.paths,l=t.args||h.args,t.icon?c=px(t.icon):h.icon&&(c=h.icon)}else a=Array.isArray(t.path)?t.path:[t.path],l=U||Array.isArray(t.args)?t.args:void 0,c=px(t.icon);let d;if(s){let h=a.map(v=>typeof v=="string"?v:v.path),y=await s(h);d=new Array(a.length);for(let v=0;v<a.length;v++)typeof a[v]=="string"?d[v]=y[v]:d[v]={path:y[v],isUnsafe:!0}}else d=a.slice();let u;if(t.requiresPath){let h;if(ke(t.requiresPath)?h=t.requiresPath:(h=t.requiresPath.path,t.requiresPath.isUnsafe&&(u=h)),!await r.existsFile(h))return}let m=await Jf(n,e,d,r,i,l,t.env,t.overrideName,t.isAutoDetected,u);if(!m){o?.debug("Terminal profile not validated",n,a);return}return m.isAutoDetected=t.isAutoDetected,m.icon=c,m.color=t.color,m}function px(n){return typeof n=="string"?{id:n}:n}async function __(n){if(rd&&!n)return;let[t,e]=await Promise.all([R_(),n||D_()]);rd=new Map,rd.set("Git Bash",{profileName:"Git Bash",paths:t,args:["--login","-i"]}),rd.set("PowerShell",{profileName:"PowerShell",paths:e,icon:dt.terminalPowershell})}async function R_(){let n=new Set,t=await Uv("git.exe");if(t){let i=P_(t);n.add(T_(i,"../.."))}function e(i,o){o&&i.add(o)}e(n,process.env.ProgramW6432),e(n,process.env.ProgramFiles),e(n,process.env["ProgramFiles(X86)"]),e(n,`${process.env.LocalAppData}\\Program`);let r=[];for(let i of n)r.push(`${i}\\Git\\bin\\bash.exe`,`${i}\\Git\\usr\\bin\\bash.exe`,`${i}\\usr\\bin\\bash.exe`);return r.push(`${process.env.UserProfile}\\scoop\\apps\\git\\current\\bin\\bash.exe`),r.push(`${process.env.UserProfile}\\scoop\\apps\\git-with-openssh\\current\\bin\\bash.exe`),r}async function D_(){let n=[];for await(let t of qg())n.push(t.exePath);return n}async function O_(n,t){let e=[],r=await new Promise((s,a)=>{mx.exec("wsl.exe -l -q",{encoding:"utf16le",timeout:1e3},(l,c)=>{if(l)return a("Problem occurred when getting wsl distros");s(c)})});if(!r)return[];let i=new RegExp(/[\r?\n]/),o=r.split(i).filter(s=>s.trim().length>0&&s!=="");for(let s of o){if(s===""||s.startsWith("docker-desktop"))continue;let a=`${s} (WSL)`,l={profileName:a,path:n,args:["-d",`${s}`],isDefault:a===t,icon:F_(s),isAutoDetected:!1};e.push(l)}return e}function F_(n){return n.includes("Ubuntu")?dt.terminalUbuntu:n.includes("Debian")?dt.terminalDebian:dt.terminalLinux}async function L_(n,t,e,r,i,o,s,a){let l=new Map;if(e&&await n.existsFile("/etc/shells")){let c=(await n.readFile("/etc/shells")).toString(),d=(o||c.split(`
`)).map(m=>{let h=m.indexOf("#");return h===-1?m:m.substring(0,h)}).filter(m=>m.trim().length>0),u=new Map;for(let m of d){let h=pe(m),y=u.get(h)||0;y++,y>1&&(h=`${h} (${y})`),u.set(h,y),l.set(h,{path:m,isAutoDetected:!0})}}return vx(r,l),await gx(l.entries(),i,n,a,t,s)}function vx(n,t){if(n)for(let[e,r]of Object.entries(n))r===null||typeof r!="object"||!("path"in r)&&!("source"in r)?t.delete(e):(r.icon=r.icon||t.get(e)?.icon,t.set(e,r))}async function Jf(n,t,e,r,i,o,s,a,l,c){if(e.length===0)return Promise.resolve(void 0);let d=e.shift();if(d==="")return Jf(n,t,e,r,i,o,s,a,l);let u=typeof d!="string"&&d.isUnsafe,m=typeof d=="string"?d:d.path,h={profileName:n,path:m,args:o,env:s,overrideName:a,isAutoDetected:l,isDefault:n===t,isUnsafePath:u,requiresUnsafePath:c};if(pe(m)===m){let v=i.PATH?i.PATH.split(cs):void 0,b=await Uv(m,void 0,v,void 0,r.existsFile);return b?(h.path=b,h.isFromPath=!0,h):Jf(n,t,e,r,i,o)}return await r.existsFile(lt(m))?h:Jf(n,t,e,r,i,o,s,a,l)}var Ya=class extends D{constructor(e,r,i,o){super();this._ptyHostStarter=e;this._configurationService=r;this._logService=i;this._loggerService=o;cx(),this._register(this._ptyHostStarter),this._register($(()=>this._disposePtyHost())),this._resolveVariablesRequestStore=this._register(new Ja(void 0,this._logService)),this._register(this._resolveVariablesRequestStore.onCreateRequest(this._onPtyHostRequestResolveVariables.fire,this._onPtyHostRequestResolveVariables)),this._ptyHostStarter.onRequestConnection&&this._register(E.once(this._ptyHostStarter.onRequestConnection)(()=>this._ensurePtyHost())),this._ptyHostStarter.onWillShutdown&&this._register(this._ptyHostStarter.onWillShutdown(()=>this._wasQuitRequested=!0))}__connection;__proxy;get _connection(){return this._ensurePtyHost(),this.__connection}get _proxy(){return this._ensurePtyHost(),this.__proxy}get _optionalProxy(){return this.__proxy}_ensurePtyHost(){this.__connection||this._startPtyHost()}_resolveVariablesRequestStore;_wasQuitRequested=!1;_restartCount=0;_isResponsive=!0;_heartbeatFirstTimeout;_heartbeatSecondTimeout;_onPtyHostExit=this._register(new S);onPtyHostExit=this._onPtyHostExit.event;_onPtyHostStart=this._register(new S);onPtyHostStart=this._onPtyHostStart.event;_onPtyHostUnresponsive=this._register(new S);onPtyHostUnresponsive=this._onPtyHostUnresponsive.event;_onPtyHostResponsive=this._register(new S);onPtyHostResponsive=this._onPtyHostResponsive.event;_onPtyHostRequestResolveVariables=this._register(new S);onPtyHostRequestResolveVariables=this._onPtyHostRequestResolveVariables.event;_onProcessData=this._register(new S);onProcessData=this._onProcessData.event;_onProcessReady=this._register(new S);onProcessReady=this._onProcessReady.event;_onProcessReplay=this._register(new S);onProcessReplay=this._onProcessReplay.event;_onProcessOrphanQuestion=this._register(new S);onProcessOrphanQuestion=this._onProcessOrphanQuestion.event;_onDidRequestDetach=this._register(new S);onDidRequestDetach=this._onDidRequestDetach.event;_onDidChangeProperty=this._register(new S);onDidChangeProperty=this._onDidChangeProperty.event;_onProcessExit=this._register(new S);onProcessExit=this._onProcessExit.event;get _ignoreProcessNames(){return this._configurationService.getValue("terminal.integrated.ignoreProcessNames")}async _refreshIgnoreProcessNames(){return this._optionalProxy?.refreshIgnoreProcessNames?.(this._ignoreProcessNames)}async _resolveShellEnv(){if(U)return process.env;try{return await Ia(this._configurationService,this._logService,{_:[]},process.env)}catch(e){return this._logService.error("ptyHost was unable to resolve shell environment",e),{}}}_startPtyHost(){let e=this._ptyHostStarter.start(),r=e.client;this._logService.getLevel()===1&&this._logService.trace("PtyHostService#_startPtyHost",new Error().stack?.replace(/^Error/,"")),$e.toService(r.getChannel("heartbeat")).onBeat(()=>this._handleHeartbeat()),this._handleHeartbeat(!0),this._register(e.onDidProcessExit(s=>{this._onPtyHostExit.fire(s.code),!this._wasQuitRequested&&!this._store.isDisposed&&(this._restartCount<=5?(this._logService.error(`ptyHost terminated unexpectedly with code ${s.code}`),this._restartCount++,this.restartPtyHost()):this._logService.error(`ptyHost terminated unexpectedly with code ${s.code}, giving up`))}));let o=$e.toService(r.getChannel("ptyHost"));return this._register(o.onProcessData(s=>this._onProcessData.fire(s))),this._register(o.onProcessReady(s=>this._onProcessReady.fire(s))),this._register(o.onProcessExit(s=>this._onProcessExit.fire(s))),this._register(o.onDidChangeProperty(s=>this._onDidChangeProperty.fire(s))),this._register(o.onProcessReplay(s=>this._onProcessReplay.fire(s))),this._register(o.onProcessOrphanQuestion(s=>this._onProcessOrphanQuestion.fire(s))),this._register(o.onDidRequestDetach(s=>this._onDidRequestDetach.fire(s))),this._register(new Gf(this._loggerService,r.getChannel("logger"))),this.__connection=e,this.__proxy=o,this._onPtyHostStart.fire(),this._register(this._configurationService.onDidChangeConfiguration(async s=>{s.affectsConfiguration("terminal.integrated.ignoreProcessNames")&&await this._refreshIgnoreProcessNames()})),this._refreshIgnoreProcessNames(),[e,o]}async createProcess(e,r,i,o,s,a,l,c,d,u,m){let h=setTimeout(()=>this._handleUnresponsiveCreateProcess(),5e3),y=await this._proxy.createProcess(e,r,i,o,s,a,l,c,d,u,m);return clearTimeout(h),y}updateTitle(e,r,i){return this._proxy.updateTitle(e,r,i)}updateIcon(e,r,i,o){return this._proxy.updateIcon(e,r,i,o)}attachToProcess(e){return this._proxy.attachToProcess(e)}detachFromProcess(e,r){return this._proxy.detachFromProcess(e,r)}shutdownAll(){return this._proxy.shutdownAll()}listProcesses(){return this._proxy.listProcesses()}async getPerformanceMarks(){return this._optionalProxy?.getPerformanceMarks()??[]}async reduceConnectionGraceTime(){return this._optionalProxy?.reduceConnectionGraceTime()}start(e){return this._proxy.start(e)}shutdown(e,r){return this._proxy.shutdown(e,r)}input(e,r){return this._proxy.input(e,r)}processBinary(e,r){return this._proxy.processBinary(e,r)}resize(e,r,i){return this._proxy.resize(e,r,i)}clearBuffer(e){return this._proxy.clearBuffer(e)}acknowledgeDataEvent(e,r){return this._proxy.acknowledgeDataEvent(e,r)}setUnicodeVersion(e,r){return this._proxy.setUnicodeVersion(e,r)}getInitialCwd(e){return this._proxy.getInitialCwd(e)}getCwd(e){return this._proxy.getCwd(e)}async getLatency(){let e=new yr,r=await this._proxy.getLatency();return e.stop(),[{label:"ptyhostservice<->ptyhost",latency:e.elapsed()},...r]}orphanQuestionReply(e){return this._proxy.orphanQuestionReply(e)}installAutoReply(e,r){return this._proxy.installAutoReply(e,r)}uninstallAllAutoReplies(){return this._proxy.uninstallAllAutoReplies()}uninstallAutoReply(e){return this._proxy.uninstallAutoReply(e)}getDefaultSystemShell(e){return this._optionalProxy?.getDefaultSystemShell(e)??Jp(e??xt,process.env)}async getProfiles(e,r,i,o=!1){let s=await this._resolveShellEnv();return hx(r,i,o,this._configurationService,s,void 0,this._logService,this._resolveVariables.bind(this,e))}async getEnvironment(){return this.__proxy?this._proxy.getEnvironment():{...process.env}}getWslPath(e,r){return this._proxy.getWslPath(e,r)}getRevivedPtyNewId(e,r){return this._proxy.getRevivedPtyNewId(e,r)}setTerminalLayoutInfo(e){return this._proxy.setTerminalLayoutInfo(e)}async getTerminalLayoutInfo(e){return this._optionalProxy?.getTerminalLayoutInfo(e)}async requestDetachInstance(e,r){return this._proxy.requestDetachInstance(e,r)}async acceptDetachInstanceReply(e,r){return this._proxy.acceptDetachInstanceReply(e,r)}async freePortKillProcess(e){if(!this._proxy.freePortKillProcess)throw new Error("freePortKillProcess does not exist on the pty proxy");return this._proxy.freePortKillProcess(e)}async serializeTerminalState(e){return this._proxy.serializeTerminalState(e)}async reviveTerminalProcesses(e,r,i){return this._proxy.reviveTerminalProcesses(e,r,i)}async refreshProperty(e,r){return this._proxy.refreshProperty(e,r)}async updateProperty(e,r,i){return this._proxy.updateProperty(e,r,i)}async restartPtyHost(){this._disposePtyHost(),this._isResponsive=!0,this._startPtyHost()}_disposePtyHost(){this._proxy.shutdownAll(),this._connection.store.dispose()}_handleHeartbeat(e){this._clearHeartbeatTimeouts(),this._heartbeatFirstTimeout=setTimeout(()=>this._handleHeartbeatFirstTimeout(),e?2e4:5e3*1.2),this._isResponsive||(this._isResponsive=!0,this._onPtyHostResponsive.fire())}_handleHeartbeatFirstTimeout(){this._logService.warn(`No ptyHost heartbeat after ${5e3*1.2/1e3} seconds`),this._heartbeatFirstTimeout=void 0,this._heartbeatSecondTimeout=setTimeout(()=>this._handleHeartbeatSecondTimeout(),5e3*1)}_handleHeartbeatSecondTimeout(){this._logService.error(`No ptyHost heartbeat after ${(5e3*1.2+5e3*1.2)/1e3} seconds`),this._heartbeatSecondTimeout=void 0,this._isResponsive&&(this._isResponsive=!1,this._onPtyHostUnresponsive.fire())}_handleUnresponsiveCreateProcess(){this._clearHeartbeatTimeouts(),this._logService.error(`No ptyHost response to createProcess after ${5e3/1e3} seconds`),this._isResponsive&&(this._isResponsive=!1,this._onPtyHostUnresponsive.fire())}_clearHeartbeatTimeouts(){this._heartbeatFirstTimeout&&(clearTimeout(this._heartbeatFirstTimeout),this._heartbeatFirstTimeout=void 0),this._heartbeatSecondTimeout&&(clearTimeout(this._heartbeatSecondTimeout),this._heartbeatSecondTimeout=void 0)}_resolveVariables(e,r){return this._resolveVariablesRequestStore.createRequest({workspaceId:e,originalText:r})}async acceptPtyHostResolvedVariables(e,r){this._resolveVariablesRequestStore.acceptReply(e,r)}};Ya=P([g(1,ce),g(2,A),g(3,Ai)],Ya);var Nv="request",yx="remoteResourceHandler",Qf=class{async routeCall(t,e,r){if(e!==Nv)throw new Error(`Call not found: ${e}`);let i=r[0];if(i?.authority){let o=t.connections.find(s=>s.ctx===i.authority);if(o)return o}throw new Error("Caller not found")}routeEvent(t,e){throw new Error(`Event not found: ${e}`)}};import{BrowserWindow as A_,app as W_}from"electron";var Xa=class extends D{constructor(e,r){super();this.instantiationService=e;this.logService=r;this.registerListeners()}_onDidMaximizeWindow=this._register(new S);onDidMaximizeWindow=this._onDidMaximizeWindow.event;_onDidUnmaximizeWindow=this._register(new S);onDidUnmaximizeWindow=this._onDidUnmaximizeWindow.event;_onDidChangeFullScreen=this._register(new S);onDidChangeFullScreen=this._onDidChangeFullScreen.event;_onDidTriggerSystemContextMenu=this._register(new S);onDidTriggerSystemContextMenu=this._onDidTriggerSystemContextMenu.event;windows=new Map;registerListeners(){W_.on("browser-window-created",(e,r)=>{let i=this.getWindowByWebContents(r.webContents);if(i)this.logService.trace('[aux window] app.on("browser-window-created"): Trying to claim auxiliary window'),i.tryClaimWindow();else{let o=new Y;o.add(E.fromNodeEventEmitter(r.webContents,"did-create-window",(s,a)=>({browserWindow:s,details:a}))(({browserWindow:s,details:a})=>{let l=this.getWindowByWebContents(s.webContents);l&&(this.logService.trace('[aux window] window.on("did-create-window"): Trying to claim auxiliary window'),l.tryClaimWindow(a.options))})),o.add(E.fromNodeEventEmitter(r,"closed")(()=>o.dispose()))}}),_e.handle("vscode:registerAuxiliaryWindow",async(e,r)=>{let i=this.getWindowByWebContents(e.sender);return i&&(this.logService.trace("[aux window] vscode:registerAuxiliaryWindow: Registering auxiliary window to main window"),i.parentId=r),e.sender.id})}createWindow(e){let{state:r,overrides:i}=this.computeWindowStateAndOverrides(e);return this.instantiationService.invokeFunction(Cp,r,i,{preload:Re.asFileUri("vs/base/parts/sandbox/electron-sandbox/preload-aux.js").fsPath})}computeWindowStateAndOverrides(e){let r={},i={},o=e.features.split(",");for(let a of o){let[l,c]=a.split("=");switch(l){case"width":r.width=parseInt(c,10);break;case"height":r.height=parseInt(c,10);break;case"left":r.x=parseInt(c,10);break;case"top":r.y=parseInt(c,10);break;case"window-maximized":r.mode=0;break;case"window-fullscreen":r.mode=3;break;case"window-disable-fullscreen":i.disableFullscreen=!0;break;case"window-native-titlebar":i.forceNativeTitlebar=!0;break}}let s=Tc.validateWindowState(this.logService,r)??Hw();return this.logService.trace("[aux window] using window state",s),{state:s,overrides:i}}registerWindow(e){let r=new Y,i=this.instantiationService.createInstance(ua,e);this.windows.set(i.id,i),r.add($(()=>this.windows.delete(i.id))),r.add(i.onDidMaximize(()=>this._onDidMaximizeWindow.fire(i))),r.add(i.onDidUnmaximize(()=>this._onDidUnmaximizeWindow.fire(i))),r.add(i.onDidEnterFullScreen(()=>this._onDidChangeFullScreen.fire({window:i,fullscreen:!0}))),r.add(i.onDidLeaveFullScreen(()=>this._onDidChangeFullScreen.fire({window:i,fullscreen:!1}))),r.add(i.onDidTriggerSystemContextMenu(({x:o,y:s})=>this._onDidTriggerSystemContextMenu.fire({window:i,x:o,y:s}))),E.once(i.onDidClose)(()=>r.dispose())}getWindowByWebContents(e){let r=this.windows.get(e.id);return r?.matches(e)?r:void 0}getFocusedWindow(){let e=A_.getFocusedWindow();if(e)return this.getWindowByWebContents(e.webContents)}getLastActiveWindow(){return kp(Array.from(this.windows.values()))}getWindows(){return Array.from(this.windows.values())}};Xa=P([g(0,Yt),g(1,A)],Xa);var ao=class extends D{constructor(e,r,i,o,s,a,l,c,d,u,m,h){super();this.mainProcessNodeIpcServer=e;this.userEnv=r;this.mainInstantiationService=i;this.logService=o;this.loggerService=s;this.environmentMainService=a;this.lifecycleMainService=l;this.configurationService=c;this.stateService=d;this.fileService=u;this.productService=m;this.userDataProfilesMainService=h;this.configureSession(),this.registerListeners()}static SECURITY_PROTOCOL_HANDLING_CONFIRMATION_SETTING_KEY={[L.file]:"security.promptForLocalFileProtocolHandling",[L.vscodeRemote]:"security.promptForRemoteFileProtocolHandling"};windowsMainService;auxiliaryWindowsMainService;nativeHostMainService;configureSession(){let e=d=>d?.startsWith(`${L.vscodeWebview}://`),r=new Set(["clipboard-read","clipboard-sanitized-write"]);Za.defaultSession.setPermissionRequestHandler((d,u,m,h)=>e(h.requestingUrl)?m(r.has(u)):m(!1)),Za.defaultSession.setPermissionCheckHandler((d,u,m,h)=>e(h.requestingUrl)?r.has(u):!1);let i=new Set([L.file,L.vscodeFileResource,L.vscodeRemoteResource,L.vscodeManagedRemoteResource,"devtools"]),o=d=>{for(let u=d;u;u=u.parent)if(u.url.startsWith(`${L.vscodeWebview}://`))return!0;return!1},s=d=>d.resourceType==="xhr"||o(d.frame),a=d=>{let u=d.frame;if(!u||!this.windowsMainService)return!1;let m=U_.getAllWindows();for(let h of m)if(u.processId===h.webContents.mainFrame.processId)return!0;return!1},l=(d,u)=>{if(d.path!=="/index.html")return!0;let m=u.frame;if(!m||!this.windowsMainService)return!1;for(let h of this.windowsMainService.getWindows())if(h.win&&m.processId===h.win.webContents.mainFrame.processId)return!0;return!1};Za.defaultSession.webRequest.onBeforeRequest((d,u)=>{let m=x.parse(d.url);return m.scheme===L.vscodeWebview&&!l(m,d)?(this.logService.error("Blocked vscode-webview request",d.url),u({cancel:!0})):m.scheme===L.vscodeFileResource&&!a(d)?(this.logService.error("Blocked vscode-file request",d.url),u({cancel:!0})):m.path.endsWith(".svg")&&!i.has(m.scheme)?u({cancel:!s(d)}):u({cancel:!1})}),Za.defaultSession.webRequest.onHeadersReceived((d,u)=>{let m=d.responseHeaders,h=m["content-type"]||m["Content-Type"];if(h&&Array.isArray(h)){let y=x.parse(d.url);if(y.path.endsWith(".svg")&&i.has(y.scheme))return m["Content-Type"]=["image/svg+xml"],u({cancel:!1,responseHeaders:m});if(!y.path.endsWith(L.vscodeRemoteResource)&&h.some(v=>v.toLowerCase().includes("image/svg")))return u({cancel:!s(d)})}return u({cancel:!1})}),Za.defaultSession.webRequest.onHeadersReceived((d,u)=>{if(d.url.startsWith("https://vscode.download.prss.microsoft.com/")){let m=d.responseHeaders??Object.create(null);if(m["Access-Control-Allow-Origin"]===void 0)return m["Access-Control-Allow-Origin"]=["*"],u({cancel:!1,responseHeaders:m})}return u({cancel:!1})});let c=Za.defaultSession;typeof c.setCodeCachePath=="function"&&this.environmentMainService.codeCachePath&&c.setCodeCachePath(V(this.environmentMainService.codeCachePath,"chrome")),U&&(this.configurationService.getValue("security.restrictUNCAccess")===!1?wb():Ls(this.configurationService.getValue("security.allowedUNCHosts")))}registerListeners(){Pd(i=>this.onUnexpectedError(i)),process.on("uncaughtException",i=>{Ty(i)||Je(i)}),process.on("unhandledRejection",i=>Je(i)),E.once(this.lifecycleMainService.onWillShutdown)(()=>this.dispose()),Tb(),Xo.on("accessibility-support-changed",(i,o)=>{this.windowsMainService?.sendToAll("vscode:accessibilitySupportChanged",o)}),Xo.on("activate",async(i,o)=>{this.logService.trace("app#activate"),o||await this.windowsMainService?.openEmptyWindow({context:1})}),Xo.on("web-contents-created",(i,o)=>{o?.opener?.url.startsWith(`${L.vscodeFileResource}://${xo}/`)&&(this.logService.trace('[aux window]  app.on("web-contents-created"): Registering auxiliary window'),this.auxiliaryWindowsMainService?.registerWindow(o)),o.on("will-navigate",s=>{this.logService.error("webContents#will-navigate: Prevented webcontent navigation"),s.preventDefault()}),o.setWindowOpenHandler(s=>s.url==="about:blank"?(this.logService.trace("[aux window] webContents#setWindowOpenHandler: Allowing auxiliary window to open on about:blank"),{action:"allow",overrideBrowserWindowOptions:this.auxiliaryWindowsMainService?.createWindow(s)}):(this.logService.trace(`webContents#setWindowOpenHandler: Prevented opening window with URL ${s.url}}`),this.nativeHostMainService?.openExternal(void 0,s.url),{action:"deny"}))});let e=[],r;Xo.on("open-file",(i,o)=>{o=Rn(o),this.logService.trace("app#open-file: ",o),i.preventDefault(),e.push(Tn(o)?{workspaceUri:x.file(o)}:{fileUri:x.file(o)}),r!==void 0&&(clearTimeout(r),r=void 0),r=setTimeout(async()=>{await this.windowsMainService?.open({context:1,cli:this.environmentMainService.args,urisToOpen:e,gotoLineMode:!1,preferNewWindow:!0}),e=[],r=void 0},100)}),Xo.on("new-window-for-tab",async()=>{await this.windowsMainService?.openEmptyWindow({context:4})}),_e.handle("vscode:fetchShellEnv",i=>{let o=this.windowsMainService?.getWindowByWebContents(i.sender),s,a;return o?.config?(s=o.config,a={...process.env,...o.config.userEnv}):(s=this.environmentMainService.args,a=process.env),this.resolveShellEnvironment(s,a,!1)}),_e.on("vscode:toggleDevTools",i=>i.sender.toggleDevTools()),_e.on("vscode:openDevTools",i=>i.sender.openDevTools()),_e.on("vscode:reloadWindow",i=>i.sender.reload()),_e.handle("vscode:notifyZoomLevel",async(i,o)=>{let s=this.windowsMainService?.getWindowByWebContents(i.sender);s&&s.notifyZoomLevel(o)})}onUnexpectedError(e){if(e){let r={message:`[uncaught exception in main]: ${e.message}`,stack:e.stack};this.windowsMainService?.sendToFocused("vscode:reportError",JSON.stringify(r))}this.logService.error(`[uncaught exception in main]: ${e}`),e.stack&&this.logService.error(e.stack)}async startup(){this.logService.debug("Starting VS Code"),this.logService.debug(`from: ${this.environmentMainService.appRoot}`),this.logService.debug("args:",this.environmentMainService.args);let e=this.productService.win32AppUserModelId;U&&e&&Xo.setAppUserModelId(e);try{W&&this.configurationService.getValue("window.nativeTabs")===!0&&!bx.getUserDefault("NSUseImprovedLayoutPass","boolean")&&bx.setUserDefault("NSUseImprovedLayoutPass","boolean",!0)}catch(m){this.logService.error(m)}let r=new Lu;E.once(this.lifecycleMainService.onWillShutdown)(m=>{m.reason===2&&r.dispose()}),this.logService.trace("Resolving machine identifier...");let[i,o,s]=await Promise.all([ix(this.stateService,this.logService),ox(this.stateService,this.logService),sx(this.stateService,this.logService)]);this.logService.trace(`Resolved machine identifier: ${i}`);let{sharedProcessReady:a,sharedProcessClient:l}=this.setupSharedProcess(i,o,s),c=await this.initServices(i,o,s,a);c.invokeFunction(m=>m.get(Mc)),this._register(c.createInstance(qa)),c.invokeFunction(m=>this.initChannels(m,r,l));let d=await c.invokeFunction(m=>this.setupProtocolUrlHandlers(m,r));this.setupManagedRemoteResourceUrlHandler(r),this.lifecycleMainService.phase=2,await c.invokeFunction(m=>this.openFirstWindow(m,d)),this.lifecycleMainService.phase=3,this.afterWindowOpen(),this._register(new bt(()=>{this._register(Wl(()=>this.lifecycleMainService.phase=4,2500))},2500)).schedule()}async setupProtocolUrlHandlers(e,r){let i=this.windowsMainService=e.get(Fe),o=e.get(Ta),s=this.nativeHostMainService=e.get(Cr),a=e.get(Gt),l=this;o.registerHandler({async handleURL(y,v){return l.handleProtocolUrl(i,a,o,y,v)}});let c=this._register(new Mf({onDidOpenMainWindow:s.onDidOpenMainWindow,onDidFocusMainWindow:s.onDidFocusMainWindow,getActiveWindowId:()=>s.getActiveWindowId(-1)})),d=new _u(y=>c.getActiveClientId().then(v=>y===v)),u=new Rf(d,this.logService),m=r.getChannel("urlHandler",u);o.registerHandler(new _f(m));let h=await this.resolveInitialProtocolUrls(i,a);return this._register(new Df(h?.urls,o,i,this.environmentMainService,this.productService,this.logService)),h}setupManagedRemoteResourceUrlHandler(e){let r=()=>({statusCode:404,data:"Not found"}),i=new Ir(()=>e.getChannel(yx,new Qf));Ix.registerBufferProtocol(L.vscodeManagedRemoteResource,(o,s)=>{let a=x.parse(o.url);if(!a.authority.startsWith("window:"))return s(r());i.value.call(Nv,[a]).then(l=>s({...l,data:Buffer.from(l.body,"base64")}),l=>{this.logService.warn("error dispatching remote resource call",l),s({statusCode:500,data:String(l)})})})}async resolveInitialProtocolUrls(e,r){let i=this.environmentMainService.args["open-url"]?this.environmentMainService.args._urls||[]:[];i.length>0&&this.logService.trace("app#resolveInitialProtocolUrls() protocol urls from command line:",i);let o=global.getOpenUrls()||[];if(o.length>0&&this.logService.trace("app#resolveInitialProtocolUrls() protocol urls from macOS 'open-url' event:",o),i.length+o.length===0)return;let s=[...i,...o].map(c=>{try{return{uri:x.parse(c),originalUrl:c}}catch{this.logService.trace("app#resolveInitialProtocolUrls() protocol url failed to parse:",c);return}}),a=[],l=[];for(let c of s){if(!c)continue;let d=this.getWindowOpenableFromProtocolUrl(c.uri);if(d)if(await this.shouldBlockOpenable(d,e,r)){this.logService.trace("app#resolveInitialProtocolUrls() protocol url was blocked:",c.uri.toString(!0));continue}else this.logService.trace("app#resolveInitialProtocolUrls() protocol url will be handled as window to open:",c.uri.toString(!0),d),a.push(d);else this.logService.trace("app#resolveInitialProtocolUrls() protocol url will be passed to active window for handling:",c.uri.toString(!0)),l.push(c)}return{urls:l,openables:a}}async shouldBlockOpenable(e,r,i){let o,s;if(wc(e)?(o=e.workspaceUri,s=p("confirmOpenMessageWorkspace","An external application wants to open '{0}' in {1}. Do you want to open this workspace file?",o.scheme===L.file?ni(o,{os:xt,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)):mp(e)?(o=e.folderUri,s=p("confirmOpenMessageFolder","An external application wants to open '{0}' in {1}. Do you want to open this folder?",o.scheme===L.file?ni(o,{os:xt,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)):(o=e.fileUri,s=p("confirmOpenMessageFileOrFolder","An external application wants to open '{0}' in {1}. Do you want to open this file or folder?",o.scheme===L.file?ni(o,{os:xt,tildify:this.environmentMainService}):o.toString(!0),this.productService.nameShort)),o.scheme!==L.file&&o.scheme!==L.vscodeRemote||this.configurationService.getValue(ao.SECURITY_PROTOCOL_HANDLING_CONFIRMATION_SETTING_KEY[o.scheme])===!1)return!1;let{response:l,checkboxChecked:c}=await i.showMessageBox({type:"warning",buttons:[p({key:"open",comment:["&& denotes a mnemonic"]},"&&Yes"),p({key:"cancel",comment:["&& denotes a mnemonic"]},"&&No")],message:s,detail:p("confirmOpenDetail","If you did not initiate this request, it may represent an attempted attack on your system. Unless you took an explicit action to initiate this request, you should press 'No'"),checkboxLabel:o.scheme===L.file?p("doNotAskAgainLocal","Allow opening local paths without asking"):p("doNotAskAgainRemote","Allow opening remote paths without asking"),cancelId:1});if(l!==0)return!0;if(c){let d={channel:"vscode:disablePromptForProtocolHandling",args:o.scheme===L.file?"local":"remote"};r.sendToFocused(d.channel,d.args),r.sendToOpeningWindow(d.channel,d.args)}return!1}getWindowOpenableFromProtocolUrl(e){if(e.path){if(e.authority===L.file){let r=x.file(e.fsPath);return Tn(r)?{workspaceUri:r}:{fileUri:r}}else if(e.authority===L.vscodeRemote){let r=e.path.indexOf(ee.sep,1),i,o;r!==-1?(i=e.path.substring(1,r),o=e.path.substring(r)):(i=e.path.substring(1),o="/");let s=e.query,a=new URLSearchParams(e.query);a.get("windowId")==="_blank"&&(a.delete("windowId"),s=a.toString());let l=x.from({scheme:L.vscodeRemote,authority:i,path:o,query:s,fragment:e.fragment});return Tn(o)?{workspaceUri:l}:/:[\d]+$/.test(o)?{fileUri:l}:{folderUri:l}}}}async handleProtocolUrl(e,r,i,o,s){this.logService.trace("app#handleProtocolUrl():",o.toString(!0),s),o.scheme===this.productService.urlProtocol&&o.path==="workspace"&&(o=o.with({authority:"file",path:x.parse(o.query).path,query:""}));let a=!1,l=new URLSearchParams(o.query);l.get("windowId")==="_blank"?(this.logService.trace("app#handleProtocolUrl() found 'windowId=_blank' as parameter, setting shouldOpenInNewWindow=true:",o.toString(!0)),l.delete("windowId"),o=o.with({query:l.toString()}),a=!0):W&&e.getWindowCount()===0&&(this.logService.trace("app#handleProtocolUrl() running on macOS with no window open, setting shouldOpenInNewWindow=true:",o.toString(!0)),a=!0);let c=l.get("continueOn");c!==null&&(this.logService.trace("app#handleProtocolUrl() found 'continueOn' as parameter:",o.toString(!0)),l.delete("continueOn"),o=o.with({query:l.toString()}),this.environmentMainService.continueOn=c??void 0);let d=this.getWindowOpenableFromProtocolUrl(o);return d?await this.shouldBlockOpenable(d,e,r)?(this.logService.trace("app#handleProtocolUrl() protocol url was blocked:",o.toString(!0)),!0):(this.logService.trace("app#handleProtocolUrl() opening protocol url as window:",d,o.toString(!0)),(await e.open({context:6,cli:{...this.environmentMainService.args},urisToOpen:[d],forceNewWindow:a,gotoLineMode:!0})).at(0)?.focus(),!0):a?(this.logService.trace("app#handleProtocolUrl() opening empty window and passing in protocol url:",o.toString(!0)),await(await e.open({context:6,cli:{...this.environmentMainService.args},forceNewWindow:!0,forceEmpty:!0,gotoLineMode:!0,remoteAuthority:di(o)})).at(0)?.ready(),i.open(o,s)):(this.logService.trace("app#handleProtocolUrl(): not handled",o.toString(!0),s),!1)}setupSharedProcess(e,r,i){let o=this._register(this.mainInstantiationService.createInstance(_a,e,r,i));this._register(o.onDidCrash(()=>this.windowsMainService?.sendToFocused("vscode:reportSharedProcessCrash")));let s=(async()=>{this.logService.trace("Main->SharedProcess#connect");let l=await o.connect();return this.logService.trace("Main->SharedProcess#connect: connection established"),new Ms(l,"main")})();return{sharedProcessReady:(async()=>(await o.whenReady(),s))(),sharedProcessClient:s}}async initServices(e,r,i,o){let s=new ki;switch(process.platform){case"win32":s.set(to,new le(jo));break;case"linux":Sd?s.set(to,new le(Fa,[process.env.SNAP,process.env.SNAP_REVISION])):s.set(to,new le(Oa));break;case"darwin":s.set(to,new le(Hn));break}s.set(Fe,new le(Na,[e,r,i,this.userEnv],!1)),s.set(mi,new le(Xa,void 0,!1));let a=new ra(this.logService,this.productService);s.set(Gt,a),s.set(yv,new le(Ca,void 0,!1)),s.set(Wc,new le(ha,void 0,!1)),s.set($p,$e.toService(ql(o.then(m=>m.getChannel("diagnostics"))))),s.set(sv,new le(Zi,[this.userEnv])),s.set(av,new le(eo,[this.userEnv])),s.set(Zl,new le(ga)),s.set(vv,new le(Pa)),s.set(Cr,new le(qo,void 0,!1)),s.set(Cv,new le(Aa)),s.set(Sv,new le(ka)),s.set(Qg,new le(Ji)),s.set(Bo,new le(pa)),s.set($i,new le(fa));let l=new Ga({graceTime:6e4,shortGraceTime:6e3,scrollback:this.configurationService.getValue("terminal.integrated.persistentSessionScrollback")??100},this.configurationService,this.environmentMainService,this.lifecycleMainService,this.logService),c=new Ya(l,this.configurationService,this.logService,this.loggerService);s.set(Xg,c),U?s.set(Bc,new le(Kc)):W?s.set(Bc,new le(Qp)):Q&&s.set(Bc,new le(Hc));let d=new fi(this.environmentMainService,this.configurationService,this.logService,this.stateService);s.set(An,d);let u=new ca(this.environmentMainService,this.logService,this.userDataProfilesMainService,d,a);if(s.set(Tr,u),s.set(Bg,new le(Ba,void 0,!1)),s.set(ro,new le(Wt,void 0,!1)),s.set(Ta,new le(Ma,void 0,!1)),Pp(this.productService,this.environmentMainService)){let m=dS(this.productService,this.configurationService),h=ql(o.then(k=>k.getChannel("telemetryAppender"))),y=new Tf(h),v=lS(B_(),N_(),process.arch,this.productService.commit,this.productService.version,e,r,i,m),b=uS(this.environmentMainService),C={appenders:[y],commonProperties:v,piiPaths:b,sendErrorTelemetry:!0};s.set(Ve,new le(Ra,[C],!1))}else s.set(Ve,Hi);return s.set(so,new le($a,void 0,!0)),s.set(ex,new le(za,void 0,!0)),s.set(Fv,new le(ja,void 0,!0)),s.set(Mc,new le(ma)),s.set(Xi,new le(Ea,void 0,!0)),await Xe.settled([d.initialize(),u.initialize()]),this.mainInstantiationService.createChild(s)}initChannels(e,r,i){let o=this._register(new Y),s=$e.fromService(e.get(yv),o,{disableMarshalling:!0});this.mainProcessNodeIpcServer.registerChannel("launch",s);let a=$e.fromService(e.get(Wc),o,{disableMarshalling:!0});this.mainProcessNodeIpcServer.registerChannel("diagnostics",a);let l=o.add(new Af(e.get(Jr)));r.registerChannel("policy",l),i.then(B=>B.registerChannel("policy",l));let c=this.fileService.getProvider(L.file);th(c instanceof Yi);let d=o.add(new gf(c,this.logService,this.environmentMainService));r.registerChannel(nv,d),i.then(B=>B.registerChannel(nv,d));let u=$e.fromService(e.get(rr),o);r.registerChannel("userDataProfiles",u),i.then(B=>B.registerChannel("userDataProfiles",u));let m=new Wf(e.get(wr));i.then(B=>B.registerChannel("request",m));let h=new Cf(e.get(to));r.registerChannel("update",h);let y=$e.fromService(e.get(sv),o);r.registerChannel("issue",y);let v=$e.fromService(e.get(av),o);r.registerChannel("process",v);let b=$e.fromService(e.get(Zl),o);r.registerChannel("encryption",b);let C=$e.fromService(e.get(no),o);r.registerChannel("sign",C);let k=$e.fromService(e.get(vv),o);r.registerChannel("keyboardLayout",k),this.nativeHostMainService=e.get(Cr);let _=$e.fromService(this.nativeHostMainService,o);r.registerChannel("nativeHost",_),i.then(B=>B.registerChannel("nativeHost",_));let T=$e.fromService(e.get(Bg),o);r.registerChannel("workspaces",T);let N=$e.fromService(e.get(Sv),o);r.registerChannel("menubar",N);let J=$e.fromService(e.get(Ta),o);r.registerChannel("url",J);let H=$e.fromService(e.get(Cv),o);r.registerChannel("webview",H);let Ke=o.add(new Pf(this.logService,e.get(Bo)));r.registerChannel("storage",Ke),i.then(B=>B.registerChannel("storage",Ke));let re=o.add(new qf(e.get(Bo),e.get(rr),this.logService));i.then(B=>B.registerChannel("profileStorageListener",re));let je=$e.fromService(e.get(Xg),o);r.registerChannel("localPty",je);let zr=$e.fromService(e.get(Bc),o);r.registerChannel("externalTerminal",zr);let Nt=new $f(e.get(Nn));r.registerChannel("logger",Nt),i.then(B=>B.registerChannel("logger",Nt));let vn=new zp(e.get(Fe));r.registerChannel("extensionhostdebugservice",vn);let qr=$e.fromService(e.get(Qg),o);r.registerChannel(JS,qr);let j=$e.fromService(e.get(Fv),o);r.registerChannel(ax,j)}async openFirstWindow(e,r){let i=this.windowsMainService=e.get(Fe);this.auxiliaryWindowsMainService=e.get(mi);let o=mn(process.env)?0:4,s=this.environmentMainService.args;if(r){if(r.openables.length>0)return i.open({context:o,cli:s,urisToOpen:r.openables,gotoLineMode:!0,initialStartup:!0});if(r.urls.length>0)for(let b of r.urls){let C=new URLSearchParams(b.uri.query);if(C.get("windowId")==="_blank")return C.delete("windowId"),b.originalUrl=b.uri.toString(!0),b.uri=b.uri.with({query:C.toString()}),i.open({context:o,cli:s,forceNewWindow:!0,forceEmpty:!0,gotoLineMode:!0,initialStartup:!0})}}let a=global.macOpenFiles,l=s._.length,c=!!s["folder-uri"],d=!!s["file-uri"],u=s["skip-add-to-recently-opened"]===!0,m=s.wait&&s.waitMarkerFilePath?x.file(s.waitMarkerFilePath):void 0,h=s.remote||void 0,y=s.profile,v=s["profile-temp"];if(!l&&!c&&!d){if(s["new-window"]||y||v)return i.open({context:o,cli:s,forceNewWindow:!0,forceEmpty:!0,noRecentEntry:u,waitMarkerFileURI:m,initialStartup:!0,remoteAuthority:h,forceProfile:y,forceTempProfile:v});if(a.length)return i.open({context:1,cli:s,urisToOpen:a.map(b=>(b=Rn(b),Tn(b)?{workspaceUri:x.file(b)}:{fileUri:x.file(b)})),noRecentEntry:u,waitMarkerFileURI:m,initialStartup:!0})}return i.open({context:o,cli:s,forceNewWindow:s["new-window"],diffMode:s.diff,mergeMode:s.merge,noRecentEntry:u,waitMarkerFileURI:m,gotoLineMode:s.goto,initialStartup:!0,remoteAuthority:h,forceProfile:y,forceTempProfile:v})}afterWindowOpen(){this.installMutex(),Ix.registerHttpProtocol(L.vscodeRemoteResource,(e,r)=>{r({url:e.url.replace(/^vscode-remote-resource:/,"http:"),method:e.method})}),this.resolveShellEnvironment(this.environmentMainService.args,process.env,!0),this.updateCrashReporterEnablement(),W&&Xo.runningUnderARM64Translation&&this.windowsMainService?.sendToFocused("vscode:showTranslatedBuildWarning")}async installMutex(){let e=this.productService.win32MutexName;if(U&&e)try{let r=await import("@vscode/windows-mutex"),i=new r.Mutex(e);E.once(this.lifecycleMainService.onWillShutdown)(()=>i.release())}catch(r){this.logService.error(r)}}async resolveShellEnvironment(e,r,i){try{return await Ia(this.configurationService,this.logService,e,r)}catch(o){let s=zt(o);i?this.windowsMainService?.sendToFocused("vscode:showResolveShellEnvError",s):this.logService.error(s)}return{}}async updateCrashReporterEnablement(){try{let r=(await this.fileService.readFile(this.environmentMainService.argvResource)).value.toString(),i=xb(r),s=na(this.configurationService)>=1;if(i["enable-crash-reporter"]===void 0){let a=["","	// Allows to disable crash reporting.","	// Should restart the app if the value is changed.",`	"enable-crash-reporter": ${s},`,"","	// Unique id used for correlating crash reports sent from this instance.","	// Do not edit this value.",`	"crash-reporter-id": "${Ze()}"`,"}"],l=r.substring(0,r.length-2).concat(`,
`,a.join(`
`));await this.fileService.writeFile(this.environmentMainService.argvResource,K.fromString(l))}else{let a=r.replace(/"enable-crash-reporter": .*,/,`"enable-crash-reporter": ${s},`);a!==r&&await this.fileService.writeFile(this.environmentMainService.argvResource,K.fromString(a))}}catch(e){this.logService.error(e),this.windowsMainService?.sendToFocused("vscode:showArgvParseWarning")}}};ao=P([g(2,Yt),g(3,A),g(4,Ai),g(5,ge),g(6,oe),g(7,ce),g(8,et),g(9,Pe),g(10,be),g(11,rr)],ao);function nd(n){return Object.isFrozen(n)?n:Jw(n)}var it=class n{constructor(t,e,r,i,o){this._contents=t;this._keys=e;this._overrides=r;this.raw=i;this.logService=o}static createEmptyModel(t){return new n({},[],[],void 0,t)}overrideConfigurations=new Map;_rawConfiguration;get rawConfiguration(){if(!this._rawConfiguration)if(this.raw?.length){let t=this.raw.map(e=>{if(e instanceof n)return e;let r=new Yf("",this.logService);return r.parseRaw(e),r.configurationModel});this._rawConfiguration=t.reduce((e,r)=>r===e?r:e.merge(r),t[0])}else this._rawConfiguration=this;return this._rawConfiguration}get contents(){return this._contents}get overrides(){return this._overrides}get keys(){return this._keys}isEmpty(){return this._keys.length===0&&Object.keys(this._contents).length===0&&this._overrides.length===0}getValue(t){return t?Fl(this.contents,t):this.contents}inspect(t,e){let r=this;return{get value(){return nd(r.rawConfiguration.getValue(t))},get override(){return e?nd(r.rawConfiguration.getOverrideValue(t,e)):void 0},get merged(){return nd(e?r.rawConfiguration.override(e).getValue(t):r.rawConfiguration.getValue(t))},get overrides(){let i=[];for(let{contents:o,identifiers:s,keys:a}of r.rawConfiguration.overrides){let l=new n(o,a,[],void 0,r.logService).getValue(t);l!==void 0&&i.push({identifiers:s,value:l})}return i.length?nd(i):void 0}}}getOverrideValue(t,e){let r=this.getContentsForOverrideIdentifer(e);return r?t?Fl(r,t):r:void 0}getKeysForOverrideIdentifier(t){let e=[];for(let r of this.overrides)r.identifiers.includes(t)&&e.push(...r.keys);return Qt(e)}getAllOverrideIdentifiers(){let t=[];for(let e of this.overrides)t.push(...e.identifiers);return Qt(t)}override(t){let e=this.overrideConfigurations.get(t);return e||(e=this.createOverrideConfigurationModel(t),this.overrideConfigurations.set(t,e)),e}merge(...t){let e=er(this.contents),r=er(this.overrides),i=[...this.keys],o=this.raw?.length?[...this.raw]:[this];for(let s of t)if(o.push(...s.raw?.length?s.raw:[s]),!s.isEmpty()){this.mergeContents(e,s.contents);for(let a of s.overrides){let[l]=r.filter(c=>Xn(c.identifiers,a.identifiers));l?(this.mergeContents(l.contents,a.contents),l.keys.push(...a.keys),l.keys=Qt(l.keys)):r.push(er(a))}for(let a of s.keys)i.indexOf(a)===-1&&i.push(a)}return new n(e,i,r,o.every(s=>s instanceof n)?void 0:o,this.logService)}createOverrideConfigurationModel(t){let e=this.getContentsForOverrideIdentifer(t);if(!e||typeof e!="object"||!Object.keys(e).length)return this;let r={};for(let i of Qt([...Object.keys(this.contents),...Object.keys(e)])){let o=this.contents[i],s=e[i];s&&(typeof o=="object"&&typeof s=="object"?(o=er(o),this.mergeContents(o,s)):o=s),r[i]=o}return new n(r,this.keys,this.overrides,void 0,this.logService)}mergeContents(t,e){for(let r of Object.keys(e)){if(r in t&&qe(t[r])&&qe(e[r])){this.mergeContents(t[r],e[r]);continue}t[r]=er(e[r])}}getContentsForOverrideIdentifer(t){let e=null,r=null,i=o=>{o&&(r?this.mergeContents(r,o):r=er(o))};for(let o of this.overrides)o.identifiers.length===1&&o.identifiers[0]===t?e=o.contents:o.identifiers.includes(t)&&i(o.contents);return i(e),r}toJSON(){return{contents:this.contents,overrides:this.overrides,keys:this.keys}}addValue(t,e){this.updateValue(t,e,!0)}setValue(t,e){this.updateValue(t,e,!1)}removeValue(t){let e=this.keys.indexOf(t);e!==-1&&(this.keys.splice(e,1),OI(this.contents,t),Cn.test(t)&&this.overrides.splice(this.overrides.findIndex(r=>Xn(r.identifiers,xs(t))),1))}updateValue(t,e,r){if(yh(this.contents,t,e,i=>this.logService.error(i)),r=r||this.keys.indexOf(t)===-1,r&&this.keys.push(t),Cn.test(t)){let i=xs(t),o={identifiers:i,keys:Object.keys(this.contents[t]),contents:ou(this.contents[t],a=>this.logService.error(a))},s=this.overrides.findIndex(a=>Xn(a.identifiers,i));s!==-1?this.overrides[s]=o:this.overrides.push(o)}}},Yf=class{constructor(t,e){this._name=t;this.logService=e}_raw=null;_configurationModel=null;_restrictedConfigurations=[];_parseErrors=[];get configurationModel(){return this._configurationModel||it.createEmptyModel(this.logService)}get restrictedConfigurations(){return this._restrictedConfigurations}get errors(){return this._parseErrors}parse(t,e){if(!ct(t)){let r=this.doParseContent(t);this.parseRaw(r,e)}}reparse(t){this._raw&&this.parseRaw(this._raw,t)}parseRaw(t,e){this._raw=t;let{contents:r,keys:i,overrides:o,restricted:s,hasExcludedProperties:a}=this.doParseRaw(t,e);this._configurationModel=new it(r,i,o,a?[t]:void 0,this.logService),this._restrictedConfigurations=s||[]}doParseContent(t){let e={},r=null,i=[],o=[],s=[];function a(c){Array.isArray(i)?i.push(c):r!==null&&(i[r]=c)}let l={onObjectBegin:()=>{let c={};a(c),o.push(i),i=c,r=null},onObjectProperty:c=>{r=c},onObjectEnd:()=>{i=o.pop()},onArrayBegin:()=>{let c=[];a(c),o.push(i),i=c,r=null},onArrayEnd:()=>{i=o.pop()},onLiteralValue:a,onError:(c,d,u)=>{s.push({error:c,offset:d,length:u})}};if(t)try{Dp(t,l),e=i[0]||{}}catch(c){this.logService.error(`Error while parsing settings file ${this._name}: ${c}`),this._parseErrors=[c]}return e}doParseRaw(t,e){let r=De.as(Et.Configuration).getConfigurationProperties(),i=this.filter(t,r,!0,e);t=i.raw;let o=ou(t,l=>this.logService.error(`Conflict in settings file ${this._name}: ${l}`)),s=Object.keys(t),a=this.toOverrides(t,l=>this.logService.error(`Conflict in settings file ${this._name}: ${l}`));return{contents:o,keys:s,overrides:a,restricted:i.restricted,hasExcludedProperties:i.hasExcludedProperties}}filter(t,e,r,i){let o=!1;if(!i?.scopes&&!i?.skipRestricted&&!i?.exclude?.length)return{raw:t,restricted:[],hasExcludedProperties:o};let s={},a=[];for(let l in t)if(Cn.test(l)&&r){let c=this.filter(t[l],e,!1,i);s[l]=c.raw,o=o||c.hasExcludedProperties,a.push(...c.restricted)}else{let c=e[l],d=c?typeof c.scope<"u"?c.scope:3:void 0;c?.restricted&&a.push(l),!i.exclude?.includes(l)&&(i.include?.includes(l)||(d===void 0||i.scopes===void 0||i.scopes.includes(d))&&!(i.skipRestricted&&c?.restricted))?s[l]=t[l]:o=!0}return{raw:s,restricted:a,hasExcludedProperties:o}}toOverrides(t,e){let r=[];for(let i of Object.keys(t))if(Cn.test(i)){let o={};for(let s in t[i])o[s]=t[i][s];r.push({identifiers:xs(i),keys:Object.keys(o),contents:ou(o,e)})}return r}},Xf=class extends D{constructor(e,r,i,o,s){super();this.userSettingsResource=e;this.parseOptions=r;this.fileService=o;this.logService=s;this.parser=new Yf(this.userSettingsResource.toString(),s),this._register(this.fileService.watch(i.dirname(this.userSettingsResource))),this._register(this.fileService.watch(this.userSettingsResource)),this._register(E.any(E.filter(this.fileService.onDidFilesChange,a=>a.contains(this.userSettingsResource)),E.filter(this.fileService.onDidRunOperation,a=>(a.isOperation(0)||a.isOperation(3)||a.isOperation(1)||a.isOperation(4))&&i.isEqual(a.resource,e)))(()=>this._onDidChange.fire()))}parser;_onDidChange=this._register(new S);onDidChange=this._onDidChange.event;async loadConfiguration(){try{let e=await this.fileService.readFile(this.userSettingsResource);return this.parser.parse(e.value.toString()||"{}",this.parseOptions),this.parser.configurationModel}catch{return it.createEmptyModel(this.logService)}}reparse(e){return e&&(this.parseOptions=e),this.parser.reparse(this.parseOptions),this.parser.configurationModel}getRestrictedSettings(){return this.parser.restrictedConfigurations}},Bv=class{constructor(t,e,r,i,o,s,a,l,c,d,u,m,h){this.key=t;this.overrides=e;this._value=r;this.overrideIdentifiers=i;this.defaultConfiguration=o;this.policyConfiguration=s;this.applicationConfiguration=a;this.userConfiguration=l;this.localUserConfiguration=c;this.remoteUserConfiguration=d;this.workspaceConfiguration=u;this.folderConfigurationModel=m;this.memoryConfigurationModel=h}get value(){return nd(this._value)}toInspectValue(t){return t?.value!==void 0||t?.override!==void 0||t?.overrides!==void 0?t:void 0}_defaultInspectValue;get defaultInspectValue(){return this._defaultInspectValue||(this._defaultInspectValue=this.defaultConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._defaultInspectValue}get defaultValue(){return this.defaultInspectValue.merged}get default(){return this.toInspectValue(this.defaultInspectValue)}_policyInspectValue;get policyInspectValue(){return this._policyInspectValue===void 0&&(this._policyInspectValue=this.policyConfiguration?this.policyConfiguration.inspect(this.key):null),this._policyInspectValue}get policyValue(){return this.policyInspectValue?.merged}get policy(){return this.policyInspectValue?.value!==void 0?{value:this.policyInspectValue.value}:void 0}_applicationInspectValue;get applicationInspectValue(){return this._applicationInspectValue===void 0&&(this._applicationInspectValue=this.applicationConfiguration?this.applicationConfiguration.inspect(this.key):null),this._applicationInspectValue}get applicationValue(){return this.applicationInspectValue?.merged}get application(){return this.toInspectValue(this.applicationInspectValue)}_userInspectValue;get userInspectValue(){return this._userInspectValue||(this._userInspectValue=this.userConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userInspectValue}get userValue(){return this.userInspectValue.merged}get user(){return this.toInspectValue(this.userInspectValue)}_userLocalInspectValue;get userLocalInspectValue(){return this._userLocalInspectValue||(this._userLocalInspectValue=this.localUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userLocalInspectValue}get userLocalValue(){return this.userLocalInspectValue.merged}get userLocal(){return this.toInspectValue(this.userLocalInspectValue)}_userRemoteInspectValue;get userRemoteInspectValue(){return this._userRemoteInspectValue||(this._userRemoteInspectValue=this.remoteUserConfiguration.inspect(this.key,this.overrides.overrideIdentifier)),this._userRemoteInspectValue}get userRemoteValue(){return this.userRemoteInspectValue.merged}get userRemote(){return this.toInspectValue(this.userRemoteInspectValue)}_workspaceInspectValue;get workspaceInspectValue(){return this._workspaceInspectValue===void 0&&(this._workspaceInspectValue=this.workspaceConfiguration?this.workspaceConfiguration.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceInspectValue}get workspaceValue(){return this.workspaceInspectValue?.merged}get workspace(){return this.toInspectValue(this.workspaceInspectValue)}_workspaceFolderInspectValue;get workspaceFolderInspectValue(){return this._workspaceFolderInspectValue===void 0&&(this._workspaceFolderInspectValue=this.folderConfigurationModel?this.folderConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier):null),this._workspaceFolderInspectValue}get workspaceFolderValue(){return this.workspaceFolderInspectValue?.merged}get workspaceFolder(){return this.toInspectValue(this.workspaceFolderInspectValue)}_memoryInspectValue;get memoryInspectValue(){return this._memoryInspectValue===void 0&&(this._memoryInspectValue=this.memoryConfigurationModel.inspect(this.key,this.overrides.overrideIdentifier)),this._memoryInspectValue}get memoryValue(){return this.memoryInspectValue.merged}get memory(){return this.toInspectValue(this.memoryInspectValue)}},el=class n{constructor(t,e,r,i,o,s,a,l,c,d){this._defaultConfiguration=t;this._policyConfiguration=e;this._applicationConfiguration=r;this._localUserConfiguration=i;this._remoteUserConfiguration=o;this._workspaceConfiguration=s;this._folderConfigurations=a;this._memoryConfiguration=l;this._memoryConfigurationByResource=c;this.logService=d}_workspaceConsolidatedConfiguration=null;_foldersConsolidatedConfigurations=new Ue;getValue(t,e,r){return this.getConsolidatedConfigurationModel(t,e,r).getValue(t)}updateValue(t,e,r={}){let i;r.resource?(i=this._memoryConfigurationByResource.get(r.resource),i||(i=it.createEmptyModel(this.logService),this._memoryConfigurationByResource.set(r.resource,i))):i=this._memoryConfiguration,e===void 0?i.removeValue(t):i.setValue(t,e),r.resource||(this._workspaceConsolidatedConfiguration=null)}inspect(t,e,r){let i=this.getConsolidatedConfigurationModel(t,e,r),o=this.getFolderConfigurationModelForResource(e.resource,r),s=e.resource?this._memoryConfigurationByResource.get(e.resource)||this._memoryConfiguration:this._memoryConfiguration,a=new Set;for(let l of i.overrides)for(let c of l.identifiers)i.getOverrideValue(t,c)!==void 0&&a.add(c);return new Bv(t,e,i.getValue(t),a.size?[...a]:void 0,this._defaultConfiguration,this._policyConfiguration.isEmpty()?void 0:this._policyConfiguration,this.applicationConfiguration.isEmpty()?void 0:this.applicationConfiguration,this.userConfiguration,this.localUserConfiguration,this.remoteUserConfiguration,r?this._workspaceConfiguration:void 0,o||void 0,s)}keys(t){let e=this.getFolderConfigurationModelForResource(void 0,t);return{default:this._defaultConfiguration.keys.slice(0),user:this.userConfiguration.keys.slice(0),workspace:this._workspaceConfiguration.keys.slice(0),workspaceFolder:e?e.keys.slice(0):[]}}updateDefaultConfiguration(t){this._defaultConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updatePolicyConfiguration(t){this._policyConfiguration=t}updateApplicationConfiguration(t){this._applicationConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateLocalUserConfiguration(t){this._localUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateRemoteUserConfiguration(t){this._remoteUserConfiguration=t,this._userConfiguration=null,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateWorkspaceConfiguration(t){this._workspaceConfiguration=t,this._workspaceConsolidatedConfiguration=null,this._foldersConsolidatedConfigurations.clear()}updateFolderConfiguration(t,e){this._folderConfigurations.set(t,e),this._foldersConsolidatedConfigurations.delete(t)}deleteFolderConfiguration(t){this.folderConfigurations.delete(t),this._foldersConsolidatedConfigurations.delete(t)}compareAndUpdateDefaultConfiguration(t,e){let r=[];if(!e){let{added:i,updated:o,removed:s}=lo(this._defaultConfiguration,t);e=[...i,...o,...s]}for(let i of e)for(let o of xs(i)){let s=this._defaultConfiguration.getKeysForOverrideIdentifier(o),a=t.getKeysForOverrideIdentifier(o),l=[...a.filter(c=>s.indexOf(c)===-1),...s.filter(c=>a.indexOf(c)===-1),...s.filter(c=>!Pr(this._defaultConfiguration.override(o).getValue(c),t.override(o).getValue(c)))];r.push([o,l])}return this.updateDefaultConfiguration(t),{keys:e,overrides:r}}compareAndUpdatePolicyConfiguration(t){let{added:e,updated:r,removed:i}=lo(this._policyConfiguration,t),o=[...e,...r,...i];return o.length&&this.updatePolicyConfiguration(t),{keys:o,overrides:[]}}compareAndUpdateApplicationConfiguration(t){let{added:e,updated:r,removed:i,overrides:o}=lo(this.applicationConfiguration,t),s=[...e,...r,...i];return s.length&&this.updateApplicationConfiguration(t),{keys:s,overrides:o}}compareAndUpdateLocalUserConfiguration(t){let{added:e,updated:r,removed:i,overrides:o}=lo(this.localUserConfiguration,t),s=[...e,...r,...i];return s.length&&this.updateLocalUserConfiguration(t),{keys:s,overrides:o}}compareAndUpdateRemoteUserConfiguration(t){let{added:e,updated:r,removed:i,overrides:o}=lo(this.remoteUserConfiguration,t),s=[...e,...r,...i];return s.length&&this.updateRemoteUserConfiguration(t),{keys:s,overrides:o}}compareAndUpdateWorkspaceConfiguration(t){let{added:e,updated:r,removed:i,overrides:o}=lo(this.workspaceConfiguration,t),s=[...e,...r,...i];return s.length&&this.updateWorkspaceConfiguration(t),{keys:s,overrides:o}}compareAndUpdateFolderConfiguration(t,e){let r=this.folderConfigurations.get(t),{added:i,updated:o,removed:s,overrides:a}=lo(r,e),l=[...i,...o,...s];return(l.length||!r)&&this.updateFolderConfiguration(t,e),{keys:l,overrides:a}}compareAndDeleteFolderConfiguration(t){let e=this.folderConfigurations.get(t);if(!e)throw new Error("Unknown folder");this.deleteFolderConfiguration(t);let{added:r,updated:i,removed:o,overrides:s}=lo(e,void 0);return{keys:[...r,...i,...o],overrides:s}}get defaults(){return this._defaultConfiguration}get applicationConfiguration(){return this._applicationConfiguration}_userConfiguration=null;get userConfiguration(){return this._userConfiguration||(this._userConfiguration=this._remoteUserConfiguration.isEmpty()?this._localUserConfiguration:this._localUserConfiguration.merge(this._remoteUserConfiguration)),this._userConfiguration}get localUserConfiguration(){return this._localUserConfiguration}get remoteUserConfiguration(){return this._remoteUserConfiguration}get workspaceConfiguration(){return this._workspaceConfiguration}get folderConfigurations(){return this._folderConfigurations}getConsolidatedConfigurationModel(t,e,r){let i=this.getConsolidatedConfigurationModelForResource(e,r);return e.overrideIdentifier&&(i=i.override(e.overrideIdentifier)),!this._policyConfiguration.isEmpty()&&this._policyConfiguration.getValue(t)!==void 0&&(i=i.merge(this._policyConfiguration)),i}getConsolidatedConfigurationModelForResource({resource:t},e){let r=this.getWorkspaceConsolidatedConfiguration();if(e&&t){let i=e.getFolder(t);i&&(r=this.getFolderConsolidatedConfiguration(i.uri)||r);let o=this._memoryConfigurationByResource.get(t);o&&(r=r.merge(o))}return r}getWorkspaceConsolidatedConfiguration(){return this._workspaceConsolidatedConfiguration||(this._workspaceConsolidatedConfiguration=this._defaultConfiguration.merge(this.applicationConfiguration,this.userConfiguration,this._workspaceConfiguration,this._memoryConfiguration)),this._workspaceConsolidatedConfiguration}getFolderConsolidatedConfiguration(t){let e=this._foldersConsolidatedConfigurations.get(t);if(!e){let r=this.getWorkspaceConsolidatedConfiguration(),i=this._folderConfigurations.get(t);i?(e=r.merge(i),this._foldersConsolidatedConfigurations.set(t,e)):e=r}return e}getFolderConfigurationModelForResource(t,e){if(e&&t){let r=e.getFolder(t);if(r)return this._folderConfigurations.get(r.uri)}}toData(){return{defaults:{contents:this._defaultConfiguration.contents,overrides:this._defaultConfiguration.overrides,keys:this._defaultConfiguration.keys},policy:{contents:this._policyConfiguration.contents,overrides:this._policyConfiguration.overrides,keys:this._policyConfiguration.keys},application:{contents:this.applicationConfiguration.contents,overrides:this.applicationConfiguration.overrides,keys:this.applicationConfiguration.keys},user:{contents:this.userConfiguration.contents,overrides:this.userConfiguration.overrides,keys:this.userConfiguration.keys},workspace:{contents:this._workspaceConfiguration.contents,overrides:this._workspaceConfiguration.overrides,keys:this._workspaceConfiguration.keys},folders:[...this._folderConfigurations.keys()].reduce((t,e)=>{let{contents:r,overrides:i,keys:o}=this._folderConfigurations.get(e);return t.push([e,{contents:r,overrides:i,keys:o}]),t},[])}}allKeys(){let t=new Set;return this._defaultConfiguration.keys.forEach(e=>t.add(e)),this.userConfiguration.keys.forEach(e=>t.add(e)),this._workspaceConfiguration.keys.forEach(e=>t.add(e)),this._folderConfigurations.forEach(e=>e.keys.forEach(r=>t.add(r))),[...t.values()]}allOverrideIdentifiers(){let t=new Set;return this._defaultConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this.userConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this._workspaceConfiguration.getAllOverrideIdentifiers().forEach(e=>t.add(e)),this._folderConfigurations.forEach(e=>e.getAllOverrideIdentifiers().forEach(r=>t.add(r))),[...t.values()]}getAllKeysForOverrideIdentifier(t){let e=new Set;return this._defaultConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>e.add(r)),this.userConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>e.add(r)),this._workspaceConfiguration.getKeysForOverrideIdentifier(t).forEach(r=>e.add(r)),this._folderConfigurations.forEach(r=>r.getKeysForOverrideIdentifier(t).forEach(i=>e.add(i))),[...e.values()]}static parse(t,e){let r=this.parseConfigurationModel(t.defaults,e),i=this.parseConfigurationModel(t.policy,e),o=this.parseConfigurationModel(t.application,e),s=this.parseConfigurationModel(t.user,e),a=this.parseConfigurationModel(t.workspace,e),l=t.folders.reduce((c,d)=>(c.set(x.revive(d[0]),this.parseConfigurationModel(d[1],e)),c),new Ue);return new n(r,i,o,s,it.createEmptyModel(e),a,l,it.createEmptyModel(e),new Ue,e)}static parseConfigurationModel(t,e){return new it(t.contents,t.keys,t.overrides,void 0,e)}};var Zf=class{constructor(t,e,r,i,o){this.change=t;this.previous=e;this.currentConfiguraiton=r;this.currentWorkspace=i;this.logService=o;for(let s of t.keys)this.affectedKeys.add(s);for(let[,s]of t.overrides)for(let a of s)this.affectedKeys.add(a);this._affectsConfigStr=this._marker;for(let s of this.affectedKeys)this._affectsConfigStr+=s+this._marker}_marker=`
`;_markerCode1=this._marker.charCodeAt(0);_markerCode2=46;_affectsConfigStr;affectedKeys=new Set;source;_previousConfiguration=void 0;get previousConfiguration(){return!this._previousConfiguration&&this.previous&&(this._previousConfiguration=el.parse(this.previous.data,this.logService)),this._previousConfiguration}affectsConfiguration(t,e){let r=this._marker+t,i=this._affectsConfigStr.indexOf(r);if(i<0)return!1;let o=i+r.length;if(o>=this._affectsConfigStr.length)return!1;let s=this._affectsConfigStr.charCodeAt(o);if(s!==this._markerCode1&&s!==this._markerCode2)return!1;if(e){let a=this.previousConfiguration?this.previousConfiguration.getValue(t,e,this.previous?.workspace):void 0,l=this.currentConfiguraiton.getValue(t,e,this.currentWorkspace);return!Pr(a,l)}return!0}};function lo(n,t){let{added:e,removed:r,updated:i}=wx(t?.rawConfiguration,n?.rawConfiguration),o=[],s=n?.getAllOverrideIdentifiers()||[],a=t?.getAllOverrideIdentifiers()||[];if(t){let l=a.filter(c=>!s.includes(c));for(let c of l)o.push([c,t.getKeysForOverrideIdentifier(c)])}if(n){let l=s.filter(c=>!a.includes(c));for(let c of l)o.push([c,n.getKeysForOverrideIdentifier(c)])}if(t&&n){for(let l of s)if(a.includes(l)){let c=wx({contents:n.getOverrideValue(void 0,l)||{},keys:n.getKeysForOverrideIdentifier(l)},{contents:t.getOverrideValue(void 0,l)||{},keys:t.getKeysForOverrideIdentifier(l)});o.push([l,[...c.added,...c.removed,...c.updated]])}}return{added:e,removed:r,updated:i,overrides:o}}function wx(n,t){let e=n?t?n.keys.filter(o=>t.keys.indexOf(o)===-1):[...n.keys]:[],r=t?n?t.keys.filter(o=>n.keys.indexOf(o)===-1):[...t.keys]:[],i=[];if(n&&t){for(let o of t.keys)if(n.keys.indexOf(o)!==-1){let s=Fl(t.contents,o),a=Fl(n.contents,o);Pr(s,a)||i.push(o)}}return{added:e,removed:r,updated:i}}var em=class extends D{constructor(e){super();this.logService=e}_onDidChangeConfiguration=this._register(new S);onDidChangeConfiguration=this._onDidChangeConfiguration.event;_configurationModel=it.createEmptyModel(this.logService);get configurationModel(){return this._configurationModel}async initialize(){return this.resetConfigurationModel(),this._register(De.as(Et.Configuration).onDidUpdateConfiguration(({properties:e,defaultsOverrides:r})=>this.onDidUpdateConfiguration(Array.from(e),r))),this.configurationModel}reload(){return this.resetConfigurationModel(),this.configurationModel}onDidUpdateConfiguration(e,r){this.updateConfigurationModel(e,De.as(Et.Configuration).getConfigurationProperties()),this._onDidChangeConfiguration.fire({defaults:this.configurationModel,properties:e})}getConfigurationDefaultOverrides(){return{}}resetConfigurationModel(){this._configurationModel=it.createEmptyModel(this.logService);let e=De.as(Et.Configuration).getConfigurationProperties();this.updateConfigurationModel(Object.keys(e),e)}updateConfigurationModel(e,r){let i=this.getConfigurationDefaultOverrides();for(let o of e){let s=i[o],a=r[o];s!==void 0?this._configurationModel.setValue(o,s):a?this._configurationModel.setValue(o,a.default):this._configurationModel.removeValue(o)}}},tm=class{onDidChangeConfiguration=E.None;configurationModel=it.createEmptyModel(new qu);async initialize(){return this.configurationModel}},tl=class extends D{constructor(e,r,i){super();this.defaultConfiguration=e;this.policyService=r;this.logService=i}_onDidChangeConfiguration=this._register(new S);onDidChangeConfiguration=this._onDidChangeConfiguration.event;_configurationModel=it.createEmptyModel(this.logService);get configurationModel(){return this._configurationModel}async initialize(){return this.logService.trace("PolicyConfiguration#initialize"),this.update(await this.updatePolicyDefinitions(this.defaultConfiguration.configurationModel.keys),!1),this._register(this.policyService.onDidChange(e=>this.onDidChangePolicies(e))),this._register(this.defaultConfiguration.onDidChangeConfiguration(async({properties:e})=>this.update(await this.updatePolicyDefinitions(e),!0))),this._configurationModel}async updatePolicyDefinitions(e){this.logService.trace("PolicyConfiguration#updatePolicyDefinitions",e);let r={},i=[],o=De.as(Et.Configuration).getConfigurationProperties();for(let s of e){let a=o[s];if(!a){i.push(s);continue}if(a.policy){if(a.type!=="string"&&a.type!=="number"){this.logService.warn(`Policy ${a.policy.name} has unsupported type ${a.type}`);continue}i.push(s),r[a.policy.name]={type:a.type}}}return hs(r)||await this.policyService.updatePolicyDefinitions(r),i}onDidChangePolicies(e){this.logService.trace("PolicyConfiguration#onDidChangePolicies",e);let r=De.as(Et.Configuration).getPolicyConfigurations(),i=Ye(e.map(o=>r.get(o)));this.update(i,!0)}update(e,r){this.logService.trace("PolicyConfiguration#update",e);let i=De.as(Et.Configuration).getConfigurationProperties(),o=[],s=this._configurationModel.isEmpty();for(let a of e){let l=i[a]?.policy?.name;if(l){let c=this.policyService.getPolicyValue(l);(s?c!==void 0:!Pr(this._configurationModel.getValue(a),c))&&o.push([a,c])}else this._configurationModel.getValue(a)!==void 0&&o.push([a,void 0])}if(o.length){this.logService.trace("PolicyConfiguration#changed",o);let a=this._configurationModel;this._configurationModel=it.createEmptyModel(this.logService);for(let l of a.keys)this._configurationModel.setValue(l,a.getValue(l));for(let[l,c]of o)c===void 0?this._configurationModel.removeValue(l):this._configurationModel.setValue(l,c);r&&this._onDidChangeConfiguration.fire(this._configurationModel)}}};tl=P([g(1,Jr),g(2,A)],tl);var rm=class extends D{constructor(e,r,i,o){super();this.settingsResource=e;this.logService=o;this.defaultConfiguration=this._register(new em(o)),this.policyConfiguration=i instanceof Ss?new tm:this._register(new tl(this.defaultConfiguration,i,o)),this.userConfiguration=this._register(new Xf(this.settingsResource,{},Le,r,o)),this.configuration=new el(this.defaultConfiguration.configurationModel,this.policyConfiguration.configurationModel,it.createEmptyModel(o),it.createEmptyModel(o),it.createEmptyModel(o),it.createEmptyModel(o),new Ue,it.createEmptyModel(o),new Ue,o),this.configurationEditing=new Vv(e,r,this),this.reloadConfigurationScheduler=this._register(new bt(()=>this.reloadConfiguration(),50)),this._register(this.defaultConfiguration.onDidChangeConfiguration(({defaults:s,properties:a})=>this.onDidDefaultConfigurationChange(s,a))),this._register(this.policyConfiguration.onDidChangeConfiguration(s=>this.onDidPolicyConfigurationChange(s))),this._register(this.userConfiguration.onDidChange(()=>this.reloadConfigurationScheduler.schedule()))}configuration;defaultConfiguration;policyConfiguration;userConfiguration;reloadConfigurationScheduler;_onDidChangeConfiguration=this._register(new S);onDidChangeConfiguration=this._onDidChangeConfiguration.event;configurationEditing;async initialize(){let[e,r,i]=await Promise.all([this.defaultConfiguration.initialize(),this.policyConfiguration.initialize(),this.userConfiguration.loadConfiguration()]);this.configuration=new el(e,r,it.createEmptyModel(this.logService),i,it.createEmptyModel(this.logService),it.createEmptyModel(this.logService),new Ue,it.createEmptyModel(this.logService),new Ue,this.logService)}getConfigurationData(){return this.configuration.toData()}getValue(e,r){let i=typeof e=="string"?e:void 0,o=iu(e)?e:iu(r)?r:{};return this.configuration.getValue(i,o,void 0)}async updateValue(e,r,i,o,s){let a=DI(i)?i:iu(i)?{resource:i.resource,overrideIdentifiers:i.overrideIdentifier?[i.overrideIdentifier]:void 0}:void 0,l=a?o:i;if(l!==void 0&&l!==3&&l!==2)throw new Error(`Unable to write ${e} to target ${l}.`);a?.overrideIdentifiers&&(a.overrideIdentifiers=Qt(a.overrideIdentifiers),a.overrideIdentifiers=a.overrideIdentifiers.length?a.overrideIdentifiers:void 0);let c=this.inspect(e,{resource:a?.resource,overrideIdentifier:a?.overrideIdentifiers?a.overrideIdentifiers[0]:void 0});if(c.policyValue!==void 0)throw new Error(`Unable to write ${e} because it is configured in system policy.`);if(Pr(r,c.defaultValue)&&(r=void 0),a?.overrideIdentifiers?.length&&a.overrideIdentifiers.length>1){let u=a.overrideIdentifiers.sort(),m=this.configuration.localUserConfiguration.overrides.find(h=>Xn([...h.identifiers].sort(),u));m&&(a.overrideIdentifiers=m.identifiers)}let d=a?.overrideIdentifiers?.length?[WI(a.overrideIdentifiers),e]:[e];await this.configurationEditing.write(d,r),await this.reloadConfiguration()}inspect(e,r={}){return this.configuration.inspect(e,r,void 0)}keys(){return this.configuration.keys(void 0)}async reloadConfiguration(){let e=await this.userConfiguration.loadConfiguration();this.onDidChangeUserConfiguration(e)}onDidChangeUserConfiguration(e){let r=this.configuration.toData(),i=this.configuration.compareAndUpdateLocalUserConfiguration(e);this.trigger(i,r,2)}onDidDefaultConfigurationChange(e,r){let i=this.configuration.toData(),o=this.configuration.compareAndUpdateDefaultConfiguration(e,r);this.trigger(o,i,7)}onDidPolicyConfigurationChange(e){let r=this.configuration.toData(),i=this.configuration.compareAndUpdatePolicyConfiguration(e);this.trigger(i,r,7)}trigger(e,r,i){let o=new Zf(e,{data:r},this.configuration,void 0,this.logService);o.source=i,this._onDidChangeConfiguration.fire(o)}},Vv=class{constructor(t,e,r){this.settingsResource=t;this.fileService=e;this.configurationService=r;this.queue=new _n}queue;write(t,e){return this.queue.queue(()=>this.doWriteConfiguration(t,e))}async doWriteConfiguration(t,e){let r;try{r=(await this.fileService.readFile(this.settingsResource)).value.toString()}catch(s){if(s.fileOperationResult===1)r="{}";else throw s}let i=[];if(Yr(r,i,{allowTrailingComma:!0,allowEmptyContent:!0}),i.length>0)throw new Error("Unable to write into the settings file. Please open the file to correct errors/warnings in the file and try again.");let o=this.getEdits(r,t,e);r=Ng(r,o),await this.fileService.writeFile(this.settingsResource,K.fromString(r))}getEdits(t,e,r){let{tabSize:i,insertSpaces:o,eol:s}=this.formattingOptions;if(!e.length){let a=JSON.stringify(r,null,o?" ".repeat(i):"	");return[{content:a,length:a.length,offset:0}]}return Ug(t,e,r,{tabSize:i,insertSpaces:o,eol:s})}_formattingOptions;get formattingOptions(){if(!this._formattingOptions){let t=xt===3||xt===2?`
`:`\r
`,e=this.configurationService.getValue("files.eol",{overrideIdentifier:"jsonc"});e&&typeof e=="string"&&e!=="auto"&&(t=e),this._formattingOptions={eol:t,insertSpaces:!!this.configurationService.getValue("editor.insertSpaces",{overrideIdentifier:"jsonc"}),tabSize:this.configurationService.getValue("editor.tabSize",{overrideIdentifier:"jsonc"})}}return this._formattingOptions}};import*as xx from"fs";import*as vt from"os";var Sx=new Map;async function Kv(n,t){let e=`${n}::${t.join(":")}`,r=Sx.get(e);if(r)return r;let i=[{tag:"grunt.js",filePattern:/^gruntfile\.js$/i},{tag:"gulp.js",filePattern:/^gulpfile\.js$/i},{tag:"tsconfig.json",filePattern:/^tsconfig\.json$/i},{tag:"package.json",filePattern:/^package\.json$/i},{tag:"jsconfig.json",filePattern:/^jsconfig\.json$/i},{tag:"tslint.json",filePattern:/^tslint\.json$/i},{tag:"eslint.json",filePattern:/^eslint\.json$/i},{tag:"tasks.json",filePattern:/^tasks\.json$/i},{tag:"launch.json",filePattern:/^launch\.json$/i},{tag:"settings.json",filePattern:/^settings\.json$/i},{tag:"webpack.config.js",filePattern:/^webpack\.config\.js$/i},{tag:"project.json",filePattern:/^project\.json$/i},{tag:"makefile",filePattern:/^makefile$/i},{tag:"sln",filePattern:/^.+\.sln$/i},{tag:"csproj",filePattern:/^.+\.csproj$/i},{tag:"cmake",filePattern:/^.+\.cmake$/i},{tag:"github-actions",filePattern:/^.+\.ya?ml$/i,relativePathPattern:/^\.github(?:\/|\\)workflows$/i},{tag:"devcontainer.json",filePattern:/^devcontainer\.json$/i},{tag:"dockerfile",filePattern:/^(dockerfile|docker\-compose\.ya?ml)$/i},{tag:"cursorrules",filePattern:/^\.cursorrules$/i}],o=new Map,s=new Map,a=2e4;function l(d,u,m,h){let y=u.substring(d.length+1);return Xe.withAsyncBody(async v=>{let b;h.readdirCount++;try{b=await q.readdir(u,{withFileTypes:!0})}catch{v();return}if(h.count>=a){h.count+=b.length,h.maxReached=!0,v();return}let C=b.length;if(C===0){v();return}let k=b;h.count+b.length>a&&(h.maxReached=!0,C=a-h.count,k=b.slice(0,C)),h.count+=b.length;for(let _ of k)if(_.isDirectory()){if(m.includes(_.name)||await l(d,V(u,_.name),m,h),--C===0){v();return}}else{let T=_.name.lastIndexOf(".");if(T>=0){let N=_.name.substring(T+1);N&&o.set(N,(o.get(N)??0)+1)}for(let N of i)N.relativePathPattern?.test(y)!==!1&&N.filePattern.test(_.name)&&s.set(N.tag,(s.get(N.tag)??0)+1);if(--C===0){v();return}}})}let c=Xe.withAsyncBody(async d=>{let u={count:0,maxReached:!1,readdirCount:0},m=new yr(!0);await l(n,n,t,u);let h=await H_(n);d({configFiles:Hv(s),fileTypes:Hv(o),fileCount:u.count,maxFilesReached:u.maxReached,launchConfigFiles:h,totalScanTime:m.elapsed(),totalReaddirCount:u.readdirCount})});return Sx.set(e,c),c}function Hv(n){return Array.from(n.entries(),([t,e])=>({name:t,count:e})).sort((t,e)=>e.count-t.count)}function K_(){let n={os:`${vt.type()} ${vt.arch()} ${vt.release()}`,memory:`${(vt.totalmem()/Ln.GB).toFixed(2)}GB (${(vt.freemem()/Ln.GB).toFixed(2)}GB free)`,vmHint:`${Math.round(zc.value()*100)}%`},t=vt.cpus();return t&&t.length>0&&(n.cpus=`${t[0].model} (${t.length} x ${t[0].speed})`),n}async function H_(n){try{let t=new Map,e=V(n,".vscode","launch.json"),r=await xx.promises.readFile(e),i=[],o=Yr(r.toString(),i);if(i.length)return console.log(`Unable to parse ${e}`),[];if(zi(o)==="object"&&o.configurations)for(let s of o.configurations){let a=s.type;a&&(t.has(a)?t.set(a,t.get(a)+1):t.set(a,1))}return Hv(t)}catch{return[]}}var rl=class{constructor(t,e){this.telemetryService=t;this.productService=e}formatMachineInfo(t){let e=[];return e.push(`OS Version:       ${t.os}`),e.push(`CPUs:             ${t.cpus}`),e.push(`Memory (System):  ${t.memory}`),e.push(`VM:               ${t.vmHint}`),e.join(`
`)}formatEnvironment(t){let e=[];e.push(`Version:          ${this.productService.nameShort} ${this.productService.version} (${this.productService.commit||"Commit unknown"}, ${this.productService.date||"Date unknown"})`),e.push(`OS Version:       ${vt.type()} ${vt.arch()} ${vt.release()}`);let r=vt.cpus();return r&&r.length>0&&e.push(`CPUs:             ${r[0].model} (${r.length} x ${r[0].speed})`),e.push(`Memory (System):  ${(vt.totalmem()/Ln.GB).toFixed(2)}GB (${(vt.freemem()/Ln.GB).toFixed(2)}GB free)`),U||e.push(`Load (avg):       ${vt.loadavg().map(i=>Math.round(i)).join(", ")}`),e.push(`VM:               ${Math.round(zc.value()*100)}%`),e.push(`Screen Reader:    ${t.screenReader?"yes":"no"}`),e.push(`Process Argv:     ${t.mainArguments.join(" ")}`),e.push(`GPU Status:       ${this.expandGPUFeatures(t.gpuFeatureStatus)}`),e.join(`
`)}async getPerformanceInfo(t,e){return Promise.all([Jc(t.mainPID),this.formatWorkspaceMetadata(t)]).then(async r=>{let[i,o]=r,s=this.formatProcessList(t,i);return e.forEach(a=>{if(Ac(a))s+=`
${a.errorMessage}`,o+=`
${a.errorMessage}`;else if(s+=`

Remote: ${a.hostName}`,a.processes&&(s+=`
${this.formatProcessList(t,a.processes)}`),a.workspaceMetadata){o+=`
|  Remote: ${a.hostName}`;for(let l of Object.keys(a.workspaceMetadata)){let c=a.workspaceMetadata[l],d=`${c.fileCount} files`;c.maxFilesReached&&(d=`more than ${d}`),o+=`|    Folder (${l}): ${d}`,o+=this.formatWorkspaceStats(c)}}}),{processInfo:s,workspaceInfo:o}})}async getSystemInfo(t,e){let{memory:r,vmHint:i,os:o,cpus:s}=K_(),a={os:o,memory:r,cpus:s,vmHint:i,processArgs:`${t.mainArguments.join(" ")}`,gpuStatus:t.gpuFeatureStatus,screenReader:`${t.screenReader?"yes":"no"}`,remoteData:e};return U||(a.load=`${vt.loadavg().map(l=>Math.round(l)).join(", ")}`),Q&&(a.linuxEnv={desktopSession:process.env.DESKTOP_SESSION,xdgSessionDesktop:process.env.XDG_SESSION_DESKTOP,xdgCurrentDesktop:process.env.XDG_CURRENT_DESKTOP,xdgSessionType:process.env.XDG_SESSION_TYPE}),Promise.resolve(a)}async getDiagnostics(t,e){let r=[];return Jc(t.mainPID).then(async i=>(r.push(""),r.push(this.formatEnvironment(t)),r.push(""),r.push(this.formatProcessList(t,i)),t.windows.some(o=>o.folderURIs&&o.folderURIs.length>0&&!o.remoteAuthority)&&(r.push(""),r.push("Workspace Stats: "),r.push(await this.formatWorkspaceMetadata(t))),e.forEach(o=>{if(Ac(o))r.push(`
${o.errorMessage}`);else if(r.push(`

`),r.push(`Remote:           ${o.hostName}`),r.push(this.formatMachineInfo(o.machineInfo)),o.processes&&r.push(this.formatProcessList(t,o.processes)),o.workspaceMetadata)for(let s of Object.keys(o.workspaceMetadata)){let a=o.workspaceMetadata[s],l=`${a.fileCount} files`;a.maxFilesReached&&(l=`more than ${l}`),r.push(`Folder (${s}): ${l}`),r.push(this.formatWorkspaceStats(a))}}),r.push(""),r.push(""),r.join(`
`)))}formatWorkspaceStats(t){let e=[],i=0,o=(c,d)=>{let u=` ${c}(${d})`;i+u.length>60?(e.push(s),s="|                 ",i=s.length):i+=u.length,s+=u},s="|      File types:",a=10,l=t.fileTypes.length>a?a:t.fileTypes.length;for(let c=0;c<l;c++){let d=t.fileTypes[c];o(d.name,d.count)}if(e.push(s),t.configFiles.length>=0&&(s="|      Conf files:",i=0,t.configFiles.forEach(c=>{o(c.name,c.count)}),e.push(s)),t.launchConfigFiles.length>0){let c="|      Launch Configs:";t.launchConfigFiles.forEach(d=>{let u=d.count>1?` ${d.name}(${d.count})`:` ${d.name}`;c+=u}),e.push(c)}return e.join(`
`)}expandGPUFeatures(t){let e=Math.max(...Object.keys(t).map(r=>r.length));return Object.keys(t).map(r=>`${r}:  ${" ".repeat(e-r.length)}  ${t[r]}`).join(`
                  `)}formatWorkspaceMetadata(t){let e=[],r=[];return t.windows.forEach(i=>{i.folderURIs.length===0||i.remoteAuthority||(e.push(`|  Window (${i.title})`),i.folderURIs.forEach(o=>{let s=x.revive(o);if(s.scheme===L.file){let a=s.fsPath;r.push(Kv(a,["node_modules",".git"]).then(l=>{let c=`${l.fileCount} files`;l.maxFilesReached&&(c=`more than ${c}`),e.push(`|    Folder (${pe(a)}): ${c}`),e.push(this.formatWorkspaceStats(l))}).catch(l=>{e.push(`|      Error: Unable to collect workspace stats for folder ${a} (${l.toString()})`)}))}else e.push(`|    Folder (${s.toString()}): Workspace stats not available.`)}))}),Promise.all(r).then(i=>e.join(`
`)).catch(i=>`Unable to collect workspace stats: ${i}`)}formatProcessList(t,e){let r=new Map;t.windows.forEach(o=>r.set(o.pid,`window [${o.id}] (${o.title})`)),t.pidToNames.forEach(({pid:o,name:s})=>r.set(o,s));let i=[];return i.push("CPU %	Mem MB	   PID	Process"),e&&this.formatProcessItem(t.mainPID,r,i,e,0),i.join(`
`)}formatProcessItem(t,e,r,i,o){let s=o===0,a;s?a=i.pid===t?`${this.productService.applicationName} main`:"remote agent":e.has(i.pid)?a=e.get(i.pid):a=`${"  ".repeat(o)} ${i.name}`;let l=process.platform==="win32"?i.mem:vt.totalmem()*(i.mem/100);r.push(`${i.load.toFixed(0).padStart(5," ")}	${(l/Ln.MB).toFixed(0).padStart(6," ")}	${i.pid.toFixed(0).padStart(6," ")}	${a}`),Array.isArray(i.children)&&i.children.forEach(c=>this.formatProcessItem(t,e,r,c,o+1))}async getWorkspaceFileExtensions(t){let e=new Set;for(let{uri:r}of t.folders){let i=x.revive(r);if(i.scheme!==L.file)continue;let o=i.fsPath;try{(await Kv(o,["node_modules",".git"])).fileTypes.forEach(a=>e.add(a.name))}catch{}}return{extensions:[...e]}}async reportWorkspaceStats(t){for(let{uri:e}of t.folders){let r=x.revive(e);if(r.scheme!==L.file)continue;let i=r.fsPath;try{let o=await Kv(i,["node_modules",".git"]);this.telemetryService.publicLog2("workspace.stats",{"workspace.id":t.telemetryId,rendererSessionId:t.rendererSessionId}),o.fileTypes.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.file",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),o.launchConfigFiles.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.launchConfigFile",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),o.configFiles.forEach(s=>{this.telemetryService.publicLog2("workspace.stats.configFiles",{rendererSessionId:t.rendererSessionId,type:s.name,count:s.count})}),this.telemetryService.publicLog2("workspace.stats.metadata",{duration:o.totalScanTime,reachedLimit:o.maxFilesReached,fileCount:o.fileCount,readdirCount:o.totalReaddirCount})}catch{}}}};rl=P([g(0,Ve),g(1,be)],rl);import{writeFileSync as z_}from"fs";import{tmpdir as q_}from"os";function Ex(n){let t=bs(q_());try{return z_(t,""),n&&console.log(`Marker file for --wait created: ${t}`),t}catch(e){n&&console.error(`Failed to create marker file for --wait: ${e}`);return}}var co=class extends D{constructor(e){super();this.logService=e}BUFFER_SIZE=256*1024;_onDidChangeFileSystemProviderRegistrations=this._register(new S);onDidChangeFileSystemProviderRegistrations=this._onDidChangeFileSystemProviderRegistrations.event;_onWillActivateFileSystemProvider=this._register(new S);onWillActivateFileSystemProvider=this._onWillActivateFileSystemProvider.event;_onDidChangeFileSystemProviderCapabilities=this._register(new S);onDidChangeFileSystemProviderCapabilities=this._onDidChangeFileSystemProviderCapabilities.event;provider=new Map;registerProvider(e,r){if(this.provider.has(e))throw new Error(`A filesystem provider for the scheme '${e}' is already registered.`);gt(`code/registerFilesystem/${e}`);let i=new Y;return this.provider.set(e,r),this._onDidChangeFileSystemProviderRegistrations.fire({added:!0,scheme:e,provider:r}),i.add(r.onDidChangeFile(o=>{let s=new Xu(o,!this.isPathCaseSensitive(r));this.internalOnDidFilesChange.fire(s),s.hasCorrelation()||this._onDidUncorrelatedFilesChange.fire(s)})),typeof r.onDidWatchError=="function"&&i.add(r.onDidWatchError(o=>this._onDidWatchError.fire(new Error(o)))),i.add(r.onDidChangeCapabilities(()=>this._onDidChangeFileSystemProviderCapabilities.fire({provider:r,scheme:e}))),$(()=>{this._onDidChangeFileSystemProviderRegistrations.fire({added:!1,scheme:e,provider:r}),this.provider.delete(e),ze(i)})}getProvider(e){return this.provider.get(e)}async activateProvider(e){let r=[];this._onWillActivateFileSystemProvider.fire({scheme:e,join(i){r.push(i)}}),!this.provider.has(e)&&await Xe.settled(r)}async canHandleResource(e){return await this.activateProvider(e.scheme),this.hasProvider(e)}hasProvider(e){return this.provider.has(e.scheme)}hasCapability(e,r){let i=this.provider.get(e.scheme);return!!(i&&i.capabilities&r)}listCapabilities(){return jr.map(this.provider,([e,r])=>({scheme:e,capabilities:r.capabilities}))}async withProvider(e){if(!CI(e))throw new Lt(p("invalidPath","Unable to resolve filesystem provider with relative file path '{0}'",this.resourceForError(e)),8);await this.activateProvider(e.scheme);let r=this.provider.get(e.scheme);if(!r){let i=new rn;throw i.message=p("noProviderFound","ENOPRO: No file system provider found for resource '{0}'",e.toString()),i}return r}async withReadProvider(e){let r=await this.withProvider(e);if(ai(r)||Nr(r)||ep(r))return r;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite, FileReadStream nor FileOpenReadWriteClose capability which is needed for the read operation.`)}async withWriteProvider(e){let r=await this.withProvider(e);if(ai(r)||Nr(r))return r;throw new Error(`Filesystem provider for scheme '${e.scheme}' neither has FileReadWrite nor FileOpenReadWriteClose capability which is needed for the write operation.`)}_onDidRunOperation=this._register(new S);onDidRunOperation=this._onDidRunOperation.event;async resolve(e,r){try{return await this.doResolveFile(e,r)}catch(i){throw hc(i)==="EntryNotFound"?new Lt(p("fileNotFoundError","Unable to resolve nonexistent file '{0}'",this.resourceForError(e)),1):li(i)}}async doResolveFile(e,r){let i=await this.withProvider(e),o=this.isPathCaseSensitive(i),s=r?.resolveTo,a=r?.resolveSingleChildDescendants,l=r?.resolveMetadata,c=await i.stat(e),d;return this.toFileStat(i,e,c,void 0,!!l,(u,m)=>(d||(d=lr.forUris(()=>!o),d.set(e,!0),s&&d.fill(!0,s)),d.get(u.resource)||d.findSuperstr(u.resource.with({query:null,fragment:null}))?!0:u.isDirectory&&a?m===1:!1))}async toFileStat(e,r,i,o,s,a){let{providerExtUri:l}=this.getExtUri(e),c={resource:r,name:l.basename(r),isFile:(i.type&1)!==0,isDirectory:(i.type&2)!==0,isSymbolicLink:(i.type&64)!==0,mtime:i.mtime,ctime:i.ctime,size:i.size,readonly:!!((i.permissions??0)&1)||!!(e.capabilities&2048),locked:!!((i.permissions??0)&2),etag:ag({mtime:i.mtime,size:i.size}),children:void 0};if(c.isDirectory&&a(c,o)){try{let d=await e.readdir(r),u=await Xe.settled(d.map(async([m,h])=>{try{let y=l.joinPath(r,m),v=s?await e.stat(y):{type:h};return await this.toFileStat(e,y,v,d.length,s,a)}catch(y){return this.logService.trace(y),null}}));c.children=Ye(u)}catch(d){this.logService.trace(d),c.children=[]}return c}return c}async resolveAll(e){return Xe.settled(e.map(async r=>{try{return{stat:await this.doResolveFile(r.resource,r.options),success:!0}}catch(i){return this.logService.trace(i),{stat:void 0,success:!1}}}))}async stat(e){let r=await this.withProvider(e),i=await r.stat(e);return this.toFileStat(r,e,i,void 0,!0,()=>!1)}async exists(e){let r=await this.withProvider(e);try{return!!await r.stat(e)}catch{return!1}}async canCreateFile(e,r){try{await this.doValidateCreateFile(e,r)}catch(i){return i}return!0}async doValidateCreateFile(e,r){if(!r?.overwrite&&await this.exists(e))throw new Lt(p("fileExists","Unable to create file '{0}' that already exists when overwrite flag is not set",this.resourceForError(e)),3,r)}async createFile(e,r=K.fromString(""),i){await this.doValidateCreateFile(e,i);let o=await this.writeFile(e,r);return this._onDidRunOperation.fire(new si(e,0,o)),o}async writeFile(e,r,i){let o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),{providerExtUri:s}=this.getExtUri(o),a=i;if(sg(o)&&!a?.atomic){let l=o.enforceAtomicWriteFile?.(e);l&&(a={...i,atomic:l})}try{await this.validateWriteFile(o,e,a)||await this.mkdirp(o,s.dirname(e));let c;if(Nr(o)&&!(r instanceof K))if(Vl(r)){let d=await ib(r,3);d.ended?c=K.concat(d.buffer):c=d}else c=nb(r,d=>K.concat(d),3);else c=r;!ai(o)||Nr(o)&&c instanceof K||Nr(o)&&sg(o)&&a?.atomic?await this.doWriteUnbuffered(o,e,a,c):await this.doWriteBuffered(o,e,a,c instanceof K?ab(c):c),this._onDidRunOperation.fire(new si(e,4))}catch(l){throw new Lt(p("err.write","Unable to write file '{0}' ({1})",this.resourceForError(e),li(l).toString()),Sr(l),a)}return this.resolve(e,{resolveMetadata:!0})}async validateWriteFile(e,r,i){let o=!!i?.unlock;if(o&&!(e.capabilities&8192))throw new Error(p("writeFailedUnlockUnsupported","Unable to unlock file '{0}' because provider does not support it.",this.resourceForError(r)));if(!!i?.atomic){if(!(e.capabilities&32768))throw new Error(p("writeFailedAtomicUnsupported1","Unable to atomically write file '{0}' because provider does not support it.",this.resourceForError(r)));if(!(e.capabilities&2))throw new Error(p("writeFailedAtomicUnsupported2","Unable to atomically write file '{0}' because provider does not support unbuffered writes.",this.resourceForError(r)));if(o)throw new Error(p("writeFailedAtomicUnlock","Unable to unlock file '{0}' because atomic write is enabled.",this.resourceForError(r)))}let a;try{a=await e.stat(r)}catch{return}if(a.type&2)throw new Lt(p("fileIsDirectoryWriteError","Unable to write file '{0}' that is actually a directory",this.resourceForError(r)),0,i);if(this.throwIfFileIsReadonly(r,a),typeof i?.mtime=="number"&&typeof i.etag=="string"&&i.etag!==np&&typeof a.mtime=="number"&&typeof a.size=="number"&&i.mtime<a.mtime&&i.etag!==ag({mtime:i.mtime,size:a.size}))throw new Lt(p("fileModifiedError","File Modified Since"),3,i);return a}async readFile(e,r,i){let o=await this.withReadProvider(e);return r?.atomic?this.doReadFileAtomic(o,e,r,i):this.doReadFile(o,e,r,i)}async doReadFileAtomic(e,r,i,o){return new Promise((s,a)=>{this.writeQueue.queueFor(r,async()=>{try{let l=await this.doReadFile(e,r,i,o);s(l)}catch(l){a(l)}},this.getExtUri(e).providerExtUri)})}async doReadFile(e,r,i,o){let s=await this.doReadFileStream(e,r,{...i,preferUnbuffered:!0},o);return{...s,value:await ii(s.value)}}async readFileStream(e,r,i){let o=await this.withReadProvider(e);return this.doReadFileStream(o,e,r,i)}async doReadFileStream(e,r,i,o){let s=new rt(o),a=i;tp(e)&&e.enforceAtomicReadFile?.(r)&&(a={...i,atomic:!0});let l=this.validateReadFile(r,a).then(d=>d,d=>{throw s.dispose(!0),d}),c;try{return typeof a?.etag=="string"&&a.etag!==np&&await l,a?.atomic&&tp(e)||!(ai(e)||ep(e))||Nr(e)&&a?.preferUnbuffered?c=this.readFileUnbuffered(e,r,a):ep(e)?c=this.readFileStreamed(e,r,s.token,a):c=this.readFileBuffered(e,r,s.token,a),c.on("end",()=>s.dispose()),c.on("error",()=>s.dispose()),{...await l,value:c}}catch(d){throw c&&await Pu(c),this.restoreReadError(d,r,a)}}restoreReadError(e,r,i){let o=p("err.read","Unable to read file '{0}' ({1})",this.resourceForError(r),li(e).toString());return e instanceof Ks?new Ks(o,e.stat,i):e instanceof Vs?new Vs(o,e.fileOperationResult,e.size,e.options):new Lt(o,Sr(e),i)}readFileStreamed(e,r,i,o=Object.create(null)){let s=e.readFileStream(r,o,i);return Tu(s,{data:a=>a instanceof K?a:K.wrap(a),error:a=>this.restoreReadError(a,r,o)},a=>K.concat(a))}readFileBuffered(e,r,i,o=Object.create(null)){let s=db();return of(e,r,s,a=>a,{...o,bufferSize:this.BUFFER_SIZE,errorTransformer:a=>this.restoreReadError(a,r,o)},i),s}readFileUnbuffered(e,r,i){let o=Di(s=>K.concat(s));return(async()=>{try{let s;i?.atomic&&tp(e)?s=await e.readFile(r,{atomic:!0}):s=await e.readFile(r),typeof i?.position=="number"&&(s=s.slice(i.position)),typeof i?.length=="number"&&(s=s.slice(0,i.length)),this.validateReadFileLimits(r,s.byteLength,i),o.end(K.wrap(s))}catch(s){o.error(s),o.end()}})(),o}async validateReadFile(e,r){let i=await this.resolve(e,{resolveMetadata:!0});if(i.isDirectory)throw new Lt(p("fileIsDirectoryReadError","Unable to read file '{0}' that is actually a directory",this.resourceForError(e)),0,r);if(typeof r?.etag=="string"&&r.etag!==np&&r.etag===i.etag)throw new Ks(p("fileNotModifiedError","File not modified since"),i,r);return this.validateReadFileLimits(e,i.size,r),i}validateReadFileLimits(e,r,i){if(typeof i?.limits?.size=="number"&&r>i.limits.size)throw new Vs(p("fileTooLargeError","Unable to read file '{0}' that is too large to open",this.resourceForError(e)),7,r,i)}async canMove(e,r,i){return this.doCanMoveCopy(e,r,"move",i)}async canCopy(e,r,i){return this.doCanMoveCopy(e,r,"copy",i)}async doCanMoveCopy(e,r,i,o){if(e.toString()!==r.toString())try{let s=i==="move"?this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e):await this.withReadProvider(e),a=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(r),r);await this.doValidateMoveCopy(s,e,a,r,i,o)}catch(s){return s}return!0}async move(e,r,i){let o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(e),e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(r),r),a=await this.doMoveCopy(o,e,s,r,"move",!!i),l=await this.resolve(r,{resolveMetadata:!0});return this._onDidRunOperation.fire(new si(e,a==="move"?2:3,l)),l}async copy(e,r,i){let o=await this.withReadProvider(e),s=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(r),r),a=await this.doMoveCopy(o,e,s,r,"copy",!!i),l=await this.resolve(r,{resolveMetadata:!0});return this._onDidRunOperation.fire(new si(e,a==="copy"?3:2,l)),l}async doMoveCopy(e,r,i,o,s,a){if(r.toString()===o.toString())return s;let{exists:l,isSameResourceWithDifferentPathCase:c}=await this.doValidateMoveCopy(e,r,i,o,s,a);if(l&&!c&&a&&await this.del(o,{recursive:!0}),await this.mkdirp(i,this.getExtUri(i).providerExtUri.dirname(o)),s==="copy"){if(e===i&&mc(e))await e.copy(r,o,{overwrite:a});else{let d=await this.resolve(r);d.isDirectory?await this.doCopyFolder(e,d,i,o):await this.doCopyFile(e,r,i,o)}return s}else return e===i?(await e.rename(r,o,{overwrite:a}),s):(await this.doMoveCopy(e,r,i,o,"copy",a),await this.del(r,{recursive:!0}),"copy")}async doCopyFile(e,r,i,o){if(ai(e)&&ai(i))return this.doPipeBuffered(e,r,i,o);if(ai(e)&&Nr(i))return this.doPipeBufferedToUnbuffered(e,r,i,o);if(Nr(e)&&ai(i))return this.doPipeUnbufferedToBuffered(e,r,i,o);if(Nr(e)&&Nr(i))return this.doPipeUnbuffered(e,r,i,o)}async doCopyFolder(e,r,i,o){await i.mkdir(o),Array.isArray(r.children)&&await Xe.settled(r.children.map(async s=>{let a=this.getExtUri(i).providerExtUri.joinPath(o,s.name);return s.isDirectory?this.doCopyFolder(e,await this.resolve(s.resource),i,a):this.doCopyFile(e,s.resource,i,a)}))}async doValidateMoveCopy(e,r,i,o,s,a){let l=!1;if(e===i){let{providerExtUri:d,isPathCaseSensitive:u}=this.getExtUri(e);if(u||(l=d.isEqual(r,o)),l&&s==="copy")throw new Error(p("unableToMoveCopyError1","Unable to copy when source '{0}' is same as target '{1}' with different path case on a case insensitive file system",this.resourceForError(r),this.resourceForError(o)));if(!l&&d.isEqualOrParent(o,r))throw new Error(p("unableToMoveCopyError2","Unable to move/copy when source '{0}' is parent of target '{1}'.",this.resourceForError(r),this.resourceForError(o)))}let c=await this.exists(o);if(c&&!l){if(!a)throw new Lt(p("unableToMoveCopyError3","Unable to move/copy '{0}' because target '{1}' already exists at destination.",this.resourceForError(r),this.resourceForError(o)),4);if(e===i){let{providerExtUri:d}=this.getExtUri(e);if(d.isEqualOrParent(r,o))throw new Error(p("unableToMoveCopyError4","Unable to move/copy '{0}' into '{1}' since a file would replace the folder it is contained in.",this.resourceForError(r),this.resourceForError(o)))}}return{exists:c,isSameResourceWithDifferentPathCase:l}}getExtUri(e){let r=this.isPathCaseSensitive(e);return{providerExtUri:r?Se:eu,isPathCaseSensitive:r}}isPathCaseSensitive(e){return!!(e.capabilities&1024)}async createFolder(e){let r=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e);await this.mkdirp(r,e);let i=await this.resolve(e,{resolveMetadata:!0});return this._onDidRunOperation.fire(new si(e,0,i)),i}async mkdirp(e,r){let i=[],{providerExtUri:o}=this.getExtUri(e);for(;!o.isEqual(r,o.dirname(r));)try{if(!((await e.stat(r)).type&2))throw new Error(p("mkdirExistsError","Unable to create folder '{0}' that already exists but is not a directory",this.resourceForError(r)));break}catch(s){if(hc(s)!=="EntryNotFound")throw s;i.push(o.basename(r)),r=o.dirname(r)}for(let s=i.length-1;s>=0;s--){r=o.joinPath(r,i[s]);try{await e.mkdir(r)}catch(a){if(hc(a)!=="EntryExists")throw a}}}async canDelete(e,r){try{await this.doValidateDelete(e,r)}catch(i){return i}return!0}async doValidateDelete(e,r){let i=this.throwIfFileSystemIsReadonly(await this.withProvider(e),e),o=!!r?.useTrash;if(o&&!(i.capabilities&4096))throw new Error(p("deleteFailedTrashUnsupported","Unable to delete file '{0}' via trash because provider does not support it.",this.resourceForError(e)));let s=r?.atomic;if(s&&!(i.capabilities&65536))throw new Error(p("deleteFailedAtomicUnsupported","Unable to delete file '{0}' atomically because provider does not support it.",this.resourceForError(e)));if(o&&s)throw new Error(p("deleteFailedTrashAndAtomicUnsupported","Unable to atomically delete file '{0}' because using trash is enabled.",this.resourceForError(e)));let a;try{a=await i.stat(e)}catch{}if(a)this.throwIfFileIsReadonly(e,a);else throw new Lt(p("deleteFailedNotFound","Unable to delete nonexistent file '{0}'",this.resourceForError(e)),1);if(!!!r?.recursive){let c=await this.resolve(e);if(c.isDirectory&&Array.isArray(c.children)&&c.children.length>0)throw new Error(p("deleteFailedNonEmptyFolder","Unable to delete non-empty folder '{0}'.",this.resourceForError(e)))}return i}async del(e,r){let i=await this.doValidateDelete(e,r),o=r;if(uw(i)&&!o?.atomic){let c=i.enforceAtomicDelete?.(e);c&&(o={...r,atomic:c})}let s=!!o?.useTrash,a=!!o?.recursive,l=o?.atomic??!1;await i.delete(e,{recursive:a,useTrash:s,atomic:l}),this._onDidRunOperation.fire(new si(e,1))}async cloneFile(e,r){let i=await this.withProvider(e),o=this.throwIfFileSystemIsReadonly(await this.withWriteProvider(r),r);if(!(i===o&&this.getExtUri(i).providerExtUri.isEqual(e,r)))return i===o&&Zu(i)?i.cloneFile(e,r):(await this.mkdirp(o,this.getExtUri(o).providerExtUri.dirname(r)),i===o&&mc(i)?this.writeQueue.queueFor(e,()=>i.copy(e,r,{overwrite:!0}),this.getExtUri(i).providerExtUri):this.writeQueue.queueFor(e,()=>this.doCopyFile(i,e,o,r),this.getExtUri(i).providerExtUri))}internalOnDidFilesChange=this._register(new S);_onDidUncorrelatedFilesChange=this._register(new S);onDidFilesChange=this._onDidUncorrelatedFilesChange.event;_onDidWatchError=this._register(new S);onDidWatchError=this._onDidWatchError.event;activeWatchers=new Map;static WATCHER_CORRELATION_IDS=0;createWatcher(e,r){return this.watch(e,{...r,correlationId:co.WATCHER_CORRELATION_IDS++})}watch(e,r={recursive:!1,excludes:[]}){let i=new Y,o=!1,s=()=>{o=!0};i.add($(()=>s())),(async()=>{try{let l=await this.doWatch(e,r);o?ze(l):s=()=>ze(l)}catch(l){this.logService.error(l)}})();let a=r.correlationId;if(typeof a=="number"){let l=i.add(new S);return i.add(this.internalOnDidFilesChange.event(d=>{d.correlates(a)&&l.fire(d)})),{onDidChange:l.event,dispose:()=>i.dispose()}}return i}async doWatch(e,r){let i=await this.withProvider(e),o=qt([this.getExtUri(i).providerExtUri.getComparisonKey(e),r]),s=this.activeWatchers.get(o);return s||(s={count:0,disposable:i.watch(e,r)},this.activeWatchers.set(o,s)),s.count+=1,$(()=>{s&&(s.count--,s.count===0&&(ze(s.disposable),this.activeWatchers.delete(o)))})}dispose(){super.dispose();for(let[,e]of this.activeWatchers)ze(e.disposable);this.activeWatchers.clear()}writeQueue=this._register(new Es);async doWriteBuffered(e,r,i,o){return this.writeQueue.queueFor(r,async()=>{let s=await e.open(r,{create:!0,unlock:i?.unlock??!1});try{Vl(o)||Eu(o)?await this.doWriteStreamBufferedQueued(e,s,o):await this.doWriteReadableBufferedQueued(e,s,o)}catch(a){throw li(a)}finally{await e.close(s)}},this.getExtUri(e).providerExtUri)}async doWriteStreamBufferedQueued(e,r,i){let o=0,s;if(Eu(i)){if(i.buffer.length>0){let a=K.concat(i.buffer);await this.doWriteBuffer(e,r,a,a.byteLength,o,0),o+=a.byteLength}if(i.ended)return;s=i.stream}else s=i;return new Promise((a,l)=>{Ts(s,{onData:async c=>{s.pause();try{await this.doWriteBuffer(e,r,c,c.byteLength,o,0)}catch(d){return l(d)}o+=c.byteLength,setTimeout(()=>s.resume())},onError:c=>l(c),onEnd:()=>a()})})}async doWriteReadableBufferedQueued(e,r,i){let o=0,s;for(;(s=i.read())!==null;)await this.doWriteBuffer(e,r,s,s.byteLength,o,0),o+=s.byteLength}async doWriteBuffer(e,r,i,o,s,a){let l=0;for(;l<o;){let c=await e.write(r,s+l,i.buffer,a+l,o-l);l+=c}}async doWriteUnbuffered(e,r,i,o){return this.writeQueue.queueFor(r,()=>this.doWriteUnbufferedQueued(e,r,i,o),this.getExtUri(e).providerExtUri)}async doWriteUnbufferedQueued(e,r,i,o){let s;o instanceof K?s=o:Vl(o)?s=await ii(o):Eu(o)?s=await lb(o):s=sb(o),await e.writeFile(r,s.buffer,{create:!0,overwrite:!0,unlock:i?.unlock??!1,atomic:i?.atomic??!1})}async doPipeBuffered(e,r,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeBufferedQueued(e,r,i,o),this.getExtUri(i).providerExtUri)}async doPipeBufferedQueued(e,r,i,o){let s,a;try{s=await e.open(r,{create:!1}),a=await i.open(o,{create:!0,unlock:!1});let l=K.alloc(this.BUFFER_SIZE),c=0,d=0,u=0;do u=await e.read(s,c,l.buffer,d,l.byteLength-d),await this.doWriteBuffer(i,a,l,u,c,d),c+=u,d+=u,d===l.byteLength&&(d=0);while(u>0)}catch(l){throw li(l)}finally{await Xe.settled([typeof s=="number"?e.close(s):Promise.resolve(),typeof a=="number"?i.close(a):Promise.resolve()])}}async doPipeUnbuffered(e,r,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeUnbufferedQueued(e,r,i,o),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedQueued(e,r,i,o){return i.writeFile(o,await e.readFile(r),{create:!0,overwrite:!0,unlock:!1,atomic:!1})}async doPipeUnbufferedToBuffered(e,r,i,o){return this.writeQueue.queueFor(o,()=>this.doPipeUnbufferedToBufferedQueued(e,r,i,o),this.getExtUri(i).providerExtUri)}async doPipeUnbufferedToBufferedQueued(e,r,i,o){let s=await i.open(o,{create:!0,unlock:!1});try{let a=await e.readFile(r);await this.doWriteBuffer(i,s,K.wrap(a),a.byteLength,0,0)}catch(a){throw li(a)}finally{await i.close(s)}}async doPipeBufferedToUnbuffered(e,r,i,o){let s=await ii(this.readFileBuffered(e,r,we.None));await this.doWriteUnbuffered(i,o,void 0,s)}throwIfFileSystemIsReadonly(e,r){if(e.capabilities&2048)throw new Lt(p("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(r)),6);return e}throwIfFileIsReadonly(e,r){if((r.permissions??0)&1)throw new Lt(p("err.readonly","Unable to modify read-only file '{0}'",this.resourceForError(e)),6)}resourceForError(e){return e.scheme===L.file?e.fsPath:e.toString(!0)}};co=P([g(0,A)],co);var zv=class{constructor(t,e){this.key=t;this.data=e}incoming=new Map;outgoing=new Map},id=class{constructor(t){this._hashFn=t}_nodes=new Map;roots(){let t=[];for(let e of this._nodes.values())e.outgoing.size===0&&t.push(e);return t}insertEdge(t,e){let r=this.lookupOrInsertNode(t),i=this.lookupOrInsertNode(e);r.outgoing.set(i.key,i),i.incoming.set(r.key,r)}removeNode(t){let e=this._hashFn(t);this._nodes.delete(e);for(let r of this._nodes.values())r.outgoing.delete(e),r.incoming.delete(e)}lookupOrInsertNode(t){let e=this._hashFn(t),r=this._nodes.get(e);return r||(r=new zv(e,t),this._nodes.set(e,r)),r}lookup(t){return this._nodes.get(this._hashFn(t))}isEmpty(){return this._nodes.size===0}toString(){let t=[];for(let[e,r]of this._nodes)t.push(`${e}
	(-> incoming)[${[...r.incoming.keys()].join(", ")}]
	(outgoing ->)[${[...r.outgoing.keys()].join(",")}]
`);return t.join(`
`)}findCycleSlow(){for(let[t,e]of this._nodes){let r=new Set([t]),i=this._findCycle(e,r);if(i)return i}}_findCycle(t,e){for(let[r,i]of t.outgoing){if(e.has(r))return[...e,r].join(" -> ");e.add(r);let o=this._findCycle(i,e);if(o)return o;e.delete(r)}}};var $_=!1,nm=class extends Error{constructor(t){super("cyclic dependency between services"),this.message=t.findCycleSlow()??`UNABLE to detect cycle, dumping graph: 
${t.toString()}`}},im=class n{constructor(t=new ki,e=!1,r,i=$_){this._services=t;this._strict=e;this._parent=r;this._enableTracing=i;this._services.set(Yt,this),this._globalGraph=i?r?._globalGraph??new id(o=>o):void 0}_globalGraph;_globalGraphImplicitDependency;_isDisposed=!1;_servicesToMaybeDispose=new Set;_children=new Set;dispose(){if(!this._isDisposed){this._isDisposed=!0,ze(this._children),this._children.clear();for(let t of this._servicesToMaybeDispose)Od(t)&&t.dispose();this._servicesToMaybeDispose.clear()}}_throwIfDisposed(){if(this._isDisposed)throw new Error("InstantiationService has been disposed")}createChild(t,e){this._throwIfDisposed();let r=this,i=new class extends n{dispose(){r._children.delete(i),super.dispose()}}(t,this._strict,this,this._enableTracing);return this._children.add(i),e?.add(i),i}invokeFunction(t,...e){this._throwIfDisposed();let r=od.traceInvocation(this._enableTracing,t),i=!1;try{return t({get:s=>{if(i)throw Cd("service accessor is only valid during the invocation of its target method");let a=this._getOrCreateServiceInstance(s,r);if(!a)throw new Error(`[invokeFunction] unknown service '${s}'`);return a}},...e)}finally{i=!0,r.stop()}}createInstance(t,...e){this._throwIfDisposed();let r,i;return t instanceof le?(r=od.traceCreation(this._enableTracing,t.ctor),i=this._createInstance(t.ctor,t.staticArguments.concat(e),r)):(r=od.traceCreation(this._enableTracing,t),i=this._createInstance(t,e,r)),r.stop(),i}_createInstance(t,e=[],r){let i=ln.getServiceDependencies(t).sort((a,l)=>a.index-l.index),o=[];for(let a of i){let l=this._getOrCreateServiceInstance(a.id,r);l||this._throwIfStrict(`[createInstance] ${t.name} depends on UNKNOWN service ${a.id}.`,!1),o.push(l)}let s=i.length>0?i[0].index:e.length;if(e.length!==s){console.trace(`[createInstance] First service dependency of ${t.name} at position ${s+1} conflicts with ${e.length} static arguments`);let a=s-e.length;a>0?e=e.concat(new Array(a)):e=e.slice(0,s)}return Reflect.construct(t,e.concat(o))}_setCreatedServiceInstance(t,e){if(this._services.get(t)instanceof le)this._services.set(t,e);else if(this._parent)this._parent._setCreatedServiceInstance(t,e);else throw new Error("illegalState - setting UNKNOWN service instance")}_getServiceInstanceOrDescriptor(t){let e=this._services.get(t);return!e&&this._parent?this._parent._getServiceInstanceOrDescriptor(t):e}_getOrCreateServiceInstance(t,e){this._globalGraph&&this._globalGraphImplicitDependency&&this._globalGraph.insertEdge(this._globalGraphImplicitDependency,String(t));let r=this._getServiceInstanceOrDescriptor(t);return r instanceof le?this._safeCreateAndCacheServiceInstance(t,r,e.branch(t,!0)):(e.branch(t,!1),r)}_activeInstantiations=new Set;_safeCreateAndCacheServiceInstance(t,e,r){if(this._activeInstantiations.has(t))throw new Error(`illegal state - RECURSIVELY instantiating service '${t}'`);this._activeInstantiations.add(t);try{return this._createAndCacheServiceInstance(t,e,r)}finally{this._activeInstantiations.delete(t)}}_createAndCacheServiceInstance(t,e,r){let i=new id(l=>l.id.toString()),o=0,s=[{id:t,desc:e,_trace:r}],a=new Set;for(;s.length;){let l=s.pop();if(!a.has(String(l.id))){if(a.add(String(l.id)),i.lookupOrInsertNode(l),o++>1e3)throw new nm(i);for(let c of ln.getServiceDependencies(l.desc.ctor)){let d=this._getServiceInstanceOrDescriptor(c.id);if(d||this._throwIfStrict(`[createInstance] ${t} depends on ${c.id} which is NOT registered.`,!0),this._globalGraph?.insertEdge(String(l.id),String(c.id)),d instanceof le){let u={id:c.id,desc:d,_trace:l._trace.branch(c.id,!0)};i.insertEdge(l,u),s.push(u)}}}}for(;;){let l=i.roots();if(l.length===0){if(!i.isEmpty())throw new nm(i);break}for(let{data:c}of l){if(this._getServiceInstanceOrDescriptor(c.id)instanceof le){let u=this._createServiceInstanceWithOwner(c.id,c.desc.ctor,c.desc.staticArguments,c.desc.supportsDelayedInstantiation,c._trace);this._setCreatedServiceInstance(c.id,u)}i.removeNode(c)}}return this._getServiceInstanceOrDescriptor(t)}_createServiceInstanceWithOwner(t,e,r=[],i,o){if(this._services.get(t)instanceof le)return this._createServiceInstance(t,e,r,i,o,this._servicesToMaybeDispose);if(this._parent)return this._parent._createServiceInstanceWithOwner(t,e,r,i,o);throw new Error(`illegalState - creating UNKNOWN service instance ${e.name}`)}_createServiceInstance(t,e,r=[],i,o,s){if(i){let a=new n(void 0,this._strict,this,this._enableTracing);a._globalGraphImplicitDependency=String(t);let l=new Map,c=new yu(()=>{let d=a._createInstance(e,r,o);for(let[u,m]of l){let h=d[u];if(typeof h=="function")for(let y of m)y.disposable=h.apply(d,y.listener)}return l.clear(),s.add(d),d});return new Proxy(Object.create(null),{get(d,u){if(!c.isInitialized&&typeof u=="string"&&(u.startsWith("onDid")||u.startsWith("onWill"))){let y=l.get(u);return y||(y=new Pi,l.set(u,y)),(b,C,k)=>{if(c.isInitialized)return c.value[u](b,C,k);{let _={listener:[b,C,k],disposable:void 0},T=y.push(_);return $(()=>{T(),_.disposable?.dispose()})}}}if(u in d)return d[u];let m=c.value,h=m[u];return typeof h!="function"||(h=h.bind(m),d[u]=h),h},set(d,u,m){return c.value[u]=m,!0},getPrototypeOf(d){return e.prototype}})}else{let a=this._createInstance(e,r,o);return s.add(a),a}}_throwIfStrict(t,e){if(e&&console.warn(t),this._strict)throw new Error(t)}};var od=class n{constructor(t,e){this.type=t;this.name=e}static all=new Set;static _None=new class extends n{constructor(){super(0,null)}stop(){}branch(){return this}};static traceInvocation(t,e){return t?new n(2,e.name||new Error().stack.split(`
`).slice(3,4).join(`
`)):n._None}static traceCreation(t,e){return t?new n(1,e.name):n._None}static _totals=0;_start=Date.now();_dep=[];branch(t,e){let r=new n(3,t.toString());return this._dep.push([t,e,r]),r}stop(){let t=Date.now()-this._start;n._totals+=t;let e=!1;function r(o,s){let a=[],l=new Array(o+1).join("	");for(let[c,d,u]of s._dep)if(d&&u){e=!0,a.push(`${l}CREATES -> ${c}`);let m=r(o+1,u);m&&a.push(m)}else a.push(`${l}uses -> ${c}`);return a.join(`
`)}let i=[`${this.type===1?"CREATE":"CALL"} ${this.name}`,`${r(1,this)}`,`DONE, took ${t.toFixed(2)}ms (grand total ${n._totals.toFixed(2)}ms)`];(t>2||e)&&n.all.add(i.join(`
`))}};var om=class extends Ao{buffer=[];_logger=void 0;constructor(t=pc){super(),this.setLevel(t),this._register(this.onDidChangeLogLevel(e=>{this._logger?.setLevel(e)}))}set logger(t){this._logger=t;for(let{level:e,message:r}of this.buffer)fc(t,e,r);this.buffer=[]}log(t,e){this._logger?fc(this._logger,t,e):this.getLevel()<=t&&this.buffer.push({level:t,message:e})}dispose(){this._logger?.dispose(),super.dispose()}flush(){this._logger?.flush()}};import{session as j_}from"electron";var nl=class extends D{constructor(e,r,i){super();this.environmentService=e;this.logService=i;this.addValidFileRoot(e.appRoot),this.addValidFileRoot(e.extensionsPath),this.addValidFileRoot(r.defaultProfile.globalStorageHome.with({scheme:L.file}).fsPath),this.addValidFileRoot(e.workspaceStorageHome.with({scheme:L.file}).fsPath),this.handleProtocols()}validRoots=lr.forPaths(!Q);validExtensions=new Set([".svg",".png",".jpg",".jpeg",".gif",".bmp",".webp",".mp4"]);handleProtocols(){let{defaultSession:e}=j_;e.protocol.registerFileProtocol(L.vscodeFileResource,(r,i)=>this.handleResourceRequest(r,i)),e.protocol.interceptFileProtocol(L.file,(r,i)=>this.handleFileRequest(r,i)),this._register($(()=>{e.protocol.unregisterProtocol(L.vscodeFileResource),e.protocol.uninterceptProtocol(L.file)}))}addValidFileRoot(e){let r=lt(e);return this.validRoots.get(r)?D.None:(this.validRoots.set(r,!0),$(()=>this.validRoots.delete(r)))}handleFileRequest(e,r){let i=x.parse(e.url);return this.logService.error(`Refused to load resource ${i.fsPath} from ${L.file}: protocol (original URL: ${e.url})`),r({error:-3})}handleResourceRequest(e,r){let i=this.requestToNormalizedFilePath(e),o;if(this.environmentService.crossOriginIsolated){let s=pe(i);s==="workbench.html"||s==="workbench-dev.html"||s==="workbench.esm.html"||s==="workbench-dev.esm.html"?o=ws.CoopAndCoep:o=ws.getHeadersFromQuery(e.url)}return this.validRoots.findSubstr(i)?r({path:i,headers:o}):this.validExtensions.has(ls(i).toLowerCase())?r({path:i}):(this.logService.error(`${L.vscodeFileResource}: Refused to load resource ${i} from ${L.vscodeFileResource}: protocol (original URL: ${e.url})`),r({error:-3}))}requestToNormalizedFilePath(e){let r=x.parse(e.url),i=Re.uriToFileUri(r);return lt(i.fsPath)}createIPCObjectUrl(){let e,r=x.from({scheme:"vscode",path:Ze()}),i=r.toString(),o=async()=>e;return _e.handle(i,o),this.logService.trace(`IPC Object URL: Registered new channel ${i}.`),{resource:r,update:s=>e=s,dispose:()=>{this.logService.trace(`IPC Object URL: Removed channel ${i}.`),_e.removeHandler(i)}}}};nl=P([g(0,br),g(1,jt),g(2,A)],nl);var bUe=F("remoteAuthorityResolverService");var sm=F("remoteSocketFactoryService");var i7e=30*1e3;function $v(n){switch(n){case 1:return"Management";case 2:return"ExtensionHost";case 3:return"Tunnel"}}function G_(n){let t=new rt;return setTimeout(()=>t.cancel(),n),t.token}function J_(n,t){if(n.isCancellationRequested||t.isCancellationRequested)return we.Cancelled;let e=new rt;return n.onCancellationRequested(()=>e.cancel()),t.onCancellationRequested(()=>e.cancel()),e.token}var sd=class{_state;_disposables;promise;_resolvePromise;_rejectPromise;get didTimeout(){return this._state==="timedout"}constructor(t){this._state="pending",this._disposables=new Y,{promise:this.promise,resolve:this._resolvePromise,reject:this._rejectPromise}=BI(),t.isCancellationRequested?this._timeout():this._disposables.add(t.onCancellationRequested(()=>this._timeout()))}registerDisposable(t){this._state==="pending"?this._disposables.add(t):t.dispose()}_timeout(){this._state==="pending"&&(this._disposables.dispose(),this._state="timedout",this._rejectPromise(this._createTimeoutError()))}_createTimeoutError(){let t=new Error("Time limit reached");return t.code="ETIMEDOUT",t.syscall="connect",t}resolve(t){this._state==="pending"&&(this._disposables.dispose(),this._state="resolved",this._resolvePromise(t))}reject(t){this._state==="pending"&&(this._disposables.dispose(),this._state="rejected",this._rejectPromise(t))}};function Q_(n,t){let e=new sd(t);return e.registerDisposable(n.onControlMessage(r=>{let i=JSON.parse(r.toString()),o=rR(i);o?e.reject(o):e.resolve(i)})),e.promise}function Y_(n,t,e,r,i,o,s,a){let l=new sd(a),c=yr.create(!1);return n.info(`Creating a socket (${s})...`),gt(`code/willCreateSocket/${o}`),t.connect(e,r,i,s).then(d=>{l.didTimeout?(gt(`code/didCreateSocketError/${o}`),n.info(`Creating a socket (${s}) finished after ${c.elapsed()} ms, but this is too late and has timed out already.`),d?.dispose()):(gt(`code/didCreateSocketOK/${o}`),n.info(`Creating a socket (${s}) was successful after ${c.elapsed()} ms.`),l.resolve(d))},d=>{gt(`code/didCreateSocketError/${o}`),n.info(`Creating a socket (${s}) returned an error after ${c.elapsed()} ms.`),n.error(d),l.reject(d)}),l.promise}function qv(n,t){let e=new sd(t);return n.then(r=>{e.didTimeout||e.resolve(r)},r=>{e.didTimeout||e.reject(r)}),e.promise}async function X_(n,t,e,r){let i=Tx(n,t);n.logService.trace(`${i} 1/6. invoking socketFactory.connect().`);let o;try{o=await Y_(n.logService,n.remoteSocketFactoryService,n.connectTo,fh.getServerRootPath(),`reconnectionToken=${n.reconnectionToken}&reconnection=${n.reconnectionProtocol?"true":"false"}`,$v(t),`renderer-${$v(t)}-${n.reconnectionToken}`,r)}catch(d){throw n.logService.error(`${i} socketFactory.connect() failed or timed out. Error:`),n.logService.error(d),d}n.logService.trace(`${i} 2/6. socketFactory.connect() was successful.`);let s,a;n.reconnectionProtocol?(n.reconnectionProtocol.beginAcceptReconnection(o,null),s=n.reconnectionProtocol,a=!1):(s=new Du({socket:o}),a=!0),n.logService.trace(`${i} 3/6. sending AuthRequest control message.`);let l=await qv(n.signService.createNewMessage(Ze()),r),c={type:"auth",auth:n.connectionToken||"00000000000000000000",data:l.data};s.sendControl(K.fromString(JSON.stringify(c)));try{let d=await Q_(s,J_(r,G_(1e4)));if(d.type!=="sign"||typeof d.data!="string"){let y=new Error("Unexpected handshake message");throw y.code="VSCODE_CONNECTION_ERROR",y}if(n.logService.trace(`${i} 4/6. received SignRequest control message.`),!await qv(n.signService.validate(l,d.signedData),r)){let y=new Error("Refused to connect to unsupported server");throw y.code="VSCODE_CONNECTION_ERROR",y}let m=await qv(n.signService.sign(d.data),r),h={type:"connectionType",commit:n.commit,signedData:m,desiredConnectionType:t};return e&&(h.args=e),n.logService.trace(`${i} 5/6. sending ConnectionTypeRequest control message.`),s.sendControl(K.fromString(JSON.stringify(h))),{protocol:s,ownsProtocol:a}}catch(d){throw d&&d.code==="ETIMEDOUT"&&(n.logService.error(`${i} the handshake timed out. Error:`),n.logService.error(d)),d&&d.code==="VSCODE_CONNECTION_ERROR"&&(n.logService.error(`${i} received error control message when negotiating connection. Error:`),n.logService.error(d)),a&&tR(s),d}}async function Z_(n,t,e){let r=Date.now(),i=Tx(n,3),{protocol:o}=await X_(n,3,t,e);return n.logService.trace(`${i} 6/6. handshake finished, connection is up and running after ${sR(r)}!`),o}async function eR(n,t,e){let{connectTo:r,connectionToken:i}=await n.addressProvider.getAddress();return{commit:n.commit,quality:n.quality,connectTo:r,connectionToken:i,reconnectionToken:t,reconnectionProtocol:e,remoteSocketFactoryService:n.remoteSocketFactoryService,signService:n.signService,logService:n.logService}}async function Px(n,t,e){let r=await eR(n,Ze(),null);return await Z_(r,{host:t,port:e},we.None)}function tR(n){try{n.acceptDisconnect();let t=n.getSocket();n.dispose(),t.dispose()}catch(t){Je(t)}}function rR(n){if(n&&n.type==="error"){let t=new Error(`Connection error: ${n.reason}`);return t.code="VSCODE_CONNECTION_ERROR",t}return null}function nR(n,t){for(;n.length<t;)n+=" ";return n}function iR(n,t){return`[remote-connection][${nR($v(n),13)}][${t.substr(0,5)}\u2026]`}function oR(n,t,e){return`${iR(n,t)}[${e?"reconnect":"initial"}]`}function Tx(n,t){return`${oR(t,n.reconnectionToken,!!n.reconnectionProtocol)}[${n.connectTo}]`}function sR(n){return`${Date.now()-n} ms`}var Cx=F("tunnelService"),w7e=F("sharedTunnelsService");function kx(n){return!!n.forwardPort}function aR(n){if(n.scheme!=="http"&&n.scheme!=="https")return;let t=/^(localhost|127\.0\.0\.1|0\.0\.0\.0):(\d+)$/.exec(n.authority);if(t)return{address:t[1],port:+t[2]}}var jv=["localhost","127.0.0.1","0:0:0:0:0:0:0:1","::1"];function am(n){return jv.indexOf(n)>=0}var Gv=["0.0.0.0","0:0:0:0:0:0:0:0","::"];function ol(n){return Gv.indexOf(n)>=0}function _x(n,t,e,r){if(e===1)return!1;if(e===2&&ol(t)){let i=/(\d+)\.(\d+)\.(\d+)/g.exec(r);if(i?.length===4&&parseInt(i[1])>=18)return!1}return n<1024}var il=class extends D{constructor(e,r){super();this.logService=e;this.configurationService=r}_onTunnelOpened=new S;onTunnelOpened=this._onTunnelOpened.event;_onTunnelClosed=new S;onTunnelClosed=this._onTunnelClosed.event;_onAddedTunnelProvider=new S;onAddedTunnelProvider=this._onAddedTunnelProvider.event;_tunnels=new Map;_tunnelProvider;_canElevate=!1;_canChangeProtocol=!0;_privacyOptions=[];_factoryInProgress=new Set;get hasTunnelProvider(){return!!this._tunnelProvider}get defaultTunnelHost(){let e=this.configurationService.getValue("remote.localPortHost");return!e||e==="localhost"?"127.0.0.1":"0.0.0.0"}setTunnelProvider(e){return this._tunnelProvider=e,e?(this._onAddedTunnelProvider.fire(),{dispose:()=>{this._tunnelProvider=void 0,this._canElevate=!1,this._privacyOptions=[]}}):(this._canElevate=!1,this._privacyOptions=[],this._onAddedTunnelProvider.fire(),{dispose:()=>{}})}setTunnelFeatures(e){this._canElevate=e.elevation,this._privacyOptions=e.privacyOptions,this._canChangeProtocol=e.protocol}get canChangeProtocol(){return this._canChangeProtocol}get canElevate(){return this._canElevate}get canChangePrivacy(){return this._privacyOptions.length>0}get privacyOptions(){return this._privacyOptions}get tunnels(){return this.getTunnels()}async getTunnels(){let e=[],r=Array.from(this._tunnels.values());for(let i of r){let o=Array.from(i.values());for(let s of o){let a=await s.value;a&&typeof a!="string"&&e.push(a)}}return e}async dispose(){super.dispose();for(let e of this._tunnels.values()){for(let{value:r}of e.values())await r.then(i=>typeof i!="string"?i?.dispose():void 0);e.clear()}this._tunnels.clear()}setEnvironmentTunnel(e,r,i,o,s){this.addTunnelToMap(e,r,Promise.resolve({tunnelRemoteHost:e,tunnelRemotePort:r,localAddress:i,privacy:o,protocol:s,dispose:()=>Promise.resolve()}))}async getExistingTunnel(e,r){(ol(e)||am(e))&&(e=jv[0]);let i=this.getTunnelFromMap(e,r);if(i)return++i.refcount,i.value}openTunnel(e,r,i,o,s,a=!1,l,c){this.logService.trace(`ForwardedPorts: (TunnelService) openTunnel request for ${r}:${i} on local port ${s}.`);let d=this._tunnelProvider??e;if(!d)return;if(r||(r="localhost"),o||(o=this.defaultTunnelHost),this._tunnelProvider&&this._factoryInProgress.has(i)){this.logService.debug("ForwardedPorts: (TunnelService) Another call to create a tunnel with the same address has occurred before the last one completed. This call will be ignored.");return}let u=this.retainOrCreateTunnel(d,r,i,o,s,a,l,c);return u?u.then(m=>{if(m){if(typeof m=="string")return this.logService.trace("ForwardedPorts: (TunnelService) The tunnel provider returned an error when creating the tunnel."),this.removeEmptyOrErrorTunnelFromMap(r,i),m}else{this.logService.trace("ForwardedPorts: (TunnelService) New tunnel is undefined."),this.removeEmptyOrErrorTunnelFromMap(r,i);return}this.logService.trace("ForwardedPorts: (TunnelService) New tunnel established.");let h=this.makeTunnel(m);return(m.tunnelRemoteHost!==r||m.tunnelRemotePort!==i)&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Host or port mismatch."),l&&m.privacy!==l&&this.logService.warn("ForwardedPorts: (TunnelService) Created tunnel does not match requirements of requested tunnel. Privacy mismatch."),this._onTunnelOpened.fire(h),h}):(this.logService.trace("ForwardedPorts: (TunnelService) Tunnel was not created."),u)}makeTunnel(e){return{tunnelRemotePort:e.tunnelRemotePort,tunnelRemoteHost:e.tunnelRemoteHost,tunnelLocalPort:e.tunnelLocalPort,localAddress:e.localAddress,privacy:e.privacy,protocol:e.protocol,dispose:async()=>{this.logService.trace(`ForwardedPorts: (TunnelService) dispose request for ${e.tunnelRemoteHost}:${e.tunnelRemotePort} `);let r=this._tunnels.get(e.tunnelRemoteHost);if(r){let i=r.get(e.tunnelRemotePort);i&&(i.refcount--,await this.tryDisposeTunnel(e.tunnelRemoteHost,e.tunnelRemotePort,i))}}}}async tryDisposeTunnel(e,r,i){if(i.refcount<=0){this.logService.trace(`ForwardedPorts: (TunnelService) Tunnel is being disposed ${e}:${r}.`);let o=i.value.then(async s=>{s&&typeof s!="string"&&(await s.dispose(!0),this._onTunnelClosed.fire({host:s.tunnelRemoteHost,port:s.tunnelRemotePort}))});return this._tunnels.has(e)&&this._tunnels.get(e).delete(r),o}}async closeTunnel(e,r){this.logService.trace(`ForwardedPorts: (TunnelService) close request for ${e}:${r} `);let i=this._tunnels.get(e);if(i&&i.has(r)){let o=i.get(r);o.refcount=0,await this.tryDisposeTunnel(e,r,o)}}addTunnelToMap(e,r,i){this._tunnels.has(e)||this._tunnels.set(e,new Map),this._tunnels.get(e).set(r,{refcount:1,value:i})}async removeEmptyOrErrorTunnelFromMap(e,r){let i=this._tunnels.get(e);if(i){let o=i.get(r),s=o?await o.value:void 0;(!s||typeof s=="string")&&i.delete(r),i.size===0&&this._tunnels.delete(e)}}getTunnelFromMap(e,r){let i=[e];am(e)?(i.push(...jv),i.push(...Gv)):ol(e)&&i.push(...Gv);let o=i.map(s=>this._tunnels.get(s));for(let s of o){let a=s?.get(r);if(a)return a}}canTunnel(e){return!!aR(e)}createWithProvider(e,r,i,o,s,a,l){this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel with provider ${r}:${i} on local port ${o}.`);let c=i;this._factoryInProgress.add(c);let d=o===void 0?i:o,u={elevationRequired:s?this.isPortPrivileged(d):!1},m={remoteAddress:{host:r,port:i},localAddressPort:o,privacy:a,public:a?a!=="private":void 0,protocol:l},h=e.forwardPort(m,u);return h?(this.addTunnelToMap(r,i,h),h.finally(()=>{this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created by provider."),this._factoryInProgress.delete(c)})):this._factoryInProgress.delete(c),h}};il=P([g(0,A),g(1,ce)],il);import*as Rx from"net";import*as Dx from"os";async function lR(n,t,e,r,i){let o;for(let s=3;s&&(o?.dispose(),o=await new Jv(n,t,e,r,i).waitForReady(),!(i&&dv[i]||!dv[o.tunnelLocalPort]));s--);return o}var Jv=class extends D{constructor(e,r,i,o,s){super();this.defaultTunnelHost=r;this.suggestedLocalPort=s;this._options=e,this._server=Rx.createServer(),this._barrier=new kn,this._listeningListener=()=>this._barrier.open(),this._server.on("listening",this._listeningListener),this._connectionListener=a=>this._onConnection(a),this._server.on("connection",this._connectionListener),this._errorListener=()=>{},this._server.on("error",this._errorListener),this.tunnelRemotePort=o,this.tunnelRemoteHost=i}tunnelRemotePort;tunnelLocalPort;tunnelRemoteHost;localAddress;privacy="private";_options;_server;_barrier;_listeningListener;_connectionListener;_errorListener;_socketsDispose=new Map;async dispose(){super.dispose(),this._server.removeListener("listening",this._listeningListener),this._server.removeListener("connection",this._connectionListener),this._server.removeListener("error",this._errorListener),this._server.close(),Array.from(this._socketsDispose.values()).forEach(r=>{r()})}async waitForReady(){let e=this.suggestedLocalPort??this.tunnelRemotePort,r=ol(this.defaultTunnelHost)?"0.0.0.0":"127.0.0.1",i=await p1(e,2,1e3,r),o=null;return this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),o=this._server.address(),o||(i=0,this._server.listen(i,this.defaultTunnelHost),await this._barrier.wait(),o=this._server.address()),this.tunnelLocalPort=o.port,this.localAddress=`${this.tunnelRemoteHost==="127.0.0.1"?"127.0.0.1":"localhost"}:${o.port}`,this}async _onConnection(e){e.pause();let r=am(this.tunnelRemoteHost)||ol(this.tunnelRemoteHost)?"localhost":this.tunnelRemoteHost,i=await Px(this._options,r,this.tunnelRemotePort),o=i.getSocket(),s=i.readEntireBuffer();i.dispose(),s.byteLength>0&&e.write(s.buffer),e.on("end",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),o.end()}),e.on("close",()=>o.end()),e.on("error",()=>{e.localAddress&&this._socketsDispose.delete(e.localAddress),o instanceof Oo?o.socket.destroy():o.end()}),o instanceof Oo?this._mirrorNodeSocket(e,o):this._mirrorGenericSocket(e,o),e.localAddress&&this._socketsDispose.set(e.localAddress,()=>{e.end(),o.end()})}_mirrorGenericSocket(e,r){r.onClose(()=>e.destroy()),r.onEnd(()=>e.end()),r.onData(i=>e.write(i.buffer)),e.on("data",i=>r.write(K.wrap(i))),e.resume()}_mirrorNodeSocket(e,r){let i=r.socket;i.on("end",()=>e.end()),i.on("close",()=>e.end()),i.on("error",()=>{e.destroy()}),i.pipe(e),e.pipe(i)}},ad=class extends il{constructor(e,r,i,o,s){super(r,s);this.remoteSocketFactoryService=e;this.signService=i;this.productService=o}isPortPrivileged(e){return _x(e,this.defaultTunnelHost,xt,Dx.release())}retainOrCreateTunnel(e,r,i,o,s,a,l,c){let d=this.getTunnelFromMap(r,i);if(d)return++d.refcount,d.value;if(kx(e))return this.createWithProvider(e,r,i,s,a,l,c);{this.logService.trace(`ForwardedPorts: (TunnelService) Creating tunnel without provider ${r}:${i} on local port ${s}.`);let u={commit:this.productService.commit,quality:this.productService.quality,addressProvider:e,remoteSocketFactoryService:this.remoteSocketFactoryService,signService:this.signService,logService:this.logService,ipcLogger:null},m=lR(u,o,r,i,s);return this.logService.trace("ForwardedPorts: (TunnelService) Tunnel created without provider."),this.addTunnelToMap(r,i,m),m}}};ad=P([g(0,sm),g(1,A),g(2,no),g(3,be),g(4,ce)],ad);var Zo=class extends ad{constructor(t,e,r,i,o){super(t,e,r,i,o)}};Zo=P([g(0,sm),g(1,A),g(2,no),g(3,be),g(4,ce)],Zo);var lm=class extends D{constructor(e,r,i,o,s){super();this.remoteSocketFactoryService=e;this.logService=r;this.productService=i;this.signService=o;this.configurationService=s}_tunnelServices=new Map;async openTunnel(e,r,i,o,s,a,l,c,d){if(this.logService.trace(`ForwardedPorts: (SharedTunnelService) openTunnel request for ${i}:${o} on local port ${a}.`),!this._tunnelServices.has(e)){let u=new Zo(this.remoteSocketFactoryService,this.logService,this.signService,this.productService,this.configurationService);this._register(u),this._tunnelServices.set(e,u),u.onTunnelClosed(async()=>{(await u.tunnels).length===0&&(u.dispose(),this._tunnelServices.delete(e))})}return this._tunnelServices.get(e).openTunnel(r,i,o,s,a,l,c,d)}};lm=P([g(0,sm),g(1,A),g(2,be),g(3,no),g(4,ce)],lm);import{net as uD}from"electron";import{parse as o0}from"url";import{parse as n0}from"url";function lD(n,t){return n.protocol==="http:"?t.HTTP_PROXY||t.http_proxy||null:n.protocol==="https:"&&(t.HTTPS_PROXY||t.https_proxy||t.HTTP_PROXY||t.http_proxy)||null}async function i0(n,t,e={}){let r=n0(n),i=e.proxyUrl||lD(r,t);if(!i)return null;let o=n0(i);if(!/^https?:$/.test(o.protocol||""))return null;let s={host:o.hostname||"",port:(o.port?+o.port:0)||(o.protocol==="https"?443:80),auth:o.auth,rejectUnauthorized:$d(e.strictSSL)?e.strictSSL:!0};if(r.protocol==="http:"){let{default:a}=await Promise.resolve().then(()=>_m(Qx()));return new a.HttpProxyAgent(i,s)}else{let{default:a}=await Promise.resolve().then(()=>_m(r0()));return new a.HttpsProxyAgent(i,s)}}import{createGunzip as cD}from"zlib";var pl=class extends $u{constructor(e,r,i){super(i);this.configurationService=e;this.environmentService=r;this.configure(),this._register(e.onDidChangeConfiguration(o=>{o.affectsConfiguration("http")&&this.configure()}))}proxyUrl;strictSSL;authorization;shellEnvErrorLogged;configure(){let e=this.configurationService.getValue("http");this.proxyUrl=e?.proxy,this.strictSSL=!!e?.proxyStrictSSL,this.authorization=e?.proxyAuthorization}async request(e,r){let{proxyUrl:i,strictSSL:o}=this,s;try{s=await Ia(this.configurationService,this.logService,this.environmentService.args,process.env)}catch(c){this.shellEnvErrorLogged||(this.shellEnvErrorLogged=!0,this.logService.error("resolving shell environment failed",Fr(c)))}let a={...process.env,...s},l=e.agent?e.agent:await i0(e.url||"",a,{proxyUrl:i,strictSSL:o});return e.agent=l,e.strictSSL=o,this.authorization&&(e.headers={...e.headers||{},"Proxy-Authorization":this.authorization}),this.logAndRequest(e,()=>s0(e,r))}async resolveProxy(e){}async lookupAuthorization(e){}async lookupKerberosAuthorization(e){try{let r=await import("kerberos"),i=new URL(e),o=this.configurationService.getValue("http.proxyKerberosServicePrincipal")||(process.platform==="win32"?`HTTP/${i.hostname}`:`HTTP@${i.hostname}`);return this.logService.debug("RequestService#lookupKerberosAuthorization Kerberos authentication lookup",`proxyURL:${i}`,`spn:${o}`),"Negotiate "+await(await r.initializeClient(o)).step("")}catch(r){this.logService.debug("RequestService#lookupKerberosAuthorization Kerberos authentication failed",r);return}}async loadCertificates(){return(await import("@vscode/proxy-agent")).loadSystemCertificates({log:this.logService})}};pl=P([g(0,ce),g(1,br),g(2,A)],pl);async function dD(n){return(o0(n.url).protocol==="https:"?await import("https"):await import("http")).request}async function s0(n,t){return Xe.withAsyncBody(async(e,r)=>{let i=o0(n.url),o=n.getRawRequest?n.getRawRequest(n):await dD(n),s={hostname:i.hostname,port:i.port?parseInt(i.port):i.protocol==="https:"?443:80,protocol:i.protocol,path:i.path,method:n.type||"GET",headers:n.headers,agent:n.agent,rejectUnauthorized:$d(n.strictSSL)?n.strictSSL:!0};n.user&&n.password&&(s.auth=n.user+":"+n.password);let a=o(s,l=>{let c=Ci(n.followRedirects)?n.followRedirects:3;if(l.statusCode&&l.statusCode>=300&&l.statusCode<400&&c>0&&l.headers.location)s0({...n,url:l.headers.location,followRedirects:c-1},t).then(e,r);else{let d=l;!n.isChromiumNetwork&&l.headers["content-encoding"]==="gzip"&&(d=l.pipe(cD())),e({res:l,stream:cb(d)})}});a.on("error",r),n.timeout&&a.setTimeout(n.timeout),n.isChromiumNetwork&&a.removeHeader("Content-Length"),n.data&&typeof n.data=="string"&&a.write(n.data),a.end(),t.onCancellationRequested(()=>{a.abort(),r(new at)})})}function pD(n){return uD.request}var vm=class extends pl{request(t,e){return super.request({...t||{},getRawRequest:pD,isChromiumNetwork:!0},e)}};var ny=class{constructor(t,e,r){this.id=t;this.dependencies=e;this.callback=r}};var iy=class n{static INSTANCE=new n;_isWebWorker=typeof self=="object"&&self.constructor&&self.constructor.name==="DedicatedWorkerGlobalScope";_isRenderer=typeof document=="object";_defineCalls=[];_state=1;_amdPolicy;constructor(){}_initialize(){if(this._state===1){if(globalThis.define){console.log("[amdX] AMD loader already present externally"),this._state=3;return}}else return;this._state=2,globalThis.define=(t,e,r)=>{typeof t!="string"&&(r=e,e=t,t=null),(typeof e!="object"||!Array.isArray(e))&&(r=e,e=null),this._defineCalls.push(new ny(t,e,r))},globalThis.define.amd=!0,this._isRenderer?this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??window.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){if(t.startsWith(window.location.origin)||t.startsWith(`${L.vscodeFileResource}://${xo}`))return t;throw new Error(`[trusted_script_src] Invalid script url: ${t}`)}}):this._isWebWorker&&(this._amdPolicy=globalThis._VSCODE_WEB_PACKAGE_TTP??globalThis.trustedTypes?.createPolicy("amdLoader",{createScriptURL(t){return t}}))}async load(t){if(this._initialize(),this._state===3)return new Promise(s=>{let a=Ze();console.log(`[amdX] Using external define("${a}", ["${t}"])`),globalThis.define(a,[t],function(l){console.log(`[amdX] Got a result for ${a}: ${!!l}`),s(l)})});let e=await(this._isWebWorker?this._workerLoadScript(t):this._isRenderer?this._rendererLoadScript(t):this._nodeJSLoadScript(t));if(!e){console.warn(`Did not receive a define call from script ${t}`);return}let r={},i=[],o=[];if(Array.isArray(e.dependencies))for(let s of e.dependencies)s==="exports"?i.push(r):o.push(s);if(o.length>0)throw new Error(`Cannot resolve dependencies for script ${t}. The dependencies are: ${o.join(", ")}`);return typeof e.callback=="function"?e.callback(...i)??r:e.callback}_rendererLoadScript(t){return new Promise((e,r)=>{let i=document.createElement("script");i.setAttribute("async","async"),i.setAttribute("type","text/javascript");let o=()=>{i.removeEventListener("load",s),i.removeEventListener("error",a)},s=l=>{o(),e(this._defineCalls.pop())},a=l=>{o(),r(l)};i.addEventListener("load",s),i.addEventListener("error",a),this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),i.setAttribute("src",t),window.document.getElementsByTagName("head")[0].appendChild(i)})}async _workerLoadScript(t){return this._amdPolicy&&(t=this._amdPolicy.createScriptURL(t)),await import(t),this._defineCalls.pop()}async _nodeJSLoadScript(t){try{let e=(await import("fs")).default,r=(await import("vm")).default,i=(await import("module")).default,o=x.parse(t).fsPath,s=e.readFileSync(o).toString(),a=i.wrap(s.replace(/^#!.*/,""));return new r.Script(a).runInThisContext().apply(),this._defineCalls.pop()}catch(e){throw e}}},ry=new Map;async function a0(n,t,e){if(!0){e===void 0&&(e=!!(globalThis._VSCODE_PRODUCT_JSON??globalThis.vscode?.context?.configuration()?.product)?.commit);let r=t?`${n}/${t}`:n;if(ry.has(r))return ry.get(r);let i;if(/^\w[\w\d+.-]*:\/\//.test(r))i=r;else{let l=`${SI}/${r}`;i=Re.asBrowserUri(l).toString(!0)}let o=iy.INSTANCE.load(i);return ry.set(r,o),o}else return await import(n)}var ym=class n{static _nextId=1;validators=new Map;async createNewMessage(t){try{let e=await this.getValidator();if(e){let r=String(n._nextId++);return this.validators.set(r,e),{id:r,data:e.createNewMessage(t)}}}catch{}return{id:"",data:t}}async validate(t,e){if(!t.id)return!0;let r=this.validators.get(t.id);if(!r)return!1;this.validators.delete(t.id);try{return r.validate(e)==="ok"}catch{return!1}finally{r.dispose?.()}}async sign(t){try{return await this.signValue(t)}catch{}return t}};var Im=class extends ym{getValidator(){return this.vsda().then(t=>new t.validator)}signValue(t){return this.vsda().then(e=>new e.signer().sign(t))}async vsda(){let t="vsda",{default:e}=await import(t);return e}};var fl=class extends To{constructor(e,r){super();this.logService=e;this.productName=r}throttler=new Ml;watcher=this._register(new Mr);async _updatePolicyDefinitions(e){this.logService.trace(`NativePolicyService#_updatePolicyDefinitions - Found ${Object.keys(e).length} policy definitions`);let{createWatcher:r}=await import("@vscode/policy-watcher");await this.throttler.queue(()=>new Promise((i,o)=>{try{this.watcher.value=r(this.productName,e,s=>{this._onDidPolicyChange(s),i()})}catch(s){this.logService.error("NativePolicyService#_updatePolicyDefinitions - Error creating watcher:",s),o(s)}}))}_onDidPolicyChange(e){this.logService.trace(`NativePolicyService#_onDidPolicyChange - Updated policy values: ${JSON.stringify(e)}`);for(let r in e){let i=e[r];i===void 0?this.policies.delete(r):this.policies.set(r,i)}this._onDidChange.fire(Object.keys(e))}};fl=P([g(0,A)],fl);function mD(n,t){let e=[];for(let r of new Set(jr.concat(n.keys(),t.keys())))n.get(r)!==t.get(r)&&e.push(r);return e}var ml=class extends To{constructor(e,r,i){super();this.file=e;this.fileService=r;this.logService=i;let o=E.filter(r.onDidFilesChange,s=>s.affects(e));this._register(r.watch(e)),this._register(o(()=>this.throttledDelayer.trigger(()=>this.refresh())))}throttledDelayer=this._register(new Ht(500));async _updatePolicyDefinitions(){await this.refresh()}async read(){let e=new Map;try{let r=await this.fileService.readFile(this.file),i=JSON.parse(r.value.toString());if(!qe(i))throw new Error("Policy file isn't a JSON object");for(let o of Object.keys(i))this.policyDefinitions[o]&&e.set(o,i[o])}catch(r){r.fileOperationResult!==1&&this.logService.error("[FilePolicyService] Failed to read policies",r)}return e}async refresh(){let e=await this.read(),r=mD(this.policies,e);this.policies=e,r.length>0&&this._onDidChange.fire(r)}};ml=P([g(1,Pe),g(2,A)],ml);var hD=[];function l0(n,t,e){t instanceof le||(t=new le(t,[],!!e)),hD.push([n,t])}var dd=class{constructor(t,e,r){this.level=t;this.key=e;this.value=r;this.forward=[]}forward},cd=void 0,bm=class n{constructor(t,e=2**16){this.comparator=t;this._maxLevel=Math.max(1,Math.log2(e)|0),this._header=new dd(this._maxLevel,cd,cd)}[Symbol.toStringTag]="SkipList";_maxLevel;_level=0;_header;_size=0;get size(){return this._size}clear(){this._header=new dd(this._maxLevel,cd,cd),this._size=0}has(t){return!!n._search(this,t,this.comparator)}get(t){return n._search(this,t,this.comparator)?.value}set(t,e){return n._insert(this,t,e,this.comparator)&&(this._size+=1),this}delete(t){let e=n._delete(this,t,this.comparator);return e&&(this._size-=1),e}forEach(t,e){let r=this._header.forward[0];for(;r;)t.call(e,r.value,r.key,this),r=r.forward[0]}[Symbol.iterator](){return this.entries()}*entries(){let t=this._header.forward[0];for(;t;)yield[t.key,t.value],t=t.forward[0]}*keys(){let t=this._header.forward[0];for(;t;)yield t.key,t=t.forward[0]}*values(){let t=this._header.forward[0];for(;t;)yield t.value,t=t.forward[0]}toString(){let t="[SkipList]:",e=this._header.forward[0];for(;e;)t+=`node(${e.key}, ${e.value}, lvl:${e.level})`,e=e.forward[0];return t}static _search(t,e,r){let i=t._header;for(let o=t._level-1;o>=0;o--)for(;i.forward[o]&&r(i.forward[o].key,e)<0;)i=i.forward[o];if(i=i.forward[0],i&&r(i.key,e)===0)return i}static _insert(t,e,r,i){let o=[],s=t._header;for(let a=t._level-1;a>=0;a--){for(;s.forward[a]&&i(s.forward[a].key,e)<0;)s=s.forward[a];o[a]=s}if(s=s.forward[0],s&&i(s.key,e)===0)return s.value=r,!1;{let a=n._randomLevel(t);if(a>t._level){for(let l=t._level;l<a;l++)o[l]=t._header;t._level=a}s=new dd(a,e,r);for(let l=0;l<a;l++)s.forward[l]=o[l].forward[l],o[l].forward[l]=s;return!0}}static _randomLevel(t,e=.5){let r=1;for(;Math.random()<e&&r<t._maxLevel;)r+=1;return r}static _delete(t,e,r){let i=[],o=t._header;for(let s=t._level-1;s>=0;s--){for(;o.forward[s]&&r(o.forward[s].key,e)<0;)o=o.forward[s];i[s]=o}if(o=o.forward[0],!o||r(o.key,e)!==0)return!1;for(let s=0;s<t._level&&i[s].forward[s]===o;s++)i[s].forward[s]=o.forward[s];for(;t._level>0&&t._header.forward[t._level-1]===cd;)t._level-=1;return!0}};var wm=class n{constructor(t){this.uri=t}static _clock=0;time=n._clock++;touch(){return this.time=n._clock++,this}},ts=class{constructor(t){this._fileService=t;let e=new Map,r=i=>{let o=e.get(i.scheme);return o===void 0&&(o=t.hasProvider(i)&&!this._fileService.hasCapability(i,1024),e.set(i.scheme,o)),o};this._dispooables.add(E.any(t.onDidChangeFileSystemProviderRegistrations,t.onDidChangeFileSystemProviderCapabilities)(i=>{e.delete(i.scheme)})),this.extUri=new Eo(r),this._canonicalUris=new bm((i,o)=>this.extUri.compare(i,o,!0),this._limit)}extUri;_dispooables=new Y;_canonicalUris;_limit=2**16;dispose(){this._dispooables.dispose(),this._canonicalUris.clear()}asCanonicalUri(t){this._fileService.hasProvider(t)&&(t=ru(t));let e=this._canonicalUris.get(t);return e?e.touch().uri.with({fragment:t.fragment}):(this._canonicalUris.set(t,new wm(t)),this._checkTrim(),t)}_checkTrim(){if(this._canonicalUris.size<this._limit)return;let t=[...this._canonicalUris.entries()].sort((r,i)=>r[1].time<i[1].time?1:r[1].time>i[1].time?-1:0);wm._clock=0,this._canonicalUris.clear();let e=this._limit*.5;for(let r=0;r<e;r++)this._canonicalUris.set(t[r][0],t[r][1].touch())}};ts=P([g(0,Pe)],ts);l0(ut,ts,1);var Sm=class extends D{logger;constructor(t,e=[]){super(),this.logger=new zu([t,...e]),this._register(t.onDidChangeLogLevel(r=>this.setLevel(r)))}get onDidChangeLogLevel(){return this.logger.onDidChangeLogLevel}setLevel(t){this.logger.setLevel(t)}getLevel(){return this.logger.getLevel()}trace(t,...e){this.logger.trace(t,...e)}debug(t,...e){this.logger.debug(t,...e)}info(t,...e){this.logger.info(t,...e)}warn(t,...e){this.logger.warn(t,...e)}error(t,...e){this.logger.error(t,...e)}flush(){this.logger.flush()}};var xm=class extends D{constructor(e,r,i,o,s,a){super();this.fileSystemScheme=e;this.fileSystemProvider=r;this.userDataScheme=i;this.userDataProfilesService=o;this.uriIdentityService=s;this.logService=a;this.updateAtomicReadWritesResources(),this._register(o.onDidChangeProfiles(()=>this.updateAtomicReadWritesResources())),this._register(this.fileSystemProvider.onDidChangeFile(l=>this.handleFileChanges(l)))}capabilities=this.fileSystemProvider.capabilities;onDidChangeCapabilities=this.fileSystemProvider.onDidChangeCapabilities;_onDidChangeFile=this._register(new S);onDidChangeFile=this._onDidChangeFile.event;watchResources=lr.forUris(()=>!(this.capabilities&1024));atomicReadWriteResources=new Dd(e=>this.uriIdentityService.extUri.getComparisonKey(this.toFileSystemResource(e)));updateAtomicReadWritesResources(){this.atomicReadWriteResources.clear();for(let e of this.userDataProfilesService.profiles)this.atomicReadWriteResources.add(e.settingsResource),this.atomicReadWriteResources.add(e.keybindingsResource),this.atomicReadWriteResources.add(e.tasksResource),this.atomicReadWriteResources.add(e.extensionsResource)}open(e,r){return this.fileSystemProvider.open(this.toFileSystemResource(e),r)}close(e){return this.fileSystemProvider.close(e)}read(e,r,i,o,s){return this.fileSystemProvider.read(e,r,i,o,s)}write(e,r,i,o,s){return this.fileSystemProvider.write(e,r,i,o,s)}watch(e,r){this.watchResources.set(e,e);let i=this.fileSystemProvider.watch(this.toFileSystemResource(e),r);return $(()=>{this.watchResources.delete(e),i.dispose()})}stat(e){return this.fileSystemProvider.stat(this.toFileSystemResource(e))}mkdir(e){return this.fileSystemProvider.mkdir(this.toFileSystemResource(e))}rename(e,r,i){return this.fileSystemProvider.rename(this.toFileSystemResource(e),this.toFileSystemResource(r),i)}readFile(e,r){return this.fileSystemProvider.readFile(this.toFileSystemResource(e),r)}readFileStream(e,r,i){return this.fileSystemProvider.readFileStream(this.toFileSystemResource(e),r,i)}readdir(e){return this.fileSystemProvider.readdir(this.toFileSystemResource(e))}enforceAtomicReadFile(e){return this.atomicReadWriteResources.has(e)}writeFile(e,r,i){return this.fileSystemProvider.writeFile(this.toFileSystemResource(e),r,i)}enforceAtomicWriteFile(e){return this.atomicReadWriteResources.has(e)?{postfix:".vsctmp"}:!1}delete(e,r){return this.fileSystemProvider.delete(this.toFileSystemResource(e),r)}copy(e,r,i){if(mc(this.fileSystemProvider))return this.fileSystemProvider.copy(this.toFileSystemResource(e),this.toFileSystemResource(r),i);throw new Error("copy not supported")}cloneFile(e,r){if(Zu(this.fileSystemProvider))return this.fileSystemProvider.cloneFile(this.toFileSystemResource(e),this.toFileSystemResource(r));throw new Error("clone not supported")}handleFileChanges(e){let r=[];for(let i of e){if(i.resource.scheme!==this.fileSystemScheme)continue;let o=this.toUserDataResource(i.resource);this.watchResources.findSubstr(o)&&r.push({resource:o,type:i.type,cId:i.cId})}r.length&&(this.logService.debug("User data changed"),this._onDidChangeFile.fire(r))}toFileSystemResource(e){return e.with({scheme:this.fileSystemScheme})}toUserDataResource(e){return e.with({scheme:this.userDataScheme})}};var oy=class{main(){try{this.startup()}catch(t){console.error(t.message),gD.exit(1)}}async startup(){Pd(c=>console.error(c));let[t,e,r,i,o,s,a,l]=this.createServices();try{try{await this.initServices(r,l,i,o,a)}catch(c){throw this.handleStartupDataDirError(r,a,c),c}await t.invokeFunction(async c=>{let d=c.get(A),u=c.get(oe),m=c.get(Pe),h=c.get(Ai),y=await this.claimInstance(d,r,u,t,a,!0);return q.writeFile(r.mainLockfile,String(process.pid)).catch(v=>{d.warn(`app#startup(): Error writing main lockfile: ${v.stack}`)}),s.logger=h.createLogger("main",{name:p("mainLog","Main")}),E.once(u.onWillShutdown)(v=>{m.dispose(),i.dispose(),v.join("instanceLockfile",c0.unlink(r.mainLockfile).catch(()=>{}))}),t.createInstance(ao,y,e).startup()})}catch(c){t.invokeFunction(this.quit,c)}}createServices(){let t=new ki,e=new Y;process.once("exit",()=>e.dispose());let r={_serviceBrand:void 0,...nr};t.set(be,r);let i=new un(this.resolveArgs(),r),o=this.patchEnvironment(i);t.set(ge,i);let s=new Up($b(i),i.logsHome);t.set(Nn,s);let a=new om(s.getLogLevel()),l=e.add(new Sm(a,[new Hu(s.getLogLevel())]));t.set(A,l);let c=new co(l);t.set(Pe,c);let d=new Yi(l);c.registerProvider(L.file,d);let u=new ts(c);t.set(ut,u);let m=new sa(1,i,l,c);t.set(sp,m),t.set(et,m);let h=new aa(m,u,i,c,l);t.set(rr,h),c.registerProvider(L.vscodeUserData,new xm(L.file,d,L.vscodeUserData,h,u,l));let y=U&&r.win32RegValueName?e.add(new fl(l,r.win32RegValueName)):i.policyFile?e.add(new ml(i.policyFile,c,l)):new Ss;t.set(Jr,y);let v=new rm(h.defaultProfile.settingsResource,c,y,l);return t.set(ce,v),t.set(oe,new le(Vn,void 0,!1)),t.set(wr,new le(vm,void 0,!0)),t.set(Un,new le(ia)),t.set(no,new le(Im,void 0,!1)),t.set(Cx,new le(Zo)),t.set(Wn,new nl(i,h,l)),[new im(t,!0),o,i,v,m,a,r,h]}patchEnvironment(t){let e={VSCODE_IPC_HOOK:t.mainIPCHandle};return["VSCODE_NLS_CONFIG","VSCODE_PORTABLE"].forEach(r=>{let i=process.env[r];typeof i=="string"&&(e[r]=i)}),Object.assign(process.env,e),e}async initServices(t,e,r,i,o){await Xe.settled([Promise.all([this.allowWindowsUNCPath(t.extensionsPath),t.codeCachePath,t.logsHome.with({scheme:L.file}).fsPath,e.defaultProfile.globalStorageHome.with({scheme:L.file}).fsPath,t.workspaceStorageHome.with({scheme:L.file}).fsPath,t.localHistoryHome.with({scheme:L.file}).fsPath,t.backupHome].map(s=>s?c0.mkdir(s,{recursive:!0}):void 0)),i.init(),r.initialize()]),e.init()}allowWindowsUNCPath(t){if(U){let e=Ib(t);e&&Ls(e)}return t}async claimInstance(t,e,r,i,o,s){let a;try{gt("code/willStartMainServer"),a=await vb(e.mainIPCHandle),gt("code/didStartMainServer"),E.once(r.onWillShutdown)(()=>a.dispose())}catch(l){if(l.code!=="EADDRINUSE")throw this.handleStartupDataDirError(e,o,l),l;let c;try{c=await yb(e.mainIPCHandle,"main")}catch(h){if(!s||U||h.code!=="ECONNREFUSED")throw h.code==="EPERM"&&this.showStartupWarningDialog(p("secondInstanceAdmin","Another instance of {0} is already running as administrator.",o.nameShort),p("secondInstanceAdminDetail","Please close the other instance and try again."),o),h;try{yD(e.mainIPCHandle)}catch(y){throw t.warn("Could not delete obsolete instance handle",y),y}return this.claimInstance(t,e,r,i,o,!1)}if(e.extensionTestsLocationURI&&!e.debugExtensionHost.break){let h=`Running extension tests from the command line is currently only supported if no other instance of ${o.nameShort} is running.`;throw t.error(h),c.dispose(),new Error(h)}let d;!e.args.wait&&!e.args.status&&(d=setTimeout(()=>{this.showStartupWarningDialog(p("secondInstanceNoResponse","Another instance of {0} is running but not responding",o.nameShort),p("secondInstanceNoResponseDetail","Please close all other instances and try again."),o)},1e4));let u=$e.toService(c.getChannel("launch"),{disableMarshalling:!0}),m=$e.toService(c.getChannel("diagnostics"),{disableMarshalling:!0});if(e.args.status)return i.invokeFunction(async()=>{let h=new rl(Hi,o),y=await m.getMainDiagnostics(),v=await m.getRemoteDiagnostics({includeProcesses:!0,includeWorkspaceMetadata:!0}),b=await h.getDiagnostics(y,v);throw console.log(b),new is});throw U&&await this.windowsAllowSetForegroundWindow(u,t),t.trace("Sending env to running instance..."),await u.start(e.args,process.env),c.dispose(),d&&clearTimeout(d),new is("Sent env to running instance. Terminating...")}if(e.args.status)throw console.log(p("statusWarning","Warning: The --status argument can only be used if {0} is already running. Please run it again after {0} has started.",o.nameShort)),new is("Terminating...");return process.env.VSCODE_PID=String(process.pid),a}handleStartupDataDirError(t,e,r){if(r.code==="EACCES"||r.code==="EPERM"){let i=Ye([t.userDataPath,t.extensionsPath,Ou]).map(o=>ni(x.file(o),{os:xt,tildify:t}));this.showStartupWarningDialog(p("startupDataDirError","Unable to write program user data."),p("startupUserDataAndExtensionsDirErrorDetail",`{0}

Please make sure the following directories are writeable:

{1}`,zt(r),i.join(`
`)),e)}}showStartupWarningDialog(t,e,r){vD.showMessageBoxSync(Sp({type:"warning",buttons:[p({key:"close",comment:["&& denotes a mnemonic"]},"&&Close")],message:t,detail:e},r).options)}async windowsAllowSetForegroundWindow(t,e){if(U){let r=await t.getMainProcessId();e.trace("Sending some foreground love to the running instance:",r);try{(await import("windows-foreground-love")).allowSetForegroundWindow(r)}catch(i){e.error(i)}}}quit(t,e){let r=t.get(A),i=t.get(oe),o=0;e&&(e.isExpected?e.message&&r.trace(e.message):(o=1,e.stack?r.error(e.stack):r.error(`Startup error: ${e.toString()}`))),i.kill(o)}resolveArgs(){let t=this.validatePaths(oS(process.argv));if(t.wait&&!t.waitMarkerFilePath){let e=Ex(t.verbose);e&&(sS(process.argv,"--waitMarkerFilePath",e),t.waitMarkerFilePath=e)}return t}validatePaths(t){if(t["open-url"]&&(t._urls=t._,t._=[]),!t.remote){let e=this.doValidatePaths(t._,t.goto);t._=e}return t}doValidatePaths(t,e){let r=ar(),i=t.map(a=>{let l=String(a),c;e&&(c=Is(l),l=c.path),l&&(l=this.preparePath(r,l));let d=Zd(l,r),u=pe(d);return u&&!II(u)?null:e&&c?(c.path=d,this.toPath(c)):d}),o=U||W,s=Qt(i,a=>a&&o?a.toLowerCase():a||"");return Ye(s)}preparePath(t,e){return U&&(e=cn(e,'"')),e=rh(rh(e," "),"	"),U&&(e=Sn(t,e),e=cn(e,".")),e}toPath(t){let e=[t.path];return typeof t.line=="number"&&e.push(String(t.line)),typeof t.column=="number"&&e.push(String(t.column)),e.join(":")}},ID=new oy;ID.main();
