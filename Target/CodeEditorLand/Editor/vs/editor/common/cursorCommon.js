import"../../../vs/editor/common/config/editorConfiguration.js";import{EditorOption as o}from"../../../vs/editor/common/config/editorOptions.js";import{CursorColumns as m}from"../../../vs/editor/common/core/cursorColumns.js";import{normalizeIndentation as b}from"../../../vs/editor/common/core/indentation.js";import{Position as h}from"../../../vs/editor/common/core/position.js";import{Range as d}from"../../../vs/editor/common/core/range.js";import{Selection as u}from"../../../vs/editor/common/core/selection.js";import"../../../vs/editor/common/editorCommon.js";import"../../../vs/editor/common/languages/languageConfiguration.js";import"../../../vs/editor/common/languages/languageConfigurationRegistry.js";import{createScopedLineTokens as f}from"../../../vs/editor/common/languages/supports.js";import"../../../vs/editor/common/languages/supports/electricCharacter.js";import"../../../vs/editor/common/model.js";import"../../../vs/editor/common/tokens/lineTokens.js";var y=(a=>(a[a.Other=0]="Other",a[a.DeletingLeft=2]="DeletingLeft",a[a.DeletingRight=3]="DeletingRight",a[a.TypingOther=4]="TypingOther",a[a.TypingFirstSpace=5]="TypingFirstSpace",a[a.TypingConsecutiveSpace=6]="TypingConsecutiveSpace",a))(y||{});const v=()=>!0,P=()=>!1,L=s=>s===" "||s==="	";class te{constructor(e,t,i,r){this.languageConfigurationService=r;this._languageId=e;const n=i.options,a=n.get(o.layoutInfo),g=n.get(o.fontInfo);this.readOnly=n.get(o.readOnly),this.tabSize=t.tabSize,this.indentSize=t.indentSize,this.insertSpaces=t.insertSpaces,this.stickyTabStops=n.get(o.stickyTabStops),this.lineHeight=g.lineHeight,this.typicalHalfwidthCharacterWidth=g.typicalHalfwidthCharacterWidth,this.pageSize=Math.max(1,Math.floor(a.height/this.lineHeight)-2),this.useTabStops=n.get(o.useTabStops),this.wordSeparators=n.get(o.wordSeparators),this.emptySelectionClipboard=n.get(o.emptySelectionClipboard),this.copyWithSyntaxHighlighting=n.get(o.copyWithSyntaxHighlighting),this.multiCursorMergeOverlapping=n.get(o.multiCursorMergeOverlapping),this.multiCursorPaste=n.get(o.multiCursorPaste),this.multiCursorLimit=n.get(o.multiCursorLimit),this.autoClosingBrackets=n.get(o.autoClosingBrackets),this.autoClosingComments=n.get(o.autoClosingComments),this.autoClosingQuotes=n.get(o.autoClosingQuotes),this.autoClosingDelete=n.get(o.autoClosingDelete),this.autoClosingOvertype=n.get(o.autoClosingOvertype),this.autoSurround=n.get(o.autoSurround),this.autoIndent=n.get(o.autoIndent),this.wordSegmenterLocales=n.get(o.wordSegmenterLocales),this.surroundingPairs={},this._electricChars=null,this.shouldAutoCloseBefore={quote:this._getShouldAutoClose(e,this.autoClosingQuotes,!0),comment:this._getShouldAutoClose(e,this.autoClosingComments,!1),bracket:this._getShouldAutoClose(e,this.autoClosingBrackets,!1)},this.autoClosingPairs=this.languageConfigurationService.getLanguageConfiguration(e).getAutoClosingPairs();const c=this.languageConfigurationService.getLanguageConfiguration(e).getSurroundingPairs();if(c)for(const C of c)this.surroundingPairs[C.open]=C.close;const p=this.languageConfigurationService.getLanguageConfiguration(e).comments;this.blockCommentStartToken=p?.blockCommentStartToken??null}_cursorMoveConfigurationBrand=void 0;readOnly;tabSize;indentSize;insertSpaces;stickyTabStops;pageSize;lineHeight;typicalHalfwidthCharacterWidth;useTabStops;wordSeparators;emptySelectionClipboard;copyWithSyntaxHighlighting;multiCursorMergeOverlapping;multiCursorPaste;multiCursorLimit;autoClosingBrackets;autoClosingComments;autoClosingQuotes;autoClosingDelete;autoClosingOvertype;autoSurround;autoIndent;autoClosingPairs;surroundingPairs;blockCommentStartToken;shouldAutoCloseBefore;wordSegmenterLocales;_languageId;_electricChars;static shouldRecreate(e){return e.hasChanged(o.layoutInfo)||e.hasChanged(o.wordSeparators)||e.hasChanged(o.emptySelectionClipboard)||e.hasChanged(o.multiCursorMergeOverlapping)||e.hasChanged(o.multiCursorPaste)||e.hasChanged(o.multiCursorLimit)||e.hasChanged(o.autoClosingBrackets)||e.hasChanged(o.autoClosingComments)||e.hasChanged(o.autoClosingQuotes)||e.hasChanged(o.autoClosingDelete)||e.hasChanged(o.autoClosingOvertype)||e.hasChanged(o.autoSurround)||e.hasChanged(o.useTabStops)||e.hasChanged(o.fontInfo)||e.hasChanged(o.readOnly)||e.hasChanged(o.wordSegmenterLocales)}get electricChars(){if(!this._electricChars){this._electricChars={};const e=this.languageConfigurationService.getLanguageConfiguration(this._languageId).electricCharacter?.getElectricCharacters();if(e)for(const t of e)this._electricChars[t]=!0}return this._electricChars}onElectricCharacter(e,t,i){const r=f(t,i-1),n=this.languageConfigurationService.getLanguageConfiguration(r.languageId).electricCharacter;return n?n.onElectricCharacter(e,r,i-r.firstCharOffset):null}normalizeIndentation(e){return b(e,this.indentSize,this.insertSpaces)}_getShouldAutoClose(e,t,i){switch(t){case"beforeWhitespace":return L;case"languageDefined":return this._getLanguageDefinedShouldAutoClose(e,i);case"always":return v;case"never":return P}}_getLanguageDefinedShouldAutoClose(e,t){const i=this.languageConfigurationService.getLanguageConfiguration(e).getAutoCloseBeforeSet(t);return r=>i.indexOf(r)!==-1}visibleColumnFromColumn(e,t){return m.visibleColumnFromColumn(e.getLineContent(t.lineNumber),t.column,this.tabSize)}columnFromVisibleColumn(e,t,i){const r=m.columnFromVisibleColumn(e.getLineContent(t),i,this.tabSize),n=e.getLineMinColumn(t);if(r<n)return n;const a=e.getLineMaxColumn(t);return r>a?a:r}}class S{_cursorStateBrand=void 0;static fromModelState(e){return new w(e)}static fromViewState(e){return new A(e)}static fromModelSelection(e){const t=u.liftSelection(e),i=new l(d.fromPositions(t.getSelectionStart()),0,0,t.getPosition(),0);return S.fromModelState(i)}static fromModelSelections(e){const t=[];for(let i=0,r=e.length;i<r;i++)t[i]=this.fromModelSelection(e[i]);return t}modelState;viewState;constructor(e,t){this.modelState=e,this.viewState=t}equals(e){return this.viewState.equals(e.viewState)&&this.modelState.equals(e.modelState)}}class w{modelState;viewState;constructor(e){this.modelState=e,this.viewState=null}}class A{modelState;viewState;constructor(e){this.modelState=null,this.viewState=e}}var k=(i=>(i[i.Simple=0]="Simple",i[i.Word=1]="Word",i[i.Line=2]="Line",i))(k||{});class l{constructor(e,t,i,r,n){this.selectionStart=e;this.selectionStartKind=t;this.selectionStartLeftoverVisibleColumns=i;this.position=r;this.leftoverVisibleColumns=n;this.selection=l._computeSelection(this.selectionStart,this.position)}_singleCursorStateBrand=void 0;selection;equals(e){return this.selectionStartLeftoverVisibleColumns===e.selectionStartLeftoverVisibleColumns&&this.leftoverVisibleColumns===e.leftoverVisibleColumns&&this.selectionStartKind===e.selectionStartKind&&this.position.equals(e.position)&&this.selectionStart.equalsRange(e.selectionStart)}hasSelection(){return!this.selection.isEmpty()||!this.selectionStart.isEmpty()}move(e,t,i,r){return e?new l(this.selectionStart,this.selectionStartKind,this.selectionStartLeftoverVisibleColumns,new h(t,i),r):new l(new d(t,i,t,i),0,r,new h(t,i),r)}static _computeSelection(e,t){return e.isEmpty()||!t.isBeforeOrEqual(e.getStartPosition())?u.fromPositions(e.getStartPosition(),t):u.fromPositions(e.getEndPosition(),t)}}class oe{_editOperationResultBrand=void 0;type;commands;shouldPushStackElementBefore;shouldPushStackElementAfter;constructor(e,t,i){this.type=e,this.commands=t,this.shouldPushStackElementBefore=i.shouldPushStackElementBefore,this.shouldPushStackElementAfter=i.shouldPushStackElementAfter}}function ie(s){return s==="'"||s==='"'||s==="`"}export{te as CursorConfiguration,S as CursorState,oe as EditOperationResult,y as EditOperationType,w as PartialModelCursorState,A as PartialViewCursorState,k as SelectionStartKind,l as SingleCursorState,ie as isQuote};
