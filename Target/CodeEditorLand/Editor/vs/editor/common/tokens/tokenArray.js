var d=class{unexpectedErrorHandler;listeners;constructor(){this.listeners=[],this.unexpectedErrorHandler=function(e){setTimeout(()=>{throw e.stack?l.isErrorNoTelemetry(e)?new l(e.message+`

`+e.stack):new Error(e.message+`

`+e.stack):e},0)}}addListener(e){return this.listeners.push(e),()=>{this._removeListener(e)}}emit(e){this.listeners.forEach(t=>{t(e)})}_removeListener(e){this.listeners.splice(this.listeners.indexOf(e),1)}setUnexpectedErrorHandler(e){this.unexpectedErrorHandler=e}getUnexpectedErrorHandler(){return this.unexpectedErrorHandler}onUnexpectedError(e){this.unexpectedErrorHandler(e),this.emit(e)}onUnexpectedExternalError(e){this.unexpectedErrorHandler(e)}},E=new d;var l=class n extends Error{name;constructor(e){super(e),this.name="CodeExpectedError"}static fromError(e){if(e instanceof n)return e;let t=new n;return t.message=e.message,t.stack=e.stack,t}static isErrorNoTelemetry(e){return e.name==="CodeExpectedError"}},i=class n extends Error{constructor(e){super(e||"An unexpected bug occurred."),Object.setPrototypeOf(this,n.prototype)}};var c=class n{constructor(e,t){this.start=e;this.endExclusive=t;if(e>t)throw new i(`Invalid range: ${this.toString()}`)}static addRange(e,t){let r=0;for(;r<t.length&&t[r].endExclusive<e.start;)r++;let s=r;for(;s<t.length&&t[s].start<=e.endExclusive;)s++;if(r===s)t.splice(r,0,e);else{let o=Math.min(e.start,t[r].start),a=Math.max(e.endExclusive,t[s-1].endExclusive);t.splice(r,s-r,new n(o,a))}}static tryCreate(e,t){if(!(e>t))return new n(e,t)}static ofLength(e){return new n(0,e)}static ofStartAndLength(e,t){return new n(e,e+t)}static emptyAt(e){return new n(e,e)}get isEmpty(){return this.start===this.endExclusive}delta(e){return new n(this.start+e,this.endExclusive+e)}deltaStart(e){return new n(this.start+e,this.endExclusive)}deltaEnd(e){return new n(this.start,this.endExclusive+e)}get length(){return this.endExclusive-this.start}toString(){return`[${this.start}, ${this.endExclusive})`}equals(e){return this.start===e.start&&this.endExclusive===e.endExclusive}containsRange(e){return this.start<=e.start&&e.endExclusive<=this.endExclusive}contains(e){return this.start<=e&&e<this.endExclusive}join(e){return new n(Math.min(this.start,e.start),Math.max(this.endExclusive,e.endExclusive))}intersect(e){let t=Math.max(this.start,e.start),r=Math.min(this.endExclusive,e.endExclusive);if(t<=r)return new n(t,r)}intersectionLength(e){let t=Math.max(this.start,e.start),r=Math.min(this.endExclusive,e.endExclusive);return Math.max(0,r-t)}intersects(e){let t=Math.max(this.start,e.start),r=Math.min(this.endExclusive,e.endExclusive);return t<r}intersectsOrTouches(e){let t=Math.max(this.start,e.start),r=Math.min(this.endExclusive,e.endExclusive);return t<=r}isBefore(e){return this.endExclusive<=e.start}isAfter(e){return this.start>=e.endExclusive}slice(e){return e.slice(this.start,this.endExclusive)}substring(e){return e.substring(this.start,this.endExclusive)}clip(e){if(this.isEmpty)throw new i(`Invalid clipping range: ${this.toString()}`);return Math.max(this.start,Math.min(this.endExclusive-1,e))}clipCyclic(e){if(this.isEmpty)throw new i(`Invalid clipping range: ${this.toString()}`);return e<this.start?this.endExclusive-(this.start-e)%this.length:e>=this.endExclusive?this.start+(e-this.start)%this.length:e}map(e){let t=[];for(let r=this.start;r<this.endExclusive;r++)t.push(e(r));return t}forEach(e){for(let t=this.start;t<this.endExclusive;t++)e(t)}};var f=class n{constructor(e){this._tokenInfo=e}static create(e){return new n(e)}forEach(e){let t=0;for(let r of this._tokenInfo){let s=new c(t,t+r.length);e(s,r),t+=r.length}}slice(e){let t=[],r=0;for(let s of this._tokenInfo){let o=r,a=o+s.length;if(a>e.start){if(o>=e.endExclusive)break;let p=Math.max(0,e.start-o),g=Math.max(0,a-e.endExclusive);t.push(new u(s.length-p-g,s.metadata))}r+=s.length}return n.create(t)}},u=class{constructor(e,t){this.length=e;this.metadata=t}},h=class{_tokens=[];add(e,t){this._tokens.push(new u(e,t))}build(){return f.create(this._tokens)}};export{f as TokenArray,h as TokenArrayBuilder,u as TokenInfo};
