import{Color as E}from"../../../../base/common/color.js";import{FontStyle as u,ColorId as _,StandardTokenType as T,MetadataConsts as h}from"../../encodedTokenAttributes.js";class b{_parsedThemeRuleBrand=void 0;token;index;fontStyle;foreground;background;constructor(e,t,r,l,n){this.token=e,this.index=t,this.fontStyle=r,this.foreground=l,this.background=n}}function k(o){if(!o||!Array.isArray(o))return[];const e=[];let t=0;for(let r=0,l=o.length;r<l;r++){const n=o[r];let s=u.NotSet;if(typeof n.fontStyle=="string"){s=u.None;const g=n.fontStyle.split(" ");for(let i=0,m=g.length;i<m;i++)switch(g[i]){case"italic":s=s|u.Italic;break;case"bold":s=s|u.Bold;break;case"underline":s=s|u.Underline;break;case"strikethrough":s=s|u.Strikethrough;break}}let d=null;typeof n.foreground=="string"&&(d=n.foreground);let a=null;typeof n.background=="string"&&(a=n.background),e[t++]=new b(n.token||"",r,s,d,a)}return e}function y(o,e){o.sort((i,m)=>{const c=I(i.token,m.token);return c!==0?c:i.index-m.index});let t=u.None,r="000000",l="ffffff";for(;o.length>=1&&o[0].token==="";){const i=o.shift();i.fontStyle!==u.NotSet&&(t=i.fontStyle),i.foreground!==null&&(r=i.foreground),i.background!==null&&(l=i.background)}const n=new S;for(const i of e)n.getId(i);const s=n.getId(r),d=n.getId(l),a=new f(t,s,d),g=new p(a);for(let i=0,m=o.length;i<m;i++){const c=o[i];g.insert(c.token,c.fontStyle,n.getId(c.foreground),n.getId(c.background))}return new C(n,g)}const x=/^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/;class S{_lastColorId;_id2color;_color2id;constructor(){this._lastColorId=0,this._id2color=[],this._color2id=new Map}getId(e){if(e===null)return 0;const t=e.match(x);if(!t)throw new Error("Illegal value for token color: "+e);e=t[1].toUpperCase();let r=this._color2id.get(e);return r||(r=++this._lastColorId,this._color2id.set(e,r),this._id2color[r]=E.fromHex("#"+e),r)}getColorMap(){return this._id2color.slice(0)}}class C{static createFromRawTokenTheme(e,t){return this.createFromParsedTokenTheme(k(e),t)}static createFromParsedTokenTheme(e,t){return y(e,t)}_colorMap;_root;_cache;constructor(e,t){this._colorMap=e,this._root=t,this._cache=new Map}getColorMap(){return this._colorMap.getColorMap()}getThemeTrieElement(){return this._root.toExternalThemeTrieElement()}_match(e){return this._root.match(e)}match(e,t){let r=this._cache.get(t);if(typeof r>"u"){const l=this._match(t),n=R(t);r=(l.metadata|n<<h.TOKEN_TYPE_OFFSET)>>>0,this._cache.set(t,r)}return(r|e<<h.LANGUAGEID_OFFSET)>>>0}}const F=/\b(comment|string|regex|regexp)\b/;function R(o){const e=o.match(F);if(!e)return T.Other;switch(e[1]){case"comment":return T.Comment;case"string":return T.String;case"regex":return T.RegEx;case"regexp":return T.RegEx}throw new Error("Unexpected match for standard token type!")}function I(o,e){return o<e?-1:o>e?1:0}class f{_themeTrieElementRuleBrand=void 0;_fontStyle;_foreground;_background;metadata;constructor(e,t,r){this._fontStyle=e,this._foreground=t,this._background=r,this.metadata=(this._fontStyle<<h.FONT_STYLE_OFFSET|this._foreground<<h.FOREGROUND_OFFSET|this._background<<h.BACKGROUND_OFFSET)>>>0}clone(){return new f(this._fontStyle,this._foreground,this._background)}acceptOverwrite(e,t,r){e!==u.NotSet&&(this._fontStyle=e),t!==_.None&&(this._foreground=t),r!==_.None&&(this._background=r),this.metadata=(this._fontStyle<<h.FONT_STYLE_OFFSET|this._foreground<<h.FOREGROUND_OFFSET|this._background<<h.BACKGROUND_OFFSET)>>>0}}class w{mainRule;children;constructor(e,t=new Map){if(this.mainRule=e,t instanceof Map)this.children=t;else{this.children=new Map;for(const r in t)this.children.set(r,t[r])}}}class p{_themeTrieElementBrand=void 0;_mainRule;_children;constructor(e){this._mainRule=e,this._children=new Map}toExternalThemeTrieElement(){const e=new Map;return this._children.forEach((t,r)=>{e.set(r,t.toExternalThemeTrieElement())}),new w(this._mainRule,e)}match(e){if(e==="")return this._mainRule;const t=e.indexOf(".");let r,l;t===-1?(r=e,l=""):(r=e.substring(0,t),l=e.substring(t+1));const n=this._children.get(r);return typeof n<"u"?n.match(l):this._mainRule}insert(e,t,r,l){if(e===""){this._mainRule.acceptOverwrite(t,r,l);return}const n=e.indexOf(".");let s,d;n===-1?(s=e,d=""):(s=e.substring(0,n),d=e.substring(n+1));let a=this._children.get(s);typeof a>"u"&&(a=new p(this._mainRule.clone()),this._children.set(s,a)),a.insert(d,t,r,l)}}function N(o){const e=[];for(let t=1,r=o.length;t<r;t++){const l=o[t];e[t]=`.mtk${t} { color: ${l}; }`}return e.push(".mtki { font-style: italic; }"),e.push(".mtkb { font-weight: bold; }"),e.push(".mtku { text-decoration: underline; text-underline-position: under; }"),e.push(".mtks { text-decoration: line-through; }"),e.push(".mtks.mtku { text-decoration: underline line-through; text-underline-position: under; }"),e.join(`
`)}export{S as ColorMap,w as ExternalThemeTrieElement,b as ParsedTokenThemeRule,p as ThemeTrieElement,f as ThemeTrieElementRule,C as TokenTheme,N as generateTokensCSSForColorMap,k as parseTokenTheme,I as strcmp,R as toStandardTokenType};
