function D(_,n){let t=Math.pow(10,n);return Math.round(_*t)/t}var E=class{_rgbaBrand=void 0;r;g;b;a;constructor(n,t,i,e=1){this.r=Math.min(255,Math.max(0,n))|0,this.g=Math.min(255,Math.max(0,t))|0,this.b=Math.min(255,Math.max(0,i))|0,this.a=D(Math.max(Math.min(1,e),0),3)}static equals(n,t){return n.r===t.r&&n.g===t.g&&n.b===t.b&&n.a===t.a}},I=class _{_hslaBrand=void 0;h;s;l;a;constructor(n,t,i,e){this.h=Math.max(Math.min(360,n),0)|0,this.s=D(Math.max(Math.min(1,t),0),3),this.l=D(Math.max(Math.min(1,i),0),3),this.a=D(Math.max(Math.min(1,e),0),3)}static equals(n,t){return n.h===t.h&&n.s===t.s&&n.l===t.l&&n.a===t.a}static fromRGBA(n){let t=n.r/255,i=n.g/255,e=n.b/255,s=n.a,r=Math.max(t,i,e),m=Math.min(t,i,e),u=0,c=0,g=(m+r)/2,b=r-m;if(b>0){switch(c=Math.min(g<=.5?b/(2*g):b/(2-2*g),1),r){case t:u=(i-e)/b+(i<e?6:0);break;case i:u=(e-t)/b+2;break;case e:u=(t-i)/b+4;break}u*=60,u=Math.round(u)}return new _(u,c,g,s)}static _hue2rgb(n,t,i){return i<0&&(i+=1),i>1&&(i-=1),i<1/6?n+(t-n)*6*i:i<1/2?t:i<2/3?n+(t-n)*(2/3-i)*6:n}static toRGBA(n){let t=n.h/360,{s:i,l:e,a:s}=n,r,m,u;if(i===0)r=m=u=e;else{let c=e<.5?e*(1+i):e+i-e*i,g=2*e-c;r=_._hue2rgb(g,c,t+1/3),m=_._hue2rgb(g,c,t),u=_._hue2rgb(g,c,t-1/3)}return new E(Math.round(r*255),Math.round(m*255),Math.round(u*255),s)}},F=class _{_hsvaBrand=void 0;h;s;v;a;constructor(n,t,i,e){this.h=Math.max(Math.min(360,n),0)|0,this.s=D(Math.max(Math.min(1,t),0),3),this.v=D(Math.max(Math.min(1,i),0),3),this.a=D(Math.max(Math.min(1,e),0),3)}static equals(n,t){return n.h===t.h&&n.s===t.s&&n.v===t.v&&n.a===t.a}static fromRGBA(n){let t=n.r/255,i=n.g/255,e=n.b/255,s=Math.max(t,i,e),r=Math.min(t,i,e),m=s-r,u=s===0?0:m/s,c;return m===0?c=0:s===t?c=((i-e)/m%6+6)%6:s===i?c=(e-t)/m+2:c=(t-i)/m+4,new _(Math.round(c*60),u,s,n.a)}static toRGBA(n){let{h:t,s:i,v:e,a:s}=n,r=e*i,m=r*(1-Math.abs(t/60%2-1)),u=e-r,[c,g,b]=[0,0,0];return t<60?(c=r,g=m):t<120?(c=m,g=r):t<180?(g=r,b=m):t<240?(g=m,b=r):t<300?(c=m,b=r):t<=360&&(c=r,b=m),c=Math.round((c+u)*255),g=Math.round((g+u)*255),b=Math.round((b+u)*255),new E(c,g,b,s)}},f=class _{static fromHex(n){return _.Format.CSS.parseHex(n)||_.red}static equals(n,t){return!n&&!t?!0:!n||!t?!1:n.equals(t)}rgba;_hsla;get hsla(){return this._hsla?this._hsla:I.fromRGBA(this.rgba)}_hsva;get hsva(){return this._hsva?this._hsva:F.fromRGBA(this.rgba)}constructor(n){if(n)if(n instanceof E)this.rgba=n;else if(n instanceof I)this._hsla=n,this.rgba=I.toRGBA(n);else if(n instanceof F)this._hsva=n,this.rgba=F.toRGBA(n);else throw new Error("Invalid color ctor argument");else throw new Error("Color needs a value")}equals(n){return!!n&&E.equals(this.rgba,n.rgba)&&I.equals(this.hsla,n.hsla)&&F.equals(this.hsva,n.hsva)}getRelativeLuminance(){let n=_._relativeLuminanceForComponent(this.rgba.r),t=_._relativeLuminanceForComponent(this.rgba.g),i=_._relativeLuminanceForComponent(this.rgba.b),e=.2126*n+.7152*t+.0722*i;return D(e,4)}static _relativeLuminanceForComponent(n){let t=n/255;return t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)}getContrastRatio(n){let t=this.getRelativeLuminance(),i=n.getRelativeLuminance();return t>i?(t+.05)/(i+.05):(i+.05)/(t+.05)}isDarker(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3<128}isLighter(){return(this.rgba.r*299+this.rgba.g*587+this.rgba.b*114)/1e3>=128}isLighterThan(n){let t=this.getRelativeLuminance(),i=n.getRelativeLuminance();return t>i}isDarkerThan(n){let t=this.getRelativeLuminance(),i=n.getRelativeLuminance();return t<i}lighten(n){return new _(new I(this.hsla.h,this.hsla.s,this.hsla.l+this.hsla.l*n,this.hsla.a))}darken(n){return new _(new I(this.hsla.h,this.hsla.s,this.hsla.l-this.hsla.l*n,this.hsla.a))}transparent(n){let{r:t,g:i,b:e,a:s}=this.rgba;return new _(new E(t,i,e,s*n))}isTransparent(){return this.rgba.a===0}isOpaque(){return this.rgba.a===1}opposite(){return new _(new E(255-this.rgba.r,255-this.rgba.g,255-this.rgba.b,this.rgba.a))}blend(n){let t=n.rgba,i=this.rgba.a,e=t.a,s=i+e*(1-i);if(s<1e-6)return _.transparent;let r=this.rgba.r*i/s+t.r*e*(1-i)/s,m=this.rgba.g*i/s+t.g*e*(1-i)/s,u=this.rgba.b*i/s+t.b*e*(1-i)/s;return new _(new E(r,m,u,s))}makeOpaque(n){if(this.isOpaque()||n.rgba.a!==1)return this;let{r:t,g:i,b:e,a:s}=this.rgba;return new _(new E(n.rgba.r-s*(n.rgba.r-t),n.rgba.g-s*(n.rgba.g-i),n.rgba.b-s*(n.rgba.b-e),1))}flatten(...n){let t=n.reduceRight((i,e)=>_._flatten(e,i));return _._flatten(this,t)}static _flatten(n,t){let i=1-n.rgba.a;return new _(new E(i*t.rgba.r+n.rgba.a*n.rgba.r,i*t.rgba.g+n.rgba.a*n.rgba.g,i*t.rgba.b+n.rgba.a*n.rgba.b))}_toString;toString(){return this._toString||(this._toString=_.Format.CSS.format(this)),this._toString}static getLighterColor(n,t,i){if(n.isLighterThan(t))return n;i=i||.5;let e=n.getRelativeLuminance(),s=t.getRelativeLuminance();return i=i*(s-e)/s,n.lighten(i)}static getDarkerColor(n,t,i){if(n.isDarkerThan(t))return n;i=i||.5;let e=n.getRelativeLuminance(),s=t.getRelativeLuminance();return i=i*(e-s)/e,n.darken(i)}static white=new _(new E(255,255,255,1));static black=new _(new E(0,0,0,1));static red=new _(new E(255,0,0,1));static blue=new _(new E(0,0,255,1));static green=new _(new E(0,255,0,1));static cyan=new _(new E(0,255,255,1));static lightgrey=new _(new E(211,211,211,1));static transparent=new _(new E(0,0,0,0))};(n=>{let _;(i=>{let t;(K=>{function e(l){return l.rgba.a===1?`rgb(${l.rgba.r}, ${l.rgba.g}, ${l.rgba.b})`:n.Format.CSS.formatRGBA(l)}K.formatRGB=e;function s(l){return`rgba(${l.rgba.r}, ${l.rgba.g}, ${l.rgba.b}, ${+l.rgba.a.toFixed(2)})`}K.formatRGBA=s;function r(l){return l.hsla.a===1?`hsl(${l.hsla.h}, ${(l.hsla.s*100).toFixed(2)}%, ${(l.hsla.l*100).toFixed(2)}%)`:n.Format.CSS.formatHSLA(l)}K.formatHSL=r;function m(l){return`hsla(${l.hsla.h}, ${(l.hsla.s*100).toFixed(2)}%, ${(l.hsla.l*100).toFixed(2)}%, ${l.hsla.a.toFixed(2)})`}K.formatHSLA=m;function u(l){let T=l.toString(16);return T.length!==2?"0"+T:T}function c(l){return`#${u(l.rgba.r)}${u(l.rgba.g)}${u(l.rgba.b)}`}K.formatHex=c;function g(l,T=!1){return T&&l.rgba.a===1?n.Format.CSS.formatHex(l):`#${u(l.rgba.r)}${u(l.rgba.g)}${u(l.rgba.b)}${u(Math.round(l.rgba.a*255))}`}K.formatHexA=g;function b(l){return l.isOpaque()?n.Format.CSS.formatHex(l):n.Format.CSS.formatRGBA(l)}K.format=b;function o(l){let T=l.length;if(T===0||l.charCodeAt(0)!==35)return null;if(T===7){let R=16*A(l.charCodeAt(1))+A(l.charCodeAt(2)),x=16*A(l.charCodeAt(3))+A(l.charCodeAt(4)),U=16*A(l.charCodeAt(5))+A(l.charCodeAt(6));return new n(new E(R,x,U,1))}if(T===9){let R=16*A(l.charCodeAt(1))+A(l.charCodeAt(2)),x=16*A(l.charCodeAt(3))+A(l.charCodeAt(4)),U=16*A(l.charCodeAt(5))+A(l.charCodeAt(6)),S=16*A(l.charCodeAt(7))+A(l.charCodeAt(8));return new n(new E(R,x,U,S/255))}if(T===4){let R=A(l.charCodeAt(1)),x=A(l.charCodeAt(2)),U=A(l.charCodeAt(3));return new n(new E(16*R+R,16*x+x,16*U+U))}if(T===5){let R=A(l.charCodeAt(1)),x=A(l.charCodeAt(2)),U=A(l.charCodeAt(3)),S=A(l.charCodeAt(4));return new n(new E(16*R+R,16*x+x,16*U+U,(16*S+S)/255))}return null}K.parseHex=o;function A(l){switch(l){case 48:return 0;case 49:return 1;case 50:return 2;case 51:return 3;case 52:return 4;case 53:return 5;case 54:return 6;case 55:return 7;case 56:return 8;case 57:return 9;case 97:return 10;case 65:return 10;case 98:return 11;case 66:return 11;case 99:return 12;case 67:return 12;case 100:return 13;case 68:return 13;case 101:return 14;case 69:return 14;case 102:return 15;case 70:return 15}return 0}})(t=i.CSS||={})})(_=n.Format||={})})(f||={});var L=class{_parsedThemeRuleBrand=void 0;token;index;fontStyle;foreground;background;constructor(n,t,i,e,s){this.token=n,this.index=t,this.fontStyle=i,this.foreground=e,this.background=s}};function M(_){if(!_||!Array.isArray(_))return[];let n=[],t=0;for(let i=0,e=_.length;i<e;i++){let s=_[i],r=-1;if(typeof s.fontStyle=="string"){r=0;let c=s.fontStyle.split(" ");for(let g=0,b=c.length;g<b;g++)switch(c[g]){case"italic":r=r|1;break;case"bold":r=r|2;break;case"underline":r=r|4;break;case"strikethrough":r=r|8;break}}let m=null;typeof s.foreground=="string"&&(m=s.foreground);let u=null;typeof s.background=="string"&&(u=s.background),n[t++]=new L(s.token||"",i,r,m,u)}return n}function v(_,n){_.sort((g,b)=>{let o=H(g.token,b.token);return o!==0?o:g.index-b.index});let t=0,i="000000",e="ffffff";for(;_.length>=1&&_[0].token==="";){let g=_.shift();g.fontStyle!==-1&&(t=g.fontStyle),g.foreground!==null&&(i=g.foreground),g.background!==null&&(e=g.background)}let s=new O;for(let g of n)s.getId(g);let r=s.getId(i),m=s.getId(e),u=new B(t,r,m),c=new N(u);for(let g=0,b=_.length;g<b;g++){let o=_[g];c.insert(o.token,o.fontStyle,s.getId(o.foreground),s.getId(o.background))}return new p(s,c)}var G=/^#?([0-9A-Fa-f]{6})([0-9A-Fa-f]{2})?$/,O=class{_lastColorId;_id2color;_color2id;constructor(){this._lastColorId=0,this._id2color=[],this._color2id=new Map}getId(n){if(n===null)return 0;let t=n.match(G);if(!t)throw new Error("Illegal value for token color: "+n);n=t[1].toUpperCase();let i=this._color2id.get(n);return i||(i=++this._lastColorId,this._color2id.set(n,i),this._id2color[i]=f.fromHex("#"+n),i)}getColorMap(){return this._id2color.slice(0)}},p=class{static createFromRawTokenTheme(n,t){return this.createFromParsedTokenTheme(M(n),t)}static createFromParsedTokenTheme(n,t){return v(n,t)}_colorMap;_root;_cache;constructor(n,t){this._colorMap=n,this._root=t,this._cache=new Map}getColorMap(){return this._colorMap.getColorMap()}getThemeTrieElement(){return this._root.toExternalThemeTrieElement()}_match(n){return this._root.match(n)}match(n,t){let i=this._cache.get(t);if(typeof i>"u"){let e=this._match(t),s=k(t);i=(e.metadata|s<<8)>>>0,this._cache.set(t,i)}return(i|n<<0)>>>0}},y=/\b(comment|string|regex|regexp)\b/;function k(_){let n=_.match(y);if(!n)return 0;switch(n[1]){case"comment":return 1;case"string":return 2;case"regex":return 3;case"regexp":return 3}throw new Error("Unexpected match for standard token type!")}function H(_,n){return _<n?-1:_>n?1:0}var B=class _{_themeTrieElementRuleBrand=void 0;_fontStyle;_foreground;_background;metadata;constructor(n,t,i){this._fontStyle=n,this._foreground=t,this._background=i,this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}clone(){return new _(this._fontStyle,this._foreground,this._background)}acceptOverwrite(n,t,i){n!==-1&&(this._fontStyle=n),t!==0&&(this._foreground=t),i!==0&&(this._background=i),this.metadata=(this._fontStyle<<11|this._foreground<<15|this._background<<24)>>>0}},w=class{mainRule;children;constructor(n,t=new Map){if(this.mainRule=n,t instanceof Map)this.children=t;else{this.children=new Map;for(let i in t)this.children.set(i,t[i])}}},N=class _{_themeTrieElementBrand=void 0;_mainRule;_children;constructor(n){this._mainRule=n,this._children=new Map}toExternalThemeTrieElement(){let n=new Map;return this._children.forEach((t,i)=>{n.set(i,t.toExternalThemeTrieElement())}),new w(this._mainRule,n)}match(n){if(n==="")return this._mainRule;let t=n.indexOf("."),i,e;t===-1?(i=n,e=""):(i=n.substring(0,t),e=n.substring(t+1));let s=this._children.get(i);return typeof s<"u"?s.match(e):this._mainRule}insert(n,t,i,e){if(n===""){this._mainRule.acceptOverwrite(t,i,e);return}let s=n.indexOf("."),r,m;s===-1?(r=n,m=""):(r=n.substring(0,s),m=n.substring(s+1));let u=this._children.get(r);typeof u>"u"&&(u=new _(this._mainRule.clone()),this._children.set(r,u)),u.insert(m,t,i,e)}};function Z(_){let n=[];for(let t=1,i=_.length;t<i;t++){let e=_[t];n[t]=`.mtk${t} { color: ${e}; }`}return n.push(".mtki { font-style: italic; }"),n.push(".mtkb { font-weight: bold; }"),n.push(".mtku { text-decoration: underline; text-underline-position: under; }"),n.push(".mtks { text-decoration: line-through; }"),n.push(".mtks.mtku { text-decoration: underline line-through; text-underline-position: under; }"),n.join(`
`)}export{O as ColorMap,w as ExternalThemeTrieElement,L as ParsedTokenThemeRule,N as ThemeTrieElement,B as ThemeTrieElementRule,p as TokenTheme,Z as generateTokensCSSForColorMap,M as parseTokenTheme,H as strcmp,k as toStandardTokenType};
