{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/common/languages/supports/onEnter.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { onUnexpectedError } from \"../../../../base/common/errors.js\";\nimport * as strings from \"../../../../base/common/strings.js\";\nimport { EditorAutoIndentStrategy } from \"../../config/editorOptions.js\";\nimport {\n\ttype CharacterPair,\n\ttype EnterAction,\n\tIndentAction,\n\ttype OnEnterRule,\n} from \"../languageConfiguration.js\";\n\nexport interface IOnEnterSupportOptions {\n\tbrackets?: CharacterPair[];\n\tonEnterRules?: OnEnterRule[];\n}\n\ninterface IProcessedBracketPair {\n\topen: string;\n\tclose: string;\n\topenRegExp: RegExp;\n\tcloseRegExp: RegExp;\n}\n\nexport class OnEnterSupport {\n\tprivate readonly _brackets: IProcessedBracketPair[];\n\tprivate readonly _regExpRules: OnEnterRule[];\n\n\tconstructor(opts: IOnEnterSupportOptions) {\n\t\topts = opts || {};\n\t\topts.brackets = opts.brackets || [\n\t\t\t[\"(\", \")\"],\n\t\t\t[\"{\", \"}\"],\n\t\t\t[\"[\", \"]\"],\n\t\t];\n\n\t\tthis._brackets = [];\n\t\topts.brackets.forEach((bracket) => {\n\t\t\tconst openRegExp = OnEnterSupport._createOpenBracketRegExp(\n\t\t\t\tbracket[0],\n\t\t\t);\n\t\t\tconst closeRegExp = OnEnterSupport._createCloseBracketRegExp(\n\t\t\t\tbracket[1],\n\t\t\t);\n\t\t\tif (openRegExp && closeRegExp) {\n\t\t\t\tthis._brackets.push({\n\t\t\t\t\topen: bracket[0],\n\t\t\t\t\topenRegExp: openRegExp,\n\t\t\t\t\tclose: bracket[1],\n\t\t\t\t\tcloseRegExp: closeRegExp,\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tthis._regExpRules = opts.onEnterRules || [];\n\t}\n\n\tpublic onEnter(\n\t\tautoIndent: EditorAutoIndentStrategy,\n\t\tpreviousLineText: string,\n\t\tbeforeEnterText: string,\n\t\tafterEnterText: string,\n\t): EnterAction | null {\n\t\t// (1): `regExpRules`\n\t\tif (autoIndent >= EditorAutoIndentStrategy.Advanced) {\n\t\t\tfor (let i = 0, len = this._regExpRules.length; i < len; i++) {\n\t\t\t\tconst rule = this._regExpRules[i];\n\t\t\t\tconst regResult = [\n\t\t\t\t\t{\n\t\t\t\t\t\treg: rule.beforeText,\n\t\t\t\t\t\ttext: beforeEnterText,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\treg: rule.afterText,\n\t\t\t\t\t\ttext: afterEnterText,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\treg: rule.previousLineText,\n\t\t\t\t\t\ttext: previousLineText,\n\t\t\t\t\t},\n\t\t\t\t].every((obj): boolean => {\n\t\t\t\t\tif (!obj.reg) {\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\n\t\t\t\t\tobj.reg.lastIndex = 0; // To disable the effect of the \"g\" flag.\n\t\t\t\t\treturn obj.reg.test(obj.text);\n\t\t\t\t});\n\n\t\t\t\tif (regResult) {\n\t\t\t\t\treturn rule.action;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (2): Special indent-outdent\n\t\tif (autoIndent >= EditorAutoIndentStrategy.Brackets) {\n\t\t\tif (beforeEnterText.length > 0 && afterEnterText.length > 0) {\n\t\t\t\tfor (let i = 0, len = this._brackets.length; i < len; i++) {\n\t\t\t\t\tconst bracket = this._brackets[i];\n\t\t\t\t\tif (\n\t\t\t\t\t\tbracket.openRegExp.test(beforeEnterText) &&\n\t\t\t\t\t\tbracket.closeRegExp.test(afterEnterText)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn { indentAction: IndentAction.IndentOutdent };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// (4): Open bracket based logic\n\t\tif (autoIndent >= EditorAutoIndentStrategy.Brackets) {\n\t\t\tif (beforeEnterText.length > 0) {\n\t\t\t\tfor (let i = 0, len = this._brackets.length; i < len; i++) {\n\t\t\t\t\tconst bracket = this._brackets[i];\n\t\t\t\t\tif (bracket.openRegExp.test(beforeEnterText)) {\n\t\t\t\t\t\treturn { indentAction: IndentAction.Indent };\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t}\n\n\tprivate static _createOpenBracketRegExp(bracket: string): RegExp | null {\n\t\tlet str = strings.escapeRegExpCharacters(bracket);\n\t\tif (!/\\B/.test(str.charAt(0))) {\n\t\t\tstr = \"\\\\b\" + str;\n\t\t}\n\t\tstr += \"\\\\s*$\";\n\t\treturn OnEnterSupport._safeRegExp(str);\n\t}\n\n\tprivate static _createCloseBracketRegExp(bracket: string): RegExp | null {\n\t\tlet str = strings.escapeRegExpCharacters(bracket);\n\t\tif (!/\\B/.test(str.charAt(str.length - 1))) {\n\t\t\tstr = str + \"\\\\b\";\n\t\t}\n\t\tstr = \"^\\\\s*\" + str;\n\t\treturn OnEnterSupport._safeRegExp(str);\n\t}\n\n\tprivate static _safeRegExp(def: string): RegExp | null {\n\t\ttry {\n\t\t\treturn new RegExp(def);\n\t\t} catch (err) {\n\t\t\tonUnexpectedError(err);\n\t\t\treturn null;\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
