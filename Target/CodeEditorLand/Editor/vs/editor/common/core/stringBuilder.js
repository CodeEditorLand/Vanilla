import*as l from"../../../base/common/strings.js";import*as d from"../../../base/common/platform.js";import*as _ from"../../../base/common/buffer.js";let n;function o(){return n||(n=new TextDecoder("UTF-16LE")),n}let f;function a(){return f||(f=new TextDecoder("UTF-16BE")),f}let u;function g(){return u||(u=d.isLittleEndian()?o():a()),u}function b(i,e,t){const r=new Uint16Array(i.buffer,e,t);return t>0&&(r[0]===65279||r[0]===65534)?p(i,e,t):o().decode(r)}function p(i,e,t){const r=[];let c=0;for(let s=0;s<t;s++){const h=_.readUInt16LE(i,e);e+=2,r[c++]=String.fromCharCode(h)}return r.join("")}class m{_capacity;_buffer;_completedStrings;_bufferLength;constructor(e){this._capacity=e|0,this._buffer=new Uint16Array(this._capacity),this._completedStrings=null,this._bufferLength=0}reset(){this._completedStrings=null,this._bufferLength=0}build(){return this._completedStrings!==null?(this._flushBuffer(),this._completedStrings.join("")):this._buildBuffer()}_buildBuffer(){if(this._bufferLength===0)return"";const e=new Uint16Array(this._buffer.buffer,0,this._bufferLength);return g().decode(e)}_flushBuffer(){const e=this._buildBuffer();this._bufferLength=0,this._completedStrings===null?this._completedStrings=[e]:this._completedStrings[this._completedStrings.length]=e}appendCharCode(e){const t=this._capacity-this._bufferLength;t<=1&&(t===0||l.isHighSurrogate(e))&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendASCIICharCode(e){this._bufferLength===this._capacity&&this._flushBuffer(),this._buffer[this._bufferLength++]=e}appendString(e){const t=e.length;if(this._bufferLength+t>=this._capacity){this._flushBuffer(),this._completedStrings[this._completedStrings.length]=e;return}for(let r=0;r<t;r++)this._buffer[this._bufferLength++]=e.charCodeAt(r)}}export{m as StringBuilder,b as decodeUTF16LE,g as getPlatformTextDecoder};
