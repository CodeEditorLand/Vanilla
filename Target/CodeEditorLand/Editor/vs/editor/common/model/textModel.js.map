{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/common/model/textModel.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ArrayQueue, pushMany } from '../../../base/common/arrays.js';\nimport { VSBuffer, VSBufferReadableStream } from '../../../base/common/buffer.js';\nimport { Color } from '../../../base/common/color.js';\nimport { BugIndicatingError, illegalArgument, onUnexpectedError } from '../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IMarkdownString } from '../../../base/common/htmlContent.js';\nimport { Disposable, IDisposable, MutableDisposable, combinedDisposable } from '../../../base/common/lifecycle.js';\nimport { listenStream } from '../../../base/common/stream.js';\nimport * as strings from '../../../base/common/strings.js';\nimport { ThemeColor } from '../../../base/common/themables.js';\nimport { Constants } from '../../../base/common/uint.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ISingleEditOperation } from '../core/editOperation.js';\nimport { countEOL } from '../core/eolCounter.js';\nimport { normalizeIndentation } from '../core/indentation.js';\nimport { IPosition, Position } from '../core/position.js';\nimport { IRange, Range } from '../core/range.js';\nimport { Selection } from '../core/selection.js';\nimport { TextChange } from '../core/textChange.js';\nimport { EDITOR_MODEL_DEFAULTS } from '../core/textModelDefaults.js';\nimport { IWordAtPosition } from '../core/wordHelper.js';\nimport { FormattingOptions } from '../languages.js';\nimport { ILanguageSelection, ILanguageService } from '../languages/language.js';\nimport { ILanguageConfigurationService } from '../languages/languageConfigurationRegistry.js';\nimport * as model from '../model.js';\nimport { BracketPairsTextModelPart } from './bracketPairsTextModelPart/bracketPairsImpl.js';\nimport { ColorizedBracketPairsDecorationProvider } from './bracketPairsTextModelPart/colorizedBracketPairsDecorationProvider.js';\nimport { EditStack } from './editStack.js';\nimport { GuidesTextModelPart } from './guidesTextModelPart.js';\nimport { guessIndentation } from './indentationGuesser.js';\nimport { IntervalNode, IntervalTree, recomputeMaxEnd } from './intervalTree.js';\nimport { PieceTreeTextBuffer } from './pieceTreeTextBuffer/pieceTreeTextBuffer.js';\nimport { PieceTreeTextBufferBuilder } from './pieceTreeTextBuffer/pieceTreeTextBufferBuilder.js';\nimport { SearchParams, TextModelSearch } from './textModelSearch.js';\nimport { TokenizationTextModelPart } from './tokenizationTextModelPart.js';\nimport { AttachedViews } from './tokens.js';\nimport { IBracketPairsTextModelPart } from '../textModelBracketPairs.js';\nimport { IModelContentChangedEvent, IModelDecorationsChangedEvent, IModelOptionsChangedEvent, InternalModelContentChangeEvent, LineInjectedText, ModelInjectedTextChangedEvent, ModelRawChange, ModelRawContentChangedEvent, ModelRawEOLChanged, ModelRawFlush, ModelRawLineChanged, ModelRawLinesDeleted, ModelRawLinesInserted } from '../textModelEvents.js';\nimport { IGuidesTextModelPart } from '../textModelGuides.js';\nimport { ITokenizationTextModelPart } from '../tokenizationTextModelPart.js';\nimport { IInstantiationService } from '../../../platform/instantiation/common/instantiation.js';\nimport { IColorTheme } from '../../../platform/theme/common/themeService.js';\nimport { IUndoRedoService, ResourceEditStackSnapshot, UndoRedoGroup } from '../../../platform/undoRedo/common/undoRedo.js';\nimport { TokenArray } from '../tokens/tokenArray.js';\n\nexport function createTextBufferFactory(text: string): model.ITextBufferFactory {\n\tconst builder = new PieceTreeTextBufferBuilder();\n\tbuilder.acceptChunk(text);\n\treturn builder.finish();\n}\n\ninterface ITextStream {\n\ton(event: 'data', callback: (data: string) => void): void;\n\ton(event: 'error', callback: (err: Error) => void): void;\n\ton(event: 'end', callback: () => void): void;\n\ton(event: string, callback: any): void;\n}\n\nexport function createTextBufferFactoryFromStream(stream: ITextStream): Promise<model.ITextBufferFactory>;\nexport function createTextBufferFactoryFromStream(stream: VSBufferReadableStream): Promise<model.ITextBufferFactory>;\nexport function createTextBufferFactoryFromStream(stream: ITextStream | VSBufferReadableStream): Promise<model.ITextBufferFactory> {\n\treturn new Promise<model.ITextBufferFactory>((resolve, reject) => {\n\t\tconst builder = new PieceTreeTextBufferBuilder();\n\n\t\tlet done = false;\n\n\t\tlistenStream<string | VSBuffer>(stream, {\n\t\t\tonData: chunk => {\n\t\t\t\tbuilder.acceptChunk((typeof chunk === 'string') ? chunk : chunk.toString());\n\t\t\t},\n\t\t\tonError: error => {\n\t\t\t\tif (!done) {\n\t\t\t\t\tdone = true;\n\t\t\t\t\treject(error);\n\t\t\t\t}\n\t\t\t},\n\t\t\tonEnd: () => {\n\t\t\t\tif (!done) {\n\t\t\t\t\tdone = true;\n\t\t\t\t\tresolve(builder.finish());\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n}\n\nexport function createTextBufferFactoryFromSnapshot(snapshot: model.ITextSnapshot): model.ITextBufferFactory {\n\tconst builder = new PieceTreeTextBufferBuilder();\n\n\tlet chunk: string | null;\n\twhile (typeof (chunk = snapshot.read()) === 'string') {\n\t\tbuilder.acceptChunk(chunk);\n\t}\n\n\treturn builder.finish();\n}\n\nexport function createTextBuffer(value: string | model.ITextBufferFactory | model.ITextSnapshot, defaultEOL: model.DefaultEndOfLine): { textBuffer: model.ITextBuffer; disposable: IDisposable } {\n\tlet factory: model.ITextBufferFactory;\n\tif (typeof value === 'string') {\n\t\tfactory = createTextBufferFactory(value);\n\t} else if (model.isITextSnapshot(value)) {\n\t\tfactory = createTextBufferFactoryFromSnapshot(value);\n\t} else {\n\t\tfactory = value;\n\t}\n\treturn factory.create(defaultEOL);\n}\n\nlet MODEL_ID = 0;\n\nconst LIMIT_FIND_COUNT = 999;\nconst LONG_LINE_BOUNDARY = 10000;\n\nclass TextModelSnapshot implements model.ITextSnapshot {\n\n\tprivate readonly _source: model.ITextSnapshot;\n\tprivate _eos: boolean;\n\n\tconstructor(source: model.ITextSnapshot) {\n\t\tthis._source = source;\n\t\tthis._eos = false;\n\t}\n\n\tpublic read(): string | null {\n\t\tif (this._eos) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst result: string[] = [];\n\t\tlet resultCnt = 0;\n\t\tlet resultLength = 0;\n\n\t\tdo {\n\t\t\tconst tmp = this._source.read();\n\n\t\t\tif (tmp === null) {\n\t\t\t\t// end-of-stream\n\t\t\t\tthis._eos = true;\n\t\t\t\tif (resultCnt === 0) {\n\t\t\t\t\treturn null;\n\t\t\t\t} else {\n\t\t\t\t\treturn result.join('');\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (tmp.length > 0) {\n\t\t\t\tresult[resultCnt++] = tmp;\n\t\t\t\tresultLength += tmp.length;\n\t\t\t}\n\n\t\t\tif (resultLength >= 64 * 1024) {\n\t\t\t\treturn result.join('');\n\t\t\t}\n\t\t} while (true);\n\t}\n}\n\nconst invalidFunc = () => { throw new Error(`Invalid change accessor`); };\n\nconst enum StringOffsetValidationType {\n\t/**\n\t * Even allowed in surrogate pairs\n\t */\n\tRelaxed = 0,\n\t/**\n\t * Not allowed in surrogate pairs\n\t */\n\tSurrogatePairs = 1,\n}\n\nexport class TextModel extends Disposable implements model.ITextModel, IDecorationsTreesHost {\n\n\tstatic _MODEL_SYNC_LIMIT = 50 * 1024 * 1024; // 50 MB,  // used in tests\n\tprivate static readonly LARGE_FILE_SIZE_THRESHOLD = 20 * 1024 * 1024; // 20 MB;\n\tprivate static readonly LARGE_FILE_LINE_COUNT_THRESHOLD = 300 * 1000; // 300K lines\n\tprivate static readonly LARGE_FILE_HEAP_OPERATION_THRESHOLD = 256 * 1024 * 1024; // 256M characters, usually ~> 512MB memory usage\n\n\tpublic static DEFAULT_CREATION_OPTIONS: model.ITextModelCreationOptions = {\n\t\tisForSimpleWidget: false,\n\t\ttabSize: EDITOR_MODEL_DEFAULTS.tabSize,\n\t\tindentSize: EDITOR_MODEL_DEFAULTS.indentSize,\n\t\tinsertSpaces: EDITOR_MODEL_DEFAULTS.insertSpaces,\n\t\tdetectIndentation: false,\n\t\tdefaultEOL: model.DefaultEndOfLine.LF,\n\t\ttrimAutoWhitespace: EDITOR_MODEL_DEFAULTS.trimAutoWhitespace,\n\t\tlargeFileOptimizations: EDITOR_MODEL_DEFAULTS.largeFileOptimizations,\n\t\tbracketPairColorizationOptions: EDITOR_MODEL_DEFAULTS.bracketPairColorizationOptions,\n\t};\n\n\tpublic static resolveOptions(textBuffer: model.ITextBuffer, options: model.ITextModelCreationOptions): model.TextModelResolvedOptions {\n\t\tif (options.detectIndentation) {\n\t\t\tconst guessedIndentation = guessIndentation(textBuffer, options.tabSize, options.insertSpaces);\n\t\t\treturn new model.TextModelResolvedOptions({\n\t\t\t\ttabSize: guessedIndentation.tabSize,\n\t\t\t\tindentSize: 'tabSize', // TODO@Alex: guess indentSize independent of tabSize\n\t\t\t\tinsertSpaces: guessedIndentation.insertSpaces,\n\t\t\t\ttrimAutoWhitespace: options.trimAutoWhitespace,\n\t\t\t\tdefaultEOL: options.defaultEOL,\n\t\t\t\tbracketPairColorizationOptions: options.bracketPairColorizationOptions,\n\t\t\t});\n\t\t}\n\n\t\treturn new model.TextModelResolvedOptions(options);\n\t}\n\n\t//#region Events\n\tprivate readonly _onWillDispose: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onWillDispose: Event<void> = this._onWillDispose.event;\n\n\tprivate readonly _onDidChangeDecorations: DidChangeDecorationsEmitter = this._register(new DidChangeDecorationsEmitter(affectedInjectedTextLines => this.handleBeforeFireDecorationsChangedEvent(affectedInjectedTextLines)));\n\tpublic readonly onDidChangeDecorations: Event<IModelDecorationsChangedEvent> = this._onDidChangeDecorations.event;\n\n\tpublic get onDidChangeLanguage() { return this._tokenizationTextModelPart.onDidChangeLanguage; }\n\tpublic get onDidChangeLanguageConfiguration() { return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration; }\n\tpublic get onDidChangeTokens() { return this._tokenizationTextModelPart.onDidChangeTokens; }\n\n\tprivate readonly _onDidChangeOptions: Emitter<IModelOptionsChangedEvent> = this._register(new Emitter<IModelOptionsChangedEvent>());\n\tpublic readonly onDidChangeOptions: Event<IModelOptionsChangedEvent> = this._onDidChangeOptions.event;\n\n\tprivate readonly _onDidChangeAttached: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeAttached: Event<void> = this._onDidChangeAttached.event;\n\n\tprivate readonly _onDidChangeInjectedText: Emitter<ModelInjectedTextChangedEvent> = this._register(new Emitter<ModelInjectedTextChangedEvent>());\n\n\tprivate readonly _eventEmitter: DidChangeContentEmitter = this._register(new DidChangeContentEmitter());\n\tpublic onDidChangeContent(listener: (e: IModelContentChangedEvent) => void): IDisposable {\n\t\treturn this._eventEmitter.slowEvent((e: InternalModelContentChangeEvent) => listener(e.contentChangedEvent));\n\t}\n\tpublic onDidChangeContentOrInjectedText(listener: (e: InternalModelContentChangeEvent | ModelInjectedTextChangedEvent) => void): IDisposable {\n\t\treturn combinedDisposable(\n\t\t\tthis._eventEmitter.fastEvent(e => listener(e)),\n\t\t\tthis._onDidChangeInjectedText.event(e => listener(e))\n\t\t);\n\t}\n\t//#endregion\n\n\tpublic readonly id: string;\n\tpublic readonly isForSimpleWidget: boolean;\n\tprivate readonly _associatedResource: URI;\n\tprivate _attachedEditorCount: number;\n\tprivate _buffer: model.ITextBuffer;\n\tprivate _bufferDisposable: IDisposable;\n\tprivate _options: model.TextModelResolvedOptions;\n\tprivate readonly _languageSelectionListener = this._register(new MutableDisposable<IDisposable>());\n\n\tprivate _isDisposed: boolean;\n\tprivate __isDisposing: boolean;\n\tpublic _isDisposing(): boolean { return this.__isDisposing; }\n\tprivate _versionId: number;\n\t/**\n\t * Unlike, versionId, this can go down (via undo) or go to previous values (via redo)\n\t */\n\tprivate _alternativeVersionId: number;\n\tprivate _initialUndoRedoSnapshot: ResourceEditStackSnapshot | null;\n\tprivate readonly _isTooLargeForSyncing: boolean;\n\tprivate readonly _isTooLargeForTokenization: boolean;\n\tprivate readonly _isTooLargeForHeapOperation: boolean;\n\n\t//#region Editing\n\tprivate readonly _commandManager: EditStack;\n\tprivate _isUndoing: boolean;\n\tprivate _isRedoing: boolean;\n\tprivate _trimAutoWhitespaceLines: number[] | null;\n\t//#endregion\n\n\t//#region Decorations\n\t/**\n\t * Used to workaround broken clients that might attempt using a decoration id generated by a different model.\n\t * It is not globally unique in order to limit it to one character.\n\t */\n\tprivate readonly _instanceId: string;\n\tprivate _deltaDecorationCallCnt: number = 0;\n\tprivate _lastDecorationId: number;\n\tprivate _decorations: { [decorationId: string]: IntervalNode };\n\tprivate _decorationsTree: DecorationsTrees;\n\tprivate readonly _decorationProvider: ColorizedBracketPairsDecorationProvider;\n\t//#endregion\n\n\tprivate readonly _tokenizationTextModelPart: TokenizationTextModelPart;\n\tpublic get tokenization(): ITokenizationTextModelPart { return this._tokenizationTextModelPart; }\n\n\tprivate readonly _bracketPairs: BracketPairsTextModelPart;\n\tpublic get bracketPairs(): IBracketPairsTextModelPart { return this._bracketPairs; }\n\n\tprivate readonly _guidesTextModelPart: GuidesTextModelPart;\n\tpublic get guides(): IGuidesTextModelPart { return this._guidesTextModelPart; }\n\n\tprivate readonly _attachedViews = new AttachedViews();\n\n\tconstructor(\n\t\tsource: string | model.ITextBufferFactory,\n\t\tlanguageIdOrSelection: string | ILanguageSelection,\n\t\tcreationOptions: model.ITextModelCreationOptions,\n\t\tassociatedResource: URI | null = null,\n\t\t@IUndoRedoService private readonly _undoRedoService: IUndoRedoService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\n\t\t// Generate a new unique model id\n\t\tMODEL_ID++;\n\t\tthis.id = '$model' + MODEL_ID;\n\t\tthis.isForSimpleWidget = creationOptions.isForSimpleWidget;\n\t\tif (typeof associatedResource === 'undefined' || associatedResource === null) {\n\t\t\tthis._associatedResource = URI.parse('inmemory://model/' + MODEL_ID);\n\t\t} else {\n\t\t\tthis._associatedResource = associatedResource;\n\t\t}\n\t\tthis._attachedEditorCount = 0;\n\n\t\tconst { textBuffer, disposable } = createTextBuffer(source, creationOptions.defaultEOL);\n\t\tthis._buffer = textBuffer;\n\t\tthis._bufferDisposable = disposable;\n\n\t\tthis._options = TextModel.resolveOptions(this._buffer, creationOptions);\n\n\t\tconst languageId = (typeof languageIdOrSelection === 'string' ? languageIdOrSelection : languageIdOrSelection.languageId);\n\t\tif (typeof languageIdOrSelection !== 'string') {\n\t\t\tthis._languageSelectionListener.value = languageIdOrSelection.onDidChange(() => this._setLanguage(languageIdOrSelection.languageId));\n\t\t}\n\n\t\tthis._bracketPairs = this._register(new BracketPairsTextModelPart(this, this._languageConfigurationService));\n\t\tthis._guidesTextModelPart = this._register(new GuidesTextModelPart(this, this._languageConfigurationService));\n\t\tthis._decorationProvider = this._register(new ColorizedBracketPairsDecorationProvider(this));\n\t\tthis._tokenizationTextModelPart = this.instantiationService.createInstance(TokenizationTextModelPart,\n\t\t\tthis,\n\t\t\tthis._bracketPairs,\n\t\t\tlanguageId,\n\t\t\tthis._attachedViews\n\t\t);\n\n\t\tconst bufferLineCount = this._buffer.getLineCount();\n\t\tconst bufferTextLength = this._buffer.getValueLengthInRange(new Range(1, 1, bufferLineCount, this._buffer.getLineLength(bufferLineCount) + 1), model.EndOfLinePreference.TextDefined);\n\n\t\t// !!! Make a decision in the ctor and permanently respect this decision !!!\n\t\t// If a model is too large at construction time, it will never get tokenized,\n\t\t// under no circumstances.\n\t\tif (creationOptions.largeFileOptimizations) {\n\t\t\tthis._isTooLargeForTokenization = (\n\t\t\t\t(bufferTextLength > TextModel.LARGE_FILE_SIZE_THRESHOLD)\n\t\t\t\t|| (bufferLineCount > TextModel.LARGE_FILE_LINE_COUNT_THRESHOLD)\n\t\t\t);\n\n\t\t\tthis._isTooLargeForHeapOperation = bufferTextLength > TextModel.LARGE_FILE_HEAP_OPERATION_THRESHOLD;\n\t\t} else {\n\t\t\tthis._isTooLargeForTokenization = false;\n\t\t\tthis._isTooLargeForHeapOperation = false;\n\t\t}\n\n\t\tthis._isTooLargeForSyncing = (bufferTextLength > TextModel._MODEL_SYNC_LIMIT);\n\n\t\tthis._versionId = 1;\n\t\tthis._alternativeVersionId = 1;\n\t\tthis._initialUndoRedoSnapshot = null;\n\n\t\tthis._isDisposed = false;\n\t\tthis.__isDisposing = false;\n\n\t\tthis._instanceId = strings.singleLetterHash(MODEL_ID);\n\t\tthis._lastDecorationId = 0;\n\t\tthis._decorations = Object.create(null);\n\t\tthis._decorationsTree = new DecorationsTrees();\n\n\t\tthis._commandManager = new EditStack(this, this._undoRedoService);\n\t\tthis._isUndoing = false;\n\t\tthis._isRedoing = false;\n\t\tthis._trimAutoWhitespaceLines = null;\n\n\n\t\tthis._register(this._decorationProvider.onDidChange(() => {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\tthis._onDidChangeDecorations.fire();\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}));\n\n\t\tthis._languageService.requestRichLanguageFeatures(languageId);\n\n\t\tthis._register(this._languageConfigurationService.onDidChange(e => {\n\t\t\tthis._bracketPairs.handleLanguageConfigurationServiceChange(e);\n\t\t\tthis._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(e);\n\t\t}));\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.__isDisposing = true;\n\t\tthis._onWillDispose.fire();\n\t\tthis._tokenizationTextModelPart.dispose();\n\t\tthis._isDisposed = true;\n\t\tsuper.dispose();\n\t\tthis._bufferDisposable.dispose();\n\t\tthis.__isDisposing = false;\n\t\t// Manually release reference to previous text buffer to avoid large leaks\n\t\t// in case someone leaks a TextModel reference\n\t\tconst emptyDisposedTextBuffer = new PieceTreeTextBuffer([], '', '\\n', false, false, true, true);\n\t\temptyDisposedTextBuffer.dispose();\n\t\tthis._buffer = emptyDisposedTextBuffer;\n\t\tthis._bufferDisposable = Disposable.None;\n\t}\n\n\t_hasListeners(): boolean {\n\t\treturn (\n\t\t\tthis._onWillDispose.hasListeners()\n\t\t\t|| this._onDidChangeDecorations.hasListeners()\n\t\t\t|| this._tokenizationTextModelPart._hasListeners()\n\t\t\t|| this._onDidChangeOptions.hasListeners()\n\t\t\t|| this._onDidChangeAttached.hasListeners()\n\t\t\t|| this._onDidChangeInjectedText.hasListeners()\n\t\t\t|| this._eventEmitter.hasListeners()\n\t\t);\n\t}\n\n\tprivate _assertNotDisposed(): void {\n\t\tif (this._isDisposed) {\n\t\t\tthrow new BugIndicatingError('Model is disposed!');\n\t\t}\n\t}\n\n\tpublic equalsTextBuffer(other: model.ITextBuffer): boolean {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.equals(other);\n\t}\n\n\tpublic getTextBuffer(): model.ITextBuffer {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer;\n\t}\n\n\tprivate _emitContentChangedEvent(rawChange: ModelRawContentChangedEvent, change: IModelContentChangedEvent): void {\n\t\tif (this.__isDisposing) {\n\t\t\t// Do not confuse listeners by emitting any event after disposing\n\t\t\treturn;\n\t\t}\n\t\tthis._tokenizationTextModelPart.handleDidChangeContent(change);\n\t\tthis._bracketPairs.handleDidChangeContent(change);\n\t\tthis._eventEmitter.fire(new InternalModelContentChangeEvent(rawChange, change));\n\t}\n\n\tpublic setValue(value: string | model.ITextSnapshot): void {\n\t\tthis._assertNotDisposed();\n\n\t\tif (value === null || value === undefined) {\n\t\t\tthrow illegalArgument();\n\t\t}\n\n\t\tconst { textBuffer, disposable } = createTextBuffer(value, this._options.defaultEOL);\n\t\tthis._setValueFromTextBuffer(textBuffer, disposable);\n\t}\n\n\tprivate _createContentChanged2(range: Range, rangeOffset: number, rangeLength: number, text: string, isUndoing: boolean, isRedoing: boolean, isFlush: boolean, isEolChange: boolean): IModelContentChangedEvent {\n\t\treturn {\n\t\t\tchanges: [{\n\t\t\t\trange: range,\n\t\t\t\trangeOffset: rangeOffset,\n\t\t\t\trangeLength: rangeLength,\n\t\t\t\ttext: text,\n\t\t\t}],\n\t\t\teol: this._buffer.getEOL(),\n\t\t\tisEolChange: isEolChange,\n\t\t\tversionId: this.getVersionId(),\n\t\t\tisUndoing: isUndoing,\n\t\t\tisRedoing: isRedoing,\n\t\t\tisFlush: isFlush\n\t\t};\n\t}\n\n\tprivate _setValueFromTextBuffer(textBuffer: model.ITextBuffer, textBufferDisposable: IDisposable): void {\n\t\tthis._assertNotDisposed();\n\t\tconst oldFullModelRange = this.getFullModelRange();\n\t\tconst oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n\t\tconst endLineNumber = this.getLineCount();\n\t\tconst endColumn = this.getLineMaxColumn(endLineNumber);\n\n\t\tthis._buffer = textBuffer;\n\t\tthis._bufferDisposable.dispose();\n\t\tthis._bufferDisposable = textBufferDisposable;\n\t\tthis._increaseVersionId();\n\n\t\t// Destroy all my decorations\n\t\tthis._decorations = Object.create(null);\n\t\tthis._decorationsTree = new DecorationsTrees();\n\n\t\t// Destroy my edit history and settings\n\t\tthis._commandManager.clear();\n\t\tthis._trimAutoWhitespaceLines = null;\n\n\t\tthis._emitContentChangedEvent(\n\t\t\tnew ModelRawContentChangedEvent(\n\t\t\t\t[\n\t\t\t\t\tnew ModelRawFlush()\n\t\t\t\t],\n\t\t\t\tthis._versionId,\n\t\t\t\tfalse,\n\t\t\t\tfalse\n\t\t\t),\n\t\t\tthis._createContentChanged2(new Range(1, 1, endLineNumber, endColumn), 0, oldModelValueLength, this.getValue(), false, false, true, false)\n\t\t);\n\t}\n\n\tpublic setEOL(eol: model.EndOfLineSequence): void {\n\t\tthis._assertNotDisposed();\n\t\tconst newEOL = (eol === model.EndOfLineSequence.CRLF ? '\\r\\n' : '\\n');\n\t\tif (this._buffer.getEOL() === newEOL) {\n\t\t\t// Nothing to do\n\t\t\treturn;\n\t\t}\n\n\t\tconst oldFullModelRange = this.getFullModelRange();\n\t\tconst oldModelValueLength = this.getValueLengthInRange(oldFullModelRange);\n\t\tconst endLineNumber = this.getLineCount();\n\t\tconst endColumn = this.getLineMaxColumn(endLineNumber);\n\n\t\tthis._onBeforeEOLChange();\n\t\tthis._buffer.setEOL(newEOL);\n\t\tthis._increaseVersionId();\n\t\tthis._onAfterEOLChange();\n\n\t\tthis._emitContentChangedEvent(\n\t\t\tnew ModelRawContentChangedEvent(\n\t\t\t\t[\n\t\t\t\t\tnew ModelRawEOLChanged()\n\t\t\t\t],\n\t\t\t\tthis._versionId,\n\t\t\t\tfalse,\n\t\t\t\tfalse\n\t\t\t),\n\t\t\tthis._createContentChanged2(new Range(1, 1, endLineNumber, endColumn), 0, oldModelValueLength, this.getValue(), false, false, false, true)\n\t\t);\n\t}\n\n\tprivate _onBeforeEOLChange(): void {\n\t\t// Ensure all decorations get their `range` set.\n\t\tthis._decorationsTree.ensureAllNodesHaveRanges(this);\n\t}\n\n\tprivate _onAfterEOLChange(): void {\n\t\t// Transform back `range` to offsets\n\t\tconst versionId = this.getVersionId();\n\t\tconst allDecorations = this._decorationsTree.collectNodesPostOrder();\n\t\tfor (let i = 0, len = allDecorations.length; i < len; i++) {\n\t\t\tconst node = allDecorations[i];\n\t\t\tconst range = node.range!; // the range is defined due to `_onBeforeEOLChange`\n\n\t\t\tconst delta = node.cachedAbsoluteStart - node.start;\n\n\t\t\tconst startOffset = this._buffer.getOffsetAt(range.startLineNumber, range.startColumn);\n\t\t\tconst endOffset = this._buffer.getOffsetAt(range.endLineNumber, range.endColumn);\n\n\t\t\tnode.cachedAbsoluteStart = startOffset;\n\t\t\tnode.cachedAbsoluteEnd = endOffset;\n\t\t\tnode.cachedVersionId = versionId;\n\n\t\t\tnode.start = startOffset - delta;\n\t\t\tnode.end = endOffset - delta;\n\n\t\t\trecomputeMaxEnd(node);\n\t\t}\n\t}\n\n\tpublic onBeforeAttached(): model.IAttachedView {\n\t\tthis._attachedEditorCount++;\n\t\tif (this._attachedEditorCount === 1) {\n\t\t\tthis._tokenizationTextModelPart.handleDidChangeAttached();\n\t\t\tthis._onDidChangeAttached.fire(undefined);\n\t\t}\n\t\treturn this._attachedViews.attachView();\n\t}\n\n\tpublic onBeforeDetached(view: model.IAttachedView): void {\n\t\tthis._attachedEditorCount--;\n\t\tif (this._attachedEditorCount === 0) {\n\t\t\tthis._tokenizationTextModelPart.handleDidChangeAttached();\n\t\t\tthis._onDidChangeAttached.fire(undefined);\n\t\t}\n\t\tthis._attachedViews.detachView(view);\n\t}\n\n\tpublic isAttachedToEditor(): boolean {\n\t\treturn this._attachedEditorCount > 0;\n\t}\n\n\tpublic getAttachedEditorCount(): number {\n\t\treturn this._attachedEditorCount;\n\t}\n\n\tpublic isTooLargeForSyncing(): boolean {\n\t\treturn this._isTooLargeForSyncing;\n\t}\n\n\tpublic isTooLargeForTokenization(): boolean {\n\t\treturn this._isTooLargeForTokenization;\n\t}\n\n\tpublic isTooLargeForHeapOperation(): boolean {\n\t\treturn this._isTooLargeForHeapOperation;\n\t}\n\n\tpublic isDisposed(): boolean {\n\t\treturn this._isDisposed;\n\t}\n\n\tpublic isDominatedByLongLines(): boolean {\n\t\tthis._assertNotDisposed();\n\t\tif (this.isTooLargeForTokenization()) {\n\t\t\t// Cannot word wrap huge files anyways, so it doesn't really matter\n\t\t\treturn false;\n\t\t}\n\t\tlet smallLineCharCount = 0;\n\t\tlet longLineCharCount = 0;\n\n\t\tconst lineCount = this._buffer.getLineCount();\n\t\tfor (let lineNumber = 1; lineNumber <= lineCount; lineNumber++) {\n\t\t\tconst lineLength = this._buffer.getLineLength(lineNumber);\n\t\t\tif (lineLength >= LONG_LINE_BOUNDARY) {\n\t\t\t\tlongLineCharCount += lineLength;\n\t\t\t} else {\n\t\t\t\tsmallLineCharCount += lineLength;\n\t\t\t}\n\t\t}\n\n\t\treturn (longLineCharCount > smallLineCharCount);\n\t}\n\n\tpublic get uri(): URI {\n\t\treturn this._associatedResource;\n\t}\n\n\t//#region Options\n\n\tpublic getOptions(): model.TextModelResolvedOptions {\n\t\tthis._assertNotDisposed();\n\t\treturn this._options;\n\t}\n\n\tpublic getFormattingOptions(): FormattingOptions {\n\t\treturn {\n\t\t\ttabSize: this._options.indentSize,\n\t\t\tinsertSpaces: this._options.insertSpaces\n\t\t};\n\t}\n\n\tpublic updateOptions(_newOpts: model.ITextModelUpdateOptions): void {\n\t\tthis._assertNotDisposed();\n\t\tconst tabSize = (typeof _newOpts.tabSize !== 'undefined') ? _newOpts.tabSize : this._options.tabSize;\n\t\tconst indentSize = (typeof _newOpts.indentSize !== 'undefined') ? _newOpts.indentSize : this._options.originalIndentSize;\n\t\tconst insertSpaces = (typeof _newOpts.insertSpaces !== 'undefined') ? _newOpts.insertSpaces : this._options.insertSpaces;\n\t\tconst trimAutoWhitespace = (typeof _newOpts.trimAutoWhitespace !== 'undefined') ? _newOpts.trimAutoWhitespace : this._options.trimAutoWhitespace;\n\t\tconst bracketPairColorizationOptions = (typeof _newOpts.bracketColorizationOptions !== 'undefined') ? _newOpts.bracketColorizationOptions : this._options.bracketPairColorizationOptions;\n\n\t\tconst newOpts = new model.TextModelResolvedOptions({\n\t\t\ttabSize: tabSize,\n\t\t\tindentSize: indentSize,\n\t\t\tinsertSpaces: insertSpaces,\n\t\t\tdefaultEOL: this._options.defaultEOL,\n\t\t\ttrimAutoWhitespace: trimAutoWhitespace,\n\t\t\tbracketPairColorizationOptions,\n\t\t});\n\n\t\tif (this._options.equals(newOpts)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst e = this._options.createChangeEvent(newOpts);\n\t\tthis._options = newOpts;\n\n\t\tthis._bracketPairs.handleDidChangeOptions(e);\n\t\tthis._decorationProvider.handleDidChangeOptions(e);\n\t\tthis._onDidChangeOptions.fire(e);\n\t}\n\n\tpublic detectIndentation(defaultInsertSpaces: boolean, defaultTabSize: number): void {\n\t\tthis._assertNotDisposed();\n\t\tconst guessedIndentation = guessIndentation(this._buffer, defaultTabSize, defaultInsertSpaces);\n\t\tthis.updateOptions({\n\t\t\tinsertSpaces: guessedIndentation.insertSpaces,\n\t\t\ttabSize: guessedIndentation.tabSize,\n\t\t\tindentSize: guessedIndentation.tabSize, // TODO@Alex: guess indentSize independent of tabSize\n\t\t});\n\t}\n\n\tpublic normalizeIndentation(str: string): string {\n\t\tthis._assertNotDisposed();\n\t\treturn normalizeIndentation(str, this._options.indentSize, this._options.insertSpaces);\n\t}\n\n\t//#endregion\n\n\t//#region Reading\n\n\tpublic getVersionId(): number {\n\t\tthis._assertNotDisposed();\n\t\treturn this._versionId;\n\t}\n\n\tpublic mightContainRTL(): boolean {\n\t\treturn this._buffer.mightContainRTL();\n\t}\n\n\tpublic mightContainUnusualLineTerminators(): boolean {\n\t\treturn this._buffer.mightContainUnusualLineTerminators();\n\t}\n\n\tpublic removeUnusualLineTerminators(selections: Selection[] | null = null): void {\n\t\tconst matches = this.findMatches(strings.UNUSUAL_LINE_TERMINATORS.source, false, true, false, null, false, Constants.MAX_SAFE_SMALL_INTEGER);\n\t\tthis._buffer.resetMightContainUnusualLineTerminators();\n\t\tthis.pushEditOperations(selections, matches.map(m => ({ range: m.range, text: null })), () => null);\n\t}\n\n\tpublic mightContainNonBasicASCII(): boolean {\n\t\treturn this._buffer.mightContainNonBasicASCII();\n\t}\n\n\tpublic getAlternativeVersionId(): number {\n\t\tthis._assertNotDisposed();\n\t\treturn this._alternativeVersionId;\n\t}\n\n\tpublic getInitialUndoRedoSnapshot(): ResourceEditStackSnapshot | null {\n\t\tthis._assertNotDisposed();\n\t\treturn this._initialUndoRedoSnapshot;\n\t}\n\n\tpublic getOffsetAt(rawPosition: IPosition): number {\n\t\tthis._assertNotDisposed();\n\t\tconst position = this._validatePosition(rawPosition.lineNumber, rawPosition.column, StringOffsetValidationType.Relaxed);\n\t\treturn this._buffer.getOffsetAt(position.lineNumber, position.column);\n\t}\n\n\tpublic getPositionAt(rawOffset: number): Position {\n\t\tthis._assertNotDisposed();\n\t\tconst offset = (Math.min(this._buffer.getLength(), Math.max(0, rawOffset)));\n\t\treturn this._buffer.getPositionAt(offset);\n\t}\n\n\tprivate _increaseVersionId(): void {\n\t\tthis._versionId = this._versionId + 1;\n\t\tthis._alternativeVersionId = this._versionId;\n\t}\n\n\tpublic _overwriteVersionId(versionId: number): void {\n\t\tthis._versionId = versionId;\n\t}\n\n\tpublic _overwriteAlternativeVersionId(newAlternativeVersionId: number): void {\n\t\tthis._alternativeVersionId = newAlternativeVersionId;\n\t}\n\n\tpublic _overwriteInitialUndoRedoSnapshot(newInitialUndoRedoSnapshot: ResourceEditStackSnapshot | null): void {\n\t\tthis._initialUndoRedoSnapshot = newInitialUndoRedoSnapshot;\n\t}\n\n\tpublic getValue(eol?: model.EndOfLinePreference, preserveBOM: boolean = false): string {\n\t\tthis._assertNotDisposed();\n\t\tif (this.isTooLargeForHeapOperation()) {\n\t\t\tthrow new BugIndicatingError('Operation would exceed heap memory limits');\n\t\t}\n\n\t\tconst fullModelRange = this.getFullModelRange();\n\t\tconst fullModelValue = this.getValueInRange(fullModelRange, eol);\n\n\t\tif (preserveBOM) {\n\t\t\treturn this._buffer.getBOM() + fullModelValue;\n\t\t}\n\n\t\treturn fullModelValue;\n\t}\n\n\tpublic createSnapshot(preserveBOM: boolean = false): model.ITextSnapshot {\n\t\treturn new TextModelSnapshot(this._buffer.createSnapshot(preserveBOM));\n\t}\n\n\tpublic getValueLength(eol?: model.EndOfLinePreference, preserveBOM: boolean = false): number {\n\t\tthis._assertNotDisposed();\n\t\tconst fullModelRange = this.getFullModelRange();\n\t\tconst fullModelValue = this.getValueLengthInRange(fullModelRange, eol);\n\n\t\tif (preserveBOM) {\n\t\t\treturn this._buffer.getBOM().length + fullModelValue;\n\t\t}\n\n\t\treturn fullModelValue;\n\t}\n\n\tpublic getValueInRange(rawRange: IRange, eol: model.EndOfLinePreference = model.EndOfLinePreference.TextDefined): string {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.getValueInRange(this.validateRange(rawRange), eol);\n\t}\n\n\tpublic getValueLengthInRange(rawRange: IRange, eol: model.EndOfLinePreference = model.EndOfLinePreference.TextDefined): number {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.getValueLengthInRange(this.validateRange(rawRange), eol);\n\t}\n\n\tpublic getCharacterCountInRange(rawRange: IRange, eol: model.EndOfLinePreference = model.EndOfLinePreference.TextDefined): number {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.getCharacterCountInRange(this.validateRange(rawRange), eol);\n\t}\n\n\tpublic getLineCount(): number {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.getLineCount();\n\t}\n\n\tpublic getLineContent(lineNumber: number): string {\n\t\tthis._assertNotDisposed();\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new BugIndicatingError('Illegal value for lineNumber');\n\t\t}\n\n\t\treturn this._buffer.getLineContent(lineNumber);\n\t}\n\n\tpublic getLineLength(lineNumber: number): number {\n\t\tthis._assertNotDisposed();\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new BugIndicatingError('Illegal value for lineNumber');\n\t\t}\n\n\t\treturn this._buffer.getLineLength(lineNumber);\n\t}\n\n\tpublic getLinesContent(): string[] {\n\t\tthis._assertNotDisposed();\n\t\tif (this.isTooLargeForHeapOperation()) {\n\t\t\tthrow new BugIndicatingError('Operation would exceed heap memory limits');\n\t\t}\n\n\t\treturn this._buffer.getLinesContent();\n\t}\n\n\tpublic getEOL(): string {\n\t\tthis._assertNotDisposed();\n\t\treturn this._buffer.getEOL();\n\t}\n\n\tpublic getEndOfLineSequence(): model.EndOfLineSequence {\n\t\tthis._assertNotDisposed();\n\t\treturn (\n\t\t\tthis._buffer.getEOL() === '\\n'\n\t\t\t\t? model.EndOfLineSequence.LF\n\t\t\t\t: model.EndOfLineSequence.CRLF\n\t\t);\n\t}\n\n\tpublic getLineMinColumn(lineNumber: number): number {\n\t\tthis._assertNotDisposed();\n\t\treturn 1;\n\t}\n\n\tpublic getLineMaxColumn(lineNumber: number): number {\n\t\tthis._assertNotDisposed();\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new BugIndicatingError('Illegal value for lineNumber');\n\t\t}\n\t\treturn this._buffer.getLineLength(lineNumber) + 1;\n\t}\n\n\tpublic getLineFirstNonWhitespaceColumn(lineNumber: number): number {\n\t\tthis._assertNotDisposed();\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new BugIndicatingError('Illegal value for lineNumber');\n\t\t}\n\t\treturn this._buffer.getLineFirstNonWhitespaceColumn(lineNumber);\n\t}\n\n\tpublic getLineLastNonWhitespaceColumn(lineNumber: number): number {\n\t\tthis._assertNotDisposed();\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\tthrow new BugIndicatingError('Illegal value for lineNumber');\n\t\t}\n\t\treturn this._buffer.getLineLastNonWhitespaceColumn(lineNumber);\n\t}\n\n\t/**\n\t * Validates `range` is within buffer bounds, but allows it to sit in between surrogate pairs, etc.\n\t * Will try to not allocate if possible.\n\t */\n\tpublic _validateRangeRelaxedNoAllocations(range: IRange): Range {\n\t\tconst linesCount = this._buffer.getLineCount();\n\n\t\tconst initialStartLineNumber = range.startLineNumber;\n\t\tconst initialStartColumn = range.startColumn;\n\t\tlet startLineNumber = Math.floor((typeof initialStartLineNumber === 'number' && !isNaN(initialStartLineNumber)) ? initialStartLineNumber : 1);\n\t\tlet startColumn = Math.floor((typeof initialStartColumn === 'number' && !isNaN(initialStartColumn)) ? initialStartColumn : 1);\n\n\t\tif (startLineNumber < 1) {\n\t\t\tstartLineNumber = 1;\n\t\t\tstartColumn = 1;\n\t\t} else if (startLineNumber > linesCount) {\n\t\t\tstartLineNumber = linesCount;\n\t\t\tstartColumn = this.getLineMaxColumn(startLineNumber);\n\t\t} else {\n\t\t\tif (startColumn <= 1) {\n\t\t\t\tstartColumn = 1;\n\t\t\t} else {\n\t\t\t\tconst maxColumn = this.getLineMaxColumn(startLineNumber);\n\t\t\t\tif (startColumn >= maxColumn) {\n\t\t\t\t\tstartColumn = maxColumn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst initialEndLineNumber = range.endLineNumber;\n\t\tconst initialEndColumn = range.endColumn;\n\t\tlet endLineNumber = Math.floor((typeof initialEndLineNumber === 'number' && !isNaN(initialEndLineNumber)) ? initialEndLineNumber : 1);\n\t\tlet endColumn = Math.floor((typeof initialEndColumn === 'number' && !isNaN(initialEndColumn)) ? initialEndColumn : 1);\n\n\t\tif (endLineNumber < 1) {\n\t\t\tendLineNumber = 1;\n\t\t\tendColumn = 1;\n\t\t} else if (endLineNumber > linesCount) {\n\t\t\tendLineNumber = linesCount;\n\t\t\tendColumn = this.getLineMaxColumn(endLineNumber);\n\t\t} else {\n\t\t\tif (endColumn <= 1) {\n\t\t\t\tendColumn = 1;\n\t\t\t} else {\n\t\t\t\tconst maxColumn = this.getLineMaxColumn(endLineNumber);\n\t\t\t\tif (endColumn >= maxColumn) {\n\t\t\t\t\tendColumn = maxColumn;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (\n\t\t\tinitialStartLineNumber === startLineNumber\n\t\t\t&& initialStartColumn === startColumn\n\t\t\t&& initialEndLineNumber === endLineNumber\n\t\t\t&& initialEndColumn === endColumn\n\t\t\t&& range instanceof Range\n\t\t\t&& !(range instanceof Selection)\n\t\t) {\n\t\t\treturn range;\n\t\t}\n\n\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n\t}\n\n\tprivate _isValidPosition(lineNumber: number, column: number, validationType: StringOffsetValidationType): boolean {\n\t\tif (typeof lineNumber !== 'number' || typeof column !== 'number') {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isNaN(lineNumber) || isNaN(column)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (lineNumber < 1 || column < 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif ((lineNumber | 0) !== lineNumber || (column | 0) !== column) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst lineCount = this._buffer.getLineCount();\n\t\tif (lineNumber > lineCount) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (column === 1) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst maxColumn = this.getLineMaxColumn(lineNumber);\n\t\tif (column > maxColumn) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (validationType === StringOffsetValidationType.SurrogatePairs) {\n\t\t\t// !!At this point, column > 1\n\t\t\tconst charCodeBefore = this._buffer.getLineCharCode(lineNumber, column - 2);\n\t\t\tif (strings.isHighSurrogate(charCodeBefore)) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate _validatePosition(_lineNumber: number, _column: number, validationType: StringOffsetValidationType): Position {\n\t\tconst lineNumber = Math.floor((typeof _lineNumber === 'number' && !isNaN(_lineNumber)) ? _lineNumber : 1);\n\t\tconst column = Math.floor((typeof _column === 'number' && !isNaN(_column)) ? _column : 1);\n\t\tconst lineCount = this._buffer.getLineCount();\n\n\t\tif (lineNumber < 1) {\n\t\t\treturn new Position(1, 1);\n\t\t}\n\n\t\tif (lineNumber > lineCount) {\n\t\t\treturn new Position(lineCount, this.getLineMaxColumn(lineCount));\n\t\t}\n\n\t\tif (column <= 1) {\n\t\t\treturn new Position(lineNumber, 1);\n\t\t}\n\n\t\tconst maxColumn = this.getLineMaxColumn(lineNumber);\n\t\tif (column >= maxColumn) {\n\t\t\treturn new Position(lineNumber, maxColumn);\n\t\t}\n\n\t\tif (validationType === StringOffsetValidationType.SurrogatePairs) {\n\t\t\t// If the position would end up in the middle of a high-low surrogate pair,\n\t\t\t// we move it to before the pair\n\t\t\t// !!At this point, column > 1\n\t\t\tconst charCodeBefore = this._buffer.getLineCharCode(lineNumber, column - 2);\n\t\t\tif (strings.isHighSurrogate(charCodeBefore)) {\n\t\t\t\treturn new Position(lineNumber, column - 1);\n\t\t\t}\n\t\t}\n\n\t\treturn new Position(lineNumber, column);\n\t}\n\n\tpublic validatePosition(position: IPosition): Position {\n\t\tconst validationType = StringOffsetValidationType.SurrogatePairs;\n\t\tthis._assertNotDisposed();\n\n\t\t// Avoid object allocation and cover most likely case\n\t\tif (position instanceof Position) {\n\t\t\tif (this._isValidPosition(position.lineNumber, position.column, validationType)) {\n\t\t\t\treturn position;\n\t\t\t}\n\t\t}\n\n\t\treturn this._validatePosition(position.lineNumber, position.column, validationType);\n\t}\n\n\tprivate _isValidRange(range: Range, validationType: StringOffsetValidationType): boolean {\n\t\tconst startLineNumber = range.startLineNumber;\n\t\tconst startColumn = range.startColumn;\n\t\tconst endLineNumber = range.endLineNumber;\n\t\tconst endColumn = range.endColumn;\n\n\t\tif (!this._isValidPosition(startLineNumber, startColumn, StringOffsetValidationType.Relaxed)) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this._isValidPosition(endLineNumber, endColumn, StringOffsetValidationType.Relaxed)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (validationType === StringOffsetValidationType.SurrogatePairs) {\n\t\t\tconst charCodeBeforeStart = (startColumn > 1 ? this._buffer.getLineCharCode(startLineNumber, startColumn - 2) : 0);\n\t\t\tconst charCodeBeforeEnd = (endColumn > 1 && endColumn <= this._buffer.getLineLength(endLineNumber) ? this._buffer.getLineCharCode(endLineNumber, endColumn - 2) : 0);\n\n\t\t\tconst startInsideSurrogatePair = strings.isHighSurrogate(charCodeBeforeStart);\n\t\t\tconst endInsideSurrogatePair = strings.isHighSurrogate(charCodeBeforeEnd);\n\n\t\t\tif (!startInsideSurrogatePair && !endInsideSurrogatePair) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tpublic validateRange(_range: IRange): Range {\n\t\tconst validationType = StringOffsetValidationType.SurrogatePairs;\n\t\tthis._assertNotDisposed();\n\n\t\t// Avoid object allocation and cover most likely case\n\t\tif ((_range instanceof Range) && !(_range instanceof Selection)) {\n\t\t\tif (this._isValidRange(_range, validationType)) {\n\t\t\t\treturn _range;\n\t\t\t}\n\t\t}\n\n\t\tconst start = this._validatePosition(_range.startLineNumber, _range.startColumn, StringOffsetValidationType.Relaxed);\n\t\tconst end = this._validatePosition(_range.endLineNumber, _range.endColumn, StringOffsetValidationType.Relaxed);\n\n\t\tconst startLineNumber = start.lineNumber;\n\t\tconst startColumn = start.column;\n\t\tconst endLineNumber = end.lineNumber;\n\t\tconst endColumn = end.column;\n\n\t\tif (validationType === StringOffsetValidationType.SurrogatePairs) {\n\t\t\tconst charCodeBeforeStart = (startColumn > 1 ? this._buffer.getLineCharCode(startLineNumber, startColumn - 2) : 0);\n\t\t\tconst charCodeBeforeEnd = (endColumn > 1 && endColumn <= this._buffer.getLineLength(endLineNumber) ? this._buffer.getLineCharCode(endLineNumber, endColumn - 2) : 0);\n\n\t\t\tconst startInsideSurrogatePair = strings.isHighSurrogate(charCodeBeforeStart);\n\t\t\tconst endInsideSurrogatePair = strings.isHighSurrogate(charCodeBeforeEnd);\n\n\t\t\tif (!startInsideSurrogatePair && !endInsideSurrogatePair) {\n\t\t\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n\t\t\t}\n\n\t\t\tif (startLineNumber === endLineNumber && startColumn === endColumn) {\n\t\t\t\t// do not expand a collapsed range, simply move it to a valid location\n\t\t\t\treturn new Range(startLineNumber, startColumn - 1, endLineNumber, endColumn - 1);\n\t\t\t}\n\n\t\t\tif (startInsideSurrogatePair && endInsideSurrogatePair) {\n\t\t\t\t// expand range at both ends\n\t\t\t\treturn new Range(startLineNumber, startColumn - 1, endLineNumber, endColumn + 1);\n\t\t\t}\n\n\t\t\tif (startInsideSurrogatePair) {\n\t\t\t\t// only expand range at the start\n\t\t\t\treturn new Range(startLineNumber, startColumn - 1, endLineNumber, endColumn);\n\t\t\t}\n\n\t\t\t// only expand range at the end\n\t\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn + 1);\n\t\t}\n\n\t\treturn new Range(startLineNumber, startColumn, endLineNumber, endColumn);\n\t}\n\n\tpublic modifyPosition(rawPosition: IPosition, offset: number): Position {\n\t\tthis._assertNotDisposed();\n\t\tconst candidate = this.getOffsetAt(rawPosition) + offset;\n\t\treturn this.getPositionAt(Math.min(this._buffer.getLength(), Math.max(0, candidate)));\n\t}\n\n\tpublic getFullModelRange(): Range {\n\t\tthis._assertNotDisposed();\n\t\tconst lineCount = this.getLineCount();\n\t\treturn new Range(1, 1, lineCount, this.getLineMaxColumn(lineCount));\n\t}\n\n\tprivate findMatchesLineByLine(searchRange: Range, searchData: model.SearchData, captureMatches: boolean, limitResultCount: number): model.FindMatch[] {\n\t\treturn this._buffer.findMatchesLineByLine(searchRange, searchData, captureMatches, limitResultCount);\n\t}\n\n\tpublic findMatches(searchString: string, rawSearchScope: any, isRegex: boolean, matchCase: boolean, wordSeparators: string | null, captureMatches: boolean, limitResultCount: number = LIMIT_FIND_COUNT): model.FindMatch[] {\n\t\tthis._assertNotDisposed();\n\n\t\tlet searchRanges: Range[] | null = null;\n\n\t\tif (rawSearchScope !== null) {\n\t\t\tif (!Array.isArray(rawSearchScope)) {\n\t\t\t\trawSearchScope = [rawSearchScope];\n\t\t\t}\n\n\t\t\tif (rawSearchScope.every((searchScope: Range) => Range.isIRange(searchScope))) {\n\t\t\t\tsearchRanges = rawSearchScope.map((searchScope: Range) => this.validateRange(searchScope));\n\t\t\t}\n\t\t}\n\n\t\tif (searchRanges === null) {\n\t\t\tsearchRanges = [this.getFullModelRange()];\n\t\t}\n\n\t\tsearchRanges = searchRanges.sort((d1, d2) => d1.startLineNumber - d2.startLineNumber || d1.startColumn - d2.startColumn);\n\n\t\tconst uniqueSearchRanges: Range[] = [];\n\t\tuniqueSearchRanges.push(searchRanges.reduce((prev, curr) => {\n\t\t\tif (Range.areIntersecting(prev, curr)) {\n\t\t\t\treturn prev.plusRange(curr);\n\t\t\t}\n\n\t\t\tuniqueSearchRanges.push(prev);\n\t\t\treturn curr;\n\t\t}));\n\n\t\tlet matchMapper: (value: Range, index: number, array: Range[]) => model.FindMatch[];\n\t\tif (!isRegex && searchString.indexOf('\\n') < 0) {\n\t\t\t// not regex, not multi line\n\t\t\tconst searchParams = new SearchParams(searchString, isRegex, matchCase, wordSeparators);\n\t\t\tconst searchData = searchParams.parseSearchRequest();\n\n\t\t\tif (!searchData) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tmatchMapper = (searchRange: Range) => this.findMatchesLineByLine(searchRange, searchData, captureMatches, limitResultCount);\n\t\t} else {\n\t\t\tmatchMapper = (searchRange: Range) => TextModelSearch.findMatches(this, new SearchParams(searchString, isRegex, matchCase, wordSeparators), searchRange, captureMatches, limitResultCount);\n\t\t}\n\n\t\treturn uniqueSearchRanges.map(matchMapper).reduce((arr, matches: model.FindMatch[]) => arr.concat(matches), []);\n\t}\n\n\tpublic findNextMatch(searchString: string, rawSearchStart: IPosition, isRegex: boolean, matchCase: boolean, wordSeparators: string, captureMatches: boolean): model.FindMatch | null {\n\t\tthis._assertNotDisposed();\n\t\tconst searchStart = this.validatePosition(rawSearchStart);\n\n\t\tif (!isRegex && searchString.indexOf('\\n') < 0) {\n\t\t\tconst searchParams = new SearchParams(searchString, isRegex, matchCase, wordSeparators);\n\t\t\tconst searchData = searchParams.parseSearchRequest();\n\t\t\tif (!searchData) {\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst lineCount = this.getLineCount();\n\t\t\tlet searchRange = new Range(searchStart.lineNumber, searchStart.column, lineCount, this.getLineMaxColumn(lineCount));\n\t\t\tlet ret = this.findMatchesLineByLine(searchRange, searchData, captureMatches, 1);\n\t\t\tTextModelSearch.findNextMatch(this, new SearchParams(searchString, isRegex, matchCase, wordSeparators), searchStart, captureMatches);\n\t\t\tif (ret.length > 0) {\n\t\t\t\treturn ret[0];\n\t\t\t}\n\n\t\t\tsearchRange = new Range(1, 1, searchStart.lineNumber, this.getLineMaxColumn(searchStart.lineNumber));\n\t\t\tret = this.findMatchesLineByLine(searchRange, searchData, captureMatches, 1);\n\n\t\t\tif (ret.length > 0) {\n\t\t\t\treturn ret[0];\n\t\t\t}\n\n\t\t\treturn null;\n\t\t}\n\n\t\treturn TextModelSearch.findNextMatch(this, new SearchParams(searchString, isRegex, matchCase, wordSeparators), searchStart, captureMatches);\n\t}\n\n\tpublic findPreviousMatch(searchString: string, rawSearchStart: IPosition, isRegex: boolean, matchCase: boolean, wordSeparators: string, captureMatches: boolean): model.FindMatch | null {\n\t\tthis._assertNotDisposed();\n\t\tconst searchStart = this.validatePosition(rawSearchStart);\n\t\treturn TextModelSearch.findPreviousMatch(this, new SearchParams(searchString, isRegex, matchCase, wordSeparators), searchStart, captureMatches);\n\t}\n\n\t//#endregion\n\n\t//#region Editing\n\n\tpublic pushStackElement(): void {\n\t\tthis._commandManager.pushStackElement();\n\t}\n\n\tpublic popStackElement(): void {\n\t\tthis._commandManager.popStackElement();\n\t}\n\n\tpublic pushEOL(eol: model.EndOfLineSequence): void {\n\t\tconst currentEOL = (this.getEOL() === '\\n' ? model.EndOfLineSequence.LF : model.EndOfLineSequence.CRLF);\n\t\tif (currentEOL === eol) {\n\t\t\treturn;\n\t\t}\n\t\ttry {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\tthis._eventEmitter.beginDeferredEmit();\n\t\t\tif (this._initialUndoRedoSnapshot === null) {\n\t\t\t\tthis._initialUndoRedoSnapshot = this._undoRedoService.createSnapshot(this.uri);\n\t\t\t}\n\t\t\tthis._commandManager.pushEOL(eol);\n\t\t} finally {\n\t\t\tthis._eventEmitter.endDeferredEmit();\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\tprivate _validateEditOperation(rawOperation: model.IIdentifiedSingleEditOperation): model.ValidAnnotatedEditOperation {\n\t\tif (rawOperation instanceof model.ValidAnnotatedEditOperation) {\n\t\t\treturn rawOperation;\n\t\t}\n\t\treturn new model.ValidAnnotatedEditOperation(\n\t\t\trawOperation.identifier || null,\n\t\t\tthis.validateRange(rawOperation.range),\n\t\t\trawOperation.text,\n\t\t\trawOperation.forceMoveMarkers || false,\n\t\t\trawOperation.isAutoWhitespaceEdit || false,\n\t\t\trawOperation._isTracked || false\n\t\t);\n\t}\n\n\tprivate _validateEditOperations(rawOperations: readonly model.IIdentifiedSingleEditOperation[]): model.ValidAnnotatedEditOperation[] {\n\t\tconst result: model.ValidAnnotatedEditOperation[] = [];\n\t\tfor (let i = 0, len = rawOperations.length; i < len; i++) {\n\t\t\tresult[i] = this._validateEditOperation(rawOperations[i]);\n\t\t}\n\t\treturn result;\n\t}\n\n\tpublic pushEditOperations(beforeCursorState: Selection[] | null, editOperations: model.IIdentifiedSingleEditOperation[], cursorStateComputer: model.ICursorStateComputer | null, group?: UndoRedoGroup): Selection[] | null {\n\t\ttry {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\tthis._eventEmitter.beginDeferredEmit();\n\t\t\treturn this._pushEditOperations(beforeCursorState, this._validateEditOperations(editOperations), cursorStateComputer, group);\n\t\t} finally {\n\t\t\tthis._eventEmitter.endDeferredEmit();\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\tprivate _pushEditOperations(beforeCursorState: Selection[] | null, editOperations: model.ValidAnnotatedEditOperation[], cursorStateComputer: model.ICursorStateComputer | null, group?: UndoRedoGroup): Selection[] | null {\n\t\tif (this._options.trimAutoWhitespace && this._trimAutoWhitespaceLines) {\n\t\t\t// Go through each saved line number and insert a trim whitespace edit\n\t\t\t// if it is safe to do so (no conflicts with other edits).\n\n\t\t\tconst incomingEdits = editOperations.map((op) => {\n\t\t\t\treturn {\n\t\t\t\t\trange: this.validateRange(op.range),\n\t\t\t\t\ttext: op.text\n\t\t\t\t};\n\t\t\t});\n\n\t\t\t// Sometimes, auto-formatters change ranges automatically which can cause undesired auto whitespace trimming near the cursor\n\t\t\t// We'll use the following heuristic: if the edits occur near the cursor, then it's ok to trim auto whitespace\n\t\t\tlet editsAreNearCursors = true;\n\t\t\tif (beforeCursorState) {\n\t\t\t\tfor (let i = 0, len = beforeCursorState.length; i < len; i++) {\n\t\t\t\t\tconst sel = beforeCursorState[i];\n\t\t\t\t\tlet foundEditNearSel = false;\n\t\t\t\t\tfor (let j = 0, lenJ = incomingEdits.length; j < lenJ; j++) {\n\t\t\t\t\t\tconst editRange = incomingEdits[j].range;\n\t\t\t\t\t\tconst selIsAbove = editRange.startLineNumber > sel.endLineNumber;\n\t\t\t\t\t\tconst selIsBelow = sel.startLineNumber > editRange.endLineNumber;\n\t\t\t\t\t\tif (!selIsAbove && !selIsBelow) {\n\t\t\t\t\t\t\tfoundEditNearSel = true;\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (!foundEditNearSel) {\n\t\t\t\t\t\teditsAreNearCursors = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (editsAreNearCursors) {\n\t\t\t\tfor (let i = 0, len = this._trimAutoWhitespaceLines.length; i < len; i++) {\n\t\t\t\t\tconst trimLineNumber = this._trimAutoWhitespaceLines[i];\n\t\t\t\t\tconst maxLineColumn = this.getLineMaxColumn(trimLineNumber);\n\n\t\t\t\t\tlet allowTrimLine = true;\n\t\t\t\t\tfor (let j = 0, lenJ = incomingEdits.length; j < lenJ; j++) {\n\t\t\t\t\t\tconst editRange = incomingEdits[j].range;\n\t\t\t\t\t\tconst editText = incomingEdits[j].text;\n\n\t\t\t\t\t\tif (trimLineNumber < editRange.startLineNumber || trimLineNumber > editRange.endLineNumber) {\n\t\t\t\t\t\t\t// `trimLine` is completely outside this edit\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// At this point:\n\t\t\t\t\t\t//   editRange.startLineNumber <= trimLine <= editRange.endLineNumber\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttrimLineNumber === editRange.startLineNumber && editRange.startColumn === maxLineColumn\n\t\t\t\t\t\t\t&& editRange.isEmpty() && editText && editText.length > 0 && editText.charAt(0) === '\\n'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// This edit inserts a new line (and maybe other text) after `trimLine`\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttrimLineNumber === editRange.startLineNumber && editRange.startColumn === 1\n\t\t\t\t\t\t\t&& editRange.isEmpty() && editText && editText.length > 0 && editText.charAt(editText.length - 1) === '\\n'\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// This edit inserts a new line (and maybe other text) before `trimLine`\n\t\t\t\t\t\t\tcontinue;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\t// Looks like we can't trim this line as it would interfere with an incoming edit\n\t\t\t\t\t\tallowTrimLine = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (allowTrimLine) {\n\t\t\t\t\t\tconst trimRange = new Range(trimLineNumber, 1, trimLineNumber, maxLineColumn);\n\t\t\t\t\t\teditOperations.push(new model.ValidAnnotatedEditOperation(null, trimRange, null, false, false, false));\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._trimAutoWhitespaceLines = null;\n\t\t}\n\t\tif (this._initialUndoRedoSnapshot === null) {\n\t\t\tthis._initialUndoRedoSnapshot = this._undoRedoService.createSnapshot(this.uri);\n\t\t}\n\t\treturn this._commandManager.pushEditOperation(beforeCursorState, editOperations, cursorStateComputer, group);\n\t}\n\n\t_applyUndo(changes: TextChange[], eol: model.EndOfLineSequence, resultingAlternativeVersionId: number, resultingSelection: Selection[] | null): void {\n\t\tconst edits = changes.map<ISingleEditOperation>((change) => {\n\t\t\tconst rangeStart = this.getPositionAt(change.newPosition);\n\t\t\tconst rangeEnd = this.getPositionAt(change.newEnd);\n\t\t\treturn {\n\t\t\t\trange: new Range(rangeStart.lineNumber, rangeStart.column, rangeEnd.lineNumber, rangeEnd.column),\n\t\t\t\ttext: change.oldText\n\t\t\t};\n\t\t});\n\t\tthis._applyUndoRedoEdits(edits, eol, true, false, resultingAlternativeVersionId, resultingSelection);\n\t}\n\n\t_applyRedo(changes: TextChange[], eol: model.EndOfLineSequence, resultingAlternativeVersionId: number, resultingSelection: Selection[] | null): void {\n\t\tconst edits = changes.map<ISingleEditOperation>((change) => {\n\t\t\tconst rangeStart = this.getPositionAt(change.oldPosition);\n\t\t\tconst rangeEnd = this.getPositionAt(change.oldEnd);\n\t\t\treturn {\n\t\t\t\trange: new Range(rangeStart.lineNumber, rangeStart.column, rangeEnd.lineNumber, rangeEnd.column),\n\t\t\t\ttext: change.newText\n\t\t\t};\n\t\t});\n\t\tthis._applyUndoRedoEdits(edits, eol, false, true, resultingAlternativeVersionId, resultingSelection);\n\t}\n\n\tprivate _applyUndoRedoEdits(edits: ISingleEditOperation[], eol: model.EndOfLineSequence, isUndoing: boolean, isRedoing: boolean, resultingAlternativeVersionId: number, resultingSelection: Selection[] | null): void {\n\t\ttry {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\tthis._eventEmitter.beginDeferredEmit();\n\t\t\tthis._isUndoing = isUndoing;\n\t\t\tthis._isRedoing = isRedoing;\n\t\t\tthis.applyEdits(edits, false);\n\t\t\tthis.setEOL(eol);\n\t\t\tthis._overwriteAlternativeVersionId(resultingAlternativeVersionId);\n\t\t} finally {\n\t\t\tthis._isUndoing = false;\n\t\t\tthis._isRedoing = false;\n\t\t\tthis._eventEmitter.endDeferredEmit(resultingSelection);\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\tpublic applyEdits(operations: readonly model.IIdentifiedSingleEditOperation[]): void;\n\tpublic applyEdits(operations: readonly model.IIdentifiedSingleEditOperation[], computeUndoEdits: false): void;\n\tpublic applyEdits(operations: readonly model.IIdentifiedSingleEditOperation[], computeUndoEdits: true): model.IValidEditOperation[];\n\tpublic applyEdits(rawOperations: readonly model.IIdentifiedSingleEditOperation[], computeUndoEdits: boolean = false): void | model.IValidEditOperation[] {\n\t\ttry {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\tthis._eventEmitter.beginDeferredEmit();\n\t\t\tconst operations = this._validateEditOperations(rawOperations);\n\t\t\treturn this._doApplyEdits(operations, computeUndoEdits);\n\t\t} finally {\n\t\t\tthis._eventEmitter.endDeferredEmit();\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\tprivate _doApplyEdits(rawOperations: model.ValidAnnotatedEditOperation[], computeUndoEdits: boolean): void | model.IValidEditOperation[] {\n\n\t\tconst oldLineCount = this._buffer.getLineCount();\n\t\tconst result = this._buffer.applyEdits(rawOperations, this._options.trimAutoWhitespace, computeUndoEdits);\n\t\tconst newLineCount = this._buffer.getLineCount();\n\n\t\tconst contentChanges = result.changes;\n\t\tthis._trimAutoWhitespaceLines = result.trimAutoWhitespaceLineNumbers;\n\n\t\tif (contentChanges.length !== 0) {\n\t\t\t// We do a first pass to update decorations\n\t\t\t// because we want to read decorations in the second pass\n\t\t\t// where we will emit content change events\n\t\t\t// and we want to read the final decorations\n\t\t\tfor (let i = 0, len = contentChanges.length; i < len; i++) {\n\t\t\t\tconst change = contentChanges[i];\n\t\t\t\tthis._decorationsTree.acceptReplace(change.rangeOffset, change.rangeLength, change.text.length, change.forceMoveMarkers);\n\t\t\t}\n\n\t\t\tconst rawContentChanges: ModelRawChange[] = [];\n\n\t\t\tthis._increaseVersionId();\n\n\t\t\tlet lineCount = oldLineCount;\n\t\t\tfor (let i = 0, len = contentChanges.length; i < len; i++) {\n\t\t\t\tconst change = contentChanges[i];\n\t\t\t\tconst [eolCount] = countEOL(change.text);\n\t\t\t\tthis._onDidChangeDecorations.fire();\n\n\t\t\t\tconst startLineNumber = change.range.startLineNumber;\n\t\t\t\tconst endLineNumber = change.range.endLineNumber;\n\n\t\t\t\tconst deletingLinesCnt = endLineNumber - startLineNumber;\n\t\t\t\tconst insertingLinesCnt = eolCount;\n\t\t\t\tconst editingLinesCnt = Math.min(deletingLinesCnt, insertingLinesCnt);\n\n\t\t\t\tconst changeLineCountDelta = (insertingLinesCnt - deletingLinesCnt);\n\n\t\t\t\tconst currentEditStartLineNumber = newLineCount - lineCount - changeLineCountDelta + startLineNumber;\n\t\t\t\tconst firstEditLineNumber = currentEditStartLineNumber;\n\t\t\t\tconst lastInsertedLineNumber = currentEditStartLineNumber + insertingLinesCnt;\n\n\t\t\t\tconst decorationsWithInjectedTextInEditedRange = this._decorationsTree.getInjectedTextInInterval(\n\t\t\t\t\tthis,\n\t\t\t\t\tthis.getOffsetAt(new Position(firstEditLineNumber, 1)),\n\t\t\t\t\tthis.getOffsetAt(new Position(lastInsertedLineNumber, this.getLineMaxColumn(lastInsertedLineNumber))),\n\t\t\t\t\t0\n\t\t\t\t);\n\n\n\t\t\t\tconst injectedTextInEditedRange = LineInjectedText.fromDecorations(decorationsWithInjectedTextInEditedRange);\n\t\t\t\tconst injectedTextInEditedRangeQueue = new ArrayQueue(injectedTextInEditedRange);\n\n\t\t\t\tfor (let j = editingLinesCnt; j >= 0; j--) {\n\t\t\t\t\tconst editLineNumber = startLineNumber + j;\n\t\t\t\t\tconst currentEditLineNumber = currentEditStartLineNumber + j;\n\n\t\t\t\t\tinjectedTextInEditedRangeQueue.takeFromEndWhile(r => r.lineNumber > currentEditLineNumber);\n\t\t\t\t\tconst decorationsInCurrentLine = injectedTextInEditedRangeQueue.takeFromEndWhile(r => r.lineNumber === currentEditLineNumber);\n\n\t\t\t\t\trawContentChanges.push(\n\t\t\t\t\t\tnew ModelRawLineChanged(\n\t\t\t\t\t\t\teditLineNumber,\n\t\t\t\t\t\t\tthis.getLineContent(currentEditLineNumber),\n\t\t\t\t\t\t\tdecorationsInCurrentLine\n\t\t\t\t\t\t));\n\t\t\t\t}\n\n\t\t\t\tif (editingLinesCnt < deletingLinesCnt) {\n\t\t\t\t\t// Must delete some lines\n\t\t\t\t\tconst spliceStartLineNumber = startLineNumber + editingLinesCnt;\n\t\t\t\t\trawContentChanges.push(new ModelRawLinesDeleted(spliceStartLineNumber + 1, endLineNumber));\n\t\t\t\t}\n\n\t\t\t\tif (editingLinesCnt < insertingLinesCnt) {\n\t\t\t\t\tconst injectedTextInEditedRangeQueue = new ArrayQueue(injectedTextInEditedRange);\n\t\t\t\t\t// Must insert some lines\n\t\t\t\t\tconst spliceLineNumber = startLineNumber + editingLinesCnt;\n\t\t\t\t\tconst cnt = insertingLinesCnt - editingLinesCnt;\n\t\t\t\t\tconst fromLineNumber = newLineCount - lineCount - cnt + spliceLineNumber + 1;\n\t\t\t\t\tconst injectedTexts: (LineInjectedText[] | null)[] = [];\n\t\t\t\t\tconst newLines: string[] = [];\n\t\t\t\t\tfor (let i = 0; i < cnt; i++) {\n\t\t\t\t\t\tconst lineNumber = fromLineNumber + i;\n\t\t\t\t\t\tnewLines[i] = this.getLineContent(lineNumber);\n\n\t\t\t\t\t\tinjectedTextInEditedRangeQueue.takeWhile(r => r.lineNumber < lineNumber);\n\t\t\t\t\t\tinjectedTexts[i] = injectedTextInEditedRangeQueue.takeWhile(r => r.lineNumber === lineNumber);\n\t\t\t\t\t}\n\n\t\t\t\t\trawContentChanges.push(\n\t\t\t\t\t\tnew ModelRawLinesInserted(\n\t\t\t\t\t\t\tspliceLineNumber + 1,\n\t\t\t\t\t\t\tstartLineNumber + insertingLinesCnt,\n\t\t\t\t\t\t\tnewLines,\n\t\t\t\t\t\t\tinjectedTexts\n\t\t\t\t\t\t)\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlineCount += changeLineCountDelta;\n\t\t\t}\n\n\t\t\tthis._emitContentChangedEvent(\n\t\t\t\tnew ModelRawContentChangedEvent(\n\t\t\t\t\trawContentChanges,\n\t\t\t\t\tthis.getVersionId(),\n\t\t\t\t\tthis._isUndoing,\n\t\t\t\t\tthis._isRedoing\n\t\t\t\t),\n\t\t\t\t{\n\t\t\t\t\tchanges: contentChanges,\n\t\t\t\t\teol: this._buffer.getEOL(),\n\t\t\t\t\tisEolChange: false,\n\t\t\t\t\tversionId: this.getVersionId(),\n\t\t\t\t\tisUndoing: this._isUndoing,\n\t\t\t\t\tisRedoing: this._isRedoing,\n\t\t\t\t\tisFlush: false\n\t\t\t\t}\n\t\t\t);\n\t\t}\n\n\t\treturn (result.reverseEdits === null ? undefined : result.reverseEdits);\n\t}\n\n\tpublic undo(): void | Promise<void> {\n\t\treturn this._undoRedoService.undo(this.uri);\n\t}\n\n\tpublic canUndo(): boolean {\n\t\treturn this._undoRedoService.canUndo(this.uri);\n\t}\n\n\tpublic redo(): void | Promise<void> {\n\t\treturn this._undoRedoService.redo(this.uri);\n\t}\n\n\tpublic canRedo(): boolean {\n\t\treturn this._undoRedoService.canRedo(this.uri);\n\t}\n\n\t//#endregion\n\n\t//#region Decorations\n\n\tprivate handleBeforeFireDecorationsChangedEvent(affectedInjectedTextLines: Set<number> | null): void {\n\t\t// This is called before the decoration changed event is fired.\n\n\t\tif (affectedInjectedTextLines === null || affectedInjectedTextLines.size === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst affectedLines = Array.from(affectedInjectedTextLines);\n\t\tconst lineChangeEvents = affectedLines.map(lineNumber => new ModelRawLineChanged(lineNumber, this.getLineContent(lineNumber), this._getInjectedTextInLine(lineNumber)));\n\n\t\tthis._onDidChangeInjectedText.fire(new ModelInjectedTextChangedEvent(lineChangeEvents));\n\t}\n\n\tpublic changeDecorations<T>(callback: (changeAccessor: model.IModelDecorationsChangeAccessor) => T, ownerId: number = 0): T | null {\n\t\tthis._assertNotDisposed();\n\n\t\ttry {\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\treturn this._changeDecorations(ownerId, callback);\n\t\t} finally {\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\tprivate _changeDecorations<T>(ownerId: number, callback: (changeAccessor: model.IModelDecorationsChangeAccessor) => T): T | null {\n\t\tconst changeAccessor: model.IModelDecorationsChangeAccessor = {\n\t\t\taddDecoration: (range: IRange, options: model.IModelDecorationOptions): string => {\n\t\t\t\treturn this._deltaDecorationsImpl(ownerId, [], [{ range: range, options: options }])[0];\n\t\t\t},\n\t\t\tchangeDecoration: (id: string, newRange: IRange): void => {\n\t\t\t\tthis._changeDecorationImpl(id, newRange);\n\t\t\t},\n\t\t\tchangeDecorationOptions: (id: string, options: model.IModelDecorationOptions) => {\n\t\t\t\tthis._changeDecorationOptionsImpl(id, _normalizeOptions(options));\n\t\t\t},\n\t\t\tremoveDecoration: (id: string): void => {\n\t\t\t\tthis._deltaDecorationsImpl(ownerId, [id], []);\n\t\t\t},\n\t\t\tdeltaDecorations: (oldDecorations: string[], newDecorations: model.IModelDeltaDecoration[]): string[] => {\n\t\t\t\tif (oldDecorations.length === 0 && newDecorations.length === 0) {\n\t\t\t\t\t// nothing to do\n\t\t\t\t\treturn [];\n\t\t\t\t}\n\t\t\t\treturn this._deltaDecorationsImpl(ownerId, oldDecorations, newDecorations);\n\t\t\t}\n\t\t};\n\t\tlet result: T | null = null;\n\t\ttry {\n\t\t\tresult = callback(changeAccessor);\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t\t// Invalidate change accessor\n\t\tchangeAccessor.addDecoration = invalidFunc;\n\t\tchangeAccessor.changeDecoration = invalidFunc;\n\t\tchangeAccessor.changeDecorationOptions = invalidFunc;\n\t\tchangeAccessor.removeDecoration = invalidFunc;\n\t\tchangeAccessor.deltaDecorations = invalidFunc;\n\t\treturn result;\n\t}\n\n\tpublic deltaDecorations(oldDecorations: string[], newDecorations: model.IModelDeltaDecoration[], ownerId: number = 0): string[] {\n\t\tthis._assertNotDisposed();\n\t\tif (!oldDecorations) {\n\t\t\toldDecorations = [];\n\t\t}\n\t\tif (oldDecorations.length === 0 && newDecorations.length === 0) {\n\t\t\t// nothing to do\n\t\t\treturn [];\n\t\t}\n\n\t\ttry {\n\t\t\tthis._deltaDecorationCallCnt++;\n\t\t\tif (this._deltaDecorationCallCnt > 1) {\n\t\t\t\tconsole.warn(`Invoking deltaDecorations recursively could lead to leaking decorations.`);\n\t\t\t\tonUnexpectedError(new Error(`Invoking deltaDecorations recursively could lead to leaking decorations.`));\n\t\t\t}\n\t\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\t\treturn this._deltaDecorationsImpl(ownerId, oldDecorations, newDecorations);\n\t\t} finally {\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t\tthis._deltaDecorationCallCnt--;\n\t\t}\n\t}\n\n\t_getTrackedRange(id: string): Range | null {\n\t\treturn this.getDecorationRange(id);\n\t}\n\n\t_setTrackedRange(id: string | null, newRange: null, newStickiness: model.TrackedRangeStickiness): null;\n\t_setTrackedRange(id: string | null, newRange: Range, newStickiness: model.TrackedRangeStickiness): string;\n\t_setTrackedRange(id: string | null, newRange: Range | null, newStickiness: model.TrackedRangeStickiness): string | null {\n\t\tconst node = (id ? this._decorations[id] : null);\n\n\t\tif (!node) {\n\t\t\tif (!newRange) {\n\t\t\t\t// node doesn't exist, the request is to delete => nothing to do\n\t\t\t\treturn null;\n\t\t\t}\n\t\t\t// node doesn't exist, the request is to set => add the tracked range\n\t\t\treturn this._deltaDecorationsImpl(0, [], [{ range: newRange, options: TRACKED_RANGE_OPTIONS[newStickiness] }], true)[0];\n\t\t}\n\n\t\tif (!newRange) {\n\t\t\t// node exists, the request is to delete => delete node\n\t\t\tthis._decorationsTree.delete(node);\n\t\t\tdelete this._decorations[node.id];\n\t\t\treturn null;\n\t\t}\n\n\t\t// node exists, the request is to set => change the tracked range and its options\n\t\tconst range = this._validateRangeRelaxedNoAllocations(newRange);\n\t\tconst startOffset = this._buffer.getOffsetAt(range.startLineNumber, range.startColumn);\n\t\tconst endOffset = this._buffer.getOffsetAt(range.endLineNumber, range.endColumn);\n\t\tthis._decorationsTree.delete(node);\n\t\tnode.reset(this.getVersionId(), startOffset, endOffset, range);\n\t\tnode.setOptions(TRACKED_RANGE_OPTIONS[newStickiness]);\n\t\tthis._decorationsTree.insert(node);\n\t\treturn node.id;\n\t}\n\n\tpublic removeAllDecorationsWithOwnerId(ownerId: number): void {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\t\tconst nodes = this._decorationsTree.collectNodesFromOwner(ownerId);\n\t\tfor (let i = 0, len = nodes.length; i < len; i++) {\n\t\t\tconst node = nodes[i];\n\n\t\t\tthis._decorationsTree.delete(node);\n\t\t\tdelete this._decorations[node.id];\n\t\t}\n\t}\n\n\tpublic getDecorationOptions(decorationId: string): model.IModelDecorationOptions | null {\n\t\tconst node = this._decorations[decorationId];\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\t\treturn node.options;\n\t}\n\n\tpublic getDecorationRange(decorationId: string): Range | null {\n\t\tconst node = this._decorations[decorationId];\n\t\tif (!node) {\n\t\t\treturn null;\n\t\t}\n\t\treturn this._decorationsTree.getNodeRange(this, node);\n\t}\n\n\tpublic getLineDecorations(lineNumber: number, ownerId: number = 0, filterOutValidation: boolean = false): model.IModelDecoration[] {\n\t\tif (lineNumber < 1 || lineNumber > this.getLineCount()) {\n\t\t\treturn [];\n\t\t}\n\t\treturn this.getLinesDecorations(lineNumber, lineNumber, ownerId, filterOutValidation);\n\t}\n\n\tpublic getLinesDecorations(_startLineNumber: number, _endLineNumber: number, ownerId: number = 0, filterOutValidation: boolean = false, onlyMarginDecorations: boolean = false): model.IModelDecoration[] {\n\t\tconst lineCount = this.getLineCount();\n\t\tconst startLineNumber = Math.min(lineCount, Math.max(1, _startLineNumber));\n\t\tconst endLineNumber = Math.min(lineCount, Math.max(1, _endLineNumber));\n\t\tconst endColumn = this.getLineMaxColumn(endLineNumber);\n\t\tconst range = new Range(startLineNumber, 1, endLineNumber, endColumn);\n\n\t\tconst decorations = this._getDecorationsInRange(range, ownerId, filterOutValidation, onlyMarginDecorations);\n\t\tpushMany(decorations, this._decorationProvider.getDecorationsInRange(range, ownerId, filterOutValidation));\n\t\treturn decorations;\n\t}\n\n\tpublic getDecorationsInRange(range: IRange, ownerId: number = 0, filterOutValidation: boolean = false, onlyMinimapDecorations: boolean = false, onlyMarginDecorations: boolean = false): model.IModelDecoration[] {\n\t\tconst validatedRange = this.validateRange(range);\n\n\t\tconst decorations = this._getDecorationsInRange(validatedRange, ownerId, filterOutValidation, onlyMarginDecorations);\n\t\tpushMany(decorations, this._decorationProvider.getDecorationsInRange(validatedRange, ownerId, filterOutValidation, onlyMinimapDecorations));\n\t\treturn decorations;\n\t}\n\n\tpublic getOverviewRulerDecorations(ownerId: number = 0, filterOutValidation: boolean = false): model.IModelDecoration[] {\n\t\treturn this._decorationsTree.getAll(this, ownerId, filterOutValidation, true, false);\n\t}\n\n\tpublic getInjectedTextDecorations(ownerId: number = 0): model.IModelDecoration[] {\n\t\treturn this._decorationsTree.getAllInjectedText(this, ownerId);\n\t}\n\n\tprivate _getInjectedTextInLine(lineNumber: number): LineInjectedText[] {\n\t\tconst startOffset = this._buffer.getOffsetAt(lineNumber, 1);\n\t\tconst endOffset = startOffset + this._buffer.getLineLength(lineNumber);\n\n\t\tconst result = this._decorationsTree.getInjectedTextInInterval(this, startOffset, endOffset, 0);\n\t\treturn LineInjectedText.fromDecorations(result).filter(t => t.lineNumber === lineNumber);\n\t}\n\n\tpublic getAllDecorations(ownerId: number = 0, filterOutValidation: boolean = false): model.IModelDecoration[] {\n\t\tlet result = this._decorationsTree.getAll(this, ownerId, filterOutValidation, false, false);\n\t\tresult = result.concat(this._decorationProvider.getAllDecorations(ownerId, filterOutValidation));\n\t\treturn result;\n\t}\n\n\tpublic getAllMarginDecorations(ownerId: number = 0): model.IModelDecoration[] {\n\t\treturn this._decorationsTree.getAll(this, ownerId, false, false, true);\n\t}\n\n\tprivate _getDecorationsInRange(filterRange: Range, filterOwnerId: number, filterOutValidation: boolean, onlyMarginDecorations: boolean): model.IModelDecoration[] {\n\t\tconst startOffset = this._buffer.getOffsetAt(filterRange.startLineNumber, filterRange.startColumn);\n\t\tconst endOffset = this._buffer.getOffsetAt(filterRange.endLineNumber, filterRange.endColumn);\n\t\treturn this._decorationsTree.getAllInInterval(this, startOffset, endOffset, filterOwnerId, filterOutValidation, onlyMarginDecorations);\n\t}\n\n\tpublic getRangeAt(start: number, end: number): Range {\n\t\treturn this._buffer.getRangeAt(start, end - start);\n\t}\n\n\tprivate _changeDecorationImpl(decorationId: string, _range: IRange): void {\n\t\tconst node = this._decorations[decorationId];\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (node.options.after) {\n\t\t\tconst oldRange = this.getDecorationRange(decorationId);\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(oldRange!.endLineNumber);\n\t\t}\n\t\tif (node.options.before) {\n\t\t\tconst oldRange = this.getDecorationRange(decorationId);\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(oldRange!.startLineNumber);\n\t\t}\n\n\t\tconst range = this._validateRangeRelaxedNoAllocations(_range);\n\t\tconst startOffset = this._buffer.getOffsetAt(range.startLineNumber, range.startColumn);\n\t\tconst endOffset = this._buffer.getOffsetAt(range.endLineNumber, range.endColumn);\n\n\t\tthis._decorationsTree.delete(node);\n\t\tnode.reset(this.getVersionId(), startOffset, endOffset, range);\n\t\tthis._decorationsTree.insert(node);\n\t\tthis._onDidChangeDecorations.checkAffectedAndFire(node.options);\n\n\t\tif (node.options.after) {\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(range.endLineNumber);\n\t\t}\n\t\tif (node.options.before) {\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(range.startLineNumber);\n\t\t}\n\t}\n\n\tprivate _changeDecorationOptionsImpl(decorationId: string, options: ModelDecorationOptions): void {\n\t\tconst node = this._decorations[decorationId];\n\t\tif (!node) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst nodeWasInOverviewRuler = (node.options.overviewRuler && node.options.overviewRuler.color ? true : false);\n\t\tconst nodeIsInOverviewRuler = (options.overviewRuler && options.overviewRuler.color ? true : false);\n\n\t\tthis._onDidChangeDecorations.checkAffectedAndFire(node.options);\n\t\tthis._onDidChangeDecorations.checkAffectedAndFire(options);\n\n\t\tif (node.options.after || options.after) {\n\t\t\tconst nodeRange = this._decorationsTree.getNodeRange(this, node);\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(nodeRange.endLineNumber);\n\t\t}\n\t\tif (node.options.before || options.before) {\n\t\t\tconst nodeRange = this._decorationsTree.getNodeRange(this, node);\n\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(nodeRange.startLineNumber);\n\t\t}\n\n\t\tconst movedInOverviewRuler = nodeWasInOverviewRuler !== nodeIsInOverviewRuler;\n\t\tconst changedWhetherInjectedText = isOptionsInjectedText(options) !== isNodeInjectedText(node);\n\t\tif (movedInOverviewRuler || changedWhetherInjectedText) {\n\t\t\tthis._decorationsTree.delete(node);\n\t\t\tnode.setOptions(options);\n\t\t\tthis._decorationsTree.insert(node);\n\t\t} else {\n\t\t\tnode.setOptions(options);\n\t\t}\n\t}\n\n\tprivate _deltaDecorationsImpl(ownerId: number, oldDecorationsIds: string[], newDecorations: model.IModelDeltaDecoration[], suppressEvents: boolean = false): string[] {\n\t\tconst versionId = this.getVersionId();\n\n\t\tconst oldDecorationsLen = oldDecorationsIds.length;\n\t\tlet oldDecorationIndex = 0;\n\n\t\tconst newDecorationsLen = newDecorations.length;\n\t\tlet newDecorationIndex = 0;\n\n\t\tthis._onDidChangeDecorations.beginDeferredEmit();\n\t\ttry {\n\t\t\tconst result = new Array<string>(newDecorationsLen);\n\t\t\twhile (oldDecorationIndex < oldDecorationsLen || newDecorationIndex < newDecorationsLen) {\n\n\t\t\t\tlet node: IntervalNode | null = null;\n\n\t\t\t\tif (oldDecorationIndex < oldDecorationsLen) {\n\t\t\t\t\t// (1) get ourselves an old node\n\t\t\t\t\tdo {\n\t\t\t\t\t\tnode = this._decorations[oldDecorationsIds[oldDecorationIndex++]];\n\t\t\t\t\t} while (!node && oldDecorationIndex < oldDecorationsLen);\n\n\t\t\t\t\t// (2) remove the node from the tree (if it exists)\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\tif (node.options.after) {\n\t\t\t\t\t\t\tconst nodeRange = this._decorationsTree.getNodeRange(this, node);\n\t\t\t\t\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(nodeRange.endLineNumber);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (node.options.before) {\n\t\t\t\t\t\t\tconst nodeRange = this._decorationsTree.getNodeRange(this, node);\n\t\t\t\t\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(nodeRange.startLineNumber);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tthis._decorationsTree.delete(node);\n\n\t\t\t\t\t\tif (!suppressEvents) {\n\t\t\t\t\t\t\tthis._onDidChangeDecorations.checkAffectedAndFire(node.options);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (newDecorationIndex < newDecorationsLen) {\n\t\t\t\t\t// (3) create a new node if necessary\n\t\t\t\t\tif (!node) {\n\t\t\t\t\t\tconst internalDecorationId = (++this._lastDecorationId);\n\t\t\t\t\t\tconst decorationId = `${this._instanceId};${internalDecorationId}`;\n\t\t\t\t\t\tnode = new IntervalNode(decorationId, 0, 0);\n\t\t\t\t\t\tthis._decorations[decorationId] = node;\n\t\t\t\t\t}\n\n\t\t\t\t\t// (4) initialize node\n\t\t\t\t\tconst newDecoration = newDecorations[newDecorationIndex];\n\t\t\t\t\tconst range = this._validateRangeRelaxedNoAllocations(newDecoration.range);\n\t\t\t\t\tconst options = _normalizeOptions(newDecoration.options);\n\t\t\t\t\tconst startOffset = this._buffer.getOffsetAt(range.startLineNumber, range.startColumn);\n\t\t\t\t\tconst endOffset = this._buffer.getOffsetAt(range.endLineNumber, range.endColumn);\n\n\t\t\t\t\tnode.ownerId = ownerId;\n\t\t\t\t\tnode.reset(versionId, startOffset, endOffset, range);\n\t\t\t\t\tnode.setOptions(options);\n\n\t\t\t\t\tif (node.options.after) {\n\t\t\t\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(range.endLineNumber);\n\t\t\t\t\t}\n\t\t\t\t\tif (node.options.before) {\n\t\t\t\t\t\tthis._onDidChangeDecorations.recordLineAffectedByInjectedText(range.startLineNumber);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!suppressEvents) {\n\t\t\t\t\t\tthis._onDidChangeDecorations.checkAffectedAndFire(options);\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._decorationsTree.insert(node);\n\n\t\t\t\t\tresult[newDecorationIndex] = node.id;\n\n\t\t\t\t\tnewDecorationIndex++;\n\t\t\t\t} else {\n\t\t\t\t\tif (node) {\n\t\t\t\t\t\tdelete this._decorations[node.id];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn result;\n\t\t} finally {\n\t\t\tthis._onDidChangeDecorations.endDeferredEmit();\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Tokenization\n\n\t// TODO move them to the tokenization part.\n\tpublic getLanguageId(): string {\n\t\treturn this.tokenization.getLanguageId();\n\t}\n\n\tpublic setLanguage(languageIdOrSelection: string | ILanguageSelection, source?: string): void {\n\t\tif (typeof languageIdOrSelection === 'string') {\n\t\t\tthis._languageSelectionListener.clear();\n\t\t\tthis._setLanguage(languageIdOrSelection, source);\n\t\t} else {\n\t\t\tthis._languageSelectionListener.value = languageIdOrSelection.onDidChange(() => this._setLanguage(languageIdOrSelection.languageId, source));\n\t\t\tthis._setLanguage(languageIdOrSelection.languageId, source);\n\t\t}\n\t}\n\n\tprivate _setLanguage(languageId: string, source?: string): void {\n\t\tthis.tokenization.setLanguageId(languageId, source);\n\t\tthis._languageService.requestRichLanguageFeatures(languageId);\n\t}\n\n\tpublic getLanguageIdAtPosition(lineNumber: number, column: number): string {\n\t\treturn this.tokenization.getLanguageIdAtPosition(lineNumber, column);\n\t}\n\n\tpublic getWordAtPosition(position: IPosition): IWordAtPosition | null {\n\t\treturn this._tokenizationTextModelPart.getWordAtPosition(position);\n\t}\n\n\tpublic getWordUntilPosition(position: IPosition): IWordAtPosition {\n\t\treturn this._tokenizationTextModelPart.getWordUntilPosition(position);\n\t}\n\n\t//#endregion\n\tnormalizePosition(position: Position, affinity: model.PositionAffinity): Position {\n\t\treturn position;\n\t}\n\n\t/**\n\t * Gets the column at which indentation stops at a given line.\n\t * @internal\n\t*/\n\tpublic getLineIndentColumn(lineNumber: number): number {\n\t\t// Columns start with 1.\n\t\treturn indentOfLine(this.getLineContent(lineNumber)) + 1;\n\t}\n}\n\nexport function indentOfLine(line: string): number {\n\tlet indent = 0;\n\tfor (const c of line) {\n\t\tif (c === ' ' || c === '\\t') {\n\t\t\tindent++;\n\t\t} else {\n\t\t\tbreak;\n\t\t}\n\t}\n\treturn indent;\n}\n\n//#region Decorations\n\nfunction isNodeInOverviewRuler(node: IntervalNode): boolean {\n\treturn (node.options.overviewRuler && node.options.overviewRuler.color ? true : false);\n}\n\nfunction isOptionsInjectedText(options: ModelDecorationOptions): boolean {\n\treturn !!options.after || !!options.before;\n}\n\nfunction isNodeInjectedText(node: IntervalNode): boolean {\n\treturn !!node.options.after || !!node.options.before;\n}\n\nexport interface IDecorationsTreesHost {\n\tgetVersionId(): number;\n\tgetRangeAt(start: number, end: number): Range;\n}\n\nclass DecorationsTrees {\n\n\t/**\n\t * This tree holds decorations that do not show up in the overview ruler.\n\t */\n\tprivate readonly _decorationsTree0: IntervalTree;\n\n\t/**\n\t * This tree holds decorations that show up in the overview ruler.\n\t */\n\tprivate readonly _decorationsTree1: IntervalTree;\n\n\t/**\n\t * This tree holds decorations that contain injected text.\n\t */\n\tprivate readonly _injectedTextDecorationsTree: IntervalTree;\n\n\tconstructor() {\n\t\tthis._decorationsTree0 = new IntervalTree();\n\t\tthis._decorationsTree1 = new IntervalTree();\n\t\tthis._injectedTextDecorationsTree = new IntervalTree();\n\t}\n\n\tpublic ensureAllNodesHaveRanges(host: IDecorationsTreesHost): void {\n\t\tthis.getAll(host, 0, false, false, false);\n\t}\n\n\tprivate _ensureNodesHaveRanges(host: IDecorationsTreesHost, nodes: IntervalNode[]): model.IModelDecoration[] {\n\t\tfor (const node of nodes) {\n\t\t\tif (node.range === null) {\n\t\t\t\tnode.range = host.getRangeAt(node.cachedAbsoluteStart, node.cachedAbsoluteEnd);\n\t\t\t}\n\t\t}\n\t\treturn <model.IModelDecoration[]>nodes;\n\t}\n\n\tpublic getAllInInterval(host: IDecorationsTreesHost, start: number, end: number, filterOwnerId: number, filterOutValidation: boolean, onlyMarginDecorations: boolean): model.IModelDecoration[] {\n\t\tconst versionId = host.getVersionId();\n\t\tconst result = this._intervalSearch(start, end, filterOwnerId, filterOutValidation, versionId, onlyMarginDecorations);\n\t\treturn this._ensureNodesHaveRanges(host, result);\n\t}\n\n\tprivate _intervalSearch(start: number, end: number, filterOwnerId: number, filterOutValidation: boolean, cachedVersionId: number, onlyMarginDecorations: boolean): IntervalNode[] {\n\t\tconst r0 = this._decorationsTree0.intervalSearch(start, end, filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\tconst r1 = this._decorationsTree1.intervalSearch(start, end, filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\tconst r2 = this._injectedTextDecorationsTree.intervalSearch(start, end, filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\treturn r0.concat(r1).concat(r2);\n\t}\n\n\tpublic getInjectedTextInInterval(host: IDecorationsTreesHost, start: number, end: number, filterOwnerId: number): model.IModelDecoration[] {\n\t\tconst versionId = host.getVersionId();\n\t\tconst result = this._injectedTextDecorationsTree.intervalSearch(start, end, filterOwnerId, false, versionId, false);\n\t\treturn this._ensureNodesHaveRanges(host, result).filter((i) => i.options.showIfCollapsed || !i.range.isEmpty());\n\t}\n\n\tpublic getAllInjectedText(host: IDecorationsTreesHost, filterOwnerId: number): model.IModelDecoration[] {\n\t\tconst versionId = host.getVersionId();\n\t\tconst result = this._injectedTextDecorationsTree.search(filterOwnerId, false, versionId, false);\n\t\treturn this._ensureNodesHaveRanges(host, result).filter((i) => i.options.showIfCollapsed || !i.range.isEmpty());\n\t}\n\n\tpublic getAll(host: IDecorationsTreesHost, filterOwnerId: number, filterOutValidation: boolean, overviewRulerOnly: boolean, onlyMarginDecorations: boolean): model.IModelDecoration[] {\n\t\tconst versionId = host.getVersionId();\n\t\tconst result = this._search(filterOwnerId, filterOutValidation, overviewRulerOnly, versionId, onlyMarginDecorations);\n\t\treturn this._ensureNodesHaveRanges(host, result);\n\t}\n\n\tprivate _search(filterOwnerId: number, filterOutValidation: boolean, overviewRulerOnly: boolean, cachedVersionId: number, onlyMarginDecorations: boolean): IntervalNode[] {\n\t\tif (overviewRulerOnly) {\n\t\t\treturn this._decorationsTree1.search(filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\t} else {\n\t\t\tconst r0 = this._decorationsTree0.search(filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\t\tconst r1 = this._decorationsTree1.search(filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\t\tconst r2 = this._injectedTextDecorationsTree.search(filterOwnerId, filterOutValidation, cachedVersionId, onlyMarginDecorations);\n\t\t\treturn r0.concat(r1).concat(r2);\n\t\t}\n\t}\n\n\tpublic collectNodesFromOwner(ownerId: number): IntervalNode[] {\n\t\tconst r0 = this._decorationsTree0.collectNodesFromOwner(ownerId);\n\t\tconst r1 = this._decorationsTree1.collectNodesFromOwner(ownerId);\n\t\tconst r2 = this._injectedTextDecorationsTree.collectNodesFromOwner(ownerId);\n\t\treturn r0.concat(r1).concat(r2);\n\t}\n\n\tpublic collectNodesPostOrder(): IntervalNode[] {\n\t\tconst r0 = this._decorationsTree0.collectNodesPostOrder();\n\t\tconst r1 = this._decorationsTree1.collectNodesPostOrder();\n\t\tconst r2 = this._injectedTextDecorationsTree.collectNodesPostOrder();\n\t\treturn r0.concat(r1).concat(r2);\n\t}\n\n\tpublic insert(node: IntervalNode): void {\n\t\tif (isNodeInjectedText(node)) {\n\t\t\tthis._injectedTextDecorationsTree.insert(node);\n\t\t} else if (isNodeInOverviewRuler(node)) {\n\t\t\tthis._decorationsTree1.insert(node);\n\t\t} else {\n\t\t\tthis._decorationsTree0.insert(node);\n\t\t}\n\t}\n\n\tpublic delete(node: IntervalNode): void {\n\t\tif (isNodeInjectedText(node)) {\n\t\t\tthis._injectedTextDecorationsTree.delete(node);\n\t\t} else if (isNodeInOverviewRuler(node)) {\n\t\t\tthis._decorationsTree1.delete(node);\n\t\t} else {\n\t\t\tthis._decorationsTree0.delete(node);\n\t\t}\n\t}\n\n\tpublic getNodeRange(host: IDecorationsTreesHost, node: IntervalNode): Range {\n\t\tconst versionId = host.getVersionId();\n\t\tif (node.cachedVersionId !== versionId) {\n\t\t\tthis._resolveNode(node, versionId);\n\t\t}\n\t\tif (node.range === null) {\n\t\t\tnode.range = host.getRangeAt(node.cachedAbsoluteStart, node.cachedAbsoluteEnd);\n\t\t}\n\t\treturn node.range;\n\t}\n\n\tprivate _resolveNode(node: IntervalNode, cachedVersionId: number): void {\n\t\tif (isNodeInjectedText(node)) {\n\t\t\tthis._injectedTextDecorationsTree.resolveNode(node, cachedVersionId);\n\t\t} else if (isNodeInOverviewRuler(node)) {\n\t\t\tthis._decorationsTree1.resolveNode(node, cachedVersionId);\n\t\t} else {\n\t\t\tthis._decorationsTree0.resolveNode(node, cachedVersionId);\n\t\t}\n\t}\n\n\tpublic acceptReplace(offset: number, length: number, textLength: number, forceMoveMarkers: boolean): void {\n\t\tthis._decorationsTree0.acceptReplace(offset, length, textLength, forceMoveMarkers);\n\t\tthis._decorationsTree1.acceptReplace(offset, length, textLength, forceMoveMarkers);\n\t\tthis._injectedTextDecorationsTree.acceptReplace(offset, length, textLength, forceMoveMarkers);\n\t}\n}\n\nfunction cleanClassName(className: string): string {\n\treturn className.replace(/[^a-z0-9\\-_]/gi, ' ');\n}\n\nclass DecorationOptions implements model.IDecorationOptions {\n\treadonly color: string | ThemeColor;\n\treadonly darkColor: string | ThemeColor;\n\n\tconstructor(options: model.IDecorationOptions) {\n\t\tthis.color = options.color || '';\n\t\tthis.darkColor = options.darkColor || '';\n\n\t}\n}\n\nexport class ModelDecorationOverviewRulerOptions extends DecorationOptions {\n\treadonly position: model.OverviewRulerLane;\n\tprivate _resolvedColor: string | null;\n\n\tconstructor(options: model.IModelDecorationOverviewRulerOptions) {\n\t\tsuper(options);\n\t\tthis._resolvedColor = null;\n\t\tthis.position = (typeof options.position === 'number' ? options.position : model.OverviewRulerLane.Center);\n\t}\n\n\tpublic getColor(theme: IColorTheme): string {\n\t\tif (!this._resolvedColor) {\n\t\t\tif (theme.type !== 'light' && this.darkColor) {\n\t\t\t\tthis._resolvedColor = this._resolveColor(this.darkColor, theme);\n\t\t\t} else {\n\t\t\t\tthis._resolvedColor = this._resolveColor(this.color, theme);\n\t\t\t}\n\t\t}\n\t\treturn this._resolvedColor;\n\t}\n\n\tpublic invalidateCachedColor(): void {\n\t\tthis._resolvedColor = null;\n\t}\n\n\tprivate _resolveColor(color: string | ThemeColor, theme: IColorTheme): string {\n\t\tif (typeof color === 'string') {\n\t\t\treturn color;\n\t\t}\n\t\tconst c = color ? theme.getColor(color.id) : null;\n\t\tif (!c) {\n\t\t\treturn '';\n\t\t}\n\t\treturn c.toString();\n\t}\n}\n\nexport class ModelDecorationGlyphMarginOptions {\n\treadonly position: model.GlyphMarginLane;\n\treadonly persistLane: boolean | undefined;\n\n\tconstructor(options: model.IModelDecorationGlyphMarginOptions | null | undefined) {\n\t\tthis.position = options?.position ?? model.GlyphMarginLane.Center;\n\t\tthis.persistLane = options?.persistLane;\n\t}\n}\n\nexport class ModelDecorationMinimapOptions extends DecorationOptions {\n\treadonly position: model.MinimapPosition;\n\treadonly sectionHeaderStyle: model.MinimapSectionHeaderStyle | null;\n\treadonly sectionHeaderText: string | null;\n\tprivate _resolvedColor: Color | undefined;\n\n\tconstructor(options: model.IModelDecorationMinimapOptions) {\n\t\tsuper(options);\n\t\tthis.position = options.position;\n\t\tthis.sectionHeaderStyle = options.sectionHeaderStyle ?? null;\n\t\tthis.sectionHeaderText = options.sectionHeaderText ?? null;\n\t}\n\n\tpublic getColor(theme: IColorTheme): Color | undefined {\n\t\tif (!this._resolvedColor) {\n\t\t\tif (theme.type !== 'light' && this.darkColor) {\n\t\t\t\tthis._resolvedColor = this._resolveColor(this.darkColor, theme);\n\t\t\t} else {\n\t\t\t\tthis._resolvedColor = this._resolveColor(this.color, theme);\n\t\t\t}\n\t\t}\n\n\t\treturn this._resolvedColor;\n\t}\n\n\tpublic invalidateCachedColor(): void {\n\t\tthis._resolvedColor = undefined;\n\t}\n\n\tprivate _resolveColor(color: string | ThemeColor, theme: IColorTheme): Color | undefined {\n\t\tif (typeof color === 'string') {\n\t\t\treturn Color.fromHex(color);\n\t\t}\n\t\treturn theme.getColor(color.id);\n\t}\n}\n\nexport class ModelDecorationInjectedTextOptions implements model.InjectedTextOptions {\n\tpublic static from(options: model.InjectedTextOptions): ModelDecorationInjectedTextOptions {\n\t\tif (options instanceof ModelDecorationInjectedTextOptions) {\n\t\t\treturn options;\n\t\t}\n\t\treturn new ModelDecorationInjectedTextOptions(options);\n\t}\n\n\tpublic readonly content: string;\n\tpublic readonly tokens: TokenArray | null;\n\treadonly inlineClassName: string | null;\n\treadonly inlineClassNameAffectsLetterSpacing: boolean;\n\treadonly attachedData: unknown | null;\n\treadonly cursorStops: model.InjectedTextCursorStops | null;\n\n\tprivate constructor(options: model.InjectedTextOptions) {\n\t\tthis.content = options.content || '';\n\t\tthis.tokens = options.tokens ?? null;\n\t\tthis.inlineClassName = options.inlineClassName || null;\n\t\tthis.inlineClassNameAffectsLetterSpacing = options.inlineClassNameAffectsLetterSpacing || false;\n\t\tthis.attachedData = options.attachedData || null;\n\t\tthis.cursorStops = options.cursorStops || null;\n\t}\n}\n\nexport class ModelDecorationOptions implements model.IModelDecorationOptions {\n\n\tpublic static EMPTY: ModelDecorationOptions;\n\n\tpublic static register(options: model.IModelDecorationOptions): ModelDecorationOptions {\n\t\treturn new ModelDecorationOptions(options);\n\t}\n\n\tpublic static createDynamic(options: model.IModelDecorationOptions): ModelDecorationOptions {\n\t\treturn new ModelDecorationOptions(options);\n\t}\n\treadonly description: string;\n\treadonly blockClassName: string | null;\n\treadonly blockIsAfterEnd: boolean | null;\n\treadonly blockDoesNotCollapse?: boolean | null;\n\treadonly blockPadding: [top: number, right: number, bottom: number, left: number] | null;\n\treadonly stickiness: model.TrackedRangeStickiness;\n\treadonly zIndex: number;\n\treadonly className: string | null;\n\treadonly shouldFillLineOnLineBreak: boolean | null;\n\treadonly hoverMessage: IMarkdownString | IMarkdownString[] | null;\n\treadonly glyphMarginHoverMessage: IMarkdownString | IMarkdownString[] | null;\n\treadonly isWholeLine: boolean;\n\treadonly showIfCollapsed: boolean;\n\treadonly collapseOnReplaceEdit: boolean;\n\treadonly overviewRuler: ModelDecorationOverviewRulerOptions | null;\n\treadonly minimap: ModelDecorationMinimapOptions | null;\n\treadonly glyphMargin?: model.IModelDecorationGlyphMarginOptions | null | undefined;\n\treadonly glyphMarginClassName: string | null;\n\treadonly linesDecorationsClassName: string | null;\n\treadonly lineNumberClassName: string | null;\n\treadonly lineNumberHoverMessage: IMarkdownString | IMarkdownString[] | null;\n\treadonly linesDecorationsTooltip: string | null;\n\treadonly firstLineDecorationClassName: string | null;\n\treadonly marginClassName: string | null;\n\treadonly inlineClassName: string | null;\n\treadonly inlineClassNameAffectsLetterSpacing: boolean;\n\treadonly beforeContentClassName: string | null;\n\treadonly afterContentClassName: string | null;\n\treadonly after: ModelDecorationInjectedTextOptions | null;\n\treadonly before: ModelDecorationInjectedTextOptions | null;\n\treadonly hideInCommentTokens: boolean | null;\n\treadonly hideInStringTokens: boolean | null;\n\n\tprivate constructor(options: model.IModelDecorationOptions) {\n\t\tthis.description = options.description;\n\t\tthis.blockClassName = options.blockClassName ? cleanClassName(options.blockClassName) : null;\n\t\tthis.blockDoesNotCollapse = options.blockDoesNotCollapse ?? null;\n\t\tthis.blockIsAfterEnd = options.blockIsAfterEnd ?? null;\n\t\tthis.blockPadding = options.blockPadding ?? null;\n\t\tthis.stickiness = options.stickiness || model.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges;\n\t\tthis.zIndex = options.zIndex || 0;\n\t\tthis.className = options.className ? cleanClassName(options.className) : null;\n\t\tthis.shouldFillLineOnLineBreak = options.shouldFillLineOnLineBreak ?? null;\n\t\tthis.hoverMessage = options.hoverMessage || null;\n\t\tthis.glyphMarginHoverMessage = options.glyphMarginHoverMessage || null;\n\t\tthis.lineNumberHoverMessage = options.lineNumberHoverMessage || null;\n\t\tthis.isWholeLine = options.isWholeLine || false;\n\t\tthis.showIfCollapsed = options.showIfCollapsed || false;\n\t\tthis.collapseOnReplaceEdit = options.collapseOnReplaceEdit || false;\n\t\tthis.overviewRuler = options.overviewRuler ? new ModelDecorationOverviewRulerOptions(options.overviewRuler) : null;\n\t\tthis.minimap = options.minimap ? new ModelDecorationMinimapOptions(options.minimap) : null;\n\t\tthis.glyphMargin = options.glyphMarginClassName ? new ModelDecorationGlyphMarginOptions(options.glyphMargin) : null;\n\t\tthis.glyphMarginClassName = options.glyphMarginClassName ? cleanClassName(options.glyphMarginClassName) : null;\n\t\tthis.linesDecorationsClassName = options.linesDecorationsClassName ? cleanClassName(options.linesDecorationsClassName) : null;\n\t\tthis.lineNumberClassName = options.lineNumberClassName ? cleanClassName(options.lineNumberClassName) : null;\n\t\tthis.linesDecorationsTooltip = options.linesDecorationsTooltip ? strings.htmlAttributeEncodeValue(options.linesDecorationsTooltip) : null;\n\t\tthis.firstLineDecorationClassName = options.firstLineDecorationClassName ? cleanClassName(options.firstLineDecorationClassName) : null;\n\t\tthis.marginClassName = options.marginClassName ? cleanClassName(options.marginClassName) : null;\n\t\tthis.inlineClassName = options.inlineClassName ? cleanClassName(options.inlineClassName) : null;\n\t\tthis.inlineClassNameAffectsLetterSpacing = options.inlineClassNameAffectsLetterSpacing || false;\n\t\tthis.beforeContentClassName = options.beforeContentClassName ? cleanClassName(options.beforeContentClassName) : null;\n\t\tthis.afterContentClassName = options.afterContentClassName ? cleanClassName(options.afterContentClassName) : null;\n\t\tthis.after = options.after ? ModelDecorationInjectedTextOptions.from(options.after) : null;\n\t\tthis.before = options.before ? ModelDecorationInjectedTextOptions.from(options.before) : null;\n\t\tthis.hideInCommentTokens = options.hideInCommentTokens ?? false;\n\t\tthis.hideInStringTokens = options.hideInStringTokens ?? false;\n\t}\n}\nModelDecorationOptions.EMPTY = ModelDecorationOptions.register({ description: 'empty' });\n\n/**\n * The order carefully matches the values of the enum.\n */\nconst TRACKED_RANGE_OPTIONS = [\n\tModelDecorationOptions.register({ description: 'tracked-range-always-grows-when-typing-at-edges', stickiness: model.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges }),\n\tModelDecorationOptions.register({ description: 'tracked-range-never-grows-when-typing-at-edges', stickiness: model.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges }),\n\tModelDecorationOptions.register({ description: 'tracked-range-grows-only-when-typing-before', stickiness: model.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore }),\n\tModelDecorationOptions.register({ description: 'tracked-range-grows-only-when-typing-after', stickiness: model.TrackedRangeStickiness.GrowsOnlyWhenTypingAfter }),\n];\n\nfunction _normalizeOptions(options: model.IModelDecorationOptions): ModelDecorationOptions {\n\tif (options instanceof ModelDecorationOptions) {\n\t\treturn options;\n\t}\n\treturn ModelDecorationOptions.createDynamic(options);\n}\n\nclass DidChangeDecorationsEmitter extends Disposable {\n\n\tprivate readonly _actual: Emitter<IModelDecorationsChangedEvent> = this._register(new Emitter<IModelDecorationsChangedEvent>());\n\tpublic readonly event: Event<IModelDecorationsChangedEvent> = this._actual.event;\n\n\tprivate _deferredCnt: number;\n\tprivate _shouldFireDeferred: boolean;\n\tprivate _affectsMinimap: boolean;\n\tprivate _affectsOverviewRuler: boolean;\n\tprivate _affectedInjectedTextLines: Set<number> | null = null;\n\tprivate _affectsGlyphMargin: boolean;\n\tprivate _affectsLineNumber: boolean;\n\n\tconstructor(private readonly handleBeforeFire: (affectedInjectedTextLines: Set<number> | null) => void) {\n\t\tsuper();\n\t\tthis._deferredCnt = 0;\n\t\tthis._shouldFireDeferred = false;\n\t\tthis._affectsMinimap = false;\n\t\tthis._affectsOverviewRuler = false;\n\t\tthis._affectsGlyphMargin = false;\n\t\tthis._affectsLineNumber = false;\n\t}\n\n\thasListeners(): boolean {\n\t\treturn this._actual.hasListeners();\n\t}\n\n\tpublic beginDeferredEmit(): void {\n\t\tthis._deferredCnt++;\n\t}\n\n\tpublic endDeferredEmit(): void {\n\t\tthis._deferredCnt--;\n\t\tif (this._deferredCnt === 0) {\n\t\t\tif (this._shouldFireDeferred) {\n\t\t\t\tthis.doFire();\n\t\t\t}\n\n\t\t\tthis._affectedInjectedTextLines?.clear();\n\t\t\tthis._affectedInjectedTextLines = null;\n\t\t}\n\t}\n\n\tpublic recordLineAffectedByInjectedText(lineNumber: number): void {\n\t\tif (!this._affectedInjectedTextLines) {\n\t\t\tthis._affectedInjectedTextLines = new Set();\n\t\t}\n\t\tthis._affectedInjectedTextLines.add(lineNumber);\n\t}\n\n\tpublic checkAffectedAndFire(options: ModelDecorationOptions): void {\n\t\tthis._affectsMinimap ||= !!options.minimap?.position;\n\t\tthis._affectsOverviewRuler ||= !!options.overviewRuler?.color;\n\t\tthis._affectsGlyphMargin ||= !!options.glyphMarginClassName;\n\t\tthis._affectsLineNumber ||= !!options.lineNumberClassName;\n\t\tthis.tryFire();\n\t}\n\n\tpublic fire(): void {\n\t\tthis._affectsMinimap = true;\n\t\tthis._affectsOverviewRuler = true;\n\t\tthis._affectsGlyphMargin = true;\n\t\tthis.tryFire();\n\t}\n\n\tprivate tryFire() {\n\t\tif (this._deferredCnt === 0) {\n\t\t\tthis.doFire();\n\t\t} else {\n\t\t\tthis._shouldFireDeferred = true;\n\t\t}\n\t}\n\n\tprivate doFire() {\n\t\tthis.handleBeforeFire(this._affectedInjectedTextLines);\n\n\t\tconst event: IModelDecorationsChangedEvent = {\n\t\t\taffectsMinimap: this._affectsMinimap,\n\t\t\taffectsOverviewRuler: this._affectsOverviewRuler,\n\t\t\taffectsGlyphMargin: this._affectsGlyphMargin,\n\t\t\taffectsLineNumber: this._affectsLineNumber,\n\t\t};\n\t\tthis._shouldFireDeferred = false;\n\t\tthis._affectsMinimap = false;\n\t\tthis._affectsOverviewRuler = false;\n\t\tthis._affectsGlyphMargin = false;\n\t\tthis._actual.fire(event);\n\t}\n}\n\n//#endregion\n\nclass DidChangeContentEmitter extends Disposable {\n\n\t/**\n\t * Both `fastEvent` and `slowEvent` work the same way and contain the same events, but first we invoke `fastEvent` and then `slowEvent`.\n\t */\n\tprivate readonly _fastEmitter: Emitter<InternalModelContentChangeEvent> = this._register(new Emitter<InternalModelContentChangeEvent>());\n\tpublic readonly fastEvent: Event<InternalModelContentChangeEvent> = this._fastEmitter.event;\n\tprivate readonly _slowEmitter: Emitter<InternalModelContentChangeEvent> = this._register(new Emitter<InternalModelContentChangeEvent>());\n\tpublic readonly slowEvent: Event<InternalModelContentChangeEvent> = this._slowEmitter.event;\n\n\tprivate _deferredCnt: number;\n\tprivate _deferredEvent: InternalModelContentChangeEvent | null;\n\n\tconstructor() {\n\t\tsuper();\n\t\tthis._deferredCnt = 0;\n\t\tthis._deferredEvent = null;\n\t}\n\n\tpublic hasListeners(): boolean {\n\t\treturn (\n\t\t\tthis._fastEmitter.hasListeners()\n\t\t\t|| this._slowEmitter.hasListeners()\n\t\t);\n\t}\n\n\tpublic beginDeferredEmit(): void {\n\t\tthis._deferredCnt++;\n\t}\n\n\tpublic endDeferredEmit(resultingSelection: Selection[] | null = null): void {\n\t\tthis._deferredCnt--;\n\t\tif (this._deferredCnt === 0) {\n\t\t\tif (this._deferredEvent !== null) {\n\t\t\t\tthis._deferredEvent.rawContentChangedEvent.resultingSelection = resultingSelection;\n\t\t\t\tconst e = this._deferredEvent;\n\t\t\t\tthis._deferredEvent = null;\n\t\t\t\tthis._fastEmitter.fire(e);\n\t\t\t\tthis._slowEmitter.fire(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic fire(e: InternalModelContentChangeEvent): void {\n\t\tif (this._deferredCnt > 0) {\n\t\t\tif (this._deferredEvent) {\n\t\t\t\tthis._deferredEvent = this._deferredEvent.merge(e);\n\t\t\t} else {\n\t\t\t\tthis._deferredEvent = e;\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tthis._fastEmitter.fire(e);\n\t\tthis._slowEmitter.fire(e);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,YAAY,gBAAgB;AACrC,SAAS,UAAU,8BAA8B;AACjD,SAAS,aAAa;AACtB,SAAS,oBAAoB,iBAAiB,yBAAyB;AACvE,SAAS,SAAS,aAAa;AAC/B,SAAS,uBAAuB;AAChC,SAAS,YAAY,aAAa,mBAAmB,0BAA0B;AAC/E,SAAS,oBAAoB;AAC7B,YAAY,aAAa;AACzB,SAAS,kBAAkB;AAC3B,SAAS,iBAAiB;AAC1B,SAAS,WAAW;AACpB,SAAS,4BAA4B;AACrC,SAAS,gBAAgB;AACzB,SAAS,4BAA4B;AACrC,SAAS,WAAW,gBAAgB;AACpC,SAAS,QAAQ,aAAa;AAC9B,SAAS,iBAAiB;AAC1B,SAAS,kBAAkB;AAC3B,SAAS,6BAA6B;AACtC,SAAS,uBAAuB;AAChC,SAAS,yBAAyB;AAClC,SAAS,oBAAoB,wBAAwB;AACrD,SAAS,qCAAqC;AAC9C,YAAY,WAAW;AACvB,SAAS,iCAAiC;AAC1C,SAAS,+CAA+C;AACxD,SAAS,iBAAiB;AAC1B,SAAS,2BAA2B;AACpC,SAAS,wBAAwB;AACjC,SAAS,cAAc,cAAc,uBAAuB;AAC5D,SAAS,2BAA2B;AACpC,SAAS,kCAAkC;AAC3C,SAAS,cAAc,uBAAuB;AAC9C,SAAS,iCAAiC;AAC1C,SAAS,qBAAqB;AAC9B,SAAS,kCAAkC;AAC3C,SAAS,2BAA2B,+BAA+B,2BAA2B,iCAAiC,kBAAkB,+BAA+B,gBAAgB,6BAA6B,oBAAoB,eAAe,qBAAqB,sBAAsB,6BAA6B;AACxU,SAAS,4BAA4B;AACrC,SAAS,kCAAkC;AAC3C,SAAS,6BAA6B;AACtC,SAAS,mBAAmB;AAC5B,SAAS,kBAAkB,2BAA2B,qBAAqB;AAC3E,SAAS,kBAAkB;AAEpB,SAAS,wBAAwB,MAAwC;AAC/E,QAAM,UAAU,IAAI,2BAA2B;AAC/C,UAAQ,YAAY,IAAI;AACxB,SAAO,QAAQ,OAAO;AACvB;AAJgB;AAeT,SAAS,kCAAkC,QAAiF;AAClI,SAAO,IAAI,QAAkC,CAAC,SAAS,WAAW;AACjE,UAAM,UAAU,IAAI,2BAA2B;AAE/C,QAAI,OAAO;AAEX,iBAAgC,QAAQ;AAAA,MACvC,QAAQ,kCAAS;AAChB,gBAAQ,YAAa,OAAO,UAAU,WAAY,QAAQ,MAAM,SAAS,CAAC;AAAA,MAC3E,GAFQ;AAAA,MAGR,SAAS,kCAAS;AACjB,YAAI,CAAC,MAAM;AACV,iBAAO;AACP,iBAAO,KAAK;AAAA,QACb;AAAA,MACD,GALS;AAAA,MAMT,OAAO,6BAAM;AACZ,YAAI,CAAC,MAAM;AACV,iBAAO;AACP,kBAAQ,QAAQ,OAAO,CAAC;AAAA,QACzB;AAAA,MACD,GALO;AAAA,IAMR,CAAC;AAAA,EACF,CAAC;AACF;AAxBgB;AA0BT,SAAS,oCAAoC,UAAyD;AAC5G,QAAM,UAAU,IAAI,2BAA2B;AAE/C,MAAI;AACJ,SAAO,QAAQ,QAAQ,SAAS,KAAK,OAAO,UAAU;AACrD,YAAQ,YAAY,KAAK;AAAA,EAC1B;AAEA,SAAO,QAAQ,OAAO;AACvB;AATgB;AAWT,SAAS,iBAAiB,OAAgE,YAAgG;AAChM,MAAI;AACJ,MAAI,OAAO,UAAU,UAAU;AAC9B,cAAU,wBAAwB,KAAK;AAAA,EACxC,WAAW,MAAM,gBAAgB,KAAK,GAAG;AACxC,cAAU,oCAAoC,KAAK;AAAA,EACpD,OAAO;AACN,cAAU;AAAA,EACX;AACA,SAAO,QAAQ,OAAO,UAAU;AACjC;AAVgB;AAYhB,IAAI,WAAW;AAEf,MAAM,mBAAmB;AACzB,MAAM,qBAAqB;AAE3B,MAAM,kBAAiD;AAAA,EAvHvD,OAuHuD;AAAA;AAAA;AAAA,EAErC;AAAA,EACT;AAAA,EAER,YAAY,QAA6B;AACxC,SAAK,UAAU;AACf,SAAK,OAAO;AAAA,EACb;AAAA,EAEO,OAAsB;AAC5B,QAAI,KAAK,MAAM;AACd,aAAO;AAAA,IACR;AAEA,UAAM,SAAmB,CAAC;AAC1B,QAAI,YAAY;AAChB,QAAI,eAAe;AAEnB,OAAG;AACF,YAAM,MAAM,KAAK,QAAQ,KAAK;AAE9B,UAAI,QAAQ,MAAM;AAEjB,aAAK,OAAO;AACZ,YAAI,cAAc,GAAG;AACpB,iBAAO;AAAA,QACR,OAAO;AACN,iBAAO,OAAO,KAAK,EAAE;AAAA,QACtB;AAAA,MACD;AAEA,UAAI,IAAI,SAAS,GAAG;AACnB,eAAO,WAAW,IAAI;AACtB,wBAAgB,IAAI;AAAA,MACrB;AAEA,UAAI,gBAAgB,KAAK,MAAM;AAC9B,eAAO,OAAO,KAAK,EAAE;AAAA,MACtB;AAAA,IACD,SAAS;AAAA,EACV;AACD;AAEA,MAAM,cAAc,6BAAM;AAAE,QAAM,IAAI,MAAM,yBAAyB;AAAG,GAApD;AAEpB,IAAW,6BAAX,kBAAWA,gCAAX;AAIC,EAAAA,wDAAA,aAAU,KAAV;AAIA,EAAAA,wDAAA,oBAAiB,KAAjB;AARU,SAAAA;AAAA,GAAA;AAWJ,IAAM,YAAN,cAAwB,WAA8D;AAAA,EAuH5F,YACC,QACA,uBACA,iBACA,qBAAiC,MACE,kBACA,kBACa,+BACR,sBACvC;AACD,UAAM;AAL6B;AACA;AACa;AACR;AAKxC;AACA,SAAK,KAAK,WAAW;AACrB,SAAK,oBAAoB,gBAAgB;AACzC,QAAI,OAAO,uBAAuB,eAAe,uBAAuB,MAAM;AAC7E,WAAK,sBAAsB,IAAI,MAAM,sBAAsB,QAAQ;AAAA,IACpE,OAAO;AACN,WAAK,sBAAsB;AAAA,IAC5B;AACA,SAAK,uBAAuB;AAE5B,UAAM,EAAE,YAAY,WAAW,IAAI,iBAAiB,QAAQ,gBAAgB,UAAU;AACtF,SAAK,UAAU;AACf,SAAK,oBAAoB;AAEzB,SAAK,WAAW,UAAU,eAAe,KAAK,SAAS,eAAe;AAEtE,UAAM,aAAc,OAAO,0BAA0B,WAAW,wBAAwB,sBAAsB;AAC9G,QAAI,OAAO,0BAA0B,UAAU;AAC9C,WAAK,2BAA2B,QAAQ,sBAAsB,YAAY,MAAM,KAAK,aAAa,sBAAsB,UAAU,CAAC;AAAA,IACpI;AAEA,SAAK,gBAAgB,KAAK,UAAU,IAAI,0BAA0B,MAAM,KAAK,6BAA6B,CAAC;AAC3G,SAAK,uBAAuB,KAAK,UAAU,IAAI,oBAAoB,MAAM,KAAK,6BAA6B,CAAC;AAC5G,SAAK,sBAAsB,KAAK,UAAU,IAAI,wCAAwC,IAAI,CAAC;AAC3F,SAAK,6BAA6B,KAAK,qBAAqB;AAAA,MAAe;AAAA,MAC1E;AAAA,MACA,KAAK;AAAA,MACL;AAAA,MACA,KAAK;AAAA,IACN;AAEA,UAAM,kBAAkB,KAAK,QAAQ,aAAa;AAClD,UAAM,mBAAmB,KAAK,QAAQ,sBAAsB,IAAI,MAAM,GAAG,GAAG,iBAAiB,KAAK,QAAQ,cAAc,eAAe,IAAI,CAAC,GAAG,MAAM,oBAAoB,WAAW;AAKpL,QAAI,gBAAgB,wBAAwB;AAC3C,WAAK,6BACH,mBAAmB,UAAU,6BAC1B,kBAAkB,UAAU;AAGjC,WAAK,8BAA8B,mBAAmB,UAAU;AAAA,IACjE,OAAO;AACN,WAAK,6BAA6B;AAClC,WAAK,8BAA8B;AAAA,IACpC;AAEA,SAAK,wBAAyB,mBAAmB,UAAU;AAE3D,SAAK,aAAa;AAClB,SAAK,wBAAwB;AAC7B,SAAK,2BAA2B;AAEhC,SAAK,cAAc;AACnB,SAAK,gBAAgB;AAErB,SAAK,cAAc,QAAQ,iBAAiB,QAAQ;AACpD,SAAK,oBAAoB;AACzB,SAAK,eAAe,uBAAO,OAAO,IAAI;AACtC,SAAK,mBAAmB,IAAI,iBAAiB;AAE7C,SAAK,kBAAkB,IAAI,UAAU,MAAM,KAAK,gBAAgB;AAChE,SAAK,aAAa;AAClB,SAAK,aAAa;AAClB,SAAK,2BAA2B;AAGhC,SAAK,UAAU,KAAK,oBAAoB,YAAY,MAAM;AACzD,WAAK,wBAAwB,kBAAkB;AAC/C,WAAK,wBAAwB,KAAK;AAClC,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C,CAAC,CAAC;AAEF,SAAK,iBAAiB,4BAA4B,UAAU;AAE5D,SAAK,UAAU,KAAK,8BAA8B,YAAY,OAAK;AAClE,WAAK,cAAc,yCAAyC,CAAC;AAC7D,WAAK,2BAA2B,yCAAyC,CAAC;AAAA,IAC3E,CAAC,CAAC;AAAA,EACH;AAAA,EArYD,OAgL6F;AAAA;AAAA;AAAA,EAE5F,OAAO,oBAAoB,KAAK,OAAO;AAAA;AAAA,EACvC,OAAwB,4BAA4B,KAAK,OAAO;AAAA;AAAA,EAChE,OAAwB,kCAAkC,MAAM;AAAA;AAAA,EAChE,OAAwB,sCAAsC,MAAM,OAAO;AAAA;AAAA,EAE3E,OAAc,2BAA4D;AAAA,IACzE,mBAAmB;AAAA,IACnB,SAAS,sBAAsB;AAAA,IAC/B,YAAY,sBAAsB;AAAA,IAClC,cAAc,sBAAsB;AAAA,IACpC,mBAAmB;AAAA,IACnB,YAAY,MAAM,iBAAiB;AAAA,IACnC,oBAAoB,sBAAsB;AAAA,IAC1C,wBAAwB,sBAAsB;AAAA,IAC9C,gCAAgC,sBAAsB;AAAA,EACvD;AAAA,EAEA,OAAc,eAAe,YAA+B,SAA0E;AACrI,QAAI,QAAQ,mBAAmB;AAC9B,YAAM,qBAAqB,iBAAiB,YAAY,QAAQ,SAAS,QAAQ,YAAY;AAC7F,aAAO,IAAI,MAAM,yBAAyB;AAAA,QACzC,SAAS,mBAAmB;AAAA,QAC5B,YAAY;AAAA;AAAA,QACZ,cAAc,mBAAmB;AAAA,QACjC,oBAAoB,QAAQ;AAAA,QAC5B,YAAY,QAAQ;AAAA,QACpB,gCAAgC,QAAQ;AAAA,MACzC,CAAC;AAAA,IACF;AAEA,WAAO,IAAI,MAAM,yBAAyB,OAAO;AAAA,EAClD;AAAA;AAAA,EAGiB,iBAAgC,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EACnE,gBAA6B,KAAK,eAAe;AAAA,EAEhD,0BAAuD,KAAK,UAAU,IAAI,4BAA4B,+BAA6B,KAAK,wCAAwC,yBAAyB,CAAC,CAAC;AAAA,EAC5M,yBAA+D,KAAK,wBAAwB;AAAA,EAE5G,IAAW,sBAAsB;AAAE,WAAO,KAAK,2BAA2B;AAAA,EAAqB;AAAA,EAC/F,IAAW,mCAAmC;AAAE,WAAO,KAAK,2BAA2B;AAAA,EAAkC;AAAA,EACzH,IAAW,oBAAoB;AAAE,WAAO,KAAK,2BAA2B;AAAA,EAAmB;AAAA,EAE1E,sBAA0D,KAAK,UAAU,IAAI,QAAmC,CAAC;AAAA,EAClH,qBAAuD,KAAK,oBAAoB;AAAA,EAE/E,uBAAsC,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EACzE,sBAAmC,KAAK,qBAAqB;AAAA,EAE5D,2BAAmE,KAAK,UAAU,IAAI,QAAuC,CAAC;AAAA,EAE9H,gBAAyC,KAAK,UAAU,IAAI,wBAAwB,CAAC;AAAA,EAC/F,mBAAmB,UAA+D;AACxF,WAAO,KAAK,cAAc,UAAU,CAAC,MAAuC,SAAS,EAAE,mBAAmB,CAAC;AAAA,EAC5G;AAAA,EACO,iCAAiC,UAAqG;AAC5I,WAAO;AAAA,MACN,KAAK,cAAc,UAAU,OAAK,SAAS,CAAC,CAAC;AAAA,MAC7C,KAAK,yBAAyB,MAAM,OAAK,SAAS,CAAC,CAAC;AAAA,IACrD;AAAA,EACD;AAAA;AAAA,EAGgB;AAAA,EACA;AAAA,EACC;AAAA,EACT;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACS,6BAA6B,KAAK,UAAU,IAAI,kBAA+B,CAAC;AAAA,EAEzF;AAAA,EACA;AAAA,EACD,eAAwB;AAAE,WAAO,KAAK;AAAA,EAAe;AAAA,EACpD;AAAA;AAAA;AAAA;AAAA,EAIA;AAAA,EACA;AAAA,EACS;AAAA,EACA;AAAA,EACA;AAAA;AAAA,EAGA;AAAA,EACT;AAAA,EACA;AAAA,EACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAQS;AAAA,EACT,0BAAkC;AAAA,EAClC;AAAA,EACA;AAAA,EACA;AAAA,EACS;AAAA;AAAA,EAGA;AAAA,EACjB,IAAW,eAA2C;AAAE,WAAO,KAAK;AAAA,EAA4B;AAAA,EAE/E;AAAA,EACjB,IAAW,eAA2C;AAAE,WAAO,KAAK;AAAA,EAAe;AAAA,EAElE;AAAA,EACjB,IAAW,SAA+B;AAAE,WAAO,KAAK;AAAA,EAAsB;AAAA,EAE7D,iBAAiB,IAAI,cAAc;AAAA,EAkGpC,UAAgB;AAC/B,SAAK,gBAAgB;AACrB,SAAK,eAAe,KAAK;AACzB,SAAK,2BAA2B,QAAQ;AACxC,SAAK,cAAc;AACnB,UAAM,QAAQ;AACd,SAAK,kBAAkB,QAAQ;AAC/B,SAAK,gBAAgB;AAGrB,UAAM,0BAA0B,IAAI,oBAAoB,CAAC,GAAG,IAAI,MAAM,OAAO,OAAO,MAAM,IAAI;AAC9F,4BAAwB,QAAQ;AAChC,SAAK,UAAU;AACf,SAAK,oBAAoB,WAAW;AAAA,EACrC;AAAA,EAEA,gBAAyB;AACxB,WACC,KAAK,eAAe,aAAa,KAC9B,KAAK,wBAAwB,aAAa,KAC1C,KAAK,2BAA2B,cAAc,KAC9C,KAAK,oBAAoB,aAAa,KACtC,KAAK,qBAAqB,aAAa,KACvC,KAAK,yBAAyB,aAAa,KAC3C,KAAK,cAAc,aAAa;AAAA,EAErC;AAAA,EAEQ,qBAA2B;AAClC,QAAI,KAAK,aAAa;AACrB,YAAM,IAAI,mBAAmB,oBAAoB;AAAA,IAClD;AAAA,EACD;AAAA,EAEO,iBAAiB,OAAmC;AAC1D,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,OAAO,KAAK;AAAA,EACjC;AAAA,EAEO,gBAAmC;AACzC,SAAK,mBAAmB;AACxB,WAAO,KAAK;AAAA,EACb;AAAA,EAEQ,yBAAyB,WAAwC,QAAyC;AACjH,QAAI,KAAK,eAAe;AAEvB;AAAA,IACD;AACA,SAAK,2BAA2B,uBAAuB,MAAM;AAC7D,SAAK,cAAc,uBAAuB,MAAM;AAChD,SAAK,cAAc,KAAK,IAAI,gCAAgC,WAAW,MAAM,CAAC;AAAA,EAC/E;AAAA,EAEO,SAAS,OAA2C;AAC1D,SAAK,mBAAmB;AAExB,QAAI,UAAU,QAAQ,UAAU,QAAW;AAC1C,YAAM,gBAAgB;AAAA,IACvB;AAEA,UAAM,EAAE,YAAY,WAAW,IAAI,iBAAiB,OAAO,KAAK,SAAS,UAAU;AACnF,SAAK,wBAAwB,YAAY,UAAU;AAAA,EACpD;AAAA,EAEQ,uBAAuB,OAAc,aAAqB,aAAqB,MAAc,WAAoB,WAAoB,SAAkB,aAAiD;AAC/M,WAAO;AAAA,MACN,SAAS,CAAC;AAAA,QACT;AAAA,QACA;AAAA,QACA;AAAA,QACA;AAAA,MACD,CAAC;AAAA,MACD,KAAK,KAAK,QAAQ,OAAO;AAAA,MACzB;AAAA,MACA,WAAW,KAAK,aAAa;AAAA,MAC7B;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,wBAAwB,YAA+B,sBAAyC;AACvG,SAAK,mBAAmB;AACxB,UAAM,oBAAoB,KAAK,kBAAkB;AACjD,UAAM,sBAAsB,KAAK,sBAAsB,iBAAiB;AACxE,UAAM,gBAAgB,KAAK,aAAa;AACxC,UAAM,YAAY,KAAK,iBAAiB,aAAa;AAErD,SAAK,UAAU;AACf,SAAK,kBAAkB,QAAQ;AAC/B,SAAK,oBAAoB;AACzB,SAAK,mBAAmB;AAGxB,SAAK,eAAe,uBAAO,OAAO,IAAI;AACtC,SAAK,mBAAmB,IAAI,iBAAiB;AAG7C,SAAK,gBAAgB,MAAM;AAC3B,SAAK,2BAA2B;AAEhC,SAAK;AAAA,MACJ,IAAI;AAAA,QACH;AAAA,UACC,IAAI,cAAc;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,QACL;AAAA,QACA;AAAA,MACD;AAAA,MACA,KAAK,uBAAuB,IAAI,MAAM,GAAG,GAAG,eAAe,SAAS,GAAG,GAAG,qBAAqB,KAAK,SAAS,GAAG,OAAO,OAAO,MAAM,KAAK;AAAA,IAC1I;AAAA,EACD;AAAA,EAEO,OAAO,KAAoC;AACjD,SAAK,mBAAmB;AACxB,UAAM,SAAU,QAAQ,MAAM,kBAAkB,OAAO,SAAS;AAChE,QAAI,KAAK,QAAQ,OAAO,MAAM,QAAQ;AAErC;AAAA,IACD;AAEA,UAAM,oBAAoB,KAAK,kBAAkB;AACjD,UAAM,sBAAsB,KAAK,sBAAsB,iBAAiB;AACxE,UAAM,gBAAgB,KAAK,aAAa;AACxC,UAAM,YAAY,KAAK,iBAAiB,aAAa;AAErD,SAAK,mBAAmB;AACxB,SAAK,QAAQ,OAAO,MAAM;AAC1B,SAAK,mBAAmB;AACxB,SAAK,kBAAkB;AAEvB,SAAK;AAAA,MACJ,IAAI;AAAA,QACH;AAAA,UACC,IAAI,mBAAmB;AAAA,QACxB;AAAA,QACA,KAAK;AAAA,QACL;AAAA,QACA;AAAA,MACD;AAAA,MACA,KAAK,uBAAuB,IAAI,MAAM,GAAG,GAAG,eAAe,SAAS,GAAG,GAAG,qBAAqB,KAAK,SAAS,GAAG,OAAO,OAAO,OAAO,IAAI;AAAA,IAC1I;AAAA,EACD;AAAA,EAEQ,qBAA2B;AAElC,SAAK,iBAAiB,yBAAyB,IAAI;AAAA,EACpD;AAAA,EAEQ,oBAA0B;AAEjC,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,iBAAiB,KAAK,iBAAiB,sBAAsB;AACnE,aAAS,IAAI,GAAG,MAAM,eAAe,QAAQ,IAAI,KAAK,KAAK;AAC1D,YAAM,OAAO,eAAe,CAAC;AAC7B,YAAM,QAAQ,KAAK;AAEnB,YAAM,QAAQ,KAAK,sBAAsB,KAAK;AAE9C,YAAM,cAAc,KAAK,QAAQ,YAAY,MAAM,iBAAiB,MAAM,WAAW;AACrF,YAAM,YAAY,KAAK,QAAQ,YAAY,MAAM,eAAe,MAAM,SAAS;AAE/E,WAAK,sBAAsB;AAC3B,WAAK,oBAAoB;AACzB,WAAK,kBAAkB;AAEvB,WAAK,QAAQ,cAAc;AAC3B,WAAK,MAAM,YAAY;AAEvB,sBAAgB,IAAI;AAAA,IACrB;AAAA,EACD;AAAA,EAEO,mBAAwC;AAC9C,SAAK;AACL,QAAI,KAAK,yBAAyB,GAAG;AACpC,WAAK,2BAA2B,wBAAwB;AACxD,WAAK,qBAAqB,KAAK,MAAS;AAAA,IACzC;AACA,WAAO,KAAK,eAAe,WAAW;AAAA,EACvC;AAAA,EAEO,iBAAiB,MAAiC;AACxD,SAAK;AACL,QAAI,KAAK,yBAAyB,GAAG;AACpC,WAAK,2BAA2B,wBAAwB;AACxD,WAAK,qBAAqB,KAAK,MAAS;AAAA,IACzC;AACA,SAAK,eAAe,WAAW,IAAI;AAAA,EACpC;AAAA,EAEO,qBAA8B;AACpC,WAAO,KAAK,uBAAuB;AAAA,EACpC;AAAA,EAEO,yBAAiC;AACvC,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,uBAAgC;AACtC,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,4BAAqC;AAC3C,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,6BAAsC;AAC5C,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,aAAsB;AAC5B,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,yBAAkC;AACxC,SAAK,mBAAmB;AACxB,QAAI,KAAK,0BAA0B,GAAG;AAErC,aAAO;AAAA,IACR;AACA,QAAI,qBAAqB;AACzB,QAAI,oBAAoB;AAExB,UAAM,YAAY,KAAK,QAAQ,aAAa;AAC5C,aAAS,aAAa,GAAG,cAAc,WAAW,cAAc;AAC/D,YAAM,aAAa,KAAK,QAAQ,cAAc,UAAU;AACxD,UAAI,cAAc,oBAAoB;AACrC,6BAAqB;AAAA,MACtB,OAAO;AACN,8BAAsB;AAAA,MACvB;AAAA,IACD;AAEA,WAAQ,oBAAoB;AAAA,EAC7B;AAAA,EAEA,IAAW,MAAW;AACrB,WAAO,KAAK;AAAA,EACb;AAAA;AAAA,EAIO,aAA6C;AACnD,SAAK,mBAAmB;AACxB,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,uBAA0C;AAChD,WAAO;AAAA,MACN,SAAS,KAAK,SAAS;AAAA,MACvB,cAAc,KAAK,SAAS;AAAA,IAC7B;AAAA,EACD;AAAA,EAEO,cAAc,UAA+C;AACnE,SAAK,mBAAmB;AACxB,UAAM,UAAW,OAAO,SAAS,YAAY,cAAe,SAAS,UAAU,KAAK,SAAS;AAC7F,UAAM,aAAc,OAAO,SAAS,eAAe,cAAe,SAAS,aAAa,KAAK,SAAS;AACtG,UAAM,eAAgB,OAAO,SAAS,iBAAiB,cAAe,SAAS,eAAe,KAAK,SAAS;AAC5G,UAAM,qBAAsB,OAAO,SAAS,uBAAuB,cAAe,SAAS,qBAAqB,KAAK,SAAS;AAC9H,UAAM,iCAAkC,OAAO,SAAS,+BAA+B,cAAe,SAAS,6BAA6B,KAAK,SAAS;AAE1J,UAAM,UAAU,IAAI,MAAM,yBAAyB;AAAA,MAClD;AAAA,MACA;AAAA,MACA;AAAA,MACA,YAAY,KAAK,SAAS;AAAA,MAC1B;AAAA,MACA;AAAA,IACD,CAAC;AAED,QAAI,KAAK,SAAS,OAAO,OAAO,GAAG;AAClC;AAAA,IACD;AAEA,UAAM,IAAI,KAAK,SAAS,kBAAkB,OAAO;AACjD,SAAK,WAAW;AAEhB,SAAK,cAAc,uBAAuB,CAAC;AAC3C,SAAK,oBAAoB,uBAAuB,CAAC;AACjD,SAAK,oBAAoB,KAAK,CAAC;AAAA,EAChC;AAAA,EAEO,kBAAkB,qBAA8B,gBAA8B;AACpF,SAAK,mBAAmB;AACxB,UAAM,qBAAqB,iBAAiB,KAAK,SAAS,gBAAgB,mBAAmB;AAC7F,SAAK,cAAc;AAAA,MAClB,cAAc,mBAAmB;AAAA,MACjC,SAAS,mBAAmB;AAAA,MAC5B,YAAY,mBAAmB;AAAA;AAAA,IAChC,CAAC;AAAA,EACF;AAAA,EAEO,qBAAqB,KAAqB;AAChD,SAAK,mBAAmB;AACxB,WAAO,qBAAqB,KAAK,KAAK,SAAS,YAAY,KAAK,SAAS,YAAY;AAAA,EACtF;AAAA;AAAA;AAAA,EAMO,eAAuB;AAC7B,SAAK,mBAAmB;AACxB,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,kBAA2B;AACjC,WAAO,KAAK,QAAQ,gBAAgB;AAAA,EACrC;AAAA,EAEO,qCAA8C;AACpD,WAAO,KAAK,QAAQ,mCAAmC;AAAA,EACxD;AAAA,EAEO,6BAA6B,aAAiC,MAAY;AAChF,UAAM,UAAU,KAAK,YAAY,QAAQ,yBAAyB,QAAQ,OAAO,MAAM,OAAO,MAAM,OAAO,UAAU,sBAAsB;AAC3I,SAAK,QAAQ,wCAAwC;AACrD,SAAK,mBAAmB,YAAY,QAAQ,IAAI,QAAM,EAAE,OAAO,EAAE,OAAO,MAAM,KAAK,EAAE,GAAG,MAAM,IAAI;AAAA,EACnG;AAAA,EAEO,4BAAqC;AAC3C,WAAO,KAAK,QAAQ,0BAA0B;AAAA,EAC/C;AAAA,EAEO,0BAAkC;AACxC,SAAK,mBAAmB;AACxB,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,6BAA+D;AACrE,SAAK,mBAAmB;AACxB,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,YAAY,aAAgC;AAClD,SAAK,mBAAmB;AACxB,UAAM,WAAW,KAAK,kBAAkB,YAAY,YAAY,YAAY,QAAQ,eAAkC;AACtH,WAAO,KAAK,QAAQ,YAAY,SAAS,YAAY,SAAS,MAAM;AAAA,EACrE;AAAA,EAEO,cAAc,WAA6B;AACjD,SAAK,mBAAmB;AACxB,UAAM,SAAU,KAAK,IAAI,KAAK,QAAQ,UAAU,GAAG,KAAK,IAAI,GAAG,SAAS,CAAC;AACzE,WAAO,KAAK,QAAQ,cAAc,MAAM;AAAA,EACzC;AAAA,EAEQ,qBAA2B;AAClC,SAAK,aAAa,KAAK,aAAa;AACpC,SAAK,wBAAwB,KAAK;AAAA,EACnC;AAAA,EAEO,oBAAoB,WAAyB;AACnD,SAAK,aAAa;AAAA,EACnB;AAAA,EAEO,+BAA+B,yBAAuC;AAC5E,SAAK,wBAAwB;AAAA,EAC9B;AAAA,EAEO,kCAAkC,4BAAoE;AAC5G,SAAK,2BAA2B;AAAA,EACjC;AAAA,EAEO,SAAS,KAAiC,cAAuB,OAAe;AACtF,SAAK,mBAAmB;AACxB,QAAI,KAAK,2BAA2B,GAAG;AACtC,YAAM,IAAI,mBAAmB,2CAA2C;AAAA,IACzE;AAEA,UAAM,iBAAiB,KAAK,kBAAkB;AAC9C,UAAM,iBAAiB,KAAK,gBAAgB,gBAAgB,GAAG;AAE/D,QAAI,aAAa;AAChB,aAAO,KAAK,QAAQ,OAAO,IAAI;AAAA,IAChC;AAEA,WAAO;AAAA,EACR;AAAA,EAEO,eAAe,cAAuB,OAA4B;AACxE,WAAO,IAAI,kBAAkB,KAAK,QAAQ,eAAe,WAAW,CAAC;AAAA,EACtE;AAAA,EAEO,eAAe,KAAiC,cAAuB,OAAe;AAC5F,SAAK,mBAAmB;AACxB,UAAM,iBAAiB,KAAK,kBAAkB;AAC9C,UAAM,iBAAiB,KAAK,sBAAsB,gBAAgB,GAAG;AAErE,QAAI,aAAa;AAChB,aAAO,KAAK,QAAQ,OAAO,EAAE,SAAS;AAAA,IACvC;AAEA,WAAO;AAAA,EACR;AAAA,EAEO,gBAAgB,UAAkB,MAAiC,MAAM,oBAAoB,aAAqB;AACxH,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,gBAAgB,KAAK,cAAc,QAAQ,GAAG,GAAG;AAAA,EACtE;AAAA,EAEO,sBAAsB,UAAkB,MAAiC,MAAM,oBAAoB,aAAqB;AAC9H,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,sBAAsB,KAAK,cAAc,QAAQ,GAAG,GAAG;AAAA,EAC5E;AAAA,EAEO,yBAAyB,UAAkB,MAAiC,MAAM,oBAAoB,aAAqB;AACjI,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,yBAAyB,KAAK,cAAc,QAAQ,GAAG,GAAG;AAAA,EAC/E;AAAA,EAEO,eAAuB;AAC7B,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,aAAa;AAAA,EAClC;AAAA,EAEO,eAAe,YAA4B;AACjD,SAAK,mBAAmB;AACxB,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,YAAM,IAAI,mBAAmB,8BAA8B;AAAA,IAC5D;AAEA,WAAO,KAAK,QAAQ,eAAe,UAAU;AAAA,EAC9C;AAAA,EAEO,cAAc,YAA4B;AAChD,SAAK,mBAAmB;AACxB,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,YAAM,IAAI,mBAAmB,8BAA8B;AAAA,IAC5D;AAEA,WAAO,KAAK,QAAQ,cAAc,UAAU;AAAA,EAC7C;AAAA,EAEO,kBAA4B;AAClC,SAAK,mBAAmB;AACxB,QAAI,KAAK,2BAA2B,GAAG;AACtC,YAAM,IAAI,mBAAmB,2CAA2C;AAAA,IACzE;AAEA,WAAO,KAAK,QAAQ,gBAAgB;AAAA,EACrC;AAAA,EAEO,SAAiB;AACvB,SAAK,mBAAmB;AACxB,WAAO,KAAK,QAAQ,OAAO;AAAA,EAC5B;AAAA,EAEO,uBAAgD;AACtD,SAAK,mBAAmB;AACxB,WACC,KAAK,QAAQ,OAAO,MAAM,OACvB,MAAM,kBAAkB,KACxB,MAAM,kBAAkB;AAAA,EAE7B;AAAA,EAEO,iBAAiB,YAA4B;AACnD,SAAK,mBAAmB;AACxB,WAAO;AAAA,EACR;AAAA,EAEO,iBAAiB,YAA4B;AACnD,SAAK,mBAAmB;AACxB,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,YAAM,IAAI,mBAAmB,8BAA8B;AAAA,IAC5D;AACA,WAAO,KAAK,QAAQ,cAAc,UAAU,IAAI;AAAA,EACjD;AAAA,EAEO,gCAAgC,YAA4B;AAClE,SAAK,mBAAmB;AACxB,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,YAAM,IAAI,mBAAmB,8BAA8B;AAAA,IAC5D;AACA,WAAO,KAAK,QAAQ,gCAAgC,UAAU;AAAA,EAC/D;AAAA,EAEO,+BAA+B,YAA4B;AACjE,SAAK,mBAAmB;AACxB,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,YAAM,IAAI,mBAAmB,8BAA8B;AAAA,IAC5D;AACA,WAAO,KAAK,QAAQ,+BAA+B,UAAU;AAAA,EAC9D;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,mCAAmC,OAAsB;AAC/D,UAAM,aAAa,KAAK,QAAQ,aAAa;AAE7C,UAAM,yBAAyB,MAAM;AACrC,UAAM,qBAAqB,MAAM;AACjC,QAAI,kBAAkB,KAAK,MAAO,OAAO,2BAA2B,YAAY,CAAC,MAAM,sBAAsB,IAAK,yBAAyB,CAAC;AAC5I,QAAI,cAAc,KAAK,MAAO,OAAO,uBAAuB,YAAY,CAAC,MAAM,kBAAkB,IAAK,qBAAqB,CAAC;AAE5H,QAAI,kBAAkB,GAAG;AACxB,wBAAkB;AAClB,oBAAc;AAAA,IACf,WAAW,kBAAkB,YAAY;AACxC,wBAAkB;AAClB,oBAAc,KAAK,iBAAiB,eAAe;AAAA,IACpD,OAAO;AACN,UAAI,eAAe,GAAG;AACrB,sBAAc;AAAA,MACf,OAAO;AACN,cAAM,YAAY,KAAK,iBAAiB,eAAe;AACvD,YAAI,eAAe,WAAW;AAC7B,wBAAc;AAAA,QACf;AAAA,MACD;AAAA,IACD;AAEA,UAAM,uBAAuB,MAAM;AACnC,UAAM,mBAAmB,MAAM;AAC/B,QAAI,gBAAgB,KAAK,MAAO,OAAO,yBAAyB,YAAY,CAAC,MAAM,oBAAoB,IAAK,uBAAuB,CAAC;AACpI,QAAI,YAAY,KAAK,MAAO,OAAO,qBAAqB,YAAY,CAAC,MAAM,gBAAgB,IAAK,mBAAmB,CAAC;AAEpH,QAAI,gBAAgB,GAAG;AACtB,sBAAgB;AAChB,kBAAY;AAAA,IACb,WAAW,gBAAgB,YAAY;AACtC,sBAAgB;AAChB,kBAAY,KAAK,iBAAiB,aAAa;AAAA,IAChD,OAAO;AACN,UAAI,aAAa,GAAG;AACnB,oBAAY;AAAA,MACb,OAAO;AACN,cAAM,YAAY,KAAK,iBAAiB,aAAa;AACrD,YAAI,aAAa,WAAW;AAC3B,sBAAY;AAAA,QACb;AAAA,MACD;AAAA,IACD;AAEA,QACC,2BAA2B,mBACxB,uBAAuB,eACvB,yBAAyB,iBACzB,qBAAqB,aACrB,iBAAiB,SACjB,EAAE,iBAAiB,YACrB;AACD,aAAO;AAAA,IACR;AAEA,WAAO,IAAI,MAAM,iBAAiB,aAAa,eAAe,SAAS;AAAA,EACxE;AAAA,EAEQ,iBAAiB,YAAoB,QAAgB,gBAAqD;AACjH,QAAI,OAAO,eAAe,YAAY,OAAO,WAAW,UAAU;AACjE,aAAO;AAAA,IACR;AAEA,QAAI,MAAM,UAAU,KAAK,MAAM,MAAM,GAAG;AACvC,aAAO;AAAA,IACR;AAEA,QAAI,aAAa,KAAK,SAAS,GAAG;AACjC,aAAO;AAAA,IACR;AAEA,SAAK,aAAa,OAAO,eAAe,SAAS,OAAO,QAAQ;AAC/D,aAAO;AAAA,IACR;AAEA,UAAM,YAAY,KAAK,QAAQ,aAAa;AAC5C,QAAI,aAAa,WAAW;AAC3B,aAAO;AAAA,IACR;AAEA,QAAI,WAAW,GAAG;AACjB,aAAO;AAAA,IACR;AAEA,UAAM,YAAY,KAAK,iBAAiB,UAAU;AAClD,QAAI,SAAS,WAAW;AACvB,aAAO;AAAA,IACR;AAEA,QAAI,mBAAmB,wBAA2C;AAEjE,YAAM,iBAAiB,KAAK,QAAQ,gBAAgB,YAAY,SAAS,CAAC;AAC1E,UAAI,QAAQ,gBAAgB,cAAc,GAAG;AAC5C,eAAO;AAAA,MACR;AAAA,IACD;AAEA,WAAO;AAAA,EACR;AAAA,EAEQ,kBAAkB,aAAqB,SAAiB,gBAAsD;AACrH,UAAM,aAAa,KAAK,MAAO,OAAO,gBAAgB,YAAY,CAAC,MAAM,WAAW,IAAK,cAAc,CAAC;AACxG,UAAM,SAAS,KAAK,MAAO,OAAO,YAAY,YAAY,CAAC,MAAM,OAAO,IAAK,UAAU,CAAC;AACxF,UAAM,YAAY,KAAK,QAAQ,aAAa;AAE5C,QAAI,aAAa,GAAG;AACnB,aAAO,IAAI,SAAS,GAAG,CAAC;AAAA,IACzB;AAEA,QAAI,aAAa,WAAW;AAC3B,aAAO,IAAI,SAAS,WAAW,KAAK,iBAAiB,SAAS,CAAC;AAAA,IAChE;AAEA,QAAI,UAAU,GAAG;AAChB,aAAO,IAAI,SAAS,YAAY,CAAC;AAAA,IAClC;AAEA,UAAM,YAAY,KAAK,iBAAiB,UAAU;AAClD,QAAI,UAAU,WAAW;AACxB,aAAO,IAAI,SAAS,YAAY,SAAS;AAAA,IAC1C;AAEA,QAAI,mBAAmB,wBAA2C;AAIjE,YAAM,iBAAiB,KAAK,QAAQ,gBAAgB,YAAY,SAAS,CAAC;AAC1E,UAAI,QAAQ,gBAAgB,cAAc,GAAG;AAC5C,eAAO,IAAI,SAAS,YAAY,SAAS,CAAC;AAAA,MAC3C;AAAA,IACD;AAEA,WAAO,IAAI,SAAS,YAAY,MAAM;AAAA,EACvC;AAAA,EAEO,iBAAiB,UAA+B;AACtD,UAAM,iBAAiB;AACvB,SAAK,mBAAmB;AAGxB,QAAI,oBAAoB,UAAU;AACjC,UAAI,KAAK,iBAAiB,SAAS,YAAY,SAAS,QAAQ,cAAc,GAAG;AAChF,eAAO;AAAA,MACR;AAAA,IACD;AAEA,WAAO,KAAK,kBAAkB,SAAS,YAAY,SAAS,QAAQ,cAAc;AAAA,EACnF;AAAA,EAEQ,cAAc,OAAc,gBAAqD;AACxF,UAAM,kBAAkB,MAAM;AAC9B,UAAM,cAAc,MAAM;AAC1B,UAAM,gBAAgB,MAAM;AAC5B,UAAM,YAAY,MAAM;AAExB,QAAI,CAAC,KAAK,iBAAiB,iBAAiB,aAAa,eAAkC,GAAG;AAC7F,aAAO;AAAA,IACR;AACA,QAAI,CAAC,KAAK,iBAAiB,eAAe,WAAW,eAAkC,GAAG;AACzF,aAAO;AAAA,IACR;AAEA,QAAI,mBAAmB,wBAA2C;AACjE,YAAM,sBAAuB,cAAc,IAAI,KAAK,QAAQ,gBAAgB,iBAAiB,cAAc,CAAC,IAAI;AAChH,YAAM,oBAAqB,YAAY,KAAK,aAAa,KAAK,QAAQ,cAAc,aAAa,IAAI,KAAK,QAAQ,gBAAgB,eAAe,YAAY,CAAC,IAAI;AAElK,YAAM,2BAA2B,QAAQ,gBAAgB,mBAAmB;AAC5E,YAAM,yBAAyB,QAAQ,gBAAgB,iBAAiB;AAExE,UAAI,CAAC,4BAA4B,CAAC,wBAAwB;AACzD,eAAO;AAAA,MACR;AACA,aAAO;AAAA,IACR;AAEA,WAAO;AAAA,EACR;AAAA,EAEO,cAAc,QAAuB;AAC3C,UAAM,iBAAiB;AACvB,SAAK,mBAAmB;AAGxB,QAAK,kBAAkB,SAAU,EAAE,kBAAkB,YAAY;AAChE,UAAI,KAAK,cAAc,QAAQ,cAAc,GAAG;AAC/C,eAAO;AAAA,MACR;AAAA,IACD;AAEA,UAAM,QAAQ,KAAK,kBAAkB,OAAO,iBAAiB,OAAO,aAAa,eAAkC;AACnH,UAAM,MAAM,KAAK,kBAAkB,OAAO,eAAe,OAAO,WAAW,eAAkC;AAE7G,UAAM,kBAAkB,MAAM;AAC9B,UAAM,cAAc,MAAM;AAC1B,UAAM,gBAAgB,IAAI;AAC1B,UAAM,YAAY,IAAI;AAEtB,QAAI,mBAAmB,wBAA2C;AACjE,YAAM,sBAAuB,cAAc,IAAI,KAAK,QAAQ,gBAAgB,iBAAiB,cAAc,CAAC,IAAI;AAChH,YAAM,oBAAqB,YAAY,KAAK,aAAa,KAAK,QAAQ,cAAc,aAAa,IAAI,KAAK,QAAQ,gBAAgB,eAAe,YAAY,CAAC,IAAI;AAElK,YAAM,2BAA2B,QAAQ,gBAAgB,mBAAmB;AAC5E,YAAM,yBAAyB,QAAQ,gBAAgB,iBAAiB;AAExE,UAAI,CAAC,4BAA4B,CAAC,wBAAwB;AACzD,eAAO,IAAI,MAAM,iBAAiB,aAAa,eAAe,SAAS;AAAA,MACxE;AAEA,UAAI,oBAAoB,iBAAiB,gBAAgB,WAAW;AAEnE,eAAO,IAAI,MAAM,iBAAiB,cAAc,GAAG,eAAe,YAAY,CAAC;AAAA,MAChF;AAEA,UAAI,4BAA4B,wBAAwB;AAEvD,eAAO,IAAI,MAAM,iBAAiB,cAAc,GAAG,eAAe,YAAY,CAAC;AAAA,MAChF;AAEA,UAAI,0BAA0B;AAE7B,eAAO,IAAI,MAAM,iBAAiB,cAAc,GAAG,eAAe,SAAS;AAAA,MAC5E;AAGA,aAAO,IAAI,MAAM,iBAAiB,aAAa,eAAe,YAAY,CAAC;AAAA,IAC5E;AAEA,WAAO,IAAI,MAAM,iBAAiB,aAAa,eAAe,SAAS;AAAA,EACxE;AAAA,EAEO,eAAe,aAAwB,QAA0B;AACvE,SAAK,mBAAmB;AACxB,UAAM,YAAY,KAAK,YAAY,WAAW,IAAI;AAClD,WAAO,KAAK,cAAc,KAAK,IAAI,KAAK,QAAQ,UAAU,GAAG,KAAK,IAAI,GAAG,SAAS,CAAC,CAAC;AAAA,EACrF;AAAA,EAEO,oBAA2B;AACjC,SAAK,mBAAmB;AACxB,UAAM,YAAY,KAAK,aAAa;AACpC,WAAO,IAAI,MAAM,GAAG,GAAG,WAAW,KAAK,iBAAiB,SAAS,CAAC;AAAA,EACnE;AAAA,EAEQ,sBAAsB,aAAoB,YAA8B,gBAAyB,kBAA6C;AACrJ,WAAO,KAAK,QAAQ,sBAAsB,aAAa,YAAY,gBAAgB,gBAAgB;AAAA,EACpG;AAAA,EAEO,YAAY,cAAsB,gBAAqB,SAAkB,WAAoB,gBAA+B,gBAAyB,mBAA2B,kBAAqC;AAC3N,SAAK,mBAAmB;AAExB,QAAI,eAA+B;AAEnC,QAAI,mBAAmB,MAAM;AAC5B,UAAI,CAAC,MAAM,QAAQ,cAAc,GAAG;AACnC,yBAAiB,CAAC,cAAc;AAAA,MACjC;AAEA,UAAI,eAAe,MAAM,CAAC,gBAAuB,MAAM,SAAS,WAAW,CAAC,GAAG;AAC9E,uBAAe,eAAe,IAAI,CAAC,gBAAuB,KAAK,cAAc,WAAW,CAAC;AAAA,MAC1F;AAAA,IACD;AAEA,QAAI,iBAAiB,MAAM;AAC1B,qBAAe,CAAC,KAAK,kBAAkB,CAAC;AAAA,IACzC;AAEA,mBAAe,aAAa,KAAK,CAAC,IAAI,OAAO,GAAG,kBAAkB,GAAG,mBAAmB,GAAG,cAAc,GAAG,WAAW;AAEvH,UAAM,qBAA8B,CAAC;AACrC,uBAAmB,KAAK,aAAa,OAAO,CAAC,MAAM,SAAS;AAC3D,UAAI,MAAM,gBAAgB,MAAM,IAAI,GAAG;AACtC,eAAO,KAAK,UAAU,IAAI;AAAA,MAC3B;AAEA,yBAAmB,KAAK,IAAI;AAC5B,aAAO;AAAA,IACR,CAAC,CAAC;AAEF,QAAI;AACJ,QAAI,CAAC,WAAW,aAAa,QAAQ,IAAI,IAAI,GAAG;AAE/C,YAAM,eAAe,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc;AACtF,YAAM,aAAa,aAAa,mBAAmB;AAEnD,UAAI,CAAC,YAAY;AAChB,eAAO,CAAC;AAAA,MACT;AAEA,oBAAc,wBAAC,gBAAuB,KAAK,sBAAsB,aAAa,YAAY,gBAAgB,gBAAgB,GAA5G;AAAA,IACf,OAAO;AACN,oBAAc,wBAAC,gBAAuB,gBAAgB,YAAY,MAAM,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc,GAAG,aAAa,gBAAgB,gBAAgB,GAA3K;AAAA,IACf;AAEA,WAAO,mBAAmB,IAAI,WAAW,EAAE,OAAO,CAAC,KAAK,YAA+B,IAAI,OAAO,OAAO,GAAG,CAAC,CAAC;AAAA,EAC/G;AAAA,EAEO,cAAc,cAAsB,gBAA2B,SAAkB,WAAoB,gBAAwB,gBAAiD;AACpL,SAAK,mBAAmB;AACxB,UAAM,cAAc,KAAK,iBAAiB,cAAc;AAExD,QAAI,CAAC,WAAW,aAAa,QAAQ,IAAI,IAAI,GAAG;AAC/C,YAAM,eAAe,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc;AACtF,YAAM,aAAa,aAAa,mBAAmB;AACnD,UAAI,CAAC,YAAY;AAChB,eAAO;AAAA,MACR;AAEA,YAAM,YAAY,KAAK,aAAa;AACpC,UAAI,cAAc,IAAI,MAAM,YAAY,YAAY,YAAY,QAAQ,WAAW,KAAK,iBAAiB,SAAS,CAAC;AACnH,UAAI,MAAM,KAAK,sBAAsB,aAAa,YAAY,gBAAgB,CAAC;AAC/E,sBAAgB,cAAc,MAAM,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc,GAAG,aAAa,cAAc;AACnI,UAAI,IAAI,SAAS,GAAG;AACnB,eAAO,IAAI,CAAC;AAAA,MACb;AAEA,oBAAc,IAAI,MAAM,GAAG,GAAG,YAAY,YAAY,KAAK,iBAAiB,YAAY,UAAU,CAAC;AACnG,YAAM,KAAK,sBAAsB,aAAa,YAAY,gBAAgB,CAAC;AAE3E,UAAI,IAAI,SAAS,GAAG;AACnB,eAAO,IAAI,CAAC;AAAA,MACb;AAEA,aAAO;AAAA,IACR;AAEA,WAAO,gBAAgB,cAAc,MAAM,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc,GAAG,aAAa,cAAc;AAAA,EAC3I;AAAA,EAEO,kBAAkB,cAAsB,gBAA2B,SAAkB,WAAoB,gBAAwB,gBAAiD;AACxL,SAAK,mBAAmB;AACxB,UAAM,cAAc,KAAK,iBAAiB,cAAc;AACxD,WAAO,gBAAgB,kBAAkB,MAAM,IAAI,aAAa,cAAc,SAAS,WAAW,cAAc,GAAG,aAAa,cAAc;AAAA,EAC/I;AAAA;AAAA;AAAA,EAMO,mBAAyB;AAC/B,SAAK,gBAAgB,iBAAiB;AAAA,EACvC;AAAA,EAEO,kBAAwB;AAC9B,SAAK,gBAAgB,gBAAgB;AAAA,EACtC;AAAA,EAEO,QAAQ,KAAoC;AAClD,UAAM,aAAc,KAAK,OAAO,MAAM,OAAO,MAAM,kBAAkB,KAAK,MAAM,kBAAkB;AAClG,QAAI,eAAe,KAAK;AACvB;AAAA,IACD;AACA,QAAI;AACH,WAAK,wBAAwB,kBAAkB;AAC/C,WAAK,cAAc,kBAAkB;AACrC,UAAI,KAAK,6BAA6B,MAAM;AAC3C,aAAK,2BAA2B,KAAK,iBAAiB,eAAe,KAAK,GAAG;AAAA,MAC9E;AACA,WAAK,gBAAgB,QAAQ,GAAG;AAAA,IACjC,UAAE;AACD,WAAK,cAAc,gBAAgB;AACnC,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA,EAEQ,uBAAuB,cAAuF;AACrH,QAAI,wBAAwB,MAAM,6BAA6B;AAC9D,aAAO;AAAA,IACR;AACA,WAAO,IAAI,MAAM;AAAA,MAChB,aAAa,cAAc;AAAA,MAC3B,KAAK,cAAc,aAAa,KAAK;AAAA,MACrC,aAAa;AAAA,MACb,aAAa,oBAAoB;AAAA,MACjC,aAAa,wBAAwB;AAAA,MACrC,aAAa,cAAc;AAAA,IAC5B;AAAA,EACD;AAAA,EAEQ,wBAAwB,eAAqG;AACpI,UAAM,SAA8C,CAAC;AACrD,aAAS,IAAI,GAAG,MAAM,cAAc,QAAQ,IAAI,KAAK,KAAK;AACzD,aAAO,CAAC,IAAI,KAAK,uBAAuB,cAAc,CAAC,CAAC;AAAA,IACzD;AACA,WAAO;AAAA,EACR;AAAA,EAEO,mBAAmB,mBAAuC,gBAAwD,qBAAwD,OAA2C;AAC3N,QAAI;AACH,WAAK,wBAAwB,kBAAkB;AAC/C,WAAK,cAAc,kBAAkB;AACrC,aAAO,KAAK,oBAAoB,mBAAmB,KAAK,wBAAwB,cAAc,GAAG,qBAAqB,KAAK;AAAA,IAC5H,UAAE;AACD,WAAK,cAAc,gBAAgB;AACnC,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA,EAEQ,oBAAoB,mBAAuC,gBAAqD,qBAAwD,OAA2C;AAC1N,QAAI,KAAK,SAAS,sBAAsB,KAAK,0BAA0B;AAItE,YAAM,gBAAgB,eAAe,IAAI,CAAC,OAAO;AAChD,eAAO;AAAA,UACN,OAAO,KAAK,cAAc,GAAG,KAAK;AAAA,UAClC,MAAM,GAAG;AAAA,QACV;AAAA,MACD,CAAC;AAID,UAAI,sBAAsB;AAC1B,UAAI,mBAAmB;AACtB,iBAAS,IAAI,GAAG,MAAM,kBAAkB,QAAQ,IAAI,KAAK,KAAK;AAC7D,gBAAM,MAAM,kBAAkB,CAAC;AAC/B,cAAI,mBAAmB;AACvB,mBAAS,IAAI,GAAG,OAAO,cAAc,QAAQ,IAAI,MAAM,KAAK;AAC3D,kBAAM,YAAY,cAAc,CAAC,EAAE;AACnC,kBAAM,aAAa,UAAU,kBAAkB,IAAI;AACnD,kBAAM,aAAa,IAAI,kBAAkB,UAAU;AACnD,gBAAI,CAAC,cAAc,CAAC,YAAY;AAC/B,iCAAmB;AACnB;AAAA,YACD;AAAA,UACD;AACA,cAAI,CAAC,kBAAkB;AACtB,kCAAsB;AACtB;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAEA,UAAI,qBAAqB;AACxB,iBAAS,IAAI,GAAG,MAAM,KAAK,yBAAyB,QAAQ,IAAI,KAAK,KAAK;AACzE,gBAAM,iBAAiB,KAAK,yBAAyB,CAAC;AACtD,gBAAM,gBAAgB,KAAK,iBAAiB,cAAc;AAE1D,cAAI,gBAAgB;AACpB,mBAAS,IAAI,GAAG,OAAO,cAAc,QAAQ,IAAI,MAAM,KAAK;AAC3D,kBAAM,YAAY,cAAc,CAAC,EAAE;AACnC,kBAAM,WAAW,cAAc,CAAC,EAAE;AAElC,gBAAI,iBAAiB,UAAU,mBAAmB,iBAAiB,UAAU,eAAe;AAE3F;AAAA,YACD;AAKA,gBACC,mBAAmB,UAAU,mBAAmB,UAAU,gBAAgB,iBACvE,UAAU,QAAQ,KAAK,YAAY,SAAS,SAAS,KAAK,SAAS,OAAO,CAAC,MAAM,MACnF;AAED;AAAA,YACD;AAEA,gBACC,mBAAmB,UAAU,mBAAmB,UAAU,gBAAgB,KACvE,UAAU,QAAQ,KAAK,YAAY,SAAS,SAAS,KAAK,SAAS,OAAO,SAAS,SAAS,CAAC,MAAM,MACrG;AAED;AAAA,YACD;AAGA,4BAAgB;AAChB;AAAA,UACD;AAEA,cAAI,eAAe;AAClB,kBAAM,YAAY,IAAI,MAAM,gBAAgB,GAAG,gBAAgB,aAAa;AAC5E,2BAAe,KAAK,IAAI,MAAM,4BAA4B,MAAM,WAAW,MAAM,OAAO,OAAO,KAAK,CAAC;AAAA,UACtG;AAAA,QAED;AAAA,MACD;AAEA,WAAK,2BAA2B;AAAA,IACjC;AACA,QAAI,KAAK,6BAA6B,MAAM;AAC3C,WAAK,2BAA2B,KAAK,iBAAiB,eAAe,KAAK,GAAG;AAAA,IAC9E;AACA,WAAO,KAAK,gBAAgB,kBAAkB,mBAAmB,gBAAgB,qBAAqB,KAAK;AAAA,EAC5G;AAAA,EAEA,WAAW,SAAuB,KAA8B,+BAAuC,oBAA8C;AACpJ,UAAM,QAAQ,QAAQ,IAA0B,CAAC,WAAW;AAC3D,YAAM,aAAa,KAAK,cAAc,OAAO,WAAW;AACxD,YAAM,WAAW,KAAK,cAAc,OAAO,MAAM;AACjD,aAAO;AAAA,QACN,OAAO,IAAI,MAAM,WAAW,YAAY,WAAW,QAAQ,SAAS,YAAY,SAAS,MAAM;AAAA,QAC/F,MAAM,OAAO;AAAA,MACd;AAAA,IACD,CAAC;AACD,SAAK,oBAAoB,OAAO,KAAK,MAAM,OAAO,+BAA+B,kBAAkB;AAAA,EACpG;AAAA,EAEA,WAAW,SAAuB,KAA8B,+BAAuC,oBAA8C;AACpJ,UAAM,QAAQ,QAAQ,IAA0B,CAAC,WAAW;AAC3D,YAAM,aAAa,KAAK,cAAc,OAAO,WAAW;AACxD,YAAM,WAAW,KAAK,cAAc,OAAO,MAAM;AACjD,aAAO;AAAA,QACN,OAAO,IAAI,MAAM,WAAW,YAAY,WAAW,QAAQ,SAAS,YAAY,SAAS,MAAM;AAAA,QAC/F,MAAM,OAAO;AAAA,MACd;AAAA,IACD,CAAC;AACD,SAAK,oBAAoB,OAAO,KAAK,OAAO,MAAM,+BAA+B,kBAAkB;AAAA,EACpG;AAAA,EAEQ,oBAAoB,OAA+B,KAA8B,WAAoB,WAAoB,+BAAuC,oBAA8C;AACrN,QAAI;AACH,WAAK,wBAAwB,kBAAkB;AAC/C,WAAK,cAAc,kBAAkB;AACrC,WAAK,aAAa;AAClB,WAAK,aAAa;AAClB,WAAK,WAAW,OAAO,KAAK;AAC5B,WAAK,OAAO,GAAG;AACf,WAAK,+BAA+B,6BAA6B;AAAA,IAClE,UAAE;AACD,WAAK,aAAa;AAClB,WAAK,aAAa;AAClB,WAAK,cAAc,gBAAgB,kBAAkB;AACrD,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA,EAKO,WAAW,eAAgE,mBAA4B,OAA2C;AACxJ,QAAI;AACH,WAAK,wBAAwB,kBAAkB;AAC/C,WAAK,cAAc,kBAAkB;AACrC,YAAM,aAAa,KAAK,wBAAwB,aAAa;AAC7D,aAAO,KAAK,cAAc,YAAY,gBAAgB;AAAA,IACvD,UAAE;AACD,WAAK,cAAc,gBAAgB;AACnC,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA,EAEQ,cAAc,eAAoD,kBAA+D;AAExI,UAAM,eAAe,KAAK,QAAQ,aAAa;AAC/C,UAAM,SAAS,KAAK,QAAQ,WAAW,eAAe,KAAK,SAAS,oBAAoB,gBAAgB;AACxG,UAAM,eAAe,KAAK,QAAQ,aAAa;AAE/C,UAAM,iBAAiB,OAAO;AAC9B,SAAK,2BAA2B,OAAO;AAEvC,QAAI,eAAe,WAAW,GAAG;AAKhC,eAAS,IAAI,GAAG,MAAM,eAAe,QAAQ,IAAI,KAAK,KAAK;AAC1D,cAAM,SAAS,eAAe,CAAC;AAC/B,aAAK,iBAAiB,cAAc,OAAO,aAAa,OAAO,aAAa,OAAO,KAAK,QAAQ,OAAO,gBAAgB;AAAA,MACxH;AAEA,YAAM,oBAAsC,CAAC;AAE7C,WAAK,mBAAmB;AAExB,UAAI,YAAY;AAChB,eAAS,IAAI,GAAG,MAAM,eAAe,QAAQ,IAAI,KAAK,KAAK;AAC1D,cAAM,SAAS,eAAe,CAAC;AAC/B,cAAM,CAAC,QAAQ,IAAI,SAAS,OAAO,IAAI;AACvC,aAAK,wBAAwB,KAAK;AAElC,cAAM,kBAAkB,OAAO,MAAM;AACrC,cAAM,gBAAgB,OAAO,MAAM;AAEnC,cAAM,mBAAmB,gBAAgB;AACzC,cAAM,oBAAoB;AAC1B,cAAM,kBAAkB,KAAK,IAAI,kBAAkB,iBAAiB;AAEpE,cAAM,uBAAwB,oBAAoB;AAElD,cAAM,6BAA6B,eAAe,YAAY,uBAAuB;AACrF,cAAM,sBAAsB;AAC5B,cAAM,yBAAyB,6BAA6B;AAE5D,cAAM,2CAA2C,KAAK,iBAAiB;AAAA,UACtE;AAAA,UACA,KAAK,YAAY,IAAI,SAAS,qBAAqB,CAAC,CAAC;AAAA,UACrD,KAAK,YAAY,IAAI,SAAS,wBAAwB,KAAK,iBAAiB,sBAAsB,CAAC,CAAC;AAAA,UACpG;AAAA,QACD;AAGA,cAAM,4BAA4B,iBAAiB,gBAAgB,wCAAwC;AAC3G,cAAM,iCAAiC,IAAI,WAAW,yBAAyB;AAE/E,iBAAS,IAAI,iBAAiB,KAAK,GAAG,KAAK;AAC1C,gBAAM,iBAAiB,kBAAkB;AACzC,gBAAM,wBAAwB,6BAA6B;AAE3D,yCAA+B,iBAAiB,OAAK,EAAE,aAAa,qBAAqB;AACzF,gBAAM,2BAA2B,+BAA+B,iBAAiB,OAAK,EAAE,eAAe,qBAAqB;AAE5H,4BAAkB;AAAA,YACjB,IAAI;AAAA,cACH;AAAA,cACA,KAAK,eAAe,qBAAqB;AAAA,cACzC;AAAA,YACD;AAAA,UAAC;AAAA,QACH;AAEA,YAAI,kBAAkB,kBAAkB;AAEvC,gBAAM,wBAAwB,kBAAkB;AAChD,4BAAkB,KAAK,IAAI,qBAAqB,wBAAwB,GAAG,aAAa,CAAC;AAAA,QAC1F;AAEA,YAAI,kBAAkB,mBAAmB;AACxC,gBAAMC,kCAAiC,IAAI,WAAW,yBAAyB;AAE/E,gBAAM,mBAAmB,kBAAkB;AAC3C,gBAAM,MAAM,oBAAoB;AAChC,gBAAM,iBAAiB,eAAe,YAAY,MAAM,mBAAmB;AAC3E,gBAAM,gBAA+C,CAAC;AACtD,gBAAM,WAAqB,CAAC;AAC5B,mBAASC,KAAI,GAAGA,KAAI,KAAKA,MAAK;AAC7B,kBAAM,aAAa,iBAAiBA;AACpC,qBAASA,EAAC,IAAI,KAAK,eAAe,UAAU;AAE5C,YAAAD,gCAA+B,UAAU,OAAK,EAAE,aAAa,UAAU;AACvE,0BAAcC,EAAC,IAAID,gCAA+B,UAAU,OAAK,EAAE,eAAe,UAAU;AAAA,UAC7F;AAEA,4BAAkB;AAAA,YACjB,IAAI;AAAA,cACH,mBAAmB;AAAA,cACnB,kBAAkB;AAAA,cAClB;AAAA,cACA;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAEA,qBAAa;AAAA,MACd;AAEA,WAAK;AAAA,QACJ,IAAI;AAAA,UACH;AAAA,UACA,KAAK,aAAa;AAAA,UAClB,KAAK;AAAA,UACL,KAAK;AAAA,QACN;AAAA,QACA;AAAA,UACC,SAAS;AAAA,UACT,KAAK,KAAK,QAAQ,OAAO;AAAA,UACzB,aAAa;AAAA,UACb,WAAW,KAAK,aAAa;AAAA,UAC7B,WAAW,KAAK;AAAA,UAChB,WAAW,KAAK;AAAA,UAChB,SAAS;AAAA,QACV;AAAA,MACD;AAAA,IACD;AAEA,WAAQ,OAAO,iBAAiB,OAAO,SAAY,OAAO;AAAA,EAC3D;AAAA,EAEO,OAA6B;AACnC,WAAO,KAAK,iBAAiB,KAAK,KAAK,GAAG;AAAA,EAC3C;AAAA,EAEO,UAAmB;AACzB,WAAO,KAAK,iBAAiB,QAAQ,KAAK,GAAG;AAAA,EAC9C;AAAA,EAEO,OAA6B;AACnC,WAAO,KAAK,iBAAiB,KAAK,KAAK,GAAG;AAAA,EAC3C;AAAA,EAEO,UAAmB;AACzB,WAAO,KAAK,iBAAiB,QAAQ,KAAK,GAAG;AAAA,EAC9C;AAAA;AAAA;AAAA,EAMQ,wCAAwC,2BAAqD;AAGpG,QAAI,8BAA8B,QAAQ,0BAA0B,SAAS,GAAG;AAC/E;AAAA,IACD;AAEA,UAAM,gBAAgB,MAAM,KAAK,yBAAyB;AAC1D,UAAM,mBAAmB,cAAc,IAAI,gBAAc,IAAI,oBAAoB,YAAY,KAAK,eAAe,UAAU,GAAG,KAAK,uBAAuB,UAAU,CAAC,CAAC;AAEtK,SAAK,yBAAyB,KAAK,IAAI,8BAA8B,gBAAgB,CAAC;AAAA,EACvF;AAAA,EAEO,kBAAqB,UAAwE,UAAkB,GAAa;AAClI,SAAK,mBAAmB;AAExB,QAAI;AACH,WAAK,wBAAwB,kBAAkB;AAC/C,aAAO,KAAK,mBAAmB,SAAS,QAAQ;AAAA,IACjD,UAAE;AACD,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA,EAEQ,mBAAsB,SAAiB,UAAkF;AAChI,UAAM,iBAAwD;AAAA,MAC7D,eAAe,wBAAC,OAAe,YAAmD;AACjF,eAAO,KAAK,sBAAsB,SAAS,CAAC,GAAG,CAAC,EAAE,OAAc,QAAiB,CAAC,CAAC,EAAE,CAAC;AAAA,MACvF,GAFe;AAAA,MAGf,kBAAkB,wBAAC,IAAY,aAA2B;AACzD,aAAK,sBAAsB,IAAI,QAAQ;AAAA,MACxC,GAFkB;AAAA,MAGlB,yBAAyB,wBAAC,IAAY,YAA2C;AAChF,aAAK,6BAA6B,IAAI,kBAAkB,OAAO,CAAC;AAAA,MACjE,GAFyB;AAAA,MAGzB,kBAAkB,wBAAC,OAAqB;AACvC,aAAK,sBAAsB,SAAS,CAAC,EAAE,GAAG,CAAC,CAAC;AAAA,MAC7C,GAFkB;AAAA,MAGlB,kBAAkB,wBAAC,gBAA0B,mBAA4D;AACxG,YAAI,eAAe,WAAW,KAAK,eAAe,WAAW,GAAG;AAE/D,iBAAO,CAAC;AAAA,QACT;AACA,eAAO,KAAK,sBAAsB,SAAS,gBAAgB,cAAc;AAAA,MAC1E,GANkB;AAAA,IAOnB;AACA,QAAI,SAAmB;AACvB,QAAI;AACH,eAAS,SAAS,cAAc;AAAA,IACjC,SAAS,GAAG;AACX,wBAAkB,CAAC;AAAA,IACpB;AAEA,mBAAe,gBAAgB;AAC/B,mBAAe,mBAAmB;AAClC,mBAAe,0BAA0B;AACzC,mBAAe,mBAAmB;AAClC,mBAAe,mBAAmB;AAClC,WAAO;AAAA,EACR;AAAA,EAEO,iBAAiB,gBAA0B,gBAA+C,UAAkB,GAAa;AAC/H,SAAK,mBAAmB;AACxB,QAAI,CAAC,gBAAgB;AACpB,uBAAiB,CAAC;AAAA,IACnB;AACA,QAAI,eAAe,WAAW,KAAK,eAAe,WAAW,GAAG;AAE/D,aAAO,CAAC;AAAA,IACT;AAEA,QAAI;AACH,WAAK;AACL,UAAI,KAAK,0BAA0B,GAAG;AACrC,gBAAQ,KAAK,0EAA0E;AACvF,0BAAkB,IAAI,MAAM,0EAA0E,CAAC;AAAA,MACxG;AACA,WAAK,wBAAwB,kBAAkB;AAC/C,aAAO,KAAK,sBAAsB,SAAS,gBAAgB,cAAc;AAAA,IAC1E,UAAE;AACD,WAAK,wBAAwB,gBAAgB;AAC7C,WAAK;AAAA,IACN;AAAA,EACD;AAAA,EAEA,iBAAiB,IAA0B;AAC1C,WAAO,KAAK,mBAAmB,EAAE;AAAA,EAClC;AAAA,EAIA,iBAAiB,IAAmB,UAAwB,eAA4D;AACvH,UAAM,OAAQ,KAAK,KAAK,aAAa,EAAE,IAAI;AAE3C,QAAI,CAAC,MAAM;AACV,UAAI,CAAC,UAAU;AAEd,eAAO;AAAA,MACR;AAEA,aAAO,KAAK,sBAAsB,GAAG,CAAC,GAAG,CAAC,EAAE,OAAO,UAAU,SAAS,sBAAsB,aAAa,EAAE,CAAC,GAAG,IAAI,EAAE,CAAC;AAAA,IACvH;AAEA,QAAI,CAAC,UAAU;AAEd,WAAK,iBAAiB,OAAO,IAAI;AACjC,aAAO,KAAK,aAAa,KAAK,EAAE;AAChC,aAAO;AAAA,IACR;AAGA,UAAM,QAAQ,KAAK,mCAAmC,QAAQ;AAC9D,UAAM,cAAc,KAAK,QAAQ,YAAY,MAAM,iBAAiB,MAAM,WAAW;AACrF,UAAM,YAAY,KAAK,QAAQ,YAAY,MAAM,eAAe,MAAM,SAAS;AAC/E,SAAK,iBAAiB,OAAO,IAAI;AACjC,SAAK,MAAM,KAAK,aAAa,GAAG,aAAa,WAAW,KAAK;AAC7D,SAAK,WAAW,sBAAsB,aAAa,CAAC;AACpD,SAAK,iBAAiB,OAAO,IAAI;AACjC,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,gCAAgC,SAAuB;AAC7D,QAAI,KAAK,aAAa;AACrB;AAAA,IACD;AACA,UAAM,QAAQ,KAAK,iBAAiB,sBAAsB,OAAO;AACjE,aAAS,IAAI,GAAG,MAAM,MAAM,QAAQ,IAAI,KAAK,KAAK;AACjD,YAAM,OAAO,MAAM,CAAC;AAEpB,WAAK,iBAAiB,OAAO,IAAI;AACjC,aAAO,KAAK,aAAa,KAAK,EAAE;AAAA,IACjC;AAAA,EACD;AAAA,EAEO,qBAAqB,cAA4D;AACvF,UAAM,OAAO,KAAK,aAAa,YAAY;AAC3C,QAAI,CAAC,MAAM;AACV,aAAO;AAAA,IACR;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,mBAAmB,cAAoC;AAC7D,UAAM,OAAO,KAAK,aAAa,YAAY;AAC3C,QAAI,CAAC,MAAM;AACV,aAAO;AAAA,IACR;AACA,WAAO,KAAK,iBAAiB,aAAa,MAAM,IAAI;AAAA,EACrD;AAAA,EAEO,mBAAmB,YAAoB,UAAkB,GAAG,sBAA+B,OAAiC;AAClI,QAAI,aAAa,KAAK,aAAa,KAAK,aAAa,GAAG;AACvD,aAAO,CAAC;AAAA,IACT;AACA,WAAO,KAAK,oBAAoB,YAAY,YAAY,SAAS,mBAAmB;AAAA,EACrF;AAAA,EAEO,oBAAoB,kBAA0B,gBAAwB,UAAkB,GAAG,sBAA+B,OAAO,wBAAiC,OAAiC;AACzM,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,kBAAkB,KAAK,IAAI,WAAW,KAAK,IAAI,GAAG,gBAAgB,CAAC;AACzE,UAAM,gBAAgB,KAAK,IAAI,WAAW,KAAK,IAAI,GAAG,cAAc,CAAC;AACrE,UAAM,YAAY,KAAK,iBAAiB,aAAa;AACrD,UAAM,QAAQ,IAAI,MAAM,iBAAiB,GAAG,eAAe,SAAS;AAEpE,UAAM,cAAc,KAAK,uBAAuB,OAAO,SAAS,qBAAqB,qBAAqB;AAC1G,aAAS,aAAa,KAAK,oBAAoB,sBAAsB,OAAO,SAAS,mBAAmB,CAAC;AACzG,WAAO;AAAA,EACR;AAAA,EAEO,sBAAsB,OAAe,UAAkB,GAAG,sBAA+B,OAAO,yBAAkC,OAAO,wBAAiC,OAAiC;AACjN,UAAM,iBAAiB,KAAK,cAAc,KAAK;AAE/C,UAAM,cAAc,KAAK,uBAAuB,gBAAgB,SAAS,qBAAqB,qBAAqB;AACnH,aAAS,aAAa,KAAK,oBAAoB,sBAAsB,gBAAgB,SAAS,qBAAqB,sBAAsB,CAAC;AAC1I,WAAO;AAAA,EACR;AAAA,EAEO,4BAA4B,UAAkB,GAAG,sBAA+B,OAAiC;AACvH,WAAO,KAAK,iBAAiB,OAAO,MAAM,SAAS,qBAAqB,MAAM,KAAK;AAAA,EACpF;AAAA,EAEO,2BAA2B,UAAkB,GAA6B;AAChF,WAAO,KAAK,iBAAiB,mBAAmB,MAAM,OAAO;AAAA,EAC9D;AAAA,EAEQ,uBAAuB,YAAwC;AACtE,UAAM,cAAc,KAAK,QAAQ,YAAY,YAAY,CAAC;AAC1D,UAAM,YAAY,cAAc,KAAK,QAAQ,cAAc,UAAU;AAErE,UAAM,SAAS,KAAK,iBAAiB,0BAA0B,MAAM,aAAa,WAAW,CAAC;AAC9F,WAAO,iBAAiB,gBAAgB,MAAM,EAAE,OAAO,OAAK,EAAE,eAAe,UAAU;AAAA,EACxF;AAAA,EAEO,kBAAkB,UAAkB,GAAG,sBAA+B,OAAiC;AAC7G,QAAI,SAAS,KAAK,iBAAiB,OAAO,MAAM,SAAS,qBAAqB,OAAO,KAAK;AAC1F,aAAS,OAAO,OAAO,KAAK,oBAAoB,kBAAkB,SAAS,mBAAmB,CAAC;AAC/F,WAAO;AAAA,EACR;AAAA,EAEO,wBAAwB,UAAkB,GAA6B;AAC7E,WAAO,KAAK,iBAAiB,OAAO,MAAM,SAAS,OAAO,OAAO,IAAI;AAAA,EACtE;AAAA,EAEQ,uBAAuB,aAAoB,eAAuB,qBAA8B,uBAA0D;AACjK,UAAM,cAAc,KAAK,QAAQ,YAAY,YAAY,iBAAiB,YAAY,WAAW;AACjG,UAAM,YAAY,KAAK,QAAQ,YAAY,YAAY,eAAe,YAAY,SAAS;AAC3F,WAAO,KAAK,iBAAiB,iBAAiB,MAAM,aAAa,WAAW,eAAe,qBAAqB,qBAAqB;AAAA,EACtI;AAAA,EAEO,WAAW,OAAe,KAAoB;AACpD,WAAO,KAAK,QAAQ,WAAW,OAAO,MAAM,KAAK;AAAA,EAClD;AAAA,EAEQ,sBAAsB,cAAsB,QAAsB;AACzE,UAAM,OAAO,KAAK,aAAa,YAAY;AAC3C,QAAI,CAAC,MAAM;AACV;AAAA,IACD;AAEA,QAAI,KAAK,QAAQ,OAAO;AACvB,YAAM,WAAW,KAAK,mBAAmB,YAAY;AACrD,WAAK,wBAAwB,iCAAiC,SAAU,aAAa;AAAA,IACtF;AACA,QAAI,KAAK,QAAQ,QAAQ;AACxB,YAAM,WAAW,KAAK,mBAAmB,YAAY;AACrD,WAAK,wBAAwB,iCAAiC,SAAU,eAAe;AAAA,IACxF;AAEA,UAAM,QAAQ,KAAK,mCAAmC,MAAM;AAC5D,UAAM,cAAc,KAAK,QAAQ,YAAY,MAAM,iBAAiB,MAAM,WAAW;AACrF,UAAM,YAAY,KAAK,QAAQ,YAAY,MAAM,eAAe,MAAM,SAAS;AAE/E,SAAK,iBAAiB,OAAO,IAAI;AACjC,SAAK,MAAM,KAAK,aAAa,GAAG,aAAa,WAAW,KAAK;AAC7D,SAAK,iBAAiB,OAAO,IAAI;AACjC,SAAK,wBAAwB,qBAAqB,KAAK,OAAO;AAE9D,QAAI,KAAK,QAAQ,OAAO;AACvB,WAAK,wBAAwB,iCAAiC,MAAM,aAAa;AAAA,IAClF;AACA,QAAI,KAAK,QAAQ,QAAQ;AACxB,WAAK,wBAAwB,iCAAiC,MAAM,eAAe;AAAA,IACpF;AAAA,EACD;AAAA,EAEQ,6BAA6B,cAAsB,SAAuC;AACjG,UAAM,OAAO,KAAK,aAAa,YAAY;AAC3C,QAAI,CAAC,MAAM;AACV;AAAA,IACD;AAEA,UAAM,yBAA0B,KAAK,QAAQ,iBAAiB,KAAK,QAAQ,cAAc,QAAQ,OAAO;AACxG,UAAM,wBAAyB,QAAQ,iBAAiB,QAAQ,cAAc,QAAQ,OAAO;AAE7F,SAAK,wBAAwB,qBAAqB,KAAK,OAAO;AAC9D,SAAK,wBAAwB,qBAAqB,OAAO;AAEzD,QAAI,KAAK,QAAQ,SAAS,QAAQ,OAAO;AACxC,YAAM,YAAY,KAAK,iBAAiB,aAAa,MAAM,IAAI;AAC/D,WAAK,wBAAwB,iCAAiC,UAAU,aAAa;AAAA,IACtF;AACA,QAAI,KAAK,QAAQ,UAAU,QAAQ,QAAQ;AAC1C,YAAM,YAAY,KAAK,iBAAiB,aAAa,MAAM,IAAI;AAC/D,WAAK,wBAAwB,iCAAiC,UAAU,eAAe;AAAA,IACxF;AAEA,UAAM,uBAAuB,2BAA2B;AACxD,UAAM,6BAA6B,sBAAsB,OAAO,MAAM,mBAAmB,IAAI;AAC7F,QAAI,wBAAwB,4BAA4B;AACvD,WAAK,iBAAiB,OAAO,IAAI;AACjC,WAAK,WAAW,OAAO;AACvB,WAAK,iBAAiB,OAAO,IAAI;AAAA,IAClC,OAAO;AACN,WAAK,WAAW,OAAO;AAAA,IACxB;AAAA,EACD;AAAA,EAEQ,sBAAsB,SAAiB,mBAA6B,gBAA+C,iBAA0B,OAAiB;AACrK,UAAM,YAAY,KAAK,aAAa;AAEpC,UAAM,oBAAoB,kBAAkB;AAC5C,QAAI,qBAAqB;AAEzB,UAAM,oBAAoB,eAAe;AACzC,QAAI,qBAAqB;AAEzB,SAAK,wBAAwB,kBAAkB;AAC/C,QAAI;AACH,YAAM,SAAS,IAAI,MAAc,iBAAiB;AAClD,aAAO,qBAAqB,qBAAqB,qBAAqB,mBAAmB;AAExF,YAAI,OAA4B;AAEhC,YAAI,qBAAqB,mBAAmB;AAE3C,aAAG;AACF,mBAAO,KAAK,aAAa,kBAAkB,oBAAoB,CAAC;AAAA,UACjE,SAAS,CAAC,QAAQ,qBAAqB;AAGvC,cAAI,MAAM;AACT,gBAAI,KAAK,QAAQ,OAAO;AACvB,oBAAM,YAAY,KAAK,iBAAiB,aAAa,MAAM,IAAI;AAC/D,mBAAK,wBAAwB,iCAAiC,UAAU,aAAa;AAAA,YACtF;AACA,gBAAI,KAAK,QAAQ,QAAQ;AACxB,oBAAM,YAAY,KAAK,iBAAiB,aAAa,MAAM,IAAI;AAC/D,mBAAK,wBAAwB,iCAAiC,UAAU,eAAe;AAAA,YACxF;AAEA,iBAAK,iBAAiB,OAAO,IAAI;AAEjC,gBAAI,CAAC,gBAAgB;AACpB,mBAAK,wBAAwB,qBAAqB,KAAK,OAAO;AAAA,YAC/D;AAAA,UACD;AAAA,QACD;AAEA,YAAI,qBAAqB,mBAAmB;AAE3C,cAAI,CAAC,MAAM;AACV,kBAAM,uBAAwB,EAAE,KAAK;AACrC,kBAAM,eAAe,GAAG,KAAK,WAAW,IAAI,oBAAoB;AAChE,mBAAO,IAAI,aAAa,cAAc,GAAG,CAAC;AAC1C,iBAAK,aAAa,YAAY,IAAI;AAAA,UACnC;AAGA,gBAAM,gBAAgB,eAAe,kBAAkB;AACvD,gBAAM,QAAQ,KAAK,mCAAmC,cAAc,KAAK;AACzE,gBAAM,UAAU,kBAAkB,cAAc,OAAO;AACvD,gBAAM,cAAc,KAAK,QAAQ,YAAY,MAAM,iBAAiB,MAAM,WAAW;AACrF,gBAAM,YAAY,KAAK,QAAQ,YAAY,MAAM,eAAe,MAAM,SAAS;AAE/E,eAAK,UAAU;AACf,eAAK,MAAM,WAAW,aAAa,WAAW,KAAK;AACnD,eAAK,WAAW,OAAO;AAEvB,cAAI,KAAK,QAAQ,OAAO;AACvB,iBAAK,wBAAwB,iCAAiC,MAAM,aAAa;AAAA,UAClF;AACA,cAAI,KAAK,QAAQ,QAAQ;AACxB,iBAAK,wBAAwB,iCAAiC,MAAM,eAAe;AAAA,UACpF;AAEA,cAAI,CAAC,gBAAgB;AACpB,iBAAK,wBAAwB,qBAAqB,OAAO;AAAA,UAC1D;AAEA,eAAK,iBAAiB,OAAO,IAAI;AAEjC,iBAAO,kBAAkB,IAAI,KAAK;AAElC;AAAA,QACD,OAAO;AACN,cAAI,MAAM;AACT,mBAAO,KAAK,aAAa,KAAK,EAAE;AAAA,UACjC;AAAA,QACD;AAAA,MACD;AAEA,aAAO;AAAA,IACR,UAAE;AACD,WAAK,wBAAwB,gBAAgB;AAAA,IAC9C;AAAA,EACD;AAAA;AAAA;AAAA;AAAA,EAOO,gBAAwB;AAC9B,WAAO,KAAK,aAAa,cAAc;AAAA,EACxC;AAAA,EAEO,YAAY,uBAAoD,QAAuB;AAC7F,QAAI,OAAO,0BAA0B,UAAU;AAC9C,WAAK,2BAA2B,MAAM;AACtC,WAAK,aAAa,uBAAuB,MAAM;AAAA,IAChD,OAAO;AACN,WAAK,2BAA2B,QAAQ,sBAAsB,YAAY,MAAM,KAAK,aAAa,sBAAsB,YAAY,MAAM,CAAC;AAC3I,WAAK,aAAa,sBAAsB,YAAY,MAAM;AAAA,IAC3D;AAAA,EACD;AAAA,EAEQ,aAAa,YAAoB,QAAuB;AAC/D,SAAK,aAAa,cAAc,YAAY,MAAM;AAClD,SAAK,iBAAiB,4BAA4B,UAAU;AAAA,EAC7D;AAAA,EAEO,wBAAwB,YAAoB,QAAwB;AAC1E,WAAO,KAAK,aAAa,wBAAwB,YAAY,MAAM;AAAA,EACpE;AAAA,EAEO,kBAAkB,UAA6C;AACrE,WAAO,KAAK,2BAA2B,kBAAkB,QAAQ;AAAA,EAClE;AAAA,EAEO,qBAAqB,UAAsC;AACjE,WAAO,KAAK,2BAA2B,qBAAqB,QAAQ;AAAA,EACrE;AAAA;AAAA,EAGA,kBAAkB,UAAoB,UAA4C;AACjF,WAAO;AAAA,EACR;AAAA;AAAA;AAAA;AAAA;AAAA,EAMO,oBAAoB,YAA4B;AAEtD,WAAO,aAAa,KAAK,eAAe,UAAU,CAAC,IAAI;AAAA,EACxD;AACD;AAtxDa,YAAN;AAAA,EA4HJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GA/HU;AAwxDN,SAAS,aAAa,MAAsB;AAClD,MAAI,SAAS;AACb,aAAW,KAAK,MAAM;AACrB,QAAI,MAAM,OAAO,MAAM,KAAM;AAC5B;AAAA,IACD,OAAO;AACN;AAAA,IACD;AAAA,EACD;AACA,SAAO;AACR;AAVgB;AAchB,SAAS,sBAAsB,MAA6B;AAC3D,SAAQ,KAAK,QAAQ,iBAAiB,KAAK,QAAQ,cAAc,QAAQ,OAAO;AACjF;AAFS;AAIT,SAAS,sBAAsB,SAA0C;AACxE,SAAO,CAAC,CAAC,QAAQ,SAAS,CAAC,CAAC,QAAQ;AACrC;AAFS;AAIT,SAAS,mBAAmB,MAA6B;AACxD,SAAO,CAAC,CAAC,KAAK,QAAQ,SAAS,CAAC,CAAC,KAAK,QAAQ;AAC/C;AAFS;AAST,MAAM,iBAAiB;AAAA,EAv+DvB,OAu+DuB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAKL;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA;AAAA;AAAA;AAAA,EAKA;AAAA,EAEjB,cAAc;AACb,SAAK,oBAAoB,IAAI,aAAa;AAC1C,SAAK,oBAAoB,IAAI,aAAa;AAC1C,SAAK,+BAA+B,IAAI,aAAa;AAAA,EACtD;AAAA,EAEO,yBAAyB,MAAmC;AAClE,SAAK,OAAO,MAAM,GAAG,OAAO,OAAO,KAAK;AAAA,EACzC;AAAA,EAEQ,uBAAuB,MAA6B,OAAiD;AAC5G,eAAW,QAAQ,OAAO;AACzB,UAAI,KAAK,UAAU,MAAM;AACxB,aAAK,QAAQ,KAAK,WAAW,KAAK,qBAAqB,KAAK,iBAAiB;AAAA,MAC9E;AAAA,IACD;AACA,WAAiC;AAAA,EAClC;AAAA,EAEO,iBAAiB,MAA6B,OAAe,KAAa,eAAuB,qBAA8B,uBAA0D;AAC/L,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,SAAS,KAAK,gBAAgB,OAAO,KAAK,eAAe,qBAAqB,WAAW,qBAAqB;AACpH,WAAO,KAAK,uBAAuB,MAAM,MAAM;AAAA,EAChD;AAAA,EAEQ,gBAAgB,OAAe,KAAa,eAAuB,qBAA8B,iBAAyB,uBAAgD;AACjL,UAAM,KAAK,KAAK,kBAAkB,eAAe,OAAO,KAAK,eAAe,qBAAqB,iBAAiB,qBAAqB;AACvI,UAAM,KAAK,KAAK,kBAAkB,eAAe,OAAO,KAAK,eAAe,qBAAqB,iBAAiB,qBAAqB;AACvI,UAAM,KAAK,KAAK,6BAA6B,eAAe,OAAO,KAAK,eAAe,qBAAqB,iBAAiB,qBAAqB;AAClJ,WAAO,GAAG,OAAO,EAAE,EAAE,OAAO,EAAE;AAAA,EAC/B;AAAA,EAEO,0BAA0B,MAA6B,OAAe,KAAa,eAAiD;AAC1I,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,SAAS,KAAK,6BAA6B,eAAe,OAAO,KAAK,eAAe,OAAO,WAAW,KAAK;AAClH,WAAO,KAAK,uBAAuB,MAAM,MAAM,EAAE,OAAO,CAAC,MAAM,EAAE,QAAQ,mBAAmB,CAAC,EAAE,MAAM,QAAQ,CAAC;AAAA,EAC/G;AAAA,EAEO,mBAAmB,MAA6B,eAAiD;AACvG,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,SAAS,KAAK,6BAA6B,OAAO,eAAe,OAAO,WAAW,KAAK;AAC9F,WAAO,KAAK,uBAAuB,MAAM,MAAM,EAAE,OAAO,CAAC,MAAM,EAAE,QAAQ,mBAAmB,CAAC,EAAE,MAAM,QAAQ,CAAC;AAAA,EAC/G;AAAA,EAEO,OAAO,MAA6B,eAAuB,qBAA8B,mBAA4B,uBAA0D;AACrL,UAAM,YAAY,KAAK,aAAa;AACpC,UAAM,SAAS,KAAK,QAAQ,eAAe,qBAAqB,mBAAmB,WAAW,qBAAqB;AACnH,WAAO,KAAK,uBAAuB,MAAM,MAAM;AAAA,EAChD;AAAA,EAEQ,QAAQ,eAAuB,qBAA8B,mBAA4B,iBAAyB,uBAAgD;AACzK,QAAI,mBAAmB;AACtB,aAAO,KAAK,kBAAkB,OAAO,eAAe,qBAAqB,iBAAiB,qBAAqB;AAAA,IAChH,OAAO;AACN,YAAM,KAAK,KAAK,kBAAkB,OAAO,eAAe,qBAAqB,iBAAiB,qBAAqB;AACnH,YAAM,KAAK,KAAK,kBAAkB,OAAO,eAAe,qBAAqB,iBAAiB,qBAAqB;AACnH,YAAM,KAAK,KAAK,6BAA6B,OAAO,eAAe,qBAAqB,iBAAiB,qBAAqB;AAC9H,aAAO,GAAG,OAAO,EAAE,EAAE,OAAO,EAAE;AAAA,IAC/B;AAAA,EACD;AAAA,EAEO,sBAAsB,SAAiC;AAC7D,UAAM,KAAK,KAAK,kBAAkB,sBAAsB,OAAO;AAC/D,UAAM,KAAK,KAAK,kBAAkB,sBAAsB,OAAO;AAC/D,UAAM,KAAK,KAAK,6BAA6B,sBAAsB,OAAO;AAC1E,WAAO,GAAG,OAAO,EAAE,EAAE,OAAO,EAAE;AAAA,EAC/B;AAAA,EAEO,wBAAwC;AAC9C,UAAM,KAAK,KAAK,kBAAkB,sBAAsB;AACxD,UAAM,KAAK,KAAK,kBAAkB,sBAAsB;AACxD,UAAM,KAAK,KAAK,6BAA6B,sBAAsB;AACnE,WAAO,GAAG,OAAO,EAAE,EAAE,OAAO,EAAE;AAAA,EAC/B;AAAA,EAEO,OAAO,MAA0B;AACvC,QAAI,mBAAmB,IAAI,GAAG;AAC7B,WAAK,6BAA6B,OAAO,IAAI;AAAA,IAC9C,WAAW,sBAAsB,IAAI,GAAG;AACvC,WAAK,kBAAkB,OAAO,IAAI;AAAA,IACnC,OAAO;AACN,WAAK,kBAAkB,OAAO,IAAI;AAAA,IACnC;AAAA,EACD;AAAA,EAEO,OAAO,MAA0B;AACvC,QAAI,mBAAmB,IAAI,GAAG;AAC7B,WAAK,6BAA6B,OAAO,IAAI;AAAA,IAC9C,WAAW,sBAAsB,IAAI,GAAG;AACvC,WAAK,kBAAkB,OAAO,IAAI;AAAA,IACnC,OAAO;AACN,WAAK,kBAAkB,OAAO,IAAI;AAAA,IACnC;AAAA,EACD;AAAA,EAEO,aAAa,MAA6B,MAA2B;AAC3E,UAAM,YAAY,KAAK,aAAa;AACpC,QAAI,KAAK,oBAAoB,WAAW;AACvC,WAAK,aAAa,MAAM,SAAS;AAAA,IAClC;AACA,QAAI,KAAK,UAAU,MAAM;AACxB,WAAK,QAAQ,KAAK,WAAW,KAAK,qBAAqB,KAAK,iBAAiB;AAAA,IAC9E;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEQ,aAAa,MAAoB,iBAA+B;AACvE,QAAI,mBAAmB,IAAI,GAAG;AAC7B,WAAK,6BAA6B,YAAY,MAAM,eAAe;AAAA,IACpE,WAAW,sBAAsB,IAAI,GAAG;AACvC,WAAK,kBAAkB,YAAY,MAAM,eAAe;AAAA,IACzD,OAAO;AACN,WAAK,kBAAkB,YAAY,MAAM,eAAe;AAAA,IACzD;AAAA,EACD;AAAA,EAEO,cAAc,QAAgB,QAAgB,YAAoB,kBAAiC;AACzG,SAAK,kBAAkB,cAAc,QAAQ,QAAQ,YAAY,gBAAgB;AACjF,SAAK,kBAAkB,cAAc,QAAQ,QAAQ,YAAY,gBAAgB;AACjF,SAAK,6BAA6B,cAAc,QAAQ,QAAQ,YAAY,gBAAgB;AAAA,EAC7F;AACD;AAEA,SAAS,eAAe,WAA2B;AAClD,SAAO,UAAU,QAAQ,kBAAkB,GAAG;AAC/C;AAFS;AAIT,MAAM,kBAAsD;AAAA,EAvnE5D,OAunE4D;AAAA;AAAA;AAAA,EAClD;AAAA,EACA;AAAA,EAET,YAAY,SAAmC;AAC9C,SAAK,QAAQ,QAAQ,SAAS;AAC9B,SAAK,YAAY,QAAQ,aAAa;AAAA,EAEvC;AACD;AAEO,MAAM,4CAA4C,kBAAkB;AAAA,EAloE3E,OAkoE2E;AAAA;AAAA;AAAA,EACjE;AAAA,EACD;AAAA,EAER,YAAY,SAAqD;AAChE,UAAM,OAAO;AACb,SAAK,iBAAiB;AACtB,SAAK,WAAY,OAAO,QAAQ,aAAa,WAAW,QAAQ,WAAW,MAAM,kBAAkB;AAAA,EACpG;AAAA,EAEO,SAAS,OAA4B;AAC3C,QAAI,CAAC,KAAK,gBAAgB;AACzB,UAAI,MAAM,SAAS,WAAW,KAAK,WAAW;AAC7C,aAAK,iBAAiB,KAAK,cAAc,KAAK,WAAW,KAAK;AAAA,MAC/D,OAAO;AACN,aAAK,iBAAiB,KAAK,cAAc,KAAK,OAAO,KAAK;AAAA,MAC3D;AAAA,IACD;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,wBAA8B;AACpC,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAEQ,cAAc,OAA4B,OAA4B;AAC7E,QAAI,OAAO,UAAU,UAAU;AAC9B,aAAO;AAAA,IACR;AACA,UAAM,IAAI,QAAQ,MAAM,SAAS,MAAM,EAAE,IAAI;AAC7C,QAAI,CAAC,GAAG;AACP,aAAO;AAAA,IACR;AACA,WAAO,EAAE,SAAS;AAAA,EACnB;AACD;AAEO,MAAM,kCAAkC;AAAA,EAvqE/C,OAuqE+C;AAAA;AAAA;AAAA,EACrC;AAAA,EACA;AAAA,EAET,YAAY,SAAsE;AACjF,SAAK,WAAW,SAAS,YAAY,MAAM,gBAAgB;AAC3D,SAAK,cAAc,SAAS;AAAA,EAC7B;AACD;AAEO,MAAM,sCAAsC,kBAAkB;AAAA,EAjrErE,OAirEqE;AAAA;AAAA;AAAA,EAC3D;AAAA,EACA;AAAA,EACA;AAAA,EACD;AAAA,EAER,YAAY,SAA+C;AAC1D,UAAM,OAAO;AACb,SAAK,WAAW,QAAQ;AACxB,SAAK,qBAAqB,QAAQ,sBAAsB;AACxD,SAAK,oBAAoB,QAAQ,qBAAqB;AAAA,EACvD;AAAA,EAEO,SAAS,OAAuC;AACtD,QAAI,CAAC,KAAK,gBAAgB;AACzB,UAAI,MAAM,SAAS,WAAW,KAAK,WAAW;AAC7C,aAAK,iBAAiB,KAAK,cAAc,KAAK,WAAW,KAAK;AAAA,MAC/D,OAAO;AACN,aAAK,iBAAiB,KAAK,cAAc,KAAK,OAAO,KAAK;AAAA,MAC3D;AAAA,IACD;AAEA,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,wBAA8B;AACpC,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAEQ,cAAc,OAA4B,OAAuC;AACxF,QAAI,OAAO,UAAU,UAAU;AAC9B,aAAO,MAAM,QAAQ,KAAK;AAAA,IAC3B;AACA,WAAO,MAAM,SAAS,MAAM,EAAE;AAAA,EAC/B;AACD;AAEO,MAAM,mCAAwE;AAAA,EAttErF,OAstEqF;AAAA;AAAA;AAAA,EACpF,OAAc,KAAK,SAAwE;AAC1F,QAAI,mBAAmB,oCAAoC;AAC1D,aAAO;AAAA,IACR;AACA,WAAO,IAAI,mCAAmC,OAAO;AAAA,EACtD;AAAA,EAEgB;AAAA,EACA;AAAA,EACP;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAED,YAAY,SAAoC;AACvD,SAAK,UAAU,QAAQ,WAAW;AAClC,SAAK,SAAS,QAAQ,UAAU;AAChC,SAAK,kBAAkB,QAAQ,mBAAmB;AAClD,SAAK,sCAAsC,QAAQ,uCAAuC;AAC1F,SAAK,eAAe,QAAQ,gBAAgB;AAC5C,SAAK,cAAc,QAAQ,eAAe;AAAA,EAC3C;AACD;AAEO,MAAM,uBAAgE;AAAA,EA/uE7E,OA+uE6E;AAAA;AAAA;AAAA,EAE5E,OAAc;AAAA,EAEd,OAAc,SAAS,SAAgE;AACtF,WAAO,IAAI,uBAAuB,OAAO;AAAA,EAC1C;AAAA,EAEA,OAAc,cAAc,SAAgE;AAC3F,WAAO,IAAI,uBAAuB,OAAO;AAAA,EAC1C;AAAA,EACS;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAED,YAAY,SAAwC;AAC3D,SAAK,cAAc,QAAQ;AAC3B,SAAK,iBAAiB,QAAQ,iBAAiB,eAAe,QAAQ,cAAc,IAAI;AACxF,SAAK,uBAAuB,QAAQ,wBAAwB;AAC5D,SAAK,kBAAkB,QAAQ,mBAAmB;AAClD,SAAK,eAAe,QAAQ,gBAAgB;AAC5C,SAAK,aAAa,QAAQ,cAAc,MAAM,uBAAuB;AACrE,SAAK,SAAS,QAAQ,UAAU;AAChC,SAAK,YAAY,QAAQ,YAAY,eAAe,QAAQ,SAAS,IAAI;AACzE,SAAK,4BAA4B,QAAQ,6BAA6B;AACtE,SAAK,eAAe,QAAQ,gBAAgB;AAC5C,SAAK,0BAA0B,QAAQ,2BAA2B;AAClE,SAAK,yBAAyB,QAAQ,0BAA0B;AAChE,SAAK,cAAc,QAAQ,eAAe;AAC1C,SAAK,kBAAkB,QAAQ,mBAAmB;AAClD,SAAK,wBAAwB,QAAQ,yBAAyB;AAC9D,SAAK,gBAAgB,QAAQ,gBAAgB,IAAI,oCAAoC,QAAQ,aAAa,IAAI;AAC9G,SAAK,UAAU,QAAQ,UAAU,IAAI,8BAA8B,QAAQ,OAAO,IAAI;AACtF,SAAK,cAAc,QAAQ,uBAAuB,IAAI,kCAAkC,QAAQ,WAAW,IAAI;AAC/G,SAAK,uBAAuB,QAAQ,uBAAuB,eAAe,QAAQ,oBAAoB,IAAI;AAC1G,SAAK,4BAA4B,QAAQ,4BAA4B,eAAe,QAAQ,yBAAyB,IAAI;AACzH,SAAK,sBAAsB,QAAQ,sBAAsB,eAAe,QAAQ,mBAAmB,IAAI;AACvG,SAAK,0BAA0B,QAAQ,0BAA0B,QAAQ,yBAAyB,QAAQ,uBAAuB,IAAI;AACrI,SAAK,+BAA+B,QAAQ,+BAA+B,eAAe,QAAQ,4BAA4B,IAAI;AAClI,SAAK,kBAAkB,QAAQ,kBAAkB,eAAe,QAAQ,eAAe,IAAI;AAC3F,SAAK,kBAAkB,QAAQ,kBAAkB,eAAe,QAAQ,eAAe,IAAI;AAC3F,SAAK,sCAAsC,QAAQ,uCAAuC;AAC1F,SAAK,yBAAyB,QAAQ,yBAAyB,eAAe,QAAQ,sBAAsB,IAAI;AAChH,SAAK,wBAAwB,QAAQ,wBAAwB,eAAe,QAAQ,qBAAqB,IAAI;AAC7G,SAAK,QAAQ,QAAQ,QAAQ,mCAAmC,KAAK,QAAQ,KAAK,IAAI;AACtF,SAAK,SAAS,QAAQ,SAAS,mCAAmC,KAAK,QAAQ,MAAM,IAAI;AACzF,SAAK,sBAAsB,QAAQ,uBAAuB;AAC1D,SAAK,qBAAqB,QAAQ,sBAAsB;AAAA,EACzD;AACD;AACA,uBAAuB,QAAQ,uBAAuB,SAAS,EAAE,aAAa,QAAQ,CAAC;AAKvF,MAAM,wBAAwB;AAAA,EAC7B,uBAAuB,SAAS,EAAE,aAAa,mDAAmD,YAAY,MAAM,uBAAuB,6BAA6B,CAAC;AAAA,EACzK,uBAAuB,SAAS,EAAE,aAAa,kDAAkD,YAAY,MAAM,uBAAuB,4BAA4B,CAAC;AAAA,EACvK,uBAAuB,SAAS,EAAE,aAAa,+CAA+C,YAAY,MAAM,uBAAuB,0BAA0B,CAAC;AAAA,EAClK,uBAAuB,SAAS,EAAE,aAAa,8CAA8C,YAAY,MAAM,uBAAuB,yBAAyB,CAAC;AACjK;AAEA,SAAS,kBAAkB,SAAgE;AAC1F,MAAI,mBAAmB,wBAAwB;AAC9C,WAAO;AAAA,EACR;AACA,SAAO,uBAAuB,cAAc,OAAO;AACpD;AALS;AAOT,MAAM,oCAAoC,WAAW;AAAA,EAapD,YAA6B,kBAA2E;AACvG,UAAM;AADsB;AAE5B,SAAK,eAAe;AACpB,SAAK,sBAAsB;AAC3B,SAAK,kBAAkB;AACvB,SAAK,wBAAwB;AAC7B,SAAK,sBAAsB;AAC3B,SAAK,qBAAqB;AAAA,EAC3B;AAAA,EAt2ED,OAi1EqD;AAAA;AAAA;AAAA,EAEnC,UAAkD,KAAK,UAAU,IAAI,QAAuC,CAAC;AAAA,EAC9G,QAA8C,KAAK,QAAQ;AAAA,EAEnE;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,6BAAiD;AAAA,EACjD;AAAA,EACA;AAAA,EAYR,eAAwB;AACvB,WAAO,KAAK,QAAQ,aAAa;AAAA,EAClC;AAAA,EAEO,oBAA0B;AAChC,SAAK;AAAA,EACN;AAAA,EAEO,kBAAwB;AAC9B,SAAK;AACL,QAAI,KAAK,iBAAiB,GAAG;AAC5B,UAAI,KAAK,qBAAqB;AAC7B,aAAK,OAAO;AAAA,MACb;AAEA,WAAK,4BAA4B,MAAM;AACvC,WAAK,6BAA6B;AAAA,IACnC;AAAA,EACD;AAAA,EAEO,iCAAiC,YAA0B;AACjE,QAAI,CAAC,KAAK,4BAA4B;AACrC,WAAK,6BAA6B,oBAAI,IAAI;AAAA,IAC3C;AACA,SAAK,2BAA2B,IAAI,UAAU;AAAA,EAC/C;AAAA,EAEO,qBAAqB,SAAuC;AAClE,SAAK,oBAAoB,CAAC,CAAC,QAAQ,SAAS;AAC5C,SAAK,0BAA0B,CAAC,CAAC,QAAQ,eAAe;AACxD,SAAK,wBAAwB,CAAC,CAAC,QAAQ;AACvC,SAAK,uBAAuB,CAAC,CAAC,QAAQ;AACtC,SAAK,QAAQ;AAAA,EACd;AAAA,EAEO,OAAa;AACnB,SAAK,kBAAkB;AACvB,SAAK,wBAAwB;AAC7B,SAAK,sBAAsB;AAC3B,SAAK,QAAQ;AAAA,EACd;AAAA,EAEQ,UAAU;AACjB,QAAI,KAAK,iBAAiB,GAAG;AAC5B,WAAK,OAAO;AAAA,IACb,OAAO;AACN,WAAK,sBAAsB;AAAA,IAC5B;AAAA,EACD;AAAA,EAEQ,SAAS;AAChB,SAAK,iBAAiB,KAAK,0BAA0B;AAErD,UAAM,QAAuC;AAAA,MAC5C,gBAAgB,KAAK;AAAA,MACrB,sBAAsB,KAAK;AAAA,MAC3B,oBAAoB,KAAK;AAAA,MACzB,mBAAmB,KAAK;AAAA,IACzB;AACA,SAAK,sBAAsB;AAC3B,SAAK,kBAAkB;AACvB,SAAK,wBAAwB;AAC7B,SAAK,sBAAsB;AAC3B,SAAK,QAAQ,KAAK,KAAK;AAAA,EACxB;AACD;AAIA,MAAM,gCAAgC,WAAW;AAAA,EA76EjD,OA66EiD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAK/B,eAAyD,KAAK,UAAU,IAAI,QAAyC,CAAC;AAAA,EACvH,YAAoD,KAAK,aAAa;AAAA,EACrE,eAAyD,KAAK,UAAU,IAAI,QAAyC,CAAC;AAAA,EACvH,YAAoD,KAAK,aAAa;AAAA,EAE9E;AAAA,EACA;AAAA,EAER,cAAc;AACb,UAAM;AACN,SAAK,eAAe;AACpB,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAEO,eAAwB;AAC9B,WACC,KAAK,aAAa,aAAa,KAC5B,KAAK,aAAa,aAAa;AAAA,EAEpC;AAAA,EAEO,oBAA0B;AAChC,SAAK;AAAA,EACN;AAAA,EAEO,gBAAgB,qBAAyC,MAAY;AAC3E,SAAK;AACL,QAAI,KAAK,iBAAiB,GAAG;AAC5B,UAAI,KAAK,mBAAmB,MAAM;AACjC,aAAK,eAAe,uBAAuB,qBAAqB;AAChE,cAAM,IAAI,KAAK;AACf,aAAK,iBAAiB;AACtB,aAAK,aAAa,KAAK,CAAC;AACxB,aAAK,aAAa,KAAK,CAAC;AAAA,MACzB;AAAA,IACD;AAAA,EACD;AAAA,EAEO,KAAK,GAA0C;AACrD,QAAI,KAAK,eAAe,GAAG;AAC1B,UAAI,KAAK,gBAAgB;AACxB,aAAK,iBAAiB,KAAK,eAAe,MAAM,CAAC;AAAA,MAClD,OAAO;AACN,aAAK,iBAAiB;AAAA,MACvB;AACA;AAAA,IACD;AACA,SAAK,aAAa,KAAK,CAAC;AACxB,SAAK,aAAa,KAAK,CAAC;AAAA,EACzB;AACD;",
  "names": ["StringOffsetValidationType", "injectedTextInEditedRangeQueue", "i"]
}
