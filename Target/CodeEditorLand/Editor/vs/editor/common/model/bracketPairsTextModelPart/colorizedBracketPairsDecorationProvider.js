import"../../../../base/common/color.js";import{Emitter as g}from"../../../../base/common/event.js";import{Disposable as d}from"../../../../base/common/lifecycle.js";import{Range as c}from"../../core/range.js";import"../../model.js";import"../../textModelBracketPairs.js";import"../decorationProvider.js";import"../textModel.js";import{editorBracketHighlightingForeground1 as p,editorBracketHighlightingForeground2 as m,editorBracketHighlightingForeground3 as h,editorBracketHighlightingForeground4 as u,editorBracketHighlightingForeground5 as C,editorBracketHighlightingForeground6 as f,editorBracketHighlightingUnexpectedBracketForeground as v}from"../../core/editorColorRegistry.js";import{registerThemingParticipant as k}from"../../../../platform/theme/common/themeService.js";import"../../textModelEvents.js";class w extends d{constructor(e){super();this.textModel=e;this.colorizationOptions=e.getOptions().bracketPairColorizationOptions,this._register(e.bracketPairs.onDidChange(r=>{this.onDidChangeEmitter.fire()}))}colorizationOptions;colorProvider=new s;onDidChangeEmitter=new g;onDidChange=this.onDidChangeEmitter.event;handleDidChangeOptions(e){this.colorizationOptions=this.textModel.getOptions().bracketPairColorizationOptions}getDecorationsInRange(e,r,a,o){return o?[]:r===void 0?[]:this.colorizationOptions.enabled?this.textModel.bracketPairs.getBracketsInRange(e,!0).map(n=>({id:`bracket${n.range.toString()}-${n.nestingLevel}`,options:{description:"BracketPairColorization",inlineClassName:this.colorProvider.getInlineClassName(n,this.colorizationOptions.independentColorPoolPerBracketType)},ownerId:0,range:n.range})).toArray():[]}getAllDecorations(e,r){return e===void 0?[]:this.colorizationOptions.enabled?this.getDecorationsInRange(new c(1,1,this.textModel.getLineCount(),1),e,r):[]}}class s{unexpectedClosingBracketClassName="unexpected-closing-bracket";getInlineClassName(i,e){return i.isInvalid?this.unexpectedClosingBracketClassName:this.getInlineClassNameOfLevel(e?i.nestingLevelOfEqualBracketType:i.nestingLevel)}getInlineClassNameOfLevel(i){return`bracket-highlighting-${i%30}`}}k((t,i)=>{const e=[p,m,h,u,C,f],r=new s;i.addRule(`.monaco-editor .${r.unexpectedClosingBracketClassName} { color: ${t.getColor(v)}; }`);const a=e.map(o=>t.getColor(o)).filter(o=>!!o).filter(o=>!o.isTransparent());for(let o=0;o<30;o++){const l=a[o%a.length];i.addRule(`.monaco-editor .${r.getInlineClassNameOfLevel(o)} { color: ${l}; }`)}});export{w as ColorizedBracketPairsDecorationProvider};
