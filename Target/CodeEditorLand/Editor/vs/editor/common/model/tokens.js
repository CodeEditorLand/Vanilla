import{equals as s}from"../../../../vs/base/common/arrays.js";import{RunOnceScheduler as d}from"../../../../vs/base/common/async.js";import{Emitter as o}from"../../../../vs/base/common/event.js";import{Disposable as r}from"../../../../vs/base/common/lifecycle.js";import{LineRange as l}from"../../../../vs/editor/common/core/lineRange.js";import"../../../../vs/editor/common/core/position.js";import"../../../../vs/editor/common/encodedTokenAttributes.js";import"../../../../vs/editor/common/languages.js";import"../../../../vs/editor/common/model.js";import"../../../../vs/editor/common/model/textModel.js";import"../../../../vs/editor/common/textModelEvents.js";import{BackgroundTokenizationState as c}from"../../../../vs/editor/common/tokenizationTextModelPart.js";import"../../../../vs/editor/common/tokens/lineTokens.js";class x{_onDidChangeVisibleRanges=new o;onDidChangeVisibleRanges=this._onDidChangeVisibleRanges.event;_views=new Set;attachView(){const n=new h(e=>{this._onDidChangeVisibleRanges.fire({view:n,state:e})});return this._views.add(n),n}detachView(n){this._views.delete(n),this._onDidChangeVisibleRanges.fire({view:n,state:void 0})}}class h{constructor(n){this.handleStateChange=n}setVisibleLines(n,e){const t=n.map(a=>new l(a.startLineNumber,a.endLineNumber+1));this.handleStateChange({visibleLineRanges:t,stabilized:e})}}class M extends r{constructor(e){super();this._refreshTokens=e}runner=this._register(new d(()=>this.update(),50));_computedLineRanges=[];_lineRanges=[];get lineRanges(){return this._lineRanges}update(){s(this._computedLineRanges,this._lineRanges,(e,t)=>e.equals(t))||(this._computedLineRanges=this._lineRanges,this._refreshTokens())}handleStateChange(e){this._lineRanges=e.visibleLineRanges,e.stabilized?(this.runner.cancel(),this.update()):this.runner.schedule()}}class N extends r{constructor(e,t,a){super();this._languageIdCodec=e;this._textModel=t;this.getLanguageId=a}_backgroundTokenizationState=c.InProgress;get backgroundTokenizationState(){return this._backgroundTokenizationState}_onDidChangeBackgroundTokenizationState=this._register(new o);onDidChangeBackgroundTokenizationState=this._onDidChangeBackgroundTokenizationState.event;_onDidChangeTokens=this._register(new o);onDidChangeTokens=this._onDidChangeTokens.event;tokenizeIfCheap(e){this.isCheapToTokenize(e)&&this.forceTokenization(e)}}export{N as AbstractTokens,M as AttachedViewHandler,x as AttachedViews};
