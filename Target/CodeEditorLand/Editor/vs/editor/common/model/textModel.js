var pe=Object.defineProperty;var _e=Object.getOwnPropertyDescriptor;var te=(h,n,e,t)=>{for(var i=t>1?void 0:t?_e(n,e):n,o=h.length-1,r;o>=0;o--)(r=h[o])&&(i=(t?r(n,e,i):r(i))||i);return t&&i&&pe(n,e,i),i},k=(h,n)=>(e,t)=>n(e,t,h);import{ArrayQueue as ne,pushMany as ie}from"../../../base/common/arrays.js";import"../../../base/common/buffer.js";import{Color as be}from"../../../base/common/color.js";import{BugIndicatingError as y,illegalArgument as ve,onUnexpectedError as oe}from"../../../base/common/errors.js";import{Emitter as R}from"../../../base/common/event.js";import"../../../base/common/htmlContent.js";import{Disposable as z,MutableDisposable as Ce,combinedDisposable as Ie}from"../../../base/common/lifecycle.js";import{listenStream as De}from"../../../base/common/stream.js";import*as L from"../../../base/common/strings.js";import"../../../base/common/themables.js";import{Constants as Le}from"../../../base/common/uint.js";import{URI as Te}from"../../../base/common/uri.js";import"../core/editOperation.js";import{countEOL as Ee}from"../core/eolCounter.js";import{normalizeIndentation as Ne}from"../core/indentation.js";import{Position as T}from"../core/position.js";import{Range as p}from"../core/range.js";import{Selection as re}from"../core/selection.js";import"../core/textChange.js";import{EDITOR_MODEL_DEFAULTS as O}from"../core/textModelDefaults.js";import"../core/wordHelper.js";import"../languages.js";import{ILanguageService as ye}from"../languages/language.js";import{ILanguageConfigurationService as Re}from"../languages/languageConfigurationRegistry.js";import*as m from"../model.js";import{BracketPairsTextModelPart as Se}from"./bracketPairsTextModelPart/bracketPairsImpl.js";import{ColorizedBracketPairsDecorationProvider as Me}from"./bracketPairsTextModelPart/colorizedBracketPairsDecorationProvider.js";import{EditStack as Oe}from"./editStack.js";import{GuidesTextModelPart as xe}from"./guidesTextModelPart.js";import{guessIndentation as se}from"./indentationGuesser.js";import{IntervalNode as Ae,IntervalTree as Y,recomputeMaxEnd as we}from"./intervalTree.js";import{PieceTreeTextBuffer as ke}from"./pieceTreeTextBuffer/pieceTreeTextBuffer.js";import{PieceTreeTextBufferBuilder as Q}from"./pieceTreeTextBuffer/pieceTreeTextBufferBuilder.js";import{SearchParams as x,TextModelSearch as V}from"./textModelSearch.js";import{TokenizationTextModelPart as Pe}from"./tokenizationTextModelPart.js";import{AttachedViews as Fe}from"./tokens.js";import"../textModelBracketPairs.js";import{InternalModelContentChangeEvent as Be,LineInjectedText as ae,ModelInjectedTextChangedEvent as ze,ModelRawContentChangedEvent as $,ModelRawEOLChanged as Ve,ModelRawFlush as je,ModelRawLineChanged as le,ModelRawLinesDeleted as He,ModelRawLinesInserted as We}from"../textModelEvents.js";import"../textModelGuides.js";import"../tokenizationTextModelPart.js";import{IInstantiationService as Ue}from"../../../platform/instantiation/common/instantiation.js";import"../../../platform/theme/common/themeService.js";import{IUndoRedoService as Ge}from"../../../platform/undoRedo/common/undoRedo.js";import"../tokens/tokenArray.js";function qe(h){const n=new Q;return n.acceptChunk(h),n.finish()}function vn(h){return new Promise((n,e)=>{const t=new Q;let i=!1;De(h,{onData:o=>{t.acceptChunk(typeof o=="string"?o:o.toString())},onError:o=>{i||(i=!0,e(o))},onEnd:()=>{i||(i=!0,n(t.finish()))}})})}function Ye(h){const n=new Q;let e;for(;typeof(e=h.read())=="string";)n.acceptChunk(e);return n.finish()}function de(h,n){let e;return typeof h=="string"?e=qe(h):m.isITextSnapshot(h)?e=Ye(h):e=h,e.create(n)}let j=0;const Qe=999,$e=1e4;class Je{_source;_eos;constructor(n){this._source=n,this._eos=!1}read(){if(this._eos)return null;const n=[];let e=0,t=0;do{const i=this._source.read();if(i===null)return this._eos=!0,e===0?null:n.join("");if(i.length>0&&(n[e++]=i,t+=i.length),t>=64*1024)return n.join("")}while(!0)}}const P=()=>{throw new Error("Invalid change accessor")};var Ze=(e=>(e[e.Relaxed=0]="Relaxed",e[e.SurrogatePairs=1]="SurrogatePairs",e))(Ze||{});let I=class extends z{constructor(e,t,i,o=null,r,s,a,d){super();this._undoRedoService=r;this._languageService=s;this._languageConfigurationService=a;this.instantiationService=d;j++,this.id="$model"+j,this.isForSimpleWidget=i.isForSimpleWidget,typeof o>"u"||o===null?this._associatedResource=Te.parse("inmemory://model/"+j):this._associatedResource=o,this._attachedEditorCount=0;const{textBuffer:c,disposable:f}=de(e,i.defaultEOL);this._buffer=c,this._bufferDisposable=f,this._options=I.resolveOptions(this._buffer,i);const l=typeof t=="string"?t:t.languageId;typeof t!="string"&&(this._languageSelectionListener.value=t.onDidChange(()=>this._setLanguage(t.languageId))),this._bracketPairs=this._register(new Se(this,this._languageConfigurationService)),this._guidesTextModelPart=this._register(new xe(this,this._languageConfigurationService)),this._decorationProvider=this._register(new Me(this)),this._tokenizationTextModelPart=this.instantiationService.createInstance(Pe,this,this._bracketPairs,l,this._attachedViews);const u=this._buffer.getLineCount(),g=this._buffer.getValueLengthInRange(new p(1,1,u,this._buffer.getLineLength(u)+1),m.EndOfLinePreference.TextDefined);i.largeFileOptimizations?(this._isTooLargeForTokenization=g>I.LARGE_FILE_SIZE_THRESHOLD||u>I.LARGE_FILE_LINE_COUNT_THRESHOLD,this._isTooLargeForHeapOperation=g>I.LARGE_FILE_HEAP_OPERATION_THRESHOLD):(this._isTooLargeForTokenization=!1,this._isTooLargeForHeapOperation=!1),this._isTooLargeForSyncing=g>I._MODEL_SYNC_LIMIT,this._versionId=1,this._alternativeVersionId=1,this._initialUndoRedoSnapshot=null,this._isDisposed=!1,this.__isDisposing=!1,this._instanceId=L.singleLetterHash(j),this._lastDecorationId=0,this._decorations=Object.create(null),this._decorationsTree=new ce,this._commandManager=new Oe(this,this._undoRedoService),this._isUndoing=!1,this._isRedoing=!1,this._trimAutoWhitespaceLines=null,this._register(this._decorationProvider.onDidChange(()=>{this._onDidChangeDecorations.beginDeferredEmit(),this._onDidChangeDecorations.fire(),this._onDidChangeDecorations.endDeferredEmit()})),this._languageService.requestRichLanguageFeatures(l),this._register(this._languageConfigurationService.onDidChange(_=>{this._bracketPairs.handleLanguageConfigurationServiceChange(_),this._tokenizationTextModelPart.handleLanguageConfigurationServiceChange(_)}))}static _MODEL_SYNC_LIMIT=50*1024*1024;static LARGE_FILE_SIZE_THRESHOLD=20*1024*1024;static LARGE_FILE_LINE_COUNT_THRESHOLD=300*1e3;static LARGE_FILE_HEAP_OPERATION_THRESHOLD=256*1024*1024;static DEFAULT_CREATION_OPTIONS={isForSimpleWidget:!1,tabSize:O.tabSize,indentSize:O.indentSize,insertSpaces:O.insertSpaces,detectIndentation:!1,defaultEOL:m.DefaultEndOfLine.LF,trimAutoWhitespace:O.trimAutoWhitespace,largeFileOptimizations:O.largeFileOptimizations,bracketPairColorizationOptions:O.bracketPairColorizationOptions};static resolveOptions(e,t){if(t.detectIndentation){const i=se(e,t.tabSize,t.insertSpaces);return new m.TextModelResolvedOptions({tabSize:i.tabSize,indentSize:"tabSize",insertSpaces:i.insertSpaces,trimAutoWhitespace:t.trimAutoWhitespace,defaultEOL:t.defaultEOL,bracketPairColorizationOptions:t.bracketPairColorizationOptions})}return new m.TextModelResolvedOptions(t)}_onWillDispose=this._register(new R);onWillDispose=this._onWillDispose.event;_onDidChangeDecorations=this._register(new it(e=>this.handleBeforeFireDecorationsChangedEvent(e)));onDidChangeDecorations=this._onDidChangeDecorations.event;get onDidChangeLanguage(){return this._tokenizationTextModelPart.onDidChangeLanguage}get onDidChangeLanguageConfiguration(){return this._tokenizationTextModelPart.onDidChangeLanguageConfiguration}get onDidChangeTokens(){return this._tokenizationTextModelPart.onDidChangeTokens}_onDidChangeOptions=this._register(new R);onDidChangeOptions=this._onDidChangeOptions.event;_onDidChangeAttached=this._register(new R);onDidChangeAttached=this._onDidChangeAttached.event;_onDidChangeInjectedText=this._register(new R);_eventEmitter=this._register(new ot);onDidChangeContent(e){return this._eventEmitter.slowEvent(t=>e(t.contentChangedEvent))}onDidChangeContentOrInjectedText(e){return Ie(this._eventEmitter.fastEvent(t=>e(t)),this._onDidChangeInjectedText.event(t=>e(t)))}id;isForSimpleWidget;_associatedResource;_attachedEditorCount;_buffer;_bufferDisposable;_options;_languageSelectionListener=this._register(new Ce);_isDisposed;__isDisposing;_isDisposing(){return this.__isDisposing}_versionId;_alternativeVersionId;_initialUndoRedoSnapshot;_isTooLargeForSyncing;_isTooLargeForTokenization;_isTooLargeForHeapOperation;_commandManager;_isUndoing;_isRedoing;_trimAutoWhitespaceLines;_instanceId;_deltaDecorationCallCnt=0;_lastDecorationId;_decorations;_decorationsTree;_decorationProvider;_tokenizationTextModelPart;get tokenization(){return this._tokenizationTextModelPart}_bracketPairs;get bracketPairs(){return this._bracketPairs}_guidesTextModelPart;get guides(){return this._guidesTextModelPart}_attachedViews=new Fe;dispose(){this.__isDisposing=!0,this._onWillDispose.fire(),this._tokenizationTextModelPart.dispose(),this._isDisposed=!0,super.dispose(),this._bufferDisposable.dispose(),this.__isDisposing=!1;const e=new ke([],"",`
`,!1,!1,!0,!0);e.dispose(),this._buffer=e,this._bufferDisposable=z.None}_hasListeners(){return this._onWillDispose.hasListeners()||this._onDidChangeDecorations.hasListeners()||this._tokenizationTextModelPart._hasListeners()||this._onDidChangeOptions.hasListeners()||this._onDidChangeAttached.hasListeners()||this._onDidChangeInjectedText.hasListeners()||this._eventEmitter.hasListeners()}_assertNotDisposed(){if(this._isDisposed)throw new y("Model is disposed!")}equalsTextBuffer(e){return this._assertNotDisposed(),this._buffer.equals(e)}getTextBuffer(){return this._assertNotDisposed(),this._buffer}_emitContentChangedEvent(e,t){this.__isDisposing||(this._tokenizationTextModelPart.handleDidChangeContent(t),this._bracketPairs.handleDidChangeContent(t),this._eventEmitter.fire(new Be(e,t)))}setValue(e){if(this._assertNotDisposed(),e==null)throw ve();const{textBuffer:t,disposable:i}=de(e,this._options.defaultEOL);this._setValueFromTextBuffer(t,i)}_createContentChanged2(e,t,i,o,r,s,a,d){return{changes:[{range:e,rangeOffset:t,rangeLength:i,text:o}],eol:this._buffer.getEOL(),isEolChange:d,versionId:this.getVersionId(),isUndoing:r,isRedoing:s,isFlush:a}}_setValueFromTextBuffer(e,t){this._assertNotDisposed();const i=this.getFullModelRange(),o=this.getValueLengthInRange(i),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._buffer=e,this._bufferDisposable.dispose(),this._bufferDisposable=t,this._increaseVersionId(),this._decorations=Object.create(null),this._decorationsTree=new ce,this._commandManager.clear(),this._trimAutoWhitespaceLines=null,this._emitContentChangedEvent(new $([new je],this._versionId,!1,!1),this._createContentChanged2(new p(1,1,r,s),0,o,this.getValue(),!1,!1,!0,!1))}setEOL(e){this._assertNotDisposed();const t=e===m.EndOfLineSequence.CRLF?`\r
`:`
`;if(this._buffer.getEOL()===t)return;const i=this.getFullModelRange(),o=this.getValueLengthInRange(i),r=this.getLineCount(),s=this.getLineMaxColumn(r);this._onBeforeEOLChange(),this._buffer.setEOL(t),this._increaseVersionId(),this._onAfterEOLChange(),this._emitContentChangedEvent(new $([new Ve],this._versionId,!1,!1),this._createContentChanged2(new p(1,1,r,s),0,o,this.getValue(),!1,!1,!1,!0))}_onBeforeEOLChange(){this._decorationsTree.ensureAllNodesHaveRanges(this)}_onAfterEOLChange(){const e=this.getVersionId(),t=this._decorationsTree.collectNodesPostOrder();for(let i=0,o=t.length;i<o;i++){const r=t[i],s=r.range,a=r.cachedAbsoluteStart-r.start,d=this._buffer.getOffsetAt(s.startLineNumber,s.startColumn),c=this._buffer.getOffsetAt(s.endLineNumber,s.endColumn);r.cachedAbsoluteStart=d,r.cachedAbsoluteEnd=c,r.cachedVersionId=e,r.start=d-a,r.end=c-a,we(r)}}onBeforeAttached(){return this._attachedEditorCount++,this._attachedEditorCount===1&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.attachView()}onBeforeDetached(e){this._attachedEditorCount--,this._attachedEditorCount===0&&(this._tokenizationTextModelPart.handleDidChangeAttached(),this._onDidChangeAttached.fire(void 0)),this._attachedViews.detachView(e)}isAttachedToEditor(){return this._attachedEditorCount>0}getAttachedEditorCount(){return this._attachedEditorCount}isTooLargeForSyncing(){return this._isTooLargeForSyncing}isTooLargeForTokenization(){return this._isTooLargeForTokenization}isTooLargeForHeapOperation(){return this._isTooLargeForHeapOperation}isDisposed(){return this._isDisposed}isDominatedByLongLines(){if(this._assertNotDisposed(),this.isTooLargeForTokenization())return!1;let e=0,t=0;const i=this._buffer.getLineCount();for(let o=1;o<=i;o++){const r=this._buffer.getLineLength(o);r>=$e?t+=r:e+=r}return t>e}get uri(){return this._associatedResource}getOptions(){return this._assertNotDisposed(),this._options}getFormattingOptions(){return{tabSize:this._options.indentSize,insertSpaces:this._options.insertSpaces}}updateOptions(e){this._assertNotDisposed();const t=typeof e.tabSize<"u"?e.tabSize:this._options.tabSize,i=typeof e.indentSize<"u"?e.indentSize:this._options.originalIndentSize,o=typeof e.insertSpaces<"u"?e.insertSpaces:this._options.insertSpaces,r=typeof e.trimAutoWhitespace<"u"?e.trimAutoWhitespace:this._options.trimAutoWhitespace,s=typeof e.bracketColorizationOptions<"u"?e.bracketColorizationOptions:this._options.bracketPairColorizationOptions,a=new m.TextModelResolvedOptions({tabSize:t,indentSize:i,insertSpaces:o,defaultEOL:this._options.defaultEOL,trimAutoWhitespace:r,bracketPairColorizationOptions:s});if(this._options.equals(a))return;const d=this._options.createChangeEvent(a);this._options=a,this._bracketPairs.handleDidChangeOptions(d),this._decorationProvider.handleDidChangeOptions(d),this._onDidChangeOptions.fire(d)}detectIndentation(e,t){this._assertNotDisposed();const i=se(this._buffer,t,e);this.updateOptions({insertSpaces:i.insertSpaces,tabSize:i.tabSize,indentSize:i.tabSize})}normalizeIndentation(e){return this._assertNotDisposed(),Ne(e,this._options.indentSize,this._options.insertSpaces)}getVersionId(){return this._assertNotDisposed(),this._versionId}mightContainRTL(){return this._buffer.mightContainRTL()}mightContainUnusualLineTerminators(){return this._buffer.mightContainUnusualLineTerminators()}removeUnusualLineTerminators(e=null){const t=this.findMatches(L.UNUSUAL_LINE_TERMINATORS.source,!1,!0,!1,null,!1,Le.MAX_SAFE_SMALL_INTEGER);this._buffer.resetMightContainUnusualLineTerminators(),this.pushEditOperations(e,t.map(i=>({range:i.range,text:null})),()=>null)}mightContainNonBasicASCII(){return this._buffer.mightContainNonBasicASCII()}getAlternativeVersionId(){return this._assertNotDisposed(),this._alternativeVersionId}getInitialUndoRedoSnapshot(){return this._assertNotDisposed(),this._initialUndoRedoSnapshot}getOffsetAt(e){this._assertNotDisposed();const t=this._validatePosition(e.lineNumber,e.column,0);return this._buffer.getOffsetAt(t.lineNumber,t.column)}getPositionAt(e){this._assertNotDisposed();const t=Math.min(this._buffer.getLength(),Math.max(0,e));return this._buffer.getPositionAt(t)}_increaseVersionId(){this._versionId=this._versionId+1,this._alternativeVersionId=this._versionId}_overwriteVersionId(e){this._versionId=e}_overwriteAlternativeVersionId(e){this._alternativeVersionId=e}_overwriteInitialUndoRedoSnapshot(e){this._initialUndoRedoSnapshot=e}getValue(e,t=!1){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new y("Operation would exceed heap memory limits");const i=this.getFullModelRange(),o=this.getValueInRange(i,e);return t?this._buffer.getBOM()+o:o}createSnapshot(e=!1){return new Je(this._buffer.createSnapshot(e))}getValueLength(e,t=!1){this._assertNotDisposed();const i=this.getFullModelRange(),o=this.getValueLengthInRange(i,e);return t?this._buffer.getBOM().length+o:o}getValueInRange(e,t=m.EndOfLinePreference.TextDefined){return this._assertNotDisposed(),this._buffer.getValueInRange(this.validateRange(e),t)}getValueLengthInRange(e,t=m.EndOfLinePreference.TextDefined){return this._assertNotDisposed(),this._buffer.getValueLengthInRange(this.validateRange(e),t)}getCharacterCountInRange(e,t=m.EndOfLinePreference.TextDefined){return this._assertNotDisposed(),this._buffer.getCharacterCountInRange(this.validateRange(e),t)}getLineCount(){return this._assertNotDisposed(),this._buffer.getLineCount()}getLineContent(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new y("Illegal value for lineNumber");return this._buffer.getLineContent(e)}getLineLength(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new y("Illegal value for lineNumber");return this._buffer.getLineLength(e)}getLinesContent(){if(this._assertNotDisposed(),this.isTooLargeForHeapOperation())throw new y("Operation would exceed heap memory limits");return this._buffer.getLinesContent()}getEOL(){return this._assertNotDisposed(),this._buffer.getEOL()}getEndOfLineSequence(){return this._assertNotDisposed(),this._buffer.getEOL()===`
`?m.EndOfLineSequence.LF:m.EndOfLineSequence.CRLF}getLineMinColumn(e){return this._assertNotDisposed(),1}getLineMaxColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new y("Illegal value for lineNumber");return this._buffer.getLineLength(e)+1}getLineFirstNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new y("Illegal value for lineNumber");return this._buffer.getLineFirstNonWhitespaceColumn(e)}getLineLastNonWhitespaceColumn(e){if(this._assertNotDisposed(),e<1||e>this.getLineCount())throw new y("Illegal value for lineNumber");return this._buffer.getLineLastNonWhitespaceColumn(e)}_validateRangeRelaxedNoAllocations(e){const t=this._buffer.getLineCount(),i=e.startLineNumber,o=e.startColumn;let r=Math.floor(typeof i=="number"&&!isNaN(i)?i:1),s=Math.floor(typeof o=="number"&&!isNaN(o)?o:1);if(r<1)r=1,s=1;else if(r>t)r=t,s=this.getLineMaxColumn(r);else if(s<=1)s=1;else{const l=this.getLineMaxColumn(r);s>=l&&(s=l)}const a=e.endLineNumber,d=e.endColumn;let c=Math.floor(typeof a=="number"&&!isNaN(a)?a:1),f=Math.floor(typeof d=="number"&&!isNaN(d)?d:1);if(c<1)c=1,f=1;else if(c>t)c=t,f=this.getLineMaxColumn(c);else if(f<=1)f=1;else{const l=this.getLineMaxColumn(c);f>=l&&(f=l)}return i===r&&o===s&&a===c&&d===f&&e instanceof p&&!(e instanceof re)?e:new p(r,s,c,f)}_isValidPosition(e,t,i){if(typeof e!="number"||typeof t!="number"||isNaN(e)||isNaN(t)||e<1||t<1||(e|0)!==e||(t|0)!==t)return!1;const o=this._buffer.getLineCount();if(e>o)return!1;if(t===1)return!0;const r=this.getLineMaxColumn(e);if(t>r)return!1;if(i===1){const s=this._buffer.getLineCharCode(e,t-2);if(L.isHighSurrogate(s))return!1}return!0}_validatePosition(e,t,i){const o=Math.floor(typeof e=="number"&&!isNaN(e)?e:1),r=Math.floor(typeof t=="number"&&!isNaN(t)?t:1),s=this._buffer.getLineCount();if(o<1)return new T(1,1);if(o>s)return new T(s,this.getLineMaxColumn(s));if(r<=1)return new T(o,1);const a=this.getLineMaxColumn(o);if(r>=a)return new T(o,a);if(i===1){const d=this._buffer.getLineCharCode(o,r-2);if(L.isHighSurrogate(d))return new T(o,r-1)}return new T(o,r)}validatePosition(e){const t=1;return this._assertNotDisposed(),e instanceof T&&this._isValidPosition(e.lineNumber,e.column,t)?e:this._validatePosition(e.lineNumber,e.column,t)}_isValidRange(e,t){const i=e.startLineNumber,o=e.startColumn,r=e.endLineNumber,s=e.endColumn;if(!this._isValidPosition(i,o,0)||!this._isValidPosition(r,s,0))return!1;if(t===1){const a=o>1?this._buffer.getLineCharCode(i,o-2):0,d=s>1&&s<=this._buffer.getLineLength(r)?this._buffer.getLineCharCode(r,s-2):0,c=L.isHighSurrogate(a),f=L.isHighSurrogate(d);return!c&&!f}return!0}validateRange(e){const t=1;if(this._assertNotDisposed(),e instanceof p&&!(e instanceof re)&&this._isValidRange(e,t))return e;const i=this._validatePosition(e.startLineNumber,e.startColumn,0),o=this._validatePosition(e.endLineNumber,e.endColumn,0),r=i.lineNumber,s=i.column,a=o.lineNumber,d=o.column;if(t===1){const c=s>1?this._buffer.getLineCharCode(r,s-2):0,f=d>1&&d<=this._buffer.getLineLength(a)?this._buffer.getLineCharCode(a,d-2):0,l=L.isHighSurrogate(c),u=L.isHighSurrogate(f);return!l&&!u?new p(r,s,a,d):r===a&&s===d?new p(r,s-1,a,d-1):l&&u?new p(r,s-1,a,d+1):l?new p(r,s-1,a,d):new p(r,s,a,d+1)}return new p(r,s,a,d)}modifyPosition(e,t){this._assertNotDisposed();const i=this.getOffsetAt(e)+t;return this.getPositionAt(Math.min(this._buffer.getLength(),Math.max(0,i)))}getFullModelRange(){this._assertNotDisposed();const e=this.getLineCount();return new p(1,1,e,this.getLineMaxColumn(e))}findMatchesLineByLine(e,t,i,o){return this._buffer.findMatchesLineByLine(e,t,i,o)}findMatches(e,t,i,o,r,s,a=Qe){this._assertNotDisposed();let d=null;t!==null&&(Array.isArray(t)||(t=[t]),t.every(l=>p.isIRange(l))&&(d=t.map(l=>this.validateRange(l)))),d===null&&(d=[this.getFullModelRange()]),d=d.sort((l,u)=>l.startLineNumber-u.startLineNumber||l.startColumn-u.startColumn);const c=[];c.push(d.reduce((l,u)=>p.areIntersecting(l,u)?l.plusRange(u):(c.push(l),u)));let f;if(!i&&e.indexOf(`
`)<0){const u=new x(e,i,o,r).parseSearchRequest();if(!u)return[];f=g=>this.findMatchesLineByLine(g,u,s,a)}else f=l=>V.findMatches(this,new x(e,i,o,r),l,s,a);return c.map(f).reduce((l,u)=>l.concat(u),[])}findNextMatch(e,t,i,o,r,s){this._assertNotDisposed();const a=this.validatePosition(t);if(!i&&e.indexOf(`
`)<0){const c=new x(e,i,o,r).parseSearchRequest();if(!c)return null;const f=this.getLineCount();let l=new p(a.lineNumber,a.column,f,this.getLineMaxColumn(f)),u=this.findMatchesLineByLine(l,c,s,1);return V.findNextMatch(this,new x(e,i,o,r),a,s),u.length>0||(l=new p(1,1,a.lineNumber,this.getLineMaxColumn(a.lineNumber)),u=this.findMatchesLineByLine(l,c,s,1),u.length>0)?u[0]:null}return V.findNextMatch(this,new x(e,i,o,r),a,s)}findPreviousMatch(e,t,i,o,r,s){this._assertNotDisposed();const a=this.validatePosition(t);return V.findPreviousMatch(this,new x(e,i,o,r),a,s)}pushStackElement(){this._commandManager.pushStackElement()}popStackElement(){this._commandManager.popStackElement()}pushEOL(e){if((this.getEOL()===`
`?m.EndOfLineSequence.LF:m.EndOfLineSequence.CRLF)!==e)try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEOL(e)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_validateEditOperation(e){return e instanceof m.ValidAnnotatedEditOperation?e:new m.ValidAnnotatedEditOperation(e.identifier||null,this.validateRange(e.range),e.text,e.forceMoveMarkers||!1,e.isAutoWhitespaceEdit||!1,e._isTracked||!1)}_validateEditOperations(e){const t=[];for(let i=0,o=e.length;i<o;i++)t[i]=this._validateEditOperation(e[i]);return t}pushEditOperations(e,t,i,o){try{return this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._pushEditOperations(e,this._validateEditOperations(t),i,o)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_pushEditOperations(e,t,i,o){if(this._options.trimAutoWhitespace&&this._trimAutoWhitespaceLines){const r=t.map(a=>({range:this.validateRange(a.range),text:a.text}));let s=!0;if(e)for(let a=0,d=e.length;a<d;a++){const c=e[a];let f=!1;for(let l=0,u=r.length;l<u;l++){const g=r[l].range,_=g.startLineNumber>c.endLineNumber,b=c.startLineNumber>g.endLineNumber;if(!_&&!b){f=!0;break}}if(!f){s=!1;break}}if(s)for(let a=0,d=this._trimAutoWhitespaceLines.length;a<d;a++){const c=this._trimAutoWhitespaceLines[a],f=this.getLineMaxColumn(c);let l=!0;for(let u=0,g=r.length;u<g;u++){const _=r[u].range,b=r[u].text;if(!(c<_.startLineNumber||c>_.endLineNumber)&&!(c===_.startLineNumber&&_.startColumn===f&&_.isEmpty()&&b&&b.length>0&&b.charAt(0)===`
`)&&!(c===_.startLineNumber&&_.startColumn===1&&_.isEmpty()&&b&&b.length>0&&b.charAt(b.length-1)===`
`)){l=!1;break}}if(l){const u=new p(c,1,c,f);t.push(new m.ValidAnnotatedEditOperation(null,u,null,!1,!1,!1))}}this._trimAutoWhitespaceLines=null}return this._initialUndoRedoSnapshot===null&&(this._initialUndoRedoSnapshot=this._undoRedoService.createSnapshot(this.uri)),this._commandManager.pushEditOperation(e,t,i,o)}_applyUndo(e,t,i,o){const r=e.map(s=>{const a=this.getPositionAt(s.newPosition),d=this.getPositionAt(s.newEnd);return{range:new p(a.lineNumber,a.column,d.lineNumber,d.column),text:s.oldText}});this._applyUndoRedoEdits(r,t,!0,!1,i,o)}_applyRedo(e,t,i,o){const r=e.map(s=>{const a=this.getPositionAt(s.oldPosition),d=this.getPositionAt(s.oldEnd);return{range:new p(a.lineNumber,a.column,d.lineNumber,d.column),text:s.newText}});this._applyUndoRedoEdits(r,t,!1,!0,i,o)}_applyUndoRedoEdits(e,t,i,o,r,s){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit(),this._isUndoing=i,this._isRedoing=o,this.applyEdits(e,!1),this.setEOL(t),this._overwriteAlternativeVersionId(r)}finally{this._isUndoing=!1,this._isRedoing=!1,this._eventEmitter.endDeferredEmit(s),this._onDidChangeDecorations.endDeferredEmit()}}applyEdits(e,t=!1){try{this._onDidChangeDecorations.beginDeferredEmit(),this._eventEmitter.beginDeferredEmit();const i=this._validateEditOperations(e);return this._doApplyEdits(i,t)}finally{this._eventEmitter.endDeferredEmit(),this._onDidChangeDecorations.endDeferredEmit()}}_doApplyEdits(e,t){const i=this._buffer.getLineCount(),o=this._buffer.applyEdits(e,this._options.trimAutoWhitespace,t),r=this._buffer.getLineCount(),s=o.changes;if(this._trimAutoWhitespaceLines=o.trimAutoWhitespaceLineNumbers,s.length!==0){for(let c=0,f=s.length;c<f;c++){const l=s[c];this._decorationsTree.acceptReplace(l.rangeOffset,l.rangeLength,l.text.length,l.forceMoveMarkers)}const a=[];this._increaseVersionId();let d=i;for(let c=0,f=s.length;c<f;c++){const l=s[c],[u]=Ee(l.text);this._onDidChangeDecorations.fire();const g=l.range.startLineNumber,_=l.range.endLineNumber,b=_-g,E=u,N=Math.min(b,E),A=E-b,W=r-d-A+g,ge=W,Z=W+E,me=this._decorationsTree.getInjectedTextInInterval(this,this.getOffsetAt(new T(ge,1)),this.getOffsetAt(new T(Z,this.getLineMaxColumn(Z))),0),K=ae.fromDecorations(me),X=new ne(K);for(let D=N;D>=0;D--){const B=g+D,S=W+D;X.takeFromEndWhile(M=>M.lineNumber>S);const U=X.takeFromEndWhile(M=>M.lineNumber===S);a.push(new le(B,this.getLineContent(S),U))}if(N<b){const D=g+N;a.push(new He(D+1,_))}if(N<E){const D=new ne(K),B=g+N,S=E-N,U=r-d-S+B+1,M=[],ee=[];for(let w=0;w<S;w++){const G=U+w;ee[w]=this.getLineContent(G),D.takeWhile(q=>q.lineNumber<G),M[w]=D.takeWhile(q=>q.lineNumber===G)}a.push(new We(B+1,g+E,ee,M))}d+=A}this._emitContentChangedEvent(new $(a,this.getVersionId(),this._isUndoing,this._isRedoing),{changes:s,eol:this._buffer.getEOL(),isEolChange:!1,versionId:this.getVersionId(),isUndoing:this._isUndoing,isRedoing:this._isRedoing,isFlush:!1})}return o.reverseEdits===null?void 0:o.reverseEdits}undo(){return this._undoRedoService.undo(this.uri)}canUndo(){return this._undoRedoService.canUndo(this.uri)}redo(){return this._undoRedoService.redo(this.uri)}canRedo(){return this._undoRedoService.canRedo(this.uri)}handleBeforeFireDecorationsChangedEvent(e){if(e===null||e.size===0)return;const i=Array.from(e).map(o=>new le(o,this.getLineContent(o),this._getInjectedTextInLine(o)));this._onDidChangeInjectedText.fire(new ze(i))}changeDecorations(e,t=0){this._assertNotDisposed();try{return this._onDidChangeDecorations.beginDeferredEmit(),this._changeDecorations(t,e)}finally{this._onDidChangeDecorations.endDeferredEmit()}}_changeDecorations(e,t){const i={addDecoration:(r,s)=>this._deltaDecorationsImpl(e,[],[{range:r,options:s}])[0],changeDecoration:(r,s)=>{this._changeDecorationImpl(r,s)},changeDecorationOptions:(r,s)=>{this._changeDecorationOptionsImpl(r,fe(s))},removeDecoration:r=>{this._deltaDecorationsImpl(e,[r],[])},deltaDecorations:(r,s)=>r.length===0&&s.length===0?[]:this._deltaDecorationsImpl(e,r,s)};let o=null;try{o=t(i)}catch(r){oe(r)}return i.addDecoration=P,i.changeDecoration=P,i.changeDecorationOptions=P,i.removeDecoration=P,i.deltaDecorations=P,o}deltaDecorations(e,t,i=0){if(this._assertNotDisposed(),e||(e=[]),e.length===0&&t.length===0)return[];try{return this._deltaDecorationCallCnt++,this._deltaDecorationCallCnt>1&&(console.warn("Invoking deltaDecorations recursively could lead to leaking decorations."),oe(new Error("Invoking deltaDecorations recursively could lead to leaking decorations."))),this._onDidChangeDecorations.beginDeferredEmit(),this._deltaDecorationsImpl(i,e,t)}finally{this._onDidChangeDecorations.endDeferredEmit(),this._deltaDecorationCallCnt--}}_getTrackedRange(e){return this.getDecorationRange(e)}_setTrackedRange(e,t,i){const o=e?this._decorations[e]:null;if(!o)return t?this._deltaDecorationsImpl(0,[],[{range:t,options:he[i]}],!0)[0]:null;if(!t)return this._decorationsTree.delete(o),delete this._decorations[o.id],null;const r=this._validateRangeRelaxedNoAllocations(t),s=this._buffer.getOffsetAt(r.startLineNumber,r.startColumn),a=this._buffer.getOffsetAt(r.endLineNumber,r.endColumn);return this._decorationsTree.delete(o),o.reset(this.getVersionId(),s,a,r),o.setOptions(he[i]),this._decorationsTree.insert(o),o.id}removeAllDecorationsWithOwnerId(e){if(this._isDisposed)return;const t=this._decorationsTree.collectNodesFromOwner(e);for(let i=0,o=t.length;i<o;i++){const r=t[i];this._decorationsTree.delete(r),delete this._decorations[r.id]}}getDecorationOptions(e){const t=this._decorations[e];return t?t.options:null}getDecorationRange(e){const t=this._decorations[e];return t?this._decorationsTree.getNodeRange(this,t):null}getLineDecorations(e,t=0,i=!1){return e<1||e>this.getLineCount()?[]:this.getLinesDecorations(e,e,t,i)}getLinesDecorations(e,t,i=0,o=!1,r=!1){const s=this.getLineCount(),a=Math.min(s,Math.max(1,e)),d=Math.min(s,Math.max(1,t)),c=this.getLineMaxColumn(d),f=new p(a,1,d,c),l=this._getDecorationsInRange(f,i,o,r);return ie(l,this._decorationProvider.getDecorationsInRange(f,i,o)),l}getDecorationsInRange(e,t=0,i=!1,o=!1,r=!1){const s=this.validateRange(e),a=this._getDecorationsInRange(s,t,i,r);return ie(a,this._decorationProvider.getDecorationsInRange(s,t,i,o)),a}getOverviewRulerDecorations(e=0,t=!1){return this._decorationsTree.getAll(this,e,t,!0,!1)}getInjectedTextDecorations(e=0){return this._decorationsTree.getAllInjectedText(this,e)}_getInjectedTextInLine(e){const t=this._buffer.getOffsetAt(e,1),i=t+this._buffer.getLineLength(e),o=this._decorationsTree.getInjectedTextInInterval(this,t,i,0);return ae.fromDecorations(o).filter(r=>r.lineNumber===e)}getAllDecorations(e=0,t=!1){let i=this._decorationsTree.getAll(this,e,t,!1,!1);return i=i.concat(this._decorationProvider.getAllDecorations(e,t)),i}getAllMarginDecorations(e=0){return this._decorationsTree.getAll(this,e,!1,!1,!0)}_getDecorationsInRange(e,t,i,o){const r=this._buffer.getOffsetAt(e.startLineNumber,e.startColumn),s=this._buffer.getOffsetAt(e.endLineNumber,e.endColumn);return this._decorationsTree.getAllInInterval(this,r,s,t,i,o)}getRangeAt(e,t){return this._buffer.getRangeAt(e,t-e)}_changeDecorationImpl(e,t){const i=this._decorations[e];if(!i)return;if(i.options.after){const a=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.endLineNumber)}if(i.options.before){const a=this.getDecorationRange(e);this._onDidChangeDecorations.recordLineAffectedByInjectedText(a.startLineNumber)}const o=this._validateRangeRelaxedNoAllocations(t),r=this._buffer.getOffsetAt(o.startLineNumber,o.startColumn),s=this._buffer.getOffsetAt(o.endLineNumber,o.endColumn);this._decorationsTree.delete(i),i.reset(this.getVersionId(),r,s,o),this._decorationsTree.insert(i),this._onDidChangeDecorations.checkAffectedAndFire(i.options),i.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.endLineNumber),i.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(o.startLineNumber)}_changeDecorationOptionsImpl(e,t){const i=this._decorations[e];if(!i)return;const o=!!(i.options.overviewRuler&&i.options.overviewRuler.color),r=!!(t.overviewRuler&&t.overviewRuler.color);if(this._onDidChangeDecorations.checkAffectedAndFire(i.options),this._onDidChangeDecorations.checkAffectedAndFire(t),i.options.after||t.after){const d=this._decorationsTree.getNodeRange(this,i);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.endLineNumber)}if(i.options.before||t.before){const d=this._decorationsTree.getNodeRange(this,i);this._onDidChangeDecorations.recordLineAffectedByInjectedText(d.startLineNumber)}const s=o!==r,a=Xe(t)!==H(i);s||a?(this._decorationsTree.delete(i),i.setOptions(t),this._decorationsTree.insert(i)):i.setOptions(t)}_deltaDecorationsImpl(e,t,i,o=!1){const r=this.getVersionId(),s=t.length;let a=0;const d=i.length;let c=0;this._onDidChangeDecorations.beginDeferredEmit();try{const f=new Array(d);for(;a<s||c<d;){let l=null;if(a<s){do l=this._decorations[t[a++]];while(!l&&a<s);if(l){if(l.options.after){const u=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.endLineNumber)}if(l.options.before){const u=this._decorationsTree.getNodeRange(this,l);this._onDidChangeDecorations.recordLineAffectedByInjectedText(u.startLineNumber)}this._decorationsTree.delete(l),o||this._onDidChangeDecorations.checkAffectedAndFire(l.options)}}if(c<d){if(!l){const N=++this._lastDecorationId,A=`${this._instanceId};${N}`;l=new Ae(A,0,0),this._decorations[A]=l}const u=i[c],g=this._validateRangeRelaxedNoAllocations(u.range),_=fe(u.options),b=this._buffer.getOffsetAt(g.startLineNumber,g.startColumn),E=this._buffer.getOffsetAt(g.endLineNumber,g.endColumn);l.ownerId=e,l.reset(r,b,E,g),l.setOptions(_),l.options.after&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(g.endLineNumber),l.options.before&&this._onDidChangeDecorations.recordLineAffectedByInjectedText(g.startLineNumber),o||this._onDidChangeDecorations.checkAffectedAndFire(_),this._decorationsTree.insert(l),f[c]=l.id,c++}else l&&delete this._decorations[l.id]}return f}finally{this._onDidChangeDecorations.endDeferredEmit()}}getLanguageId(){return this.tokenization.getLanguageId()}setLanguage(e,t){typeof e=="string"?(this._languageSelectionListener.clear(),this._setLanguage(e,t)):(this._languageSelectionListener.value=e.onDidChange(()=>this._setLanguage(e.languageId,t)),this._setLanguage(e.languageId,t))}_setLanguage(e,t){this.tokenization.setLanguageId(e,t),this._languageService.requestRichLanguageFeatures(e)}getLanguageIdAtPosition(e,t){return this.tokenization.getLanguageIdAtPosition(e,t)}getWordAtPosition(e){return this._tokenizationTextModelPart.getWordAtPosition(e)}getWordUntilPosition(e){return this._tokenizationTextModelPart.getWordUntilPosition(e)}normalizePosition(e,t){return e}getLineIndentColumn(e){return Ke(this.getLineContent(e))+1}};I=te([k(4,Ge),k(5,ye),k(6,Re),k(7,Ue)],I);function Ke(h){let n=0;for(const e of h)if(e===" "||e==="	")n++;else break;return n}function J(h){return!!(h.options.overviewRuler&&h.options.overviewRuler.color)}function Xe(h){return!!h.after||!!h.before}function H(h){return!!h.options.after||!!h.options.before}class ce{_decorationsTree0;_decorationsTree1;_injectedTextDecorationsTree;constructor(){this._decorationsTree0=new Y,this._decorationsTree1=new Y,this._injectedTextDecorationsTree=new Y}ensureAllNodesHaveRanges(n){this.getAll(n,0,!1,!1,!1)}_ensureNodesHaveRanges(n,e){for(const t of e)t.range===null&&(t.range=n.getRangeAt(t.cachedAbsoluteStart,t.cachedAbsoluteEnd));return e}getAllInInterval(n,e,t,i,o,r){const s=n.getVersionId(),a=this._intervalSearch(e,t,i,o,s,r);return this._ensureNodesHaveRanges(n,a)}_intervalSearch(n,e,t,i,o,r){const s=this._decorationsTree0.intervalSearch(n,e,t,i,o,r),a=this._decorationsTree1.intervalSearch(n,e,t,i,o,r),d=this._injectedTextDecorationsTree.intervalSearch(n,e,t,i,o,r);return s.concat(a).concat(d)}getInjectedTextInInterval(n,e,t,i){const o=n.getVersionId(),r=this._injectedTextDecorationsTree.intervalSearch(e,t,i,!1,o,!1);return this._ensureNodesHaveRanges(n,r).filter(s=>s.options.showIfCollapsed||!s.range.isEmpty())}getAllInjectedText(n,e){const t=n.getVersionId(),i=this._injectedTextDecorationsTree.search(e,!1,t,!1);return this._ensureNodesHaveRanges(n,i).filter(o=>o.options.showIfCollapsed||!o.range.isEmpty())}getAll(n,e,t,i,o){const r=n.getVersionId(),s=this._search(e,t,i,r,o);return this._ensureNodesHaveRanges(n,s)}_search(n,e,t,i,o){if(t)return this._decorationsTree1.search(n,e,i,o);{const r=this._decorationsTree0.search(n,e,i,o),s=this._decorationsTree1.search(n,e,i,o),a=this._injectedTextDecorationsTree.search(n,e,i,o);return r.concat(s).concat(a)}}collectNodesFromOwner(n){const e=this._decorationsTree0.collectNodesFromOwner(n),t=this._decorationsTree1.collectNodesFromOwner(n),i=this._injectedTextDecorationsTree.collectNodesFromOwner(n);return e.concat(t).concat(i)}collectNodesPostOrder(){const n=this._decorationsTree0.collectNodesPostOrder(),e=this._decorationsTree1.collectNodesPostOrder(),t=this._injectedTextDecorationsTree.collectNodesPostOrder();return n.concat(e).concat(t)}insert(n){H(n)?this._injectedTextDecorationsTree.insert(n):J(n)?this._decorationsTree1.insert(n):this._decorationsTree0.insert(n)}delete(n){H(n)?this._injectedTextDecorationsTree.delete(n):J(n)?this._decorationsTree1.delete(n):this._decorationsTree0.delete(n)}getNodeRange(n,e){const t=n.getVersionId();return e.cachedVersionId!==t&&this._resolveNode(e,t),e.range===null&&(e.range=n.getRangeAt(e.cachedAbsoluteStart,e.cachedAbsoluteEnd)),e.range}_resolveNode(n,e){H(n)?this._injectedTextDecorationsTree.resolveNode(n,e):J(n)?this._decorationsTree1.resolveNode(n,e):this._decorationsTree0.resolveNode(n,e)}acceptReplace(n,e,t,i){this._decorationsTree0.acceptReplace(n,e,t,i),this._decorationsTree1.acceptReplace(n,e,t,i),this._injectedTextDecorationsTree.acceptReplace(n,e,t,i)}}function C(h){return h.replace(/[^a-z0-9\-_]/gi," ")}class ue{color;darkColor;constructor(n){this.color=n.color||"",this.darkColor=n.darkColor||""}}class et extends ue{position;_resolvedColor;constructor(n){super(n),this._resolvedColor=null,this.position=typeof n.position=="number"?n.position:m.OverviewRulerLane.Center}getColor(n){return this._resolvedColor||(n.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,n):this._resolvedColor=this._resolveColor(this.color,n)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=null}_resolveColor(n,e){if(typeof n=="string")return n;const t=n?e.getColor(n.id):null;return t?t.toString():""}}class tt{position;persistLane;constructor(n){this.position=n?.position??m.GlyphMarginLane.Center,this.persistLane=n?.persistLane}}class nt extends ue{position;sectionHeaderStyle;sectionHeaderText;_resolvedColor;constructor(n){super(n),this.position=n.position,this.sectionHeaderStyle=n.sectionHeaderStyle??null,this.sectionHeaderText=n.sectionHeaderText??null}getColor(n){return this._resolvedColor||(n.type!=="light"&&this.darkColor?this._resolvedColor=this._resolveColor(this.darkColor,n):this._resolvedColor=this._resolveColor(this.color,n)),this._resolvedColor}invalidateCachedColor(){this._resolvedColor=void 0}_resolveColor(n,e){return typeof n=="string"?be.fromHex(n):e.getColor(n.id)}}class F{static from(n){return n instanceof F?n:new F(n)}content;tokens;inlineClassName;inlineClassNameAffectsLetterSpacing;attachedData;cursorStops;constructor(n){this.content=n.content||"",this.tokens=n.tokens??null,this.inlineClassName=n.inlineClassName||null,this.inlineClassNameAffectsLetterSpacing=n.inlineClassNameAffectsLetterSpacing||!1,this.attachedData=n.attachedData||null,this.cursorStops=n.cursorStops||null}}class v{static EMPTY;static register(n){return new v(n)}static createDynamic(n){return new v(n)}description;blockClassName;blockIsAfterEnd;blockDoesNotCollapse;blockPadding;stickiness;zIndex;className;shouldFillLineOnLineBreak;hoverMessage;glyphMarginHoverMessage;isWholeLine;showIfCollapsed;collapseOnReplaceEdit;overviewRuler;minimap;glyphMargin;glyphMarginClassName;linesDecorationsClassName;lineNumberClassName;lineNumberHoverMessage;linesDecorationsTooltip;firstLineDecorationClassName;marginClassName;inlineClassName;inlineClassNameAffectsLetterSpacing;beforeContentClassName;afterContentClassName;after;before;hideInCommentTokens;hideInStringTokens;constructor(n){this.description=n.description,this.blockClassName=n.blockClassName?C(n.blockClassName):null,this.blockDoesNotCollapse=n.blockDoesNotCollapse??null,this.blockIsAfterEnd=n.blockIsAfterEnd??null,this.blockPadding=n.blockPadding??null,this.stickiness=n.stickiness||m.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges,this.zIndex=n.zIndex||0,this.className=n.className?C(n.className):null,this.shouldFillLineOnLineBreak=n.shouldFillLineOnLineBreak??null,this.hoverMessage=n.hoverMessage||null,this.glyphMarginHoverMessage=n.glyphMarginHoverMessage||null,this.lineNumberHoverMessage=n.lineNumberHoverMessage||null,this.isWholeLine=n.isWholeLine||!1,this.showIfCollapsed=n.showIfCollapsed||!1,this.collapseOnReplaceEdit=n.collapseOnReplaceEdit||!1,this.overviewRuler=n.overviewRuler?new et(n.overviewRuler):null,this.minimap=n.minimap?new nt(n.minimap):null,this.glyphMargin=n.glyphMarginClassName?new tt(n.glyphMargin):null,this.glyphMarginClassName=n.glyphMarginClassName?C(n.glyphMarginClassName):null,this.linesDecorationsClassName=n.linesDecorationsClassName?C(n.linesDecorationsClassName):null,this.lineNumberClassName=n.lineNumberClassName?C(n.lineNumberClassName):null,this.linesDecorationsTooltip=n.linesDecorationsTooltip?L.htmlAttributeEncodeValue(n.linesDecorationsTooltip):null,this.firstLineDecorationClassName=n.firstLineDecorationClassName?C(n.firstLineDecorationClassName):null,this.marginClassName=n.marginClassName?C(n.marginClassName):null,this.inlineClassName=n.inlineClassName?C(n.inlineClassName):null,this.inlineClassNameAffectsLetterSpacing=n.inlineClassNameAffectsLetterSpacing||!1,this.beforeContentClassName=n.beforeContentClassName?C(n.beforeContentClassName):null,this.afterContentClassName=n.afterContentClassName?C(n.afterContentClassName):null,this.after=n.after?F.from(n.after):null,this.before=n.before?F.from(n.before):null,this.hideInCommentTokens=n.hideInCommentTokens??!1,this.hideInStringTokens=n.hideInStringTokens??!1}}v.EMPTY=v.register({description:"empty"});const he=[v.register({description:"tracked-range-always-grows-when-typing-at-edges",stickiness:m.TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges}),v.register({description:"tracked-range-never-grows-when-typing-at-edges",stickiness:m.TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges}),v.register({description:"tracked-range-grows-only-when-typing-before",stickiness:m.TrackedRangeStickiness.GrowsOnlyWhenTypingBefore}),v.register({description:"tracked-range-grows-only-when-typing-after",stickiness:m.TrackedRangeStickiness.GrowsOnlyWhenTypingAfter})];function fe(h){return h instanceof v?h:v.createDynamic(h)}class it extends z{constructor(e){super();this.handleBeforeFire=e;this._deferredCnt=0,this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._affectsLineNumber=!1}_actual=this._register(new R);event=this._actual.event;_deferredCnt;_shouldFireDeferred;_affectsMinimap;_affectsOverviewRuler;_affectedInjectedTextLines=null;_affectsGlyphMargin;_affectsLineNumber;hasListeners(){return this._actual.hasListeners()}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(){this._deferredCnt--,this._deferredCnt===0&&(this._shouldFireDeferred&&this.doFire(),this._affectedInjectedTextLines?.clear(),this._affectedInjectedTextLines=null)}recordLineAffectedByInjectedText(e){this._affectedInjectedTextLines||(this._affectedInjectedTextLines=new Set),this._affectedInjectedTextLines.add(e)}checkAffectedAndFire(e){this._affectsMinimap||=!!e.minimap?.position,this._affectsOverviewRuler||=!!e.overviewRuler?.color,this._affectsGlyphMargin||=!!e.glyphMarginClassName,this._affectsLineNumber||=!!e.lineNumberClassName,this.tryFire()}fire(){this._affectsMinimap=!0,this._affectsOverviewRuler=!0,this._affectsGlyphMargin=!0,this.tryFire()}tryFire(){this._deferredCnt===0?this.doFire():this._shouldFireDeferred=!0}doFire(){this.handleBeforeFire(this._affectedInjectedTextLines);const e={affectsMinimap:this._affectsMinimap,affectsOverviewRuler:this._affectsOverviewRuler,affectsGlyphMargin:this._affectsGlyphMargin,affectsLineNumber:this._affectsLineNumber};this._shouldFireDeferred=!1,this._affectsMinimap=!1,this._affectsOverviewRuler=!1,this._affectsGlyphMargin=!1,this._actual.fire(e)}}class ot extends z{_fastEmitter=this._register(new R);fastEvent=this._fastEmitter.event;_slowEmitter=this._register(new R);slowEvent=this._slowEmitter.event;_deferredCnt;_deferredEvent;constructor(){super(),this._deferredCnt=0,this._deferredEvent=null}hasListeners(){return this._fastEmitter.hasListeners()||this._slowEmitter.hasListeners()}beginDeferredEmit(){this._deferredCnt++}endDeferredEmit(n=null){if(this._deferredCnt--,this._deferredCnt===0&&this._deferredEvent!==null){this._deferredEvent.rawContentChangedEvent.resultingSelection=n;const e=this._deferredEvent;this._deferredEvent=null,this._fastEmitter.fire(e),this._slowEmitter.fire(e)}}fire(n){if(this._deferredCnt>0){this._deferredEvent?this._deferredEvent=this._deferredEvent.merge(n):this._deferredEvent=n;return}this._fastEmitter.fire(n),this._slowEmitter.fire(n)}}export{tt as ModelDecorationGlyphMarginOptions,F as ModelDecorationInjectedTextOptions,nt as ModelDecorationMinimapOptions,v as ModelDecorationOptions,et as ModelDecorationOverviewRulerOptions,I as TextModel,de as createTextBuffer,qe as createTextBufferFactory,Ye as createTextBufferFactoryFromSnapshot,vn as createTextBufferFactoryFromStream,Ke as indentOfLine};
