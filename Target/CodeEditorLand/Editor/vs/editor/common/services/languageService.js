import{Emitter as i,Event as a}from"../../../base/common/event.js";import{Disposable as g}from"../../../base/common/lifecycle.js";import"../../../base/common/uri.js";import{LanguagesRegistry as u}from"./languagesRegistry.js";import"../languages/language.js";import{TokenizationRegistry as o}from"../languages.js";import{PLAINTEXT_LANGUAGE_ID as d}from"../languages/modesRegistry.js";import{observableFromEvent as l}from"../../../base/common/observable.js";class r extends g{_serviceBrand;static instanceCount=0;_onDidRequestBasicLanguageFeatures=this._register(new i);onDidRequestBasicLanguageFeatures=this._onDidRequestBasicLanguageFeatures.event;_onDidRequestRichLanguageFeatures=this._register(new i);onDidRequestRichLanguageFeatures=this._onDidRequestRichLanguageFeatures.event;_onDidChange=this._register(new i({leakWarningThreshold:200}));onDidChange=this._onDidChange.event;_requestedBasicLanguages=new Set;_requestedRichLanguages=new Set;_registry;languageIdCodec;constructor(e=!1){super(),r.instanceCount++,this._registry=this._register(new u(!0,e)),this.languageIdCodec=this._registry.languageIdCodec,this._register(this._registry.onDidChange(()=>this._onDidChange.fire()))}dispose(){r.instanceCount--,super.dispose()}registerLanguage(e){return this._registry.registerLanguage(e)}isRegisteredLanguageId(e){return this._registry.isRegisteredLanguageId(e)}getRegisteredLanguageIds(){return this._registry.getRegisteredLanguageIds()}getSortedRegisteredLanguageNames(){return this._registry.getSortedRegisteredLanguageNames()}getLanguageName(e){return this._registry.getLanguageName(e)}getMimeType(e){return this._registry.getMimeType(e)}getIcon(e){return this._registry.getIcon(e)}getExtensions(e){return this._registry.getExtensions(e)}getFilenames(e){return this._registry.getFilenames(e)}getConfigurationFiles(e){return this._registry.getConfigurationFiles(e)}getLanguageIdByLanguageName(e){return this._registry.getLanguageIdByLanguageName(e)}getLanguageIdByMimeType(e){return this._registry.getLanguageIdByMimeType(e)}guessLanguageIdByFilepathOrFirstLine(e,t){return this._registry.guessLanguageIdByFilepathOrFirstLine(e,t).at(0)??null}createById(e){return new n(this.onDidChange,()=>this._createAndGetLanguageIdentifier(e))}createByMimeType(e){return new n(this.onDidChange,()=>{const t=this.getLanguageIdByMimeType(e);return this._createAndGetLanguageIdentifier(t)})}createByFilepathOrFirstLine(e,t){return new n(this.onDidChange,()=>{const s=this.guessLanguageIdByFilepathOrFirstLine(e,t);return this._createAndGetLanguageIdentifier(s)})}_createAndGetLanguageIdentifier(e){return(!e||!this.isRegisteredLanguageId(e))&&(e=d),e}requestBasicLanguageFeatures(e){this._requestedBasicLanguages.has(e)||(this._requestedBasicLanguages.add(e),this._onDidRequestBasicLanguageFeatures.fire(e))}requestRichLanguageFeatures(e){this._requestedRichLanguages.has(e)||(this._requestedRichLanguages.add(e),this.requestBasicLanguageFeatures(e),o.getOrCreate(e),this._onDidRequestRichLanguageFeatures.fire(e))}}class n{_value;onDidChange;constructor(e,t){this._value=l(this,e,()=>t()),this.onDidChange=a.fromObservable(this._value)}get languageId(){return this._value.get()}}export{r as LanguageService};
