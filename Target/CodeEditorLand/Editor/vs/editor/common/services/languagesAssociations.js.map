{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/common/services/languagesAssociations.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { type ParsedPattern, parse } from \"../../../base/common/glob.js\";\nimport { Mimes } from \"../../../base/common/mime.js\";\nimport { Schemas } from \"../../../base/common/network.js\";\nimport { basename, posix } from \"../../../base/common/path.js\";\nimport { DataUri } from \"../../../base/common/resources.js\";\nimport { startsWithUTF8BOM } from \"../../../base/common/strings.js\";\nimport type { URI } from \"../../../base/common/uri.js\";\nimport { PLAINTEXT_LANGUAGE_ID } from \"../languages/modesRegistry.js\";\n\nexport interface ILanguageAssociation {\n\treadonly id: string;\n\treadonly mime: string;\n\treadonly filename?: string;\n\treadonly extension?: string;\n\treadonly filepattern?: string;\n\treadonly firstline?: RegExp;\n}\n\ninterface ILanguageAssociationItem extends ILanguageAssociation {\n\treadonly userConfigured: boolean;\n\treadonly filenameLowercase?: string;\n\treadonly extensionLowercase?: string;\n\treadonly filepatternLowercase?: ParsedPattern;\n\treadonly filepatternOnPath?: boolean;\n}\n\nlet registeredAssociations: ILanguageAssociationItem[] = [];\nlet nonUserRegisteredAssociations: ILanguageAssociationItem[] = [];\nlet userRegisteredAssociations: ILanguageAssociationItem[] = [];\n\n/**\n * Associate a language to the registry (platform).\n * * **NOTE**: This association will lose over associations registered using `registerConfiguredLanguageAssociation`.\n * * **NOTE**: Use `clearPlatformLanguageAssociations` to remove all associations registered using this function.\n */\nexport function registerPlatformLanguageAssociation(\n\tassociation: ILanguageAssociation,\n\twarnOnOverwrite = false,\n): void {\n\t_registerLanguageAssociation(association, false, warnOnOverwrite);\n}\n\n/**\n * Associate a language to the registry (configured).\n * * **NOTE**: This association will win over associations registered using `registerPlatformLanguageAssociation`.\n * * **NOTE**: Use `clearConfiguredLanguageAssociations` to remove all associations registered using this function.\n */\nexport function registerConfiguredLanguageAssociation(\n\tassociation: ILanguageAssociation,\n): void {\n\t_registerLanguageAssociation(association, true, false);\n}\n\nfunction _registerLanguageAssociation(\n\tassociation: ILanguageAssociation,\n\tuserConfigured: boolean,\n\twarnOnOverwrite: boolean,\n): void {\n\t// Register\n\tconst associationItem = toLanguageAssociationItem(\n\t\tassociation,\n\t\tuserConfigured,\n\t);\n\tregisteredAssociations.push(associationItem);\n\tif (associationItem.userConfigured) {\n\t\tuserRegisteredAssociations.push(associationItem);\n\t} else {\n\t\tnonUserRegisteredAssociations.push(associationItem);\n\t}\n\n\t// Check for conflicts unless this is a user configured association\n\tif (warnOnOverwrite && !associationItem.userConfigured) {\n\t\tregisteredAssociations.forEach((a) => {\n\t\t\tif (a.mime === associationItem.mime || a.userConfigured) {\n\t\t\t\treturn; // same mime or userConfigured is ok\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tassociationItem.extension &&\n\t\t\t\ta.extension === associationItem.extension\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Overwriting extension <<${associationItem.extension}>> to now point to mime <<${associationItem.mime}>>`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tassociationItem.filename &&\n\t\t\t\ta.filename === associationItem.filename\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Overwriting filename <<${associationItem.filename}>> to now point to mime <<${associationItem.mime}>>`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tassociationItem.filepattern &&\n\t\t\t\ta.filepattern === associationItem.filepattern\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Overwriting filepattern <<${associationItem.filepattern}>> to now point to mime <<${associationItem.mime}>>`,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\tassociationItem.firstline &&\n\t\t\t\ta.firstline === associationItem.firstline\n\t\t\t) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`Overwriting firstline <<${associationItem.firstline}>> to now point to mime <<${associationItem.mime}>>`,\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n}\n\nfunction toLanguageAssociationItem(\n\tassociation: ILanguageAssociation,\n\tuserConfigured: boolean,\n): ILanguageAssociationItem {\n\treturn {\n\t\tid: association.id,\n\t\tmime: association.mime,\n\t\tfilename: association.filename,\n\t\textension: association.extension,\n\t\tfilepattern: association.filepattern,\n\t\tfirstline: association.firstline,\n\t\tuserConfigured: userConfigured,\n\t\tfilenameLowercase: association.filename\n\t\t\t? association.filename.toLowerCase()\n\t\t\t: undefined,\n\t\textensionLowercase: association.extension\n\t\t\t? association.extension.toLowerCase()\n\t\t\t: undefined,\n\t\tfilepatternLowercase: association.filepattern\n\t\t\t? parse(association.filepattern.toLowerCase())\n\t\t\t: undefined,\n\t\tfilepatternOnPath: association.filepattern\n\t\t\t? association.filepattern.indexOf(posix.sep) >= 0\n\t\t\t: false,\n\t};\n}\n\n/**\n * Clear language associations from the registry (platform).\n */\nexport function clearPlatformLanguageAssociations(): void {\n\tregisteredAssociations = registeredAssociations.filter(\n\t\t(a) => a.userConfigured,\n\t);\n\tnonUserRegisteredAssociations = [];\n}\n\n/**\n * Clear language associations from the registry (configured).\n */\nexport function clearConfiguredLanguageAssociations(): void {\n\tregisteredAssociations = registeredAssociations.filter(\n\t\t(a) => !a.userConfigured,\n\t);\n\tuserRegisteredAssociations = [];\n}\n\ninterface IdAndMime {\n\tid: string;\n\tmime: string;\n}\n\n/**\n * Given a file, return the best matching mime types for it\n * based on the registered language associations.\n */\nexport function getMimeTypes(\n\tresource: URI | null,\n\tfirstLine?: string,\n): string[] {\n\treturn getAssociations(resource, firstLine).map((item) => item.mime);\n}\n\n/**\n * @see `getMimeTypes`\n */\nexport function getLanguageIds(\n\tresource: URI | null,\n\tfirstLine?: string,\n): string[] {\n\treturn getAssociations(resource, firstLine).map((item) => item.id);\n}\n\nfunction getAssociations(\n\tresource: URI | null,\n\tfirstLine?: string,\n): IdAndMime[] {\n\tlet path: string | undefined;\n\tif (resource) {\n\t\tswitch (resource.scheme) {\n\t\t\tcase Schemas.file:\n\t\t\t\tpath = resource.fsPath;\n\t\t\t\tbreak;\n\t\t\tcase Schemas.data: {\n\t\t\t\tconst metadata = DataUri.parseMetaData(resource);\n\t\t\t\tpath = metadata.get(DataUri.META_DATA_LABEL);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase Schemas.vscodeNotebookCell:\n\t\t\t\t// File path not relevant for language detection of cell\n\t\t\t\tpath = undefined;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tpath = resource.path;\n\t\t}\n\t}\n\n\tif (!path) {\n\t\treturn [{ id: \"unknown\", mime: Mimes.unknown }];\n\t}\n\n\tpath = path.toLowerCase();\n\n\tconst filename = basename(path);\n\n\t// 1.) User configured mappings have highest priority\n\tconst configuredLanguage = getAssociationByPath(\n\t\tpath,\n\t\tfilename,\n\t\tuserRegisteredAssociations,\n\t);\n\tif (configuredLanguage) {\n\t\treturn [\n\t\t\tconfiguredLanguage,\n\t\t\t{ id: PLAINTEXT_LANGUAGE_ID, mime: Mimes.text },\n\t\t];\n\t}\n\n\t// 2.) Registered mappings have middle priority\n\tconst registeredLanguage = getAssociationByPath(\n\t\tpath,\n\t\tfilename,\n\t\tnonUserRegisteredAssociations,\n\t);\n\tif (registeredLanguage) {\n\t\treturn [\n\t\t\tregisteredLanguage,\n\t\t\t{ id: PLAINTEXT_LANGUAGE_ID, mime: Mimes.text },\n\t\t];\n\t}\n\n\t// 3.) Firstline has lowest priority\n\tif (firstLine) {\n\t\tconst firstlineLanguage = getAssociationByFirstline(firstLine);\n\t\tif (firstlineLanguage) {\n\t\t\treturn [\n\t\t\t\tfirstlineLanguage,\n\t\t\t\t{ id: PLAINTEXT_LANGUAGE_ID, mime: Mimes.text },\n\t\t\t];\n\t\t}\n\t}\n\n\treturn [{ id: \"unknown\", mime: Mimes.unknown }];\n}\n\nfunction getAssociationByPath(\n\tpath: string,\n\tfilename: string,\n\tassociations: ILanguageAssociationItem[],\n): ILanguageAssociationItem | undefined {\n\tlet filenameMatch: ILanguageAssociationItem | undefined;\n\tlet patternMatch: ILanguageAssociationItem | undefined;\n\tlet extensionMatch: ILanguageAssociationItem | undefined;\n\n\t// We want to prioritize associations based on the order they are registered so that the last registered\n\t// association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074\n\tfor (let i = associations.length - 1; i >= 0; i--) {\n\t\tconst association = associations[i];\n\n\t\t// First exact name match\n\t\tif (filename === association.filenameLowercase) {\n\t\t\tfilenameMatch = association;\n\t\t\tbreak; // take it!\n\t\t}\n\n\t\t// Longest pattern match\n\t\tif (association.filepattern) {\n\t\t\tif (\n\t\t\t\t!patternMatch ||\n\t\t\t\tassociation.filepattern.length >\n\t\t\t\t\tpatternMatch.filepattern!.length\n\t\t\t) {\n\t\t\t\tconst target = association.filepatternOnPath ? path : filename; // match on full path if pattern contains path separator\n\t\t\t\tif (association.filepatternLowercase?.(target)) {\n\t\t\t\t\tpatternMatch = association;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Longest extension match\n\t\tif (association.extension) {\n\t\t\tif (\n\t\t\t\t!extensionMatch ||\n\t\t\t\tassociation.extension.length > extensionMatch.extension!.length\n\t\t\t) {\n\t\t\t\tif (filename.endsWith(association.extensionLowercase!)) {\n\t\t\t\t\textensionMatch = association;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\t// 1.) Exact name match has second highest priority\n\tif (filenameMatch) {\n\t\treturn filenameMatch;\n\t}\n\n\t// 2.) Match on pattern\n\tif (patternMatch) {\n\t\treturn patternMatch;\n\t}\n\n\t// 3.) Match on extension comes next\n\tif (extensionMatch) {\n\t\treturn extensionMatch;\n\t}\n\n\treturn undefined;\n}\n\nfunction getAssociationByFirstline(\n\tfirstLine: string,\n): ILanguageAssociationItem | undefined {\n\tif (startsWithUTF8BOM(firstLine)) {\n\t\tfirstLine = firstLine.substr(1);\n\t}\n\n\tif (firstLine.length > 0) {\n\t\t// We want to prioritize associations based on the order they are registered so that the last registered\n\t\t// association wins over all other. This is for https://github.com/microsoft/vscode/issues/20074\n\t\tfor (let i = registeredAssociations.length - 1; i >= 0; i--) {\n\t\t\tconst association = registeredAssociations[i];\n\t\t\tif (!association.firstline) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst matches = firstLine.match(association.firstline);\n\t\t\tif (matches && matches.length > 0) {\n\t\t\t\treturn association;\n\t\t\t}\n\t\t}\n\t}\n\n\treturn undefined;\n}\n"],
  "mappings": ";;AAKA,SAA6B,aAAa;AAC1C,SAAS,aAAa;AACtB,SAAS,eAAe;AACxB,SAAS,UAAU,aAAa;AAChC,SAAS,eAAe;AACxB,SAAS,yBAAyB;AAElC,SAAS,6BAA6B;AAmBtC,IAAI,yBAAqD,CAAC;AAC1D,IAAI,gCAA4D,CAAC;AACjE,IAAI,6BAAyD,CAAC;AAOvD,SAAS,oCACf,aACA,kBAAkB,OACX;AACP,+BAA6B,aAAa,OAAO,eAAe;AACjE;AALgB;AAYT,SAAS,sCACf,aACO;AACP,+BAA6B,aAAa,MAAM,KAAK;AACtD;AAJgB;AAMhB,SAAS,6BACR,aACA,gBACA,iBACO;AAEP,QAAM,kBAAkB;AAAA,IACvB;AAAA,IACA;AAAA,EACD;AACA,yBAAuB,KAAK,eAAe;AAC3C,MAAI,gBAAgB,gBAAgB;AACnC,+BAA2B,KAAK,eAAe;AAAA,EAChD,OAAO;AACN,kCAA8B,KAAK,eAAe;AAAA,EACnD;AAGA,MAAI,mBAAmB,CAAC,gBAAgB,gBAAgB;AACvD,2BAAuB,QAAQ,CAAC,MAAM;AACrC,UAAI,EAAE,SAAS,gBAAgB,QAAQ,EAAE,gBAAgB;AACxD;AAAA,MACD;AAEA,UACC,gBAAgB,aAChB,EAAE,cAAc,gBAAgB,WAC/B;AACD,gBAAQ;AAAA,UACP,2BAA2B,gBAAgB,SAAS,6BAA6B,gBAAgB,IAAI;AAAA,QACtG;AAAA,MACD;AAEA,UACC,gBAAgB,YAChB,EAAE,aAAa,gBAAgB,UAC9B;AACD,gBAAQ;AAAA,UACP,0BAA0B,gBAAgB,QAAQ,6BAA6B,gBAAgB,IAAI;AAAA,QACpG;AAAA,MACD;AAEA,UACC,gBAAgB,eAChB,EAAE,gBAAgB,gBAAgB,aACjC;AACD,gBAAQ;AAAA,UACP,6BAA6B,gBAAgB,WAAW,6BAA6B,gBAAgB,IAAI;AAAA,QAC1G;AAAA,MACD;AAEA,UACC,gBAAgB,aAChB,EAAE,cAAc,gBAAgB,WAC/B;AACD,gBAAQ;AAAA,UACP,2BAA2B,gBAAgB,SAAS,6BAA6B,gBAAgB,IAAI;AAAA,QACtG;AAAA,MACD;AAAA,IACD,CAAC;AAAA,EACF;AACD;AA7DS;AA+DT,SAAS,0BACR,aACA,gBAC2B;AAC3B,SAAO;AAAA,IACN,IAAI,YAAY;AAAA,IAChB,MAAM,YAAY;AAAA,IAClB,UAAU,YAAY;AAAA,IACtB,WAAW,YAAY;AAAA,IACvB,aAAa,YAAY;AAAA,IACzB,WAAW,YAAY;AAAA,IACvB;AAAA,IACA,mBAAmB,YAAY,WAC5B,YAAY,SAAS,YAAY,IACjC;AAAA,IACH,oBAAoB,YAAY,YAC7B,YAAY,UAAU,YAAY,IAClC;AAAA,IACH,sBAAsB,YAAY,cAC/B,MAAM,YAAY,YAAY,YAAY,CAAC,IAC3C;AAAA,IACH,mBAAmB,YAAY,cAC5B,YAAY,YAAY,QAAQ,MAAM,GAAG,KAAK,IAC9C;AAAA,EACJ;AACD;AAzBS;AA8BF,SAAS,oCAA0C;AACzD,2BAAyB,uBAAuB;AAAA,IAC/C,CAAC,MAAM,EAAE;AAAA,EACV;AACA,kCAAgC,CAAC;AAClC;AALgB;AAUT,SAAS,sCAA4C;AAC3D,2BAAyB,uBAAuB;AAAA,IAC/C,CAAC,MAAM,CAAC,EAAE;AAAA,EACX;AACA,+BAA6B,CAAC;AAC/B;AALgB;AAgBT,SAAS,aACf,UACA,WACW;AACX,SAAO,gBAAgB,UAAU,SAAS,EAAE,IAAI,CAAC,SAAS,KAAK,IAAI;AACpE;AALgB;AAUT,SAAS,eACf,UACA,WACW;AACX,SAAO,gBAAgB,UAAU,SAAS,EAAE,IAAI,CAAC,SAAS,KAAK,EAAE;AAClE;AALgB;AAOhB,SAAS,gBACR,UACA,WACc;AACd,MAAI;AACJ,MAAI,UAAU;AACb,YAAQ,SAAS,QAAQ;AAAA,MACxB,KAAK,QAAQ;AACZ,eAAO,SAAS;AAChB;AAAA,MACD,KAAK,QAAQ,MAAM;AAClB,cAAM,WAAW,QAAQ,cAAc,QAAQ;AAC/C,eAAO,SAAS,IAAI,QAAQ,eAAe;AAC3C;AAAA,MACD;AAAA,MACA,KAAK,QAAQ;AAEZ,eAAO;AACP;AAAA,MACD;AACC,eAAO,SAAS;AAAA,IAClB;AAAA,EACD;AAEA,MAAI,CAAC,MAAM;AACV,WAAO,CAAC,EAAE,IAAI,WAAW,MAAM,MAAM,QAAQ,CAAC;AAAA,EAC/C;AAEA,SAAO,KAAK,YAAY;AAExB,QAAM,WAAW,SAAS,IAAI;AAG9B,QAAM,qBAAqB;AAAA,IAC1B;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,MAAI,oBAAoB;AACvB,WAAO;AAAA,MACN;AAAA,MACA,EAAE,IAAI,uBAAuB,MAAM,MAAM,KAAK;AAAA,IAC/C;AAAA,EACD;AAGA,QAAM,qBAAqB;AAAA,IAC1B;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,MAAI,oBAAoB;AACvB,WAAO;AAAA,MACN;AAAA,MACA,EAAE,IAAI,uBAAuB,MAAM,MAAM,KAAK;AAAA,IAC/C;AAAA,EACD;AAGA,MAAI,WAAW;AACd,UAAM,oBAAoB,0BAA0B,SAAS;AAC7D,QAAI,mBAAmB;AACtB,aAAO;AAAA,QACN;AAAA,QACA,EAAE,IAAI,uBAAuB,MAAM,MAAM,KAAK;AAAA,MAC/C;AAAA,IACD;AAAA,EACD;AAEA,SAAO,CAAC,EAAE,IAAI,WAAW,MAAM,MAAM,QAAQ,CAAC;AAC/C;AAtES;AAwET,SAAS,qBACR,MACA,UACA,cACuC;AACvC,MAAI;AACJ,MAAI;AACJ,MAAI;AAIJ,WAAS,IAAI,aAAa,SAAS,GAAG,KAAK,GAAG,KAAK;AAClD,UAAM,cAAc,aAAa,CAAC;AAGlC,QAAI,aAAa,YAAY,mBAAmB;AAC/C,sBAAgB;AAChB;AAAA,IACD;AAGA,QAAI,YAAY,aAAa;AAC5B,UACC,CAAC,gBACD,YAAY,YAAY,SACvB,aAAa,YAAa,QAC1B;AACD,cAAM,SAAS,YAAY,oBAAoB,OAAO;AACtD,YAAI,YAAY,uBAAuB,MAAM,GAAG;AAC/C,yBAAe;AAAA,QAChB;AAAA,MACD;AAAA,IACD;AAGA,QAAI,YAAY,WAAW;AAC1B,UACC,CAAC,kBACD,YAAY,UAAU,SAAS,eAAe,UAAW,QACxD;AACD,YAAI,SAAS,SAAS,YAAY,kBAAmB,GAAG;AACvD,2BAAiB;AAAA,QAClB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAGA,MAAI,eAAe;AAClB,WAAO;AAAA,EACR;AAGA,MAAI,cAAc;AACjB,WAAO;AAAA,EACR;AAGA,MAAI,gBAAgB;AACnB,WAAO;AAAA,EACR;AAEA,SAAO;AACR;AA/DS;AAiET,SAAS,0BACR,WACuC;AACvC,MAAI,kBAAkB,SAAS,GAAG;AACjC,gBAAY,UAAU,OAAO,CAAC;AAAA,EAC/B;AAEA,MAAI,UAAU,SAAS,GAAG;AAGzB,aAAS,IAAI,uBAAuB,SAAS,GAAG,KAAK,GAAG,KAAK;AAC5D,YAAM,cAAc,uBAAuB,CAAC;AAC5C,UAAI,CAAC,YAAY,WAAW;AAC3B;AAAA,MACD;AAEA,YAAM,UAAU,UAAU,MAAM,YAAY,SAAS;AACrD,UAAI,WAAW,QAAQ,SAAS,GAAG;AAClC,eAAO;AAAA,MACR;AAAA,IACD;AAAA,EACD;AAEA,SAAO;AACR;AAxBS;",
  "names": []
}
