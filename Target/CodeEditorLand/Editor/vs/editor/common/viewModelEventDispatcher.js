import{Emitter as v}from"../../base/common/event.js";import{Disposable as p}from"../../base/common/lifecycle.js";import"./core/selection.js";import"./cursorEvents.js";import"./editorCommon.js";import"./textModelEvents.js";import"./viewEventHandler.js";import"./viewEvents.js";class F extends p{_onEvent=this._register(new v);onEvent=this._onEvent.event;_eventHandlers;_viewEventQueue;_isConsumingViewEventQueue;_collector;_collectorCnt;_outgoingEvents;constructor(){super(),this._eventHandlers=[],this._viewEventQueue=null,this._isConsumingViewEventQueue=!1,this._collector=null,this._collectorCnt=0,this._outgoingEvents=[]}emitOutgoingEvent(e){this._addOutgoingEvent(e),this._emitOutgoingEvents()}_addOutgoingEvent(e){for(let t=0,o=this._outgoingEvents.length;t<o;t++){const l=this._outgoingEvents[t].kind===e.kind?this._outgoingEvents[t].attemptToMerge(e):null;if(l){this._outgoingEvents[t]=l;return}}this._outgoingEvents.push(e)}_emitOutgoingEvents(){for(;this._outgoingEvents.length>0;){if(this._collector||this._isConsumingViewEventQueue)return;const e=this._outgoingEvents.shift();e.isNoOp()||this._onEvent.fire(e)}}addViewEventHandler(e){for(let t=0,o=this._eventHandlers.length;t<o;t++)this._eventHandlers[t]===e&&console.warn("Detected duplicate listener in ViewEventDispatcher",e);this._eventHandlers.push(e)}removeViewEventHandler(e){for(let t=0;t<this._eventHandlers.length;t++)if(this._eventHandlers[t]===e){this._eventHandlers.splice(t,1);break}}beginEmitViewEvents(){return this._collectorCnt++,this._collectorCnt===1&&(this._collector=new E),this._collector}endEmitViewEvents(){if(this._collectorCnt--,this._collectorCnt===0){const e=this._collector.outgoingEvents,t=this._collector.viewEvents;this._collector=null;for(const o of e)this._addOutgoingEvent(o);t.length>0&&this._emitMany(t)}this._emitOutgoingEvents()}emitSingleViewEvent(e){try{this.beginEmitViewEvents().emitViewEvent(e)}finally{this.endEmitViewEvents()}}_emitMany(e){this._viewEventQueue?this._viewEventQueue=this._viewEventQueue.concat(e):this._viewEventQueue=e,this._isConsumingViewEventQueue||this._consumeViewEventQueue()}_consumeViewEventQueue(){try{this._isConsumingViewEventQueue=!0,this._doConsumeQueue()}finally{this._isConsumingViewEventQueue=!1}}_doConsumeQueue(){for(;this._viewEventQueue;){const e=this._viewEventQueue;this._viewEventQueue=null;const t=this._eventHandlers.slice(0);for(const o of t)o.handleEvents(e)}}}class E{viewEvents;outgoingEvents;constructor(){this.viewEvents=[],this.outgoingEvents=[]}emitViewEvent(e){this.viewEvents.push(e)}emitOutgoingEvent(e){this.outgoingEvents.push(e)}}var C=(n=>(n[n.ContentSizeChanged=0]="ContentSizeChanged",n[n.FocusChanged=1]="FocusChanged",n[n.ScrollChanged=2]="ScrollChanged",n[n.ViewZonesChanged=3]="ViewZonesChanged",n[n.HiddenAreasChanged=4]="HiddenAreasChanged",n[n.ReadOnlyEditAttempt=5]="ReadOnlyEditAttempt",n[n.CursorStateChanged=6]="CursorStateChanged",n[n.ModelDecorationsChanged=7]="ModelDecorationsChanged",n[n.ModelLanguageChanged=8]="ModelLanguageChanged",n[n.ModelLanguageConfigurationChanged=9]="ModelLanguageConfigurationChanged",n[n.ModelContentChanged=10]="ModelContentChanged",n[n.ModelOptionsChanged=11]="ModelOptionsChanged",n[n.ModelTokensChanged=12]="ModelTokensChanged",n))(C||{});class a{kind=0;_oldContentWidth;_oldContentHeight;contentWidth;contentHeight;contentWidthChanged;contentHeightChanged;constructor(e,t,o,l){this._oldContentWidth=e,this._oldContentHeight=t,this.contentWidth=o,this.contentHeight=l,this.contentWidthChanged=this._oldContentWidth!==this.contentWidth,this.contentHeightChanged=this._oldContentHeight!==this.contentHeight}isNoOp(){return!this.contentWidthChanged&&!this.contentHeightChanged}attemptToMerge(e){return e.kind!==this.kind?null:new a(this._oldContentWidth,this._oldContentHeight,e.contentWidth,e.contentHeight)}}class c{kind=1;oldHasFocus;hasFocus;constructor(e,t){this.oldHasFocus=e,this.hasFocus=t}isNoOp(){return this.oldHasFocus===this.hasFocus}attemptToMerge(e){return e.kind!==this.kind?null:new c(this.oldHasFocus,e.hasFocus)}}class h{kind=2;_oldScrollWidth;_oldScrollLeft;_oldScrollHeight;_oldScrollTop;scrollWidth;scrollLeft;scrollHeight;scrollTop;scrollWidthChanged;scrollLeftChanged;scrollHeightChanged;scrollTopChanged;constructor(e,t,o,l,r,s,u,g){this._oldScrollWidth=e,this._oldScrollLeft=t,this._oldScrollHeight=o,this._oldScrollTop=l,this.scrollWidth=r,this.scrollLeft=s,this.scrollHeight=u,this.scrollTop=g,this.scrollWidthChanged=this._oldScrollWidth!==this.scrollWidth,this.scrollLeftChanged=this._oldScrollLeft!==this.scrollLeft,this.scrollHeightChanged=this._oldScrollHeight!==this.scrollHeight,this.scrollTopChanged=this._oldScrollTop!==this.scrollTop}isNoOp(){return!this.scrollWidthChanged&&!this.scrollLeftChanged&&!this.scrollHeightChanged&&!this.scrollTopChanged}attemptToMerge(e){return e.kind!==this.kind?null:new h(this._oldScrollWidth,this._oldScrollLeft,this._oldScrollHeight,this._oldScrollTop,e.scrollWidth,e.scrollLeft,e.scrollHeight,e.scrollTop)}}class A{kind=3;constructor(){}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class D{kind=4;constructor(){}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class d{kind=6;oldSelections;selections;oldModelVersionId;modelVersionId;source;reason;reachedMaxCursorCount;constructor(e,t,o,l,r,s,u){this.oldSelections=e,this.selections=t,this.oldModelVersionId=o,this.modelVersionId=l,this.source=r,this.reason=s,this.reachedMaxCursorCount=u}static _selectionsAreEqual(e,t){if(!e&&!t)return!0;if(!e||!t)return!1;const o=e.length,l=t.length;if(o!==l)return!1;for(let r=0;r<o;r++)if(!e[r].equalsSelection(t[r]))return!1;return!0}isNoOp(){return d._selectionsAreEqual(this.oldSelections,this.selections)&&this.oldModelVersionId===this.modelVersionId}attemptToMerge(e){return e.kind!==this.kind?null:new d(this.oldSelections,e.selections,this.oldModelVersionId,e.modelVersionId,e.source,e.reason,this.reachedMaxCursorCount||e.reachedMaxCursorCount)}}class R{kind=5;constructor(){}isNoOp(){return!1}attemptToMerge(e){return e.kind!==this.kind?null:this}}class z{constructor(e){this.event=e}kind=7;isNoOp(){return!1}attemptToMerge(e){return null}}class Z{constructor(e){this.event=e}kind=8;isNoOp(){return!1}attemptToMerge(e){return null}}class q{constructor(e){this.event=e}kind=9;isNoOp(){return!1}attemptToMerge(e){return null}}class j{constructor(e){this.event=e}kind=10;isNoOp(){return!1}attemptToMerge(e){return null}}class B{constructor(e){this.event=e}kind=11;isNoOp(){return!1}attemptToMerge(e){return null}}class G{constructor(e){this.event=e}kind=12;isNoOp(){return!1}attemptToMerge(e){return null}}export{a as ContentSizeChangedEvent,d as CursorStateChangedEvent,c as FocusChangedEvent,D as HiddenAreasChangedEvent,j as ModelContentChangedEvent,z as ModelDecorationsChangedEvent,Z as ModelLanguageChangedEvent,q as ModelLanguageConfigurationChangedEvent,B as ModelOptionsChangedEvent,G as ModelTokensChangedEvent,C as OutgoingViewModelEventKind,R as ReadOnlyEditAttemptEvent,h as ScrollChangedEvent,F as ViewModelEventDispatcher,E as ViewModelEventsCollector,A as ViewZonesChangedEvent};
