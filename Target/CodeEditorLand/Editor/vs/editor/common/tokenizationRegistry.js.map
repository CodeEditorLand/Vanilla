{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/common/tokenizationRegistry.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Color } from '../../base/common/color.js';\nimport { Emitter, Event } from '../../base/common/event.js';\nimport { Disposable, IDisposable, toDisposable } from '../../base/common/lifecycle.js';\nimport { ITokenizationRegistry, ITokenizationSupportChangedEvent, ILazyTokenizationSupport } from './languages.js';\nimport { ColorId } from './encodedTokenAttributes.js';\n\nexport class TokenizationRegistry<TSupport> implements ITokenizationRegistry<TSupport> {\n\n\tprivate readonly _tokenizationSupports = new Map<string, TSupport>();\n\tprivate readonly _factories = new Map<string, TokenizationSupportFactoryData<TSupport>>();\n\n\tprivate readonly _onDidChange = new Emitter<ITokenizationSupportChangedEvent>();\n\tpublic readonly onDidChange: Event<ITokenizationSupportChangedEvent> = this._onDidChange.event;\n\n\tprivate _colorMap: Color[] | null;\n\n\tconstructor() {\n\t\tthis._colorMap = null;\n\t}\n\n\tpublic handleChange(languageIds: string[]): void {\n\t\tthis._onDidChange.fire({\n\t\t\tchangedLanguages: languageIds,\n\t\t\tchangedColorMap: false\n\t\t});\n\t}\n\n\tpublic register(languageId: string, support: TSupport): IDisposable {\n\t\tthis._tokenizationSupports.set(languageId, support);\n\t\tthis.handleChange([languageId]);\n\t\treturn toDisposable(() => {\n\t\t\tif (this._tokenizationSupports.get(languageId) !== support) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._tokenizationSupports.delete(languageId);\n\t\t\tthis.handleChange([languageId]);\n\t\t});\n\t}\n\n\tpublic get(languageId: string): TSupport | null {\n\t\treturn this._tokenizationSupports.get(languageId) || null;\n\t}\n\n\tpublic registerFactory(languageId: string, factory: ILazyTokenizationSupport<TSupport>): IDisposable {\n\t\tthis._factories.get(languageId)?.dispose();\n\t\tconst myData = new TokenizationSupportFactoryData(this, languageId, factory);\n\t\tthis._factories.set(languageId, myData);\n\t\treturn toDisposable(() => {\n\t\t\tconst v = this._factories.get(languageId);\n\t\t\tif (!v || v !== myData) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tthis._factories.delete(languageId);\n\t\t\tv.dispose();\n\t\t});\n\t}\n\n\tpublic async getOrCreate(languageId: string): Promise<TSupport | null> {\n\t\t// check first if the support is already set\n\t\tconst tokenizationSupport = this.get(languageId);\n\t\tif (tokenizationSupport) {\n\t\t\treturn tokenizationSupport;\n\t\t}\n\n\t\tconst factory = this._factories.get(languageId);\n\t\tif (!factory || factory.isResolved) {\n\t\t\t// no factory or factory.resolve already finished\n\t\t\treturn null;\n\t\t}\n\n\t\tawait factory.resolve();\n\n\t\treturn this.get(languageId);\n\t}\n\n\tpublic isResolved(languageId: string): boolean {\n\t\tconst tokenizationSupport = this.get(languageId);\n\t\tif (tokenizationSupport) {\n\t\t\treturn true;\n\t\t}\n\n\t\tconst factory = this._factories.get(languageId);\n\t\tif (!factory || factory.isResolved) {\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tpublic setColorMap(colorMap: Color[]): void {\n\t\tthis._colorMap = colorMap;\n\t\tthis._onDidChange.fire({\n\t\t\tchangedLanguages: Array.from(this._tokenizationSupports.keys()),\n\t\t\tchangedColorMap: true\n\t\t});\n\t}\n\n\tpublic getColorMap(): Color[] | null {\n\t\treturn this._colorMap;\n\t}\n\n\tpublic getDefaultBackground(): Color | null {\n\t\tif (this._colorMap && this._colorMap.length > ColorId.DefaultBackground) {\n\t\t\treturn this._colorMap[ColorId.DefaultBackground];\n\t\t}\n\t\treturn null;\n\t}\n}\n\nclass TokenizationSupportFactoryData<TSupport> extends Disposable {\n\n\tprivate _isDisposed: boolean = false;\n\tprivate _resolvePromise: Promise<void> | null = null;\n\tprivate _isResolved: boolean = false;\n\n\tpublic get isResolved(): boolean {\n\t\treturn this._isResolved;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _registry: TokenizationRegistry<TSupport>,\n\t\tprivate readonly _languageId: string,\n\t\tprivate readonly _factory: ILazyTokenizationSupport<TSupport>,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._isDisposed = true;\n\t\tsuper.dispose();\n\t}\n\n\tpublic async resolve(): Promise<void> {\n\t\tif (!this._resolvePromise) {\n\t\t\tthis._resolvePromise = this._create();\n\t\t}\n\t\treturn this._resolvePromise;\n\t}\n\n\tprivate async _create(): Promise<void> {\n\t\tconst value = await this._factory.tokenizationSupport;\n\t\tthis._isResolved = true;\n\t\tif (value && !this._isDisposed) {\n\t\t\tthis._register(this._registry.register(this._languageId, value));\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
