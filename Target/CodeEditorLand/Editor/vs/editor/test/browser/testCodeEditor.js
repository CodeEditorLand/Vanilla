import{DisposableStore as c,toDisposable as f}from"../../../base/common/lifecycle.js";import{mock as p}from"../../../base/test/common/mock.js";import"../../browser/config/editorConfiguration.js";import"../../browser/editorBrowser.js";import{ICodeEditorService as u}from"../../browser/services/codeEditorService.js";import"../../browser/view.js";import{CodeEditorWidget as T}from"../../browser/widget/codeEditor/codeEditorWidget.js";import"../../common/config/editorOptions.js";import"../../common/editorCommon.js";import{ILanguageService as I}from"../../common/languages/language.js";import{ILanguageConfigurationService as S}from"../../common/languages/languageConfigurationRegistry.js";import"../../common/model.js";import{IEditorWorkerService as C}from"../../common/services/editorWorker.js";import{ILanguageFeatureDebounceService as g,LanguageFeatureDebounceService as E}from"../../common/services/languageFeatureDebounce.js";import{ILanguageFeaturesService as x}from"../../common/services/languageFeatures.js";import{LanguageFeaturesService as b}from"../../common/services/languageFeaturesService.js";import{LanguageService as M}from"../../common/services/languageService.js";import{IModelService as w}from"../../common/services/model.js";import{ModelService as h}from"../../common/services/modelService.js";import{ITextResourcePropertiesService as y}from"../../common/services/textResourceConfiguration.js";import{ITreeSitterParserService as F}from"../../common/services/treeSitterParserService.js";import"../../common/viewModel/viewModelImpl.js";import{TestConfiguration as D}from"./config/testConfiguration.js";import{TestCodeEditorService as O,TestCommandService as V}from"./editorTestServices.js";import{TestTreeSitterParserService as A}from"../common/services/testTreeSitterService.js";import{TestLanguageConfigurationService as _}from"../common/modes/testLanguageConfigurationService.js";import{TestEditorWorkerService as B}from"../common/services/testEditorWorkerService.js";import{TestTextResourcePropertiesService as L}from"../common/services/testTextResourcePropertiesService.js";import{instantiateTextModel as P}from"../common/testTextModel.js";import{IAccessibilityService as W}from"../../../platform/accessibility/common/accessibility.js";import{TestAccessibilityService as k}from"../../../platform/accessibility/test/common/testAccessibilityService.js";import"../../../platform/actions/common/actions.js";import{IClipboardService as H}from"../../../platform/clipboard/common/clipboardService.js";import{TestClipboardService as K}from"../../../platform/clipboard/test/common/testClipboardService.js";import{ICommandService as N}from"../../../platform/commands/common/commands.js";import{IConfigurationService as R}from"../../../platform/configuration/common/configuration.js";import{TestConfigurationService as U}from"../../../platform/configuration/test/common/testConfigurationService.js";import{IContextKeyService as j}from"../../../platform/contextkey/common/contextkey.js";import{IDialogService as q}from"../../../platform/dialogs/common/dialogs.js";import{TestDialogService as z}from"../../../platform/dialogs/test/common/testDialogService.js";import{IEnvironmentService as G}from"../../../platform/environment/common/environment.js";import{SyncDescriptor as J}from"../../../platform/instantiation/common/descriptors.js";import"../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as Q}from"../../../platform/instantiation/common/serviceCollection.js";import{TestInstantiationService as X}from"../../../platform/instantiation/test/common/instantiationServiceMock.js";import{IKeybindingService as Y}from"../../../platform/keybinding/common/keybinding.js";import{MockContextKeyService as Z,MockKeybindingService as $}from"../../../platform/keybinding/test/common/mockKeybindingService.js";import{ILogService as ee,NullLogService as te}from"../../../platform/log/common/log.js";import{INotificationService as ie}from"../../../platform/notification/common/notification.js";import{TestNotificationService as oe}from"../../../platform/notification/test/common/testNotificationService.js";import{IOpenerService as re}from"../../../platform/opener/common/opener.js";import{NullOpenerService as ne}from"../../../platform/opener/test/common/nullOpenerService.js";import{ITelemetryService as se}from"../../../platform/telemetry/common/telemetry.js";import{NullTelemetryServiceShape as de}from"../../../platform/telemetry/common/telemetryUtils.js";import{IThemeService as ae}from"../../../platform/theme/common/themeService.js";import{TestThemeService as ce}from"../../../platform/theme/test/common/testThemeService.js";import{IUndoRedoService as me}from"../../../platform/undoRedo/common/undoRedo.js";import{UndoRedoService as le}from"../../../platform/undoRedo/common/undoRedoService.js";class ve extends T{_createConfiguration(t,i,e){return new D(e)}_createView(t){return[null,!1]}_hasTextFocus=!1;setHasTextFocus(t){this._hasTextFocus=t}hasTextFocus(){return this._hasTextFocus}getViewModel(){return this._modelData?this._modelData.viewModel:void 0}registerAndInstantiateContribution(t,i){const e=this._instantiationService.createInstance(i,this);return this._contributions.set(t,e),e}registerDisposable(t){this._register(t)}}class fe{parentElement=null;ownerDocument=document;document=document;setAttribute(t,i){}removeAttribute(t){}hasAttribute(t){return!1}getAttribute(t){}addEventListener(t){}removeEventListener(t){}}function Lt(o,t,i){return m(o,t,i)}async function Pt(o,t,i){return m(o,t,i)}function pe(o){return!!(o&&o.uri)}function m(o,t,i){const e=new c,r=l(e,t.serviceCollection);delete t.serviceCollection;let d;pe(o)?d=o:d=e.add(P(r,Array.isArray(o)?o.join(`
`):o));const n=e.add(v(r,d,t));n.getViewModel().setHasFocus(!0);const a=i(n,n.getViewModel(),r);if(a)return a.then(()=>e.dispose());e.dispose()}function l(o,t=new Q){const i=[],e=(n,s)=>{t.has(n)||t.set(n,new J(s)),i.push(n)},r=(n,s)=>{t.has(n)||t.set(n,s),i.push(n)};e(W,k),e(Y,$),e(H,K),e(C,B),r(re,ne),e(ie,oe),e(q,z),e(me,le),e(I,M),e(S,_),e(R,U),e(y,L),e(ae,ce),e(ee,te),e(w,h),e(u,O),e(j,Z),e(N,V),e(se,de),e(G,class extends p(){isBuilt=!0;isExtensionDevelopment=!1}),e(g,E),e(x,b),e(F,A);const d=o.add(new X(t,!0));return o.add(f(()=>{for(const n of i){const s=t.get(n);typeof s.dispose=="function"&&s.dispose()}})),d}function Wt(o,t={}){const i=new c,e=l(i,t.serviceCollection);delete t.serviceCollection;const r=v(e,o||null,t);return r.registerDisposable(i),r}function v(o,t,i={}){const e={contributions:[]},r=o.createInstance(ve,new fe,i,e);return typeof i.hasTextFocus>"u"&&(i.hasTextFocus=!0),r.setHasTextFocus(i.hasTextFocus),r.setModel(t),r.getViewModel()?.setHasFocus(i.hasTextFocus),r}export{ve as TestCodeEditor,l as createCodeEditorServices,Wt as createTestCodeEditor,v as instantiateTestCodeEditor,Pt as withAsyncTestCodeEditor,Lt as withTestCodeEditor};
