import f from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as p}from"../../../../base/test/common/utils.js";import{EditOperation as d}from"../../../common/core/editOperation.js";import{Position as h}from"../../../common/core/position.js";import{Range as n}from"../../../common/core/range.js";import{Selection as e}from"../../../common/core/selection.js";import{withTestCodeEditor as S}from"../testCodeEditor.js";function c(u,o,t,w,s){S(u,{},(a,r)=>{const i=a.getModel();r.setSelections("tests",o),i.applyEdits(t),f.deepStrictEqual(i.getLinesContent(),w);const g=r.getSelections();f.deepStrictEqual(g.map(l=>l.toString()),s.map(l=>l.toString()))})}suite("Editor Side Editing - collapsed selection",()=>{p(),test("replace at selection",()=>{c(["first","second line","third line","fourth"],[new e(1,1,1,1)],[d.replace(new e(1,1,1,1),"something ")],["something first","second line","third line","fourth"],[new e(1,11,1,11)])}),test("replace at selection 2",()=>{c(["first","second line","third line","fourth"],[new e(1,1,1,6)],[d.replace(new e(1,1,1,6),"something")],["something","second line","third line","fourth"],[new e(1,1,1,10)])}),test("insert at selection",()=>{c(["first","second line","third line","fourth"],[new e(1,1,1,1)],[d.insert(new h(1,1),"something ")],["something first","second line","third line","fourth"],[new e(1,11,1,11)])}),test("insert at selection sitting on max column",()=>{c(["first","second line","third line","fourth"],[new e(1,6,1,6)],[d.insert(new h(1,6),` something
new `)],["first something","new ","second line","third line","fourth"],[new e(2,5,2,5)])}),test("issue #3994: replace on top of selection",()=>{c(['$obj = New-Object "system.col"'],[new e(1,30,1,30)],[d.replaceMove(new n(1,19,1,31),'"System.Collections"')],['$obj = New-Object "System.Collections"'],[new e(1,39,1,39)])}),test("issue #15267: Suggestion that adds a line - cursor goes to the wrong line ",()=>{c(["package main","","import (",'	"fmt"',")","","func main(","	fmt.Println(strings.Con)","}"],[new e(8,25,8,25)],[d.replaceMove(new n(5,1,5,1),`	"strings"
`)],["package main","","import (",'	"fmt"','	"strings"',")","","func main(","	fmt.Println(strings.Con)","}"],[new e(9,25,9,25)])}),test("issue #15236: Selections broke after deleting text using vscode.TextEditor.edit ",()=>{c(["foofoofoo, foofoofoo, bar"],[new e(1,1,1,10),new e(1,12,1,21)],[d.replace(new n(1,1,1,10),""),d.replace(new n(1,12,1,21),"")],[", , bar"],[new e(1,1,1,1),new e(1,3,1,3)])})}),suite("SideEditing",()=>{p();const u=["My First Line","My Second Line","Third Line"];function o(w,s,a,r,i,g){S(u.join(`
`),{},(l,m)=>{m.setSelections("tests",[w]),l.getModel().applyEdits([{range:s,text:a,forceMoveMarkers:r}]);const b=m.getSelection();f.deepStrictEqual(b.toString(),i.toString(),g)})}function t(w,s,a,r){const i=new e(w.startLineNumber,w.startColumn,w.endLineNumber,w.endColumn);o(i,s,a,!1,r[0][0],"0-0-regular-no-force"),o(i,s,a,!0,r[1][0],"1-0-regular-force");const g=new e(w.endLineNumber,w.endColumn,w.startLineNumber,w.startColumn);o(g,s,a,!1,r[0][1],"0-1-inverse-no-force"),o(g,s,a,!0,r[1][1],"1-1-inverse-force")}suite("insert",()=>{suite("collapsed sel",()=>{test("before",()=>{t(new n(1,4,1,4),new n(1,3,1,3),"xx",[[new e(1,6,1,6),new e(1,6,1,6)],[new e(1,6,1,6),new e(1,6,1,6)]])}),test("equal",()=>{t(new n(1,4,1,4),new n(1,4,1,4),"xx",[[new e(1,6,1,6),new e(1,6,1,6)],[new e(1,6,1,6),new e(1,6,1,6)]])}),test("after",()=>{t(new n(1,4,1,4),new n(1,5,1,5),"xx",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])})}),suite("non-collapsed dec",()=>{test("before",()=>{t(new n(1,4,1,9),new n(1,3,1,3),"xx",[[new e(1,6,1,11),new e(1,11,1,6)],[new e(1,6,1,11),new e(1,11,1,6)]])}),test("start",()=>{t(new n(1,4,1,9),new n(1,4,1,4),"xx",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,6,1,11),new e(1,11,1,6)]])}),test("inside",()=>{t(new n(1,4,1,9),new n(1,5,1,5),"xx",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,4,1,11),new e(1,11,1,4)]])}),test("end",()=>{t(new n(1,4,1,9),new n(1,9,1,9),"xx",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,4,1,11),new e(1,11,1,4)]])}),test("after",()=>{t(new n(1,4,1,9),new n(1,10,1,10),"xx",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])})})}),suite("delete",()=>{suite("collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,4),new n(1,1,1,3),"",[[new e(1,2,1,2),new e(1,2,1,2)],[new e(1,2,1,2),new e(1,2,1,2)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,4),new n(1,2,1,4),"",[[new e(1,2,1,2),new e(1,2,1,2)],[new e(1,2,1,2),new e(1,2,1,2)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,4),new n(1,3,1,5),"",[[new e(1,3,1,3),new e(1,3,1,3)],[new e(1,3,1,3),new e(1,3,1,3)]])}),test("edit.start >= range.end",()=>{t(new n(1,4,1,4),new n(1,4,1,6),"",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,4),new n(1,5,1,7),"",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])})}),suite("non-collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,9),new n(1,1,1,3),"",[[new e(1,2,1,7),new e(1,7,1,2)],[new e(1,2,1,7),new e(1,7,1,2)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,9),new n(1,2,1,4),"",[[new e(1,2,1,7),new e(1,7,1,2)],[new e(1,2,1,7),new e(1,7,1,2)]])}),test("edit.start < range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,5),"",[[new e(1,3,1,7),new e(1,7,1,3)],[new e(1,3,1,7),new e(1,7,1,3)]])}),test("edit.start < range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,9),"",[[new e(1,3,1,3),new e(1,3,1,3)],[new e(1,3,1,3),new e(1,3,1,3)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,10),"",[[new e(1,3,1,3),new e(1,3,1,3)],[new e(1,3,1,3),new e(1,3,1,3)]])}),test("edit.start == range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,6),"",[[new e(1,4,1,7),new e(1,7,1,4)],[new e(1,4,1,7),new e(1,7,1,4)]])}),test("edit.start == range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,9),"",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start == range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,10),"",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,7),"",[[new e(1,4,1,7),new e(1,7,1,4)],[new e(1,4,1,7),new e(1,7,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,9),"",[[new e(1,4,1,5),new e(1,5,1,4)],[new e(1,4,1,5),new e(1,5,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,10),"",[[new e(1,4,1,5),new e(1,5,1,4)],[new e(1,4,1,5),new e(1,5,1,4)]])}),test("edit.start == range.end",()=>{t(new n(1,4,1,9),new n(1,9,1,11),"",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,9),new n(1,10,1,11),"",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])})})}),suite("replace short",()=>{suite("collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,4),new n(1,1,1,3),"c",[[new e(1,3,1,3),new e(1,3,1,3)],[new e(1,3,1,3),new e(1,3,1,3)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,4),new n(1,2,1,4),"c",[[new e(1,3,1,3),new e(1,3,1,3)],[new e(1,3,1,3),new e(1,3,1,3)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,4),new n(1,3,1,5),"c",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start >= range.end",()=>{t(new n(1,4,1,4),new n(1,4,1,6),"c",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,5,1,5),new e(1,5,1,5)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,4),new n(1,5,1,7),"c",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])})}),suite("non-collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,9),new n(1,1,1,3),"c",[[new e(1,3,1,8),new e(1,8,1,3)],[new e(1,3,1,8),new e(1,8,1,3)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,9),new n(1,2,1,4),"c",[[new e(1,3,1,8),new e(1,8,1,3)],[new e(1,3,1,8),new e(1,8,1,3)]])}),test("edit.start < range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,5),"c",[[new e(1,4,1,8),new e(1,8,1,4)],[new e(1,4,1,8),new e(1,8,1,4)]])}),test("edit.start < range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,9),"c",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,10),"c",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])}),test("edit.start == range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,6),"c",[[new e(1,4,1,8),new e(1,8,1,4)],[new e(1,5,1,8),new e(1,8,1,5)]])}),test("edit.start == range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,9),"c",[[new e(1,4,1,5),new e(1,5,1,4)],[new e(1,5,1,5),new e(1,5,1,5)]])}),test("edit.start == range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,10),"c",[[new e(1,4,1,5),new e(1,5,1,4)],[new e(1,5,1,5),new e(1,5,1,5)]])}),test("edit.start > range.start && edit.start < range.end && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,7),"c",[[new e(1,4,1,8),new e(1,8,1,4)],[new e(1,4,1,8),new e(1,8,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,9),"c",[[new e(1,4,1,6),new e(1,6,1,4)],[new e(1,4,1,6),new e(1,6,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,10),"c",[[new e(1,4,1,6),new e(1,6,1,4)],[new e(1,4,1,6),new e(1,6,1,4)]])}),test("edit.start == range.end",()=>{t(new n(1,4,1,9),new n(1,9,1,11),"c",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,10),new e(1,10,1,4)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,9),new n(1,10,1,11),"c",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])})})}),suite("replace long",()=>{suite("collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,4),new n(1,1,1,3),"cccc",[[new e(1,6,1,6),new e(1,6,1,6)],[new e(1,6,1,6),new e(1,6,1,6)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,4),new n(1,2,1,4),"cccc",[[new e(1,6,1,6),new e(1,6,1,6)],[new e(1,6,1,6),new e(1,6,1,6)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,4),new n(1,3,1,5),"cccc",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,7,1,7),new e(1,7,1,7)]])}),test("edit.start >= range.end",()=>{t(new n(1,4,1,4),new n(1,4,1,6),"cccc",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,8,1,8),new e(1,8,1,8)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,4),new n(1,5,1,7),"cccc",[[new e(1,4,1,4),new e(1,4,1,4)],[new e(1,4,1,4),new e(1,4,1,4)]])})}),suite("non-collapsed dec",()=>{test("edit.end < range.start",()=>{t(new n(1,4,1,9),new n(1,1,1,3),"cccc",[[new e(1,6,1,11),new e(1,11,1,6)],[new e(1,6,1,11),new e(1,11,1,6)]])}),test("edit.end <= range.start",()=>{t(new n(1,4,1,9),new n(1,2,1,4),"cccc",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,6,1,11),new e(1,11,1,6)]])}),test("edit.start < range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,5),"cccc",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,7,1,11),new e(1,11,1,7)]])}),test("edit.start < range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,9),"cccc",[[new e(1,4,1,7),new e(1,7,1,4)],[new e(1,7,1,7),new e(1,7,1,7)]])}),test("edit.start < range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,3,1,10),"cccc",[[new e(1,4,1,7),new e(1,7,1,4)],[new e(1,7,1,7),new e(1,7,1,7)]])}),test("edit.start == range.start && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,6),"cccc",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,8,1,11),new e(1,11,1,8)]])}),test("edit.start == range.start && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,9),"cccc",[[new e(1,4,1,8),new e(1,8,1,4)],[new e(1,8,1,8),new e(1,8,1,8)]])}),test("edit.start == range.start && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,4,1,10),"cccc",[[new e(1,4,1,8),new e(1,8,1,4)],[new e(1,8,1,8),new e(1,8,1,8)]])}),test("edit.start > range.start && edit.start < range.end && edit.end < range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,7),"cccc",[[new e(1,4,1,11),new e(1,11,1,4)],[new e(1,4,1,11),new e(1,11,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end == range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,9),"cccc",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])}),test("edit.start > range.start && edit.start < range.end && edit.end > range.end",()=>{t(new n(1,4,1,9),new n(1,5,1,10),"cccc",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])}),test("edit.start == range.end",()=>{t(new n(1,4,1,9),new n(1,9,1,11),"cccc",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,13),new e(1,13,1,4)]])}),test("edit.start > range.end",()=>{t(new n(1,4,1,9),new n(1,10,1,11),"cccc",[[new e(1,4,1,9),new e(1,9,1,4)],[new e(1,4,1,9),new e(1,9,1,4)]])})})})});
