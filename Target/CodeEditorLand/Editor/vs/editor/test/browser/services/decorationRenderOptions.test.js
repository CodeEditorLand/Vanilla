import t from"assert";import*as u from"../../../../base/common/platform.js";import{URI as c}from"../../../../base/common/uri.js";import{ensureNoDisposablesAreLeakedInTestSuite as b}from"../../../../base/test/common/utils.js";import"../../../common/editorCommon.js";import{TestCodeEditorService as i}from"../editorTestServices.js";import{TestColorTheme as m,TestThemeService as g}from"../../../../platform/theme/test/common/testThemeService.js";suite("Decoration Render Options",()=>{const a=b(),l=new g,p={gutterIconPath:c.parse("https://github.com/microsoft/vscode/blob/main/resources/linux/code.png"),gutterIconSize:"contain",backgroundColor:"red",borderColor:"yellow"};test("register and resolve decoration type",()=>{const e=a.add(new i(l));a.add(e.registerDecorationType("test","example",p)),t.notStrictEqual(e.resolveDecorationOptions("example",!1),void 0)}),test("remove decoration type",()=>{const e=a.add(new i(l));e.registerDecorationType("test","example",p),t.notStrictEqual(e.resolveDecorationOptions("example",!1),void 0),e.removeDecorationType("example"),t.throws(()=>e.resolveDecorationOptions("example",!1))});function n(e){return e.read()}test("css properties",()=>{const e=a.add(new i(l)),r=e.globalStyleSheet;a.add(e.registerDecorationType("test","example",p));const o=n(r);t(o.indexOf("{background:url('https://github.com/microsoft/vscode/blob/main/resources/linux/code.png') center center no-repeat;background-size:contain;}")>=0),t(o.indexOf("{background-color:red;border-color:yellow;box-sizing: border-box;}")>=0)}),test("theme color",()=>{const e={backgroundColor:{id:"editorBackground"},borderColor:{id:"editorBorder"}},r=new g(new m({editorBackground:"#FF0000"})),o=a.add(new i(r)),s=o.globalStyleSheet;o.registerDecorationType("test","example",e),t.strictEqual(n(s),".monaco-editor .ced-example-0 {background-color:#ff0000;border-color:transparent;box-sizing: border-box;}"),r.setTheme(new m({editorBackground:"#EE0000",editorBorder:"#00FFFF"})),t.strictEqual(n(s),".monaco-editor .ced-example-0 {background-color:#ee0000;border-color:#00ffff;box-sizing: border-box;}"),o.removeDecorationType("example"),t.strictEqual(n(s),"")}),test("theme overrides",()=>{const e={color:{id:"editorBackground"},light:{color:"#FF00FF"},dark:{color:"#000000",after:{color:{id:"infoForeground"}}}},r=new g(new m({editorBackground:"#FF0000",infoForeground:"#444444"})),o=a.add(new i(r)),s=o.globalStyleSheet;o.registerDecorationType("test","example",e);const d=[".vs-dark.monaco-editor .ced-example-4::after, .hc-black.monaco-editor .ced-example-4::after {color:#444444 !important;}",".vs-dark.monaco-editor .ced-example-1, .hc-black.monaco-editor .ced-example-1 {color:#000000 !important;}",".vs.monaco-editor .ced-example-1, .hc-light.monaco-editor .ced-example-1 {color:#FF00FF !important;}",".monaco-editor .ced-example-1 {color:#ff0000 !important;}"].join(`
`);t.strictEqual(n(s),d),o.removeDecorationType("example"),t.strictEqual(n(s),"")}),test("css properties, gutterIconPaths",()=>{const e=a.add(new i(l)),r=e.globalStyleSheet;e.registerDecorationType("test","example",{gutterIconPath:c.parse("data:image/svg+xml;base64,PHN2ZyB4b+")}),t(n(r).indexOf("{background:url('data:image/svg+xml;base64,PHN2ZyB4b+') center center no-repeat;}")>0),e.removeDecorationType("example");function o(s,d){const f=n(r);t(f.indexOf(`{background:url('${s}') center center no-repeat;}`)>0||f.indexOf(`{background:url('${d}') center center no-repeat;}`)>0)}u.isWindows?(e.registerDecorationType("test","example",{gutterIconPath:c.file("c:\\files\\miles\\more.png")}),o("file:///c:/files/miles/more.png","vscode-file://vscode-app/c:/files/miles/more.png"),e.removeDecorationType("example"),e.registerDecorationType("test","example",{gutterIconPath:c.file("c:\\files\\foo\\b'ar.png")}),o("file:///c:/files/foo/b%27ar.png","vscode-file://vscode-app/c:/files/foo/b%27ar.png"),e.removeDecorationType("example")):(e.registerDecorationType("test","example",{gutterIconPath:c.file("/Users/foo/bar.png")}),o("file:///Users/foo/bar.png","vscode-file://vscode-app/Users/foo/bar.png"),e.removeDecorationType("example"),e.registerDecorationType("test","example",{gutterIconPath:c.file("/Users/foo/b'ar.png")}),o("file:///Users/foo/b%27ar.png","vscode-file://vscode-app/Users/foo/b%27ar.png"),e.removeDecorationType("example")),e.registerDecorationType("test","example",{gutterIconPath:c.parse("http://test/pa'th")}),t(n(r).indexOf("{background:url('http://test/pa%27th') center center no-repeat;}")>0),e.removeDecorationType("example")})});
