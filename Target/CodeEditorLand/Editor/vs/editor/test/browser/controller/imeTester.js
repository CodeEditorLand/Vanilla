import{Position as L}from"../../../common/core/position.js";import{Range as A}from"../../../common/core/range.js";import"../../../common/model.js";import*as N from"../../../../base/browser/dom.js";import*as g from"../../../../base/browser/browser.js";import*as P from"../../../../base/common/platform.js";import{mainWindow as w}from"../../../../base/browser/window.js";import{TestAccessibilityService as y}from"../../../../platform/accessibility/test/common/testAccessibilityService.js";import{NullLogService as _}from"../../../../platform/log/common/log.js";import{PagedScreenReaderStrategy as v}from"../../../browser/controller/editContext/screenReaderUtils.js";import{TextAreaState as R}from"../../../browser/controller/editContext/textArea/textAreaEditContextState.js";import{TextAreaInput as k,TextAreaWrapper as O}from"../../../browser/controller/editContext/textArea/textAreaEditContextInput.js";class H{_line;constructor(e){this._line=e}_setText(e){this._line=e}getLineMaxColumn(e){return this._line.length+1}getValueInRange(e,n){return this._line.substring(e.startColumn-1,e.endColumn-1)}getValueLengthInRange(e,n){return this.getValueInRange(e,n).length}modifyPosition(e,n){const o=Math.min(this.getLineMaxColumn(e.lineNumber),Math.max(1,e.column+n));return new L(e.lineNumber,o)}getModelLineContent(e){return this._line}getLineCount(){return 1}}class F{_model;constructor(e){this._model=e}paint(e){N.clearNode(e);for(let n=1;n<=this._model.getLineCount();n++){const o=document.createTextNode(this._model.getModelLineContent(n));e.appendChild(o);const c=document.createElement("br");e.appendChild(c)}}}function V(s,e,n){let o=0,c=0;const i=document.createElement("div");i.className="container";const d=document.createElement("div");d.className="title";const x=document.createElement("strong");x.innerText=e,d.innerText=s+". Type ",d.appendChild(x),i.appendChild(d);const f=document.createElement("button");f.innerText="Start",i.appendChild(f);const l=document.createElement("textarea");l.setAttribute("rows","10"),l.setAttribute("cols","40"),i.appendChild(l);const u=new H("some  text"),M={getDataToCopy:()=>({isFromEmptySelection:!1,multicursorText:null,text:"",html:void 0,mode:null}),getScreenReaderContent:()=>{const t=new A(1,1+o,1,1+o+c),r=v.fromEditorSelection(u,t,10,!0);return R.fromScreenReaderContentState(r)},deduceModelPosition:(t,r,m)=>null},C=new k(M,new O(l),P.OS,{isAndroid:g.isAndroid,isFirefox:g.isFirefox,isChrome:g.isChrome,isSafari:g.isSafari},new y,new _),p=document.createElement("pre");p.className="output",i.appendChild(p);const a=document.createElement("pre");a.className="check",i.appendChild(a);const b=document.createElement("br");b.style.clear="both",i.appendChild(b);const T=new F(u),I=(t,r)=>{o=t,c=r,C.writeNativeTextAreaContent("selection changed"),C.focusTextArea()},S=(t,r,m)=>{u._setText(t),I(r,m),T.paint(p);const h="some "+n+" text";t===h?(a.innerText="[GOOD]",a.className="check good"):(a.innerText="[BAD]",a.className="check bad"),a.appendChild(document.createTextNode(h))};return C.onType(t=>{console.log("type text: "+t.text+", replaceCharCnt: "+t.replacePrevCharCnt);const r=u.getModelLineContent(1),m=r.substring(0,o-t.replacePrevCharCnt),h=r.substring(o+c),E=t.text;S(m+E+h,(m+E).length,0)}),T.paint(p),f.onclick=function(){S("some  text",5,0),l.focus()},i}const D=[{description:"Japanese IME 1",in:"sennsei [Enter]",out:"\u305B\u3093\u305B\u3044"},{description:"Japanese IME 2",in:"konnichiha [Enter]",out:"\u3053\u3093\u3044\u3061\u306F"},{description:"Japanese IME 3",in:"mikann [Enter]",out:"\u307F\u304B\u3093"},{description:"Korean IME 1",in:"gksrmf [Space]",out:"\uD55C\uAE00 "},{description:"Chinese IME 1",in:".,",out:"\u3002\uFF0C"},{description:"Chinese IME 2",in:"ni [Space] hao [Space]",out:"\u4F60\u597D"},{description:"Chinese IME 3",in:"hazni [Space]",out:"\u54C8\u795D\u4F60"},{description:"Mac dead key 1",in:"`.",out:"`."},{description:"Mac hold key 1",in:"e long press and 1",out:"\xE9"}];D.forEach(s=>{w.document.body.appendChild(V(s.description,s.in,s.out))});
