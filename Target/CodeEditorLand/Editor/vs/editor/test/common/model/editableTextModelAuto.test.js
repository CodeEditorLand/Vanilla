import{CharCode as c}from"../../../../base/common/charCode.js";import{ensureNoDisposablesAreLeakedInTestSuite as h}from"../../../../base/test/common/utils.js";import"../../../common/core/editOperation.js";import{Position as p}from"../../../common/core/position.js";import{Range as f}from"../../../common/core/range.js";import{testApplyEditsWithSyncedModels as l}from"./editableTextModelTestUtils.js";const d=!1;suite("EditorModel Auto Tests",()=>{h();function i(t,o,e,n,s){return{range:new f(t,o,e,n),text:s.join(`
`),forceMoveMarkers:!1}}test("auto1",()=>{l(["ioe","","yjct","",""],[i(1,2,1,2,["b","r","fq"]),i(1,4,2,1,["",""])],["ib","r","fqoe","","yjct","",""])}),test("auto2",()=>{l(["f","littnhskrq","utxvsizqnk","lslqz","jxn","gmm"],[i(1,2,1,2,["","o"]),i(2,4,2,4,["zaq","avb"]),i(2,5,6,2,["jlr","zl","j"])],["f","o","litzaq","avbtjlr","zl","jmm"])}),test("auto3",()=>{l(["ofw","qsxmziuvzw","rp","qsnymek","elth","wmgzbwudxz","iwsdkndh","bujlbwb","asuouxfv","xuccnb"],[i(4,3,4,3,[""])],["ofw","qsxmziuvzw","rp","qsnymek","elth","wmgzbwudxz","iwsdkndh","bujlbwb","asuouxfv","xuccnb"])}),test("auto4",()=>{l(["fefymj","qum","vmiwxxaiqq","dz","lnqdgorosf"],[i(1,3,1,5,["hp"]),i(1,7,2,1,["kcg","","mpx"]),i(2,2,2,2,["","aw",""]),i(2,2,2,2,["vqr","mo"]),i(4,2,5,3,["xyc"])],["fehpmjkcg","","mpxq","aw","vqr","moum","vmiwxxaiqq","dxycqdgorosf"])})});function r(i,t){return Math.floor(Math.random()*(t-i+1))+i}function b(i,t){const o=r(i,t);let e="";for(let n=0;n<o;n++)e+=String.fromCharCode(r(c.a,c.z));return e}function m(i){const t=r(1,i?3:10),o=[];for(let e=0;e<t;e++)o.push(b(0,i?3:10));return o.join(`
`)}function x(i){const t=[];let o=r(1,5),e=i.length;for(;o>0&&e>0;){const n=r(0,e),s=r(0,e-n),u=m(!0);t.push({offset:n,length:s,text:u}),e=n,o--}return t.reverse(),t}class a{initialContent;resultingContent;edits;static _generateOffsetToPosition(t){const o=[];let e=1,n=1;for(let s=0,u=t.length;s<=u;s++){const g=t.charAt(s);o[s]=new p(e,n),g===`
`?(e++,n=1):n++}return o}constructor(){this.initialContent=m(!1);const t=x(this.initialContent),o=a._generateOffsetToPosition(this.initialContent);this.edits=[];for(const e of t){const n=o[e.offset],s=o[e.offset+e.length];this.edits.push({range:new f(n.lineNumber,n.column,s.lineNumber,s.column),text:e.text})}this.resultingContent=this.initialContent;for(let e=t.length-1;e>=0;e--)this.resultingContent=this.resultingContent.substring(0,t[e].offset)+t[e].text+this.resultingContent.substring(t[e].offset+t[e].length)}print(){let t=[];t.push("testApplyEditsWithSyncedModels("),t.push("	[");const o=this.initialContent.split(`
`);t=t.concat(o.map(n=>`		'${n}',`)),t.push("	],"),t.push("	["),t=t.concat(this.edits.map(n=>{const s="['"+n.text.split(`
`).join("', '")+"']";return`		editOp(${n.range.startLineNumber}, ${n.range.startColumn}, ${n.range.endLineNumber}, ${n.range.endColumn}, ${s}),`})),t.push("	],"),t.push("	[");const e=this.resultingContent.split(`
`);return t=t.concat(e.map(n=>`		'${n}',`)),t.push("	]"),t.push(");"),t.join(`
`)}}if(d){let i=1;for(;;){console.log("------BEGIN NEW TEST: "+i);const t=new a;console.log("------END NEW TEST: "+i++);try{l(t.initialContent.split(`
`),t.edits,t.resultingContent.split(`
`))}catch(o){console.log(o),console.log(t.print());break}}}
