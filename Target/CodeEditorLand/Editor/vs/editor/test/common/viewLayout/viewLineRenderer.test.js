import t from"assert";import{CharCode as L}from"../../../../base/common/charCode.js";import*as q from"../../../../base/common/strings.js";import{ensureNoDisposablesAreLeakedInTestSuite as T}from"../../../../base/test/common/utils.js";import{MetadataConsts as C}from"../../../common/encodedTokenAttributes.js";import"../../../common/tokens/lineTokens.js";import{LineDecoration as o}from"../../../common/viewLayout/lineDecorations.js";import{DomPosition as y,LineRange as w,RenderLineInput as u,renderViewLine2 as p}from"../../../common/viewLayout/viewLineRenderer.js";import{InlineDecorationType as m}from"../../../common/viewModel.js";import{TestLineToken as E,TestLineTokens as P}from"../core/testLineToken.js";function c(n){return new P(n)}function a(n,r){return new E(n,r<<C.FOREGROUND_OFFSET>>>0)}function i(n){let r=n.html;r.startsWith("<span>")&&(r=r.replace(/^<span>/,"")),r=r.replace(/<\/span>$/,"");const s=[];let e=0;do{const l=r.indexOf("<span",e+1);if(l===-1)break;s.push(r.substring(e,l)),e=l}while(!0);return s.push(r.substring(e)),{html:s,mapping:n.characterMapping.inflate()}}suite("viewLineRenderer.renderLine",()=>{T();function n(s,e,l,d){const k=p(new u(!1,!0,s,!1,q.isBasicASCII(s),!1,0,c([new E(s.length,0)]),[],e,0,0,0,0,-1,"none",!1,!1,null));t.strictEqual(k.html,'<span><span class="mtk0">'+l+"</span></span>");const f=d.map(h=>[h,[0,h]]);S(k.characterMapping,f)}test("replaces spaces",()=>{n(" ",4,"\xA0",[0,1]),n("  ",4,"\xA0\xA0",[0,1,2]),n("a  b",4,"a\xA0\xA0b",[0,1,2,3,4])}),test("escapes HTML markup",()=>{n("a<b",4,"a&lt;b",[0,1,2,3]),n("a>b",4,"a&gt;b",[0,1,2,3]),n("a&b",4,"a&amp;b",[0,1,2,3])}),test("replaces some bad characters",()=>{n("a\0b",4,"a&#00;b",[0,1,2,3]),n("a"+String.fromCharCode(L.UTF8_BOM)+"b",4,"a\uFFFDb",[0,1,2,3]),n("a\u2028b",4,"a\uFFFDb",[0,1,2,3])}),test("handles tabs",()=>{n("	",4,"\xA0\xA0\xA0\xA0",[0,4]),n("x	",4,"x\xA0\xA0\xA0",[0,1,4]),n("xx	",4,"xx\xA0\xA0",[0,1,2,4]),n("xxx	",4,"xxx\xA0",[0,1,2,3,4]),n("xxxx	",4,"xxxx\xA0\xA0\xA0\xA0",[0,1,2,3,4,8])});function r(s,e,l,d,k){const f=p(new u(!1,!0,s,!1,!0,!1,0,c(l),[],e,0,0,0,0,-1,"none",!1,!1,null));t.strictEqual(f.html,"<span>"+d+"</span>"),S(f.characterMapping,k)}test("empty line",()=>{r("",4,[],"<span></span>",[])}),test("uses part type",()=>{r("x",4,[a(1,10)],'<span class="mtk10">x</span>',[[0,[0,0]],[1,[0,1]]]),r("x",4,[a(1,20)],'<span class="mtk20">x</span>',[[0,[0,0]],[1,[0,1]]]),r("x",4,[a(1,30)],'<span class="mtk30">x</span>',[[0,[0,0]],[1,[0,1]]])}),test("two parts",()=>{r("xy",4,[a(1,1),a(2,2)],'<span class="mtk1">x</span><span class="mtk2">y</span>',[[0,[0,0]],[1,[1,0]],[2,[1,1]]]),r("xyz",4,[a(1,1),a(3,2)],'<span class="mtk1">x</span><span class="mtk2">yz</span>',[[0,[0,0]],[1,[1,0]],[2,[1,1]],[3,[1,2]]]),r("xyz",4,[a(2,1),a(3,2)],'<span class="mtk1">xy</span><span class="mtk2">z</span>',[[0,[0,0]],[1,[0,1]],[2,[1,0]],[3,[1,1]]])}),test("overflow",()=>{const s=p(new u(!1,!0,"Hello world!",!1,!0,!1,0,c([a(1,0),a(2,1),a(3,2),a(4,3),a(5,4),a(6,5),a(7,6),a(8,7),a(9,8),a(10,9),a(11,10),a(12,11)]),[],4,0,10,10,10,6,"boundary",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk0">H</span>','<span class="mtk1">e</span>','<span class="mtk2">l</span>','<span class="mtk3">l</span>','<span class="mtk4">o</span>','<span class="mtk5">\xA0</span>','<span class="mtkoverflow">Show more (6 chars)</span>'],mapping:[[0,0,0],[1,0,1],[2,0,2],[3,0,3],[4,0,4],[5,0,5],[5,1,6]]})}),test("typical line",()=>{const s="	    export class Game { // http://test.com     ",e=c([a(5,1),a(11,2),a(12,3),a(17,4),a(18,5),a(22,6),a(23,7),a(24,8),a(25,9),a(28,10),a(43,11),a(48,12)]),l=p(new u(!1,!0,s,!1,!0,!1,0,e,[],4,0,10,10,10,-1,"boundary",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtk2">export</span>','<span class="mtk3">\xA0</span>','<span class="mtk4">class</span>','<span class="mtk5">\xA0</span>','<span class="mtk6">Game</span>','<span class="mtk7">\xA0</span>','<span class="mtk8">{</span>','<span class="mtk9">\xA0</span>','<span class="mtk10">//\xA0</span>','<span class="mtk11">http://test.com</span>','<span class="mtkz" style="width:20px">\xB7\u200C\xB7\u200C</span>','<span class="mtkz" style="width:30px">\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[1,0,4],[1,2,5],[1,4,6],[1,6,7],[2,0,8],[2,1,9],[2,2,10],[2,3,11],[2,4,12],[2,5,13],[3,0,14],[4,0,15],[4,1,16],[4,2,17],[4,3,18],[4,4,19],[5,0,20],[6,0,21],[6,1,22],[6,2,23],[6,3,24],[7,0,25],[8,0,26],[9,0,27],[10,0,28],[10,1,29],[10,2,30],[11,0,31],[11,1,32],[11,2,33],[11,3,34],[11,4,35],[11,5,36],[11,6,37],[11,7,38],[11,8,39],[11,9,40],[11,10,41],[11,11,42],[11,12,43],[11,13,44],[11,14,45],[12,0,46],[12,2,47],[13,0,48],[13,2,49],[13,4,50],[13,6,51]]})}),test("issue #2255: Weird line rendering part 1",()=>{const s="			cursorStyle:						(prevOpts.cursorStyle !== newOpts.cursorStyle),",e=c([a(3,1),a(15,2),a(21,3),a(22,4),a(43,5),a(45,6),a(46,7),a(66,8),a(67,9),a(68,10)]),l=p(new u(!1,!0,s,!1,!0,!1,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="mtk1">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtk2">cursorStyle:</span>','<span class="mtk3">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtk4">(</span>','<span class="mtk5">prevOpts.cursorStyle\xA0</span>','<span class="mtk6">!=</span>','<span class="mtk7">=</span>','<span class="mtk8">\xA0newOpts.cursorStyle</span>','<span class="mtk9">)</span>','<span class="mtk10">,</span>'],mapping:[[0,0,0],[0,4,4],[0,8,8],[1,0,12],[1,1,13],[1,2,14],[1,3,15],[1,4,16],[1,5,17],[1,6,18],[1,7,19],[1,8,20],[1,9,21],[1,10,22],[1,11,23],[2,0,24],[2,4,28],[2,8,32],[2,12,36],[2,16,40],[2,20,44],[3,0,48],[4,0,49],[4,1,50],[4,2,51],[4,3,52],[4,4,53],[4,5,54],[4,6,55],[4,7,56],[4,8,57],[4,9,58],[4,10,59],[4,11,60],[4,12,61],[4,13,62],[4,14,63],[4,15,64],[4,16,65],[4,17,66],[4,18,67],[4,19,68],[4,20,69],[5,0,70],[5,1,71],[6,0,72],[7,0,73],[7,1,74],[7,2,75],[7,3,76],[7,4,77],[7,5,78],[7,6,79],[7,7,80],[7,8,81],[7,9,82],[7,10,83],[7,11,84],[7,12,85],[7,13,86],[7,14,87],[7,15,88],[7,16,89],[7,17,90],[7,18,91],[7,19,92],[8,0,93],[9,0,94],[9,1,95]]})}),test("issue #2255: Weird line rendering part 2",()=>{const s=" 			cursorStyle:						(prevOpts.cursorStyle !== newOpts.cursorStyle),",e=c([a(4,1),a(16,2),a(22,3),a(23,4),a(44,5),a(46,6),a(47,7),a(67,8),a(68,9),a(69,10)]),l=p(new u(!1,!0,s,!1,!0,!1,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="mtk1">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtk2">cursorStyle:</span>','<span class="mtk3">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtk4">(</span>','<span class="mtk5">prevOpts.cursorStyle\xA0</span>','<span class="mtk6">!=</span>','<span class="mtk7">=</span>','<span class="mtk8">\xA0newOpts.cursorStyle</span>','<span class="mtk9">)</span>','<span class="mtk10">,</span>'],mapping:[[0,0,0],[0,1,1],[0,4,4],[0,8,8],[1,0,12],[1,1,13],[1,2,14],[1,3,15],[1,4,16],[1,5,17],[1,6,18],[1,7,19],[1,8,20],[1,9,21],[1,10,22],[1,11,23],[2,0,24],[2,4,28],[2,8,32],[2,12,36],[2,16,40],[2,20,44],[3,0,48],[4,0,49],[4,1,50],[4,2,51],[4,3,52],[4,4,53],[4,5,54],[4,6,55],[4,7,56],[4,8,57],[4,9,58],[4,10,59],[4,11,60],[4,12,61],[4,13,62],[4,14,63],[4,15,64],[4,16,65],[4,17,66],[4,18,67],[4,19,68],[4,20,69],[5,0,70],[5,1,71],[6,0,72],[7,0,73],[7,1,74],[7,2,75],[7,3,76],[7,4,77],[7,5,78],[7,6,79],[7,7,80],[7,8,81],[7,9,82],[7,10,83],[7,11,84],[7,12,85],[7,13,86],[7,14,87],[7,15,88],[7,16,89],[7,17,90],[7,18,91],[7,19,92],[8,0,93],[9,0,94],[9,1,95]]})}),test("issue #91178: after decoration type shown before cursor",()=>{const s="//just a comment",e=c([a(16,1)]),l=p(new u(!0,!1,s,!1,!0,!1,0,e,[new o(13,13,"dec1",m.After),new o(13,13,"dec2",m.Before)],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="mtk1">//just\xA0a\xA0com</span>','<span class="mtk1 dec2"></span>','<span class="mtk1 dec1"></span>','<span class="mtk1">ment</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[2,0,12],[3,1,13],[3,2,14],[3,3,15],[3,4,16]]})}),test("issue microsoft/monaco-editor#280: Improved source code rendering for RTL languages",()=>{const s=`var \u05E7\u05D5\u05D3\u05DE\u05D5\u05EA = "\u05DE\u05D9\u05D5\u05EA\u05E8 \u05E7\u05D5\u05D3\u05DE\u05D5\u05EA \u05E6'\u05D8 \u05E9\u05DC, \u05D0\u05DD \u05DC\u05E9\u05D5\u05DF \u05D4\u05E2\u05D1\u05E8\u05D9\u05EA \u05E9\u05D9\u05E0\u05D5\u05D9\u05D9\u05DD \u05D5\u05D9\u05E9, \u05D0\u05DD";`,e=c([a(3,6),a(13,1),a(66,20),a(67,1)]),l=p(new u(!1,!0,s,!1,!1,!0,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span dir="ltr">','<span class="mtk6">var</span>','<span style="unicode-bidi:isolate" class="mtk1">\xA0\u05E7\u05D5\u05D3\u05DE\u05D5\u05EA\xA0=\xA0</span>',`<span style="unicode-bidi:isolate" class="mtk20">"\u05DE\u05D9\u05D5\u05EA\u05E8\xA0\u05E7\u05D5\u05D3\u05DE\u05D5\u05EA\xA0\u05E6'\u05D8\xA0\u05E9\u05DC,\xA0\u05D0\u05DD\xA0\u05DC\u05E9\u05D5\u05DF\xA0\u05D4\u05E2\u05D1\u05E8\u05D9\u05EA\xA0\u05E9\u05D9\u05E0\u05D5\u05D9\u05D9\u05DD\xA0\u05D5\u05D9\u05E9,\xA0\u05D0\u05DD"</span>`,'<span class="mtk1">;</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[1,0,3],[1,1,4],[1,2,5],[1,3,6],[1,4,7],[1,5,8],[1,6,9],[1,7,10],[1,8,11],[1,9,12],[2,0,13],[2,1,14],[2,2,15],[2,3,16],[2,4,17],[2,5,18],[2,6,19],[2,7,20],[2,8,21],[2,9,22],[2,10,23],[2,11,24],[2,12,25],[2,13,26],[2,14,27],[2,15,28],[2,16,29],[2,17,30],[2,18,31],[2,19,32],[2,20,33],[2,21,34],[2,22,35],[2,23,36],[2,24,37],[2,25,38],[2,26,39],[2,27,40],[2,28,41],[2,29,42],[2,30,43],[2,31,44],[2,32,45],[2,33,46],[2,34,47],[2,35,48],[2,36,49],[2,37,50],[2,38,51],[2,39,52],[2,40,53],[2,41,54],[2,42,55],[2,43,56],[2,44,57],[2,45,58],[2,46,59],[2,47,60],[2,48,61],[2,49,62],[2,50,63],[2,51,64],[2,52,65],[3,0,66],[3,1,67]]}),t.strictEqual(l.containsRTL,!0)}),test("issue #137036: Issue in RTL languages in recent versions",()=>{const s='<option value="\u0627\u0644\u0639\u0631\u0628\u064A\u0629">\u0627\u0644\u0639\u0631\u0628\u064A\u0629</option>',e=c([a(1,2),a(7,3),a(8,4),a(13,5),a(14,4),a(23,6),a(24,2),a(31,4),a(33,2),a(39,3),a(40,2)]),l=p(new u(!1,!0,s,!1,!1,!0,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span dir="ltr">','<span class="mtk2">&lt;</span>','<span class="mtk3">option</span>','<span class="mtk4">\xA0</span>','<span class="mtk5">value</span>','<span class="mtk4">=</span>','<span style="unicode-bidi:isolate" class="mtk6">"\u0627\u0644\u0639\u0631\u0628\u064A\u0629"</span>','<span class="mtk2">&gt;</span>','<span style="unicode-bidi:isolate" class="mtk4">\u0627\u0644\u0639\u0631\u0628\u064A\u0629</span>','<span class="mtk2">&lt;/</span>','<span class="mtk3">option</span>','<span class="mtk2">&gt;</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[1,3,4],[1,4,5],[1,5,6],[2,0,7],[3,0,8],[3,1,9],[3,2,10],[3,3,11],[3,4,12],[4,0,13],[5,0,14],[5,1,15],[5,2,16],[5,3,17],[5,4,18],[5,5,19],[5,6,20],[5,7,21],[5,8,22],[6,0,23],[7,0,24],[7,1,25],[7,2,26],[7,3,27],[7,4,28],[7,5,29],[7,6,30],[8,0,31],[8,1,32],[9,0,33],[9,1,34],[9,2,35],[9,3,36],[9,4,37],[9,5,38],[10,0,39],[10,1,40]]}),t.strictEqual(l.containsRTL,!0)}),test("issue #99589: Rendering whitespace influences bidi layout",()=>{const s='    ["\u{1F5A8}\uFE0F \u0686\u0627\u067E \u0641\u0627\u06A9\u062A\u0648\u0631","\u{1F3A8} \u062A\u0646\u0638\u06CC\u0645\u0627\u062A"]',e=c([a(5,2),a(21,3),a(22,2),a(34,3),a(35,2)]),l=p(new u(!0,!0,s,!1,!1,!0,0,e,[],4,0,10,10,10,-1,"all",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span dir="ltr">','<span class="mtkw">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtk2">[</span>','<span style="unicode-bidi:isolate" class="mtk3">"\u{1F5A8}\uFE0F\xA0\u0686\u0627\u067E\xA0\u0641\u0627\u06A9\u062A\u0648\u0631"</span>','<span class="mtk2">,</span>','<span style="unicode-bidi:isolate" class="mtk3">"\u{1F3A8}\xA0\u062A\u0646\u0638\u06CC\u0645\u0627\u062A"</span>','<span class="mtk2">]</span>'],mapping:[[0,0,0],[0,2,1],[0,4,2],[0,6,3],[1,0,4],[2,0,5],[2,1,6],[2,2,7],[2,3,8],[2,4,9],[2,5,10],[2,6,11],[2,7,12],[2,8,13],[2,9,14],[2,10,15],[2,11,16],[2,12,17],[2,13,18],[2,14,19],[2,15,20],[3,0,21],[4,0,22],[4,1,23],[4,2,24],[4,3,25],[4,4,26],[4,5,27],[4,6,28],[4,7,29],[4,8,30],[4,9,31],[4,10,32],[4,11,33],[5,0,34],[5,1,35]]}),t.strictEqual(l.containsRTL,!0)}),test("issue #6885: Splits large tokens",()=>{const s="This is just a long line that contains very interesting text. This is just a long line that contains very interesting text.";function e(l,d,k){const f=c([a(d.length,1)]),h=p(new u(!1,!0,d,!1,!0,!1,0,f,[],4,0,10,10,10,-1,"none",!1,!1,null));t.strictEqual(h.html,"<span>"+k.join("")+"</span>",l)}e("49 chars",s.substr(0,49),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0inter</span>']),e("50 chars",s.substr(0,50),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0intere</span>']),e("51 chars",s.substr(0,51),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0intere</span>','<span class="mtk1">s</span>']),e("99 chars",s.substr(0,99),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0intere</span>','<span class="mtk1">sting\xA0text.\xA0This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contain</span>']),e("100 chars",s.substr(0,100),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0intere</span>','<span class="mtk1">sting\xA0text.\xA0This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains</span>']),e("101 chars",s.substr(0,101),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0intere</span>','<span class="mtk1">sting\xA0text.\xA0This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains</span>','<span class="mtk1">\xA0</span>'])}),test("issue #21476: Does not split large tokens when ligatures are on",()=>{const s="This is just a long line that contains very interesting text. This is just a long line that contains very interesting text.";function e(l,d,k){const f=c([a(d.length,1)]),h=p(new u(!1,!0,d,!1,!0,!1,0,f,[],4,0,10,10,10,-1,"none",!1,!0,null));t.strictEqual(h.html,"<span>"+k.join("")+"</span>",l)}e("101 chars",s.substr(0,101),['<span class="mtk1">This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0contains\xA0very\xA0</span>','<span class="mtk1">interesting\xA0text.\xA0This\xA0is\xA0just\xA0a\xA0long\xA0line\xA0that\xA0</span>','<span class="mtk1">contains\xA0</span>'])}),test("issue #20624: Unaligned surrogate pairs are corrupted at multiples of 50 columns",()=>{const s="a\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}",e=c([a(s.length,1)]),l=p(new u(!1,!0,s,!1,!1,!1,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l).html,['<span class="mtk1">a\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}\u{20BB7}</span>'])}),test("issue #6885: Does not split large tokens in RTL text",()=>{const s="\u05D0\u05EA \u05D2\u05E8\u05DE\u05E0\u05D9\u05EA \u05D1\u05D4\u05EA\u05D9\u05D9\u05D7\u05E1\u05D5\u05EA \u05E9\u05DE\u05D5, \u05E9\u05E0\u05EA\u05D9 \u05D4\u05DE\u05E9\u05E4\u05D8 \u05D0\u05DC \u05D7\u05E4\u05E9, \u05D0\u05DD \u05DB\u05EA\u05D1 \u05D0\u05D7\u05E8\u05D9\u05DD \u05D5\u05DC\u05D7\u05D1\u05E8. \u05E9\u05DC \u05D4\u05EA\u05D5\u05DB\u05DF \u05D0\u05D5\u05D3\u05D5\u05EA \u05D1\u05D5\u05D9\u05E7\u05D9\u05E4\u05D3\u05D9\u05D4 \u05DB\u05DC\u05DC, \u05E9\u05DC \u05E2\u05D6\u05E8\u05D4 \u05DB\u05D9\u05DE\u05D9\u05D4 \u05D4\u05D9\u05D0. \u05E2\u05DC \u05E2\u05DE\u05D5\u05D3 \u05D9\u05D5\u05E6\u05E8\u05D9\u05DD \u05DE\u05D9\u05EA\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4 \u05E1\u05D3\u05E8, \u05D0\u05DD \u05E9\u05DB\u05DC \u05E9\u05EA\u05E4\u05D5 \u05DC\u05E2\u05D1\u05E8\u05D9\u05EA \u05E9\u05D9\u05E0\u05D5\u05D9\u05D9\u05DD, \u05D0\u05DD \u05E9\u05D0\u05DC\u05D5\u05EA \u05D0\u05E0\u05D2\u05DC\u05D9\u05EA \u05E2\u05D6\u05D4. \u05E9\u05DE\u05D5\u05EA \u05D1\u05E7\u05DC\u05D5\u05EA \u05DE\u05D4 \u05E1\u05D3\u05E8.",e=c([a(s.length,1)]),l=p(new u(!1,!0,s,!1,!1,!0,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(l.html,['<span dir="ltr">','<span style="unicode-bidi:isolate" class="mtk1">\u05D0\u05EA\xA0\u05D2\u05E8\u05DE\u05E0\u05D9\u05EA\xA0\u05D1\u05D4\u05EA\u05D9\u05D9\u05D7\u05E1\u05D5\u05EA\xA0\u05E9\u05DE\u05D5,\xA0\u05E9\u05E0\u05EA\u05D9\xA0\u05D4\u05DE\u05E9\u05E4\u05D8\xA0\u05D0\u05DC\xA0\u05D7\u05E4\u05E9,\xA0\u05D0\u05DD\xA0\u05DB\u05EA\u05D1\xA0\u05D0\u05D7\u05E8\u05D9\u05DD\xA0\u05D5\u05DC\u05D7\u05D1\u05E8.\xA0\u05E9\u05DC\xA0\u05D4\u05EA\u05D5\u05DB\u05DF\xA0\u05D0\u05D5\u05D3\u05D5\u05EA\xA0\u05D1\u05D5\u05D9\u05E7\u05D9\u05E4\u05D3\u05D9\u05D4\xA0\u05DB\u05DC\u05DC,\xA0\u05E9\u05DC\xA0\u05E2\u05D6\u05E8\u05D4\xA0\u05DB\u05D9\u05DE\u05D9\u05D4\xA0\u05D4\u05D9\u05D0.\xA0\u05E2\u05DC\xA0\u05E2\u05DE\u05D5\u05D3\xA0\u05D9\u05D5\u05E6\u05E8\u05D9\u05DD\xA0\u05DE\u05D9\u05EA\u05D5\u05DC\u05D5\u05D2\u05D9\u05D4\xA0\u05E1\u05D3\u05E8,\xA0\u05D0\u05DD\xA0\u05E9\u05DB\u05DC\xA0\u05E9\u05EA\u05E4\u05D5\xA0\u05DC\u05E2\u05D1\u05E8\u05D9\u05EA\xA0\u05E9\u05D9\u05E0\u05D5\u05D9\u05D9\u05DD,\xA0\u05D0\u05DD\xA0\u05E9\u05D0\u05DC\u05D5\u05EA\xA0\u05D0\u05E0\u05D2\u05DC\u05D9\u05EA\xA0\u05E2\u05D6\u05D4.\xA0\u05E9\u05DE\u05D5\u05EA\xA0\u05D1\u05E7\u05DC\u05D5\u05EA\xA0\u05DE\u05D4\xA0\u05E1\u05D3\u05E8.</span>',"</span>"].join("")),t.strictEqual(l.containsRTL,!0)}),test("issue #95685: Uses unicode replacement character for Paragraph Separator",()=>{const s='var ftext = [\u2029"Und", "dann", "eines"];',e=c([a(s.length,1)]),l=p(new u(!1,!0,s,!1,!1,!1,0,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="mtk1">var\xA0ftext\xA0=\xA0[\uFFFD"Und",\xA0"dann",\xA0"eines"];</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38]]})}),test("issue #19673: Monokai Theme bad-highlighting in line wrap",()=>{const s="    MongoCallback<string>): void {",e=c([a(17,1),a(18,2),a(24,3),a(26,4),a(27,5),a(28,6),a(32,7),a(34,8)]),l=p(new u(!0,!0,s,!1,!0,!1,4,e,[],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(l),{html:['<span class="">\xA0\xA0\xA0\xA0</span>','<span class="mtk1">MongoCallback</span>','<span class="mtk2">&lt;</span>','<span class="mtk3">string</span>','<span class="mtk4">&gt;)</span>','<span class="mtk5">:</span>','<span class="mtk6">\xA0</span>','<span class="mtk7">void</span>','<span class="mtk8">\xA0{</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[1,0,4],[1,1,5],[1,2,6],[1,3,7],[1,4,8],[1,5,9],[1,6,10],[1,7,11],[1,8,12],[1,9,13],[1,10,14],[1,11,15],[1,12,16],[2,0,17],[3,0,18],[3,1,19],[3,2,20],[3,3,21],[3,4,22],[3,5,23],[4,0,24],[4,1,25],[5,0,26],[6,0,27],[7,0,28],[7,1,29],[7,2,30],[7,3,31],[8,0,32],[8,1,33],[8,2,34]]})})});function S(n,r){for(let s=0;s<r.length;s++){const[e,[l,d]]=r[s],k=n.getDomPosition(s+1);t.deepStrictEqual(k,new y(l,d),`getDomPosition(${s+1})`);let f=d+1;for(let b=s+1;b<r.length;b++){const[,[x,z]]=r[b];if(x===l)f=z+1;else break}const h=n.getColumn(new y(l,d),f);t.strictEqual(h,s+1,`actual.getColumn(${l}, ${d})`);const g=n.getHorizontalOffset(s+1);t.strictEqual(g,e,`actual.getHorizontalOffset(${s+1})`)}t.strictEqual(n.length,r.length,"length mismatch")}suite("viewLineRenderer.renderLine 2",()=>{T();function n(s,e,l,d,k,f){const h=p(new u(s,!0,e,!1,!0,!1,d,c(l),[],4,0,10,10,10,-1,k,!1,!1,f));return i(h)}test("issue #18616: Inline decorations ending at the text length are no longer rendered",()=>{const s="https://microsoft.com",e=p(new u(!1,!0,s,!1,!0,!1,0,c([a(21,3)]),[new o(1,22,"link",m.Regular)],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(e),{html:['<span class="mtk3 link">https://microsoft.com</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21]]})}),test("issue #19207: Link in Monokai is not rendered correctly",()=>{const s="'let url = `http://***/_api/web/lists/GetByTitle(\\'Teambuildingaanvragen\\')/items`;'",e=p(new u(!0,!0,s,!1,!0,!1,0,c([a(49,6),a(51,4),a(72,6),a(74,4),a(84,6)]),[new o(13,51,"detected-link",m.Regular)],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(e),{html:['<span class="mtk6">\'let\xA0url\xA0=\xA0`</span>','<span class="mtk6 detected-link">http://***/_api/web/lists/GetByTitle(</span>','<span class="mtk4 detected-link">\\</span>',`<span class="mtk4">'</span>`,'<span class="mtk6">Teambuildingaanvragen</span>',`<span class="mtk4">\\'</span>`,'<span class="mtk6">)/items`;\'</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[1,0,12],[1,1,13],[1,2,14],[1,3,15],[1,4,16],[1,5,17],[1,6,18],[1,7,19],[1,8,20],[1,9,21],[1,10,22],[1,11,23],[1,12,24],[1,13,25],[1,14,26],[1,15,27],[1,16,28],[1,17,29],[1,18,30],[1,19,31],[1,20,32],[1,21,33],[1,22,34],[1,23,35],[1,24,36],[1,25,37],[1,26,38],[1,27,39],[1,28,40],[1,29,41],[1,30,42],[1,31,43],[1,32,44],[1,33,45],[1,34,46],[1,35,47],[1,36,48],[2,0,49],[3,0,50],[4,0,51],[4,1,52],[4,2,53],[4,3,54],[4,4,55],[4,5,56],[4,6,57],[4,7,58],[4,8,59],[4,9,60],[4,10,61],[4,11,62],[4,12,63],[4,13,64],[4,14,65],[4,15,66],[4,16,67],[4,17,68],[4,18,69],[4,19,70],[4,20,71],[5,0,72],[5,1,73],[6,0,74],[6,1,75],[6,2,76],[6,3,77],[6,4,78],[6,5,79],[6,6,80],[6,7,81],[6,8,82],[6,9,83],[6,10,84]]})}),test("createLineParts simple",()=>{t.deepStrictEqual(n(!1,"Hello world!",[a(12,1)],0,"none",null),{html:['<span class="mtk1">Hello\xA0world!</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12]]})}),test("createLineParts simple two tokens",()=>{t.deepStrictEqual(n(!1,"Hello world!",[a(6,1),a(12,2)],0,"none",null),{html:['<span class="mtk1">Hello\xA0</span>','<span class="mtk2">world!</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[1,0,6],[1,1,7],[1,2,8],[1,3,9],[1,4,10],[1,5,11],[1,6,12]]})}),test("createLineParts render whitespace - 4 leading spaces",()=>{t.deepStrictEqual(n(!1,"    Hello world!    ",[a(4,1),a(6,2),a(20,3)],0,"boundary",null),{html:['<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,2,1],[0,4,2],[0,6,3],[1,0,4],[1,1,5],[2,0,6],[2,1,7],[2,2,8],[2,3,9],[2,4,10],[2,5,11],[2,6,12],[2,7,13],[2,8,14],[2,9,15],[3,0,16],[3,2,17],[3,4,18],[3,6,19],[3,8,20]]})}),test("createLineParts render whitespace - 8 leading spaces",()=>{t.deepStrictEqual(n(!1,"        Hello world!        ",[a(8,1),a(10,2),a(28,3)],0,"boundary",null),{html:['<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,2,1],[0,4,2],[0,6,3],[1,0,4],[1,2,5],[1,4,6],[1,6,7],[2,0,8],[2,1,9],[3,0,10],[3,1,11],[3,2,12],[3,3,13],[3,4,14],[3,5,15],[3,6,16],[3,7,17],[3,8,18],[3,9,19],[4,0,20],[4,2,21],[4,4,22],[4,6,23],[5,0,24],[5,2,25],[5,4,26],[5,6,27],[5,8,28]]})}),test("createLineParts render whitespace - 2 leading tabs",()=>{t.deepStrictEqual(n(!1,"		Hello world!	",[a(2,1),a(4,2),a(15,3)],0,"boundary",null),{html:['<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>','<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,4],[2,0,8],[2,1,9],[3,0,10],[3,1,11],[3,2,12],[3,3,13],[3,4,14],[3,5,15],[3,6,16],[3,7,17],[3,8,18],[3,9,19],[4,0,20],[4,4,24]]})}),test("createLineParts render whitespace - mixed leading spaces and tabs",()=>{t.deepStrictEqual(n(!1,"  		  Hello world! 	  	   	    ",[a(6,1),a(8,2),a(31,3)],0,"boundary",null),{html:['<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\u2192\xA0</span>','<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>','<span class="mtkz" style="width:20px">\xB7\u200C\xB7\u200C</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:20px">\xB7\u200C\uFFEB</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\u2192\xA0</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\uFFEB</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,2,1],[0,4,2],[1,0,4],[2,0,8],[2,2,9],[3,0,10],[3,1,11],[4,0,12],[4,1,13],[4,2,14],[4,3,15],[4,4,16],[4,5,17],[4,6,18],[4,7,19],[4,8,20],[4,9,21],[5,0,22],[5,2,23],[6,0,24],[6,2,25],[6,4,26],[7,0,28],[7,2,29],[7,4,30],[7,6,31],[8,0,32],[8,2,33],[8,4,34],[8,6,35],[8,8,36]]})}),test("createLineParts render whitespace skips faux indent",()=>{t.deepStrictEqual(n(!1,"		  Hello world! 	  	   	    ",[a(4,1),a(6,2),a(29,3)],2,"boundary",null),{html:['<span class="">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtkz" style="width:20px">\xB7\u200C\xB7\u200C</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:20px">\xB7\u200C\uFFEB</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\u2192\xA0</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\uFFEB</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,4,4],[1,0,8],[1,2,9],[2,0,10],[2,1,11],[3,0,12],[3,1,13],[3,2,14],[3,3,15],[3,4,16],[3,5,17],[3,6,18],[3,7,19],[3,8,20],[3,9,21],[4,0,22],[4,2,23],[5,0,24],[5,2,25],[5,4,26],[6,0,28],[6,2,29],[6,4,30],[6,6,31],[7,0,32],[7,2,33],[7,4,34],[7,6,35],[7,8,36]]})}),test("createLineParts does not emit width for monospace fonts",()=>{t.deepStrictEqual(n(!0,"		  Hello world! 	  	   	    ",[a(4,1),a(6,2),a(29,3)],2,"boundary",null),{html:['<span class="">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtkw">\xB7\u200C\xB7\u200C</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkw">\xB7\u200C\uFFEB\xB7\u200C\xB7\u200C\u2192\xA0\xB7\u200C\xB7\u200C\xB7\u200C\uFFEB\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,4,4],[1,0,8],[1,2,9],[2,0,10],[2,1,11],[3,0,12],[3,1,13],[3,2,14],[3,3,15],[3,4,16],[3,5,17],[3,6,18],[3,7,19],[3,8,20],[3,9,21],[4,0,22],[4,2,23],[4,3,24],[4,5,25],[4,7,26],[4,9,28],[4,11,29],[4,13,30],[4,15,31],[4,16,32],[4,18,33],[4,20,34],[4,22,35],[4,24,36]]})}),test("createLineParts render whitespace in middle but not for one space",()=>{t.deepStrictEqual(n(!1,"it  it it  it",[a(6,1),a(7,2),a(13,3)],0,"boundary",null),{html:['<span class="mtk1">it</span>','<span class="mtkz" style="width:20px">\xB7\u200C\xB7\u200C</span>','<span class="mtk1">it</span>','<span class="mtk2">\xA0</span>','<span class="mtk3">it</span>','<span class="mtkz" style="width:20px">\xB7\u200C\xB7\u200C</span>','<span class="mtk3">it</span>'],mapping:[[0,0,0],[0,1,1],[1,0,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[4,0,7],[4,1,8],[5,0,9],[5,2,10],[6,0,11],[6,1,12],[6,2,13]]})}),test("createLineParts render whitespace for all in middle",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"all",null),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">Hel</span>','<span class="mtk1">lo</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk2">world!</span>','<span class="mtkz" style="width:30px">\u2192\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[4,0,7],[4,1,8],[4,2,9],[4,3,10],[4,4,11],[4,5,12],[5,0,13],[5,3,16]]})}),test("createLineParts render whitespace for selection with no selections",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"selection",null),{html:['<span class="mtk0">\xA0Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!\xA0\xA0\xA0</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[1,0,4],[1,1,5],[2,0,6],[2,1,7],[2,2,8],[2,3,9],[2,4,10],[2,5,11],[2,6,12],[2,7,13],[2,10,16]]})}),test("createLineParts render whitespace for selection with whole line selection",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"selection",[new w(0,14)]),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">Hel</span>','<span class="mtk1">lo</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk2">world!</span>','<span class="mtkz" style="width:30px">\u2192\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[4,0,7],[4,1,8],[4,2,9],[4,3,10],[4,4,11],[4,5,12],[5,0,13],[5,3,16]]})}),test("createLineParts render whitespace for selection with selection spanning part of whitespace",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"selection",[new w(0,5)]),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!\xA0\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[3,1,7],[3,2,8],[3,3,9],[3,4,10],[3,5,11],[3,6,12],[3,7,13],[3,10,16]]})}),test("createLineParts render whitespace for selection with multiple selections",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"selection",[new w(0,5),new w(9,14)]),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!</span>','<span class="mtkz" style="width:30px">\u2192\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[3,1,7],[3,2,8],[3,3,9],[3,4,10],[3,5,11],[3,6,12],[4,0,13],[4,3,16]]})}),test("createLineParts render whitespace for selection with multiple, initially unsorted selections",()=>{t.deepStrictEqual(n(!1," Hello world!	",[a(4,0),a(6,1),a(14,2)],0,"selection",[new w(9,14),new w(0,5)]),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!</span>','<span class="mtkz" style="width:30px">\u2192\xA0\xA0</span>'],mapping:[[0,0,0],[1,0,1],[1,1,2],[1,2,3],[2,0,4],[2,1,5],[3,0,6],[3,1,7],[3,2,8],[3,3,9],[3,4,10],[3,5,11],[3,6,12],[4,0,13],[4,3,16]]})}),test("createLineParts render whitespace for selection with selections next to each other",()=>{t.deepStrictEqual(n(!1," * S",[a(4,0)],0,"selection",[new w(0,1),new w(1,2),new w(2,3)]),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">*</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk0">S</span>'],mapping:[[0,0,0],[1,0,1],[2,0,2],[3,0,3],[3,1,4]]})}),test("createLineParts render whitespace for trailing with leading, inner, and without trailing whitespace",()=>{t.deepStrictEqual(n(!1," Hello world!",[a(4,0),a(6,1),a(14,2)],0,"trailing",null),{html:['<span class="mtk0">\xA0Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[1,0,4],[1,1,5],[2,0,6],[2,1,7],[2,2,8],[2,3,9],[2,4,10],[2,5,11],[2,6,12],[2,7,13]]})}),test("createLineParts render whitespace for trailing with leading, inner, and trailing whitespace",()=>{t.deepStrictEqual(n(!1," Hello world! 	",[a(4,0),a(6,1),a(15,2)],0,"trailing",null),{html:['<span class="mtk0">\xA0Hel</span>','<span class="mtk1">lo</span>','<span class="mtk2">\xA0world!</span>','<span class="mtkz" style="width:30px">\xB7\u200C\u2192\xA0</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[1,0,4],[1,1,5],[2,0,6],[2,1,7],[2,2,8],[2,3,9],[2,4,10],[2,5,11],[2,6,12],[3,0,13],[3,2,14],[3,4,16]]})}),test("createLineParts render whitespace for trailing with 8 leading and 8 trailing whitespaces",()=>{t.deepStrictEqual(n(!1,"        Hello world!        ",[a(8,1),a(10,2),a(28,3)],0,"trailing",null),{html:['<span class="mtk1">\xA0\xA0\xA0\xA0\xA0\xA0\xA0\xA0</span>','<span class="mtk2">He</span>','<span class="mtk3">llo\xA0world!</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtkz" style="width:40px">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[1,0,8],[1,1,9],[2,0,10],[2,1,11],[2,2,12],[2,3,13],[2,4,14],[2,5,15],[2,6,16],[2,7,17],[2,8,18],[2,9,19],[3,0,20],[3,2,21],[3,4,22],[3,6,23],[4,0,24],[4,2,25],[4,4,26],[4,6,27],[4,8,28]]})}),test("createLineParts render whitespace for trailing with line containing only whitespaces",()=>{t.deepStrictEqual(n(!1," 	 ",[a(2,0),a(3,1)],0,"trailing",null),{html:['<span class="mtkz" style="width:40px">\xB7\u200C\u2192\xA0\xA0</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>'],mapping:[[0,0,0],[0,2,1],[1,0,4],[1,2,5]]})}),test("createLineParts can handle unsorted inline decorations",()=>{const s=p(new u(!1,!0,"Hello world",!1,!0,!1,0,c([a(11,0)]),[new o(5,7,"a",m.Regular),new o(1,3,"b",m.Regular),new o(2,8,"c",m.Regular)],4,0,10,10,10,-1,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk0 b">H</span>','<span class="mtk0 b c">e</span>','<span class="mtk0 c">ll</span>','<span class="mtk0 a c">o\xA0</span>','<span class="mtk0 c">w</span>','<span class="mtk0">orld</span>'],mapping:[[0,0,0],[1,0,1],[2,0,2],[2,1,3],[3,0,4],[3,1,5],[4,0,6],[5,0,7],[5,1,8],[5,2,9],[5,3,10],[5,4,11]]})}),test("issue #11485: Visible whitespace conflicts with before decorator attachment",()=>{const s="	bla",e=p(new u(!1,!0,s,!1,!0,!1,0,c([a(4,3)]),[new o(1,2,"before",m.Before)],4,0,10,10,10,-1,"all",!1,!0,null));t.deepStrictEqual(i(e),{html:['<span class="mtkw before">\u2192\xA0\xA0\xA0</span>','<span class="mtk3">bla</span>'],mapping:[[0,0,0],[1,0,4],[1,1,5],[1,2,6],[1,3,7]]})}),test('issue #32436: Non-monospace font + visible whitespace + After decorator causes line to "jump"',()=>{const s="	bla",e=p(new u(!1,!0,s,!1,!0,!1,0,c([a(4,3)]),[new o(2,3,"before",m.Before)],4,0,10,10,10,-1,"all",!1,!0,null));t.deepStrictEqual(i(e),{html:['<span class="mtkz" style="width:40px">\u2192\xA0\xA0\xA0</span>','<span class="mtk3 before">b</span>','<span class="mtk3">la</span>'],mapping:[[0,0,0],[1,0,4],[2,0,5],[2,1,6],[2,2,7]]})}),test("issue #30133: Empty lines don't render inline decorations",()=>{const s="",e=p(new u(!1,!0,s,!1,!0,!1,0,c([a(0,3)]),[new o(1,2,"before",m.Before)],4,0,10,10,10,-1,"all",!1,!0,null));t.deepStrictEqual(i(e),{html:['<span class="before"></span>'],mapping:[[1,0,0]]})}),test("issue #37208: Collapsing bullet point containing emoji in Markdown document results in [??] character",()=>{const s=p(new u(!0,!0,"  1. \u{1F64F}",!1,!1,!1,0,c([a(7,3)]),[new o(7,8,"inline-folded",m.After)],2,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">\xA0\xA01.\xA0</span>','<span class="mtk3 inline-folded">\u{1F64F}</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[1,0,5],[1,1,6],[1,2,7]]})}),test("issue #37401 #40127: Allow both before and after decorations on empty line",()=>{const s=p(new u(!0,!0,"",!1,!0,!1,0,c([a(0,3)]),[new o(1,1,"before",m.Before),new o(1,1,"after",m.After)],2,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="before"></span>','<span class="after"></span>'],mapping:[[1,0,0]]})}),test("issue #118759: enable multiple text editor decorations in empty lines",()=>{const s=p(new u(!0,!0,"",!1,!0,!1,0,c([a(0,3)]),[new o(1,1,"after1",m.After),new o(1,1,"after2",m.After),new o(1,1,"before1",m.Before),new o(1,1,"before2",m.Before)],2,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="before1"></span>','<span class="before2"></span>','<span class="after1"></span>','<span class="after2"></span>'],mapping:[[2,0,0]]})}),test("issue #38935: GitLens end-of-line blame no longer rendering",()=>{const s=p(new u(!0,!0,"	}",!1,!0,!1,0,c([a(2,3)]),[new o(3,3,"ced-TextEditorDecorationType2-5e9b9b3f-3 ced-TextEditorDecorationType2-3",m.Before),new o(3,3,"ced-TextEditorDecorationType2-5e9b9b3f-4 ced-TextEditorDecorationType2-4",m.After)],4,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">\xA0\xA0\xA0\xA0}</span>','<span class="ced-TextEditorDecorationType2-5e9b9b3f-3 ced-TextEditorDecorationType2-3"></span>','<span class="ced-TextEditorDecorationType2-5e9b9b3f-4 ced-TextEditorDecorationType2-4"></span>'],mapping:[[0,0,0],[0,4,4],[2,0,5]]})}),test("issue #136622: Inline decorations are not rendering on non-ASCII lines when renderControlCharacters is on",()=>{const s=p(new u(!0,!0,"some text \xA3",!1,!1,!1,0,c([a(11,3)]),[new o(5,5,"inlineDec1",m.After),new o(6,6,"inlineDec2",m.Before)],4,0,10,10,10,1e4,"none",!0,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">some</span>','<span class="mtk3 inlineDec1"></span>','<span class="mtk3">\xA0</span>','<span class="mtk3 inlineDec2"></span>','<span class="mtk3">text\xA0\xA3</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[1,0,4],[4,0,5],[4,1,6],[4,2,7],[4,3,8],[4,4,9],[4,5,10],[4,6,11]]})}),test("issue #22832: Consider fullwidth characters when rendering tabs",()=>{const s=p(new u(!0,!0,'asd = "\u64E6"		#asd',!1,!1,!1,0,c([a(15,3)]),[],4,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">asd\xA0=\xA0"\u64E6"\xA0\xA0\xA0\xA0\xA0\xA0#asd</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,9],[0,9,10],[0,11,12],[0,15,16],[0,16,17],[0,17,18],[0,18,19],[0,19,20]]})}),test("issue #22832: Consider fullwidth characters when rendering tabs (render whitespace)",()=>{const s=p(new u(!0,!0,'asd = "\u64E6"		#asd',!1,!1,!1,0,c([a(15,3)]),[],4,0,10,10,10,1e4,"all",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">asd</span>','<span class="mtkw">\xB7\u200C</span>','<span class="mtk3">=</span>','<span class="mtkw">\xB7\u200C</span>','<span class="mtk3">"\u64E6"</span>','<span class="mtkw">\u2192\xA0\u2192\xA0\xA0\xA0</span>','<span class="mtk3">#asd</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[1,0,3],[2,0,4],[3,0,5],[4,0,6],[4,1,7],[4,2,9],[5,0,10],[5,2,12],[6,0,16],[6,1,17],[6,2,18],[6,3,19],[6,4,20]]})}),test("issue #22352: COMBINING ACUTE ACCENT (U+0301)",()=>{const s=p(new u(!0,!0,"12345689012345678901234568901234567890123456890aba\u0301ba",!1,!1,!1,0,c([a(53,3)]),[],4,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">12345689012345678901234568901234567890123456890aba\u0301ba</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[0,45,45],[0,46,46],[0,47,47],[0,48,48],[0,49,49],[0,50,50],[0,51,51],[0,52,52],[0,53,53]]})}),test("issue #22352: Partially Broken Complex Script Rendering of Tamil",()=>{const s=p(new u(!0,!0," JoyShare\u0BB2\u0BCD \u0BAA\u0BBF\u0BA9\u0BCD\u0BA4\u0BCA\u0B9F\u0BB0\u0BCD\u0BA8\u0BCD\u0BA4\u0BC1, \u0BB5\u0BBF\u0B9F\u0BC0\u0BAF\u0BCB, \u0B9C\u0BCB\u0B95\u0BCD\u0B95\u0BC1\u0B95\u0BB3\u0BCD, \u0B85\u0BA9\u0BBF\u0BAE\u0BC7\u0B9A\u0BA9\u0BCD, \u0BA8\u0B95\u0BC8\u0B9A\u0BCD\u0B9A\u0BC1\u0BB5\u0BC8 \u0BAA\u0B9F\u0B99\u0BCD\u0B95\u0BB3\u0BCD \u0BAE\u0BB1\u0BCD\u0BB1\u0BC1\u0BAE\u0BCD \u0B9A\u0BC6\u0BAF\u0BCD\u0BA4\u0BBF\u0B95\u0BB3\u0BC8 \u0BAA\u0BC6\u0BB1\u0BC1\u0BB5\u0BC0\u0BB0\u0BCD",!1,!1,!1,0,c([a(100,3)]),[],4,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">\xA0JoyShare\u0BB2\u0BCD\xA0\u0BAA\u0BBF\u0BA9\u0BCD\u0BA4\u0BCA\u0B9F\u0BB0\u0BCD\u0BA8\u0BCD\u0BA4\u0BC1,\xA0\u0BB5\u0BBF\u0B9F\u0BC0\u0BAF\u0BCB,\xA0\u0B9C\u0BCB\u0B95\u0BCD\u0B95\u0BC1\u0B95\u0BB3\u0BCD,\xA0</span>','<span class="mtk3">\u0B85\u0BA9\u0BBF\u0BAE\u0BC7\u0B9A\u0BA9\u0BCD,\xA0\u0BA8\u0B95\u0BC8\u0B9A\u0BCD\u0B9A\u0BC1\u0BB5\u0BC8\xA0\u0BAA\u0B9F\u0B99\u0BCD\u0B95\u0BB3\u0BCD\xA0\u0BAE\u0BB1\u0BCD\u0BB1\u0BC1\u0BAE\u0BCD\xA0\u0B9A\u0BC6\u0BAF\u0BCD\u0BA4\u0BBF\u0B95\u0BB3\u0BC8\xA0</span>','<span class="mtk3">\u0BAA\u0BC6\u0BB1\u0BC1\u0BB5\u0BC0\u0BB0\u0BCD</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[0,45,45],[1,0,46],[1,1,47],[1,2,48],[1,3,49],[1,4,50],[1,5,51],[1,6,52],[1,7,53],[1,8,54],[1,9,55],[1,10,56],[1,11,57],[1,12,58],[1,13,59],[1,14,60],[1,15,61],[1,16,62],[1,17,63],[1,18,64],[1,19,65],[1,20,66],[1,21,67],[1,22,68],[1,23,69],[1,24,70],[1,25,71],[1,26,72],[1,27,73],[1,28,74],[1,29,75],[1,30,76],[1,31,77],[1,32,78],[1,33,79],[1,34,80],[1,35,81],[1,36,82],[1,37,83],[1,38,84],[1,39,85],[1,40,86],[1,41,87],[1,42,88],[1,43,89],[1,44,90],[1,45,91],[2,0,92],[2,1,93],[2,2,94],[2,3,95],[2,4,96],[2,5,97],[2,6,98],[2,7,99],[2,8,100]]})}),test("issue #42700: Hindi characters are not being rendered properly",()=>{const s=p(new u(!0,!0," \u0935\u094B \u0910\u0938\u093E \u0915\u094D\u092F\u093E \u0939\u0948 \u091C\u094B \u0939\u092E\u093E\u0930\u0947 \u0905\u0902\u0926\u0930 \u092D\u0940 \u0939\u0948 \u0914\u0930 \u092C\u093E\u0939\u0930 \u092D\u0940 \u0939\u0948\u0964 \u091C\u093F\u0938\u0915\u0940 \u0935\u091C\u0939 \u0938\u0947 \u0939\u092E \u0938\u092C \u0939\u0948\u0902\u0964 \u091C\u093F\u0938\u0928\u0947 \u0907\u0938 \u0938\u0943\u0937\u094D\u091F\u093F \u0915\u0940 \u0930\u091A\u0928\u093E \u0915\u0940 \u0939\u0948\u0964",!1,!1,!1,0,c([a(105,3)]),[],4,0,10,10,10,1e4,"none",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">\xA0\u0935\u094B\xA0\u0910\u0938\u093E\xA0\u0915\u094D\u092F\u093E\xA0\u0939\u0948\xA0\u091C\u094B\xA0\u0939\u092E\u093E\u0930\u0947\xA0\u0905\u0902\u0926\u0930\xA0\u092D\u0940\xA0\u0939\u0948\xA0\u0914\u0930\xA0\u092C\u093E\u0939\u0930\xA0\u092D\u0940\xA0\u0939\u0948\u0964\xA0</span>','<span class="mtk3">\u091C\u093F\u0938\u0915\u0940\xA0\u0935\u091C\u0939\xA0\u0938\u0947\xA0\u0939\u092E\xA0\u0938\u092C\xA0\u0939\u0948\u0902\u0964\xA0\u091C\u093F\u0938\u0928\u0947\xA0\u0907\u0938\xA0\u0938\u0943\u0937\u094D\u091F\u093F\xA0\u0915\u0940\xA0\u0930\u091A\u0928\u093E\xA0\u0915\u0940\xA0</span>','<span class="mtk3">\u0939\u0948\u0964</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[0,45,45],[0,46,46],[0,47,47],[0,48,48],[0,49,49],[0,50,50],[1,0,51],[1,1,52],[1,2,53],[1,3,54],[1,4,55],[1,5,56],[1,6,57],[1,7,58],[1,8,59],[1,9,60],[1,10,61],[1,11,62],[1,12,63],[1,13,64],[1,14,65],[1,15,66],[1,16,67],[1,17,68],[1,18,69],[1,19,70],[1,20,71],[1,21,72],[1,22,73],[1,23,74],[1,24,75],[1,25,76],[1,26,77],[1,27,78],[1,28,79],[1,29,80],[1,30,81],[1,31,82],[1,32,83],[1,33,84],[1,34,85],[1,35,86],[1,36,87],[1,37,88],[1,38,89],[1,39,90],[1,40,91],[1,41,92],[1,42,93],[1,43,94],[1,44,95],[1,45,96],[1,46,97],[1,47,98],[1,48,99],[1,49,100],[1,50,101],[2,0,102],[2,1,103],[2,2,104],[2,3,105]]})}),test('issue #38123: editor.renderWhitespace: "boundary" renders whitespace at line wrap point when line is wrapped',()=>{const s=p(new u(!0,!0,"This is a long line which never uses more than two spaces. ",!0,!0,!1,0,c([a(59,3)]),[],4,0,10,10,10,1e4,"boundary",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">This\xA0is\xA0a\xA0long\xA0line\xA0which\xA0never\xA0uses\xA0more\xA0than\xA0two</span>','<span class="mtk3">\xA0spaces.</span>','<span class="mtk3">\xA0</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[0,45,45],[0,46,46],[0,47,47],[0,48,48],[0,49,49],[1,0,50],[1,1,51],[1,2,52],[1,3,53],[1,4,54],[1,5,55],[1,6,56],[1,7,57],[2,0,58],[2,1,59]]})}),test("issue #33525: Long line with ligatures takes a long time to paint decorations",()=>{const s=p(new u(!1,!1,"append data to append data to append data to append data to append data to append data to append data to append data to append data to append data to append data to append data to append data to",!1,!0,!1,0,c([a(194,3)]),[],4,0,10,10,10,1e4,"none",!1,!0,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0</span>','<span class="mtk3">append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0</span>','<span class="mtk3">append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0</span>','<span class="mtk3">append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0append\xA0data\xA0to\xA0</span>','<span class="mtk3">append\xA0data\xA0to</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[1,0,45],[1,1,46],[1,2,47],[1,3,48],[1,4,49],[1,5,50],[1,6,51],[1,7,52],[1,8,53],[1,9,54],[1,10,55],[1,11,56],[1,12,57],[1,13,58],[1,14,59],[1,15,60],[1,16,61],[1,17,62],[1,18,63],[1,19,64],[1,20,65],[1,21,66],[1,22,67],[1,23,68],[1,24,69],[1,25,70],[1,26,71],[1,27,72],[1,28,73],[1,29,74],[1,30,75],[1,31,76],[1,32,77],[1,33,78],[1,34,79],[1,35,80],[1,36,81],[1,37,82],[1,38,83],[1,39,84],[1,40,85],[1,41,86],[1,42,87],[1,43,88],[1,44,89],[2,0,90],[2,1,91],[2,2,92],[2,3,93],[2,4,94],[2,5,95],[2,6,96],[2,7,97],[2,8,98],[2,9,99],[2,10,100],[2,11,101],[2,12,102],[2,13,103],[2,14,104],[2,15,105],[2,16,106],[2,17,107],[2,18,108],[2,19,109],[2,20,110],[2,21,111],[2,22,112],[2,23,113],[2,24,114],[2,25,115],[2,26,116],[2,27,117],[2,28,118],[2,29,119],[2,30,120],[2,31,121],[2,32,122],[2,33,123],[2,34,124],[2,35,125],[2,36,126],[2,37,127],[2,38,128],[2,39,129],[2,40,130],[2,41,131],[2,42,132],[2,43,133],[2,44,134],[3,0,135],[3,1,136],[3,2,137],[3,3,138],[3,4,139],[3,5,140],[3,6,141],[3,7,142],[3,8,143],[3,9,144],[3,10,145],[3,11,146],[3,12,147],[3,13,148],[3,14,149],[3,15,150],[3,16,151],[3,17,152],[3,18,153],[3,19,154],[3,20,155],[3,21,156],[3,22,157],[3,23,158],[3,24,159],[3,25,160],[3,26,161],[3,27,162],[3,28,163],[3,29,164],[3,30,165],[3,31,166],[3,32,167],[3,33,168],[3,34,169],[3,35,170],[3,36,171],[3,37,172],[3,38,173],[3,39,174],[3,40,175],[3,41,176],[3,42,177],[3,43,178],[3,44,179],[4,0,180],[4,1,181],[4,2,182],[4,3,183],[4,4,184],[4,5,185],[4,6,186],[4,7,187],[4,8,188],[4,9,189],[4,10,190],[4,11,191],[4,12,192],[4,13,193],[4,14,194]]})}),test("issue #33525: Long line with ligatures takes a long time to paint decorations - not possible",()=>{const s=p(new u(!1,!1,"appenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatato",!1,!0,!1,0,c([a(194,3)]),[],4,0,10,10,10,1e4,"none",!1,!0,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">appenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatatoappenddatato</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[0,21,21],[0,22,22],[0,23,23],[0,24,24],[0,25,25],[0,26,26],[0,27,27],[0,28,28],[0,29,29],[0,30,30],[0,31,31],[0,32,32],[0,33,33],[0,34,34],[0,35,35],[0,36,36],[0,37,37],[0,38,38],[0,39,39],[0,40,40],[0,41,41],[0,42,42],[0,43,43],[0,44,44],[0,45,45],[0,46,46],[0,47,47],[0,48,48],[0,49,49],[0,50,50],[0,51,51],[0,52,52],[0,53,53],[0,54,54],[0,55,55],[0,56,56],[0,57,57],[0,58,58],[0,59,59],[0,60,60],[0,61,61],[0,62,62],[0,63,63],[0,64,64],[0,65,65],[0,66,66],[0,67,67],[0,68,68],[0,69,69],[0,70,70],[0,71,71],[0,72,72],[0,73,73],[0,74,74],[0,75,75],[0,76,76],[0,77,77],[0,78,78],[0,79,79],[0,80,80],[0,81,81],[0,82,82],[0,83,83],[0,84,84],[0,85,85],[0,86,86],[0,87,87],[0,88,88],[0,89,89],[0,90,90],[0,91,91],[0,92,92],[0,93,93],[0,94,94],[0,95,95],[0,96,96],[0,97,97],[0,98,98],[0,99,99],[0,100,100],[0,101,101],[0,102,102],[0,103,103],[0,104,104],[0,105,105],[0,106,106],[0,107,107],[0,108,108],[0,109,109],[0,110,110],[0,111,111],[0,112,112],[0,113,113],[0,114,114],[0,115,115],[0,116,116],[0,117,117],[0,118,118],[0,119,119],[0,120,120],[0,121,121],[0,122,122],[0,123,123],[0,124,124],[0,125,125],[0,126,126],[0,127,127],[0,128,128],[0,129,129],[0,130,130],[0,131,131],[0,132,132],[0,133,133],[0,134,134],[0,135,135],[0,136,136],[0,137,137],[0,138,138],[0,139,139],[0,140,140],[0,141,141],[0,142,142],[0,143,143],[0,144,144],[0,145,145],[0,146,146],[0,147,147],[0,148,148],[0,149,149],[0,150,150],[0,151,151],[0,152,152],[0,153,153],[0,154,154],[0,155,155],[0,156,156]]})}),test("issue #91936: Semantic token color highlighting fails on line with selected text",()=>{const s=p(new u(!1,!0,"                    else if ($s = 08) then '\\b'",!1,!0,!1,0,c([a(20,1),a(24,15),a(25,1),a(27,15),a(28,1),a(29,1),a(29,1),a(31,16),a(32,1),a(33,1),a(34,1),a(36,6),a(36,1),a(37,1),a(38,1),a(42,15),a(43,1),a(47,11)]),[],4,0,10,11,11,1e4,"selection",!1,!1,[new w(0,47)]));t.deepStrictEqual(i(s),{html:['<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk15">else</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk15">if</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk1">(</span>','<span class="mtk16">$s</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk1">=</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk6">08</span>','<span class="mtk1">)</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>','<span class="mtk15">then</span>','<span class="mtkz" style="width:10px">\xB7\u200C</span>',`<span class="mtk11">'\\b'</span>`],mapping:[[0,0,0],[1,0,1],[2,0,2],[3,0,3],[4,0,4],[5,0,5],[6,0,6],[7,0,7],[8,0,8],[9,0,9],[10,0,10],[11,0,11],[12,0,12],[13,0,13],[14,0,14],[15,0,15],[16,0,16],[17,0,17],[18,0,18],[19,0,19],[20,0,20],[20,1,21],[20,2,22],[20,3,23],[21,0,24],[22,0,25],[22,1,26],[23,0,27],[24,0,28],[25,0,29],[25,1,30],[26,0,31],[27,0,32],[28,0,33],[29,0,34],[29,1,35],[30,0,36],[31,0,37],[32,0,38],[32,1,39],[32,2,40],[32,3,41],[33,0,42],[34,0,43],[34,1,44],[34,2,45],[34,3,46],[34,4,47]]})}),test("issue #119416: Delete Control Character (U+007F / &#127;) displayed as space",()=>{const s=p(new u(!1,!1,"[\x7F] [\0]",!1,!0,!1,0,c([a(7,3)]),[],4,0,10,10,10,1e4,"none",!0,!0,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">[\u2421]\xA0[\u2400]</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7]]})}),test("issue #116939: Important control characters aren't rendered",()=>{const s=p(new u(!1,!1,'transferBalance(5678,\u202E6776,4321\u202C,"USD");',!1,!1,!1,0,c([a(42,3)]),[],4,0,10,10,10,1e4,"none",!0,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtk3">transferBalance(5678,</span>','<span class="mtkcontrol">[U+202E]</span>','<span class="mtk3">6776,4321</span>','<span class="mtkcontrol">[U+202C]</span>','<span class="mtk3">,"USD");</span>'],mapping:[[0,0,0],[0,1,1],[0,2,2],[0,3,3],[0,4,4],[0,5,5],[0,6,6],[0,7,7],[0,8,8],[0,9,9],[0,10,10],[0,11,11],[0,12,12],[0,13,13],[0,14,14],[0,15,15],[0,16,16],[0,17,17],[0,18,18],[0,19,19],[0,20,20],[1,0,21],[2,0,29],[2,1,30],[2,2,31],[2,3,32],[2,4,33],[2,5,34],[2,6,35],[2,7,36],[2,8,37],[3,0,38],[4,0,46],[4,1,47],[4,2,48],[4,3,49],[4,4,50],[4,5,51],[4,6,52],[4,7,53],[4,8,54]]})}),test("issue #124038: Multiple end-of-line text decorations get merged",()=>{const s=p(new u(!0,!1,"    if",!1,!0,!1,0,c([a(4,1),a(6,2)]),[new o(7,7,"ced-1-TextEditorDecorationType2-17c14d98-3 ced-1-TextEditorDecorationType2-3",m.Before),new o(7,7,"ced-1-TextEditorDecorationType2-17c14d98-4 ced-1-TextEditorDecorationType2-4",m.After),new o(7,7,"ced-ghost-text-1-4",m.After)],4,0,10,10,10,1e4,"all",!1,!1,null));t.deepStrictEqual(i(s),{html:['<span class="mtkw">\xB7\u200C\xB7\u200C\xB7\u200C\xB7\u200C</span>','<span class="mtk2">if</span>','<span class="ced-1-TextEditorDecorationType2-17c14d98-3 ced-1-TextEditorDecorationType2-3"></span>','<span class="ced-1-TextEditorDecorationType2-17c14d98-4 ced-1-TextEditorDecorationType2-4"></span>','<span class="ced-ghost-text-1-4"></span>'],mapping:[[0,0,0],[0,2,1],[0,4,2],[0,6,3],[1,0,4],[1,1,5],[3,0,6]]})});function r(s,e,l,d){const k=p(new u(!1,!0,s,!1,!0,!1,0,c(l),[],e,0,10,10,10,-1,"none",!1,!1,null));return(f,h,g,b)=>{const x=k.characterMapping.getColumn(new y(f,g),h);t.strictEqual(x,b,"getColumn for "+f+", "+g)}}test("getColumnOfLinePartOffset 1 - simple text",()=>{const s=r("hello world",4,[a(11,1)],[11]);s(0,11,0,1),s(0,11,1,2),s(0,11,2,3),s(0,11,3,4),s(0,11,4,5),s(0,11,5,6),s(0,11,6,7),s(0,11,7,8),s(0,11,8,9),s(0,11,9,10),s(0,11,10,11),s(0,11,11,12)}),test("getColumnOfLinePartOffset 2 - regular JS",()=>{const s=r("var x = 3;",4,[a(3,1),a(4,2),a(5,3),a(8,4),a(9,5),a(10,6)],[3,1,1,3,1,1]);s(0,3,0,1),s(0,3,1,2),s(0,3,2,3),s(0,3,3,4),s(1,1,0,4),s(1,1,1,5),s(2,1,0,5),s(2,1,1,6),s(3,3,0,6),s(3,3,1,7),s(3,3,2,8),s(3,3,3,9),s(4,1,0,9),s(4,1,1,10),s(5,1,0,10),s(5,1,1,11)}),test("getColumnOfLinePartOffset 3 - tab with tab size 6",()=>{const s=r("	",6,[a(1,1)],[6]);s(0,6,0,1),s(0,6,1,1),s(0,6,2,1),s(0,6,3,1),s(0,6,4,2),s(0,6,5,2),s(0,6,6,2)}),test("getColumnOfLinePartOffset 4 - once indented line, tab size 4",()=>{const s=r("	function",4,[a(1,1),a(9,2)],[4,8]);s(0,4,0,1),s(0,4,1,1),s(0,4,2,1),s(0,4,3,2),s(0,4,4,2),s(1,8,0,2),s(1,8,1,3),s(1,8,2,4),s(1,8,3,5),s(1,8,4,6),s(1,8,5,7),s(1,8,6,8),s(1,8,7,9),s(1,8,8,10)}),test("getColumnOfLinePartOffset 5 - twice indented line, tab size 4",()=>{const s=r("		function",4,[a(2,1),a(10,2)],[8,8]);s(0,8,0,1),s(0,8,1,1),s(0,8,2,1),s(0,8,3,2),s(0,8,4,2),s(0,8,5,2),s(0,8,6,2),s(0,8,7,3),s(0,8,8,3),s(1,8,0,3),s(1,8,1,4),s(1,8,2,5),s(1,8,3,6),s(1,8,4,7),s(1,8,5,8),s(1,8,6,9),s(1,8,7,10),s(1,8,8,11)})});
