import a from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as l}from"../../../../base/test/common/utils.js";import"../../../common/languages.js";import{computeLinks as p}from"../../../common/languages/linkComputer.js";class c{constructor(o){this._lines=o}getLineCount(){return this._lines.length}getLineContent(o){return this._lines[o-1]}}function m(i){const o=new c(i);return p(o)}function t(i,o){let r=0,n=0,s,e=0;for(e=0;e<o.length;e++)if(s=o.charAt(e),s!==" "&&s!=="	"){r=e+1;break}for(e=o.length-1;e>=0;e--)if(s=o.charAt(e),s!==" "&&s!=="	"){n=e+2;break}const h=m([i]);a.deepStrictEqual(h,[{range:{startLineNumber:1,startColumn:r,endLineNumber:1,endColumn:n},url:o.substring(r-1,n-1)}])}suite("Editor Modes - Link Computer",()=>{l(),test("Null model",()=>{const i=p(null);a.deepStrictEqual(i,[])}),test("Parsing",()=>{t('x = "http://foo.bar";',"     http://foo.bar  "),t("x = (http://foo.bar);","     http://foo.bar  "),t("x = [http://foo.bar];","     http://foo.bar  "),t("x = 'http://foo.bar';","     http://foo.bar  "),t("x =  http://foo.bar ;","     http://foo.bar  "),t("x = <http://foo.bar>;","     http://foo.bar  "),t("x = {http://foo.bar};","     http://foo.bar  "),t("(see http://foo.bar)","     http://foo.bar  "),t("[see http://foo.bar]","     http://foo.bar  "),t("{see http://foo.bar}","     http://foo.bar  "),t("<see http://foo.bar>","     http://foo.bar  "),t("<url>http://mylink.com</url>","     http://mylink.com      "),t("// Click here to learn more. https://go.microsoft.com/fwlink/?LinkID=513275&clcid=0x409","                             https://go.microsoft.com/fwlink/?LinkID=513275&clcid=0x409"),t("// Click here to learn more. https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx","                             https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx"),t("// https://github.com/projectkudu/kudu/blob/master/Kudu.Core/Scripts/selectNodeVersion.js","   https://github.com/projectkudu/kudu/blob/master/Kudu.Core/Scripts/selectNodeVersion.js"),t("<!-- !!! Do not remove !!!   WebContentRef(link:https://go.microsoft.com/fwlink/?LinkId=166007, area:Admin, updated:2015, nextUpdate:2016, tags:SqlServer)   !!! Do not remove !!! -->","                                                https://go.microsoft.com/fwlink/?LinkId=166007                                                                                        "),t("For instructions, see https://go.microsoft.com/fwlink/?LinkId=166007.</value>","                      https://go.microsoft.com/fwlink/?LinkId=166007         "),t("For instructions, see https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx.</value>","                      https://msdn.microsoft.com/en-us/library/windows/desktop/aa365247(v=vs.85).aspx         "),t('x = "https://en.wikipedia.org/wiki/Z\xFCrich";',"     https://en.wikipedia.org/wiki/Z\xFCrich  "),t("\u8ACB\u53C3\u95B1 http://go.microsoft.com/fwlink/?LinkId=761051\u3002","    http://go.microsoft.com/fwlink/?LinkId=761051 "),t("\uFF08\u8ACB\u53C3\u95B1 http://go.microsoft.com/fwlink/?LinkId=761051\uFF09","     http://go.microsoft.com/fwlink/?LinkId=761051 "),t('x = "file:///foo.bar";',"     file:///foo.bar  "),t('x = "file://c:/foo.bar";',"     file://c:/foo.bar  "),t('x = "file://shares/foo.bar";',"     file://shares/foo.bar  "),t('x = "file://sh\xE4res/foo.bar";',"     file://sh\xE4res/foo.bar  "),t("Some text, then http://www.bing.com.","                http://www.bing.com "),t("let url = `http://***/_api/web/lists/GetByTitle('Teambuildingaanvragen')/items`;","           http://***/_api/web/lists/GetByTitle('Teambuildingaanvragen')/items  ")}),test("issue #7855",()=>{t("7. At this point, ServiceMain has been called.  There is no functionality presently in ServiceMain, but you can consult the [MSDN documentation](https://msdn.microsoft.com/en-us/library/windows/desktop/ms687414(v=vs.85).aspx) to add functionality as desired!","                                                                                                                                                 https://msdn.microsoft.com/en-us/library/windows/desktop/ms687414(v=vs.85).aspx                                  ")}),test('issue #62278: "Ctrl + click to follow link" for IPv6 URLs',()=>{t('let x = "http://[::1]:5000/connect/token"',"         http://[::1]:5000/connect/token  ")}),test("issue #70254: bold links dont open in markdown file using editor mode with ctrl + click",()=>{t("2. Navigate to **https://portal.azure.com**","                 https://portal.azure.com  ")}),test("issue #86358: URL wrong recognition pattern",()=>{t("POST|https://portal.azure.com|2019-12-05|","     https://portal.azure.com            ")}),test("issue #67022: Space as end of hyperlink isn't always good idea",()=>{t("aa  https://foo.bar/[this is foo site]  aa","    https://foo.bar/[this is foo site]    ")}),test("issue #100353: Link detection stops at \uFF06(double-byte)",()=>{t("aa  http://tree-mark.chips.jp/\u30EC\u30FC\u30BA\u30F3\uFF06\u30D9\u30EA\u30FC\u30DF\u30C3\u30AF\u30B9  aa","    http://tree-mark.chips.jp/\u30EC\u30FC\u30BA\u30F3\uFF06\u30D9\u30EA\u30FC\u30DF\u30C3\u30AF\u30B9    ")}),test("issue #121438: Link detection stops at\u3010...\u3011",()=>{t("aa  https://zh.wikipedia.org/wiki/\u3010\u6211\u63A8\u7684\u5B69\u5B50\u3011 aa","    https://zh.wikipedia.org/wiki/\u3010\u6211\u63A8\u7684\u5B69\u5B50\u3011   ")}),test("issue #121438: Link detection stops at\u300A...\u300B",()=>{t("aa  https://zh.wikipedia.org/wiki/\u300A\u65B0\u9752\u5E74\u300B\u7F16\u8F91\u90E8\u65E7\u5740 aa","    https://zh.wikipedia.org/wiki/\u300A\u65B0\u9752\u5E74\u300B\u7F16\u8F91\u90E8\u65E7\u5740   ")}),test("issue #121438: Link detection stops at \u201C...\u201D",()=>{t("aa  https://zh.wikipedia.org/wiki/\u201C\u5E38\u51EF\u7533\u201D\u8BEF\u8BD1\u4E8B\u4EF6 aa","    https://zh.wikipedia.org/wiki/\u201C\u5E38\u51EF\u7533\u201D\u8BEF\u8BD1\u4E8B\u4EF6   ")}),test("issue #150905: Colon after bare hyperlink is treated as its part",()=>{t("https://site.web/page.html: blah blah blah","https://site.web/page.html                ")}),test("issue #156875: Links include quotes ",()=>{t('"This file has been converted from https://github.com/jeff-hykin/better-c-syntax/blob/master/autogenerated/c.tmLanguage.json",',"                                   https://github.com/jeff-hykin/better-c-syntax/blob/master/autogenerated/c.tmLanguage.json  ")})});
