{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/codelens/browser/codelensController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\ttype CancelablePromise,\n\tRunOnceScheduler,\n\tcreateCancelablePromise,\n\tdisposableTimeout,\n} from \"../../../../base/common/async.js\";\nimport {\n\tonUnexpectedError,\n\tonUnexpectedExternalError,\n} from \"../../../../base/common/errors.js\";\nimport {\n\tDisposableStore,\n\ttoDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport { localize } from \"../../../../nls.js\";\nimport { ICommandService } from \"../../../../platform/commands/common/commands.js\";\nimport { INotificationService } from \"../../../../platform/notification/common/notification.js\";\nimport { IQuickInputService } from \"../../../../platform/quickinput/common/quickInput.js\";\nimport {\n\ttype IActiveCodeEditor,\n\ttype ICodeEditor,\n\ttype IViewZoneChangeAccessor,\n\tMouseTargetType,\n} from \"../../../browser/editorBrowser.js\";\nimport {\n\tEditorAction,\n\tEditorContributionInstantiation,\n\ttype ServicesAccessor,\n\tregisterEditorAction,\n\tregisterEditorContribution,\n} from \"../../../browser/editorExtensions.js\";\nimport { StableEditorScrollState } from \"../../../browser/stableEditorScroll.js\";\nimport {\n\tEDITOR_FONT_DEFAULTS,\n\tEditorOption,\n} from \"../../../common/config/editorOptions.js\";\nimport type { IEditorContribution } from \"../../../common/editorCommon.js\";\nimport { EditorContextKeys } from \"../../../common/editorContextKeys.js\";\nimport type { CodeLens, Command } from \"../../../common/languages.js\";\nimport type { IModelDecorationsChangeAccessor } from \"../../../common/model.js\";\nimport {\n\ttype IFeatureDebounceInformation,\n\tILanguageFeatureDebounceService,\n} from \"../../../common/services/languageFeatureDebounce.js\";\nimport { ILanguageFeaturesService } from \"../../../common/services/languageFeatures.js\";\nimport { ICodeLensCache } from \"./codeLensCache.js\";\nimport {\n\ttype CodeLensItem,\n\ttype CodeLensModel,\n\tgetCodeLensModel,\n} from \"./codelens.js\";\nimport { CodeLensHelper, CodeLensWidget } from \"./codelensWidget.js\";\n\nexport class CodeLensContribution implements IEditorContribution {\n\tstatic readonly ID: string = \"css.editor.codeLens\";\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _localToDispose = new DisposableStore();\n\n\tprivate readonly _lenses: CodeLensWidget[] = [];\n\n\tprivate readonly _provideCodeLensDebounce: IFeatureDebounceInformation;\n\tprivate readonly _resolveCodeLensesDebounce: IFeatureDebounceInformation;\n\tprivate readonly _resolveCodeLensesScheduler: RunOnceScheduler;\n\n\tprivate _getCodeLensModelPromise:\n\t\t| CancelablePromise<CodeLensModel>\n\t\t| undefined;\n\tprivate readonly _oldCodeLensModels = new DisposableStore();\n\tprivate _currentCodeLensModel: CodeLensModel | undefined;\n\tprivate _resolveCodeLensesPromise: CancelablePromise<any> | undefined;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@ILanguageFeatureDebounceService\n\t\tdebounceService: ILanguageFeatureDebounceService,\n\t\t@ICommandService private readonly _commandService: ICommandService,\n\t\t@INotificationService\n\t\tprivate readonly _notificationService: INotificationService,\n\t\t@ICodeLensCache private readonly _codeLensCache: ICodeLensCache,\n\t) {\n\t\tthis._provideCodeLensDebounce = debounceService.for(\n\t\t\t_languageFeaturesService.codeLensProvider,\n\t\t\t\"CodeLensProvide\",\n\t\t\t{ min: 250 },\n\t\t);\n\t\tthis._resolveCodeLensesDebounce = debounceService.for(\n\t\t\t_languageFeaturesService.codeLensProvider,\n\t\t\t\"CodeLensResolve\",\n\t\t\t{ min: 250, salt: \"resolve\" },\n\t\t);\n\t\tthis._resolveCodeLensesScheduler = new RunOnceScheduler(\n\t\t\t() => this._resolveCodeLensesInViewport(),\n\t\t\tthis._resolveCodeLensesDebounce.default(),\n\t\t);\n\n\t\tthis._disposables.add(\n\t\t\tthis._editor.onDidChangeModel(() => this._onModelChange()),\n\t\t);\n\t\tthis._disposables.add(\n\t\t\tthis._editor.onDidChangeModelLanguage(() => this._onModelChange()),\n\t\t);\n\t\tthis._disposables.add(\n\t\t\tthis._editor.onDidChangeConfiguration((e) => {\n\t\t\t\tif (\n\t\t\t\t\te.hasChanged(EditorOption.fontInfo) ||\n\t\t\t\t\te.hasChanged(EditorOption.codeLensFontSize) ||\n\t\t\t\t\te.hasChanged(EditorOption.codeLensFontFamily)\n\t\t\t\t) {\n\t\t\t\t\tthis._updateLensStyle();\n\t\t\t\t}\n\t\t\t\tif (e.hasChanged(EditorOption.codeLens)) {\n\t\t\t\t\tthis._onModelChange();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._disposables.add(\n\t\t\t_languageFeaturesService.codeLensProvider.onDidChange(\n\t\t\t\tthis._onModelChange,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\t\tthis._onModelChange();\n\n\t\tthis._updateLensStyle();\n\t}\n\n\tdispose(): void {\n\t\tthis._localDispose();\n\t\tthis._disposables.dispose();\n\t\tthis._oldCodeLensModels.dispose();\n\t\tthis._currentCodeLensModel?.dispose();\n\t}\n\n\tprivate _getLayoutInfo() {\n\t\tconst lineHeightFactor = Math.max(\n\t\t\t1.3,\n\t\t\tthis._editor.getOption(EditorOption.lineHeight) /\n\t\t\t\tthis._editor.getOption(EditorOption.fontSize),\n\t\t);\n\t\tlet fontSize = this._editor.getOption(EditorOption.codeLensFontSize);\n\t\tif (!fontSize || fontSize < 5) {\n\t\t\tfontSize =\n\t\t\t\t(this._editor.getOption(EditorOption.fontSize) * 0.9) | 0;\n\t\t}\n\t\treturn {\n\t\t\tfontSize,\n\t\t\tcodeLensHeight: (fontSize * lineHeightFactor) | 0,\n\t\t};\n\t}\n\n\tprivate _updateLensStyle(): void {\n\t\tconst { codeLensHeight, fontSize } = this._getLayoutInfo();\n\t\tconst fontFamily = this._editor.getOption(\n\t\t\tEditorOption.codeLensFontFamily,\n\t\t);\n\t\tconst editorFontInfo = this._editor.getOption(EditorOption.fontInfo);\n\n\t\tconst { style } = this._editor.getContainerDomNode();\n\n\t\tstyle.setProperty(\n\t\t\t\"--vscode-editorCodeLens-lineHeight\",\n\t\t\t`${codeLensHeight}px`,\n\t\t);\n\t\tstyle.setProperty(\"--vscode-editorCodeLens-fontSize\", `${fontSize}px`);\n\t\tstyle.setProperty(\n\t\t\t\"--vscode-editorCodeLens-fontFeatureSettings\",\n\t\t\teditorFontInfo.fontFeatureSettings,\n\t\t);\n\n\t\tif (fontFamily) {\n\t\t\tstyle.setProperty(\"--vscode-editorCodeLens-fontFamily\", fontFamily);\n\t\t\tstyle.setProperty(\n\t\t\t\t\"--vscode-editorCodeLens-fontFamilyDefault\",\n\t\t\t\tEDITOR_FONT_DEFAULTS.fontFamily,\n\t\t\t);\n\t\t}\n\n\t\t//\n\t\tthis._editor.changeViewZones((accessor) => {\n\t\t\tfor (const lens of this._lenses) {\n\t\t\t\tlens.updateHeight(codeLensHeight, accessor);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _localDispose(): void {\n\t\tthis._getCodeLensModelPromise?.cancel();\n\t\tthis._getCodeLensModelPromise = undefined;\n\t\tthis._resolveCodeLensesPromise?.cancel();\n\t\tthis._resolveCodeLensesPromise = undefined;\n\t\tthis._localToDispose.clear();\n\t\tthis._oldCodeLensModels.clear();\n\t\tthis._currentCodeLensModel?.dispose();\n\t}\n\n\tprivate _onModelChange(): void {\n\t\tthis._localDispose();\n\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!this._editor.getOption(EditorOption.codeLens) ||\n\t\t\tmodel.isTooLargeForTokenization()\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cachedLenses = this._codeLensCache.get(model);\n\t\tif (cachedLenses) {\n\t\t\tthis._renderCodeLensSymbols(cachedLenses);\n\t\t}\n\n\t\tif (!this._languageFeaturesService.codeLensProvider.has(model)) {\n\t\t\t// no provider -> return but check with\n\t\t\t// cached lenses. they expire after 30 seconds\n\t\t\tif (cachedLenses) {\n\t\t\t\tdisposableTimeout(\n\t\t\t\t\t() => {\n\t\t\t\t\t\tconst cachedLensesNow = this._codeLensCache.get(model);\n\t\t\t\t\t\tif (cachedLenses === cachedLensesNow) {\n\t\t\t\t\t\t\tthis._codeLensCache.delete(model);\n\t\t\t\t\t\t\tthis._onModelChange();\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\t30 * 1000,\n\t\t\t\t\tthis._localToDispose,\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tfor (const provider of this._languageFeaturesService.codeLensProvider.all(\n\t\t\tmodel,\n\t\t)) {\n\t\t\tif (typeof provider.onDidChange === \"function\") {\n\t\t\t\tconst registration = provider.onDidChange(() =>\n\t\t\t\t\tscheduler.schedule(),\n\t\t\t\t);\n\t\t\t\tthis._localToDispose.add(registration);\n\t\t\t}\n\t\t}\n\n\t\tconst scheduler = new RunOnceScheduler(() => {\n\t\t\tconst t1 = Date.now();\n\n\t\t\tthis._getCodeLensModelPromise?.cancel();\n\t\t\tthis._getCodeLensModelPromise = createCancelablePromise((token) =>\n\t\t\t\tgetCodeLensModel(\n\t\t\t\t\tthis._languageFeaturesService.codeLensProvider,\n\t\t\t\t\tmodel,\n\t\t\t\t\ttoken,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tthis._getCodeLensModelPromise.then((result) => {\n\t\t\t\tif (this._currentCodeLensModel) {\n\t\t\t\t\tthis._oldCodeLensModels.add(this._currentCodeLensModel);\n\t\t\t\t}\n\t\t\t\tthis._currentCodeLensModel = result;\n\n\t\t\t\t// cache model to reduce flicker\n\t\t\t\tthis._codeLensCache.put(model, result);\n\n\t\t\t\t// update moving average\n\t\t\t\tconst newDelay = this._provideCodeLensDebounce.update(\n\t\t\t\t\tmodel,\n\t\t\t\t\tDate.now() - t1,\n\t\t\t\t);\n\t\t\t\tscheduler.delay = newDelay;\n\n\t\t\t\t// render lenses\n\t\t\t\tthis._renderCodeLensSymbols(result);\n\t\t\t\t// dom.scheduleAtNextAnimationFrame(() => this._resolveCodeLensesInViewport());\n\t\t\t\tthis._resolveCodeLensesInViewportSoon();\n\t\t\t}, onUnexpectedError);\n\t\t}, this._provideCodeLensDebounce.get(model));\n\n\t\tthis._localToDispose.add(scheduler);\n\t\tthis._localToDispose.add(\n\t\t\ttoDisposable(() => this._resolveCodeLensesScheduler.cancel()),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onDidChangeModelContent(() => {\n\t\t\t\tthis._editor.changeDecorations((decorationsAccessor) => {\n\t\t\t\t\tthis._editor.changeViewZones((viewZonesAccessor) => {\n\t\t\t\t\t\tconst toDispose: CodeLensWidget[] = [];\n\t\t\t\t\t\tlet lastLensLineNumber = -1;\n\n\t\t\t\t\t\tthis._lenses.forEach((lens) => {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!lens.isValid() ||\n\t\t\t\t\t\t\t\tlastLensLineNumber === lens.getLineNumber()\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// invalid -> lens collapsed, attach range doesn't exist anymore\n\t\t\t\t\t\t\t\t// line_number -> lenses should never be on the same line\n\t\t\t\t\t\t\t\ttoDispose.push(lens);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tlens.update(viewZonesAccessor);\n\t\t\t\t\t\t\t\tlastLensLineNumber = lens.getLineNumber();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst helper = new CodeLensHelper();\n\t\t\t\t\t\ttoDispose.forEach((l) => {\n\t\t\t\t\t\t\tl.dispose(helper, viewZonesAccessor);\n\t\t\t\t\t\t\tthis._lenses.splice(this._lenses.indexOf(l), 1);\n\t\t\t\t\t\t});\n\t\t\t\t\t\thelper.commit(decorationsAccessor);\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t// Ask for all references again\n\t\t\t\tscheduler.schedule();\n\n\t\t\t\t// Cancel pending and active resolve requests\n\t\t\t\tthis._resolveCodeLensesScheduler.cancel();\n\t\t\t\tthis._resolveCodeLensesPromise?.cancel();\n\t\t\t\tthis._resolveCodeLensesPromise = undefined;\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onDidFocusEditorText(() => {\n\t\t\t\tscheduler.schedule();\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onDidBlurEditorText(() => {\n\t\t\t\tscheduler.cancel();\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onDidScrollChange((e) => {\n\t\t\t\tif (e.scrollTopChanged && this._lenses.length > 0) {\n\t\t\t\t\tthis._resolveCodeLensesInViewportSoon();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onDidLayoutChange(() => {\n\t\t\t\tthis._resolveCodeLensesInViewportSoon();\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\ttoDisposable(() => {\n\t\t\t\tif (this._editor.getModel()) {\n\t\t\t\t\tconst scrollState = StableEditorScrollState.capture(\n\t\t\t\t\t\tthis._editor,\n\t\t\t\t\t);\n\t\t\t\t\tthis._editor.changeDecorations((decorationsAccessor) => {\n\t\t\t\t\t\tthis._editor.changeViewZones((viewZonesAccessor) => {\n\t\t\t\t\t\t\tthis._disposeAllLenses(\n\t\t\t\t\t\t\t\tdecorationsAccessor,\n\t\t\t\t\t\t\t\tviewZonesAccessor,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tscrollState.restore(this._editor);\n\t\t\t\t} else {\n\t\t\t\t\t// No accessors available\n\t\t\t\t\tthis._disposeAllLenses(undefined, undefined);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._localToDispose.add(\n\t\t\tthis._editor.onMouseDown((e) => {\n\t\t\t\tif (e.target.type !== MouseTargetType.CONTENT_WIDGET) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tlet target = e.target.element;\n\t\t\t\tif (target?.tagName === \"SPAN\") {\n\t\t\t\t\ttarget = target.parentElement;\n\t\t\t\t}\n\t\t\t\tif (target?.tagName === \"A\") {\n\t\t\t\t\tfor (const lens of this._lenses) {\n\t\t\t\t\t\tconst command = lens.getCommand(\n\t\t\t\t\t\t\ttarget as HTMLLinkElement,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (command) {\n\t\t\t\t\t\t\tthis._commandService\n\t\t\t\t\t\t\t\t.executeCommand(\n\t\t\t\t\t\t\t\t\tcommand.id,\n\t\t\t\t\t\t\t\t\t...(command.arguments || []),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.catch((err) =>\n\t\t\t\t\t\t\t\t\tthis._notificationService.error(err),\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tscheduler.schedule();\n\t}\n\n\tprivate _disposeAllLenses(\n\t\tdecChangeAccessor: IModelDecorationsChangeAccessor | undefined,\n\t\tviewZoneChangeAccessor: IViewZoneChangeAccessor | undefined,\n\t): void {\n\t\tconst helper = new CodeLensHelper();\n\t\tfor (const lens of this._lenses) {\n\t\t\tlens.dispose(helper, viewZoneChangeAccessor);\n\t\t}\n\t\tif (decChangeAccessor) {\n\t\t\thelper.commit(decChangeAccessor);\n\t\t}\n\t\tthis._lenses.length = 0;\n\t}\n\n\tprivate _renderCodeLensSymbols(symbols: CodeLensModel): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxLineNumber = this._editor.getModel().getLineCount();\n\t\tconst groups: CodeLensItem[][] = [];\n\t\tlet lastGroup: CodeLensItem[] | undefined;\n\n\t\tfor (const symbol of symbols.lenses) {\n\t\t\tconst line = symbol.symbol.range.startLineNumber;\n\t\t\tif (line < 1 || line > maxLineNumber) {\n\t\t\t\t// invalid code lens\n\t\t\t\tcontinue;\n\t\t\t} else if (\n\t\t\t\tlastGroup &&\n\t\t\t\tlastGroup[lastGroup.length - 1].symbol.range.startLineNumber ===\n\t\t\t\t\tline\n\t\t\t) {\n\t\t\t\t// on same line as previous\n\t\t\t\tlastGroup.push(symbol);\n\t\t\t} else {\n\t\t\t\t// on later line as previous\n\t\t\t\tlastGroup = [symbol];\n\t\t\t\tgroups.push(lastGroup);\n\t\t\t}\n\t\t}\n\n\t\tif (!groups.length && !this._lenses.length) {\n\t\t\t// Nothing to change\n\t\t\treturn;\n\t\t}\n\n\t\tconst scrollState = StableEditorScrollState.capture(this._editor);\n\t\tconst layoutInfo = this._getLayoutInfo();\n\n\t\tthis._editor.changeDecorations((decorationsAccessor) => {\n\t\t\tthis._editor.changeViewZones((viewZoneAccessor) => {\n\t\t\t\tconst helper = new CodeLensHelper();\n\t\t\t\tlet codeLensIndex = 0;\n\t\t\t\tlet groupsIndex = 0;\n\n\t\t\t\twhile (\n\t\t\t\t\tgroupsIndex < groups.length &&\n\t\t\t\t\tcodeLensIndex < this._lenses.length\n\t\t\t\t) {\n\t\t\t\t\tconst symbolsLineNumber =\n\t\t\t\t\t\tgroups[groupsIndex][0].symbol.range.startLineNumber;\n\t\t\t\t\tconst codeLensLineNumber =\n\t\t\t\t\t\tthis._lenses[codeLensIndex].getLineNumber();\n\n\t\t\t\t\tif (codeLensLineNumber < symbolsLineNumber) {\n\t\t\t\t\t\tthis._lenses[codeLensIndex].dispose(\n\t\t\t\t\t\t\thelper,\n\t\t\t\t\t\t\tviewZoneAccessor,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis._lenses.splice(codeLensIndex, 1);\n\t\t\t\t\t} else if (codeLensLineNumber === symbolsLineNumber) {\n\t\t\t\t\t\tthis._lenses[codeLensIndex].updateCodeLensSymbols(\n\t\t\t\t\t\t\tgroups[groupsIndex],\n\t\t\t\t\t\t\thelper,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tgroupsIndex++;\n\t\t\t\t\t\tcodeLensIndex++;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._lenses.splice(\n\t\t\t\t\t\t\tcodeLensIndex,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\tnew CodeLensWidget(\n\t\t\t\t\t\t\t\tgroups[groupsIndex],\n\t\t\t\t\t\t\t\t<IActiveCodeEditor>this._editor,\n\t\t\t\t\t\t\t\thelper,\n\t\t\t\t\t\t\t\tviewZoneAccessor,\n\t\t\t\t\t\t\t\tlayoutInfo.codeLensHeight,\n\t\t\t\t\t\t\t\t() => this._resolveCodeLensesInViewportSoon(),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcodeLensIndex++;\n\t\t\t\t\t\tgroupsIndex++;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Delete extra code lenses\n\t\t\t\twhile (codeLensIndex < this._lenses.length) {\n\t\t\t\t\tthis._lenses[codeLensIndex].dispose(\n\t\t\t\t\t\thelper,\n\t\t\t\t\t\tviewZoneAccessor,\n\t\t\t\t\t);\n\t\t\t\t\tthis._lenses.splice(codeLensIndex, 1);\n\t\t\t\t}\n\n\t\t\t\t// Create extra symbols\n\t\t\t\twhile (groupsIndex < groups.length) {\n\t\t\t\t\tthis._lenses.push(\n\t\t\t\t\t\tnew CodeLensWidget(\n\t\t\t\t\t\t\tgroups[groupsIndex],\n\t\t\t\t\t\t\t<IActiveCodeEditor>this._editor,\n\t\t\t\t\t\t\thelper,\n\t\t\t\t\t\t\tviewZoneAccessor,\n\t\t\t\t\t\t\tlayoutInfo.codeLensHeight,\n\t\t\t\t\t\t\t() => this._resolveCodeLensesInViewportSoon(),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t\tgroupsIndex++;\n\t\t\t\t}\n\n\t\t\t\thelper.commit(decorationsAccessor);\n\t\t\t});\n\t\t});\n\n\t\tscrollState.restore(this._editor);\n\t}\n\n\tprivate _resolveCodeLensesInViewportSoon(): void {\n\t\tconst model = this._editor.getModel();\n\t\tif (model) {\n\t\t\tthis._resolveCodeLensesScheduler.schedule();\n\t\t}\n\t}\n\n\tprivate _resolveCodeLensesInViewport(): void {\n\t\tthis._resolveCodeLensesPromise?.cancel();\n\t\tthis._resolveCodeLensesPromise = undefined;\n\n\t\tconst model = this._editor.getModel();\n\t\tif (!model) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst toResolve: CodeLensItem[][] = [];\n\t\tconst lenses: CodeLensWidget[] = [];\n\t\tthis._lenses.forEach((lens) => {\n\t\t\tconst request = lens.computeIfNecessary(model);\n\t\t\tif (request) {\n\t\t\t\ttoResolve.push(request);\n\t\t\t\tlenses.push(lens);\n\t\t\t}\n\t\t});\n\n\t\tif (toResolve.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst t1 = Date.now();\n\n\t\tconst resolvePromise = createCancelablePromise((token) => {\n\t\t\tconst promises = toResolve.map((request, i) => {\n\t\t\t\tconst resolvedSymbols = new Array<CodeLens | undefined | null>(\n\t\t\t\t\trequest.length,\n\t\t\t\t);\n\t\t\t\tconst promises = request.map((request, i) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!request.symbol.command &&\n\t\t\t\t\t\ttypeof request.provider.resolveCodeLens === \"function\"\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn Promise.resolve(\n\t\t\t\t\t\t\trequest.provider.resolveCodeLens(\n\t\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\t\trequest.symbol,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t).then((symbol) => {\n\t\t\t\t\t\t\tresolvedSymbols[i] = symbol;\n\t\t\t\t\t\t}, onUnexpectedExternalError);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolvedSymbols[i] = request.symbol;\n\t\t\t\t\t\treturn Promise.resolve(undefined);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn Promise.all(promises).then(() => {\n\t\t\t\t\tif (\n\t\t\t\t\t\t!token.isCancellationRequested &&\n\t\t\t\t\t\t!lenses[i].isDisposed()\n\t\t\t\t\t) {\n\t\t\t\t\t\tlenses[i].updateCommands(resolvedSymbols);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t});\n\n\t\t\treturn Promise.all(promises);\n\t\t});\n\t\tthis._resolveCodeLensesPromise = resolvePromise;\n\n\t\tthis._resolveCodeLensesPromise.then(\n\t\t\t() => {\n\t\t\t\t// update moving average\n\t\t\t\tconst newDelay = this._resolveCodeLensesDebounce.update(\n\t\t\t\t\tmodel,\n\t\t\t\t\tDate.now() - t1,\n\t\t\t\t);\n\t\t\t\tthis._resolveCodeLensesScheduler.delay = newDelay;\n\n\t\t\t\tif (this._currentCodeLensModel) {\n\t\t\t\t\t// update the cached state with new resolved items\n\t\t\t\t\tthis._codeLensCache.put(model, this._currentCodeLensModel);\n\t\t\t\t}\n\t\t\t\tthis._oldCodeLensModels.clear(); // dispose old models once we have updated the UI with the current model\n\t\t\t\tif (resolvePromise === this._resolveCodeLensesPromise) {\n\t\t\t\t\tthis._resolveCodeLensesPromise = undefined;\n\t\t\t\t}\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tonUnexpectedError(err); // can also be cancellation!\n\t\t\t\tif (resolvePromise === this._resolveCodeLensesPromise) {\n\t\t\t\t\tthis._resolveCodeLensesPromise = undefined;\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync getModel(): Promise<CodeLensModel | undefined> {\n\t\tawait this._getCodeLensModelPromise;\n\t\tawait this._resolveCodeLensesPromise;\n\t\treturn this._currentCodeLensModel?.isDisposed\n\t\t\t? undefined\n\t\t\t: this._currentCodeLensModel;\n\t}\n}\n\nregisterEditorContribution(\n\tCodeLensContribution.ID,\n\tCodeLensContribution,\n\tEditorContributionInstantiation.AfterFirstRender,\n);\n\nregisterEditorAction(\n\tclass ShowLensesInCurrentLine extends EditorAction {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: \"codelens.showLensesInCurrentLine\",\n\t\t\t\tprecondition: EditorContextKeys.hasCodeLensProvider,\n\t\t\t\tlabel: localize(\n\t\t\t\t\t\"showLensOnLine\",\n\t\t\t\t\t\"Show CodeLens Commands For Current Line\",\n\t\t\t\t),\n\t\t\t\talias: \"Show CodeLens Commands For Current Line\",\n\t\t\t});\n\t\t}\n\n\t\tasync run(\n\t\t\taccessor: ServicesAccessor,\n\t\t\teditor: ICodeEditor,\n\t\t): Promise<void> {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\t\tconst commandService = accessor.get(ICommandService);\n\t\t\tconst notificationService = accessor.get(INotificationService);\n\n\t\t\tconst lineNumber = editor.getSelection().positionLineNumber;\n\t\t\tconst codelensController =\n\t\t\t\teditor.getContribution<CodeLensContribution>(\n\t\t\t\t\tCodeLensContribution.ID,\n\t\t\t\t);\n\t\t\tif (!codelensController) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst model = await codelensController.getModel();\n\t\t\tif (!model) {\n\t\t\t\t// nothing\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst items: { label: string; command: Command }[] = [];\n\t\t\tfor (const lens of model.lenses) {\n\t\t\t\tif (\n\t\t\t\t\tlens.symbol.command &&\n\t\t\t\t\tlens.symbol.range.startLineNumber === lineNumber\n\t\t\t\t) {\n\t\t\t\t\titems.push({\n\t\t\t\t\t\tlabel: lens.symbol.command.title,\n\t\t\t\t\t\tcommand: lens.symbol.command,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (items.length === 0) {\n\t\t\t\t// We dont want an empty picker\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst item = await quickInputService.pick(items, {\n\t\t\t\tcanPickMany: false,\n\t\t\t\tplaceHolder: localize(\"placeHolder\", \"Select a command\"),\n\t\t\t});\n\t\t\tif (!item) {\n\t\t\t\t// Nothing picked\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet command = item.command;\n\n\t\t\tif (model.isDisposed) {\n\t\t\t\t// try to find the same command again in-case the model has been re-created in the meantime\n\t\t\t\t// this is a best attempt approach which shouldn't be needed because eager model re-creates\n\t\t\t\t// shouldn't happen due to focus in/out anymore\n\t\t\t\tconst newModel = await codelensController.getModel();\n\t\t\t\tconst newLens = newModel?.lenses.find(\n\t\t\t\t\t(lens) =>\n\t\t\t\t\t\tlens.symbol.range.startLineNumber === lineNumber &&\n\t\t\t\t\t\tlens.symbol.command?.title === command.title,\n\t\t\t\t);\n\t\t\t\tif (!newLens || !newLens.symbol.command) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tcommand = newLens.symbol.command;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tawait commandService.executeCommand(\n\t\t\t\t\tcommand.id,\n\t\t\t\t\t...(command.arguments || []),\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tnotificationService.error(err);\n\t\t\t}\n\t\t}\n\t},\n);\n"],
  "mappings": ";;;;;;;;;;;;AAKA;AAAA,EAEC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,gBAAgB;AACzB,SAAS,uBAAuB;AAChC,SAAS,4BAA4B;AACrC,SAAS,0BAA0B;AACnC;AAAA,EAIC;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,OACM;AACP,SAAS,+BAA+B;AACxC;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAEP,SAAS,yBAAyB;AAGlC;AAAA,EAEC;AAAA,OACM;AACP,SAAS,gCAAgC;AACzC,SAAS,sBAAsB;AAC/B;AAAA,EAGC;AAAA,OACM;AACP,SAAS,gBAAgB,sBAAsB;AAExC,IAAM,uBAAN,MAA0D;AAAA,EAmBhE,YACkB,SAEA,0BAEjB,iBACkC,iBAEjB,sBACgB,gBAChC;AATgB;AAEA;AAGiB;AAEjB;AACgB;AAEjC,SAAK,2BAA2B,gBAAgB;AAAA,MAC/C,yBAAyB;AAAA,MACzB;AAAA,MACA,EAAE,KAAK,IAAI;AAAA,IACZ;AACA,SAAK,6BAA6B,gBAAgB;AAAA,MACjD,yBAAyB;AAAA,MACzB;AAAA,MACA,EAAE,KAAK,KAAK,MAAM,UAAU;AAAA,IAC7B;AACA,SAAK,8BAA8B,IAAI;AAAA,MACtC,MAAM,KAAK,6BAA6B;AAAA,MACxC,KAAK,2BAA2B,QAAQ;AAAA,IACzC;AAEA,SAAK,aAAa;AAAA,MACjB,KAAK,QAAQ,iBAAiB,MAAM,KAAK,eAAe,CAAC;AAAA,IAC1D;AACA,SAAK,aAAa;AAAA,MACjB,KAAK,QAAQ,yBAAyB,MAAM,KAAK,eAAe,CAAC;AAAA,IAClE;AACA,SAAK,aAAa;AAAA,MACjB,KAAK,QAAQ,yBAAyB,CAAC,MAAM;AAC5C,YACC,EAAE,WAAW,aAAa,QAAQ,KAClC,EAAE,WAAW,aAAa,gBAAgB,KAC1C,EAAE,WAAW,aAAa,kBAAkB,GAC3C;AACD,eAAK,iBAAiB;AAAA,QACvB;AACA,YAAI,EAAE,WAAW,aAAa,QAAQ,GAAG;AACxC,eAAK,eAAe;AAAA,QACrB;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK,aAAa;AAAA,MACjB,yBAAyB,iBAAiB;AAAA,QACzC,KAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD;AACA,SAAK,eAAe;AAEpB,SAAK,iBAAiB;AAAA,EACvB;AAAA,EApID,OA0DiE;AAAA;AAAA;AAAA,EAChE,OAAgB,KAAa;AAAA,EAEZ,eAAe,IAAI,gBAAgB;AAAA,EACnC,kBAAkB,IAAI,gBAAgB;AAAA,EAEtC,UAA4B,CAAC;AAAA,EAE7B;AAAA,EACA;AAAA,EACA;AAAA,EAET;AAAA,EAGS,qBAAqB,IAAI,gBAAgB;AAAA,EAClD;AAAA,EACA;AAAA,EA2DR,UAAgB;AACf,SAAK,cAAc;AACnB,SAAK,aAAa,QAAQ;AAC1B,SAAK,mBAAmB,QAAQ;AAChC,SAAK,uBAAuB,QAAQ;AAAA,EACrC;AAAA,EAEQ,iBAAiB;AACxB,UAAM,mBAAmB,KAAK;AAAA,MAC7B;AAAA,MACA,KAAK,QAAQ,UAAU,aAAa,UAAU,IAC7C,KAAK,QAAQ,UAAU,aAAa,QAAQ;AAAA,IAC9C;AACA,QAAI,WAAW,KAAK,QAAQ,UAAU,aAAa,gBAAgB;AACnE,QAAI,CAAC,YAAY,WAAW,GAAG;AAC9B,iBACE,KAAK,QAAQ,UAAU,aAAa,QAAQ,IAAI,MAAO;AAAA,IAC1D;AACA,WAAO;AAAA,MACN;AAAA,MACA,gBAAiB,WAAW,mBAAoB;AAAA,IACjD;AAAA,EACD;AAAA,EAEQ,mBAAyB;AAChC,UAAM,EAAE,gBAAgB,SAAS,IAAI,KAAK,eAAe;AACzD,UAAM,aAAa,KAAK,QAAQ;AAAA,MAC/B,aAAa;AAAA,IACd;AACA,UAAM,iBAAiB,KAAK,QAAQ,UAAU,aAAa,QAAQ;AAEnE,UAAM,EAAE,MAAM,IAAI,KAAK,QAAQ,oBAAoB;AAEnD,UAAM;AAAA,MACL;AAAA,MACA,GAAG,cAAc;AAAA,IAClB;AACA,UAAM,YAAY,oCAAoC,GAAG,QAAQ,IAAI;AACrE,UAAM;AAAA,MACL;AAAA,MACA,eAAe;AAAA,IAChB;AAEA,QAAI,YAAY;AACf,YAAM,YAAY,sCAAsC,UAAU;AAClE,YAAM;AAAA,QACL;AAAA,QACA,qBAAqB;AAAA,MACtB;AAAA,IACD;AAGA,SAAK,QAAQ,gBAAgB,CAAC,aAAa;AAC1C,iBAAW,QAAQ,KAAK,SAAS;AAChC,aAAK,aAAa,gBAAgB,QAAQ;AAAA,MAC3C;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEQ,gBAAsB;AAC7B,SAAK,0BAA0B,OAAO;AACtC,SAAK,2BAA2B;AAChC,SAAK,2BAA2B,OAAO;AACvC,SAAK,4BAA4B;AACjC,SAAK,gBAAgB,MAAM;AAC3B,SAAK,mBAAmB,MAAM;AAC9B,SAAK,uBAAuB,QAAQ;AAAA,EACrC;AAAA,EAEQ,iBAAuB;AAC9B,SAAK,cAAc;AAEnB,UAAM,QAAQ,KAAK,QAAQ,SAAS;AACpC,QAAI,CAAC,OAAO;AACX;AAAA,IACD;AAEA,QACC,CAAC,KAAK,QAAQ,UAAU,aAAa,QAAQ,KAC7C,MAAM,0BAA0B,GAC/B;AACD;AAAA,IACD;AAEA,UAAM,eAAe,KAAK,eAAe,IAAI,KAAK;AAClD,QAAI,cAAc;AACjB,WAAK,uBAAuB,YAAY;AAAA,IACzC;AAEA,QAAI,CAAC,KAAK,yBAAyB,iBAAiB,IAAI,KAAK,GAAG;AAG/D,UAAI,cAAc;AACjB;AAAA,UACC,MAAM;AACL,kBAAM,kBAAkB,KAAK,eAAe,IAAI,KAAK;AACrD,gBAAI,iBAAiB,iBAAiB;AACrC,mBAAK,eAAe,OAAO,KAAK;AAChC,mBAAK,eAAe;AAAA,YACrB;AAAA,UACD;AAAA,UACA,KAAK;AAAA,UACL,KAAK;AAAA,QACN;AAAA,MACD;AACA;AAAA,IACD;AAEA,eAAW,YAAY,KAAK,yBAAyB,iBAAiB;AAAA,MACrE;AAAA,IACD,GAAG;AACF,UAAI,OAAO,SAAS,gBAAgB,YAAY;AAC/C,cAAM,eAAe,SAAS;AAAA,UAAY,MACzC,UAAU,SAAS;AAAA,QACpB;AACA,aAAK,gBAAgB,IAAI,YAAY;AAAA,MACtC;AAAA,IACD;AAEA,UAAM,YAAY,IAAI,iBAAiB,MAAM;AAC5C,YAAM,KAAK,KAAK,IAAI;AAEpB,WAAK,0BAA0B,OAAO;AACtC,WAAK,2BAA2B;AAAA,QAAwB,CAAC,UACxD;AAAA,UACC,KAAK,yBAAyB;AAAA,UAC9B;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAEA,WAAK,yBAAyB,KAAK,CAAC,WAAW;AAC9C,YAAI,KAAK,uBAAuB;AAC/B,eAAK,mBAAmB,IAAI,KAAK,qBAAqB;AAAA,QACvD;AACA,aAAK,wBAAwB;AAG7B,aAAK,eAAe,IAAI,OAAO,MAAM;AAGrC,cAAM,WAAW,KAAK,yBAAyB;AAAA,UAC9C;AAAA,UACA,KAAK,IAAI,IAAI;AAAA,QACd;AACA,kBAAU,QAAQ;AAGlB,aAAK,uBAAuB,MAAM;AAElC,aAAK,iCAAiC;AAAA,MACvC,GAAG,iBAAiB;AAAA,IACrB,GAAG,KAAK,yBAAyB,IAAI,KAAK,CAAC;AAE3C,SAAK,gBAAgB,IAAI,SAAS;AAClC,SAAK,gBAAgB;AAAA,MACpB,aAAa,MAAM,KAAK,4BAA4B,OAAO,CAAC;AAAA,IAC7D;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,wBAAwB,MAAM;AAC1C,aAAK,QAAQ,kBAAkB,CAAC,wBAAwB;AACvD,eAAK,QAAQ,gBAAgB,CAAC,sBAAsB;AACnD,kBAAM,YAA8B,CAAC;AACrC,gBAAI,qBAAqB;AAEzB,iBAAK,QAAQ,QAAQ,CAAC,SAAS;AAC9B,kBACC,CAAC,KAAK,QAAQ,KACd,uBAAuB,KAAK,cAAc,GACzC;AAGD,0BAAU,KAAK,IAAI;AAAA,cACpB,OAAO;AACN,qBAAK,OAAO,iBAAiB;AAC7B,qCAAqB,KAAK,cAAc;AAAA,cACzC;AAAA,YACD,CAAC;AAED,kBAAM,SAAS,IAAI,eAAe;AAClC,sBAAU,QAAQ,CAAC,MAAM;AACxB,gBAAE,QAAQ,QAAQ,iBAAiB;AACnC,mBAAK,QAAQ,OAAO,KAAK,QAAQ,QAAQ,CAAC,GAAG,CAAC;AAAA,YAC/C,CAAC;AACD,mBAAO,OAAO,mBAAmB;AAAA,UAClC,CAAC;AAAA,QACF,CAAC;AAGD,kBAAU,SAAS;AAGnB,aAAK,4BAA4B,OAAO;AACxC,aAAK,2BAA2B,OAAO;AACvC,aAAK,4BAA4B;AAAA,MAClC,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,qBAAqB,MAAM;AACvC,kBAAU,SAAS;AAAA,MACpB,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,oBAAoB,MAAM;AACtC,kBAAU,OAAO;AAAA,MAClB,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,kBAAkB,CAAC,MAAM;AACrC,YAAI,EAAE,oBAAoB,KAAK,QAAQ,SAAS,GAAG;AAClD,eAAK,iCAAiC;AAAA,QACvC;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,kBAAkB,MAAM;AACpC,aAAK,iCAAiC;AAAA,MACvC,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,aAAa,MAAM;AAClB,YAAI,KAAK,QAAQ,SAAS,GAAG;AAC5B,gBAAM,cAAc,wBAAwB;AAAA,YAC3C,KAAK;AAAA,UACN;AACA,eAAK,QAAQ,kBAAkB,CAAC,wBAAwB;AACvD,iBAAK,QAAQ,gBAAgB,CAAC,sBAAsB;AACnD,mBAAK;AAAA,gBACJ;AAAA,gBACA;AAAA,cACD;AAAA,YACD,CAAC;AAAA,UACF,CAAC;AACD,sBAAY,QAAQ,KAAK,OAAO;AAAA,QACjC,OAAO;AAEN,eAAK,kBAAkB,QAAW,MAAS;AAAA,QAC5C;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK,gBAAgB;AAAA,MACpB,KAAK,QAAQ,YAAY,CAAC,MAAM;AAC/B,YAAI,EAAE,OAAO,SAAS,gBAAgB,gBAAgB;AACrD;AAAA,QACD;AACA,YAAI,SAAS,EAAE,OAAO;AACtB,YAAI,QAAQ,YAAY,QAAQ;AAC/B,mBAAS,OAAO;AAAA,QACjB;AACA,YAAI,QAAQ,YAAY,KAAK;AAC5B,qBAAW,QAAQ,KAAK,SAAS;AAChC,kBAAM,UAAU,KAAK;AAAA,cACpB;AAAA,YACD;AACA,gBAAI,SAAS;AACZ,mBAAK,gBACH;AAAA,gBACA,QAAQ;AAAA,gBACR,GAAI,QAAQ,aAAa,CAAC;AAAA,cAC3B,EACC;AAAA,gBAAM,CAAC,QACP,KAAK,qBAAqB,MAAM,GAAG;AAAA,cACpC;AACD;AAAA,YACD;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AACA,cAAU,SAAS;AAAA,EACpB;AAAA,EAEQ,kBACP,mBACA,wBACO;AACP,UAAM,SAAS,IAAI,eAAe;AAClC,eAAW,QAAQ,KAAK,SAAS;AAChC,WAAK,QAAQ,QAAQ,sBAAsB;AAAA,IAC5C;AACA,QAAI,mBAAmB;AACtB,aAAO,OAAO,iBAAiB;AAAA,IAChC;AACA,SAAK,QAAQ,SAAS;AAAA,EACvB;AAAA,EAEQ,uBAAuB,SAA8B;AAC5D,QAAI,CAAC,KAAK,QAAQ,SAAS,GAAG;AAC7B;AAAA,IACD;AAEA,UAAM,gBAAgB,KAAK,QAAQ,SAAS,EAAE,aAAa;AAC3D,UAAM,SAA2B,CAAC;AAClC,QAAI;AAEJ,eAAW,UAAU,QAAQ,QAAQ;AACpC,YAAM,OAAO,OAAO,OAAO,MAAM;AACjC,UAAI,OAAO,KAAK,OAAO,eAAe;AAErC;AAAA,MACD,WACC,aACA,UAAU,UAAU,SAAS,CAAC,EAAE,OAAO,MAAM,oBAC5C,MACA;AAED,kBAAU,KAAK,MAAM;AAAA,MACtB,OAAO;AAEN,oBAAY,CAAC,MAAM;AACnB,eAAO,KAAK,SAAS;AAAA,MACtB;AAAA,IACD;AAEA,QAAI,CAAC,OAAO,UAAU,CAAC,KAAK,QAAQ,QAAQ;AAE3C;AAAA,IACD;AAEA,UAAM,cAAc,wBAAwB,QAAQ,KAAK,OAAO;AAChE,UAAM,aAAa,KAAK,eAAe;AAEvC,SAAK,QAAQ,kBAAkB,CAAC,wBAAwB;AACvD,WAAK,QAAQ,gBAAgB,CAAC,qBAAqB;AAClD,cAAM,SAAS,IAAI,eAAe;AAClC,YAAI,gBAAgB;AACpB,YAAI,cAAc;AAElB,eACC,cAAc,OAAO,UACrB,gBAAgB,KAAK,QAAQ,QAC5B;AACD,gBAAM,oBACL,OAAO,WAAW,EAAE,CAAC,EAAE,OAAO,MAAM;AACrC,gBAAM,qBACL,KAAK,QAAQ,aAAa,EAAE,cAAc;AAE3C,cAAI,qBAAqB,mBAAmB;AAC3C,iBAAK,QAAQ,aAAa,EAAE;AAAA,cAC3B;AAAA,cACA;AAAA,YACD;AACA,iBAAK,QAAQ,OAAO,eAAe,CAAC;AAAA,UACrC,WAAW,uBAAuB,mBAAmB;AACpD,iBAAK,QAAQ,aAAa,EAAE;AAAA,cAC3B,OAAO,WAAW;AAAA,cAClB;AAAA,YACD;AACA;AACA;AAAA,UACD,OAAO;AACN,iBAAK,QAAQ;AAAA,cACZ;AAAA,cACA;AAAA,cACA,IAAI;AAAA,gBACH,OAAO,WAAW;AAAA,gBACC,KAAK;AAAA,gBACxB;AAAA,gBACA;AAAA,gBACA,WAAW;AAAA,gBACX,MAAM,KAAK,iCAAiC;AAAA,cAC7C;AAAA,YACD;AACA;AACA;AAAA,UACD;AAAA,QACD;AAGA,eAAO,gBAAgB,KAAK,QAAQ,QAAQ;AAC3C,eAAK,QAAQ,aAAa,EAAE;AAAA,YAC3B;AAAA,YACA;AAAA,UACD;AACA,eAAK,QAAQ,OAAO,eAAe,CAAC;AAAA,QACrC;AAGA,eAAO,cAAc,OAAO,QAAQ;AACnC,eAAK,QAAQ;AAAA,YACZ,IAAI;AAAA,cACH,OAAO,WAAW;AAAA,cACC,KAAK;AAAA,cACxB;AAAA,cACA;AAAA,cACA,WAAW;AAAA,cACX,MAAM,KAAK,iCAAiC;AAAA,YAC7C;AAAA,UACD;AACA;AAAA,QACD;AAEA,eAAO,OAAO,mBAAmB;AAAA,MAClC,CAAC;AAAA,IACF,CAAC;AAED,gBAAY,QAAQ,KAAK,OAAO;AAAA,EACjC;AAAA,EAEQ,mCAAyC;AAChD,UAAM,QAAQ,KAAK,QAAQ,SAAS;AACpC,QAAI,OAAO;AACV,WAAK,4BAA4B,SAAS;AAAA,IAC3C;AAAA,EACD;AAAA,EAEQ,+BAAqC;AAC5C,SAAK,2BAA2B,OAAO;AACvC,SAAK,4BAA4B;AAEjC,UAAM,QAAQ,KAAK,QAAQ,SAAS;AACpC,QAAI,CAAC,OAAO;AACX;AAAA,IACD;AAEA,UAAM,YAA8B,CAAC;AACrC,UAAM,SAA2B,CAAC;AAClC,SAAK,QAAQ,QAAQ,CAAC,SAAS;AAC9B,YAAM,UAAU,KAAK,mBAAmB,KAAK;AAC7C,UAAI,SAAS;AACZ,kBAAU,KAAK,OAAO;AACtB,eAAO,KAAK,IAAI;AAAA,MACjB;AAAA,IACD,CAAC;AAED,QAAI,UAAU,WAAW,GAAG;AAC3B;AAAA,IACD;AAEA,UAAM,KAAK,KAAK,IAAI;AAEpB,UAAM,iBAAiB,wBAAwB,CAAC,UAAU;AACzD,YAAM,WAAW,UAAU,IAAI,CAAC,SAAS,MAAM;AAC9C,cAAM,kBAAkB,IAAI;AAAA,UAC3B,QAAQ;AAAA,QACT;AACA,cAAMA,YAAW,QAAQ,IAAI,CAACC,UAASC,OAAM;AAC5C,cACC,CAACD,SAAQ,OAAO,WAChB,OAAOA,SAAQ,SAAS,oBAAoB,YAC3C;AACD,mBAAO,QAAQ;AAAA,cACdA,SAAQ,SAAS;AAAA,gBAChB;AAAA,gBACAA,SAAQ;AAAA,gBACR;AAAA,cACD;AAAA,YACD,EAAE,KAAK,CAAC,WAAW;AAClB,8BAAgBC,EAAC,IAAI;AAAA,YACtB,GAAG,yBAAyB;AAAA,UAC7B,OAAO;AACN,4BAAgBA,EAAC,IAAID,SAAQ;AAC7B,mBAAO,QAAQ,QAAQ,MAAS;AAAA,UACjC;AAAA,QACD,CAAC;AAED,eAAO,QAAQ,IAAID,SAAQ,EAAE,KAAK,MAAM;AACvC,cACC,CAAC,MAAM,2BACP,CAAC,OAAO,CAAC,EAAE,WAAW,GACrB;AACD,mBAAO,CAAC,EAAE,eAAe,eAAe;AAAA,UACzC;AAAA,QACD,CAAC;AAAA,MACF,CAAC;AAED,aAAO,QAAQ,IAAI,QAAQ;AAAA,IAC5B,CAAC;AACD,SAAK,4BAA4B;AAEjC,SAAK,0BAA0B;AAAA,MAC9B,MAAM;AAEL,cAAM,WAAW,KAAK,2BAA2B;AAAA,UAChD;AAAA,UACA,KAAK,IAAI,IAAI;AAAA,QACd;AACA,aAAK,4BAA4B,QAAQ;AAEzC,YAAI,KAAK,uBAAuB;AAE/B,eAAK,eAAe,IAAI,OAAO,KAAK,qBAAqB;AAAA,QAC1D;AACA,aAAK,mBAAmB,MAAM;AAC9B,YAAI,mBAAmB,KAAK,2BAA2B;AACtD,eAAK,4BAA4B;AAAA,QAClC;AAAA,MACD;AAAA,MACA,CAAC,QAAQ;AACR,0BAAkB,GAAG;AACrB,YAAI,mBAAmB,KAAK,2BAA2B;AACtD,eAAK,4BAA4B;AAAA,QAClC;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,WAA+C;AACpD,UAAM,KAAK;AACX,UAAM,KAAK;AACX,WAAO,KAAK,uBAAuB,aAChC,SACA,KAAK;AAAA,EACT;AACD;AApkBa,uBAAN;AAAA,EAqBJ;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,EAEA;AAAA,GA5BU;AAskBb;AAAA,EACC,qBAAqB;AAAA,EACrB;AAAA,EACA,gCAAgC;AACjC;AAEA;AAAA,EACC,MAAM,gCAAgC,aAAa;AAAA,IAvoBpD,OAuoBoD;AAAA;AAAA;AAAA,IAClD,cAAc;AACb,YAAM;AAAA,QACL,IAAI;AAAA,QACJ,cAAc,kBAAkB;AAAA,QAChC,OAAO;AAAA,UACN;AAAA,UACA;AAAA,QACD;AAAA,QACA,OAAO;AAAA,MACR,CAAC;AAAA,IACF;AAAA,IAEA,MAAM,IACL,UACA,QACgB;AAChB,UAAI,CAAC,OAAO,SAAS,GAAG;AACvB;AAAA,MACD;AAEA,YAAM,oBAAoB,SAAS,IAAI,kBAAkB;AACzD,YAAM,iBAAiB,SAAS,IAAI,eAAe;AACnD,YAAM,sBAAsB,SAAS,IAAI,oBAAoB;AAE7D,YAAM,aAAa,OAAO,aAAa,EAAE;AACzC,YAAM,qBACL,OAAO;AAAA,QACN,qBAAqB;AAAA,MACtB;AACD,UAAI,CAAC,oBAAoB;AACxB;AAAA,MACD;AAEA,YAAM,QAAQ,MAAM,mBAAmB,SAAS;AAChD,UAAI,CAAC,OAAO;AAEX;AAAA,MACD;AAEA,YAAM,QAA+C,CAAC;AACtD,iBAAW,QAAQ,MAAM,QAAQ;AAChC,YACC,KAAK,OAAO,WACZ,KAAK,OAAO,MAAM,oBAAoB,YACrC;AACD,gBAAM,KAAK;AAAA,YACV,OAAO,KAAK,OAAO,QAAQ;AAAA,YAC3B,SAAS,KAAK,OAAO;AAAA,UACtB,CAAC;AAAA,QACF;AAAA,MACD;AAEA,UAAI,MAAM,WAAW,GAAG;AAEvB;AAAA,MACD;AAEA,YAAM,OAAO,MAAM,kBAAkB,KAAK,OAAO;AAAA,QAChD,aAAa;AAAA,QACb,aAAa,SAAS,eAAe,kBAAkB;AAAA,MACxD,CAAC;AACD,UAAI,CAAC,MAAM;AAEV;AAAA,MACD;AAEA,UAAI,UAAU,KAAK;AAEnB,UAAI,MAAM,YAAY;AAIrB,cAAM,WAAW,MAAM,mBAAmB,SAAS;AACnD,cAAM,UAAU,UAAU,OAAO;AAAA,UAChC,CAAC,SACA,KAAK,OAAO,MAAM,oBAAoB,cACtC,KAAK,OAAO,SAAS,UAAU,QAAQ;AAAA,QACzC;AACA,YAAI,CAAC,WAAW,CAAC,QAAQ,OAAO,SAAS;AACxC;AAAA,QACD;AACA,kBAAU,QAAQ,OAAO;AAAA,MAC1B;AAEA,UAAI;AACH,cAAM,eAAe;AAAA,UACpB,QAAQ;AAAA,UACR,GAAI,QAAQ,aAAa,CAAC;AAAA,QAC3B;AAAA,MACD,SAAS,KAAK;AACb,4BAAoB,MAAM,GAAG;AAAA,MAC9B;AAAA,IACD;AAAA,EACD;AACD;",
  "names": ["promises", "request", "i"]
}
