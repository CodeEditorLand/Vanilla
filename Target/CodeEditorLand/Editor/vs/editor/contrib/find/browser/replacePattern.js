import{CharCode as n}from"../../../../base/common/charCode.js";import{buildReplaceStringWithCasePreserved as _}from"../../../../base/common/search.js";var f=(i=>(i[i.StaticValue=0]="StaticValue",i[i.DynamicPieces=1]="DynamicPieces",i))(f||{});class d{constructor(t){this.staticValue=t}kind=0}class P{constructor(t){this.pieces=t}kind=1}class o{static fromStaticValue(t){return new o([h.staticValue(t)])}_state;get hasReplacementPatterns(){return this._state.kind===1}constructor(t){!t||t.length===0?this._state=new d(""):t.length===1&&t[0].staticValue!==null?this._state=new d(t[0].staticValue):this._state=new P(t)}buildReplaceString(t,i){if(this._state.kind===0)return i?_(t,this._state.staticValue):this._state.staticValue;let e="";for(let l=0,p=this._state.pieces.length;l<p;l++){const s=this._state.pieces[l];if(s.staticValue!==null){e+=s.staticValue;continue}let a=o._substitute(s.matchIndex,t);if(s.caseOps!==null&&s.caseOps.length>0){const c=[],m=s.caseOps.length;let g=0;for(let u=0,b=a.length;u<b;u++){if(g>=m){c.push(a.slice(u));break}switch(s.caseOps[g]){case"U":c.push(a[u].toUpperCase());break;case"u":c.push(a[u].toUpperCase()),g++;break;case"L":c.push(a[u].toLowerCase());break;case"l":c.push(a[u].toLowerCase()),g++;break;default:c.push(a[u])}}a=c.join("")}e+=a}return e}static _substitute(t,i){if(i===null)return"";if(t===0)return i[0];let e="";for(;t>0;){if(t<i.length)return(i[t]||"")+e;e=String(t%10)+e,t=Math.floor(t/10)}return"$"+e}}class h{static staticValue(t){return new h(t,-1,null)}static matchIndex(t){return new h(null,t,null)}static caseOps(t,i){return new h(null,t,i)}staticValue;matchIndex;caseOps;constructor(t,i,e){this.staticValue=t,this.matchIndex=i,!e||e.length===0?this.caseOps=null:this.caseOps=e.slice(0)}}class C{_source;_lastCharIndex;_result;_resultLen;_currentStaticPiece;constructor(t){this._source=t,this._lastCharIndex=0,this._result=[],this._resultLen=0,this._currentStaticPiece=""}emitUnchanged(t){this._emitStatic(this._source.substring(this._lastCharIndex,t)),this._lastCharIndex=t}emitStatic(t,i){this._emitStatic(t),this._lastCharIndex=i}_emitStatic(t){t.length!==0&&(this._currentStaticPiece+=t)}emitMatchIndex(t,i,e){this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=h.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),this._result[this._resultLen++]=h.caseOps(t,e),this._lastCharIndex=i}finalize(){return this.emitUnchanged(this._source.length),this._currentStaticPiece.length!==0&&(this._result[this._resultLen++]=h.staticValue(this._currentStaticPiece),this._currentStaticPiece=""),new o(this._result)}}function k(r){if(!r||r.length===0)return new o(null);const t=[],i=new C(r);for(let e=0,l=r.length;e<l;e++){const p=r.charCodeAt(e);if(p===n.Backslash){if(e++,e>=l)break;const s=r.charCodeAt(e);switch(s){case n.Backslash:i.emitUnchanged(e-1),i.emitStatic("\\",e+1);break;case n.n:i.emitUnchanged(e-1),i.emitStatic(`
`,e+1);break;case n.t:i.emitUnchanged(e-1),i.emitStatic("	",e+1);break;case n.u:case n.U:case n.l:case n.L:i.emitUnchanged(e-1),i.emitStatic("",e+1),t.push(String.fromCharCode(s));break}continue}if(p===n.DollarSign){if(e++,e>=l)break;const s=r.charCodeAt(e);if(s===n.DollarSign){i.emitUnchanged(e-1),i.emitStatic("$",e+1);continue}if(s===n.Digit0||s===n.Ampersand){i.emitUnchanged(e-1),i.emitMatchIndex(0,e+1,t),t.length=0;continue}if(n.Digit1<=s&&s<=n.Digit9){let a=s-n.Digit0;if(e+1<l){const c=r.charCodeAt(e+1);if(n.Digit0<=c&&c<=n.Digit9){e++,a=a*10+(c-n.Digit0),i.emitUnchanged(e-2),i.emitMatchIndex(a,e+1,t),t.length=0;continue}}i.emitUnchanged(e-1),i.emitMatchIndex(a,e+1,t),t.length=0;continue}}}return i.finalize()}export{o as ReplacePattern,h as ReplacePiece,k as parseReplaceString};
