import*as d from"../../../../base/browser/dom.js";import"./findOptionsWidget.css";import{CaseSensitiveToggle as g,RegexToggle as p,WholeWordsToggle as _}from"../../../../base/browser/ui/findinput/findInputToggles.js";import{createInstantHoverDelegate as c}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{Widget as v}from"../../../../base/browser/ui/widget.js";import{RunOnceScheduler as m}from"../../../../base/common/async.js";import"../../../../platform/keybinding/common/keybinding.js";import{asCssVariable as n,inputActiveOptionBackground as u,inputActiveOptionBorder as y,inputActiveOptionForeground as b}from"../../../../platform/theme/common/colorRegistry.js";import{OverlayWidgetPositionPreference as f}from"../../../browser/editorBrowser.js";import{FIND_IDS as a}from"./findModel.js";import"./findState.js";class h extends v{static ID="editor.contrib.findOptionsWidget";_editor;_state;_keybindingService;_domNode;regex;wholeWords;caseSensitive;constructor(s,i,l){super(),this._editor=s,this._state=i,this._keybindingService=l,this._domNode=document.createElement("div"),this._domNode.className="findOptionsWidget",this._domNode.style.display="none",this._domNode.style.top="10px",this._domNode.style.zIndex="12",this._domNode.setAttribute("role","presentation"),this._domNode.setAttribute("aria-hidden","true");const o={inputActiveOptionBorder:n(y),inputActiveOptionForeground:n(b),inputActiveOptionBackground:n(u)},r=this._register(c());this.caseSensitive=this._register(new g({appendTitle:this._keybindingLabelFor(a.ToggleCaseSensitiveCommand),isChecked:this._state.matchCase,hoverDelegate:r,...o})),this._domNode.appendChild(this.caseSensitive.domNode),this._register(this.caseSensitive.onChange(()=>{this._state.change({matchCase:this.caseSensitive.checked},!1)})),this.wholeWords=this._register(new _({appendTitle:this._keybindingLabelFor(a.ToggleWholeWordCommand),isChecked:this._state.wholeWord,hoverDelegate:r,...o})),this._domNode.appendChild(this.wholeWords.domNode),this._register(this.wholeWords.onChange(()=>{this._state.change({wholeWord:this.wholeWords.checked},!1)})),this.regex=this._register(new p({appendTitle:this._keybindingLabelFor(a.ToggleRegexCommand),isChecked:this._state.isRegex,hoverDelegate:r,...o})),this._domNode.appendChild(this.regex.domNode),this._register(this.regex.onChange(()=>{this._state.change({isRegex:this.regex.checked},!1)})),this._editor.addOverlayWidget(this),this._register(this._state.onFindReplaceStateChange(e=>{let t=!1;e.isRegex&&(this.regex.checked=this._state.isRegex,t=!0),e.wholeWord&&(this.wholeWords.checked=this._state.wholeWord,t=!0),e.matchCase&&(this.caseSensitive.checked=this._state.matchCase,t=!0),!this._state.isRevealed&&t&&this._revealTemporarily()})),this._register(d.addDisposableListener(this._domNode,d.EventType.MOUSE_LEAVE,e=>this._onMouseLeave())),this._register(d.addDisposableListener(this._domNode,"mouseover",e=>this._onMouseOver()))}_keybindingLabelFor(s){const i=this._keybindingService.lookupKeybinding(s);return i?` (${i.getLabel()})`:""}dispose(){this._editor.removeOverlayWidget(this),super.dispose()}getId(){return h.ID}getDomNode(){return this._domNode}getPosition(){return{preference:f.TOP_RIGHT_CORNER}}highlightFindOptions(){this._revealTemporarily()}_hideSoon=this._register(new m(()=>this._hide(),2e3));_revealTemporarily(){this._show(),this._hideSoon.schedule()}_onMouseLeave(){this._hideSoon.schedule()}_onMouseOver(){this._hideSoon.cancel()}_isVisible=!1;_show(){this._isVisible||(this._isVisible=!0,this._domNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!1,this._domNode.style.display="none")}}export{h as FindOptionsWidget};
