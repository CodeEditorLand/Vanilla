import{Disposable as b}from"../../../../../../vs/base/common/lifecycle.js";import{autorun as d}from"../../../../../../vs/base/common/observable.js";import{firstNonWhitespaceIndex as c}from"../../../../../../vs/base/common/strings.js";import{CursorColumns as S}from"../../../../../../vs/editor/common/core/cursorColumns.js";import"../../../../../../vs/editor/contrib/inlineCompletions/browser/model/inlineCompletionsModel.js";import{localize as a}from"../../../../../../vs/nls.js";import{RawContextKey as r}from"../../../../../../vs/platform/contextkey/common/contextkey.js";class t extends b{constructor(T,f){super();this.contextKeyService=T;this.model=f;this._register(d(n=>{const e=this.model.read(n)?.state.read(n),s=!!e?.inlineCompletion&&e?.primaryGhostText!==void 0&&!e?.primaryGhostText.isEmpty();this.inlineCompletionVisible.set(s),e?.primaryGhostText&&e?.inlineCompletion&&this.suppressSuggestions.set(e.inlineCompletion.inlineCompletion.source.inlineCompletions.suppressSuggestions)})),this._register(d(n=>{const i=this.model.read(n);let e=!1,s=!0;const o=i?.primaryGhostText.read(n);if(i?.selectedSuggestItem&&o&&o.parts.length>0){const{column:p,lines:h}=o.parts[0],u=h[0],m=i.textModel.getLineIndentColumn(o.lineNumber);if(p<=m){let l=c(u);l===-1&&(l=u.length-1),e=l>0;const g=i.textModel.getOptions().tabSize;s=S.visibleColumnFromColumn(u,l+1,g)<g}}this.inlineCompletionSuggestsIndentation.set(e),this.inlineCompletionSuggestsIndentationLessThanTabSize.set(s)}))}static inlineSuggestionVisible=new r("inlineSuggestionVisible",!1,a("inlineSuggestionVisible","Whether an inline suggestion is visible"));static inlineSuggestionHasIndentation=new r("inlineSuggestionHasIndentation",!1,a("inlineSuggestionHasIndentation","Whether the inline suggestion starts with whitespace"));static inlineSuggestionHasIndentationLessThanTabSize=new r("inlineSuggestionHasIndentationLessThanTabSize",!0,a("inlineSuggestionHasIndentationLessThanTabSize","Whether the inline suggestion starts with whitespace that is less than what would be inserted by tab"));static suppressSuggestions=new r("inlineSuggestionSuppressSuggestions",void 0,a("suppressSuggestions","Whether suggestions should be suppressed for the current suggestion"));inlineCompletionVisible=t.inlineSuggestionVisible.bindTo(this.contextKeyService);inlineCompletionSuggestsIndentation=t.inlineSuggestionHasIndentation.bindTo(this.contextKeyService);inlineCompletionSuggestsIndentationLessThanTabSize=t.inlineSuggestionHasIndentationLessThanTabSize.bindTo(this.contextKeyService);suppressSuggestions=t.suppressSuggestions.bindTo(this.contextKeyService)}export{t as InlineCompletionContextKeys};
