var f=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var A=(i,o,e,n)=>{for(var r=n>1?void 0:n?y(o,e):o,m=i.length-1,S;m>=0;m--)(S=i[m])&&(r=(n?S(o,e,r):S(r))||r);return n&&r&&f(o,e,r),r},g=(i,o)=>(e,n)=>o(e,n,i);import{alert as b}from"../../../../../vs/base/browser/ui/aria/aria.js";import{MarkdownString as v}from"../../../../../vs/base/common/htmlContent.js";import{KeyChord as u,KeyCode as s,KeyMod as d}from"../../../../../vs/base/common/keyCodes.js";import"../../../../../vs/base/common/lifecycle.js";import"vs/css!./anchorSelect";import"../../../../../vs/editor/browser/editorBrowser.js";import{EditorAction as a,EditorContributionInstantiation as x,registerEditorAction as l,registerEditorContribution as E}from"../../../../../vs/editor/browser/editorExtensions.js";import{Selection as I}from"../../../../../vs/editor/common/core/selection.js";import"../../../../../vs/editor/common/editorCommon.js";import{EditorContextKeys as C}from"../../../../../vs/editor/common/editorContextKeys.js";import{TrackedRangeStickiness as K}from"../../../../../vs/editor/common/model.js";import{localize as c}from"../../../../../vs/nls.js";import{IContextKeyService as T,RawContextKey as D}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{KeybindingWeight as p}from"../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";const h=new D("selectionAnchorSet",!1);let t=class{constructor(o,e){this.editor=o;this.selectionAnchorSetContextKey=h.bindTo(e),this.modelChangeListener=o.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}static ID="editor.contrib.selectionAnchorController";static get(o){return o.getContribution(t.ID)}decorationId;selectionAnchorSetContextKey;modelChangeListener;setSelectionAnchor(){if(this.editor.hasModel()){const o=this.editor.getPosition();this.editor.changeDecorations(e=>{this.decorationId&&e.removeDecoration(this.decorationId),this.decorationId=e.addDecoration(I.fromPositions(o,o),{description:"selection-anchor",stickiness:K.NeverGrowsWhenTypingAtEdges,hoverMessage:new v().appendText(c("selectionAnchor","Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),b(c("anchorSet","Anchor set at {0}:{1}",o.lineNumber,o.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const o=this.editor.getModel().getDecorationRange(this.decorationId);o&&this.editor.setPosition(o.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const o=this.editor.getModel().getDecorationRange(this.decorationId);if(o){const e=this.editor.getPosition();this.editor.setSelection(I.fromPositions(o.getStartPosition(),e)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const o=this.decorationId;this.editor.changeDecorations(e=>{e.removeDecoration(o),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};t=A([g(1,T)],t);class P extends a{constructor(){super({id:"editor.action.setSelectionAnchor",label:c("setSelectionAnchor","Set Selection Anchor"),alias:"Set Selection Anchor",precondition:void 0,kbOpts:{kbExpr:C.editorTextFocus,primary:u(d.CtrlCmd|s.KeyK,d.CtrlCmd|s.KeyB),weight:p.EditorContrib}})}async run(o,e){t.get(e)?.setSelectionAnchor()}}class k extends a{constructor(){super({id:"editor.action.goToSelectionAnchor",label:c("goToSelectionAnchor","Go to Selection Anchor"),alias:"Go to Selection Anchor",precondition:h})}async run(o,e){t.get(e)?.goToSelectionAnchor()}}class M extends a{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:c("selectFromAnchorToCursor","Select from Anchor to Cursor"),alias:"Select from Anchor to Cursor",precondition:h,kbOpts:{kbExpr:C.editorTextFocus,primary:u(d.CtrlCmd|s.KeyK,d.CtrlCmd|s.KeyK),weight:p.EditorContrib}})}async run(o,e){t.get(e)?.selectFromAnchorToCursor()}}class w extends a{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:c("cancelSelectionAnchor","Cancel Selection Anchor"),alias:"Cancel Selection Anchor",precondition:h,kbOpts:{kbExpr:C.editorTextFocus,primary:s.Escape,weight:p.EditorContrib}})}async run(o,e){t.get(e)?.cancelSelectionAnchor()}}E(t.ID,t,x.Lazy),l(P),l(k),l(M),l(w);export{h as SelectionAnchorSet};
