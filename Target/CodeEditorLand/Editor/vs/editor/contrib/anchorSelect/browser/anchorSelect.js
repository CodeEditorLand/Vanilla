var I=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var A=(i,o,e,n)=>{for(var r=n>1?void 0:n?f(o,e):o,m=i.length-1,p;m>=0;m--)(p=i[m])&&(r=(n?p(o,e,r):p(r))||r);return n&&r&&I(o,e,r),r},g=(i,o)=>(e,n)=>o(e,n,i);import{alert as b}from"../../../../base/browser/ui/aria/aria.js";import{MarkdownString as v}from"../../../../base/common/htmlContent.js";import{KeyChord as u,KeyCode as s,KeyMod as d}from"../../../../base/common/keyCodes.js";import"./anchorSelect.css";import{localize as c}from"../../../../nls.js";import{IContextKeyService as x,RawContextKey as E}from"../../../../platform/contextkey/common/contextkey.js";import{KeybindingWeight as C}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{EditorAction as a,EditorContributionInstantiation as K,registerEditorAction as l,registerEditorContribution as T}from"../../../browser/editorExtensions.js";import{Selection as y}from"../../../common/core/selection.js";import{EditorContextKeys as S}from"../../../common/editorContextKeys.js";import{TrackedRangeStickiness as D}from"../../../common/model.js";const h=new E("selectionAnchorSet",!1);let t=class{constructor(o,e){this.editor=o;this.selectionAnchorSetContextKey=h.bindTo(e),this.modelChangeListener=o.onDidChangeModel(()=>this.selectionAnchorSetContextKey.reset())}static ID="editor.contrib.selectionAnchorController";static get(o){return o.getContribution(t.ID)}decorationId;selectionAnchorSetContextKey;modelChangeListener;setSelectionAnchor(){if(this.editor.hasModel()){const o=this.editor.getPosition();this.editor.changeDecorations(e=>{this.decorationId&&e.removeDecoration(this.decorationId),this.decorationId=e.addDecoration(y.fromPositions(o,o),{description:"selection-anchor",stickiness:D.NeverGrowsWhenTypingAtEdges,hoverMessage:new v().appendText(c("selectionAnchor","Selection Anchor")),className:"selection-anchor"})}),this.selectionAnchorSetContextKey.set(!!this.decorationId),b(c("anchorSet","Anchor set at {0}:{1}",o.lineNumber,o.column))}}goToSelectionAnchor(){if(this.editor.hasModel()&&this.decorationId){const o=this.editor.getModel().getDecorationRange(this.decorationId);o&&this.editor.setPosition(o.getStartPosition())}}selectFromAnchorToCursor(){if(this.editor.hasModel()&&this.decorationId){const o=this.editor.getModel().getDecorationRange(this.decorationId);if(o){const e=this.editor.getPosition();this.editor.setSelection(y.fromPositions(o.getStartPosition(),e)),this.cancelSelectionAnchor()}}}cancelSelectionAnchor(){if(this.decorationId){const o=this.decorationId;this.editor.changeDecorations(e=>{e.removeDecoration(o),this.decorationId=void 0}),this.selectionAnchorSetContextKey.set(!1)}}dispose(){this.cancelSelectionAnchor(),this.modelChangeListener.dispose()}};t=A([g(1,x)],t);class P extends a{constructor(){super({id:"editor.action.setSelectionAnchor",label:c("setSelectionAnchor","Set Selection Anchor"),alias:"Set Selection Anchor",precondition:void 0,kbOpts:{kbExpr:S.editorTextFocus,primary:u(d.CtrlCmd|s.KeyK,d.CtrlCmd|s.KeyB),weight:C.EditorContrib}})}async run(o,e){t.get(e)?.setSelectionAnchor()}}class k extends a{constructor(){super({id:"editor.action.goToSelectionAnchor",label:c("goToSelectionAnchor","Go to Selection Anchor"),alias:"Go to Selection Anchor",precondition:h})}async run(o,e){t.get(e)?.goToSelectionAnchor()}}class w extends a{constructor(){super({id:"editor.action.selectFromAnchorToCursor",label:c("selectFromAnchorToCursor","Select from Anchor to Cursor"),alias:"Select from Anchor to Cursor",precondition:h,kbOpts:{kbExpr:S.editorTextFocus,primary:u(d.CtrlCmd|s.KeyK,d.CtrlCmd|s.KeyK),weight:C.EditorContrib}})}async run(o,e){t.get(e)?.selectFromAnchorToCursor()}}class M extends a{constructor(){super({id:"editor.action.cancelSelectionAnchor",label:c("cancelSelectionAnchor","Cancel Selection Anchor"),alias:"Cancel Selection Anchor",precondition:h,kbOpts:{kbExpr:S.editorTextFocus,primary:s.Escape,weight:C.EditorContrib}})}async run(o,e){t.get(e)?.cancelSelectionAnchor()}}T(t.ID,t,K.Lazy),l(P),l(k),l(w),l(M);export{h as SelectionAnchorSet};
