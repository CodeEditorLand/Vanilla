{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/smartSelect/browser/bracketSelections.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { LinkedList } from \"../../../../base/common/linkedList.js\";\nimport { Position } from \"../../../common/core/position.js\";\nimport { Range } from \"../../../common/core/range.js\";\nimport type {\n\tSelectionRange,\n\tSelectionRangeProvider,\n} from \"../../../common/languages.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\n\nexport class BracketSelectionRangeProvider implements SelectionRangeProvider {\n\tasync provideSelectionRanges(\n\t\tmodel: ITextModel,\n\t\tpositions: Position[],\n\t): Promise<SelectionRange[][]> {\n\t\tconst result: SelectionRange[][] = [];\n\n\t\tfor (const position of positions) {\n\t\t\tconst bucket: SelectionRange[] = [];\n\t\t\tresult.push(bucket);\n\n\t\t\tconst ranges = new Map<string, LinkedList<Range>>();\n\t\t\tawait new Promise<void>((resolve) =>\n\t\t\t\tBracketSelectionRangeProvider._bracketsRightYield(\n\t\t\t\t\tresolve,\n\t\t\t\t\t0,\n\t\t\t\t\tmodel,\n\t\t\t\t\tposition,\n\t\t\t\t\tranges,\n\t\t\t\t),\n\t\t\t);\n\t\t\tawait new Promise<void>((resolve) =>\n\t\t\t\tBracketSelectionRangeProvider._bracketsLeftYield(\n\t\t\t\t\tresolve,\n\t\t\t\t\t0,\n\t\t\t\t\tmodel,\n\t\t\t\t\tposition,\n\t\t\t\t\tranges,\n\t\t\t\t\tbucket,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tpublic static _maxDuration = 30;\n\tprivate static readonly _maxRounds = 2;\n\n\tprivate static _bracketsRightYield(\n\t\tresolve: () => void,\n\t\tround: number,\n\t\tmodel: ITextModel,\n\t\tpos: Position,\n\t\tranges: Map<string, LinkedList<Range>>,\n\t): void {\n\t\tconst counts = new Map<string, number>();\n\t\tconst t1 = Date.now();\n\t\twhile (true) {\n\t\t\tif (round >= BracketSelectionRangeProvider._maxRounds) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!pos) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst bracket = model.bracketPairs.findNextBracket(pos);\n\t\t\tif (!bracket) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst d = Date.now() - t1;\n\t\t\tif (d > BracketSelectionRangeProvider._maxDuration) {\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t\tBracketSelectionRangeProvider._bracketsRightYield(\n\t\t\t\t\t\tresolve,\n\t\t\t\t\t\tround + 1,\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t\tranges,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (bracket.bracketInfo.isOpeningBracket) {\n\t\t\t\tconst key = bracket.bracketInfo.bracketText;\n\t\t\t\t// wait for closing\n\t\t\t\tconst val = counts.has(key) ? counts.get(key)! : 0;\n\t\t\t\tcounts.set(key, val + 1);\n\t\t\t} else {\n\t\t\t\tconst key =\n\t\t\t\t\tbracket.bracketInfo.getOpeningBrackets()[0].bracketText;\n\t\t\t\t// process closing\n\t\t\t\tlet val = counts.has(key) ? counts.get(key)! : 0;\n\t\t\t\tval -= 1;\n\t\t\t\tcounts.set(key, Math.max(0, val));\n\t\t\t\tif (val < 0) {\n\t\t\t\t\tlet list = ranges.get(key);\n\t\t\t\t\tif (!list) {\n\t\t\t\t\t\tlist = new LinkedList();\n\t\t\t\t\t\tranges.set(key, list);\n\t\t\t\t\t}\n\t\t\t\t\tlist.push(bracket.range);\n\t\t\t\t}\n\t\t\t}\n\t\t\tpos = bracket.range.getEndPosition();\n\t\t}\n\t}\n\n\tprivate static _bracketsLeftYield(\n\t\tresolve: () => void,\n\t\tround: number,\n\t\tmodel: ITextModel,\n\t\tpos: Position,\n\t\tranges: Map<string, LinkedList<Range>>,\n\t\tbucket: SelectionRange[],\n\t): void {\n\t\tconst counts = new Map<string, number>();\n\t\tconst t1 = Date.now();\n\t\twhile (true) {\n\t\t\tif (\n\t\t\t\tround >= BracketSelectionRangeProvider._maxRounds &&\n\t\t\t\tranges.size === 0\n\t\t\t) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (!pos) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst bracket = model.bracketPairs.findPrevBracket(pos);\n\t\t\tif (!bracket) {\n\t\t\t\tresolve();\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst d = Date.now() - t1;\n\t\t\tif (d > BracketSelectionRangeProvider._maxDuration) {\n\t\t\t\tsetTimeout(() =>\n\t\t\t\t\tBracketSelectionRangeProvider._bracketsLeftYield(\n\t\t\t\t\t\tresolve,\n\t\t\t\t\t\tround + 1,\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tpos,\n\t\t\t\t\t\tranges,\n\t\t\t\t\t\tbucket,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (bracket.bracketInfo.isOpeningBracket) {\n\t\t\t\tconst key = bracket.bracketInfo.bracketText;\n\t\t\t\t// opening\n\t\t\t\tlet val = counts.has(key) ? counts.get(key)! : 0;\n\t\t\t\tval -= 1;\n\t\t\t\tcounts.set(key, Math.max(0, val));\n\t\t\t\tif (val < 0) {\n\t\t\t\t\tconst list = ranges.get(key);\n\t\t\t\t\tif (list) {\n\t\t\t\t\t\tconst closing = list.shift();\n\t\t\t\t\t\tif (list.size === 0) {\n\t\t\t\t\t\t\tranges.delete(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst innerBracket = Range.fromPositions(\n\t\t\t\t\t\t\tbracket.range.getEndPosition(),\n\t\t\t\t\t\t\tclosing!.getStartPosition(),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst outerBracket = Range.fromPositions(\n\t\t\t\t\t\t\tbracket.range.getStartPosition(),\n\t\t\t\t\t\t\tclosing!.getEndPosition(),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tbucket.push({ range: innerBracket });\n\t\t\t\t\t\tbucket.push({ range: outerBracket });\n\t\t\t\t\t\tBracketSelectionRangeProvider._addBracketLeading(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\touterBracket,\n\t\t\t\t\t\t\tbucket,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tconst key =\n\t\t\t\t\tbracket.bracketInfo.getOpeningBrackets()[0].bracketText;\n\t\t\t\t// wait for opening\n\t\t\t\tconst val = counts.has(key) ? counts.get(key)! : 0;\n\t\t\t\tcounts.set(key, val + 1);\n\t\t\t}\n\t\t\tpos = bracket.range.getStartPosition();\n\t\t}\n\t}\n\n\tprivate static _addBracketLeading(\n\t\tmodel: ITextModel,\n\t\tbracket: Range,\n\t\tbucket: SelectionRange[],\n\t): void {\n\t\tif (bracket.startLineNumber === bracket.endLineNumber) {\n\t\t\treturn;\n\t\t}\n\t\t// xxxxxxxx {\n\t\t//\n\t\t// }\n\t\tconst startLine = bracket.startLineNumber;\n\t\tconst column = model.getLineFirstNonWhitespaceColumn(startLine);\n\t\tif (column !== 0 && column !== bracket.startColumn) {\n\t\t\tbucket.push({\n\t\t\t\trange: Range.fromPositions(\n\t\t\t\t\tnew Position(startLine, column),\n\t\t\t\t\tbracket.getEndPosition(),\n\t\t\t\t),\n\t\t\t});\n\t\t\tbucket.push({\n\t\t\t\trange: Range.fromPositions(\n\t\t\t\t\tnew Position(startLine, 1),\n\t\t\t\t\tbracket.getEndPosition(),\n\t\t\t\t),\n\t\t\t});\n\t\t}\n\n\t\t// xxxxxxxx\n\t\t// {\n\t\t//\n\t\t// }\n\t\tconst aboveLine = startLine - 1;\n\t\tif (aboveLine > 0) {\n\t\t\tconst column = model.getLineFirstNonWhitespaceColumn(aboveLine);\n\t\t\tif (\n\t\t\t\tcolumn === bracket.startColumn &&\n\t\t\t\tcolumn !== model.getLineLastNonWhitespaceColumn(aboveLine)\n\t\t\t) {\n\t\t\t\tbucket.push({\n\t\t\t\t\trange: Range.fromPositions(\n\t\t\t\t\t\tnew Position(aboveLine, column),\n\t\t\t\t\t\tbracket.getEndPosition(),\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t\tbucket.push({\n\t\t\t\t\trange: Range.fromPositions(\n\t\t\t\t\t\tnew Position(aboveLine, 1),\n\t\t\t\t\t\tbracket.getEndPosition(),\n\t\t\t\t\t),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["column"]
}
