import*as a from"../../../../base/common/strings.js";import{Range as l}from"../../../common/core/range.js";import{CancellationTokenSource as c}from"../../../../base/common/cancellation.js";import{DisposableStore as d}from"../../../../base/common/lifecycle.js";import{EditorKeybindingCancellationTokenSource as p}from"./keybindingCancellation.js";var h=(i=>(i[i.Value=1]="Value",i[i.Selection=2]="Selection",i[i.Position=4]="Position",i[i.Scroll=8]="Scroll",i))(h||{});class n{flags;position;selection;modelVersionId;scrollLeft;scrollTop;constructor(o,e){if(this.flags=e,this.flags&1){const t=o.getModel();this.modelVersionId=t?a.format("{0}#{1}",t.uri.toString(),t.getVersionId()):null}else this.modelVersionId=null;this.flags&4?this.position=o.getPosition():this.position=null,this.flags&2?this.selection=o.getSelection():this.selection=null,this.flags&8?(this.scrollLeft=o.getScrollLeft(),this.scrollTop=o.getScrollTop()):(this.scrollLeft=-1,this.scrollTop=-1)}_equals(o){if(!(o instanceof n))return!1;const e=o;return!(this.modelVersionId!==e.modelVersionId||this.scrollLeft!==e.scrollLeft||this.scrollTop!==e.scrollTop||!this.position&&e.position||this.position&&!e.position||this.position&&e.position&&!this.position.equals(e.position)||!this.selection&&e.selection||this.selection&&!e.selection||this.selection&&e.selection&&!this.selection.equalsRange(e.selection))}validate(o){return this._equals(new n(o,this.flags))}}class V extends p{_listener=new d;constructor(o,e,t,i){super(o,i),e&4&&this._listener.add(o.onDidChangeCursorPosition(s=>{(!t||!l.containsPosition(t,s.position))&&this.cancel()})),e&2&&this._listener.add(o.onDidChangeCursorSelection(s=>{(!t||!l.containsRange(t,s.selection))&&this.cancel()})),e&8&&this._listener.add(o.onDidScrollChange(s=>this.cancel())),e&1&&(this._listener.add(o.onDidChangeModel(s=>this.cancel())),this._listener.add(o.onDidChangeModelContent(s=>this.cancel())))}dispose(){this._listener.dispose(),super.dispose()}}class E extends c{_listener;constructor(o,e){super(e),this._listener=o.onDidChangeContent(()=>this.cancel())}dispose(){this._listener.dispose(),super.dispose()}}export{h as CodeEditorStateFlag,n as EditorState,V as EditorStateCancellationTokenSource,E as TextModelCancellationTokenSource};
