{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/editorState/browser/editorState.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\ttype CancellationToken,\n\tCancellationTokenSource,\n} from \"../../../../base/common/cancellation.js\";\nimport {\n\tDisposableStore,\n\ttype IDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport * as strings from \"../../../../base/common/strings.js\";\nimport type {\n\tIActiveCodeEditor,\n\tICodeEditor,\n} from \"../../../browser/editorBrowser.js\";\nimport type { Position } from \"../../../common/core/position.js\";\nimport { type IRange, Range } from \"../../../common/core/range.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\nimport { EditorKeybindingCancellationTokenSource } from \"./keybindingCancellation.js\";\n\nexport enum CodeEditorStateFlag {\n\tValue = 1,\n\tSelection = 2,\n\tPosition = 4,\n\tScroll = 8,\n}\n\nexport class EditorState {\n\tprivate readonly flags: number;\n\n\tprivate readonly position: Position | null;\n\tprivate readonly selection: Range | null;\n\tprivate readonly modelVersionId: string | null;\n\tprivate readonly scrollLeft: number;\n\tprivate readonly scrollTop: number;\n\n\tconstructor(editor: ICodeEditor, flags: number) {\n\t\tthis.flags = flags;\n\n\t\tif ((this.flags & CodeEditorStateFlag.Value) !== 0) {\n\t\t\tconst model = editor.getModel();\n\t\t\tthis.modelVersionId = model\n\t\t\t\t? strings.format(\n\t\t\t\t\t\t\"{0}#{1}\",\n\t\t\t\t\t\tmodel.uri.toString(),\n\t\t\t\t\t\tmodel.getVersionId(),\n\t\t\t\t\t)\n\t\t\t\t: null;\n\t\t} else {\n\t\t\tthis.modelVersionId = null;\n\t\t}\n\t\tif ((this.flags & CodeEditorStateFlag.Position) !== 0) {\n\t\t\tthis.position = editor.getPosition();\n\t\t} else {\n\t\t\tthis.position = null;\n\t\t}\n\t\tif ((this.flags & CodeEditorStateFlag.Selection) !== 0) {\n\t\t\tthis.selection = editor.getSelection();\n\t\t} else {\n\t\t\tthis.selection = null;\n\t\t}\n\t\tif ((this.flags & CodeEditorStateFlag.Scroll) !== 0) {\n\t\t\tthis.scrollLeft = editor.getScrollLeft();\n\t\t\tthis.scrollTop = editor.getScrollTop();\n\t\t} else {\n\t\t\tthis.scrollLeft = -1;\n\t\t\tthis.scrollTop = -1;\n\t\t}\n\t}\n\n\tprivate _equals(other: any): boolean {\n\t\tif (!(other instanceof EditorState)) {\n\t\t\treturn false;\n\t\t}\n\t\tconst state = <EditorState>other;\n\n\t\tif (this.modelVersionId !== state.modelVersionId) {\n\t\t\treturn false;\n\t\t}\n\t\tif (\n\t\t\tthis.scrollLeft !== state.scrollLeft ||\n\t\t\tthis.scrollTop !== state.scrollTop\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t\tif (\n\t\t\t(!this.position && state.position) ||\n\t\t\t(this.position && !state.position) ||\n\t\t\t(this.position &&\n\t\t\t\tstate.position &&\n\t\t\t\t!this.position.equals(state.position))\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t\tif (\n\t\t\t(!this.selection && state.selection) ||\n\t\t\t(this.selection && !state.selection) ||\n\t\t\t(this.selection &&\n\t\t\t\tstate.selection &&\n\t\t\t\t!this.selection.equalsRange(state.selection))\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tpublic validate(editor: ICodeEditor): boolean {\n\t\treturn this._equals(new EditorState(editor, this.flags));\n\t}\n}\n\n/**\n * A cancellation token source that cancels when the editor changes as expressed\n * by the provided flags\n * @param range If provided, changes in position and selection within this range will not trigger cancellation\n */\nexport class EditorStateCancellationTokenSource\n\textends EditorKeybindingCancellationTokenSource\n\timplements IDisposable\n{\n\tprivate readonly _listener = new DisposableStore();\n\n\tconstructor(\n\t\teditor: IActiveCodeEditor,\n\t\tflags: CodeEditorStateFlag,\n\t\trange?: IRange,\n\t\tparent?: CancellationToken,\n\t) {\n\t\tsuper(editor, parent);\n\n\t\tif (flags & CodeEditorStateFlag.Position) {\n\t\t\tthis._listener.add(\n\t\t\t\teditor.onDidChangeCursorPosition((e) => {\n\t\t\t\t\tif (!range || !Range.containsPosition(range, e.position)) {\n\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\tif (flags & CodeEditorStateFlag.Selection) {\n\t\t\tthis._listener.add(\n\t\t\t\teditor.onDidChangeCursorSelection((e) => {\n\t\t\t\t\tif (!range || !Range.containsRange(range, e.selection)) {\n\t\t\t\t\t\tthis.cancel();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\tif (flags & CodeEditorStateFlag.Scroll) {\n\t\t\tthis._listener.add(editor.onDidScrollChange((_) => this.cancel()));\n\t\t}\n\t\tif (flags & CodeEditorStateFlag.Value) {\n\t\t\tthis._listener.add(editor.onDidChangeModel((_) => this.cancel()));\n\t\t\tthis._listener.add(\n\t\t\t\teditor.onDidChangeModelContent((_) => this.cancel()),\n\t\t\t);\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tthis._listener.dispose();\n\t\tsuper.dispose();\n\t}\n}\n\n/**\n * A cancellation token source that cancels when the provided model changes\n */\nexport class TextModelCancellationTokenSource\n\textends CancellationTokenSource\n\timplements IDisposable\n{\n\tprivate _listener: IDisposable;\n\n\tconstructor(model: ITextModel, parent?: CancellationToken) {\n\t\tsuper(parent);\n\t\tthis._listener = model.onDidChangeContent(() => this.cancel());\n\t}\n\n\toverride dispose() {\n\t\tthis._listener.dispose();\n\t\tsuper.dispose();\n\t}\n}\n"],
  "mappings": "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",
  "names": ["CodeEditorStateFlag"]
}
