import{createSingleCallFunction as d}from"../../../../base/common/functional.js";import{DisposableStore as s,MutableDisposable as l,toDisposable as u}from"../../../../base/common/lifecycle.js";import{getCodeEditor as g,isDiffEditor as I}from"../../../browser/editorBrowser.js";import{ScrollType as h}from"../../../common/editorCommon.js";import{OverviewRulerLane as p}from"../../../common/model.js";import{overviewRulerRangeHighlight as v}from"../../../common/core/editorColorRegistry.js";import{themeColorFromId as m}from"../../../../platform/theme/common/themeService.js";import{status as D}from"../../../../base/browser/ui/aria/aria.js";import{TextEditorSelectionSource as f}from"../../../../platform/editor/common/editor.js";class z{constructor(e){this.options=e}provide(e,t,r){const i=new s;e.canAcceptInBackground=!!this.options?.canAcceptInBackground,e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1;const o=i.add(new l);return o.value=this.doProvide(e,t,r),i.add(this.onDidActiveTextEditorControlChange(()=>{o.value=void 0,o.value=this.doProvide(e,t)})),i}doProvide(e,t,r){const i=new s,o=this.activeTextEditorControl;if(o&&this.canProvideWithTextEditor(o)){const n={editor:o},a=g(o);if(a){let c=o.saveViewState()??void 0;i.add(a.onDidChangeCursorPosition(()=>{c=o.saveViewState()??void 0})),n.restoreViewState=()=>{c&&o===this.activeTextEditorControl&&o.restoreViewState(c)},i.add(d(t.onCancellationRequested)(()=>n.restoreViewState?.()))}i.add(u(()=>this.clearDecorations(o))),i.add(this.provideWithTextEditor(n,e,t,r))}else i.add(this.provideWithoutTextEditor(e,t));return i}canProvideWithTextEditor(e){return!0}gotoLocation({editor:e},t){e.setSelection(t.range,f.JUMP),e.revealRangeInCenter(t.range,h.Smooth),t.preserveFocus||e.focus();const r=e.getModel();r&&"getLineContent"in r&&D(`${r.getLineContent(t.range.startLineNumber)}`)}getModel(e){return I(e)?e.getModel()?.modified:e.getModel()}rangeHighlightDecorationId=void 0;addDecorations(e,t){e.changeDecorations(r=>{const i=[];this.rangeHighlightDecorationId&&(i.push(this.rangeHighlightDecorationId.overviewRulerDecorationId),i.push(this.rangeHighlightDecorationId.rangeHighlightId),this.rangeHighlightDecorationId=void 0);const o=[{range:t,options:{description:"quick-access-range-highlight",className:"rangeHighlight",isWholeLine:!0}},{range:t,options:{description:"quick-access-range-highlight-overview",overviewRuler:{color:m(v),position:p.Full}}}],[n,a]=r.deltaDecorations(i,o);this.rangeHighlightDecorationId={rangeHighlightId:n,overviewRulerDecorationId:a}})}clearDecorations(e){const t=this.rangeHighlightDecorationId;t&&(e.changeDecorations(r=>{r.deltaDecorations([t.overviewRulerDecorationId,t.rangeHighlightId],[])}),this.rangeHighlightDecorationId=void 0)}}export{z as AbstractEditorNavigationQuickAccessProvider};
