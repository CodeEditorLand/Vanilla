{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/links/browser/getLinks.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from \"../../../../base/common/arrays.js\";\nimport { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { onUnexpectedExternalError } from \"../../../../base/common/errors.js\";\nimport {\n\tDisposableStore,\n\tisDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport { assertType } from \"../../../../base/common/types.js\";\nimport { URI } from \"../../../../base/common/uri.js\";\nimport { CommandsRegistry } from \"../../../../platform/commands/common/commands.js\";\nimport { type IRange, Range } from \"../../../common/core/range.js\";\nimport type { LanguageFeatureRegistry } from \"../../../common/languageFeatureRegistry.js\";\nimport type {\n\tILink,\n\tILinksList,\n\tLinkProvider,\n} from \"../../../common/languages.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../common/services/languageFeatures.js\";\nimport { IModelService } from \"../../../common/services/model.js\";\n\nexport class Link implements ILink {\n\tprivate _link: ILink;\n\tprivate readonly _provider: LinkProvider;\n\n\tconstructor(link: ILink, provider: LinkProvider) {\n\t\tthis._link = link;\n\t\tthis._provider = provider;\n\t}\n\n\ttoJSON(): ILink {\n\t\treturn {\n\t\t\trange: this.range,\n\t\t\turl: this.url,\n\t\t\ttooltip: this.tooltip,\n\t\t};\n\t}\n\n\tget range(): IRange {\n\t\treturn this._link.range;\n\t}\n\n\tget url(): URI | string | undefined {\n\t\treturn this._link.url;\n\t}\n\n\tget tooltip(): string | undefined {\n\t\treturn this._link.tooltip;\n\t}\n\n\tasync resolve(token: CancellationToken): Promise<URI | string> {\n\t\tif (this._link.url) {\n\t\t\treturn this._link.url;\n\t\t}\n\n\t\tif (typeof this._provider.resolveLink === \"function\") {\n\t\t\treturn Promise.resolve(\n\t\t\t\tthis._provider.resolveLink(this._link, token),\n\t\t\t).then((value) => {\n\t\t\t\tthis._link = value || this._link;\n\t\t\t\tif (this._link.url) {\n\t\t\t\t\t// recurse\n\t\t\t\t\treturn this.resolve(token);\n\t\t\t\t}\n\n\t\t\t\treturn Promise.reject(new Error(\"missing\"));\n\t\t\t});\n\t\t}\n\n\t\treturn Promise.reject(new Error(\"missing\"));\n\t}\n}\n\nexport class LinksList {\n\treadonly links: Link[];\n\n\tprivate readonly _disposables = new DisposableStore();\n\n\tconstructor(tuples: [ILinksList, LinkProvider][]) {\n\t\tlet links: Link[] = [];\n\t\tfor (const [list, provider] of tuples) {\n\t\t\t// merge all links\n\t\t\tconst newLinks = list.links.map((link) => new Link(link, provider));\n\t\t\tlinks = LinksList._union(links, newLinks);\n\t\t\t// register disposables\n\t\t\tif (isDisposable(list)) {\n\t\t\t\tthis._disposables.add(list);\n\t\t\t}\n\t\t}\n\t\tthis.links = links;\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis.links.length = 0;\n\t}\n\n\tprivate static _union(oldLinks: Link[], newLinks: Link[]): Link[] {\n\t\t// reunite oldLinks with newLinks and remove duplicates\n\t\tconst result: Link[] = [];\n\t\tlet oldIndex: number;\n\t\tlet oldLen: number;\n\t\tlet newIndex: number;\n\t\tlet newLen: number;\n\n\t\tfor (\n\t\t\toldIndex = 0,\n\t\t\t\tnewIndex = 0,\n\t\t\t\toldLen = oldLinks.length,\n\t\t\t\tnewLen = newLinks.length;\n\t\t\toldIndex < oldLen && newIndex < newLen;\n\t\t) {\n\t\t\tconst oldLink = oldLinks[oldIndex];\n\t\t\tconst newLink = newLinks[newIndex];\n\n\t\t\tif (Range.areIntersectingOrTouching(oldLink.range, newLink.range)) {\n\t\t\t\t// Remove the oldLink\n\t\t\t\toldIndex++;\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst comparisonResult = Range.compareRangesUsingStarts(\n\t\t\t\toldLink.range,\n\t\t\t\tnewLink.range,\n\t\t\t);\n\n\t\t\tif (comparisonResult < 0) {\n\t\t\t\t// oldLink is before\n\t\t\t\tresult.push(oldLink);\n\t\t\t\toldIndex++;\n\t\t\t} else {\n\t\t\t\t// newLink is before\n\t\t\t\tresult.push(newLink);\n\t\t\t\tnewIndex++;\n\t\t\t}\n\t\t}\n\n\t\tfor (; oldIndex < oldLen; oldIndex++) {\n\t\t\tresult.push(oldLinks[oldIndex]);\n\t\t}\n\t\tfor (; newIndex < newLen; newIndex++) {\n\t\t\tresult.push(newLinks[newIndex]);\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nexport function getLinks(\n\tproviders: LanguageFeatureRegistry<LinkProvider>,\n\tmodel: ITextModel,\n\ttoken: CancellationToken,\n): Promise<LinksList> {\n\tconst lists: [ILinksList, LinkProvider][] = [];\n\n\t// ask all providers for links in parallel\n\tconst promises = providers\n\t\t.ordered(model)\n\t\t.reverse()\n\t\t.map((provider, i) => {\n\t\t\treturn Promise.resolve(provider.provideLinks(model, token)).then(\n\t\t\t\t(result) => {\n\t\t\t\t\tif (result) {\n\t\t\t\t\t\tlists[i] = [result, provider];\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tonUnexpectedExternalError,\n\t\t\t);\n\t\t});\n\n\treturn Promise.all(promises).then(() => {\n\t\tconst result = new LinksList(coalesce(lists));\n\t\tif (!token.isCancellationRequested) {\n\t\t\treturn result;\n\t\t}\n\t\tresult.dispose();\n\t\treturn new LinksList([]);\n\t});\n}\n\nCommandsRegistry.registerCommand(\n\t\"_executeLinkProvider\",\n\tasync (accessor, ...args): Promise<ILink[]> => {\n\t\tlet [uri, resolveCount] = args;\n\t\tassertType(uri instanceof URI);\n\n\t\tif (typeof resolveCount !== \"number\") {\n\t\t\tresolveCount = 0;\n\t\t}\n\n\t\tconst { linkProvider } = accessor.get(ILanguageFeaturesService);\n\t\tconst model = accessor.get(IModelService).getModel(uri);\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\t\tconst list = await getLinks(\n\t\t\tlinkProvider,\n\t\t\tmodel,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\tif (!list) {\n\t\t\treturn [];\n\t\t}\n\n\t\t// resolve links\n\t\tfor (let i = 0; i < Math.min(resolveCount, list.links.length); i++) {\n\t\t\tawait list.links[i].resolve(CancellationToken.None);\n\t\t}\n\n\t\tconst result = list.links.slice(0);\n\t\tlist.dispose();\n\t\treturn result;\n\t},\n);\n"],
  "mappings": ";;AAKA,SAAS,gBAAgB;AACzB,SAAS,yBAAyB;AAClC,SAAS,iCAAiC;AAC1C;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,kBAAkB;AAC3B,SAAS,WAAW;AACpB,SAAS,wBAAwB;AACjC,SAAsB,aAAa;AAQnC,SAAS,gCAAgC;AACzC,SAAS,qBAAqB;AAEvB,MAAM,KAAsB;AAAA,EA1BnC,OA0BmC;AAAA;AAAA;AAAA,EAC1B;AAAA,EACS;AAAA,EAEjB,YAAY,MAAa,UAAwB;AAChD,SAAK,QAAQ;AACb,SAAK,YAAY;AAAA,EAClB;AAAA,EAEA,SAAgB;AACf,WAAO;AAAA,MACN,OAAO,KAAK;AAAA,MACZ,KAAK,KAAK;AAAA,MACV,SAAS,KAAK;AAAA,IACf;AAAA,EACD;AAAA,EAEA,IAAI,QAAgB;AACnB,WAAO,KAAK,MAAM;AAAA,EACnB;AAAA,EAEA,IAAI,MAAgC;AACnC,WAAO,KAAK,MAAM;AAAA,EACnB;AAAA,EAEA,IAAI,UAA8B;AACjC,WAAO,KAAK,MAAM;AAAA,EACnB;AAAA,EAEA,MAAM,QAAQ,OAAiD;AAC9D,QAAI,KAAK,MAAM,KAAK;AACnB,aAAO,KAAK,MAAM;AAAA,IACnB;AAEA,QAAI,OAAO,KAAK,UAAU,gBAAgB,YAAY;AACrD,aAAO,QAAQ;AAAA,QACd,KAAK,UAAU,YAAY,KAAK,OAAO,KAAK;AAAA,MAC7C,EAAE,KAAK,CAAC,UAAU;AACjB,aAAK,QAAQ,SAAS,KAAK;AAC3B,YAAI,KAAK,MAAM,KAAK;AAEnB,iBAAO,KAAK,QAAQ,KAAK;AAAA,QAC1B;AAEA,eAAO,QAAQ,OAAO,IAAI,MAAM,SAAS,CAAC;AAAA,MAC3C,CAAC;AAAA,IACF;AAEA,WAAO,QAAQ,OAAO,IAAI,MAAM,SAAS,CAAC;AAAA,EAC3C;AACD;AAEO,MAAM,UAAU;AAAA,EA9EvB,OA8EuB;AAAA;AAAA;AAAA,EACb;AAAA,EAEQ,eAAe,IAAI,gBAAgB;AAAA,EAEpD,YAAY,QAAsC;AACjD,QAAI,QAAgB,CAAC;AACrB,eAAW,CAAC,MAAM,QAAQ,KAAK,QAAQ;AAEtC,YAAM,WAAW,KAAK,MAAM,IAAI,CAAC,SAAS,IAAI,KAAK,MAAM,QAAQ,CAAC;AAClE,cAAQ,UAAU,OAAO,OAAO,QAAQ;AAExC,UAAI,aAAa,IAAI,GAAG;AACvB,aAAK,aAAa,IAAI,IAAI;AAAA,MAC3B;AAAA,IACD;AACA,SAAK,QAAQ;AAAA,EACd;AAAA,EAEA,UAAgB;AACf,SAAK,aAAa,QAAQ;AAC1B,SAAK,MAAM,SAAS;AAAA,EACrB;AAAA,EAEA,OAAe,OAAO,UAAkB,UAA0B;AAEjE,UAAM,SAAiB,CAAC;AACxB,QAAI;AACJ,QAAI;AACJ,QAAI;AACJ,QAAI;AAEJ,SACC,WAAW,GACV,WAAW,GACX,SAAS,SAAS,QAClB,SAAS,SAAS,QACnB,WAAW,UAAU,WAAW,UAC/B;AACD,YAAM,UAAU,SAAS,QAAQ;AACjC,YAAM,UAAU,SAAS,QAAQ;AAEjC,UAAI,MAAM,0BAA0B,QAAQ,OAAO,QAAQ,KAAK,GAAG;AAElE;AACA;AAAA,MACD;AAEA,YAAM,mBAAmB,MAAM;AAAA,QAC9B,QAAQ;AAAA,QACR,QAAQ;AAAA,MACT;AAEA,UAAI,mBAAmB,GAAG;AAEzB,eAAO,KAAK,OAAO;AACnB;AAAA,MACD,OAAO;AAEN,eAAO,KAAK,OAAO;AACnB;AAAA,MACD;AAAA,IACD;AAEA,WAAO,WAAW,QAAQ,YAAY;AACrC,aAAO,KAAK,SAAS,QAAQ,CAAC;AAAA,IAC/B;AACA,WAAO,WAAW,QAAQ,YAAY;AACrC,aAAO,KAAK,SAAS,QAAQ,CAAC;AAAA,IAC/B;AAEA,WAAO;AAAA,EACR;AACD;AAEO,SAAS,SACf,WACA,OACA,OACqB;AACrB,QAAM,QAAsC,CAAC;AAG7C,QAAM,WAAW,UACf,QAAQ,KAAK,EACb,QAAQ,EACR,IAAI,CAAC,UAAU,MAAM;AACrB,WAAO,QAAQ,QAAQ,SAAS,aAAa,OAAO,KAAK,CAAC,EAAE;AAAA,MAC3D,CAAC,WAAW;AACX,YAAI,QAAQ;AACX,gBAAM,CAAC,IAAI,CAAC,QAAQ,QAAQ;AAAA,QAC7B;AAAA,MACD;AAAA,MACA;AAAA,IACD;AAAA,EACD,CAAC;AAEF,SAAO,QAAQ,IAAI,QAAQ,EAAE,KAAK,MAAM;AACvC,UAAM,SAAS,IAAI,UAAU,SAAS,KAAK,CAAC;AAC5C,QAAI,CAAC,MAAM,yBAAyB;AACnC,aAAO;AAAA,IACR;AACA,WAAO,QAAQ;AACf,WAAO,IAAI,UAAU,CAAC,CAAC;AAAA,EACxB,CAAC;AACF;AA9BgB;AAgChB,iBAAiB;AAAA,EAChB;AAAA,EACA,OAAO,aAAa,SAA2B;AAC9C,QAAI,CAAC,KAAK,YAAY,IAAI;AAC1B,eAAW,eAAe,GAAG;AAE7B,QAAI,OAAO,iBAAiB,UAAU;AACrC,qBAAe;AAAA,IAChB;AAEA,UAAM,EAAE,aAAa,IAAI,SAAS,IAAI,wBAAwB;AAC9D,UAAM,QAAQ,SAAS,IAAI,aAAa,EAAE,SAAS,GAAG;AACtD,QAAI,CAAC,OAAO;AACX,aAAO,CAAC;AAAA,IACT;AACA,UAAM,OAAO,MAAM;AAAA,MAClB;AAAA,MACA;AAAA,MACA,kBAAkB;AAAA,IACnB;AACA,QAAI,CAAC,MAAM;AACV,aAAO,CAAC;AAAA,IACT;AAGA,aAAS,IAAI,GAAG,IAAI,KAAK,IAAI,cAAc,KAAK,MAAM,MAAM,GAAG,KAAK;AACnE,YAAM,KAAK,MAAM,CAAC,EAAE,QAAQ,kBAAkB,IAAI;AAAA,IACnD;AAEA,UAAM,SAAS,KAAK,MAAM,MAAM,CAAC;AACjC,SAAK,QAAQ;AACb,WAAO;AAAA,EACR;AACD;",
  "names": []
}
