import*as h from"../../../../base/browser/dom.js";import{Action as g,Separator as C}from"../../../../base/common/actions.js";import{CancellationToken as k}from"../../../../base/common/cancellation.js";import{generateUuid as x}from"../../../../base/common/uuid.js";import{MenuId as A,MenuItemAction as E,MenuRegistry as b,isIMenuItem as P}from"../../../../platform/actions/common/actions.js";import{ICommandService as L}from"../../../../platform/commands/common/commands.js";import{IContextKeyService as N}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as R}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as T}from"../../../../platform/instantiation/common/instantiation.js";import{INotificationService as j,Severity as D}from"../../../../platform/notification/common/notification.js";import{EditorOption as v}from"../../../common/config/editorOptions.js";import{Range as f}from"../../../common/core/range.js";import{ITextModelService as S}from"../../../common/services/resolverService.js";import{DefinitionAction as O,SymbolNavigationAction as H,SymbolNavigationAnchor as y}from"../../gotoSymbol/browser/goToCommands.js";import{PeekContext as F}from"../../peekView/browser/peekView.js";async function $(o,n,r,t){const l=o.get(S),c=o.get(R),s=o.get(L),a=o.get(T),u=o.get(j);if(await t.item.resolve(k.None),!t.part.location)return;const m=t.part.location,i=[],p=new Set(b.getMenuItems(A.EditorContext).map(e=>P(e)?e.command.id:x()));for(const e of H.all())p.has(e.desc.id)&&i.push(new g(e.desc.id,E.label(e.desc,{renderShortTitle:!0}),void 0,!0,async()=>{const d=await l.createModelReference(m.uri);try{const w=new y(d.object.textEditorModel,f.getStartPosition(m.range)),M=t.item.anchor.range;await a.invokeFunction(e.runEditorCommand.bind(e),n,w,M)}finally{d.dispose()}}));if(t.part.command){const{command:e}=t.part;i.push(new C),i.push(new g(e.id,e.title,void 0,!0,async()=>{try{await s.executeCommand(e.id,...e.arguments??[])}catch(d){u.notify({severity:D.Error,source:t.item.provider.displayName,message:d})}}))}const I=n.getOption(v.useShadowDOM);c.showContextMenu({domForShadowRoot:I?n.getDomNode()??void 0:void 0,getAnchor:()=>{const e=h.getDomNodePagePosition(r);return{x:e.left,y:e.top+e.height+8}},getActions:()=>i,onHide:()=>{n.focus()},autoSelectFirstItem:!0})}async function ee(o,n,r,t){const c=await o.get(S).createModelReference(t.uri);await r.invokeWithinContext(async s=>{const a=n.hasSideBySideModifier,u=s.get(N),m=F.inPeekEditor.getValue(u),i=!a&&r.getOption(v.definitionLinkOpensInPeek)&&!m;return new O({openToSide:a,openInPeek:i,muteMessage:!0},{title:{value:"",original:""},id:"",precondition:void 0}).run(s,new y(c.object.textEditorModel,f.getStartPosition(t.range)),f.lift(t.range))}),c.dispose()}export{ee as goToDefinitionWithLocation,$ as showGoToContextMenu};
