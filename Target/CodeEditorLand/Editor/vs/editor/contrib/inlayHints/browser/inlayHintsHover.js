var y=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var h=(d,s,t,i)=>{for(var r=i>1?void 0:i?M(s,t):s,o=d.length-1,e;o>=0;o--)(e=d[o])&&(r=(i?e(s,t,r):e(r))||r);return i&&r&&y(s,t,r),r},c=(d,s)=>(t,i)=>s(t,i,d);import{isNonEmptyArray as b}from"../../../../../vs/base/common/arrays.js";import{AsyncIterableObject as v}from"../../../../../vs/base/common/async.js";import"../../../../../vs/base/common/cancellation.js";import{isEmptyMarkdownString as S,MarkdownString as p}from"../../../../../vs/base/common/htmlContent.js";import*as k from"../../../../../vs/base/common/platform.js";import{MouseTargetType as H}from"../../../../../vs/editor/browser/editorBrowser.js";import{EditorOption as T}from"../../../../../vs/editor/common/config/editorOptions.js";import{Position as C}from"../../../../../vs/editor/common/core/position.js";import{ILanguageService as E}from"../../../../../vs/editor/common/languages/language.js";import"../../../../../vs/editor/common/model.js";import{ModelDecorationInjectedTextOptions as P}from"../../../../../vs/editor/common/model/textModel.js";import{ILanguageFeaturesService as O}from"../../../../../vs/editor/common/services/languageFeatures.js";import{ITextModelService as A}from"../../../../../vs/editor/common/services/resolverService.js";import{getHoverProviderResultsAsAsyncIterable as x}from"../../../../../vs/editor/contrib/hover/browser/getHover.js";import{HoverForeignElementAnchor as L}from"../../../../../vs/editor/contrib/hover/browser/hoverTypes.js";import{MarkdownHover as f,MarkdownHoverParticipant as _}from"../../../../../vs/editor/contrib/hover/browser/markdownHoverParticipant.js";import{asCommandLink as D}from"../../../../../vs/editor/contrib/inlayHints/browser/inlayHints.js";import{InlayHintsController as j,RenderedInlayHintLabelPart as R}from"../../../../../vs/editor/contrib/inlayHints/browser/inlayHintsController.js";import{localize as m}from"../../../../../vs/nls.js";import{ICommandService as F}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as K}from"../../../../../vs/platform/configuration/common/configuration.js";import{IHoverService as N}from"../../../../../vs/platform/hover/browser/hover.js";import{IKeybindingService as $}from"../../../../../vs/platform/keybinding/common/keybinding.js";import{IOpenerService as Y}from"../../../../../vs/platform/opener/common/opener.js";class w extends L{constructor(t,i,r,o){super(10,i,t.item.anchor.range,r,o,!0);this.part=t}}let u=class extends _{constructor(t,i,r,o,e,a,n,g,l){super(t,i,r,a,g,o,e,l);this._resolverService=n}hoverOrdinal=6;suggestHoverAnchor(t){if(!j.get(this._editor)||t.target.type!==H.CONTENT_TEXT)return null;const r=t.target.detail.injectedText?.options;return r instanceof P&&r.attachedData instanceof R?new w(r.attachedData,this,t.event.posx,t.event.posy):null}computeSync(){return[]}computeAsync(t,i,r){return t instanceof w?new v(async o=>{const{part:e}=t;if(await e.item.resolve(r),r.isCancellationRequested)return;let a;typeof e.item.hint.tooltip=="string"?a=new p().appendText(e.item.hint.tooltip):e.item.hint.tooltip&&(a=e.item.hint.tooltip),a&&o.emitOne(new f(this,t.range,[a],!1,0)),b(e.item.hint.textEdits)&&o.emitOne(new f(this,t.range,[new p().appendText(m("hint.dbl","Double-click to insert"))],!1,10001));let n;if(typeof e.part.tooltip=="string"?n=new p().appendText(e.part.tooltip):e.part.tooltip&&(n=e.part.tooltip),n&&o.emitOne(new f(this,t.range,[n],!1,1)),e.part.location||e.part.command){let l;const I=this._editor.getOption(T.multiCursorModifier)==="altKey"?k.isMacintosh?m("links.navigate.kb.meta.mac","cmd + click"):m("links.navigate.kb.meta","ctrl + click"):k.isMacintosh?m("links.navigate.kb.alt.mac","option + click"):m("links.navigate.kb.alt","alt + click");e.part.location&&e.part.command?l=new p().appendText(m("hint.defAndCommand","Go to Definition ({0}), right click for more",I)):e.part.location?l=new p().appendText(m("hint.def","Go to Definition ({0})",I)):e.part.command&&(l=new p(`[${m("hint.cmd","Execute Command")}](${D(e.part.command)} "${e.part.command.title}") (${I})`,{isTrusted:!0})),l&&o.emitOne(new f(this,t.range,[l],!1,1e4))}const g=await this._resolveInlayHintLabelPartHover(e,r);for await(const l of g)o.emitOne(l)}):v.EMPTY}async _resolveInlayHintLabelPartHover(t,i){if(!t.part.location)return v.EMPTY;const{uri:r,range:o}=t.part.location,e=await this._resolverService.createModelReference(r);try{const a=e.object.textEditorModel;return this._languageFeaturesService.hoverProvider.has(a)?x(this._languageFeaturesService.hoverProvider,a,new C(o.startLineNumber,o.startColumn),i).filter(n=>!S(n.hover.contents)).map(n=>new f(this,t.item.anchor.range,n.hover.contents,!1,2+n.ordinal)):v.EMPTY}finally{e.dispose()}}};u=h([c(1,E),c(2,Y),c(3,$),c(4,N),c(5,K),c(6,A),c(7,O),c(8,F)],u);export{u as InlayHintsHover};
