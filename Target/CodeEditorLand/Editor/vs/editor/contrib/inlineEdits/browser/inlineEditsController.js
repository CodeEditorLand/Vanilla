var v=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var c=(n,t,e,i)=>{for(var r=i>1?void 0:i?p(t,e):t,s=n.length-1,l;s>=0;s--)(l=n[s])&&(r=(i?l(t,e,r):l(r))||r);return i&&r&&v(t,e,r),r},o=(n,t)=>(e,i)=>t(e,i,n);import{readHotReloadableExport as u}from"../../../../base/common/hotReloadHelpers.js";import{Disposable as h}from"../../../../base/common/lifecycle.js";import{derived as f,derivedDisposable as b,derivedObservableWithCache as I,derivedWithSetter as _,observableValue as S}from"../../../../base/common/observable.js";import{IConfigurationService as y}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as g}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as E}from"../../../../platform/instantiation/common/instantiation.js";import{bindContextKey as m,observableConfigValue as C}from"../../../../platform/observable/common/platformObservableUtils.js";import{observableCodeEditor as x}from"../../../browser/observableCodeEditor.js";import{Selection as O}from"../../../common/core/selection.js";import{ILanguageFeatureDebounceService as D}from"../../../common/services/languageFeatureDebounce.js";import{ILanguageFeaturesService as K}from"../../../common/services/languageFeatures.js";import{inlineEditVisible as R,isPinnedContextKey as F}from"./consts.js";import{InlineEditsModel as w}from"./inlineEditsModel.js";import{InlineEditsWidget as V}from"./inlineEditsWidget.js";let d=class extends h{constructor(e,i,r,s,l,M){super();this.editor=e;this._instantiationService=i;this._contextKeyService=r;this._debounceService=s;this._languageFeaturesService=l;this._configurationService=M;this._register(m(R,this._contextKeyService,a=>!!this.model.read(a)?.inlineEdit.read(a))),this._register(m(F,this._contextKeyService,a=>!!this.model.read(a)?.isPinned.read(a))),this.model.recomputeInitiallyAndOnChange(this._store),this._widget.recomputeInitiallyAndOnChange(this._store)}static ID="editor.contrib.inlineEditsController";static get(e){return e.getContribution(d.ID)}_enabled=C("editor.inlineEdits.enabled",!1,this._configurationService);_editorObs=x(this.editor);_selection=f(this,e=>this._editorObs.cursorSelection.read(e)??new O(1,1,1,1));_debounceValue=this._debounceService.for(this._languageFeaturesService.inlineCompletionsProvider,"InlineEditsDebounce",{min:50,max:50});model=b(this,e=>{if(!this._enabled.read(e)||this._editorObs.isReadonly.read(e))return;const i=this._editorObs.model.read(e);return i?this._instantiationService.createInstance(u(w,e),i,this._editorObs.versionId,this._selection,this._debounceValue):void 0});_hadInlineEdit=I(this,(e,i)=>i||this.model.read(e)?.inlineEdit.read(e)!==void 0);_widget=b(this,e=>{if(this._hadInlineEdit.read(e))return this._instantiationService.createInstance(u(V,e),this.editor,this.model.map((i,r)=>i?.inlineEdit.read(r)),L(i=>this.model.read(i)?.userPrompt??S("empty","")))})};d=c([o(1,E),o(2,g),o(3,D),o(4,K),o(5,y)],d);function L(n){return _(void 0,t=>n(t).read(t),(t,e)=>{n(void 0).set(t,e)})}export{d as InlineEditsController};
