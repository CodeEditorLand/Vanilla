{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/inlineEdits/browser/inlineEditsController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { readHotReloadableExport } from '../../../../base/common/hotReloadHelpers.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { derived, derivedDisposable, derivedObservableWithCache, derivedWithSetter, IReader, ISettableObservable, observableValue } from '../../../../base/common/observable.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { bindContextKey, observableConfigValue } from '../../../../platform/observable/common/platformObservableUtils.js';\nimport { ICodeEditor } from '../../../browser/editorBrowser.js';\nimport { observableCodeEditor } from '../../../browser/observableCodeEditor.js';\nimport { Selection } from '../../../common/core/selection.js';\nimport { ILanguageFeatureDebounceService } from '../../../common/services/languageFeatureDebounce.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { inlineEditVisible, isPinnedContextKey } from './consts.js';\nimport { InlineEditsModel } from './inlineEditsModel.js';\nimport { InlineEditsWidget } from './inlineEditsWidget.js';\n\nexport class InlineEditsController extends Disposable {\n\tstatic ID = 'editor.contrib.inlineEditsController';\n\n\tpublic static get(editor: ICodeEditor): InlineEditsController | null {\n\t\treturn editor.getContribution<InlineEditsController>(InlineEditsController.ID);\n\t}\n\n\tprivate readonly _enabled = observableConfigValue('editor.inlineEdits.enabled', false, this._configurationService);\n\tprivate readonly _editorObs = observableCodeEditor(this.editor);\n\tprivate readonly _selection = derived(this, reader => this._editorObs.cursorSelection.read(reader) ?? new Selection(1, 1, 1, 1));\n\n\tprivate readonly _debounceValue = this._debounceService.for(\n\t\tthis._languageFeaturesService.inlineCompletionsProvider,\n\t\t'InlineEditsDebounce',\n\t\t{ min: 50, max: 50 }\n\t);\n\n\tpublic readonly model = derivedDisposable<InlineEditsModel | undefined>(this, reader => {\n\t\tif (!this._enabled.read(reader)) {\n\t\t\treturn undefined;\n\t\t}\n\t\tif (this._editorObs.isReadonly.read(reader)) { return undefined; }\n\t\tconst textModel = this._editorObs.model.read(reader);\n\t\tif (!textModel) { return undefined; }\n\n\t\tconst model: InlineEditsModel = this._instantiationService.createInstance(\n\t\t\treadHotReloadableExport(InlineEditsModel, reader),\n\t\t\ttextModel,\n\t\t\tthis._editorObs.versionId,\n\t\t\tthis._selection,\n\t\t\tthis._debounceValue,\n\t\t);\n\n\t\treturn model;\n\t});\n\n\tprivate readonly _hadInlineEdit = derivedObservableWithCache<boolean>(this, (reader, lastValue) => lastValue || this.model.read(reader)?.inlineEdit.read(reader) !== undefined);\n\n\tprotected readonly _widget = derivedDisposable(this, reader => {\n\t\tif (!this._hadInlineEdit.read(reader)) { return undefined; }\n\n\t\treturn this._instantiationService.createInstance(\n\t\t\treadHotReloadableExport(InlineEditsWidget, reader),\n\t\t\tthis.editor,\n\t\t\tthis.model.map((m, reader) => m?.inlineEdit.read(reader)),\n\t\t\tflattenSettableObservable((reader) => this.model.read(reader)?.userPrompt ?? observableValue('empty', '')),\n\t\t);\n\t});\n\n\tconstructor(\n\t\tpublic readonly editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@ILanguageFeatureDebounceService private readonly _debounceService: ILanguageFeatureDebounceService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(bindContextKey(inlineEditVisible, this._contextKeyService, r => !!this.model.read(r)?.inlineEdit.read(r)));\n\t\tthis._register(bindContextKey(isPinnedContextKey, this._contextKeyService, r => !!this.model.read(r)?.isPinned.read(r)));\n\n\t\tthis.model.recomputeInitiallyAndOnChange(this._store);\n\t\tthis._widget.recomputeInitiallyAndOnChange(this._store);\n\t}\n}\n\nfunction flattenSettableObservable<TResult>(fn: (reader: IReader | undefined) => ISettableObservable<TResult>): ISettableObservable<TResult> {\n\treturn derivedWithSetter(undefined, reader => {\n\t\tconst obs = fn(reader);\n\t\treturn obs.read(reader);\n\t}, (value, tx) => {\n\t\tfn(undefined).set(value, tx);\n\t});\n}\n"],
  "mappings": "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",
  "names": ["reader"]
}
