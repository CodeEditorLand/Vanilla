var g=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var f=(o,r,e,t)=>{for(var n=t>1?void 0:t?M(r,e):r,a=o.length-1,l;a>=0;a--)(l=o[a])&&(n=(t?l(r,e,n):l(n))||n);return t&&n&&g(r,e,n),n},m=(o,r)=>(e,t)=>r(e,t,o);import{normalizeDriveLetter as h}from"../../../../base/common/labels.js";import*as u from"../../../../base/common/path.js";import{dirname as C}from"../../../../base/common/resources.js";import{commonPrefixLength as v,getLeadingWhitespace as E,isFalsyOrWhitespace as y,splitLines as b}from"../../../../base/common/strings.js";import{generateUuid as O}from"../../../../base/common/uuid.js";import*as i from"../../../../nls.js";import{WORKSPACE_EXTENSION as R,isEmptyWorkspaceIdentifier as I,isSingleFolderWorkspaceIdentifier as S,toWorkspaceIdentifier as L}from"../../../../platform/workspace/common/workspace.js";import{ILanguageConfigurationService as A}from"../../../common/languages/languageConfigurationRegistry.js";import{Text as U}from"./snippetParser.js";const H=Object.freeze({CURRENT_YEAR:!0,CURRENT_YEAR_SHORT:!0,CURRENT_MONTH:!0,CURRENT_DATE:!0,CURRENT_HOUR:!0,CURRENT_MINUTE:!0,CURRENT_SECOND:!0,CURRENT_DAY_NAME:!0,CURRENT_DAY_NAME_SHORT:!0,CURRENT_MONTH_NAME:!0,CURRENT_MONTH_NAME_SHORT:!0,CURRENT_SECONDS_UNIX:!0,CURRENT_TIMEZONE_OFFSET:!0,SELECTION:!0,CLIPBOARD:!0,TM_SELECTED_TEXT:!0,TM_CURRENT_LINE:!0,TM_CURRENT_WORD:!0,TM_LINE_INDEX:!0,TM_LINE_NUMBER:!0,TM_FILENAME:!0,TM_FILENAME_BASE:!0,TM_DIRECTORY:!0,TM_FILEPATH:!0,CURSOR_INDEX:!0,CURSOR_NUMBER:!0,RELATIVE_FILEPATH:!0,BLOCK_COMMENT_START:!0,BLOCK_COMMENT_END:!0,LINE_COMMENT:!0,WORKSPACE_NAME:!0,WORKSPACE_FOLDER:!0,RANDOM:!0,RANDOM_HEX:!0,UUID:!0});class J{constructor(r){this._delegates=r}resolve(r){for(const e of this._delegates){const t=e.resolve(r);if(t!==void 0)return t}}}class Y{constructor(r,e,t,n){this._model=r;this._selection=e;this._selectionIdx=t;this._overtypingCapturer=n}resolve(r){const{name:e}=r;if(e==="SELECTION"||e==="TM_SELECTED_TEXT"){let t=this._model.getValueInRange(this._selection)||void 0,n=this._selection.startLineNumber!==this._selection.endLineNumber;if(!t&&this._overtypingCapturer){const a=this._overtypingCapturer.getLastOvertypedInfo(this._selectionIdx);a&&(t=a.value,n=a.multiline)}if(t&&n&&r.snippet){const a=this._model.getLineContent(this._selection.startLineNumber),l=E(a,0,this._selection.startColumn-1);let s=l;r.snippet.walk(c=>c===r?!1:(c instanceof U&&(s=E(b(c.value).pop())),!0));const p=v(s,l);t=t.replace(/(\r\n|\r|\n)(.*)/g,(c,N,T)=>`${N}${s.substr(p)}${T}`)}return t}else{if(e==="TM_CURRENT_LINE")return this._model.getLineContent(this._selection.positionLineNumber);if(e==="TM_CURRENT_WORD"){const t=this._model.getWordAtPosition({lineNumber:this._selection.positionLineNumber,column:this._selection.positionColumn});return t&&t.word||void 0}else{if(e==="TM_LINE_INDEX")return String(this._selection.positionLineNumber-1);if(e==="TM_LINE_NUMBER")return String(this._selection.positionLineNumber);if(e==="CURSOR_INDEX")return String(this._selectionIdx);if(e==="CURSOR_NUMBER")return String(this._selectionIdx+1)}}}}class B{constructor(r,e){this._labelService=r;this._model=e}resolve(r){const{name:e}=r;if(e==="TM_FILENAME")return u.basename(this._model.uri.fsPath);if(e==="TM_FILENAME_BASE"){const t=u.basename(this._model.uri.fsPath),n=t.lastIndexOf(".");return n<=0?t:t.slice(0,n)}else{if(e==="TM_DIRECTORY")return u.dirname(this._model.uri.fsPath)==="."?"":this._labelService.getUriLabel(C(this._model.uri));if(e==="TM_FILEPATH")return this._labelService.getUriLabel(this._model.uri);if(e==="RELATIVE_FILEPATH")return this._labelService.getUriLabel(this._model.uri,{relative:!0,noPrefix:!0})}}}class X{constructor(r,e,t,n){this._readClipboardText=r;this._selectionIdx=e;this._selectionCount=t;this._spread=n}resolve(r){if(r.name!=="CLIPBOARD")return;const e=this._readClipboardText();if(e){if(this._spread){const t=e.split(/\r\n|\n|\r/).filter(n=>!y(n));if(t.length===this._selectionCount)return t[this._selectionIdx]}return e}}}let _=class{constructor(r,e,t){this._model=r;this._selection=e;this._languageConfigurationService=t}resolve(r){const{name:e}=r,t=this._model.getLanguageIdAtPosition(this._selection.selectionStartLineNumber,this._selection.selectionStartColumn),n=this._languageConfigurationService.getLanguageConfiguration(t).comments;if(n){if(e==="LINE_COMMENT")return n.lineCommentToken||void 0;if(e==="BLOCK_COMMENT_START")return n.blockCommentStartToken||void 0;if(e==="BLOCK_COMMENT_END")return n.blockCommentEndToken||void 0}}};_=f([m(2,A)],_);class d{static dayNames=[i.localize("Sunday","Sunday"),i.localize("Monday","Monday"),i.localize("Tuesday","Tuesday"),i.localize("Wednesday","Wednesday"),i.localize("Thursday","Thursday"),i.localize("Friday","Friday"),i.localize("Saturday","Saturday")];static dayNamesShort=[i.localize("SundayShort","Sun"),i.localize("MondayShort","Mon"),i.localize("TuesdayShort","Tue"),i.localize("WednesdayShort","Wed"),i.localize("ThursdayShort","Thu"),i.localize("FridayShort","Fri"),i.localize("SaturdayShort","Sat")];static monthNames=[i.localize("January","January"),i.localize("February","February"),i.localize("March","March"),i.localize("April","April"),i.localize("May","May"),i.localize("June","June"),i.localize("July","July"),i.localize("August","August"),i.localize("September","September"),i.localize("October","October"),i.localize("November","November"),i.localize("December","December")];static monthNamesShort=[i.localize("JanuaryShort","Jan"),i.localize("FebruaryShort","Feb"),i.localize("MarchShort","Mar"),i.localize("AprilShort","Apr"),i.localize("MayShort","May"),i.localize("JuneShort","Jun"),i.localize("JulyShort","Jul"),i.localize("AugustShort","Aug"),i.localize("SeptemberShort","Sep"),i.localize("OctoberShort","Oct"),i.localize("NovemberShort","Nov"),i.localize("DecemberShort","Dec")];_date=new Date;resolve(r){const{name:e}=r;if(e==="CURRENT_YEAR")return String(this._date.getFullYear());if(e==="CURRENT_YEAR_SHORT")return String(this._date.getFullYear()).slice(-2);if(e==="CURRENT_MONTH")return String(this._date.getMonth().valueOf()+1).padStart(2,"0");if(e==="CURRENT_DATE")return String(this._date.getDate().valueOf()).padStart(2,"0");if(e==="CURRENT_HOUR")return String(this._date.getHours().valueOf()).padStart(2,"0");if(e==="CURRENT_MINUTE")return String(this._date.getMinutes().valueOf()).padStart(2,"0");if(e==="CURRENT_SECOND")return String(this._date.getSeconds().valueOf()).padStart(2,"0");if(e==="CURRENT_DAY_NAME")return d.dayNames[this._date.getDay()];if(e==="CURRENT_DAY_NAME_SHORT")return d.dayNamesShort[this._date.getDay()];if(e==="CURRENT_MONTH_NAME")return d.monthNames[this._date.getMonth()];if(e==="CURRENT_MONTH_NAME_SHORT")return d.monthNamesShort[this._date.getMonth()];if(e==="CURRENT_SECONDS_UNIX")return String(Math.floor(this._date.getTime()/1e3));if(e==="CURRENT_TIMEZONE_OFFSET"){const t=this._date.getTimezoneOffset(),n=t>0?"-":"+",a=Math.trunc(Math.abs(t/60)),l=a<10?"0"+a:a,s=Math.abs(t)-a*60,p=s<10?"0"+s:s;return n+l+":"+p}}}class K{constructor(r){this._workspaceService=r}resolve(r){if(!this._workspaceService)return;const e=L(this._workspaceService.getWorkspace());if(!I(e)){if(r.name==="WORKSPACE_NAME")return this._resolveWorkspaceName(e);if(r.name==="WORKSPACE_FOLDER")return this._resoveWorkspacePath(e)}}_resolveWorkspaceName(r){if(S(r))return u.basename(r.uri.path);let e=u.basename(r.configPath.path);return e.endsWith(R)&&(e=e.substr(0,e.length-R.length-1)),e}_resoveWorkspacePath(r){if(S(r))return h(r.uri.fsPath);const e=u.basename(r.configPath.path);let t=r.configPath.fsPath;return t.endsWith(e)&&(t=t.substr(0,t.length-e.length-1)),t?h(t):"/"}}class w{resolve(r){const{name:e}=r;if(e==="RANDOM")return Math.random().toString().slice(-6);if(e==="RANDOM_HEX")return Math.random().toString(16).slice(-6);if(e==="UUID")return O()}}export{X as ClipboardBasedVariableResolver,_ as CommentBasedVariableResolver,J as CompositeSnippetVariableResolver,H as KnownSnippetVariableNames,B as ModelBasedVariableResolver,w as RandomBasedVariableResolver,Y as SelectionBasedVariableResolver,d as TimeBasedVariableResolver,K as WorkspaceBasedVariableResolver};
