import{AsyncIterableObject as m}from"../../../../base/common/async.js";import{CancellationToken as s}from"../../../../base/common/cancellation.js";import{onUnexpectedExternalError as P}from"../../../../base/common/errors.js";import{registerModelAndPositionCommand as a}from"../../../browser/editorExtensions.js";import"../../../common/core/position.js";import"../../../common/model.js";import"../../../common/languages.js";import"../../../common/languageFeatureRegistry.js";import{ILanguageFeaturesService as v}from"../../../common/services/languageFeatures.js";class p{constructor(r,o,t){this.provider=r;this.hover=o;this.ordinal=t}}async function f(e,r,o,t,i){const n=await Promise.resolve(e.provideHover(o,t,i)).catch(P);if(!(!n||!H(n)))return new p(e,n,r)}function g(e,r,o,t,i=!1){const u=e.ordered(r,i).map((d,l)=>f(d,l,r,o,t));return m.fromPromises(u).coalesce()}function c(e,r,o,t,i=!1){return g(e,r,o,t,i).map(n=>n.hover).toPromise()}a("_executeHoverProvider",(e,r,o)=>{const t=e.get(v);return c(t.hoverProvider,r,o,s.None)}),a("_executeHoverProvider_recursive",(e,r,o)=>{const t=e.get(v);return c(t.hoverProvider,r,o,s.None,!0)});function H(e){const r=typeof e.range<"u",o=typeof e.contents<"u"&&e.contents&&e.contents.length>0;return r&&o}export{p as HoverProviderResult,g as getHoverProviderResultsAsAsyncIterable,c as getHoversPromise};
