import{Action as g}from"../../../../../vs/base/common/actions.js";import{Codicon as a}from"../../../../../vs/base/common/codicons.js";import{Emitter as V}from"../../../../../vs/base/common/event.js";import{Disposable as E}from"../../../../../vs/base/common/lifecycle.js";import{ThemeIcon as w}from"../../../../../vs/base/common/themables.js";import"../../../../../vs/editor/browser/editorBrowser.js";import{ICodeEditorService as p}from"../../../../../vs/editor/browser/services/codeEditorService.js";import{EditorContextKeys as v}from"../../../../../vs/editor/common/editorContextKeys.js";import{HoverVerbosityAction as n}from"../../../../../vs/editor/common/languages.js";import{ContentHoverController as u}from"../../../../../vs/editor/contrib/hover/browser/contentHoverController2.js";import{DECREASE_HOVER_VERBOSITY_ACCESSIBLE_ACTION_ID as x,DECREASE_HOVER_VERBOSITY_ACTION_ID as b,INCREASE_HOVER_VERBOSITY_ACCESSIBLE_ACTION_ID as H,INCREASE_HOVER_VERBOSITY_ACTION_ID as h}from"../../../../../vs/editor/contrib/hover/browser/hoverActionIds.js";import{labelForHoverVerbosityAction as S}from"../../../../../vs/editor/contrib/hover/browser/markdownHoverParticipant.js";import{localize as C}from"../../../../../vs/nls.js";import{AccessibleContentProvider as O,AccessibleViewProviderId as I,AccessibleViewType as c}from"../../../../../vs/platform/accessibility/browser/accessibleView.js";import"../../../../../vs/platform/accessibility/browser/accessibleViewRegistry.js";import{IContextViewService as P}from"../../../../../vs/platform/contextview/browser/contextView.js";import{IHoverService as D}from"../../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as m}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as F}from"../../../../../vs/platform/keybinding/common/keybinding.js";var l;(e=>(e.increaseVerbosity=C("increaseVerbosity","- The focused hover part verbosity level can be increased with the Increase Hover Verbosity command.",`<keybinding:${h}>`),e.decreaseVerbosity=C("decreaseVerbosity","- The focused hover part verbosity level can be decreased with the Decrease Hover Verbosity command.",`<keybinding:${b}>`)))(l||={});class ce{type=c.View;priority=95;name="hover";when=v.hoverFocused;getProvider(i){const e=i.get(p),o=e.getActiveCodeEditor()||e.getFocusedCodeEditor();if(!o)throw new Error("No active or focused code editor");const t=u.get(o);if(!t)return;const r=i.get(F);return i.get(m).createInstance(T,r,o,t)}}class de{priority=100;name="hover";type=c.Help;when=v.hoverVisible;getProvider(i){const e=i.get(p),o=e.getActiveCodeEditor()||e.getFocusedCodeEditor();if(!o)throw new Error("No active or focused code editor");const t=u.get(o);if(t)return i.get(m).createInstance(f,t)}}class A extends E{constructor(e){super();this._hoverController=e}id=I.Hover;verbositySettingKey="accessibility.verbosity.hover";_onDidChangeContent=this._register(new V);onDidChangeContent=this._onDidChangeContent.event;_focusedHoverPartIndex=-1;onOpen(){this._hoverController&&(this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!0,this._focusedHoverPartIndex=this._hoverController.focusedHoverPartIndex(),this._register(this._hoverController.onHoverContentsChanged(()=>{this._onDidChangeContent.fire()})))}onClose(){this._hoverController&&(this._focusedHoverPartIndex===-1?this._hoverController.focus():this._hoverController.focusHoverPartWithIndex(this._focusedHoverPartIndex),this._focusedHoverPartIndex=-1,this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!1)}provideContentAtIndex(e,o){if(e!==-1){const t=this._hoverController.getAccessibleWidgetContentAtIndex(e);if(t===void 0)return"";const r=[];return o&&r.push(...this._descriptionsOfVerbosityActionsForIndex(e)),r.push(t),r.join(`
`)}else{const t=this._hoverController.getAccessibleWidgetContent();if(t===void 0)return"";const r=[];return r.push(t),r.join(`
`)}}_descriptionsOfVerbosityActionsForIndex(e){const o=[],t=this._descriptionOfVerbosityActionForIndex(n.Increase,e);t!==void 0&&o.push(t);const r=this._descriptionOfVerbosityActionForIndex(n.Decrease,e);return r!==void 0&&o.push(r),o}_descriptionOfVerbosityActionForIndex(e,o){if(this._hoverController.doesHoverAtIndexSupportVerbosityAction(o,e))switch(e){case n.Increase:return l.increaseVerbosity;case n.Decrease:return l.decreaseVerbosity}}}class f extends A{options={type:c.Help};constructor(i){super(i)}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class T extends A{constructor(e,o,t){super(t);this._keybindingService=e;this._editor=o;this._initializeOptions(this._editor,t)}options={type:c.View};provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!1)}get actions(){const e=[];return e.push(this._getActionFor(this._editor,n.Increase)),e.push(this._getActionFor(this._editor,n.Decrease)),e}_getActionFor(e,o){let t,r,d;switch(o){case n.Increase:t=h,r=H,d=a.add;break;case n.Decrease:t=b,r=x,d=a.remove;break}const y=S(this._keybindingService,o),_=this._hoverController.doesHoverAtIndexSupportVerbosityAction(this._focusedHoverPartIndex,o);return new g(r,y,w.asClassName(d),_,()=>{e.getAction(t)?.run({index:this._focusedHoverPartIndex,focus:!1})})}_initializeOptions(e,o){const t=this._register(new f(o));this.options.language=e.getModel()?.getLanguageId(),this.options.customHelp=()=>t.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class le{type=c.View;priority=90;name="extension-hover";getProvider(i){const o=i.get(P).getContextViewElement(),t=o?.textContent??void 0,r=i.get(D);if(!(o.classList.contains("accessible-view-container")||!t))return new O(I.Hover,{language:"typescript",type:c.View},()=>t,()=>{r.showAndFocusLastHover()},"accessibility.verbosity.hover")}}export{le as ExtHoverAccessibleView,de as HoverAccessibilityHelp,f as HoverAccessibilityHelpProvider,ce as HoverAccessibleView,T as HoverAccessibleViewProvider};
