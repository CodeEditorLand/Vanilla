import{Action as g}from"../../../../base/common/actions.js";import{Codicon as a}from"../../../../base/common/codicons.js";import{Emitter as V}from"../../../../base/common/event.js";import{Disposable as E}from"../../../../base/common/lifecycle.js";import{ThemeIcon as w}from"../../../../base/common/themables.js";import{localize as p}from"../../../../nls.js";import{AccessibleContentProvider as x,AccessibleViewProviderId as v,AccessibleViewType as c}from"../../../../platform/accessibility/browser/accessibleView.js";import{IContextViewService as H}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as S}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as u}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as O}from"../../../../platform/keybinding/common/keybinding.js";import{ICodeEditorService as b}from"../../../browser/services/codeEditorService.js";import{EditorContextKeys as h}from"../../../common/editorContextKeys.js";import{HoverVerbosityAction as n}from"../../../common/languages.js";import{ContentHoverController as C}from"./contentHoverController.js";import{DECREASE_HOVER_VERBOSITY_ACCESSIBLE_ACTION_ID as P,DECREASE_HOVER_VERBOSITY_ACTION_ID as I,INCREASE_HOVER_VERBOSITY_ACCESSIBLE_ACTION_ID as D,INCREASE_HOVER_VERBOSITY_ACTION_ID as m}from"./hoverActionIds.js";import{labelForHoverVerbosityAction as F}from"./markdownHoverParticipant.js";var l;(e=>(e.increaseVerbosity=p("increaseVerbosity","- The focused hover part verbosity level can be increased with the Increase Hover Verbosity command.",`<keybinding:${m}>`),e.decreaseVerbosity=p("decreaseVerbosity","- The focused hover part verbosity level can be decreased with the Decrease Hover Verbosity command.",`<keybinding:${I}>`)))(l||={});class X{type=c.View;priority=95;name="hover";when=h.hoverFocused;getProvider(i){const e=i.get(b),o=e.getActiveCodeEditor()||e.getFocusedCodeEditor();if(!o)throw new Error("No active or focused code editor");const t=C.get(o);if(!t)return;const r=i.get(O);return i.get(u).createInstance(R,r,o,t)}}class Z{priority=100;name="hover";type=c.Help;when=h.hoverVisible;getProvider(i){const e=i.get(b),o=e.getActiveCodeEditor()||e.getFocusedCodeEditor();if(!o)throw new Error("No active or focused code editor");const t=C.get(o);if(t)return i.get(u).createInstance(A,t)}}class y extends E{constructor(e){super();this._hoverController=e}id=v.Hover;verbositySettingKey="accessibility.verbosity.hover";_onDidChangeContent=this._register(new V);onDidChangeContent=this._onDidChangeContent.event;_focusedHoverPartIndex=-1;onOpen(){this._hoverController&&(this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!0,this._focusedHoverPartIndex=this._hoverController.focusedHoverPartIndex(),this._register(this._hoverController.onHoverContentsChanged(()=>{this._onDidChangeContent.fire()})))}onClose(){this._hoverController&&(this._focusedHoverPartIndex===-1?this._hoverController.focus():this._hoverController.focusHoverPartWithIndex(this._focusedHoverPartIndex),this._focusedHoverPartIndex=-1,this._hoverController.shouldKeepOpenOnEditorMouseMoveOrLeave=!1)}provideContentAtIndex(e,o){if(e!==-1){const t=this._hoverController.getAccessibleWidgetContentAtIndex(e);if(t===void 0)return"";const r=[];return o&&r.push(...this._descriptionsOfVerbosityActionsForIndex(e)),r.push(t),r.join(`
`)}else{const t=this._hoverController.getAccessibleWidgetContent();if(t===void 0)return"";const r=[];return r.push(t),r.join(`
`)}}_descriptionsOfVerbosityActionsForIndex(e){const o=[],t=this._descriptionOfVerbosityActionForIndex(n.Increase,e);t!==void 0&&o.push(t);const r=this._descriptionOfVerbosityActionForIndex(n.Decrease,e);return r!==void 0&&o.push(r),o}_descriptionOfVerbosityActionForIndex(e,o){if(this._hoverController.doesHoverAtIndexSupportVerbosityAction(o,e))switch(e){case n.Increase:return l.increaseVerbosity;case n.Decrease:return l.decreaseVerbosity}}}class A extends y{options={type:c.Help};constructor(i){super(i)}provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class R extends y{constructor(e,o,t){super(t);this._keybindingService=e;this._editor=o;this._initializeOptions(this._editor,t)}options={type:c.View};provideContent(){return this.provideContentAtIndex(this._focusedHoverPartIndex,!1)}get actions(){const e=[];return e.push(this._getActionFor(this._editor,n.Increase)),e.push(this._getActionFor(this._editor,n.Decrease)),e}_getActionFor(e,o){let t,r,d;switch(o){case n.Increase:t=m,r=D,d=a.add;break;case n.Decrease:t=I,r=P,d=a.remove;break}const f=F(this._keybindingService,o),_=this._hoverController.doesHoverAtIndexSupportVerbosityAction(this._focusedHoverPartIndex,o);return new g(r,f,w.asClassName(d),_,()=>{e.getAction(t)?.run({index:this._focusedHoverPartIndex,focus:!1})})}_initializeOptions(e,o){const t=this._register(new A(o));this.options.language=e.getModel()?.getLanguageId(),this.options.customHelp=()=>t.provideContentAtIndex(this._focusedHoverPartIndex,!0)}}class ee{type=c.View;priority=90;name="extension-hover";getProvider(i){const o=i.get(H).getContextViewElement(),t=o?.textContent??void 0,r=i.get(S);if(!(o.classList.contains("accessible-view-container")||!t))return new x(v.Hover,{language:"typescript",type:c.View},()=>t,()=>{r.showAndFocusLastHover()},"accessibility.verbosity.hover")}}export{ee as ExtHoverAccessibleView,Z as HoverAccessibilityHelp,A as HoverAccessibilityHelpProvider,X as HoverAccessibleView,R as HoverAccessibleViewProvider};
