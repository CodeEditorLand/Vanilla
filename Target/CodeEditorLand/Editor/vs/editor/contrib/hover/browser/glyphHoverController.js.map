{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/hover/browser/glyphHoverController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IKeyboardEvent } from '../../../../base/browser/keyboardEvent.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor, IEditorMouseEvent, IPartialEditorMouseEvent } from '../../../browser/editorBrowser.js';\nimport { ConfigurationChangedEvent, EditorOption } from '../../../common/config/editorOptions.js';\nimport { IEditorContribution, IScrollEvent } from '../../../common/editorCommon.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IHoverWidget } from './hoverTypes.js';\nimport { RunOnceScheduler } from '../../../../base/common/async.js';\nimport { isMousePositionWithinElement } from './hoverUtils.js';\nimport './hover.css';\nimport { GlyphHoverWidget } from './glyphHoverWidget.js';\n\n// sticky hover widget which doesn't disappear on focus out and such\nconst _sticky = false\n\t// || Boolean(\"true\") // done \"weirdly\" so that a lint warning prevents you from pushing this\n\t;\n\ninterface IHoverSettings {\n\treadonly enabled: boolean;\n\treadonly sticky: boolean;\n\treadonly hidingDelay: number;\n}\n\ninterface IHoverState {\n\tmouseDown: boolean;\n}\n\nexport class GlyphHoverController extends Disposable implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.marginHover';\n\n\tpublic shouldKeepOpenOnEditorMouseMoveOrLeave: boolean = false;\n\n\tprivate readonly _listenersStore = new DisposableStore();\n\n\tprivate _glyphWidget: GlyphHoverWidget | undefined;\n\tprivate _mouseMoveEvent: IEditorMouseEvent | undefined;\n\tprivate _reactToEditorMouseMoveRunner: RunOnceScheduler;\n\n\tprivate _hoverSettings!: IHoverSettings;\n\tprivate _hoverState: IHoverState = {\n\t\tmouseDown: false\n\t};\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t\tthis._reactToEditorMouseMoveRunner = this._register(\n\t\t\tnew RunOnceScheduler(\n\t\t\t\t() => this._reactToEditorMouseMove(this._mouseMoveEvent), 0\n\t\t\t)\n\t\t);\n\t\tthis._hookListeners();\n\t\tthis._register(this._editor.onDidChangeConfiguration((e: ConfigurationChangedEvent) => {\n\t\t\tif (e.hasChanged(EditorOption.hover)) {\n\t\t\t\tthis._unhookListeners();\n\t\t\t\tthis._hookListeners();\n\t\t\t}\n\t\t}));\n\t}\n\n\tstatic get(editor: ICodeEditor): GlyphHoverController | null {\n\t\treturn editor.getContribution<GlyphHoverController>(GlyphHoverController.ID);\n\t}\n\n\tprivate _hookListeners(): void {\n\n\t\tconst hoverOpts = this._editor.getOption(EditorOption.hover);\n\t\tthis._hoverSettings = {\n\t\t\tenabled: hoverOpts.enabled,\n\t\t\tsticky: hoverOpts.sticky,\n\t\t\thidingDelay: hoverOpts.hidingDelay\n\t\t};\n\n\t\tif (hoverOpts.enabled) {\n\t\t\tthis._listenersStore.add(this._editor.onMouseDown((e: IEditorMouseEvent) => this._onEditorMouseDown(e)));\n\t\t\tthis._listenersStore.add(this._editor.onMouseUp(() => this._onEditorMouseUp()));\n\t\t\tthis._listenersStore.add(this._editor.onMouseMove((e: IEditorMouseEvent) => this._onEditorMouseMove(e)));\n\t\t\tthis._listenersStore.add(this._editor.onKeyDown((e: IKeyboardEvent) => this._onKeyDown(e)));\n\t\t} else {\n\t\t\tthis._listenersStore.add(this._editor.onMouseMove((e: IEditorMouseEvent) => this._onEditorMouseMove(e)));\n\t\t\tthis._listenersStore.add(this._editor.onKeyDown((e: IKeyboardEvent) => this._onKeyDown(e)));\n\t\t}\n\n\t\tthis._listenersStore.add(this._editor.onMouseLeave((e) => this._onEditorMouseLeave(e)));\n\t\tthis._listenersStore.add(this._editor.onDidChangeModel(() => {\n\t\t\tthis._cancelScheduler();\n\t\t\tthis._hideWidgets();\n\t\t}));\n\t\tthis._listenersStore.add(this._editor.onDidChangeModelContent(() => this._cancelScheduler()));\n\t\tthis._listenersStore.add(this._editor.onDidScrollChange((e: IScrollEvent) => this._onEditorScrollChanged(e)));\n\t}\n\n\tprivate _unhookListeners(): void {\n\t\tthis._listenersStore.clear();\n\t}\n\n\tprivate _cancelScheduler() {\n\t\tthis._mouseMoveEvent = undefined;\n\t\tthis._reactToEditorMouseMoveRunner.cancel();\n\t}\n\n\tprivate _onEditorScrollChanged(e: IScrollEvent): void {\n\t\tif (e.scrollTopChanged || e.scrollLeftChanged) {\n\t\t\tthis._hideWidgets();\n\t\t}\n\t}\n\n\tprivate _onEditorMouseDown(mouseEvent: IEditorMouseEvent): void {\n\t\tthis._hoverState.mouseDown = true;\n\t\tconst shouldNotHideCurrentHoverWidget = this._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\tif (shouldNotHideCurrentHoverWidget) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _isMouseOnGlyphHoverWidget(mouseEvent: IPartialEditorMouseEvent): boolean {\n\t\tconst glyphHoverWidgetNode = this._glyphWidget?.getDomNode();\n\t\tif (glyphHoverWidgetNode) {\n\t\t\treturn isMousePositionWithinElement(glyphHoverWidgetNode, mouseEvent.event.posx, mouseEvent.event.posy);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _onEditorMouseUp(): void {\n\t\tthis._hoverState.mouseDown = false;\n\t}\n\n\tprivate _onEditorMouseLeave(mouseEvent: IPartialEditorMouseEvent): void {\n\t\tif (this.shouldKeepOpenOnEditorMouseMoveOrLeave) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cancelScheduler();\n\t\tconst shouldNotHideCurrentHoverWidget = this._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\tif (shouldNotHideCurrentHoverWidget) {\n\t\t\treturn;\n\t\t}\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _shouldNotRecomputeCurrentHoverWidget(mouseEvent: IEditorMouseEvent): boolean {\n\t\tconst isHoverSticky = this._hoverSettings.sticky;\n\t\tconst isMouseOnGlyphHoverWidget = this._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\treturn isHoverSticky && isMouseOnGlyphHoverWidget;\n\t}\n\n\tprivate _onEditorMouseMove(mouseEvent: IEditorMouseEvent): void {\n\t\tif (this.shouldKeepOpenOnEditorMouseMoveOrLeave) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mouseMoveEvent = mouseEvent;\n\t\tconst shouldNotRecomputeCurrentHoverWidget = this._shouldNotRecomputeCurrentHoverWidget(mouseEvent);\n\t\tif (shouldNotRecomputeCurrentHoverWidget) {\n\t\t\tthis._reactToEditorMouseMoveRunner.cancel();\n\t\t\treturn;\n\t\t}\n\t\tthis._reactToEditorMouseMove(mouseEvent);\n\t}\n\n\tprivate _reactToEditorMouseMove(mouseEvent: IEditorMouseEvent | undefined): void {\n\n\t\tif (!mouseEvent) {\n\t\t\treturn;\n\t\t}\n\t\tconst glyphWidgetShowsOrWillShow = this._tryShowHoverWidget(mouseEvent);\n\t\tif (glyphWidgetShowsOrWillShow) {\n\t\t\treturn;\n\t\t}\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _tryShowHoverWidget(mouseEvent: IEditorMouseEvent): boolean {\n\t\tconst glyphWidget: IHoverWidget = this._getOrCreateGlyphWidget();\n\t\treturn glyphWidget.showsOrWillShow(mouseEvent);\n\t}\n\n\tprivate _onKeyDown(e: IKeyboardEvent): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (e.keyCode === KeyCode.Ctrl\n\t\t\t|| e.keyCode === KeyCode.Alt\n\t\t\t|| e.keyCode === KeyCode.Meta\n\t\t\t|| e.keyCode === KeyCode.Shift) {\n\t\t\t// Do not hide hover when a modifier key is pressed\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _hideWidgets(): void {\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._glyphWidget?.hide();\n\t}\n\n\tprivate _getOrCreateGlyphWidget(): GlyphHoverWidget {\n\t\tif (!this._glyphWidget) {\n\t\t\tthis._glyphWidget = this._instantiationService.createInstance(GlyphHoverWidget, this._editor);\n\t\t}\n\t\treturn this._glyphWidget;\n\t}\n\n\tpublic hideContentHover(): void {\n\t\tthis._hideWidgets();\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._unhookListeners();\n\t\tthis._listenersStore.dispose();\n\t\tthis._glyphWidget?.dispose();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
