{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/hover/browser/glyphHoverController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IKeyboardEvent } from \"../../../../base/browser/keyboardEvent.js\";\nimport { RunOnceScheduler } from \"../../../../base/common/async.js\";\nimport { KeyCode } from \"../../../../base/common/keyCodes.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n} from \"../../../../base/common/lifecycle.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport type {\n\tICodeEditor,\n\tIEditorMouseEvent,\n\tIPartialEditorMouseEvent,\n} from \"../../../browser/editorBrowser.js\";\nimport {\n\ttype ConfigurationChangedEvent,\n\tEditorOption,\n} from \"../../../common/config/editorOptions.js\";\nimport type {\n\tIEditorContribution,\n\tIScrollEvent,\n} from \"../../../common/editorCommon.js\";\nimport type { IHoverWidget } from \"./hoverTypes.js\";\nimport { isMousePositionWithinElement } from \"./hoverUtils.js\";\nimport \"./hover.css\";\nimport { GlyphHoverWidget } from \"./glyphHoverWidget.js\";\n\n// sticky hover widget which doesn't disappear on focus out and such\nconst _sticky = false;\n// || Boolean(\"true\") // done \"weirdly\" so that a lint warning prevents you from pushing this\n\ninterface IHoverSettings {\n\treadonly enabled: boolean;\n\treadonly sticky: boolean;\n\treadonly hidingDelay: number;\n}\n\ninterface IHoverState {\n\tmouseDown: boolean;\n}\n\nexport class GlyphHoverController\n\textends Disposable\n\timplements IEditorContribution\n{\n\tpublic static readonly ID = \"editor.contrib.marginHover\";\n\n\tpublic shouldKeepOpenOnEditorMouseMoveOrLeave = false;\n\n\tprivate readonly _listenersStore = new DisposableStore();\n\n\tprivate _glyphWidget: GlyphHoverWidget | undefined;\n\tprivate _mouseMoveEvent: IEditorMouseEvent | undefined;\n\tprivate _reactToEditorMouseMoveRunner: RunOnceScheduler;\n\n\tprivate _hoverSettings!: IHoverSettings;\n\tprivate _hoverState: IHoverState = {\n\t\tmouseDown: false,\n\t};\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t\tthis._reactToEditorMouseMoveRunner = this._register(\n\t\t\tnew RunOnceScheduler(\n\t\t\t\t() => this._reactToEditorMouseMove(this._mouseMoveEvent), 0\n\t\t\t)\n\t\t);\n\t\tthis._hookListeners();\n\t\tthis._register(this._editor.onDidChangeConfiguration((e: ConfigurationChangedEvent) => {\n\t\t\tif (e.hasChanged(EditorOption.hover)) {\n\t\t\t\tthis._unhookListeners();\n\t\t\t\tthis._hookListeners();\n\t\t\t}\n\t\t}));\n\t}\n\n\tstatic get(editor: ICodeEditor): GlyphHoverController | null {\n\t\treturn editor.getContribution<GlyphHoverController>(\n\t\t\tGlyphHoverController.ID,\n\t\t);\n\t}\n\n\tprivate _hookListeners(): void {\n\t\tconst hoverOpts = this._editor.getOption(EditorOption.hover);\n\t\tthis._hoverSettings = {\n\t\t\tenabled: hoverOpts.enabled,\n\t\t\tsticky: hoverOpts.sticky,\n\t\t\thidingDelay: hoverOpts.hidingDelay,\n\t\t};\n\n\t\tif (hoverOpts.enabled) {\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onMouseDown((e: IEditorMouseEvent) =>\n\t\t\t\t\tthis._onEditorMouseDown(e),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onMouseUp(() => this._onEditorMouseUp()),\n\t\t\t);\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onMouseMove((e: IEditorMouseEvent) =>\n\t\t\t\t\tthis._onEditorMouseMove(e),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onKeyDown((e: IKeyboardEvent) =>\n\t\t\t\t\tthis._onKeyDown(e),\n\t\t\t\t),\n\t\t\t);\n\t\t} else {\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onMouseMove((e: IEditorMouseEvent) =>\n\t\t\t\t\tthis._onEditorMouseMove(e),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._listenersStore.add(\n\t\t\t\tthis._editor.onKeyDown((e: IKeyboardEvent) =>\n\t\t\t\t\tthis._onKeyDown(e),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tthis._listenersStore.add(\n\t\t\tthis._editor.onMouseLeave((e) => this._onEditorMouseLeave(e)),\n\t\t);\n\t\tthis._listenersStore.add(\n\t\t\tthis._editor.onDidChangeModel(() => {\n\t\t\t\tthis._cancelScheduler();\n\t\t\t\tthis._hideWidgets();\n\t\t\t}),\n\t\t);\n\t\tthis._listenersStore.add(\n\t\t\tthis._editor.onDidChangeModelContent(() => this._cancelScheduler()),\n\t\t);\n\t\tthis._listenersStore.add(\n\t\t\tthis._editor.onDidScrollChange((e: IScrollEvent) =>\n\t\t\t\tthis._onEditorScrollChanged(e),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _unhookListeners(): void {\n\t\tthis._listenersStore.clear();\n\t}\n\n\tprivate _cancelScheduler() {\n\t\tthis._mouseMoveEvent = undefined;\n\t\tthis._reactToEditorMouseMoveRunner.cancel();\n\t}\n\n\tprivate _onEditorScrollChanged(e: IScrollEvent): void {\n\t\tif (e.scrollTopChanged || e.scrollLeftChanged) {\n\t\t\tthis._hideWidgets();\n\t\t}\n\t}\n\n\tprivate _onEditorMouseDown(mouseEvent: IEditorMouseEvent): void {\n\t\tthis._hoverState.mouseDown = true;\n\t\tconst shouldNotHideCurrentHoverWidget =\n\t\t\tthis._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\tif (shouldNotHideCurrentHoverWidget) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _isMouseOnGlyphHoverWidget(\n\t\tmouseEvent: IPartialEditorMouseEvent,\n\t): boolean {\n\t\tconst glyphHoverWidgetNode = this._glyphWidget?.getDomNode();\n\t\tif (glyphHoverWidgetNode) {\n\t\t\treturn isMousePositionWithinElement(\n\t\t\t\tglyphHoverWidgetNode,\n\t\t\t\tmouseEvent.event.posx,\n\t\t\t\tmouseEvent.event.posy,\n\t\t\t);\n\t\t}\n\t\treturn false;\n\t}\n\n\tprivate _onEditorMouseUp(): void {\n\t\tthis._hoverState.mouseDown = false;\n\t}\n\n\tprivate _onEditorMouseLeave(mouseEvent: IPartialEditorMouseEvent): void {\n\t\tif (this.shouldKeepOpenOnEditorMouseMoveOrLeave) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._cancelScheduler();\n\t\tconst shouldNotHideCurrentHoverWidget =\n\t\t\tthis._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\tif (shouldNotHideCurrentHoverWidget) {\n\t\t\treturn;\n\t\t}\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _shouldNotRecomputeCurrentHoverWidget(\n\t\tmouseEvent: IEditorMouseEvent,\n\t): boolean {\n\t\tconst isHoverSticky = this._hoverSettings.sticky;\n\t\tconst isMouseOnGlyphHoverWidget =\n\t\t\tthis._isMouseOnGlyphHoverWidget(mouseEvent);\n\t\treturn isHoverSticky && isMouseOnGlyphHoverWidget;\n\t}\n\n\tprivate _onEditorMouseMove(mouseEvent: IEditorMouseEvent): void {\n\t\tif (this.shouldKeepOpenOnEditorMouseMoveOrLeave) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._mouseMoveEvent = mouseEvent;\n\t\tconst shouldNotRecomputeCurrentHoverWidget =\n\t\t\tthis._shouldNotRecomputeCurrentHoverWidget(mouseEvent);\n\t\tif (shouldNotRecomputeCurrentHoverWidget) {\n\t\t\tthis._reactToEditorMouseMoveRunner.cancel();\n\t\t\treturn;\n\t\t}\n\t\tthis._reactToEditorMouseMove(mouseEvent);\n\t}\n\n\tprivate _reactToEditorMouseMove(\n\t\tmouseEvent: IEditorMouseEvent | undefined,\n\t): void {\n\t\tif (!mouseEvent) {\n\t\t\treturn;\n\t\t}\n\t\tconst glyphWidgetShowsOrWillShow = this._tryShowHoverWidget(mouseEvent);\n\t\tif (glyphWidgetShowsOrWillShow) {\n\t\t\treturn;\n\t\t}\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _tryShowHoverWidget(mouseEvent: IEditorMouseEvent): boolean {\n\t\tconst glyphWidget: IHoverWidget = this._getOrCreateGlyphWidget();\n\t\treturn glyphWidget.showsOrWillShow(mouseEvent);\n\t}\n\n\tprivate _onKeyDown(e: IKeyboardEvent): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (\n\t\t\te.keyCode === KeyCode.Ctrl ||\n\t\t\te.keyCode === KeyCode.Alt ||\n\t\t\te.keyCode === KeyCode.Meta ||\n\t\t\te.keyCode === KeyCode.Shift\n\t\t) {\n\t\t\t// Do not hide hover when a modifier key is pressed\n\t\t\treturn;\n\t\t}\n\t\tthis._hideWidgets();\n\t}\n\n\tprivate _hideWidgets(): void {\n\t\tif (_sticky) {\n\t\t\treturn;\n\t\t}\n\t\tthis._glyphWidget?.hide();\n\t}\n\n\tprivate _getOrCreateGlyphWidget(): GlyphHoverWidget {\n\t\tif (!this._glyphWidget) {\n\t\t\tthis._glyphWidget = this._instantiationService.createInstance(\n\t\t\t\tGlyphHoverWidget,\n\t\t\t\tthis._editor,\n\t\t\t);\n\t\t}\n\t\treturn this._glyphWidget;\n\t}\n\n\tpublic hideContentHover(): void {\n\t\tthis._hideWidgets();\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._unhookListeners();\n\t\tthis._listenersStore.dispose();\n\t\tthis._glyphWidget?.dispose();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
