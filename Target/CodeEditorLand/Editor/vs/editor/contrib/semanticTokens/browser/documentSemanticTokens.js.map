{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/semanticTokens/browser/documentSemanticTokens.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from \"../../../../base/common/async.js\";\nimport { CancellationTokenSource } from \"../../../../base/common/cancellation.js\";\nimport * as errors from \"../../../../base/common/errors.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\tdispose,\n} from \"../../../../base/common/lifecycle.js\";\nimport { StopWatch } from \"../../../../base/common/stopwatch.js\";\nimport { IConfigurationService } from \"../../../../platform/configuration/common/configuration.js\";\nimport { IThemeService } from \"../../../../platform/theme/common/themeService.js\";\nimport { registerEditorFeature } from \"../../../common/editorFeatures.js\";\nimport type { LanguageFeatureRegistry } from \"../../../common/languageFeatureRegistry.js\";\nimport type {\n\tDocumentSemanticTokensProvider,\n\tSemanticTokens,\n\tSemanticTokensEdits,\n} from \"../../../common/languages.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\nimport {\n\ttype IFeatureDebounceInformation,\n\tILanguageFeatureDebounceService,\n} from \"../../../common/services/languageFeatureDebounce.js\";\nimport { ILanguageFeaturesService } from \"../../../common/services/languageFeatures.js\";\nimport { IModelService } from \"../../../common/services/model.js\";\nimport {\n\ttype SemanticTokensProviderStyling,\n\ttoMultilineTokens2,\n} from \"../../../common/services/semanticTokensProviderStyling.js\";\nimport { ISemanticTokensStylingService } from \"../../../common/services/semanticTokensStyling.js\";\nimport type { IModelContentChangedEvent } from \"../../../common/textModelEvents.js\";\nimport {\n\tgetDocumentSemanticTokens,\n\thasDocumentSemanticTokensProvider,\n\tisSemanticTokens,\n\tisSemanticTokensEdits,\n} from \"../common/getSemanticTokens.js\";\nimport {\n\tSEMANTIC_HIGHLIGHTING_SETTING_ID,\n\tisSemanticColoringEnabled,\n} from \"../common/semanticTokensConfig.js\";\n\nexport class DocumentSemanticTokensFeature extends Disposable {\n\tprivate readonly _watchers: Record<string, ModelSemanticColoring>;\n\n\tconstructor(\n\t\t@ISemanticTokensStylingService semanticTokensStylingService: ISemanticTokensStylingService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILanguageFeatureDebounceService languageFeatureDebounceService: ILanguageFeatureDebounceService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper();\n\t\tthis._watchers = Object.create(null);\n\n\t\tconst register = (model: ITextModel) => {\n\t\t\tthis._watchers[model.uri.toString()] = new ModelSemanticColoring(\n\t\t\t\tmodel,\n\t\t\t\tsemanticTokensStylingService,\n\t\t\t\tthemeService,\n\t\t\t\tlanguageFeatureDebounceService,\n\t\t\t\tlanguageFeaturesService,\n\t\t\t);\n\t\t};\n\t\tconst deregister = (\n\t\t\tmodel: ITextModel,\n\t\t\tmodelSemanticColoring: ModelSemanticColoring,\n\t\t) => {\n\t\t\tmodelSemanticColoring.dispose();\n\t\t\tdelete this._watchers[model.uri.toString()];\n\t\t};\n\t\tconst handleSettingOrThemeChange = () => {\n\t\t\tfor (const model of modelService.getModels()) {\n\t\t\t\tconst curr = this._watchers[model.uri.toString()];\n\t\t\t\tif (\n\t\t\t\t\tisSemanticColoringEnabled(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tthemeService,\n\t\t\t\t\t\tconfigurationService,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tif (!curr) {\n\t\t\t\t\t\tregister(model);\n\t\t\t\t\t}\n\t\t\t\t} else if (curr) {\n\t\t\t\t\tderegister(model, curr);\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tmodelService.getModels().forEach((model) => {\n\t\t\tif (\n\t\t\t\tisSemanticColoringEnabled(\n\t\t\t\t\tmodel,\n\t\t\t\t\tthemeService,\n\t\t\t\t\tconfigurationService,\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tregister(model);\n\t\t\t}\n\t\t});\n\t\tthis._register(\n\t\t\tmodelService.onModelAdded((model) => {\n\t\t\t\tif (\n\t\t\t\t\tisSemanticColoringEnabled(\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tthemeService,\n\t\t\t\t\t\tconfigurationService,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tregister(model);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tmodelService.onModelRemoved((model) => {\n\t\t\t\tconst curr = this._watchers[model.uri.toString()];\n\t\t\t\tif (curr) {\n\t\t\t\t\tderegister(model, curr);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tconfigurationService.onDidChangeConfiguration((e) => {\n\t\t\t\tif (e.affectsConfiguration(SEMANTIC_HIGHLIGHTING_SETTING_ID)) {\n\t\t\t\t\thandleSettingOrThemeChange();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthemeService.onDidColorThemeChange(handleSettingOrThemeChange),\n\t\t);\n\t}\n\n\toverride dispose(): void {\n\t\t// Dispose all watchers\n\t\tfor (const watcher of Object.values(this._watchers)) {\n\t\t\twatcher.dispose();\n\t\t}\n\t\tsuper.dispose();\n\t}\n}\n\nclass ModelSemanticColoring extends Disposable {\n\tpublic static REQUEST_MIN_DELAY = 300;\n\tpublic static REQUEST_MAX_DELAY = 2000;\n\n\tprivate _isDisposed: boolean;\n\tprivate readonly _model: ITextModel;\n\tprivate readonly _provider: LanguageFeatureRegistry<DocumentSemanticTokensProvider>;\n\tprivate readonly _debounceInformation: IFeatureDebounceInformation;\n\tprivate readonly _fetchDocumentSemanticTokens: RunOnceScheduler;\n\tprivate _currentDocumentResponse: SemanticTokensResponse | null;\n\tprivate _currentDocumentRequestCancellationTokenSource: CancellationTokenSource | null;\n\tprivate _documentProvidersChangeListeners: IDisposable[];\n\tprivate _providersChangedDuringRequest: boolean;\n\n\tconstructor(\n\t\tmodel: ITextModel,\n\t\t@ISemanticTokensStylingService private readonly _semanticTokensStylingService: ISemanticTokensStylingService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ILanguageFeatureDebounceService languageFeatureDebounceService: ILanguageFeatureDebounceService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper();\n\n\t\tthis._isDisposed = false;\n\t\tthis._model = model;\n\t\tthis._provider = languageFeaturesService.documentSemanticTokensProvider;\n\t\tthis._debounceInformation = languageFeatureDebounceService.for(this._provider, 'DocumentSemanticTokens', { min: ModelSemanticColoring.REQUEST_MIN_DELAY, max: ModelSemanticColoring.REQUEST_MAX_DELAY });\n\t\tthis._fetchDocumentSemanticTokens = this._register(new RunOnceScheduler(() => this._fetchDocumentSemanticTokensNow(), ModelSemanticColoring.REQUEST_MIN_DELAY));\n\t\tthis._currentDocumentResponse = null;\n\t\tthis._currentDocumentRequestCancellationTokenSource = null;\n\t\tthis._documentProvidersChangeListeners = [];\n\t\tthis._providersChangedDuringRequest = false;\n\n\t\tthis._register(this._model.onDidChangeContent(() => {\n\t\t\tif (!this._fetchDocumentSemanticTokens.isScheduled()) {\n\t\t\t\tthis._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._model.onDidChangeAttached(() => {\n\t\t\tif (!this._fetchDocumentSemanticTokens.isScheduled()) {\n\t\t\t\tthis._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._model.onDidChangeLanguage(() => {\n\t\t\t// clear any outstanding state\n\t\t\tif (this._currentDocumentResponse) {\n\t\t\t\tthis._currentDocumentResponse.dispose();\n\t\t\t\tthis._currentDocumentResponse = null;\n\t\t\t}\n\t\t\tif (this._currentDocumentRequestCancellationTokenSource) {\n\t\t\t\tthis._currentDocumentRequestCancellationTokenSource.cancel();\n\t\t\t\tthis._currentDocumentRequestCancellationTokenSource = null;\n\t\t\t}\n\t\t\tthis._setDocumentSemanticTokens(null, null, null, []);\n\t\t\tthis._fetchDocumentSemanticTokens.schedule(0);\n\t\t}));\n\n\t\tconst bindDocumentChangeListeners = () => {\n\t\t\tdispose(this._documentProvidersChangeListeners);\n\t\t\tthis._documentProvidersChangeListeners = [];\n\t\t\tfor (const provider of this._provider.all(model)) {\n\t\t\t\tif (typeof provider.onDidChange === 'function') {\n\t\t\t\t\tthis._documentProvidersChangeListeners.push(provider.onDidChange(() => {\n\t\t\t\t\t\tif (this._currentDocumentRequestCancellationTokenSource) {\n\t\t\t\t\t\t\t// there is already a request running,\n\t\t\t\t\t\t\tthis._providersChangedDuringRequest = true;\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._fetchDocumentSemanticTokens.schedule(0);\n\t\t\t\t\t}));\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\t\tbindDocumentChangeListeners();\n\t\tthis._register(this._provider.onDidChange(() => {\n\t\t\tbindDocumentChangeListeners();\n\t\t\tthis._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n\t\t}));\n\n\t\tthis._register(themeService.onDidColorThemeChange(_ => {\n\t\t\t// clear out existing tokens\n\t\t\tthis._setDocumentSemanticTokens(null, null, null, []);\n\t\t\tthis._fetchDocumentSemanticTokens.schedule(this._debounceInformation.get(this._model));\n\t\t}));\n\n\t\tthis._fetchDocumentSemanticTokens.schedule(0);\n\t}\n\n\tpublic override dispose(): void {\n\t\tif (this._currentDocumentResponse) {\n\t\t\tthis._currentDocumentResponse.dispose();\n\t\t\tthis._currentDocumentResponse = null;\n\t\t}\n\t\tif (this._currentDocumentRequestCancellationTokenSource) {\n\t\t\tthis._currentDocumentRequestCancellationTokenSource.cancel();\n\t\t\tthis._currentDocumentRequestCancellationTokenSource = null;\n\t\t}\n\t\tdispose(this._documentProvidersChangeListeners);\n\t\tthis._documentProvidersChangeListeners = [];\n\t\tthis._setDocumentSemanticTokens(null, null, null, []);\n\t\tthis._isDisposed = true;\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate _fetchDocumentSemanticTokensNow(): void {\n\t\tif (this._currentDocumentRequestCancellationTokenSource) {\n\t\t\t// there is already a request running, let it finish...\n\t\t\treturn;\n\t\t}\n\n\t\tif (!hasDocumentSemanticTokensProvider(this._provider, this._model)) {\n\t\t\t// there is no provider\n\t\t\tif (this._currentDocumentResponse) {\n\t\t\t\t// there are semantic tokens set\n\t\t\t\tthis._model.tokenization.setSemanticTokens(null, false);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._model.isAttachedToEditor()) {\n\t\t\t// this document is not visible, there is no need to fetch semantic tokens for it\n\t\t\treturn;\n\t\t}\n\n\t\tconst cancellationTokenSource = new CancellationTokenSource();\n\t\tconst lastProvider = this._currentDocumentResponse\n\t\t\t? this._currentDocumentResponse.provider\n\t\t\t: null;\n\t\tconst lastResultId = this._currentDocumentResponse\n\t\t\t? this._currentDocumentResponse.resultId || null\n\t\t\t: null;\n\t\tconst request = getDocumentSemanticTokens(\n\t\t\tthis._provider,\n\t\t\tthis._model,\n\t\t\tlastProvider,\n\t\t\tlastResultId,\n\t\t\tcancellationTokenSource.token,\n\t\t);\n\t\tthis._currentDocumentRequestCancellationTokenSource =\n\t\t\tcancellationTokenSource;\n\t\tthis._providersChangedDuringRequest = false;\n\n\t\tconst pendingChanges: IModelContentChangedEvent[] = [];\n\t\tconst contentChangeListener = this._model.onDidChangeContent((e) => {\n\t\t\tpendingChanges.push(e);\n\t\t});\n\n\t\tconst sw = new StopWatch(false);\n\t\trequest.then(\n\t\t\t(res) => {\n\t\t\t\tthis._debounceInformation.update(this._model, sw.elapsed());\n\t\t\t\tthis._currentDocumentRequestCancellationTokenSource = null;\n\t\t\t\tcontentChangeListener.dispose();\n\n\t\t\t\tif (res) {\n\t\t\t\t\tconst { provider, tokens } = res;\n\t\t\t\t\tconst styling =\n\t\t\t\t\t\tthis._semanticTokensStylingService.getStyling(provider);\n\t\t\t\t\tthis._setDocumentSemanticTokens(\n\t\t\t\t\t\tprovider,\n\t\t\t\t\t\ttokens || null,\n\t\t\t\t\t\tstyling,\n\t\t\t\t\t\tpendingChanges,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tthis._setDocumentSemanticTokens(\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tnull,\n\t\t\t\t\t\tpendingChanges,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tconst isExpectedError =\n\t\t\t\t\terr &&\n\t\t\t\t\t(errors.isCancellationError(err) ||\n\t\t\t\t\t\t(typeof err.message === \"string\" &&\n\t\t\t\t\t\t\terr.message.indexOf(\"busy\") !== -1));\n\t\t\t\tif (!isExpectedError) {\n\t\t\t\t\terrors.onUnexpectedError(err);\n\t\t\t\t}\n\n\t\t\t\t// Semantic tokens eats up all errors and considers errors to mean that the result is temporarily not available\n\t\t\t\t// The API does not have a special error kind to express this...\n\t\t\t\tthis._currentDocumentRequestCancellationTokenSource = null;\n\t\t\t\tcontentChangeListener.dispose();\n\n\t\t\t\tif (\n\t\t\t\t\tpendingChanges.length > 0 ||\n\t\t\t\t\tthis._providersChangedDuringRequest\n\t\t\t\t) {\n\t\t\t\t\t// More changes occurred while the request was running\n\t\t\t\t\tif (!this._fetchDocumentSemanticTokens.isScheduled()) {\n\t\t\t\t\t\tthis._fetchDocumentSemanticTokens.schedule(\n\t\t\t\t\t\t\tthis._debounceInformation.get(this._model),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate static _copy(\n\t\tsrc: Uint32Array,\n\t\tsrcOffset: number,\n\t\tdest: Uint32Array,\n\t\tdestOffset: number,\n\t\tlength: number,\n\t): void {\n\t\t// protect against overflows\n\t\tlength = Math.min(\n\t\t\tlength,\n\t\t\tdest.length - destOffset,\n\t\t\tsrc.length - srcOffset,\n\t\t);\n\t\tfor (let i = 0; i < length; i++) {\n\t\t\tdest[destOffset + i] = src[srcOffset + i];\n\t\t}\n\t}\n\n\tprivate _setDocumentSemanticTokens(\n\t\tprovider: DocumentSemanticTokensProvider | null,\n\t\ttokens: SemanticTokens | SemanticTokensEdits | null,\n\t\tstyling: SemanticTokensProviderStyling | null,\n\t\tpendingChanges: IModelContentChangedEvent[],\n\t): void {\n\t\tconst currentResponse = this._currentDocumentResponse;\n\t\tconst rescheduleIfNeeded = () => {\n\t\t\tif (\n\t\t\t\t(pendingChanges.length > 0 ||\n\t\t\t\t\tthis._providersChangedDuringRequest) &&\n\t\t\t\t!this._fetchDocumentSemanticTokens.isScheduled()\n\t\t\t) {\n\t\t\t\tthis._fetchDocumentSemanticTokens.schedule(\n\t\t\t\t\tthis._debounceInformation.get(this._model),\n\t\t\t\t);\n\t\t\t}\n\t\t};\n\n\t\tif (this._currentDocumentResponse) {\n\t\t\tthis._currentDocumentResponse.dispose();\n\t\t\tthis._currentDocumentResponse = null;\n\t\t}\n\t\tif (this._isDisposed) {\n\t\t\t// disposed!\n\t\t\tif (provider && tokens) {\n\t\t\t\tprovider.releaseDocumentSemanticTokens(tokens.resultId);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\t\tif (!provider || !styling) {\n\t\t\tthis._model.tokenization.setSemanticTokens(null, false);\n\t\t\treturn;\n\t\t}\n\t\tif (!tokens) {\n\t\t\tthis._model.tokenization.setSemanticTokens(null, true);\n\t\t\trescheduleIfNeeded();\n\t\t\treturn;\n\t\t}\n\n\t\tif (isSemanticTokensEdits(tokens)) {\n\t\t\tif (!currentResponse) {\n\t\t\t\t// not possible!\n\t\t\t\tthis._model.tokenization.setSemanticTokens(null, true);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tif (tokens.edits.length === 0) {\n\t\t\t\t// nothing to do!\n\t\t\t\ttokens = {\n\t\t\t\t\tresultId: tokens.resultId,\n\t\t\t\t\tdata: currentResponse.data,\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\tlet deltaLength = 0;\n\t\t\t\tfor (const edit of tokens.edits) {\n\t\t\t\t\tdeltaLength +=\n\t\t\t\t\t\t(edit.data ? edit.data.length : 0) - edit.deleteCount;\n\t\t\t\t}\n\n\t\t\t\tconst srcData = currentResponse.data;\n\t\t\t\tconst destData = new Uint32Array(srcData.length + deltaLength);\n\n\t\t\t\tlet srcLastStart = srcData.length;\n\t\t\t\tlet destLastStart = destData.length;\n\t\t\t\tfor (let i = tokens.edits.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst edit = tokens.edits[i];\n\n\t\t\t\t\tif (edit.start > srcData.length) {\n\t\t\t\t\t\tstyling.warnInvalidEditStart(\n\t\t\t\t\t\t\tcurrentResponse.resultId,\n\t\t\t\t\t\t\ttokens.resultId,\n\t\t\t\t\t\t\ti,\n\t\t\t\t\t\t\tedit.start,\n\t\t\t\t\t\t\tsrcData.length,\n\t\t\t\t\t\t);\n\t\t\t\t\t\t// The edits are invalid and there's no way to recover\n\t\t\t\t\t\tthis._model.tokenization.setSemanticTokens(null, true);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst copyCount =\n\t\t\t\t\t\tsrcLastStart - (edit.start + edit.deleteCount);\n\t\t\t\t\tif (copyCount > 0) {\n\t\t\t\t\t\tModelSemanticColoring._copy(\n\t\t\t\t\t\t\tsrcData,\n\t\t\t\t\t\t\tsrcLastStart - copyCount,\n\t\t\t\t\t\t\tdestData,\n\t\t\t\t\t\t\tdestLastStart - copyCount,\n\t\t\t\t\t\t\tcopyCount,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdestLastStart -= copyCount;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (edit.data) {\n\t\t\t\t\t\tModelSemanticColoring._copy(\n\t\t\t\t\t\t\tedit.data,\n\t\t\t\t\t\t\t0,\n\t\t\t\t\t\t\tdestData,\n\t\t\t\t\t\t\tdestLastStart - edit.data.length,\n\t\t\t\t\t\t\tedit.data.length,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdestLastStart -= edit.data.length;\n\t\t\t\t\t}\n\n\t\t\t\t\tsrcLastStart = edit.start;\n\t\t\t\t}\n\n\t\t\t\tif (srcLastStart > 0) {\n\t\t\t\t\tModelSemanticColoring._copy(\n\t\t\t\t\t\tsrcData,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tdestData,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tsrcLastStart,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\ttokens = {\n\t\t\t\t\tresultId: tokens.resultId,\n\t\t\t\t\tdata: destData,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\tif (isSemanticTokens(tokens)) {\n\t\t\tthis._currentDocumentResponse = new SemanticTokensResponse(\n\t\t\t\tprovider,\n\t\t\t\ttokens.resultId,\n\t\t\t\ttokens.data,\n\t\t\t);\n\n\t\t\tconst result = toMultilineTokens2(\n\t\t\t\ttokens,\n\t\t\t\tstyling,\n\t\t\t\tthis._model.getLanguageId(),\n\t\t\t);\n\n\t\t\t// Adjust incoming semantic tokens\n\t\t\tif (pendingChanges.length > 0) {\n\t\t\t\t// More changes occurred while the request was running\n\t\t\t\t// We need to:\n\t\t\t\t// 1. Adjust incoming semantic tokens\n\t\t\t\t// 2. Request them again\n\t\t\t\tfor (const change of pendingChanges) {\n\t\t\t\t\tfor (const area of result) {\n\t\t\t\t\t\tfor (const singleChange of change.changes) {\n\t\t\t\t\t\t\tarea.applyEdit(\n\t\t\t\t\t\t\t\tsingleChange.range,\n\t\t\t\t\t\t\t\tsingleChange.text,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._model.tokenization.setSemanticTokens(result, true);\n\t\t} else {\n\t\t\tthis._model.tokenization.setSemanticTokens(null, true);\n\t\t}\n\n\t\trescheduleIfNeeded();\n\t}\n}\n\nclass SemanticTokensResponse {\n\tconstructor(\n\t\tpublic readonly provider: DocumentSemanticTokensProvider,\n\t\tpublic readonly resultId: string | undefined,\n\t\tpublic readonly data: Uint32Array,\n\t) {}\n\n\tpublic dispose(): void {\n\t\tthis.provider.releaseDocumentSemanticTokens(this.resultId);\n\t}\n}\n\nregisterEditorFeature(DocumentSemanticTokensFeature);\n"],
  "mappings": "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",
  "names": []
}
