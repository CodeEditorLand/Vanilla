{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/inlineProgress/browser/inlineProgress.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { disposableTimeout } from '../../../../base/common/async.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport { noBreakWhitespace } from '../../../../base/common/strings.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport './inlineProgressWidget.css';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from '../../../browser/editorBrowser.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport { IPosition } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { IEditorDecorationsCollection } from '../../../common/editorCommon.js';\nimport { TrackedRangeStickiness } from '../../../common/model.js';\nimport { ModelDecorationOptions } from '../../../common/model/textModel.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\n\nconst inlineProgressDecoration = ModelDecorationOptions.register({\n\tdescription: 'inline-progress-widget',\n\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\tshowIfCollapsed: true,\n\tafter: {\n\t\tcontent: noBreakWhitespace,\n\t\tinlineClassName: 'inline-editor-progress-decoration',\n\t\tinlineClassNameAffectsLetterSpacing: true,\n\t}\n});\n\n\nclass InlineProgressWidget extends Disposable implements IContentWidget {\n\tprivate static readonly baseId = 'editor.widget.inlineProgressWidget';\n\n\tallowEditorOverflow = false;\n\tsuppressMouseDown = true;\n\n\tprivate domNode!: HTMLElement;\n\n\tconstructor(\n\t\tprivate readonly typeId: string,\n\t\tprivate readonly editor: ICodeEditor,\n\t\tprivate readonly range: Range,\n\t\ttitle: string,\n\t\tprivate readonly delegate: InlineProgressDelegate,\n\t) {\n\t\tsuper();\n\n\t\tthis.create(title);\n\n\t\tthis.editor.addContentWidget(this);\n\t\tthis.editor.layoutContentWidget(this);\n\t}\n\n\tprivate create(title: string): void {\n\t\tthis.domNode = dom.$('.inline-progress-widget');\n\t\tthis.domNode.role = 'button';\n\t\tthis.domNode.title = title;\n\n\t\tconst iconElement = dom.$('span.icon');\n\t\tthis.domNode.append(iconElement);\n\n\t\ticonElement.classList.add(...ThemeIcon.asClassNameArray(Codicon.loading), 'codicon-modifier-spin');\n\n\t\tconst updateSize = () => {\n\t\t\tconst lineHeight = this.editor.getOption(EditorOption.lineHeight);\n\t\t\tthis.domNode.style.height = `${lineHeight}px`;\n\t\t\tthis.domNode.style.width = `${Math.ceil(0.8 * lineHeight)}px`;\n\t\t};\n\t\tupdateSize();\n\n\t\tthis._register(this.editor.onDidChangeConfiguration(c => {\n\t\t\tif (c.hasChanged(EditorOption.fontSize) || c.hasChanged(EditorOption.lineHeight)) {\n\t\t\t\tupdateSize();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(dom.addDisposableListener(this.domNode, dom.EventType.CLICK, e => {\n\t\t\tthis.delegate.cancel();\n\t\t}));\n\t}\n\n\tgetId(): string {\n\t\treturn InlineProgressWidget.baseId + '.' + this.typeId;\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this.domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition | null {\n\t\treturn {\n\t\t\tposition: { lineNumber: this.range.startLineNumber, column: this.range.startColumn },\n\t\t\tpreference: [ContentWidgetPositionPreference.EXACT]\n\t\t};\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis.editor.removeContentWidget(this);\n\t}\n}\n\ninterface InlineProgressDelegate {\n\tcancel(): void;\n}\n\nexport class InlineProgressManager extends Disposable {\n\n\t/** Delay before showing the progress widget */\n\tprivate readonly _showDelay = 500; // ms\n\tprivate readonly _showPromise = this._register(new MutableDisposable());\n\n\tprivate readonly _currentDecorations: IEditorDecorationsCollection;\n\tprivate readonly _currentWidget = this._register(new MutableDisposable<InlineProgressWidget>());\n\n\tprivate _operationIdPool = 0;\n\tprivate _currentOperation?: number;\n\n\tconstructor(\n\t\tprivate readonly id: string,\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._currentDecorations = _editor.createDecorationsCollection();\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._currentDecorations.clear();\n\t}\n\n\tpublic async showWhile<R>(position: IPosition, title: string, promise: Promise<R>, delegate: InlineProgressDelegate, delayOverride?: number): Promise<R> {\n\t\tconst operationId = this._operationIdPool++;\n\t\tthis._currentOperation = operationId;\n\n\t\tthis.clear();\n\n\t\tthis._showPromise.value = disposableTimeout(() => {\n\t\t\tconst range = Range.fromPositions(position);\n\t\t\tconst decorationIds = this._currentDecorations.set([{\n\t\t\t\trange: range,\n\t\t\t\toptions: inlineProgressDecoration,\n\t\t\t}]);\n\n\t\t\tif (decorationIds.length > 0) {\n\t\t\t\tthis._currentWidget.value = this._instantiationService.createInstance(InlineProgressWidget, this.id, this._editor, range, title, delegate);\n\t\t\t}\n\t\t}, delayOverride ?? this._showDelay);\n\n\t\ttry {\n\t\t\treturn await promise;\n\t\t} finally {\n\t\t\tif (this._currentOperation === operationId) {\n\t\t\t\tthis.clear();\n\t\t\t\tthis._currentOperation = undefined;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate clear() {\n\t\tthis._showPromise.clear();\n\t\tthis._currentDecorations.clear();\n\t\tthis._currentWidget.clear();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
