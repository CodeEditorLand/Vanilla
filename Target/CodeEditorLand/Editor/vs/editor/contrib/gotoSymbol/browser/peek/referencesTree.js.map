{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/gotoSymbol/browser/peek/referencesTree.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { IKeyboardEvent } from '../../../../../base/browser/keyboardEvent.js';\nimport { CountBadge } from '../../../../../base/browser/ui/countBadge/countBadge.js';\nimport { HighlightedLabel } from '../../../../../base/browser/ui/highlightedlabel/highlightedLabel.js';\nimport { IconLabel } from '../../../../../base/browser/ui/iconLabel/iconLabel.js';\nimport { IIdentityProvider, IKeyboardNavigationLabelProvider, IListVirtualDelegate } from '../../../../../base/browser/ui/list/list.js';\nimport { IListAccessibilityProvider } from '../../../../../base/browser/ui/list/listWidget.js';\nimport { IAsyncDataSource, ITreeNode, ITreeRenderer } from '../../../../../base/browser/ui/tree/tree.js';\nimport { createMatches, FuzzyScore, IMatch } from '../../../../../base/common/filters.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { basename, dirname } from '../../../../../base/common/resources.js';\nimport { ITextModelService } from '../../../../common/services/resolverService.js';\nimport { localize } from '../../../../../nls.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { ILabelService } from '../../../../../platform/label/common/label.js';\nimport { defaultCountBadgeStyles } from '../../../../../platform/theme/browser/defaultStyles.js';\nimport { FileReferences, OneReference, ReferencesModel } from '../referencesModel.js';\n\n//#region data source\n\nexport type TreeElement = FileReferences | OneReference;\n\nexport class DataSource implements IAsyncDataSource<ReferencesModel | FileReferences, TreeElement> {\n\n\tconstructor(@ITextModelService private readonly _resolverService: ITextModelService) { }\n\n\thasChildren(element: ReferencesModel | FileReferences | TreeElement): boolean {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn true;\n\t\t}\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetChildren(element: ReferencesModel | FileReferences | TreeElement): TreeElement[] | Promise<TreeElement[]> {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn element.groups;\n\t\t}\n\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn element.resolve(this._resolverService).then(val => {\n\t\t\t\t// if (element.failure) {\n\t\t\t\t// \t// refresh the element on failure so that\n\t\t\t\t// \t// we can update its rendering\n\t\t\t\t// \treturn tree.refresh(element).then(() => val.children);\n\t\t\t\t// }\n\t\t\t\treturn val.children;\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error('bad tree');\n\t}\n}\n\n//#endregion\n\nexport class Delegate implements IListVirtualDelegate<TreeElement> {\n\tgetHeight(): number {\n\t\treturn 23;\n\t}\n\tgetTemplateId(element: FileReferences | OneReference): string {\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn FileReferencesRenderer.id;\n\t\t} else {\n\t\t\treturn OneReferenceRenderer.id;\n\t\t}\n\t}\n}\n\nexport class StringRepresentationProvider implements IKeyboardNavigationLabelProvider<TreeElement> {\n\n\tconstructor(@IKeybindingService private readonly _keybindingService: IKeybindingService) { }\n\n\tgetKeyboardNavigationLabel(element: TreeElement): { toString(): string } {\n\t\tif (element instanceof OneReference) {\n\t\t\tconst parts = element.parent.getPreview(element)?.preview(element.range);\n\t\t\tif (parts) {\n\t\t\t\treturn parts.value;\n\t\t\t}\n\t\t}\n\t\t// FileReferences or unresolved OneReference\n\t\treturn basename(element.uri);\n\t}\n\n\tmightProducePrintableCharacter(event: IKeyboardEvent): boolean {\n\t\treturn this._keybindingService.mightProducePrintableCharacter(event);\n\t}\n}\n\nexport class IdentityProvider implements IIdentityProvider<TreeElement> {\n\n\tgetId(element: TreeElement): { toString(): string } {\n\t\treturn element instanceof OneReference ? element.id : element.uri;\n\t}\n}\n\n//#region render: File\n\nclass FileReferencesTemplate extends Disposable {\n\n\treadonly file: IconLabel;\n\treadonly badge: CountBadge;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\t@ILabelService private readonly _labelService: ILabelService\n\t) {\n\t\tsuper();\n\t\tconst parent = document.createElement('div');\n\t\tparent.classList.add('reference-file');\n\t\tthis.file = this._register(new IconLabel(parent, { supportHighlights: true }));\n\n\t\tthis.badge = new CountBadge(dom.append(parent, dom.$('.count')), {}, defaultCountBadgeStyles);\n\n\t\tcontainer.appendChild(parent);\n\t}\n\n\tset(element: FileReferences, matches: IMatch[]) {\n\t\tconst parent = dirname(element.uri);\n\t\tthis.file.setLabel(\n\t\t\tthis._labelService.getUriBasenameLabel(element.uri),\n\t\t\tthis._labelService.getUriLabel(parent, { relative: true }),\n\t\t\t{ title: this._labelService.getUriLabel(element.uri), matches }\n\t\t);\n\t\tconst len = element.children.length;\n\t\tthis.badge.setCount(len);\n\t\tif (len > 1) {\n\t\t\tthis.badge.setTitleFormat(localize('referencesCount', \"{0} references\", len));\n\t\t} else {\n\t\t\tthis.badge.setTitleFormat(localize('referenceCount', \"{0} reference\", len));\n\t\t}\n\t}\n}\n\nexport class FileReferencesRenderer implements ITreeRenderer<FileReferences, FuzzyScore, FileReferencesTemplate> {\n\n\tstatic readonly id = 'FileReferencesRenderer';\n\n\treadonly templateId: string = FileReferencesRenderer.id;\n\n\tconstructor(@IInstantiationService private readonly _instantiationService: IInstantiationService) { }\n\n\trenderTemplate(container: HTMLElement): FileReferencesTemplate {\n\t\treturn this._instantiationService.createInstance(FileReferencesTemplate, container);\n\t}\n\trenderElement(node: ITreeNode<FileReferences, FuzzyScore>, index: number, template: FileReferencesTemplate): void {\n\t\ttemplate.set(node.element, createMatches(node.filterData));\n\t}\n\tdisposeTemplate(templateData: FileReferencesTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\n//#region render: Reference\nclass OneReferenceTemplate extends Disposable {\n\n\treadonly label: HighlightedLabel;\n\n\tconstructor(container: HTMLElement) {\n\t\tsuper();\n\n\t\tthis.label = this._register(new HighlightedLabel(container));\n\t}\n\n\tset(element: OneReference, score?: FuzzyScore): void {\n\t\tconst preview = element.parent.getPreview(element)?.preview(element.range);\n\t\tif (!preview || !preview.value) {\n\t\t\t// this means we FAILED to resolve the document or the value is the empty string\n\t\t\tthis.label.set(`${basename(element.uri)}:${element.range.startLineNumber + 1}:${element.range.startColumn + 1}`);\n\t\t} else {\n\t\t\t// render search match as highlight unless\n\t\t\t// we have score, then render the score\n\t\t\tconst { value, highlight } = preview;\n\t\t\tif (score && !FuzzyScore.isDefault(score)) {\n\t\t\t\tthis.label.element.classList.toggle('referenceMatch', false);\n\t\t\t\tthis.label.set(value, createMatches(score));\n\t\t\t} else {\n\t\t\t\tthis.label.element.classList.toggle('referenceMatch', true);\n\t\t\t\tthis.label.set(value, [highlight]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class OneReferenceRenderer implements ITreeRenderer<OneReference, FuzzyScore, OneReferenceTemplate> {\n\n\tstatic readonly id = 'OneReferenceRenderer';\n\n\treadonly templateId: string = OneReferenceRenderer.id;\n\n\trenderTemplate(container: HTMLElement): OneReferenceTemplate {\n\t\treturn new OneReferenceTemplate(container);\n\t}\n\trenderElement(node: ITreeNode<OneReference, FuzzyScore>, index: number, templateData: OneReferenceTemplate): void {\n\t\ttemplateData.set(node.element, node.filterData);\n\t}\n\tdisposeTemplate(templateData: OneReferenceTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\n\nexport class AccessibilityProvider implements IListAccessibilityProvider<FileReferences | OneReference> {\n\n\tgetWidgetAriaLabel(): string {\n\t\treturn localize('treeAriaLabel', \"References\");\n\t}\n\n\tgetAriaLabel(element: FileReferences | OneReference): string | null {\n\t\treturn element.ariaMessage;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
