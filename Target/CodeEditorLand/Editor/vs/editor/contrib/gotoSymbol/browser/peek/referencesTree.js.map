{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/gotoSymbol/browser/peek/referencesTree.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport type { IKeyboardEvent } from \"../../../../../base/browser/keyboardEvent.js\";\nimport { CountBadge } from \"../../../../../base/browser/ui/countBadge/countBadge.js\";\nimport { HighlightedLabel } from \"../../../../../base/browser/ui/highlightedlabel/highlightedLabel.js\";\nimport { IconLabel } from \"../../../../../base/browser/ui/iconLabel/iconLabel.js\";\nimport type {\n\tIIdentityProvider,\n\tIKeyboardNavigationLabelProvider,\n\tIListVirtualDelegate,\n} from \"../../../../../base/browser/ui/list/list.js\";\nimport type { IListAccessibilityProvider } from \"../../../../../base/browser/ui/list/listWidget.js\";\nimport type {\n\tIAsyncDataSource,\n\tITreeNode,\n\tITreeRenderer,\n} from \"../../../../../base/browser/ui/tree/tree.js\";\nimport {\n\tFuzzyScore,\n\ttype IMatch,\n\tcreateMatches,\n} from \"../../../../../base/common/filters.js\";\nimport { Disposable } from \"../../../../../base/common/lifecycle.js\";\nimport { basename, dirname } from \"../../../../../base/common/resources.js\";\nimport { localize } from \"../../../../../nls.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { IKeybindingService } from \"../../../../../platform/keybinding/common/keybinding.js\";\nimport { ILabelService } from \"../../../../../platform/label/common/label.js\";\nimport { defaultCountBadgeStyles } from \"../../../../../platform/theme/browser/defaultStyles.js\";\nimport { ITextModelService } from \"../../../../common/services/resolverService.js\";\nimport {\n\tFileReferences,\n\tOneReference,\n\tReferencesModel,\n} from \"../referencesModel.js\";\n\n//#region data source\n\nexport type TreeElement = FileReferences | OneReference;\n\nexport class DataSource\n\timplements IAsyncDataSource<ReferencesModel | FileReferences, TreeElement>\n{\n\tconstructor(@ITextModelService private readonly _resolverService: ITextModelService) { }\n\n\thasChildren(\n\t\telement: ReferencesModel | FileReferences | TreeElement,\n\t): boolean {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn true;\n\t\t}\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tgetChildren(\n\t\telement: ReferencesModel | FileReferences | TreeElement,\n\t): TreeElement[] | Promise<TreeElement[]> {\n\t\tif (element instanceof ReferencesModel) {\n\t\t\treturn element.groups;\n\t\t}\n\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn element.resolve(this._resolverService).then((val) => {\n\t\t\t\t// if (element.failure) {\n\t\t\t\t// \t// refresh the element on failure so that\n\t\t\t\t// \t// we can update its rendering\n\t\t\t\t// \treturn tree.refresh(element).then(() => val.children);\n\t\t\t\t// }\n\t\t\t\treturn val.children;\n\t\t\t});\n\t\t}\n\n\t\tthrow new Error(\"bad tree\");\n\t}\n}\n\n//#endregion\n\nexport class Delegate implements IListVirtualDelegate<TreeElement> {\n\tgetHeight(): number {\n\t\treturn 23;\n\t}\n\tgetTemplateId(element: FileReferences | OneReference): string {\n\t\tif (element instanceof FileReferences) {\n\t\t\treturn FileReferencesRenderer.id;\n\t\t} else {\n\t\t\treturn OneReferenceRenderer.id;\n\t\t}\n\t}\n}\n\nexport class StringRepresentationProvider\n\timplements IKeyboardNavigationLabelProvider<TreeElement>\n{\n\tconstructor(@IKeybindingService private readonly _keybindingService: IKeybindingService) { }\n\n\tgetKeyboardNavigationLabel(element: TreeElement): { toString(): string } {\n\t\tif (element instanceof OneReference) {\n\t\t\tconst parts = element.parent\n\t\t\t\t.getPreview(element)\n\t\t\t\t?.preview(element.range);\n\t\t\tif (parts) {\n\t\t\t\treturn parts.value;\n\t\t\t}\n\t\t}\n\t\t// FileReferences or unresolved OneReference\n\t\treturn basename(element.uri);\n\t}\n\n\tmightProducePrintableCharacter(event: IKeyboardEvent): boolean {\n\t\treturn this._keybindingService.mightProducePrintableCharacter(event);\n\t}\n}\n\nexport class IdentityProvider implements IIdentityProvider<TreeElement> {\n\tgetId(element: TreeElement): { toString(): string } {\n\t\treturn element instanceof OneReference ? element.id : element.uri;\n\t}\n}\n\n//#region render: File\n\nclass FileReferencesTemplate extends Disposable {\n\treadonly file: IconLabel;\n\treadonly badge: CountBadge;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\t@ILabelService private readonly _labelService: ILabelService,\n\t) {\n\t\tsuper();\n\t\tconst parent = document.createElement(\"div\");\n\t\tparent.classList.add(\"reference-file\");\n\t\tthis.file = this._register(\n\t\t\tnew IconLabel(parent, { supportHighlights: true }),\n\t\t);\n\n\t\tthis.badge = new CountBadge(\n\t\t\tdom.append(parent, dom.$(\".count\")),\n\t\t\t{},\n\t\t\tdefaultCountBadgeStyles,\n\t\t);\n\n\t\tcontainer.appendChild(parent);\n\t}\n\n\tset(element: FileReferences, matches: IMatch[]) {\n\t\tconst parent = dirname(element.uri);\n\t\tthis.file.setLabel(\n\t\t\tthis._labelService.getUriBasenameLabel(element.uri),\n\t\t\tthis._labelService.getUriLabel(parent, { relative: true }),\n\t\t\t{ title: this._labelService.getUriLabel(element.uri), matches },\n\t\t);\n\t\tconst len = element.children.length;\n\t\tthis.badge.setCount(len);\n\t\tif (len > 1) {\n\t\t\tthis.badge.setTitleFormat(\n\t\t\t\tlocalize(\"referencesCount\", \"{0} references\", len),\n\t\t\t);\n\t\t} else {\n\t\t\tthis.badge.setTitleFormat(\n\t\t\t\tlocalize(\"referenceCount\", \"{0} reference\", len),\n\t\t\t);\n\t\t}\n\t}\n}\n\nexport class FileReferencesRenderer\n\timplements ITreeRenderer<FileReferences, FuzzyScore, FileReferencesTemplate>\n{\n\tstatic readonly id = \"FileReferencesRenderer\";\n\n\treadonly templateId: string = FileReferencesRenderer.id;\n\n\tconstructor(\n\t\t@IInstantiationService\n\t\tprivate readonly _instantiationService: IInstantiationService,\n\t) {}\n\n\trenderTemplate(container: HTMLElement): FileReferencesTemplate {\n\t\treturn this._instantiationService.createInstance(\n\t\t\tFileReferencesTemplate,\n\t\t\tcontainer,\n\t\t);\n\t}\n\trenderElement(\n\t\tnode: ITreeNode<FileReferences, FuzzyScore>,\n\t\tindex: number,\n\t\ttemplate: FileReferencesTemplate,\n\t): void {\n\t\ttemplate.set(node.element, createMatches(node.filterData));\n\t}\n\tdisposeTemplate(templateData: FileReferencesTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\n//#region render: Reference\nclass OneReferenceTemplate extends Disposable {\n\treadonly label: HighlightedLabel;\n\n\tconstructor(container: HTMLElement) {\n\t\tsuper();\n\n\t\tthis.label = this._register(new HighlightedLabel(container));\n\t}\n\n\tset(element: OneReference, score?: FuzzyScore): void {\n\t\tconst preview = element.parent\n\t\t\t.getPreview(element)\n\t\t\t?.preview(element.range);\n\t\tif (!preview || !preview.value) {\n\t\t\t// this means we FAILED to resolve the document or the value is the empty string\n\t\t\tthis.label.set(\n\t\t\t\t`${basename(element.uri)}:${element.range.startLineNumber + 1}:${element.range.startColumn + 1}`,\n\t\t\t);\n\t\t} else {\n\t\t\t// render search match as highlight unless\n\t\t\t// we have score, then render the score\n\t\t\tconst { value, highlight } = preview;\n\t\t\tif (score && !FuzzyScore.isDefault(score)) {\n\t\t\t\tthis.label.element.classList.toggle(\"referenceMatch\", false);\n\t\t\t\tthis.label.set(value, createMatches(score));\n\t\t\t} else {\n\t\t\t\tthis.label.element.classList.toggle(\"referenceMatch\", true);\n\t\t\t\tthis.label.set(value, [highlight]);\n\t\t\t}\n\t\t}\n\t}\n}\n\nexport class OneReferenceRenderer\n\timplements ITreeRenderer<OneReference, FuzzyScore, OneReferenceTemplate>\n{\n\tstatic readonly id = \"OneReferenceRenderer\";\n\n\treadonly templateId: string = OneReferenceRenderer.id;\n\n\trenderTemplate(container: HTMLElement): OneReferenceTemplate {\n\t\treturn new OneReferenceTemplate(container);\n\t}\n\trenderElement(\n\t\tnode: ITreeNode<OneReference, FuzzyScore>,\n\t\tindex: number,\n\t\ttemplateData: OneReferenceTemplate,\n\t): void {\n\t\ttemplateData.set(node.element, node.filterData);\n\t}\n\tdisposeTemplate(templateData: OneReferenceTemplate): void {\n\t\ttemplateData.dispose();\n\t}\n}\n\n//#endregion\n\nexport class AccessibilityProvider\n\timplements IListAccessibilityProvider<FileReferences | OneReference>\n{\n\tgetWidgetAriaLabel(): string {\n\t\treturn localize(\"treeAriaLabel\", \"References\");\n\t}\n\n\tgetAriaLabel(element: FileReferences | OneReference): string | null {\n\t\treturn element.ariaMessage;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
