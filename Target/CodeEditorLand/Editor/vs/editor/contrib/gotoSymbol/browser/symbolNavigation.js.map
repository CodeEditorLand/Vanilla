{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/gotoSymbol/browser/symbolNavigation.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, type Event } from \"../../../../base/common/event.js\";\nimport { KeyCode } from \"../../../../base/common/keyCodes.js\";\nimport {\n\tDisposableStore,\n\ttype IDisposable,\n\tcombinedDisposable,\n\tdispose,\n} from \"../../../../base/common/lifecycle.js\";\nimport { isEqual } from \"../../../../base/common/resources.js\";\nimport { localize } from \"../../../../nls.js\";\nimport {\n\ttype IContextKey,\n\tIContextKeyService,\n\tRawContextKey,\n} from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { TextEditorSelectionRevealType } from \"../../../../platform/editor/common/editor.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport {\n\ttype ServicesAccessor,\n\tcreateDecorator,\n} from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { IKeybindingService } from \"../../../../platform/keybinding/common/keybinding.js\";\nimport {\n\tKeybindingWeight,\n\tKeybindingsRegistry,\n} from \"../../../../platform/keybinding/common/keybindingsRegistry.js\";\nimport { INotificationService } from \"../../../../platform/notification/common/notification.js\";\nimport type { ICodeEditor } from \"../../../browser/editorBrowser.js\";\nimport {\n\tEditorCommand,\n\tregisterEditorCommand,\n} from \"../../../browser/editorExtensions.js\";\nimport { ICodeEditorService } from \"../../../browser/services/codeEditorService.js\";\nimport { Range } from \"../../../common/core/range.js\";\nimport type { OneReference, ReferencesModel } from \"./referencesModel.js\";\n\nexport const ctxHasSymbols = new RawContextKey(\n\t\"hasSymbols\",\n\tfalse,\n\tlocalize(\n\t\t\"hasSymbols\",\n\t\t\"Whether there are symbol locations that can be navigated via keyboard-only.\",\n\t),\n);\n\nexport const ISymbolNavigationService =\n\tcreateDecorator<ISymbolNavigationService>(\"ISymbolNavigationService\");\n\nexport interface ISymbolNavigationService {\n\treadonly _serviceBrand: undefined;\n\treset(): void;\n\tput(anchor: OneReference): void;\n\trevealNext(source: ICodeEditor): Promise<any>;\n}\n\nclass SymbolNavigationService implements ISymbolNavigationService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _ctxHasSymbols: IContextKey<boolean>;\n\n\tprivate _currentModel?: ReferencesModel = undefined;\n\tprivate _currentIdx = -1;\n\tprivate _currentState?: IDisposable;\n\tprivate _currentMessage?: IDisposable;\n\tprivate _ignoreEditorChange = false;\n\n\tconstructor(\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@ICodeEditorService private readonly _editorService: ICodeEditorService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t) {\n\t\tthis._ctxHasSymbols = ctxHasSymbols.bindTo(contextKeyService);\n\t}\n\n\treset(): void {\n\t\tthis._ctxHasSymbols.reset();\n\t\tthis._currentState?.dispose();\n\t\tthis._currentMessage?.dispose();\n\t\tthis._currentModel = undefined;\n\t\tthis._currentIdx = -1;\n\t}\n\n\tput(anchor: OneReference): void {\n\t\tconst refModel = anchor.parent.parent;\n\n\t\tif (refModel.references.length <= 1) {\n\t\t\tthis.reset();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._currentModel = refModel;\n\t\tthis._currentIdx = refModel.references.indexOf(anchor);\n\t\tthis._ctxHasSymbols.set(true);\n\t\tthis._showMessage();\n\n\t\tconst editorState = new EditorState(this._editorService);\n\t\tconst listener = editorState.onDidChange((_) => {\n\t\t\tif (this._ignoreEditorChange) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst editor = this._editorService.getActiveCodeEditor();\n\t\t\tif (!editor) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst model = editor.getModel();\n\t\t\tconst position = editor.getPosition();\n\t\t\tif (!model || !position) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet seenUri = false;\n\t\t\tlet seenPosition = false;\n\t\t\tfor (const reference of refModel.references) {\n\t\t\t\tif (isEqual(reference.uri, model.uri)) {\n\t\t\t\t\tseenUri = true;\n\t\t\t\t\tseenPosition =\n\t\t\t\t\t\tseenPosition ||\n\t\t\t\t\t\tRange.containsPosition(reference.range, position);\n\t\t\t\t} else if (seenUri) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (!seenUri || !seenPosition) {\n\t\t\t\tthis.reset();\n\t\t\t}\n\t\t});\n\n\t\tthis._currentState = combinedDisposable(editorState, listener);\n\t}\n\n\trevealNext(source: ICodeEditor): Promise<any> {\n\t\tif (!this._currentModel) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\t// get next result and advance\n\t\tthis._currentIdx += 1;\n\t\tthis._currentIdx %= this._currentModel.references.length;\n\t\tconst reference = this._currentModel.references[this._currentIdx];\n\n\t\t// status\n\t\tthis._showMessage();\n\n\t\t// open editor, ignore events while that happens\n\t\tthis._ignoreEditorChange = true;\n\t\treturn this._editorService\n\t\t\t.openCodeEditor(\n\t\t\t\t{\n\t\t\t\t\tresource: reference.uri,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tselection: Range.collapseToStart(reference.range),\n\t\t\t\t\t\tselectionRevealType:\n\t\t\t\t\t\t\tTextEditorSelectionRevealType.NearTopIfOutsideViewport,\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsource,\n\t\t\t)\n\t\t\t.finally(() => {\n\t\t\t\tthis._ignoreEditorChange = false;\n\t\t\t});\n\t}\n\n\tprivate _showMessage(): void {\n\t\tthis._currentMessage?.dispose();\n\n\t\tconst kb = this._keybindingService.lookupKeybinding(\n\t\t\t\"editor.gotoNextSymbolFromResult\",\n\t\t);\n\t\tconst message = kb\n\t\t\t? localize(\n\t\t\t\t\t\"location.kb\",\n\t\t\t\t\t\"Symbol {0} of {1}, {2} for next\",\n\t\t\t\t\tthis._currentIdx + 1,\n\t\t\t\t\tthis._currentModel!.references.length,\n\t\t\t\t\tkb.getLabel(),\n\t\t\t\t)\n\t\t\t: localize(\n\t\t\t\t\t\"location\",\n\t\t\t\t\t\"Symbol {0} of {1}\",\n\t\t\t\t\tthis._currentIdx + 1,\n\t\t\t\t\tthis._currentModel!.references.length,\n\t\t\t\t);\n\n\t\tthis._currentMessage = this._notificationService.status(message);\n\t}\n}\n\nregisterSingleton(\n\tISymbolNavigationService,\n\tSymbolNavigationService,\n\tInstantiationType.Delayed,\n);\n\nregisterEditorCommand(\n\tnew (class extends EditorCommand {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: \"editor.gotoNextSymbolFromResult\",\n\t\t\t\tprecondition: ctxHasSymbols,\n\t\t\t\tkbOpts: {\n\t\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\t\tprimary: KeyCode.F12,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\trunEditorCommand(\n\t\t\taccessor: ServicesAccessor,\n\t\t\teditor: ICodeEditor,\n\t\t): void | Promise<void> {\n\t\t\treturn accessor.get(ISymbolNavigationService).revealNext(editor);\n\t\t}\n\t})(),\n);\n\nKeybindingsRegistry.registerCommandAndKeybindingRule({\n\tid: \"editor.gotoNextSymbolFromResult.cancel\",\n\tweight: KeybindingWeight.EditorContrib,\n\twhen: ctxHasSymbols,\n\tprimary: KeyCode.Escape,\n\thandler(accessor) {\n\t\taccessor.get(ISymbolNavigationService).reset();\n\t},\n});\n\n//\n\nclass EditorState {\n\tprivate readonly _listener = new Map<ICodeEditor, IDisposable>();\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _onDidChange = new Emitter<{ editor: ICodeEditor }>();\n\treadonly onDidChange: Event<{ editor: ICodeEditor }> =\n\t\tthis._onDidChange.event;\n\n\tconstructor(@ICodeEditorService editorService: ICodeEditorService) {\n\t\tthis._disposables.add(editorService.onCodeEditorRemove(this._onDidRemoveEditor, this));\n\t\tthis._disposables.add(editorService.onCodeEditorAdd(this._onDidAddEditor, this));\n\t\teditorService.listCodeEditors().forEach(this._onDidAddEditor, this);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._onDidChange.dispose();\n\t\tdispose(this._listener.values());\n\t}\n\n\tprivate _onDidAddEditor(editor: ICodeEditor): void {\n\t\tthis._listener.set(\n\t\t\teditor,\n\t\t\tcombinedDisposable(\n\t\t\t\teditor.onDidChangeCursorPosition((_) =>\n\t\t\t\t\tthis._onDidChange.fire({ editor }),\n\t\t\t\t),\n\t\t\t\teditor.onDidChangeModelContent((_) =>\n\t\t\t\t\tthis._onDidChange.fire({ editor }),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _onDidRemoveEditor(editor: ICodeEditor): void {\n\t\tthis._listener.get(editor)?.dispose();\n\t\tthis._listener.delete(editor);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
