{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/gotoSymbol/browser/goToSymbol.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { matchesSomeScheme, Schemas } from '../../../../base/common/network.js';\nimport { registerModelAndPositionCommand } from '../../../browser/editorExtensions.js';\nimport { Position } from '../../../common/core/position.js';\nimport { LanguageFeatureRegistry } from '../../../common/languageFeatureRegistry.js';\nimport { DeclarationProvider, DefinitionProvider, ImplementationProvider, LocationLink, ProviderResult, ReferenceProvider, TypeDefinitionProvider } from '../../../common/languages.js';\nimport { ITextModel } from '../../../common/model.js';\nimport { ILanguageFeaturesService } from '../../../common/services/languageFeatures.js';\nimport { ReferencesModel } from './referencesModel.js';\n\nfunction shouldIncludeLocationLink(sourceModel: ITextModel, loc: LocationLink): boolean {\n\t// Always allow the location if the request comes from a document with the same scheme.\n\tif (loc.uri.scheme === sourceModel.uri.scheme) {\n\t\treturn true;\n\t}\n\n\t// Otherwise filter out locations from internal schemes\n\tif (matchesSomeScheme(loc.uri, Schemas.walkThroughSnippet, Schemas.vscodeChatCodeBlock, Schemas.vscodeChatCodeCompareBlock)) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nasync function getLocationLinks<T>(\n\tmodel: ITextModel,\n\tposition: Position,\n\tregistry: LanguageFeatureRegistry<T>,\n\trecursive: boolean,\n\tprovide: (provider: T, model: ITextModel, position: Position) => ProviderResult<LocationLink | LocationLink[]>\n): Promise<LocationLink[]> {\n\tconst provider = registry.ordered(model, recursive);\n\n\t// get results\n\tconst promises = provider.map((provider): Promise<LocationLink | LocationLink[] | undefined> => {\n\t\treturn Promise.resolve(provide(provider, model, position)).then(undefined, err => {\n\t\t\tonUnexpectedExternalError(err);\n\t\t\treturn undefined;\n\t\t});\n\t});\n\n\tconst values = await Promise.all(promises);\n\treturn coalesce(values.flat()).filter(loc => shouldIncludeLocationLink(model, loc));\n}\n\nexport function getDefinitionsAtPosition(registry: LanguageFeatureRegistry<DefinitionProvider>, model: ITextModel, position: Position, recursive: boolean, token: CancellationToken): Promise<LocationLink[]> {\n\treturn getLocationLinks(model, position, registry, recursive, (provider, model, position) => {\n\t\treturn provider.provideDefinition(model, position, token);\n\t});\n}\n\nexport function getDeclarationsAtPosition(registry: LanguageFeatureRegistry<DeclarationProvider>, model: ITextModel, position: Position, recursive: boolean, token: CancellationToken): Promise<LocationLink[]> {\n\treturn getLocationLinks(model, position, registry, recursive, (provider, model, position) => {\n\t\treturn provider.provideDeclaration(model, position, token);\n\t});\n}\n\nexport function getImplementationsAtPosition(registry: LanguageFeatureRegistry<ImplementationProvider>, model: ITextModel, position: Position, recursive: boolean, token: CancellationToken): Promise<LocationLink[]> {\n\treturn getLocationLinks(model, position, registry, recursive, (provider, model, position) => {\n\t\treturn provider.provideImplementation(model, position, token);\n\t});\n}\n\nexport function getTypeDefinitionsAtPosition(registry: LanguageFeatureRegistry<TypeDefinitionProvider>, model: ITextModel, position: Position, recursive: boolean, token: CancellationToken): Promise<LocationLink[]> {\n\treturn getLocationLinks(model, position, registry, recursive, (provider, model, position) => {\n\t\treturn provider.provideTypeDefinition(model, position, token);\n\t});\n}\n\nexport function getReferencesAtPosition(registry: LanguageFeatureRegistry<ReferenceProvider>, model: ITextModel, position: Position, compact: boolean, recursive: boolean, token: CancellationToken): Promise<LocationLink[]> {\n\treturn getLocationLinks(model, position, registry, recursive, async (provider, model, position) => {\n\t\tconst result = (await provider.provideReferences(model, position, { includeDeclaration: true }, token))?.filter(ref => shouldIncludeLocationLink(model, ref));\n\t\tif (!compact || !result || result.length !== 2) {\n\t\t\treturn result;\n\t\t}\n\t\tconst resultWithoutDeclaration = (await provider.provideReferences(model, position, { includeDeclaration: false }, token))?.filter(ref => shouldIncludeLocationLink(model, ref));\n\t\tif (resultWithoutDeclaration && resultWithoutDeclaration.length === 1) {\n\t\t\treturn resultWithoutDeclaration;\n\t\t}\n\t\treturn result;\n\t});\n}\n\n// -- API commands ----\n\nasync function _sortedAndDeduped(callback: () => Promise<LocationLink[]>): Promise<LocationLink[]> {\n\tconst rawLinks = await callback();\n\tconst model = new ReferencesModel(rawLinks, '');\n\tconst modelLinks = model.references.map(ref => ref.link);\n\tmodel.dispose();\n\treturn modelLinks;\n}\n\nregisterModelAndPositionCommand('_executeDefinitionProvider', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, false, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeDefinitionProvider_recursive', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getDefinitionsAtPosition(languageFeaturesService.definitionProvider, model, position, true, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, false, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeTypeDefinitionProvider_recursive', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getTypeDefinitionsAtPosition(languageFeaturesService.typeDefinitionProvider, model, position, true, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeDeclarationProvider', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, false, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\nregisterModelAndPositionCommand('_executeDeclarationProvider_recursive', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getDeclarationsAtPosition(languageFeaturesService.declarationProvider, model, position, true, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeReferenceProvider', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, false, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeReferenceProvider_recursive', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getReferencesAtPosition(languageFeaturesService.referenceProvider, model, position, false, true, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeImplementationProvider', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, false, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n\nregisterModelAndPositionCommand('_executeImplementationProvider_recursive', (accessor, model, position) => {\n\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\tconst promise = getImplementationsAtPosition(languageFeaturesService.implementationProvider, model, position, true, CancellationToken.None);\n\treturn _sortedAndDeduped(() => promise);\n});\n"],
  "mappings": ";;AAKA,SAAS,gBAAgB;AACzB,SAAS,yBAAyB;AAClC,SAAS,iCAAiC;AAC1C,SAAS,mBAAmB,eAAe;AAC3C,SAAS,uCAAuC;AAChD,SAAS,gBAAgB;AACzB,SAAS,+BAA+B;AACxC,SAAS,qBAAqB,oBAAoB,wBAAwB,cAAc,gBAAgB,mBAAmB,8BAA8B;AACzJ,SAAS,kBAAkB;AAC3B,SAAS,gCAAgC;AACzC,SAAS,uBAAuB;AAEhC,SAAS,0BAA0B,aAAyB,KAA4B;AAEvF,MAAI,IAAI,IAAI,WAAW,YAAY,IAAI,QAAQ;AAC9C,WAAO;AAAA,EACR;AAGA,MAAI,kBAAkB,IAAI,KAAK,QAAQ,oBAAoB,QAAQ,qBAAqB,QAAQ,0BAA0B,GAAG;AAC5H,WAAO;AAAA,EACR;AAEA,SAAO;AACR;AAZS;AAcT,eAAe,iBACd,OACA,UACA,UACA,WACA,SAC0B;AAC1B,QAAM,WAAW,SAAS,QAAQ,OAAO,SAAS;AAGlD,QAAM,WAAW,SAAS,IAAI,CAACA,cAAiE;AAC/F,WAAO,QAAQ,QAAQ,QAAQA,WAAU,OAAO,QAAQ,CAAC,EAAE,KAAK,QAAW,SAAO;AACjF,gCAA0B,GAAG;AAC7B,aAAO;AAAA,IACR,CAAC;AAAA,EACF,CAAC;AAED,QAAM,SAAS,MAAM,QAAQ,IAAI,QAAQ;AACzC,SAAO,SAAS,OAAO,KAAK,CAAC,EAAE,OAAO,SAAO,0BAA0B,OAAO,GAAG,CAAC;AACnF;AAnBe;AAqBR,SAAS,yBAAyB,UAAuD,OAAmB,UAAoB,WAAoB,OAAmD;AAC7M,SAAO,iBAAiB,OAAO,UAAU,UAAU,WAAW,CAAC,UAAUC,QAAOC,cAAa;AAC5F,WAAO,SAAS,kBAAkBD,QAAOC,WAAU,KAAK;AAAA,EACzD,CAAC;AACF;AAJgB;AAMT,SAAS,0BAA0B,UAAwD,OAAmB,UAAoB,WAAoB,OAAmD;AAC/M,SAAO,iBAAiB,OAAO,UAAU,UAAU,WAAW,CAAC,UAAUD,QAAOC,cAAa;AAC5F,WAAO,SAAS,mBAAmBD,QAAOC,WAAU,KAAK;AAAA,EAC1D,CAAC;AACF;AAJgB;AAMT,SAAS,6BAA6B,UAA2D,OAAmB,UAAoB,WAAoB,OAAmD;AACrN,SAAO,iBAAiB,OAAO,UAAU,UAAU,WAAW,CAAC,UAAUD,QAAOC,cAAa;AAC5F,WAAO,SAAS,sBAAsBD,QAAOC,WAAU,KAAK;AAAA,EAC7D,CAAC;AACF;AAJgB;AAMT,SAAS,6BAA6B,UAA2D,OAAmB,UAAoB,WAAoB,OAAmD;AACrN,SAAO,iBAAiB,OAAO,UAAU,UAAU,WAAW,CAAC,UAAUD,QAAOC,cAAa;AAC5F,WAAO,SAAS,sBAAsBD,QAAOC,WAAU,KAAK;AAAA,EAC7D,CAAC;AACF;AAJgB;AAMT,SAAS,wBAAwB,UAAsD,OAAmB,UAAoB,SAAkB,WAAoB,OAAmD;AAC7N,SAAO,iBAAiB,OAAO,UAAU,UAAU,WAAW,OAAO,UAAUD,QAAOC,cAAa;AAClG,UAAM,UAAU,MAAM,SAAS,kBAAkBD,QAAOC,WAAU,EAAE,oBAAoB,KAAK,GAAG,KAAK,IAAI,OAAO,SAAO,0BAA0BD,QAAO,GAAG,CAAC;AAC5J,QAAI,CAAC,WAAW,CAAC,UAAU,OAAO,WAAW,GAAG;AAC/C,aAAO;AAAA,IACR;AACA,UAAM,4BAA4B,MAAM,SAAS,kBAAkBA,QAAOC,WAAU,EAAE,oBAAoB,MAAM,GAAG,KAAK,IAAI,OAAO,SAAO,0BAA0BD,QAAO,GAAG,CAAC;AAC/K,QAAI,4BAA4B,yBAAyB,WAAW,GAAG;AACtE,aAAO;AAAA,IACR;AACA,WAAO;AAAA,EACR,CAAC;AACF;AAZgB;AAgBhB,eAAe,kBAAkB,UAAkE;AAClG,QAAM,WAAW,MAAM,SAAS;AAChC,QAAM,QAAQ,IAAI,gBAAgB,UAAU,EAAE;AAC9C,QAAM,aAAa,MAAM,WAAW,IAAI,SAAO,IAAI,IAAI;AACvD,QAAM,QAAQ;AACd,SAAO;AACR;AANe;AAQf,gCAAgC,8BAA8B,CAAC,UAAU,OAAO,aAAa;AAC5F,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,yBAAyB,wBAAwB,oBAAoB,OAAO,UAAU,OAAO,kBAAkB,IAAI;AACnI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,wCAAwC,CAAC,UAAU,OAAO,aAAa;AACtG,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,yBAAyB,wBAAwB,oBAAoB,OAAO,UAAU,MAAM,kBAAkB,IAAI;AAClI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,kCAAkC,CAAC,UAAU,OAAO,aAAa;AAChG,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,6BAA6B,wBAAwB,wBAAwB,OAAO,UAAU,OAAO,kBAAkB,IAAI;AAC3I,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,4CAA4C,CAAC,UAAU,OAAO,aAAa;AAC1G,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,6BAA6B,wBAAwB,wBAAwB,OAAO,UAAU,MAAM,kBAAkB,IAAI;AAC1I,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,+BAA+B,CAAC,UAAU,OAAO,aAAa;AAC7F,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,0BAA0B,wBAAwB,qBAAqB,OAAO,UAAU,OAAO,kBAAkB,IAAI;AACrI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AACD,gCAAgC,yCAAyC,CAAC,UAAU,OAAO,aAAa;AACvG,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,0BAA0B,wBAAwB,qBAAqB,OAAO,UAAU,MAAM,kBAAkB,IAAI;AACpI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,6BAA6B,CAAC,UAAU,OAAO,aAAa;AAC3F,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,wBAAwB,wBAAwB,mBAAmB,OAAO,UAAU,OAAO,OAAO,kBAAkB,IAAI;AACxI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,uCAAuC,CAAC,UAAU,OAAO,aAAa;AACrG,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,wBAAwB,wBAAwB,mBAAmB,OAAO,UAAU,OAAO,MAAM,kBAAkB,IAAI;AACvI,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,kCAAkC,CAAC,UAAU,OAAO,aAAa;AAChG,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,6BAA6B,wBAAwB,wBAAwB,OAAO,UAAU,OAAO,kBAAkB,IAAI;AAC3I,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;AAED,gCAAgC,4CAA4C,CAAC,UAAU,OAAO,aAAa;AAC1G,QAAM,0BAA0B,SAAS,IAAI,wBAAwB;AACrE,QAAM,UAAU,6BAA6B,wBAAwB,wBAAwB,OAAO,UAAU,MAAM,kBAAkB,IAAI;AAC1I,SAAO,kBAAkB,MAAM,OAAO;AACvC,CAAC;",
  "names": ["provider", "model", "position"]
}
