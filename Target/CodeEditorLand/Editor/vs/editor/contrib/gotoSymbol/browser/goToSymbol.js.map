{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/gotoSymbol/browser/goToSymbol.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from \"../../../../base/common/arrays.js\";\nimport { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { onUnexpectedExternalError } from \"../../../../base/common/errors.js\";\nimport { Schemas, matchesSomeScheme } from \"../../../../base/common/network.js\";\nimport { registerModelAndPositionCommand } from \"../../../browser/editorExtensions.js\";\nimport type { Position } from \"../../../common/core/position.js\";\nimport type { LanguageFeatureRegistry } from \"../../../common/languageFeatureRegistry.js\";\nimport type {\n\tDeclarationProvider,\n\tDefinitionProvider,\n\tImplementationProvider,\n\tLocationLink,\n\tProviderResult,\n\tReferenceProvider,\n\tTypeDefinitionProvider,\n} from \"../../../common/languages.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../common/services/languageFeatures.js\";\nimport { ReferencesModel } from \"./referencesModel.js\";\n\nfunction shouldIncludeLocationLink(\n\tsourceModel: ITextModel,\n\tloc: LocationLink,\n): boolean {\n\t// Always allow the location if the request comes from a document with the same scheme.\n\tif (loc.uri.scheme === sourceModel.uri.scheme) {\n\t\treturn true;\n\t}\n\n\t// Otherwise filter out locations from internal schemes\n\tif (\n\t\tmatchesSomeScheme(\n\t\t\tloc.uri,\n\t\t\tSchemas.walkThroughSnippet,\n\t\t\tSchemas.vscodeChatCodeBlock,\n\t\t\tSchemas.vscodeChatCodeCompareBlock,\n\t\t)\n\t) {\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\nasync function getLocationLinks<T>(\n\tmodel: ITextModel,\n\tposition: Position,\n\tregistry: LanguageFeatureRegistry<T>,\n\trecursive: boolean,\n\tprovide: (\n\t\tprovider: T,\n\t\tmodel: ITextModel,\n\t\tposition: Position,\n\t) => ProviderResult<LocationLink | LocationLink[]>,\n): Promise<LocationLink[]> {\n\tconst provider = registry.ordered(model, recursive);\n\n\t// get results\n\tconst promises = provider.map(\n\t\t(provider): Promise<LocationLink | LocationLink[] | undefined> => {\n\t\t\treturn Promise.resolve(provide(provider, model, position)).then(\n\t\t\t\tundefined,\n\t\t\t\t(err) => {\n\t\t\t\t\tonUnexpectedExternalError(err);\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\t\t\t);\n\t\t},\n\t);\n\n\tconst values = await Promise.all(promises);\n\treturn coalesce(values.flat()).filter((loc) =>\n\t\tshouldIncludeLocationLink(model, loc),\n\t);\n}\n\nexport function getDefinitionsAtPosition(\n\tregistry: LanguageFeatureRegistry<DefinitionProvider>,\n\tmodel: ITextModel,\n\tposition: Position,\n\trecursive: boolean,\n\ttoken: CancellationToken,\n): Promise<LocationLink[]> {\n\treturn getLocationLinks(\n\t\tmodel,\n\t\tposition,\n\t\tregistry,\n\t\trecursive,\n\t\t(provider, model, position) => {\n\t\t\treturn provider.provideDefinition(model, position, token);\n\t\t},\n\t);\n}\n\nexport function getDeclarationsAtPosition(\n\tregistry: LanguageFeatureRegistry<DeclarationProvider>,\n\tmodel: ITextModel,\n\tposition: Position,\n\trecursive: boolean,\n\ttoken: CancellationToken,\n): Promise<LocationLink[]> {\n\treturn getLocationLinks(\n\t\tmodel,\n\t\tposition,\n\t\tregistry,\n\t\trecursive,\n\t\t(provider, model, position) => {\n\t\t\treturn provider.provideDeclaration(model, position, token);\n\t\t},\n\t);\n}\n\nexport function getImplementationsAtPosition(\n\tregistry: LanguageFeatureRegistry<ImplementationProvider>,\n\tmodel: ITextModel,\n\tposition: Position,\n\trecursive: boolean,\n\ttoken: CancellationToken,\n): Promise<LocationLink[]> {\n\treturn getLocationLinks(\n\t\tmodel,\n\t\tposition,\n\t\tregistry,\n\t\trecursive,\n\t\t(provider, model, position) => {\n\t\t\treturn provider.provideImplementation(model, position, token);\n\t\t},\n\t);\n}\n\nexport function getTypeDefinitionsAtPosition(\n\tregistry: LanguageFeatureRegistry<TypeDefinitionProvider>,\n\tmodel: ITextModel,\n\tposition: Position,\n\trecursive: boolean,\n\ttoken: CancellationToken,\n): Promise<LocationLink[]> {\n\treturn getLocationLinks(\n\t\tmodel,\n\t\tposition,\n\t\tregistry,\n\t\trecursive,\n\t\t(provider, model, position) => {\n\t\t\treturn provider.provideTypeDefinition(model, position, token);\n\t\t},\n\t);\n}\n\nexport function getReferencesAtPosition(\n\tregistry: LanguageFeatureRegistry<ReferenceProvider>,\n\tmodel: ITextModel,\n\tposition: Position,\n\tcompact: boolean,\n\trecursive: boolean,\n\ttoken: CancellationToken,\n): Promise<LocationLink[]> {\n\treturn getLocationLinks(\n\t\tmodel,\n\t\tposition,\n\t\tregistry,\n\t\trecursive,\n\t\tasync (provider, model, position) => {\n\t\t\tconst result = (\n\t\t\t\tawait provider.provideReferences(\n\t\t\t\t\tmodel,\n\t\t\t\t\tposition,\n\t\t\t\t\t{ includeDeclaration: true },\n\t\t\t\t\ttoken,\n\t\t\t\t)\n\t\t\t)?.filter((ref) => shouldIncludeLocationLink(model, ref));\n\t\t\tif (!compact || !result || result.length !== 2) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t\tconst resultWithoutDeclaration = (\n\t\t\t\tawait provider.provideReferences(\n\t\t\t\t\tmodel,\n\t\t\t\t\tposition,\n\t\t\t\t\t{ includeDeclaration: false },\n\t\t\t\t\ttoken,\n\t\t\t\t)\n\t\t\t)?.filter((ref) => shouldIncludeLocationLink(model, ref));\n\t\t\tif (\n\t\t\t\tresultWithoutDeclaration &&\n\t\t\t\tresultWithoutDeclaration.length === 1\n\t\t\t) {\n\t\t\t\treturn resultWithoutDeclaration;\n\t\t\t}\n\t\t\treturn result;\n\t\t},\n\t);\n}\n\n// -- API commands ----\n\nasync function _sortedAndDeduped(\n\tcallback: () => Promise<LocationLink[]>,\n): Promise<LocationLink[]> {\n\tconst rawLinks = await callback();\n\tconst model = new ReferencesModel(rawLinks, \"\");\n\tconst modelLinks = model.references.map((ref) => ref.link);\n\tmodel.dispose();\n\treturn modelLinks;\n}\n\nregisterModelAndPositionCommand(\n\t\"_executeDefinitionProvider\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getDefinitionsAtPosition(\n\t\t\tlanguageFeaturesService.definitionProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeDefinitionProvider_recursive\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getDefinitionsAtPosition(\n\t\t\tlanguageFeaturesService.definitionProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\ttrue,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeTypeDefinitionProvider\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getTypeDefinitionsAtPosition(\n\t\t\tlanguageFeaturesService.typeDefinitionProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeTypeDefinitionProvider_recursive\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getTypeDefinitionsAtPosition(\n\t\t\tlanguageFeaturesService.typeDefinitionProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\ttrue,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeDeclarationProvider\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getDeclarationsAtPosition(\n\t\t\tlanguageFeaturesService.declarationProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\nregisterModelAndPositionCommand(\n\t\"_executeDeclarationProvider_recursive\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getDeclarationsAtPosition(\n\t\t\tlanguageFeaturesService.declarationProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\ttrue,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeReferenceProvider\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getReferencesAtPosition(\n\t\t\tlanguageFeaturesService.referenceProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\tfalse,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeReferenceProvider_recursive\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getReferencesAtPosition(\n\t\t\tlanguageFeaturesService.referenceProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\ttrue,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeImplementationProvider\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getImplementationsAtPosition(\n\t\t\tlanguageFeaturesService.implementationProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\tfalse,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n\nregisterModelAndPositionCommand(\n\t\"_executeImplementationProvider_recursive\",\n\t(accessor, model, position) => {\n\t\tconst languageFeaturesService = accessor.get(ILanguageFeaturesService);\n\t\tconst promise = getImplementationsAtPosition(\n\t\t\tlanguageFeaturesService.implementationProvider,\n\t\t\tmodel,\n\t\t\tposition,\n\t\t\ttrue,\n\t\t\tCancellationToken.None,\n\t\t);\n\t\treturn _sortedAndDeduped(() => promise);\n\t},\n);\n"],
  "mappings": "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",
  "names": ["provider", "model", "position"]
}
