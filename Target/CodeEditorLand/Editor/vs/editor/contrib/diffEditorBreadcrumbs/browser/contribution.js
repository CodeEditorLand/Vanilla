var p=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var u=(a,n,t,o)=>{for(var r=o>1?void 0:o?v(n,t):n,i=a.length-1,e;i>=0;i--)(e=a[i])&&(r=(o?e(n,t,r):e(r))||r);return o&&r&&p(n,t,r),r},s=(a,n)=>(t,o)=>n(t,o,a);import{compareBy as f,numberComparator as S,reverseOrder as h}from"../../../../../vs/base/common/arrays.js";import{Event as M}from"../../../../../vs/base/common/event.js";import{Disposable as y}from"../../../../../vs/base/common/lifecycle.js";import{autorunWithStore as I,observableSignalFromEvent as c,observableValue as L}from"../../../../../vs/base/common/observable.js";import{HideUnchangedRegionsFeature as _}from"../../../../../vs/editor/browser/widget/diffEditor/features/hideUnchangedRegionsFeature.js";import{DisposableCancellationTokenSource as C}from"../../../../../vs/editor/browser/widget/diffEditor/utils.js";import"../../../../../vs/editor/common/core/lineRange.js";import"../../../../../vs/editor/common/languages.js";import"../../../../../vs/editor/common/model.js";import{ILanguageFeaturesService as x}from"../../../../../vs/editor/common/services/languageFeatures.js";import{IOutlineModelService as D}from"../../../../../vs/editor/contrib/documentSymbols/browser/outlineModel.js";let d=class extends y{constructor(t,o,r){super();this._textModel=t;this._languageFeaturesService=o;this._outlineModelService=r;const i=c("documentSymbolProvider.onDidChange",this._languageFeaturesService.documentSymbolProvider.onDidChange),e=c("_textModel.onDidChangeContent",M.debounce(m=>this._textModel.onDidChangeContent(m),()=>{},100));this._register(I(async(m,l)=>{i.read(m),e.read(m);const g=l.add(new C),b=await this._outlineModelService.getOrCreate(this._textModel,g.token);l.isDisposed||this._currentModel.set(b,void 0)}))}_currentModel=L(this,void 0);getBreadcrumbItems(t,o){const r=this._currentModel.read(o);if(!r)return[];const i=r.asListOfDocumentSymbols().filter(e=>t.contains(e.range.startLineNumber)&&!t.contains(e.range.endLineNumber));return i.sort(h(f(e=>e.range.endLineNumber-e.range.startLineNumber,S))),i.map(e=>({name:e.name,kind:e.kind,startLineNumber:e.range.startLineNumber}))}};d=u([s(1,x),s(2,D)],d),_.setBreadcrumbsSourceFactory((a,n)=>n.createInstance(d,a));
