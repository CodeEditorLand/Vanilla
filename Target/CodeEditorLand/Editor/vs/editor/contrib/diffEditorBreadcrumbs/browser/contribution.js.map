{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/diffEditorBreadcrumbs/browser/contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tcompareBy,\n\tnumberComparator,\n\treverseOrder,\n} from \"../../../../base/common/arrays.js\";\nimport { Event } from \"../../../../base/common/event.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport {\n\ttype IReader,\n\tautorunWithStore,\n\tobservableSignalFromEvent,\n\tobservableValue,\n} from \"../../../../base/common/observable.js\";\nimport {\n\tHideUnchangedRegionsFeature,\n\ttype IDiffEditorBreadcrumbsSource,\n} from \"../../../browser/widget/diffEditor/features/hideUnchangedRegionsFeature.js\";\nimport { DisposableCancellationTokenSource } from \"../../../browser/widget/diffEditor/utils.js\";\nimport type { LineRange } from \"../../../common/core/lineRange.js\";\nimport type { SymbolKind } from \"../../../common/languages.js\";\nimport type { ITextModel } from \"../../../common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../common/services/languageFeatures.js\";\nimport {\n\tIOutlineModelService,\n\ttype OutlineModel,\n} from \"../../documentSymbols/browser/outlineModel.js\";\n\nclass DiffEditorBreadcrumbsSource\n\textends Disposable\n\timplements IDiffEditorBreadcrumbsSource\n{\n\tprivate readonly _currentModel = observableValue<OutlineModel | undefined>(\n\t\tthis,\n\t\tundefined,\n\t);\n\n\tconstructor(\n\t\tprivate readonly _textModel: ITextModel,\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IOutlineModelService\n\t\tprivate readonly _outlineModelService: IOutlineModelService,\n\t) {\n\t\tsuper();\n\n\t\tconst documentSymbolProviderChanged = observableSignalFromEvent(\n\t\t\t\"documentSymbolProvider.onDidChange\",\n\t\t\tthis._languageFeaturesService.documentSymbolProvider.onDidChange,\n\t\t);\n\n\t\tconst textModelChanged = observableSignalFromEvent(\n\t\t\t\"_textModel.onDidChangeContent\",\n\t\t\tEvent.debounce<any>(\n\t\t\t\t(e) => this._textModel.onDidChangeContent(e),\n\t\t\t\t() => undefined,\n\t\t\t\t100,\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorunWithStore(async (reader, store) => {\n\t\t\t\tdocumentSymbolProviderChanged.read(reader);\n\t\t\t\ttextModelChanged.read(reader);\n\n\t\t\t\tconst src = store.add(new DisposableCancellationTokenSource());\n\t\t\t\tconst model = await this._outlineModelService.getOrCreate(\n\t\t\t\t\tthis._textModel,\n\t\t\t\t\tsrc.token,\n\t\t\t\t);\n\t\t\t\tif (store.isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._currentModel.set(model, undefined);\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic getBreadcrumbItems(\n\t\tstartRange: LineRange,\n\t\treader: IReader,\n\t): { name: string; kind: SymbolKind; startLineNumber: number }[] {\n\t\tconst m = this._currentModel.read(reader);\n\t\tif (!m) {\n\t\t\treturn [];\n\t\t}\n\t\tconst symbols = m\n\t\t\t.asListOfDocumentSymbols()\n\t\t\t.filter(\n\t\t\t\t(s) =>\n\t\t\t\t\tstartRange.contains(s.range.startLineNumber) &&\n\t\t\t\t\t!startRange.contains(s.range.endLineNumber),\n\t\t\t);\n\t\tsymbols.sort(\n\t\t\treverseOrder(\n\t\t\t\tcompareBy(\n\t\t\t\t\t(s) => s.range.endLineNumber - s.range.startLineNumber,\n\t\t\t\t\tnumberComparator,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\treturn symbols.map((s) => ({\n\t\t\tname: s.name,\n\t\t\tkind: s.kind,\n\t\t\tstartLineNumber: s.range.startLineNumber,\n\t\t}));\n\t}\n}\n\nHideUnchangedRegionsFeature.setBreadcrumbsSourceFactory(\n\t(textModel, instantiationService) => {\n\t\treturn instantiationService.createInstance(\n\t\t\tDiffEditorBreadcrumbsSource,\n\t\t\ttextModel,\n\t\t);\n\t},\n);\n"],
  "mappings": ";;;;;;;;;;;;AAKA;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,aAAa;AACtB,SAAS,kBAAkB;AAC3B;AAAA,EAEC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,OAEM;AACP,SAAS,yCAAyC;AAIlD,SAAS,gCAAgC;AACzC;AAAA,EACC;AAAA,OAEM;AAEP,IAAM,8BAAN,cACS,WAET;AAAA,EAMC,YACkB,YAEA,0BAEA,sBAChB;AACD,UAAM;AANW;AAEA;AAEA;AAIjB,UAAM,gCAAgC;AAAA,MACrC;AAAA,MACA,KAAK,yBAAyB,uBAAuB;AAAA,IACtD;AAEA,UAAM,mBAAmB;AAAA,MACxB;AAAA,MACA,MAAM;AAAA,QACL,CAAC,MAAM,KAAK,WAAW,mBAAmB,CAAC;AAAA,QAC3C,MAAM;AAAA,QACN;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,iBAAiB,OAAO,QAAQ,UAAU;AACzC,sCAA8B,KAAK,MAAM;AACzC,yBAAiB,KAAK,MAAM;AAE5B,cAAM,MAAM,MAAM,IAAI,IAAI,kCAAkC,CAAC;AAC7D,cAAM,QAAQ,MAAM,KAAK,qBAAqB;AAAA,UAC7C,KAAK;AAAA,UACL,IAAI;AAAA,QACL;AACA,YAAI,MAAM,YAAY;AACrB;AAAA,QACD;AAEA,aAAK,cAAc,IAAI,OAAO,MAAS;AAAA,MACxC,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAjFD,OAmCA;AAAA;AAAA;AAAA,EACkB,gBAAgB;AAAA,IAChC;AAAA,IACA;AAAA,EACD;AAAA,EA4CO,mBACN,YACA,QACgE;AAChE,UAAM,IAAI,KAAK,cAAc,KAAK,MAAM;AACxC,QAAI,CAAC,GAAG;AACP,aAAO,CAAC;AAAA,IACT;AACA,UAAM,UAAU,EACd,wBAAwB,EACxB;AAAA,MACA,CAAC,MACA,WAAW,SAAS,EAAE,MAAM,eAAe,KAC3C,CAAC,WAAW,SAAS,EAAE,MAAM,aAAa;AAAA,IAC5C;AACD,YAAQ;AAAA,MACP;AAAA,QACC;AAAA,UACC,CAAC,MAAM,EAAE,MAAM,gBAAgB,EAAE,MAAM;AAAA,UACvC;AAAA,QACD;AAAA,MACD;AAAA,IACD;AACA,WAAO,QAAQ,IAAI,CAAC,OAAO;AAAA,MAC1B,MAAM,EAAE;AAAA,MACR,MAAM,EAAE;AAAA,MACR,iBAAiB,EAAE,MAAM;AAAA,IAC1B,EAAE;AAAA,EACH;AACD;AAhFM,8BAAN;AAAA,EAWG;AAAA,EAEA;AAAA,GAbG;AAkFN,4BAA4B;AAAA,EAC3B,CAAC,WAAW,yBAAyB;AACpC,WAAO,qBAAqB;AAAA,MAC3B;AAAA,MACA;AAAA,IACD;AAAA,EACD;AACD;",
  "names": []
}
