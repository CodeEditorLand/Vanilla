var _=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var v=(d,o,e,r)=>{for(var t=r>1?void 0:r?I(o,e):o,n=d.length-1,i;n>=0;n--)(i=d[n])&&(t=(r?i(o,e,t):i(t))||t);return r&&t&&_(o,e,t),t},P=(d,o)=>(e,r)=>o(e,r,d);import{CancellationToken as M}from"../../../../../base/common/cancellation.js";import"../../../../../base/common/color.js";import{DisposableStore as k}from"../../../../../base/common/lifecycle.js";import{IThemeService as y}from"../../../../../platform/theme/common/themeService.js";import"../../../../browser/editorBrowser.js";import"../../../../common/languageFeatureRegistry.js";import"../../../../common/languages.js";import"../../../hover/browser/hoverTypes.js";import{getColors as D}from"../color.js";import{ColorDetector as w}from"../colorDetector.js";import"../colorPickerModel.js";import{createColorHover as H,updateColorPresentations as p,updateEditorModel as E}from"../colorPickerParticipantUtils.js";import{ColorPickerWidget as R}from"../hoverColorPicker/hoverColorPickerWidget.js";import{Range as C}from"../../../../common/core/range.js";import{EditorOption as b}from"../../../../common/config/editorOptions.js";import{Dimension as S}from"../../../../../base/browser/dom.js";class f{constructor(o,e,r,t){this.owner=o;this.range=e;this.model=r;this.provider=t}static fromBaseColor(o,e){return new f(o,e.range,e.model,e.provider)}}let u=class{constructor(o,e){this._editor=o;this._themeService=e}hoverOrdinal=2;_color=null;async createColorHover(o,e,r){if(!this._editor.hasModel()||!w.get(this._editor))return null;const n=await D(r,this._editor.getModel(),M.None);let i=null,s=null;for(const g of n){const h=g.colorInfo;C.containsRange(h.range,o.range)&&(i=h,s=g.provider)}const a=i??o,m=s??e,c=!!i;return{colorHover:f.fromBaseColor(this,await H(this._editor.getModel(),a,m)),foundInEditor:c}}async updateEditorModel(o){if(!this._editor.hasModel())return;const e=o.model;let r=new C(o.range.startLineNumber,o.range.startColumn,o.range.endLineNumber,o.range.endColumn);this._color&&(await p(this._editor.getModel(),e,this._color,r,o),r=E(this._editor,r,e))}renderHoverParts(o,e){if(e.length===0||!this._editor.hasModel())return;if(o.setMinimumDimensions){const l=this._editor.getOption(b.lineHeight)+8;o.setMinimumDimensions(new S(302,l))}const r=new k,t=e[0],n=this._editor.getModel(),i=t.model,s=r.add(new R(o.fragment,i,this._editor.getOption(b.pixelRatio),this._themeService,!0));let a=!1;const m=new C(t.range.startLineNumber,t.range.startColumn,t.range.endLineNumber,t.range.endColumn),c=t.model.color;return this._color=c,p(n,i,c,m,t),r.add(i.onColorFlushed(l=>{this._color=l})),r.add(i.onDidChangeColor(l=>{p(n,i,l,m,t)})),r.add(this._editor.onDidChangeModelContent(l=>{a?a=!1:(o.hide(),this._editor.focus())})),{hoverPart:t,colorPicker:s,disposables:r}}};u=v([P(1,y)],u);export{f as StandaloneColorPickerHover,u as StandaloneColorPickerParticipant};
