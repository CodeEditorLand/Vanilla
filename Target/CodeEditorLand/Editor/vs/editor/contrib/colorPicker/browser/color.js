import{CancellationToken as C}from"../../../../base/common/cancellation.js";import{illegalArgument as d,onUnexpectedExternalError as f}from"../../../../base/common/errors.js";import{IModelService as I}from"../../../common/services/model.js";import{ILanguageFeaturesService as p}from"../../../common/services/languageFeatures.js";import{DefaultDocumentColorProvider as D}from"./defaultDocumentColorProvider.js";import{IConfigurationService as P}from"../../../../platform/configuration/common/configuration.js";async function z(n,o,r,e=!0){return v(new g,n,o,r,e)}function B(n,o,r,e){return Promise.resolve(r.provideColorPresentations(n,o,e))}class g{constructor(){}async compute(o,r,e,l){const t=await o.provideDocumentColors(r,e);if(Array.isArray(t))for(const a of t)l.push({colorInfo:a,provider:o});return Array.isArray(t)}}class G{constructor(){}async compute(o,r,e,l){const t=await o.provideDocumentColors(r,e);if(Array.isArray(t))for(const a of t)l.push({range:a.range,color:[a.color.red,a.color.green,a.color.blue,a.color.alpha]});return Array.isArray(t)}}class H{constructor(o){this.colorInfo=o}async compute(o,r,e,l){const t=await o.provideColorPresentations(r,this.colorInfo,C.None);return Array.isArray(t)&&l.push(...t),Array.isArray(t)}}async function v(n,o,r,e,l){let t=!1,a;const i=[],m=o.ordered(r);for(let c=m.length-1;c>=0;c--){const s=m[c];if(s instanceof D)a=s;else try{await n.compute(s,r,e,i)&&(t=!0)}catch(u){f(u)}}return t?i:a&&l?(await n.compute(a,r,e,i),i):[]}function J(n,o){const{colorProvider:r}=n.get(p),e=n.get(I).getModel(o);if(!e)throw d();const l=n.get(P).getValue("editor.defaultColorDecorators",{resource:o});return{model:e,colorProviderRegistry:r,isDefaultColorDecoratorsEnabled:l}}export{H as ColorPresentationsCollector,G as ExtColorDataCollector,v as _findColorData,J as _setupColorCommand,B as getColorPresentations,z as getColors};
