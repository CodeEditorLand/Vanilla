{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/colorPicker/browser/colorPickerParticipantUtils.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension } from \"../../../../base/browser/dom.js\";\nimport { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { Color, RGBA } from \"../../../../base/common/color.js\";\nimport { DisposableStore } from \"../../../../base/common/lifecycle.js\";\nimport type { IThemeService } from \"../../../../platform/theme/common/themeService.js\";\nimport type {\n\tIActiveCodeEditor,\n\tICodeEditor,\n} from \"../../../browser/editorBrowser.js\";\nimport { EditorOption } from \"../../../common/config/editorOptions.js\";\nimport type { ISingleEditOperation } from \"../../../common/core/editOperation.js\";\nimport { Range } from \"../../../common/core/range.js\";\nimport type {\n\tDocumentColorProvider,\n\tIColorInformation,\n} from \"../../../common/languages.js\";\nimport {\n\ttype ITextModel,\n\tTrackedRangeStickiness,\n} from \"../../../common/model.js\";\nimport type { IEditorHoverRenderContext } from \"../../hover/browser/hoverTypes.js\";\nimport { getColorPresentations } from \"./color.js\";\nimport { ColorPickerModel } from \"./colorPickerModel.js\";\nimport {\n\tColorHover,\n\tHoverColorPickerParticipant,\n} from \"./hoverColorPicker/hoverColorPickerParticipant.js\";\nimport { ColorPickerWidget } from \"./hoverColorPicker/hoverColorPickerWidget.js\";\nimport {\n\tStandaloneColorPickerHover,\n\tStandaloneColorPickerParticipant,\n} from \"./standaloneColorPicker/standaloneColorPickerParticipant.js\";\n\nexport async function createColorHover<\n\tT extends HoverColorPickerParticipant | StandaloneColorPickerParticipant,\n>(\n\tparticipant: T,\n\teditorModel: ITextModel,\n\tcolorInfo: IColorInformation,\n\tprovider: DocumentColorProvider,\n): Promise<\n\tT extends HoverColorPickerParticipant\n\t\t? ColorHover\n\t\t: StandaloneColorPickerHover\n>;\nexport async function createColorHover(\n\tparticipant: HoverColorPickerParticipant | StandaloneColorPickerParticipant,\n\teditorModel: ITextModel,\n\tcolorInfo: IColorInformation,\n\tprovider: DocumentColorProvider,\n): Promise<ColorHover | StandaloneColorPickerHover> {\n\tconst originalText = editorModel.getValueInRange(colorInfo.range);\n\tconst { red, green, blue, alpha } = colorInfo.color;\n\tconst rgba = new RGBA(\n\t\tMath.round(red * 255),\n\t\tMath.round(green * 255),\n\t\tMath.round(blue * 255),\n\t\talpha,\n\t);\n\tconst color = new Color(rgba);\n\n\tconst colorPresentations = await getColorPresentations(\n\t\teditorModel,\n\t\tcolorInfo,\n\t\tprovider,\n\t\tCancellationToken.None,\n\t);\n\tconst model = new ColorPickerModel(color, [], 0);\n\tmodel.colorPresentations = colorPresentations || [];\n\tmodel.guessColorPresentation(color, originalText);\n\n\tif (participant instanceof HoverColorPickerParticipant) {\n\t\treturn new ColorHover(\n\t\t\tparticipant,\n\t\t\tRange.lift(colorInfo.range),\n\t\t\tmodel,\n\t\t\tprovider,\n\t\t);\n\t} else {\n\t\treturn new StandaloneColorPickerHover(\n\t\t\tparticipant,\n\t\t\tRange.lift(colorInfo.range),\n\t\t\tmodel,\n\t\t\tprovider,\n\t\t);\n\t}\n}\n\nexport function renderHoverParts<\n\tT extends ColorHover | StandaloneColorPickerHover,\n>(\n\tparticipant: HoverColorPickerParticipant | StandaloneColorPickerParticipant,\n\teditor: ICodeEditor,\n\tthemeService: IThemeService,\n\thoverParts: T[],\n\tcontext: IEditorHoverRenderContext,\n):\n\t| {\n\t\t\thoverPart: T;\n\t\t\tcolorPicker: ColorPickerWidget;\n\t\t\tdisposables: DisposableStore;\n\t  }\n\t| undefined {\n\tif (hoverParts.length === 0 || !editor.hasModel()) {\n\t\treturn undefined;\n\t}\n\tif (context.setMinimumDimensions) {\n\t\tconst minimumHeight = editor.getOption(EditorOption.lineHeight) + 8;\n\t\tcontext.setMinimumDimensions(new Dimension(302, minimumHeight));\n\t}\n\n\tconst disposables = new DisposableStore();\n\tconst colorHover = hoverParts[0];\n\tconst editorModel = editor.getModel();\n\tconst model = colorHover.model;\n\tconst colorPicker = disposables.add(\n\t\tnew ColorPickerWidget(\n\t\t\tcontext.fragment,\n\t\t\tmodel,\n\t\t\teditor.getOption(EditorOption.pixelRatio),\n\t\t\tthemeService,\n\t\t\tparticipant instanceof StandaloneColorPickerParticipant,\n\t\t),\n\t);\n\n\tlet editorUpdatedByColorPicker = false;\n\tlet range = new Range(\n\t\tcolorHover.range.startLineNumber,\n\t\tcolorHover.range.startColumn,\n\t\tcolorHover.range.endLineNumber,\n\t\tcolorHover.range.endColumn,\n\t);\n\tif (participant instanceof StandaloneColorPickerParticipant) {\n\t\tconst color = colorHover.model.color;\n\t\tparticipant.color = color;\n\t\tupdateColorPresentations(editorModel, model, color, range, colorHover);\n\t\tdisposables.add(\n\t\t\tmodel.onColorFlushed((color: Color) => {\n\t\t\t\tparticipant.color = color;\n\t\t\t}),\n\t\t);\n\t} else {\n\t\tdisposables.add(\n\t\t\tmodel.onColorFlushed(async (color: Color) => {\n\t\t\t\tawait updateColorPresentations(\n\t\t\t\t\teditorModel,\n\t\t\t\t\tmodel,\n\t\t\t\t\tcolor,\n\t\t\t\t\trange,\n\t\t\t\t\tcolorHover,\n\t\t\t\t);\n\t\t\t\teditorUpdatedByColorPicker = true;\n\t\t\t\trange = updateEditorModel(editor, range, model);\n\t\t\t}),\n\t\t);\n\t}\n\tdisposables.add(\n\t\tmodel.onDidChangeColor((color: Color) => {\n\t\t\tupdateColorPresentations(\n\t\t\t\teditorModel,\n\t\t\t\tmodel,\n\t\t\t\tcolor,\n\t\t\t\trange,\n\t\t\t\tcolorHover,\n\t\t\t);\n\t\t}),\n\t);\n\tdisposables.add(\n\t\teditor.onDidChangeModelContent((e) => {\n\t\t\tif (editorUpdatedByColorPicker) {\n\t\t\t\teditorUpdatedByColorPicker = false;\n\t\t\t} else {\n\t\t\t\tcontext.hide();\n\t\t\t\teditor.focus();\n\t\t\t}\n\t\t}),\n\t);\n\treturn { hoverPart: colorHover, colorPicker, disposables };\n}\n\nexport function updateEditorModel(\n\teditor: IActiveCodeEditor,\n\trange: Range,\n\tmodel: ColorPickerModel,\n): Range {\n\tconst textEdits: ISingleEditOperation[] = [];\n\tconst edit = model.presentation.textEdit ?? {\n\t\trange,\n\t\ttext: model.presentation.label,\n\t\tforceMoveMarkers: false,\n\t};\n\ttextEdits.push(edit);\n\n\tif (model.presentation.additionalTextEdits) {\n\t\ttextEdits.push(...model.presentation.additionalTextEdits);\n\t}\n\tconst replaceRange = Range.lift(edit.range);\n\tconst trackedRange = editor\n\t\t.getModel()\n\t\t._setTrackedRange(\n\t\t\tnull,\n\t\t\treplaceRange,\n\t\t\tTrackedRangeStickiness.GrowsOnlyWhenTypingAfter,\n\t\t);\n\teditor.executeEdits(\"colorpicker\", textEdits);\n\teditor.pushUndoStop();\n\treturn editor.getModel()._getTrackedRange(trackedRange) ?? replaceRange;\n}\n\nexport async function updateColorPresentations(\n\teditorModel: ITextModel,\n\tcolorPickerModel: ColorPickerModel,\n\tcolor: Color,\n\trange: Range,\n\tcolorHover: ColorHover | StandaloneColorPickerHover,\n) {\n\tconst colorPresentations = await getColorPresentations(\n\t\teditorModel,\n\t\t{\n\t\t\trange: range,\n\t\t\tcolor: {\n\t\t\t\tred: color.rgba.r / 255,\n\t\t\t\tgreen: color.rgba.g / 255,\n\t\t\t\tblue: color.rgba.b / 255,\n\t\t\t\talpha: color.rgba.a,\n\t\t\t},\n\t\t},\n\t\tcolorHover.provider,\n\t\tCancellationToken.None,\n\t);\n\tcolorPickerModel.colorPresentations = colorPresentations || [];\n}\n"],
  "mappings": "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",
  "names": ["color"]
}
