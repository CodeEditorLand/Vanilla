{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/colorPicker/browser/standaloneColorPicker/standaloneColorPickerWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport \"../colorPicker.css\";\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport { Emitter } from \"../../../../../base/common/event.js\";\nimport { Disposable } from \"../../../../../base/common/lifecycle.js\";\nimport type { IContextKey } from \"../../../../../platform/contextkey/common/contextkey.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { IKeybindingService } from \"../../../../../platform/keybinding/common/keybinding.js\";\nimport {\n\tContentWidgetPositionPreference,\n\ttype ICodeEditor,\n\ttype IContentWidget,\n\ttype IContentWidgetPosition,\n} from \"../../../../browser/editorBrowser.js\";\nimport { EditorOption } from \"../../../../common/config/editorOptions.js\";\nimport type { Position } from \"../../../../common/core/position.js\";\nimport type { IRange } from \"../../../../common/core/range.js\";\nimport type { IColorInformation } from \"../../../../common/languages.js\";\nimport { PositionAffinity } from \"../../../../common/model.js\";\nimport { IEditorWorkerService } from \"../../../../common/services/editorWorker.js\";\nimport { ILanguageFeaturesService } from \"../../../../common/services/languageFeatures.js\";\nimport { EditorHoverStatusBar } from \"../../../hover/browser/contentHoverStatusBar.js\";\nimport type { IEditorHoverRenderContext } from \"../../../hover/browser/hoverTypes.js\";\nimport type { InsertButton } from \"../colorPickerParts/colorPickerInsertButton.js\";\nimport { DefaultDocumentColorProvider } from \"../defaultDocumentColorProvider.js\";\nimport {\n\ttype StandaloneColorPickerHover,\n\tStandaloneColorPickerParticipant,\n} from \"./standaloneColorPickerParticipant.js\";\n\nclass StandaloneColorPickerResult {\n\t// The color picker result consists of: an array of color results and a boolean indicating if the color was found in the editor\n\tconstructor(\n\t\tpublic readonly value: StandaloneColorPickerHover,\n\t\tpublic readonly foundInEditor: boolean,\n\t) {}\n}\n\nconst PADDING = 8;\nconst CLOSE_BUTTON_WIDTH = 22;\n\nexport class StandaloneColorPickerWidget\n\textends Disposable\n\timplements IContentWidget\n{\n\tstatic readonly ID = \"editor.contrib.standaloneColorPickerWidget\";\n\treadonly allowEditorOverflow = true;\n\n\tprivate readonly _position: Position | undefined = undefined;\n\tprivate readonly _standaloneColorPickerParticipant: StandaloneColorPickerParticipant;\n\n\tprivate _body: HTMLElement = document.createElement(\"div\");\n\tprivate _colorHover: StandaloneColorPickerHover | null = null;\n\tprivate _selectionSetInEditor = false;\n\n\tprivate readonly _onResult = this._register(\n\t\tnew Emitter<StandaloneColorPickerResult>(),\n\t);\n\tpublic readonly onResult = this._onResult.event;\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _standaloneColorPickerVisible: IContextKey<boolean>,\n\t\tprivate readonly _standaloneColorPickerFocused: IContextKey<boolean>,\n\t\t@IInstantiationService _instantiationService: IInstantiationService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService,\n\t) {\n\t\tsuper();\n\t\tthis._standaloneColorPickerVisible.set(true);\n\t\tthis._standaloneColorPickerParticipant = _instantiationService.createInstance(StandaloneColorPickerParticipant, this._editor);\n\t\tthis._position = this._editor._getViewModel()?.getPrimaryCursorState().modelState.position;\n\t\tconst editorSelection = this._editor.getSelection();\n\t\tconst selection = editorSelection ?\n\t\t\t{\n\t\t\t\tstartLineNumber: editorSelection.startLineNumber,\n\t\t\t\tstartColumn: editorSelection.startColumn,\n\t\t\t\tendLineNumber: editorSelection.endLineNumber,\n\t\t\t\tendColumn: editorSelection.endColumn\n\t\t\t} : { startLineNumber: 0, endLineNumber: 0, endColumn: 0, startColumn: 0 };\n\t\tconst focusTracker = this._register(dom.trackFocus(this._body));\n\t\tthis._register(focusTracker.onDidBlur(_ => {\n\t\t\tthis.hide();\n\t\t}));\n\t\tthis._register(focusTracker.onDidFocus(_ => {\n\t\t\tthis.focus();\n\t\t}));\n\t\t// When the cursor position changes, hide the color picker\n\t\tthis._register(this._editor.onDidChangeCursorPosition(() => {\n\t\t\t// Do not hide the color picker when the cursor changes position due to the keybindings\n\t\t\tif (this._selectionSetInEditor) {\n\t\t\t\tthis._selectionSetInEditor = false;\n\t\t\t} else {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._editor.onMouseMove((e) => {\n\t\t\tconst classList = e.target.element?.classList;\n\t\t\tif (classList && classList.contains('colorpicker-color-decoration')) {\n\t\t\t\tthis.hide();\n\t\t\t}\n\t\t}));\n\t\tthis._register(this.onResult((result) => {\n\t\t\tthis._render(result.value, result.foundInEditor);\n\t\t}));\n\t\tthis._start(selection);\n\t\tthis._body.style.zIndex = '50';\n\t\tthis._editor.addContentWidget(this);\n\t}\n\n\tpublic updateEditor() {\n\t\tif (this._colorHover) {\n\t\t\tthis._standaloneColorPickerParticipant.updateEditorModel(\n\t\t\t\tthis._colorHover,\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic getId(): string {\n\t\treturn StandaloneColorPickerWidget.ID;\n\t}\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._body;\n\t}\n\n\tpublic getPosition(): IContentWidgetPosition | null {\n\t\tif (!this._position) {\n\t\t\treturn null;\n\t\t}\n\t\tconst positionPreference = this._editor.getOption(\n\t\t\tEditorOption.hover,\n\t\t).above;\n\t\treturn {\n\t\t\tposition: this._position,\n\t\t\tsecondaryPosition: this._position,\n\t\t\tpreference: positionPreference\n\t\t\t\t? [\n\t\t\t\t\t\tContentWidgetPositionPreference.ABOVE,\n\t\t\t\t\t\tContentWidgetPositionPreference.BELOW,\n\t\t\t\t\t]\n\t\t\t\t: [\n\t\t\t\t\t\tContentWidgetPositionPreference.BELOW,\n\t\t\t\t\t\tContentWidgetPositionPreference.ABOVE,\n\t\t\t\t\t],\n\t\t\tpositionAffinity: PositionAffinity.None,\n\t\t};\n\t}\n\n\tpublic hide(): void {\n\t\tthis.dispose();\n\t\tthis._standaloneColorPickerVisible.set(false);\n\t\tthis._standaloneColorPickerFocused.set(false);\n\t\tthis._editor.removeContentWidget(this);\n\t\tthis._editor.focus();\n\t}\n\n\tpublic focus(): void {\n\t\tthis._standaloneColorPickerFocused.set(true);\n\t\tthis._body.focus();\n\t}\n\n\tprivate async _start(selection: IRange) {\n\t\tconst computeAsyncResult = await this._computeAsync(selection);\n\t\tif (!computeAsyncResult) {\n\t\t\treturn;\n\t\t}\n\t\tthis._onResult.fire(\n\t\t\tnew StandaloneColorPickerResult(\n\t\t\t\tcomputeAsyncResult.result,\n\t\t\t\tcomputeAsyncResult.foundInEditor,\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate async _computeAsync(\n\t\trange: IRange,\n\t): Promise<{\n\t\tresult: StandaloneColorPickerHover;\n\t\tfoundInEditor: boolean;\n\t} | null> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn null;\n\t\t}\n\t\tconst colorInfo: IColorInformation = {\n\t\t\trange: range,\n\t\t\tcolor: { red: 0, green: 0, blue: 0, alpha: 1 },\n\t\t};\n\t\tconst colorHoverResult: {\n\t\t\tcolorHover: StandaloneColorPickerHover;\n\t\t\tfoundInEditor: boolean;\n\t\t} | null =\n\t\t\tawait this._standaloneColorPickerParticipant.createColorHover(\n\t\t\t\tcolorInfo,\n\t\t\t\tnew DefaultDocumentColorProvider(this._editorWorkerService),\n\t\t\t\tthis._languageFeaturesService.colorProvider,\n\t\t\t);\n\t\tif (!colorHoverResult) {\n\t\t\treturn null;\n\t\t}\n\t\treturn {\n\t\t\tresult: colorHoverResult.colorHover,\n\t\t\tfoundInEditor: colorHoverResult.foundInEditor,\n\t\t};\n\t}\n\n\tprivate _render(\n\t\tcolorHover: StandaloneColorPickerHover,\n\t\tfoundInEditor: boolean,\n\t) {\n\t\tconst fragment = document.createDocumentFragment();\n\t\tconst statusBar = this._register(\n\t\t\tnew EditorHoverStatusBar(this._keybindingService),\n\t\t);\n\n\t\tconst context: IEditorHoverRenderContext = {\n\t\t\tfragment,\n\t\t\tstatusBar,\n\t\t\tonContentsChanged: () => {},\n\t\t\thide: () => this.hide(),\n\t\t};\n\n\t\tthis._colorHover = colorHover;\n\t\tconst renderedHoverPart =\n\t\t\tthis._standaloneColorPickerParticipant.renderHoverParts(context, [\n\t\t\t\tcolorHover,\n\t\t\t]);\n\t\tif (!renderedHoverPart) {\n\t\t\treturn;\n\t\t}\n\t\tthis._register(renderedHoverPart.disposables);\n\t\tconst colorPicker = renderedHoverPart.colorPicker;\n\t\tthis._body.classList.add(\"standalone-colorpicker-body\");\n\t\tthis._body.style.maxHeight =\n\t\t\tMath.max(this._editor.getLayoutInfo().height / 4, 250) + \"px\";\n\t\tthis._body.style.maxWidth =\n\t\t\tMath.max(this._editor.getLayoutInfo().width * 0.66, 500) + \"px\";\n\t\tthis._body.tabIndex = 0;\n\t\tthis._body.appendChild(fragment);\n\t\tcolorPicker.layout();\n\n\t\tconst colorPickerBody = colorPicker.body;\n\t\tconst saturationBoxWidth =\n\t\t\tcolorPickerBody.saturationBox.domNode.clientWidth;\n\t\tconst widthOfOriginalColorBox =\n\t\t\tcolorPickerBody.domNode.clientWidth -\n\t\t\tsaturationBoxWidth -\n\t\t\tCLOSE_BUTTON_WIDTH -\n\t\t\tPADDING;\n\t\tconst enterButton: InsertButton | null = colorPicker.body.enterButton;\n\t\tenterButton?.onClicked(() => {\n\t\t\tthis.updateEditor();\n\t\t\tthis.hide();\n\t\t});\n\t\tconst colorPickerHeader = colorPicker.header;\n\t\tconst pickedColorNode = colorPickerHeader.pickedColorNode;\n\t\tpickedColorNode.style.width = saturationBoxWidth + PADDING + \"px\";\n\t\tconst originalColorNode = colorPickerHeader.originalColorNode;\n\t\toriginalColorNode.style.width = widthOfOriginalColorBox + \"px\";\n\t\tconst closeButton = colorPicker.header.closeButton;\n\t\tcloseButton?.onClicked(() => {\n\t\t\tthis.hide();\n\t\t});\n\t\t// When found in the editor, highlight the selection in the editor\n\t\tif (foundInEditor) {\n\t\t\tif (enterButton) {\n\t\t\t\tenterButton.button.textContent = \"Replace\";\n\t\t\t}\n\t\t\tthis._selectionSetInEditor = true;\n\t\t\tthis._editor.setSelection(colorHover.range);\n\t\t}\n\t\tthis._editor.layoutContentWidget(this);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,OAAO;AACP,YAAY,SAAS;AACrB,SAAS,eAAe;AACxB,SAAS,kBAAkB;AAE3B,SAAS,6BAA6B;AACtC,SAAS,0BAA0B;AACnC;AAAA,EACC;AAAA,OAIM;AACP,SAAS,oBAAoB;AAI7B,SAAS,wBAAwB;AACjC,SAAS,4BAA4B;AACrC,SAAS,gCAAgC;AACzC,SAAS,4BAA4B;AAGrC,SAAS,oCAAoC;AAC7C;AAAA,EAEC;AAAA,OACM;AAEP,MAAM,4BAA4B;AAAA;AAAA,EAEjC,YACiB,OACA,eACf;AAFe;AACA;AAAA,EACd;AAAA,EAvCJ,OAkCkC;AAAA;AAAA;AAMlC;AAEA,MAAM,UAAU;AAChB,MAAM,qBAAqB;AAEpB,IAAM,8BAAN,cACE,WAET;AAAA,EAgBC,YACkB,SACA,+BACA,+BACM,uBACc,oBACM,0BACJ,sBACtC;AACD,UAAM;AARW;AACA;AACA;AAEoB;AACM;AACJ;AAGvC,SAAK,8BAA8B,IAAI,IAAI;AAC3C,SAAK,oCAAoC,sBAAsB,eAAe,kCAAkC,KAAK,OAAO;AAC5H,SAAK,YAAY,KAAK,QAAQ,cAAc,GAAG,sBAAsB,EAAE,WAAW;AAClF,UAAM,kBAAkB,KAAK,QAAQ,aAAa;AAClD,UAAM,YAAY,kBACjB;AAAA,MACC,iBAAiB,gBAAgB;AAAA,MACjC,aAAa,gBAAgB;AAAA,MAC7B,eAAe,gBAAgB;AAAA,MAC/B,WAAW,gBAAgB;AAAA,IAC5B,IAAI,EAAE,iBAAiB,GAAG,eAAe,GAAG,WAAW,GAAG,aAAa,EAAE;AAC1E,UAAM,eAAe,KAAK,UAAU,IAAI,WAAW,KAAK,KAAK,CAAC;AAC9D,SAAK,UAAU,aAAa,UAAU,OAAK;AAC1C,WAAK,KAAK;AAAA,IACX,CAAC,CAAC;AACF,SAAK,UAAU,aAAa,WAAW,OAAK;AAC3C,WAAK,MAAM;AAAA,IACZ,CAAC,CAAC;AAEF,SAAK,UAAU,KAAK,QAAQ,0BAA0B,MAAM;AAE3D,UAAI,KAAK,uBAAuB;AAC/B,aAAK,wBAAwB;AAAA,MAC9B,OAAO;AACN,aAAK,KAAK;AAAA,MACX;AAAA,IACD,CAAC,CAAC;AACF,SAAK,UAAU,KAAK,QAAQ,YAAY,CAAC,MAAM;AAC9C,YAAM,YAAY,EAAE,OAAO,SAAS;AACpC,UAAI,aAAa,UAAU,SAAS,8BAA8B,GAAG;AACpE,aAAK,KAAK;AAAA,MACX;AAAA,IACD,CAAC,CAAC;AACF,SAAK,UAAU,KAAK,SAAS,CAAC,WAAW;AACxC,WAAK,QAAQ,OAAO,OAAO,OAAO,aAAa;AAAA,IAChD,CAAC,CAAC;AACF,SAAK,OAAO,SAAS;AACrB,SAAK,MAAM,MAAM,SAAS;AAC1B,SAAK,QAAQ,iBAAiB,IAAI;AAAA,EACnC;AAAA,EAjHD,OAgDA;AAAA;AAAA;AAAA,EACC,OAAgB,KAAK;AAAA,EACZ,sBAAsB;AAAA,EAEd,YAAkC;AAAA,EAClC;AAAA,EAET,QAAqB,SAAS,cAAc,KAAK;AAAA,EACjD,cAAiD;AAAA,EACjD,wBAAwB;AAAA,EAEf,YAAY,KAAK;AAAA,IACjC,IAAI,QAAqC;AAAA,EAC1C;AAAA,EACgB,WAAW,KAAK,UAAU;AAAA,EAqDnC,eAAe;AACrB,QAAI,KAAK,aAAa;AACrB,WAAK,kCAAkC;AAAA,QACtC,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AAAA,EAEO,QAAgB;AACtB,WAAO,4BAA4B;AAAA,EACpC;AAAA,EAEO,aAA0B;AAChC,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,cAA6C;AACnD,QAAI,CAAC,KAAK,WAAW;AACpB,aAAO;AAAA,IACR;AACA,UAAM,qBAAqB,KAAK,QAAQ;AAAA,MACvC,aAAa;AAAA,IACd,EAAE;AACF,WAAO;AAAA,MACN,UAAU,KAAK;AAAA,MACf,mBAAmB,KAAK;AAAA,MACxB,YAAY,qBACT;AAAA,QACA,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MACjC,IACC;AAAA,QACA,gCAAgC;AAAA,QAChC,gCAAgC;AAAA,MACjC;AAAA,MACF,kBAAkB,iBAAiB;AAAA,IACpC;AAAA,EACD;AAAA,EAEO,OAAa;AACnB,SAAK,QAAQ;AACb,SAAK,8BAA8B,IAAI,KAAK;AAC5C,SAAK,8BAA8B,IAAI,KAAK;AAC5C,SAAK,QAAQ,oBAAoB,IAAI;AACrC,SAAK,QAAQ,MAAM;AAAA,EACpB;AAAA,EAEO,QAAc;AACpB,SAAK,8BAA8B,IAAI,IAAI;AAC3C,SAAK,MAAM,MAAM;AAAA,EAClB;AAAA,EAEA,MAAc,OAAO,WAAmB;AACvC,UAAM,qBAAqB,MAAM,KAAK,cAAc,SAAS;AAC7D,QAAI,CAAC,oBAAoB;AACxB;AAAA,IACD;AACA,SAAK,UAAU;AAAA,MACd,IAAI;AAAA,QACH,mBAAmB;AAAA,QACnB,mBAAmB;AAAA,MACpB;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAc,cACb,OAIS;AACT,QAAI,CAAC,KAAK,QAAQ,SAAS,GAAG;AAC7B,aAAO;AAAA,IACR;AACA,UAAM,YAA+B;AAAA,MACpC;AAAA,MACA,OAAO,EAAE,KAAK,GAAG,OAAO,GAAG,MAAM,GAAG,OAAO,EAAE;AAAA,IAC9C;AACA,UAAM,mBAIL,MAAM,KAAK,kCAAkC;AAAA,MAC5C;AAAA,MACA,IAAI,6BAA6B,KAAK,oBAAoB;AAAA,MAC1D,KAAK,yBAAyB;AAAA,IAC/B;AACD,QAAI,CAAC,kBAAkB;AACtB,aAAO;AAAA,IACR;AACA,WAAO;AAAA,MACN,QAAQ,iBAAiB;AAAA,MACzB,eAAe,iBAAiB;AAAA,IACjC;AAAA,EACD;AAAA,EAEQ,QACP,YACA,eACC;AACD,UAAM,WAAW,SAAS,uBAAuB;AACjD,UAAM,YAAY,KAAK;AAAA,MACtB,IAAI,qBAAqB,KAAK,kBAAkB;AAAA,IACjD;AAEA,UAAM,UAAqC;AAAA,MAC1C;AAAA,MACA;AAAA,MACA,mBAAmB,6BAAM;AAAA,MAAC,GAAP;AAAA,MACnB,MAAM,6BAAM,KAAK,KAAK,GAAhB;AAAA,IACP;AAEA,SAAK,cAAc;AACnB,UAAM,oBACL,KAAK,kCAAkC,iBAAiB,SAAS;AAAA,MAChE;AAAA,IACD,CAAC;AACF,QAAI,CAAC,mBAAmB;AACvB;AAAA,IACD;AACA,SAAK,UAAU,kBAAkB,WAAW;AAC5C,UAAM,cAAc,kBAAkB;AACtC,SAAK,MAAM,UAAU,IAAI,6BAA6B;AACtD,SAAK,MAAM,MAAM,YAChB,KAAK,IAAI,KAAK,QAAQ,cAAc,EAAE,SAAS,GAAG,GAAG,IAAI;AAC1D,SAAK,MAAM,MAAM,WAChB,KAAK,IAAI,KAAK,QAAQ,cAAc,EAAE,QAAQ,MAAM,GAAG,IAAI;AAC5D,SAAK,MAAM,WAAW;AACtB,SAAK,MAAM,YAAY,QAAQ;AAC/B,gBAAY,OAAO;AAEnB,UAAM,kBAAkB,YAAY;AACpC,UAAM,qBACL,gBAAgB,cAAc,QAAQ;AACvC,UAAM,0BACL,gBAAgB,QAAQ,cACxB,qBACA,qBACA;AACD,UAAM,cAAmC,YAAY,KAAK;AAC1D,iBAAa,UAAU,MAAM;AAC5B,WAAK,aAAa;AAClB,WAAK,KAAK;AAAA,IACX,CAAC;AACD,UAAM,oBAAoB,YAAY;AACtC,UAAM,kBAAkB,kBAAkB;AAC1C,oBAAgB,MAAM,QAAQ,qBAAqB,UAAU;AAC7D,UAAM,oBAAoB,kBAAkB;AAC5C,sBAAkB,MAAM,QAAQ,0BAA0B;AAC1D,UAAM,cAAc,YAAY,OAAO;AACvC,iBAAa,UAAU,MAAM;AAC5B,WAAK,KAAK;AAAA,IACX,CAAC;AAED,QAAI,eAAe;AAClB,UAAI,aAAa;AAChB,oBAAY,OAAO,cAAc;AAAA,MAClC;AACA,WAAK,wBAAwB;AAC7B,WAAK,QAAQ,aAAa,WAAW,KAAK;AAAA,IAC3C;AACA,SAAK,QAAQ,oBAAoB,IAAI;AAAA,EACtC;AACD;AAzOa,8BAAN;AAAA,EAuBJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GA1BU;",
  "names": []
}
