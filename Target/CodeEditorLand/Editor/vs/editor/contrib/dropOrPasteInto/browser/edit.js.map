{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/dropOrPasteInto/browser/edit.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { ResourceTextEdit } from '../../../browser/services/bulkEditService.js';\nimport { DocumentDropEdit, DocumentPasteEdit, DropYieldTo, WorkspaceEdit } from '../../../common/languages.js';\nimport { Range } from '../../../common/core/range.js';\nimport { SnippetParser } from '../../snippet/browser/snippetParser.js';\nimport { HierarchicalKind } from '../../../../base/common/hierarchicalKind.js';\n\n/**\n * Given a {@link DropOrPasteEdit} and set of ranges, creates a {@link WorkspaceEdit} that applies the insert text from\n * the {@link DropOrPasteEdit} at each range plus any additional edits.\n */\nexport function createCombinedWorkspaceEdit(uri: URI, ranges: readonly Range[], edit: DocumentPasteEdit | DocumentDropEdit): WorkspaceEdit {\n\t// If the edit insert text is empty, skip applying at each range\n\tif (typeof edit.insertText === 'string' ? edit.insertText === '' : edit.insertText.snippet === '') {\n\t\treturn {\n\t\t\tedits: edit.additionalEdit?.edits ?? []\n\t\t};\n\t}\n\n\treturn {\n\t\tedits: [\n\t\t\t...ranges.map(range =>\n\t\t\t\tnew ResourceTextEdit(uri,\n\t\t\t\t\t{ range, text: typeof edit.insertText === 'string' ? SnippetParser.escape(edit.insertText) + '$0' : edit.insertText.snippet, insertAsSnippet: true }\n\t\t\t\t)),\n\t\t\t...(edit.additionalEdit?.edits ?? [])\n\t\t]\n\t};\n}\n\nexport function sortEditsByYieldTo<T extends {\n\treadonly kind: HierarchicalKind | undefined;\n\treadonly handledMimeType?: string;\n\treadonly yieldTo?: readonly DropYieldTo[];\n}>(edits: readonly T[]): T[] {\n\tfunction yieldsTo(yTo: DropYieldTo, other: T): boolean {\n\t\tif ('mimeType' in yTo) {\n\t\t\treturn yTo.mimeType === other.handledMimeType;\n\t\t}\n\t\treturn !!other.kind && yTo.kind.contains(other.kind);\n\t}\n\n\t// Build list of nodes each node yields to\n\tconst yieldsToMap = new Map<T, T[]>();\n\tfor (const edit of edits) {\n\t\tfor (const yTo of edit.yieldTo ?? []) {\n\t\t\tfor (const other of edits) {\n\t\t\t\tif (other === edit) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (yieldsTo(yTo, other)) {\n\t\t\t\t\tlet arr = yieldsToMap.get(edit);\n\t\t\t\t\tif (!arr) {\n\t\t\t\t\t\tarr = [];\n\t\t\t\t\t\tyieldsToMap.set(edit, arr);\n\t\t\t\t\t}\n\t\t\t\t\tarr.push(other);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tif (!yieldsToMap.size) {\n\t\treturn Array.from(edits);\n\t}\n\n\t// Topological sort\n\tconst visited = new Set<T>();\n\tconst tempStack: T[] = [];\n\n\tfunction visit(nodes: T[]): T[] {\n\t\tif (!nodes.length) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst node = nodes[0];\n\t\tif (tempStack.includes(node)) {\n\t\t\tconsole.warn('Yield to cycle detected', node);\n\t\t\treturn nodes;\n\t\t}\n\n\t\tif (visited.has(node)) {\n\t\t\treturn visit(nodes.slice(1));\n\t\t}\n\n\t\tlet pre: T[] = [];\n\t\tconst yTo = yieldsToMap.get(node);\n\t\tif (yTo) {\n\t\t\ttempStack.push(node);\n\t\t\tpre = visit(yTo);\n\t\t\ttempStack.pop();\n\t\t}\n\n\t\tvisited.add(node);\n\n\t\treturn [...pre, node, ...visit(nodes.slice(1))];\n\t}\n\n\treturn visit(Array.from(edits));\n}\n"],
  "mappings": ";;AAKA,SAAS,WAAW;AACpB,SAAS,wBAAwB;AACjC,SAAS,kBAAkB,mBAAmB,aAAa,qBAAqB;AAChF,SAAS,aAAa;AACtB,SAAS,qBAAqB;AAC9B,SAAS,wBAAwB;AAM1B,SAAS,4BAA4B,KAAU,QAA0B,MAA2D;AAE1I,MAAI,OAAO,KAAK,eAAe,WAAW,KAAK,eAAe,KAAK,KAAK,WAAW,YAAY,IAAI;AAClG,WAAO;AAAA,MACN,OAAO,KAAK,gBAAgB,SAAS,CAAC;AAAA,IACvC;AAAA,EACD;AAEA,SAAO;AAAA,IACN,OAAO;AAAA,MACN,GAAG,OAAO,IAAI,WACb,IAAI;AAAA,QAAiB;AAAA,QACpB,EAAE,OAAO,MAAM,OAAO,KAAK,eAAe,WAAW,cAAc,OAAO,KAAK,UAAU,IAAI,OAAO,KAAK,WAAW,SAAS,iBAAiB,KAAK;AAAA,MACpJ,CAAC;AAAA,MACF,GAAI,KAAK,gBAAgB,SAAS,CAAC;AAAA,IACpC;AAAA,EACD;AACD;AAjBgB;AAmBT,SAAS,mBAIb,OAA0B;AAC5B,WAAS,SAAS,KAAkB,OAAmB;AACtD,QAAI,cAAc,KAAK;AACtB,aAAO,IAAI,aAAa,MAAM;AAAA,IAC/B;AACA,WAAO,CAAC,CAAC,MAAM,QAAQ,IAAI,KAAK,SAAS,MAAM,IAAI;AAAA,EACpD;AALS;AAQT,QAAM,cAAc,oBAAI,IAAY;AACpC,aAAW,QAAQ,OAAO;AACzB,eAAW,OAAO,KAAK,WAAW,CAAC,GAAG;AACrC,iBAAW,SAAS,OAAO;AAC1B,YAAI,UAAU,MAAM;AACnB;AAAA,QACD;AAEA,YAAI,SAAS,KAAK,KAAK,GAAG;AACzB,cAAI,MAAM,YAAY,IAAI,IAAI;AAC9B,cAAI,CAAC,KAAK;AACT,kBAAM,CAAC;AACP,wBAAY,IAAI,MAAM,GAAG;AAAA,UAC1B;AACA,cAAI,KAAK,KAAK;AAAA,QACf;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAEA,MAAI,CAAC,YAAY,MAAM;AACtB,WAAO,MAAM,KAAK,KAAK;AAAA,EACxB;AAGA,QAAM,UAAU,oBAAI,IAAO;AAC3B,QAAM,YAAiB,CAAC;AAExB,WAAS,MAAM,OAAiB;AAC/B,QAAI,CAAC,MAAM,QAAQ;AAClB,aAAO,CAAC;AAAA,IACT;AAEA,UAAM,OAAO,MAAM,CAAC;AACpB,QAAI,UAAU,SAAS,IAAI,GAAG;AAC7B,cAAQ,KAAK,2BAA2B,IAAI;AAC5C,aAAO;AAAA,IACR;AAEA,QAAI,QAAQ,IAAI,IAAI,GAAG;AACtB,aAAO,MAAM,MAAM,MAAM,CAAC,CAAC;AAAA,IAC5B;AAEA,QAAI,MAAW,CAAC;AAChB,UAAM,MAAM,YAAY,IAAI,IAAI;AAChC,QAAI,KAAK;AACR,gBAAU,KAAK,IAAI;AACnB,YAAM,MAAM,GAAG;AACf,gBAAU,IAAI;AAAA,IACf;AAEA,YAAQ,IAAI,IAAI;AAEhB,WAAO,CAAC,GAAG,KAAK,MAAM,GAAG,MAAM,MAAM,MAAM,CAAC,CAAC,CAAC;AAAA,EAC/C;AA1BS;AA4BT,SAAO,MAAM,MAAM,KAAK,KAAK,CAAC;AAC/B;AAtEgB;",
  "names": []
}
