var x=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var h=(p,n,e,t)=>{for(var i=t>1?void 0:t?M(n,e):n,o=p.length-1,a;o>=0;o--)(a=p[o])&&(i=(t?a(n,e,i):a(i))||i);return t&&i&&x(n,e,i),i},s=(p,n)=>(e,t)=>n(e,t,p);import{h as y}from"../../../../base/browser/dom.js";import{KeybindingLabel as O,unthemedKeybindingLabelOptions as B}from"../../../../base/browser/ui/keybindingLabel/keybindingLabel.js";import{Separator as E}from"../../../../base/common/actions.js";import{equals as I}from"../../../../base/common/arrays.js";import{Disposable as S,toDisposable as D}from"../../../../base/common/lifecycle.js";import{autorun as g,autorunWithStore as K,derived as L,observableFromEvent as V}from"../../../../base/common/observable.js";import{OS as W}from"../../../../base/common/platform.js";import"./inlineEditHintsWidget.css";import{MenuEntryActionViewItem as k,createAndFillInActionBarActions as N}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as G}from"../../../../platform/actions/browser/toolbar.js";import{IMenuService as A,MenuId as T,MenuItemAction as w}from"../../../../platform/actions/common/actions.js";import{ICommandService as F}from"../../../../platform/commands/common/commands.js";import{IContextKeyService as C}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as j}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as P}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as q}from"../../../../platform/keybinding/common/keybinding.js";import{ITelemetryService as R}from"../../../../platform/telemetry/common/telemetry.js";import{ContentWidgetPositionPreference as _}from"../../../browser/editorBrowser.js";import{EditorOption as X}from"../../../common/config/editorOptions.js";import{Position as $}from"../../../common/core/position.js";import{PositionAffinity as J}from"../../../common/model.js";let u=class extends S{constructor(e,t,i){super();this.editor=e;this.model=t;this.instantiationService=i;this._register(K((o,a)=>{if(!this.model.read(o)||!this.alwaysShowToolbar.read(o))return;const r=a.add(this.instantiationService.createInstance(d,this.editor,!0,this.position));e.addContentWidget(r),a.add(D(()=>e.removeContentWidget(r)))}))}alwaysShowToolbar=V(this,this.editor.onDidChangeConfiguration,()=>this.editor.getOption(X.inlineEdit).showToolbar==="always");sessionPosition=void 0;position=L(this,e=>{const t=this.model.read(e)?.model.ghostText.read(e);if(!this.alwaysShowToolbar.read(e)||!t||t.parts.length===0)return this.sessionPosition=void 0,null;const i=t.parts[0].column;this.sessionPosition&&this.sessionPosition.lineNumber!==t.lineNumber&&(this.sessionPosition=void 0);const o=new $(t.lineNumber,Math.min(i,this.sessionPosition?.column??Number.MAX_SAFE_INTEGER));return this.sessionPosition=o,o})};u=h([s(2,P)],u);let d=class extends S{constructor(e,t,i,o,a,m){super();this.editor=e;this.withBorder=t;this._position=i;this._contextKeyService=a;this._menuService=m;this.toolBar=this._register(o.createInstance(c,this.nodes.toolBar,this.editor,T.InlineEditToolbar,{menuOptions:{renderShortTitle:!0},toolbarOptions:{primaryGroup:r=>r.startsWith("primary")},actionViewItemProvider:(r,l)=>{if(r instanceof w)return o.createInstance(Q,r,void 0)},telemetrySource:"InlineEditToolbar"})),this._register(this.toolBar.onDidChangeDropdownVisibility(r=>{d._dropDownVisible=r})),this._register(g(r=>{this._position.read(r),this.editor.layoutContentWidget(this)})),this._register(g(r=>{const l=[];for(const[b,v]of this.inlineCompletionsActionsMenus.getActions())for(const f of v)f instanceof w&&l.push(f);l.length>0&&l.unshift(new E),this.toolBar.setAdditionalSecondaryActions(l)}))}static _dropDownVisible=!1;static get dropDownVisible(){return this._dropDownVisible}static id=0;id=`InlineEditHintsContentWidget${d.id++}`;allowEditorOverflow=!0;suppressMouseDown=!1;nodes=y("div.inlineEditHints",{className:this.withBorder?".withBorder":""},[y("div@toolBar")]);toolBar;inlineCompletionsActionsMenus=this._register(this._menuService.createMenu(T.InlineEditActions,this._contextKeyService));getId(){return this.id}getDomNode(){return this.nodes.root}getPosition(){return{position:this._position.get(),preference:[_.ABOVE,_.BELOW],positionAffinity:J.LeftOfInjectedText}}};d=h([s(3,P),s(4,C),s(5,A)],d);class Q extends k{updateLabel(){const n=this._keybindingService.lookupKeybinding(this._action.id,this._contextKeyService);if(!n)return super.updateLabel();if(this.label){const e=y("div.keybinding").root;this._register(new O(e,W,{disableTitle:!0,...B})).set(n),this.label.textContent=this._action.label,this.label.appendChild(e),this.label.classList.add("inlineEditStatusBarItemLabel")}}updateTooltip(){}}let c=class extends G{constructor(e,t,i,o,a,m,r,l,b,v){super(e,{resetMenu:i,...o},a,m,r,l,b,v);this.editor=t;this.menuId=i;this.options2=o;this.menuService=a;this.contextKeyService=m;this._store.add(this.menu.onDidChange(()=>this.updateToolbar())),this._store.add(this.editor.onDidChangeCursorPosition(()=>this.updateToolbar())),this.updateToolbar()}menu=this._store.add(this.menuService.createMenu(this.menuId,this.contextKeyService,{emitEventsForSubmenuChanges:!0}));additionalActions=[];prependedPrimaryActions=[];updateToolbar(){const e=[],t=[];N(this.menu,this.options2?.menuOptions,{primary:e,secondary:t},this.options2?.toolbarOptions?.primaryGroup,this.options2?.toolbarOptions?.shouldInlineSubmenu,this.options2?.toolbarOptions?.useSeparatorsInPrimaryActions),t.push(...this.additionalActions),e.unshift(...this.prependedPrimaryActions),this.setActions(e,t)}setPrependedPrimaryActions(e){I(this.prependedPrimaryActions,e,(t,i)=>t===i)||(this.prependedPrimaryActions=e,this.updateToolbar())}setAdditionalSecondaryActions(e){I(this.additionalActions,e,(t,i)=>t===i)||(this.additionalActions=e,this.updateToolbar())}};c=h([s(4,A),s(5,C),s(6,j),s(7,q),s(8,F),s(9,R)],c);export{c as CustomizedMenuWorkbenchToolBar,d as InlineEditHintsContentWidget,u as InlineEditHintsWidget};
