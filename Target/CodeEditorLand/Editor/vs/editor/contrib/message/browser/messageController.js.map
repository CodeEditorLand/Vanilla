{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/message/browser/messageController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderMarkdown } from '../../../../base/browser/markdownRenderer.js';\nimport { alert } from '../../../../base/browser/ui/aria/aria.js';\nimport { Event } from '../../../../base/common/event.js';\nimport { IMarkdownString, isMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { DisposableStore, IDisposable, MutableDisposable } from '../../../../base/common/lifecycle.js';\nimport './messageController.css';\nimport { ContentWidgetPositionPreference, ICodeEditor, IContentWidget, IContentWidgetPosition } from '../../../browser/editorBrowser.js';\nimport { EditorCommand, EditorContributionInstantiation, registerEditorCommand, registerEditorContribution } from '../../../browser/editorExtensions.js';\nimport { IPosition } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { IEditorContribution, ScrollType } from '../../../common/editorCommon.js';\nimport { PositionAffinity } from '../../../common/model.js';\nimport { openLinkFromMarkdown } from '../../../browser/widget/markdownRenderer/browser/markdownRenderer.js';\nimport * as nls from '../../../../nls.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { KeybindingWeight } from '../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport * as dom from '../../../../base/browser/dom.js';\n\nexport class MessageController implements IEditorContribution {\n\n\tpublic static readonly ID = 'editor.contrib.messageController';\n\n\tstatic readonly MESSAGE_VISIBLE = new RawContextKey<boolean>('messageVisible', false, nls.localize('messageVisible', 'Whether the editor is currently showing an inline message'));\n\n\tstatic get(editor: ICodeEditor): MessageController | null {\n\t\treturn editor.getContribution<MessageController>(MessageController.ID);\n\t}\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _visible: IContextKey<boolean>;\n\tprivate readonly _messageWidget = new MutableDisposable<MessageWidget>();\n\tprivate readonly _messageListeners = new DisposableStore();\n\tprivate _message: { element: HTMLElement; dispose: () => void } | undefined;\n\tprivate _mouseOverMessage: boolean = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService\n\t) {\n\n\t\tthis._editor = editor;\n\t\tthis._visible = MessageController.MESSAGE_VISIBLE.bindTo(contextKeyService);\n\t}\n\n\tdispose(): void {\n\t\tthis._message?.dispose();\n\t\tthis._messageListeners.dispose();\n\t\tthis._messageWidget.dispose();\n\t\tthis._visible.reset();\n\t}\n\n\tisVisible() {\n\t\treturn this._visible.get();\n\t}\n\n\tshowMessage(message: IMarkdownString | string, position: IPosition): void {\n\n\t\talert(isMarkdownString(message) ? message.value : message);\n\n\t\tthis._visible.set(true);\n\t\tthis._messageWidget.clear();\n\t\tthis._messageListeners.clear();\n\t\tthis._message = isMarkdownString(message) ? renderMarkdown(message, {\n\t\t\tactionHandler: {\n\t\t\t\tcallback: (url) => {\n\t\t\t\t\tthis.closeMessage();\n\t\t\t\t\topenLinkFromMarkdown(this._openerService, url, isMarkdownString(message) ? message.isTrusted : undefined);\n\t\t\t\t},\n\t\t\t\tdisposables: this._messageListeners\n\t\t\t},\n\t\t}) : undefined;\n\t\tthis._messageWidget.value = new MessageWidget(this._editor, position, typeof message === 'string' ? message : this._message!.element);\n\n\t\t// close on blur (debounced to allow to tab into the message), cursor, model change, dispose\n\t\tthis._messageListeners.add(Event.debounce(this._editor.onDidBlurEditorText, (last, event) => event, 0)(() => {\n\t\t\tif (this._mouseOverMessage) {\n\t\t\t\treturn; // override when mouse over message\n\t\t\t}\n\n\t\t\tif (this._messageWidget.value && dom.isAncestor(dom.getActiveElement(), this._messageWidget.value.getDomNode())) {\n\t\t\t\treturn; // override when focus is inside the message\n\t\t\t}\n\n\t\t\tthis.closeMessage();\n\t\t}\n\t\t));\n\t\tthis._messageListeners.add(this._editor.onDidChangeCursorPosition(() => this.closeMessage()));\n\t\tthis._messageListeners.add(this._editor.onDidDispose(() => this.closeMessage()));\n\t\tthis._messageListeners.add(this._editor.onDidChangeModel(() => this.closeMessage()));\n\t\tthis._messageListeners.add(dom.addDisposableListener(this._messageWidget.value.getDomNode(), dom.EventType.MOUSE_ENTER, () => this._mouseOverMessage = true, true));\n\t\tthis._messageListeners.add(dom.addDisposableListener(this._messageWidget.value.getDomNode(), dom.EventType.MOUSE_LEAVE, () => this._mouseOverMessage = false, true));\n\n\t\t// close on mouse move\n\t\tlet bounds: Range;\n\t\tthis._messageListeners.add(this._editor.onMouseMove(e => {\n\t\t\t// outside the text area\n\t\t\tif (!e.target.position) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!bounds) {\n\t\t\t\t// define bounding box around position and first mouse occurance\n\t\t\t\tbounds = new Range(position.lineNumber - 3, 1, e.target.position.lineNumber + 3, 1);\n\t\t\t} else if (!bounds.containsPosition(e.target.position)) {\n\t\t\t\t// check if position is still in bounds\n\t\t\t\tthis.closeMessage();\n\t\t\t}\n\t\t}));\n\t}\n\n\tcloseMessage(): void {\n\t\tthis._visible.reset();\n\t\tthis._messageListeners.clear();\n\t\tif (this._messageWidget.value) {\n\t\t\tthis._messageListeners.add(MessageWidget.fadeOut(this._messageWidget.value));\n\t\t}\n\t}\n}\n\nconst MessageCommand = EditorCommand.bindToContribution<MessageController>(MessageController.get);\n\n\nregisterEditorCommand(new MessageCommand({\n\tid: 'leaveEditorMessage',\n\tprecondition: MessageController.MESSAGE_VISIBLE,\n\thandler: c => c.closeMessage(),\n\tkbOpts: {\n\t\tweight: KeybindingWeight.EditorContrib + 30,\n\t\tprimary: KeyCode.Escape\n\t}\n}));\n\nclass MessageWidget implements IContentWidget {\n\n\t// Editor.IContentWidget.allowEditorOverflow\n\treadonly allowEditorOverflow = true;\n\treadonly suppressMouseDown = false;\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _position: IPosition;\n\tprivate readonly _domNode: HTMLDivElement;\n\n\tstatic fadeOut(messageWidget: MessageWidget): IDisposable {\n\t\tconst dispose = () => {\n\t\t\tmessageWidget.dispose();\n\t\t\tclearTimeout(handle);\n\t\t\tmessageWidget.getDomNode().removeEventListener('animationend', dispose);\n\t\t};\n\t\tconst handle = setTimeout(dispose, 110);\n\t\tmessageWidget.getDomNode().addEventListener('animationend', dispose);\n\t\tmessageWidget.getDomNode().classList.add('fadeOut');\n\t\treturn { dispose };\n\t}\n\n\tconstructor(editor: ICodeEditor, { lineNumber, column }: IPosition, text: HTMLElement | string) {\n\n\t\tthis._editor = editor;\n\t\tthis._editor.revealLinesInCenterIfOutsideViewport(lineNumber, lineNumber, ScrollType.Smooth);\n\t\tthis._position = { lineNumber, column };\n\n\t\tthis._domNode = document.createElement('div');\n\t\tthis._domNode.classList.add('monaco-editor-overlaymessage');\n\t\tthis._domNode.style.marginLeft = '-6px';\n\n\t\tconst anchorTop = document.createElement('div');\n\t\tanchorTop.classList.add('anchor', 'top');\n\t\tthis._domNode.appendChild(anchorTop);\n\n\t\tconst message = document.createElement('div');\n\t\tif (typeof text === 'string') {\n\t\t\tmessage.classList.add('message');\n\t\t\tmessage.textContent = text;\n\t\t} else {\n\t\t\ttext.classList.add('message');\n\t\t\tmessage.appendChild(text);\n\t\t}\n\t\tthis._domNode.appendChild(message);\n\n\t\tconst anchorBottom = document.createElement('div');\n\t\tanchorBottom.classList.add('anchor', 'below');\n\t\tthis._domNode.appendChild(anchorBottom);\n\n\t\tthis._editor.addContentWidget(this);\n\t\tthis._domNode.classList.add('fadeIn');\n\t}\n\n\tdispose() {\n\t\tthis._editor.removeContentWidget(this);\n\t}\n\n\tgetId(): string {\n\t\treturn 'messageoverlay';\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition {\n\t\treturn {\n\t\t\tposition: this._position,\n\t\t\tpreference: [\n\t\t\t\tContentWidgetPositionPreference.ABOVE,\n\t\t\t\tContentWidgetPositionPreference.BELOW,\n\t\t\t],\n\t\t\tpositionAffinity: PositionAffinity.Right,\n\t\t};\n\t}\n\n\tafterRender(position: ContentWidgetPositionPreference | null): void {\n\t\tthis._domNode.classList.toggle('below', position === ContentWidgetPositionPreference.BELOW);\n\t}\n\n}\n\nregisterEditorContribution(MessageController.ID, MessageController, EditorContributionInstantiation.Lazy);\n"],
  "mappings": "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",
  "names": []
}
