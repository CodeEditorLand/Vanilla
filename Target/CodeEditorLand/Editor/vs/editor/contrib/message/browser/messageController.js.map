{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/contrib/message/browser/messageController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderMarkdown } from \"../../../../base/browser/markdownRenderer.js\";\nimport { alert } from \"../../../../base/browser/ui/aria/aria.js\";\nimport { Event } from \"../../../../base/common/event.js\";\nimport {\n\ttype IMarkdownString,\n\tisMarkdownString,\n} from \"../../../../base/common/htmlContent.js\";\nimport { KeyCode } from \"../../../../base/common/keyCodes.js\";\nimport {\n\tDisposableStore,\n\ttype IDisposable,\n\tMutableDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport \"./messageController.css\";\nimport * as dom from \"../../../../base/browser/dom.js\";\nimport * as nls from \"../../../../nls.js\";\nimport {\n\ttype IContextKey,\n\tIContextKeyService,\n\tRawContextKey,\n} from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { KeybindingWeight } from \"../../../../platform/keybinding/common/keybindingsRegistry.js\";\nimport { IOpenerService } from \"../../../../platform/opener/common/opener.js\";\nimport {\n\tContentWidgetPositionPreference,\n\ttype ICodeEditor,\n\ttype IContentWidget,\n\ttype IContentWidgetPosition,\n} from \"../../../browser/editorBrowser.js\";\nimport {\n\tEditorCommand,\n\tEditorContributionInstantiation,\n\tregisterEditorCommand,\n\tregisterEditorContribution,\n} from \"../../../browser/editorExtensions.js\";\nimport { openLinkFromMarkdown } from \"../../../browser/widget/markdownRenderer/browser/markdownRenderer.js\";\nimport type { IPosition } from \"../../../common/core/position.js\";\nimport { Range } from \"../../../common/core/range.js\";\nimport {\n\ttype IEditorContribution,\n\tScrollType,\n} from \"../../../common/editorCommon.js\";\nimport { PositionAffinity } from \"../../../common/model.js\";\n\nexport class MessageController implements IEditorContribution {\n\tpublic static readonly ID = \"editor.contrib.messageController\";\n\n\tstatic readonly MESSAGE_VISIBLE = new RawContextKey<boolean>(\n\t\t\"messageVisible\",\n\t\tfalse,\n\t\tnls.localize(\n\t\t\t\"messageVisible\",\n\t\t\t\"Whether the editor is currently showing an inline message\",\n\t\t),\n\t);\n\n\tstatic get(editor: ICodeEditor): MessageController | null {\n\t\treturn editor.getContribution<MessageController>(MessageController.ID);\n\t}\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _visible: IContextKey<boolean>;\n\tprivate readonly _messageWidget = new MutableDisposable<MessageWidget>();\n\tprivate readonly _messageListeners = new DisposableStore();\n\tprivate _message: { element: HTMLElement; dispose: () => void } | undefined;\n\tprivate _mouseOverMessage = false;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._visible =\n\t\t\tMessageController.MESSAGE_VISIBLE.bindTo(contextKeyService);\n\t}\n\n\tdispose(): void {\n\t\tthis._message?.dispose();\n\t\tthis._messageListeners.dispose();\n\t\tthis._messageWidget.dispose();\n\t\tthis._visible.reset();\n\t}\n\n\tisVisible() {\n\t\treturn this._visible.get();\n\t}\n\n\tshowMessage(message: IMarkdownString | string, position: IPosition): void {\n\t\talert(isMarkdownString(message) ? message.value : message);\n\n\t\tthis._visible.set(true);\n\t\tthis._messageWidget.clear();\n\t\tthis._messageListeners.clear();\n\t\tthis._message = isMarkdownString(message)\n\t\t\t? renderMarkdown(message, {\n\t\t\t\t\tactionHandler: {\n\t\t\t\t\t\tcallback: (url) => {\n\t\t\t\t\t\t\tthis.closeMessage();\n\t\t\t\t\t\t\topenLinkFromMarkdown(\n\t\t\t\t\t\t\t\tthis._openerService,\n\t\t\t\t\t\t\t\turl,\n\t\t\t\t\t\t\t\tisMarkdownString(message)\n\t\t\t\t\t\t\t\t\t? message.isTrusted\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdisposables: this._messageListeners,\n\t\t\t\t\t},\n\t\t\t\t})\n\t\t\t: undefined;\n\t\tthis._messageWidget.value = new MessageWidget(\n\t\t\tthis._editor,\n\t\t\tposition,\n\t\t\ttypeof message === \"string\" ? message : this._message!.element,\n\t\t);\n\n\t\t// close on blur (debounced to allow to tab into the message), cursor, model change, dispose\n\t\tthis._messageListeners.add(\n\t\t\tEvent.debounce(\n\t\t\t\tthis._editor.onDidBlurEditorText,\n\t\t\t\t(last, event) => event,\n\t\t\t\t0,\n\t\t\t)(() => {\n\t\t\t\tif (this._mouseOverMessage) {\n\t\t\t\t\treturn; // override when mouse over message\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\tthis._messageWidget.value &&\n\t\t\t\t\tdom.isAncestor(\n\t\t\t\t\t\tdom.getActiveElement(),\n\t\t\t\t\t\tthis._messageWidget.value.getDomNode(),\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\treturn; // override when focus is inside the message\n\t\t\t\t}\n\n\t\t\t\tthis.closeMessage();\n\t\t\t}),\n\t\t);\n\t\tthis._messageListeners.add(\n\t\t\tthis._editor.onDidChangeCursorPosition(() => this.closeMessage()),\n\t\t);\n\t\tthis._messageListeners.add(\n\t\t\tthis._editor.onDidDispose(() => this.closeMessage()),\n\t\t);\n\t\tthis._messageListeners.add(\n\t\t\tthis._editor.onDidChangeModel(() => this.closeMessage()),\n\t\t);\n\t\tthis._messageListeners.add(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis._messageWidget.value.getDomNode(),\n\t\t\t\tdom.EventType.MOUSE_ENTER,\n\t\t\t\t() => (this._mouseOverMessage = true),\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\t\tthis._messageListeners.add(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis._messageWidget.value.getDomNode(),\n\t\t\t\tdom.EventType.MOUSE_LEAVE,\n\t\t\t\t() => (this._mouseOverMessage = false),\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\t// close on mouse move\n\t\tlet bounds: Range;\n\t\tthis._messageListeners.add(\n\t\t\tthis._editor.onMouseMove((e) => {\n\t\t\t\t// outside the text area\n\t\t\t\tif (!e.target.position) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!bounds) {\n\t\t\t\t\t// define bounding box around position and first mouse occurance\n\t\t\t\t\tbounds = new Range(\n\t\t\t\t\t\tposition.lineNumber - 3,\n\t\t\t\t\t\t1,\n\t\t\t\t\t\te.target.position.lineNumber + 3,\n\t\t\t\t\t\t1,\n\t\t\t\t\t);\n\t\t\t\t} else if (!bounds.containsPosition(e.target.position)) {\n\t\t\t\t\t// check if position is still in bounds\n\t\t\t\t\tthis.closeMessage();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tcloseMessage(): void {\n\t\tthis._visible.reset();\n\t\tthis._messageListeners.clear();\n\t\tif (this._messageWidget.value) {\n\t\t\tthis._messageListeners.add(\n\t\t\t\tMessageWidget.fadeOut(this._messageWidget.value),\n\t\t\t);\n\t\t}\n\t}\n}\n\nconst MessageCommand = EditorCommand.bindToContribution<MessageController>(\n\tMessageController.get,\n);\n\nregisterEditorCommand(\n\tnew MessageCommand({\n\t\tid: \"leaveEditorMessage\",\n\t\tprecondition: MessageController.MESSAGE_VISIBLE,\n\t\thandler: (c) => c.closeMessage(),\n\t\tkbOpts: {\n\t\t\tweight: KeybindingWeight.EditorContrib + 30,\n\t\t\tprimary: KeyCode.Escape,\n\t\t},\n\t}),\n);\n\nclass MessageWidget implements IContentWidget {\n\t// Editor.IContentWidget.allowEditorOverflow\n\treadonly allowEditorOverflow = true;\n\treadonly suppressMouseDown = false;\n\n\tprivate readonly _editor: ICodeEditor;\n\tprivate readonly _position: IPosition;\n\tprivate readonly _domNode: HTMLDivElement;\n\n\tstatic fadeOut(messageWidget: MessageWidget): IDisposable {\n\t\tconst dispose = () => {\n\t\t\tmessageWidget.dispose();\n\t\t\tclearTimeout(handle);\n\t\t\tmessageWidget\n\t\t\t\t.getDomNode()\n\t\t\t\t.removeEventListener(\"animationend\", dispose);\n\t\t};\n\t\tconst handle = setTimeout(dispose, 110);\n\t\tmessageWidget.getDomNode().addEventListener(\"animationend\", dispose);\n\t\tmessageWidget.getDomNode().classList.add(\"fadeOut\");\n\t\treturn { dispose };\n\t}\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t{ lineNumber, column }: IPosition,\n\t\ttext: HTMLElement | string,\n\t) {\n\t\tthis._editor = editor;\n\t\tthis._editor.revealLinesInCenterIfOutsideViewport(\n\t\t\tlineNumber,\n\t\t\tlineNumber,\n\t\t\tScrollType.Smooth,\n\t\t);\n\t\tthis._position = { lineNumber, column };\n\n\t\tthis._domNode = document.createElement(\"div\");\n\t\tthis._domNode.classList.add(\"monaco-editor-overlaymessage\");\n\t\tthis._domNode.style.marginLeft = \"-6px\";\n\n\t\tconst anchorTop = document.createElement(\"div\");\n\t\tanchorTop.classList.add(\"anchor\", \"top\");\n\t\tthis._domNode.appendChild(anchorTop);\n\n\t\tconst message = document.createElement(\"div\");\n\t\tif (typeof text === \"string\") {\n\t\t\tmessage.classList.add(\"message\");\n\t\t\tmessage.textContent = text;\n\t\t} else {\n\t\t\ttext.classList.add(\"message\");\n\t\t\tmessage.appendChild(text);\n\t\t}\n\t\tthis._domNode.appendChild(message);\n\n\t\tconst anchorBottom = document.createElement(\"div\");\n\t\tanchorBottom.classList.add(\"anchor\", \"below\");\n\t\tthis._domNode.appendChild(anchorBottom);\n\n\t\tthis._editor.addContentWidget(this);\n\t\tthis._domNode.classList.add(\"fadeIn\");\n\t}\n\n\tdispose() {\n\t\tthis._editor.removeContentWidget(this);\n\t}\n\n\tgetId(): string {\n\t\treturn \"messageoverlay\";\n\t}\n\n\tgetDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tgetPosition(): IContentWidgetPosition {\n\t\treturn {\n\t\t\tposition: this._position,\n\t\t\tpreference: [\n\t\t\t\tContentWidgetPositionPreference.ABOVE,\n\t\t\t\tContentWidgetPositionPreference.BELOW,\n\t\t\t],\n\t\t\tpositionAffinity: PositionAffinity.Right,\n\t\t};\n\t}\n\n\tafterRender(position: ContentWidgetPositionPreference | null): void {\n\t\tthis._domNode.classList.toggle(\n\t\t\t\"below\",\n\t\t\tposition === ContentWidgetPositionPreference.BELOW,\n\t\t);\n\t}\n}\n\nregisterEditorContribution(\n\tMessageController.ID,\n\tMessageController,\n\tEditorContributionInstantiation.Lazy,\n);\n"],
  "mappings": "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",
  "names": []
}
