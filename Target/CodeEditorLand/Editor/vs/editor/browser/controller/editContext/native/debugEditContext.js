const c="blue",v="red",h="green";class g extends EditContext{_isDebugging=!0;_controlBounds=null;_selectionBounds=null;_characterBounds=null;constructor(e){super(e)}updateText(e,t,n){super.updateText(e,t,n),this.renderDebug()}updateSelection(e,t){super.updateSelection(e,t),this.renderDebug()}updateControlBounds(e){super.updateControlBounds(e),this._controlBounds=e,this.renderDebug()}updateSelectionBounds(e){super.updateSelectionBounds(e),this._selectionBounds=e,this.renderDebug()}updateCharacterBounds(e,t){super.updateCharacterBounds(e,t),this._characterBounds={rangeStart:e,characterBounds:t},this.renderDebug()}attachedElements(){return super.attachedElements()}characterBounds(){return super.characterBounds()}_ontextupdateWrapper=new i("textupdate",this);_ontextformatupdateWrapper=new i("textformatupdate",this);_oncharacterboundsupdateWrapper=new i("characterboundsupdate",this);_oncompositionstartWrapper=new i("compositionstart",this);_oncompositionendWrapper=new i("compositionend",this);get ontextupdate(){return this._ontextupdateWrapper.eventHandler}set ontextupdate(e){this._ontextupdateWrapper.eventHandler=e}get ontextformatupdate(){return this._ontextformatupdateWrapper.eventHandler}set ontextformatupdate(e){this._ontextformatupdateWrapper.eventHandler=e}get oncharacterboundsupdate(){return this._oncharacterboundsupdateWrapper.eventHandler}set oncharacterboundsupdate(e){this._oncharacterboundsupdateWrapper.eventHandler=e}get oncompositionstart(){return this._oncompositionstartWrapper.eventHandler}set oncompositionstart(e){this._oncompositionstartWrapper.eventHandler=e}get oncompositionend(){return this._oncompositionendWrapper.eventHandler}set oncompositionend(e){this._oncompositionendWrapper.eventHandler=e}_listenerMap=new Map;addEventListener(e,t,n){if(!t)return;const s=d=>{this._isDebugging&&this.renderDebug(),typeof t=="function"?t.call(this,d):typeof t=="object"&&"handleEvent"in t&&t.handleEvent(d)};this._listenerMap.set(t,s),super.addEventListener(e,s,n),this.renderDebug()}removeEventListener(e,t,n){if(!t)return;const s=this._listenerMap.get(t);s&&(super.removeEventListener(e,s,n),this._listenerMap.delete(t)),this.renderDebug()}dispatchEvent(e){return super.dispatchEvent(e)}startDebugging(){this._isDebugging=!0,this.renderDebug()}endDebugging(){this._isDebugging=!1,this.renderDebug()}_disposables=[];renderDebug(){if(this._disposables.forEach(e=>e.dispose()),this._disposables=[],!(!this._isDebugging||this._listenerMap.size===0)){if(this._controlBounds&&this._disposables.push(a(this._controlBounds,c)),this._selectionBounds&&this._disposables.push(a(this._selectionBounds,v)),this._characterBounds)for(const e of this._characterBounds.characterBounds)this._disposables.push(a(e,h));this._disposables.push(b(this.text,this.selectionStart,this.selectionEnd))}}}function b(r,e,t){const n=document.createElement("div");n.className="debug-rect-marker",n.style.position="absolute",n.style.zIndex="999999999",n.style.bottom="50px",n.style.left="60px",n.style.backgroundColor="white",n.style.border="1px solid black",n.style.padding="5px",n.style.whiteSpace="pre",n.style.font="12px monospace",n.style.pointerEvents="none";const s=r.substring(0,e),d=r.substring(e,t)||"|",p=r.substring(t)+" ",l=document.createTextNode(s);n.appendChild(l);const o=document.createElement("span");o.style.backgroundColor="yellow",o.appendChild(document.createTextNode(d)),o.style.minWidth="2px",o.style.minHeight="16px",n.appendChild(o);const u=document.createTextNode(p);return n.appendChild(u),document.body.appendChild(n),{dispose:()=>{n.remove()}}}function a(r,e){const t=document.createElement("div");return t.className="debug-rect-marker",t.style.position="absolute",t.style.zIndex="999999999",t.style.outline=`2px solid ${e}`,t.style.pointerEvents="none",t.style.top=r.top+"px",t.style.left=r.left+"px",t.style.width=r.width+"px",t.style.height=r.height+"px",document.body.appendChild(t),{dispose:()=>{t.remove()}}}class i{constructor(e,t){this._eventType=e;this._target=t}_eventHandler=null;get eventHandler(){return this._eventHandler}set eventHandler(e){this._eventHandler&&this._target.removeEventListener(this._eventType,this._eventHandler),this._eventHandler=e,e&&this._target.addEventListener(this._eventType,e)}}export{g as DebugEditContext};
