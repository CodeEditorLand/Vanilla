{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/controller/pointerHandler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserFeatures } from \"../../../base/browser/canIUse.js\";\nimport * as dom from \"../../../base/browser/dom.js\";\nimport {\n\tEventType,\n\tGesture,\n\ttype GestureEvent,\n} from \"../../../base/browser/touch.js\";\nimport { mainWindow } from \"../../../base/browser/window.js\";\nimport { Disposable } from \"../../../base/common/lifecycle.js\";\nimport * as platform from \"../../../base/common/platform.js\";\nimport type { ViewContext } from \"../../common/viewModel/viewContext.js\";\nimport { NavigationCommandRevealType } from \"../coreCommands.js\";\nimport { type IMouseTarget, MouseTargetType } from \"../editorBrowser.js\";\nimport { EditorMouseEvent, EditorPointerEventFactory } from \"../editorDom.js\";\nimport type { ViewController } from \"../view/viewController.js\";\nimport { TextAreaSyntethicEvents } from \"./editContext/textArea/textAreaEditContextInput.js\";\nimport { type IPointerHandlerHelper, MouseHandler } from \"./mouseHandler.js\";\n\n/**\n * Currently only tested on iOS 13/ iPadOS.\n */\nexport class PointerEventHandler extends MouseHandler {\n\tprivate _lastPointerType: string;\n\tconstructor(\n\t\tcontext: ViewContext,\n\t\tviewController: ViewController,\n\t\tviewHelper: IPointerHandlerHelper,\n\t) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis._register(Gesture.addTarget(this.viewHelper.linesContentDomNode));\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Tap,\n\t\t\t\t(e) => this.onTap(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Change,\n\t\t\t\t(e) => this.onChange(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Contextmenu,\n\t\t\t\t(e: MouseEvent) =>\n\t\t\t\t\tthis._onContextMenu(\n\t\t\t\t\t\tnew EditorMouseEvent(\n\t\t\t\t\t\t\te,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tthis.viewHelper.viewDomNode,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t),\n\t\t\t),\n\t\t);\n\n\t\tthis._lastPointerType = \"mouse\";\n\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\t\"pointerdown\",\n\t\t\t\t(e: any) => {\n\t\t\t\t\tconst pointerType = e.pointerType;\n\t\t\t\t\tif (pointerType === \"mouse\") {\n\t\t\t\t\t\tthis._lastPointerType = \"mouse\";\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (pointerType === \"touch\") {\n\t\t\t\t\t\tthis._lastPointerType = \"touch\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._lastPointerType = \"pen\";\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\t// PonterEvents\n\t\tconst pointerEvents = new EditorPointerEventFactory(\n\t\t\tthis.viewHelper.viewDomNode,\n\t\t);\n\n\t\tthis._register(\n\t\t\tpointerEvents.onPointerMove(this.viewHelper.viewDomNode, (e) =>\n\t\t\t\tthis._onMouseMove(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tpointerEvents.onPointerUp(this.viewHelper.viewDomNode, (e) =>\n\t\t\t\tthis._onMouseUp(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tpointerEvents.onPointerLeave(this.viewHelper.viewDomNode, (e) =>\n\t\t\t\tthis._onMouseLeave(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tpointerEvents.onPointerDown(\n\t\t\t\tthis.viewHelper.viewDomNode,\n\t\t\t\t(e, pointerId) => this._onMouseDown(e, pointerId),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate onTap(event: GestureEvent): void {\n\t\tif (\n\t\t\t!event.initialTarget ||\n\t\t\t!this.viewHelper.linesContentDomNode.contains(\n\t\t\t\t<any>event.initialTarget,\n\t\t\t)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tevent.preventDefault();\n\t\tthis.viewHelper.focusTextArea();\n\t\tthis._dispatchGesture(event, /*inSelectionMode*/ false);\n\t}\n\n\tprivate onChange(event: GestureEvent): void {\n\t\tif (this._lastPointerType === \"touch\") {\n\t\t\tthis._context.viewModel.viewLayout.deltaScrollNow(\n\t\t\t\t-event.translationX,\n\t\t\t\t-event.translationY,\n\t\t\t);\n\t\t}\n\t\tif (this._lastPointerType === \"pen\") {\n\t\t\tthis._dispatchGesture(event, /*inSelectionMode*/ true);\n\t\t}\n\t}\n\n\tprivate _dispatchGesture(\n\t\tevent: GestureEvent,\n\t\tinSelectionMode: boolean,\n\t): void {\n\t\tconst target = this._createMouseTarget(\n\t\t\tnew EditorMouseEvent(event, false, this.viewHelper.viewDomNode),\n\t\t\tfalse,\n\t\t);\n\t\tif (target.position) {\n\t\t\tthis.viewController.dispatchMouse({\n\t\t\t\tposition: target.position,\n\t\t\t\tmouseColumn: target.position.column,\n\t\t\t\tstartedOnLineNumbers: false,\n\t\t\t\trevealType: NavigationCommandRevealType.Minimal,\n\t\t\t\tmouseDownCount: event.tapCount,\n\t\t\t\tinSelectionMode,\n\t\t\t\taltKey: false,\n\t\t\t\tctrlKey: false,\n\t\t\t\tmetaKey: false,\n\t\t\t\tshiftKey: false,\n\t\t\t\tleftButton: false,\n\t\t\t\tmiddleButton: false,\n\t\t\t\tonInjectedText:\n\t\t\t\t\ttarget.type === MouseTargetType.CONTENT_TEXT &&\n\t\t\t\t\ttarget.detail.injectedText !== null,\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected override _onMouseDown(\n\t\te: EditorMouseEvent,\n\t\tpointerId: number,\n\t): void {\n\t\tif ((e.browserEvent as any).pointerType === \"touch\") {\n\t\t\treturn;\n\t\t}\n\n\t\tsuper._onMouseDown(e, pointerId);\n\t}\n}\n\nclass TouchHandler extends MouseHandler {\n\tconstructor(\n\t\tcontext: ViewContext,\n\t\tviewController: ViewController,\n\t\tviewHelper: IPointerHandlerHelper,\n\t) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis._register(Gesture.addTarget(this.viewHelper.linesContentDomNode));\n\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Tap,\n\t\t\t\t(e) => this.onTap(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Change,\n\t\t\t\t(e) => this.onChange(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis.viewHelper.linesContentDomNode,\n\t\t\t\tEventType.Contextmenu,\n\t\t\t\t(e: MouseEvent) =>\n\t\t\t\t\tthis._onContextMenu(\n\t\t\t\t\t\tnew EditorMouseEvent(\n\t\t\t\t\t\t\te,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tthis.viewHelper.viewDomNode,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate onTap(event: GestureEvent): void {\n\t\tevent.preventDefault();\n\n\t\tthis.viewHelper.focusTextArea();\n\n\t\tconst target = this._createMouseTarget(\n\t\t\tnew EditorMouseEvent(event, false, this.viewHelper.viewDomNode),\n\t\t\tfalse,\n\t\t);\n\n\t\tif (target.position) {\n\t\t\t// Send the tap event also to the <textarea> (for input purposes)\n\t\t\tconst event = document.createEvent(\"CustomEvent\");\n\t\t\tevent.initEvent(TextAreaSyntethicEvents.Tap, false, true);\n\t\t\tthis.viewHelper.dispatchTextAreaEvent(event);\n\n\t\t\tthis.viewController.moveTo(\n\t\t\t\ttarget.position,\n\t\t\t\tNavigationCommandRevealType.Minimal,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate onChange(e: GestureEvent): void {\n\t\tthis._context.viewModel.viewLayout.deltaScrollNow(\n\t\t\t-e.translationX,\n\t\t\t-e.translationY,\n\t\t);\n\t}\n}\n\nexport class PointerHandler extends Disposable {\n\tprivate readonly handler: MouseHandler;\n\n\tconstructor(\n\t\tcontext: ViewContext,\n\t\tviewController: ViewController,\n\t\tviewHelper: IPointerHandlerHelper,\n\t) {\n\t\tsuper();\n\t\tconst isPhone =\n\t\t\tplatform.isIOS || (platform.isAndroid && platform.isMobile);\n\t\tif (isPhone && BrowserFeatures.pointerEvents) {\n\t\t\tthis.handler = this._register(\n\t\t\t\tnew PointerEventHandler(context, viewController, viewHelper),\n\t\t\t);\n\t\t} else if (mainWindow.TouchEvent) {\n\t\t\tthis.handler = this._register(\n\t\t\t\tnew TouchHandler(context, viewController, viewHelper),\n\t\t\t);\n\t\t} else {\n\t\t\tthis.handler = this._register(\n\t\t\t\tnew MouseHandler(context, viewController, viewHelper),\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic getTargetAtClientPoint(\n\t\tclientX: number,\n\t\tclientY: number,\n\t): IMouseTarget | null {\n\t\treturn this.handler.getTargetAtClientPoint(clientX, clientY);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["event"]
}
