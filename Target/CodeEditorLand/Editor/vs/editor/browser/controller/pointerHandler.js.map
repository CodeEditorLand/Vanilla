{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/controller/pointerHandler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { BrowserFeatures } from '../../../base/browser/canIUse.js';\nimport * as dom from '../../../base/browser/dom.js';\nimport { EventType, Gesture, GestureEvent } from '../../../base/browser/touch.js';\nimport { mainWindow } from '../../../base/browser/window.js';\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport * as platform from '../../../base/common/platform.js';\nimport { IPointerHandlerHelper, MouseHandler } from './mouseHandler.js';\nimport { NavigationCommandRevealType } from '../coreCommands.js';\nimport { IMouseTarget, MouseTargetType } from '../editorBrowser.js';\nimport { EditorMouseEvent, EditorPointerEventFactory } from '../editorDom.js';\nimport { ViewController } from '../view/viewController.js';\nimport { ViewContext } from '../../common/viewModel/viewContext.js';\nimport { TextAreaSyntethicEvents } from './editContext/textArea/textAreaEditContextInput.js';\n\n/**\n * Currently only tested on iOS 13/ iPadOS.\n */\nexport class PointerEventHandler extends MouseHandler {\n\tprivate _lastPointerType: string;\n\tconstructor(context: ViewContext, viewController: ViewController, viewHelper: IPointerHandlerHelper) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis._register(Gesture.addTarget(this.viewHelper.linesContentDomNode));\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Tap, (e) => this.onTap(e)));\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Change, (e) => this.onChange(e)));\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Contextmenu, (e: MouseEvent) => this._onContextMenu(new EditorMouseEvent(e, false, this.viewHelper.viewDomNode), false)));\n\n\t\tthis._lastPointerType = 'mouse';\n\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, 'pointerdown', (e: any) => {\n\t\t\tconst pointerType = e.pointerType;\n\t\t\tif (pointerType === 'mouse') {\n\t\t\t\tthis._lastPointerType = 'mouse';\n\t\t\t\treturn;\n\t\t\t} else if (pointerType === 'touch') {\n\t\t\t\tthis._lastPointerType = 'touch';\n\t\t\t} else {\n\t\t\t\tthis._lastPointerType = 'pen';\n\t\t\t}\n\t\t}));\n\n\t\t// PonterEvents\n\t\tconst pointerEvents = new EditorPointerEventFactory(this.viewHelper.viewDomNode);\n\n\t\tthis._register(pointerEvents.onPointerMove(this.viewHelper.viewDomNode, (e) => this._onMouseMove(e)));\n\t\tthis._register(pointerEvents.onPointerUp(this.viewHelper.viewDomNode, (e) => this._onMouseUp(e)));\n\t\tthis._register(pointerEvents.onPointerLeave(this.viewHelper.viewDomNode, (e) => this._onMouseLeave(e)));\n\t\tthis._register(pointerEvents.onPointerDown(this.viewHelper.viewDomNode, (e, pointerId) => this._onMouseDown(e, pointerId)));\n\t}\n\n\tprivate onTap(event: GestureEvent): void {\n\t\tif (!event.initialTarget || !this.viewHelper.linesContentDomNode.contains(<any>event.initialTarget)) {\n\t\t\treturn;\n\t\t}\n\n\t\tevent.preventDefault();\n\t\tthis.viewHelper.focusTextArea();\n\t\tthis._dispatchGesture(event, /*inSelectionMode*/false);\n\t}\n\n\tprivate onChange(event: GestureEvent): void {\n\t\tif (this._lastPointerType === 'touch') {\n\t\t\tthis._context.viewModel.viewLayout.deltaScrollNow(-event.translationX, -event.translationY);\n\t\t}\n\t\tif (this._lastPointerType === 'pen') {\n\t\t\tthis._dispatchGesture(event, /*inSelectionMode*/true);\n\t\t}\n\t}\n\n\tprivate _dispatchGesture(event: GestureEvent, inSelectionMode: boolean): void {\n\t\tconst target = this._createMouseTarget(new EditorMouseEvent(event, false, this.viewHelper.viewDomNode), false);\n\t\tif (target.position) {\n\t\t\tthis.viewController.dispatchMouse({\n\t\t\t\tposition: target.position,\n\t\t\t\tmouseColumn: target.position.column,\n\t\t\t\tstartedOnLineNumbers: false,\n\t\t\t\trevealType: NavigationCommandRevealType.Minimal,\n\t\t\t\tmouseDownCount: event.tapCount,\n\t\t\t\tinSelectionMode,\n\t\t\t\taltKey: false,\n\t\t\t\tctrlKey: false,\n\t\t\t\tmetaKey: false,\n\t\t\t\tshiftKey: false,\n\t\t\t\tleftButton: false,\n\t\t\t\tmiddleButton: false,\n\t\t\t\tonInjectedText: target.type === MouseTargetType.CONTENT_TEXT && target.detail.injectedText !== null\n\t\t\t});\n\t\t}\n\t}\n\n\tprotected override _onMouseDown(e: EditorMouseEvent, pointerId: number): void {\n\t\tif ((e.browserEvent as any).pointerType === 'touch') {\n\t\t\treturn;\n\t\t}\n\n\t\tsuper._onMouseDown(e, pointerId);\n\t}\n}\n\nclass TouchHandler extends MouseHandler {\n\n\tconstructor(context: ViewContext, viewController: ViewController, viewHelper: IPointerHandlerHelper) {\n\t\tsuper(context, viewController, viewHelper);\n\n\t\tthis._register(Gesture.addTarget(this.viewHelper.linesContentDomNode));\n\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Tap, (e) => this.onTap(e)));\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Change, (e) => this.onChange(e)));\n\t\tthis._register(dom.addDisposableListener(this.viewHelper.linesContentDomNode, EventType.Contextmenu, (e: MouseEvent) => this._onContextMenu(new EditorMouseEvent(e, false, this.viewHelper.viewDomNode), false)));\n\t}\n\n\tprivate onTap(event: GestureEvent): void {\n\t\tevent.preventDefault();\n\n\t\tthis.viewHelper.focusTextArea();\n\n\t\tconst target = this._createMouseTarget(new EditorMouseEvent(event, false, this.viewHelper.viewDomNode), false);\n\n\t\tif (target.position) {\n\t\t\t// Send the tap event also to the <textarea> (for input purposes)\n\t\t\tconst event = document.createEvent('CustomEvent');\n\t\t\tevent.initEvent(TextAreaSyntethicEvents.Tap, false, true);\n\t\t\tthis.viewHelper.dispatchTextAreaEvent(event);\n\n\t\t\tthis.viewController.moveTo(target.position, NavigationCommandRevealType.Minimal);\n\t\t}\n\t}\n\n\tprivate onChange(e: GestureEvent): void {\n\t\tthis._context.viewModel.viewLayout.deltaScrollNow(-e.translationX, -e.translationY);\n\t}\n}\n\nexport class PointerHandler extends Disposable {\n\tprivate readonly handler: MouseHandler;\n\n\tconstructor(context: ViewContext, viewController: ViewController, viewHelper: IPointerHandlerHelper) {\n\t\tsuper();\n\t\tconst isPhone = platform.isIOS || (platform.isAndroid && platform.isMobile);\n\t\tif (isPhone && BrowserFeatures.pointerEvents) {\n\t\t\tthis.handler = this._register(new PointerEventHandler(context, viewController, viewHelper));\n\t\t} else if (mainWindow.TouchEvent) {\n\t\t\tthis.handler = this._register(new TouchHandler(context, viewController, viewHelper));\n\t\t} else {\n\t\t\tthis.handler = this._register(new MouseHandler(context, viewController, viewHelper));\n\t\t}\n\t}\n\n\tpublic getTargetAtClientPoint(clientX: number, clientY: number): IMouseTarget | null {\n\t\treturn this.handler.getTargetAtClientPoint(clientX, clientY);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["event"]
}
