var q=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var A=(m,s,e,t)=>{for(var o=t>1?void 0:t?X(s,e):s,n=m.length-1,i;n>=0;n--)(i=m[n])&&(o=(t?i(s,e,o):i(o))||o);return t&&o&&q(s,e,o),o},f=(m,s)=>(e,t)=>s(e,t,m);import"../../services/markerDecorations.js";import*as w from"../../../../base/browser/dom.js";import"../../../../base/browser/keyboardEvent.js";import"../../../../base/browser/mouseEvent.js";import"../../../../base/common/color.js";import{onUnexpectedError as W}from"../../../../base/common/errors.js";import{createEventDeliveryQueue as Y,Emitter as u}from"../../../../base/common/event.js";import{hash as J}from"../../../../base/common/hash.js";import{Disposable as M,dispose as ee}from"../../../../base/common/lifecycle.js";import{Schemas as k}from"../../../../base/common/network.js";import"./editor.css";import*as B from"../../../../nls.js";import{IAccessibilityService as te}from"../../../../platform/accessibility/common/accessibility.js";import{MenuId as H}from"../../../../platform/actions/common/actions.js";import{ICommandService as oe}from"../../../../platform/commands/common/commands.js";import{IContextKeyService as Q}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as ie}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as ne}from"../../../../platform/instantiation/common/serviceCollection.js";import{INotificationService as re,Severity as se}from"../../../../platform/notification/common/notification.js";import{editorErrorForeground as ae,editorHintForeground as de,editorInfoForeground as le,editorWarningForeground as he}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as ue,registerThemingParticipant as ce}from"../../../../platform/theme/common/themeService.js";import"../../../common/config/editorConfiguration.js";import{EditorOption as _,filterValidationDecorations as U}from"../../../common/config/editorOptions.js";import{CursorColumns as K}from"../../../common/core/cursorColumns.js";import"../../../common/core/dimension.js";import{editorUnnecessaryCodeOpacity as me}from"../../../common/core/editorColorRegistry.js";import{Position as z}from"../../../common/core/position.js";import{Range as I}from"../../../common/core/range.js";import{Selection as O}from"../../../common/core/selection.js";import"../../../common/core/wordHelper.js";import{WordOperations as ge}from"../../../common/cursor/cursorWordOperations.js";import{CursorChangeReason as ve}from"../../../common/cursorEvents.js";import{InternalEditorAction as pe}from"../../../common/editorAction.js";import*as d from"../../../common/editorCommon.js";import{EditorContextKeys as l}from"../../../common/editorContextKeys.js";import{ILanguageConfigurationService as _e}from"../../../common/languages/languageConfigurationRegistry.js";import{EndOfLinePreference as L}from"../../../common/model.js";import{ClassName as T}from"../../../common/model/intervalTree.js";import{ModelDecorationOptions as G}from"../../../common/model/textModel.js";import{ILanguageFeaturesService as De}from"../../../common/services/languageFeatures.js";import"../../../common/textModelEvents.js";import{VerticalRevealType as v}from"../../../common/viewEvents.js";import"../../../common/viewModel.js";import{MonospaceLineBreaksComputerFactory as ye}from"../../../common/viewModel/monospaceLineBreaksComputer.js";import{ViewModel as Ce}from"../../../common/viewModel/viewModelImpl.js";import{OutgoingViewModelEventKind as D}from"../../../common/viewModelEventDispatcher.js";import{applyFontInfo as be}from"../../config/domFontInfo.js";import{EditorConfiguration as fe}from"../../config/editorConfiguration.js";import{TabFocus as $}from"../../config/tabFocus.js";import"../../editorBrowser.js";import{EditorExtensionsRegistry as V}from"../../editorExtensions.js";import{ICodeEditorService as Ie}from"../../services/codeEditorService.js";import{View as Ee}from"../../view.js";import{DOMLineBreaksComputerFactory as we}from"../../view/domLineBreaksComputer.js";import"../../view/viewController.js";import{ViewUserInputEvents as Se}from"../../view/viewUserInputEvents.js";import{CodeEditorContributions as Me}from"./codeEditorContributions.js";let E=class extends M{constructor(e,t,o,n,i,h,r,a,c,y,C,S){super();this.languageConfigurationService=C;i.willCreateCodeEditor();const P={...t};this._domElement=e,this._overflowWidgetsDomNode=P.overflowWidgetsDomNode,delete P.overflowWidgetsDomNode,this._id=++Te,this._decorationTypeKeysToIds={},this._decorationTypeSubtypes={},this._telemetryData=o.telemetryData,this._configuration=this._register(this._createConfiguration(o.isSimpleWidget||!1,o.contextMenuId??(o.isSimpleWidget?H.SimpleEditorContext:H.EditorContext),P,y)),this._register(this._configuration.onDidChange(g=>{this._onDidChangeConfiguration.fire(g);const b=this._configuration.options;if(g.hasChanged(_.layoutInfo)){const R=b.get(_.layoutInfo);this._onDidLayoutChange.fire(R)}})),this._contextKeyService=this._register(r.createScoped(this._domElement)),this._notificationService=c,this._codeEditorService=i,this._commandService=h,this._themeService=a,this._register(new Re(this,this._contextKeyService)),this._register(new We(this,this._contextKeyService,S)),this._instantiationService=this._register(n.createChild(new ne([Q,this._contextKeyService]))),this._modelData=null,this._focusTracker=new Oe(e,this._overflowWidgetsDomNode),this._register(this._focusTracker.onChange(()=>{this._editorWidgetFocus.setValue(this._focusTracker.hasFocus())})),this._contentWidgets={},this._overlayWidgets={},this._glyphMarginWidgets={};let F;Array.isArray(o.contributions)?F=o.contributions:F=V.getEditorContributions(),this._contributions.initialize(this,F,this._instantiationService);for(const g of V.getEditorActions()){if(this._actions.has(g.id)){W(new Error(`Cannot have two actions with the same id ${g.id}`));continue}const b=new pe(g.id,g.label,g.alias,g.metadata,g.precondition??void 0,R=>this._instantiationService.invokeFunction(j=>Promise.resolve(g.runEditorCommand(j,this,R))),this._contextKeyService);this._actions.set(b.id,b)}const N=()=>!this._configuration.options.get(_.readOnly)&&this._configuration.options.get(_.dropIntoEditor).enabled;this._register(new w.DragAndDropObserver(this._domElement,{onDragOver:g=>{if(!N())return;const b=this.getTargetAtClientPoint(g.clientX,g.clientY);b?.position&&this.showDropIndicatorAt(b.position)},onDrop:async g=>{if(!N()||(this.removeDropIndicator(),!g.dataTransfer))return;const b=this.getTargetAtClientPoint(g.clientX,g.clientY);b?.position&&this._onDropIntoEditor.fire({position:b.position,event:g})},onDragLeave:()=>{this.removeDropIndicator()},onDragEnd:()=>{this.removeDropIndicator()}})),this._codeEditorService.addCodeEditor(this)}static dropIntoEditorDecorationOptions=G.register({description:"workbench-dnd-target",className:"dnd-target"});_deliveryQueue=Y();_contributions=this._register(new Me);_onDidDispose=this._register(new u);onDidDispose=this._onDidDispose.event;_onDidChangeModelContent=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelContent=this._onDidChangeModelContent.event;_onDidChangeModelLanguage=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelLanguage=this._onDidChangeModelLanguage.event;_onDidChangeModelLanguageConfiguration=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelLanguageConfiguration=this._onDidChangeModelLanguageConfiguration.event;_onDidChangeModelOptions=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelOptions=this._onDidChangeModelOptions.event;_onDidChangeModelDecorations=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelDecorations=this._onDidChangeModelDecorations.event;_onDidChangeModelTokens=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModelTokens=this._onDidChangeModelTokens.event;_onDidChangeConfiguration=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeConfiguration=this._onDidChangeConfiguration.event;_onWillChangeModel=this._register(new u({deliveryQueue:this._deliveryQueue}));onWillChangeModel=this._onWillChangeModel.event;_onDidChangeModel=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeModel=this._onDidChangeModel.event;_onDidChangeCursorPosition=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeCursorPosition=this._onDidChangeCursorPosition.event;_onDidChangeCursorSelection=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeCursorSelection=this._onDidChangeCursorSelection.event;_onDidAttemptReadOnlyEdit=this._register(new p(this._contributions,this._deliveryQueue));onDidAttemptReadOnlyEdit=this._onDidAttemptReadOnlyEdit.event;_onDidLayoutChange=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidLayoutChange=this._onDidLayoutChange.event;_editorTextFocus=this._register(new Z({deliveryQueue:this._deliveryQueue}));onDidFocusEditorText=this._editorTextFocus.onDidChangeToTrue;onDidBlurEditorText=this._editorTextFocus.onDidChangeToFalse;_editorWidgetFocus=this._register(new Z({deliveryQueue:this._deliveryQueue}));onDidFocusEditorWidget=this._editorWidgetFocus.onDidChangeToTrue;onDidBlurEditorWidget=this._editorWidgetFocus.onDidChangeToFalse;_onWillType=this._register(new p(this._contributions,this._deliveryQueue));onWillType=this._onWillType.event;_onDidType=this._register(new p(this._contributions,this._deliveryQueue));onDidType=this._onDidType.event;_onDidCompositionStart=this._register(new p(this._contributions,this._deliveryQueue));onDidCompositionStart=this._onDidCompositionStart.event;_onDidCompositionEnd=this._register(new p(this._contributions,this._deliveryQueue));onDidCompositionEnd=this._onDidCompositionEnd.event;_onDidPaste=this._register(new p(this._contributions,this._deliveryQueue));onDidPaste=this._onDidPaste.event;_onMouseUp=this._register(new p(this._contributions,this._deliveryQueue));onMouseUp=this._onMouseUp.event;_onMouseDown=this._register(new p(this._contributions,this._deliveryQueue));onMouseDown=this._onMouseDown.event;_onMouseDrag=this._register(new p(this._contributions,this._deliveryQueue));onMouseDrag=this._onMouseDrag.event;_onMouseDrop=this._register(new p(this._contributions,this._deliveryQueue));onMouseDrop=this._onMouseDrop.event;_onMouseDropCanceled=this._register(new p(this._contributions,this._deliveryQueue));onMouseDropCanceled=this._onMouseDropCanceled.event;_onDropIntoEditor=this._register(new p(this._contributions,this._deliveryQueue));onDropIntoEditor=this._onDropIntoEditor.event;_onContextMenu=this._register(new p(this._contributions,this._deliveryQueue));onContextMenu=this._onContextMenu.event;_onMouseMove=this._register(new p(this._contributions,this._deliveryQueue));onMouseMove=this._onMouseMove.event;_onMouseLeave=this._register(new p(this._contributions,this._deliveryQueue));onMouseLeave=this._onMouseLeave.event;_onMouseWheel=this._register(new p(this._contributions,this._deliveryQueue));onMouseWheel=this._onMouseWheel.event;_onKeyUp=this._register(new p(this._contributions,this._deliveryQueue));onKeyUp=this._onKeyUp.event;_onKeyDown=this._register(new p(this._contributions,this._deliveryQueue));onKeyDown=this._onKeyDown.event;_onDidContentSizeChange=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidContentSizeChange=this._onDidContentSizeChange.event;_onDidScrollChange=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidScrollChange=this._onDidScrollChange.event;_onDidChangeViewZones=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeViewZones=this._onDidChangeViewZones.event;_onDidChangeHiddenAreas=this._register(new u({deliveryQueue:this._deliveryQueue}));onDidChangeHiddenAreas=this._onDidChangeHiddenAreas.event;_updateCounter=0;_onBeginUpdate=this._register(new u);onBeginUpdate=this._onBeginUpdate.event;_onEndUpdate=this._register(new u);onEndUpdate=this._onEndUpdate.event;get isSimpleWidget(){return this._configuration.isSimpleWidget}get contextMenuId(){return this._configuration.contextMenuId}_telemetryData;_domElement;_overflowWidgetsDomNode;_id;_configuration;_contributionsDisposable;_actions=new Map;_modelData;_instantiationService;_contextKeyService;get contextKeyService(){return this._contextKeyService}_notificationService;_codeEditorService;_commandService;_themeService;_focusTracker;_contentWidgets;_overlayWidgets;_glyphMarginWidgets;_decorationTypeKeysToIds;_decorationTypeSubtypes;_bannerDomNode=null;_dropIntoEditorDecorations=this.createDecorationsCollection();writeScreenReaderContent(e){this._modelData?.view.writeScreenReaderContent(e)}_createConfiguration(e,t,o,n){return new fe(e,t,o,this._domElement,n)}getId(){return this.getEditorType()+":"+this._id}getEditorType(){return d.EditorType.ICodeEditor}dispose(){this._codeEditorService.removeCodeEditor(this),this._focusTracker.dispose(),this._actions.clear(),this._contentWidgets={},this._overlayWidgets={},this._removeDecorationTypes(),this._postDetachModelCleanup(this._detachModel()),this._onDidDispose.fire(),super.dispose()}invokeWithinContext(e){return this._instantiationService.invokeFunction(e)}updateOptions(e){this._configuration.updateOptions(e||{})}getOptions(){return this._configuration.options}getOption(e){return this._configuration.options.get(e)}getRawOptions(){return this._configuration.getRawOptions()}getOverflowWidgetsDomNode(){return this._overflowWidgetsDomNode}getConfiguredWordAtPosition(e){return this._modelData?ge.getWordAtPosition(this._modelData.model,this._configuration.options.get(_.wordSeparators),this._configuration.options.get(_.wordSegmenterLocales),e):null}getValue(e=null){if(!this._modelData)return"";const t=!!(e&&e.preserveBOM);let o=L.TextDefined;return e&&e.lineEnding&&e.lineEnding===`
`?o=L.LF:e&&e.lineEnding&&e.lineEnding===`\r
`&&(o=L.CRLF),this._modelData.model.getValue(o,t)}setValue(e){try{if(this._beginUpdate(),!this._modelData)return;this._modelData.model.setValue(e)}finally{this._endUpdate()}}getModel(){return this._modelData?this._modelData.model:null}setModel(e=null){try{this._beginUpdate();const t=e;if(this._modelData===null&&t===null||this._modelData&&this._modelData.model===t)return;const o={oldModelUrl:this._modelData?.model.uri||null,newModelUrl:t?.uri||null};this._onWillChangeModel.fire(o);const n=this.hasTextFocus(),i=this._detachModel();this._attachModel(t),n&&this.hasModel()&&this.focus(),this._removeDecorationTypes(),this._onDidChangeModel.fire(o),this._postDetachModelCleanup(i),this._contributionsDisposable=this._contributions.onAfterModelAttached()}finally{this._endUpdate()}}_removeDecorationTypes(){if(this._decorationTypeKeysToIds={},this._decorationTypeSubtypes){for(const e in this._decorationTypeSubtypes){const t=this._decorationTypeSubtypes[e];for(const o in t)this._removeDecorationType(e+"-"+o)}this._decorationTypeSubtypes={}}}getVisibleRanges(){return this._modelData?this._modelData.viewModel.getVisibleRanges():[]}getVisibleRangesPlusViewportAboveBelow(){return this._modelData?this._modelData.viewModel.getVisibleRangesPlusViewportAboveBelow():[]}getWhitespaces(){return this._modelData?this._modelData.viewModel.viewLayout.getWhitespaces():[]}static _getVerticalOffsetAfterPosition(e,t,o,n){const i=e.model.validatePosition({lineNumber:t,column:o}),h=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);return e.viewModel.viewLayout.getVerticalOffsetAfterLineNumber(h.lineNumber,n)}getTopForLineNumber(e,t=!1){return this._modelData?E._getVerticalOffsetForPosition(this._modelData,e,1,t):-1}getTopForPosition(e,t){return this._modelData?E._getVerticalOffsetForPosition(this._modelData,e,t,!1):-1}static _getVerticalOffsetForPosition(e,t,o,n=!1){const i=e.model.validatePosition({lineNumber:t,column:o}),h=e.viewModel.coordinatesConverter.convertModelPositionToViewPosition(i);return e.viewModel.viewLayout.getVerticalOffsetForLineNumber(h.lineNumber,n)}getBottomForLineNumber(e,t=!1){if(!this._modelData)return-1;const o=this._modelData.model.getLineMaxColumn(e);return E._getVerticalOffsetAfterPosition(this._modelData,e,o,t)}setHiddenAreas(e,t){this._modelData?.viewModel.setHiddenAreas(e.map(o=>I.lift(o)),t)}getVisibleColumnFromPosition(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),o=this._modelData.model.getOptions().tabSize;return K.visibleColumnFromColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,o)+1}getStatusbarColumn(e){if(!this._modelData)return e.column;const t=this._modelData.model.validatePosition(e),o=this._modelData.model.getOptions().tabSize;return K.toStatusbarColumn(this._modelData.model.getLineContent(t.lineNumber),t.column,o)}getPosition(){return this._modelData?this._modelData.viewModel.getPosition():null}setPosition(e,t="api"){if(this._modelData){if(!z.isIPosition(e))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,[{selectionStartLineNumber:e.lineNumber,selectionStartColumn:e.column,positionLineNumber:e.lineNumber,positionColumn:e.column}])}}_sendRevealRange(e,t,o,n){if(!this._modelData)return;if(!I.isIRange(e))throw new Error("Invalid arguments");const i=this._modelData.model.validateRange(e),h=this._modelData.viewModel.coordinatesConverter.convertModelRangeToViewRange(i);this._modelData.viewModel.revealRange("api",o,h,t,n)}revealLine(e,t=d.ScrollType.Smooth){this._revealLine(e,v.Simple,t)}revealLineInCenter(e,t=d.ScrollType.Smooth){this._revealLine(e,v.Center,t)}revealLineInCenterIfOutsideViewport(e,t=d.ScrollType.Smooth){this._revealLine(e,v.CenterIfOutsideViewport,t)}revealLineNearTop(e,t=d.ScrollType.Smooth){this._revealLine(e,v.NearTop,t)}_revealLine(e,t,o){if(typeof e!="number")throw new Error("Invalid arguments");this._sendRevealRange(new I(e,1,e,1),t,!1,o)}revealPosition(e,t=d.ScrollType.Smooth){this._revealPosition(e,v.Simple,!0,t)}revealPositionInCenter(e,t=d.ScrollType.Smooth){this._revealPosition(e,v.Center,!0,t)}revealPositionInCenterIfOutsideViewport(e,t=d.ScrollType.Smooth){this._revealPosition(e,v.CenterIfOutsideViewport,!0,t)}revealPositionNearTop(e,t=d.ScrollType.Smooth){this._revealPosition(e,v.NearTop,!0,t)}_revealPosition(e,t,o,n){if(!z.isIPosition(e))throw new Error("Invalid arguments");this._sendRevealRange(new I(e.lineNumber,e.column,e.lineNumber,e.column),t,o,n)}getSelection(){return this._modelData?this._modelData.viewModel.getSelection():null}getSelections(){return this._modelData?this._modelData.viewModel.getSelections():null}setSelection(e,t="api"){const o=O.isISelection(e),n=I.isIRange(e);if(!o&&!n)throw new Error("Invalid arguments");if(o)this._setSelectionImpl(e,t);else if(n){const i={selectionStartLineNumber:e.startLineNumber,selectionStartColumn:e.startColumn,positionLineNumber:e.endLineNumber,positionColumn:e.endColumn};this._setSelectionImpl(i,t)}}_setSelectionImpl(e,t){if(!this._modelData)return;const o=new O(e.selectionStartLineNumber,e.selectionStartColumn,e.positionLineNumber,e.positionColumn);this._modelData.viewModel.setSelections(t,[o])}revealLines(e,t,o=d.ScrollType.Smooth){this._revealLines(e,t,v.Simple,o)}revealLinesInCenter(e,t,o=d.ScrollType.Smooth){this._revealLines(e,t,v.Center,o)}revealLinesInCenterIfOutsideViewport(e,t,o=d.ScrollType.Smooth){this._revealLines(e,t,v.CenterIfOutsideViewport,o)}revealLinesNearTop(e,t,o=d.ScrollType.Smooth){this._revealLines(e,t,v.NearTop,o)}_revealLines(e,t,o,n){if(typeof e!="number"||typeof t!="number")throw new Error("Invalid arguments");this._sendRevealRange(new I(e,1,t,1),o,!1,n)}revealRange(e,t=d.ScrollType.Smooth,o=!1,n=!0){this._revealRange(e,o?v.Center:v.Simple,n,t)}revealRangeInCenter(e,t=d.ScrollType.Smooth){this._revealRange(e,v.Center,!0,t)}revealRangeInCenterIfOutsideViewport(e,t=d.ScrollType.Smooth){this._revealRange(e,v.CenterIfOutsideViewport,!0,t)}revealRangeNearTop(e,t=d.ScrollType.Smooth){this._revealRange(e,v.NearTop,!0,t)}revealRangeNearTopIfOutsideViewport(e,t=d.ScrollType.Smooth){this._revealRange(e,v.NearTopIfOutsideViewport,!0,t)}revealRangeAtTop(e,t=d.ScrollType.Smooth){this._revealRange(e,v.Top,!0,t)}_revealRange(e,t,o,n){if(!I.isIRange(e))throw new Error("Invalid arguments");this._sendRevealRange(I.lift(e),t,o,n)}setSelections(e,t="api",o=ve.NotSet){if(this._modelData){if(!e||e.length===0)throw new Error("Invalid arguments");for(let n=0,i=e.length;n<i;n++)if(!O.isISelection(e[n]))throw new Error("Invalid arguments");this._modelData.viewModel.setSelections(t,e,o)}}getContentWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getContentWidth():-1}getScrollWidth(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollWidth():-1}getScrollLeft(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollLeft():-1}getContentHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getContentHeight():-1}getScrollHeight(){return this._modelData?this._modelData.viewModel.viewLayout.getScrollHeight():-1}getScrollTop(){return this._modelData?this._modelData.viewModel.viewLayout.getCurrentScrollTop():-1}setScrollLeft(e,t=d.ScrollType.Immediate){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollLeft:e},t)}}setScrollTop(e,t=d.ScrollType.Immediate){if(this._modelData){if(typeof e!="number")throw new Error("Invalid arguments");this._modelData.viewModel.viewLayout.setScrollPosition({scrollTop:e},t)}}setScrollPosition(e,t=d.ScrollType.Immediate){this._modelData&&this._modelData.viewModel.viewLayout.setScrollPosition(e,t)}hasPendingScrollAnimation(){return this._modelData?this._modelData.viewModel.viewLayout.hasPendingScrollAnimation():!1}saveViewState(){if(!this._modelData)return null;const e=this._contributions.saveViewState(),t=this._modelData.viewModel.saveCursorState(),o=this._modelData.viewModel.saveState();return{cursorState:t,viewState:o,contributionsState:e}}restoreViewState(e){if(!this._modelData||!this._modelData.hasRealView)return;const t=e;if(t&&t.cursorState&&t.viewState){const o=t.cursorState;Array.isArray(o)?o.length>0&&this._modelData.viewModel.restoreCursorState(o):this._modelData.viewModel.restoreCursorState([o]),this._contributions.restoreViewState(t.contributionsState||{});const n=this._modelData.viewModel.reduceRestoreState(t.viewState);this._modelData.view.restoreState(n)}}handleInitialized(){this._getViewModel()?.visibleLinesStabilized()}onVisible(){this._modelData?.view.refreshFocusState()}onHide(){this._modelData?.view.refreshFocusState(),this._focusTracker.refreshState()}getContribution(e){return this._contributions.get(e)}getActions(){return Array.from(this._actions.values())}getSupportedActions(){let e=this.getActions();return e=e.filter(t=>t.isSupported()),e}getAction(e){return this._actions.get(e)||null}trigger(e,t,o){o=o||{};try{switch(this._beginUpdate(),t){case d.Handler.CompositionStart:this._startComposition();return;case d.Handler.CompositionEnd:this._endComposition(e);return;case d.Handler.Type:{const i=o;this._type(e,i.text||"");return}case d.Handler.ReplacePreviousChar:{const i=o;this._compositionType(e,i.text||"",i.replaceCharCnt||0,0,0);return}case d.Handler.CompositionType:{const i=o;this._compositionType(e,i.text||"",i.replacePrevCharCnt||0,i.replaceNextCharCnt||0,i.positionDelta||0);return}case d.Handler.Paste:{const i=o;this._paste(e,i.text||"",i.pasteOnNewLine||!1,i.multicursorText||null,i.mode||null,i.clipboardEvent);return}case d.Handler.Cut:this._cut(e);return}const n=this.getAction(t);if(n){Promise.resolve(n.run(o)).then(void 0,W);return}if(!this._modelData||this._triggerEditorCommand(e,t,o))return;this._triggerCommand(t,o)}finally{this._endUpdate()}}_triggerCommand(e,t){this._commandService.executeCommand(e,t)}_startComposition(){this._modelData&&(this._modelData.viewModel.startComposition(),this._onDidCompositionStart.fire())}_endComposition(e){this._modelData&&(this._modelData.viewModel.endComposition(e),this._onDidCompositionEnd.fire())}_type(e,t){!this._modelData||t.length===0||(e==="keyboard"&&this._onWillType.fire(t),this._modelData.viewModel.type(t,e),e==="keyboard"&&this._onDidType.fire(t))}_compositionType(e,t,o,n,i){this._modelData&&this._modelData.viewModel.compositionType(t,o,n,i,e)}_paste(e,t,o,n,i,h){if(!this._modelData)return;const r=this._modelData.viewModel,a=r.getSelection().getStartPosition();r.paste(t,o,n,e);const c=r.getSelection().getStartPosition();e==="keyboard"&&this._onDidPaste.fire({clipboardEvent:h,range:new I(a.lineNumber,a.column,c.lineNumber,c.column),languageId:i})}_cut(e){this._modelData&&this._modelData.viewModel.cut(e)}_triggerEditorCommand(e,t,o){const n=V.getEditorCommand(t);return n?(o=o||{},o.source=e,this._instantiationService.invokeFunction(i=>{Promise.resolve(n.runEditorCommand(i,this,o)).then(void 0,W)}),!0):!1}_getViewModel(){return this._modelData?this._modelData.viewModel:null}pushUndoStop(){return!this._modelData||this._configuration.options.get(_.readOnly)?!1:(this._modelData.model.pushStackElement(),!0)}popUndoStop(){return!this._modelData||this._configuration.options.get(_.readOnly)?!1:(this._modelData.model.popStackElement(),!0)}executeEdits(e,t,o){if(!this._modelData||this._configuration.options.get(_.readOnly))return!1;let n;return o?Array.isArray(o)?n=()=>o:n=o:n=()=>null,this._modelData.viewModel.executeEdits(e,t,n),!0}executeCommand(e,t){this._modelData&&this._modelData.viewModel.executeCommand(t,e)}executeCommands(e,t){this._modelData&&this._modelData.viewModel.executeCommands(t,e)}createDecorationsCollection(e){return new Le(this,e)}changeDecorations(e){return this._modelData?this._modelData.model.changeDecorations(e,this._id):null}getLineDecorations(e){return this._modelData?this._modelData.model.getLineDecorations(e,this._id,U(this._configuration.options)):null}getDecorationsInRange(e){return this._modelData?this._modelData.model.getDecorationsInRange(e,this._id,U(this._configuration.options)):null}deltaDecorations(e,t){return this._modelData?e.length===0&&t.length===0?e:this._modelData.model.deltaDecorations(e,t,this._id):[]}removeDecorations(e){!this._modelData||e.length===0||this._modelData.model.changeDecorations(t=>{t.deltaDecorations(e,[])})}setDecorationsByType(e,t,o){const n={},i=this._decorationTypeSubtypes[t]||{};this._decorationTypeSubtypes[t]=n;const h=[];for(const a of o){let c=t;if(a.renderOptions){const C=J(a.renderOptions).toString(16);c=t+"-"+C,!i[C]&&!n[C]&&this._registerDecorationType(e,c,a.renderOptions,t),n[C]=!0}const y=this._resolveDecorationOptions(c,!!a.hoverMessage);a.hoverMessage&&(y.hoverMessage=a.hoverMessage),h.push({range:a.range,options:y})}for(const a in i)n[a]||this._removeDecorationType(t+"-"+a);const r=this._decorationTypeKeysToIds[t]||[];this.changeDecorations(a=>this._decorationTypeKeysToIds[t]=a.deltaDecorations(r,h))}setDecorationsByTypeFast(e,t){const o=this._decorationTypeSubtypes[e]||{};for(const r in o)this._removeDecorationType(e+"-"+r);this._decorationTypeSubtypes[e]={};const n=G.createDynamic(this._resolveDecorationOptions(e,!1)),i=new Array(t.length);for(let r=0,a=t.length;r<a;r++)i[r]={range:t[r],options:n};const h=this._decorationTypeKeysToIds[e]||[];this.changeDecorations(r=>this._decorationTypeKeysToIds[e]=r.deltaDecorations(h,i))}removeDecorationsByType(e){const t=this._decorationTypeKeysToIds[e];t&&this.changeDecorations(o=>o.deltaDecorations(t,[])),this._decorationTypeKeysToIds.hasOwnProperty(e)&&delete this._decorationTypeKeysToIds[e],this._decorationTypeSubtypes.hasOwnProperty(e)&&delete this._decorationTypeSubtypes[e]}getLayoutInfo(){return this._configuration.options.get(_.layoutInfo)}createOverviewRuler(e){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.createOverviewRuler(e)}getContainerDomNode(){return this._domElement}getDomNode(){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.domNode.domNode}delegateVerticalScrollbarPointerDown(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateVerticalScrollbarPointerDown(e)}delegateScrollFromMouseWheelEvent(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.delegateScrollFromMouseWheelEvent(e)}layout(e,t=!1){this._configuration.observeContainer(e),t||this.render()}focus(){!this._modelData||!this._modelData.hasRealView||this._modelData.view.focus()}hasTextFocus(){return!this._modelData||!this._modelData.hasRealView?!1:this._modelData.view.isFocused()}hasWidgetFocus(){return this._focusTracker&&this._focusTracker.hasFocus()}addContentWidget(e){const t={widget:e,position:e.getPosition()};this._contentWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a content widget with the same id:"+e.getId()),this._contentWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addContentWidget(t)}layoutContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const o=this._contentWidgets[t];o.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutContentWidget(o)}}removeContentWidget(e){const t=e.getId();if(this._contentWidgets.hasOwnProperty(t)){const o=this._contentWidgets[t];delete this._contentWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeContentWidget(o)}}addOverlayWidget(e){const t={widget:e,position:e.getPosition()};this._overlayWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting an overlay widget with the same id."),this._overlayWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addOverlayWidget(t)}layoutOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const o=this._overlayWidgets[t];o.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutOverlayWidget(o)}}removeOverlayWidget(e){const t=e.getId();if(this._overlayWidgets.hasOwnProperty(t)){const o=this._overlayWidgets[t];delete this._overlayWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeOverlayWidget(o)}}addGlyphMarginWidget(e){const t={widget:e,position:e.getPosition()};this._glyphMarginWidgets.hasOwnProperty(e.getId())&&console.warn("Overwriting a glyph margin widget with the same id."),this._glyphMarginWidgets[e.getId()]=t,this._modelData&&this._modelData.hasRealView&&this._modelData.view.addGlyphMarginWidget(t)}layoutGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const o=this._glyphMarginWidgets[t];o.position=e.getPosition(),this._modelData&&this._modelData.hasRealView&&this._modelData.view.layoutGlyphMarginWidget(o)}}removeGlyphMarginWidget(e){const t=e.getId();if(this._glyphMarginWidgets.hasOwnProperty(t)){const o=this._glyphMarginWidgets[t];delete this._glyphMarginWidgets[t],this._modelData&&this._modelData.hasRealView&&this._modelData.view.removeGlyphMarginWidget(o)}}changeViewZones(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.change(e)}getTargetAtClientPoint(e,t){return!this._modelData||!this._modelData.hasRealView?null:this._modelData.view.getTargetAtClientPoint(e,t)}getScrolledVisiblePosition(e){if(!this._modelData||!this._modelData.hasRealView)return null;const t=this._modelData.model.validatePosition(e),o=this._configuration.options,n=o.get(_.layoutInfo),i=E._getVerticalOffsetForPosition(this._modelData,t.lineNumber,t.column)-this.getScrollTop(),h=this._modelData.view.getOffsetForColumn(t.lineNumber,t.column)+n.glyphMarginWidth+n.lineNumbersWidth+n.decorationsWidth-this.getScrollLeft();return{top:i,left:h,height:o.get(_.lineHeight)}}getOffsetForColumn(e,t){return!this._modelData||!this._modelData.hasRealView?-1:this._modelData.view.getOffsetForColumn(e,t)}render(e=!1){!this._modelData||!this._modelData.hasRealView||this._modelData.viewModel.batchEvents(()=>{this._modelData.view.render(!0,e)})}setAriaOptions(e){!this._modelData||!this._modelData.hasRealView||this._modelData.view.setAriaOptions(e)}applyFontInfo(e){be(e,this._configuration.options.get(_.fontInfo))}setBanner(e,t){this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),this._bannerDomNode=e,this._configuration.setReservedHeight(e?t:0),this._bannerDomNode&&this._domElement.prepend(this._bannerDomNode)}_attachModel(e){if(!e){this._modelData=null;return}const t=[];this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._configuration.setIsDominatedByLongLines(e.isDominatedByLongLines()),this._configuration.setModelLineCount(e.getLineCount());const o=e.onBeforeAttached(),n=new Ce(this._id,this._configuration,e,we.create(w.getWindow(this._domElement)),ye.create(this._configuration.options),r=>w.scheduleAtNextAnimationFrame(w.getWindow(this._domElement),r),this.languageConfigurationService,this._themeService,o,{batchChanges:r=>{try{return this._beginUpdate(),r()}finally{this._endUpdate()}}});t.push(e.onWillDispose(()=>this.setModel(null))),t.push(n.onEvent(r=>{switch(r.kind){case D.ContentSizeChanged:this._onDidContentSizeChange.fire(r);break;case D.FocusChanged:this._editorTextFocus.setValue(r.hasFocus);break;case D.ScrollChanged:this._onDidScrollChange.fire(r);break;case D.ViewZonesChanged:this._onDidChangeViewZones.fire();break;case D.HiddenAreasChanged:this._onDidChangeHiddenAreas.fire();break;case D.ReadOnlyEditAttempt:this._onDidAttemptReadOnlyEdit.fire();break;case D.CursorStateChanged:{if(r.reachedMaxCursorCount){const C=this.getOption(_.multiCursorLimit),S=B.localize("cursors.maximum","The number of cursors has been limited to {0}. Consider using [find and replace](https://code.visualstudio.com/docs/editor/codebasics#_find-and-replace) for larger changes or increase the editor multi cursor limit setting.",C);this._notificationService.prompt(se.Warning,S,[{label:"Find and Replace",run:()=>{this._commandService.executeCommand("editor.action.startFindReplaceAction")}},{label:B.localize("goToSetting","Increase Multi Cursor Limit"),run:()=>{this._commandService.executeCommand("workbench.action.openSettings2",{query:"editor.multiCursorLimit"})}}])}const a=[];for(let C=0,S=r.selections.length;C<S;C++)a[C]=r.selections[C].getPosition();const c={position:a[0],secondaryPositions:a.slice(1),reason:r.reason,source:r.source};this._onDidChangeCursorPosition.fire(c);const y={selection:r.selections[0],secondarySelections:r.selections.slice(1),modelVersionId:r.modelVersionId,oldSelections:r.oldSelections,oldModelVersionId:r.oldModelVersionId,source:r.source,reason:r.reason};this._onDidChangeCursorSelection.fire(y);break}case D.ModelDecorationsChanged:this._onDidChangeModelDecorations.fire(r.event);break;case D.ModelLanguageChanged:this._domElement.setAttribute("data-mode-id",e.getLanguageId()),this._onDidChangeModelLanguage.fire(r.event);break;case D.ModelLanguageConfigurationChanged:this._onDidChangeModelLanguageConfiguration.fire(r.event);break;case D.ModelContentChanged:this._onDidChangeModelContent.fire(r.event);break;case D.ModelOptionsChanged:this._onDidChangeModelOptions.fire(r.event);break;case D.ModelTokensChanged:this._onDidChangeModelTokens.fire(r.event);break}}));const[i,h]=this._createView(n);if(h){this._domElement.appendChild(i.domNode.domNode);let r=Object.keys(this._contentWidgets);for(let a=0,c=r.length;a<c;a++){const y=r[a];i.addContentWidget(this._contentWidgets[y])}r=Object.keys(this._overlayWidgets);for(let a=0,c=r.length;a<c;a++){const y=r[a];i.addOverlayWidget(this._overlayWidgets[y])}r=Object.keys(this._glyphMarginWidgets);for(let a=0,c=r.length;a<c;a++){const y=r[a];i.addGlyphMarginWidget(this._glyphMarginWidgets[y])}i.render(!1,!0),i.domNode.domNode.setAttribute("data-uri",e.uri.toString())}this._modelData=new Pe(e,n,i,h,t,o)}_createView(e){let t;this.isSimpleWidget?t={paste:(i,h,r,a)=>{this._paste("keyboard",i,h,r,a)},type:i=>{this._type("keyboard",i)},compositionType:(i,h,r,a)=>{this._compositionType("keyboard",i,h,r,a)},startComposition:()=>{this._startComposition()},endComposition:()=>{this._endComposition("keyboard")},cut:()=>{this._cut("keyboard")}}:t={paste:(i,h,r,a)=>{const c={text:i,pasteOnNewLine:h,multicursorText:r,mode:a};this._commandService.executeCommand(d.Handler.Paste,c)},type:i=>{const h={text:i};this._commandService.executeCommand(d.Handler.Type,h)},compositionType:(i,h,r,a)=>{if(r||a){const c={text:i,replacePrevCharCnt:h,replaceNextCharCnt:r,positionDelta:a};this._commandService.executeCommand(d.Handler.CompositionType,c)}else{const c={text:i,replaceCharCnt:h};this._commandService.executeCommand(d.Handler.ReplacePreviousChar,c)}},startComposition:()=>{this._commandService.executeCommand(d.Handler.CompositionStart,{})},endComposition:()=>{this._commandService.executeCommand(d.Handler.CompositionEnd,{})},cut:()=>{this._commandService.executeCommand(d.Handler.Cut,{})}};const o=new Se(e.coordinatesConverter);return o.onKeyDown=i=>this._onKeyDown.fire(i),o.onKeyUp=i=>this._onKeyUp.fire(i),o.onContextMenu=i=>this._onContextMenu.fire(i),o.onMouseMove=i=>this._onMouseMove.fire(i),o.onMouseLeave=i=>this._onMouseLeave.fire(i),o.onMouseDown=i=>this._onMouseDown.fire(i),o.onMouseUp=i=>this._onMouseUp.fire(i),o.onMouseDrag=i=>this._onMouseDrag.fire(i),o.onMouseDrop=i=>this._onMouseDrop.fire(i),o.onMouseDropCanceled=i=>this._onMouseDropCanceled.fire(i),o.onMouseWheel=i=>this._onMouseWheel.fire(i),[new Ee(t,this._configuration,this._themeService.getColorTheme(),e,o,this._overflowWidgetsDomNode,this._instantiationService),!0]}_postDetachModelCleanup(e){e?.removeAllDecorationsWithOwnerId(this._id)}_detachModel(){if(this._contributionsDisposable?.dispose(),this._contributionsDisposable=void 0,!this._modelData)return null;const e=this._modelData.model,t=this._modelData.hasRealView?this._modelData.view.domNode.domNode:null;return this._modelData.dispose(),this._modelData=null,this._domElement.removeAttribute("data-mode-id"),t&&this._domElement.contains(t)&&t.remove(),this._bannerDomNode&&this._domElement.contains(this._bannerDomNode)&&this._bannerDomNode.remove(),e}_registerDecorationType(e,t,o,n){this._codeEditorService.registerDecorationType(e,t,o,n,this)}_removeDecorationType(e){this._codeEditorService.removeDecorationType(e)}_resolveDecorationOptions(e,t){return this._codeEditorService.resolveDecorationOptions(e,t)}getTelemetryData(){return this._telemetryData}hasModel(){return this._modelData!==null}showDropIndicatorAt(e){const t=[{range:new I(e.lineNumber,e.column,e.lineNumber,e.column),options:E.dropIntoEditorDecorationOptions}];this._dropIntoEditorDecorations.set(t),this.revealPosition(e,d.ScrollType.Immediate)}removeDropIndicator(){this._dropIntoEditorDecorations.clear()}setContextValue(e,t){this._contextKeyService.createKey(e,t)}_beginUpdate(){this._updateCounter++,this._updateCounter===1&&this._onBeginUpdate.fire()}_endUpdate(){this._updateCounter--,this._updateCounter===0&&this._onEndUpdate.fire()}};E=A([f(3,ie),f(4,Ie),f(5,oe),f(6,Q),f(7,ue),f(8,re),f(9,te),f(10,_e),f(11,De)],E);let Te=0;class Pe{constructor(s,e,t,o,n,i){this.model=s;this.viewModel=e;this.view=t;this.hasRealView=o;this.listenersToRemove=n;this.attachedView=i}dispose(){ee(this.listenersToRemove),this.model.onBeforeDetached(this.attachedView),this.hasRealView&&this.view.dispose(),this.viewModel.dispose()}}var Fe=(t=>(t[t.NotSet=0]="NotSet",t[t.False=1]="False",t[t.True=2]="True",t))(Fe||{});class Z extends M{constructor(e){super();this._emitterOptions=e;this._value=0}_onDidChangeToTrue=this._register(new u(this._emitterOptions));onDidChangeToTrue=this._onDidChangeToTrue.event;_onDidChangeToFalse=this._register(new u(this._emitterOptions));onDidChangeToFalse=this._onDidChangeToFalse.event;_value;setValue(e){const t=e?2:1;this._value!==t&&(this._value=t,this._value===2?this._onDidChangeToTrue.fire():this._value===1&&this._onDidChangeToFalse.fire())}}class p extends u{constructor(e,t){super({deliveryQueue:t});this._contributions=e}fire(e){this._contributions.onBeforeInteractionEvent(),super.fire(e)}}class Re extends M{_editor;_editorSimpleInput;_editorFocus;_textInputFocus;_editorTextFocus;_tabMovesFocus;_editorReadonly;_inDiffEditor;_editorColumnSelection;_hasMultipleSelections;_hasNonEmptySelection;_canUndo;_canRedo;constructor(s,e){super(),this._editor=s,e.createKey("editorId",s.getId()),this._editorSimpleInput=l.editorSimpleInput.bindTo(e),this._editorFocus=l.focus.bindTo(e),this._textInputFocus=l.textInputFocus.bindTo(e),this._editorTextFocus=l.editorTextFocus.bindTo(e),this._tabMovesFocus=l.tabMovesFocus.bindTo(e),this._editorReadonly=l.readOnly.bindTo(e),this._inDiffEditor=l.inDiffEditor.bindTo(e),this._editorColumnSelection=l.columnSelection.bindTo(e),this._hasMultipleSelections=l.hasMultipleSelections.bindTo(e),this._hasNonEmptySelection=l.hasNonEmptySelection.bindTo(e),this._canUndo=l.canUndo.bindTo(e),this._canRedo=l.canRedo.bindTo(e),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromConfig())),this._register(this._editor.onDidChangeCursorSelection(()=>this._updateFromSelection())),this._register(this._editor.onDidFocusEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorWidget(()=>this._updateFromFocus())),this._register(this._editor.onDidFocusEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidBlurEditorText(()=>this._updateFromFocus())),this._register(this._editor.onDidChangeModel(()=>this._updateFromModel())),this._register(this._editor.onDidChangeConfiguration(()=>this._updateFromModel())),this._register($.onDidChangeTabFocus(t=>this._tabMovesFocus.set(t))),this._updateFromConfig(),this._updateFromSelection(),this._updateFromFocus(),this._updateFromModel(),this._editorSimpleInput.set(this._editor.isSimpleWidget)}_updateFromConfig(){const s=this._editor.getOptions();this._tabMovesFocus.set($.getTabFocusMode()),this._editorReadonly.set(s.get(_.readOnly)),this._inDiffEditor.set(s.get(_.inDiffEditor)),this._editorColumnSelection.set(s.get(_.columnSelection))}_updateFromSelection(){const s=this._editor.getSelections();s?(this._hasMultipleSelections.set(s.length>1),this._hasNonEmptySelection.set(s.some(e=>!e.isEmpty()))):(this._hasMultipleSelections.reset(),this._hasNonEmptySelection.reset())}_updateFromFocus(){this._editorFocus.set(this._editor.hasWidgetFocus()&&!this._editor.isSimpleWidget),this._editorTextFocus.set(this._editor.hasTextFocus()&&!this._editor.isSimpleWidget),this._textInputFocus.set(this._editor.hasTextFocus())}_updateFromModel(){const s=this._editor.getModel();this._canUndo.set(!!(s&&s.canUndo())),this._canRedo.set(!!(s&&s.canRedo()))}}class We extends M{constructor(e,t,o){super();this._editor=e;this._contextKeyService=t;this._languageFeaturesService=o;this._langId=l.languageId.bindTo(t),this._hasCompletionItemProvider=l.hasCompletionItemProvider.bindTo(t),this._hasCodeActionsProvider=l.hasCodeActionsProvider.bindTo(t),this._hasCodeLensProvider=l.hasCodeLensProvider.bindTo(t),this._hasDefinitionProvider=l.hasDefinitionProvider.bindTo(t),this._hasDeclarationProvider=l.hasDeclarationProvider.bindTo(t),this._hasImplementationProvider=l.hasImplementationProvider.bindTo(t),this._hasTypeDefinitionProvider=l.hasTypeDefinitionProvider.bindTo(t),this._hasHoverProvider=l.hasHoverProvider.bindTo(t),this._hasDocumentHighlightProvider=l.hasDocumentHighlightProvider.bindTo(t),this._hasDocumentSymbolProvider=l.hasDocumentSymbolProvider.bindTo(t),this._hasReferenceProvider=l.hasReferenceProvider.bindTo(t),this._hasRenameProvider=l.hasRenameProvider.bindTo(t),this._hasSignatureHelpProvider=l.hasSignatureHelpProvider.bindTo(t),this._hasInlayHintsProvider=l.hasInlayHintsProvider.bindTo(t),this._hasDocumentFormattingProvider=l.hasDocumentFormattingProvider.bindTo(t),this._hasDocumentSelectionFormattingProvider=l.hasDocumentSelectionFormattingProvider.bindTo(t),this._hasMultipleDocumentFormattingProvider=l.hasMultipleDocumentFormattingProvider.bindTo(t),this._hasMultipleDocumentSelectionFormattingProvider=l.hasMultipleDocumentSelectionFormattingProvider.bindTo(t),this._isInEmbeddedEditor=l.isInEmbeddedEditor.bindTo(t);const n=()=>this._update();this._register(e.onDidChangeModel(n)),this._register(e.onDidChangeModelLanguage(n)),this._register(o.completionProvider.onDidChange(n)),this._register(o.codeActionProvider.onDidChange(n)),this._register(o.codeLensProvider.onDidChange(n)),this._register(o.definitionProvider.onDidChange(n)),this._register(o.declarationProvider.onDidChange(n)),this._register(o.implementationProvider.onDidChange(n)),this._register(o.typeDefinitionProvider.onDidChange(n)),this._register(o.hoverProvider.onDidChange(n)),this._register(o.documentHighlightProvider.onDidChange(n)),this._register(o.documentSymbolProvider.onDidChange(n)),this._register(o.referenceProvider.onDidChange(n)),this._register(o.renameProvider.onDidChange(n)),this._register(o.documentFormattingEditProvider.onDidChange(n)),this._register(o.documentRangeFormattingEditProvider.onDidChange(n)),this._register(o.signatureHelpProvider.onDidChange(n)),this._register(o.inlayHintsProvider.onDidChange(n)),n()}_langId;_hasCompletionItemProvider;_hasCodeActionsProvider;_hasCodeLensProvider;_hasDefinitionProvider;_hasDeclarationProvider;_hasImplementationProvider;_hasTypeDefinitionProvider;_hasHoverProvider;_hasDocumentHighlightProvider;_hasDocumentSymbolProvider;_hasReferenceProvider;_hasRenameProvider;_hasDocumentFormattingProvider;_hasDocumentSelectionFormattingProvider;_hasMultipleDocumentFormattingProvider;_hasMultipleDocumentSelectionFormattingProvider;_hasSignatureHelpProvider;_hasInlayHintsProvider;_isInEmbeddedEditor;dispose(){super.dispose()}reset(){this._contextKeyService.bufferChangeEvents(()=>{this._langId.reset(),this._hasCompletionItemProvider.reset(),this._hasCodeActionsProvider.reset(),this._hasCodeLensProvider.reset(),this._hasDefinitionProvider.reset(),this._hasDeclarationProvider.reset(),this._hasImplementationProvider.reset(),this._hasTypeDefinitionProvider.reset(),this._hasHoverProvider.reset(),this._hasDocumentHighlightProvider.reset(),this._hasDocumentSymbolProvider.reset(),this._hasReferenceProvider.reset(),this._hasRenameProvider.reset(),this._hasDocumentFormattingProvider.reset(),this._hasDocumentSelectionFormattingProvider.reset(),this._hasSignatureHelpProvider.reset(),this._isInEmbeddedEditor.reset()})}_update(){const e=this._editor.getModel();if(!e){this.reset();return}this._contextKeyService.bufferChangeEvents(()=>{this._langId.set(e.getLanguageId()),this._hasCompletionItemProvider.set(this._languageFeaturesService.completionProvider.has(e)),this._hasCodeActionsProvider.set(this._languageFeaturesService.codeActionProvider.has(e)),this._hasCodeLensProvider.set(this._languageFeaturesService.codeLensProvider.has(e)),this._hasDefinitionProvider.set(this._languageFeaturesService.definitionProvider.has(e)),this._hasDeclarationProvider.set(this._languageFeaturesService.declarationProvider.has(e)),this._hasImplementationProvider.set(this._languageFeaturesService.implementationProvider.has(e)),this._hasTypeDefinitionProvider.set(this._languageFeaturesService.typeDefinitionProvider.has(e)),this._hasHoverProvider.set(this._languageFeaturesService.hoverProvider.has(e)),this._hasDocumentHighlightProvider.set(this._languageFeaturesService.documentHighlightProvider.has(e)),this._hasDocumentSymbolProvider.set(this._languageFeaturesService.documentSymbolProvider.has(e)),this._hasReferenceProvider.set(this._languageFeaturesService.referenceProvider.has(e)),this._hasRenameProvider.set(this._languageFeaturesService.renameProvider.has(e)),this._hasSignatureHelpProvider.set(this._languageFeaturesService.signatureHelpProvider.has(e)),this._hasInlayHintsProvider.set(this._languageFeaturesService.inlayHintsProvider.has(e)),this._hasDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.has(e)||this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.has(e)),this._hasMultipleDocumentFormattingProvider.set(this._languageFeaturesService.documentFormattingEditProvider.all(e).length+this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._hasMultipleDocumentSelectionFormattingProvider.set(this._languageFeaturesService.documentRangeFormattingEditProvider.all(e).length>1),this._isInEmbeddedEditor.set(e.uri.scheme===k.walkThroughSnippet||e.uri.scheme===k.vscodeChatCodeBlock)})}}class Oe extends M{_hasDomElementFocus;_domFocusTracker;_overflowWidgetsDomNode;_onChange=this._register(new u);onChange=this._onChange.event;_overflowWidgetsDomNodeHasFocus;_hadFocus=void 0;constructor(s,e){super(),this._hasDomElementFocus=!1,this._domFocusTracker=this._register(w.trackFocus(s)),this._overflowWidgetsDomNodeHasFocus=!1,this._register(this._domFocusTracker.onDidFocus(()=>{this._hasDomElementFocus=!0,this._update()})),this._register(this._domFocusTracker.onDidBlur(()=>{this._hasDomElementFocus=!1,this._update()})),e&&(this._overflowWidgetsDomNode=this._register(w.trackFocus(e)),this._register(this._overflowWidgetsDomNode.onDidFocus(()=>{this._overflowWidgetsDomNodeHasFocus=!0,this._update()})),this._register(this._overflowWidgetsDomNode.onDidBlur(()=>{this._overflowWidgetsDomNodeHasFocus=!1,this._update()})))}_update(){const s=this._hasDomElementFocus||this._overflowWidgetsDomNodeHasFocus;this._hadFocus!==s&&(this._hadFocus=s,this._onChange.fire(void 0))}hasFocus(){return this._hadFocus??!1}refreshState(){this._domFocusTracker.refreshState(),this._overflowWidgetsDomNode?.refreshState?.()}}class Le{constructor(s,e){this._editor=s;Array.isArray(e)&&e.length>0&&this.set(e)}_decorationIds=[];_isChangingDecorations=!1;get length(){return this._decorationIds.length}onDidChange(s,e,t){return this._editor.onDidChangeModelDecorations(o=>{this._isChangingDecorations||s.call(e,o)},t)}getRange(s){return!this._editor.hasModel()||s>=this._decorationIds.length?null:this._editor.getModel().getDecorationRange(this._decorationIds[s])}getRanges(){if(!this._editor.hasModel())return[];const s=this._editor.getModel(),e=[];for(const t of this._decorationIds){const o=s.getDecorationRange(t);o&&e.push(o)}return e}has(s){return this._decorationIds.includes(s.id)}clear(){this._decorationIds.length!==0&&this.set([])}set(s){try{this._isChangingDecorations=!0,this._editor.changeDecorations(e=>{this._decorationIds=e.deltaDecorations(this._decorationIds,s)})}finally{this._isChangingDecorations=!1}return this._decorationIds}append(s){let e=[];try{this._isChangingDecorations=!0,this._editor.changeDecorations(t=>{e=t.deltaDecorations([],s),this._decorationIds=this._decorationIds.concat(e)})}finally{this._isChangingDecorations=!1}return e}}const Ve=encodeURIComponent("<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 6 3' enable-background='new 0 0 6 3' height='3' width='6'><g fill='"),xe=encodeURIComponent("'><polygon points='5.5,0 2.5,3 1.1,3 4.1,0'/><polygon points='4,0 6,2 6,0.6 5.4,0'/><polygon points='0,2 1,3 2.4,3 0,0.6'/></g></svg>");function x(m){return Ve+encodeURIComponent(m.toString())+xe}const Ne=encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" height="3" width="12"><g fill="'),Ae=encodeURIComponent('"><circle cx="1" cy="1" r="1"/><circle cx="5" cy="1" r="1"/><circle cx="9" cy="1" r="1"/></g></svg>');function ke(m){return Ne+encodeURIComponent(m.toString())+Ae}ce((m,s)=>{const e=m.getColor(ae);e&&s.addRule(`.monaco-editor .${T.EditorErrorDecoration} { background: url("data:image/svg+xml,${x(e)}") repeat-x bottom left; }`);const t=m.getColor(he);t&&s.addRule(`.monaco-editor .${T.EditorWarningDecoration} { background: url("data:image/svg+xml,${x(t)}") repeat-x bottom left; }`);const o=m.getColor(le);o&&s.addRule(`.monaco-editor .${T.EditorInfoDecoration} { background: url("data:image/svg+xml,${x(o)}") repeat-x bottom left; }`);const n=m.getColor(de);n&&s.addRule(`.monaco-editor .${T.EditorHintDecoration} { background: url("data:image/svg+xml,${ke(n)}") no-repeat bottom left; }`);const i=m.getColor(me);i&&s.addRule(`.monaco-editor.showUnused .${T.EditorUnnecessaryInlineDecoration} { opacity: ${i.rgba.a}; }`)});export{Z as BooleanEventEmitter,E as CodeEditorWidget,We as EditorModeContext};
