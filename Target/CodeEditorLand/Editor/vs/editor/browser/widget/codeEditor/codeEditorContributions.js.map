{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/widget/codeEditor/codeEditorContributions.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getWindow, runWhenWindowIdle } from '../../../../base/browser/dom.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Disposable, DisposableMap, IDisposable } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../editorBrowser.js';\nimport { EditorContributionInstantiation, IEditorContributionDescription } from '../../editorExtensions.js';\nimport { IEditorContribution } from '../../../common/editorCommon.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\n\nexport class CodeEditorContributions extends Disposable {\n\n\tprivate _editor: ICodeEditor | null = null;\n\tprivate _instantiationService: IInstantiationService | null = null;\n\n\t/**\n\t * Contains all instantiated contributions.\n\t */\n\tprivate readonly _instances = this._register(new DisposableMap<string, IEditorContribution>());\n\t/**\n\t * Contains contributions which are not yet instantiated.\n\t */\n\tprivate readonly _pending = new Map<string, IEditorContributionDescription>();\n\t/**\n\t * Tracks which instantiation kinds are still left in `_pending`.\n\t */\n\tprivate readonly _finishedInstantiation: boolean[] = [];\n\n\tconstructor(\n\n\t) {\n\t\tsuper();\n\n\t\tthis._finishedInstantiation[EditorContributionInstantiation.Eager] = false;\n\t\tthis._finishedInstantiation[EditorContributionInstantiation.AfterFirstRender] = false;\n\t\tthis._finishedInstantiation[EditorContributionInstantiation.BeforeFirstInteraction] = false;\n\t\tthis._finishedInstantiation[EditorContributionInstantiation.Eventually] = false;\n\t}\n\n\tpublic initialize(editor: ICodeEditor, contributions: IEditorContributionDescription[], instantiationService: IInstantiationService) {\n\t\tthis._editor = editor;\n\t\tthis._instantiationService = instantiationService;\n\n\t\tfor (const desc of contributions) {\n\t\t\tif (this._pending.has(desc.id)) {\n\t\t\t\tonUnexpectedError(new Error(`Cannot have two contributions with the same id ${desc.id}`));\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tthis._pending.set(desc.id, desc);\n\t\t}\n\n\t\tthis._instantiateSome(EditorContributionInstantiation.Eager);\n\n\t\t// AfterFirstRender\n\t\t// - these extensions will be instantiated at the latest 50ms after the first render.\n\t\t// - but if there is idle time, we will instantiate them sooner.\n\t\tthis._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()), () => {\n\t\t\tthis._instantiateSome(EditorContributionInstantiation.AfterFirstRender);\n\t\t}));\n\n\t\t// BeforeFirstInteraction\n\t\t// - these extensions will be instantiated at the latest before a mouse or a keyboard event.\n\t\t// - but if there is idle time, we will instantiate them sooner.\n\t\tthis._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()), () => {\n\t\t\tthis._instantiateSome(EditorContributionInstantiation.BeforeFirstInteraction);\n\t\t}));\n\n\t\t// Eventually\n\t\t// - these extensions will only be instantiated when there is idle time.\n\t\t// - since there is no guarantee that there will ever be idle time, we set a timeout of 5s here.\n\t\tthis._register(runWhenWindowIdle(getWindow(this._editor.getDomNode()), () => {\n\t\t\tthis._instantiateSome(EditorContributionInstantiation.Eventually);\n\t\t}, 5000));\n\t}\n\n\tpublic saveViewState(): { [key: string]: any } {\n\t\tconst contributionsState: { [key: string]: any } = {};\n\t\tfor (const [id, contribution] of this._instances) {\n\t\t\tif (typeof contribution.saveViewState === 'function') {\n\t\t\t\tcontributionsState[id] = contribution.saveViewState();\n\t\t\t}\n\t\t}\n\t\treturn contributionsState;\n\t}\n\n\tpublic restoreViewState(contributionsState: { [key: string]: any }): void {\n\t\tfor (const [id, contribution] of this._instances) {\n\t\t\tif (typeof contribution.restoreViewState === 'function') {\n\t\t\t\tcontribution.restoreViewState(contributionsState[id]);\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic get(id: string): IEditorContribution | null {\n\t\tthis._instantiateById(id);\n\t\treturn this._instances.get(id) || null;\n\t}\n\n\t/**\n\t * used by tests\n\t */\n\tpublic set(id: string, value: IEditorContribution) {\n\t\tthis._instances.set(id, value);\n\t}\n\n\tpublic onBeforeInteractionEvent(): void {\n\t\t// this method is called very often by the editor!\n\t\tthis._instantiateSome(EditorContributionInstantiation.BeforeFirstInteraction);\n\t}\n\n\tpublic onAfterModelAttached(): IDisposable {\n\t\treturn runWhenWindowIdle(getWindow(this._editor?.getDomNode()), () => {\n\t\t\tthis._instantiateSome(EditorContributionInstantiation.AfterFirstRender);\n\t\t}, 50);\n\t}\n\n\tprivate _instantiateSome(instantiation: EditorContributionInstantiation): void {\n\t\tif (this._finishedInstantiation[instantiation]) {\n\t\t\t// already done with this instantiation!\n\t\t\treturn;\n\t\t}\n\t\tthis._finishedInstantiation[instantiation] = true;\n\n\t\tconst contribs = this._findPendingContributionsByInstantiation(instantiation);\n\t\tfor (const contrib of contribs) {\n\t\t\tthis._instantiateById(contrib.id);\n\t\t}\n\t}\n\n\tprivate _findPendingContributionsByInstantiation(instantiation: EditorContributionInstantiation): readonly IEditorContributionDescription[] {\n\t\tconst result: IEditorContributionDescription[] = [];\n\t\tfor (const [, desc] of this._pending) {\n\t\t\tif (desc.instantiation === instantiation) {\n\t\t\t\tresult.push(desc);\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _instantiateById(id: string): void {\n\t\tconst desc = this._pending.get(id);\n\t\tif (!desc) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._pending.delete(id);\n\n\t\tif (!this._instantiationService || !this._editor) {\n\t\t\tthrow new Error(`Cannot instantiate contributions before being initialized!`);\n\t\t}\n\n\t\ttry {\n\t\t\tconst instance = this._instantiationService.createInstance(desc.ctor, this._editor);\n\t\t\tthis._instances.set(desc.id, instance);\n\t\t\tif (typeof instance.restoreViewState === 'function' && desc.instantiation !== EditorContributionInstantiation.Eager) {\n\t\t\t\tconsole.warn(`Editor contribution '${desc.id}' should be eager instantiated because it uses saveViewState / restoreViewState.`);\n\t\t\t}\n\t\t} catch (err) {\n\t\t\tonUnexpectedError(err);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
