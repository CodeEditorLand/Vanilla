var C=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var m=(s,r,e,t)=>{for(var i=t>1?void 0:t?O(r,e):r,o=s.length-1,d;o>=0;o--)(d=s[o])&&(i=(t?d(r,e,i):d(i))||i);return t&&i&&C(r,e,i),i},c=(s,r)=>(e,t)=>r(e,t,s);import{Emitter as _}from"../../../../../base/common/event.js";import{Disposable as y}from"../../../../../base/common/lifecycle.js";import{autorunHandleChanges as b,derived as S,derivedOpts as I,observableFromEvent as l}from"../../../../../base/common/observable.js";import{localize as v}from"../../../../../nls.js";import{IInstantiationService as W}from"../../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as H}from"../../../../../platform/keybinding/common/keybinding.js";import{EditorOptions as D}from"../../../../common/config/editorOptions.js";import{Position as f}from"../../../../common/core/position.js";import{observableCodeEditor as p}from"../../../observableCodeEditor.js";import{OverviewRulerFeature as E}from"../features/overviewRulerFeature.js";let g=class extends y{constructor(e,t,i,o,d,h,u){super();this.originalEditorElement=e;this.modifiedEditorElement=t;this._options=i;this._argCodeEditorWidgetOptions=o;this._createInnerEditor=d;this._instantiationService=h;this._keybindingService=u;this._argCodeEditorWidgetOptions=null,this._register(b({createEmptyChangeSummary:()=>({}),handleChange:(n,a)=>(n.didChange(i.editorOptions)&&Object.assign(a,n.change.changedOptions),!0)},(n,a)=>{i.editorOptions.read(n),this._options.renderSideBySide.read(n),this.modified.updateOptions(this._adjustOptionsForRightHandSide(n,a)),this.original.updateOptions(this._adjustOptionsForLeftHandSide(n,a))}))}original=this._register(this._createLeftHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.originalEditor||{}));modified=this._register(this._createRightHandSideEditor(this._options.editorOptions.get(),this._argCodeEditorWidgetOptions.modifiedEditor||{}));_onDidContentSizeChange=this._register(new _);get onDidContentSizeChange(){return this._onDidContentSizeChange.event}modifiedScrollTop=l(this,this.modified.onDidScrollChange,()=>this.modified.getScrollTop());modifiedScrollHeight=l(this,this.modified.onDidScrollChange,()=>this.modified.getScrollHeight());modifiedObs=p(this.modified);originalObs=p(this.original);modifiedModel=this.modifiedObs.model;modifiedSelections=l(this,this.modified.onDidChangeCursorSelection,()=>this.modified.getSelections()??[]);modifiedCursor=I({owner:this,equalsFn:f.equals},e=>this.modifiedSelections.read(e)[0]?.getPosition()??new f(1,1));originalCursor=l(this,this.original.onDidChangeCursorPosition,()=>this.original.getPosition()??new f(1,1));isOriginalFocused=p(this.original).isFocused;isModifiedFocused=p(this.modified).isFocused;isFocused=S(this,e=>this.isOriginalFocused.read(e)||this.isModifiedFocused.read(e));_createLeftHandSideEditor(e,t){const i=this._adjustOptionsForLeftHandSide(void 0,e),o=this._constructInnerEditor(this._instantiationService,this.originalEditorElement,i,t);return o.setContextValue("isInDiffLeftEditor",!0),o}_createRightHandSideEditor(e,t){const i=this._adjustOptionsForRightHandSide(void 0,e),o=this._constructInnerEditor(this._instantiationService,this.modifiedEditorElement,i,t);return o.setContextValue("isInDiffRightEditor",!0),o}_constructInnerEditor(e,t,i,o){const d=this._createInnerEditor(e,t,i,o);return this._register(d.onDidContentSizeChange(h=>{const u=this.original.getContentWidth()+this.modified.getContentWidth()+E.ENTIRE_DIFF_OVERVIEW_WIDTH,n=Math.max(this.modified.getContentHeight(),this.original.getContentHeight());this._onDidContentSizeChange.fire({contentHeight:n,contentWidth:u,contentHeightChanged:h.contentHeightChanged,contentWidthChanged:h.contentWidthChanged})})),d}_adjustOptionsForLeftHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return this._options.renderSideBySide.get()?(i.unicodeHighlight=this._options.editorOptions.get().unicodeHighlight||{},i.wordWrapOverride1=this._options.diffWordWrap.get()):(i.wordWrapOverride1="off",i.wordWrapOverride2="off",i.stickyScroll={enabled:!1},i.unicodeHighlight={nonBasicASCII:!1,ambiguousCharacters:!1,invisibleCharacters:!1}),i.glyphMargin=this._options.renderSideBySide.get(),t.originalAriaLabel&&(i.ariaLabel=t.originalAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.readOnly=!this._options.originalEditable.get(),i.dropIntoEditor={enabled:!i.readOnly},i.extraEditorClassName="original-in-monaco-diff-editor",i}_adjustOptionsForRightHandSide(e,t){const i=this._adjustOptionsForSubEditor(t);return t.modifiedAriaLabel&&(i.ariaLabel=t.modifiedAriaLabel),i.ariaLabel=this._updateAriaLabel(i.ariaLabel),i.wordWrapOverride1=this._options.diffWordWrap.get(),i.revealHorizontalRightPadding=D.revealHorizontalRightPadding.defaultValue+E.ENTIRE_DIFF_OVERVIEW_WIDTH,i.scrollbar.verticalHasArrows=!1,i.extraEditorClassName="modified-in-monaco-diff-editor",i}_adjustOptionsForSubEditor(e){const t={...e,dimension:{height:0,width:0}};return t.inDiffEditor=!0,t.automaticLayout=!1,t.scrollbar={...t.scrollbar||{}},t.folding=!1,t.codeLens=this._options.diffCodeLens.get(),t.fixedOverflowWidgets=!0,t.minimap={...t.minimap||{}},t.minimap.enabled=!1,this._options.hideUnchangedRegions.get()?t.stickyScroll={enabled:!1}:t.stickyScroll=this._options.editorOptions.get().stickyScroll,t}_updateAriaLabel(e){e||(e="");const t=v("diff-aria-navigation-tip"," use {0} to open the accessibility help.",this._keybindingService.lookupKeybinding("editor.action.accessibilityHelp")?.getAriaLabel());return this._options.accessibilityVerbose.get()?e+t:e?e.replaceAll(t,""):""}};g=m([c(5,W),c(6,H)],g);export{g as DiffEditorEditors};
