import{Orientation as b,Sash as u,SashState as o}from"../../../../../base/browser/ui/sash/sash.js";import{Disposable as _}from"../../../../../base/common/lifecycle.js";import{autorun as d,derivedWithSetter as f,observableValue as p}from"../../../../../base/common/observable.js";import"../diffEditorOptions.js";class E{constructor(e,s){this._options=e;this.dimensions=s}sashLeft=f(this,e=>{const s=this._sashRatio.read(e)??this._options.splitViewDefaultRatio.read(e);return this._computeSashLeft(s,e)},(e,s)=>{const t=this.dimensions.width.get();this._sashRatio.set(e/t,s)});_sashRatio=p(this,void 0);resetSash(){this._sashRatio.set(void 0,void 0)}_computeSashLeft(e,s){const t=this.dimensions.width.read(s),h=Math.floor(this._options.splitViewDefaultRatio.read(s)*t),n=this._options.enableSplitViewResizing.read(s)?Math.floor(e*t):h,a=100;return t<=a*2?h:n<a?a:n>t-a?t-a:n}}class w extends _{constructor(s,t,h,n,a,m){super();this._domNode=s;this._dimensions=t;this._enabled=h;this._boundarySashes=n;this.sashLeft=a;this._resetSash=m;this._register(this._sash.onDidStart(()=>{this._startSashPosition=this.sashLeft.get()})),this._register(this._sash.onDidChange(i=>{this.sashLeft.set(this._startSashPosition+(i.currentX-i.startX),void 0)})),this._register(this._sash.onDidEnd(()=>this._sash.layout())),this._register(this._sash.onDidReset(()=>this._resetSash())),this._register(d(i=>{const r=this._boundarySashes.read(i);r&&(this._sash.orthogonalEndSash=r.bottom)})),this._register(d(i=>{const r=this._enabled.read(i);this._sash.state=r?o.Enabled:o.Disabled,this.sashLeft.read(i),this._dimensions.height.read(i),this._sash.layout()}))}_sash=this._register(new u(this._domNode,{getVerticalSashTop:s=>0,getVerticalSashLeft:s=>this.sashLeft.get(),getVerticalSashHeight:s=>this._dimensions.height.get()},{orientation:b.VERTICAL}));_startSashPosition=void 0}export{w as DiffEditorSash,E as SashLayout};
