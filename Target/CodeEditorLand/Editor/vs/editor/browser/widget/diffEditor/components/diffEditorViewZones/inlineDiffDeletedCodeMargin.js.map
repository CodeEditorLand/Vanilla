{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/widget/diffEditor/components/diffEditorViewZones/inlineDiffDeletedCodeMargin.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { addStandardDisposableListener, getDomNodePagePosition } from '../../../../../../base/browser/dom.js';\nimport { Action } from '../../../../../../base/common/actions.js';\nimport { Codicon } from '../../../../../../base/common/codicons.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { isIOS } from '../../../../../../base/common/platform.js';\nimport { ThemeIcon } from '../../../../../../base/common/themables.js';\nimport { IEditorMouseEvent, MouseTargetType } from '../../../../editorBrowser.js';\nimport { CodeEditorWidget } from '../../../codeEditor/codeEditorWidget.js';\nimport { DiffEditorWidget } from '../../diffEditorWidget.js';\nimport { EditorOption } from '../../../../../common/config/editorOptions.js';\nimport { DetailedLineRangeMapping } from '../../../../../common/diff/rangeMapping.js';\nimport { EndOfLineSequence, ITextModel } from '../../../../../common/model.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IClipboardService } from '../../../../../../platform/clipboard/common/clipboardService.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\n\nexport class InlineDiffDeletedCodeMargin extends Disposable {\n\tprivate readonly _diffActions: HTMLElement;\n\n\tprivate _visibility: boolean = false;\n\n\tget visibility(): boolean {\n\t\treturn this._visibility;\n\t}\n\n\tset visibility(_visibility: boolean) {\n\t\tif (this._visibility !== _visibility) {\n\t\t\tthis._visibility = _visibility;\n\t\t\tthis._diffActions.style.visibility = _visibility ? 'visible' : 'hidden';\n\t\t}\n\t}\n\n\tconstructor(\n\t\tprivate readonly _getViewZoneId: () => string,\n\t\tprivate readonly _marginDomNode: HTMLElement,\n\t\tprivate readonly _modifiedEditor: CodeEditorWidget,\n\t\tprivate readonly _diff: DetailedLineRangeMapping,\n\t\tprivate readonly _editor: DiffEditorWidget,\n\t\tprivate readonly _viewLineCounts: number[],\n\t\tprivate readonly _originalTextModel: ITextModel,\n\t\tprivate readonly _contextMenuService: IContextMenuService,\n\t\tprivate readonly _clipboardService: IClipboardService,\n\t) {\n\t\tsuper();\n\n\t\t// make sure the diff margin shows above overlay.\n\t\tthis._marginDomNode.style.zIndex = '10';\n\n\t\tthis._diffActions = document.createElement('div');\n\t\tthis._diffActions.className = ThemeIcon.asClassName(Codicon.lightBulb) + ' lightbulb-glyph';\n\t\tthis._diffActions.style.position = 'absolute';\n\t\tconst lineHeight = this._modifiedEditor.getOption(EditorOption.lineHeight);\n\t\tthis._diffActions.style.right = '0px';\n\t\tthis._diffActions.style.visibility = 'hidden';\n\t\tthis._diffActions.style.height = `${lineHeight}px`;\n\t\tthis._diffActions.style.lineHeight = `${lineHeight}px`;\n\t\tthis._marginDomNode.appendChild(this._diffActions);\n\n\t\tlet currentLineNumberOffset = 0;\n\n\t\tconst useShadowDOM = _modifiedEditor.getOption(EditorOption.useShadowDOM) && !isIOS; // Do not use shadow dom on IOS #122035\n\t\tconst showContextMenu = (x: number, y: number) => {\n\t\t\tthis._contextMenuService.showContextMenu({\n\t\t\t\tdomForShadowRoot: useShadowDOM ? _modifiedEditor.getDomNode() ?? undefined : undefined,\n\t\t\t\tgetAnchor: () => ({ x, y }),\n\t\t\t\tgetActions: () => {\n\t\t\t\t\tconst actions: Action[] = [];\n\t\t\t\t\tconst isDeletion = _diff.modified.isEmpty;\n\n\t\t\t\t\t// default action\n\t\t\t\t\tactions.push(new Action(\n\t\t\t\t\t\t'diff.clipboard.copyDeletedContent',\n\t\t\t\t\t\tisDeletion\n\t\t\t\t\t\t\t? (_diff.original.length > 1\n\t\t\t\t\t\t\t\t? localize('diff.clipboard.copyDeletedLinesContent.label', \"Copy deleted lines\")\n\t\t\t\t\t\t\t\t: localize('diff.clipboard.copyDeletedLinesContent.single.label', \"Copy deleted line\"))\n\t\t\t\t\t\t\t: (_diff.original.length > 1\n\t\t\t\t\t\t\t\t? localize('diff.clipboard.copyChangedLinesContent.label', \"Copy changed lines\")\n\t\t\t\t\t\t\t\t: localize('diff.clipboard.copyChangedLinesContent.single.label', \"Copy changed line\")),\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t\tasync () => {\n\t\t\t\t\t\t\tconst originalText = this._originalTextModel.getValueInRange(_diff.original.toExclusiveRange());\n\t\t\t\t\t\t\tawait this._clipboardService.writeText(originalText);\n\t\t\t\t\t\t}\n\t\t\t\t\t));\n\n\t\t\t\t\tif (_diff.original.length > 1) {\n\t\t\t\t\t\tactions.push(new Action(\n\t\t\t\t\t\t\t'diff.clipboard.copyDeletedLineContent',\n\t\t\t\t\t\t\tisDeletion\n\t\t\t\t\t\t\t\t? localize('diff.clipboard.copyDeletedLineContent.label', \"Copy deleted line ({0})\",\n\t\t\t\t\t\t\t\t\t_diff.original.startLineNumber + currentLineNumberOffset)\n\t\t\t\t\t\t\t\t: localize('diff.clipboard.copyChangedLineContent.label', \"Copy changed line ({0})\",\n\t\t\t\t\t\t\t\t\t_diff.original.startLineNumber + currentLineNumberOffset),\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\tasync () => {\n\t\t\t\t\t\t\t\tlet lineContent = this._originalTextModel.getLineContent(_diff.original.startLineNumber + currentLineNumberOffset);\n\t\t\t\t\t\t\t\tif (lineContent === '') {\n\t\t\t\t\t\t\t\t\t// empty line -> new line\n\t\t\t\t\t\t\t\t\tconst eof = this._originalTextModel.getEndOfLineSequence();\n\t\t\t\t\t\t\t\t\tlineContent = eof === EndOfLineSequence.LF ? '\\n' : '\\r\\n';\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tawait this._clipboardService.writeText(lineContent);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t));\n\t\t\t\t\t}\n\t\t\t\t\tconst readOnly = _modifiedEditor.getOption(EditorOption.readOnly);\n\t\t\t\t\tif (!readOnly) {\n\t\t\t\t\t\tactions.push(new Action(\n\t\t\t\t\t\t\t'diff.inline.revertChange',\n\t\t\t\t\t\t\tlocalize('diff.inline.revertChange.label', \"Revert this change\"),\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\tasync () => {\n\t\t\t\t\t\t\t\tthis._editor.revert(this._diff);\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn actions;\n\t\t\t\t},\n\t\t\t\tautoSelectFirstItem: true\n\t\t\t});\n\t\t};\n\n\t\tthis._register(addStandardDisposableListener(this._diffActions, 'mousedown', e => {\n\t\t\tif (!e.leftButton) { return; }\n\n\t\t\tconst { top, height } = getDomNodePagePosition(this._diffActions);\n\t\t\tconst pad = Math.floor(lineHeight / 3);\n\t\t\te.preventDefault();\n\t\t\tshowContextMenu(e.posx, top + height + pad);\n\t\t}));\n\n\t\tthis._register(_modifiedEditor.onMouseMove((e: IEditorMouseEvent) => {\n\t\t\tif ((e.target.type === MouseTargetType.CONTENT_VIEW_ZONE || e.target.type === MouseTargetType.GUTTER_VIEW_ZONE) && e.target.detail.viewZoneId === this._getViewZoneId()) {\n\t\t\t\tcurrentLineNumberOffset = this._updateLightBulbPosition(this._marginDomNode, e.event.browserEvent.y, lineHeight);\n\t\t\t\tthis.visibility = true;\n\t\t\t} else {\n\t\t\t\tthis.visibility = false;\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(_modifiedEditor.onMouseDown((e: IEditorMouseEvent) => {\n\t\t\tif (!e.event.leftButton) { return; }\n\n\t\t\tif (e.target.type === MouseTargetType.CONTENT_VIEW_ZONE || e.target.type === MouseTargetType.GUTTER_VIEW_ZONE) {\n\t\t\t\tconst viewZoneId = e.target.detail.viewZoneId;\n\n\t\t\t\tif (viewZoneId === this._getViewZoneId()) {\n\t\t\t\t\te.event.preventDefault();\n\t\t\t\t\tcurrentLineNumberOffset = this._updateLightBulbPosition(this._marginDomNode, e.event.browserEvent.y, lineHeight);\n\t\t\t\t\tshowContextMenu(e.event.posx, e.event.posy + lineHeight);\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate _updateLightBulbPosition(marginDomNode: HTMLElement, y: number, lineHeight: number): number {\n\t\tconst { top } = getDomNodePagePosition(marginDomNode);\n\t\tconst offset = y - top;\n\t\tconst lineNumberOffset = Math.floor(offset / lineHeight);\n\t\tconst newTop = lineNumberOffset * lineHeight;\n\t\tthis._diffActions.style.top = `${newTop}px`;\n\t\tif (this._viewLineCounts) {\n\t\t\tlet acc = 0;\n\t\t\tfor (let i = 0; i < this._viewLineCounts.length; i++) {\n\t\t\t\tacc += this._viewLineCounts[i];\n\t\t\t\tif (lineNumberOffset < acc) {\n\t\t\t\t\treturn i;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn lineNumberOffset;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
