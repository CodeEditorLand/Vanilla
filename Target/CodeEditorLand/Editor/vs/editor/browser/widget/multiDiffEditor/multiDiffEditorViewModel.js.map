{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/widget/multiDiffEditor/multiDiffEditorViewModel.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, DisposableStore, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { IObservable, ITransaction, constObservable, derived, derivedObservableWithWritableCache, mapObservableArrayCached, observableFromValueWithChangeEvent, observableValue, transaction } from '../../../../base/common/observable.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ContextKeyValue } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IDiffEditorOptions } from '../../../common/config/editorOptions.js';\nimport { Selection } from '../../../common/core/selection.js';\nimport { IDiffEditorViewModel } from '../../../common/editorCommon.js';\nimport { IModelService } from '../../../common/services/model.js';\nimport { DiffEditorOptions } from '../diffEditor/diffEditorOptions.js';\nimport { DiffEditorViewModel } from '../diffEditor/diffEditorViewModel.js';\nimport { RefCounted } from '../diffEditor/utils.js';\nimport { IDocumentDiffItem, IMultiDiffEditorModel } from './model.js';\n\nexport class MultiDiffEditorViewModel extends Disposable {\n\tprivate readonly _documents: IObservable<readonly RefCounted<IDocumentDiffItem>[] | 'loading'> = observableFromValueWithChangeEvent(this.model, this.model.documents);\n\n\tprivate readonly _documentsArr = derived(this, reader => {\n\t\tconst result = this._documents.read(reader);\n\t\tif (result === 'loading') { return []; }\n\t\treturn result;\n\t});\n\n\tpublic readonly isLoading = derived(this, reader => this._documents.read(reader) === 'loading');\n\n\tpublic readonly items: IObservable<readonly DocumentDiffItemViewModel[]> = mapObservableArrayCached(\n\t\tthis,\n\t\tthis._documentsArr,\n\t\t(d, store) => store.add(this._instantiationService.createInstance(DocumentDiffItemViewModel, d, this))\n\t).recomputeInitiallyAndOnChange(this._store);\n\n\tpublic readonly focusedDiffItem = derived(this, reader => this.items.read(reader).find(i => i.isFocused.read(reader)));\n\tpublic readonly activeDiffItem = derivedObservableWithWritableCache<DocumentDiffItemViewModel | undefined>(this,\n\t\t(reader, lastValue) => this.focusedDiffItem.read(reader) ?? (lastValue && this.items.read(reader).indexOf(lastValue) !== -1) ? lastValue : undefined\n\t);\n\n\tpublic async waitForDiffs(): Promise<void> {\n\t\tfor (const d of this.items.get()) {\n\t\t\tawait d.diffEditorViewModel.waitForDiff();\n\t\t}\n\t}\n\n\tpublic collapseAll(): void {\n\t\ttransaction(tx => {\n\t\t\tfor (const d of this.items.get()) {\n\t\t\t\td.collapsed.set(true, tx);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic expandAll(): void {\n\t\ttransaction(tx => {\n\t\t\tfor (const d of this.items.get()) {\n\t\t\t\td.collapsed.set(false, tx);\n\t\t\t}\n\t\t});\n\t}\n\n\tpublic get contextKeys(): Record<string, ContextKeyValue> | undefined {\n\t\treturn this.model.contextKeys;\n\t}\n\n\tconstructor(\n\t\tpublic readonly model: IMultiDiffEditorModel,\n\t\tprivate readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t}\n}\n\nexport class DocumentDiffItemViewModel extends Disposable {\n\t/**\n\t * The diff editor view model keeps its inner objects alive.\n\t*/\n\tpublic readonly diffEditorViewModelRef: RefCounted<IDiffEditorViewModel>;\n\tpublic get diffEditorViewModel(): IDiffEditorViewModel {\n\t\treturn this.diffEditorViewModelRef.object;\n\t}\n\tpublic readonly collapsed = observableValue<boolean>(this, false);\n\n\tpublic readonly lastTemplateData = observableValue<{ contentHeight: number; selections: Selection[] | undefined }>(\n\t\tthis,\n\t\t{ contentHeight: 500, selections: undefined, }\n\t);\n\n\tpublic get originalUri(): URI | undefined { return this.documentDiffItem.original?.uri; }\n\tpublic get modifiedUri(): URI | undefined { return this.documentDiffItem.modified?.uri; }\n\n\tpublic readonly isActive: IObservable<boolean> = derived(this, reader => this._editorViewModel.activeDiffItem.read(reader) === this);\n\n\tprivate readonly _isFocusedSource = observableValue<IObservable<boolean>>(this, constObservable(false));\n\tpublic readonly isFocused = derived(this, reader => this._isFocusedSource.read(reader).read(reader));\n\n\tpublic setIsFocused(source: IObservable<boolean>, tx: ITransaction | undefined): void {\n\t\tthis._isFocusedSource.set(source, tx);\n\t}\n\n\tprivate readonly documentDiffItemRef: RefCounted<IDocumentDiffItem>;\n\tpublic get documentDiffItem(): IDocumentDiffItem {\n\t\treturn this.documentDiffItemRef.object;\n\t}\n\n\tpublic readonly isAlive = observableValue<boolean>(this, true);\n\n\tconstructor(\n\t\tdocumentDiffItem: RefCounted<IDocumentDiffItem>,\n\t\tprivate readonly _editorViewModel: MultiDiffEditorViewModel,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.isAlive.set(false, undefined);\n\t\t}));\n\n\t\tthis.documentDiffItemRef = this._register(documentDiffItem.createNewRef(this));\n\n\t\tfunction updateOptions(options: IDiffEditorOptions): IDiffEditorOptions {\n\t\t\treturn {\n\t\t\t\t...options,\n\t\t\t\thideUnchangedRegions: {\n\t\t\t\t\tenabled: true,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tconst options = this._instantiationService.createInstance(DiffEditorOptions, updateOptions(this.documentDiffItem.options || {}));\n\t\tif (this.documentDiffItem.onOptionsDidChange) {\n\t\t\tthis._register(this.documentDiffItem.onOptionsDidChange(() => {\n\t\t\t\toptions.updateOptions(updateOptions(this.documentDiffItem.options || {}));\n\t\t\t}));\n\t\t}\n\n\t\tconst diffEditorViewModelStore = new DisposableStore();\n\t\tconst originalTextModel = this.documentDiffItem.original ?? diffEditorViewModelStore.add(this._modelService.createModel('', null));\n\t\tconst modifiedTextModel = this.documentDiffItem.modified ?? diffEditorViewModelStore.add(this._modelService.createModel('', null));\n\t\tdiffEditorViewModelStore.add(this.documentDiffItemRef.createNewRef(this));\n\n\t\tthis.diffEditorViewModelRef = this._register(RefCounted.createWithDisposable(\n\t\t\tthis._instantiationService.createInstance(DiffEditorViewModel, {\n\t\t\t\toriginal: originalTextModel,\n\t\t\t\tmodified: modifiedTextModel,\n\t\t\t}, options),\n\t\t\tdiffEditorViewModelStore,\n\t\t\tthis\n\t\t));\n\t}\n\n\tpublic getKey(): string {\n\t\treturn JSON.stringify([\n\t\t\tthis.originalUri?.toString(),\n\t\t\tthis.modifiedUri?.toString()\n\t\t]);\n\t}\n}\n"],
  "mappings": "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",
  "names": ["options"]
}
