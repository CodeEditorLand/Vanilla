import*as Z from"../../nls.js";import{isFirefox as Ee}from"../../base/browser/browser.js";import{KeyCode as i,KeyMod as n}from"../../base/common/keyCodes.js";import*as v from"../../base/common/types.js";import{status as xe}from"../../base/browser/ui/aria/aria.js";import{Command as be,EditorCommand as se,registerEditorCommand as a,UndoCommand as he,RedoCommand as we,SelectAllCommand as ge}from"./editorExtensions.js";import{ICodeEditorService as q}from"./services/codeEditorService.js";import{ColumnSelection as H}from"../common/cursor/cursorColumnSelection.js";import{CursorState as z,EditOperationType as ae}from"../common/cursorCommon.js";import{DeleteOperations as ce}from"../common/cursor/cursorDeleteOperations.js";import{CursorChangeReason as w}from"../common/cursorEvents.js";import{CursorMove as m,CursorMoveCommands as P}from"../common/cursor/cursorMoveCommands.js";import{TypeOperations as de}from"../common/cursor/cursorTypeOperations.js";import{Position as ue}from"../common/core/position.js";import{Range as Oe}from"../common/core/range.js";import{Handler as V,ScrollType as J}from"../common/editorCommon.js";import{EditorContextKeys as c}from"../common/editorContextKeys.js";import{VerticalRevealType as j}from"../common/viewEvents.js";import{ContextKeyExpr as Q}from"../../platform/contextkey/common/contextkey.js";import{KeybindingWeight as ye,KeybindingsRegistry as Pe}from"../../platform/keybinding/common/keybindingsRegistry.js";import{EditorOption as le}from"../common/config/editorOptions.js";import{getActiveElement as Ie,isEditableElement as ke}from"../../base/browser/dom.js";import{EnterOperation as Ae}from"../common/cursor/cursorTypeEditOperations.js";const u=ye.EditorCore;class f extends se{runEditorCommand(y,h,C){const x=h._getViewModel();x&&this.runCoreEditorCommand(x,C||{})}}var O;(g=>{const E=function(I){if(!v.isObject(I))return!1;const p=I;return!(!v.isString(p.to)||!v.isUndefined(p.by)&&!v.isString(p.by)||!v.isUndefined(p.value)&&!v.isNumber(p.value)||!v.isUndefined(p.revealCursor)&&!v.isBoolean(p.revealCursor))};g.metadata={description:"Scroll editor in the given direction",args:[{name:"Editor scroll argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'to': A mandatory direction value.\n						```\n						'up', 'down'\n						```\n					* 'by': Unit to move. Default is computed based on 'to' value.\n						```\n						'line', 'wrappedLine', 'page', 'halfPage', 'editor'\n						```\n					* 'value': Number of units to move. Default is '1'.\n					* 'revealCursor': If 'true' reveals the cursor if it is outside view port.\n				",constraint:E,schema:{type:"object",required:["to"],properties:{to:{type:"string",enum:["up","down"]},by:{type:"string",enum:["line","wrappedLine","page","halfPage","editor"]},value:{type:"number",default:1},revealCursor:{type:"boolean"}}}}]},g.RawDirection={Up:"up",Right:"right",Down:"down",Left:"left"},g.RawUnit={Line:"line",WrappedLine:"wrappedLine",Page:"page",HalfPage:"halfPage",Editor:"editor",Column:"column"};function x(I){let p;switch(I.to){case g.RawDirection.Up:p=1;break;case g.RawDirection.Right:p=2;break;case g.RawDirection.Down:p=3;break;case g.RawDirection.Left:p=4;break;default:return null}let l;switch(I.by){case g.RawUnit.Line:l=1;break;case g.RawUnit.WrappedLine:l=2;break;case g.RawUnit.Page:l=3;break;case g.RawUnit.HalfPage:l=4;break;case g.RawUnit.Editor:l=5;break;case g.RawUnit.Column:l=6;break;default:l=2}const D=Math.floor(I.value||1),b=!!I.revealCursor;return{direction:p,unit:l,value:D,revealCursor:b,select:!!I.select}}g.parse=x;let B;(b=>(b[b.Up=1]="Up",b[b.Right=2]="Right",b[b.Down=3]="Down",b[b.Left=4]="Left"))(B=g.Direction||={});let G;(k=>(k[k.Line=1]="Line",k[k.WrappedLine=2]="WrappedLine",k[k.Page=3]="Page",k[k.HalfPage=4]="HalfPage",k[k.Editor=5]="Editor",k[k.Column=6]="Column"))(G=g.Unit||={})})(O||={});var K;(C=>{const E=function(x){if(!v.isObject(x))return!1;const B=x;return!(!v.isNumber(B.lineNumber)&&!v.isString(B.lineNumber)||!v.isUndefined(B.at)&&!v.isString(B.at))};C.metadata={description:"Reveal the given line at the given logical position",args:[{name:"Reveal line argument object",description:"Property-value pairs that can be passed through this argument:\n					* 'lineNumber': A mandatory line number value.\n					* 'at': Logical position at which line has to be revealed.\n						```\n						'top', 'center', 'bottom'\n						```\n				",constraint:E,schema:{type:"object",required:["lineNumber"],properties:{lineNumber:{type:["number","string"]},at:{type:"string",enum:["top","center","bottom"]}}}}]},C.RawAtArgument={Top:"top",Center:"center",Bottom:"bottom"}})(K||={});class X{constructor(y){y.addImplementation(1e4,"code-editor",(h,C)=>{const x=h.get(q).getFocusedCodeEditor();return x&&x.hasTextFocus()?this._runEditorCommand(h,x,C):!1}),y.addImplementation(1e3,"generic-dom-input-textarea",(h,C)=>{const x=Ie();return x&&ke(x)?(this.runDOMCommand(x),!0):!1}),y.addImplementation(0,"generic-dom",(h,C)=>{const x=h.get(q).getActiveCodeEditor();return x?(x.focus(),this._runEditorCommand(h,x,C)):!1})}_runEditorCommand(y,h,C){const x=this.runEditorCommand(y,h,C);return x||!0}}var Le=(C=>(C[C.Regular=0]="Regular",C[C.Minimal=1]="Minimal",C[C.None=2]="None",C))(Le||{}),T;(s=>{class E extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){if(!t.position)return;e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,[P.moveTo(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position,t.viewPosition)])&&t.revealType!==2&&e.revealAllCursors(t.source,!0,!0)}}s.MoveTo=a(new E({id:"_moveTo",inSelectionMode:!1,precondition:void 0})),s.MoveToSelect=a(new E({id:"_moveToSelect",inSelectionMode:!0,precondition:void 0}));class C extends f{runCoreEditorCommand(e,t){e.model.pushStackElement();const o=this._getColumnSelectResult(e,e.getPrimaryCursorState(),e.getCursorColumnSelectData(),t);o!==null&&(e.setCursorStates(t.source,w.Explicit,o.viewStates.map(d=>z.fromViewState(d))),e.setCursorColumnSelectData({isReal:!0,fromViewLineNumber:o.fromLineNumber,fromViewVisualColumn:o.fromVisualColumn,toViewLineNumber:o.toLineNumber,toViewVisualColumn:o.toVisualColumn}),o.reversed?e.revealTopMostCursor(t.source):e.revealBottomMostCursor(t.source))}}s.ColumnSelect=a(new class extends C{constructor(){super({id:"columnSelect",precondition:void 0})}_getColumnSelectResult(r,e,t,o){if(typeof o.position>"u"||typeof o.viewPosition>"u"||typeof o.mouseColumn>"u")return null;const d=r.model.validatePosition(o.position),S=r.coordinatesConverter.validateViewPosition(new ue(o.viewPosition.lineNumber,o.viewPosition.column),d),A=o.doColumnSelect?t.fromViewLineNumber:S.lineNumber,L=o.doColumnSelect?t.fromViewVisualColumn:o.mouseColumn-1;return H.columnSelect(r.cursorConfig,r,A,L,S.lineNumber,o.mouseColumn-1)}}),s.CursorColumnSelectLeft=a(new class extends C{constructor(){super({id:"cursorColumnSelectLeft",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.LeftArrow,linux:{primary:0}}})}_getColumnSelectResult(r,e,t,o){return H.columnSelectLeft(r.cursorConfig,r,t)}}),s.CursorColumnSelectRight=a(new class extends C{constructor(){super({id:"cursorColumnSelectRight",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.RightArrow,linux:{primary:0}}})}_getColumnSelectResult(r,e,t,o){return H.columnSelectRight(r.cursorConfig,r,t)}});class g extends C{_isPaged;constructor(e){super(e),this._isPaged=e.isPaged}_getColumnSelectResult(e,t,o,d){return H.columnSelectUp(e.cursorConfig,e,o,this._isPaged)}}s.CursorColumnSelectUp=a(new g({isPaged:!1,id:"cursorColumnSelectUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.UpArrow,linux:{primary:0}}})),s.CursorColumnSelectPageUp=a(new g({isPaged:!0,id:"cursorColumnSelectPageUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.PageUp,linux:{primary:0}}}));class l extends C{_isPaged;constructor(e){super(e),this._isPaged=e.isPaged}_getColumnSelectResult(e,t,o,d){return H.columnSelectDown(e.cursorConfig,e,o,this._isPaged)}}s.CursorColumnSelectDown=a(new l({isPaged:!1,id:"cursorColumnSelectDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.DownArrow,linux:{primary:0}}})),s.CursorColumnSelectPageDown=a(new l({isPaged:!0,id:"cursorColumnSelectPageDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|n.Alt|i.PageDown,linux:{primary:0}}}));class R extends f{constructor(){super({id:"cursorMove",precondition:void 0,metadata:m.metadata})}runCoreEditorCommand(e,t){const o=m.parse(t);o&&this._runCursorMove(e,t.source,o)}_runCursorMove(e,t,o){e.model.pushStackElement(),e.setCursorStates(t,w.Explicit,R._move(e,e.getCursorStates(),o)),e.revealAllCursors(t,!0)}static _move(e,t,o){const d=o.select,S=o.value;switch(o.direction){case m.Direction.Left:case m.Direction.Right:case m.Direction.Up:case m.Direction.Down:case m.Direction.PrevBlankLine:case m.Direction.NextBlankLine:case m.Direction.WrappedLineStart:case m.Direction.WrappedLineFirstNonWhitespaceCharacter:case m.Direction.WrappedLineColumnCenter:case m.Direction.WrappedLineEnd:case m.Direction.WrappedLineLastNonWhitespaceCharacter:return P.simpleMove(e,t,o.direction,d,S,o.unit);case m.Direction.ViewPortTop:case m.Direction.ViewPortBottom:case m.Direction.ViewPortCenter:case m.Direction.ViewPortIfOutside:return P.viewportMove(e,t,o.direction,d,S);default:return null}}}s.CursorMoveImpl=R,s.CursorMove=a(new R);let Ce;(e=>e[e.PAGE_SIZE_MARKER=-1]="PAGE_SIZE_MARKER")(Ce||={});class M extends f{_staticArgs;constructor(e){super(e),this._staticArgs=e.args}runCoreEditorCommand(e,t){let o=this._staticArgs;this._staticArgs.value===-1&&(o={direction:this._staticArgs.direction,unit:this._staticArgs.unit,select:this._staticArgs.select,value:t.pageSize||e.cursorConfig.pageSize}),e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,P.simpleMove(e,e.getCursorStates(),o.direction,o.select,o.value,o.unit)),e.revealAllCursors(t.source,!0)}}s.CursorLeft=a(new M({args:{direction:m.Direction.Left,unit:m.Unit.None,select:!1,value:1},id:"cursorLeft",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.LeftArrow,mac:{primary:i.LeftArrow,secondary:[n.WinCtrl|i.KeyB]}}})),s.CursorLeftSelect=a(new M({args:{direction:m.Direction.Left,unit:m.Unit.None,select:!0,value:1},id:"cursorLeftSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.LeftArrow}})),s.CursorRight=a(new M({args:{direction:m.Direction.Right,unit:m.Unit.None,select:!1,value:1},id:"cursorRight",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.RightArrow,mac:{primary:i.RightArrow,secondary:[n.WinCtrl|i.KeyF]}}})),s.CursorRightSelect=a(new M({args:{direction:m.Direction.Right,unit:m.Unit.None,select:!0,value:1},id:"cursorRightSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.RightArrow}})),s.CursorUp=a(new M({args:{direction:m.Direction.Up,unit:m.Unit.WrappedLine,select:!1,value:1},id:"cursorUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.UpArrow,mac:{primary:i.UpArrow,secondary:[n.WinCtrl|i.KeyP]}}})),s.CursorUpSelect=a(new M({args:{direction:m.Direction.Up,unit:m.Unit.WrappedLine,select:!0,value:1},id:"cursorUpSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.UpArrow,secondary:[n.CtrlCmd|n.Shift|i.UpArrow],mac:{primary:n.Shift|i.UpArrow},linux:{primary:n.Shift|i.UpArrow}}})),s.CursorPageUp=a(new M({args:{direction:m.Direction.Up,unit:m.Unit.WrappedLine,select:!1,value:-1},id:"cursorPageUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.PageUp}})),s.CursorPageUpSelect=a(new M({args:{direction:m.Direction.Up,unit:m.Unit.WrappedLine,select:!0,value:-1},id:"cursorPageUpSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.PageUp}})),s.CursorDown=a(new M({args:{direction:m.Direction.Down,unit:m.Unit.WrappedLine,select:!1,value:1},id:"cursorDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.DownArrow,mac:{primary:i.DownArrow,secondary:[n.WinCtrl|i.KeyN]}}})),s.CursorDownSelect=a(new M({args:{direction:m.Direction.Down,unit:m.Unit.WrappedLine,select:!0,value:1},id:"cursorDownSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.DownArrow,secondary:[n.CtrlCmd|n.Shift|i.DownArrow],mac:{primary:n.Shift|i.DownArrow},linux:{primary:n.Shift|i.DownArrow}}})),s.CursorPageDown=a(new M({args:{direction:m.Direction.Down,unit:m.Unit.WrappedLine,select:!1,value:-1},id:"cursorPageDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.PageDown}})),s.CursorPageDownSelect=a(new M({args:{direction:m.Direction.Down,unit:m.Unit.WrappedLine,select:!0,value:-1},id:"cursorPageDownSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.PageDown}})),s.CreateCursor=a(new class extends f{constructor(){super({id:"createCursor",precondition:void 0})}runCoreEditorCommand(r,e){if(!e.position)return;let t;e.wholeLine?t=P.line(r,r.getPrimaryCursorState(),!1,e.position,e.viewPosition):t=P.moveTo(r,r.getPrimaryCursorState(),!1,e.position,e.viewPosition);const o=r.getCursorStates();if(o.length>1){const d=t.modelState?t.modelState.position:null,S=t.viewState?t.viewState.position:null;for(let A=0,L=o.length;A<L;A++){const _=o[A];if(!(d&&!_.modelState.selection.containsPosition(d))&&!(S&&!_.viewState.selection.containsPosition(S))){o.splice(A,1),r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,o);return}}}o.push(t),r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,o)}}),s.LastCursorMoveToSelect=a(new class extends f{constructor(){super({id:"_lastCursorMoveToSelect",precondition:void 0})}runCoreEditorCommand(r,e){if(!e.position)return;const t=r.getLastAddedCursorIndex(),o=r.getCursorStates(),d=o.slice(0);d[t]=P.moveTo(r,o[t],!0,e.position,e.viewPosition),r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,d)}});class Y extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,P.moveToBeginningOfLine(e,e.getCursorStates(),this._inSelectionMode)),e.revealAllCursors(t.source,!0)}}s.CursorHome=a(new Y({inSelectionMode:!1,id:"cursorHome",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.Home,mac:{primary:i.Home,secondary:[n.CtrlCmd|i.LeftArrow]}}})),s.CursorHomeSelect=a(new Y({inSelectionMode:!0,id:"cursorHomeSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.Home,mac:{primary:n.Shift|i.Home,secondary:[n.CtrlCmd|n.Shift|i.LeftArrow]}}}));class $ extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,this._exec(e.getCursorStates())),e.revealAllCursors(t.source,!0)}_exec(e){const t=[];for(let o=0,d=e.length;o<d;o++){const S=e[o],A=S.modelState.position.lineNumber;t[o]=z.fromModelState(S.modelState.move(this._inSelectionMode,A,1,0))}return t}}s.CursorLineStart=a(new $({inSelectionMode:!1,id:"cursorLineStart",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:0,mac:{primary:n.WinCtrl|i.KeyA}}})),s.CursorLineStartSelect=a(new $({inSelectionMode:!0,id:"cursorLineStartSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:0,mac:{primary:n.WinCtrl|n.Shift|i.KeyA}}}));class N extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,P.moveToEndOfLine(e,e.getCursorStates(),this._inSelectionMode,t.sticky||!1)),e.revealAllCursors(t.source,!0)}}s.CursorEnd=a(new N({inSelectionMode:!1,id:"cursorEnd",precondition:void 0,kbOpts:{args:{sticky:!1},weight:u,kbExpr:c.textInputFocus,primary:i.End,mac:{primary:i.End,secondary:[n.CtrlCmd|i.RightArrow]}},metadata:{description:"Go to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:Z.localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}})),s.CursorEndSelect=a(new N({inSelectionMode:!0,id:"cursorEndSelect",precondition:void 0,kbOpts:{args:{sticky:!1},weight:u,kbExpr:c.textInputFocus,primary:n.Shift|i.End,mac:{primary:n.Shift|i.End,secondary:[n.CtrlCmd|n.Shift|i.RightArrow]}},metadata:{description:"Select to End",args:[{name:"args",schema:{type:"object",properties:{sticky:{description:Z.localize("stickydesc","Stick to the end even when going to longer lines"),type:"boolean",default:!1}}}}]}}));class ee extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,this._exec(e,e.getCursorStates())),e.revealAllCursors(t.source,!0)}_exec(e,t){const o=[];for(let d=0,S=t.length;d<S;d++){const A=t[d],L=A.modelState.position.lineNumber,_=e.model.getLineMaxColumn(L);o[d]=z.fromModelState(A.modelState.move(this._inSelectionMode,L,_,0))}return o}}s.CursorLineEnd=a(new ee({inSelectionMode:!1,id:"cursorLineEnd",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:0,mac:{primary:n.WinCtrl|i.KeyE}}})),s.CursorLineEndSelect=a(new ee({inSelectionMode:!0,id:"cursorLineEndSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:0,mac:{primary:n.WinCtrl|n.Shift|i.KeyE}}}));class te extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,P.moveToBeginningOfBuffer(e,e.getCursorStates(),this._inSelectionMode)),e.revealAllCursors(t.source,!0)}}s.CursorTop=a(new te({inSelectionMode:!1,id:"cursorTop",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.Home,mac:{primary:n.CtrlCmd|i.UpArrow}}})),s.CursorTopSelect=a(new te({inSelectionMode:!0,id:"cursorTopSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|i.Home,mac:{primary:n.CtrlCmd|n.Shift|i.UpArrow}}}));class oe extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,P.moveToEndOfBuffer(e,e.getCursorStates(),this._inSelectionMode)),e.revealAllCursors(t.source,!0)}}s.CursorBottom=a(new oe({inSelectionMode:!1,id:"cursorBottom",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.End,mac:{primary:n.CtrlCmd|i.DownArrow}}})),s.CursorBottomSelect=a(new oe({inSelectionMode:!0,id:"cursorBottomSelect",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|n.Shift|i.End,mac:{primary:n.CtrlCmd|n.Shift|i.DownArrow}}}));class Se extends f{constructor(){super({id:"editorScroll",precondition:void 0,metadata:O.metadata})}determineScrollMethod(e){const t=[6],o=[1,2,3,4,5,6],d=[4,2],S=[1,3];return t.includes(e.unit)&&d.includes(e.direction)?this._runHorizontalEditorScroll.bind(this):o.includes(e.unit)&&S.includes(e.direction)?this._runVerticalEditorScroll.bind(this):null}runCoreEditorCommand(e,t){const o=O.parse(t);if(!o)return;const d=this.determineScrollMethod(o);d&&d(e,t.source,o)}_runVerticalEditorScroll(e,t,o){const d=this._computeDesiredScrollTop(e,o);if(o.revealCursor){const S=e.getCompletelyVisibleViewRangeAtScrollTop(d);e.setCursorStates(t,w.Explicit,[P.findPositionInViewportIfOutside(e,e.getPrimaryCursorState(),S,o.select)])}e.viewLayout.setScrollPosition({scrollTop:d},J.Smooth)}_computeDesiredScrollTop(e,t){if(t.unit===1){const S=e.viewLayout.getFutureViewport(),A=e.getCompletelyVisibleViewRangeAtScrollTop(S.top),L=e.coordinatesConverter.convertViewRangeToModelRange(A);let _;t.direction===1?_=Math.max(1,L.startLineNumber-t.value):_=Math.min(e.model.getLineCount(),L.startLineNumber+t.value);const fe=e.coordinatesConverter.convertModelPositionToViewPosition(new ue(_,1));return e.viewLayout.getVerticalOffsetForLineNumber(fe.lineNumber)}if(t.unit===5){let S=0;return t.direction===3&&(S=e.model.getLineCount()-e.cursorConfig.pageSize),e.viewLayout.getVerticalOffsetForLineNumber(S)}let o;t.unit===3?o=e.cursorConfig.pageSize*t.value:t.unit===4?o=Math.round(e.cursorConfig.pageSize/2)*t.value:o=t.value;const d=(t.direction===1?-1:1)*o;return e.viewLayout.getCurrentScrollTop()+d*e.cursorConfig.lineHeight}_runHorizontalEditorScroll(e,t,o){const d=this._computeDesiredScrollLeft(e,o);e.viewLayout.setScrollPosition({scrollLeft:d},J.Smooth)}_computeDesiredScrollLeft(e,t){const o=(t.direction===4?-1:1)*t.value;return e.viewLayout.getCurrentScrollLeft()+o*e.cursorConfig.typicalHalfwidthCharacterWidth}}s.EditorScrollImpl=Se,s.EditorScroll=a(new Se),s.ScrollLineUp=a(new class extends f{constructor(){super({id:"scrollLineUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.UpArrow,mac:{primary:n.WinCtrl|i.PageUp}}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Up,by:O.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollPageUp=a(new class extends f{constructor(){super({id:"scrollPageUp",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.PageUp,win:{primary:n.Alt|i.PageUp},linux:{primary:n.Alt|i.PageUp}}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Up,by:O.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollEditorTop=a(new class extends f{constructor(){super({id:"scrollEditorTop",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Up,by:O.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollLineDown=a(new class extends f{constructor(){super({id:"scrollLineDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.DownArrow,mac:{primary:n.WinCtrl|i.PageDown}}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Down,by:O.RawUnit.WrappedLine,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollPageDown=a(new class extends f{constructor(){super({id:"scrollPageDown",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:n.CtrlCmd|i.PageDown,win:{primary:n.Alt|i.PageDown},linux:{primary:n.Alt|i.PageDown}}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Down,by:O.RawUnit.Page,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollEditorBottom=a(new class extends f{constructor(){super({id:"scrollEditorBottom",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Down,by:O.RawUnit.Editor,value:1,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollLeft=a(new class extends f{constructor(){super({id:"scrollLeft",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Left,by:O.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:e.source})}}),s.ScrollRight=a(new class extends f{constructor(){super({id:"scrollRight",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus}})}runCoreEditorCommand(r,e){s.EditorScroll.runCoreEditorCommand(r,{to:O.RawDirection.Right,by:O.RawUnit.Column,value:2,revealCursor:!1,select:!1,source:e.source})}});class re extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){t.position&&(e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,[P.word(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position)]),t.revealType!==2&&e.revealAllCursors(t.source,!0,!0))}}s.WordSelect=a(new re({inSelectionMode:!1,id:"_wordSelect",precondition:void 0})),s.WordSelectDrag=a(new re({inSelectionMode:!0,id:"_wordSelectDrag",precondition:void 0})),s.LastCursorWordSelect=a(new class extends f{constructor(){super({id:"lastCursorWordSelect",precondition:void 0})}runCoreEditorCommand(r,e){if(!e.position)return;const t=r.getLastAddedCursorIndex(),o=r.getCursorStates(),d=o.slice(0),S=o[t];d[t]=P.word(r,S,S.modelState.hasSelection(),e.position),r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,d)}});class ne extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){t.position&&(e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,[P.line(e,e.getPrimaryCursorState(),this._inSelectionMode,t.position,t.viewPosition)]),t.revealType!==2&&e.revealAllCursors(t.source,!1,!0))}}s.LineSelect=a(new ne({inSelectionMode:!1,id:"_lineSelect",precondition:void 0})),s.LineSelectDrag=a(new ne({inSelectionMode:!0,id:"_lineSelectDrag",precondition:void 0}));class ie extends f{_inSelectionMode;constructor(e){super(e),this._inSelectionMode=e.inSelectionMode}runCoreEditorCommand(e,t){if(!t.position)return;const o=e.getLastAddedCursorIndex(),d=e.getCursorStates(),S=d.slice(0);S[o]=P.line(e,d[o],this._inSelectionMode,t.position,t.viewPosition),e.model.pushStackElement(),e.setCursorStates(t.source,w.Explicit,S)}}s.LastCursorLineSelect=a(new ie({inSelectionMode:!1,id:"lastCursorLineSelect",precondition:void 0})),s.LastCursorLineSelectDrag=a(new ie({inSelectionMode:!0,id:"lastCursorLineSelectDrag",precondition:void 0})),s.CancelSelection=a(new class extends f{constructor(){super({id:"cancelSelection",precondition:c.hasNonEmptySelection,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.Escape,secondary:[n.Shift|i.Escape]}})}runCoreEditorCommand(r,e){r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,[P.cancelSelection(r,r.getPrimaryCursorState())]),r.revealAllCursors(e.source,!0)}}),s.RemoveSecondaryCursors=a(new class extends f{constructor(){super({id:"removeSecondaryCursors",precondition:c.hasMultipleSelections,kbOpts:{weight:u+1,kbExpr:c.textInputFocus,primary:i.Escape,secondary:[n.Shift|i.Escape]}})}runCoreEditorCommand(r,e){r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,[r.getPrimaryCursorState()]),r.revealAllCursors(e.source,!0),xe(Z.localize("removedCursor","Removed secondary cursors"))}}),s.RevealLine=a(new class extends f{constructor(){super({id:"revealLine",precondition:void 0,metadata:K.metadata})}runCoreEditorCommand(r,e){const t=e,o=t.lineNumber||0;let d=typeof o=="number"?o+1:parseInt(o)+1;d<1&&(d=1);const S=r.model.getLineCount();d>S&&(d=S);const A=new Oe(d,1,d,r.model.getLineMaxColumn(d));let L=j.Simple;if(t.at)switch(t.at){case K.RawAtArgument.Top:L=j.Top;break;case K.RawAtArgument.Center:L=j.Center;break;case K.RawAtArgument.Bottom:L=j.Bottom;break;default:break}const _=r.coordinatesConverter.convertModelRangeToViewRange(A);r.revealRange(e.source,!1,_,L,J.Smooth)}}),s.SelectAll=new class extends X{constructor(){super(ge)}runDOMCommand(r){Ee&&(r.focus(),r.select()),r.ownerDocument.execCommand("selectAll")}runEditorCommand(r,e,t){const o=e._getViewModel();o&&this.runCoreEditorCommand(o,t)}runCoreEditorCommand(r,e){r.model.pushStackElement(),r.setCursorStates("keyboard",w.Explicit,[P.selectAll(r,r.getPrimaryCursorState())])}},s.SetSelection=a(new class extends f{constructor(){super({id:"setSelection",precondition:void 0})}runCoreEditorCommand(r,e){e.selection&&(r.model.pushStackElement(),r.setCursorStates(e.source,w.Explicit,[z.fromModelSelection(e.selection)]))}})})(T||={});const ve=Q.and(c.textInputFocus,c.columnSelection);function W(E,y){Pe.registerKeybindingRule({id:E,primary:y,when:ve,weight:u+1})}W(T.CursorColumnSelectLeft.id,n.Shift|i.LeftArrow),W(T.CursorColumnSelectRight.id,n.Shift|i.RightArrow),W(T.CursorColumnSelectUp.id,n.Shift|i.UpArrow),W(T.CursorColumnSelectPageUp.id,n.Shift|i.PageUp),W(T.CursorColumnSelectDown.id,n.Shift|i.DownArrow),W(T.CursorColumnSelectPageDown.id,n.Shift|i.PageDown);function me(E){return E.register(),E}var De;(I=>{class E extends se{runEditorCommand(l,D,b){const R=D._getViewModel();R&&this.runCoreEditingCommand(D,R,b||{})}}I.CoreEditingCommand=E,I.LineBreakInsert=a(new class extends E{constructor(){super({id:"lineBreakInsert",precondition:c.writable,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:0,mac:{primary:n.WinCtrl|i.KeyO}}})}runCoreEditingCommand(p,l,D){p.pushUndoStop(),p.executeCommands(this.id,Ae.lineBreakInsert(l.cursorConfig,l.model,l.getCursorStates().map(b=>b.modelState.selection)))}}),I.Outdent=a(new class extends E{constructor(){super({id:"outdent",precondition:c.writable,kbOpts:{weight:u,kbExpr:Q.and(c.editorTextFocus,c.tabDoesNotMoveFocus),primary:n.Shift|i.Tab}})}runCoreEditingCommand(p,l,D){p.pushUndoStop(),p.executeCommands(this.id,de.outdent(l.cursorConfig,l.model,l.getCursorStates().map(b=>b.modelState.selection))),p.pushUndoStop()}}),I.Tab=a(new class extends E{constructor(){super({id:"tab",precondition:c.writable,kbOpts:{weight:u,kbExpr:Q.and(c.editorTextFocus,c.tabDoesNotMoveFocus),primary:i.Tab}})}runCoreEditingCommand(p,l,D){p.pushUndoStop(),p.executeCommands(this.id,de.tab(l.cursorConfig,l.model,l.getCursorStates().map(b=>b.modelState.selection))),p.pushUndoStop()}}),I.DeleteLeft=a(new class extends E{constructor(){super({id:"deleteLeft",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.Backspace,secondary:[n.Shift|i.Backspace],mac:{primary:i.Backspace,secondary:[n.Shift|i.Backspace,n.WinCtrl|i.KeyH,n.WinCtrl|i.Backspace]}}})}runCoreEditingCommand(p,l,D){const[b,R]=ce.deleteLeft(l.getPrevEditOperationType(),l.cursorConfig,l.model,l.getCursorStates().map(k=>k.modelState.selection),l.getCursorAutoClosedCharacters());b&&p.pushUndoStop(),p.executeCommands(this.id,R),l.setPrevEditOperationType(ae.DeletingLeft)}}),I.DeleteRight=a(new class extends E{constructor(){super({id:"deleteRight",precondition:void 0,kbOpts:{weight:u,kbExpr:c.textInputFocus,primary:i.Delete,mac:{primary:i.Delete,secondary:[n.WinCtrl|i.KeyD,n.WinCtrl|i.Delete]}}})}runCoreEditingCommand(p,l,D){const[b,R]=ce.deleteRight(l.getPrevEditOperationType(),l.cursorConfig,l.model,l.getCursorStates().map(k=>k.modelState.selection));b&&p.pushUndoStop(),p.executeCommands(this.id,R),l.setPrevEditOperationType(ae.DeletingRight)}}),I.Undo=new class extends X{constructor(){super(he)}runDOMCommand(p){p.ownerDocument.execCommand("undo")}runEditorCommand(p,l,D){if(!(!l.hasModel()||l.getOption(le.readOnly)===!0))return l.getModel().undo()}},I.Redo=new class extends X{constructor(){super(we)}runDOMCommand(p){p.ownerDocument.execCommand("redo")}runEditorCommand(p,l,D){if(!(!l.hasModel()||l.getOption(le.readOnly)===!0))return l.getModel().redo()}}})(De||={});class pe extends be{_handlerId;constructor(y,h,C){super({id:y,precondition:void 0,metadata:C}),this._handlerId=h}runCommand(y,h){const C=y.get(q).getFocusedCodeEditor();C&&C.trigger("keyboard",this._handlerId,h)}}function F(E,y){me(new pe("default:"+E,E)),me(new pe(E,E,y))}F(V.Type,{description:"Type",args:[{name:"args",schema:{type:"object",required:["text"],properties:{text:{type:"string"}}}}]}),F(V.ReplacePreviousChar),F(V.CompositionType),F(V.CompositionStart),F(V.CompositionEnd),F(V.Paste),F(V.Cut);export{De as CoreEditingCommands,f as CoreEditorCommand,T as CoreNavigationCommands,O as EditorScroll_,Le as NavigationCommandRevealType,K as RevealLine_};
