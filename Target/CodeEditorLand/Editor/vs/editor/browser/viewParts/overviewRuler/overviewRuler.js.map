{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/viewParts/overviewRuler/overviewRuler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { FastDomNode, createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { IOverviewRuler } from '../../editorBrowser.js';\nimport { OverviewRulerPosition, EditorOption } from '../../../common/config/editorOptions.js';\nimport { ColorZone, OverviewRulerZone, OverviewZoneManager } from '../../../common/viewModel/overviewZoneManager.js';\nimport { ViewContext } from '../../../common/viewModel/viewContext.js';\nimport * as viewEvents from '../../../common/viewEvents.js';\nimport { ViewEventHandler } from '../../../common/viewEventHandler.js';\n\n/**\n * The overview ruler appears underneath the editor scroll bar and shows things\n * like the cursor, various decorations, etc.\n */\nexport class OverviewRuler extends ViewEventHandler implements IOverviewRuler {\n\n\tprivate readonly _context: ViewContext;\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _zoneManager: OverviewZoneManager;\n\n\tconstructor(context: ViewContext, cssClassName: string) {\n\t\tsuper();\n\t\tthis._context = context;\n\t\tconst options = this._context.configuration.options;\n\n\t\tthis._domNode = createFastDomNode(document.createElement('canvas'));\n\t\tthis._domNode.setClassName(cssClassName);\n\t\tthis._domNode.setPosition('absolute');\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain('strict');\n\n\t\tthis._zoneManager = new OverviewZoneManager((lineNumber: number) => this._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber));\n\t\tthis._zoneManager.setDOMWidth(0);\n\t\tthis._zoneManager.setDOMHeight(0);\n\t\tthis._zoneManager.setOuterHeight(this._context.viewLayout.getScrollHeight());\n\t\tthis._zoneManager.setLineHeight(options.get(EditorOption.lineHeight));\n\n\t\tthis._zoneManager.setPixelRatio(options.get(EditorOption.pixelRatio));\n\n\t\tthis._context.addEventHandler(this);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._context.removeEventHandler(this);\n\t\tsuper.dispose();\n\t}\n\n\t// ---- begin view event handlers\n\n\tpublic override onConfigurationChanged(e: viewEvents.ViewConfigurationChangedEvent): boolean {\n\t\tconst options = this._context.configuration.options;\n\n\t\tif (e.hasChanged(EditorOption.lineHeight)) {\n\t\t\tthis._zoneManager.setLineHeight(options.get(EditorOption.lineHeight));\n\t\t\tthis._render();\n\t\t}\n\n\t\tif (e.hasChanged(EditorOption.pixelRatio)) {\n\t\t\tthis._zoneManager.setPixelRatio(options.get(EditorOption.pixelRatio));\n\t\t\tthis._domNode.setWidth(this._zoneManager.getDOMWidth());\n\t\t\tthis._domNode.setHeight(this._zoneManager.getDOMHeight());\n\t\t\tthis._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n\t\t\tthis._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n\t\t\tthis._render();\n\t\t}\n\n\t\treturn true;\n\t}\n\tpublic override onFlushed(e: viewEvents.ViewFlushedEvent): boolean {\n\t\tthis._render();\n\t\treturn true;\n\t}\n\tpublic override onScrollChanged(e: viewEvents.ViewScrollChangedEvent): boolean {\n\t\tif (e.scrollHeightChanged) {\n\t\t\tthis._zoneManager.setOuterHeight(e.scrollHeight);\n\t\t\tthis._render();\n\t\t}\n\t\treturn true;\n\t}\n\tpublic override onZonesChanged(e: viewEvents.ViewZonesChangedEvent): boolean {\n\t\tthis._render();\n\t\treturn true;\n\t}\n\n\t// ---- end view event handlers\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._domNode.domNode;\n\t}\n\n\tpublic setLayout(position: OverviewRulerPosition): void {\n\t\tthis._domNode.setTop(position.top);\n\t\tthis._domNode.setRight(position.right);\n\n\t\tlet hasChanged = false;\n\t\thasChanged = this._zoneManager.setDOMWidth(position.width) || hasChanged;\n\t\thasChanged = this._zoneManager.setDOMHeight(position.height) || hasChanged;\n\n\t\tif (hasChanged) {\n\t\t\tthis._domNode.setWidth(this._zoneManager.getDOMWidth());\n\t\t\tthis._domNode.setHeight(this._zoneManager.getDOMHeight());\n\t\t\tthis._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n\t\t\tthis._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n\n\t\t\tthis._render();\n\t\t}\n\t}\n\n\tpublic setZones(zones: OverviewRulerZone[]): void {\n\t\tthis._zoneManager.setZones(zones);\n\t\tthis._render();\n\t}\n\n\tprivate _render(): boolean {\n\t\tif (this._zoneManager.getOuterHeight() === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst width = this._zoneManager.getCanvasWidth();\n\t\tconst height = this._zoneManager.getCanvasHeight();\n\n\t\tconst colorZones = this._zoneManager.resolveColorZones();\n\t\tconst id2Color = this._zoneManager.getId2Color();\n\n\t\tconst ctx = this._domNode.domNode.getContext('2d')!;\n\t\tctx.clearRect(0, 0, width, height);\n\t\tif (colorZones.length > 0) {\n\t\t\tthis._renderOneLane(ctx, colorZones, id2Color, width);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate _renderOneLane(ctx: CanvasRenderingContext2D, colorZones: ColorZone[], id2Color: string[], width: number): void {\n\n\t\tlet currentColorId = 0;\n\t\tlet currentFrom = 0;\n\t\tlet currentTo = 0;\n\n\t\tfor (const zone of colorZones) {\n\n\t\t\tconst zoneColorId = zone.colorId;\n\t\t\tconst zoneFrom = zone.from;\n\t\t\tconst zoneTo = zone.to;\n\n\t\t\tif (zoneColorId !== currentColorId) {\n\t\t\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\n\t\t\t\tcurrentColorId = zoneColorId;\n\t\t\t\tctx.fillStyle = id2Color[currentColorId];\n\t\t\t\tcurrentFrom = zoneFrom;\n\t\t\t\tcurrentTo = zoneTo;\n\t\t\t} else {\n\t\t\t\tif (currentTo >= zoneFrom) {\n\t\t\t\t\tcurrentTo = Math.max(currentTo, zoneTo);\n\t\t\t\t} else {\n\t\t\t\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\t\t\t\t\tcurrentFrom = zoneFrom;\n\t\t\t\t\tcurrentTo = zoneTo;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
