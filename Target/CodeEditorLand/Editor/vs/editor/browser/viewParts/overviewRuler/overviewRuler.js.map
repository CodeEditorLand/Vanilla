{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/viewParts/overviewRuler/overviewRuler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\ttype FastDomNode,\n\tcreateFastDomNode,\n} from \"../../../../base/browser/fastDomNode.js\";\nimport {\n\tEditorOption,\n\ttype OverviewRulerPosition,\n} from \"../../../common/config/editorOptions.js\";\nimport { ViewEventHandler } from \"../../../common/viewEventHandler.js\";\nimport type * as viewEvents from \"../../../common/viewEvents.js\";\nimport {\n\ttype ColorZone,\n\ttype OverviewRulerZone,\n\tOverviewZoneManager,\n} from \"../../../common/viewModel/overviewZoneManager.js\";\nimport type { ViewContext } from \"../../../common/viewModel/viewContext.js\";\nimport type { IOverviewRuler } from \"../../editorBrowser.js\";\n\n/**\n * The overview ruler appears underneath the editor scroll bar and shows things\n * like the cursor, various decorations, etc.\n */\nexport class OverviewRuler extends ViewEventHandler implements IOverviewRuler {\n\tprivate readonly _context: ViewContext;\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _zoneManager: OverviewZoneManager;\n\n\tconstructor(context: ViewContext, cssClassName: string) {\n\t\tsuper();\n\t\tthis._context = context;\n\t\tconst options = this._context.configuration.options;\n\n\t\tthis._domNode = createFastDomNode(document.createElement(\"canvas\"));\n\t\tthis._domNode.setClassName(cssClassName);\n\t\tthis._domNode.setPosition(\"absolute\");\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain(\"strict\");\n\n\t\tthis._zoneManager = new OverviewZoneManager((lineNumber: number) =>\n\t\t\tthis._context.viewLayout.getVerticalOffsetForLineNumber(lineNumber),\n\t\t);\n\t\tthis._zoneManager.setDOMWidth(0);\n\t\tthis._zoneManager.setDOMHeight(0);\n\t\tthis._zoneManager.setOuterHeight(\n\t\t\tthis._context.viewLayout.getScrollHeight(),\n\t\t);\n\t\tthis._zoneManager.setLineHeight(options.get(EditorOption.lineHeight));\n\n\t\tthis._zoneManager.setPixelRatio(options.get(EditorOption.pixelRatio));\n\n\t\tthis._context.addEventHandler(this);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._context.removeEventHandler(this);\n\t\tsuper.dispose();\n\t}\n\n\t// ---- begin view event handlers\n\n\tpublic override onConfigurationChanged(\n\t\te: viewEvents.ViewConfigurationChangedEvent,\n\t): boolean {\n\t\tconst options = this._context.configuration.options;\n\n\t\tif (e.hasChanged(EditorOption.lineHeight)) {\n\t\t\tthis._zoneManager.setLineHeight(\n\t\t\t\toptions.get(EditorOption.lineHeight),\n\t\t\t);\n\t\t\tthis._render();\n\t\t}\n\n\t\tif (e.hasChanged(EditorOption.pixelRatio)) {\n\t\t\tthis._zoneManager.setPixelRatio(\n\t\t\t\toptions.get(EditorOption.pixelRatio),\n\t\t\t);\n\t\t\tthis._domNode.setWidth(this._zoneManager.getDOMWidth());\n\t\t\tthis._domNode.setHeight(this._zoneManager.getDOMHeight());\n\t\t\tthis._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n\t\t\tthis._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n\t\t\tthis._render();\n\t\t}\n\n\t\treturn true;\n\t}\n\tpublic override onFlushed(e: viewEvents.ViewFlushedEvent): boolean {\n\t\tthis._render();\n\t\treturn true;\n\t}\n\tpublic override onScrollChanged(\n\t\te: viewEvents.ViewScrollChangedEvent,\n\t): boolean {\n\t\tif (e.scrollHeightChanged) {\n\t\t\tthis._zoneManager.setOuterHeight(e.scrollHeight);\n\t\t\tthis._render();\n\t\t}\n\t\treturn true;\n\t}\n\tpublic override onZonesChanged(\n\t\te: viewEvents.ViewZonesChangedEvent,\n\t): boolean {\n\t\tthis._render();\n\t\treturn true;\n\t}\n\n\t// ---- end view event handlers\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._domNode.domNode;\n\t}\n\n\tpublic setLayout(position: OverviewRulerPosition): void {\n\t\tthis._domNode.setTop(position.top);\n\t\tthis._domNode.setRight(position.right);\n\n\t\tlet hasChanged = false;\n\t\thasChanged =\n\t\t\tthis._zoneManager.setDOMWidth(position.width) || hasChanged;\n\t\thasChanged =\n\t\t\tthis._zoneManager.setDOMHeight(position.height) || hasChanged;\n\n\t\tif (hasChanged) {\n\t\t\tthis._domNode.setWidth(this._zoneManager.getDOMWidth());\n\t\t\tthis._domNode.setHeight(this._zoneManager.getDOMHeight());\n\t\t\tthis._domNode.domNode.width = this._zoneManager.getCanvasWidth();\n\t\t\tthis._domNode.domNode.height = this._zoneManager.getCanvasHeight();\n\n\t\t\tthis._render();\n\t\t}\n\t}\n\n\tpublic setZones(zones: OverviewRulerZone[]): void {\n\t\tthis._zoneManager.setZones(zones);\n\t\tthis._render();\n\t}\n\n\tprivate _render(): boolean {\n\t\tif (this._zoneManager.getOuterHeight() === 0) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst width = this._zoneManager.getCanvasWidth();\n\t\tconst height = this._zoneManager.getCanvasHeight();\n\n\t\tconst colorZones = this._zoneManager.resolveColorZones();\n\t\tconst id2Color = this._zoneManager.getId2Color();\n\n\t\tconst ctx = this._domNode.domNode.getContext(\"2d\")!;\n\t\tctx.clearRect(0, 0, width, height);\n\t\tif (colorZones.length > 0) {\n\t\t\tthis._renderOneLane(ctx, colorZones, id2Color, width);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tprivate _renderOneLane(\n\t\tctx: CanvasRenderingContext2D,\n\t\tcolorZones: ColorZone[],\n\t\tid2Color: string[],\n\t\twidth: number,\n\t): void {\n\t\tlet currentColorId = 0;\n\t\tlet currentFrom = 0;\n\t\tlet currentTo = 0;\n\n\t\tfor (const zone of colorZones) {\n\t\t\tconst zoneColorId = zone.colorId;\n\t\t\tconst zoneFrom = zone.from;\n\t\t\tconst zoneTo = zone.to;\n\n\t\t\tif (zoneColorId !== currentColorId) {\n\t\t\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\n\t\t\t\tcurrentColorId = zoneColorId;\n\t\t\t\tctx.fillStyle = id2Color[currentColorId];\n\t\t\t\tcurrentFrom = zoneFrom;\n\t\t\t\tcurrentTo = zoneTo;\n\t\t\t} else if (currentTo >= zoneFrom) {\n\t\t\t\tcurrentTo = Math.max(currentTo, zoneTo);\n\t\t\t} else {\n\t\t\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\t\t\t\tcurrentFrom = zoneFrom;\n\t\t\t\tcurrentTo = zoneTo;\n\t\t\t}\n\t\t}\n\n\t\tctx.fillRect(0, currentFrom, width, currentTo - currentFrom);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
