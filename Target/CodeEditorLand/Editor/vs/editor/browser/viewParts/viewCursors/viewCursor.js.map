{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/viewParts/viewCursors/viewCursor.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { FastDomNode, createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport { applyFontInfo } from '../../config/domFontInfo.js';\nimport { TextEditorCursorStyle, EditorOption } from '../../../common/config/editorOptions.js';\nimport { Position } from '../../../common/core/position.js';\nimport { Range } from '../../../common/core/range.js';\nimport { RenderingContext, RestrictedRenderingContext } from '../../view/renderingContext.js';\nimport { ViewContext } from '../../../common/viewModel/viewContext.js';\nimport * as viewEvents from '../../../common/viewEvents.js';\nimport { MOUSE_CURSOR_TEXT_CSS_CLASS_NAME } from '../../../../base/browser/ui/mouseCursor/mouseCursor.js';\n\nexport interface IViewCursorRenderData {\n\tdomNode: HTMLElement;\n\tposition: Position;\n\tcontentLeft: number;\n\twidth: number;\n\theight: number;\n}\n\nclass ViewCursorRenderData {\n\tconstructor(\n\t\tpublic readonly top: number,\n\t\tpublic readonly left: number,\n\t\tpublic readonly paddingLeft: number,\n\t\tpublic readonly width: number,\n\t\tpublic readonly height: number,\n\t\tpublic readonly textContent: string,\n\t\tpublic readonly textContentClassName: string\n\t) { }\n}\n\nexport enum CursorPlurality {\n\tSingle,\n\tMultiPrimary,\n\tMultiSecondary,\n}\n\nexport class ViewCursor {\n\tprivate readonly _context: ViewContext;\n\tprivate readonly _domNode: FastDomNode<HTMLElement>;\n\n\tprivate _cursorStyle: TextEditorCursorStyle;\n\tprivate _lineCursorWidth: number;\n\tprivate _lineHeight: number;\n\tprivate _typicalHalfwidthCharacterWidth: number;\n\n\tprivate _isVisible: boolean;\n\n\tprivate _position: Position;\n\tprivate _pluralityClass: string;\n\n\tprivate _lastRenderedContent: string;\n\tprivate _renderData: ViewCursorRenderData | null;\n\n\tconstructor(context: ViewContext, plurality: CursorPlurality) {\n\t\tthis._context = context;\n\t\tconst options = this._context.configuration.options;\n\t\tconst fontInfo = options.get(EditorOption.fontInfo);\n\n\t\tthis._cursorStyle = options.get(EditorOption.cursorStyle);\n\t\tthis._lineHeight = options.get(EditorOption.lineHeight);\n\t\tthis._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\n\t\tthis._lineCursorWidth = Math.min(options.get(EditorOption.cursorWidth), this._typicalHalfwidthCharacterWidth);\n\n\t\tthis._isVisible = true;\n\n\t\t// Create the dom node\n\t\tthis._domNode = createFastDomNode(document.createElement('div'));\n\t\tthis._domNode.setClassName(`cursor ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME}`);\n\t\tthis._domNode.setHeight(this._lineHeight);\n\t\tthis._domNode.setTop(0);\n\t\tthis._domNode.setLeft(0);\n\t\tapplyFontInfo(this._domNode, fontInfo);\n\t\tthis._domNode.setDisplay('none');\n\n\t\tthis._position = new Position(1, 1);\n\t\tthis._pluralityClass = '';\n\t\tthis.setPlurality(plurality);\n\n\t\tthis._lastRenderedContent = '';\n\t\tthis._renderData = null;\n\t}\n\n\tpublic getDomNode(): FastDomNode<HTMLElement> {\n\t\treturn this._domNode;\n\t}\n\n\tpublic getPosition(): Position {\n\t\treturn this._position;\n\t}\n\n\tpublic setPlurality(plurality: CursorPlurality) {\n\t\tswitch (plurality) {\n\t\t\tdefault:\n\t\t\tcase CursorPlurality.Single:\n\t\t\t\tthis._pluralityClass = '';\n\t\t\t\tbreak;\n\n\t\t\tcase CursorPlurality.MultiPrimary:\n\t\t\t\tthis._pluralityClass = 'cursor-primary';\n\t\t\t\tbreak;\n\n\t\t\tcase CursorPlurality.MultiSecondary:\n\t\t\t\tthis._pluralityClass = 'cursor-secondary';\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpublic show(): void {\n\t\tif (!this._isVisible) {\n\t\t\tthis._domNode.setVisibility('inherit');\n\t\t\tthis._isVisible = true;\n\t\t}\n\t}\n\n\tpublic hide(): void {\n\t\tif (this._isVisible) {\n\t\t\tthis._domNode.setVisibility('hidden');\n\t\t\tthis._isVisible = false;\n\t\t}\n\t}\n\n\tpublic onConfigurationChanged(e: viewEvents.ViewConfigurationChangedEvent): boolean {\n\t\tconst options = this._context.configuration.options;\n\t\tconst fontInfo = options.get(EditorOption.fontInfo);\n\n\t\tthis._cursorStyle = options.get(EditorOption.cursorStyle);\n\t\tthis._lineHeight = options.get(EditorOption.lineHeight);\n\t\tthis._typicalHalfwidthCharacterWidth = fontInfo.typicalHalfwidthCharacterWidth;\n\t\tthis._lineCursorWidth = Math.min(options.get(EditorOption.cursorWidth), this._typicalHalfwidthCharacterWidth);\n\t\tapplyFontInfo(this._domNode, fontInfo);\n\n\t\treturn true;\n\t}\n\n\tpublic onCursorPositionChanged(position: Position, pauseAnimation: boolean): boolean {\n\t\tif (pauseAnimation) {\n\t\t\tthis._domNode.domNode.style.transitionProperty = 'none';\n\t\t} else {\n\t\t\tthis._domNode.domNode.style.transitionProperty = '';\n\t\t}\n\t\tthis._position = position;\n\t\treturn true;\n\t}\n\n\t/**\n\t * If `this._position` is inside a grapheme, returns the position where the grapheme starts.\n\t * Also returns the next grapheme.\n\t */\n\tprivate _getGraphemeAwarePosition(): [Position, string] {\n\t\tconst { lineNumber, column } = this._position;\n\t\tconst lineContent = this._context.viewModel.getLineContent(lineNumber);\n\t\tconst [startOffset, endOffset] = strings.getCharContainingOffset(lineContent, column - 1);\n\t\treturn [new Position(lineNumber, startOffset + 1), lineContent.substring(startOffset, endOffset)];\n\t}\n\n\tprivate _prepareRender(ctx: RenderingContext): ViewCursorRenderData | null {\n\t\tlet textContent = '';\n\t\tlet textContentClassName = '';\n\t\tconst [position, nextGrapheme] = this._getGraphemeAwarePosition();\n\n\t\tif (this._cursorStyle === TextEditorCursorStyle.Line || this._cursorStyle === TextEditorCursorStyle.LineThin) {\n\t\t\tconst visibleRange = ctx.visibleRangeForPosition(position);\n\t\t\tif (!visibleRange || visibleRange.outsideRenderedLine) {\n\t\t\t\t// Outside viewport\n\t\t\t\treturn null;\n\t\t\t}\n\n\t\t\tconst window = dom.getWindow(this._domNode.domNode);\n\t\t\tlet width: number;\n\t\t\tif (this._cursorStyle === TextEditorCursorStyle.Line) {\n\t\t\t\twidth = dom.computeScreenAwareSize(window, this._lineCursorWidth > 0 ? this._lineCursorWidth : 2);\n\t\t\t\tif (width > 2) {\n\t\t\t\t\ttextContent = nextGrapheme;\n\t\t\t\t\ttextContentClassName = this._getTokenClassName(position);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twidth = dom.computeScreenAwareSize(window, 1);\n\t\t\t}\n\n\t\t\tlet left = visibleRange.left;\n\t\t\tlet paddingLeft = 0;\n\t\t\tif (width >= 2 && left >= 1) {\n\t\t\t\t// shift the cursor a bit between the characters\n\t\t\t\tpaddingLeft = 1;\n\t\t\t\tleft -= paddingLeft;\n\t\t\t}\n\n\t\t\tconst top = ctx.getVerticalOffsetForLineNumber(position.lineNumber) - ctx.bigNumbersDelta;\n\t\t\treturn new ViewCursorRenderData(top, left, paddingLeft, width, this._lineHeight, textContent, textContentClassName);\n\t\t}\n\n\t\tconst visibleRangeForCharacter = ctx.linesVisibleRangesForRange(new Range(position.lineNumber, position.column, position.lineNumber, position.column + nextGrapheme.length), false);\n\t\tif (!visibleRangeForCharacter || visibleRangeForCharacter.length === 0) {\n\t\t\t// Outside viewport\n\t\t\treturn null;\n\t\t}\n\n\t\tconst firstVisibleRangeForCharacter = visibleRangeForCharacter[0];\n\t\tif (firstVisibleRangeForCharacter.outsideRenderedLine || firstVisibleRangeForCharacter.ranges.length === 0) {\n\t\t\t// Outside viewport\n\t\t\treturn null;\n\t\t}\n\n\t\tconst range = firstVisibleRangeForCharacter.ranges[0];\n\t\tconst width = (\n\t\t\tnextGrapheme === '\\t'\n\t\t\t\t? this._typicalHalfwidthCharacterWidth\n\t\t\t\t: (range.width < 1\n\t\t\t\t\t? this._typicalHalfwidthCharacterWidth\n\t\t\t\t\t: range.width)\n\t\t);\n\n\t\tif (this._cursorStyle === TextEditorCursorStyle.Block) {\n\t\t\ttextContent = nextGrapheme;\n\t\t\ttextContentClassName = this._getTokenClassName(position);\n\t\t}\n\n\t\tlet top = ctx.getVerticalOffsetForLineNumber(position.lineNumber) - ctx.bigNumbersDelta;\n\t\tlet height = this._lineHeight;\n\n\t\t// Underline might interfere with clicking\n\t\tif (this._cursorStyle === TextEditorCursorStyle.Underline || this._cursorStyle === TextEditorCursorStyle.UnderlineThin) {\n\t\t\ttop += this._lineHeight - 2;\n\t\t\theight = 2;\n\t\t}\n\n\t\treturn new ViewCursorRenderData(top, range.left, 0, width, height, textContent, textContentClassName);\n\t}\n\n\tprivate _getTokenClassName(position: Position): string {\n\t\tconst lineData = this._context.viewModel.getViewLineData(position.lineNumber);\n\t\tconst tokenIndex = lineData.tokens.findTokenIndexAtOffset(position.column - 1);\n\t\treturn lineData.tokens.getClassName(tokenIndex);\n\t}\n\n\tpublic prepareRender(ctx: RenderingContext): void {\n\t\tthis._renderData = this._prepareRender(ctx);\n\t}\n\n\tpublic render(ctx: RestrictedRenderingContext): IViewCursorRenderData | null {\n\t\tif (!this._renderData) {\n\t\t\tthis._domNode.setDisplay('none');\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._lastRenderedContent !== this._renderData.textContent) {\n\t\t\tthis._lastRenderedContent = this._renderData.textContent;\n\t\t\tthis._domNode.domNode.textContent = this._lastRenderedContent;\n\t\t}\n\n\t\tthis._domNode.setClassName(`cursor ${this._pluralityClass} ${MOUSE_CURSOR_TEXT_CSS_CLASS_NAME} ${this._renderData.textContentClassName}`);\n\n\t\tthis._domNode.setDisplay('block');\n\t\tthis._domNode.setTop(this._renderData.top);\n\t\tthis._domNode.setLeft(this._renderData.left);\n\t\tthis._domNode.setPaddingLeft(this._renderData.paddingLeft);\n\t\tthis._domNode.setWidth(this._renderData.width);\n\t\tthis._domNode.setLineHeight(this._renderData.height);\n\t\tthis._domNode.setHeight(this._renderData.height);\n\n\t\treturn {\n\t\t\tdomNode: this._domNode.domNode,\n\t\t\tposition: this._position,\n\t\t\tcontentLeft: this._renderData.left,\n\t\t\theight: this._renderData.height,\n\t\t\twidth: 2\n\t\t};\n\t}\n}\n"],
  "mappings": "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",
  "names": ["CursorPlurality", "width", "top"]
}
