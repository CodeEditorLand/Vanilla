{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/viewParts/overlayWidgets/overlayWidgets.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport './overlayWidgets.css';\nimport { FastDomNode, createFastDomNode } from '../../../../base/browser/fastDomNode.js';\nimport { IOverlayWidget, IOverlayWidgetPosition, IOverlayWidgetPositionCoordinates, OverlayWidgetPositionPreference } from '../../editorBrowser.js';\nimport { PartFingerprint, PartFingerprints, ViewPart } from '../../view/viewPart.js';\nimport { RenderingContext, RestrictedRenderingContext } from '../../view/renderingContext.js';\nimport { ViewContext } from '../../../common/viewModel/viewContext.js';\nimport * as viewEvents from '../../../common/viewEvents.js';\nimport { EditorOption } from '../../../common/config/editorOptions.js';\nimport * as dom from '../../../../base/browser/dom.js';\n\n\ninterface IWidgetData {\n\twidget: IOverlayWidget;\n\tpreference: OverlayWidgetPositionPreference | IOverlayWidgetPositionCoordinates | null;\n\tstack?: number;\n\tdomNode: FastDomNode<HTMLElement>;\n}\n\ninterface IWidgetMap {\n\t[key: string]: IWidgetData;\n}\n\nexport class ViewOverlayWidgets extends ViewPart {\n\n\tprivate readonly _viewDomNode: FastDomNode<HTMLElement>;\n\tprivate _widgets: IWidgetMap;\n\tprivate _viewDomNodeRect: dom.IDomNodePagePosition;\n\tprivate readonly _domNode: FastDomNode<HTMLElement>;\n\tpublic readonly overflowingOverlayWidgetsDomNode: FastDomNode<HTMLElement>;\n\tprivate _verticalScrollbarWidth: number;\n\tprivate _minimapWidth: number;\n\tprivate _horizontalScrollbarHeight: number;\n\tprivate _editorHeight: number;\n\tprivate _editorWidth: number;\n\n\tconstructor(context: ViewContext, viewDomNode: FastDomNode<HTMLElement>) {\n\t\tsuper(context);\n\t\tthis._viewDomNode = viewDomNode;\n\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\tthis._widgets = {};\n\t\tthis._verticalScrollbarWidth = layoutInfo.verticalScrollbarWidth;\n\t\tthis._minimapWidth = layoutInfo.minimap.minimapWidth;\n\t\tthis._horizontalScrollbarHeight = layoutInfo.horizontalScrollbarHeight;\n\t\tthis._editorHeight = layoutInfo.height;\n\t\tthis._editorWidth = layoutInfo.width;\n\t\tthis._viewDomNodeRect = { top: 0, left: 0, width: 0, height: 0 };\n\n\t\tthis._domNode = createFastDomNode(document.createElement('div'));\n\t\tPartFingerprints.write(this._domNode, PartFingerprint.OverlayWidgets);\n\t\tthis._domNode.setClassName('overlayWidgets');\n\n\t\tthis.overflowingOverlayWidgetsDomNode = createFastDomNode(document.createElement('div'));\n\t\tPartFingerprints.write(this.overflowingOverlayWidgetsDomNode, PartFingerprint.OverflowingOverlayWidgets);\n\t\tthis.overflowingOverlayWidgetsDomNode.setClassName('overflowingOverlayWidgets');\n\t}\n\n\tpublic override dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._widgets = {};\n\t}\n\n\tpublic getDomNode(): FastDomNode<HTMLElement> {\n\t\treturn this._domNode;\n\t}\n\n\t// ---- begin view event handlers\n\n\tpublic override onConfigurationChanged(e: viewEvents.ViewConfigurationChangedEvent): boolean {\n\t\tconst options = this._context.configuration.options;\n\t\tconst layoutInfo = options.get(EditorOption.layoutInfo);\n\n\t\tthis._verticalScrollbarWidth = layoutInfo.verticalScrollbarWidth;\n\t\tthis._minimapWidth = layoutInfo.minimap.minimapWidth;\n\t\tthis._horizontalScrollbarHeight = layoutInfo.horizontalScrollbarHeight;\n\t\tthis._editorHeight = layoutInfo.height;\n\t\tthis._editorWidth = layoutInfo.width;\n\t\treturn true;\n\t}\n\n\t// ---- end view event handlers\n\n\tpublic addWidget(widget: IOverlayWidget): void {\n\t\tconst domNode = createFastDomNode(widget.getDomNode());\n\n\t\tthis._widgets[widget.getId()] = {\n\t\t\twidget: widget,\n\t\t\tpreference: null,\n\t\t\tdomNode: domNode\n\t\t};\n\n\t\t// This is sync because a widget wants to be in the dom\n\t\tdomNode.setPosition('absolute');\n\t\tdomNode.setAttribute('widgetId', widget.getId());\n\n\t\tif (widget.allowEditorOverflow) {\n\t\t\tthis.overflowingOverlayWidgetsDomNode.appendChild(domNode);\n\t\t} else {\n\t\t\tthis._domNode.appendChild(domNode);\n\t\t}\n\n\t\tthis.setShouldRender();\n\t\tthis._updateMaxMinWidth();\n\t}\n\n\tpublic setWidgetPosition(widget: IOverlayWidget, position: IOverlayWidgetPosition | null): boolean {\n\t\tconst widgetData = this._widgets[widget.getId()];\n\t\tconst preference = position ? position.preference : null;\n\t\tconst stack = position?.stackOridinal;\n\t\tif (widgetData.preference === preference && widgetData.stack === stack) {\n\t\t\tthis._updateMaxMinWidth();\n\t\t\treturn false;\n\t\t}\n\n\t\twidgetData.preference = preference;\n\t\twidgetData.stack = stack;\n\t\tthis.setShouldRender();\n\t\tthis._updateMaxMinWidth();\n\n\t\treturn true;\n\t}\n\n\tpublic removeWidget(widget: IOverlayWidget): void {\n\t\tconst widgetId = widget.getId();\n\t\tif (this._widgets.hasOwnProperty(widgetId)) {\n\t\t\tconst widgetData = this._widgets[widgetId];\n\t\t\tconst domNode = widgetData.domNode.domNode;\n\t\t\tdelete this._widgets[widgetId];\n\n\t\t\tdomNode.remove();\n\t\t\tthis.setShouldRender();\n\t\t\tthis._updateMaxMinWidth();\n\t\t}\n\t}\n\n\tprivate _updateMaxMinWidth(): void {\n\t\tlet maxMinWidth = 0;\n\t\tconst keys = Object.keys(this._widgets);\n\t\tfor (let i = 0, len = keys.length; i < len; i++) {\n\t\t\tconst widgetId = keys[i];\n\t\t\tconst widget = this._widgets[widgetId];\n\t\t\tconst widgetMinWidthInPx = widget.widget.getMinContentWidthInPx?.();\n\t\t\tif (typeof widgetMinWidthInPx !== 'undefined') {\n\t\t\t\tmaxMinWidth = Math.max(maxMinWidth, widgetMinWidthInPx);\n\t\t\t}\n\t\t}\n\t\tthis._context.viewLayout.setOverlayWidgetsMinWidth(maxMinWidth);\n\t}\n\n\tprivate _renderWidget(widgetData: IWidgetData, stackCoordinates: number[]): void {\n\t\tconst domNode = widgetData.domNode;\n\n\t\tif (widgetData.preference === null) {\n\t\t\tdomNode.setTop('');\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxRight = (2 * this._verticalScrollbarWidth) + this._minimapWidth;\n\t\tif (widgetData.preference === OverlayWidgetPositionPreference.TOP_RIGHT_CORNER || widgetData.preference === OverlayWidgetPositionPreference.BOTTOM_RIGHT_CORNER) {\n\t\t\tif (widgetData.preference === OverlayWidgetPositionPreference.BOTTOM_RIGHT_CORNER) {\n\t\t\t\tconst widgetHeight = domNode.domNode.clientHeight;\n\t\t\t\tdomNode.setTop((this._editorHeight - widgetHeight - 2 * this._horizontalScrollbarHeight));\n\t\t\t} else {\n\t\t\t\tdomNode.setTop(0);\n\t\t\t}\n\n\t\t\tif (widgetData.stack !== undefined) {\n\t\t\t\tdomNode.setTop(stackCoordinates[widgetData.preference]);\n\t\t\t\tstackCoordinates[widgetData.preference] += domNode.domNode.clientWidth;\n\t\t\t} else {\n\t\t\t\tdomNode.setRight(maxRight);\n\t\t\t}\n\t\t} else if (widgetData.preference === OverlayWidgetPositionPreference.TOP_CENTER) {\n\t\t\tdomNode.domNode.style.right = '50%';\n\t\t\tif (widgetData.stack !== undefined) {\n\t\t\t\tdomNode.setTop(stackCoordinates[OverlayWidgetPositionPreference.TOP_CENTER]);\n\t\t\t\tstackCoordinates[OverlayWidgetPositionPreference.TOP_CENTER] += domNode.domNode.clientHeight;\n\t\t\t} else {\n\t\t\t\tdomNode.setTop(0);\n\t\t\t}\n\t\t} else {\n\t\t\tconst { top, left } = widgetData.preference;\n\t\t\tconst fixedOverflowWidgets = this._context.configuration.options.get(EditorOption.fixedOverflowWidgets);\n\t\t\tif (fixedOverflowWidgets && widgetData.widget.allowEditorOverflow) {\n\t\t\t\t// top, left are computed relative to the editor and we need them relative to the page\n\t\t\t\tconst editorBoundingBox = this._viewDomNodeRect;\n\t\t\t\tdomNode.setTop(top + editorBoundingBox.top);\n\t\t\t\tdomNode.setLeft(left + editorBoundingBox.left);\n\t\t\t\tdomNode.setPosition('fixed');\n\n\t\t\t} else {\n\t\t\t\tdomNode.setTop(top);\n\t\t\t\tdomNode.setLeft(left);\n\t\t\t\tdomNode.setPosition('absolute');\n\t\t\t}\n\t\t}\n\t}\n\n\tpublic prepareRender(ctx: RenderingContext): void {\n\t\tthis._viewDomNodeRect = dom.getDomNodePagePosition(this._viewDomNode.domNode);\n\t}\n\n\tpublic render(ctx: RestrictedRenderingContext): void {\n\t\tthis._domNode.setWidth(this._editorWidth);\n\n\t\tconst keys = Object.keys(this._widgets);\n\t\tconst stackCoordinates = Array.from({ length: OverlayWidgetPositionPreference.TOP_CENTER + 1 }, () => 0);\n\t\tkeys.sort((a, b) => (this._widgets[a].stack || 0) - (this._widgets[b].stack || 0));\n\n\t\tfor (let i = 0, len = keys.length; i < len; i++) {\n\t\t\tconst widgetId = keys[i];\n\t\t\tthis._renderWidget(this._widgets[widgetId], stackCoordinates);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
