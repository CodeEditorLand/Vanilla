var y=class A{_rgba8Brand=void 0;static Empty=new A(0,0,0,0);r;g;b;a;constructor(e,t,r,n){this.r=A._clamp(e),this.g=A._clamp(t),this.b=A._clamp(r),this.a=A._clamp(n)}equals(e){return this.r===e.r&&this.g===e.g&&this.b===e.b&&this.a===e.a}static _clamp(e){return e<0?0:e>255?255:e|0}};var w=(()=>{let A=[];for(let e=32;e<=126;e++)A.push(e);return A.push(65533),A})(),O=(A,e)=>(A-=32,A<0||A>96?e<=2?(A+96)%96:95:A);function g(A){return A<0?0:A>255?255:A|0}var S=class A{constructor(e,t){this.scale=t;this.charDataNormal=A.soften(e,12/15),this.charDataLight=A.soften(e,50/60)}_minimapCharRendererBrand=void 0;charDataNormal;charDataLight;static soften(e,t){let r=new Uint8ClampedArray(e.length);for(let n=0,a=e.length;n<a;n++)r[n]=g(e[n]*t);return r}renderChar(e,t,r,n,a,C,o,c,i,B,b){let m=1*this.scale,l=2*this.scale,E=b?1:l;if(t+m>e.width||r+E>e.height){console.warn("bad render request outside image data");return}let R=B?this.charDataLight:this.charDataNormal,d=O(n,i),H=e.width*4,h=o.r,s=o.g,F=o.b,T=a.r-h,_=a.g-s,f=a.b-F,u=Math.max(C,c),D=e.data,I=d*m*l,p=r*H+t*4;for(let N=0;N<E;N++){let M=p;for(let G=0;G<m;G++){let U=R[I++]/255*(C/255);D[M++]=h+T*U,D[M++]=s+_*U,D[M++]=F+f*U,D[M++]=u}p+=H}}blockRenderChar(e,t,r,n,a,C,o,c){let i=1*this.scale,B=2*this.scale,b=c?1:B;if(t+i>e.width||r+b>e.height){console.warn("bad render request outside image data");return}let m=e.width*4,l=.5*(a/255),E=C.r,R=C.g,d=C.b,H=n.r-E,h=n.g-R,s=n.b-d,F=E+H*l,T=R+h*l,_=d+s*l,f=Math.max(a,o),u=e.data,D=r*m+t*4;for(let I=0;I<b;I++){let p=D;for(let N=0;N<i;N++)u[p++]=F,u[p++]=T,u[p++]=_,u[p++]=f;D+=m}}};function x(A,e){let t=this,r=!1,n;return function(){if(r)return n;if(r=!0,e)try{n=A.apply(t,arguments)}finally{e()}else n=A.apply(t,arguments);return n}}var P={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15},W=A=>{let e=new Uint8ClampedArray(A.length/2);for(let t=0;t<A.length;t+=2)e[t>>1]=P[A[t]]<<4|P[A[t+1]]&15;return e},L={1:x(()=>W("0000511D6300CF609C709645A78432005642574171487021003C451900274D35D762755E8B629C5BA856AF57BA649530C167D1512A272A3F6038604460398526BCA2A968DB6F8957C768BE5FBE2FB467CF5D8D5B795DC7625B5DFF50DE64C466DB2FC47CD860A65E9A2EB96CB54CE06DA763AB2EA26860524D3763536601005116008177A8705E53AB738E6A982F88BAA35B5F5B626D9C636B449B737E5B7B678598869A662F6B5B8542706C704C80736A607578685B70594A49715A4522E792")),2:x(()=>W("000000000000000055394F383D2800008B8B1F210002000081B1CBCBCC820000847AAF6B9AAF2119BE08B8881AD60000A44FD07DCCF107015338130C00000000385972265F390B406E2437634B4B48031B12B8A0847000001E15B29A402F0000000000004B33460B00007A752C2A0000000000004D3900000084394B82013400ABA5CFC7AD9C0302A45A3E5A98AB000089A43382D97900008BA54AA087A70A0248A6A7AE6DBE0000BF6F94987EA40A01A06DCFA7A7A9030496C32F77891D0000A99FB1A0AFA80603B29AB9CA75930D010C0948354D3900000C0948354F37460D0028BE673D8400000000AF9D7B6E00002B007AA8933400007AA642675C2700007984CFB9C3985B768772A8A6B7B20000CAAECAAFC4B700009F94A6009F840009D09F9BA4CA9C0000CC8FC76DC87F0000C991C472A2000000A894A48CA7B501079BA2C9C69BA20000B19A5D3FA89000005CA6009DA2960901B0A7F0669FB200009D009E00B7890000DAD0F5D092820000D294D4C48BD10000B5A7A4A3B1A50402CAB6CBA6A2000000B5A7A4A3B1A8044FCDADD19D9CB00000B7778F7B8AAE0803C9AB5D3F5D3F00009EA09EA0BAB006039EA0989A8C7900009B9EF4D6B7C00000A9A7816CACA80000ABAC84705D3F000096DA635CDC8C00006F486F266F263D4784006124097B00374F6D2D6D2D6D4A3A95872322000000030000000000008D8939130000000000002E22A5C9CBC70600AB25C0B5C9B400061A2DB04CA67001082AA6BEBEBFC606002321DACBC19E03087AA08B6768380000282FBAC0B8CA7A88AD25BBA5A29900004C396C5894A6000040485A6E356E9442A32CD17EADA70000B4237923628600003E2DE9C1D7B500002F25BBA5A2990000231DB6AFB4A804023025C0B5CAB588062B2CBDBEC0C706882435A75CA20000002326BD6A82A908048B4B9A5A668000002423A09CB4BB060025259C9D8A7900001C1FCAB2C7C700002A2A9387ABA200002626A4A47D6E9D14333163A0C87500004B6F9C2D643A257049364936493647358A34438355497F1A0000A24C1D590000D38DFFBDD4CD3126"))};var v=class A{static lastCreated;static lastFontFamily;static create(e,t){if(this.lastCreated&&e===this.lastCreated.scale&&t===this.lastFontFamily)return this.lastCreated;let r;return L[e]?r=new S(L[e](),e):r=A.createFromSampleData(A.createSampleData(t).data,e),this.lastFontFamily=t,this.lastCreated=r,r}static createSampleData(e){let t=document.createElement("canvas"),r=t.getContext("2d");t.style.height="16px",t.height=16,t.width=96*10,t.style.width=96*10+"px",r.fillStyle="#ffffff",r.font=`bold 16px ${e}`,r.textBaseline="middle";let n=0;for(let a of w)r.fillText(String.fromCharCode(a),n,16/2),n+=10;return r.getImageData(0,0,96*10,16)}static createFromSampleData(e,t){let r=16*10*4*96;if(e.length!==r)throw new Error("Unexpected source in MinimapCharRenderer");let n=A._downsample(e,t);return new S(n,t)}static _downsampleChar(e,t,r,n,a){let C=1*a,o=2*a,c=n,i=0;for(let B=0;B<o;B++){let b=B/o*16,m=(B+1)/o*16;for(let l=0;l<C;l++){let E=l/C*10,R=(l+1)/C*10,d=0,H=0;for(let s=b;s<m;s++){let F=t+Math.floor(s)*3840,T=1-(s-Math.floor(s));for(let _=E;_<R;_++){let f=1-(_-Math.floor(_)),u=F+Math.floor(_)*4,D=f*T;H+=D,d+=e[u]*e[u+3]/255*D}}let h=d/H;i=Math.max(i,h),r[c++]=g(h)}}return i}static _downsample(e,t){let r=2*t*1*t,n=r*96,a=new Uint8ClampedArray(n),C=0,o=0,c=0;for(let i=0;i<96;i++)c=Math.max(c,this._downsampleChar(e,o,a,C,t)),C+=r,o+=10*4;if(c>0){let i=255/c;for(let B=0;B<n;B++)a[B]*=i}return a}};export{v as MinimapCharRendererFactory};
