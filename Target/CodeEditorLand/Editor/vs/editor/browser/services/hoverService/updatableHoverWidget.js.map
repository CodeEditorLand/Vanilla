{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/services/hoverService/updatableHoverWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isHTMLElement } from \"../../../../base/browser/dom.js\";\nimport type {\n\tIHoverWidget,\n\tIManagedHoverContent,\n\tIManagedHoverOptions,\n} from \"../../../../base/browser/ui/hover/hover.js\";\nimport type {\n\tIHoverDelegate,\n\tIHoverDelegateOptions,\n\tIHoverDelegateTarget,\n} from \"../../../../base/browser/ui/hover/hoverDelegate.js\";\nimport { HoverPosition } from \"../../../../base/browser/ui/hover/hoverWidget.js\";\nimport { CancellationTokenSource } from \"../../../../base/common/cancellation.js\";\nimport {\n\ttype IMarkdownString,\n\tisMarkdownString,\n} from \"../../../../base/common/htmlContent.js\";\nimport type { IDisposable } from \"../../../../base/common/lifecycle.js\";\nimport { isFunction, isString } from \"../../../../base/common/types.js\";\nimport { localize } from \"../../../../nls.js\";\n\ntype IManagedHoverResolvedContent =\n\t| IMarkdownString\n\t| string\n\t| HTMLElement\n\t| undefined;\n\nexport class ManagedHoverWidget implements IDisposable {\n\tprivate _hoverWidget: IHoverWidget | undefined;\n\tprivate _cancellationTokenSource: CancellationTokenSource | undefined;\n\n\tconstructor(\n\t\tprivate hoverDelegate: IHoverDelegate,\n\t\tprivate target: IHoverDelegateTarget | HTMLElement,\n\t\tprivate fadeInAnimation: boolean,\n\t) {}\n\n\tasync update(\n\t\tcontent: IManagedHoverContent,\n\t\tfocus?: boolean,\n\t\toptions?: IManagedHoverOptions,\n\t): Promise<void> {\n\t\tif (this._cancellationTokenSource) {\n\t\t\t// there's an computation ongoing, cancel it\n\t\t\tthis._cancellationTokenSource.dispose(true);\n\t\t\tthis._cancellationTokenSource = undefined;\n\t\t}\n\t\tif (this.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet resolvedContent;\n\t\tif (\n\t\t\tcontent === undefined ||\n\t\t\tisString(content) ||\n\t\t\tisHTMLElement(content)\n\t\t) {\n\t\t\tresolvedContent = content;\n\t\t} else if (isFunction(content.markdown)) {\n\t\t\t// compute the content, potentially long-running\n\n\t\t\t// show 'Loading' if no hover is up yet\n\t\t\tif (!this._hoverWidget) {\n\t\t\t\tthis.show(\n\t\t\t\t\tlocalize(\"iconLabel.loading\", \"Loading...\"),\n\t\t\t\t\tfocus,\n\t\t\t\t\toptions,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\t// compute the content\n\t\t\tthis._cancellationTokenSource = new CancellationTokenSource();\n\t\t\tconst token = this._cancellationTokenSource.token;\n\t\t\tresolvedContent = await content.markdown(token);\n\t\t\tif (resolvedContent === undefined) {\n\t\t\t\tresolvedContent = content.markdownNotSupportedFallback;\n\t\t\t}\n\n\t\t\tif (this.isDisposed || token.isCancellationRequested) {\n\t\t\t\t// either the widget has been closed in the meantime\n\t\t\t\t// or there has been a new call to `update`\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else {\n\t\t\tresolvedContent =\n\t\t\t\tcontent.markdown ?? content.markdownNotSupportedFallback;\n\t\t}\n\n\t\tthis.show(resolvedContent, focus, options);\n\t}\n\n\tprivate show(\n\t\tcontent: IManagedHoverResolvedContent,\n\t\tfocus?: boolean,\n\t\toptions?: IManagedHoverOptions,\n\t): void {\n\t\tconst oldHoverWidget = this._hoverWidget;\n\n\t\tif (this.hasContent(content)) {\n\t\t\tconst hoverOptions: IHoverDelegateOptions = {\n\t\t\t\tcontent,\n\t\t\t\ttarget: this.target,\n\t\t\t\tactions: options?.actions,\n\t\t\t\tlinkHandler: options?.linkHandler,\n\t\t\t\ttrapFocus: options?.trapFocus,\n\t\t\t\tappearance: {\n\t\t\t\t\tshowPointer: this.hoverDelegate.placement === \"element\",\n\t\t\t\t\tskipFadeInAnimation:\n\t\t\t\t\t\t!this.fadeInAnimation || !!oldHoverWidget, // do not fade in if the hover is already showing\n\t\t\t\t\tshowHoverHint: options?.appearance?.showHoverHint,\n\t\t\t\t},\n\t\t\t\tposition: {\n\t\t\t\t\thoverPosition: HoverPosition.BELOW,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tthis._hoverWidget = this.hoverDelegate.showHover(\n\t\t\t\thoverOptions,\n\t\t\t\tfocus,\n\t\t\t);\n\t\t}\n\t\toldHoverWidget?.dispose();\n\t}\n\n\tprivate hasContent(\n\t\tcontent: IManagedHoverResolvedContent,\n\t): content is NonNullable<IManagedHoverResolvedContent> {\n\t\tif (!content) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isMarkdownString(content)) {\n\t\t\treturn !!content.value;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget isDisposed() {\n\t\treturn this._hoverWidget?.isDisposed;\n\t}\n\n\tdispose(): void {\n\t\tthis._hoverWidget?.dispose();\n\t\tthis._cancellationTokenSource?.dispose(true);\n\t\tthis._cancellationTokenSource = undefined;\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,qBAAqB;AAW9B,SAAS,qBAAqB;AAC9B,SAAS,+BAA+B;AACxC;AAAA,EAEC;AAAA,OACM;AAEP,SAAS,YAAY,gBAAgB;AACrC,SAAS,gBAAgB;AAQlB,MAAM,mBAA0C;AAAA,EAItD,YACS,eACA,QACA,iBACP;AAHO;AACA;AACA;AAAA,EACN;AAAA,EAxCJ,OAgCuD;AAAA;AAAA;AAAA,EAC9C;AAAA,EACA;AAAA,EAQR,MAAM,OACL,SACA,OACA,SACgB;AAChB,QAAI,KAAK,0BAA0B;AAElC,WAAK,yBAAyB,QAAQ,IAAI;AAC1C,WAAK,2BAA2B;AAAA,IACjC;AACA,QAAI,KAAK,YAAY;AACpB;AAAA,IACD;AAEA,QAAI;AACJ,QACC,YAAY,UACZ,SAAS,OAAO,KAChB,cAAc,OAAO,GACpB;AACD,wBAAkB;AAAA,IACnB,WAAW,WAAW,QAAQ,QAAQ,GAAG;AAIxC,UAAI,CAAC,KAAK,cAAc;AACvB,aAAK;AAAA,UACJ,SAAS,qBAAqB,YAAY;AAAA,UAC1C;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAGA,WAAK,2BAA2B,IAAI,wBAAwB;AAC5D,YAAM,QAAQ,KAAK,yBAAyB;AAC5C,wBAAkB,MAAM,QAAQ,SAAS,KAAK;AAC9C,UAAI,oBAAoB,QAAW;AAClC,0BAAkB,QAAQ;AAAA,MAC3B;AAEA,UAAI,KAAK,cAAc,MAAM,yBAAyB;AAGrD;AAAA,MACD;AAAA,IACD,OAAO;AACN,wBACC,QAAQ,YAAY,QAAQ;AAAA,IAC9B;AAEA,SAAK,KAAK,iBAAiB,OAAO,OAAO;AAAA,EAC1C;AAAA,EAEQ,KACP,SACA,OACA,SACO;AACP,UAAM,iBAAiB,KAAK;AAE5B,QAAI,KAAK,WAAW,OAAO,GAAG;AAC7B,YAAM,eAAsC;AAAA,QAC3C;AAAA,QACA,QAAQ,KAAK;AAAA,QACb,SAAS,SAAS;AAAA,QAClB,aAAa,SAAS;AAAA,QACtB,WAAW,SAAS;AAAA,QACpB,YAAY;AAAA,UACX,aAAa,KAAK,cAAc,cAAc;AAAA,UAC9C,qBACC,CAAC,KAAK,mBAAmB,CAAC,CAAC;AAAA;AAAA,UAC5B,eAAe,SAAS,YAAY;AAAA,QACrC;AAAA,QACA,UAAU;AAAA,UACT,eAAe,cAAc;AAAA,QAC9B;AAAA,MACD;AAEA,WAAK,eAAe,KAAK,cAAc;AAAA,QACtC;AAAA,QACA;AAAA,MACD;AAAA,IACD;AACA,oBAAgB,QAAQ;AAAA,EACzB;AAAA,EAEQ,WACP,SACuD;AACvD,QAAI,CAAC,SAAS;AACb,aAAO;AAAA,IACR;AAEA,QAAI,iBAAiB,OAAO,GAAG;AAC9B,aAAO,CAAC,CAAC,QAAQ;AAAA,IAClB;AAEA,WAAO;AAAA,EACR;AAAA,EAEA,IAAI,aAAa;AAChB,WAAO,KAAK,cAAc;AAAA,EAC3B;AAAA,EAEA,UAAgB;AACf,SAAK,cAAc,QAAQ;AAC3B,SAAK,0BAA0B,QAAQ,IAAI;AAC3C,SAAK,2BAA2B;AAAA,EACjC;AACD;",
  "names": []
}
