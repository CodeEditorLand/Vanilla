{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/services/hoverService/updatableHoverWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isHTMLElement } from '../../../../base/browser/dom.js';\nimport type { IHoverWidget, IManagedHoverContent, IManagedHoverOptions } from '../../../../base/browser/ui/hover/hover.js';\nimport type { IHoverDelegate, IHoverDelegateOptions, IHoverDelegateTarget } from '../../../../base/browser/ui/hover/hoverDelegate.js';\nimport { HoverPosition } from '../../../../base/browser/ui/hover/hoverWidget.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { isMarkdownString, type IMarkdownString } from '../../../../base/common/htmlContent.js';\nimport { IDisposable } from '../../../../base/common/lifecycle.js';\nimport { isFunction, isString } from '../../../../base/common/types.js';\nimport { localize } from '../../../../nls.js';\n\ntype IManagedHoverResolvedContent = IMarkdownString | string | HTMLElement | undefined;\n\nexport class ManagedHoverWidget implements IDisposable {\n\n\tprivate _hoverWidget: IHoverWidget | undefined;\n\tprivate _cancellationTokenSource: CancellationTokenSource | undefined;\n\n\tconstructor(private hoverDelegate: IHoverDelegate, private target: IHoverDelegateTarget | HTMLElement, private fadeInAnimation: boolean) {\n\t}\n\n\tasync update(content: IManagedHoverContent, focus?: boolean, options?: IManagedHoverOptions): Promise<void> {\n\t\tif (this._cancellationTokenSource) {\n\t\t\t// there's an computation ongoing, cancel it\n\t\t\tthis._cancellationTokenSource.dispose(true);\n\t\t\tthis._cancellationTokenSource = undefined;\n\t\t}\n\t\tif (this.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet resolvedContent;\n\t\tif (content === undefined || isString(content) || isHTMLElement(content)) {\n\t\t\tresolvedContent = content;\n\t\t} else if (!isFunction(content.markdown)) {\n\t\t\tresolvedContent = content.markdown ?? content.markdownNotSupportedFallback;\n\t\t} else {\n\t\t\t// compute the content, potentially long-running\n\n\t\t\t// show 'Loading' if no hover is up yet\n\t\t\tif (!this._hoverWidget) {\n\t\t\t\tthis.show(localize('iconLabel.loading', \"Loading...\"), focus, options);\n\t\t\t}\n\n\t\t\t// compute the content\n\t\t\tthis._cancellationTokenSource = new CancellationTokenSource();\n\t\t\tconst token = this._cancellationTokenSource.token;\n\t\t\tresolvedContent = await content.markdown(token);\n\t\t\tif (resolvedContent === undefined) {\n\t\t\t\tresolvedContent = content.markdownNotSupportedFallback;\n\t\t\t}\n\n\t\t\tif (this.isDisposed || token.isCancellationRequested) {\n\t\t\t\t// either the widget has been closed in the meantime\n\t\t\t\t// or there has been a new call to `update`\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tthis.show(resolvedContent, focus, options);\n\t}\n\n\tprivate show(content: IManagedHoverResolvedContent, focus?: boolean, options?: IManagedHoverOptions): void {\n\t\tconst oldHoverWidget = this._hoverWidget;\n\n\t\tif (this.hasContent(content)) {\n\t\t\tconst hoverOptions: IHoverDelegateOptions = {\n\t\t\t\tcontent,\n\t\t\t\ttarget: this.target,\n\t\t\t\tactions: options?.actions,\n\t\t\t\tlinkHandler: options?.linkHandler,\n\t\t\t\ttrapFocus: options?.trapFocus,\n\t\t\t\tappearance: {\n\t\t\t\t\tshowPointer: this.hoverDelegate.placement === 'element',\n\t\t\t\t\tskipFadeInAnimation: !this.fadeInAnimation || !!oldHoverWidget, // do not fade in if the hover is already showing\n\t\t\t\t\tshowHoverHint: options?.appearance?.showHoverHint,\n\t\t\t\t},\n\t\t\t\tposition: {\n\t\t\t\t\thoverPosition: HoverPosition.BELOW,\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tthis._hoverWidget = this.hoverDelegate.showHover(hoverOptions, focus);\n\t\t}\n\t\toldHoverWidget?.dispose();\n\t}\n\n\tprivate hasContent(content: IManagedHoverResolvedContent): content is NonNullable<IManagedHoverResolvedContent> {\n\t\tif (!content) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (isMarkdownString(content)) {\n\t\t\treturn !!content.value;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget isDisposed() {\n\t\treturn this._hoverWidget?.isDisposed;\n\t}\n\n\tdispose(): void {\n\t\tthis._hoverWidget?.dispose();\n\t\tthis._cancellationTokenSource?.dispose(true);\n\t\tthis._cancellationTokenSource = undefined;\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,qBAAqB;AAG9B,SAAS,qBAAqB;AAC9B,SAAS,+BAA+B;AACxC,SAAS,wBAA8C;AACvD,SAAS,mBAAmB;AAC5B,SAAS,YAAY,gBAAgB;AACrC,SAAS,gBAAgB;AAIlB,MAAM,mBAA0C;AAAA,EAKtD,YAAoB,eAAuC,QAAoD,iBAA0B;AAArH;AAAuC;AAAoD;AAAA,EAC/G;AAAA,EAvBD,OAiBuD;AAAA;AAAA;AAAA,EAE9C;AAAA,EACA;AAAA,EAKR,MAAM,OAAO,SAA+B,OAAiB,SAA+C;AAC3G,QAAI,KAAK,0BAA0B;AAElC,WAAK,yBAAyB,QAAQ,IAAI;AAC1C,WAAK,2BAA2B;AAAA,IACjC;AACA,QAAI,KAAK,YAAY;AACpB;AAAA,IACD;AAEA,QAAI;AACJ,QAAI,YAAY,UAAa,SAAS,OAAO,KAAK,cAAc,OAAO,GAAG;AACzE,wBAAkB;AAAA,IACnB,WAAW,CAAC,WAAW,QAAQ,QAAQ,GAAG;AACzC,wBAAkB,QAAQ,YAAY,QAAQ;AAAA,IAC/C,OAAO;AAIN,UAAI,CAAC,KAAK,cAAc;AACvB,aAAK,KAAK,SAAS,qBAAqB,YAAY,GAAG,OAAO,OAAO;AAAA,MACtE;AAGA,WAAK,2BAA2B,IAAI,wBAAwB;AAC5D,YAAM,QAAQ,KAAK,yBAAyB;AAC5C,wBAAkB,MAAM,QAAQ,SAAS,KAAK;AAC9C,UAAI,oBAAoB,QAAW;AAClC,0BAAkB,QAAQ;AAAA,MAC3B;AAEA,UAAI,KAAK,cAAc,MAAM,yBAAyB;AAGrD;AAAA,MACD;AAAA,IACD;AAEA,SAAK,KAAK,iBAAiB,OAAO,OAAO;AAAA,EAC1C;AAAA,EAEQ,KAAK,SAAuC,OAAiB,SAAsC;AAC1G,UAAM,iBAAiB,KAAK;AAE5B,QAAI,KAAK,WAAW,OAAO,GAAG;AAC7B,YAAM,eAAsC;AAAA,QAC3C;AAAA,QACA,QAAQ,KAAK;AAAA,QACb,SAAS,SAAS;AAAA,QAClB,aAAa,SAAS;AAAA,QACtB,WAAW,SAAS;AAAA,QACpB,YAAY;AAAA,UACX,aAAa,KAAK,cAAc,cAAc;AAAA,UAC9C,qBAAqB,CAAC,KAAK,mBAAmB,CAAC,CAAC;AAAA;AAAA,UAChD,eAAe,SAAS,YAAY;AAAA,QACrC;AAAA,QACA,UAAU;AAAA,UACT,eAAe,cAAc;AAAA,QAC9B;AAAA,MACD;AAEA,WAAK,eAAe,KAAK,cAAc,UAAU,cAAc,KAAK;AAAA,IACrE;AACA,oBAAgB,QAAQ;AAAA,EACzB;AAAA,EAEQ,WAAW,SAA6F;AAC/G,QAAI,CAAC,SAAS;AACb,aAAO;AAAA,IACR;AAEA,QAAI,iBAAiB,OAAO,GAAG;AAC9B,aAAO,CAAC,CAAC,QAAQ;AAAA,IAClB;AAEA,WAAO;AAAA,EACR;AAAA,EAEA,IAAI,aAAa;AAChB,WAAO,KAAK,cAAc;AAAA,EAC3B;AAAA,EAEA,UAAgB;AACf,SAAK,cAAc,QAAQ;AAC3B,SAAK,0BAA0B,QAAQ,IAAI;AAC3C,SAAK,2BAA2B;AAAA,EACjC;AACD;",
  "names": []
}
