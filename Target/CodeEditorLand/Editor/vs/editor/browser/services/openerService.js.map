{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/editor/browser/services/openerService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../base/browser/dom.js';\nimport { mainWindow } from '../../../base/browser/window.js';\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { IDisposable } from '../../../base/common/lifecycle.js';\nimport { LinkedList } from '../../../base/common/linkedList.js';\nimport { ResourceMap } from '../../../base/common/map.js';\nimport { parse } from '../../../base/common/marshalling.js';\nimport { matchesScheme, matchesSomeScheme, Schemas } from '../../../base/common/network.js';\nimport { normalizePath } from '../../../base/common/resources.js';\nimport { URI } from '../../../base/common/uri.js';\nimport { ICodeEditorService } from './codeEditorService.js';\nimport { ICommandService } from '../../../platform/commands/common/commands.js';\nimport { EditorOpenSource } from '../../../platform/editor/common/editor.js';\nimport { extractSelection, IExternalOpener, IExternalUriResolver, IOpener, IOpenerService, IResolvedExternalUri, IValidator, OpenOptions, ResolveExternalUriOptions } from '../../../platform/opener/common/opener.js';\n\nclass CommandOpener implements IOpener {\n\n\tconstructor(@ICommandService private readonly _commandService: ICommandService) { }\n\n\tasync open(target: URI | string, options?: OpenOptions): Promise<boolean> {\n\t\tif (!matchesScheme(target, Schemas.command)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (!options?.allowCommands) {\n\t\t\t// silently ignore commands when command-links are disabled, also\n\t\t\t// suppress other openers by returning TRUE\n\t\t\treturn true;\n\t\t}\n\n\t\tif (typeof target === 'string') {\n\t\t\ttarget = URI.parse(target);\n\t\t}\n\n\t\tif (Array.isArray(options.allowCommands)) {\n\t\t\t// Only allow specific commands\n\t\t\tif (!options.allowCommands.includes(target.path)) {\n\t\t\t\t// Suppress other openers by returning TRUE\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\t// execute as command\n\t\tlet args: any = [];\n\t\ttry {\n\t\t\targs = parse(decodeURIComponent(target.query));\n\t\t} catch {\n\t\t\t// ignore and retry\n\t\t\ttry {\n\t\t\t\targs = parse(target.query);\n\t\t\t} catch {\n\t\t\t\t// ignore error\n\t\t\t}\n\t\t}\n\t\tif (!Array.isArray(args)) {\n\t\t\targs = [args];\n\t\t}\n\t\tawait this._commandService.executeCommand(target.path, ...args);\n\t\treturn true;\n\t}\n}\n\nclass EditorOpener implements IOpener {\n\n\tconstructor(@ICodeEditorService private readonly _editorService: ICodeEditorService) { }\n\n\tasync open(target: URI | string, options: OpenOptions) {\n\t\tif (typeof target === 'string') {\n\t\t\ttarget = URI.parse(target);\n\t\t}\n\t\tconst { selection, uri } = extractSelection(target);\n\t\ttarget = uri;\n\n\t\tif (target.scheme === Schemas.file) {\n\t\t\ttarget = normalizePath(target); // workaround for non-normalized paths (https://github.com/microsoft/vscode/issues/12954)\n\t\t}\n\n\t\tawait this._editorService.openCodeEditor(\n\t\t\t{\n\t\t\t\tresource: target,\n\t\t\t\toptions: {\n\t\t\t\t\tselection,\n\t\t\t\t\tsource: options?.fromUserGesture ? EditorOpenSource.USER : EditorOpenSource.API,\n\t\t\t\t\t...options?.editorOptions\n\t\t\t\t}\n\t\t\t},\n\t\t\tthis._editorService.getFocusedCodeEditor(),\n\t\t\toptions?.openToSide\n\t\t);\n\n\t\treturn true;\n\t}\n}\n\nexport class OpenerService implements IOpenerService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _openers = new LinkedList<IOpener>();\n\tprivate readonly _validators = new LinkedList<IValidator>();\n\tprivate readonly _resolvers = new LinkedList<IExternalUriResolver>();\n\tprivate readonly _resolvedUriTargets = new ResourceMap<URI>(uri => uri.with({ path: null, fragment: null, query: null }).toString());\n\n\tprivate _defaultExternalOpener: IExternalOpener;\n\tprivate readonly _externalOpeners = new LinkedList<IExternalOpener>();\n\n\tconstructor(\n\t\t@ICodeEditorService editorService: ICodeEditorService,\n\t\t@ICommandService commandService: ICommandService\n\t) {\n\t\t// Default external opener is going through window.open()\n\t\tthis._defaultExternalOpener = {\n\t\t\topenExternal: async href => {\n\t\t\t\t// ensure to open HTTP/HTTPS links into new windows\n\t\t\t\t// to not trigger a navigation. Any other link is\n\t\t\t\t// safe to be set as HREF to prevent a blank window\n\t\t\t\t// from opening.\n\t\t\t\tif (matchesSomeScheme(href, Schemas.http, Schemas.https)) {\n\t\t\t\t\tdom.windowOpenNoOpener(href);\n\t\t\t\t} else {\n\t\t\t\t\tmainWindow.location.href = href;\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\t\t};\n\n\t\t// Default opener: any external, maito, http(s), command, and catch-all-editors\n\t\tthis._openers.push({\n\t\t\topen: async (target: URI | string, options?: OpenOptions) => {\n\t\t\t\tif (options?.openExternal || matchesSomeScheme(target, Schemas.mailto, Schemas.http, Schemas.https, Schemas.vsls)) {\n\t\t\t\t\t// open externally\n\t\t\t\t\tawait this._doOpenExternal(target, options);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\treturn false;\n\t\t\t}\n\t\t});\n\t\tthis._openers.push(new CommandOpener(commandService));\n\t\tthis._openers.push(new EditorOpener(editorService));\n\t}\n\n\tregisterOpener(opener: IOpener): IDisposable {\n\t\tconst remove = this._openers.unshift(opener);\n\t\treturn { dispose: remove };\n\t}\n\n\tregisterValidator(validator: IValidator): IDisposable {\n\t\tconst remove = this._validators.push(validator);\n\t\treturn { dispose: remove };\n\t}\n\n\tregisterExternalUriResolver(resolver: IExternalUriResolver): IDisposable {\n\t\tconst remove = this._resolvers.push(resolver);\n\t\treturn { dispose: remove };\n\t}\n\n\tsetDefaultExternalOpener(externalOpener: IExternalOpener): void {\n\t\tthis._defaultExternalOpener = externalOpener;\n\t}\n\n\tregisterExternalOpener(opener: IExternalOpener): IDisposable {\n\t\tconst remove = this._externalOpeners.push(opener);\n\t\treturn { dispose: remove };\n\t}\n\n\tasync open(target: URI | string, options?: OpenOptions): Promise<boolean> {\n\t\t// check with contributed validators\n\t\tconst targetURI = typeof target === 'string' ? URI.parse(target) : target;\n\t\t// validate against the original URI that this URI resolves to, if one exists\n\t\tconst validationTarget = this._resolvedUriTargets.get(targetURI) ?? target;\n\t\tfor (const validator of this._validators) {\n\t\t\tif (!(await validator.shouldOpen(validationTarget, options))) {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t}\n\n\t\t// check with contributed openers\n\t\tfor (const opener of this._openers) {\n\t\t\tconst handled = await opener.open(target, options);\n\t\t\tif (handled) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tasync resolveExternalUri(resource: URI, options?: ResolveExternalUriOptions): Promise<IResolvedExternalUri> {\n\t\tfor (const resolver of this._resolvers) {\n\t\t\ttry {\n\t\t\t\tconst result = await resolver.resolveExternalUri(resource, options);\n\t\t\t\tif (result) {\n\t\t\t\t\tif (!this._resolvedUriTargets.has(result.resolved)) {\n\t\t\t\t\t\tthis._resolvedUriTargets.set(result.resolved, resource);\n\t\t\t\t\t}\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t} catch {\n\t\t\t\t// noop\n\t\t\t}\n\t\t}\n\n\t\tthrow new Error('Could not resolve external URI: ' + resource.toString());\n\t}\n\n\tprivate async _doOpenExternal(resource: URI | string, options: OpenOptions | undefined): Promise<boolean> {\n\n\t\t//todo@jrieken IExternalUriResolver should support `uri: URI | string`\n\t\tconst uri = typeof resource === 'string' ? URI.parse(resource) : resource;\n\t\tlet externalUri: URI;\n\n\t\ttry {\n\t\t\texternalUri = (await this.resolveExternalUri(uri, options)).resolved;\n\t\t} catch {\n\t\t\texternalUri = uri;\n\t\t}\n\n\t\tlet href: string;\n\t\tif (typeof resource === 'string' && uri.toString() === externalUri.toString()) {\n\t\t\t// open the url-string AS IS\n\t\t\thref = resource;\n\t\t} else {\n\t\t\t// open URI using the toString(noEncode)+encodeURI-trick\n\t\t\thref = encodeURI(externalUri.toString(true));\n\t\t}\n\n\t\tif (options?.allowContributedOpeners) {\n\t\t\tconst preferredOpenerId = typeof options?.allowContributedOpeners === 'string' ? options?.allowContributedOpeners : undefined;\n\t\t\tfor (const opener of this._externalOpeners) {\n\t\t\t\tconst didOpen = await opener.openExternal(href, {\n\t\t\t\t\tsourceUri: uri,\n\t\t\t\t\tpreferredOpenerId,\n\t\t\t\t}, CancellationToken.None);\n\t\t\t\tif (didOpen) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this._defaultExternalOpener.openExternal(href, { sourceUri: uri }, CancellationToken.None);\n\t}\n\n\tdispose() {\n\t\tthis._validators.clear();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
