var P=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var y=(s,e,t,o)=>{for(var n=o>1?void 0:o?j(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(n=(o?a(e,t,n):a(n))||n);return o&&n&&P(e,t,n),n},i=(s,e)=>(t,o)=>e(t,o,s);import*as U from"../../../base/browser/ui/aria/aria.js";import{setBaseLayerHoverDelegate as W}from"../../../base/browser/ui/hover/hoverDelegate2.js";import{setHoverDelegateFactory as q}from"../../../base/browser/ui/hover/hoverDelegateFactory.js";import{mainWindow as X}from"../../../base/browser/window.js";import{Disposable as Y,DisposableStore as J,toDisposable as Q}from"../../../base/common/lifecycle.js";import{IAccessibilityService as L}from"../../../platform/accessibility/common/accessibility.js";import{IAccessibilitySignalService as Z}from"../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{MenuId as $,MenuRegistry as ee}from"../../../platform/actions/common/actions.js";import{IClipboardService as te}from"../../../platform/clipboard/common/clipboardService.js";import{CommandsRegistry as ie,ICommandService as O}from"../../../platform/commands/common/commands.js";import{IConfigurationService as k}from"../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as v,IContextKeyService as M}from"../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as oe}from"../../../platform/contextview/browser/contextView.js";import{IHoverService as w,WorkbenchHoverDelegate as ne}from"../../../platform/hover/browser/hover.js";import{IInstantiationService as K}from"../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as R}from"../../../platform/keybinding/common/keybinding.js";import{INotificationService as _}from"../../../platform/notification/common/notification.js";import{IEditorProgressService as re}from"../../../platform/progress/common/progress.js";import{IThemeService as ae}from"../../../platform/theme/common/themeService.js";import{ICodeEditorService as A}from"../../browser/services/codeEditorService.js";import{CodeEditorWidget as de}from"../../browser/widget/codeEditor/codeEditorWidget.js";import{DiffEditorWidget as se}from"../../browser/widget/diffEditor/diffEditorWidget.js";import{InternalEditorAction as ce}from"../../common/editorAction.js";import{ILanguageService as le}from"../../common/languages/language.js";import{ILanguageConfigurationService as N}from"../../common/languages/languageConfigurationRegistry.js";import{PLAINTEXT_LANGUAGE_ID as me}from"../../common/languages/modesRegistry.js";import{ILanguageFeaturesService as B}from"../../common/services/languageFeatures.js";import{IModelService as ue}from"../../common/services/model.js";import{StandaloneCodeEditorNLS as ge}from"../../common/standaloneStrings.js";import{IStandaloneThemeService as V}from"../common/standaloneTheme.js";import{StandaloneCodeEditorService as pe}from"./standaloneCodeEditorService.js";import{StandaloneKeybindingService as fe,updateConfigurationService as h}from"./standaloneServices.js";let Ie=0,G=!1;function ve(s){if(!s){if(G)return;G=!0}U.setARIAContainer(s||X.document.body)}let S=class extends de{_standaloneKeybindingService;constructor(e,t,o,n,r,a,f,p,c,l,g,I,d){const m={...t};m.ariaLabel=m.ariaLabel||ge.editorViewAccessibleLabel,super(e,m,{},o,n,r,a,c,l,g,I,d),p instanceof fe?this._standaloneKeybindingService=p:this._standaloneKeybindingService=null,ve(m.ariaContainerElement),q((E,D)=>o.createInstance(ne,E,D,{})),W(f)}addCommand(e,t,o){if(!this._standaloneKeybindingService)return null;const n="DYNAMIC_"+ ++Ie,r=v.deserialize(o);return this._standaloneKeybindingService.addDynamicKeybinding(n,e,t,r),n}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return Y.None;const t=e.id,o=e.label,n=v.and(v.equals("editorId",this.getId()),v.deserialize(e.precondition)),r=e.keybindings,a=v.and(n,v.deserialize(e.keybindingContext)),f=e.contextMenuGroupId||null,p=e.contextMenuOrder||0,c=(d,...m)=>Promise.resolve(e.run(this,...m)),l=new J,g=this.getId()+":"+t;if(l.add(ie.registerCommand(g,c)),f){const d={command:{id:g,title:o},when:n,group:f,order:p};l.add(ee.appendMenuItem($.EditorContext,d))}if(Array.isArray(r))for(const d of r)l.add(this._standaloneKeybindingService.addDynamicKeybinding(g,d,c,a));const I=new ce(g,o,o,void 0,n,(...d)=>Promise.resolve(e.run(this,...d)),this._contextKeyService);return this._actions.set(t,I),l.add(Q(()=>{this._actions.delete(t)})),l}_triggerCommand(e,t){if(this._codeEditorService instanceof pe)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};S=y([i(2,K),i(3,A),i(4,O),i(5,M),i(6,w),i(7,R),i(8,ae),i(9,_),i(10,L),i(11,N),i(12,B)],S);let b=class extends S{_configurationService;_standaloneThemeService;_ownsModel;constructor(e,t,o,n,r,a,f,p,c,l,g,I,d,m,E,D){const u={...t};h(g,u,!1);const F=c.registerEditorContainer(e);typeof u.theme=="string"&&c.setTheme(u.theme),typeof u.autoDetectHighContrast<"u"&&c.setAutoDetectHighContrast(!!u.autoDetectHighContrast);const H=u.model;delete u.model,super(e,u,o,n,r,a,f,p,c,l,I,E,D),this._configurationService=g,this._standaloneThemeService=c,this._register(F);let C;if(typeof H>"u"){const T=m.getLanguageIdByMimeType(u.language)||u.language||me;C=Se(d,m,u.value||"",T,void 0),this._ownsModel=!0}else C=H,this._ownsModel=!1;if(this._attachModel(C),C){const T={oldModelUrl:null,newModelUrl:C.uri};this._onDidChangeModel.fire(T)}}dispose(){super.dispose()}updateOptions(e){h(this._configurationService,e,!1),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};b=y([i(2,K),i(3,A),i(4,O),i(5,M),i(6,w),i(7,R),i(8,V),i(9,_),i(10,k),i(11,L),i(12,ue),i(13,le),i(14,N),i(15,B)],b);let x=class extends se{_configurationService;_standaloneThemeService;constructor(e,t,o,n,r,a,f,p,c,l,g,I){const d={...t};h(p,d,!0);const m=a.registerEditorContainer(e);typeof d.theme=="string"&&a.setTheme(d.theme),typeof d.autoDetectHighContrast<"u"&&a.setAutoDetectHighContrast(!!d.autoDetectHighContrast),super(e,d,{},n,o,r,I,l),this._configurationService=p,this._standaloneThemeService=a,this._register(m)}dispose(){super.dispose()}updateOptions(e){h(this._configurationService,e,!0),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_createInnerEditor(e,t,o){return e.createInstance(S,t,o)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,o){return this.getModifiedEditor().addCommand(e,t,o)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};x=y([i(2,K),i(3,M),i(4,A),i(5,V),i(6,_),i(7,k),i(8,oe),i(9,re),i(10,te),i(11,Z)],x);function Se(s,e,t,o,n){if(t=t||"",!o){const r=t.indexOf(`
`);let a=t;return r!==-1&&(a=t.substring(0,r)),z(s,t,e.createByFilepathOrFirstLine(n||null,a),n)}return z(s,t,e.createById(o),n)}function z(s,e,t,o){return s.createModel(e,t,o)}export{S as StandaloneCodeEditor,x as StandaloneDiffEditor2,b as StandaloneEditor,Se as createTextModel};
