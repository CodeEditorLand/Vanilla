var P=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var h=(s,e,t,o)=>{for(var n=o>1?void 0:o?U(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(n=(o?a(e,t,n):a(n))||n);return o&&n&&P(e,t,n),n},i=(s,e)=>(t,o)=>e(t,o,s);import*as W from"../../../base/browser/ui/aria/aria.js";import{Disposable as q,toDisposable as X,DisposableStore as Y}from"../../../base/common/lifecycle.js";import{ICodeEditorService as T}from"../../browser/services/codeEditorService.js";import{CodeEditorWidget as j}from"../../browser/widget/codeEditor/codeEditorWidget.js";import{InternalEditorAction as J}from"../../common/editorAction.js";import{StandaloneKeybindingService as Q,updateConfigurationService as y}from"./standaloneServices.js";import{IStandaloneThemeService as L}from"../common/standaloneTheme.js";import{MenuId as Z,MenuRegistry as $}from"../../../platform/actions/common/actions.js";import{CommandsRegistry as ee,ICommandService as O}from"../../../platform/commands/common/commands.js";import{IConfigurationService as k}from"../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as v,IContextKeyService as K}from"../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as te}from"../../../platform/contextview/browser/contextView.js";import{IInstantiationService as _}from"../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as R}from"../../../platform/keybinding/common/keybinding.js";import{INotificationService as A}from"../../../platform/notification/common/notification.js";import{IThemeService as ie}from"../../../platform/theme/common/themeService.js";import{IAccessibilityService as N}from"../../../platform/accessibility/common/accessibility.js";import{StandaloneCodeEditorNLS as oe}from"../../common/standaloneStrings.js";import{IClipboardService as ne}from"../../../platform/clipboard/common/clipboardService.js";import{IEditorProgressService as re}from"../../../platform/progress/common/progress.js";import{IModelService as ae}from"../../common/services/model.js";import{ILanguageService as de}from"../../common/languages/language.js";import{StandaloneCodeEditorService as se}from"./standaloneCodeEditorService.js";import{PLAINTEXT_LANGUAGE_ID as ce}from"../../common/languages/modesRegistry.js";import{ILanguageConfigurationService as w}from"../../common/languages/languageConfigurationRegistry.js";import{ILanguageFeaturesService as V}from"../../common/services/languageFeatures.js";import{DiffEditorWidget as le}from"../../browser/widget/diffEditor/diffEditorWidget.js";import{IAccessibilitySignalService as ue}from"../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{mainWindow as me}from"../../../base/browser/window.js";import{setHoverDelegateFactory as ge}from"../../../base/browser/ui/hover/hoverDelegateFactory.js";import{IHoverService as B,WorkbenchHoverDelegate as Ie}from"../../../platform/hover/browser/hover.js";import{setBaseLayerHoverDelegate as fe}from"../../../base/browser/ui/hover/hoverDelegate2.js";let pe=0,G=!1;function ve(s){if(!s){if(G)return;G=!0}W.setARIAContainer(s||me.document.body)}let S=class extends j{_standaloneKeybindingService;constructor(e,t,o,n,r,a,f,I,c,l,g,p,d){const u={...t};u.ariaLabel=u.ariaLabel||oe.editorViewAccessibleLabel,super(e,u,{},o,n,r,a,c,l,g,p,d),I instanceof Q?this._standaloneKeybindingService=I:this._standaloneKeybindingService=null,ve(u.ariaContainerElement),ge((E,D)=>o.createInstance(Ie,E,D,{})),fe(f)}addCommand(e,t,o){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const n="DYNAMIC_"+ ++pe,r=v.deserialize(o);return this._standaloneKeybindingService.addDynamicKeybinding(n,e,t,r),n}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),q.None;const t=e.id,o=e.label,n=v.and(v.equals("editorId",this.getId()),v.deserialize(e.precondition)),r=e.keybindings,a=v.and(n,v.deserialize(e.keybindingContext)),f=e.contextMenuGroupId||null,I=e.contextMenuOrder||0,c=(d,...u)=>Promise.resolve(e.run(this,...u)),l=new Y,g=this.getId()+":"+t;if(l.add(ee.registerCommand(g,c)),f){const d={command:{id:g,title:o},when:n,group:f,order:I};l.add($.appendMenuItem(Z.EditorContext,d))}if(Array.isArray(r))for(const d of r)l.add(this._standaloneKeybindingService.addDynamicKeybinding(g,d,c,a));const p=new J(g,o,o,void 0,n,(...d)=>Promise.resolve(e.run(this,...d)),this._contextKeyService);return this._actions.set(t,p),l.add(X(()=>{this._actions.delete(t)})),l}_triggerCommand(e,t){if(this._codeEditorService instanceof se)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};S=h([i(2,_),i(3,T),i(4,O),i(5,K),i(6,B),i(7,R),i(8,ie),i(9,A),i(10,N),i(11,w),i(12,V)],S);let b=class extends S{_configurationService;_standaloneThemeService;_ownsModel;constructor(e,t,o,n,r,a,f,I,c,l,g,p,d,u,E,D){const m={...t};y(g,m,!1);const F=c.registerEditorContainer(e);typeof m.theme=="string"&&c.setTheme(m.theme),typeof m.autoDetectHighContrast<"u"&&c.setAutoDetectHighContrast(!!m.autoDetectHighContrast);const H=m.model;delete m.model,super(e,m,o,n,r,a,f,I,c,l,p,E,D),this._configurationService=g,this._standaloneThemeService=c,this._register(F);let C;if(typeof H>"u"){const M=u.getLanguageIdByMimeType(m.language)||m.language||ce;C=Se(d,u,m.value||"",M,void 0),this._ownsModel=!0}else C=H,this._ownsModel=!1;if(this._attachModel(C),C){const M={oldModelUrl:null,newModelUrl:C.uri};this._onDidChangeModel.fire(M)}}dispose(){super.dispose()}updateOptions(e){y(this._configurationService,e,!1),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};b=h([i(2,_),i(3,T),i(4,O),i(5,K),i(6,B),i(7,R),i(8,L),i(9,A),i(10,k),i(11,N),i(12,ae),i(13,de),i(14,w),i(15,V)],b);let x=class extends le{_configurationService;_standaloneThemeService;constructor(e,t,o,n,r,a,f,I,c,l,g,p){const d={...t};y(I,d,!0);const u=a.registerEditorContainer(e);typeof d.theme=="string"&&a.setTheme(d.theme),typeof d.autoDetectHighContrast<"u"&&a.setAutoDetectHighContrast(!!d.autoDetectHighContrast),super(e,d,{},n,o,r,p,l),this._configurationService=I,this._standaloneThemeService=a,this._register(u)}dispose(){super.dispose()}updateOptions(e){y(this._configurationService,e,!0),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_createInnerEditor(e,t,o){return e.createInstance(S,t,o)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,o){return this.getModifiedEditor().addCommand(e,t,o)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};x=h([i(2,_),i(3,K),i(4,T),i(5,L),i(6,A),i(7,k),i(8,te),i(9,re),i(10,ne),i(11,ue)],x);function Se(s,e,t,o,n){if(t=t||"",!o){const r=t.indexOf(`
`);let a=t;return r!==-1&&(a=t.substring(0,r)),z(s,t,e.createByFilepathOrFirstLine(n||null,a),n)}return z(s,t,e.createById(o),n)}function z(s,e,t,o){return s.createModel(e,t,o)}export{S as StandaloneCodeEditor,x as StandaloneDiffEditor2,b as StandaloneEditor,Se as createTextModel};
