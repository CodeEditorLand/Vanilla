var P=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var h=(s,e,t,o)=>{for(var n=o>1?void 0:o?U(e,t):e,r=s.length-1,a;r>=0;r--)(a=s[r])&&(n=(o?a(e,t,n):a(n))||n);return o&&n&&P(e,t,n),n},i=(s,e)=>(t,o)=>e(t,o,s);import*as W from"../../../../vs/base/browser/ui/aria/aria.js";import{setBaseLayerHoverDelegate as q}from"../../../../vs/base/browser/ui/hover/hoverDelegate2.js";import{setHoverDelegateFactory as X}from"../../../../vs/base/browser/ui/hover/hoverDelegateFactory.js";import{mainWindow as Y}from"../../../../vs/base/browser/window.js";import{Disposable as j,DisposableStore as J,toDisposable as Q}from"../../../../vs/base/common/lifecycle.js";import"../../../../vs/base/common/uri.js";import"../../../../vs/editor/browser/config/editorConfiguration.js";import"../../../../vs/editor/browser/editorBrowser.js";import{ICodeEditorService as T}from"../../../../vs/editor/browser/services/codeEditorService.js";import{CodeEditorWidget as Z}from"../../../../vs/editor/browser/widget/codeEditor/codeEditorWidget.js";import{DiffEditorWidget as $}from"../../../../vs/editor/browser/widget/diffEditor/diffEditorWidget.js";import"../../../../vs/editor/common/config/editorOptions.js";import{InternalEditorAction as ee}from"../../../../vs/editor/common/editorAction.js";import"../../../../vs/editor/common/editorCommon.js";import{ILanguageService as te}from"../../../../vs/editor/common/languages/language.js";import{ILanguageConfigurationService as L}from"../../../../vs/editor/common/languages/languageConfigurationRegistry.js";import{PLAINTEXT_LANGUAGE_ID as ie}from"../../../../vs/editor/common/languages/modesRegistry.js";import"../../../../vs/editor/common/model.js";import{ILanguageFeaturesService as O}from"../../../../vs/editor/common/services/languageFeatures.js";import{IModelService as oe}from"../../../../vs/editor/common/services/model.js";import{StandaloneCodeEditorNLS as ne}from"../../../../vs/editor/common/standaloneStrings.js";import{StandaloneCodeEditorService as re}from"../../../../vs/editor/standalone/browser/standaloneCodeEditorService.js";import{StandaloneKeybindingService as ae,updateConfigurationService as y}from"../../../../vs/editor/standalone/browser/standaloneServices.js";import"../../../../vs/editor/standalone/browser/standaloneThemeService.js";import{IStandaloneThemeService as k}from"../../../../vs/editor/standalone/common/standaloneTheme.js";import{IAccessibilityService as R}from"../../../../vs/platform/accessibility/common/accessibility.js";import{IAccessibilitySignalService as de}from"../../../../vs/platform/accessibilitySignal/browser/accessibilitySignalService.js";import{MenuId as se,MenuRegistry as ce}from"../../../../vs/platform/actions/common/actions.js";import{IClipboardService as le}from"../../../../vs/platform/clipboard/common/clipboardService.js";import{CommandsRegistry as ue,ICommandService as N}from"../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as w}from"../../../../vs/platform/configuration/common/configuration.js";import{ContextKeyExpr as v,IContextKeyService as K}from"../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as me}from"../../../../vs/platform/contextview/browser/contextView.js";import{IHoverService as V,WorkbenchHoverDelegate as ge}from"../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as _}from"../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as B}from"../../../../vs/platform/keybinding/common/keybinding.js";import{INotificationService as A}from"../../../../vs/platform/notification/common/notification.js";import{IEditorProgressService as Ie}from"../../../../vs/platform/progress/common/progress.js";import{IThemeService as fe}from"../../../../vs/platform/theme/common/themeService.js";let pe=0,G=!1;function ve(s){if(!s){if(G)return;G=!0}W.setARIAContainer(s||Y.document.body)}let S=class extends Z{_standaloneKeybindingService;constructor(e,t,o,n,r,a,f,I,c,l,g,p,d){const u={...t};u.ariaLabel=u.ariaLabel||ne.editorViewAccessibleLabel,super(e,u,{},o,n,r,a,c,l,g,p,d),I instanceof ae?this._standaloneKeybindingService=I:this._standaloneKeybindingService=null,ve(u.ariaContainerElement),X((E,D)=>o.createInstance(ge,E,D,{})),q(f)}addCommand(e,t,o){if(!this._standaloneKeybindingService)return console.warn("Cannot add command because the editor is configured with an unrecognized KeybindingService"),null;const n="DYNAMIC_"+ ++pe,r=v.deserialize(o);return this._standaloneKeybindingService.addDynamicKeybinding(n,e,t,r),n}createContextKey(e,t){return this._contextKeyService.createKey(e,t)}addAction(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");if(!this._standaloneKeybindingService)return console.warn("Cannot add keybinding because the editor is configured with an unrecognized KeybindingService"),j.None;const t=e.id,o=e.label,n=v.and(v.equals("editorId",this.getId()),v.deserialize(e.precondition)),r=e.keybindings,a=v.and(n,v.deserialize(e.keybindingContext)),f=e.contextMenuGroupId||null,I=e.contextMenuOrder||0,c=(d,...u)=>Promise.resolve(e.run(this,...u)),l=new J,g=this.getId()+":"+t;if(l.add(ue.registerCommand(g,c)),f){const d={command:{id:g,title:o},when:n,group:f,order:I};l.add(ce.appendMenuItem(se.EditorContext,d))}if(Array.isArray(r))for(const d of r)l.add(this._standaloneKeybindingService.addDynamicKeybinding(g,d,c,a));const p=new ee(g,o,o,void 0,n,(...d)=>Promise.resolve(e.run(this,...d)),this._contextKeyService);return this._actions.set(t,p),l.add(Q(()=>{this._actions.delete(t)})),l}_triggerCommand(e,t){if(this._codeEditorService instanceof re)try{this._codeEditorService.setActiveCodeEditor(this),super._triggerCommand(e,t)}finally{this._codeEditorService.setActiveCodeEditor(null)}else super._triggerCommand(e,t)}};S=h([i(2,_),i(3,T),i(4,N),i(5,K),i(6,V),i(7,B),i(8,fe),i(9,A),i(10,R),i(11,L),i(12,O)],S);let b=class extends S{_configurationService;_standaloneThemeService;_ownsModel;constructor(e,t,o,n,r,a,f,I,c,l,g,p,d,u,E,D){const m={...t};y(g,m,!1);const F=c.registerEditorContainer(e);typeof m.theme=="string"&&c.setTheme(m.theme),typeof m.autoDetectHighContrast<"u"&&c.setAutoDetectHighContrast(!!m.autoDetectHighContrast);const H=m.model;delete m.model,super(e,m,o,n,r,a,f,I,c,l,p,E,D),this._configurationService=g,this._standaloneThemeService=c,this._register(F);let C;if(typeof H>"u"){const M=u.getLanguageIdByMimeType(m.language)||m.language||ie;C=Se(d,u,m.value||"",M,void 0),this._ownsModel=!0}else C=H,this._ownsModel=!1;if(this._attachModel(C),C){const M={oldModelUrl:null,newModelUrl:C.uri};this._onDidChangeModel.fire(M)}}dispose(){super.dispose()}updateOptions(e){y(this._configurationService,e,!1),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_postDetachModelCleanup(e){super._postDetachModelCleanup(e),e&&this._ownsModel&&(e.dispose(),this._ownsModel=!1)}};b=h([i(2,_),i(3,T),i(4,N),i(5,K),i(6,V),i(7,B),i(8,k),i(9,A),i(10,w),i(11,R),i(12,oe),i(13,te),i(14,L),i(15,O)],b);let x=class extends ${_configurationService;_standaloneThemeService;constructor(e,t,o,n,r,a,f,I,c,l,g,p){const d={...t};y(I,d,!0);const u=a.registerEditorContainer(e);typeof d.theme=="string"&&a.setTheme(d.theme),typeof d.autoDetectHighContrast<"u"&&a.setAutoDetectHighContrast(!!d.autoDetectHighContrast),super(e,d,{},n,o,r,p,l),this._configurationService=I,this._standaloneThemeService=a,this._register(u)}dispose(){super.dispose()}updateOptions(e){y(this._configurationService,e,!0),typeof e.theme=="string"&&this._standaloneThemeService.setTheme(e.theme),typeof e.autoDetectHighContrast<"u"&&this._standaloneThemeService.setAutoDetectHighContrast(!!e.autoDetectHighContrast),super.updateOptions(e)}_createInnerEditor(e,t,o){return e.createInstance(S,t,o)}getOriginalEditor(){return super.getOriginalEditor()}getModifiedEditor(){return super.getModifiedEditor()}addCommand(e,t,o){return this.getModifiedEditor().addCommand(e,t,o)}createContextKey(e,t){return this.getModifiedEditor().createContextKey(e,t)}addAction(e){return this.getModifiedEditor().addAction(e)}};x=h([i(2,_),i(3,K),i(4,T),i(5,k),i(6,A),i(7,w),i(8,me),i(9,Ie),i(10,le),i(11,de)],x);function Se(s,e,t,o,n){if(t=t||"",!o){const r=t.indexOf(`
`);let a=t;return r!==-1&&(a=t.substring(0,r)),z(s,t,e.createByFilepathOrFirstLine(n||null,a),n)}return z(s,t,e.createById(o),n)}function z(s,e,t,o){return s.createModel(e,t,o)}export{S as StandaloneCodeEditor,x as StandaloneDiffEditor2,b as StandaloneEditor,Se as createTextModel};
