import{mainWindow as v}from"../../../base/browser/window.js";import{Disposable as T,DisposableStore as x}from"../../../base/common/lifecycle.js";import{splitLines as D}from"../../../base/common/strings.js";import{URI as h}from"../../../base/common/uri.js";import"./standalone-tokens.css";import{MenuId as O,MenuRegistry as L}from"../../../platform/actions/common/actions.js";import{CommandsRegistry as I}from"../../../platform/commands/common/commands.js";import{ContextKeyExpr as p}from"../../../platform/contextkey/common/contextkey.js";import{IKeybindingService as M}from"../../../platform/keybinding/common/keybinding.js";import{IMarkerService as g}from"../../../platform/markers/common/markers.js";import{IOpenerService as R}from"../../../platform/opener/common/opener.js";import{FontMeasurements as z}from"../../browser/config/fontMeasurements.js";import{EditorCommand as A}from"../../browser/editorExtensions.js";import{ICodeEditorService as l}from"../../browser/services/codeEditorService.js";import{MultiDiffEditorWidget as P}from"../../browser/widget/multiDiffEditor/multiDiffEditorWidget.js";import{ApplyUpdateResult as W,ConfigurationChangedEvent as w,EditorOptions as K}from"../../common/config/editorOptions.js";import{EditorZoom as F}from"../../common/config/editorZoom.js";import{BareFontInfo as U,FontInfo as B}from"../../common/config/fontInfo.js";import{EditorType as H}from"../../common/editorCommon.js";import*as b from"../../common/languages.js";import{ILanguageService as u}from"../../common/languages/language.js";import{PLAINTEXT_LANGUAGE_ID as j}from"../../common/languages/modesRegistry.js";import{NullState as N,nullTokenize as G}from"../../common/languages/nullTokenize.js";import{FindMatch as q,TextModelResolvedOptions as V}from"../../common/model.js";import{IModelService as c}from"../../common/services/model.js";import*as i from"../../common/standalone/standaloneEnums.js";import{IStandaloneThemeService as m}from"../common/standaloneTheme.js";import{Colorizer as S}from"./colorizer.js";import{StandaloneDiffEditor2 as Z,StandaloneEditor as _,createTextModel as X}from"./standaloneCodeEditor.js";import{StandaloneKeybindingService as C,StandaloneServices as t}from"./standaloneServices.js";import{createWebWorker as J}from"./standaloneWebWorker.js";function Q(e,n,o){return t.initialize(o||{}).createInstance(_,e,n)}function Y(e){return t.get(l).onCodeEditorAdd(o=>{e(o)})}function $(e){return t.get(l).onDiffEditorAdd(o=>{e(o)})}function ee(){return t.get(l).listCodeEditors()}function ne(){return t.get(l).listDiffEditors()}function oe(e,n,o){return t.initialize(o||{}).createInstance(Z,e,n)}function te(e,n){const o=t.initialize(n||{});return new P(e,{},o)}function re(e){if(typeof e.id!="string"||typeof e.run!="function")throw new Error("Invalid command descriptor, `id` and `run` are required properties!");return I.registerCommand(e.id,e.run)}function ie(e){if(typeof e.id!="string"||typeof e.label!="string"||typeof e.run!="function")throw new Error("Invalid action descriptor, `id`, `label` and `run` are required properties!");const n=p.deserialize(e.precondition),o=(a,...d)=>A.runEditorCommand(a,d,n,(s,f,y)=>Promise.resolve(e.run(f,...y))),r=new x;if(r.add(I.registerCommand(e.id,o)),e.contextMenuGroupId){const a={command:{id:e.id,title:e.label},when:n,group:e.contextMenuGroupId,order:e.contextMenuOrder||0};r.add(L.appendMenuItem(O.EditorContext,a))}if(Array.isArray(e.keybindings)){const a=t.get(M);if(a instanceof C){const d=p.and(n,p.deserialize(e.keybindingContext));r.add(a.addDynamicKeybindings(e.keybindings.map(s=>({keybinding:s,command:e.id,when:d}))))}}return r}function ae(e){return k([e])}function k(e){const n=t.get(M);return n instanceof C?n.addDynamicKeybindings(e.map(o=>({keybinding:o.keybinding,command:o.command,commandArgs:o.commandArgs,when:p.deserialize(o.when)}))):T.None}function de(e,n,o){const r=t.get(u),a=r.getLanguageIdByMimeType(n)||n;return X(t.get(c),r,e,a,o)}function se(e,n){const o=t.get(u),r=o.getLanguageIdByMimeType(n)||n||j;e.setLanguage(o.createById(r))}function ce(e,n,o){e&&t.get(g).changeOne(n,e.uri,o)}function le(e){t.get(g).changeAll(e,[])}function me(e){return t.get(g).read(e)}function pe(e){return t.get(g).onMarkerChanged(e)}function ge(e){return t.get(c).getModel(e)}function ue(){return t.get(c).getModels()}function fe(e){return t.get(c).onModelAdded(e)}function ye(e){return t.get(c).onModelRemoved(e)}function Ie(e){return t.get(c).onModelLanguageChanged(o=>{e({model:o.model,oldLanguage:o.oldLanguageId})})}function Se(e){return J(t.get(c),e)}function Ee(e,n){const o=t.get(u),r=t.get(m);return S.colorizeElement(r,o,e,n).then(()=>{r.registerEditorContainer(e)})}function ve(e,n,o){const r=t.get(u);return t.get(m).registerEditorContainer(v.document.body),S.colorize(r,e,n,o)}function Me(e,n,o=4){return t.get(m).registerEditorContainer(v.document.body),S.colorizeModelLine(e,n,o)}function be(e){const n=b.TokenizationRegistry.get(e);return n||{getInitialState:()=>N,tokenize:(o,r,a)=>G(e,a)}}function Ce(e,n){b.TokenizationRegistry.getOrCreate(n);const o=be(n),r=D(e),a=[];let d=o.getInitialState();for(let s=0,f=r.length;s<f;s++){const y=r[s],E=o.tokenize(y,!0,d);a[s]=E.tokens,d=E.endState}return a}function ke(e,n){t.get(m).defineTheme(e,n)}function Te(e){t.get(m).setTheme(e)}function xe(){z.clearAllFontInfos()}function De(e,n){return I.registerCommand({id:e,handler:n})}function he(e){return t.get(R).registerOpener({async open(o){return typeof o=="string"&&(o=h.parse(o)),e.open(o)}})}function Oe(e){return t.get(l).registerCodeEditorOpenHandler(async(o,r,a)=>{if(!r)return null;const d=o.options?.selection;let s;return d&&typeof d.endLineNumber=="number"&&typeof d.endColumn=="number"?s=d:d&&(s={lineNumber:d.startLineNumber,column:d.startColumn}),await e.openCodeEditor(r,o.resource,s)?r:null})}function an(){return{create:Q,getEditors:ee,getDiffEditors:ne,onDidCreateEditor:Y,onDidCreateDiffEditor:$,createDiffEditor:oe,addCommand:re,addEditorAction:ie,addKeybindingRule:ae,addKeybindingRules:k,createModel:de,setModelLanguage:se,setModelMarkers:ce,getModelMarkers:me,removeAllMarkers:le,onDidChangeMarkers:pe,getModels:ue,getModel:ge,onDidCreateModel:fe,onWillDisposeModel:ye,onDidChangeModelLanguage:Ie,createWebWorker:Se,colorizeElement:Ee,colorize:ve,colorizeModelLine:Me,tokenize:Ce,defineTheme:ke,setTheme:Te,remeasureFonts:xe,registerCommand:De,registerLinkOpener:he,registerEditorOpener:Oe,AccessibilitySupport:i.AccessibilitySupport,ContentWidgetPositionPreference:i.ContentWidgetPositionPreference,CursorChangeReason:i.CursorChangeReason,DefaultEndOfLine:i.DefaultEndOfLine,EditorAutoIndentStrategy:i.EditorAutoIndentStrategy,EditorOption:i.EditorOption,EndOfLinePreference:i.EndOfLinePreference,EndOfLineSequence:i.EndOfLineSequence,MinimapPosition:i.MinimapPosition,MinimapSectionHeaderStyle:i.MinimapSectionHeaderStyle,MouseTargetType:i.MouseTargetType,OverlayWidgetPositionPreference:i.OverlayWidgetPositionPreference,OverviewRulerLane:i.OverviewRulerLane,GlyphMarginLane:i.GlyphMarginLane,RenderLineNumbersType:i.RenderLineNumbersType,RenderMinimap:i.RenderMinimap,ScrollbarVisibility:i.ScrollbarVisibility,ScrollType:i.ScrollType,TextEditorCursorBlinkingStyle:i.TextEditorCursorBlinkingStyle,TextEditorCursorStyle:i.TextEditorCursorStyle,TrackedRangeStickiness:i.TrackedRangeStickiness,WrappingIndent:i.WrappingIndent,InjectedTextCursorStops:i.InjectedTextCursorStops,PositionAffinity:i.PositionAffinity,ShowLightbulbIconMode:i.ShowLightbulbIconMode,ConfigurationChangedEvent:w,BareFontInfo:U,FontInfo:B,TextModelResolvedOptions:V,FindMatch:q,ApplyUpdateResult:W,EditorZoom:F,createMultiFileDiffEditor:te,EditorType:H,EditorOptions:K}}export{re as addCommand,ie as addEditorAction,ae as addKeybindingRule,k as addKeybindingRules,ve as colorize,Ee as colorizeElement,Me as colorizeModelLine,Q as create,oe as createDiffEditor,de as createModel,an as createMonacoEditorAPI,te as createMultiFileDiffEditor,Se as createWebWorker,ke as defineTheme,ne as getDiffEditors,ee as getEditors,ge as getModel,me as getModelMarkers,ue as getModels,pe as onDidChangeMarkers,Ie as onDidChangeModelLanguage,$ as onDidCreateDiffEditor,Y as onDidCreateEditor,fe as onDidCreateModel,ye as onWillDisposeModel,De as registerCommand,Oe as registerEditorOpener,he as registerLinkOpener,xe as remeasureFonts,le as removeAllMarkers,se as setModelLanguage,ce as setModelMarkers,Te as setTheme,Ce as tokenize};
