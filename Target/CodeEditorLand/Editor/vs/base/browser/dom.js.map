{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/browser/dom.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tAbstractIdleValue,\n\ttype IdleDeadline,\n\tIntervalTimer,\n\tTimeoutTimer,\n\t_runWhenIdle,\n} from \"../common/async.js\";\nimport { onUnexpectedError } from \"../common/errors.js\";\nimport * as event from \"../common/event.js\";\nimport { hash } from \"../common/hash.js\";\nimport { KeyCode } from \"../common/keyCodes.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../common/lifecycle.js\";\nimport { FileAccess, RemoteAuthorities, Schemas } from \"../common/network.js\";\nimport { isPointWithinTriangle } from \"../common/numbers.js\";\nimport * as platform from \"../common/platform.js\";\nimport { URI } from \"../common/uri.js\";\nimport * as browser from \"./browser.js\";\nimport { BrowserFeatures } from \"./canIUse.js\";\nimport * as dompurify from \"./dompurify/dompurify.js\";\nimport { type IKeyboardEvent, StandardKeyboardEvent } from \"./keyboardEvent.js\";\nimport { type IMouseEvent, StandardMouseEvent } from \"./mouseEvent.js\";\nimport { type CodeWindow, ensureCodeWindow, mainWindow } from \"./window.js\";\n\nexport interface IRegisteredCodeWindow {\n\treadonly window: CodeWindow;\n\treadonly disposables: DisposableStore;\n}\n\n//# region Multi-Window Support Utilities\n\nexport const {\n\tregisterWindow,\n\tgetWindow,\n\tgetDocument,\n\tgetWindows,\n\tgetWindowsCount,\n\tgetWindowId,\n\tgetWindowById,\n\thasWindow,\n\tonDidRegisterWindow,\n\tonWillUnregisterWindow,\n\tonDidUnregisterWindow,\n} = (() => {\n\tconst windows = new Map<number, IRegisteredCodeWindow>();\n\n\tensureCodeWindow(mainWindow, 1);\n\tconst mainWindowRegistration = {\n\t\twindow: mainWindow,\n\t\tdisposables: new DisposableStore(),\n\t};\n\twindows.set(mainWindow.vscodeWindowId, mainWindowRegistration);\n\n\tconst onDidRegisterWindow = new event.Emitter<IRegisteredCodeWindow>();\n\tconst onDidUnregisterWindow = new event.Emitter<CodeWindow>();\n\tconst onWillUnregisterWindow = new event.Emitter<CodeWindow>();\n\n\tfunction getWindowById(windowId: number): IRegisteredCodeWindow | undefined;\n\tfunction getWindowById(\n\t\twindowId: number | undefined,\n\t\tfallbackToMain: true,\n\t): IRegisteredCodeWindow;\n\tfunction getWindowById(\n\t\twindowId: number | undefined,\n\t\tfallbackToMain?: boolean,\n\t): IRegisteredCodeWindow | undefined {\n\t\tconst window =\n\t\t\ttypeof windowId === \"number\" ? windows.get(windowId) : undefined;\n\n\t\treturn window ?? (fallbackToMain ? mainWindowRegistration : undefined);\n\t}\n\n\treturn {\n\t\tonDidRegisterWindow: onDidRegisterWindow.event,\n\t\tonWillUnregisterWindow: onWillUnregisterWindow.event,\n\t\tonDidUnregisterWindow: onDidUnregisterWindow.event,\n\t\tregisterWindow(window: CodeWindow): IDisposable {\n\t\t\tif (windows.has(window.vscodeWindowId)) {\n\t\t\t\treturn Disposable.None;\n\t\t\t}\n\n\t\t\tconst disposables = new DisposableStore();\n\n\t\t\tconst registeredWindow = {\n\t\t\t\twindow,\n\t\t\t\tdisposables: disposables.add(new DisposableStore()),\n\t\t\t};\n\t\t\twindows.set(window.vscodeWindowId, registeredWindow);\n\n\t\t\tdisposables.add(\n\t\t\t\ttoDisposable(() => {\n\t\t\t\t\twindows.delete(window.vscodeWindowId);\n\t\t\t\t\tonDidUnregisterWindow.fire(window);\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tdisposables.add(\n\t\t\t\taddDisposableListener(window, EventType.BEFORE_UNLOAD, () => {\n\t\t\t\t\tonWillUnregisterWindow.fire(window);\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tonDidRegisterWindow.fire(registeredWindow);\n\n\t\t\treturn disposables;\n\t\t},\n\t\tgetWindows(): Iterable<IRegisteredCodeWindow> {\n\t\t\treturn windows.values();\n\t\t},\n\t\tgetWindowsCount(): number {\n\t\t\treturn windows.size;\n\t\t},\n\t\tgetWindowId(targetWindow: Window): number {\n\t\t\treturn (targetWindow as CodeWindow).vscodeWindowId;\n\t\t},\n\t\thasWindow(windowId: number): boolean {\n\t\t\treturn windows.has(windowId);\n\t\t},\n\t\tgetWindowById,\n\t\tgetWindow(e: Node | UIEvent | undefined | null): CodeWindow {\n\t\t\tconst candidateNode = e as Node | undefined | null;\n\t\t\tif (candidateNode?.ownerDocument?.defaultView) {\n\t\t\t\treturn candidateNode.ownerDocument.defaultView\n\t\t\t\t\t.window as CodeWindow;\n\t\t\t}\n\n\t\t\tconst candidateEvent = e as UIEvent | undefined | null;\n\t\t\tif (candidateEvent?.view) {\n\t\t\t\treturn candidateEvent.view.window as CodeWindow;\n\t\t\t}\n\n\t\t\treturn mainWindow;\n\t\t},\n\t\tgetDocument(e: Node | UIEvent | undefined | null): Document {\n\t\t\tconst candidateNode = e as Node | undefined | null;\n\t\t\treturn getWindow(candidateNode).document;\n\t\t},\n\t};\n})();\n\n//#endregion\n\nexport function clearNode(node: HTMLElement): void {\n\twhile (node.firstChild) {\n\t\tnode.firstChild.remove();\n\t}\n}\n\nclass DomListener implements IDisposable {\n\tprivate _handler: (e: any) => void;\n\tprivate _node: EventTarget;\n\tprivate readonly _type: string;\n\tprivate readonly _options: boolean | AddEventListenerOptions;\n\n\tconstructor(\n\t\tnode: EventTarget,\n\t\ttype: string,\n\t\thandler: (e: any) => void,\n\t\toptions?: boolean | AddEventListenerOptions,\n\t) {\n\t\tthis._node = node;\n\t\tthis._type = type;\n\t\tthis._handler = handler;\n\t\tthis._options = options || false;\n\t\tthis._node.addEventListener(this._type, this._handler, this._options);\n\t}\n\n\tdispose(): void {\n\t\tif (!this._handler) {\n\t\t\t// Already disposed\n\t\t\treturn;\n\t\t}\n\n\t\tthis._node.removeEventListener(\n\t\t\tthis._type,\n\t\t\tthis._handler,\n\t\t\tthis._options,\n\t\t);\n\n\t\t// Prevent leakers from holding on to the dom or handler func\n\t\tthis._node = null!;\n\t\tthis._handler = null!;\n\t}\n}\n\nexport function addDisposableListener<\n\tK extends keyof GlobalEventHandlersEventMap,\n>(\n\tnode: EventTarget,\n\ttype: K,\n\thandler: (event: GlobalEventHandlersEventMap[K]) => void,\n\tuseCapture?: boolean,\n): IDisposable;\nexport function addDisposableListener(\n\tnode: EventTarget,\n\ttype: string,\n\thandler: (event: any) => void,\n\tuseCapture?: boolean,\n): IDisposable;\nexport function addDisposableListener(\n\tnode: EventTarget,\n\ttype: string,\n\thandler: (event: any) => void,\n\toptions: AddEventListenerOptions,\n): IDisposable;\nexport function addDisposableListener(\n\tnode: EventTarget,\n\ttype: string,\n\thandler: (event: any) => void,\n\tuseCaptureOrOptions?: boolean | AddEventListenerOptions,\n): IDisposable {\n\treturn new DomListener(node, type, handler, useCaptureOrOptions);\n}\n\nexport interface IAddStandardDisposableListenerSignature {\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"click\",\n\t\thandler: (event: IMouseEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"mousedown\",\n\t\thandler: (event: IMouseEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"keydown\",\n\t\thandler: (event: IKeyboardEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"keypress\",\n\t\thandler: (event: IKeyboardEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"keyup\",\n\t\thandler: (event: IKeyboardEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"pointerdown\",\n\t\thandler: (event: PointerEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"pointermove\",\n\t\thandler: (event: PointerEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: \"pointerup\",\n\t\thandler: (event: PointerEvent) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n\t(\n\t\tnode: HTMLElement,\n\t\ttype: string,\n\t\thandler: (event: any) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable;\n}\nfunction _wrapAsStandardMouseEvent(\n\ttargetWindow: Window,\n\thandler: (e: IMouseEvent) => void,\n): (e: MouseEvent) => void {\n\treturn (e: MouseEvent) => handler(new StandardMouseEvent(targetWindow, e));\n}\nfunction _wrapAsStandardKeyboardEvent(\n\thandler: (e: IKeyboardEvent) => void,\n): (e: KeyboardEvent) => void {\n\treturn (e: KeyboardEvent) => handler(new StandardKeyboardEvent(e));\n}\nexport const addStandardDisposableListener: IAddStandardDisposableListenerSignature =\n\tfunction addStandardDisposableListener(\n\t\tnode: HTMLElement,\n\t\ttype: string,\n\t\thandler: (event: any) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable {\n\t\tlet wrapHandler = handler;\n\n\t\tif (\n\t\t\ttype === \"click\" ||\n\t\t\ttype === \"mousedown\" ||\n\t\t\ttype === \"contextmenu\"\n\t\t) {\n\t\t\twrapHandler = _wrapAsStandardMouseEvent(getWindow(node), handler);\n\t\t} else if (\n\t\t\ttype === \"keydown\" ||\n\t\t\ttype === \"keypress\" ||\n\t\t\ttype === \"keyup\"\n\t\t) {\n\t\t\twrapHandler = _wrapAsStandardKeyboardEvent(handler);\n\t\t}\n\n\t\treturn addDisposableListener(node, type, wrapHandler, useCapture);\n\t};\n\nexport const addStandardDisposableGenericMouseDownListener =\n\tfunction addStandardDisposableListener(\n\t\tnode: HTMLElement,\n\t\thandler: (event: any) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable {\n\t\tconst wrapHandler = _wrapAsStandardMouseEvent(getWindow(node), handler);\n\n\t\treturn addDisposableGenericMouseDownListener(\n\t\t\tnode,\n\t\t\twrapHandler,\n\t\t\tuseCapture,\n\t\t);\n\t};\n\nexport const addStandardDisposableGenericMouseUpListener =\n\tfunction addStandardDisposableListener(\n\t\tnode: HTMLElement,\n\t\thandler: (event: any) => void,\n\t\tuseCapture?: boolean,\n\t): IDisposable {\n\t\tconst wrapHandler = _wrapAsStandardMouseEvent(getWindow(node), handler);\n\n\t\treturn addDisposableGenericMouseUpListener(\n\t\t\tnode,\n\t\t\twrapHandler,\n\t\t\tuseCapture,\n\t\t);\n\t};\nexport function addDisposableGenericMouseDownListener(\n\tnode: EventTarget,\n\thandler: (event: any) => void,\n\tuseCapture?: boolean,\n): IDisposable {\n\treturn addDisposableListener(\n\t\tnode,\n\t\tplatform.isIOS && BrowserFeatures.pointerEvents\n\t\t\t? EventType.POINTER_DOWN\n\t\t\t: EventType.MOUSE_DOWN,\n\t\thandler,\n\t\tuseCapture,\n\t);\n}\n\nexport function addDisposableGenericMouseMoveListener(\n\tnode: EventTarget,\n\thandler: (event: any) => void,\n\tuseCapture?: boolean,\n): IDisposable {\n\treturn addDisposableListener(\n\t\tnode,\n\t\tplatform.isIOS && BrowserFeatures.pointerEvents\n\t\t\t? EventType.POINTER_MOVE\n\t\t\t: EventType.MOUSE_MOVE,\n\t\thandler,\n\t\tuseCapture,\n\t);\n}\n\nexport function addDisposableGenericMouseUpListener(\n\tnode: EventTarget,\n\thandler: (event: any) => void,\n\tuseCapture?: boolean,\n): IDisposable {\n\treturn addDisposableListener(\n\t\tnode,\n\t\tplatform.isIOS && BrowserFeatures.pointerEvents\n\t\t\t? EventType.POINTER_UP\n\t\t\t: EventType.MOUSE_UP,\n\t\thandler,\n\t\tuseCapture,\n\t);\n}\n\n/**\n * Execute the callback the next time the browser is idle, returning an\n * {@link IDisposable} that will cancel the callback when disposed. This wraps\n * [requestIdleCallback] so it will fallback to [setTimeout] if the environment\n * doesn't support it.\n *\n * @param targetWindow The window for which to run the idle callback\n * @param callback The callback to run when idle, this includes an\n * [IdleDeadline] that provides the time alloted for the idle callback by the\n * browser. Not respecting this deadline will result in a degraded user\n * experience.\n * @param timeout A timeout at which point to queue no longer wait for an idle\n * callback but queue it on the regular event loop (like setTimeout). Typically\n * this should not be used.\n *\n * [IdleDeadline]: https://developer.mozilla.org/en-US/docs/Web/API/IdleDeadline\n * [requestIdleCallback]: https://developer.mozilla.org/en-US/docs/Web/API/Window/requestIdleCallback\n * [setTimeout]: https://developer.mozilla.org/en-US/docs/Web/API/Window/setTimeout\n */\nexport function runWhenWindowIdle(\n\ttargetWindow: Window | typeof globalThis,\n\tcallback: (idle: IdleDeadline) => void,\n\ttimeout?: number,\n): IDisposable {\n\treturn _runWhenIdle(targetWindow, callback, timeout);\n}\n\n/**\n * An implementation of the \"idle-until-urgent\"-strategy as introduced\n * here: https://philipwalton.com/articles/idle-until-urgent/\n */\nexport class WindowIdleValue<T> extends AbstractIdleValue<T> {\n\tconstructor(targetWindow: Window | typeof globalThis, executor: () => T) {\n\t\tsuper(targetWindow, executor);\n\t}\n}\n\n/**\n * Schedule a callback to be run at the next animation frame.\n * This allows multiple parties to register callbacks that should run at the next animation frame.\n * If currently in an animation frame, `runner` will be executed immediately.\n * @return token that can be used to cancel the scheduled runner (only if `runner` was not executed immediately).\n */\nexport let runAtThisOrScheduleAtNextAnimationFrame: (\n\ttargetWindow: Window,\n\trunner: () => void,\n\tpriority?: number,\n) => IDisposable;\n/**\n * Schedule a callback to be run at the next animation frame.\n * This allows multiple parties to register callbacks that should run at the next animation frame.\n * If currently in an animation frame, `runner` will be executed at the next animation frame.\n * @return token that can be used to cancel the scheduled runner.\n */\nexport let scheduleAtNextAnimationFrame: (\n\ttargetWindow: Window,\n\trunner: () => void,\n\tpriority?: number,\n) => IDisposable;\n\nexport function disposableWindowInterval(\n\ttargetWindow: Window,\n\thandler: () => void | boolean /* stop interval */ | Promise<unknown>,\n\tinterval: number,\n\titerations?: number,\n): IDisposable {\n\tlet iteration = 0;\n\tconst timer = targetWindow.setInterval(() => {\n\t\titeration++;\n\t\tif (\n\t\t\t(typeof iterations === \"number\" && iteration >= iterations) ||\n\t\t\thandler() === true\n\t\t) {\n\t\t\tdisposable.dispose();\n\t\t}\n\t}, interval);\n\tconst disposable = toDisposable(() => {\n\t\ttargetWindow.clearInterval(timer);\n\t});\n\treturn disposable;\n}\n\nexport class WindowIntervalTimer extends IntervalTimer {\n\tprivate readonly defaultTarget?: Window & typeof globalThis;\n\n\t/**\n\t *\n\t * @param node The optional node from which the target window is determined\n\t */\n\tconstructor(node?: Node) {\n\t\tsuper();\n\t\tthis.defaultTarget = node && getWindow(node);\n\t}\n\n\toverride cancelAndSet(\n\t\trunner: () => void,\n\t\tinterval: number,\n\t\ttargetWindow?: Window & typeof globalThis,\n\t): void {\n\t\treturn super.cancelAndSet(\n\t\t\trunner,\n\t\t\tinterval,\n\t\t\ttargetWindow ?? this.defaultTarget,\n\t\t);\n\t}\n}\n\nclass AnimationFrameQueueItem implements IDisposable {\n\tprivate _runner: () => void;\n\tpublic priority: number;\n\tprivate _canceled: boolean;\n\n\tconstructor(runner: () => void, priority = 0) {\n\t\tthis._runner = runner;\n\t\tthis.priority = priority;\n\t\tthis._canceled = false;\n\t}\n\n\tdispose(): void {\n\t\tthis._canceled = true;\n\t}\n\n\texecute(): void {\n\t\tif (this._canceled) {\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tthis._runner();\n\t\t} catch (e) {\n\t\t\tonUnexpectedError(e);\n\t\t}\n\t}\n\n\t// Sort by priority (largest to lowest)\n\tstatic sort(\n\t\ta: AnimationFrameQueueItem,\n\t\tb: AnimationFrameQueueItem,\n\t): number {\n\t\treturn b.priority - a.priority;\n\t}\n}\n\n(() => {\n\t/**\n\t * The runners scheduled at the next animation frame\n\t */\n\tconst NEXT_QUEUE = new Map<\n\t\tnumber /* window ID */,\n\t\tAnimationFrameQueueItem[]\n\t>();\n\t/**\n\t * The runners scheduled at the current animation frame\n\t */\n\tconst CURRENT_QUEUE = new Map<\n\t\tnumber /* window ID */,\n\t\tAnimationFrameQueueItem[]\n\t>();\n\t/**\n\t * A flag to keep track if the native requestAnimationFrame was already called\n\t */\n\tconst animFrameRequested = new Map<number /* window ID */, boolean>();\n\t/**\n\t * A flag to indicate if currently handling a native requestAnimationFrame callback\n\t */\n\tconst inAnimationFrameRunner = new Map<number /* window ID */, boolean>();\n\n\tconst animationFrameRunner = (targetWindowId: number) => {\n\t\tanimFrameRequested.set(targetWindowId, false);\n\n\t\tconst currentQueue = NEXT_QUEUE.get(targetWindowId) ?? [];\n\t\tCURRENT_QUEUE.set(targetWindowId, currentQueue);\n\t\tNEXT_QUEUE.set(targetWindowId, []);\n\n\t\tinAnimationFrameRunner.set(targetWindowId, true);\n\t\twhile (currentQueue.length > 0) {\n\t\t\tcurrentQueue.sort(AnimationFrameQueueItem.sort);\n\t\t\tconst top = currentQueue.shift()!;\n\t\t\ttop.execute();\n\t\t}\n\t\tinAnimationFrameRunner.set(targetWindowId, false);\n\t};\n\n\tscheduleAtNextAnimationFrame = (\n\t\ttargetWindow: Window,\n\t\trunner: () => void,\n\t\tpriority = 0,\n\t) => {\n\t\tconst targetWindowId = getWindowId(targetWindow);\n\t\tconst item = new AnimationFrameQueueItem(runner, priority);\n\n\t\tlet nextQueue = NEXT_QUEUE.get(targetWindowId);\n\t\tif (!nextQueue) {\n\t\t\tnextQueue = [];\n\t\t\tNEXT_QUEUE.set(targetWindowId, nextQueue);\n\t\t}\n\t\tnextQueue.push(item);\n\n\t\tif (!animFrameRequested.get(targetWindowId)) {\n\t\t\tanimFrameRequested.set(targetWindowId, true);\n\t\t\ttargetWindow.requestAnimationFrame(() =>\n\t\t\t\tanimationFrameRunner(targetWindowId),\n\t\t\t);\n\t\t}\n\n\t\treturn item;\n\t};\n\n\trunAtThisOrScheduleAtNextAnimationFrame = (\n\t\ttargetWindow: Window,\n\t\trunner: () => void,\n\t\tpriority?: number,\n\t) => {\n\t\tconst targetWindowId = getWindowId(targetWindow);\n\t\tif (inAnimationFrameRunner.get(targetWindowId)) {\n\t\t\tconst item = new AnimationFrameQueueItem(runner, priority);\n\t\t\tlet currentQueue = CURRENT_QUEUE.get(targetWindowId);\n\t\t\tif (!currentQueue) {\n\t\t\t\tcurrentQueue = [];\n\t\t\t\tCURRENT_QUEUE.set(targetWindowId, currentQueue);\n\t\t\t}\n\t\t\tcurrentQueue.push(item);\n\t\t\treturn item;\n\t\t} else {\n\t\t\treturn scheduleAtNextAnimationFrame(targetWindow, runner, priority);\n\t\t}\n\t};\n})();\n\nexport function measure(\n\ttargetWindow: Window,\n\tcallback: () => void,\n): IDisposable {\n\treturn scheduleAtNextAnimationFrame(\n\t\ttargetWindow,\n\t\tcallback,\n\t\t10000 /* must be early */,\n\t);\n}\n\nexport function modify(\n\ttargetWindow: Window,\n\tcallback: () => void,\n): IDisposable {\n\treturn scheduleAtNextAnimationFrame(\n\t\ttargetWindow,\n\t\tcallback,\n\t\t-10000 /* must be late */,\n\t);\n}\n\n/**\n * Add a throttled listener. `handler` is fired at most every 8.33333ms or with the next animation frame (if browser supports it).\n */\nexport interface IEventMerger<R, E> {\n\t(lastEvent: R | null, currentEvent: E): R;\n}\n\nconst MINIMUM_TIME_MS = 8;\nconst DEFAULT_EVENT_MERGER: IEventMerger<Event, Event> = (\n\tlastEvent: Event | null,\n\tcurrentEvent: Event,\n) => currentEvent;\n\nclass TimeoutThrottledDomListener<R, E extends Event> extends Disposable {\n\tconstructor(\n\t\tnode: any,\n\t\ttype: string,\n\t\thandler: (event: R) => void,\n\t\teventMerger: IEventMerger<R, E> = <any>DEFAULT_EVENT_MERGER,\n\t\tminimumTimeMs: number = MINIMUM_TIME_MS,\n\t) {\n\t\tsuper();\n\n\t\tlet lastEvent: R | null = null;\n\t\tlet lastHandlerTime = 0;\n\t\tconst timeout = this._register(new TimeoutTimer());\n\n\t\tconst invokeHandler = () => {\n\t\t\tlastHandlerTime = new Date().getTime();\n\t\t\thandler(<R>lastEvent);\n\t\t\tlastEvent = null;\n\t\t};\n\n\t\tthis._register(\n\t\t\taddDisposableListener(node, type, (e) => {\n\t\t\t\tlastEvent = eventMerger(lastEvent, e);\n\t\t\t\tconst elapsedTime = new Date().getTime() - lastHandlerTime;\n\n\t\t\t\tif (elapsedTime >= minimumTimeMs) {\n\t\t\t\t\ttimeout.cancel();\n\t\t\t\t\tinvokeHandler();\n\t\t\t\t} else {\n\t\t\t\t\ttimeout.setIfNotSet(\n\t\t\t\t\t\tinvokeHandler,\n\t\t\t\t\t\tminimumTimeMs - elapsedTime,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n}\n\nexport function addDisposableThrottledListener<R, E extends Event = Event>(\n\tnode: any,\n\ttype: string,\n\thandler: (event: R) => void,\n\teventMerger?: IEventMerger<R, E>,\n\tminimumTimeMs?: number,\n): IDisposable {\n\treturn new TimeoutThrottledDomListener<R, E>(\n\t\tnode,\n\t\ttype,\n\t\thandler,\n\t\teventMerger,\n\t\tminimumTimeMs,\n\t);\n}\n\nexport function getComputedStyle(el: HTMLElement): CSSStyleDeclaration {\n\treturn getWindow(el).getComputedStyle(el, null);\n}\n\nexport function getClientArea(\n\telement: HTMLElement,\n\tfallback?: HTMLElement,\n): Dimension {\n\tconst elWindow = getWindow(element);\n\tconst elDocument = elWindow.document;\n\n\t// Try with DOM clientWidth / clientHeight\n\tif (element !== elDocument.body) {\n\t\treturn new Dimension(element.clientWidth, element.clientHeight);\n\t}\n\n\t// If visual view port exits and it's on mobile, it should be used instead of window innerWidth / innerHeight, or document.body.clientWidth / document.body.clientHeight\n\tif (platform.isIOS && elWindow?.visualViewport) {\n\t\treturn new Dimension(\n\t\t\telWindow.visualViewport.width,\n\t\t\telWindow.visualViewport.height,\n\t\t);\n\t}\n\n\t// Try innerWidth / innerHeight\n\tif (elWindow?.innerWidth && elWindow.innerHeight) {\n\t\treturn new Dimension(elWindow.innerWidth, elWindow.innerHeight);\n\t}\n\n\t// Try with document.body.clientWidth / document.body.clientHeight\n\tif (\n\t\telDocument.body &&\n\t\telDocument.body.clientWidth &&\n\t\telDocument.body.clientHeight\n\t) {\n\t\treturn new Dimension(\n\t\t\telDocument.body.clientWidth,\n\t\t\telDocument.body.clientHeight,\n\t\t);\n\t}\n\n\t// Try with document.documentElement.clientWidth / document.documentElement.clientHeight\n\tif (\n\t\telDocument.documentElement &&\n\t\telDocument.documentElement.clientWidth &&\n\t\telDocument.documentElement.clientHeight\n\t) {\n\t\treturn new Dimension(\n\t\t\telDocument.documentElement.clientWidth,\n\t\t\telDocument.documentElement.clientHeight,\n\t\t);\n\t}\n\n\tif (fallback) {\n\t\treturn getClientArea(fallback);\n\t}\n\n\tthrow new Error(\"Unable to figure out browser width and height\");\n}\n\nclass SizeUtils {\n\t// Adapted from WinJS\n\t// Converts a CSS positioning string for the specified element to pixels.\n\tprivate static convertToPixels(\n\t\telement: HTMLElement,\n\t\tvalue: string,\n\t): number {\n\t\treturn Number.parseFloat(value) || 0;\n\t}\n\n\tprivate static getDimension(\n\t\telement: HTMLElement,\n\t\tcssPropertyName: string,\n\t\tjsPropertyName: string,\n\t): number {\n\t\tconst computedStyle = getComputedStyle(element);\n\t\tconst value = computedStyle\n\t\t\t? computedStyle.getPropertyValue(cssPropertyName)\n\t\t\t: \"0\";\n\t\treturn SizeUtils.convertToPixels(element, value);\n\t}\n\n\tstatic getBorderLeftWidth(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(\n\t\t\telement,\n\t\t\t\"border-left-width\",\n\t\t\t\"borderLeftWidth\",\n\t\t);\n\t}\n\tstatic getBorderRightWidth(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(\n\t\t\telement,\n\t\t\t\"border-right-width\",\n\t\t\t\"borderRightWidth\",\n\t\t);\n\t}\n\tstatic getBorderTopWidth(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(\n\t\t\telement,\n\t\t\t\"border-top-width\",\n\t\t\t\"borderTopWidth\",\n\t\t);\n\t}\n\tstatic getBorderBottomWidth(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(\n\t\t\telement,\n\t\t\t\"border-bottom-width\",\n\t\t\t\"borderBottomWidth\",\n\t\t);\n\t}\n\n\tstatic getPaddingLeft(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"padding-left\", \"paddingLeft\");\n\t}\n\tstatic getPaddingRight(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"padding-right\", \"paddingRight\");\n\t}\n\tstatic getPaddingTop(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"padding-top\", \"paddingTop\");\n\t}\n\tstatic getPaddingBottom(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(\n\t\t\telement,\n\t\t\t\"padding-bottom\",\n\t\t\t\"paddingBottom\",\n\t\t);\n\t}\n\n\tstatic getMarginLeft(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"margin-left\", \"marginLeft\");\n\t}\n\tstatic getMarginTop(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"margin-top\", \"marginTop\");\n\t}\n\tstatic getMarginRight(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"margin-right\", \"marginRight\");\n\t}\n\tstatic getMarginBottom(element: HTMLElement): number {\n\t\treturn SizeUtils.getDimension(element, \"margin-bottom\", \"marginBottom\");\n\t}\n}\n\n// ----------------------------------------------------------------------------------------\n// Position & Dimension\n\nexport interface IDimension {\n\treadonly width: number;\n\treadonly height: number;\n}\n\nexport class Dimension implements IDimension {\n\tstatic readonly None = new Dimension(0, 0);\n\n\tconstructor(\n\t\treadonly width: number,\n\t\treadonly height: number,\n\t) {}\n\n\twith(width: number = this.width, height: number = this.height): Dimension {\n\t\tif (width !== this.width || height !== this.height) {\n\t\t\treturn new Dimension(width, height);\n\t\t} else {\n\t\t\treturn this;\n\t\t}\n\t}\n\n\tstatic is(obj: unknown): obj is IDimension {\n\t\treturn (\n\t\t\ttypeof obj === \"object\" &&\n\t\t\ttypeof (<IDimension>obj).height === \"number\" &&\n\t\t\ttypeof (<IDimension>obj).width === \"number\"\n\t\t);\n\t}\n\n\tstatic lift(obj: IDimension): Dimension {\n\t\tif (obj instanceof Dimension) {\n\t\t\treturn obj;\n\t\t} else {\n\t\t\treturn new Dimension(obj.width, obj.height);\n\t\t}\n\t}\n\n\tstatic equals(a: Dimension | undefined, b: Dimension | undefined): boolean {\n\t\tif (a === b) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!a || !b) {\n\t\t\treturn false;\n\t\t}\n\t\treturn a.width === b.width && a.height === b.height;\n\t}\n}\n\nexport interface IDomPosition {\n\treadonly left: number;\n\treadonly top: number;\n}\n\nexport function getTopLeftOffset(element: HTMLElement): IDomPosition {\n\t// Adapted from WinJS.Utilities.getPosition\n\t// and added borders to the mix\n\n\tlet offsetParent = element.offsetParent;\n\tlet top = element.offsetTop;\n\tlet left = element.offsetLeft;\n\n\twhile (\n\t\t(element = <HTMLElement>element.parentNode) !== null &&\n\t\telement !== element.ownerDocument.body &&\n\t\telement !== element.ownerDocument.documentElement\n\t) {\n\t\ttop -= element.scrollTop;\n\t\tconst c = isShadowRoot(element) ? null : getComputedStyle(element);\n\t\tif (c) {\n\t\t\tleft -=\n\t\t\t\tc.direction !== \"rtl\"\n\t\t\t\t\t? element.scrollLeft\n\t\t\t\t\t: -element.scrollLeft;\n\t\t}\n\n\t\tif (element === offsetParent) {\n\t\t\tleft += SizeUtils.getBorderLeftWidth(element);\n\t\t\ttop += SizeUtils.getBorderTopWidth(element);\n\t\t\ttop += element.offsetTop;\n\t\t\tleft += element.offsetLeft;\n\t\t\toffsetParent = element.offsetParent;\n\t\t}\n\t}\n\n\treturn {\n\t\tleft: left,\n\t\ttop: top,\n\t};\n}\n\nexport interface IDomNodePagePosition {\n\tleft: number;\n\ttop: number;\n\twidth: number;\n\theight: number;\n}\n\nexport function size(\n\telement: HTMLElement,\n\twidth: number | null,\n\theight: number | null,\n): void {\n\tif (typeof width === \"number\") {\n\t\telement.style.width = `${width}px`;\n\t}\n\n\tif (typeof height === \"number\") {\n\t\telement.style.height = `${height}px`;\n\t}\n}\n\nexport function position(\n\telement: HTMLElement,\n\ttop: number,\n\tright?: number,\n\tbottom?: number,\n\tleft?: number,\n\tposition = \"absolute\",\n): void {\n\tif (typeof top === \"number\") {\n\t\telement.style.top = `${top}px`;\n\t}\n\n\tif (typeof right === \"number\") {\n\t\telement.style.right = `${right}px`;\n\t}\n\n\tif (typeof bottom === \"number\") {\n\t\telement.style.bottom = `${bottom}px`;\n\t}\n\n\tif (typeof left === \"number\") {\n\t\telement.style.left = `${left}px`;\n\t}\n\n\telement.style.position = position;\n}\n\n/**\n * Returns the position of a dom node relative to the entire page.\n */\nexport function getDomNodePagePosition(\n\tdomNode: HTMLElement,\n): IDomNodePagePosition {\n\tconst bb = domNode.getBoundingClientRect();\n\tconst window = getWindow(domNode);\n\treturn {\n\t\tleft: bb.left + window.scrollX,\n\t\ttop: bb.top + window.scrollY,\n\t\twidth: bb.width,\n\t\theight: bb.height,\n\t};\n}\n\n/**\n * Returns the effective zoom on a given element before window zoom level is applied\n */\nexport function getDomNodeZoomLevel(domNode: HTMLElement): number {\n\tlet testElement: HTMLElement | null = domNode;\n\tlet zoom = 1.0;\n\tdo {\n\t\tconst elementZoomLevel = (getComputedStyle(testElement) as any).zoom;\n\t\tif (\n\t\t\telementZoomLevel !== null &&\n\t\t\telementZoomLevel !== undefined &&\n\t\t\telementZoomLevel !== \"1\"\n\t\t) {\n\t\t\tzoom *= elementZoomLevel;\n\t\t}\n\n\t\ttestElement = testElement.parentElement;\n\t} while (\n\t\ttestElement !== null &&\n\t\ttestElement !== testElement.ownerDocument.documentElement\n\t);\n\n\treturn zoom;\n}\n\n// Adapted from WinJS\n// Gets the width of the element, including margins.\nexport function getTotalWidth(element: HTMLElement): number {\n\tconst margin =\n\t\tSizeUtils.getMarginLeft(element) + SizeUtils.getMarginRight(element);\n\treturn element.offsetWidth + margin;\n}\n\nexport function getContentWidth(element: HTMLElement): number {\n\tconst border =\n\t\tSizeUtils.getBorderLeftWidth(element) +\n\t\tSizeUtils.getBorderRightWidth(element);\n\tconst padding =\n\t\tSizeUtils.getPaddingLeft(element) + SizeUtils.getPaddingRight(element);\n\treturn element.offsetWidth - border - padding;\n}\n\nexport function getTotalScrollWidth(element: HTMLElement): number {\n\tconst margin =\n\t\tSizeUtils.getMarginLeft(element) + SizeUtils.getMarginRight(element);\n\treturn element.scrollWidth + margin;\n}\n\n// Adapted from WinJS\n// Gets the height of the content of the specified element. The content height does not include borders or padding.\nexport function getContentHeight(element: HTMLElement): number {\n\tconst border =\n\t\tSizeUtils.getBorderTopWidth(element) +\n\t\tSizeUtils.getBorderBottomWidth(element);\n\tconst padding =\n\t\tSizeUtils.getPaddingTop(element) + SizeUtils.getPaddingBottom(element);\n\treturn element.offsetHeight - border - padding;\n}\n\n// Adapted from WinJS\n// Gets the height of the element, including its margins.\nexport function getTotalHeight(element: HTMLElement): number {\n\tconst margin =\n\t\tSizeUtils.getMarginTop(element) + SizeUtils.getMarginBottom(element);\n\treturn element.offsetHeight + margin;\n}\n\n// Gets the left coordinate of the specified element relative to the specified parent.\nfunction getRelativeLeft(element: HTMLElement, parent: HTMLElement): number {\n\tif (element === null) {\n\t\treturn 0;\n\t}\n\n\tconst elementPosition = getTopLeftOffset(element);\n\tconst parentPosition = getTopLeftOffset(parent);\n\treturn elementPosition.left - parentPosition.left;\n}\n\nexport function getLargestChildWidth(\n\tparent: HTMLElement,\n\tchildren: HTMLElement[],\n): number {\n\tconst childWidths = children.map((child) => {\n\t\treturn (\n\t\t\tMath.max(getTotalScrollWidth(child), getTotalWidth(child)) +\n\t\t\t\tgetRelativeLeft(child, parent) || 0\n\t\t);\n\t});\n\tconst maxWidth = Math.max(...childWidths);\n\treturn maxWidth;\n}\n\n// ----------------------------------------------------------------------------------------\n\nexport function isAncestor(\n\ttestChild: Node | null,\n\ttestAncestor: Node | null,\n): boolean {\n\treturn Boolean(testAncestor?.contains(testChild));\n}\n\nconst parentFlowToDataKey = \"parentFlowToElementId\";\n\n/**\n * Set an explicit parent to use for nodes that are not part of the\n * regular dom structure.\n */\nexport function setParentFlowTo(\n\tfromChildElement: HTMLElement,\n\ttoParentElement: Element,\n): void {\n\tfromChildElement.dataset[parentFlowToDataKey] = toParentElement.id;\n}\n\nfunction getParentFlowToElement(node: HTMLElement): HTMLElement | null {\n\tconst flowToParentId = node.dataset[parentFlowToDataKey];\n\tif (typeof flowToParentId === \"string\") {\n\t\treturn node.ownerDocument.getElementById(flowToParentId);\n\t}\n\treturn null;\n}\n\n/**\n * Check if `testAncestor` is an ancestor of `testChild`, observing the explicit\n * parents set by `setParentFlowTo`.\n */\nexport function isAncestorUsingFlowTo(\n\ttestChild: Node,\n\ttestAncestor: Node,\n): boolean {\n\tlet node: Node | null = testChild;\n\twhile (node) {\n\t\tif (node === testAncestor) {\n\t\t\treturn true;\n\t\t}\n\n\t\tif (isHTMLElement(node)) {\n\t\t\tconst flowToParentElement = getParentFlowToElement(node);\n\t\t\tif (flowToParentElement) {\n\t\t\t\tnode = flowToParentElement;\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\t\tnode = node.parentNode;\n\t}\n\n\treturn false;\n}\n\nexport function findParentWithClass(\n\tnode: HTMLElement,\n\tclazz: string,\n\tstopAtClazzOrNode?: string | HTMLElement,\n): HTMLElement | null {\n\twhile (node && node.nodeType === node.ELEMENT_NODE) {\n\t\tif (node.classList.contains(clazz)) {\n\t\t\treturn node;\n\t\t}\n\n\t\tif (stopAtClazzOrNode) {\n\t\t\tif (typeof stopAtClazzOrNode === \"string\") {\n\t\t\t\tif (node.classList.contains(stopAtClazzOrNode)) {\n\t\t\t\t\treturn null;\n\t\t\t\t}\n\t\t\t} else if (node === stopAtClazzOrNode) {\n\t\t\t\treturn null;\n\t\t\t}\n\t\t}\n\n\t\tnode = <HTMLElement>node.parentNode;\n\t}\n\n\treturn null;\n}\n\nexport function hasParentWithClass(\n\tnode: HTMLElement,\n\tclazz: string,\n\tstopAtClazzOrNode?: string | HTMLElement,\n): boolean {\n\treturn !!findParentWithClass(node, clazz, stopAtClazzOrNode);\n}\n\nexport function isShadowRoot(node: Node): node is ShadowRoot {\n\treturn node && !!(<ShadowRoot>node).host && !!(<ShadowRoot>node).mode;\n}\n\nexport function isInShadowDOM(domNode: Node): boolean {\n\treturn !!getShadowRoot(domNode);\n}\n\nexport function getShadowRoot(domNode: Node): ShadowRoot | null {\n\twhile (domNode.parentNode) {\n\t\tif (domNode === domNode.ownerDocument?.body) {\n\t\t\t// reached the body\n\t\t\treturn null;\n\t\t}\n\t\tdomNode = domNode.parentNode;\n\t}\n\treturn isShadowRoot(domNode) ? domNode : null;\n}\n\n/**\n * Returns the active element across all child windows\n * based on document focus. Falls back to the main\n * window if no window has focus.\n */\nexport function getActiveElement(): Element | null {\n\tlet result = getActiveDocument().activeElement;\n\n\twhile (result?.shadowRoot) {\n\t\tresult = result.shadowRoot.activeElement;\n\t}\n\n\treturn result;\n}\n\n/**\n * Returns true if the focused window active element matches\n * the provided element. Falls back to the main window if no\n * window has focus.\n */\nexport function isActiveElement(element: Element): boolean {\n\treturn getActiveElement() === element;\n}\n\n/**\n * Returns true if the focused window active element is contained in\n * `ancestor`. Falls back to the main window if no window has focus.\n */\nexport function isAncestorOfActiveElement(ancestor: Element): boolean {\n\treturn isAncestor(getActiveElement(), ancestor);\n}\n\n/**\n * Returns whether the element is in the active `document`. The active\n * document has focus or will be the main windows document.\n */\nexport function isActiveDocument(element: Element): boolean {\n\treturn element.ownerDocument === getActiveDocument();\n}\n\n/**\n * Returns the active document across main and child windows.\n * Prefers the window with focus, otherwise falls back to\n * the main windows document.\n */\nexport function getActiveDocument(): Document {\n\tif (getWindowsCount() <= 1) {\n\t\treturn mainWindow.document;\n\t}\n\n\tconst documents = Array.from(getWindows()).map(\n\t\t({ window }) => window.document,\n\t);\n\treturn documents.find((doc) => doc.hasFocus()) ?? mainWindow.document;\n}\n\n/**\n * Returns the active window across main and child windows.\n * Prefers the window with focus, otherwise falls back to\n * the main window.\n */\nexport function getActiveWindow(): CodeWindow {\n\tconst document = getActiveDocument();\n\treturn (document.defaultView?.window ?? mainWindow) as CodeWindow;\n}\n\nconst globalStylesheets = new Map<\n\tHTMLStyleElement /* main stylesheet */,\n\tSet<HTMLStyleElement /* aux window clones that track the main stylesheet */>\n>();\n\nexport function isGlobalStylesheet(node: Node): boolean {\n\treturn globalStylesheets.has(node as HTMLStyleElement);\n}\n\n/**\n * A version of createStyleSheet which has a unified API to initialize/set the style content.\n */\nexport function createStyleSheet2(): WrappedStyleElement {\n\treturn new WrappedStyleElement();\n}\n\nclass WrappedStyleElement {\n\tprivate _currentCssStyle = \"\";\n\tprivate _styleSheet: HTMLStyleElement | undefined = undefined;\n\n\tpublic setStyle(cssStyle: string): void {\n\t\tif (cssStyle === this._currentCssStyle) {\n\t\t\treturn;\n\t\t}\n\t\tthis._currentCssStyle = cssStyle;\n\n\t\tif (this._styleSheet) {\n\t\t\tthis._styleSheet.innerText = cssStyle;\n\t\t} else {\n\t\t\tthis._styleSheet = createStyleSheet(\n\t\t\t\tmainWindow.document.head,\n\t\t\t\t(s) => (s.innerText = cssStyle),\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._styleSheet) {\n\t\t\tthis._styleSheet.remove();\n\t\t\tthis._styleSheet = undefined;\n\t\t}\n\t}\n}\n\nexport function createStyleSheet(\n\tcontainer: HTMLElement = mainWindow.document.head,\n\tbeforeAppend?: (style: HTMLStyleElement) => void,\n\tdisposableStore?: DisposableStore,\n): HTMLStyleElement {\n\tconst style = document.createElement(\"style\");\n\tstyle.type = \"text/css\";\n\tstyle.media = \"screen\";\n\tbeforeAppend?.(style);\n\tcontainer.appendChild(style);\n\n\tif (disposableStore) {\n\t\tdisposableStore.add(toDisposable(() => style.remove()));\n\t}\n\n\t// With <head> as container, the stylesheet becomes global and is tracked\n\t// to support auxiliary windows to clone the stylesheet.\n\tif (container === mainWindow.document.head) {\n\t\tconst globalStylesheetClones = new Set<HTMLStyleElement>();\n\t\tglobalStylesheets.set(style, globalStylesheetClones);\n\n\t\tfor (const { window: targetWindow, disposables } of getWindows()) {\n\t\t\tif (targetWindow === mainWindow) {\n\t\t\t\tcontinue; // main window is already tracked\n\t\t\t}\n\n\t\t\tconst cloneDisposable = disposables.add(\n\t\t\t\tcloneGlobalStyleSheet(\n\t\t\t\t\tstyle,\n\t\t\t\t\tglobalStylesheetClones,\n\t\t\t\t\ttargetWindow,\n\t\t\t\t),\n\t\t\t);\n\t\t\tdisposableStore?.add(cloneDisposable);\n\t\t}\n\t}\n\n\treturn style;\n}\n\nexport function cloneGlobalStylesheets(targetWindow: Window): IDisposable {\n\tconst disposables = new DisposableStore();\n\n\tfor (const [\n\t\tglobalStylesheet,\n\t\tclonedGlobalStylesheets,\n\t] of globalStylesheets) {\n\t\tdisposables.add(\n\t\t\tcloneGlobalStyleSheet(\n\t\t\t\tglobalStylesheet,\n\t\t\t\tclonedGlobalStylesheets,\n\t\t\t\ttargetWindow,\n\t\t\t),\n\t\t);\n\t}\n\n\treturn disposables;\n}\n\nfunction cloneGlobalStyleSheet(\n\tglobalStylesheet: HTMLStyleElement,\n\tglobalStylesheetClones: Set<HTMLStyleElement>,\n\ttargetWindow: Window,\n): IDisposable {\n\tconst disposables = new DisposableStore();\n\n\tconst clone = globalStylesheet.cloneNode(true) as HTMLStyleElement;\n\ttargetWindow.document.head.appendChild(clone);\n\tdisposables.add(toDisposable(() => clone.remove()));\n\n\tfor (const rule of getDynamicStyleSheetRules(globalStylesheet)) {\n\t\tclone.sheet?.insertRule(rule.cssText, clone.sheet?.cssRules.length);\n\t}\n\n\tdisposables.add(\n\t\tsharedMutationObserver.observe(globalStylesheet, disposables, {\n\t\t\tchildList: true,\n\t\t})(() => {\n\t\t\tclone.textContent = globalStylesheet.textContent;\n\t\t}),\n\t);\n\n\tglobalStylesheetClones.add(clone);\n\tdisposables.add(toDisposable(() => globalStylesheetClones.delete(clone)));\n\n\treturn disposables;\n}\n\ninterface IMutationObserver {\n\tusers: number;\n\treadonly observer: MutationObserver;\n\treadonly onDidMutate: event.Event<MutationRecord[]>;\n}\n\nexport const sharedMutationObserver = new (class {\n\treadonly mutationObservers = new Map<\n\t\tNode,\n\t\tMap<number, IMutationObserver>\n\t>();\n\n\tobserve(\n\t\ttarget: Node,\n\t\tdisposables: DisposableStore,\n\t\toptions?: MutationObserverInit,\n\t): event.Event<MutationRecord[]> {\n\t\tlet mutationObserversPerTarget = this.mutationObservers.get(target);\n\t\tif (!mutationObserversPerTarget) {\n\t\t\tmutationObserversPerTarget = new Map<number, IMutationObserver>();\n\t\t\tthis.mutationObservers.set(target, mutationObserversPerTarget);\n\t\t}\n\n\t\tconst optionsHash = hash(options);\n\t\tlet mutationObserverPerOptions =\n\t\t\tmutationObserversPerTarget.get(optionsHash);\n\t\tif (mutationObserverPerOptions) {\n\t\t\tmutationObserverPerOptions.users += 1;\n\t\t} else {\n\t\t\tconst onDidMutate = new event.Emitter<MutationRecord[]>();\n\t\t\tconst observer = new MutationObserver((mutations) =>\n\t\t\t\tonDidMutate.fire(mutations),\n\t\t\t);\n\t\t\tobserver.observe(target, options);\n\n\t\t\tconst resolvedMutationObserverPerOptions =\n\t\t\t\t(mutationObserverPerOptions = {\n\t\t\t\t\tusers: 1,\n\t\t\t\t\tobserver,\n\t\t\t\t\tonDidMutate: onDidMutate.event,\n\t\t\t\t});\n\n\t\t\tdisposables.add(\n\t\t\t\ttoDisposable(() => {\n\t\t\t\t\tresolvedMutationObserverPerOptions.users -= 1;\n\n\t\t\t\t\tif (resolvedMutationObserverPerOptions.users === 0) {\n\t\t\t\t\t\tonDidMutate.dispose();\n\t\t\t\t\t\tobserver.disconnect();\n\n\t\t\t\t\t\tmutationObserversPerTarget?.delete(optionsHash);\n\t\t\t\t\t\tif (mutationObserversPerTarget?.size === 0) {\n\t\t\t\t\t\t\tthis.mutationObservers.delete(target);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tmutationObserversPerTarget.set(\n\t\t\t\toptionsHash,\n\t\t\t\tmutationObserverPerOptions,\n\t\t\t);\n\t\t}\n\n\t\treturn mutationObserverPerOptions.onDidMutate;\n\t}\n})();\n\nexport function createMetaElement(\n\tcontainer: HTMLElement = mainWindow.document.head,\n): HTMLMetaElement {\n\treturn createHeadElement(\"meta\", container) as HTMLMetaElement;\n}\n\nexport function createLinkElement(\n\tcontainer: HTMLElement = mainWindow.document.head,\n): HTMLLinkElement {\n\treturn createHeadElement(\"link\", container) as HTMLLinkElement;\n}\n\nfunction createHeadElement(\n\ttagName: string,\n\tcontainer: HTMLElement = mainWindow.document.head,\n): HTMLElement {\n\tconst element = document.createElement(tagName);\n\tcontainer.appendChild(element);\n\treturn element;\n}\n\nlet _sharedStyleSheet: HTMLStyleElement | null = null;\nfunction getSharedStyleSheet(): HTMLStyleElement {\n\tif (!_sharedStyleSheet) {\n\t\t_sharedStyleSheet = createStyleSheet();\n\t}\n\treturn _sharedStyleSheet;\n}\n\nfunction getDynamicStyleSheetRules(style: HTMLStyleElement) {\n\tif (style?.sheet?.rules) {\n\t\t// Chrome, IE\n\t\treturn style.sheet.rules;\n\t}\n\tif (style?.sheet?.cssRules) {\n\t\t// FF\n\t\treturn style.sheet.cssRules;\n\t}\n\treturn [];\n}\n\nexport function createCSSRule(\n\tselector: string,\n\tcssText: string,\n\tstyle = getSharedStyleSheet(),\n): void {\n\tif (!style || !cssText) {\n\t\treturn;\n\t}\n\n\tstyle.sheet?.insertRule(`${selector} {${cssText}}`, 0);\n\n\t// Apply rule also to all cloned global stylesheets\n\tfor (const clonedGlobalStylesheet of globalStylesheets.get(style) ?? []) {\n\t\tcreateCSSRule(selector, cssText, clonedGlobalStylesheet);\n\t}\n}\n\nexport function removeCSSRulesContainingSelector(\n\truleName: string,\n\tstyle = getSharedStyleSheet(),\n): void {\n\tif (!style) {\n\t\treturn;\n\t}\n\n\tconst rules = getDynamicStyleSheetRules(style);\n\tconst toDelete: number[] = [];\n\tfor (let i = 0; i < rules.length; i++) {\n\t\tconst rule = rules[i];\n\t\tif (\n\t\t\tisCSSStyleRule(rule) &&\n\t\t\trule.selectorText.indexOf(ruleName) !== -1\n\t\t) {\n\t\t\ttoDelete.push(i);\n\t\t}\n\t}\n\n\tfor (let i = toDelete.length - 1; i >= 0; i--) {\n\t\tstyle.sheet?.deleteRule(toDelete[i]);\n\t}\n\n\t// Remove rules also from all cloned global stylesheets\n\tfor (const clonedGlobalStylesheet of globalStylesheets.get(style) ?? []) {\n\t\tremoveCSSRulesContainingSelector(ruleName, clonedGlobalStylesheet);\n\t}\n}\n\nfunction isCSSStyleRule(rule: CSSRule): rule is CSSStyleRule {\n\treturn typeof (rule as CSSStyleRule).selectorText === \"string\";\n}\n\nexport function isHTMLElement(e: unknown): e is HTMLElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLElement ||\n\t\te instanceof getWindow(e as Node).HTMLElement\n\t);\n}\n\nexport function isHTMLAnchorElement(e: unknown): e is HTMLAnchorElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLAnchorElement ||\n\t\te instanceof getWindow(e as Node).HTMLAnchorElement\n\t);\n}\n\nexport function isHTMLSpanElement(e: unknown): e is HTMLSpanElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLSpanElement ||\n\t\te instanceof getWindow(e as Node).HTMLSpanElement\n\t);\n}\n\nexport function isHTMLTextAreaElement(e: unknown): e is HTMLTextAreaElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLTextAreaElement ||\n\t\te instanceof getWindow(e as Node).HTMLTextAreaElement\n\t);\n}\n\nexport function isHTMLInputElement(e: unknown): e is HTMLInputElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLInputElement ||\n\t\te instanceof getWindow(e as Node).HTMLInputElement\n\t);\n}\n\nexport function isHTMLButtonElement(e: unknown): e is HTMLButtonElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLButtonElement ||\n\t\te instanceof getWindow(e as Node).HTMLButtonElement\n\t);\n}\n\nexport function isHTMLDivElement(e: unknown): e is HTMLDivElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof HTMLDivElement ||\n\t\te instanceof getWindow(e as Node).HTMLDivElement\n\t);\n}\n\nexport function isSVGElement(e: unknown): e is SVGElement {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof SVGElement || e instanceof getWindow(e as Node).SVGElement\n\t);\n}\n\nexport function isMouseEvent(e: unknown): e is MouseEvent {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof MouseEvent ||\n\t\te instanceof getWindow(e as UIEvent).MouseEvent\n\t);\n}\n\nexport function isKeyboardEvent(e: unknown): e is KeyboardEvent {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof KeyboardEvent ||\n\t\te instanceof getWindow(e as UIEvent).KeyboardEvent\n\t);\n}\n\nexport function isPointerEvent(e: unknown): e is PointerEvent {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof PointerEvent ||\n\t\te instanceof getWindow(e as UIEvent).PointerEvent\n\t);\n}\n\nexport function isDragEvent(e: unknown): e is DragEvent {\n\t// eslint-disable-next-line no-restricted-syntax\n\treturn (\n\t\te instanceof DragEvent || e instanceof getWindow(e as UIEvent).DragEvent\n\t);\n}\n\nexport const EventType = {\n\t// Mouse\n\tCLICK: \"click\",\n\tAUXCLICK: \"auxclick\",\n\tDBLCLICK: \"dblclick\",\n\tMOUSE_UP: \"mouseup\",\n\tMOUSE_DOWN: \"mousedown\",\n\tMOUSE_OVER: \"mouseover\",\n\tMOUSE_MOVE: \"mousemove\",\n\tMOUSE_OUT: \"mouseout\",\n\tMOUSE_ENTER: \"mouseenter\",\n\tMOUSE_LEAVE: \"mouseleave\",\n\tMOUSE_WHEEL: \"wheel\",\n\tPOINTER_UP: \"pointerup\",\n\tPOINTER_DOWN: \"pointerdown\",\n\tPOINTER_MOVE: \"pointermove\",\n\tPOINTER_LEAVE: \"pointerleave\",\n\tCONTEXT_MENU: \"contextmenu\",\n\tWHEEL: \"wheel\",\n\t// Keyboard\n\tKEY_DOWN: \"keydown\",\n\tKEY_PRESS: \"keypress\",\n\tKEY_UP: \"keyup\",\n\t// HTML Document\n\tLOAD: \"load\",\n\tBEFORE_UNLOAD: \"beforeunload\",\n\tUNLOAD: \"unload\",\n\tPAGE_SHOW: \"pageshow\",\n\tPAGE_HIDE: \"pagehide\",\n\tPASTE: \"paste\",\n\tABORT: \"abort\",\n\tERROR: \"error\",\n\tRESIZE: \"resize\",\n\tSCROLL: \"scroll\",\n\tFULLSCREEN_CHANGE: \"fullscreenchange\",\n\tWK_FULLSCREEN_CHANGE: \"webkitfullscreenchange\",\n\t// Form\n\tSELECT: \"select\",\n\tCHANGE: \"change\",\n\tSUBMIT: \"submit\",\n\tRESET: \"reset\",\n\tFOCUS: \"focus\",\n\tFOCUS_IN: \"focusin\",\n\tFOCUS_OUT: \"focusout\",\n\tBLUR: \"blur\",\n\tINPUT: \"input\",\n\t// Local Storage\n\tSTORAGE: \"storage\",\n\t// Drag\n\tDRAG_START: \"dragstart\",\n\tDRAG: \"drag\",\n\tDRAG_ENTER: \"dragenter\",\n\tDRAG_LEAVE: \"dragleave\",\n\tDRAG_OVER: \"dragover\",\n\tDROP: \"drop\",\n\tDRAG_END: \"dragend\",\n\t// Animation\n\tANIMATION_START: browser.isWebKit\n\t\t? \"webkitAnimationStart\"\n\t\t: \"animationstart\",\n\tANIMATION_END: browser.isWebKit ? \"webkitAnimationEnd\" : \"animationend\",\n\tANIMATION_ITERATION: browser.isWebKit\n\t\t? \"webkitAnimationIteration\"\n\t\t: \"animationiteration\",\n} as const;\n\nexport interface EventLike {\n\tpreventDefault(): void;\n\tstopPropagation(): void;\n}\n\nexport function isEventLike(obj: unknown): obj is EventLike {\n\tconst candidate = obj as EventLike | undefined;\n\n\treturn !!(\n\t\tcandidate &&\n\t\ttypeof candidate.preventDefault === \"function\" &&\n\t\ttypeof candidate.stopPropagation === \"function\"\n\t);\n}\n\nexport const EventHelper = {\n\tstop: <T extends EventLike>(e: T, cancelBubble?: boolean): T => {\n\t\te.preventDefault();\n\t\tif (cancelBubble) {\n\t\t\te.stopPropagation();\n\t\t}\n\t\treturn e;\n\t},\n};\n\nexport interface IFocusTracker extends Disposable {\n\treadonly onDidFocus: event.Event<void>;\n\treadonly onDidBlur: event.Event<void>;\n\trefreshState(): void;\n}\n\nexport function saveParentsScrollTop(node: Element): number[] {\n\tconst r: number[] = [];\n\tfor (let i = 0; node && node.nodeType === node.ELEMENT_NODE; i++) {\n\t\tr[i] = node.scrollTop;\n\t\tnode = <Element>node.parentNode;\n\t}\n\treturn r;\n}\n\nexport function restoreParentsScrollTop(node: Element, state: number[]): void {\n\tfor (let i = 0; node && node.nodeType === node.ELEMENT_NODE; i++) {\n\t\tif (node.scrollTop !== state[i]) {\n\t\t\tnode.scrollTop = state[i];\n\t\t}\n\t\tnode = <Element>node.parentNode;\n\t}\n}\n\nclass FocusTracker extends Disposable implements IFocusTracker {\n\tprivate readonly _onDidFocus = this._register(new event.Emitter<void>());\n\treadonly onDidFocus = this._onDidFocus.event;\n\n\tprivate readonly _onDidBlur = this._register(new event.Emitter<void>());\n\treadonly onDidBlur = this._onDidBlur.event;\n\n\tprivate _refreshStateHandler: () => void;\n\n\tprivate static hasFocusWithin(element: HTMLElement | Window): boolean {\n\t\tif (isHTMLElement(element)) {\n\t\t\tconst shadowRoot = getShadowRoot(element);\n\t\t\tconst activeElement = shadowRoot\n\t\t\t\t? shadowRoot.activeElement\n\t\t\t\t: element.ownerDocument.activeElement;\n\t\t\treturn isAncestor(activeElement, element);\n\t\t} else {\n\t\t\tconst window = element;\n\t\t\treturn isAncestor(window.document.activeElement, window.document);\n\t\t}\n\t}\n\n\tconstructor(element: HTMLElement | Window) {\n\t\tsuper();\n\t\tlet hasFocus = FocusTracker.hasFocusWithin(element);\n\t\tlet loosingFocus = false;\n\n\t\tconst onFocus = () => {\n\t\t\tloosingFocus = false;\n\t\t\tif (!hasFocus) {\n\t\t\t\thasFocus = true;\n\t\t\t\tthis._onDidFocus.fire();\n\t\t\t}\n\t\t};\n\n\t\tconst onBlur = () => {\n\t\t\tif (hasFocus) {\n\t\t\t\tloosingFocus = true;\n\t\t\t\t(isHTMLElement(element)\n\t\t\t\t\t? getWindow(element)\n\t\t\t\t\t: element\n\t\t\t\t).setTimeout(() => {\n\t\t\t\t\tif (loosingFocus) {\n\t\t\t\t\t\tloosingFocus = false;\n\t\t\t\t\t\thasFocus = false;\n\t\t\t\t\t\tthis._onDidBlur.fire();\n\t\t\t\t\t}\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t};\n\n\t\tthis._refreshStateHandler = () => {\n\t\t\tconst currentNodeHasFocus = FocusTracker.hasFocusWithin(\n\t\t\t\t<HTMLElement>element,\n\t\t\t);\n\t\t\tif (currentNodeHasFocus !== hasFocus) {\n\t\t\t\tif (hasFocus) {\n\t\t\t\t\tonBlur();\n\t\t\t\t} else {\n\t\t\t\t\tonFocus();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._register(\n\t\t\taddDisposableListener(element, EventType.FOCUS, onFocus, true),\n\t\t);\n\t\tthis._register(\n\t\t\taddDisposableListener(element, EventType.BLUR, onBlur, true),\n\t\t);\n\t\tif (isHTMLElement(element)) {\n\t\t\tthis._register(\n\t\t\t\taddDisposableListener(element, EventType.FOCUS_IN, () =>\n\t\t\t\t\tthis._refreshStateHandler(),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._register(\n\t\t\t\taddDisposableListener(element, EventType.FOCUS_OUT, () =>\n\t\t\t\t\tthis._refreshStateHandler(),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t}\n\n\trefreshState() {\n\t\tthis._refreshStateHandler();\n\t}\n}\n\n/**\n * Creates a new `IFocusTracker` instance that tracks focus changes on the given `element` and its descendants.\n *\n * @param element The `HTMLElement` or `Window` to track focus changes on.\n * @returns An `IFocusTracker` instance.\n */\nexport function trackFocus(element: HTMLElement | Window): IFocusTracker {\n\treturn new FocusTracker(element);\n}\n\nexport function after<T extends Node>(sibling: HTMLElement, child: T): T {\n\tsibling.after(child);\n\treturn child;\n}\n\nexport function append<T extends Node>(parent: HTMLElement, child: T): T;\nexport function append<T extends Node>(\n\tparent: HTMLElement,\n\t...children: (T | string)[]\n): void;\nexport function append<T extends Node>(\n\tparent: HTMLElement,\n\t...children: (T | string)[]\n): T | void {\n\tparent.append(...children);\n\tif (children.length === 1 && typeof children[0] !== \"string\") {\n\t\treturn <T>children[0];\n\t}\n}\n\nexport function prepend<T extends Node>(parent: HTMLElement, child: T): T {\n\tparent.insertBefore(child, parent.firstChild);\n\treturn child;\n}\n\n/**\n * Removes all children from `parent` and appends `children`\n */\nexport function reset(\n\tparent: HTMLElement,\n\t...children: Array<Node | string>\n): void {\n\tparent.innerText = \"\";\n\tappend(parent, ...children);\n}\n\nconst SELECTOR_REGEX = /([\\w-]+)?(#([\\w-]+))?((\\.([\\w-]+))*)/;\n\nexport enum Namespace {\n\tHTML = \"http://www.w3.org/1999/xhtml\",\n\tSVG = \"http://www.w3.org/2000/svg\",\n}\n\nfunction _$<T extends Element>(\n\tnamespace: Namespace,\n\tdescription: string,\n\tattrs?: { [key: string]: any },\n\t...children: Array<Node | string>\n): T {\n\tconst match = SELECTOR_REGEX.exec(description);\n\n\tif (!match) {\n\t\tthrow new Error(\"Bad use of emmet\");\n\t}\n\n\tconst tagName = match[1] || \"div\";\n\tlet result: T;\n\n\tif (namespace !== Namespace.HTML) {\n\t\tresult = document.createElementNS(namespace as string, tagName) as T;\n\t} else {\n\t\tresult = document.createElement(tagName) as unknown as T;\n\t}\n\n\tif (match[3]) {\n\t\tresult.id = match[3];\n\t}\n\tif (match[4]) {\n\t\tresult.className = match[4].replace(/\\./g, \" \").trim();\n\t}\n\n\tif (attrs) {\n\t\tObject.entries(attrs).forEach(([name, value]) => {\n\t\t\tif (typeof value === \"undefined\") {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (/^on\\w+$/.test(name)) {\n\t\t\t\t(<any>result)[name] = value;\n\t\t\t} else if (name === \"selected\") {\n\t\t\t\tif (value) {\n\t\t\t\t\tresult.setAttribute(name, \"true\");\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tresult.setAttribute(name, value);\n\t\t\t}\n\t\t});\n\t}\n\n\tresult.append(...children);\n\n\treturn result as T;\n}\n\nexport function $<T extends HTMLElement>(\n\tdescription: string,\n\tattrs?: { [key: string]: any },\n\t...children: Array<Node | string>\n): T {\n\treturn _$(Namespace.HTML, description, attrs, ...children);\n}\n\n$.SVG = <T extends SVGElement>(\n\tdescription: string,\n\tattrs?: { [key: string]: any },\n\t...children: Array<Node | string>\n): T => _$(Namespace.SVG, description, attrs, ...children);\n\nexport function join(nodes: Node[], separator: Node | string): Node[] {\n\tconst result: Node[] = [];\n\n\tnodes.forEach((node, index) => {\n\t\tif (index > 0) {\n\t\t\tif (separator instanceof Node) {\n\t\t\t\tresult.push(separator.cloneNode());\n\t\t\t} else {\n\t\t\t\tresult.push(document.createTextNode(separator));\n\t\t\t}\n\t\t}\n\n\t\tresult.push(node);\n\t});\n\n\treturn result;\n}\n\nexport function setVisibility(\n\tvisible: boolean,\n\t...elements: HTMLElement[]\n): void {\n\tif (visible) {\n\t\tshow(...elements);\n\t} else {\n\t\thide(...elements);\n\t}\n}\n\nexport function show(...elements: HTMLElement[]): void {\n\tfor (const element of elements) {\n\t\telement.style.display = \"\";\n\t\telement.removeAttribute(\"aria-hidden\");\n\t}\n}\n\nexport function hide(...elements: HTMLElement[]): void {\n\tfor (const element of elements) {\n\t\telement.style.display = \"none\";\n\t\telement.setAttribute(\"aria-hidden\", \"true\");\n\t}\n}\n\nfunction findParentWithAttribute(\n\tnode: Node | null,\n\tattribute: string,\n): HTMLElement | null {\n\twhile (node && node.nodeType === node.ELEMENT_NODE) {\n\t\tif (isHTMLElement(node) && node.hasAttribute(attribute)) {\n\t\t\treturn node;\n\t\t}\n\n\t\tnode = node.parentNode;\n\t}\n\n\treturn null;\n}\n\nexport function removeTabIndexAndUpdateFocus(node: HTMLElement): void {\n\tif (!node || !node.hasAttribute(\"tabIndex\")) {\n\t\treturn;\n\t}\n\n\t// If we are the currently focused element and tabIndex is removed,\n\t// standard DOM behavior is to move focus to the <body> element. We\n\t// typically never want that, rather put focus to the closest element\n\t// in the hierarchy of the parent DOM nodes.\n\tif (node.ownerDocument.activeElement === node) {\n\t\tconst parentFocusable = findParentWithAttribute(\n\t\t\tnode.parentElement,\n\t\t\t\"tabIndex\",\n\t\t);\n\t\tparentFocusable?.focus();\n\t}\n\n\tnode.removeAttribute(\"tabindex\");\n}\n\nexport function finalHandler<T extends Event>(\n\tfn: (event: T) => any,\n): (event: T) => any {\n\treturn (e) => {\n\t\te.preventDefault();\n\t\te.stopPropagation();\n\t\tfn(e);\n\t};\n}\n\nexport function domContentLoaded(targetWindow: Window): Promise<void> {\n\treturn new Promise<void>((resolve) => {\n\t\tconst readyState = targetWindow.document.readyState;\n\t\tif (\n\t\t\treadyState === \"complete\" ||\n\t\t\t(targetWindow.document && targetWindow.document.body !== null)\n\t\t) {\n\t\t\tresolve(undefined);\n\t\t} else {\n\t\t\tconst listener = () => {\n\t\t\t\ttargetWindow.window.removeEventListener(\n\t\t\t\t\t\"DOMContentLoaded\",\n\t\t\t\t\tlistener,\n\t\t\t\t\tfalse,\n\t\t\t\t);\n\t\t\t\tresolve();\n\t\t\t};\n\n\t\t\ttargetWindow.window.addEventListener(\n\t\t\t\t\"DOMContentLoaded\",\n\t\t\t\tlistener,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t}\n\t});\n}\n\n/**\n * Find a value usable for a dom node size such that the likelihood that it would be\n * displayed with constant screen pixels size is as high as possible.\n *\n * e.g. We would desire for the cursors to be 2px (CSS px) wide. Under a devicePixelRatio\n * of 1.25, the cursor will be 2.5 screen pixels wide. Depending on how the dom node aligns/\"snaps\"\n * with the screen pixels, it will sometimes be rendered with 2 screen pixels, and sometimes with 3 screen pixels.\n */\nexport function computeScreenAwareSize(window: Window, cssPx: number): number {\n\tconst screenPx = window.devicePixelRatio * cssPx;\n\treturn Math.max(1, Math.floor(screenPx)) / window.devicePixelRatio;\n}\n\n/**\n * Open safely a new window. This is the best way to do so, but you cannot tell\n * if the window was opened or if it was blocked by the browser's popup blocker.\n * If you want to tell if the browser blocked the new window, use {@link windowOpenWithSuccess}.\n *\n * See https://github.com/microsoft/monaco-editor/issues/601\n * To protect against malicious code in the linked site, particularly phishing attempts,\n * the window.opener should be set to null to prevent the linked site from having access\n * to change the location of the current page.\n * See https://mathiasbynens.github.io/rel-noopener/\n */\nexport function windowOpenNoOpener(url: string): void {\n\t// By using 'noopener' in the `windowFeatures` argument, the newly created window will\n\t// not be able to use `window.opener` to reach back to the current page.\n\t// See https://stackoverflow.com/a/46958731\n\t// See https://developer.mozilla.org/en-US/docs/Web/API/Window/open#noopener\n\t// However, this also doesn't allow us to realize if the browser blocked\n\t// the creation of the window.\n\tmainWindow.open(url, \"_blank\", \"noopener\");\n}\n\n/**\n * Open a new window in a popup. This is the best way to do so, but you cannot tell\n * if the window was opened or if it was blocked by the browser's popup blocker.\n * If you want to tell if the browser blocked the new window, use {@link windowOpenWithSuccess}.\n *\n * Note: this does not set {@link window.opener} to null. This is to allow the opened popup to\n * be able to use {@link window.close} to close itself. Because of this, you should only use\n * this function on urls that you trust.\n *\n * In otherwords, you should almost always use {@link windowOpenNoOpener} instead of this function.\n */\nconst popupWidth = 780,\n\tpopupHeight = 640;\nexport function windowOpenPopup(url: string): void {\n\tconst left = Math.floor(\n\t\tmainWindow.screenLeft + mainWindow.innerWidth / 2 - popupWidth / 2,\n\t);\n\tconst top = Math.floor(\n\t\tmainWindow.screenTop + mainWindow.innerHeight / 2 - popupHeight / 2,\n\t);\n\tmainWindow.open(\n\t\turl,\n\t\t\"_blank\",\n\t\t`width=${popupWidth},height=${popupHeight},top=${top},left=${left}`,\n\t);\n}\n\n/**\n * Attempts to open a window and returns whether it succeeded. This technique is\n * not appropriate in certain contexts, like for example when the JS context is\n * executing inside a sandboxed iframe. If it is not necessary to know if the\n * browser blocked the new window, use {@link windowOpenNoOpener}.\n *\n * See https://github.com/microsoft/monaco-editor/issues/601\n * See https://github.com/microsoft/monaco-editor/issues/2474\n * See https://mathiasbynens.github.io/rel-noopener/\n *\n * @param url the url to open\n * @param noOpener whether or not to set the {@link window.opener} to null. You should leave the default\n * (true) unless you trust the url that is being opened.\n * @returns boolean indicating if the {@link window.open} call succeeded\n */\nexport function windowOpenWithSuccess(url: string, noOpener = true): boolean {\n\tconst newTab = mainWindow.open();\n\tif (newTab) {\n\t\tif (noOpener) {\n\t\t\t// see `windowOpenNoOpener` for details on why this is important\n\t\t\t(newTab as any).opener = null;\n\t\t}\n\t\tnewTab.location.href = url;\n\t\treturn true;\n\t}\n\treturn false;\n}\n\nexport function animate(targetWindow: Window, fn: () => void): IDisposable {\n\tconst step = () => {\n\t\tfn();\n\t\tstepDisposable = scheduleAtNextAnimationFrame(targetWindow, step);\n\t};\n\n\tlet stepDisposable = scheduleAtNextAnimationFrame(targetWindow, step);\n\treturn toDisposable(() => stepDisposable.dispose());\n}\n\nRemoteAuthorities.setPreferredWebSchema(\n\t/^https:/.test(mainWindow.location.href) ? \"https\" : \"http\",\n);\n\n/**\n * returns url('...')\n */\nexport function asCSSUrl(uri: URI | null | undefined): string {\n\tif (!uri) {\n\t\treturn `url('')`;\n\t}\n\treturn `url('${FileAccess.uriToBrowserUri(uri).toString(true).replace(/'/g, \"%27\")}')`;\n}\n\nexport function asCSSPropertyValue(value: string) {\n\treturn `'${value.replace(/'/g, \"%27\")}'`;\n}\n\nexport function asCssValueWithDefault(\n\tcssPropertyValue: string | undefined,\n\tdflt: string,\n): string {\n\tif (cssPropertyValue !== undefined) {\n\t\tconst variableMatch = cssPropertyValue.match(/^\\s*var\\((.+)\\)$/);\n\t\tif (variableMatch) {\n\t\t\tconst varArguments = variableMatch[1].split(\",\", 2);\n\t\t\tif (varArguments.length === 2) {\n\t\t\t\tdflt = asCssValueWithDefault(varArguments[1].trim(), dflt);\n\t\t\t}\n\t\t\treturn `var(${varArguments[0]}, ${dflt})`;\n\t\t}\n\t\treturn cssPropertyValue;\n\t}\n\treturn dflt;\n}\n\nexport function triggerDownload(\n\tdataOrUri: Uint8Array | URI,\n\tname: string,\n): void {\n\t// If the data is provided as Buffer, we create a\n\t// blob URL out of it to produce a valid link\n\tlet url: string;\n\tif (URI.isUri(dataOrUri)) {\n\t\turl = dataOrUri.toString(true);\n\t} else {\n\t\tconst blob = new Blob([dataOrUri]);\n\t\turl = URL.createObjectURL(blob);\n\n\t\t// Ensure to free the data from DOM eventually\n\t\tsetTimeout(() => URL.revokeObjectURL(url));\n\t}\n\n\t// In order to download from the browser, the only way seems\n\t// to be creating a <a> element with download attribute that\n\t// points to the file to download.\n\t// See also https://developers.google.com/web/updates/2011/08/Downloading-resources-in-HTML5-a-download\n\tconst activeWindow = getActiveWindow();\n\tconst anchor = document.createElement(\"a\");\n\tactiveWindow.document.body.appendChild(anchor);\n\tanchor.download = name;\n\tanchor.href = url;\n\tanchor.click();\n\n\t// Ensure to remove the element from DOM eventually\n\tsetTimeout(() => anchor.remove());\n}\n\nexport function triggerUpload(): Promise<FileList | undefined> {\n\treturn new Promise<FileList | undefined>((resolve) => {\n\t\t// In order to upload to the browser, create a\n\t\t// input element of type `file` and click it\n\t\t// to gather the selected files\n\t\tconst activeWindow = getActiveWindow();\n\t\tconst input = document.createElement(\"input\");\n\t\tactiveWindow.document.body.appendChild(input);\n\t\tinput.type = \"file\";\n\t\tinput.multiple = true;\n\n\t\t// Resolve once the input event has fired once\n\t\tevent.Event.once(event.Event.fromDOMEventEmitter(input, \"input\"))(\n\t\t\t() => {\n\t\t\t\tresolve(input.files ?? undefined);\n\t\t\t},\n\t\t);\n\n\t\tinput.click();\n\n\t\t// Ensure to remove the element from DOM eventually\n\t\tsetTimeout(() => input.remove());\n\t});\n}\n\nexport enum DetectedFullscreenMode {\n\t/**\n\t * The document is fullscreen, e.g. because an element\n\t * in the document requested to be fullscreen.\n\t */\n\tDOCUMENT = 1,\n\n\t/**\n\t * The browser is fullscreen, e.g. because the user enabled\n\t * native window fullscreen for it.\n\t */\n\tBROWSER = 2,\n}\n\nexport interface IDetectedFullscreen {\n\t/**\n\t * Figure out if the document is fullscreen or the browser.\n\t */\n\tmode: DetectedFullscreenMode;\n\n\t/**\n\t * Whether we know for sure that we are in fullscreen mode or\n\t * it is a guess.\n\t */\n\tguess: boolean;\n}\n\nexport function detectFullscreen(\n\ttargetWindow: Window,\n): IDetectedFullscreen | null {\n\t// Browser fullscreen: use DOM APIs to detect\n\tif (\n\t\ttargetWindow.document.fullscreenElement ||\n\t\t(<any>targetWindow.document).webkitFullscreenElement ||\n\t\t(<any>targetWindow.document).webkitIsFullScreen\n\t) {\n\t\treturn { mode: DetectedFullscreenMode.DOCUMENT, guess: false };\n\t}\n\n\t// There is no standard way to figure out if the browser\n\t// is using native fullscreen. Via checking on screen\n\t// height and comparing that to window height, we can guess\n\t// it though.\n\n\tif (targetWindow.innerHeight === targetWindow.screen.height) {\n\t\t// if the height of the window matches the screen height, we can\n\t\t// safely assume that the browser is fullscreen because no browser\n\t\t// chrome is taking height away (e.g. like toolbars).\n\t\treturn { mode: DetectedFullscreenMode.BROWSER, guess: false };\n\t}\n\n\tif (platform.isMacintosh || platform.isLinux) {\n\t\t// macOS and Linux do not properly report `innerHeight`, only Windows does\n\t\tif (\n\t\t\ttargetWindow.outerHeight === targetWindow.screen.height &&\n\t\t\ttargetWindow.outerWidth === targetWindow.screen.width\n\t\t) {\n\t\t\t// if the height of the browser matches the screen height, we can\n\t\t\t// only guess that we are in fullscreen. It is also possible that\n\t\t\t// the user has turned off taskbars in the OS and the browser is\n\t\t\t// simply able to span the entire size of the screen.\n\t\t\treturn { mode: DetectedFullscreenMode.BROWSER, guess: true };\n\t\t}\n\t}\n\n\t// Not in fullscreen\n\treturn null;\n}\n\n// -- sanitize and trusted html\n\n/**\n * Hooks dompurify using `afterSanitizeAttributes` to check that all `href` and `src`\n * attributes are valid.\n */\nexport function hookDomPurifyHrefAndSrcSanitizer(\n\tallowedProtocols: readonly string[],\n\tallowDataImages = false,\n): IDisposable {\n\t// https://github.com/cure53/DOMPurify/blob/main/demos/hooks-scheme-allowlist.html\n\n\t// build an anchor to map URLs to\n\tconst anchor = document.createElement(\"a\");\n\n\tdompurify.addHook(\"afterSanitizeAttributes\", (node) => {\n\t\t// check all href/src attributes for validity\n\t\tfor (const attr of [\"href\", \"src\"]) {\n\t\t\tif (node.hasAttribute(attr)) {\n\t\t\t\tconst attrValue = node.getAttribute(attr) as string;\n\t\t\t\tif (attr === \"href\" && attrValue.startsWith(\"#\")) {\n\t\t\t\t\t// Allow fragment links\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tanchor.href = attrValue;\n\t\t\t\tif (\n\t\t\t\t\t!allowedProtocols.includes(\n\t\t\t\t\t\tanchor.protocol.replace(/:$/, \"\"),\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tallowDataImages &&\n\t\t\t\t\t\tattr === \"src\" &&\n\t\t\t\t\t\tanchor.href.startsWith(\"data:\")\n\t\t\t\t\t) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tnode.removeAttribute(attr);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n\n\treturn toDisposable(() => {\n\t\tdompurify.removeHook(\"afterSanitizeAttributes\");\n\t});\n}\n\nconst defaultSafeProtocols = [Schemas.http, Schemas.https, Schemas.command];\n\n/**\n * List of safe, non-input html tags.\n */\nexport const basicMarkupHtmlTags = Object.freeze([\n\t\"a\",\n\t\"abbr\",\n\t\"b\",\n\t\"bdo\",\n\t\"blockquote\",\n\t\"br\",\n\t\"caption\",\n\t\"cite\",\n\t\"code\",\n\t\"col\",\n\t\"colgroup\",\n\t\"dd\",\n\t\"del\",\n\t\"details\",\n\t\"dfn\",\n\t\"div\",\n\t\"dl\",\n\t\"dt\",\n\t\"em\",\n\t\"figcaption\",\n\t\"figure\",\n\t\"h1\",\n\t\"h2\",\n\t\"h3\",\n\t\"h4\",\n\t\"h5\",\n\t\"h6\",\n\t\"hr\",\n\t\"i\",\n\t\"img\",\n\t\"input\",\n\t\"ins\",\n\t\"kbd\",\n\t\"label\",\n\t\"li\",\n\t\"mark\",\n\t\"ol\",\n\t\"p\",\n\t\"pre\",\n\t\"q\",\n\t\"rp\",\n\t\"rt\",\n\t\"ruby\",\n\t\"samp\",\n\t\"small\",\n\t\"small\",\n\t\"source\",\n\t\"span\",\n\t\"strike\",\n\t\"strong\",\n\t\"sub\",\n\t\"summary\",\n\t\"sup\",\n\t\"table\",\n\t\"tbody\",\n\t\"td\",\n\t\"tfoot\",\n\t\"th\",\n\t\"thead\",\n\t\"time\",\n\t\"tr\",\n\t\"tt\",\n\t\"u\",\n\t\"ul\",\n\t\"var\",\n\t\"video\",\n\t\"wbr\",\n]);\n\nconst defaultDomPurifyConfig = Object.freeze<\n\tdompurify.Config & { RETURN_TRUSTED_TYPE: true }\n>({\n\tALLOWED_TAGS: [\n\t\t\"a\",\n\t\t\"button\",\n\t\t\"blockquote\",\n\t\t\"code\",\n\t\t\"div\",\n\t\t\"h1\",\n\t\t\"h2\",\n\t\t\"h3\",\n\t\t\"h4\",\n\t\t\"h5\",\n\t\t\"h6\",\n\t\t\"hr\",\n\t\t\"input\",\n\t\t\"label\",\n\t\t\"li\",\n\t\t\"p\",\n\t\t\"pre\",\n\t\t\"select\",\n\t\t\"small\",\n\t\t\"span\",\n\t\t\"strong\",\n\t\t\"textarea\",\n\t\t\"ul\",\n\t\t\"ol\",\n\t],\n\tALLOWED_ATTR: [\n\t\t\"href\",\n\t\t\"data-href\",\n\t\t\"data-command\",\n\t\t\"target\",\n\t\t\"title\",\n\t\t\"name\",\n\t\t\"src\",\n\t\t\"alt\",\n\t\t\"class\",\n\t\t\"id\",\n\t\t\"role\",\n\t\t\"tabindex\",\n\t\t\"style\",\n\t\t\"data-code\",\n\t\t\"width\",\n\t\t\"height\",\n\t\t\"align\",\n\t\t\"x-dispatch\",\n\t\t\"required\",\n\t\t\"checked\",\n\t\t\"placeholder\",\n\t\t\"type\",\n\t\t\"start\",\n\t],\n\tRETURN_DOM: false,\n\tRETURN_DOM_FRAGMENT: false,\n\tRETURN_TRUSTED_TYPE: true,\n});\n\n/**\n * Sanitizes the given `value` and reset the given `node` with it.\n */\nexport function safeInnerHtml(\n\tnode: HTMLElement,\n\tvalue: string,\n\textraDomPurifyConfig?: dompurify.Config,\n): void {\n\tconst hook = hookDomPurifyHrefAndSrcSanitizer(defaultSafeProtocols);\n\ttry {\n\t\tconst html = dompurify.sanitize(value, {\n\t\t\t...defaultDomPurifyConfig,\n\t\t\t...extraDomPurifyConfig,\n\t\t});\n\t\tnode.innerHTML = html as unknown as string;\n\t} finally {\n\t\thook.dispose();\n\t}\n}\n\n/**\n * Convert a Unicode string to a string in which each 16-bit unit occupies only one byte\n *\n * From https://developer.mozilla.org/en-US/docs/Web/API/WindowOrWorkerGlobalScope/btoa\n */\nfunction toBinary(str: string): string {\n\tconst codeUnits = new Uint16Array(str.length);\n\tfor (let i = 0; i < codeUnits.length; i++) {\n\t\tcodeUnits[i] = str.charCodeAt(i);\n\t}\n\tlet binary = \"\";\n\tconst uint8array = new Uint8Array(codeUnits.buffer);\n\tfor (let i = 0; i < uint8array.length; i++) {\n\t\tbinary += String.fromCharCode(uint8array[i]);\n\t}\n\treturn binary;\n}\n\n/**\n * Version of the global `btoa` function that handles multi-byte characters instead\n * of throwing an exception.\n */\nexport function multibyteAwareBtoa(str: string): string {\n\treturn btoa(toBinary(str));\n}\n\ntype ModifierKey = \"alt\" | \"ctrl\" | \"shift\" | \"meta\";\n\nexport interface IModifierKeyStatus {\n\taltKey: boolean;\n\tshiftKey: boolean;\n\tctrlKey: boolean;\n\tmetaKey: boolean;\n\tlastKeyPressed?: ModifierKey;\n\tlastKeyReleased?: ModifierKey;\n\tevent?: KeyboardEvent;\n}\n\nexport class ModifierKeyEmitter extends event.Emitter<IModifierKeyStatus> {\n\tprivate readonly _subscriptions = new DisposableStore();\n\tprivate _keyStatus: IModifierKeyStatus;\n\tprivate static instance: ModifierKeyEmitter;\n\n\tprivate constructor() {\n\t\tsuper();\n\n\t\tthis._keyStatus = {\n\t\t\taltKey: false,\n\t\t\tshiftKey: false,\n\t\t\tctrlKey: false,\n\t\t\tmetaKey: false,\n\t\t};\n\n\t\tthis._subscriptions.add(\n\t\t\tevent.Event.runAndSubscribe(\n\t\t\t\tonDidRegisterWindow,\n\t\t\t\t({ window, disposables }) =>\n\t\t\t\t\tthis.registerListeners(window, disposables),\n\t\t\t\t{ window: mainWindow, disposables: this._subscriptions },\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate registerListeners(\n\t\twindow: Window,\n\t\tdisposables: DisposableStore,\n\t): void {\n\t\tdisposables.add(\n\t\t\taddDisposableListener(\n\t\t\t\twindow,\n\t\t\t\t\"keydown\",\n\t\t\t\t(e) => {\n\t\t\t\t\tif (e.defaultPrevented) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst event = new StandardKeyboardEvent(e);\n\t\t\t\t\t// If Alt-key keydown event is repeated, ignore it #112347\n\t\t\t\t\t// Only known to be necessary for Alt-Key at the moment #115810\n\t\t\t\t\tif (event.keyCode === KeyCode.Alt && e.repeat) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (e.altKey && !this._keyStatus.altKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = \"alt\";\n\t\t\t\t\t} else if (e.ctrlKey && !this._keyStatus.ctrlKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = \"ctrl\";\n\t\t\t\t\t} else if (e.metaKey && !this._keyStatus.metaKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = \"meta\";\n\t\t\t\t\t} else if (e.shiftKey && !this._keyStatus.shiftKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = \"shift\";\n\t\t\t\t\t} else if (event.keyCode !== KeyCode.Alt) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = undefined;\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._keyStatus.altKey = e.altKey;\n\t\t\t\t\tthis._keyStatus.ctrlKey = e.ctrlKey;\n\t\t\t\t\tthis._keyStatus.metaKey = e.metaKey;\n\t\t\t\t\tthis._keyStatus.shiftKey = e.shiftKey;\n\n\t\t\t\t\tif (this._keyStatus.lastKeyPressed) {\n\t\t\t\t\t\tthis._keyStatus.event = e;\n\t\t\t\t\t\tthis.fire(this._keyStatus);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tdisposables.add(\n\t\t\taddDisposableListener(\n\t\t\t\twindow,\n\t\t\t\t\"keyup\",\n\t\t\t\t(e) => {\n\t\t\t\t\tif (e.defaultPrevented) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!e.altKey && this._keyStatus.altKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased = \"alt\";\n\t\t\t\t\t} else if (!e.ctrlKey && this._keyStatus.ctrlKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased = \"ctrl\";\n\t\t\t\t\t} else if (!e.metaKey && this._keyStatus.metaKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased = \"meta\";\n\t\t\t\t\t} else if (!e.shiftKey && this._keyStatus.shiftKey) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased = \"shift\";\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed !==\n\t\t\t\t\t\tthis._keyStatus.lastKeyReleased\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._keyStatus.altKey = e.altKey;\n\t\t\t\t\tthis._keyStatus.ctrlKey = e.ctrlKey;\n\t\t\t\t\tthis._keyStatus.metaKey = e.metaKey;\n\t\t\t\t\tthis._keyStatus.shiftKey = e.shiftKey;\n\n\t\t\t\t\tif (this._keyStatus.lastKeyReleased) {\n\t\t\t\t\t\tthis._keyStatus.event = e;\n\t\t\t\t\t\tthis.fire(this._keyStatus);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tdisposables.add(\n\t\t\taddDisposableListener(\n\t\t\t\twindow.document.body,\n\t\t\t\t\"mousedown\",\n\t\t\t\t() => {\n\t\t\t\t\tthis._keyStatus.lastKeyPressed = undefined;\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tdisposables.add(\n\t\t\taddDisposableListener(\n\t\t\t\twindow.document.body,\n\t\t\t\t\"mouseup\",\n\t\t\t\t() => {\n\t\t\t\t\tthis._keyStatus.lastKeyPressed = undefined;\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tdisposables.add(\n\t\t\taddDisposableListener(\n\t\t\t\twindow.document.body,\n\t\t\t\t\"mousemove\",\n\t\t\t\t(e) => {\n\t\t\t\t\tif (e.buttons) {\n\t\t\t\t\t\tthis._keyStatus.lastKeyPressed = undefined;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tdisposables.add(\n\t\t\taddDisposableListener(window, \"blur\", () => {\n\t\t\t\tthis.resetKeyStatus();\n\t\t\t}),\n\t\t);\n\t}\n\n\tget keyStatus(): IModifierKeyStatus {\n\t\treturn this._keyStatus;\n\t}\n\n\tget isModifierPressed(): boolean {\n\t\treturn (\n\t\t\tthis._keyStatus.altKey ||\n\t\t\tthis._keyStatus.ctrlKey ||\n\t\t\tthis._keyStatus.metaKey ||\n\t\t\tthis._keyStatus.shiftKey\n\t\t);\n\t}\n\n\t/**\n\t * Allows to explicitly reset the key status based on more knowledge (#109062)\n\t */\n\tresetKeyStatus(): void {\n\t\tthis.doResetKeyStatus();\n\t\tthis.fire(this._keyStatus);\n\t}\n\n\tprivate doResetKeyStatus(): void {\n\t\tthis._keyStatus = {\n\t\t\taltKey: false,\n\t\t\tshiftKey: false,\n\t\t\tctrlKey: false,\n\t\t\tmetaKey: false,\n\t\t};\n\t}\n\n\tstatic getInstance() {\n\t\tif (!ModifierKeyEmitter.instance) {\n\t\t\tModifierKeyEmitter.instance = new ModifierKeyEmitter();\n\t\t}\n\n\t\treturn ModifierKeyEmitter.instance;\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\t\tthis._subscriptions.dispose();\n\t}\n}\n\nexport function getCookieValue(name: string): string | undefined {\n\tconst match = document.cookie.match(\n\t\t\"(^|[^;]+)\\\\s*\" + name + \"\\\\s*=\\\\s*([^;]+)\",\n\t); // See https://stackoverflow.com/a/25490531\n\n\treturn match ? match.pop() : undefined;\n}\n\nexport interface IDragAndDropObserverCallbacks {\n\treadonly onDragEnter?: (e: DragEvent) => void;\n\treadonly onDragLeave?: (e: DragEvent) => void;\n\treadonly onDrop?: (e: DragEvent) => void;\n\treadonly onDragEnd?: (e: DragEvent) => void;\n\treadonly onDragStart?: (e: DragEvent) => void;\n\treadonly onDrag?: (e: DragEvent) => void;\n\treadonly onDragOver?: (e: DragEvent, dragDuration: number) => void;\n}\n\nexport class DragAndDropObserver extends Disposable {\n\t// A helper to fix issues with repeated DRAG_ENTER / DRAG_LEAVE\n\t// calls see https://github.com/microsoft/vscode/issues/14470\n\t// when the element has child elements where the events are fired\n\t// repeadedly.\n\tprivate counter = 0;\n\n\t// Allows to measure the duration of the drag operation.\n\tprivate dragStartTime = 0;\n\n\tconstructor(\n\t\tprivate readonly element: HTMLElement,\n\t\tprivate readonly callbacks: IDragAndDropObserverCallbacks,\n\t) {\n\t\tsuper();\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\tif (this.callbacks.onDragStart) {\n\t\t\tthis._register(\n\t\t\t\taddDisposableListener(\n\t\t\t\t\tthis.element,\n\t\t\t\t\tEventType.DRAG_START,\n\t\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\t\tthis.callbacks.onDragStart?.(e);\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tif (this.callbacks.onDrag) {\n\t\t\tthis._register(\n\t\t\t\taddDisposableListener(\n\t\t\t\t\tthis.element,\n\t\t\t\t\tEventType.DRAG,\n\t\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\t\tthis.callbacks.onDrag?.(e);\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tthis._register(\n\t\t\taddDisposableListener(\n\t\t\t\tthis.element,\n\t\t\t\tEventType.DRAG_ENTER,\n\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\tthis.counter++;\n\t\t\t\t\tthis.dragStartTime = e.timeStamp;\n\n\t\t\t\t\tthis.callbacks.onDragEnter?.(e);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\taddDisposableListener(\n\t\t\t\tthis.element,\n\t\t\t\tEventType.DRAG_OVER,\n\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\te.preventDefault(); // needed so that the drop event fires (https://stackoverflow.com/questions/21339924/drop-event-not-firing-in-chrome)\n\n\t\t\t\t\tthis.callbacks.onDragOver?.(\n\t\t\t\t\t\te,\n\t\t\t\t\t\te.timeStamp - this.dragStartTime,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\taddDisposableListener(\n\t\t\t\tthis.element,\n\t\t\t\tEventType.DRAG_LEAVE,\n\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\tthis.counter--;\n\n\t\t\t\t\tif (this.counter === 0) {\n\t\t\t\t\t\tthis.dragStartTime = 0;\n\n\t\t\t\t\t\tthis.callbacks.onDragLeave?.(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\taddDisposableListener(\n\t\t\t\tthis.element,\n\t\t\t\tEventType.DRAG_END,\n\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\tthis.counter = 0;\n\t\t\t\t\tthis.dragStartTime = 0;\n\n\t\t\t\t\tthis.callbacks.onDragEnd?.(e);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\taddDisposableListener(\n\t\t\t\tthis.element,\n\t\t\t\tEventType.DROP,\n\t\t\t\t(e: DragEvent) => {\n\t\t\t\t\tthis.counter = 0;\n\t\t\t\t\tthis.dragStartTime = 0;\n\n\t\t\t\t\tthis.callbacks.onDrop?.(e);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n}\n\ntype HTMLElementAttributeKeys<T> = Partial<{\n\t[K in keyof T]: T[K] extends Function\n\t\t? never\n\t\t: T[K] extends object\n\t\t\t? HTMLElementAttributeKeys<T[K]>\n\t\t\t: T[K];\n}>;\ntype ElementAttributes<T> = HTMLElementAttributeKeys<T> & Record<string, any>;\ntype RemoveHTMLElement<T> = T extends HTMLElement ? never : T;\ntype UnionToIntersection<U> = (U extends any ? (k: U) => void : never) extends (\n\tk: infer I,\n) => void\n\t? I\n\t: never;\ntype ArrayToObj<T extends readonly any[]> = UnionToIntersection<\n\tRemoveHTMLElement<T[number]>\n>;\ntype HHTMLElementTagNameMap = HTMLElementTagNameMap & { \"\": HTMLDivElement };\n\ntype TagToElement<T> = T extends `${infer TStart}#${string}`\n\t? TStart extends keyof HHTMLElementTagNameMap\n\t\t? HHTMLElementTagNameMap[TStart]\n\t\t: HTMLElement\n\t: T extends `${infer TStart}.${string}`\n\t\t? TStart extends keyof HHTMLElementTagNameMap\n\t\t\t? HHTMLElementTagNameMap[TStart]\n\t\t\t: HTMLElement\n\t\t: T extends keyof HTMLElementTagNameMap\n\t\t\t? HTMLElementTagNameMap[T]\n\t\t\t: HTMLElement;\n\ntype TagToElementAndId<TTag> = TTag extends `${infer TTag}@${infer TId}`\n\t? { element: TagToElement<TTag>; id: TId }\n\t: { element: TagToElement<TTag>; id: \"root\" };\n\ntype TagToRecord<TTag> = TagToElementAndId<TTag> extends {\n\telement: infer TElement;\n\tid: infer TId;\n}\n\t? Record<(TId extends string ? TId : never) | \"root\", TElement>\n\t: never;\n\ntype Child = HTMLElement | string | Record<string, HTMLElement>;\n\nconst H_REGEX =\n\t/(?<tag>[\\w-]+)?(?:#(?<id>[\\w-]+))?(?<class>(?:\\.(?:[\\w-]+))*)(?:@(?<name>(?:[\\w_])+))?/;\n\n/**\n * A helper function to create nested dom nodes.\n *\n *\n * ```ts\n * const elements = h('div.code-view', [\n * \th('div.title@title'),\n * \th('div.container', [\n * \t\th('div.gutter@gutterDiv'),\n * \t\th('div@editor'),\n * \t]),\n * ]);\n * const editor = createEditor(elements.editor);\n * ```\n */\nexport function h<TTag extends string>(\n\ttag: TTag,\n): TagToRecord<TTag> extends infer Y ? { [TKey in keyof Y]: Y[TKey] } : never;\n\nexport function h<TTag extends string, T extends Child[]>(\n\ttag: TTag,\n\tchildren: [...T],\n): ArrayToObj<T> & TagToRecord<TTag> extends infer Y\n\t? { [TKey in keyof Y]: Y[TKey] }\n\t: never;\n\nexport function h<TTag extends string>(\n\ttag: TTag,\n\tattributes: Partial<ElementAttributes<TagToElement<TTag>>>,\n): TagToRecord<TTag> extends infer Y ? { [TKey in keyof Y]: Y[TKey] } : never;\n\nexport function h<TTag extends string, T extends Child[]>(\n\ttag: TTag,\n\tattributes: Partial<ElementAttributes<TagToElement<TTag>>>,\n\tchildren: [...T],\n): ArrayToObj<T> & TagToRecord<TTag> extends infer Y\n\t? { [TKey in keyof Y]: Y[TKey] }\n\t: never;\n\nexport function h(\n\ttag: string,\n\t...args:\n\t\t| []\n\t\t| [\n\t\t\t\tattributes:\n\t\t\t\t\t| ({ $: string } & Partial<ElementAttributes<HTMLElement>>)\n\t\t\t\t\t| Record<string, any>,\n\t\t\t\tchildren?: any[],\n\t\t  ]\n\t\t| [children: any[]]\n): Record<string, HTMLElement> {\n\tlet attributes: { $?: string } & Partial<ElementAttributes<HTMLElement>>;\n\tlet children: (Record<string, HTMLElement> | HTMLElement)[] | undefined;\n\n\tif (Array.isArray(args[0])) {\n\t\tattributes = {};\n\t\tchildren = args[0];\n\t} else {\n\t\tattributes = (args[0] as any) || {};\n\t\tchildren = args[1];\n\t}\n\n\tconst match = H_REGEX.exec(tag);\n\n\tif (!match || !match.groups) {\n\t\tthrow new Error(\"Bad use of h\");\n\t}\n\n\tconst tagName = match.groups[\"tag\"] || \"div\";\n\tconst el = document.createElement(tagName);\n\n\tif (match.groups[\"id\"]) {\n\t\tel.id = match.groups[\"id\"];\n\t}\n\n\tconst classNames = [];\n\tif (match.groups[\"class\"]) {\n\t\tfor (const className of match.groups[\"class\"].split(\".\")) {\n\t\t\tif (className !== \"\") {\n\t\t\t\tclassNames.push(className);\n\t\t\t}\n\t\t}\n\t}\n\tif (attributes.className !== undefined) {\n\t\tfor (const className of attributes.className.split(\".\")) {\n\t\t\tif (className !== \"\") {\n\t\t\t\tclassNames.push(className);\n\t\t\t}\n\t\t}\n\t}\n\tif (classNames.length > 0) {\n\t\tel.className = classNames.join(\" \");\n\t}\n\n\tconst result: Record<string, HTMLElement> = {};\n\n\tif (match.groups[\"name\"]) {\n\t\tresult[match.groups[\"name\"]] = el;\n\t}\n\n\tif (children) {\n\t\tfor (const c of children) {\n\t\t\tif (isHTMLElement(c)) {\n\t\t\t\tel.appendChild(c);\n\t\t\t} else if (typeof c === \"string\") {\n\t\t\t\tel.append(c);\n\t\t\t} else if (\"root\" in c) {\n\t\t\t\tObject.assign(result, c);\n\t\t\t\tel.appendChild(c.root);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const [key, value] of Object.entries(attributes)) {\n\t\tif (key === \"className\") {\n\t\t\tcontinue;\n\t\t} else if (key === \"style\") {\n\t\t\tfor (const [cssKey, cssValue] of Object.entries(value)) {\n\t\t\t\tel.style.setProperty(\n\t\t\t\t\tcamelCaseToHyphenCase(cssKey),\n\t\t\t\t\ttypeof cssValue === \"number\"\n\t\t\t\t\t\t? cssValue + \"px\"\n\t\t\t\t\t\t: \"\" + cssValue,\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (key === \"tabIndex\") {\n\t\t\tel.tabIndex = value;\n\t\t} else {\n\t\t\tel.setAttribute(camelCaseToHyphenCase(key), value.toString());\n\t\t}\n\t}\n\n\tresult[\"root\"] = el;\n\n\treturn result;\n}\n\nexport function svgElem<TTag extends string>(\n\ttag: TTag,\n): TagToRecord<TTag> extends infer Y ? { [TKey in keyof Y]: Y[TKey] } : never;\n\nexport function svgElem<TTag extends string, T extends Child[]>(\n\ttag: TTag,\n\tchildren: [...T],\n): ArrayToObj<T> & TagToRecord<TTag> extends infer Y\n\t? { [TKey in keyof Y]: Y[TKey] }\n\t: never;\n\nexport function svgElem<TTag extends string>(\n\ttag: TTag,\n\tattributes: Partial<ElementAttributes<TagToElement<TTag>>>,\n): TagToRecord<TTag> extends infer Y ? { [TKey in keyof Y]: Y[TKey] } : never;\n\nexport function svgElem<TTag extends string, T extends Child[]>(\n\ttag: TTag,\n\tattributes: Partial<ElementAttributes<TagToElement<TTag>>>,\n\tchildren: [...T],\n): ArrayToObj<T> & TagToRecord<TTag> extends infer Y\n\t? { [TKey in keyof Y]: Y[TKey] }\n\t: never;\n\nexport function svgElem(\n\ttag: string,\n\t...args:\n\t\t| []\n\t\t| [\n\t\t\t\tattributes:\n\t\t\t\t\t| ({ $: string } & Partial<ElementAttributes<HTMLElement>>)\n\t\t\t\t\t| Record<string, any>,\n\t\t\t\tchildren?: any[],\n\t\t  ]\n\t\t| [children: any[]]\n): Record<string, HTMLElement> {\n\tlet attributes: { $?: string } & Partial<ElementAttributes<HTMLElement>>;\n\tlet children: (Record<string, HTMLElement> | HTMLElement)[] | undefined;\n\n\tif (Array.isArray(args[0])) {\n\t\tattributes = {};\n\t\tchildren = args[0];\n\t} else {\n\t\tattributes = (args[0] as any) || {};\n\t\tchildren = args[1];\n\t}\n\n\tconst match = H_REGEX.exec(tag);\n\n\tif (!match || !match.groups) {\n\t\tthrow new Error(\"Bad use of h\");\n\t}\n\n\tconst tagName = match.groups[\"tag\"] || \"div\";\n\tconst el = document.createElementNS(\n\t\t\"http://www.w3.org/2000/svg\",\n\t\ttagName,\n\t) as any as HTMLElement;\n\n\tif (match.groups[\"id\"]) {\n\t\tel.id = match.groups[\"id\"];\n\t}\n\n\tconst classNames = [];\n\tif (match.groups[\"class\"]) {\n\t\tfor (const className of match.groups[\"class\"].split(\".\")) {\n\t\t\tif (className !== \"\") {\n\t\t\t\tclassNames.push(className);\n\t\t\t}\n\t\t}\n\t}\n\tif (attributes.className !== undefined) {\n\t\tfor (const className of attributes.className.split(\".\")) {\n\t\t\tif (className !== \"\") {\n\t\t\t\tclassNames.push(className);\n\t\t\t}\n\t\t}\n\t}\n\tif (classNames.length > 0) {\n\t\tel.className = classNames.join(\" \");\n\t}\n\n\tconst result: Record<string, HTMLElement> = {};\n\n\tif (match.groups[\"name\"]) {\n\t\tresult[match.groups[\"name\"]] = el;\n\t}\n\n\tif (children) {\n\t\tfor (const c of children) {\n\t\t\tif (isHTMLElement(c)) {\n\t\t\t\tel.appendChild(c);\n\t\t\t} else if (typeof c === \"string\") {\n\t\t\t\tel.append(c);\n\t\t\t} else if (\"root\" in c) {\n\t\t\t\tObject.assign(result, c);\n\t\t\t\tel.appendChild(c.root);\n\t\t\t}\n\t\t}\n\t}\n\n\tfor (const [key, value] of Object.entries(attributes)) {\n\t\tif (key === \"className\") {\n\t\t\tcontinue;\n\t\t} else if (key === \"style\") {\n\t\t\tfor (const [cssKey, cssValue] of Object.entries(value)) {\n\t\t\t\tel.style.setProperty(\n\t\t\t\t\tcamelCaseToHyphenCase(cssKey),\n\t\t\t\t\ttypeof cssValue === \"number\"\n\t\t\t\t\t\t? cssValue + \"px\"\n\t\t\t\t\t\t: \"\" + cssValue,\n\t\t\t\t);\n\t\t\t}\n\t\t} else if (key === \"tabIndex\") {\n\t\t\tel.tabIndex = value;\n\t\t} else {\n\t\t\tel.setAttribute(camelCaseToHyphenCase(key), value.toString());\n\t\t}\n\t}\n\n\tresult[\"root\"] = el;\n\n\treturn result;\n}\n\nfunction camelCaseToHyphenCase(str: string) {\n\treturn str.replace(/([a-z])([A-Z])/g, \"$1-$2\").toLowerCase();\n}\n\nexport function copyAttributes(\n\tfrom: Element,\n\tto: Element,\n\tfilter?: string[],\n): void {\n\tfor (const { name, value } of from.attributes) {\n\t\tif (!filter || filter.includes(name)) {\n\t\t\tto.setAttribute(name, value);\n\t\t}\n\t}\n}\n\nfunction copyAttribute(from: Element, to: Element, name: string): void {\n\tconst value = from.getAttribute(name);\n\tif (value) {\n\t\tto.setAttribute(name, value);\n\t} else {\n\t\tto.removeAttribute(name);\n\t}\n}\n\nexport function trackAttributes(\n\tfrom: Element,\n\tto: Element,\n\tfilter?: string[],\n): IDisposable {\n\tcopyAttributes(from, to, filter);\n\n\tconst disposables = new DisposableStore();\n\n\tdisposables.add(\n\t\tsharedMutationObserver.observe(from, disposables, {\n\t\t\tattributes: true,\n\t\t\tattributeFilter: filter,\n\t\t})((mutations) => {\n\t\t\tfor (const mutation of mutations) {\n\t\t\t\tif (mutation.type === \"attributes\" && mutation.attributeName) {\n\t\t\t\t\tcopyAttribute(from, to, mutation.attributeName);\n\t\t\t\t}\n\t\t\t}\n\t\t}),\n\t);\n\n\treturn disposables;\n}\n\nexport function isEditableElement(element: Element): boolean {\n\treturn (\n\t\telement.tagName.toLowerCase() === \"input\" ||\n\t\telement.tagName.toLowerCase() === \"textarea\" ||\n\t\t(isHTMLElement(element) && !!element.editContext)\n\t);\n}\n\n/**\n * Helper for calculating the \"safe triangle\" occluded by hovers to avoid early dismissal.\n * @see https://www.smashingmagazine.com/2023/08/better-context-menus-safe-triangles/ for example\n */\nexport class SafeTriangle {\n\t// 4 points (x, y), 8 length\n\tprivate points = new Int16Array(8);\n\n\tconstructor(\n\t\tprivate readonly originX: number,\n\t\tprivate readonly originY: number,\n\t\ttarget: HTMLElement,\n\t) {\n\t\tconst { top, left, right, bottom } = target.getBoundingClientRect();\n\t\tconst t = this.points;\n\t\tlet i = 0;\n\n\t\tt[i++] = left;\n\t\tt[i++] = top;\n\n\t\tt[i++] = right;\n\t\tt[i++] = top;\n\n\t\tt[i++] = left;\n\t\tt[i++] = bottom;\n\n\t\tt[i++] = right;\n\t\tt[i++] = bottom;\n\t}\n\n\tpublic contains(x: number, y: number) {\n\t\tconst { points, originX, originY } = this;\n\t\tfor (let i = 0; i < 4; i++) {\n\t\t\tconst p1 = 2 * i;\n\t\t\tconst p2 = 2 * ((i + 1) % 4);\n\t\t\tif (\n\t\t\t\tisPointWithinTriangle(\n\t\t\t\t\tx,\n\t\t\t\t\ty,\n\t\t\t\t\toriginX,\n\t\t\t\t\toriginY,\n\t\t\t\t\tpoints[p1],\n\t\t\t\t\tpoints[p1 + 1],\n\t\t\t\t\tpoints[p2],\n\t\t\t\t\tpoints[p2 + 1],\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n}\n"],
  "mappings": "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AA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AACD,CAAC;AAED,MAAM,yBAAyB,OAAO,OAEpC;AAAA,EACD,cAAc;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AAAA,EACA,cAAc;AAAA,IACb;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AAAA,EACA,YAAY;AAAA,EACZ,qBAAqB;AAAA,EACrB,qBAAqB;AACtB,CAAC;AAKM,SAAS,cACf,MACA,OACA,sBACO;AACP,QAAM,OAAO,iCAAiC,oBAAoB;AAClE,MAAI;AACH,UAAM,OAAO,UAAU,SAAS,OAAO;AAAA,MACtC,GAAG;AAAA,MACH,GAAG;A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",
  "names": ["onDidRegisterWindow", "onDidUnregisterWindow", "onWillUnregisterWindow", "getWindowById", "addStandardDisposableListener", "position", "document", "Namespace", "DetectedFullscreenMode", "event"]
}
