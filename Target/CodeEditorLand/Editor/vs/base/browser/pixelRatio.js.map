{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/browser/pixelRatio.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from \"../common/event.js\";\nimport { Disposable, markAsSingleton } from \"../common/lifecycle.js\";\nimport { getWindowId, onDidUnregisterWindow } from \"./dom.js\";\n\n/**\n * See https://developer.mozilla.org/en-US/docs/Web/API/Window/devicePixelRatio#monitoring_screen_resolution_or_zoom_level_changes\n */\nclass DevicePixelRatioMonitor extends Disposable {\n\tprivate readonly _onDidChange = this._register(new Emitter<void>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate readonly _listener: () => void;\n\tprivate _mediaQueryList: MediaQueryList | null;\n\n\tconstructor(targetWindow: Window) {\n\t\tsuper();\n\n\t\tthis._listener = () => this._handleChange(targetWindow, true);\n\t\tthis._mediaQueryList = null;\n\t\tthis._handleChange(targetWindow, false);\n\t}\n\n\tprivate _handleChange(targetWindow: Window, fireEvent: boolean): void {\n\t\tthis._mediaQueryList?.removeEventListener(\"change\", this._listener);\n\n\t\tthis._mediaQueryList = targetWindow.matchMedia(\n\t\t\t`(resolution: ${targetWindow.devicePixelRatio}dppx)`,\n\t\t);\n\t\tthis._mediaQueryList.addEventListener(\"change\", this._listener);\n\n\t\tif (fireEvent) {\n\t\t\tthis._onDidChange.fire();\n\t\t}\n\t}\n}\n\nexport interface IPixelRatioMonitor {\n\treadonly value: number;\n\treadonly onDidChange: Event<number>;\n}\n\nclass PixelRatioMonitorImpl extends Disposable implements IPixelRatioMonitor {\n\tprivate readonly _onDidChange = this._register(new Emitter<number>());\n\treadonly onDidChange = this._onDidChange.event;\n\n\tprivate _value: number;\n\n\tget value(): number {\n\t\treturn this._value;\n\t}\n\n\tconstructor(targetWindow: Window) {\n\t\tsuper();\n\n\t\tthis._value = this._getPixelRatio(targetWindow);\n\n\t\tconst dprMonitor = this._register(\n\t\t\tnew DevicePixelRatioMonitor(targetWindow),\n\t\t);\n\t\tthis._register(\n\t\t\tdprMonitor.onDidChange(() => {\n\t\t\t\tthis._value = this._getPixelRatio(targetWindow);\n\t\t\t\tthis._onDidChange.fire(this._value);\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate _getPixelRatio(targetWindow: Window): number {\n\t\tconst ctx: any = document.createElement(\"canvas\").getContext(\"2d\");\n\t\tconst dpr = targetWindow.devicePixelRatio || 1;\n\t\tconst bsr =\n\t\t\tctx.webkitBackingStorePixelRatio ||\n\t\t\tctx.mozBackingStorePixelRatio ||\n\t\t\tctx.msBackingStorePixelRatio ||\n\t\t\tctx.oBackingStorePixelRatio ||\n\t\t\tctx.backingStorePixelRatio ||\n\t\t\t1;\n\t\treturn dpr / bsr;\n\t}\n}\n\nclass PixelRatioMonitorFacade {\n\tprivate readonly mapWindowIdToPixelRatioMonitor = new Map<\n\t\tnumber,\n\t\tPixelRatioMonitorImpl\n\t>();\n\n\tprivate _getOrCreatePixelRatioMonitor(\n\t\ttargetWindow: Window,\n\t): PixelRatioMonitorImpl {\n\t\tconst targetWindowId = getWindowId(targetWindow);\n\t\tlet pixelRatioMonitor =\n\t\t\tthis.mapWindowIdToPixelRatioMonitor.get(targetWindowId);\n\t\tif (!pixelRatioMonitor) {\n\t\t\tpixelRatioMonitor = markAsSingleton(\n\t\t\t\tnew PixelRatioMonitorImpl(targetWindow),\n\t\t\t);\n\t\t\tthis.mapWindowIdToPixelRatioMonitor.set(\n\t\t\t\ttargetWindowId,\n\t\t\t\tpixelRatioMonitor,\n\t\t\t);\n\n\t\t\tmarkAsSingleton(\n\t\t\t\tEvent.once(onDidUnregisterWindow)(({ vscodeWindowId }) => {\n\t\t\t\t\tif (vscodeWindowId === targetWindowId) {\n\t\t\t\t\t\tpixelRatioMonitor?.dispose();\n\t\t\t\t\t\tthis.mapWindowIdToPixelRatioMonitor.delete(\n\t\t\t\t\t\t\ttargetWindowId,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\treturn pixelRatioMonitor;\n\t}\n\n\tgetInstance(targetWindow: Window): IPixelRatioMonitor {\n\t\treturn this._getOrCreatePixelRatioMonitor(targetWindow);\n\t}\n}\n\n/**\n * Returns the pixel ratio.\n *\n * This is useful for rendering <canvas> elements at native screen resolution or for being used as\n * a cache key when storing font measurements. Fonts might render differently depending on resolution\n * and any measurements need to be discarded for example when a window is moved from a monitor to another.\n */\nexport const PixelRatio = new PixelRatioMonitorFacade();\n"],
  "mappings": ";;AAKA,SAAS,SAAS,aAAa;AAC/B,SAAS,YAAY,uBAAuB;AAC5C,SAAS,aAAa,6BAA6B;AAKnD,MAAM,gCAAgC,WAAW;AAAA,EAZjD,OAYiD;AAAA;AAAA;AAAA,EAC/B,eAAe,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EACzD,cAAc,KAAK,aAAa;AAAA,EAExB;AAAA,EACT;AAAA,EAER,YAAY,cAAsB;AACjC,UAAM;AAEN,SAAK,YAAY,MAAM,KAAK,cAAc,cAAc,IAAI;AAC5D,SAAK,kBAAkB;AACvB,SAAK,cAAc,cAAc,KAAK;AAAA,EACvC;AAAA,EAEQ,cAAc,cAAsB,WAA0B;AACrE,SAAK,iBAAiB,oBAAoB,UAAU,KAAK,SAAS;AAElE,SAAK,kBAAkB,aAAa;AAAA,MACnC,gBAAgB,aAAa,gBAAgB;AAAA,IAC9C;AACA,SAAK,gBAAgB,iBAAiB,UAAU,KAAK,SAAS;AAE9D,QAAI,WAAW;AACd,WAAK,aAAa,KAAK;AAAA,IACxB;AAAA,EACD;AACD;AAOA,MAAM,8BAA8B,WAAyC;AAAA,EA9C7E,OA8C6E;AAAA;AAAA;AAAA,EAC3D,eAAe,KAAK,UAAU,IAAI,QAAgB,CAAC;AAAA,EAC3D,cAAc,KAAK,aAAa;AAAA,EAEjC;AAAA,EAER,IAAI,QAAgB;AACnB,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,YAAY,cAAsB;AACjC,UAAM;AAEN,SAAK,SAAS,KAAK,eAAe,YAAY;AAE9C,UAAM,aAAa,KAAK;AAAA,MACvB,IAAI,wBAAwB,YAAY;AAAA,IACzC;AACA,SAAK;AAAA,MACJ,WAAW,YAAY,MAAM;AAC5B,aAAK,SAAS,KAAK,eAAe,YAAY;AAC9C,aAAK,aAAa,KAAK,KAAK,MAAM;AAAA,MACnC,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,eAAe,cAA8B;AACpD,UAAM,MAAW,SAAS,cAAc,QAAQ,EAAE,WAAW,IAAI;AACjE,UAAM,MAAM,aAAa,oBAAoB;AAC7C,UAAM,MACL,IAAI,gCACJ,IAAI,6BACJ,IAAI,4BACJ,IAAI,2BACJ,IAAI,0BACJ;AACD,WAAO,MAAM;AAAA,EACd;AACD;AAEA,MAAM,wBAAwB;AAAA,EAtF9B,OAsF8B;AAAA;AAAA;AAAA,EACZ,iCAAiC,oBAAI,IAGpD;AAAA,EAEM,8BACP,cACwB;AACxB,UAAM,iBAAiB,YAAY,YAAY;AAC/C,QAAI,oBACH,KAAK,+BAA+B,IAAI,cAAc;AACvD,QAAI,CAAC,mBAAmB;AACvB,0BAAoB;AAAA,QACnB,IAAI,sBAAsB,YAAY;AAAA,MACvC;AACA,WAAK,+BAA+B;AAAA,QACnC;AAAA,QACA;AAAA,MACD;AAEA;AAAA,QACC,MAAM,KAAK,qBAAqB,EAAE,CAAC,EAAE,eAAe,MAAM;AACzD,cAAI,mBAAmB,gBAAgB;AACtC,+BAAmB,QAAQ;AAC3B,iBAAK,+BAA+B;AAAA,cACnC;AAAA,YACD;AAAA,UACD;AAAA,QACD,CAAC;AAAA,MACF;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAAA,EAEA,YAAY,cAA0C;AACrD,WAAO,KAAK,8BAA8B,YAAY;AAAA,EACvD;AACD;AASO,MAAM,aAAa,IAAI,wBAAwB;",
  "names": []
}
