import{Action as k}from"../../../common/actions.js";import{Codicon as I}from"../../../common/codicons.js";import{Color as _}from"../../../common/color.js";import{Emitter as p}from"../../../common/event.js";import{isMarkdownString as m,markdownStringEqual as S}from"../../../common/htmlContent.js";import{KeyCode as r}from"../../../common/keyCodes.js";import{Disposable as g,DisposableStore as L}from"../../../common/lifecycle.js";import{ThemeIcon as w}from"../../../common/themables.js";import{EventHelper as b,EventType as a,addDisposableListener as d,isActiveElement as D,reset as l,trackFocus as C}from"../../dom.js";import{sanitize as T}from"../../dompurify/dompurify.js";import{StandardKeyboardEvent as f}from"../../keyboardEvent.js";import{renderMarkdown as A,renderStringAsPlaintext as v}from"../../markdownRenderer.js";import{Gesture as x,EventType as M}from"../../touch.js";import{getDefaultHoverDelegate as y}from"../hover/hoverDelegateFactory.js";import{renderLabelWithIcons as B}from"../iconLabel/iconLabels.js";import"./button.css";import{localize as H}from"../../../../nls.js";import{getBaseLayerHoverDelegate as E}from"../hover/hoverDelegate2.js";const et={buttonBackground:"#0E639C",buttonHoverBackground:"#006BB3",buttonSeparator:_.white.toString(),buttonForeground:_.white.toString(),buttonBorder:void 0,buttonSecondaryBackground:void 0,buttonSecondaryForeground:void 0,buttonSecondaryHoverBackground:void 0};class u extends g{options;_element;_label="";_labelElement;_labelShortElement;_hover;_onDidClick=this._register(new p);get onDidClick(){return this._onDidClick.event}_onDidEscape=this._register(new p);get onDidEscape(){return this._onDidEscape.event}focusTracker;constructor(t,e){super(),this.options=e,this._element=document.createElement("a"),this._element.classList.add("monaco-button"),this._element.tabIndex=0,this._element.setAttribute("role","button"),this._element.classList.toggle("secondary",!!e.secondary);const n=e.secondary?e.buttonSecondaryBackground:e.buttonBackground,s=e.secondary?e.buttonSecondaryForeground:e.buttonForeground;this._element.style.color=s||"",this._element.style.backgroundColor=n||"",e.supportShortLabel&&(this._labelShortElement=document.createElement("div"),this._labelShortElement.classList.add("monaco-button-label-short"),this._element.appendChild(this._labelShortElement),this._labelElement=document.createElement("div"),this._labelElement.classList.add("monaco-button-label"),this._element.appendChild(this._labelElement),this._element.classList.add("monaco-text-button-with-short-label")),typeof e.title=="string"&&this.setTitle(e.title),typeof e.ariaLabel=="string"&&this._element.setAttribute("aria-label",e.ariaLabel),t.appendChild(this._element),this._register(x.addTarget(this._element)),[a.CLICK,M.Tap].forEach(i=>{this._register(d(this._element,i,o=>{if(!this.enabled){b.stop(o);return}this._onDidClick.fire(o)}))}),this._register(d(this._element,a.KEY_DOWN,i=>{const o=new f(i);let h=!1;this.enabled&&(o.equals(r.Enter)||o.equals(r.Space))?(this._onDidClick.fire(i),h=!0):o.equals(r.Escape)&&(this._onDidEscape.fire(i),this._element.blur(),h=!0),h&&b.stop(o,!0)})),this._register(d(this._element,a.MOUSE_OVER,i=>{this._element.classList.contains("disabled")||this.updateBackground(!0)})),this._register(d(this._element,a.MOUSE_OUT,i=>{this.updateBackground(!1)})),this.focusTracker=this._register(C(this._element)),this._register(this.focusTracker.onDidFocus(()=>{this.enabled&&this.updateBackground(!0)})),this._register(this.focusTracker.onDidBlur(()=>{this.enabled&&this.updateBackground(!1)}))}dispose(){super.dispose(),this._element.remove()}getContentElements(t){const e=[];for(let n of B(t))if(typeof n=="string"){if(n=n.trim(),n==="")continue;const s=document.createElement("span");s.textContent=n,e.push(s)}else e.push(n);return e}updateBackground(t){let e;this.options.secondary?e=t?this.options.buttonSecondaryHoverBackground:this.options.buttonSecondaryBackground:e=t?this.options.buttonHoverBackground:this.options.buttonBackground,e&&(this._element.style.backgroundColor=e)}get element(){return this._element}set label(t){if(this._label===t||m(this._label)&&m(t)&&S(this._label,t))return;this._element.classList.add("monaco-text-button");const e=this.options.supportShortLabel?this._labelElement:this._element;if(m(t)){const s=A(t,{inline:!0});s.dispose();const i=s.element.querySelector("p")?.innerHTML;if(i){const o=T(i,{ADD_TAGS:["b","i","u","code","span"],ALLOWED_ATTR:["class"],RETURN_TRUSTED_TYPE:!0});e.innerHTML=o}else l(e)}else this.options.supportIcons?l(e,...this.getContentElements(t)):e.textContent=t;let n="";typeof this.options.title=="string"?n=this.options.title:this.options.title&&(n=v(t)),this.setTitle(n),typeof this.options.ariaLabel=="string"?this._element.setAttribute("aria-label",this.options.ariaLabel):this.options.ariaLabel&&this._element.setAttribute("aria-label",n),this._label=t}get label(){return this._label}set labelShort(t){!this.options.supportShortLabel||!this._labelShortElement||(this.options.supportIcons?l(this._labelShortElement,...this.getContentElements(t)):this._labelShortElement.textContent=t)}set icon(t){this._element.classList.add(...w.asClassNameArray(t))}set enabled(t){t?(this._element.classList.remove("disabled"),this._element.setAttribute("aria-disabled",String(!1)),this._element.tabIndex=0):(this._element.classList.add("disabled"),this._element.setAttribute("aria-disabled",String(!0)))}get enabled(){return!this._element.classList.contains("disabled")}set checked(t){t?(this._element.classList.add("checked"),this._element.setAttribute("aria-checked","true")):(this._element.classList.remove("checked"),this._element.setAttribute("aria-checked","false"))}get checked(){return this._element.classList.contains("checked")}setTitle(t){!this._hover&&t!==""?this._hover=this._register(E().setupManagedHover(this.options.hoverDelegate??y("mouse"),this._element,t)):this._hover&&this._hover.update(t)}focus(){this._element.focus()}hasFocus(){return D(this._element)}}class F extends g{button;action;dropdownButton;separatorContainer;separator;element;_onDidClick=this._register(new p);onDidClick=this._onDidClick.event;constructor(t,e){super(),this.element=document.createElement("div"),this.element.classList.add("monaco-button-dropdown"),t.appendChild(this.element),this.button=this._register(new u(this.element,e)),this._register(this.button.onDidClick(i=>this._onDidClick.fire(i))),this.action=this._register(new k("primaryAction",v(this.button.label),void 0,!0,async()=>this._onDidClick.fire(void 0))),this.separatorContainer=document.createElement("div"),this.separatorContainer.classList.add("monaco-button-dropdown-separator"),this.separator=document.createElement("div"),this.separatorContainer.appendChild(this.separator),this.element.appendChild(this.separatorContainer);const n=e.buttonBorder;n&&(this.separatorContainer.style.borderTop="1px solid "+n,this.separatorContainer.style.borderBottom="1px solid "+n);const s=e.secondary?e.buttonSecondaryBackground:e.buttonBackground;this.separatorContainer.style.backgroundColor=s??"",this.separator.style.backgroundColor=e.buttonSeparator??"",this.dropdownButton=this._register(new u(this.element,{...e,title:!1,supportIcons:!0})),this._register(E().setupManagedHover(y("mouse"),this.dropdownButton.element,H("button dropdown more actions","More Actions..."))),this.dropdownButton.element.setAttribute("aria-haspopup","true"),this.dropdownButton.element.setAttribute("aria-expanded","false"),this.dropdownButton.element.classList.add("monaco-dropdown-button"),this.dropdownButton.icon=I.dropDownButton,this._register(this.dropdownButton.onDidClick(i=>{const o=Array.isArray(e.actions)?e.actions:e.actions.getActions();e.contextMenuProvider.showContextMenu({getAnchor:()=>this.dropdownButton.element,getActions:()=>e.addPrimaryActionToDropdown===!1?[...o]:[this.action,...o],actionRunner:e.actionRunner,onHide:()=>this.dropdownButton.element.setAttribute("aria-expanded","false")}),this.dropdownButton.element.setAttribute("aria-expanded","true")}))}dispose(){super.dispose(),this.element.remove()}set label(t){this.button.label=t,this.action.label=t}set icon(t){this.button.icon=t}set enabled(t){this.button.enabled=t,this.dropdownButton.enabled=t,this.element.classList.toggle("disabled",!t)}get enabled(){return this.button.enabled}set checked(t){this.button.checked=t}get checked(){return this.button.checked}focus(){this.button.focus()}hasFocus(){return this.button.hasFocus()||this.dropdownButton.hasFocus()}}class O{constructor(t,e){this.options=e;this._element=document.createElement("div"),this._element.classList.add("monaco-description-button"),this._button=new u(this._element,e),this._descriptionElement=document.createElement("div"),this._descriptionElement.classList.add("monaco-button-description"),this._element.appendChild(this._descriptionElement),t.appendChild(this._element)}_button;_element;_descriptionElement;get onDidClick(){return this._button.onDidClick}get element(){return this._element}set label(t){this._button.label=t}set icon(t){this._button.icon=t}get enabled(){return this._button.enabled}set enabled(t){this._button.enabled=t}set checked(t){this._button.checked=t}get checked(){return this._button.checked}focus(){this._button.focus()}hasFocus(){return this._button.hasFocus()}dispose(){this._button.dispose()}set description(t){this.options.supportIcons?l(this._descriptionElement,...B(t)):this._descriptionElement.textContent=t}}class nt{constructor(t){this.container=t}_buttons=[];_buttonStore=new L;dispose(){this._buttonStore.dispose()}get buttons(){return this._buttons}clear(){this._buttonStore.clear(),this._buttons.length=0}addButton(t){const e=this._buttonStore.add(new u(this.container,t));return this.pushButton(e),e}addButtonWithDescription(t){const e=this._buttonStore.add(new O(this.container,t));return this.pushButton(e),e}addButtonWithDropdown(t){const e=this._buttonStore.add(new F(this.container,t));return this.pushButton(e),e}pushButton(t){this._buttons.push(t);const e=this._buttons.length-1;this._buttonStore.add(d(t.element,a.KEY_DOWN,n=>{const s=new f(n);let i=!0,o;s.equals(r.LeftArrow)?o=e>0?e-1:this._buttons.length-1:s.equals(r.RightArrow)?o=e===this._buttons.length-1?0:e+1:i=!1,i&&typeof o=="number"&&(this._buttons[o].focus(),b.stop(n,!0))}))}}export{u as Button,nt as ButtonBar,O as ButtonWithDescription,F as ButtonWithDropdown,et as unthemedButtonStyles};
