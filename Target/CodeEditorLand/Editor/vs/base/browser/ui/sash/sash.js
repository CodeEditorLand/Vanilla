var R=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var v=(r,e,t,n)=>{for(var o=n>1?void 0:n?k(e,t):e,h=r.length-1,d;h>=0;h--)(d=r[h])&&(o=(n?d(e,t,o):d(o))||o);return n&&o&&R(e,t,o),o};import{Delayer as U}from"../../../common/async.js";import{memoize as p}from"../../../common/decorators.js";import{Emitter as S}from"../../../common/event.js";import{Disposable as X,DisposableStore as u,toDisposable as I}from"../../../common/lifecycle.js";import{isMacintosh as b}from"../../../common/platform.js";import{$ as L,EventHelper as P,append as H,createStyleSheet as Y,getWindow as M,isHTMLElement as N}from"../../dom.js";import{DomEmitter as a}from"../../event.js";import{EventType as f,Gesture as W}from"../../touch.js";import"./sash.css";const $=!1;var G=(o=>(o.North="north",o.South="south",o.East="east",o.West="west",o))(G||{}),K=(t=>(t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL",t))(K||{}),Z=(o=>(o[o.Disabled=0]="Disabled",o[o.AtMinimum=1]="AtMinimum",o[o.AtMaximum=2]="AtMaximum",o[o.Enabled=3]="Enabled",o))(Z||{});let z=4;const T=new S;function se(r){z=r,T.fire(r)}let x=300;const C=new S;function ie(r){x=r,C.fire(r)}class _{constructor(e){this.el=e}disposables=new u;get onPointerMove(){return this.disposables.add(new a(M(this.el),"mousemove")).event}get onPointerUp(){return this.disposables.add(new a(M(this.el),"mouseup")).event}dispose(){this.disposables.dispose()}}v([p],_.prototype,"onPointerMove",1),v([p],_.prototype,"onPointerUp",1);class w{constructor(e){this.el=e}disposables=new u;get onPointerMove(){return this.disposables.add(new a(this.el,f.Change)).event}get onPointerUp(){return this.disposables.add(new a(this.el,f.End)).event}dispose(){this.disposables.dispose()}}v([p],w.prototype,"onPointerMove",1),v([p],w.prototype,"onPointerUp",1);class E{constructor(e){this.factory=e}get onPointerMove(){return this.factory.onPointerMove}get onPointerUp(){return this.factory.onPointerUp}dispose(){}}v([p],E.prototype,"onPointerMove",1),v([p],E.prototype,"onPointerUp",1);const O="pointer-events-disabled";class l extends X{el;layoutProvider;orientation;size;hoverDelay=x;hoverDelayer=this._register(new U(this.hoverDelay));_state=3;onDidEnablementChange=this._register(new S);_onDidStart=this._register(new S);_onDidChange=this._register(new S);_onDidReset=this._register(new S);_onDidEnd=this._register(new S);orthogonalStartSashDisposables=this._register(new u);_orthogonalStartSash;orthogonalStartDragHandleDisposables=this._register(new u);_orthogonalStartDragHandle;orthogonalEndSashDisposables=this._register(new u);_orthogonalEndSash;orthogonalEndDragHandleDisposables=this._register(new u);_orthogonalEndDragHandle;get state(){return this._state}get orthogonalStartSash(){return this._orthogonalStartSash}get orthogonalEndSash(){return this._orthogonalEndSash}set state(e){this._state!==e&&(this.el.classList.toggle("disabled",e===0),this.el.classList.toggle("minimum",e===1),this.el.classList.toggle("maximum",e===2),this._state=e,this.onDidEnablementChange.fire(e))}onDidStart=this._onDidStart.event;onDidChange=this._onDidChange.event;onDidReset=this._onDidReset.event;onDidEnd=this._onDidEnd.event;linkedSash=void 0;set orthogonalStartSash(e){if(this._orthogonalStartSash!==e){if(this.orthogonalStartDragHandleDisposables.clear(),this.orthogonalStartSashDisposables.clear(),e){const t=n=>{this.orthogonalStartDragHandleDisposables.clear(),n!==0&&(this._orthogonalStartDragHandle=H(this.el,L(".orthogonal-drag-handle.start")),this.orthogonalStartDragHandleDisposables.add(I(()=>this._orthogonalStartDragHandle.remove())),this.orthogonalStartDragHandleDisposables.add(new a(this._orthogonalStartDragHandle,"mouseenter")).event(()=>l.onMouseEnter(e),void 0,this.orthogonalStartDragHandleDisposables),this.orthogonalStartDragHandleDisposables.add(new a(this._orthogonalStartDragHandle,"mouseleave")).event(()=>l.onMouseLeave(e),void 0,this.orthogonalStartDragHandleDisposables))};this.orthogonalStartSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalStartSash=e}}set orthogonalEndSash(e){if(this._orthogonalEndSash!==e){if(this.orthogonalEndDragHandleDisposables.clear(),this.orthogonalEndSashDisposables.clear(),e){const t=n=>{this.orthogonalEndDragHandleDisposables.clear(),n!==0&&(this._orthogonalEndDragHandle=H(this.el,L(".orthogonal-drag-handle.end")),this.orthogonalEndDragHandleDisposables.add(I(()=>this._orthogonalEndDragHandle.remove())),this.orthogonalEndDragHandleDisposables.add(new a(this._orthogonalEndDragHandle,"mouseenter")).event(()=>l.onMouseEnter(e),void 0,this.orthogonalEndDragHandleDisposables),this.orthogonalEndDragHandleDisposables.add(new a(this._orthogonalEndDragHandle,"mouseleave")).event(()=>l.onMouseLeave(e),void 0,this.orthogonalEndDragHandleDisposables))};this.orthogonalEndSashDisposables.add(e.onDidEnablementChange.event(t,this)),t(e.state)}this._orthogonalEndSash=e}}constructor(e,t,n){super(),this.el=H(e,L(".monaco-sash")),n.orthogonalEdge&&this.el.classList.add(`orthogonal-edge-${n.orthogonalEdge}`),b&&this.el.classList.add("mac");const o=this._register(new a(this.el,"mousedown")).event;this._register(o(i=>this.onPointerStart(i,new _(e)),this));const h=this._register(new a(this.el,"dblclick")).event;this._register(h(this.onPointerDoublePress,this));const d=this._register(new a(this.el,"mouseenter")).event;this._register(d(()=>l.onMouseEnter(this)));const c=this._register(new a(this.el,"mouseleave")).event;this._register(c(()=>l.onMouseLeave(this))),this._register(W.addTarget(this.el));const D=this._register(new a(this.el,f.Start)).event;this._register(D(i=>this.onPointerStart(i,new w(this.el)),this));const m=this._register(new a(this.el,f.Tap)).event;let g;this._register(m(i=>{if(g){clearTimeout(g),g=void 0,this.onPointerDoublePress(i);return}clearTimeout(g),g=setTimeout(()=>g=void 0,250)},this)),typeof n.size=="number"?(this.size=n.size,n.orientation===0?this.el.style.width=`${this.size}px`:this.el.style.height=`${this.size}px`):(this.size=z,this._register(T.event(i=>{this.size=i,this.layout()}))),this._register(C.event(i=>this.hoverDelay=i)),this.layoutProvider=t,this.orthogonalStartSash=n.orthogonalStartSash,this.orthogonalEndSash=n.orthogonalEndSash,this.orientation=n.orientation||0,this.orientation===1?(this.el.classList.add("horizontal"),this.el.classList.remove("vertical")):(this.el.classList.remove("horizontal"),this.el.classList.add("vertical")),this.el.classList.toggle("debug",$),this.layout()}onPointerStart(e,t){P.stop(e);let n=!1;if(!e.__orthogonalSashEvent){const s=this.getOrthogonalSash(e);s&&(n=!0,e.__orthogonalSashEvent=!0,s.onPointerStart(e,new E(t)))}if(this.linkedSash&&!e.__linkedSashEvent&&(e.__linkedSashEvent=!0,this.linkedSash.onPointerStart(e,new E(t))),!this.state)return;const o=this.el.ownerDocument.getElementsByTagName("iframe");for(const s of o)s.classList.add(O);const h=e.pageX,d=e.pageY,c=e.altKey,D={startX:h,currentX:h,startY:d,currentY:d,altKey:c};this.el.classList.add("active"),this._onDidStart.fire(D);const m=Y(this.el),g=()=>{let s="";n?s="all-scroll":this.orientation===1?this.state===1?s="s-resize":this.state===2?s="n-resize":s=b?"row-resize":"ns-resize":this.state===1?s="e-resize":this.state===2?s="w-resize":s=b?"col-resize":"ew-resize",m.textContent=`* { cursor: ${s} !important; }`},i=new u;g(),n||this.onDidEnablementChange.event(g,null,i);const V=s=>{P.stop(s,!1);const y={startX:h,currentX:s.pageX,startY:d,currentY:s.pageY,altKey:c};this._onDidChange.fire(y)},A=s=>{P.stop(s,!1),m.remove(),this.el.classList.remove("active"),this._onDidEnd.fire(),i.dispose();for(const y of o)y.classList.remove(O)};t.onPointerMove(V,null,i),t.onPointerUp(A,null,i),i.add(t)}onPointerDoublePress(e){const t=this.getOrthogonalSash(e);t&&t._onDidReset.fire(),this.linkedSash&&this.linkedSash._onDidReset.fire(),this._onDidReset.fire()}static onMouseEnter(e,t=!1){e.el.classList.contains("active")?(e.hoverDelayer.cancel(),e.el.classList.add("hover")):e.hoverDelayer.trigger(()=>e.el.classList.add("hover"),e.hoverDelay).then(void 0,()=>{}),!t&&e.linkedSash&&l.onMouseEnter(e.linkedSash,!0)}static onMouseLeave(e,t=!1){e.hoverDelayer.cancel(),e.el.classList.remove("hover"),!t&&e.linkedSash&&l.onMouseLeave(e.linkedSash,!0)}clearSashHoverState(){l.onMouseLeave(this)}layout(){if(this.orientation===0){const e=this.layoutProvider;this.el.style.left=e.getVerticalSashLeft(this)-this.size/2+"px",e.getVerticalSashTop&&(this.el.style.top=e.getVerticalSashTop(this)+"px"),e.getVerticalSashHeight&&(this.el.style.height=e.getVerticalSashHeight(this)+"px")}else{const e=this.layoutProvider;this.el.style.top=e.getHorizontalSashTop(this)-this.size/2+"px",e.getHorizontalSashLeft&&(this.el.style.left=e.getHorizontalSashLeft(this)+"px"),e.getHorizontalSashWidth&&(this.el.style.width=e.getHorizontalSashWidth(this)+"px")}}getOrthogonalSash(e){const t=e.initialTarget??e.target;if(!(!t||!N(t))&&t.classList.contains("orthogonal-drag-handle"))return t.classList.contains("start")?this.orthogonalStartSash:this.orthogonalEndSash}dispose(){super.dispose(),this.el.remove()}}export{K as Orientation,G as OrthogonalEdge,l as Sash,Z as SashState,ie as setGlobalHoverDelay,se as setGlobalSashSize};
