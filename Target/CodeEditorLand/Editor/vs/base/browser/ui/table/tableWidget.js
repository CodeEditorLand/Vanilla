import{Emitter as I,Event as T}from"../../../common/event.js";import{Disposable as E,DisposableStore as y}from"../../../common/lifecycle.js";import{ScrollbarVisibility as R}from"../../../common/scrollable.js";import{$ as d,append as h,clearNode as f,createStyleSheet as D,getContentHeight as M,getContentWidth as C}from"../../dom.js";import{getBaseLayerHoverDelegate as S}from"../hover/hoverDelegate2.js";import{getDefaultHoverDelegate as L}from"../hover/hoverDelegateFactory.js";import{List as H,unthemedListStyles as x}from"../list/listWidget.js";import{Orientation as O,SplitView as N}from"../splitview/splitview.js";import"./table.css";class m{constructor(e,t,i){this.columns=e;this.getColumnSize=i;const l=new Map(t.map(o=>[o.templateId,o]));this.renderers=[];for(const o of e){const n=l.get(o.templateId);if(!n)throw new Error(`Table cell renderer for template id ${o.templateId} not found.`);this.renderers.push(n)}}static TemplateId="row";templateId=m.TemplateId;renderers;renderedTemplates=new Set;renderTemplate(e){const t=h(e,d(".monaco-table-tr")),i=[],l=[];for(let n=0;n<this.columns.length;n++){const r=this.renderers[n],a=h(t,d(".monaco-table-td",{"data-col-index":n}));a.style.width=`${this.getColumnSize(n)}px`,i.push(a),l.push(r.renderTemplate(a))}const o={container:e,cellContainers:i,cellTemplateData:l};return this.renderedTemplates.add(o),o}renderElement(e,t,i,l){for(let o=0;o<this.columns.length;o++){const r=this.columns[o].project(e);this.renderers[o].renderElement(r,t,i.cellTemplateData[o],l)}}disposeElement(e,t,i,l){for(let o=0;o<this.columns.length;o++){const n=this.renderers[o];if(n.disposeElement){const a=this.columns[o].project(e);n.disposeElement(a,t,i.cellTemplateData[o],l)}}}disposeTemplate(e){for(let t=0;t<this.columns.length;t++)this.renderers[t].disposeTemplate(e.cellTemplateData[t]);f(e.container),this.renderedTemplates.delete(e)}layoutColumn(e,t){for(const{cellContainers:i}of this.renderedTemplates)i[e].style.width=`${t}px`}}function V(c){return{getHeight(e){return c.getHeight(e)},getTemplateId(){return m.TemplateId}}}class F extends E{constructor(t,i){super();this.column=t;this.index=i;this.element=d(".monaco-table-th",{"data-col-index":i},t.label),t.tooltip&&this._register(S().setupManagedHover(L("mouse"),this.element,t.tooltip))}element;get minimumSize(){return this.column.minimumWidth??120}get maximumSize(){return this.column.maximumWidth??Number.POSITIVE_INFINITY}get onDidChange(){return this.column.onDidChangeWidthConstraints??T.None}_onDidLayout=new I;onDidLayout=this._onDidLayout.event;layout(t){this._onDidLayout.fire([this.index,t])}}class v{constructor(e,t,i,l,o,n){this.virtualDelegate=i;this.columns=l;this.domNode=h(t,d(`.monaco-table.${this.domId}`));const r=l.map((s,u)=>this.disposables.add(new F(s,u))),a={size:r.reduce((s,u)=>s+u.column.weight,0),views:r.map(s=>({size:s.column.weight,view:s}))};this.splitview=this.disposables.add(new N(this.domNode,{orientation:O.HORIZONTAL,scrollbarVisibility:R.Hidden,getSashOrthogonalSize:()=>this.cachedHeight,descriptor:a})),this.splitview.el.style.height=`${i.headerRowHeight}px`,this.splitview.el.style.lineHeight=`${i.headerRowHeight}px`;const p=new m(l,o,s=>this.splitview.getViewSize(s));this.list=this.disposables.add(new H(e,this.domNode,V(i),[p],n)),T.any(...r.map(s=>s.onDidLayout))(([s,u])=>p.layoutColumn(s,u),null,this.disposables),this.splitview.onDidSashReset(s=>{const u=l.reduce((b,w)=>b+w.weight,0),g=l[s].weight/u*this.cachedWidth;this.splitview.resizeView(s,g)},null,this.disposables),this.styleElement=D(this.domNode),this.style(x)}static InstanceCount=0;domId=`table_id_${++v.InstanceCount}`;domNode;splitview;list;styleElement;disposables=new y;cachedWidth=0;cachedHeight=0;get onDidChangeFocus(){return this.list.onDidChangeFocus}get onDidChangeSelection(){return this.list.onDidChangeSelection}get onDidScroll(){return this.list.onDidScroll}get onMouseClick(){return this.list.onMouseClick}get onMouseDblClick(){return this.list.onMouseDblClick}get onMouseMiddleClick(){return this.list.onMouseMiddleClick}get onPointer(){return this.list.onPointer}get onMouseUp(){return this.list.onMouseUp}get onMouseDown(){return this.list.onMouseDown}get onMouseOver(){return this.list.onMouseOver}get onMouseMove(){return this.list.onMouseMove}get onMouseOut(){return this.list.onMouseOut}get onTouchStart(){return this.list.onTouchStart}get onTap(){return this.list.onTap}get onContextMenu(){return this.list.onContextMenu}get onDidFocus(){return this.list.onDidFocus}get onDidBlur(){return this.list.onDidBlur}get scrollTop(){return this.list.scrollTop}set scrollTop(e){this.list.scrollTop=e}get scrollLeft(){return this.list.scrollLeft}set scrollLeft(e){this.list.scrollLeft=e}get scrollHeight(){return this.list.scrollHeight}get renderHeight(){return this.list.renderHeight}get onDidDispose(){return this.list.onDidDispose}getColumnLabels(){return this.columns.map(e=>e.label)}resizeColumn(e,t){const i=Math.round(t/100*this.cachedWidth);this.splitview.resizeView(e,i)}updateOptions(e){this.list.updateOptions(e)}splice(e,t,i=[]){this.list.splice(e,t,i)}rerender(){this.list.rerender()}row(e){return this.list.element(e)}indexOf(e){return this.list.indexOf(e)}get length(){return this.list.length}getHTMLElement(){return this.domNode}layout(e,t){e=e??M(this.domNode),t=t??C(this.domNode),this.cachedWidth=t,this.cachedHeight=e,this.splitview.layout(t);const i=e-this.virtualDelegate.headerRowHeight;this.list.getHTMLElement().style.height=`${i}px`,this.list.layout(i,t)}triggerTypeNavigation(){this.list.triggerTypeNavigation()}style(e){const t=[];t.push(`.monaco-table.${this.domId} > .monaco-split-view2 .monaco-sash.vertical::before {
			top: ${this.virtualDelegate.headerRowHeight+1}px;
			height: calc(100% - ${this.virtualDelegate.headerRowHeight}px);
		}`),this.styleElement.textContent=t.join(`
`),this.list.style(e)}domFocus(){this.list.domFocus()}setAnchor(e){this.list.setAnchor(e)}getAnchor(){return this.list.getAnchor()}getSelectedElements(){return this.list.getSelectedElements()}setSelection(e,t){this.list.setSelection(e,t)}getSelection(){return this.list.getSelection()}setFocus(e,t){this.list.setFocus(e,t)}focusNext(e=1,t=!1,i){this.list.focusNext(e,t,i)}focusPrevious(e=1,t=!1,i){this.list.focusPrevious(e,t,i)}focusNextPage(e){return this.list.focusNextPage(e)}focusPreviousPage(e){return this.list.focusPreviousPage(e)}focusFirst(e){this.list.focusFirst(e)}focusLast(e){this.list.focusLast(e)}getFocus(){return this.list.getFocus()}getFocusedElements(){return this.list.getFocusedElements()}getRelativeTop(e){return this.list.getRelativeTop(e)}reveal(e,t){this.list.reveal(e,t)}dispose(){this.disposables.dispose()}}export{v as Table};
