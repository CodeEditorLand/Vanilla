import*as i from"../../dom.js";import"../../mouseEvent.js";import{DomScrollableElement as u}from"../scrollbar/scrollableElement.js";import{commonPrefixLength as h}from"../../../common/arrays.js";import{ThemeIcon as _}from"../../../common/themables.js";import{Emitter as a}from"../../../common/event.js";import{DisposableStore as l,dispose as b}from"../../../common/lifecycle.js";import{ScrollbarVisibility as c}from"../../../common/scrollable.js";import"./breadcrumbsWidget.css";class L{}class N{_disposables=new l;_domNode;_scrollable;_onDidSelectItem=new a;_onDidFocusItem=new a;_onDidChangeFocus=new a;onDidSelectItem=this._onDidSelectItem.event;onDidFocusItem=this._onDidFocusItem.event;onDidChangeFocus=this._onDidChangeFocus.event;_items=new Array;_nodes=new Array;_freeNodes=new Array;_separatorIcon;_enabled=!0;_focusedItemIdx=-1;_selectedItemIdx=-1;_pendingDimLayout;_pendingLayout;_dimension;constructor(e,s,t,o){this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs",this._domNode.tabIndex=0,this._domNode.setAttribute("role","list"),this._scrollable=new u(this._domNode,{vertical:c.Hidden,horizontal:c.Auto,horizontalScrollbarSize:s,useShadows:!1,scrollYToX:!0}),this._separatorIcon=t,this._disposables.add(this._scrollable),this._disposables.add(i.addStandardDisposableListener(this._domNode,"click",n=>this._onClick(n))),e.appendChild(this._scrollable.getDomNode());const d=i.createStyleSheet(this._domNode);this._style(d,o);const r=i.trackFocus(this._domNode);this._disposables.add(r),this._disposables.add(r.onDidBlur(n=>this._onDidChangeFocus.fire(!1))),this._disposables.add(r.onDidFocus(n=>this._onDidChangeFocus.fire(!0)))}setHorizontalScrollbarSize(e){this._scrollable.updateOptions({horizontalScrollbarSize:e})}dispose(){this._disposables.dispose(),this._pendingLayout?.dispose(),this._pendingDimLayout?.dispose(),this._onDidSelectItem.dispose(),this._onDidFocusItem.dispose(),this._onDidChangeFocus.dispose(),this._domNode.remove(),this._nodes.length=0,this._freeNodes.length=0}layout(e){e&&i.Dimension.equals(e,this._dimension)||(e?(this._pendingDimLayout?.dispose(),this._pendingDimLayout=this._updateDimensions(e)):(this._pendingLayout?.dispose(),this._pendingLayout=this._updateScrollbar()))}_updateDimensions(e){const s=new l;return s.add(i.modify(i.getWindow(this._domNode),()=>{this._dimension=e,this._domNode.style.width=`${e.width}px`,this._domNode.style.height=`${e.height}px`,s.add(this._updateScrollbar())})),s}_updateScrollbar(){return i.measure(i.getWindow(this._domNode),()=>{i.measure(i.getWindow(this._domNode),()=>{this._scrollable.setRevealOnScroll(!1),this._scrollable.scanDomNode(),this._scrollable.setRevealOnScroll(!0)})})}_style(e,s){let t="";s.breadcrumbsBackground&&(t+=`.monaco-breadcrumbs { background-color: ${s.breadcrumbsBackground}}`),s.breadcrumbsForeground&&(t+=`.monaco-breadcrumbs .monaco-breadcrumb-item { color: ${s.breadcrumbsForeground}}
`),s.breadcrumbsFocusForeground&&(t+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused { color: ${s.breadcrumbsFocusForeground}}
`),s.breadcrumbsFocusAndSelectionForeground&&(t+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused.selected { color: ${s.breadcrumbsFocusAndSelectionForeground}}
`),s.breadcrumbsHoverForeground&&(t+=`.monaco-breadcrumbs:not(.disabled	) .monaco-breadcrumb-item:hover:not(.focused):not(.selected) { color: ${s.breadcrumbsHoverForeground}}
`),e.innerText=t}setEnabled(e){this._enabled=e,this._domNode.classList.toggle("disabled",!this._enabled)}domFocus(){const e=this._focusedItemIdx>=0?this._focusedItemIdx:this._items.length-1;e>=0&&e<this._items.length?this._focus(e,void 0):this._domNode.focus()}isDOMFocused(){return i.isAncestorOfActiveElement(this._domNode)}getFocused(){return this._items[this._focusedItemIdx]}setFocused(e,s){this._focus(this._items.indexOf(e),s)}focusPrev(e){this._focusedItemIdx>0&&this._focus(this._focusedItemIdx-1,e)}focusNext(e){this._focusedItemIdx+1<this._nodes.length&&this._focus(this._focusedItemIdx+1,e)}_focus(e,s){this._focusedItemIdx=-1;for(let t=0;t<this._nodes.length;t++){const o=this._nodes[t];t!==e?o.classList.remove("focused"):(this._focusedItemIdx=t,o.classList.add("focused"),o.focus())}this._reveal(this._focusedItemIdx,!0),this._onDidFocusItem.fire({type:"focus",item:this._items[this._focusedItemIdx],node:this._nodes[this._focusedItemIdx],payload:s})}reveal(e){const s=this._items.indexOf(e);s>=0&&this._reveal(s,!1)}revealLast(){this._reveal(this._items.length-1,!1)}_reveal(e,s){if(e<0||e>=this._nodes.length)return;const t=this._nodes[e];if(!t)return;const{width:o}=this._scrollable.getScrollDimensions(),{scrollLeft:d}=this._scrollable.getScrollPosition();(!s||t.offsetLeft>d+o||t.offsetLeft<d)&&(this._scrollable.setRevealOnScroll(!1),this._scrollable.setScrollPosition({scrollLeft:t.offsetLeft}),this._scrollable.setRevealOnScroll(!0))}getSelection(){return this._items[this._selectedItemIdx]}setSelection(e,s){this._select(this._items.indexOf(e),s)}_select(e,s){this._selectedItemIdx=-1;for(let t=0;t<this._nodes.length;t++){const o=this._nodes[t];t!==e?o.classList.remove("selected"):(this._selectedItemIdx=t,o.classList.add("selected"))}this._onDidSelectItem.fire({type:"select",item:this._items[this._selectedItemIdx],node:this._nodes[this._selectedItemIdx],payload:s})}getItems(){return this._items}setItems(e){let s,t=[];try{s=h(this._items,e,(o,d)=>o.equals(d)),t=this._items.splice(s,this._items.length-s,...e.slice(s)),this._render(s),b(t),this._focus(-1,void 0)}catch(o){const d=new Error(`BreadcrumbsItem#setItems: newItems: ${e.length}, prefix: ${s}, removed: ${t.length}`);throw d.name=o.name,d.stack=o.stack,d}}_render(e){let s=!1;for(;e<this._items.length&&e<this._nodes.length;e++){const t=this._items[e],o=this._nodes[e];this._renderItem(t,o),s=!0}for(;e<this._nodes.length;){const t=this._nodes.pop();t&&(this._freeNodes.push(t),t.remove(),s=!0)}for(;e<this._items.length;e++){const t=this._items[e],o=this._freeNodes.length>0?this._freeNodes.pop():document.createElement("div");o&&(this._renderItem(t,o),this._domNode.appendChild(o),this._nodes.push(o),s=!0)}s&&this.layout(void 0)}_renderItem(e,s){i.clearNode(s),s.className="";try{e.render(s)}catch(o){s.innerText="<<RENDER ERROR>>",console.error(o)}s.tabIndex=-1,s.setAttribute("role","listitem"),s.classList.add("monaco-breadcrumb-item");const t=i.$(_.asCSSSelector(this._separatorIcon));s.appendChild(t)}_onClick(e){if(this._enabled)for(let s=e.target;s;s=s.parentElement){const t=this._nodes.indexOf(s);if(t>=0){this._focus(t,e),this._select(t,e);break}}}}export{L as BreadcrumbsItem,N as BreadcrumbsWidget};
