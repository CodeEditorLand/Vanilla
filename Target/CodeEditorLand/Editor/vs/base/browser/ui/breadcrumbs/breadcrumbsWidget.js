import{commonPrefixLength as u}from"../../../common/arrays.js";import{Emitter as a}from"../../../common/event.js";import{DisposableStore as l,dispose as h}from"../../../common/lifecycle.js";import{ScrollbarVisibility as c}from"../../../common/scrollable.js";import{ThemeIcon as _}from"../../../common/themables.js";import*as i from"../../dom.js";import{DomScrollableElement as b}from"../scrollbar/scrollableElement.js";import"./breadcrumbsWidget.css";class x{}class S{_disposables=new l;_domNode;_scrollable;_onDidSelectItem=new a;_onDidFocusItem=new a;_onDidChangeFocus=new a;onDidSelectItem=this._onDidSelectItem.event;onDidFocusItem=this._onDidFocusItem.event;onDidChangeFocus=this._onDidChangeFocus.event;_items=new Array;_nodes=new Array;_freeNodes=new Array;_separatorIcon;_enabled=!0;_focusedItemIdx=-1;_selectedItemIdx=-1;_pendingDimLayout;_pendingLayout;_dimension;constructor(e,t,s,o){this._domNode=document.createElement("div"),this._domNode.className="monaco-breadcrumbs",this._domNode.tabIndex=0,this._domNode.setAttribute("role","list"),this._scrollable=new b(this._domNode,{vertical:c.Hidden,horizontal:c.Auto,horizontalScrollbarSize:t,useShadows:!1,scrollYToX:!0}),this._separatorIcon=s,this._disposables.add(this._scrollable),this._disposables.add(i.addStandardDisposableListener(this._domNode,"click",n=>this._onClick(n))),e.appendChild(this._scrollable.getDomNode());const d=i.createStyleSheet(this._domNode);this._style(d,o);const r=i.trackFocus(this._domNode);this._disposables.add(r),this._disposables.add(r.onDidBlur(n=>this._onDidChangeFocus.fire(!1))),this._disposables.add(r.onDidFocus(n=>this._onDidChangeFocus.fire(!0)))}setHorizontalScrollbarSize(e){this._scrollable.updateOptions({horizontalScrollbarSize:e})}dispose(){this._disposables.dispose(),this._pendingLayout?.dispose(),this._pendingDimLayout?.dispose(),this._onDidSelectItem.dispose(),this._onDidFocusItem.dispose(),this._onDidChangeFocus.dispose(),this._domNode.remove(),this._nodes.length=0,this._freeNodes.length=0}layout(e){e&&i.Dimension.equals(e,this._dimension)||(e?(this._pendingDimLayout?.dispose(),this._pendingDimLayout=this._updateDimensions(e)):(this._pendingLayout?.dispose(),this._pendingLayout=this._updateScrollbar()))}_updateDimensions(e){const t=new l;return t.add(i.modify(i.getWindow(this._domNode),()=>{this._dimension=e,this._domNode.style.width=`${e.width}px`,this._domNode.style.height=`${e.height}px`,t.add(this._updateScrollbar())})),t}_updateScrollbar(){return i.measure(i.getWindow(this._domNode),()=>{i.measure(i.getWindow(this._domNode),()=>{this._scrollable.setRevealOnScroll(!1),this._scrollable.scanDomNode(),this._scrollable.setRevealOnScroll(!0)})})}_style(e,t){let s="";t.breadcrumbsBackground&&(s+=`.monaco-breadcrumbs { background-color: ${t.breadcrumbsBackground}}`),t.breadcrumbsForeground&&(s+=`.monaco-breadcrumbs .monaco-breadcrumb-item { color: ${t.breadcrumbsForeground}}
`),t.breadcrumbsFocusForeground&&(s+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused { color: ${t.breadcrumbsFocusForeground}}
`),t.breadcrumbsFocusAndSelectionForeground&&(s+=`.monaco-breadcrumbs .monaco-breadcrumb-item.focused.selected { color: ${t.breadcrumbsFocusAndSelectionForeground}}
`),t.breadcrumbsHoverForeground&&(s+=`.monaco-breadcrumbs:not(.disabled	) .monaco-breadcrumb-item:hover:not(.focused):not(.selected) { color: ${t.breadcrumbsHoverForeground}}
`),e.innerText=s}setEnabled(e){this._enabled=e,this._domNode.classList.toggle("disabled",!this._enabled)}domFocus(){const e=this._focusedItemIdx>=0?this._focusedItemIdx:this._items.length-1;e>=0&&e<this._items.length?this._focus(e,void 0):this._domNode.focus()}isDOMFocused(){return i.isAncestorOfActiveElement(this._domNode)}getFocused(){return this._items[this._focusedItemIdx]}setFocused(e,t){this._focus(this._items.indexOf(e),t)}focusPrev(e){this._focusedItemIdx>0&&this._focus(this._focusedItemIdx-1,e)}focusNext(e){this._focusedItemIdx+1<this._nodes.length&&this._focus(this._focusedItemIdx+1,e)}_focus(e,t){this._focusedItemIdx=-1;for(let s=0;s<this._nodes.length;s++){const o=this._nodes[s];s!==e?o.classList.remove("focused"):(this._focusedItemIdx=s,o.classList.add("focused"),o.focus())}this._reveal(this._focusedItemIdx,!0),this._onDidFocusItem.fire({type:"focus",item:this._items[this._focusedItemIdx],node:this._nodes[this._focusedItemIdx],payload:t})}reveal(e){const t=this._items.indexOf(e);t>=0&&this._reveal(t,!1)}revealLast(){this._reveal(this._items.length-1,!1)}_reveal(e,t){if(e<0||e>=this._nodes.length)return;const s=this._nodes[e];if(!s)return;const{width:o}=this._scrollable.getScrollDimensions(),{scrollLeft:d}=this._scrollable.getScrollPosition();(!t||s.offsetLeft>d+o||s.offsetLeft<d)&&(this._scrollable.setRevealOnScroll(!1),this._scrollable.setScrollPosition({scrollLeft:s.offsetLeft}),this._scrollable.setRevealOnScroll(!0))}getSelection(){return this._items[this._selectedItemIdx]}setSelection(e,t){this._select(this._items.indexOf(e),t)}_select(e,t){this._selectedItemIdx=-1;for(let s=0;s<this._nodes.length;s++){const o=this._nodes[s];s!==e?o.classList.remove("selected"):(this._selectedItemIdx=s,o.classList.add("selected"))}this._onDidSelectItem.fire({type:"select",item:this._items[this._selectedItemIdx],node:this._nodes[this._selectedItemIdx],payload:t})}getItems(){return this._items}setItems(e){let t,s=[];try{t=u(this._items,e,(o,d)=>o.equals(d)),s=this._items.splice(t,this._items.length-t,...e.slice(t)),this._render(t),h(s),this._focus(-1,void 0)}catch(o){const d=new Error(`BreadcrumbsItem#setItems: newItems: ${e.length}, prefix: ${t}, removed: ${s.length}`);throw d.name=o.name,d.stack=o.stack,d}}_render(e){let t=!1;for(;e<this._items.length&&e<this._nodes.length;e++){const s=this._items[e],o=this._nodes[e];this._renderItem(s,o),t=!0}for(;e<this._nodes.length;){const s=this._nodes.pop();s&&(this._freeNodes.push(s),s.remove(),t=!0)}for(;e<this._items.length;e++){const s=this._items[e],o=this._freeNodes.length>0?this._freeNodes.pop():document.createElement("div");o&&(this._renderItem(s,o),this._domNode.appendChild(o),this._nodes.push(o),t=!0)}t&&this.layout(void 0)}_renderItem(e,t){i.clearNode(t),t.className="";try{e.render(t)}catch{t.innerText="<<RENDER ERROR>>"}t.tabIndex=-1,t.setAttribute("role","listitem"),t.classList.add("monaco-breadcrumb-item");const s=i.$(_.asCSSSelector(this._separatorIcon));t.appendChild(s)}_onClick(e){if(this._enabled)for(let t=e.target;t;t=t.parentElement){const s=this._nodes.indexOf(t);if(s>=0){this._focus(s,e),this._select(s,e);break}}}}export{x as BreadcrumbsItem,S as BreadcrumbsWidget};
