import*as m from"../../../../nls.js";import{Action as u}from"../../../common/actions.js";import{Codicon as h}from"../../../common/codicons.js";import{Emitter as A}from"../../../common/event.js";import"../../../common/keybindings.js";import{KeyCode as a}from"../../../common/keyCodes.js";import"../../../common/lifecycle.js";import{ThemeIcon as w}from"../../../common/themables.js";import"../../contextmenu.js";import{$ as I,addDisposableListener as v,append as c,EventType as g,h as l}from"../../dom.js";import{StandardKeyboardEvent as f}from"../../keyboardEvent.js";import"../actionbar/actionbar.js";import{ActionViewItem as b,BaseActionViewItem as M}from"../actionbar/actionViewItems.js";import"../contextview/contextview.js";import{DropdownMenu as y}from"./dropdown.js";import"./dropdown.css";import{getBaseLayerHoverDelegate as P}from"../hover/hoverDelegate2.js";import{getDefaultHoverDelegate as V}from"../hover/hoverDelegateFactory.js";class D extends M{menuActionsOrProvider;dropdownMenu;contextMenuProvider;actionItem=null;_onDidChangeVisibility=this._register(new A);onDidChangeVisibility=this._onDidChangeVisibility.event;options;constructor(e,i,n,r=Object.create(null)){super(null,e,r),this.menuActionsOrProvider=i,this.contextMenuProvider=n,this.options=r,this.options.actionRunner&&(this.actionRunner=this.options.actionRunner)}render(e){this.actionItem=e;const i=o=>{this.element=c(o,I("a.action-label"));let t=[];return typeof this.options.classNames=="string"?t=this.options.classNames.split(/\s+/g).filter(s=>!!s):this.options.classNames&&(t=this.options.classNames),t.find(s=>s==="icon")||t.push("codicon"),this.element.classList.add(...t),this.element.setAttribute("role","button"),this.element.setAttribute("aria-haspopup","true"),this.element.setAttribute("aria-expanded","false"),this._action.label&&this._register(P().setupManagedHover(this.options.hoverDelegate??V("mouse"),this.element,this._action.label)),this.element.ariaLabel=this._action.label||"",null},n=Array.isArray(this.menuActionsOrProvider),r={contextMenuProvider:this.contextMenuProvider,labelRenderer:i,menuAsChild:this.options.menuAsChild,actions:n?this.menuActionsOrProvider:void 0,actionProvider:n?void 0:this.menuActionsOrProvider,skipTelemetry:this.options.skipTelemetry};if(this.dropdownMenu=this._register(new y(e,r)),this._register(this.dropdownMenu.onDidChangeVisibility(o=>{this.element?.setAttribute("aria-expanded",`${o}`),this._onDidChangeVisibility.fire(o)})),this.dropdownMenu.menuOptions={actionViewItemProvider:this.options.actionViewItemProvider,actionRunner:this.actionRunner,getKeyBinding:this.options.keybindingProvider,context:this._context},this.options.anchorAlignmentProvider){const o=this;this.dropdownMenu.menuOptions={...this.dropdownMenu.menuOptions,get anchorAlignment(){return o.options.anchorAlignmentProvider()}}}this.updateTooltip(),this.updateEnabled()}getTooltip(){let e=null;return this.action.tooltip?e=this.action.tooltip:this.action.label&&(e=this.action.label),e??void 0}setActionContext(e){super.setActionContext(e),this.dropdownMenu&&(this.dropdownMenu.menuOptions?this.dropdownMenu.menuOptions.context=e:this.dropdownMenu.menuOptions={context:e})}show(){this.dropdownMenu?.show()}updateEnabled(){const e=!this.action.enabled;this.actionItem?.classList.toggle("disabled",e),this.element?.classList.toggle("disabled",e)}}class ie extends b{constructor(i,n,r,o){super(i,n,r);this.contextMenuProvider=o}dropdownMenuActionViewItem;render(i){if(super.render(i),this.element){this.element.classList.add("action-dropdown-item");const n={getActions:()=>{const t=this.options.menuActionsOrProvider;return Array.isArray(t)?t:t.getActions()}},r=this.options.menuActionClassNames||[],o=l("div.action-dropdown-item-separator",[l("div",{})]).root;o.classList.toggle("prominent",r.includes("prominent")),c(this.element,o),this.dropdownMenuActionViewItem=this._register(new D(this._register(new u("dropdownAction",m.localize("moreActions","More Actions..."))),n,this.contextMenuProvider,{classNames:["dropdown",...w.asClassNameArray(h.dropDownButton),...r],hoverDelegate:this.options.hoverDelegate})),this.dropdownMenuActionViewItem.render(this.element),this._register(v(this.element,g.KEY_DOWN,t=>{if(n.getActions().length===0)return;const s=new f(t);let d=!1;this.dropdownMenuActionViewItem?.isFocused()&&s.equals(a.LeftArrow)?(d=!0,this.dropdownMenuActionViewItem?.blur(),this.focus()):this.isFocused()&&s.equals(a.RightArrow)&&(d=!0,this.blur(),this.dropdownMenuActionViewItem?.focus()),d&&(s.preventDefault(),s.stopPropagation())}))}}blur(){super.blur(),this.dropdownMenuActionViewItem?.blur()}setFocusable(i){super.setFocusable(i),this.dropdownMenuActionViewItem?.setFocusable(i)}}export{ie as ActionWithDropdownActionViewItem,D as DropdownMenuActionViewItem};
