import{Action as p,ActionRunner as b,Separator as m}from"../../../common/actions.js";import{Disposable as f}from"../../../common/lifecycle.js";import*as v from"../../../common/platform.js";import*as c from"../../../common/types.js";import{isFirefox as g}from"../../browser.js";import{DataTransfers as I}from"../../dnd.js";import{addDisposableListener as n,EventHelper as a,EventType as l}from"../../dom.js";import{Gesture as x,EventType as A}from"../../touch.js";import"../contextview/contextview.js";import"../hover/hoverDelegate.js";import{getDefaultHoverDelegate as L}from"../hover/hoverDelegateFactory.js";import{SelectBox as C}from"../selectBox/selectBox.js";import"../toggle/toggle.js";import"./actionbar.js";import"./actionbar.css";import*as T from"../../../../nls.js";import{getBaseLayerHoverDelegate as _}from"../hover/hoverDelegate2.js";class h extends f{constructor(e,i,o={}){super();this.options=o;this._context=e||this,this._action=i,i instanceof p&&this._register(i.onDidChange(s=>{this.element&&this.handleActionChangeEvent(s)}))}element;_context;_action;customHover;get action(){return this._action}_actionRunner;handleActionChangeEvent(e){e.enabled!==void 0&&this.updateEnabled(),e.checked!==void 0&&this.updateChecked(),e.class!==void 0&&this.updateClass(),e.label!==void 0&&(this.updateLabel(),this.updateTooltip()),e.tooltip!==void 0&&this.updateTooltip()}get actionRunner(){return this._actionRunner||(this._actionRunner=this._register(new b)),this._actionRunner}set actionRunner(e){this._actionRunner=e}isEnabled(){return this._action.enabled}setActionContext(e){this._context=e}render(e){const i=this.element=e;this._register(x.addTarget(e));const o=this.options&&this.options.draggable;o&&(e.draggable=!0,g&&this._register(n(e,l.DRAG_START,s=>s.dataTransfer?.setData(I.TEXT,this._action.label)))),this._register(n(i,A.Tap,s=>this.onClick(s,!0))),this._register(n(i,l.MOUSE_DOWN,s=>{o||a.stop(s,!0),this._action.enabled&&s.button===0&&i.classList.add("active")})),v.isMacintosh&&this._register(n(i,l.CONTEXT_MENU,s=>{s.button===0&&s.ctrlKey===!0&&this.onClick(s)})),this._register(n(i,l.CLICK,s=>{a.stop(s,!0),this.options&&this.options.isMenu||this.onClick(s)})),this._register(n(i,l.DBLCLICK,s=>{a.stop(s,!0)})),[l.MOUSE_UP,l.MOUSE_OUT].forEach(s=>{this._register(n(i,s,r=>{a.stop(r),i.classList.remove("active")}))})}onClick(e,i=!1){a.stop(e,!0);const o=c.isUndefinedOrNull(this._context)?this.options?.useEventAsContext?e:{preserveFocus:i}:this._context;this.actionRunner.run(this._action,o)}focus(){this.element&&(this.element.tabIndex=0,this.element.focus(),this.element.classList.add("focused"))}isFocused(){return!!this.element?.classList.contains("focused")}blur(){this.element&&(this.element.blur(),this.element.tabIndex=-1,this.element.classList.remove("focused"))}setFocusable(e){this.element&&(this.element.tabIndex=e?0:-1)}get trapsArrowNavigation(){return!1}updateEnabled(){}updateLabel(){}getClass(){return this.action.class}getTooltip(){return this.action.tooltip}updateTooltip(){if(!this.element)return;const e=this.getTooltip()??"";if(this.updateAriaLabel(),this.options.hoverDelegate?.showNativeHover)this.element.title=e;else if(!this.customHover&&e!==""){const i=this.options.hoverDelegate??L("element");this.customHover=this._store.add(_().setupManagedHover(i,this.element,e))}else this.customHover&&this.customHover.update(e)}updateAriaLabel(){if(this.element){const e=this.getTooltip()??"";this.element.setAttribute("aria-label",e)}}updateClass(){}updateChecked(){}dispose(){this.element&&(this.element.remove(),this.element=void 0),this._context=void 0,super.dispose()}}class Y extends h{label;options;cssClass;constructor(t,e,i){super(t,e,i),this.options=i,this.options.icon=i.icon!==void 0?i.icon:!1,this.options.label=i.label!==void 0?i.label:!0,this.cssClass=""}render(t){super.render(t),c.assertType(this.element);const e=document.createElement("a");if(e.classList.add("action-label"),e.setAttribute("role",this.getDefaultAriaRole()),this.label=e,this.element.appendChild(e),this.options.label&&this.options.keybinding){const i=document.createElement("span");i.classList.add("keybinding"),i.textContent=this.options.keybinding,this.element.appendChild(i)}this.updateClass(),this.updateLabel(),this.updateTooltip(),this.updateEnabled(),this.updateChecked()}getDefaultAriaRole(){return this._action.id===m.ID?"presentation":this.options.isMenu?"menuitem":this.options.isTabList?"tab":"button"}focus(){this.label&&(this.label.tabIndex=0,this.label.focus())}isFocused(){return!!this.label&&this.label?.tabIndex===0}blur(){this.label&&(this.label.tabIndex=-1)}setFocusable(t){this.label&&(this.label.tabIndex=t?0:-1)}updateLabel(){this.options.label&&this.label&&(this.label.textContent=this.action.label)}getTooltip(){let t=null;return this.action.tooltip?t=this.action.tooltip:!this.options.label&&this.action.label&&this.options.icon&&(t=this.action.label,this.options.keybinding&&(t=T.localize({key:"titleLabel",comment:["action title","action keybinding"]},"{0} ({1})",t,this.options.keybinding))),t??void 0}updateClass(){this.cssClass&&this.label&&this.label.classList.remove(...this.cssClass.split(" ")),this.options.icon?(this.cssClass=this.getClass(),this.label&&(this.label.classList.add("codicon"),this.cssClass&&this.label.classList.add(...this.cssClass.split(" "))),this.updateEnabled()):this.label?.classList.remove("codicon")}updateEnabled(){this.action.enabled?(this.label&&(this.label.removeAttribute("aria-disabled"),this.label.classList.remove("disabled")),this.element?.classList.remove("disabled")):(this.label&&(this.label.setAttribute("aria-disabled","true"),this.label.classList.add("disabled")),this.element?.classList.add("disabled"))}updateAriaLabel(){if(this.label){const t=this.getTooltip()??"";this.label.setAttribute("aria-label",t)}}updateChecked(){this.label&&(this.action.checked!==void 0?(this.label.classList.toggle("checked",this.action.checked),this.options.isTabList?this.label.setAttribute("aria-selected",this.action.checked?"true":"false"):(this.label.setAttribute("aria-checked",this.action.checked?"true":"false"),this.label.setAttribute("role","checkbox"))):(this.label.classList.remove("checked"),this.label.removeAttribute(this.options.isTabList?"aria-selected":"aria-checked"),this.label.setAttribute("role",this.getDefaultAriaRole())))}}class Z extends h{selectBox;constructor(t,e,i,o,s,r,u){super(t,e),this.selectBox=new C(i,o,s,r,u),this.selectBox.setFocusable(!1),this._register(this.selectBox),this.registerListeners()}setOptions(t,e){this.selectBox.setOptions(t,e)}select(t){this.selectBox.select(t)}registerListeners(){this._register(this.selectBox.onDidSelect(t=>this.runAction(t.selected,t.index)))}runAction(t,e){this.actionRunner.run(this._action,this.getActionContext(t,e))}getActionContext(t,e){return t}setFocusable(t){this.selectBox.setFocusable(t)}focus(){this.selectBox?.focus()}blur(){this.selectBox?.blur()}render(t){this.selectBox.render(t)}}export{Y as ActionViewItem,h as BaseActionViewItem,Z as SelectActionViewItem};
