{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/browser/iframe.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\n/**\n * Represents a window in a possible chain of iframes\n */\ninterface IWindowChainElement {\n\t/**\n\t * The window object for it\n\t */\n\treadonly window: WeakRef<Window>;\n\t/**\n\t * The iframe element inside the window.parent corresponding to window\n\t */\n\treadonly iframeElement: Element | null;\n}\n\nconst sameOriginWindowChainCache = new WeakMap<Window, IWindowChainElement[] | null>();\n\nfunction getParentWindowIfSameOrigin(w: Window): Window | null {\n\tif (!w.parent || w.parent === w) {\n\t\treturn null;\n\t}\n\n\t// Cannot really tell if we have access to the parent window unless we try to access something in it\n\ttry {\n\t\tconst location = w.location;\n\t\tconst parentLocation = w.parent.location;\n\t\tif (location.origin !== 'null' && parentLocation.origin !== 'null' && location.origin !== parentLocation.origin) {\n\t\t\treturn null;\n\t\t}\n\t} catch (e) {\n\t\treturn null;\n\t}\n\n\treturn w.parent;\n}\n\nexport class IframeUtils {\n\n\t/**\n\t * Returns a chain of embedded windows with the same origin (which can be accessed programmatically).\n\t * Having a chain of length 1 might mean that the current execution environment is running outside of an iframe or inside an iframe embedded in a window with a different origin.\n\t */\n\tprivate static getSameOriginWindowChain(targetWindow: Window): IWindowChainElement[] {\n\t\tlet windowChainCache = sameOriginWindowChainCache.get(targetWindow);\n\t\tif (!windowChainCache) {\n\t\t\twindowChainCache = [];\n\t\t\tsameOriginWindowChainCache.set(targetWindow, windowChainCache);\n\t\t\tlet w: Window | null = targetWindow;\n\t\t\tlet parent: Window | null;\n\t\t\tdo {\n\t\t\t\tparent = getParentWindowIfSameOrigin(w);\n\t\t\t\tif (parent) {\n\t\t\t\t\twindowChainCache.push({\n\t\t\t\t\t\twindow: new WeakRef(w),\n\t\t\t\t\t\tiframeElement: w.frameElement || null\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\twindowChainCache.push({\n\t\t\t\t\t\twindow: new WeakRef(w),\n\t\t\t\t\t\tiframeElement: null\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tw = parent;\n\t\t\t} while (w);\n\t\t}\n\t\treturn windowChainCache.slice(0);\n\t}\n\n\t/**\n\t * Returns the position of `childWindow` relative to `ancestorWindow`\n\t */\n\tpublic static getPositionOfChildWindowRelativeToAncestorWindow(childWindow: Window, ancestorWindow: Window | null) {\n\n\t\tif (!ancestorWindow || childWindow === ancestorWindow) {\n\t\t\treturn {\n\t\t\t\ttop: 0,\n\t\t\t\tleft: 0\n\t\t\t};\n\t\t}\n\n\t\tlet top = 0, left = 0;\n\n\t\tconst windowChain = this.getSameOriginWindowChain(childWindow);\n\n\t\tfor (const windowChainEl of windowChain) {\n\t\t\tconst windowInChain = windowChainEl.window.deref();\n\t\t\ttop += windowInChain?.scrollY ?? 0;\n\t\t\tleft += windowInChain?.scrollX ?? 0;\n\n\t\t\tif (windowInChain === ancestorWindow) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tif (!windowChainEl.iframeElement) {\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tconst boundingRect = windowChainEl.iframeElement.getBoundingClientRect();\n\t\t\ttop += boundingRect.top;\n\t\t\tleft += boundingRect.left;\n\t\t}\n\n\t\treturn {\n\t\t\ttop: top,\n\t\t\tleft: left\n\t\t};\n\t}\n}\n\n/**\n * Returns a sha-256 composed of `parentOrigin` and `salt` converted to base 32\n */\nexport async function parentOriginHash(parentOrigin: string, salt: string): Promise<string> {\n\t// This same code is also inlined at `src/vs/workbench/services/extensions/worker/webWorkerExtensionHostIframe.html`\n\tif (!crypto.subtle) {\n\t\tthrow new Error(`'crypto.subtle' is not available so webviews will not work. This is likely because the editor is not running in a secure context (https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts).`);\n\t}\n\n\tconst strData = JSON.stringify({ parentOrigin, salt });\n\tconst encoder = new TextEncoder();\n\tconst arrData = encoder.encode(strData);\n\tconst hash = await crypto.subtle.digest('sha-256', arrData);\n\treturn sha256AsBase32(hash);\n}\n\nfunction sha256AsBase32(bytes: ArrayBuffer): string {\n\tconst array = Array.from(new Uint8Array(bytes));\n\tconst hexArray = array.map(b => b.toString(16).padStart(2, '0')).join('');\n\t// sha256 has 256 bits, so we need at most ceil(lg(2^256-1)/lg(32)) = 52 chars to represent it in base 32\n\treturn BigInt(`0x${hexArray}`).toString(32).padStart(52, '0');\n}\n"],
  "mappings": ";;AAmBA,MAAM,6BAA6B,oBAAI,QAA8C;AAErF,SAAS,4BAA4B,GAA0B;AAC9D,MAAI,CAAC,EAAE,UAAU,EAAE,WAAW,GAAG;AAChC,WAAO;AAAA,EACR;AAGA,MAAI;AACH,UAAM,WAAW,EAAE;AACnB,UAAM,iBAAiB,EAAE,OAAO;AAChC,QAAI,SAAS,WAAW,UAAU,eAAe,WAAW,UAAU,SAAS,WAAW,eAAe,QAAQ;AAChH,aAAO;AAAA,IACR;AAAA,EACD,SAAS,GAAG;AACX,WAAO;AAAA,EACR;AAEA,SAAO,EAAE;AACV;AAjBS;AAmBF,MAAM,YAAY;AAAA,EAxCzB,OAwCyB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxB,OAAe,yBAAyB,cAA6C;AACpF,QAAI,mBAAmB,2BAA2B,IAAI,YAAY;AAClE,QAAI,CAAC,kBAAkB;AACtB,yBAAmB,CAAC;AACpB,iCAA2B,IAAI,cAAc,gBAAgB;AAC7D,UAAI,IAAmB;AACvB,UAAI;AACJ,SAAG;AACF,iBAAS,4BAA4B,CAAC;AACtC,YAAI,QAAQ;AACX,2BAAiB,KAAK;AAAA,YACrB,QAAQ,IAAI,QAAQ,CAAC;AAAA,YACrB,eAAe,EAAE,gBAAgB;AAAA,UAClC,CAAC;AAAA,QACF,OAAO;AACN,2BAAiB,KAAK;AAAA,YACrB,QAAQ,IAAI,QAAQ,CAAC;AAAA,YACrB,eAAe;AAAA,UAChB,CAAC;AAAA,QACF;AACA,YAAI;AAAA,MACL,SAAS;AAAA,IACV;AACA,WAAO,iBAAiB,MAAM,CAAC;AAAA,EAChC;AAAA;AAAA;AAAA;AAAA,EAKA,OAAc,iDAAiD,aAAqB,gBAA+B;AAElH,QAAI,CAAC,kBAAkB,gBAAgB,gBAAgB;AACtD,aAAO;AAAA,QACN,KAAK;AAAA,QACL,MAAM;AAAA,MACP;AAAA,IACD;AAEA,QAAI,MAAM,GAAG,OAAO;AAEpB,UAAM,cAAc,KAAK,yBAAyB,WAAW;AAE7D,eAAW,iBAAiB,aAAa;AACxC,YAAM,gBAAgB,cAAc,OAAO,MAAM;AACjD,aAAO,eAAe,WAAW;AACjC,cAAQ,eAAe,WAAW;AAElC,UAAI,kBAAkB,gBAAgB;AACrC;AAAA,MACD;AAEA,UAAI,CAAC,cAAc,eAAe;AACjC;AAAA,MACD;AAEA,YAAM,eAAe,cAAc,cAAc,sBAAsB;AACvE,aAAO,aAAa;AACpB,cAAQ,aAAa;AAAA,IACtB;AAEA,WAAO;AAAA,MACN;AAAA,MACA;AAAA,IACD;AAAA,EACD;AACD;AAKA,eAAsB,iBAAiB,cAAsB,MAA+B;AAE3F,MAAI,CAAC,OAAO,QAAQ;AACnB,UAAM,IAAI,MAAM,2MAA2M;AAAA,EAC5N;AAEA,QAAM,UAAU,KAAK,UAAU,EAAE,cAAc,KAAK,CAAC;AACrD,QAAM,UAAU,IAAI,YAAY;AAChC,QAAM,UAAU,QAAQ,OAAO,OAAO;AACtC,QAAM,OAAO,MAAM,OAAO,OAAO,OAAO,WAAW,OAAO;AAC1D,SAAO,eAAe,IAAI;AAC3B;AAXsB;AAatB,SAAS,eAAe,OAA4B;AACnD,QAAM,QAAQ,MAAM,KAAK,IAAI,WAAW,KAAK,CAAC;AAC9C,QAAM,WAAW,MAAM,IAAI,OAAK,EAAE,SAAS,EAAE,EAAE,SAAS,GAAG,GAAG,CAAC,EAAE,KAAK,EAAE;AAExE,SAAO,OAAO,KAAK,QAAQ,EAAE,EAAE,SAAS,EAAE,EAAE,SAAS,IAAI,GAAG;AAC7D;AALS;",
  "names": []
}
