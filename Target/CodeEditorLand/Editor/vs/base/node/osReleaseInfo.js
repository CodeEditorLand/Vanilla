import{constants as l,promises as f}from"fs";import{createInterface as I}from"readline";import*as a from"../common/platform.js";async function m(o){if(a.isMacintosh||a.isWindows)return;let n;for(const i of["/etc/os-release","/usr/lib/os-release","/etc/lsb-release"])try{n=await f.open(i,l.R_OK);break}catch{}if(!n){o("Unable to retrieve release information from known identifier paths.");return}try{const i=new Set(["ID","DISTRIB_ID","ID_LIKE","VERSION_ID","DISTRIB_RELEASE"]),s={id:"unknown"};for await(const r of I({input:n.createReadStream(),crlfDelay:1/0})){if(!r.includes("="))continue;const e=r.split("=")[0].toUpperCase().trim();if(i.has(e)){const t=r.split("=")[1].replace(/"/g,"").toLowerCase().trim();e==="ID"||e==="DISTRIB_ID"?s.id=t:e==="ID_LIKE"?s.id_like=t:(e==="VERSION_ID"||e==="DISTRIB_RELEASE")&&(s.version_id=t)}}return s}catch(i){o(i)}}export{m as getOSReleaseInfo};
