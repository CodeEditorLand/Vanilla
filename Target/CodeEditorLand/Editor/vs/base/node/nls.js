import*as R from"fs";import*as D from"path";import*as V from"../common/performance.js";const d={exports:{}};(()=>{function C(r,s,a){async function m(e){try{return await s.promises.access(e),!0}catch{return!1}}function x(e){const n=new Date;return s.promises.utimes(e,n,n)}async function P(e){const n=r.join(e,"languagepacks.json");try{return JSON.parse(await s.promises.readFile(n,"utf-8"))}catch{return}}function O(e,n){try{for(;n;){if(e[n])return n;const i=n.lastIndexOf("-");if(i>0)n=n.substring(0,i);else return}}catch{}}function u(e,n,i){return a.mark("code/didGenerateNls"),{userLocale:e,osLocale:n,resolvedLanguage:"en",defaultMessagesFile:r.join(i,"nls.messages.json"),locale:e,availableLanguages:{}}}async function b({userLocale:e,osLocale:n,userDataPath:i,commit:y,nlsMetadataPath:o}){if(a.mark("code/willGenerateNls"),process.env.VSCODE_DEV||e==="pseudo"||e.startsWith("en")||!y||!i)return u(e,n,o);try{const f=await P(i);if(!f)return u(e,n,o);const c=O(f,e);if(!c)return u(e,n,o);const t=f[c],p=t?.translations?.vscode;if(!t||typeof t.hash!="string"||!t.translations||typeof p!="string"||!await m(p))return u(e,n,o);const w=`${t.hash}.${c}`,g=r.join(i,"clp",w),l=r.join(g,y),N=r.join(l,"nls.messages.json"),k=r.join(g,"tcf.json"),j=r.join(g,"corrupted.info");await m(j)&&await s.promises.rm(g,{recursive:!0,force:!0,maxRetries:3});const v={userLocale:e,osLocale:n,resolvedLanguage:c,defaultMessagesFile:r.join(o,"nls.messages.json"),languagePack:{translationsConfigFile:k,messagesFile:N,corruptMarkerFile:j},locale:e,availableLanguages:{"*":c},_languagePackId:w,_languagePackSupport:!0,_translationsConfigFile:k,_cacheRoot:g,_resolvedLanguagePackCoreLocation:l,_corruptedFile:j};if(await m(l))return x(l).catch(()=>{}),a.mark("code/didGenerateNls"),v;const[,h,_,J]=await Promise.all([s.promises.mkdir(l,{recursive:!0}),JSON.parse(await s.promises.readFile(r.join(o,"nls.keys.json"),"utf-8")),JSON.parse(await s.promises.readFile(r.join(o,"nls.messages.json"),"utf-8")),JSON.parse(await s.promises.readFile(p,"utf-8"))]),F=[];let S=0;for(const[E,G]of h){const I=J.contents[E];for(const K of G)F.push(I?.[K]||_[S]),S++}return await Promise.all([s.promises.writeFile(N,JSON.stringify(F),"utf-8"),s.promises.writeFile(k,JSON.stringify(t.translations),"utf-8")]),a.mark("code/didGenerateNls"),v}catch{}return u(e,n,o)}return{resolveNLSConfiguration:b}}if(typeof d=="object"&&typeof d.exports=="object")d.exports=C(D,R,V);else throw new Error("vs/base/node/nls defined in UNKNOWN context (neither requirejs or commonjs)")})();const $=d.exports.resolveNLSConfiguration;export{$ as resolveNLSConfiguration};
