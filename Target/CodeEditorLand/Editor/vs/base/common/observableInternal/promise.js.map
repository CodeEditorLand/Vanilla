{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/common/observableInternal/promise.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { IObservable, observableValue, transaction } from './base.js';\nimport { derived } from './derived.js';\n\nexport class ObservableLazy<T> {\n\tprivate readonly _value = observableValue<T | undefined>(this, undefined);\n\n\t/**\n\t * The cached value.\n\t * Does not force a computation of the value.\n\t */\n\tpublic get cachedValue(): IObservable<T | undefined> { return this._value; }\n\n\tconstructor(private readonly _computeValue: () => T) {\n\t}\n\n\t/**\n\t * Returns the cached value.\n\t * Computes the value if the value has not been cached yet.\n\t */\n\tpublic getValue() {\n\t\tlet v = this._value.get();\n\t\tif (!v) {\n\t\t\tv = this._computeValue();\n\t\t\tthis._value.set(v, undefined);\n\t\t}\n\t\treturn v;\n\t}\n}\n\n/**\n * A promise whose state is observable.\n */\nexport class ObservablePromise<T> {\n\tpublic static fromFn<T>(fn: () => Promise<T>): ObservablePromise<T> {\n\t\treturn new ObservablePromise(fn());\n\t}\n\n\tprivate readonly _value = observableValue<PromiseResult<T> | undefined>(this, undefined);\n\n\t/**\n\t * The promise that this object wraps.\n\t */\n\tpublic readonly promise: Promise<T>;\n\n\t/**\n\t * The current state of the promise.\n\t * Is `undefined` if the promise didn't resolve yet.\n\t */\n\tpublic readonly promiseResult: IObservable<PromiseResult<T> | undefined> = this._value;\n\n\tconstructor(promise: Promise<T>) {\n\t\tthis.promise = promise.then(value => {\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description onPromiseResolved */\n\t\t\t\tthis._value.set(new PromiseResult(value, undefined), tx);\n\t\t\t});\n\t\t\treturn value;\n\t\t}, error => {\n\t\t\ttransaction(tx => {\n\t\t\t\t/** @description onPromiseRejected */\n\t\t\t\tthis._value.set(new PromiseResult<T>(undefined, error), tx);\n\t\t\t});\n\t\t\tthrow error;\n\t\t});\n\t}\n}\n\nexport class PromiseResult<T> {\n\tconstructor(\n\t\t/**\n\t\t * The value of the resolved promise.\n\t\t * Undefined if the promise rejected.\n\t\t */\n\t\tpublic readonly data: T | undefined,\n\n\t\t/**\n\t\t * The error in case of a rejected promise.\n\t\t * Undefined if the promise resolved.\n\t\t */\n\t\tpublic readonly error: unknown | undefined,\n\t) {\n\t}\n\n\t/**\n\t * Returns the value if the promise resolved, otherwise throws the error.\n\t */\n\tpublic getDataOrThrow(): T {\n\t\tif (this.error) {\n\t\t\tthrow this.error;\n\t\t}\n\t\treturn this.data!;\n\t}\n}\n\n/**\n * A lazy promise whose state is observable.\n */\nexport class ObservableLazyPromise<T> {\n\tprivate readonly _lazyValue = new ObservableLazy(() => new ObservablePromise(this._computePromise()));\n\n\t/**\n\t * Does not enforce evaluation of the promise compute function.\n\t * Is undefined if the promise has not been computed yet.\n\t */\n\tpublic readonly cachedPromiseResult = derived(this, reader => this._lazyValue.cachedValue.read(reader)?.promiseResult.read(reader));\n\n\tconstructor(private readonly _computePromise: () => Promise<T>) {\n\t}\n\n\tpublic getPromise(): Promise<T> {\n\t\treturn this._lazyValue.getValue().promise;\n\t}\n}\n"],
  "mappings": ";;AAIA,SAAS,aAAa,iBAAiB,mBAAmB;AAC1D,SAAS,eAAe;AAEjB,MAAM,eAAkB;AAAA,EAS9B,YAA6B,eAAwB;AAAxB;AAAA,EAC7B;AAAA,EAjBD,OAO+B;AAAA;AAAA;AAAA,EACb,SAAS,gBAA+B,MAAM,MAAS;AAAA;AAAA;AAAA;AAAA;AAAA,EAMxE,IAAW,cAA0C;AAAE,WAAO,KAAK;AAAA,EAAQ;AAAA;AAAA;AAAA;AAAA;AAAA,EASpE,WAAW;AACjB,QAAI,IAAI,KAAK,OAAO,IAAI;AACxB,QAAI,CAAC,GAAG;AACP,UAAI,KAAK,cAAc;AACvB,WAAK,OAAO,IAAI,GAAG,MAAS;AAAA,IAC7B;AACA,WAAO;AAAA,EACR;AACD;AAKO,MAAM,kBAAqB;AAAA,EApClC,OAoCkC;AAAA;AAAA;AAAA,EACjC,OAAc,OAAU,IAA4C;AACnE,WAAO,IAAI,kBAAkB,GAAG,CAAC;AAAA,EAClC;AAAA,EAEiB,SAAS,gBAA8C,MAAM,MAAS;AAAA;AAAA;AAAA;AAAA,EAKvE;AAAA;AAAA;AAAA;AAAA;AAAA,EAMA,gBAA2D,KAAK;AAAA,EAEhF,YAAY,SAAqB;AAChC,SAAK,UAAU,QAAQ,KAAK,WAAS;AACpC,kBAAY,QAAM;AAEjB,aAAK,OAAO,IAAI,IAAI,cAAc,OAAO,MAAS,GAAG,EAAE;AAAA,MACxD,CAAC;AACD,aAAO;AAAA,IACR,GAAG,WAAS;AACX,kBAAY,QAAM;AAEjB,aAAK,OAAO,IAAI,IAAI,cAAiB,QAAW,KAAK,GAAG,EAAE;AAAA,MAC3D,CAAC;AACD,YAAM;AAAA,IACP,CAAC;AAAA,EACF;AACD;AAEO,MAAM,cAAiB;AAAA,EAC7B,YAKiB,MAMA,OACf;AAPe;AAMA;AAAA,EAEjB;AAAA,EArFD,OAuE8B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAmBtB,iBAAoB;AAC1B,QAAI,KAAK,OAAO;AACf,YAAM,KAAK;AAAA,IACZ;AACA,WAAO,KAAK;AAAA,EACb;AACD;AAKO,MAAM,sBAAyB;AAAA,EASrC,YAA6B,iBAAmC;AAAnC;AAAA,EAC7B;AAAA,EA/GD,OAqGsC;AAAA;AAAA;AAAA,EACpB,aAAa,IAAI,eAAe,MAAM,IAAI,kBAAkB,KAAK,gBAAgB,CAAC,CAAC;AAAA;AAAA;AAAA;AAAA;AAAA,EAMpF,sBAAsB,QAAQ,MAAM,YAAU,KAAK,WAAW,YAAY,KAAK,MAAM,GAAG,cAAc,KAAK,MAAM,CAAC;AAAA,EAK3H,aAAyB;AAC/B,WAAO,KAAK,WAAW,SAAS,EAAE;AAAA,EACnC;AACD;",
  "names": []
}
