var P;(a=>a.DEFAULT={allowTrailingComma:!0})(P||={});function U(n,a=!1){let e=0,t=n.length,i="",o=0,s=16,m=0;function r(l){let S=0,g=0;for(;S<l;){let u=n.charCodeAt(e);if(u>=48&&u<=57)g=g*16+u-48;else if(u>=65&&u<=70)g=g*16+u-65+10;else if(u>=97&&u<=102)g=g*16+u-97+10;else break;e++,S++}return S<l&&(g=-1),g}function f(l){e=l,i="",o=0,s=16,m=0}function c(){let l=e;if(n.charCodeAt(e)===48)e++;else for(e++;e<n.length&&O(n.charCodeAt(e));)e++;if(e<n.length&&n.charCodeAt(e)===46)if(e++,e<n.length&&O(n.charCodeAt(e)))for(e++;e<n.length&&O(n.charCodeAt(e));)e++;else return m=3,n.substring(l,e);let S=e;if(e<n.length&&(n.charCodeAt(e)===69||n.charCodeAt(e)===101))if(e++,(e<n.length&&n.charCodeAt(e)===43||n.charCodeAt(e)===45)&&e++,e<n.length&&O(n.charCodeAt(e))){for(e++;e<n.length&&O(n.charCodeAt(e));)e++;S=e}else m=3;return n.substring(l,S)}function b(){let l="",S=e;for(;;){if(e>=t){l+=n.substring(S,e),m=2;break}let g=n.charCodeAt(e);if(g===34){l+=n.substring(S,e),e++;break}if(g===92){if(l+=n.substring(S,e),e++,e>=t){m=2;break}switch(n.charCodeAt(e++)){case 34:l+='"';break;case 92:l+="\\";break;case 47:l+="/";break;case 98:l+="\b";break;case 102:l+="\f";break;case 110:l+=`
`;break;case 114:l+="\r";break;case 116:l+="	";break;case 117:{let d=r(4);d>=0?l+=String.fromCharCode(d):m=4;break}default:m=5}S=e;continue}if(g>=0&&g<=31)if(A(g)){l+=n.substring(S,e),m=2;break}else m=6;e++}return l}function p(){if(i="",m=0,o=e,e>=t)return o=t,s=17;let l=n.charCodeAt(e);if(F(l)){do e++,i+=String.fromCharCode(l),l=n.charCodeAt(e);while(F(l));return s=15}if(A(l))return e++,i+=String.fromCharCode(l),l===13&&n.charCodeAt(e)===10&&(e++,i+=`
`),s=14;switch(l){case 123:return e++,s=1;case 125:return e++,s=2;case 91:return e++,s=3;case 93:return e++,s=4;case 58:return e++,s=6;case 44:return e++,s=5;case 34:return e++,i=b(),s=10;case 47:{let S=e-1;if(n.charCodeAt(e+1)===47){for(e+=2;e<t&&!A(n.charCodeAt(e));)e++;return i=n.substring(S,e),s=12}if(n.charCodeAt(e+1)===42){e+=2;let g=t-1,u=!1;for(;e<g;){if(n.charCodeAt(e)===42&&n.charCodeAt(e+1)===47){e+=2,u=!0;break}e++}return u||(e++,m=1),i=n.substring(S,e),s=13}return i+=String.fromCharCode(l),e++,s=16}case 45:if(i+=String.fromCharCode(l),e++,e===t||!O(n.charCodeAt(e)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=c(),s=11;default:for(;e<t&&T(l);)e++,l=n.charCodeAt(e);if(o!==e){switch(i=n.substring(o,e),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(l),e++,s=16}}function T(l){if(F(l)||A(l))return!1;switch(l){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function x(){let l;do l=p();while(l>=12&&l<=15);return l}return{setPosition:f,getPosition:()=>e,scan:a?x:p,getToken:()=>s,getTokenValue:()=>i,getTokenOffset:()=>o,getTokenLength:()=>e-o,getTokenError:()=>m}}function F(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function A(n){return n===10||n===13||n===8232||n===8233}function O(n){return n>=48&&n<=57}function J(n,a=[],e=P.DEFAULT){let t={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(r){t.type==="property"&&(t.length=r-t.offset,t=t.parent)}function o(r){return t.children.push(r),r}Q(n,{onObjectBegin:r=>{t=o({type:"object",offset:r,length:-1,parent:t,children:[]})},onObjectProperty:(r,f,c)=>{t=o({type:"property",offset:f,length:-1,parent:t,children:[]}),t.children.push({type:"string",value:r,offset:f,length:c,parent:t})},onObjectEnd:(r,f)=>{t.length=r+f-t.offset,t=t.parent,i(r+f)},onArrayBegin:(r,f)=>{t=o({type:"array",offset:r,length:-1,parent:t,children:[]})},onArrayEnd:(r,f)=>{t.length=r+f-t.offset,t=t.parent,i(r+f)},onLiteralValue:(r,f,c)=>{o({type:z(r),offset:f,length:c,parent:t,value:r}),i(f+c)},onSeparator:(r,f,c)=>{t.type==="property"&&(r===":"?t.colonOffset=f:r===","&&i(f))},onError:(r,f,c)=>{a.push({error:r,offset:f,length:c})}},e);let m=t.children[0];return m&&delete m.parent,m}function I(n,a){if(!n)return;let e=n;for(let t of a)if(typeof t=="string"){if(e.type!=="object"||!Array.isArray(e.children))return;let i=!1;for(let o of e.children)if(Array.isArray(o.children)&&o.children[0].value===t){e=o.children[1],i=!0;break}if(!i)return}else{let i=t;if(e.type!=="array"||i<0||!Array.isArray(e.children)||i>=e.children.length)return;e=e.children[i]}return e}function Q(n,a,e=P.DEFAULT){let t=U(n,!1);function i(k){return k?()=>k(t.getTokenOffset(),t.getTokenLength()):()=>!0}function o(k){return k?E=>k(E,t.getTokenOffset(),t.getTokenLength()):()=>!0}let s=i(a.onObjectBegin),m=o(a.onObjectProperty),r=i(a.onObjectEnd),f=i(a.onArrayBegin),c=i(a.onArrayEnd),b=o(a.onLiteralValue),p=o(a.onSeparator),T=i(a.onComment),x=o(a.onError),l=e&&e.disallowComments,S=e&&e.allowTrailingComma;function g(){for(;;){let k=t.scan();switch(t.getTokenError()){case 4:u(14);break;case 5:u(15);break;case 3:u(13);break;case 1:l||u(11);break;case 2:u(12);break;case 6:u(16);break}switch(k){case 12:case 13:l?u(10):T();break;case 16:u(1);break;case 15:case 14:break;default:return k}}}function u(k,E=[],_=[]){if(x(k),E.length+_.length>0){let B=t.getToken();for(;B!==17;){if(E.indexOf(B)!==-1){g();break}else if(_.indexOf(B)!==-1)break;B=g()}}}function d(k){let E=t.getTokenValue();return k?b(E):m(E),g(),!0}function y(){switch(t.getToken()){case 11:{let k=0;try{k=JSON.parse(t.getTokenValue()),typeof k!="number"&&(u(2),k=0)}catch{u(2)}b(k);break}case 7:b(null);break;case 8:b(!0);break;case 9:b(!1);break;default:return!1}return g(),!0}function h(){return t.getToken()!==10?(u(3,[],[2,5]),!1):(d(!1),t.getToken()===6?(p(":"),g(),K()||u(4,[],[2,5])):u(5,[],[2,5]),!0)}function v(){s(),g();let k=!1;for(;t.getToken()!==2&&t.getToken()!==17;){if(t.getToken()===5){if(k||u(4,[],[]),p(","),g(),t.getToken()===2&&S)break}else k&&u(6,[],[]);h()||u(4,[],[2,5]),k=!0}return r(),t.getToken()!==2?u(7,[2],[]):g(),!0}function L(){f(),g();let k=!1;for(;t.getToken()!==4&&t.getToken()!==17;){if(t.getToken()===5){if(k||u(4,[],[]),p(","),g(),t.getToken()===4&&S)break}else k&&u(6,[],[]);K()||u(4,[],[4,5]),k=!0}return c(),t.getToken()!==4?u(8,[4],[]):g(),!0}function K(){switch(t.getToken()){case 3:return L();case 1:return v();case 10:return d(!0);default:return y()}}return g(),t.getToken()===17?e.allowEmptyContent?!0:(u(4,[],[]),!1):K()?(t.getToken()!==17&&u(9,[],[]),!0):(u(4,[],[]),!1)}function z(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}function D(n,a,e){let t,i,o,s,m;if(a){for(s=a.offset,m=s+a.length,o=s;o>0&&!w(n,o-1);)o--;let d=m;for(;d<n.length&&!w(n,d);)d++;i=n.substring(o,d),t=M(i,e)}else i=n,t=0,o=0,s=0,m=n.length;let r=R(e,n),f=!1,c=0,b;e.insertSpaces?b=j(" ",e.tabSize||4):b="	";let p=U(i,!1),T=!1;function x(){return r+j(b,t+c)}function l(){let d=p.scan();for(f=!1;d===15||d===14;)f=f||d===14,d=p.scan();return T=d===16||p.getTokenError()!==0,d}let S=[];function g(d,y,h){!T&&y<m&&h>s&&n.substring(y,h)!==d&&S.push({offset:y,length:h-y,content:d})}let u=l();if(u!==17){let d=p.getTokenOffset()+o,y=j(b,t);g(y,o,d)}for(;u!==17;){let d=p.getTokenOffset()+p.getTokenLength()+o,y=l(),h="";for(;!f&&(y===12||y===13);){let L=p.getTokenOffset()+o;g(" ",d,L),d=p.getTokenOffset()+p.getTokenLength()+o,h=y===12?x():"",y=l()}if(y===2)u!==1&&(c--,h=x());else if(y===4)u!==3&&(c--,h=x());else{switch(u){case 3:case 1:c++,h=x();break;case 5:case 12:h=x();break;case 13:f?h=x():h=" ";break;case 6:h=" ";break;case 10:if(y===6){h="";break}case 7:case 8:case 9:case 11:case 2:case 4:y===12||y===13?h=" ":y!==5&&y!==17&&(T=!0);break;case 16:T=!0;break}f&&(y===12||y===13)&&(h=x())}let v=p.getTokenOffset()+o;g(h,d,v),u=y}return S}function j(n,a){let e="";for(let t=0;t<a;t++)e+=n;return e}function M(n,a){let e=0,t=0,i=a.tabSize||4;for(;e<n.length;){let o=n.charAt(e);if(o===" ")t++;else if(o==="	")t+=i;else break;e++}return Math.floor(t/i)}function R(n,a){for(let e=0;e<a.length;e++){let t=a.charAt(e);if(t==="\r")return e+1<a.length&&a.charAt(e+1)===`
`?`\r
`:"\r";if(t===`
`)return`
`}return n&&n.eol||`
`}function w(n,a){return`\r
`.indexOf(n.charAt(a))!==-1}function oe(n,a,e){return $(n,a,void 0,e)}function $(n,a,e,t,i){let o=a.slice(),m=J(n,[]),r,f;for(;o.length>0&&(f=o.pop(),r=I(m,o),r===void 0&&e!==void 0);)typeof f=="string"?e={[f]:e}:e=[e];if(r)if(r.type==="object"&&typeof f=="string"&&Array.isArray(r.children)){let c=I(r,[f]);if(c!==void 0)if(e===void 0){if(!c.parent)throw new Error("Malformed AST");let b=r.children.indexOf(c.parent),p,T=c.parent.offset+c.parent.length;if(b>0){let x=r.children[b-1];p=x.offset+x.length}else p=r.offset+1,r.children.length>1&&(T=r.children[1].offset);return N(n,{offset:p,length:T-p,content:""},t)}else return N(n,{offset:c.offset,length:c.length,content:JSON.stringify(e)},t);else{if(e===void 0)return[];let b=`${JSON.stringify(f)}: ${JSON.stringify(e)}`,p=i?i(r.children.map(x=>x.children[0].value)):r.children.length,T;if(p>0){let x=r.children[p-1];T={offset:x.offset+x.length,length:0,content:","+b}}else r.children.length===0?T={offset:r.offset+1,length:0,content:b}:T={offset:r.offset+1,length:0,content:b+","};return N(n,T,t)}}else if(r.type==="array"&&typeof f=="number"&&Array.isArray(r.children))if(e!==void 0){let c=`${JSON.stringify(e)}`,b;if(r.children.length===0||f===0)b={offset:r.offset+1,length:0,content:r.children.length===0?c:c+","};else{let p=f===-1||f>r.children.length?r.children.length:f,T=r.children[p-1];b={offset:T.offset+T.length,length:0,content:","+c}}return N(n,b,t)}else{let c=f,b=r.children[c],p;if(r.children.length===1)p={offset:r.offset+1,length:r.length-2,content:""};else if(r.children.length-1===c){let T=r.children[c-1],x=T.offset+T.length,l=r.offset+r.length;p={offset:x,length:l-2-x,content:""}}else p={offset:b.offset,length:r.children[c+1].offset-b.offset,content:""};return N(n,p,t)}else throw new Error(`Can not add ${typeof f!="number"?"index":"property"} to parent of type ${r.type}`);else return e===void 0?[]:N(n,{offset:m?m.offset:0,length:m?m.length:0,content:JSON.stringify(e)},t)}function N(n,a,e){let t=V(n,a),i=a.offset,o=a.offset+a.content.length;if(a.length===0||a.content.length===0){for(;i>0&&!w(t,i-1);)i--;for(;o<t.length&&!w(t,o);)o++}let s=D(t,{offset:i,length:o-i},e);for(let r=s.length-1;r>=0;r--){let f=s[r];t=V(t,f),i=Math.min(i,f.offset),o=Math.max(o,f.offset+f.length),o+=f.content.length-f.length}let m=n.length-(t.length-o)-i;return[{offset:i,length:m,content:t.substring(i,o)}]}function V(n,a){return n.substring(0,a.offset)+a.content+n.substring(a.offset+a.length)}function le(n,a){let e=a.slice(0).sort((i,o)=>{let s=i.offset-o.offset;return s===0?i.length-o.length:s}),t=n.length;for(let i=e.length-1;i>=0;i--){let o=e[i];if(o.offset+o.length<=t)n=V(n,o);else throw new Error("Overlapping edit");t=o.offset}return n}export{V as applyEdit,le as applyEdits,oe as removeProperty,$ as setProperty,N as withFormatting};
