var s=class{constructor(t,e){this.toKey=e;for(let i of t)this.add(i)}_map=new Map;get size(){return this._map.size}add(t){let e=this.toKey(t);return this._map.set(e,t),this}delete(t){return this._map.delete(this.toKey(t))}has(t){return this._map.has(this.toKey(t))}*entries(){for(let t of this._map.values())yield[t,t]}keys(){return this.values()}*values(){for(let t of this._map.values())yield t}clear(){this._map.clear()}forEach(t,e){this._map.forEach(i=>t.call(e,i,i,this))}[Symbol.iterator](){return this.values()}[Symbol.toStringTag]="SetWithKey"};var n=class{constructor(t,e=0,i=t.length,r=e-1){this.items=t;this.start=e;this.end=i;this.index=r}current(){return this.index===this.start-1||this.index===this.end?null:this.items[this.index]}next(){return this.index=Math.min(this.index+1,this.end),this.current()}previous(){return this.index=Math.max(this.index-1,this.start-1),this.current()}first(){return this.index=this.start,this.current()}last(){return this.index=this.end-1,this.current()}};var a=class{_history;_limit;_navigator;constructor(t=[],e=10){this._initialize(t),this._limit=e,this._onChange()}getHistory(){return this._elements}add(t){this._history.delete(t),this._history.add(t),this._onChange()}next(){return this._navigator.next()}previous(){return this._currentPosition()!==0?this._navigator.previous():null}current(){return this._navigator.current()}first(){return this._navigator.first()}last(){return this._navigator.last()}isFirst(){return this._currentPosition()===0}isLast(){return this._currentPosition()>=this._elements.length-1}isNowhere(){return this._navigator.current()===null}has(t){return this._history.has(t)}clear(){this._initialize([]),this._onChange()}_onChange(){this._reduceToLimit();let t=this._elements;this._navigator=new n(t,0,t.length,t.length)}_reduceToLimit(){let t=this._elements;t.length>this._limit&&this._initialize(t.slice(t.length-this._limit))}_currentPosition(){let t=this._navigator.current();return t?this._elements.indexOf(t):-1}_initialize(t){this._history=new Set;for(let e of t)this._history.add(e)}get _elements(){let t=[];return this._history.forEach(e=>t.push(e)),t}},h=class{constructor(t,e=10,i=r=>r){this.capacity=e;this.identityFn=i;if(t.length<1)throw new Error("not supported");this._size=1,this.head=this.tail=this.cursor={value:t[0],previous:void 0,next:void 0},this.valueSet=new s([t[0]],i);for(let r=1;r<t.length;r++)this.add(t[r])}valueSet;head;tail;cursor;_size;get size(){return this._size}add(t){let e={value:t,previous:this.tail,next:void 0};for(this.tail.next=e,this.tail=e,this.cursor=this.tail,this._size++,this.valueSet.has(t)?this._deleteFromList(t):this.valueSet.add(t);this._size>this.capacity;)this.valueSet.delete(this.head.value),this.head=this.head.next,this.head.previous=void 0,this._size--}replaceLast(t){if(this.identityFn(this.tail.value)===this.identityFn(t))return t;let e=this.tail.value;return this.valueSet.delete(e),this.tail.value=t,this.valueSet.has(t)?this._deleteFromList(t):this.valueSet.add(t),e}prepend(t){if(this._size===this.capacity||this.valueSet.has(t))return;let e={value:t,previous:void 0,next:this.head};this.head.previous=e,this.head=e,this._size++,this.valueSet.add(t)}isAtEnd(){return this.cursor===this.tail}current(){return this.cursor.value}previous(){return this.cursor.previous&&(this.cursor=this.cursor.previous),this.cursor.value}next(){return this.cursor.next&&(this.cursor=this.cursor.next),this.cursor.value}has(t){return this.valueSet.has(t)}resetCursor(){return this.cursor=this.tail,this.cursor.value}*[Symbol.iterator](){let t=this.head;for(;t;)yield t.value,t=t.next}_deleteFromList(t){let e=this.head,i=this.identityFn(t);for(;e!==this.tail;)this.identityFn(e.value)===i&&(e===this.head?(this.head=this.head.next,this.head.previous=void 0):(e.previous.next=e.next,e.next.previous=e.previous),this._size--),e=e.next}};export{a as HistoryNavigator,h as HistoryNavigator2};
