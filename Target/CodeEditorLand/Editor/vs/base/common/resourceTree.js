var f=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var h=(s,e,r,n)=>{for(var t=n>1?void 0:n?T(e,r):e,i=s.length-1,o;i>=0;i--)(o=s[i])&&(t=(n?o(e,r,t):o(t))||t);return n&&t&&f(e,r,t),t};import{memoize as C}from"./decorators.js";import{PathIterator as c}from"./ternarySearchTree.js";import*as m from"./path.js";import{extUri as N}from"./resources.js";import{URI as p}from"./uri.js";class a{constructor(e,r,n,t=void 0,i=void 0){this.uri=e;this.relativePath=r;this.context=n;this.element=t;this.parent=i}_children=new Map;get childrenCount(){return this._children.size}get children(){return this._children.values()}get name(){return m.posix.basename(this.relativePath)}get(e){return this._children.get(e)}set(e,r){this._children.set(e,r)}delete(e){this._children.delete(e)}clear(){this._children.clear()}}h([C],a.prototype,"name",1);function u(s,e){typeof s.element<"u"&&e.push(s.element);for(const r of s.children)u(r,e);return e}class U{constructor(e,r=p.file("/"),n=N){this.extUri=n;this.root=new a(r,"",e)}root;static getRoot(e){for(;e.parent;)e=e.parent;return e}static collect(e){return u(e,[])}static isResourceNode(e){return e instanceof a}add(e,r){const n=this.extUri.relativePath(this.root.uri,e)||e.path,t=new c(!1).reset(n);let i=this.root,o="";for(;;){const l=t.value();o=o+"/"+l;let d=i.get(l);if(d?t.hasNext()||(d.element=r):(d=new a(this.extUri.joinPath(this.root.uri,o),o,this.root.context,t.hasNext()?void 0:r,i),i.set(l,d)),i=d,!t.hasNext())return;t.next()}}delete(e){const r=this.extUri.relativePath(this.root.uri,e)||e.path,n=new c(!1).reset(r);return this._delete(this.root,n)}_delete(e,r){const n=r.value(),t=e.get(n);if(t){if(r.hasNext()){const i=this._delete(t,r.next());return typeof i<"u"&&t.childrenCount===0&&e.delete(n),i}return e.delete(n),t.element}}clear(){this.root.clear()}getNode(e){const r=this.extUri.relativePath(this.root.uri,e)||e.path,n=new c(!1).reset(r);let t=this.root;for(;;){const i=n.value(),o=t.get(i);if(!o||!n.hasNext())return o;t=o,n.next()}}}export{U as ResourceTree};
