import{CharCode as a}from"../../../vs/base/common/charCode.js";import{LRUCache as ae}from"../../../vs/base/common/map.js";import{getKoreanAltChars as he}from"../../../vs/base/common/naturalLanguage/korean.js";import*as R from"../../../vs/base/common/strings.js";function H(...e){return function(n,t){for(let r=0,u=e.length;r<u;r++){const i=e[r](n,t);if(i)return i}return null}}const Re=V.bind(void 0,!1),J=V.bind(void 0,!0);function V(e,n,t){if(!t||t.length<n.length)return null;let r;return e?r=R.startsWithIgnoreCase(t,n):r=t.indexOf(n)===0,r?n.length>0?[{start:0,end:n.length}]:[]:null}function ge(e,n){const t=n.toLowerCase().indexOf(e.toLowerCase());return t===-1?null:[{start:t,end:t+e.length}]}function be(e,n){return P(e.toLowerCase(),n.toLowerCase(),0,0)}function P(e,n,t,r){if(t===e.length)return[];if(r===n.length)return null;if(e[t]===n[r]){let u=null;return(u=P(e,n,t+1,r+1))?T({start:r,end:r+1},u):null}return P(e,n,t,r+1)}function G(e){return a.a<=e&&e<=a.z}function S(e){return a.A<=e&&e<=a.Z}function U(e){return a.Digit0<=e&&e<=a.Digit9}function Y(e){return e===a.Space||e===a.Tab||e===a.LineFeed||e===a.CarriageReturn}const j=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(e=>j.add(e.charCodeAt(0)));function A(e){return Y(e)||j.has(e)}function d(e,n){return e===n||A(e)&&A(n)}const W=new Map;function w(e){if(W.has(e))return W.get(e);let n;const t=he(e);return t&&(n=t),W.set(e,n),n}function ee(e){return G(e)||S(e)||U(e)}function T(e,n){return n.length===0?n=[e]:e.end===n[0].start?n[0].start=e.start:n.unshift(e),n}function ne(e,n){for(let t=n;t<e.length;t++){const r=e.charCodeAt(t);if(S(r)||U(r)||t>0&&!ee(e.charCodeAt(t-1)))return t}return e.length}function q(e,n,t,r){if(t===e.length)return[];if(r===n.length)return null;if(e[t]!==n[r].toLowerCase())return null;{let u=null,i=r+1;for(u=q(e,n,t+1,r+1);!u&&(i=ne(n,i))<n.length;)u=q(e,n,t+1,i),i++;return u===null?null:T({start:r,end:r+1},u)}}function me(e){let n=0,t=0,r=0,u=0,i=0;for(let f=0;f<e.length;f++)i=e.charCodeAt(f),S(i)&&n++,G(i)&&t++,ee(i)&&r++,U(i)&&u++;const l=n/e.length,c=t/e.length,o=r/e.length,s=u/e.length;return{upperPercent:l,lowerPercent:c,alphaPercent:o,numericPercent:s}}function Ce(e){const{upperPercent:n,lowerPercent:t}=e;return t===0&&n>.6}function pe(e){const{upperPercent:n,lowerPercent:t,alphaPercent:r,numericPercent:u}=e;return t>.2&&n<.8&&r>.6&&u<.2}function ze(e){let n=0,t=0,r=0,u=0;for(let i=0;i<e.length;i++)r=e.charCodeAt(i),S(r)&&n++,G(r)&&t++,Y(r)&&u++;return(n===0||t===0)&&u===0?e.length<=30:n<=5}function te(e,n){if(!n||(n=n.trim(),n.length===0)||!ze(e))return null;n.length>60&&(n=n.substring(0,60));const t=me(n);if(!pe(t)){if(!Ce(t))return null;n=n.toLowerCase()}let r=null,u=0;for(e=e.toLowerCase();u<n.length&&(r=q(e,n,0,u))===null;)u=ne(n,u+1);return r}function Pe(e,n,t=!1){if(!n||n.length===0)return null;let r=null,u=0;for(e=e.toLowerCase(),n=n.toLowerCase();u<n.length&&(r=v(e,n,0,u,t),r===null);)u=re(n,u+1);return r}function v(e,n,t,r,u){let i=0;if(t===e.length)return[];if(r===n.length)return null;if(!d(e.charCodeAt(t),n.charCodeAt(r))){const o=w(e.charCodeAt(t));if(!o)return null;for(let s=0;s<o.length;s++)if(!d(o[s],n.charCodeAt(r+s)))return null;i+=o.length-1}let l=null,c=r+i+1;if(l=v(e,n,t+1,c,u),!u)for(;!l&&(c=re(n,c))<n.length;)l=v(e,n,t+1,c,u),c++;if(!l)return null;if(e.charCodeAt(t)!==n.charCodeAt(r)){const o=w(e.charCodeAt(t));if(!o)return l;for(let s=0;s<o.length;s++)if(o[s]!==n.charCodeAt(r+s))return l}return T({start:r,end:r+i+1},l)}function re(e,n){for(let t=n;t<e.length;t++)if(A(e.charCodeAt(t))||t>0&&A(e.charCodeAt(t-1)))return t;return e.length}const ye=H(J,te,ge),Me=H(J,te,be),ue=new ae(1e4);function Ge(e,n,t=!1){if(typeof e!="string"||typeof n!="string")return null;let r=ue.get(e);r||(r=new RegExp(R.convertSimple2RegExpPattern(e),"i"),ue.set(e,r));const u=r.exec(n);return u?[{start:u.index,end:u.index+u[0].length}]:t?Me(e,n):ye(e,n)}function Ue(e,n){const t=k(e,e.toLowerCase(),0,n,n.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return t?xe(t):null}function We(e,n,t,r,u,i){const l=Math.min(13,e.length);for(;t<l;t++){const c=k(e,n,t,r,u,i,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(c)return c}return[0,i]}function xe(e){if(typeof e>"u")return[];const n=[],t=e[1];for(let r=e.length-1;r>1;r--){const u=e[r]+t,i=n[n.length-1];i&&i.end===u?i.end=u+1:n.push({start:u,end:u+1})}return n}const C=128;function Q(){const e=[],n=[];for(let t=0;t<=C;t++)n[t]=0;for(let t=0;t<=C;t++)e.push(n.slice(0));return e}function ie(e){const n=[];for(let t=0;t<=e;t++)n[t]=0;return n}const le=ie(2*C),$=ie(2*C),m=Q(),p=Q(),z=Q(),Fe=!1;function K(e,n,t,r,u){function i(c,o,s=" "){for(;c.length<o;)c=s+c;return c}let l=` |   |${r.split("").map(c=>i(c,3)).join("|")}
`;for(let c=0;c<=t;c++)c===0?l+=" |":l+=`${n[c-1]}|`,l+=e[c].slice(0,u+1).map(o=>i(o.toString(),3)).join("|")+`
`;return l}function Ie(e,n,t,r){e=e.substr(n),t=t.substr(r),console.log(K(p,e,e.length,t,t.length)),console.log(K(z,e,e.length,t,t.length)),console.log(K(m,e,e.length,t,t.length))}function L(e,n){if(n<0||n>=e.length)return!1;const t=e.codePointAt(n);switch(t){case a.Underline:case a.Dash:case a.Period:case a.Space:case a.Slash:case a.Backslash:case a.SingleQuote:case a.DoubleQuote:case a.Colon:case a.DollarSign:case a.LessThan:case a.GreaterThan:case a.OpenParen:case a.CloseParen:case a.OpenSquareBracket:case a.CloseSquareBracket:case a.OpenCurlyBrace:case a.CloseCurlyBrace:return!0;case void 0:return!1;default:return!!R.isEmojiImprecise(t)}}function se(e,n){if(n<0||n>=e.length)return!1;switch(e.charCodeAt(n)){case a.Space:case a.Tab:return!0;default:return!1}}function _(e,n,t){return n[e]!==t[e]}function Se(e,n,t,r,u,i,l=!1){for(;n<t&&u<i;)e[n]===r[u]&&(l&&(le[n]=u),n+=1),u+=1;return n===t}var Ae=(r=>(r[r.Diag=1]="Diag",r[r.Left=2]="Left",r[r.LeftLeft=3]="LeftLeft",r))(Ae||{}),Le;(t=>{t.Default=[-100,0];function n(r){return!r||r.length===2&&r[0]===-100&&r[1]===0}t.isDefault=n})(Le||={});class _e{constructor(n,t){this.firstMatchCanBeWeak=n;this.boostFullMatch=t}static default={boostFullMatch:!0,firstMatchCanBeWeak:!1}}function k(e,n,t,r,u,i,l=_e.default){const c=e.length>C?C:e.length,o=r.length>C?C:r.length;if(t>=c||i>=o||c-t>o-i||!Se(n,t,c,u,i,o,!0))return;ke(c,o,t,i,n,u);let s=1,f=1,h=t,g=i;const X=[!1];for(s=1,h=t;h<c;s++,h++){const b=le[h],x=$[h],oe=h+1<c?$[h+1]:o;for(f=b-i+1,g=b;g<oe;f++,g++){let O=Number.MIN_SAFE_INTEGER,F=!1;g<=x&&(O=Ee(e,n,h,t,r,u,g,o,i,m[s-1][f-1]===0,X));let I=0;O!==Number.MAX_SAFE_INTEGER&&(F=!0,I=O+p[s-1][f-1]);const D=g>b,B=D?p[s][f-1]+(m[s][f-1]>0?-5:0):0,Z=g>b+1&&m[s][f-1]>0,N=Z?p[s][f-2]+(m[s][f-2]>0?-5:0):0;if(Z&&(!D||N>=B)&&(!F||N>=I))p[s][f]=N,z[s][f]=3,m[s][f]=0;else if(D&&(!F||B>=I))p[s][f]=B,z[s][f]=2,m[s][f]=0;else if(F)p[s][f]=I,z[s][f]=1,m[s][f]=m[s-1][f-1]+1;else throw new Error("not possible")}}if(Fe&&Ie(e,t,r,i),!X[0]&&!l.firstMatchCanBeWeak)return;s--,f--;const y=[p[s][f],i];let M=0,E=0;for(;s>=1;){let b=f;do{const x=z[s][b];if(x===3)b=b-2;else if(x===2)b=b-1;else break}while(b>=1);M>1&&n[t+s-1]===u[i+f-1]&&!_(b+i-1,r,u)&&M+1>m[s][b]&&(b=f),b===f?M++:M=1,E||(E=b),s--,f=b-1,y.push(f)}o-i===c&&l.boostFullMatch&&(y[0]+=2);const fe=E-c;return y[0]-=fe,y}function ke(e,n,t,r,u,i){let l=e-1,c=n-1;for(;l>=t&&c>=r;)u[l]===i[c]&&($[l]=c,l--),c--}function Ee(e,n,t,r,u,i,l,c,o,s,f){if(n[t]!==i[l])return Number.MIN_SAFE_INTEGER;let h=1,g=!1;return l===t-r?h=e[t]===u[l]?7:5:_(l,u,i)&&(l===0||!_(l-1,u,i))?(h=e[t]===u[l]?7:5,g=!0):L(i,l)&&(l===0||!L(i,l-1))?h=5:(L(i,l-1)||se(i,l-1))&&(h=5,g=!0),h>1&&t===r&&(f[0]=!0),g||(g=_(l,u,i)||L(i,l-1)||se(i,l-1)),t===r?l>o&&(h-=g?3:5):s?h+=g?2:0:h+=g?0:1,l+1===c&&(h-=g?3:5),h}function Te(e,n,t,r,u,i,l){return ce(e,n,t,r,u,i,!0,l)}function qe(e,n,t,r,u,i,l){return ce(e,n,t,r,u,i,!1,l)}function ce(e,n,t,r,u,i,l,c){let o=k(e,n,t,r,u,i,c);if(o&&!l)return o;if(e.length>=3){const s=Math.min(7,e.length-1);for(let f=t+1;f<s;f++){const h=Oe(e,f);if(h){const g=k(h,h.toLowerCase(),t,r,u,i,c);g&&(g[0]-=3,(!o||g[0]>o[0])&&(o=g))}}}return o}function Oe(e,n){if(n+1>=e.length)return;const t=e[n],r=e[n+1];if(t!==r)return e.slice(0,n)+r+t+e.slice(n+2)}export{Le as FuzzyScore,_e as FuzzyScoreOptions,We as anyScore,xe as createMatches,k as fuzzyScore,qe as fuzzyScoreGraceful,Te as fuzzyScoreGracefulAggressive,Se as isPatternInWord,S as isUpper,te as matchesCamelCase,ge as matchesContiguousSubString,Ge as matchesFuzzy,Ue as matchesFuzzy2,J as matchesPrefix,Re as matchesStrictPrefix,be as matchesSubString,Pe as matchesWords,H as or};
