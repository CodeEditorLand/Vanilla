import{CharCode as a}from"./charCode.js";import{LRUCache as oe}from"./map.js";import{getKoreanAltChars as ae}from"./naturalLanguage/korean.js";import*as R from"./strings.js";function Z(...e){return function(n,t){for(let r=0,u=e.length;r<u;r++){const i=e[r](n,t);if(i)return i}return null}}const Ne=J.bind(void 0,!1),H=J.bind(void 0,!0);function J(e,n,t){if(!t||t.length<n.length)return null;let r;return e?r=R.startsWithIgnoreCase(t,n):r=t.indexOf(n)===0,r?n.length>0?[{start:0,end:n.length}]:[]:null}function he(e,n){const t=n.toLowerCase().indexOf(e.toLowerCase());return t===-1?null:[{start:t,end:t+e.length}]}function ge(e,n){return P(e.toLowerCase(),n.toLowerCase(),0,0)}function P(e,n,t,r){if(t===e.length)return[];if(r===n.length)return null;if(e[t]===n[r]){let u=null;return(u=P(e,n,t+1,r+1))?W({start:r,end:r+1},u):null}return P(e,n,t,r+1)}function G(e){return a.a<=e&&e<=a.z}function I(e){return a.A<=e&&e<=a.Z}function T(e){return a.Digit0<=e&&e<=a.Digit9}function V(e){return e===a.Space||e===a.Tab||e===a.LineFeed||e===a.CarriageReturn}const Y=new Set;"()[]{}<>`'\"-/;:,.?!".split("").forEach(e=>Y.add(e.charCodeAt(0)));function S(e){return V(e)||Y.has(e)}function j(e,n){return e===n||S(e)&&S(n)}const U=new Map;function d(e){if(U.has(e))return U.get(e);let n;const t=ae(e);return t&&(n=t),U.set(e,n),n}function w(e){return G(e)||I(e)||T(e)}function W(e,n){return n.length===0?n=[e]:e.end===n[0].start?n[0].start=e.start:n.unshift(e),n}function ee(e,n){for(let t=n;t<e.length;t++){const r=e.charCodeAt(t);if(I(r)||T(r)||t>0&&!w(e.charCodeAt(t-1)))return t}return e.length}function q(e,n,t,r){if(t===e.length)return[];if(r===n.length)return null;if(e[t]!==n[r].toLowerCase())return null;{let u=null,i=r+1;for(u=q(e,n,t+1,r+1);!u&&(i=ee(n,i))<n.length;)u=q(e,n,t+1,i),i++;return u===null?null:W({start:r,end:r+1},u)}}function be(e){let n=0,t=0,r=0,u=0,i=0;for(let f=0;f<e.length;f++)i=e.charCodeAt(f),I(i)&&n++,G(i)&&t++,w(i)&&r++,T(i)&&u++;const l=n/e.length,c=t/e.length,o=r/e.length,s=u/e.length;return{upperPercent:l,lowerPercent:c,alphaPercent:o,numericPercent:s}}function me(e){const{upperPercent:n,lowerPercent:t}=e;return t===0&&n>.6}function pe(e){const{upperPercent:n,lowerPercent:t,alphaPercent:r,numericPercent:u}=e;return t>.2&&n<.8&&r>.6&&u<.2}function Ce(e){let n=0,t=0,r=0,u=0;for(let i=0;i<e.length;i++)r=e.charCodeAt(i),I(r)&&n++,G(r)&&t++,V(r)&&u++;return(n===0||t===0)&&u===0?e.length<=30:n<=5}function ne(e,n){if(!n||(n=n.trim(),n.length===0)||!Ce(e))return null;n.length>60&&(n=n.substring(0,60));const t=be(n);if(!pe(t)){if(!me(t))return null;n=n.toLowerCase()}let r=null,u=0;for(e=e.toLowerCase();u<n.length&&(r=q(e,n,0,u))===null;)u=ee(n,u+1);return r}function Re(e,n,t=!1){if(!n||n.length===0)return null;let r=null,u=0;for(e=e.toLowerCase(),n=n.toLowerCase();u<n.length&&(r=v(e,n,0,u,t),r===null);)u=te(n,u+1);return r}function v(e,n,t,r,u){let i=0;if(t===e.length)return[];if(r===n.length)return null;if(!j(e.charCodeAt(t),n.charCodeAt(r))){const o=d(e.charCodeAt(t));if(!o)return null;for(let s=0;s<o.length;s++)if(!j(o[s],n.charCodeAt(r+s)))return null;i+=o.length-1}let l=null,c=r+i+1;if(l=v(e,n,t+1,c,u),!u)for(;!l&&(c=te(n,c))<n.length;)l=v(e,n,t+1,c,u),c++;if(!l)return null;if(e.charCodeAt(t)!==n.charCodeAt(r)){const o=d(e.charCodeAt(t));if(!o)return l;for(let s=0;s<o.length;s++)if(o[s]!==n.charCodeAt(r+s))return l}return W({start:r,end:r+i+1},l)}function te(e,n){for(let t=n;t<e.length;t++)if(S(e.charCodeAt(t))||t>0&&S(e.charCodeAt(t-1)))return t;return e.length}const ze=Z(H,ne,he),ye=Z(H,ne,ge),re=new oe(1e4);function Pe(e,n,t=!1){if(typeof e!="string"||typeof n!="string")return null;let r=re.get(e);r||(r=new RegExp(R.convertSimple2RegExpPattern(e),"i"),re.set(e,r));const u=r.exec(n);return u?[{start:u.index,end:u.index+u[0].length}]:t?ye(e,n):ze(e,n)}function Ge(e,n){const t=k(e,e.toLowerCase(),0,n,n.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return t?Me(t):null}function Te(e,n,t,r,u,i){const l=Math.min(13,e.length);for(;t<l;t++){const c=k(e,n,t,r,u,i,{firstMatchCanBeWeak:!0,boostFullMatch:!0});if(c)return c}return[0,i]}function Me(e){if(typeof e>"u")return[];const n=[],t=e[1];for(let r=e.length-1;r>1;r--){const u=e[r]+t,i=n[n.length-1];i&&i.end===u?i.end=u+1:n.push({start:u,end:u+1})}return n}const p=128;function Q(){const e=[],n=[];for(let t=0;t<=p;t++)n[t]=0;for(let t=0;t<=p;t++)e.push(n.slice(0));return e}function ue(e){const n=[];for(let t=0;t<=e;t++)n[t]=0;return n}const ie=ue(2*p),$=ue(2*p),m=Q(),C=Q(),A=Q(),xe=!1;function Ue(e,n,t,r,u){function i(c,o,s=" "){for(;c.length<o;)c=s+c;return c}let l=` |   |${r.split("").map(c=>i(c,3)).join("|")}
`;for(let c=0;c<=t;c++)c===0?l+=" |":l+=`${n[c-1]}|`,l+=e[c].slice(0,u+1).map(o=>i(o.toString(),3)).join("|")+`
`;return l}function Fe(e,n,t,r){e=e.substr(n),t=t.substr(r)}function _(e,n){if(n<0||n>=e.length)return!1;const t=e.codePointAt(n);switch(t){case a.Underline:case a.Dash:case a.Period:case a.Space:case a.Slash:case a.Backslash:case a.SingleQuote:case a.DoubleQuote:case a.Colon:case a.DollarSign:case a.LessThan:case a.GreaterThan:case a.OpenParen:case a.CloseParen:case a.OpenSquareBracket:case a.CloseSquareBracket:case a.OpenCurlyBrace:case a.CloseCurlyBrace:return!0;case void 0:return!1;default:return!!R.isEmojiImprecise(t)}}function le(e,n){if(n<0||n>=e.length)return!1;switch(e.charCodeAt(n)){case a.Space:case a.Tab:return!0;default:return!1}}function L(e,n,t){return n[e]!==t[e]}function Ie(e,n,t,r,u,i,l=!1){for(;n<t&&u<i;)e[n]===r[u]&&(l&&(ie[n]=u),n+=1),u+=1;return n===t}var Se=(r=>(r[r.Diag=1]="Diag",r[r.Left=2]="Left",r[r.LeftLeft=3]="LeftLeft",r))(Se||{}),Ae;(t=>{t.Default=[-100,0];function n(r){return!r||r.length===2&&r[0]===-100&&r[1]===0}t.isDefault=n})(Ae||={});class _e{constructor(n,t){this.firstMatchCanBeWeak=n;this.boostFullMatch=t}static default={boostFullMatch:!0,firstMatchCanBeWeak:!1}}function k(e,n,t,r,u,i,l=_e.default){const c=e.length>p?p:e.length,o=r.length>p?p:r.length;if(t>=c||i>=o||c-t>o-i||!Ie(n,t,c,u,i,o,!0))return;Le(c,o,t,i,n,u);let s=1,f=1,h=t,g=i;const K=[!1];for(s=1,h=t;h<c;s++,h++){const b=ie[h],M=$[h],fe=h+1<c?$[h+1]:o;for(f=b-i+1,g=b;g<fe;f++,g++){let O=Number.MIN_SAFE_INTEGER,x=!1;g<=M&&(O=ke(e,n,h,t,r,u,g,o,i,m[s-1][f-1]===0,K));let F=0;O!==Number.MAX_SAFE_INTEGER&&(x=!0,F=O+C[s-1][f-1]);const D=g>b,B=D?C[s][f-1]+(m[s][f-1]>0?-5:0):0,X=g>b+1&&m[s][f-1]>0,N=X?C[s][f-2]+(m[s][f-2]>0?-5:0):0;if(X&&(!D||N>=B)&&(!x||N>=F))C[s][f]=N,A[s][f]=3,m[s][f]=0;else if(D&&(!x||B>=F))C[s][f]=B,A[s][f]=2,m[s][f]=0;else if(x)C[s][f]=F,A[s][f]=1,m[s][f]=m[s-1][f-1]+1;else throw new Error("not possible")}}if(xe&&Fe(e,t,r,i),!K[0]&&!l.firstMatchCanBeWeak)return;s--,f--;const z=[C[s][f],i];let y=0,E=0;for(;s>=1;){let b=f;do{const M=A[s][b];if(M===3)b=b-2;else if(M===2)b=b-1;else break}while(b>=1);y>1&&n[t+s-1]===u[i+f-1]&&!L(b+i-1,r,u)&&y+1>m[s][b]&&(b=f),b===f?y++:y=1,E||(E=b),s--,f=b-1,z.push(f)}o-i===c&&l.boostFullMatch&&(z[0]+=2);const ce=E-c;return z[0]-=ce,z}function Le(e,n,t,r,u,i){let l=e-1,c=n-1;for(;l>=t&&c>=r;)u[l]===i[c]&&($[l]=c,l--),c--}function ke(e,n,t,r,u,i,l,c,o,s,f){if(n[t]!==i[l])return Number.MIN_SAFE_INTEGER;let h=1,g=!1;return l===t-r?h=e[t]===u[l]?7:5:L(l,u,i)&&(l===0||!L(l-1,u,i))?(h=e[t]===u[l]?7:5,g=!0):_(i,l)&&(l===0||!_(i,l-1))?h=5:(_(i,l-1)||le(i,l-1))&&(h=5,g=!0),h>1&&t===r&&(f[0]=!0),g||(g=L(l,u,i)||_(i,l-1)||le(i,l-1)),t===r?l>o&&(h-=g?3:5):s?h+=g?2:0:h+=g?0:1,l+1===c&&(h-=g?3:5),h}function We(e,n,t,r,u,i,l){return se(e,n,t,r,u,i,!0,l)}function qe(e,n,t,r,u,i,l){return se(e,n,t,r,u,i,!1,l)}function se(e,n,t,r,u,i,l,c){let o=k(e,n,t,r,u,i,c);if(o&&!l)return o;if(e.length>=3){const s=Math.min(7,e.length-1);for(let f=t+1;f<s;f++){const h=Ee(e,f);if(h){const g=k(h,h.toLowerCase(),t,r,u,i,c);g&&(g[0]-=3,(!o||g[0]>o[0])&&(o=g))}}}return o}function Ee(e,n){if(n+1>=e.length)return;const t=e[n],r=e[n+1];if(t!==r)return e.slice(0,n)+r+t+e.slice(n+2)}export{Ae as FuzzyScore,_e as FuzzyScoreOptions,Te as anyScore,Me as createMatches,k as fuzzyScore,qe as fuzzyScoreGraceful,We as fuzzyScoreGracefulAggressive,Ie as isPatternInWord,I as isUpper,ne as matchesCamelCase,he as matchesContiguousSubString,Pe as matchesFuzzy,Ge as matchesFuzzy2,H as matchesPrefix,Ne as matchesStrictPrefix,ge as matchesSubString,Re as matchesWords,Z as or};
