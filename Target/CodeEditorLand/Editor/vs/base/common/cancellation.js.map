{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/common/cancellation.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from './event.js';\nimport { DisposableStore, IDisposable } from './lifecycle.js';\n\nexport interface CancellationToken {\n\n\t/**\n\t * A flag signalling is cancellation has been requested.\n\t */\n\treadonly isCancellationRequested: boolean;\n\n\t/**\n\t * An event which fires when cancellation is requested. This event\n\t * only ever fires `once` as cancellation can only happen once. Listeners\n\t * that are registered after cancellation will be called (next event loop run),\n\t * but also only once.\n\t *\n\t * @event\n\t */\n\treadonly onCancellationRequested: (listener: (e: any) => any, thisArgs?: any, disposables?: IDisposable[]) => IDisposable;\n}\n\nconst shortcutEvent: Event<any> = Object.freeze(function (callback, context?): IDisposable {\n\tconst handle = setTimeout(callback.bind(context), 0);\n\treturn { dispose() { clearTimeout(handle); } };\n});\n\nexport namespace CancellationToken {\n\n\texport function isCancellationToken(thing: unknown): thing is CancellationToken {\n\t\tif (thing === CancellationToken.None || thing === CancellationToken.Cancelled) {\n\t\t\treturn true;\n\t\t}\n\t\tif (thing instanceof MutableToken) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing || typeof thing !== 'object') {\n\t\t\treturn false;\n\t\t}\n\t\treturn typeof (thing as CancellationToken).isCancellationRequested === 'boolean'\n\t\t\t&& typeof (thing as CancellationToken).onCancellationRequested === 'function';\n\t}\n\n\n\texport const None = Object.freeze<CancellationToken>({\n\t\tisCancellationRequested: false,\n\t\tonCancellationRequested: Event.None\n\t});\n\n\texport const Cancelled = Object.freeze<CancellationToken>({\n\t\tisCancellationRequested: true,\n\t\tonCancellationRequested: shortcutEvent\n\t});\n}\n\nclass MutableToken implements CancellationToken {\n\n\tprivate _isCancelled: boolean = false;\n\tprivate _emitter: Emitter<any> | null = null;\n\n\tpublic cancel() {\n\t\tif (!this._isCancelled) {\n\t\t\tthis._isCancelled = true;\n\t\t\tif (this._emitter) {\n\t\t\t\tthis._emitter.fire(undefined);\n\t\t\t\tthis.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCancellationRequested(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tget onCancellationRequested(): Event<any> {\n\t\tif (this._isCancelled) {\n\t\t\treturn shortcutEvent;\n\t\t}\n\t\tif (!this._emitter) {\n\t\t\tthis._emitter = new Emitter<any>();\n\t\t}\n\t\treturn this._emitter.event;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._emitter) {\n\t\t\tthis._emitter.dispose();\n\t\t\tthis._emitter = null;\n\t\t}\n\t}\n}\n\nexport class CancellationTokenSource {\n\n\tprivate _token?: CancellationToken = undefined;\n\tprivate _parentListener?: IDisposable = undefined;\n\n\tconstructor(parent?: CancellationToken) {\n\t\tthis._parentListener = parent && parent.onCancellationRequested(this.cancel, this);\n\t}\n\n\tget token(): CancellationToken {\n\t\tif (!this._token) {\n\t\t\t// be lazy and create the token only when\n\t\t\t// actually needed\n\t\t\tthis._token = new MutableToken();\n\t\t}\n\t\treturn this._token;\n\t}\n\n\tcancel(): void {\n\t\tif (!this._token) {\n\t\t\t// save an object by returning the default\n\t\t\t// cancelled token when cancellation happens\n\t\t\t// before someone asks for the token\n\t\t\tthis._token = CancellationToken.Cancelled;\n\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually cancel\n\t\t\tthis._token.cancel();\n\t\t}\n\t}\n\n\tdispose(cancel: boolean = false): void {\n\t\tif (cancel) {\n\t\t\tthis.cancel();\n\t\t}\n\t\tthis._parentListener?.dispose();\n\t\tif (!this._token) {\n\t\t\t// ensure to initialize with an empty token if we had none\n\t\t\tthis._token = CancellationToken.None;\n\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually dispose\n\t\t\tthis._token.dispose();\n\t\t}\n\t}\n}\n\nexport function cancelOnDispose(store: DisposableStore): CancellationToken {\n\tconst source = new CancellationTokenSource();\n\tstore.add({ dispose() { source.cancel(); } });\n\treturn source.token;\n}\n"],
  "mappings": ";;AAKA,SAAS,SAAS,aAAa;AAC/B,SAAS,iBAAiB,mBAAmB;AAoB7C,MAAM,gBAA4B,OAAO,OAAO,SAAU,UAAU,SAAuB;AAC1F,QAAM,SAAS,WAAW,SAAS,KAAK,OAAO,GAAG,CAAC;AACnD,SAAO,EAAE,UAAU;AAAE,iBAAa,MAAM;AAAA,EAAG,EAAE;AAC9C,CAAC;AAEM,IAAU;AAAA,CAAV,CAAUA,uBAAV;AAEC,WAAS,oBAAoB,OAA4C;AAC/E,QAAI,UAAUA,mBAAkB,QAAQ,UAAUA,mBAAkB,WAAW;AAC9E,aAAO;AAAA,IACR;AACA,QAAI,iBAAiB,cAAc;AAClC,aAAO;AAAA,IACR;AACA,QAAI,CAAC,SAAS,OAAO,UAAU,UAAU;AACxC,aAAO;AAAA,IACR;AACA,WAAO,OAAQ,MAA4B,4BAA4B,aACnE,OAAQ,MAA4B,4BAA4B;AAAA,EACrE;AAZO,EAAAA,mBAAS;AAAA;AAeT,EAAMA,mBAAA,OAAO,OAAO,OAA0B;AAAA,IACpD,yBAAyB;AAAA,IACzB,yBAAyB,MAAM;AAAA,EAChC,CAAC;AAEM,EAAMA,mBAAA,YAAY,OAAO,OAA0B;AAAA,IACzD,yBAAyB;AAAA,IACzB,yBAAyB;AAAA,EAC1B,CAAC;AAAA,GAzBe;AA4BjB,MAAM,aAA0C;AAAA,EA3DhD,OA2DgD;AAAA;AAAA;AAAA,EAEvC,eAAwB;AAAA,EACxB,WAAgC;AAAA,EAEjC,SAAS;AACf,QAAI,CAAC,KAAK,cAAc;AACvB,WAAK,eAAe;AACpB,UAAI,KAAK,UAAU;AAClB,aAAK,SAAS,KAAK,MAAS;AAC5B,aAAK,QAAQ;AAAA,MACd;AAAA,IACD;AAAA,EACD;AAAA,EAEA,IAAI,0BAAmC;AACtC,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,IAAI,0BAAsC;AACzC,QAAI,KAAK,cAAc;AACtB,aAAO;AAAA,IACR;AACA,QAAI,CAAC,KAAK,UAAU;AACnB,WAAK,WAAW,IAAI,QAAa;AAAA,IAClC;AACA,WAAO,KAAK,SAAS;AAAA,EACtB;AAAA,EAEO,UAAgB;AACtB,QAAI,KAAK,UAAU;AAClB,WAAK,SAAS,QAAQ;AACtB,WAAK,WAAW;AAAA,IACjB;AAAA,EACD;AACD;AAEO,MAAM,wBAAwB;AAAA,EAhGrC,OAgGqC;AAAA;AAAA;AAAA,EAE5B,SAA6B;AAAA,EAC7B,kBAAgC;AAAA,EAExC,YAAY,QAA4B;AACvC,SAAK,kBAAkB,UAAU,OAAO,wBAAwB,KAAK,QAAQ,IAAI;AAAA,EAClF;AAAA,EAEA,IAAI,QAA2B;AAC9B,QAAI,CAAC,KAAK,QAAQ;AAGjB,WAAK,SAAS,IAAI,aAAa;AAAA,IAChC;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,SAAe;AACd,QAAI,CAAC,KAAK,QAAQ;AAIjB,WAAK,SAAS,kBAAkB;AAAA,IAEjC,WAAW,KAAK,kBAAkB,cAAc;AAE/C,WAAK,OAAO,OAAO;AAAA,IACpB;AAAA,EACD;AAAA,EAEA,QAAQ,SAAkB,OAAa;AACtC,QAAI,QAAQ;AACX,WAAK,OAAO;AAAA,IACb;AACA,SAAK,iBAAiB,QAAQ;AAC9B,QAAI,CAAC,KAAK,QAAQ;AAEjB,WAAK,SAAS,kBAAkB;AAAA,IAEjC,WAAW,KAAK,kBAAkB,cAAc;AAE/C,WAAK,OAAO,QAAQ;AAAA,IACrB;AAAA,EACD;AACD;AAEO,SAAS,gBAAgB,OAA2C;AAC1E,QAAM,SAAS,IAAI,wBAAwB;AAC3C,QAAM,IAAI,EAAE,UAAU;AAAE,WAAO,OAAO;AAAA,EAAG,EAAE,CAAC;AAC5C,SAAO,OAAO;AACf;AAJgB;",
  "names": ["CancellationToken"]
}
