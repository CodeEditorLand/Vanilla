{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/common/cancellation.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter, Event } from \"./event.js\";\nimport type { DisposableStore, IDisposable } from \"./lifecycle.js\";\n\nexport interface CancellationToken {\n\t/**\n\t * A flag signalling is cancellation has been requested.\n\t */\n\treadonly isCancellationRequested: boolean;\n\n\t/**\n\t * An event which fires when cancellation is requested. This event\n\t * only ever fires `once` as cancellation can only happen once. Listeners\n\t * that are registered after cancellation will be called (next event loop run),\n\t * but also only once.\n\t *\n\t * @event\n\t */\n\treadonly onCancellationRequested: (\n\t\tlistener: (e: any) => any,\n\t\tthisArgs?: any,\n\t\tdisposables?: IDisposable[],\n\t) => IDisposable;\n}\n\nconst shortcutEvent: Event<any> = Object.freeze(\n\t(callback, context?): IDisposable => {\n\t\tconst handle = setTimeout(callback.bind(context), 0);\n\t\treturn {\n\t\t\tdispose() {\n\t\t\t\tclearTimeout(handle);\n\t\t\t},\n\t\t};\n\t},\n);\n\nexport namespace CancellationToken {\n\texport function isCancellationToken(\n\t\tthing: unknown,\n\t): thing is CancellationToken {\n\t\tif (\n\t\t\tthing === CancellationToken.None ||\n\t\t\tthing === CancellationToken.Cancelled\n\t\t) {\n\t\t\treturn true;\n\t\t}\n\t\tif (thing instanceof MutableToken) {\n\t\t\treturn true;\n\t\t}\n\t\tif (!thing || typeof thing !== \"object\") {\n\t\t\treturn false;\n\t\t}\n\t\treturn (\n\t\t\ttypeof (thing as CancellationToken).isCancellationRequested ===\n\t\t\t\t\"boolean\" &&\n\t\t\ttypeof (thing as CancellationToken).onCancellationRequested ===\n\t\t\t\t\"function\"\n\t\t);\n\t}\n\n\texport const None = Object.freeze<CancellationToken>({\n\t\tisCancellationRequested: false,\n\t\tonCancellationRequested: Event.None,\n\t});\n\n\texport const Cancelled = Object.freeze<CancellationToken>({\n\t\tisCancellationRequested: true,\n\t\tonCancellationRequested: shortcutEvent,\n\t});\n}\n\nclass MutableToken implements CancellationToken {\n\tprivate _isCancelled = false;\n\tprivate _emitter: Emitter<any> | null = null;\n\n\tpublic cancel() {\n\t\tif (!this._isCancelled) {\n\t\t\tthis._isCancelled = true;\n\t\t\tif (this._emitter) {\n\t\t\t\tthis._emitter.fire(undefined);\n\t\t\t\tthis.dispose();\n\t\t\t}\n\t\t}\n\t}\n\n\tget isCancellationRequested(): boolean {\n\t\treturn this._isCancelled;\n\t}\n\n\tget onCancellationRequested(): Event<any> {\n\t\tif (this._isCancelled) {\n\t\t\treturn shortcutEvent;\n\t\t}\n\t\tif (!this._emitter) {\n\t\t\tthis._emitter = new Emitter<any>();\n\t\t}\n\t\treturn this._emitter.event;\n\t}\n\n\tpublic dispose(): void {\n\t\tif (this._emitter) {\n\t\t\tthis._emitter.dispose();\n\t\t\tthis._emitter = null;\n\t\t}\n\t}\n}\n\nexport class CancellationTokenSource {\n\tprivate _token?: CancellationToken = undefined;\n\tprivate _parentListener?: IDisposable = undefined;\n\n\tconstructor(parent?: CancellationToken) {\n\t\tthis._parentListener =\n\t\t\tparent && parent.onCancellationRequested(this.cancel, this);\n\t}\n\n\tget token(): CancellationToken {\n\t\tif (!this._token) {\n\t\t\t// be lazy and create the token only when\n\t\t\t// actually needed\n\t\t\tthis._token = new MutableToken();\n\t\t}\n\t\treturn this._token;\n\t}\n\n\tcancel(): void {\n\t\tif (!this._token) {\n\t\t\t// save an object by returning the default\n\t\t\t// cancelled token when cancellation happens\n\t\t\t// before someone asks for the token\n\t\t\tthis._token = CancellationToken.Cancelled;\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually cancel\n\t\t\tthis._token.cancel();\n\t\t}\n\t}\n\n\tdispose(cancel = false): void {\n\t\tif (cancel) {\n\t\t\tthis.cancel();\n\t\t}\n\t\tthis._parentListener?.dispose();\n\t\tif (!this._token) {\n\t\t\t// ensure to initialize with an empty token if we had none\n\t\t\tthis._token = CancellationToken.None;\n\t\t} else if (this._token instanceof MutableToken) {\n\t\t\t// actually dispose\n\t\t\tthis._token.dispose();\n\t\t}\n\t}\n}\n\nexport function cancelOnDispose(store: DisposableStore): CancellationToken {\n\tconst source = new CancellationTokenSource();\n\tstore.add({\n\t\tdispose() {\n\t\t\tsource.cancel();\n\t\t},\n\t});\n\treturn source.token;\n}\n"],
  "mappings": ";;AAKA,SAAS,SAAS,aAAa;AAwB/B,MAAM,gBAA4B,OAAO;AAAA,EACxC,CAAC,UAAU,YAA0B;AACpC,UAAM,SAAS,WAAW,SAAS,KAAK,OAAO,GAAG,CAAC;AACnD,WAAO;AAAA,MACN,UAAU;AACT,qBAAa,MAAM;AAAA,MACpB;AAAA,IACD;AAAA,EACD;AACD;AAEO,IAAU;AAAA,CAAV,CAAUA,uBAAV;AACC,WAAS,oBACf,OAC6B;AAC7B,QACC,UAAUA,mBAAkB,QAC5B,UAAUA,mBAAkB,WAC3B;AACD,aAAO;AAAA,IACR;AACA,QAAI,iBAAiB,cAAc;AAClC,aAAO;AAAA,IACR;AACA,QAAI,CAAC,SAAS,OAAO,UAAU,UAAU;AACxC,aAAO;AAAA,IACR;AACA,WACC,OAAQ,MAA4B,4BACnC,aACD,OAAQ,MAA4B,4BACnC;AAAA,EAEH;AArBO,EAAAA,mBAAS;AAAA;AAuBT,EAAMA,mBAAA,OAAO,OAAO,OAA0B;AAAA,IACpD,yBAAyB;AAAA,IACzB,yBAAyB,MAAM;AAAA,EAChC,CAAC;AAEM,EAAMA,mBAAA,YAAY,OAAO,OAA0B;AAAA,IACzD,yBAAyB;AAAA,IACzB,yBAAyB;AAAA,EAC1B,CAAC;AAAA,GAhCe;AAmCjB,MAAM,aAA0C;AAAA,EA3EhD,OA2EgD;AAAA;AAAA;AAAA,EACvC,eAAe;AAAA,EACf,WAAgC;AAAA,EAEjC,SAAS;AACf,QAAI,CAAC,KAAK,cAAc;AACvB,WAAK,eAAe;AACpB,UAAI,KAAK,UAAU;AAClB,aAAK,SAAS,KAAK,MAAS;AAC5B,aAAK,QAAQ;AAAA,MACd;AAAA,IACD;AAAA,EACD;AAAA,EAEA,IAAI,0BAAmC;AACtC,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,IAAI,0BAAsC;AACzC,QAAI,KAAK,cAAc;AACtB,aAAO;AAAA,IACR;AACA,QAAI,CAAC,KAAK,UAAU;AACnB,WAAK,WAAW,IAAI,QAAa;AAAA,IAClC;AACA,WAAO,KAAK,SAAS;AAAA,EACtB;AAAA,EAEO,UAAgB;AACtB,QAAI,KAAK,UAAU;AAClB,WAAK,SAAS,QAAQ;AACtB,WAAK,WAAW;AAAA,IACjB;AAAA,EACD;AACD;AAEO,MAAM,wBAAwB;AAAA,EA/GrC,OA+GqC;AAAA;AAAA;AAAA,EAC5B,SAA6B;AAAA,EAC7B,kBAAgC;AAAA,EAExC,YAAY,QAA4B;AACvC,SAAK,kBACJ,UAAU,OAAO,wBAAwB,KAAK,QAAQ,IAAI;AAAA,EAC5D;AAAA,EAEA,IAAI,QAA2B;AAC9B,QAAI,CAAC,KAAK,QAAQ;AAGjB,WAAK,SAAS,IAAI,aAAa;AAAA,IAChC;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,SAAe;AACd,QAAI,CAAC,KAAK,QAAQ;AAIjB,WAAK,SAAS,kBAAkB;AAAA,IACjC,WAAW,KAAK,kBAAkB,cAAc;AAE/C,WAAK,OAAO,OAAO;AAAA,IACpB;AAAA,EACD;AAAA,EAEA,QAAQ,SAAS,OAAa;AAC7B,QAAI,QAAQ;AACX,WAAK,OAAO;AAAA,IACb;AACA,SAAK,iBAAiB,QAAQ;AAC9B,QAAI,CAAC,KAAK,QAAQ;AAEjB,WAAK,SAAS,kBAAkB;AAAA,IACjC,WAAW,KAAK,kBAAkB,cAAc;AAE/C,WAAK,OAAO,QAAQ;AAAA,IACrB;AAAA,EACD;AACD;AAEO,SAAS,gBAAgB,OAA2C;AAC1E,QAAM,SAAS,IAAI,wBAAwB;AAC3C,QAAM,IAAI;AAAA,IACT,UAAU;AACT,aAAO,OAAO;AAAA,IACf;AAAA,EACD,CAAC;AACD,SAAO,OAAO;AACf;AARgB;",
  "names": ["CancellationToken"]
}
