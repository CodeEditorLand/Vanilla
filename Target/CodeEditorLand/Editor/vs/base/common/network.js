import*as R from"./errors.js";import*as v from"./platform.js";import{equalsIgnoreCase as x,startsWithIgnoreCase as f}from"./strings.js";import{URI as a}from"./uri.js";import*as h from"./path.js";var c;(t=>(t.inMemory="inmemory",t.vscode="vscode",t.internal="private",t.walkThrough="walkThrough",t.walkThroughSnippet="walkThroughSnippet",t.http="http",t.https="https",t.file="file",t.mailto="mailto",t.untitled="untitled",t.data="data",t.command="command",t.vscodeRemote="vscode-remote",t.vscodeRemoteResource="vscode-remote-resource",t.vscodeManagedRemoteResource="vscode-managed-remote-resource",t.vscodeUserData="vscode-userdata",t.vscodeCustomEditor="vscode-custom-editor",t.vscodeNotebookCell="vscode-notebook-cell",t.vscodeNotebookCellMetadata="vscode-notebook-cell-metadata",t.vscodeNotebookCellMetadataDiff="vscode-notebook-cell-metadata-diff",t.vscodeNotebookCellOutput="vscode-notebook-cell-output",t.vscodeNotebookCellOutputDiff="vscode-notebook-cell-output-diff",t.vscodeNotebookMetadata="vscode-notebook-metadata",t.vscodeInteractiveInput="vscode-interactive-input",t.vscodeSettings="vscode-settings",t.vscodeWorkspaceTrust="vscode-workspace-trust",t.vscodeTerminal="vscode-terminal",t.vscodeChatCodeBlock="vscode-chat-code-block",t.vscodeChatCodeCompareBlock="vscode-chat-code-compare-block",t.vscodeChatSesssion="vscode-chat-editor",t.webviewPanel="webview-panel",t.vscodeWebview="vscode-webview",t.extension="extension",t.vscodeFileResource="vscode-file",t.tmp="tmp",t.vsls="vsls",t.vscodeSourceControl="vscode-scm",t.commentsInput="comment",t.codeSetting="code-setting",t.outputChannel="output"))(c||={});function m(n,e){return a.isUri(n)?x(n.scheme,e):f(n,e+":")}function se(n,...e){return e.some(o=>m(n,o))}const ne="vscode-tkn",U="tkn";class b{_hosts=Object.create(null);_ports=Object.create(null);_connectionTokens=Object.create(null);_preferredWebSchema="http";_delegate=null;_serverRootPath="/";setPreferredWebSchema(e){this._preferredWebSchema=e}setDelegate(e){this._delegate=e}setServerRootPath(e,o){this._serverRootPath=k(e,o)}getServerRootPath(){return this._serverRootPath}get _remoteResourcesPath(){return h.posix.join(this._serverRootPath,c.vscodeRemoteResource)}set(e,o,r){this._hosts[e]=o,this._ports[e]=r}setConnectionToken(e,o){this._connectionTokens[e]=o}getPreferredWebSchema(){return this._preferredWebSchema}rewrite(e){if(this._delegate)try{return this._delegate(e)}catch(i){return R.onUnexpectedError(i),e}const o=e.authority;let r=this._hosts[o];r&&r.indexOf(":")!==-1&&r.indexOf("[")===-1&&(r=`[${r}]`);const d=this._ports[o],l=this._connectionTokens[o];let s=`path=${encodeURIComponent(e.path)}`;return typeof l=="string"&&(s+=`&${U}=${encodeURIComponent(l)}`),a.from({scheme:v.isWeb?this._preferredWebSchema:c.vscodeRemoteResource,authority:`${r}:${d}`,path:this._remoteResourcesPath,query:s})}}const P=new b;function k(n,e){return h.posix.join(e??"/",`${n.quality??"oss"}-${n.commit??"dev"}`)}const ie="vs/../../extensions",ce="vs/../../node_modules",ae="vs/../../node_modules.asar",pe="vs/../../node_modules.asar.unpacked",$="vscode-app";class u{static FALLBACK_AUTHORITY=$;asBrowserUri(e){const o=this.toUri(e);return this.uriToBrowserUri(o)}uriToBrowserUri(e){return e.scheme===c.vscodeRemote?P.rewrite(e):e.scheme===c.file&&(v.isNative||v.webWorkerOrigin===`${c.vscodeFileResource}://${u.FALLBACK_AUTHORITY}`)?e.with({scheme:c.vscodeFileResource,authority:e.authority||u.FALLBACK_AUTHORITY,query:null,fragment:null}):e}asFileUri(e){const o=this.toUri(e);return this.uriToFileUri(o)}uriToFileUri(e){return e.scheme===c.vscodeFileResource?e.with({scheme:c.file,authority:e.authority!==u.FALLBACK_AUTHORITY?e.authority:null,query:null,fragment:null}):e}toUri(e,o){if(a.isUri(e))return e;if(globalThis._VSCODE_FILE_ROOT){const r=globalThis._VSCODE_FILE_ROOT;if(/^\w[\w\d+.-]*:\/\//.test(r))return a.joinPath(a.parse(r,!0),e);const d=h.join(r,e);return a.file(d)}return a.parse(o.toUrl(e))}}const de=new u;var y;(l=>{const n=new Map([["1",{"Cross-Origin-Opener-Policy":"same-origin"}],["2",{"Cross-Origin-Embedder-Policy":"require-corp"}],["3",{"Cross-Origin-Opener-Policy":"same-origin","Cross-Origin-Embedder-Policy":"require-corp"}]]);l.CoopAndCoep=Object.freeze(n.get("3"));const o="vscode-coi";function r(s){let i;typeof s=="string"?i=new URL(s).searchParams:s instanceof URL?i=s.searchParams:a.isUri(s)&&(i=new URL(s.toString(!0)).searchParams);const p=i?.get(o);if(p)return n.get(p)}l.getHeadersFromQuery=r;function d(s,i,p){if(!globalThis.crossOriginIsolated)return;const g=i&&p?"3":p?"2":"1";s instanceof URLSearchParams?s.set(o,g):s[o]=g}l.addSearchParam=d})(y||={});export{y as COI,de as FileAccess,P as RemoteAuthorities,c as Schemas,$ as VSCODE_AUTHORITY,ie as builtinExtensionsPath,ne as connectionTokenCookieName,U as connectionTokenQueryName,k as getServerRootPath,m as matchesScheme,se as matchesSomeScheme,ae as nodeModulesAsarPath,pe as nodeModulesAsarUnpackedPath,ce as nodeModulesPath};
