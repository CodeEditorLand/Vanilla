import{Emitter as S}from"./event.js";import{Disposable as d}from"./lifecycle.js";var b=(t=>(t[t.Auto=1]="Auto",t[t.Hidden=2]="Hidden",t[t.Visible=3]="Visible",t))(b||{});class h{constructor(o,l,t,i,e,r,s){this._forceIntegerValues=o;this._forceIntegerValues&&(l=l|0,t=t|0,i=i|0,e=e|0,r=r|0,s=s|0),this.rawScrollLeft=i,this.rawScrollTop=s,l<0&&(l=0),i+l>t&&(i=t-l),i<0&&(i=0),e<0&&(e=0),s+e>r&&(s=r-e),s<0&&(s=0),this.width=l,this.scrollWidth=t,this.scrollLeft=i,this.height=e,this.scrollHeight=r,this.scrollTop=s}_scrollStateBrand=void 0;rawScrollLeft;rawScrollTop;width;scrollWidth;scrollLeft;height;scrollHeight;scrollTop;equals(o){return this.rawScrollLeft===o.rawScrollLeft&&this.rawScrollTop===o.rawScrollTop&&this.width===o.width&&this.scrollWidth===o.scrollWidth&&this.scrollLeft===o.scrollLeft&&this.height===o.height&&this.scrollHeight===o.scrollHeight&&this.scrollTop===o.scrollTop}withScrollDimensions(o,l){return new h(this._forceIntegerValues,typeof o.width<"u"?o.width:this.width,typeof o.scrollWidth<"u"?o.scrollWidth:this.scrollWidth,l?this.rawScrollLeft:this.scrollLeft,typeof o.height<"u"?o.height:this.height,typeof o.scrollHeight<"u"?o.scrollHeight:this.scrollHeight,l?this.rawScrollTop:this.scrollTop)}withScrollPosition(o){return new h(this._forceIntegerValues,this.width,this.scrollWidth,typeof o.scrollLeft<"u"?o.scrollLeft:this.rawScrollLeft,this.height,this.scrollHeight,typeof o.scrollTop<"u"?o.scrollTop:this.rawScrollTop)}createScrollEvent(o,l){const t=this.width!==o.width,i=this.scrollWidth!==o.scrollWidth,e=this.scrollLeft!==o.scrollLeft,r=this.height!==o.height,s=this.scrollHeight!==o.scrollHeight,u=this.scrollTop!==o.scrollTop;return{inSmoothScrolling:l,oldWidth:o.width,oldScrollWidth:o.scrollWidth,oldScrollLeft:o.scrollLeft,width:this.width,scrollWidth:this.scrollWidth,scrollLeft:this.scrollLeft,oldHeight:o.height,oldScrollHeight:o.scrollHeight,oldScrollTop:o.scrollTop,height:this.height,scrollHeight:this.scrollHeight,scrollTop:this.scrollTop,widthChanged:t,scrollWidthChanged:i,scrollLeftChanged:e,heightChanged:r,scrollHeightChanged:s,scrollTopChanged:u}}}class D extends d{_scrollableBrand=void 0;_smoothScrollDuration;_scheduleAtNextAnimationFrame;_state;_smoothScrolling;_onScroll=this._register(new S);onScroll=this._onScroll.event;constructor(o){super(),this._smoothScrollDuration=o.smoothScrollDuration,this._scheduleAtNextAnimationFrame=o.scheduleAtNextAnimationFrame,this._state=new h(o.forceIntegerValues,0,0,0,0,0,0),this._smoothScrolling=null}dispose(){this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),super.dispose()}setSmoothScrollDuration(o){this._smoothScrollDuration=o}validateScrollPosition(o){return this._state.withScrollPosition(o)}getScrollDimensions(){return this._state}setScrollDimensions(o,l){const t=this._state.withScrollDimensions(o,l);this._setState(t,!!this._smoothScrolling),this._smoothScrolling?.acceptScrollDimensions(this._state)}getFutureScrollPosition(){return this._smoothScrolling?this._smoothScrolling.to:this._state}getCurrentScrollPosition(){return this._state}setScrollPositionNow(o){const l=this._state.withScrollPosition(o);this._smoothScrolling&&(this._smoothScrolling.dispose(),this._smoothScrolling=null),this._setState(l,!1)}setScrollPositionSmooth(o,l){if(this._smoothScrollDuration===0)return this.setScrollPositionNow(o);if(this._smoothScrolling){o={scrollLeft:typeof o.scrollLeft>"u"?this._smoothScrolling.to.scrollLeft:o.scrollLeft,scrollTop:typeof o.scrollTop>"u"?this._smoothScrolling.to.scrollTop:o.scrollTop};const t=this._state.withScrollPosition(o);if(this._smoothScrolling.to.scrollLeft===t.scrollLeft&&this._smoothScrolling.to.scrollTop===t.scrollTop)return;let i;l?i=new c(this._smoothScrolling.from,t,this._smoothScrolling.startTime,this._smoothScrolling.duration):i=this._smoothScrolling.combine(this._state,t,this._smoothScrollDuration),this._smoothScrolling.dispose(),this._smoothScrolling=i}else{const t=this._state.withScrollPosition(o);this._smoothScrolling=c.start(this._state,t,this._smoothScrollDuration)}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}hasPendingScrollAnimation(){return!!this._smoothScrolling}_performSmoothScrolling(){if(!this._smoothScrolling)return;const o=this._smoothScrolling.tick(),l=this._state.withScrollPosition(o);if(this._setState(l,!0),!!this._smoothScrolling){if(o.isDone){this._smoothScrolling.dispose(),this._smoothScrolling=null;return}this._smoothScrolling.animationFrameDisposable=this._scheduleAtNextAnimationFrame(()=>{this._smoothScrolling&&(this._smoothScrolling.animationFrameDisposable=null,this._performSmoothScrolling())})}}_setState(o,l){const t=this._state;t.equals(o)||(this._state=o,this._onScroll.fire(this._state.createScrollEvent(t,l)))}}class m{scrollLeft;scrollTop;isDone;constructor(o,l,t){this.scrollLeft=o,this.scrollTop=l,this.isDone=t}}function a(n,o){const l=o-n;return function(t){return n+l*f(t)}}function p(n,o,l){return function(t){return t<l?n(t/l):o((t-l)/(1-l))}}class c{from;to;duration;startTime;animationFrameDisposable;scrollLeft;scrollTop;constructor(o,l,t,i){this.from=o,this.to=l,this.duration=i,this.startTime=t,this.animationFrameDisposable=null,this._initAnimations()}_initAnimations(){this.scrollLeft=this._initAnimation(this.from.scrollLeft,this.to.scrollLeft,this.to.width),this.scrollTop=this._initAnimation(this.from.scrollTop,this.to.scrollTop,this.to.height)}_initAnimation(o,l,t){if(Math.abs(o-l)>2.5*t){let e,r;return o<l?(e=o+.75*t,r=l-.75*t):(e=o-.75*t,r=l+.75*t),p(a(o,e),a(r,l),.33)}return a(o,l)}dispose(){this.animationFrameDisposable!==null&&(this.animationFrameDisposable.dispose(),this.animationFrameDisposable=null)}acceptScrollDimensions(o){this.to=o.withScrollPosition(this.to),this._initAnimations()}tick(){return this._tick(Date.now())}_tick(o){const l=(o-this.startTime)/this.duration;if(l<1){const t=this.scrollLeft(l),i=this.scrollTop(l);return new m(t,i,!1)}return new m(this.to.scrollLeft,this.to.scrollTop,!0)}combine(o,l,t){return c.start(o,l,t)}static start(o,l,t){t=t+10;const i=Date.now()-10;return new c(o,l,i,t)}}function g(n){return Math.pow(n,3)}function f(n){return 1-g(1-n)}export{h as ScrollState,D as Scrollable,b as ScrollbarVisibility,c as SmoothScrollingOperation,m as SmoothScrollingUpdate};
