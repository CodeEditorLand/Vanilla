import g from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as x}from"../common/utils.js";import{CSSPluginUtilities as i,rewriteUrls as t}from"../../../css.build.js";suite("CSSPlugin",()=>{x(),test("Utilities.pathOf",()=>{g.strictEqual(i.pathOf(""),""),g.strictEqual(i.pathOf("/a"),"/"),g.strictEqual(i.pathOf("a/b/c.css"),"a/b/"),g.strictEqual(i.pathOf("a"),""),g.strictEqual(i.pathOf("a.com/a.css"),"a.com/"),g.strictEqual(i.pathOf("http://a.com/a.css"),"http://a.com/"),g.strictEqual(i.pathOf("https://a.com/a.css"),"https://a.com/"),g.strictEqual(i.pathOf("http://a.com/a/b/c.css"),"http://a.com/a/b/"),g.strictEqual(i.pathOf("https://a.com/a/b/c.css"),"https://a.com/a/b/"),g.strictEqual(i.pathOf("/a.css"),"/"),g.strictEqual(i.pathOf("/a/b/c.css"),"/a/b/")}),test("Utilities.joinPaths",()=>{function s(a,m,c){g.strictEqual(i.joinPaths(a,m),c,"<"+a+"> + <"+m+"> = <"+c+">")}s("","a.css","a.css"),s("","./a.css","a.css"),s("","././././a.css","a.css"),s("","./../a.css","../a.css"),s("","../../a.css","../../a.css"),s("","../../a/b/c.css","../../a/b/c.css"),s("/","a.css","/a.css"),s("/","./a.css","/a.css"),s("/","././././a.css","/a.css"),s("/","./../a.css","/a.css"),s("/","../../a.css","/a.css"),s("/","../../a/b/c.css","/a/b/c.css"),s("x/y/z/","a.css","x/y/z/a.css"),s("x/y/z/","./a.css","x/y/z/a.css"),s("x/y/z/","././././a.css","x/y/z/a.css"),s("x/y/z/","./../a.css","x/y/a.css"),s("x/y/z/","../../a.css","x/a.css"),s("x/y/z/","../../a/b/c.css","x/a/b/c.css"),s("//a.com/","a.css","//a.com/a.css"),s("//a.com/","./a.css","//a.com/a.css"),s("//a.com/","././././a.css","//a.com/a.css"),s("//a.com/","./../a.css","//a.com/a.css"),s("//a.com/","../../a.css","//a.com/a.css"),s("//a.com/","../../a/b/c.css","//a.com/a/b/c.css"),s("//a.com/x/y/z/","a.css","//a.com/x/y/z/a.css"),s("//a.com/x/y/z/","./a.css","//a.com/x/y/z/a.css"),s("//a.com/x/y/z/","././././a.css","//a.com/x/y/z/a.css"),s("//a.com/x/y/z/","./../a.css","//a.com/x/y/a.css"),s("//a.com/x/y/z/","../../a.css","//a.com/x/a.css"),s("//a.com/x/y/z/","../../a/b/c.css","//a.com/x/a/b/c.css"),s("http://a.com/","a.css","http://a.com/a.css"),s("http://a.com/","./a.css","http://a.com/a.css"),s("http://a.com/","././././a.css","http://a.com/a.css"),s("http://a.com/","./../a.css","http://a.com/a.css"),s("http://a.com/","../../a.css","http://a.com/a.css"),s("http://a.com/","../../a/b/c.css","http://a.com/a/b/c.css"),s("http://a.com/x/y/z/","a.css","http://a.com/x/y/z/a.css"),s("http://a.com/x/y/z/","./a.css","http://a.com/x/y/z/a.css"),s("http://a.com/x/y/z/","././././a.css","http://a.com/x/y/z/a.css"),s("http://a.com/x/y/z/","./../a.css","http://a.com/x/y/a.css"),s("http://a.com/x/y/z/","../../a.css","http://a.com/x/a.css"),s("http://a.com/x/y/z/","../../a/b/c.css","http://a.com/x/a/b/c.css"),s("https://a.com/","a.css","https://a.com/a.css"),s("https://a.com/","./a.css","https://a.com/a.css"),s("https://a.com/","././././a.css","https://a.com/a.css"),s("https://a.com/","./../a.css","https://a.com/a.css"),s("https://a.com/","../../a.css","https://a.com/a.css"),s("https://a.com/","../../a/b/c.css","https://a.com/a/b/c.css"),s("https://a.com/x/y/z/","a.css","https://a.com/x/y/z/a.css"),s("https://a.com/x/y/z/","./a.css","https://a.com/x/y/z/a.css"),s("https://a.com/x/y/z/","././././a.css","https://a.com/x/y/z/a.css"),s("https://a.com/x/y/z/","./../a.css","https://a.com/x/y/a.css"),s("https://a.com/x/y/z/","../../a.css","https://a.com/x/a.css"),s("https://a.com/x/y/z/","../../a/b/c.css","https://a.com/x/a/b/c.css")}),test("Utilities.commonPrefix",()=>{function s(a,m,c){g.strictEqual(i.commonPrefix(a,m),c,"prefix(<"+a+">, <"+m+">) = <"+c+">"),g.strictEqual(i.commonPrefix(m,a),c,"prefix(<"+m+">, <"+a+">) = <"+c+">")}s("","",""),s("x","",""),s("x","x","x"),s("aaaa","aaaa","aaaa"),s("aaaaxyz","aaaa","aaaa"),s("aaaaxyz","aaaatuv","aaaa")}),test("Utilities.commonFolderPrefix",()=>{function s(a,m,c){g.strictEqual(i.commonFolderPrefix(a,m),c,"folderPrefix(<"+a+">, <"+m+">) = <"+c+">"),g.strictEqual(i.commonFolderPrefix(m,a),c,"folderPrefix(<"+m+">, <"+a+">) = <"+c+">")}s("","",""),s("x","",""),s("x","x",""),s("aaaa","aaaa",""),s("aaaaxyz","aaaa",""),s("aaaaxyz","aaaatuv",""),s("/","/","/"),s("x/","",""),s("x/","x/","x/"),s("aaaa/","aaaa/","aaaa/"),s("aaaa/axyz","aaaa/a","aaaa/"),s("aaaa/axyz","aaaa/atuv","aaaa/")}),test("Utilities.relativePath",()=>{function s(a,m,c){g.strictEqual(i.relativePath(a,m),c,"relativePath(<"+a+">, <"+m+">) = <"+c+">")}s("","",""),s("x","",""),s("x","x","x"),s("aaaa","aaaa","aaaa"),s("aaaaxyz","aaaa","aaaa"),s("aaaaxyz","aaaatuv","aaaatuv"),s("x/y/aaaaxyz","x/aaaatuv","../aaaatuv"),s("x/y/aaaaxyz","x/y/aaaatuv","aaaatuv"),s("z/t/aaaaxyz","x/y/aaaatuv","../../x/y/aaaatuv"),s("aaaaxyz","x/y/aaaatuv","x/y/aaaatuv"),s("a","/a","/a"),s("/","/a","/a"),s("/a/b/c","/a/b/c","/a/b/c"),s("/a/b","/a/b/c/d","/a/b/c/d"),s("a","http://a","http://a"),s("/","http://a","http://a"),s("/a/b/c","http://a/b/c","http://a/b/c"),s("/a/b","http://a/b/c/d","http://a/b/c/d"),s("a","https://a","https://a"),s("/","https://a","https://a"),s("/a/b/c","https://a/b/c","https://a/b/c"),s("/a/b","https://a/b/c/d","https://a/b/c/d"),s("x/","","../"),s("x/","","../"),s("x/","x/",""),s("x/a","x/a","a")}),test("Utilities.rewriteUrls",()=>{function s(a,m,c,p){g.strictEqual(t(a,m,"sel { background:url('"+c+"'); }"),"sel { background:url("+p+"); }"),g.strictEqual(t(a,m,'sel { background:url("'+c+'"); }'),"sel { background:url("+p+"); }"),g.strictEqual(t(a,m,"sel { background:url("+c+"); }"),"sel { background:url("+p+"); }")}s("a.css","b.css","img/img.png","img/img.png"),s("a.css","t/b.css","img/img.png","../img/img.png"),s("a.css","x/y/b.css","img/img.png","../../img/img.png"),s("x/a.css","b.css","img/img.png","x/img/img.png"),s("x/y/a.css","b.css","img/img.png","x/y/img/img.png"),s("x/y/a.css","t/u/b.css","img/img.png","../../x/y/img/img.png"),s("x/y/a.css","x/u/b.css","img/img.png","../y/img/img.png"),s("x/y/a.css","x/y/b.css","img/img.png","img/img.png"),s("/a.css","b.css","img/img.png","/img/img.png"),s("/a.css","x/b.css","img/img.png","/img/img.png"),s("/a.css","x/y/b.css","img/img.png","/img/img.png"),s("/x/a.css","b.css","img/img.png","/x/img/img.png"),s("/x/a.css","x/b.css","img/img.png","/x/img/img.png"),s("/x/a.css","x/y/b.css","img/img.png","/x/img/img.png"),s("/x/y/a.css","b.css","img/img.png","/x/y/img/img.png"),s("/x/y/a.css","x/b.css","img/img.png","/x/y/img/img.png"),s("/x/y/a.css","x/y/b.css","img/img.png","/x/y/img/img.png"),s("/a.css","/b.css","img/img.png","/img/img.png"),s("/a.css","/b.css","img/img.png","/img/img.png"),s("/x/a.css","/b.css","img/img.png","/x/img/img.png"),s("/x/a.css","/x/b.css","img/img.png","/x/img/img.png"),s("http://www.example.com/x/y/a.css","b.css","img/img.png","http://www.example.com/x/y/img/img.png"),s("http://www.example.com/x/y/a.css","http://www.example2.com/b.css","img/img.png","http://www.example.com/x/y/img/img.png"),s("https://www.example.com/x/y/a.css","b.css","img/img.png","https://www.example.com/x/y/img/img.png"),s("a.css","b.css","../img/img.png","../img/img.png"),s("a.css","t/b.css","../img/img.png","../../img/img.png"),s("a.css","x/y/b.css","../img/img.png","../../../img/img.png"),s("x/a.css","b.css","../img/img.png","img/img.png"),s("x/y/a.css","b.css","../img/img.png","x/img/img.png"),s("x/y/a.css","t/u/b.css","../img/img.png","../../x/img/img.png"),s("x/y/a.css","x/u/b.css","../img/img.png","../img/img.png"),s("x/y/a.css","x/y/b.css","../img/img.png","../img/img.png"),s("/a.css","b.css","../img/img.png","/img/img.png"),s("/a.css","x/b.css","../img/img.png","/img/img.png"),s("/a.css","x/y/b.css","../img/img.png","/img/img.png"),s("/x/a.css","b.css","../img/img.png","/img/img.png"),s("/x/a.css","x/b.css","../img/img.png","/img/img.png"),s("/x/a.css","x/y/b.css","../img/img.png","/img/img.png"),s("/x/y/a.css","b.css","../img/img.png","/x/img/img.png"),s("/x/y/a.css","x/b.css","../img/img.png","/x/img/img.png"),s("/x/y/a.css","x/y/b.css","../img/img.png","/x/img/img.png"),s("/a.css","/b.css","../img/img.png","/img/img.png"),s("/a.css","/b.css","../img/img.png","/img/img.png"),s("/x/a.css","/b.css","../img/img.png","/img/img.png"),s("/x/a.css","/x/b.css","../img/img.png","/img/img.png"),s("http://www.example.com/x/y/a.css","b.css","../img/img.png","http://www.example.com/x/img/img.png"),s("http://www.example.com/x/y/a.css","http://www.example2.com/b.css","../img/img.png","http://www.example.com/x/img/img.png"),s("https://www.example.com/x/y/a.css","b.css","../img/img.png","https://www.example.com/x/img/img.png"),s("a.css","b.css","/img/img.png","/img/img.png"),s("a.css","t/b.css","/img/img.png","/img/img.png"),s("a.css","x/y/b.css","/img/img.png","/img/img.png"),s("x/a.css","b.css","/img/img.png","/img/img.png"),s("x/y/a.css","b.css","/img/img.png","/img/img.png"),s("x/y/a.css","t/u/b.css","/img/img.png","/img/img.png"),s("x/y/a.css","x/u/b.css","/img/img.png","/img/img.png"),s("x/y/a.css","x/y/b.css","/img/img.png","/img/img.png"),s("/a.css","b.css","/img/img.png","/img/img.png"),s("/a.css","x/b.css","/img/img.png","/img/img.png"),s("/a.css","x/y/b.css","/img/img.png","/img/img.png"),s("/x/a.css","b.css","/img/img.png","/img/img.png"),s("/x/a.css","x/b.css","/img/img.png","/img/img.png"),s("/x/a.css","x/y/b.css","/img/img.png","/img/img.png"),s("/x/y/a.css","b.css","/img/img.png","/img/img.png"),s("/x/y/a.css","x/b.css","/img/img.png","/img/img.png"),s("/x/y/a.css","x/y/b.css","/img/img.png","/img/img.png"),s("/a.css","/b.css","/img/img.png","/img/img.png"),s("/a.css","/b.css","/img/img.png","/img/img.png"),s("/x/a.css","/b.css","/img/img.png","/img/img.png"),s("/x/a.css","/x/b.css","/img/img.png","/img/img.png"),s("http://www.example.com/x/y/a.css","b.css","/img/img.png","http://www.example.com/img/img.png"),s("http://www.example.com/x/y/a.css","http://www.example.com/x/y/b.css","/img/img.png","http://www.example.com/img/img.png"),s("https://www.example.com/x/y/a.css","b.css","/img/img.png","https://www.example.com/img/img.png"),s("a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("a.css","t/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("a.css","x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("x/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("x/y/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("x/y/a.css","t/u/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("x/y/a.css","x/u/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("x/y/a.css","x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/a.css","x/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/a.css","x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/a.css","x/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/a.css","x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/y/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/y/a.css","x/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/y/a.css","x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/a.css","/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/a.css","/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/a.css","/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("/x/a.css","/x/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("http://www.example.com/x/y/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("http://www.example.com/x/y/a.css","http://www.example.com/x/y/b.css","http://example.com/img/img.png","http://example.com/img/img.png"),s("https://www.example.com/x/y/a.css","b.css","http://example.com/img/img.png","http://example.com/img/img.png")}),test("Utilities.rewriteUrls - quotes and spaces",()=>{g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url('../img/img.png'); }"),"sel { background:url(../../x/img/img.png); }"),g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url(	'../img/img.png'); }"),"sel { background:url(../../x/img/img.png); }"),g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url( '../img/img.png'); }"),"sel { background:url(../../x/img/img.png); }"),g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url('../img/img.png'	); }"),"sel { background:url(../../x/img/img.png); }"),g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url('../img/img.png' ); }"),"sel { background:url(../../x/img/img.png); }"),g.strictEqual(t("x/y/a.css","t/u/b.css","sel { background:url(   	   '../img/img.png'     	); }"),"sel { background:url(../../x/img/img.png); }")}),test("Bug 9601 - css should ignore data urls",()=>{const s="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAACXBIWXMAAAsTAAALEwEAmpwYAAACHmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNC40LjAiPgogICA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczpkYz0iaHR0cDovL3B1cmwub3JnL2RjL2VsZW1lbnRzLzEuMS8iPgogICAgICAgICA8ZGM6c3ViamVjdD4KICAgICAgICAgICAgPHJkZjpCYWcvPgogICAgICAgICA8L2RjOnN1YmplY3Q+CiAgICAgIDwvcmRmOkRlc2NyaXB0aW9uPgogICAgICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgICAgICAgICB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iPgogICAgICAgICA8eG1wOkNyZWF0b3JUb29sPkFkb2JlIEltYWdlUmVhZHk8L3htcDpDcmVhdG9yVG9vbD4KICAgICAgPC9yZGY6RGVzY3JpcHRpb24+CiAgIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+ClC8oVQAAAGnSURBVDiNrZMxTxNxGMZ///9dZWns9a4dTHSABFiuCU5dGt2d9BsQls6GD2LCd2AiQQfixKIJE0ObdKIUSvDa5uLZihP0Sh+HOw3ipOUZ3zzvL2+e932NJBaRe7/Q8Uw5eMRrzXllDU8A5mJkLB+/TflQ+67JXb+5O0FUNS9deLckns/tn2A7hxtDawZvn37Vp78AX8rmxZLDewf89HGJ+fgKCrkrBeuXKPy44hbGN7e8eTbRZwALcFE2nuOy48j6zmaTYP8Qtxaia9A1uLWQYP8QZ7OJI+s7LjsXZeMBIIlLn61xgEbLnqadtiQp7Z0orq8rrq8r7Z1IkqadtkbLnsYBuvTZkpQBhgF7SRVFJRQ3QqW9bgY5P1V6fpoDu4oboaISSqpoGLD3GzAIOEqqaFBBURHF9TWlZxlEktKzruL6mqJi5kmqaBBwJIl7Wf+7LICBIYBSKGyE+LsHuCurzPo9Zv0e7soq/u4BhY0Qpfn68p6HCbHv4Q0qtBPfarLd1LR1nAVWzDNphJq2jjXZbirxrQYV2n0PT9Lih/Rwp/xLCz3T/+gnd2VVRJs/vngAAAAASUVORK5CYII=";function a(m,c){g.strictEqual(t(m,c,"sel { background:url("+s+"); }"),"sel { background:url("+s+"); }"),g.strictEqual(t(m,c,"sel { background:url( 	"+s+"	 ); }"),"sel { background:url("+s+"); }")}a("a.css","b.css"),a("a.css","t/b.css"),a("a.css","x/y/b.css"),a("x/a.css","b.css"),a("x/y/a.css","b.css"),a("x/y/a.css","t/u/b.css"),a("x/y/a.css","x/u/b.css"),a("x/y/a.css","x/y/b.css"),a("/a.css","b.css"),a("/a.css","x/b.css"),a("/a.css","x/y/b.css"),a("/x/a.css","b.css"),a("/x/a.css","x/b.css"),a("/x/a.css","x/y/b.css"),a("/x/y/a.css","b.css"),a("/x/y/a.css","x/b.css"),a("/x/y/a.css","x/y/b.css"),a("/a.css","/b.css"),a("/a.css","/b.css"),a("/x/a.css","/b.css"),a("/x/a.css","/x/b.css"),a("http://www.example.com/x/y/a.css","b.css"),a("http://www.example.com/x/y/a.css","http://www.example.com/x/y/b.css"),a("https://www.example.com/x/y/a.css","b.css")})});
