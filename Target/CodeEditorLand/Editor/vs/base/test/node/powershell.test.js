import a from"assert";import*as l from"fs";import*as r from"../../common/platform.js";import{enumeratePowerShellInstallations as n,getFirstAvailablePowerShellInstallation as i}from"../../node/powershell.js";import{ensureNoDisposablesAreLeakedInTestSuite as h}from"../common/utils.js";function o(t){let e=!1;try{e=l.statSync(t).isFile()}catch{try{e=l.statSync(l.readlinkSync(t)).isFile()}catch{}}a.strictEqual(e,!0)}r.isWindows&&suite("PowerShell finder",()=>{h(),test("Can find first available PowerShell",async()=>{const t=await i(),e=t?.exePath;a.notStrictEqual(e,null),a.notStrictEqual(t?.displayName,null),o(e)}),test("Can enumerate PowerShells",async()=>{const t=new Array;for await(const s of n())t.push(s);const e=`Found these PowerShells:
`+t.map(s=>`${s.displayName}: ${s.exePath}`).join(`
`);a.strictEqual(t.length>=1,!0,e);for(const s of t)o(s.exePath);a.strictEqual(t[t.length-1].displayName,"Windows PowerShell",e)})});
