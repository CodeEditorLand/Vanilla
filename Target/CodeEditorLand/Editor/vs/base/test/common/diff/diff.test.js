import a from"assert";import{LcsDiff as d,StringDiffSequence as o}from"../../../common/diff/diff.js";import{ensureNoDisposablesAreLeakedInTestSuite as w}from"../utils.js";function D(t,n){const f=[];for(let e=0;e<t;e++)f[e]=n;return f}function p(t,n){let f="";for(let e=0;e<t.length;e++)n[e]&&(f+=t.charAt(e));return f}function b(t,n,f,e,r=!1){const l=D(t.length,!0),u=D(n.length,!0);let i,s,g;for(i=0;i<f.length;i++){if(g=f[i],g.originalLength)for(s=0;s<g.originalLength;s++)l[g.originalStart+s]=!1;if(g.modifiedLength)for(s=0;s<g.modifiedLength;s++)u[g.modifiedStart+s]=!1}const z=p(t,l),m=p(n,u);r?(a.strictEqual(z.length,e.length),a.strictEqual(m.length,e.length)):(a.strictEqual(z,e),a.strictEqual(m,e))}function y(t,n,f,e=!1){const l=new d(new o(t),new o(n)).ComputeDiff(!1).changes;b(t,n,l,f,e)}function h(t,n){let f=t;for(let e=0;e<n;e++)f+=f;return f}function c(t,n,f){y(t,n,f);for(let e=2;e<=5;e++)y(h(t,e),h(n,e),h(f,e),!0)}suite("Diff",()=>{w(),test("LcsDiff - different strings tests",function(){this.timeout(1e4),c("heLLo world","hello orlando","heo orld"),c("abcde","acd","acd"),c("abcdbce","bcede","bcde"),c("abcdefgabcdefg","bcehafg","bceafg"),c("abcde","fgh",""),c("abcfabc","fabc","fabc"),c("0azby0","9axbzby9","azby"),c("0abc00000","9a1b2c399999","abc"),c("fooBar","myfooBar","fooBar"),c("fooBar","fooMyBar","fooBar"),c("fooBar","fooBar","fooBar")})}),suite("Diff - Ported from VS",()=>{w(),test("using continue processing predicate to quit early",function(){const t="abcdef",n="abxxcyyydzzzzezzzzzzzzzzzzzzzzzzzzf";let f=0,e=new d(new o(t),new o(n),function(u,i){return a.strictEqual(f,0),f++,a.strictEqual(u,1),!1}),r=e.ComputeDiff(!0).changes;a.strictEqual(f,1),b(t,n,r,"abf"),e=new d(new o(t),new o(n),function(u,i){return a(i<=1),i<1}),r=e.ComputeDiff(!0).changes,b(t,n,r,"abcf"),e=new d(new o(t),new o(n),function(u,i){return a(i<=2),i<2}),r=e.ComputeDiff(!0).changes,b(t,n,r,"abcdf");let l=!1;e=new d(new o(t),new o(n),function(u,i){a(i<=2);const s=l;return l=i>1,!s}),r=e.ComputeDiff(!0).changes,b(t,n,r,"abcdf"),e=new d(new o(t),new o(n),function(u,i){return a(i<=3),i<3}),r=e.ComputeDiff(!0).changes,b(t,n,r,"abcdef")})});
