import e from"assert";import{toSlashes as I}from"../../common/extpath.js";import{posix as U,win32 as x}from"../../common/path.js";import{isWindows as p}from"../../common/platform.js";import{addTrailingPathSeparator as y,basename as g,dirname as q,distinctParents as d,extUri as h,extUriIgnorePathCase as E,hasTrailingPathSeparator as $,isAbsolutePath as v,joinPath as l,normalizePath as t,relativePath as C,removeTrailingPathSeparator as R,resolvePath as B}from"../../common/resources.js";import{URI as o}from"../../common/uri.js";import{ensureNoDisposablesAreLeakedInTestSuite as T}from"./utils.js";suite("Resources",()=>{T(),test("distinctParents",()=>{let f=[o.file("/some/folderA/file.txt"),o.file("/some/folderB/file.txt"),o.file("/some/folderC/file.txt")],r=d(f,i=>i);e.strictEqual(r.length,3),e.strictEqual(r[0].toString(),f[0].toString()),e.strictEqual(r[1].toString(),f[1].toString()),e.strictEqual(r[2].toString(),f[2].toString()),f=[o.file("/some/folderA"),o.file("/some/folderA/file.txt"),o.file("/some/folderA/child/file.txt"),o.file("/some/folderA2/file.txt"),o.file("/some/file.txt")],r=d(f,i=>i),e.strictEqual(r.length,3),e.strictEqual(r[0].toString(),f[0].toString()),e.strictEqual(r[1].toString(),f[3].toString()),e.strictEqual(r[2].toString(),f[4].toString())}),test("dirname",()=>{p?(e.strictEqual(q(o.file("c:\\some\\file\\test.txt")).toString(),"file:///c%3A/some/file"),e.strictEqual(q(o.file("c:\\some\\file")).toString(),"file:///c%3A/some"),e.strictEqual(q(o.file("c:\\some\\file\\")).toString(),"file:///c%3A/some"),e.strictEqual(q(o.file("c:\\some")).toString(),"file:///c%3A/"),e.strictEqual(q(o.file("C:\\some")).toString(),"file:///c%3A/"),e.strictEqual(q(o.file("c:\\")).toString(),"file:///c%3A/")):(e.strictEqual(q(o.file("/some/file/test.txt")).toString(),"file:///some/file"),e.strictEqual(q(o.file("/some/file/")).toString(),"file:///some"),e.strictEqual(q(o.file("/some/file")).toString(),"file:///some")),e.strictEqual(q(o.parse("foo://a/some/file/test.txt")).toString(),"foo://a/some/file"),e.strictEqual(q(o.parse("foo://a/some/file/")).toString(),"foo://a/some"),e.strictEqual(q(o.parse("foo://a/some/file")).toString(),"foo://a/some"),e.strictEqual(q(o.parse("foo://a/some")).toString(),"foo://a/"),e.strictEqual(q(o.parse("foo://a/")).toString(),"foo://a/"),e.strictEqual(q(o.parse("foo://a")).toString(),"foo://a"),q(o.from({scheme:"file",authority:"/users/someone/portal.h"})),e.strictEqual(q(o.parse("foo://a/b/c?q")).toString(),"foo://a/b?q")}),test("basename",()=>{p?(e.strictEqual(g(o.file("c:\\some\\file\\test.txt")),"test.txt"),e.strictEqual(g(o.file("c:\\some\\file")),"file"),e.strictEqual(g(o.file("c:\\some\\file\\")),"file"),e.strictEqual(g(o.file("C:\\some\\file\\")),"file")):(e.strictEqual(g(o.file("/some/file/test.txt")),"test.txt"),e.strictEqual(g(o.file("/some/file/")),"file"),e.strictEqual(g(o.file("/some/file")),"file"),e.strictEqual(g(o.file("/some")),"some")),e.strictEqual(g(o.parse("foo://a/some/file/test.txt")),"test.txt"),e.strictEqual(g(o.parse("foo://a/some/file/")),"file"),e.strictEqual(g(o.parse("foo://a/some/file")),"file"),e.strictEqual(g(o.parse("foo://a/some")),"some"),e.strictEqual(g(o.parse("foo://a/")),""),e.strictEqual(g(o.parse("foo://a")),"")}),test("joinPath",()=>{p?(e.strictEqual(l(o.file("c:\\foo\\bar"),"/file.js").toString(),"file:///c%3A/foo/bar/file.js"),e.strictEqual(l(o.file("c:\\foo\\bar\\"),"file.js").toString(),"file:///c%3A/foo/bar/file.js"),e.strictEqual(l(o.file("c:\\foo\\bar\\"),"/file.js").toString(),"file:///c%3A/foo/bar/file.js"),e.strictEqual(l(o.file("c:\\"),"/file.js").toString(),"file:///c%3A/file.js"),e.strictEqual(l(o.file("c:\\"),"bar/file.js").toString(),"file:///c%3A/bar/file.js"),e.strictEqual(l(o.file("c:\\foo"),"./file.js").toString(),"file:///c%3A/foo/file.js"),e.strictEqual(l(o.file("c:\\foo"),"/./file.js").toString(),"file:///c%3A/foo/file.js"),e.strictEqual(l(o.file("C:\\foo"),"../file.js").toString(),"file:///c%3A/file.js"),e.strictEqual(l(o.file("C:\\foo\\."),"../file.js").toString(),"file:///c%3A/file.js")):(e.strictEqual(l(o.file("/foo/bar"),"/file.js").toString(),"file:///foo/bar/file.js"),e.strictEqual(l(o.file("/foo/bar"),"file.js").toString(),"file:///foo/bar/file.js"),e.strictEqual(l(o.file("/foo/bar/"),"/file.js").toString(),"file:///foo/bar/file.js"),e.strictEqual(l(o.file("/"),"/file.js").toString(),"file:///file.js"),e.strictEqual(l(o.file("/foo/bar"),"./file.js").toString(),"file:///foo/bar/file.js"),e.strictEqual(l(o.file("/foo/bar"),"/./file.js").toString(),"file:///foo/bar/file.js"),e.strictEqual(l(o.file("/foo/bar"),"../file.js").toString(),"file:///foo/file.js")),e.strictEqual(l(o.parse("foo://a/foo/bar")).toString(),"foo://a/foo/bar"),e.strictEqual(l(o.parse("foo://a/foo/bar"),"/file.js").toString(),"foo://a/foo/bar/file.js"),e.strictEqual(l(o.parse("foo://a/foo/bar"),"file.js").toString(),"foo://a/foo/bar/file.js"),e.strictEqual(l(o.parse("foo://a/foo/bar/"),"/file.js").toString(),"foo://a/foo/bar/file.js"),e.strictEqual(l(o.parse("foo://a/"),"/file.js").toString(),"foo://a/file.js"),e.strictEqual(l(o.parse("foo://a/foo/bar/"),"./file.js").toString(),"foo://a/foo/bar/file.js"),e.strictEqual(l(o.parse("foo://a/foo/bar/"),"/./file.js").toString(),"foo://a/foo/bar/file.js"),e.strictEqual(l(o.parse("foo://a/foo/bar/"),"../file.js").toString(),"foo://a/foo/file.js"),e.strictEqual(l(o.from({scheme:"myScheme",authority:"authority",path:"/path",query:"query",fragment:"fragment"}),"/file.js").toString(),"myScheme://authority/path/file.js?query#fragment")}),test("normalizePath",()=>{p?(e.strictEqual(t(o.file("c:\\foo\\.\\bar")).toString(),"file:///c%3A/foo/bar"),e.strictEqual(t(o.file("c:\\foo\\.")).toString(),"file:///c%3A/foo"),e.strictEqual(t(o.file("c:\\foo\\.\\")).toString(),"file:///c%3A/foo/"),e.strictEqual(t(o.file("c:\\foo\\..")).toString(),"file:///c%3A/"),e.strictEqual(t(o.file("c:\\foo\\..\\bar")).toString(),"file:///c%3A/bar"),e.strictEqual(t(o.file("c:\\foo\\..\\..\\bar")).toString(),"file:///c%3A/bar"),e.strictEqual(t(o.file("c:\\foo\\foo\\..\\..\\bar")).toString(),"file:///c%3A/bar"),e.strictEqual(t(o.file("C:\\foo\\foo\\.\\..\\..\\bar")).toString(),"file:///c%3A/bar"),e.strictEqual(t(o.file("C:\\foo\\foo\\.\\..\\some\\..\\bar")).toString(),"file:///c%3A/foo/bar")):(e.strictEqual(t(o.file("/foo/./bar")).toString(),"file:///foo/bar"),e.strictEqual(t(o.file("/foo/.")).toString(),"file:///foo"),e.strictEqual(t(o.file("/foo/./")).toString(),"file:///foo/"),e.strictEqual(t(o.file("/foo/..")).toString(),"file:///"),e.strictEqual(t(o.file("/foo/../bar")).toString(),"file:///bar"),e.strictEqual(t(o.file("/foo/../../bar")).toString(),"file:///bar"),e.strictEqual(t(o.file("/foo/foo/../../bar")).toString(),"file:///bar"),e.strictEqual(t(o.file("/foo/foo/./../../bar")).toString(),"file:///bar"),e.strictEqual(t(o.file("/foo/foo/./../some/../bar")).toString(),"file:///foo/bar"),e.strictEqual(t(o.file("/f")).toString(),"file:///f")),e.strictEqual(t(o.parse("foo://a/foo/./bar")).toString(),"foo://a/foo/bar"),e.strictEqual(t(o.parse("foo://a/foo/.")).toString(),"foo://a/foo"),e.strictEqual(t(o.parse("foo://a/foo/./")).toString(),"foo://a/foo/"),e.strictEqual(t(o.parse("foo://a/foo/..")).toString(),"foo://a/"),e.strictEqual(t(o.parse("foo://a/foo/../bar")).toString(),"foo://a/bar"),e.strictEqual(t(o.parse("foo://a/foo/../../bar")).toString(),"foo://a/bar"),e.strictEqual(t(o.parse("foo://a/foo/foo/../../bar")).toString(),"foo://a/bar"),e.strictEqual(t(o.parse("foo://a/foo/foo/./../../bar")).toString(),"foo://a/bar"),e.strictEqual(t(o.parse("foo://a/foo/foo/./../some/../bar")).toString(),"foo://a/foo/bar"),e.strictEqual(t(o.parse("foo://a")).toString(),"foo://a"),e.strictEqual(t(o.parse("foo://a/")).toString(),"foo://a/"),e.strictEqual(t(o.parse("foo://a/foo/./bar?q=1")).toString(),o.parse("foo://a/foo/bar?q%3D1").toString())}),test("isAbsolute",()=>{p?(e.strictEqual(v(o.file("c:\\foo\\")),!0),e.strictEqual(v(o.file("C:\\foo\\")),!0),e.strictEqual(v(o.file("bar")),!0)):(e.strictEqual(v(o.file("/foo/bar")),!0),e.strictEqual(v(o.file("bar")),!0)),e.strictEqual(v(o.parse("foo:foo")),!1),e.strictEqual(v(o.parse("foo://a/foo/.")),!0)});function S(f,r){e.strictEqual($(f),r,f.toString())}function m(f,r){A(R(f),r,f.toString())}function j(f,r){A(y(f),r,f.toString())}test("trailingPathSeparator",()=>{S(o.parse("foo://a/foo"),!1),S(o.parse("foo://a/foo/"),!0),S(o.parse("foo://a/"),!1),S(o.parse("foo://a"),!1),m(o.parse("foo://a/foo"),o.parse("foo://a/foo")),m(o.parse("foo://a/foo/"),o.parse("foo://a/foo")),m(o.parse("foo://a/"),o.parse("foo://a/")),m(o.parse("foo://a"),o.parse("foo://a")),j(o.parse("foo://a/foo"),o.parse("foo://a/foo/")),j(o.parse("foo://a/foo/"),o.parse("foo://a/foo/")),j(o.parse("foo://a/"),o.parse("foo://a/")),j(o.parse("foo://a"),o.parse("foo://a/")),p?(S(o.file("c:\\a\\foo"),!1),S(o.file("c:\\a\\foo\\"),!0),S(o.file("c:\\"),!1),S(o.file("\\\\server\\share\\some\\"),!0),S(o.file("\\\\server\\share\\"),!1),m(o.file("c:\\a\\foo"),o.file("c:\\a\\foo")),m(o.file("c:\\a\\foo\\"),o.file("c:\\a\\foo")),m(o.file("c:\\"),o.file("c:\\")),m(o.file("\\\\server\\share\\some\\"),o.file("\\\\server\\share\\some")),m(o.file("\\\\server\\share\\"),o.file("\\\\server\\share\\")),j(o.file("c:\\a\\foo"),o.file("c:\\a\\foo\\")),j(o.file("c:\\a\\foo\\"),o.file("c:\\a\\foo\\")),j(o.file("c:\\"),o.file("c:\\")),j(o.file("\\\\server\\share\\some"),o.file("\\\\server\\share\\some\\")),j(o.file("\\\\server\\share\\some\\"),o.file("\\\\server\\share\\some\\"))):(S(o.file("/foo/bar"),!1),S(o.file("/foo/bar/"),!0),S(o.file("/"),!1),m(o.file("/foo/bar"),o.file("/foo/bar")),m(o.file("/foo/bar/"),o.file("/foo/bar")),m(o.file("/"),o.file("/")),j(o.file("/foo/bar"),o.file("/foo/bar/")),j(o.file("/foo/bar/"),o.file("/foo/bar/")),j(o.file("/"),o.file("/")))});function A(f,r,i,c){(c?E:h).isEqual(r,f)||e.strictEqual(f.toString(),r.toString(),i)}function a(f,r,i,c,n){const b=n?E:h;e.strictEqual(b.relativePath(f,r),i,`from ${f.toString()} to ${r.toString()}`),i!==void 0&&!c&&A(R(l(f,i)),R(r),"joinPath on relativePath should be equal",n)}test("relativePath",()=>{a(o.parse("foo://a/foo"),o.parse("foo://a/foo/bar"),"bar"),a(o.parse("foo://a/foo"),o.parse("foo://a/foo/bar/"),"bar"),a(o.parse("foo://a/foo"),o.parse("foo://a/foo/bar/goo"),"bar/goo"),a(o.parse("foo://a/"),o.parse("foo://a/foo/bar/goo"),"foo/bar/goo"),a(o.parse("foo://a/foo/xoo"),o.parse("foo://a/foo/bar"),"../bar"),a(o.parse("foo://a/foo/xoo/yoo"),o.parse("foo://a"),"../../..",!0),a(o.parse("foo://a/foo"),o.parse("foo://a/foo/"),""),a(o.parse("foo://a/foo/"),o.parse("foo://a/foo"),""),a(o.parse("foo://a/foo/"),o.parse("foo://a/foo/"),""),a(o.parse("foo://a/foo"),o.parse("foo://a/foo"),""),a(o.parse("foo://a"),o.parse("foo://a"),"",!0),a(o.parse("foo://a/"),o.parse("foo://a/"),""),a(o.parse("foo://a/"),o.parse("foo://a"),"",!0),a(o.parse("foo://a/foo?q"),o.parse("foo://a/foo/bar#h"),"bar",!0),a(o.parse("foo://"),o.parse("foo://a/b"),void 0),a(o.parse("foo://a2/b"),o.parse("foo://a/b"),void 0),a(o.parse("goo://a/b"),o.parse("foo://a/b"),void 0),a(o.parse("foo://a/foo"),o.parse("foo://A/FOO/bar/goo"),"bar/goo",!1,!0),a(o.parse("foo://a/foo"),o.parse("foo://A/FOO/BAR/GOO"),"BAR/GOO",!1,!0),a(o.parse("foo://a/foo/xoo"),o.parse("foo://A/FOO/BAR/GOO"),"../BAR/GOO",!1,!0),a(o.parse("foo:///c:/a/foo"),o.parse("foo:///C:/a/foo/xoo/"),"xoo",!1,!0),p?(a(o.file("c:\\foo\\bar"),o.file("c:\\foo\\bar"),""),a(o.file("c:\\foo\\bar\\huu"),o.file("c:\\foo\\bar"),".."),a(o.file("c:\\foo\\bar\\a1\\a2"),o.file("c:\\foo\\bar"),"../.."),a(o.file("c:\\foo\\bar\\"),o.file("c:\\foo\\bar\\a1\\a2"),"a1/a2"),a(o.file("c:\\foo\\bar\\"),o.file("c:\\foo\\bar\\a1\\a2\\"),"a1/a2"),a(o.file("c:\\"),o.file("c:\\foo\\bar"),"foo/bar"),a(o.file("\\\\server\\share\\some\\"),o.file("\\\\server\\share\\some\\path"),"path"),a(o.file("\\\\server\\share\\some\\"),o.file("\\\\server\\share2\\some\\path"),"../../share2/some/path",!0)):(a(o.file("/a/foo"),o.file("/a/foo/bar"),"bar"),a(o.file("/a/foo"),o.file("/a/foo/bar/"),"bar"),a(o.file("/a/foo"),o.file("/a/foo/bar/goo"),"bar/goo"),a(o.file("/a/"),o.file("/a/foo/bar/goo"),"foo/bar/goo"),a(o.file("/"),o.file("/a/foo/bar/goo"),"a/foo/bar/goo"),a(o.file("/a/foo/xoo"),o.file("/a/foo/bar"),"../bar"),a(o.file("/a/foo/xoo/yoo"),o.file("/a"),"../../.."),a(o.file("/a/foo"),o.file("/a/foo/"),""),a(o.file("/a/foo"),o.file("/b/foo/"),"../../b/foo"))});function s(f,r,i){const c=B(f,r);if(A(c,i,`from ${f.toString()} and ${r}`),!(r.indexOf("/")!==-1?U:x).isAbsolute(r)){let b=p?I(r):r;b=b.startsWith("./")?b.substr(2):b,e.strictEqual(C(f,c),b,`relativePath (${f.toString()}) on actual (${c.toString()}) should be to path (${b})`)}}test("resolve",()=>{p?(s(o.file("c:\\foo\\bar"),"file.js",o.file("c:\\foo\\bar\\file.js")),s(o.file("c:\\foo\\bar"),"t\\file.js",o.file("c:\\foo\\bar\\t\\file.js")),s(o.file("c:\\foo\\bar"),".\\t\\file.js",o.file("c:\\foo\\bar\\t\\file.js")),s(o.file("c:\\foo\\bar"),"a1/file.js",o.file("c:\\foo\\bar\\a1\\file.js")),s(o.file("c:\\foo\\bar"),"./a1/file.js",o.file("c:\\foo\\bar\\a1\\file.js")),s(o.file("c:\\foo\\bar"),"\\b1\\file.js",o.file("c:\\b1\\file.js")),s(o.file("c:\\foo\\bar"),"/b1/file.js",o.file("c:\\b1\\file.js")),s(o.file("c:\\foo\\bar\\"),"file.js",o.file("c:\\foo\\bar\\file.js")),s(o.file("c:\\"),"file.js",o.file("c:\\file.js")),s(o.file("c:\\"),"\\b1\\file.js",o.file("c:\\b1\\file.js")),s(o.file("c:\\"),"/b1/file.js",o.file("c:\\b1\\file.js")),s(o.file("c:\\"),"d:\\foo\\bar.txt",o.file("d:\\foo\\bar.txt")),s(o.file("\\\\server\\share\\some\\"),"b1\\file.js",o.file("\\\\server\\share\\some\\b1\\file.js")),s(o.file("\\\\server\\share\\some\\"),"\\file.js",o.file("\\\\server\\share\\file.js")),s(o.file("c:\\"),"\\\\server\\share\\some\\",o.file("\\\\server\\share\\some")),s(o.file("\\\\server\\share\\some\\"),"c:\\",o.file("c:\\"))):(s(o.file("/foo/bar"),"file.js",o.file("/foo/bar/file.js")),s(o.file("/foo/bar"),"./file.js",o.file("/foo/bar/file.js")),s(o.file("/foo/bar"),"/file.js",o.file("/file.js")),s(o.file("/foo/bar/"),"file.js",o.file("/foo/bar/file.js")),s(o.file("/"),"file.js",o.file("/file.js")),s(o.file(""),"./file.js",o.file("/file.js")),s(o.file(""),"/file.js",o.file("/file.js"))),s(o.parse("foo://server/foo/bar"),"file.js",o.parse("foo://server/foo/bar/file.js")),s(o.parse("foo://server/foo/bar"),"./file.js",o.parse("foo://server/foo/bar/file.js")),s(o.parse("foo://server/foo/bar"),"./file.js",o.parse("foo://server/foo/bar/file.js")),s(o.parse("foo://server/foo/bar"),"c:\\a1\\b1",o.parse("foo://server/c:/a1/b1")),s(o.parse("foo://server/foo/bar"),"c:\\",o.parse("foo://server/c:"))});function u(f,r,i,c){const n=i?E:h;e.strictEqual(n.isEqual(f,r),c,`${f.toString()}${c?"===":"!=="}${r.toString()}`),e.strictEqual(n.compare(f,r)===0,c),e.strictEqual(n.getComparisonKey(f)===n.getComparisonKey(r),c,`comparison keys ${f.toString()}, ${r.toString()}`),e.strictEqual(n.isEqualOrParent(f,r),c,`isEqualOrParent ${f.toString()}, ${r.toString()}`),i||e.strictEqual(f.toString()===r.toString(),c)}test("isEqual",()=>{const f=p?o.file("c:\\foo\\bar"):o.file("/foo/bar"),r=p?o.file("C:\\foo\\Bar"):o.file("/foo/Bar");u(f,f,!0,!0),u(f,f,!1,!0),u(f,f,void 0,!0),u(f,r,!0,!0),u(f,r,!1,!1);const i=o.parse("foo://server:453/foo/bar"),c=o.parse("foo://server:453/foo/Bar");u(i,i,!0,!0),u(i,i,!1,!0),u(i,i,void 0,!0),u(i,c,!0,!0),u(i,c,!1,!1),u(f,i,!0,!1),u(o.parse("file://server"),o.parse("file://server/"),!0,!0),u(o.parse("http://server"),o.parse("http://server/"),!0,!0),u(o.parse("foo://server"),o.parse("foo://server/"),!0,!1),u(o.parse("foo://server/foo"),o.parse("foo://server/foo/"),!0,!1),u(o.parse("foo://server/foo"),o.parse("foo://server/foo?"),!0,!0);const n=o.parse("foo://server:453/foo/bar?q=1"),b=o.parse("foo://server:453/foo/bar#xy");u(n,n,!0,!0),u(n,i,!0,!1),u(b,b,!0,!0),u(b,n,!0,!1),u(b,i,!0,!1)}),test("isEqualOrParent",()=>{const f=p?o.file("c:\\foo\\bar"):o.file("/foo/bar"),r=p?o.file("c:\\foo"):o.file("/foo"),i=p?o.file("C:\\Foo\\"):o.file("/Foo/");e.strictEqual(E.isEqualOrParent(f,f),!0,"1"),e.strictEqual(h.isEqualOrParent(f,f),!0,"2"),e.strictEqual(E.isEqualOrParent(f,r),!0,"3"),e.strictEqual(h.isEqualOrParent(f,r),!0,"4"),e.strictEqual(E.isEqualOrParent(f,i),!0,"5"),e.strictEqual(h.isEqualOrParent(f,i),!1,"6"),e.strictEqual(h.isEqualOrParent(r,f),!1,"7"),e.strictEqual(E.isEqualOrParent(i,r),!0,"8");const c=o.parse("foo://server:453/foo/bar/goo"),n=o.parse("foo://server:453/foo/"),b=o.parse("foo://server:453/foo");e.strictEqual(E.isEqualOrParent(c,c,!0),!0,"11"),e.strictEqual(h.isEqualOrParent(c,c),!0,"12"),e.strictEqual(E.isEqualOrParent(c,n,!0),!0,"13"),e.strictEqual(h.isEqualOrParent(c,n),!0,"14"),e.strictEqual(E.isEqualOrParent(c,f,!0),!1,"15"),e.strictEqual(E.isEqualOrParent(b,b,!0),!0,"16");const P=o.parse("foo://server:453/foo?q=1"),O=o.parse("foo://server:453/foo/bar?q=1");e.strictEqual(E.isEqualOrParent(P,b),!1,"17"),e.strictEqual(E.isEqualOrParent(P,P),!0,"18"),e.strictEqual(E.isEqualOrParent(O,P),!0,"19"),e.strictEqual(E.isEqualOrParent(O,b),!1,"20")})});
