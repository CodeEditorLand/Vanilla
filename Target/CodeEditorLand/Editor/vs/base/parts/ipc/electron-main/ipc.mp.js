import"electron";import{Event as o}from"../../../../../vs/base/common/event.js";import"../../../../../vs/base/common/lifecycle.js";import{generateUuid as a}from"../../../../../vs/base/common/uuid.js";import{Client as c}from"../../../../../vs/base/parts/ipc/common/ipc.mp.js";import{validatedIpcMain as m}from"../../../../../vs/base/parts/ipc/electron-main/ipcMain.js";class w extends c{constructor(e,r){super({addEventListener:(t,s)=>e.addListener(t,s),removeEventListener:(t,s)=>e.removeListener(t,s),postMessage:t=>e.postMessage(t),start:()=>e.start(),close:()=>e.close()},r)}}async function P(n){if(n.isDestroyed()||n.webContents.isDestroyed())throw new Error("ipc.mp#connect: Cannot talk to window because it is closed or destroyed");const e=a();n.webContents.send("vscode:createMessageChannel",e);const r=o.fromNodeEventEmitter(m,"vscode:createMessageChannelResult",(s,i)=>({nonce:i,port:s.ports[0]})),{port:t}=await o.toPromise(o.once(o.filter(r,s=>s.nonce===e)));return t}export{w as Client,P as connect};
