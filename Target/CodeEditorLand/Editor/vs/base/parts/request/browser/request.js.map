{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/base/parts/request/browser/request.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { bufferToStream, VSBuffer } from '../../../common/buffer.js';\nimport { CancellationToken } from '../../../common/cancellation.js';\nimport { canceled } from '../../../common/errors.js';\nimport { IHeaders, IRequestContext, IRequestOptions, OfflineError } from '../common/request.js';\n\nexport async function request(options: IRequestOptions, token: CancellationToken): Promise<IRequestContext> {\n\tif (token.isCancellationRequested) {\n\t\tthrow canceled();\n\t}\n\n\tconst cancellation = new AbortController();\n\tconst disposable = token.onCancellationRequested(() => cancellation.abort());\n\tconst signal = options.timeout ? AbortSignal.any([\n\t\tcancellation.signal,\n\t\tAbortSignal.timeout(options.timeout),\n\t]) : cancellation.signal;\n\n\ttry {\n\t\tconst res = await fetch(options.url || '', {\n\t\t\tmethod: options.type || 'GET',\n\t\t\theaders: getRequestHeaders(options),\n\t\t\tbody: options.data,\n\t\t\tsignal,\n\t\t});\n\t\treturn {\n\t\t\tres: {\n\t\t\t\tstatusCode: res.status,\n\t\t\t\theaders: getResponseHeaders(res),\n\t\t\t},\n\t\t\tstream: bufferToStream(VSBuffer.wrap(new Uint8Array(await res.arrayBuffer()))),\n\t\t};\n\t} catch (err) {\n\t\tif (!navigator.onLine) {\n\t\t\tthrow new OfflineError();\n\t\t}\n\t\tif (err?.name === 'AbortError') {\n\t\t\tthrow canceled();\n\t\t}\n\t\tif (err?.name === 'TimeoutError') {\n\t\t\tthrow new Error(`Fetch timeout: ${options.timeout}ms`);\n\t\t}\n\t\tthrow err;\n\t} finally {\n\t\tdisposable.dispose();\n\t}\n}\n\nfunction getRequestHeaders(options: IRequestOptions) {\n\tif (options.headers || options.user || options.password || options.proxyAuthorization) {\n\t\tconst headers: HeadersInit = new Headers();\n\t\touter: for (const k in options.headers) {\n\t\t\tswitch (k.toLowerCase()) {\n\t\t\t\tcase 'user-agent':\n\t\t\t\tcase 'accept-encoding':\n\t\t\t\tcase 'content-length':\n\t\t\t\t\t// unsafe headers\n\t\t\t\t\tcontinue outer;\n\t\t\t}\n\t\t\tconst header = options.headers[k];\n\t\t\tif (typeof header === 'string') {\n\t\t\t\theaders.set(k, header);\n\t\t\t} else if (Array.isArray(header)) {\n\t\t\t\tfor (const h of header) {\n\t\t\t\t\theaders.append(k, h);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (options.user || options.password) {\n\t\t\theaders.set('Authorization', 'Basic ' + btoa(`${options.user || ''}:${options.password || ''}`));\n\t\t}\n\t\tif (options.proxyAuthorization) {\n\t\t\theaders.set('Proxy-Authorization', options.proxyAuthorization);\n\t\t}\n\t\treturn headers;\n\t}\n\treturn undefined;\n}\n\nfunction getResponseHeaders(res: Response): IHeaders {\n\tconst headers: IHeaders = Object.create(null);\n\tres.headers.forEach((value, key) => {\n\t\tif (headers[key]) {\n\t\t\tif (Array.isArray(headers[key])) {\n\t\t\t\theaders[key].push(value);\n\t\t\t} else {\n\t\t\t\theaders[key] = [headers[key], value];\n\t\t\t}\n\t\t} else {\n\t\t\theaders[key] = value;\n\t\t}\n\t});\n\treturn headers;\n}\n"],
  "mappings": ";;AAKA,SAAS,gBAAgB,gBAAgB;AACzC,SAAS,yBAAyB;AAClC,SAAS,gBAAgB;AACzB,SAAS,UAAU,iBAAiB,iBAAiB,oBAAoB;AAEzE,eAAsB,QAAQ,SAA0B,OAAoD;AAC3G,MAAI,MAAM,yBAAyB;AAClC,UAAM,SAAS;AAAA,EAChB;AAEA,QAAM,eAAe,IAAI,gBAAgB;AACzC,QAAM,aAAa,MAAM,wBAAwB,MAAM,aAAa,MAAM,CAAC;AAC3E,QAAM,SAAS,QAAQ,UAAU,YAAY,IAAI;AAAA,IAChD,aAAa;AAAA,IACb,YAAY,QAAQ,QAAQ,OAAO;AAAA,EACpC,CAAC,IAAI,aAAa;AAElB,MAAI;AACH,UAAM,MAAM,MAAM,MAAM,QAAQ,OAAO,IAAI;AAAA,MAC1C,QAAQ,QAAQ,QAAQ;AAAA,MACxB,SAAS,kBAAkB,OAAO;AAAA,MAClC,MAAM,QAAQ;AAAA,MACd;AAAA,IACD,CAAC;AACD,WAAO;AAAA,MACN,KAAK;AAAA,QACJ,YAAY,IAAI;AAAA,QAChB,SAAS,mBAAmB,GAAG;AAAA,MAChC;AAAA,MACA,QAAQ,eAAe,SAAS,KAAK,IAAI,WAAW,MAAM,IAAI,YAAY,CAAC,CAAC,CAAC;AAAA,IAC9E;AAAA,EACD,SAAS,KAAK;AACb,QAAI,CAAC,UAAU,QAAQ;AACtB,YAAM,IAAI,aAAa;AAAA,IACxB;AACA,QAAI,KAAK,SAAS,cAAc;AAC/B,YAAM,SAAS;AAAA,IAChB;AACA,QAAI,KAAK,SAAS,gBAAgB;AACjC,YAAM,IAAI,MAAM,kBAAkB,QAAQ,OAAO,IAAI;AAAA,IACtD;AACA,UAAM;AAAA,EACP,UAAE;AACD,eAAW,QAAQ;AAAA,EACpB;AACD;AAxCsB;AA0CtB,SAAS,kBAAkB,SAA0B;AACpD,MAAI,QAAQ,WAAW,QAAQ,QAAQ,QAAQ,YAAY,QAAQ,oBAAoB;AACtF,UAAM,UAAuB,IAAI,QAAQ;AACzC,UAAO,YAAW,KAAK,QAAQ,SAAS;AACvC,cAAQ,EAAE,YAAY,GAAG;AAAA,QACxB,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAEJ,mBAAS;AAAA,MACX;AACA,YAAM,SAAS,QAAQ,QAAQ,CAAC;AAChC,UAAI,OAAO,WAAW,UAAU;AAC/B,gBAAQ,IAAI,GAAG,MAAM;AAAA,MACtB,WAAW,MAAM,QAAQ,MAAM,GAAG;AACjC,mBAAW,KAAK,QAAQ;AACvB,kBAAQ,OAAO,GAAG,CAAC;AAAA,QACpB;AAAA,MACD;AAAA,IACD;AACA,QAAI,QAAQ,QAAQ,QAAQ,UAAU;AACrC,cAAQ,IAAI,iBAAiB,WAAW,KAAK,GAAG,QAAQ,QAAQ,EAAE,IAAI,QAAQ,YAAY,EAAE,EAAE,CAAC;AAAA,IAChG;AACA,QAAI,QAAQ,oBAAoB;AAC/B,cAAQ,IAAI,uBAAuB,QAAQ,kBAAkB;AAAA,IAC9D;AACA,WAAO;AAAA,EACR;AACA,SAAO;AACR;AA7BS;AA+BT,SAAS,mBAAmB,KAAyB;AACpD,QAAM,UAAoB,uBAAO,OAAO,IAAI;AAC5C,MAAI,QAAQ,QAAQ,CAAC,OAAO,QAAQ;AACnC,QAAI,QAAQ,GAAG,GAAG;AACjB,UAAI,MAAM,QAAQ,QAAQ,GAAG,CAAC,GAAG;AAChC,gBAAQ,GAAG,EAAE,KAAK,KAAK;AAAA,MACxB,OAAO;AACN,gBAAQ,GAAG,IAAI,CAAC,QAAQ,GAAG,GAAG,KAAK;AAAA,MACpC;AAAA,IACD,OAAO;AACN,cAAQ,GAAG,IAAI;AAAA,IAChB;AAAA,EACD,CAAC;AACD,SAAO;AACR;AAdS;",
  "names": []
}
