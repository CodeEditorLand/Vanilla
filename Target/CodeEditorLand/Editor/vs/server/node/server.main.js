import*as c from"os";import*as a from"fs";import"net";import{FileAccess as p}from"../../base/common/network.js";import{run as m}from"./remoteExtensionHostAgentCli.js";import{createServer as l}from"./remoteExtensionHostAgentServer.js";import{parseArgs as O}from"../../platform/environment/node/argv.js";import{join as e,dirname as f}from"../../base/common/path.js";import{performance as E}from"perf_hooks";import{serverOptions as d}from"./serverEnvironmentService.js";import u from"../../platform/product/common/product.js";import*as S from"../../base/common/performance.js";S.mark("code/server/codeLoaded"),global.vscodeServerCodeLoadedTime=E.now();const g={onMultipleValues:(r,i)=>{},onEmptyValue:r=>{},onUnknownOption:r=>{},onDeprecatedOption:(r,i)=>{}},o=O(process.argv.slice(2),d,g),n=o["server-data-dir"]||process.env.VSCODE_AGENT_FOLDER||e(c.homedir(),u.serverDataFolderName||".vscode-remote"),s=e(n,"data"),t=e(s,"User"),A=e(t,"globalStorage"),_=e(t,"History"),v=e(s,"Machine");o["user-data-dir"]=s;const T=f(p.asFileUri("").fsPath),I=e(T,"extensions");o["builtin-extensions-dir"]=I,o["extensions-dir"]=o["extensions-dir"]||e(n,"extensions"),[n,o["extensions-dir"],s,t,v,A,_].forEach(r=>{try{a.existsSync(r)||a.mkdirSync(r,{mode:448})}catch{}});function U(){m(o,n,d)}function V(r){return l(r,o,n)}export{V as createServer,U as spawnCli};
