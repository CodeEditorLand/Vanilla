import*as a from"fs";import"net";import*as p from"os";import{performance as m}from"perf_hooks";import{FileAccess as d}from"../../../vs/base/common/network.js";import{dirname as l,join as e}from"../../../vs/base/common/path.js";import*as f from"vs/base/common/performance";import{parseArgs as E}from"../../../vs/platform/environment/node/argv.js";import O from"../../../vs/platform/product/common/product.js";import{run as S}from"../../../vs/server/node/remoteExtensionHostAgentCli.js";import{createServer as A}from"../../../vs/server/node/remoteExtensionHostAgentServer.js";import{serverOptions as c}from"../../../vs/server/node/serverEnvironmentService.js";f.mark("code/server/codeLoaded"),global.vscodeServerCodeLoadedTime=m.now();const _={onMultipleValues:(r,n)=>{console.error(`Option '${r}' can only be defined once. Using value ${n}.`)},onEmptyValue:r=>{console.error(`Ignoring option '${r}': Value must not be empty.`)},onUnknownOption:r=>{console.error(`Ignoring option '${r}': not supported for server.`)},onDeprecatedOption:(r,n)=>{console.warn(`Option '${r}' is deprecated: ${n}`)}},o=E(process.argv.slice(2),c,_),t=o["server-data-dir"]||process.env.VSCODE_AGENT_FOLDER||e(p.homedir(),O.serverDataFolderName||".vscode-remote"),s=e(t,"data"),i=e(s,"User"),g=e(i,"globalStorage"),u=e(i,"History"),v=e(s,"Machine");o["user-data-dir"]=s;const T=l(d.asFileUri("").fsPath),I=e(T,"extensions");o["builtin-extensions-dir"]=I,o["extensions-dir"]=o["extensions-dir"]||e(t,"extensions"),[t,o["extensions-dir"],s,i,v,g,u].forEach(r=>{try{a.existsSync(r)||a.mkdirSync(r,{mode:448})}catch(n){console.error(n)}});function U(){S(o,t,c)}function $(r){return A(r,o,t)}export{$ as createServer,U as spawnCli};
