import{URI as i}from"../../base/common/uri.js";import{createURITransformer as m}from"../../workbench/api/node/uriTransformer.js";import{DiskFileSystemProvider as a}from"../../platform/files/node/diskFileSystemProvider.js";import{posix as c,delimiter as f}from"../../base/common/path.js";import{AbstractDiskFileSystemProviderChannel as l,AbstractSessionFileWatcher as v}from"../../platform/files/node/diskFileSystemProviderServer.js";class L extends l{constructor(r,e){super(new a(r),r);this.environmentService=e;this._register(this.provider)}uriTransformerCache=new Map;getUriTransformer(r){let e=this.uriTransformerCache.get(r.remoteAuthority);return e||(e=m(r.remoteAuthority),this.uriTransformerCache.set(r.remoteAuthority,e)),e}transformIncoming(r,e,n=!1){if(n&&e.path==="/vscode-resource"&&e.query){const o=JSON.parse(e.query).requestResourcePath;return i.from({scheme:"file",path:o})}return i.revive(r.transformIncoming(e))}createSessionFileWatcher(r,e){return new p(r,e,this.logService,this.environmentService)}}class p extends v{constructor(t,r,e,n){super(t,r,e,n)}getRecursiveWatcherOptions(t){const r=t.args["file-watcher-polling"];if(r){const e=r.split(f),n=Number(e[0]);if(n>0)return{usePolling:e.length>1?e.slice(1):!0,pollingInterval:n}}}getExtraExcludes(t){if(t.extensionsPath)return[c.join(t.extensionsPath,"**")]}}export{L as RemoteAgentFileSystemProviderChannel};
