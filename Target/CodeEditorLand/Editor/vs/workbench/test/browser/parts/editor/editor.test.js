import t from"assert";import{EditorResourceAccessor as i,SideBySideEditor as n,EditorInputCapabilities as l,isEditorIdentifier as I,isResourceEditorInput as q,isUntitledResourceEditorInput as h,isResourceDiffEditorInput as B,isEditorInputWithOptionsAndGroup as T,isEditorInputWithOptions as A,isEditorInput as b,isResourceSideBySideEditorInput as m,isTextEditorViewState as O,isResourceMergeEditorInput as C}from"../../../../common/editor.js";import{DiffEditorInput as M}from"../../../../common/editor/diffEditorInput.js";import{URI as a}from"../../../../../base/common/uri.js";import"../../../../../platform/instantiation/common/instantiation.js";import{workbenchInstantiationService as w,TestServiceAccessor as P,TestEditorInput as H,registerTestEditor as W,registerTestFileEditor as G,registerTestResourceEditor as V,TestFileEditorInput as y,createEditorPart as F,registerTestSideBySideEditor as K}from"../../workbenchTestServices.js";import{Schemas as o}from"../../../../../base/common/network.js";import{UntitledTextEditorInput as L}from"../../../../services/untitled/common/untitledTextEditorInput.js";import{DisposableStore as _}from"../../../../../base/common/lifecycle.js";import{ensureNoDisposablesAreLeakedInTestSuite as j,toResource as p}from"../../../../../base/test/common/utils.js";import{SyncDescriptor as z}from"../../../../../platform/instantiation/common/descriptors.js";import{whenEditorClosed as J}from"../../../../browser/editor.js";import{IEditorGroupsService as Q}from"../../../../services/editor/common/editorGroupsService.js";import{EditorService as X}from"../../../../services/editor/browser/editorService.js";import{IEditorService as Z}from"../../../../services/editor/common/editorService.js";import{SideBySideEditorInput as k}from"../../../../common/editor/sideBySideEditorInput.js";import{EditorResolution as N}from"../../../../../platform/editor/common/editor.js";import"../../../../../editor/common/editorCommon.js";import{Position as $}from"../../../../../editor/common/core/position.js";suite("Workbench editor utils",()=>{class D extends H{constructor(e,S,E){super(e,E);this.preferredResource=S}}const d=new _,v="MyTestEditorForEditors";let f,R;setup(()=>{f=w(void 0,d),R=f.createInstance(P),d.add(R.untitledTextEditorService),d.add(G()),d.add(K()),d.add(V()),d.add(W(v,[new z(y)]))}),teardown(()=>{d.clear()}),test("untyped check functions",()=>{t.ok(!q(void 0)),t.ok(!q({})),t.ok(!q({original:{resource:a.file("/")},modified:{resource:a.file("/")}})),t.ok(q({resource:a.file("/")})),t.ok(!h(void 0)),t.ok(h({})),t.ok(h({resource:a.file("/").with({scheme:o.untitled})})),t.ok(h({resource:a.file("/"),forceUntitled:!0})),t.ok(!B(void 0)),t.ok(!B({})),t.ok(!B({resource:a.file("/")})),t.ok(B({original:{resource:a.file("/")},modified:{resource:a.file("/")}})),t.ok(B({original:{resource:a.file("/")},modified:{resource:a.file("/")},primary:{resource:a.file("/")},secondary:{resource:a.file("/")}})),t.ok(!B({primary:{resource:a.file("/")},secondary:{resource:a.file("/")}})),t.ok(!m(void 0)),t.ok(!m({})),t.ok(!m({resource:a.file("/")})),t.ok(m({primary:{resource:a.file("/")},secondary:{resource:a.file("/")}})),t.ok(!m({original:{resource:a.file("/")},modified:{resource:a.file("/")}})),t.ok(!m({primary:{resource:a.file("/")},secondary:{resource:a.file("/")},original:{resource:a.file("/")},modified:{resource:a.file("/")}})),t.ok(!C(void 0)),t.ok(!C({})),t.ok(!C({resource:a.file("/")})),t.ok(C({input1:{resource:a.file("/")},input2:{resource:a.file("/")},base:{resource:a.file("/")},result:{resource:a.file("/")}}))}),test("EditorInputCapabilities",()=>{const s=d.add(new y(a.file("resource1"),"testTypeId")),r=d.add(new y(a.file("resource2"),"testTypeId"));s.capabilities=l.None,t.strictEqual(s.hasCapability(l.None),!0),t.strictEqual(s.hasCapability(l.Readonly),!1),t.strictEqual(s.isReadonly(),!1),t.strictEqual(s.hasCapability(l.Untitled),!1),t.strictEqual(s.hasCapability(l.RequiresTrust),!1),t.strictEqual(s.hasCapability(l.Singleton),!1),s.capabilities|=l.Readonly,t.strictEqual(s.hasCapability(l.Readonly),!0),t.strictEqual(!!s.isReadonly(),!0),t.strictEqual(s.hasCapability(l.None),!1),t.strictEqual(s.hasCapability(l.Untitled),!1),t.strictEqual(s.hasCapability(l.RequiresTrust),!1),t.strictEqual(s.hasCapability(l.Singleton),!1),s.capabilities=l.None,r.capabilities=l.None;const e=f.createInstance(k,"name",void 0,s,r);t.strictEqual(e.hasCapability(l.MultipleEditors),!0),t.strictEqual(e.hasCapability(l.Readonly),!1),t.strictEqual(e.isReadonly(),!1),t.strictEqual(e.hasCapability(l.Untitled),!1),t.strictEqual(e.hasCapability(l.RequiresTrust),!1),t.strictEqual(e.hasCapability(l.Singleton),!1),s.capabilities|=l.Readonly,t.strictEqual(e.hasCapability(l.Readonly),!1),t.strictEqual(e.isReadonly(),!1),r.capabilities|=l.Readonly,t.strictEqual(e.hasCapability(l.Readonly),!0),t.strictEqual(!!e.isReadonly(),!0),s.capabilities|=l.Untitled,t.strictEqual(e.hasCapability(l.Untitled),!1),r.capabilities|=l.Untitled,t.strictEqual(e.hasCapability(l.Untitled),!0),s.capabilities|=l.RequiresTrust,t.strictEqual(e.hasCapability(l.RequiresTrust),!0),r.capabilities|=l.RequiresTrust,t.strictEqual(e.hasCapability(l.RequiresTrust),!0),s.capabilities|=l.Singleton,t.strictEqual(e.hasCapability(l.Singleton),!0),r.capabilities|=l.Singleton,t.strictEqual(e.hasCapability(l.Singleton),!0)}),test("EditorResourceAccessor - typed inputs",()=>{const s=R.untitledTextEditorService;t.ok(!i.getCanonicalUri(null)),t.ok(!i.getOriginalUri(null));const r=d.add(f.createInstance(L,s.create()));t.strictEqual(i.getCanonicalUri(r)?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.PRIMARY})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.ANY})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.SECONDARY})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.BOTH})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{filterByScheme:o.untitled})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(r,{filterByScheme:[o.file,o.untitled]})?.toString(),r.resource.toString()),t.ok(!i.getCanonicalUri(r,{filterByScheme:o.file})),t.strictEqual(i.getOriginalUri(r)?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.PRIMARY})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.ANY})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.SECONDARY})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.BOTH})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{filterByScheme:o.untitled})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(r,{filterByScheme:[o.file,o.untitled]})?.toString(),r.resource.toString()),t.ok(!i.getOriginalUri(r,{filterByScheme:o.file}));const e=d.add(new H(a.file("/some/path.txt"),"editorResourceFileTest"));t.strictEqual(i.getCanonicalUri(e)?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.ANY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.SECONDARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.BOTH})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.ok(!i.getCanonicalUri(e,{filterByScheme:o.untitled})),t.strictEqual(i.getOriginalUri(e)?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.ANY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.SECONDARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.BOTH})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.ok(!i.getOriginalUri(e,{filterByScheme:o.untitled}));const S=f.createInstance(M,"name","description",r,e,void 0),E=f.createInstance(k,"name","description",r,e);for(const u of[S,E])t.ok(!i.getCanonicalUri(u)),t.ok(!i.getCanonicalUri(u,{filterByScheme:o.file})),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.PRIMARY,filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.PRIMARY,filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.SECONDARY})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.SECONDARY,filterByScheme:o.untitled})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.SECONDARY,filterByScheme:[o.file,o.untitled]})?.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH,filterByScheme:o.file}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH}).secondary.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH,filterByScheme:o.untitled}).secondary.toString(),r.resource.toString()),t.strictEqual(i.getCanonicalUri(u,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).secondary.toString(),r.resource.toString()),t.ok(!i.getOriginalUri(u)),t.ok(!i.getOriginalUri(u,{filterByScheme:o.file})),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.PRIMARY,filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.PRIMARY,filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.SECONDARY})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.SECONDARY,filterByScheme:o.untitled})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.SECONDARY,filterByScheme:[o.file,o.untitled]})?.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH,filterByScheme:o.file}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH}).secondary.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH,filterByScheme:o.untitled}).secondary.toString(),r.resource.toString()),t.strictEqual(i.getOriginalUri(u,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).secondary.toString(),r.resource.toString());const g=a.file("/some/path.txt"),c=a.file("/some/PATH.txt"),Y=d.add(new D(a.file("/some/path.txt"),a.file("/some/PATH.txt"),"editorResourceFileTest"));t.strictEqual(i.getCanonicalUri(Y)?.toString(),g.toString()),t.strictEqual(i.getOriginalUri(Y)?.toString(),c.toString())}),test("EditorResourceAccessor - untyped inputs",()=>{t.ok(!i.getCanonicalUri(null)),t.ok(!i.getOriginalUri(null));const r={resource:a.from({scheme:o.untitled,authority:"foo",path:"/bar"})};t.strictEqual(i.getCanonicalUri(r)?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.PRIMARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.ANY})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.SECONDARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{supportSideBySide:n.BOTH})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{filterByScheme:o.untitled})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(r,{filterByScheme:[o.file,o.untitled]})?.toString(),r.resource?.toString()),t.ok(!i.getCanonicalUri(r,{filterByScheme:o.file})),t.strictEqual(i.getOriginalUri(r)?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.PRIMARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.ANY})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.SECONDARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{supportSideBySide:n.BOTH})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{filterByScheme:o.untitled})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(r,{filterByScheme:[o.file,o.untitled]})?.toString(),r.resource?.toString()),t.ok(!i.getOriginalUri(r,{filterByScheme:o.file}));const e={resource:a.file("/some/path.txt")};t.strictEqual(i.getCanonicalUri(e)?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.ANY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.SECONDARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{supportSideBySide:n.BOTH})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(e,{filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.ok(!i.getCanonicalUri(e,{filterByScheme:o.untitled})),t.strictEqual(i.getOriginalUri(e)?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.ANY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.SECONDARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{supportSideBySide:n.BOTH})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(e,{filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.ok(!i.getOriginalUri(e,{filterByScheme:o.untitled}));const S={original:r,modified:e},E={primary:e,secondary:r};for(const c of[S,E])t.ok(!i.getCanonicalUri(c)),t.ok(!i.getCanonicalUri(c,{filterByScheme:o.file})),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.PRIMARY,filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.PRIMARY,filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.SECONDARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.SECONDARY,filterByScheme:o.untitled})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.SECONDARY,filterByScheme:[o.file,o.untitled]})?.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH,filterByScheme:o.file}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).primary.toString(),e.resource.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH}).secondary.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH,filterByScheme:o.untitled}).secondary.toString(),r.resource?.toString()),t.strictEqual(i.getCanonicalUri(c,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).secondary.toString(),r.resource?.toString()),t.ok(!i.getOriginalUri(c)),t.ok(!i.getOriginalUri(c,{filterByScheme:o.file})),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.PRIMARY})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.PRIMARY,filterByScheme:o.file})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.PRIMARY,filterByScheme:[o.file,o.untitled]})?.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.SECONDARY})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.SECONDARY,filterByScheme:o.untitled})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.SECONDARY,filterByScheme:[o.file,o.untitled]})?.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH,filterByScheme:o.file}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).primary.toString(),e.resource.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH}).secondary.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH,filterByScheme:o.untitled}).secondary.toString(),r.resource?.toString()),t.strictEqual(i.getOriginalUri(c,{supportSideBySide:n.BOTH,filterByScheme:[o.file,o.untitled]}).secondary.toString(),r.resource?.toString());const g={input1:{resource:a.file("/some/remote.txt")},input2:{resource:a.file("/some/local.txt")},base:{resource:a.file("/some/base.txt")},result:{resource:a.file("/some/merged.txt")}};t.strictEqual(i.getCanonicalUri(g)?.toString(),g.result.resource.toString()),t.strictEqual(i.getOriginalUri(g)?.toString(),g.result.resource.toString())}),test("isEditorIdentifier",()=>{t.strictEqual(I(void 0),!1),t.strictEqual(I("undefined"),!1);const s=d.add(new y(a.file("resource1"),"testTypeId"));t.strictEqual(I(s),!1),t.strictEqual(I({editor:s,groupId:3}),!0)}),test("isEditorInputWithOptionsAndGroup",()=>{const s=d.add(new y(a.file("resource1"),"testTypeId"));t.strictEqual(b(s),!0),t.strictEqual(A(s),!1),t.strictEqual(T(s),!1);const r={editor:s,options:{override:N.PICK}};t.strictEqual(b(r),!1),t.strictEqual(A(r),!0),t.strictEqual(T(r),!1);const e=R.editorGroupService,S={editor:s,options:{override:N.PICK},group:e.activeGroup};t.strictEqual(b(S),!1),t.strictEqual(A(S),!0),t.strictEqual(T(S),!0)}),test("isTextEditorViewState",()=>{t.strictEqual(O(void 0),!1),t.strictEqual(O({}),!1);const s={contributionsState:{},cursorState:[],viewState:{scrollLeft:0,firstPosition:new $(1,1),firstPositionDeltaTop:1}};t.strictEqual(O(s),!0);const r={original:s,modified:s};t.strictEqual(O(r),!0)}),test("whenEditorClosed (single editor)",async function(){return U(!1,!1,p.call(this,"/path/index.txt"))}),test("whenEditorClosed (multiple editor)",async function(){return U(!1,!1,p.call(this,"/path/index.txt"),p.call(this,"/test.html"))}),test("whenEditorClosed (single editor, diff editor)",async function(){return U(!0,!1,p.call(this,"/path/index.txt"))}),test("whenEditorClosed (multiple editor, diff editor)",async function(){return U(!0,!1,p.call(this,"/path/index.txt"),p.call(this,"/test.html"))}),test("whenEditorClosed (single custom editor)",async function(){return U(!1,!0,p.call(this,"/path/index.txt"))}),test("whenEditorClosed (multiple custom editor)",async function(){return U(!1,!0,p.call(this,"/path/index.txt"),p.call(this,"/test.html"))});async function x(){const s=w(void 0,d),r=await F(s,d);s.stub(Q,r);const e=d.add(s.createInstance(X,void 0));return s.stub(Z,e),s.createInstance(P)}async function U(s,r,...e){const S=await x();for(const g of e)r?await S.editorService.openEditor(new y(g,"testTypeId"),{pinned:!0}):s?await S.editorService.openEditor(f.createInstance(k,"testSideBySideEditor",void 0,new y(g,"testTypeId"),new y(g,"testTypeId")),{pinned:!0}):await S.editorService.openEditor({resource:g,options:{pinned:!0}});const E=S.instantitionService.invokeFunction(g=>J(g,e));S.editorGroupService.activeGroup.closeAllEditors(),await E}j()});
