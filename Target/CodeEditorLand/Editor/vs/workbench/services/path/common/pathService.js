var d=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var f=(a,e,r,t)=>{for(var o=t>1?void 0:t?u(e,r):e,n=a.length-1,m;n>=0;n--)(m=a[n])&&(o=(t?m(e,r,o):m(o))||o);return t&&o&&d(e,r,o),o},c=(a,e)=>(r,t)=>e(r,t,a);import{isValidBasename as v}from"../../../../base/common/extpath.js";import{Schemas as s}from"../../../../base/common/network.js";import{posix as p,win32 as U}from"../../../../base/common/path.js";import{OS as g,OperatingSystem as l}from"../../../../base/common/platform.js";import{basename as I}from"../../../../base/common/resources.js";import{URI as h}from"../../../../base/common/uri.js";import{createDecorator as S}from"../../../../platform/instantiation/common/instantiation.js";import{getVirtualWorkspaceScheme as R}from"../../../../platform/workspace/common/virtualWorkspace.js";import{IWorkspaceContextService as y}from"../../../../platform/workspace/common/workspace.js";import{IWorkbenchEnvironmentService as b}from"../../environment/common/environmentService.js";import{IRemoteAgentService as H}from"../../remote/common/remoteAgentService.js";const A=S("pathService");let i=class{constructor(e,r,t,o){this.localUserHome=e;this.remoteAgentService=r;this.environmentService=t;this.contextService=o;this.resolveOS=(async()=>(await this.remoteAgentService.getEnvironment())?.os||g)(),this.resolveUserHome=(async()=>{const n=await this.remoteAgentService.getEnvironment();return this.maybeUnresolvedUserHome=n?.userHome??e})()}resolveOS;resolveUserHome;maybeUnresolvedUserHome;hasValidBasename(e,r,t){return typeof r=="string"||typeof r>"u"?this.resolveOS.then(o=>this.doHasValidBasename(e,o,r)):this.doHasValidBasename(e,r,t)}doHasValidBasename(e,r,t){return e.scheme===s.file||e.scheme===s.vscodeRemote?v(t??I(e),r===l.Windows):!0}get defaultUriScheme(){return i.findDefaultUriScheme(this.environmentService,this.contextService)}static findDefaultUriScheme(e,r){if(e.remoteAuthority)return s.vscodeRemote;const t=R(r.getWorkspace());if(t)return t;const o=r.getWorkspace().folders[0];if(o)return o.uri.scheme;const n=r.getWorkspace().configuration;return n?n.scheme:s.file}userHome(e){return e?.preferLocal?this.localUserHome:this.resolveUserHome}get resolvedUserHome(){return this.maybeUnresolvedUserHome}get path(){return this.resolveOS.then(e=>e===l.Windows?U:p)}async fileURI(e){let r="";if(await this.resolveOS===l.Windows&&(e=e.replace(/\\/g,"/")),e[0]==="/"&&e[1]==="/"){const o=e.indexOf("/",2);o===-1?(r=e.substring(2),e="/"):(r=e.substring(2,o),e=e.substring(o)||"/")}return h.from({scheme:s.file,authority:r,path:e,query:"",fragment:""})}};i=f([c(1,H),c(2,b),c(3,y)],i);export{i as AbstractPathService,A as IPathService};
