{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/path/common/pathService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { isValidBasename } from '../../../../base/common/extpath.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { IPath, win32, posix } from '../../../../base/common/path.js';\nimport { OperatingSystem, OS } from '../../../../base/common/platform.js';\nimport { basename } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\nimport { getVirtualWorkspaceScheme } from '../../../../platform/workspace/common/virtualWorkspace.js';\nimport { IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IRemoteAgentService } from '../../remote/common/remoteAgentService.js';\n\nexport const IPathService = createDecorator<IPathService>('pathService');\n\n/**\n * Provides access to path related properties that will match the\n * environment. If the environment is connected to a remote, the\n * path properties will match that of the remotes operating system.\n */\nexport interface IPathService {\n\n\treadonly _serviceBrand: undefined;\n\n\t/**\n\t * The correct path library to use for the target environment. If\n\t * the environment is connected to a remote, this will be the\n\t * path library of the remote file system. Otherwise it will be\n\t * the local file system's path library depending on the OS.\n\t */\n\treadonly path: Promise<IPath>;\n\n\t/**\n\t * Determines the best default URI scheme for the current workspace.\n\t * It uses information about whether we're running remote, in browser,\n\t * or native combined with information about the current workspace to\n\t * find the best default scheme.\n\t */\n\treadonly defaultUriScheme: string;\n\n\t/**\n\t * Converts the given path to a file URI to use for the target\n\t * environment. If the environment is connected to a remote, it\n\t * will use the path separators according to the remote file\n\t * system. Otherwise it will use the local file system's path\n\t * separators.\n\t */\n\tfileURI(path: string): Promise<URI>;\n\n\t/**\n\t * Resolves the user-home directory for the target environment.\n\t * If the envrionment is connected to a remote, this will be the\n\t * remote's user home directory, otherwise the local one unless\n\t * `preferLocal` is set to `true`.\n\t */\n\tuserHome(options: { preferLocal: true }): URI;\n\tuserHome(options?: { preferLocal: boolean }): Promise<URI>;\n\n\t/**\n\t * Figures out if the provided resource has a valid file name\n\t * for the operating system the file is saved to.\n\t *\n\t * Note: this currently only supports `file` and `vscode-file`\n\t * protocols where we know the limits of the file systems behind\n\t * these OS. Other remotes are not supported and this method\n\t * will always return `true` for them.\n\t */\n\thasValidBasename(resource: URI, basename?: string): Promise<boolean>;\n\thasValidBasename(resource: URI, os: OperatingSystem, basename?: string): boolean;\n\n\t/**\n\t * @deprecated use `userHome` instead.\n\t */\n\treadonly resolvedUserHome: URI | undefined;\n}\n\nexport abstract class AbstractPathService implements IPathService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate resolveOS: Promise<OperatingSystem>;\n\n\tprivate resolveUserHome: Promise<URI>;\n\tprivate maybeUnresolvedUserHome: URI | undefined;\n\n\tconstructor(\n\t\tprivate localUserHome: URI,\n\t\t@IRemoteAgentService private readonly remoteAgentService: IRemoteAgentService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IWorkspaceContextService private contextService: IWorkspaceContextService\n\t) {\n\n\t\t// OS\n\t\tthis.resolveOS = (async () => {\n\t\t\tconst env = await this.remoteAgentService.getEnvironment();\n\n\t\t\treturn env?.os || OS;\n\t\t})();\n\n\t\t// User Home\n\t\tthis.resolveUserHome = (async () => {\n\t\t\tconst env = await this.remoteAgentService.getEnvironment();\n\t\t\tconst userHome = this.maybeUnresolvedUserHome = env?.userHome ?? localUserHome;\n\n\t\t\treturn userHome;\n\t\t})();\n\t}\n\n\thasValidBasename(resource: URI, basename?: string): Promise<boolean>;\n\thasValidBasename(resource: URI, os: OperatingSystem, basename?: string): boolean;\n\thasValidBasename(resource: URI, arg2?: string | OperatingSystem, basename?: string): boolean | Promise<boolean> {\n\n\t\t// async version\n\t\tif (typeof arg2 === 'string' || typeof arg2 === 'undefined') {\n\t\t\treturn this.resolveOS.then(os => this.doHasValidBasename(resource, os, arg2));\n\t\t}\n\n\t\t// sync version\n\t\treturn this.doHasValidBasename(resource, arg2, basename);\n\t}\n\n\tprivate doHasValidBasename(resource: URI, os: OperatingSystem, name?: string): boolean {\n\n\t\t// Our `isValidBasename` method only works with our\n\t\t// standard schemes for files on disk, either locally\n\t\t// or remote.\n\t\tif (resource.scheme === Schemas.file || resource.scheme === Schemas.vscodeRemote) {\n\t\t\treturn isValidBasename(name ?? basename(resource), os === OperatingSystem.Windows);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tget defaultUriScheme(): string {\n\t\treturn AbstractPathService.findDefaultUriScheme(this.environmentService, this.contextService);\n\t}\n\n\tstatic findDefaultUriScheme(environmentService: IWorkbenchEnvironmentService, contextService: IWorkspaceContextService): string {\n\t\tif (environmentService.remoteAuthority) {\n\t\t\treturn Schemas.vscodeRemote;\n\t\t}\n\n\t\tconst virtualWorkspace = getVirtualWorkspaceScheme(contextService.getWorkspace());\n\t\tif (virtualWorkspace) {\n\t\t\treturn virtualWorkspace;\n\t\t}\n\n\t\tconst firstFolder = contextService.getWorkspace().folders[0];\n\t\tif (firstFolder) {\n\t\t\treturn firstFolder.uri.scheme;\n\t\t}\n\n\t\tconst configuration = contextService.getWorkspace().configuration;\n\t\tif (configuration) {\n\t\t\treturn configuration.scheme;\n\t\t}\n\n\t\treturn Schemas.file;\n\t}\n\n\tuserHome(options?: { preferLocal: boolean }): Promise<URI>;\n\tuserHome(options: { preferLocal: true }): URI;\n\tuserHome(options?: { preferLocal: boolean }): Promise<URI> | URI {\n\t\treturn options?.preferLocal ? this.localUserHome : this.resolveUserHome;\n\t}\n\n\tget resolvedUserHome(): URI | undefined {\n\t\treturn this.maybeUnresolvedUserHome;\n\t}\n\n\tget path(): Promise<IPath> {\n\t\treturn this.resolveOS.then(os => {\n\t\t\treturn os === OperatingSystem.Windows ?\n\t\t\t\twin32 :\n\t\t\t\tposix;\n\t\t});\n\t}\n\n\tasync fileURI(_path: string): Promise<URI> {\n\t\tlet authority = '';\n\n\t\t// normalize to fwd-slashes on windows,\n\t\t// on other systems bwd-slashes are valid\n\t\t// filename character, eg /f\\oo/ba\\r.txt\n\t\tconst os = await this.resolveOS;\n\t\tif (os === OperatingSystem.Windows) {\n\t\t\t_path = _path.replace(/\\\\/g, '/');\n\t\t}\n\n\t\t// check for authority as used in UNC shares\n\t\t// or use the path as given\n\t\tif (_path[0] === '/' && _path[1] === '/') {\n\t\t\tconst idx = _path.indexOf('/', 2);\n\t\t\tif (idx === -1) {\n\t\t\t\tauthority = _path.substring(2);\n\t\t\t\t_path = '/';\n\t\t\t} else {\n\t\t\t\tauthority = _path.substring(2, idx);\n\t\t\t\t_path = _path.substring(idx) || '/';\n\t\t\t}\n\t\t}\n\n\t\treturn URI.from({\n\t\t\tscheme: Schemas.file,\n\t\t\tauthority,\n\t\t\tpath: _path,\n\t\t\tquery: '',\n\t\t\tfragment: ''\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": ["basename"]
}
