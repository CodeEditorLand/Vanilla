{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/workspaces/common/editSessionIdentityService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { insert } from \"../../../../base/common/arrays.js\";\nimport type { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport {\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport {\n\ttype EditSessionIdentityMatch,\n\ttype IEditSessionIdentityCreateParticipant,\n\ttype IEditSessionIdentityProvider,\n\tIEditSessionIdentityService,\n} from \"../../../../platform/workspace/common/editSessions.js\";\nimport type { IWorkspaceFolder } from \"../../../../platform/workspace/common/workspace.js\";\nimport { IExtensionService } from \"../../extensions/common/extensions.js\";\n\nexport class EditSessionIdentityService implements IEditSessionIdentityService {\n\treadonly _serviceBrand: undefined;\n\n\tprivate _editSessionIdentifierProviders = new Map<\n\t\tstring,\n\t\tIEditSessionIdentityProvider\n\t>();\n\n\tconstructor(\n\t\t@IExtensionService\n\t\tprivate readonly _extensionService: IExtensionService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {}\n\n\tregisterEditSessionIdentityProvider(\n\t\tprovider: IEditSessionIdentityProvider,\n\t): IDisposable {\n\t\tif (this._editSessionIdentifierProviders.get(provider.scheme)) {\n\t\t\tthrow new Error(\n\t\t\t\t`A provider has already been registered for scheme ${provider.scheme}`,\n\t\t\t);\n\t\t}\n\n\t\tthis._editSessionIdentifierProviders.set(provider.scheme, provider);\n\t\treturn toDisposable(() => {\n\t\t\tthis._editSessionIdentifierProviders.delete(provider.scheme);\n\t\t});\n\t}\n\n\tasync getEditSessionIdentifier(\n\t\tworkspaceFolder: IWorkspaceFolder,\n\t\ttoken: CancellationToken,\n\t): Promise<string | undefined> {\n\t\tconst { scheme } = workspaceFolder.uri;\n\n\t\tconst provider = await this.activateProvider(scheme);\n\t\tthis._logService.trace(\n\t\t\t`EditSessionIdentityProvider for scheme ${scheme} available: ${!!provider}`,\n\t\t);\n\n\t\treturn provider?.getEditSessionIdentifier(workspaceFolder, token);\n\t}\n\n\tasync provideEditSessionIdentityMatch(\n\t\tworkspaceFolder: IWorkspaceFolder,\n\t\tidentity1: string,\n\t\tidentity2: string,\n\t\tcancellationToken: CancellationToken,\n\t): Promise<EditSessionIdentityMatch | undefined> {\n\t\tconst { scheme } = workspaceFolder.uri;\n\n\t\tconst provider = await this.activateProvider(scheme);\n\t\tthis._logService.trace(\n\t\t\t`EditSessionIdentityProvider for scheme ${scheme} available: ${!!provider}`,\n\t\t);\n\n\t\treturn provider?.provideEditSessionIdentityMatch?.(\n\t\t\tworkspaceFolder,\n\t\t\tidentity1,\n\t\t\tidentity2,\n\t\t\tcancellationToken,\n\t\t);\n\t}\n\n\tasync onWillCreateEditSessionIdentity(\n\t\tworkspaceFolder: IWorkspaceFolder,\n\t\tcancellationToken: CancellationToken,\n\t): Promise<void> {\n\t\tthis._logService.debug(\n\t\t\t\"Running onWillCreateEditSessionIdentity participants...\",\n\t\t);\n\n\t\t// TODO@joyceerhl show progress notification?\n\t\tfor (const participant of this._participants) {\n\t\t\tawait participant.participate(workspaceFolder, cancellationToken);\n\t\t}\n\n\t\tthis._logService.debug(\n\t\t\t`Done running ${this._participants.length} onWillCreateEditSessionIdentity participants.`,\n\t\t);\n\t}\n\n\tprivate _participants: IEditSessionIdentityCreateParticipant[] = [];\n\n\taddEditSessionIdentityCreateParticipant(\n\t\tparticipant: IEditSessionIdentityCreateParticipant,\n\t): IDisposable {\n\t\tconst dispose = insert(this._participants, participant);\n\n\t\treturn toDisposable(() => dispose());\n\t}\n\n\tprivate async activateProvider(scheme: string) {\n\t\tconst transformedScheme = scheme === \"vscode-remote\" ? \"file\" : scheme;\n\n\t\tconst provider = this._editSessionIdentifierProviders.get(scheme);\n\t\tif (provider) {\n\t\t\treturn provider;\n\t\t}\n\n\t\tawait this._extensionService.activateByEvent(\n\t\t\t`onEditSession:${transformedScheme}`,\n\t\t);\n\t\treturn this._editSessionIdentifierProviders.get(scheme);\n\t}\n}\n\nregisterSingleton(\n\tIEditSessionIdentityService,\n\tEditSessionIdentityService,\n\tInstantiationType.Delayed,\n);\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,cAAc;AAEvB;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,mBAAmB;AAC5B;AAAA,EAIC;AAAA,OACM;AAEP,SAAS,yBAAyB;AAE3B,IAAM,6BAAN,MAAwE;AAAA,EAQ9E,YAEkB,mBACa,aAC7B;AAFgB;AACa;AAAA,EAC5B;AAAA,EArCJ,OAyB+E;AAAA;AAAA;AAAA,EACrE;AAAA,EAED,kCAAkC,oBAAI,IAG5C;AAAA,EAQF,oCACC,UACc;AACd,QAAI,KAAK,gCAAgC,IAAI,SAAS,MAAM,GAAG;AAC9D,YAAM,IAAI;AAAA,QACT,qDAAqD,SAAS,MAAM;AAAA,MACrE;AAAA,IACD;AAEA,SAAK,gCAAgC,IAAI,SAAS,QAAQ,QAAQ;AAClE,WAAO,aAAa,MAAM;AACzB,WAAK,gCAAgC,OAAO,SAAS,MAAM;AAAA,IAC5D,CAAC;AAAA,EACF;AAAA,EAEA,MAAM,yBACL,iBACA,OAC8B;AAC9B,UAAM,EAAE,OAAO,IAAI,gBAAgB;AAEnC,UAAM,WAAW,MAAM,KAAK,iBAAiB,MAAM;AACnD,SAAK,YAAY;AAAA,MAChB,0CAA0C,MAAM,eAAe,CAAC,CAAC,QAAQ;AAAA,IAC1E;AAEA,WAAO,UAAU,yBAAyB,iBAAiB,KAAK;AAAA,EACjE;AAAA,EAEA,MAAM,gCACL,iBACA,WACA,WACA,mBACgD;AAChD,UAAM,EAAE,OAAO,IAAI,gBAAgB;AAEnC,UAAM,WAAW,MAAM,KAAK,iBAAiB,MAAM;AACnD,SAAK,YAAY;AAAA,MAChB,0CAA0C,MAAM,eAAe,CAAC,CAAC,QAAQ;AAAA,IAC1E;AAEA,WAAO,UAAU;AAAA,MAChB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,gCACL,iBACA,mBACgB;AAChB,SAAK,YAAY;AAAA,MAChB;AAAA,IACD;AAGA,eAAW,eAAe,KAAK,eAAe;AAC7C,YAAM,YAAY,YAAY,iBAAiB,iBAAiB;AAAA,IACjE;AAEA,SAAK,YAAY;AAAA,MAChB,gBAAgB,KAAK,cAAc,MAAM;AAAA,IAC1C;AAAA,EACD;AAAA,EAEQ,gBAAyD,CAAC;AAAA,EAElE,wCACC,aACc;AACd,UAAM,UAAU,OAAO,KAAK,eAAe,WAAW;AAEtD,WAAO,aAAa,MAAM,QAAQ,CAAC;AAAA,EACpC;AAAA,EAEA,MAAc,iBAAiB,QAAgB;AAC9C,UAAM,oBAAoB,WAAW,kBAAkB,SAAS;AAEhE,UAAM,WAAW,KAAK,gCAAgC,IAAI,MAAM;AAChE,QAAI,UAAU;AACb,aAAO;AAAA,IACR;AAEA,UAAM,KAAK,kBAAkB;AAAA,MAC5B,iBAAiB,iBAAiB;AAAA,IACnC;AACA,WAAO,KAAK,gCAAgC,IAAI,MAAM;AAAA,EACvD;AACD;AAzGa,6BAAN;AAAA,EASJ;AAAA,EAEA;AAAA,GAXU;AA2Gb;AAAA,EACC;AAAA,EACA;AAAA,EACA,kBAAkB;AACnB;",
  "names": []
}
