var c=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var p=(n,s,i,o)=>{for(var e=o>1?void 0:o?v(s,i):s,t=n.length-1,r;t>=0;t--)(r=n[t])&&(e=(o?r(s,i,e):r(e))||e);return o&&e&&c(s,i,e),e},d=(n,s)=>(i,o)=>s(i,o,n);import{timeout as f}from"../../../../base/common/async.js";import{CancellationToken as D}from"../../../../base/common/cancellation.js";import{Emitter as l}from"../../../../base/common/event.js";import{Disposable as y}from"../../../../base/common/lifecycle.js";import{FileChangeType as h,IFileService as g}from"../../../../platform/files/common/files.js";let a=class extends y{constructor(i,o){super();this.resource=i;this.fileService=o;this._register(this.fileService.onDidFilesChange(e=>this.onDidFilesChange(e)))}_onDidChangeOrphaned=this._register(new l);onDidChangeOrphaned=this._onDidChangeOrphaned.event;orphaned=!1;isOrphaned(){return this.orphaned}async onDidFilesChange(i){let o=!1,e;if(this.orphaned?i.contains(this.resource,h.ADDED)&&(e=!1,o=!0):i.contains(this.resource,h.DELETED)&&(e=!0,o=!0),o&&this.orphaned!==e){let t=!1;e&&(await f(100,D.None),this.isDisposed()?t=!0:t=!await this.fileService.exists(this.resource)),this.orphaned!==t&&!this.isDisposed()&&this.setOrphaned(t)}}setOrphaned(i){this.orphaned!==i&&(this.orphaned=i,this._onDidChangeOrphaned.fire())}_onWillDispose=this._register(new l);onWillDispose=this._onWillDispose.event;isDisposed(){return this._store.isDisposed}dispose(){this.orphaned=!1,this._onWillDispose.fire(),super.dispose()}isModified(){return this.isDirty()}};a=p([d(1,g)],a);export{a as ResourceWorkingCopy};
