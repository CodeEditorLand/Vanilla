var q=(a=>(a[a.BOM=65279]="BOM",a[a.SPACE=32]="SPACE",a[a.TAB=9]="TAB",a[a.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",a[a.LINE_FEED=10]="LINE_FEED",a[a.SLASH=47]="SLASH",a[a.LESS_THAN=60]="LESS_THAN",a[a.QUESTION_MARK=63]="QUESTION_MARK",a[a.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",a))(q||{}),G=(f=>(f[f.ROOT_STATE=0]="ROOT_STATE",f[f.DICT_STATE=1]="DICT_STATE",f[f.ARR_STATE=2]="ARR_STATE",f))(G||{});function V(l){return Q(l,null,null)}function Q(l,_,o){const f=l.length;let s=0,E=1,p=0;f>0&&l.charCodeAt(0)===65279&&(s=1);function A(e){if(o===null)s=s+e;else for(;e>0;)l.charCodeAt(s)===10?(s++,E++,p=0):(s++,p++),e--}function d(e){o===null?s=e:A(e-s)}function a(){for(;s<f;){const e=l.charCodeAt(s);if(e!==32&&e!==9&&e!==13&&e!==10)break;A(1)}}function R(e){return l.substr(s,e.length)===e?(A(e.length),!0):!1}function S(e){const r=l.indexOf(e,s);d(r!==-1?r+e.length:f)}function I(e){const r=l.indexOf(e,s);if(r!==-1){const c=l.substring(s,r);return d(r+e.length),c}else{const c=l.substr(s);return d(f),c}}let i=0,t=null;const h=[],D=[];let n=null;function g(e,r){h.push(i),D.push(t),i=e,t=r}function y(){if(h.length===0)return u("illegal state stack");i=h.pop(),t=D.pop()}function u(e){throw new Error("Near offset "+s+": "+e+" ~~~"+l.substr(s,50)+"~~~")}const C={enterDict:function(){if(n===null)return u("missing <key>");const e={};o!==null&&(e[o]={filename:_,line:E,char:p}),t[n]=e,n=null,g(1,e)},enterArray:function(){if(n===null)return u("missing <key>");const e=[];t[n]=e,n=null,g(2,e)}},k={enterDict:function(){const e={};o!==null&&(e[o]={filename:_,line:E,char:p}),t.push(e),g(1,e)},enterArray:function(){const e=[];t.push(e),g(2,e)}};function b(){i===1?C.enterDict():i===2?k.enterDict():(t={},o!==null&&(t[o]={filename:_,line:E,char:p}),g(1,t))}function m(){if(i===1)y();else return u("unexpected </dict>")}function w(){i===1?C.enterArray():i===2?k.enterArray():(t=[],g(2,t))}function x(){if(i===1)return u("unexpected </array>");if(i===2)y();else return u("unexpected </array>")}function L(e){if(i===1){if(n!==null)return u("too many <key>");n=e}else return u("unexpected <key>")}function N(e){if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function P(e){if(isNaN(e))return u("cannot parse float");if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function M(e){if(isNaN(e))return u("cannot parse integer");if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function B(e){if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function U(e){if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function O(e){if(i===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else i===2?t.push(e):t=e}function H(e){return e.replace(/&#([0-9]+);/g,function(r,c){return String.fromCodePoint(parseInt(c,10))}).replace(/&#x([0-9a-f]+);/g,function(r,c){return String.fromCodePoint(parseInt(c,16))}).replace(/&amp;|&lt;|&gt;|&quot;|&apos;/g,function(r){switch(r){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&quot;":return'"';case"&apos;":return"'"}return r})}function F(){let e=I(">"),r=!1;return e.charCodeAt(e.length-1)===47&&(r=!0,e=e.substring(0,e.length-1)),{name:e.trim(),isClosed:r}}function T(e){if(e.isClosed)return"";const r=I("</");return S(">"),H(r)}for(;s<f&&(a(),!(s>=f));){const e=l.charCodeAt(s);if(A(1),e!==60)return u("expected <");if(s>=f)return u("unexpected end of input");const r=l.charCodeAt(s);if(r===63){A(1),S("?>");continue}if(r===33){if(A(1),R("--")){S("-->");continue}S(">");continue}if(r===47){if(A(1),a(),R("plist")){S(">");continue}if(R("dict")){S(">"),m();continue}if(R("array")){S(">"),x();continue}return u("unexpected closed tag")}const c=F();switch(c.name){case"dict":b(),c.isClosed&&m();continue;case"array":w(),c.isClosed&&x();continue;case"key":L(T(c));continue;case"string":N(T(c));continue;case"real":P(parseFloat(T(c)));continue;case"integer":M(parseInt(T(c),10));continue;case"date":B(new Date(T(c)));continue;case"data":U(T(c));continue;case"true":T(c),O(!0);continue;case"false":T(c),O(!1);continue}if(!/^plist/.test(c.name))return u("unexpected opened tag "+c.name)}return t}export{V as parse};
