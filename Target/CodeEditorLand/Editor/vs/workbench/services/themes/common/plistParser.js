var q=(a=>(a[a.BOM=65279]="BOM",a[a.SPACE=32]="SPACE",a[a.TAB=9]="TAB",a[a.CARRIAGE_RETURN=13]="CARRIAGE_RETURN",a[a.LINE_FEED=10]="LINE_FEED",a[a.SLASH=47]="SLASH",a[a.LESS_THAN=60]="LESS_THAN",a[a.QUESTION_MARK=63]="QUESTION_MARK",a[a.EXCLAMATION_MARK=33]="EXCLAMATION_MARK",a))(q||{}),G=(f=>(f[f.ROOT_STATE=0]="ROOT_STATE",f[f.DICT_STATE=1]="DICT_STATE",f[f.ARR_STATE=2]="ARR_STATE",f))(G||{});function V(l){return Q(l,null,null)}function Q(l,_,T){const f=l.length;let s=0,E=1,p=0;f>0&&l.charCodeAt(0)===65279&&(s=1);function A(e){if(T===null)s=s+e;else for(;e>0;)l.charCodeAt(s)===10?(s++,E++,p=0):(s++,p++),e--}function d(e){T===null?s=e:A(e-s)}function a(){for(;s<f;){const e=l.charCodeAt(s);if(e!==32&&e!==9&&e!==13&&e!==10)break;A(1)}}function R(e){return l.substr(s,e.length)===e?(A(e.length),!0):!1}function S(e){const i=l.indexOf(e,s);d(i!==-1?i+e.length:f)}function I(e){const i=l.indexOf(e,s);if(i!==-1){const c=l.substring(s,i);return d(i+e.length),c}else{const c=l.substr(s);return d(f),c}}let r=0,t=null;const h=[],D=[];let n=null;function g(e,i){h.push(r),D.push(t),r=e,t=i}function y(){if(h.length===0)return u("illegal state stack");r=h.pop(),t=D.pop()}function u(e){throw new Error("Near offset "+s+": "+e+" ~~~"+l.substr(s,50)+"~~~")}const C={enterDict:()=>{if(n===null)return u("missing <key>");const e={};T!==null&&(e[T]={filename:_,line:E,char:p}),t[n]=e,n=null,g(1,e)},enterArray:()=>{if(n===null)return u("missing <key>");const e=[];t[n]=e,n=null,g(2,e)}},m={enterDict:()=>{const e={};T!==null&&(e[T]={filename:_,line:E,char:p}),t.push(e),g(1,e)},enterArray:()=>{const e=[];t.push(e),g(2,e)}};function O(){r===1?C.enterDict():r===2?m.enterDict():(t={},T!==null&&(t[T]={filename:_,line:E,char:p}),g(1,t))}function k(){if(r===1)y();else return u("unexpected </dict>")}function N(){r===1?C.enterArray():r===2?m.enterArray():(t=[],g(2,t))}function b(){if(r===1)return u("unexpected </array>");if(r===2)y();else return u("unexpected </array>")}function w(e){if(r===1){if(n!==null)return u("too many <key>");n=e}else return u("unexpected <key>")}function L(e){if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function P(e){if(isNaN(e))return u("cannot parse float");if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function M(e){if(isNaN(e))return u("cannot parse integer");if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function B(e){if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function U(e){if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function x(e){if(r===1){if(n===null)return u("missing <key>");t[n]=e,n=null}else r===2?t.push(e):t=e}function H(e){return e.replace(/&#([0-9]+);/g,(i,c)=>String.fromCodePoint(Number.parseInt(c,10))).replace(/&#x([0-9a-f]+);/g,(i,c)=>String.fromCodePoint(Number.parseInt(c,16))).replace(/&amp;|&lt;|&gt;|&quot;|&apos;/g,i=>{switch(i){case"&amp;":return"&";case"&lt;":return"<";case"&gt;":return">";case"&quot;":return'"';case"&apos;":return"'"}return i})}function F(){let e=I(">"),i=!1;return e.charCodeAt(e.length-1)===47&&(i=!0,e=e.substring(0,e.length-1)),{name:e.trim(),isClosed:i}}function o(e){if(e.isClosed)return"";const i=I("</");return S(">"),H(i)}for(;s<f&&(a(),!(s>=f));){const e=l.charCodeAt(s);if(A(1),e!==60)return u("expected <");if(s>=f)return u("unexpected end of input");const i=l.charCodeAt(s);if(i===63){A(1),S("?>");continue}if(i===33){if(A(1),R("--")){S("-->");continue}S(">");continue}if(i===47){if(A(1),a(),R("plist")){S(">");continue}if(R("dict")){S(">"),k();continue}if(R("array")){S(">"),b();continue}return u("unexpected closed tag")}const c=F();switch(c.name){case"dict":O(),c.isClosed&&k();continue;case"array":N(),c.isClosed&&b();continue;case"key":w(o(c));continue;case"string":L(o(c));continue;case"real":P(Number.parseFloat(o(c)));continue;case"integer":M(Number.parseInt(o(c),10));continue;case"date":B(new Date(o(c)));continue;case"data":U(o(c));continue;case"true":o(c),x(!0);continue;case"false":o(c),x(!1);continue}if(!/^plist/.test(c.name))return u("unexpected opened tag "+c.name)}return t}export{V as parse};
