var S=Object.defineProperty;var l=Object.getOwnPropertyDescriptor;var c=(s,i,t,e)=>{for(var r=e>1?void 0:e?l(i,t):i,a=s.length-1,n;a>=0;a--)(n=s[a])&&(r=(e?n(i,t,r):n(r))||r);return e&&r&&S(i,t,r),r},h=(s,i)=>(t,e)=>i(t,e,s);import{Emitter as g}from"../../../../../vs/base/common/event.js";import{Disposable as p}from"../../../../../vs/base/common/lifecycle.js";import{isBoolean as m,isObject as v}from"../../../../../vs/base/common/types.js";import{InstantiationType as C,registerSingleton as I}from"../../../../../vs/platform/instantiation/common/extensions.js";import{INativeHostService as f}from"../../../../../vs/platform/native/common/native.js";import{IStorageService as u,StorageScope as d,StorageTarget as E}from"../../../../../vs/platform/storage/common/storage.js";import"../../../../../vs/platform/window/common/window.js";import{INativeWorkbenchEnvironmentService as y}from"../../../../../vs/workbench/services/environment/electron-sandbox/environmentService.js";import{IHostColorSchemeService as O}from"../../../../../vs/workbench/services/themes/common/hostColorSchemeService.js";let o=class extends p{constructor(t,e,r){super();this.nativeHostService=t;this.storageService=r;this._register(this.nativeHostService.onDidChangeColorScheme(n=>this.update(n)));const a=this.getStoredValue()??e.window.colorScheme;this.dark=a.dark,this.highContrast=a.highContrast,this.nativeHostService.getOSColorScheme().then(n=>this.update(n))}static STORAGE_KEY="HostColorSchemeData";_onDidChangeColorScheme=this._register(new g);onDidChangeColorScheme=this._onDidChangeColorScheme.event;dark;highContrast;getStoredValue(){const t=this.storageService.get(o.STORAGE_KEY,d.APPLICATION);if(t)try{const e=JSON.parse(t);if(v(e)&&m(e.highContrast)&&m(e.dark))return e}catch{}}update({highContrast:t,dark:e}){(e!==this.dark||t!==this.highContrast)&&(this.dark=e,this.highContrast=t,this.storageService.store(o.STORAGE_KEY,JSON.stringify({highContrast:t,dark:e}),d.APPLICATION,E.MACHINE),this._onDidChangeColorScheme.fire())}};o=c([h(0,f),h(1,y),h(2,u)],o),I(O,o,C.Delayed);export{o as NativeHostColorSchemeService};
