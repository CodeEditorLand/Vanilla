var u=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var a=(i,n,o,e)=>{for(var t=e>1?void 0:e?g(n,o):n,r=i.length-1,m;r>=0;r--)(m=i[r])&&(t=(e?m(n,o,t):m(t))||t);return e&&t&&u(n,o,t),t},s=(i,n)=>(o,e)=>n(o,e,i);import"../../../../../vs/base/common/cancellation.js";import"../../../../../vs/base/parts/request/common/request.js";import"../../../../../vs/editor/browser/editorExtensions.js";import{CommandsRegistry as p}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as C}from"../../../../../vs/platform/configuration/common/configuration.js";import{ILoggerService as f}from"../../../../../vs/platform/log/common/log.js";import{RequestService as R}from"../../../../../vs/platform/request/browser/requestService.js";import{RequestChannelClient as h}from"../../../../../vs/platform/request/common/requestIpc.js";import{IRemoteAgentService as l}from"../../../../../vs/workbench/services/remote/common/remoteAgentService.js";let c=class extends R{constructor(o,e,t){super(e,t);this.remoteAgentService=o}async request(o,e){try{const t=await super.request(o,e),r=this.remoteAgentService.getConnection();return r&&t.res.statusCode===405?this._makeRemoteRequest(r,o,e):t}catch(t){const r=this.remoteAgentService.getConnection();if(r)return this._makeRemoteRequest(r,o,e);throw t}}_makeRemoteRequest(o,e,t){return o.withChannel("request",r=>new h(r).request(e,t))}};c=a([s(0,l),s(1,C),s(2,f)],c),p.registerCommand("_workbench.fetchJSON",async function(i,n,o){const e=await fetch(n,{method:o,headers:{Accept:"application/json"}});if(e.ok)return e.json();throw new Error(e.statusText)});export{c as BrowserRequestService};
