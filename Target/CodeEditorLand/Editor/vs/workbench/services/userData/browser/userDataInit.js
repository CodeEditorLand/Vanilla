var m=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var c=(a,i,e,t)=>{for(var n=t>1?void 0:t?z(i,e):i,o=a.length-1,l;o>=0;o--)(l=a[o])&&(n=(t?l(i,e,n):l(n))||n);return t&&n&&m(i,e,n),n},s=(a,i)=>(e,t)=>i(e,t,a);import{mark as I}from"../../../../base/common/performance.js";import{isWeb as h}from"../../../../base/common/platform.js";import{createDecorator as v,IInstantiationService as d}from"../../../../platform/instantiation/common/instantiation.js";import{Registry as u}from"../../../../platform/registry/common/platform.js";import{Extensions as p}from"../../../common/contributions.js";import{IExtensionService as w}from"../../extensions/common/extensions.js";import{LifecyclePhase as S}from"../../lifecycle/common/lifecycle.js";const P=v("IUserDataInitializationService");class E{constructor(i=[]){this.initializers=i}_serviceBrand;async whenInitializationFinished(){await this.requiresInitialization()&&await Promise.all(this.initializers.map(i=>i.whenInitializationFinished()))}async requiresInitialization(){return(await Promise.all(this.initializers.map(i=>i.requiresInitialization()))).some(i=>i)}async initializeRequiredResources(){await this.requiresInitialization()&&await Promise.all(this.initializers.map(i=>i.initializeRequiredResources()))}async initializeOtherResources(i){await this.requiresInitialization()&&await Promise.all(this.initializers.map(e=>e.initializeOtherResources(i)))}async initializeInstalledExtensions(i){await this.requiresInitialization()&&await Promise.all(this.initializers.map(e=>e.initializeInstalledExtensions(i)))}}let r=class{constructor(i,e,t){t.whenInstalledExtensionsRegistered().then(()=>this.initializeOtherResource(i,e))}async initializeOtherResource(i,e){await i.requiresInitialization()&&(I("code/willInitOtherUserData"),await i.initializeOtherResources(e),I("code/didInitOtherUserData"))}};r=c([s(0,P),s(1,d),s(2,w)],r),h&&u.as(p.Workbench).registerWorkbenchContribution(r,S.Restored);export{P as IUserDataInitializationService,E as UserDataInitializationService};
