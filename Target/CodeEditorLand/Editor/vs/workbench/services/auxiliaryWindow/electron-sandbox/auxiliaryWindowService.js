var g=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var l=(s,n,e,i)=>{for(var o=i>1?void 0:i?x(n,e):n,t=s.length-1,d;t>=0;t--)(d=s[t])&&(o=(i?d(n,e,o):d(o))||o);return i&&o&&g(n,e,o),o},r=(s,n)=>(e,i)=>n(e,i,s);import{getZoomLevel as C,isFullscreen as b,setFullscreen as H}from"../../../../../vs/base/browser/browser.js";import{getActiveWindow as z}from"../../../../../vs/base/browser/dom.js";import"../../../../../vs/base/browser/window.js";import"../../../../../vs/base/common/async.js";import"../../../../../vs/base/common/lifecycle.js";import{mark as S}from"vs/base/common/performance";import{isMacintosh as k}from"../../../../../vs/base/common/platform.js";import"../../../../../vs/base/parts/sandbox/electron-sandbox/globals.js";import{localize as D}from"../../../../../vs/nls.js";import{IConfigurationService as f}from"../../../../../vs/platform/configuration/common/configuration.js";import{IDialogService as h}from"../../../../../vs/platform/dialogs/common/dialogs.js";import{InstantiationType as E,registerSingleton as U}from"../../../../../vs/platform/instantiation/common/extensions.js";import{IInstantiationService as u}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{INativeHostService as I}from"../../../../../vs/platform/native/common/native.js";import{ITelemetryService as B}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{applyZoom as L}from"../../../../../vs/platform/window/electron-sandbox/window.js";import{AuxiliaryWindow as M,AuxiliaryWindowMode as p,BrowserAuxiliaryWindowService as O,IAuxiliaryWindowService as F}from"../../../../../vs/workbench/services/auxiliaryWindow/browser/auxiliaryWindowService.js";import{IWorkbenchEnvironmentService as W}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IHostService as y}from"../../../../../vs/workbench/services/host/browser/host.js";import{IWorkbenchLayoutService as T}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";import{ShutdownReason as A}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";let a=class extends M{constructor(e,i,o,t,d,w,v,m,P){super(e,i,o,t,v,m);this.nativeHostService=d;this.instantiationService=w;this.dialogService=P;k||this.handleMaximizedState(),this.handleFullScreenState()}skipUnloadConfirmation=!1;maximized=!1;handleMaximizedState(){(async()=>this.maximized=await this.nativeHostService.isMaximized({targetWindowId:this.window.vscodeWindowId}))(),this._register(this.nativeHostService.onDidMaximizeWindow(e=>{e===this.window.vscodeWindowId&&(this.maximized=!0)})),this._register(this.nativeHostService.onDidUnmaximizeWindow(e=>{e===this.window.vscodeWindowId&&(this.maximized=!1)}))}async handleFullScreenState(){await this.nativeHostService.isFullScreen({targetWindowId:this.window.vscodeWindowId})&&H(!0,this.window)}async handleVetoBeforeClose(e,i){this.preventUnload(e),await this.dialogService.error(i,D("backupErrorDetails","Try saving or reverting the editors with unsaved changes first and then try again."))}async confirmBeforeClose(e){if(this.skipUnloadConfirmation)return;this.preventUnload(e),await this.instantiationService.invokeFunction(o=>a.confirmOnShutdown(o,A.CLOSE))&&(this.skipUnloadConfirmation=!0,this.nativeHostService.closeWindow({targetWindowId:this.window.vscodeWindowId}))}preventUnload(e){e.preventDefault(),e.returnValue=!0}createState(){const e=super.createState(),i=b(this.window);return{...e,bounds:e.bounds,mode:this.maximized?p.Maximized:i?p.Fullscreen:p.Normal}}};a=l([r(3,f),r(4,I),r(5,u),r(6,y),r(7,W),r(8,h)],a);let c=class extends O{constructor(e,i,o,t,d,w,v,m){super(e,t,i,w,v,m);this.nativeHostService=o;this.instantiationService=d}async resolveWindowId(e){S("code/auxiliaryWindow/willResolveWindowId");const i=await e.vscode.ipcRenderer.invoke("vscode:registerAuxiliaryWindow",this.nativeHostService.windowId);return S("code/auxiliaryWindow/didResolveWindowId"),i}createContainer(e,i,o){let t;return typeof o?.zoomLevel=="number"?t=o.zoomLevel:t=C(z()),L(t,e),super.createContainer(e,i)}createAuxiliaryWindow(e,i,o){return new a(e,i,o,this.configurationService,this.nativeHostService,this.instantiationService,this.hostService,this.environmentService,this.dialogService)}};c=l([r(0,T),r(1,f),r(2,I),r(3,h),r(4,u),r(5,B),r(6,y),r(7,W)],c),U(F,c,E.Delayed);export{a as NativeAuxiliaryWindow,c as NativeAuxiliaryWindowService};
