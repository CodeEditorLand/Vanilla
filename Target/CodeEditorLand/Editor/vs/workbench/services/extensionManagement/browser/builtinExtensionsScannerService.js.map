{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/extensionManagement/browser/builtinExtensionsScannerService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { mainWindow } from \"../../../../base/browser/window.js\";\nimport {\n\tFileAccess,\n\tbuiltinExtensionsPath,\n} from \"../../../../base/common/network.js\";\nimport { Language, isWeb } from \"../../../../base/common/platform.js\";\nimport { URI } from \"../../../../base/common/uri.js\";\nimport { getGalleryExtensionId } from \"../../../../platform/extensionManagement/common/extensionManagementUtil.js\";\nimport {\n\ttype ITranslations,\n\tlocalizeManifest,\n} from \"../../../../platform/extensionManagement/common/extensionNls.js\";\nimport { IExtensionResourceLoaderService } from \"../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js\";\nimport {\n\tExtensionType,\n\tIBuiltinExtensionsScannerService,\n\ttype IExtension,\n\ttype IExtensionManifest,\n\tTargetPlatform,\n} from \"../../../../platform/extensions/common/extensions.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport { IProductService } from \"../../../../platform/product/common/productService.js\";\nimport { IUriIdentityService } from \"../../../../platform/uriIdentity/common/uriIdentity.js\";\nimport { IWorkbenchEnvironmentService } from \"../../environment/common/environmentService.js\";\n\ninterface IBundledExtension {\n\textensionPath: string;\n\tpackageJSON: IExtensionManifest;\n\tpackageNLS?: any;\n\treadmePath?: string;\n\tchangelogPath?: string;\n}\n\nexport class BuiltinExtensionsScannerService\n\timplements IBuiltinExtensionsScannerService\n{\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly builtinExtensionsPromises: Promise<IExtension>[] = [];\n\n\tprivate nlsUrl: URI | undefined;\n\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionResourceLoaderService private readonly extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@IProductService productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (isWeb) {\n\t\t\tconst nlsBaseUrl = productService.extensionsGallery?.nlsBaseUrl;\n\t\t\t// Only use the nlsBaseUrl if we are using a language other than the default, English.\n\t\t\tif (nlsBaseUrl && productService.commit && !Language.isDefaultVariant()) {\n\t\t\t\tthis.nlsUrl = URI.joinPath(URI.parse(nlsBaseUrl), productService.commit, productService.version, Language.value());\n\t\t\t}\n\n\t\t\tconst builtinExtensionsServiceUrl = FileAccess.asBrowserUri(builtinExtensionsPath);\n\t\t\tif (builtinExtensionsServiceUrl) {\n\t\t\t\tlet bundledExtensions: IBundledExtension[] = [];\n\n\t\t\t\tif (environmentService.isBuilt) {\n\t\t\t\t\t// Built time configuration (do NOT modify)\n\t\t\t\t\tbundledExtensions = [/*BUILD->INSERT_BUILTIN_EXTENSIONS*/];\n\t\t\t\t} else {\n\t\t\t\t\t// Find builtin extensions by checking for DOM\n\t\t\t\t\tconst builtinExtensionsElement = mainWindow.document.getElementById('vscode-workbench-builtin-extensions');\n\t\t\t\t\tconst builtinExtensionsElementAttribute = builtinExtensionsElement ? builtinExtensionsElement.getAttribute('data-settings') : undefined;\n\t\t\t\t\tif (builtinExtensionsElementAttribute) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbundledExtensions = JSON.parse(builtinExtensionsElementAttribute);\n\t\t\t\t\t\t} catch (error) { /* ignore error*/ }\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.builtinExtensionsPromises = bundledExtensions.map(async e => {\n\t\t\t\t\tconst id = getGalleryExtensionId(e.packageJSON.publisher, e.packageJSON.name);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidentifier: { id },\n\t\t\t\t\t\tlocation: uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.extensionPath),\n\t\t\t\t\t\ttype: ExtensionType.System,\n\t\t\t\t\t\tisBuiltin: true,\n\t\t\t\t\t\tmanifest: e.packageNLS ? await this.localizeManifest(id, e.packageJSON, e.packageNLS) : e.packageJSON,\n\t\t\t\t\t\treadmeUrl: e.readmePath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.readmePath) : undefined,\n\t\t\t\t\t\tchangelogUrl: e.changelogPath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.changelogPath) : undefined,\n\t\t\t\t\t\ttargetPlatform: TargetPlatform.WEB,\n\t\t\t\t\t\tvalidations: [],\n\t\t\t\t\t\tisValid: true\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync scanBuiltinExtensions(): Promise<IExtension[]> {\n\t\treturn [...(await Promise.all(this.builtinExtensionsPromises))];\n\t}\n\n\tprivate async localizeManifest(\n\t\textensionId: string,\n\t\tmanifest: IExtensionManifest,\n\t\tfallbackTranslations: ITranslations,\n\t): Promise<IExtensionManifest> {\n\t\tif (!this.nlsUrl) {\n\t\t\treturn localizeManifest(\n\t\t\t\tthis.logService,\n\t\t\t\tmanifest,\n\t\t\t\tfallbackTranslations,\n\t\t\t);\n\t\t}\n\t\t// the `package` endpoint returns the translations in a key-value format similar to the package.nls.json file.\n\t\tconst uri = URI.joinPath(this.nlsUrl, extensionId, \"package\");\n\t\ttry {\n\t\t\tconst res =\n\t\t\t\tawait this.extensionResourceLoaderService.readExtensionResource(\n\t\t\t\t\turi,\n\t\t\t\t);\n\t\t\tconst json = JSON.parse(res.toString());\n\t\t\treturn localizeManifest(\n\t\t\t\tthis.logService,\n\t\t\t\tmanifest,\n\t\t\t\tjson,\n\t\t\t\tfallbackTranslations,\n\t\t\t);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\treturn localizeManifest(\n\t\t\t\tthis.logService,\n\t\t\t\tmanifest,\n\t\t\t\tfallbackTranslations,\n\t\t\t);\n\t\t}\n\t}\n}\n\nregisterSingleton(\n\tIBuiltinExtensionsScannerService,\n\tBuiltinExtensionsScannerService,\n\tInstantiationType.Delayed,\n);\n"],
  "mappings": "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",
  "names": []
}
