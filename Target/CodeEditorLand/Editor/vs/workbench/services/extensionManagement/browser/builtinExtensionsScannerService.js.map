{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/extensionManagement/browser/builtinExtensionsScannerService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IBuiltinExtensionsScannerService, ExtensionType, IExtensionManifest, TargetPlatform, IExtension } from '../../../../platform/extensions/common/extensions.js';\nimport { isWeb, Language } from '../../../../base/common/platform.js';\nimport { IWorkbenchEnvironmentService } from '../../environment/common/environmentService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { getGalleryExtensionId } from '../../../../platform/extensionManagement/common/extensionManagementUtil.js';\nimport { builtinExtensionsPath, FileAccess } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IExtensionResourceLoaderService } from '../../../../platform/extensionResourceLoader/common/extensionResourceLoader.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { ITranslations, localizeManifest } from '../../../../platform/extensionManagement/common/extensionNls.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { mainWindow } from '../../../../base/browser/window.js';\n\ninterface IBundledExtension {\n\textensionPath: string;\n\tpackageJSON: IExtensionManifest;\n\tpackageNLS?: any;\n\treadmePath?: string;\n\tchangelogPath?: string;\n}\n\nexport class BuiltinExtensionsScannerService implements IBuiltinExtensionsScannerService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly builtinExtensionsPromises: Promise<IExtension>[] = [];\n\n\tprivate nlsUrl: URI | undefined;\n\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IExtensionResourceLoaderService private readonly extensionResourceLoaderService: IExtensionResourceLoaderService,\n\t\t@IProductService productService: IProductService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t\tif (isWeb) {\n\t\t\tconst nlsBaseUrl = productService.extensionsGallery?.nlsBaseUrl;\n\t\t\t// Only use the nlsBaseUrl if we are using a language other than the default, English.\n\t\t\tif (nlsBaseUrl && productService.commit && !Language.isDefaultVariant()) {\n\t\t\t\tthis.nlsUrl = URI.joinPath(URI.parse(nlsBaseUrl), productService.commit, productService.version, Language.value());\n\t\t\t}\n\n\t\t\tconst builtinExtensionsServiceUrl = FileAccess.asBrowserUri(builtinExtensionsPath);\n\t\t\tif (builtinExtensionsServiceUrl) {\n\t\t\t\tlet bundledExtensions: IBundledExtension[] = [];\n\n\t\t\t\tif (environmentService.isBuilt) {\n\t\t\t\t\t// Built time configuration (do NOT modify)\n\t\t\t\t\tbundledExtensions = [/*BUILD->INSERT_BUILTIN_EXTENSIONS*/];\n\t\t\t\t} else {\n\t\t\t\t\t// Find builtin extensions by checking for DOM\n\t\t\t\t\tconst builtinExtensionsElement = mainWindow.document.getElementById('vscode-workbench-builtin-extensions');\n\t\t\t\t\tconst builtinExtensionsElementAttribute = builtinExtensionsElement ? builtinExtensionsElement.getAttribute('data-settings') : undefined;\n\t\t\t\t\tif (builtinExtensionsElementAttribute) {\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\tbundledExtensions = JSON.parse(builtinExtensionsElementAttribute);\n\t\t\t\t\t\t} catch (error) { /* ignore error*/ }\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.builtinExtensionsPromises = bundledExtensions.map(async e => {\n\t\t\t\t\tconst id = getGalleryExtensionId(e.packageJSON.publisher, e.packageJSON.name);\n\t\t\t\t\treturn {\n\t\t\t\t\t\tidentifier: { id },\n\t\t\t\t\t\tlocation: uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.extensionPath),\n\t\t\t\t\t\ttype: ExtensionType.System,\n\t\t\t\t\t\tisBuiltin: true,\n\t\t\t\t\t\tmanifest: e.packageNLS ? await this.localizeManifest(id, e.packageJSON, e.packageNLS) : e.packageJSON,\n\t\t\t\t\t\treadmeUrl: e.readmePath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.readmePath) : undefined,\n\t\t\t\t\t\tchangelogUrl: e.changelogPath ? uriIdentityService.extUri.joinPath(builtinExtensionsServiceUrl, e.changelogPath) : undefined,\n\t\t\t\t\t\ttargetPlatform: TargetPlatform.WEB,\n\t\t\t\t\t\tvalidations: [],\n\t\t\t\t\t\tisValid: true\n\t\t\t\t\t};\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\n\tasync scanBuiltinExtensions(): Promise<IExtension[]> {\n\t\treturn [...await Promise.all(this.builtinExtensionsPromises)];\n\t}\n\n\tprivate async localizeManifest(extensionId: string, manifest: IExtensionManifest, fallbackTranslations: ITranslations): Promise<IExtensionManifest> {\n\t\tif (!this.nlsUrl) {\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t\t// the `package` endpoint returns the translations in a key-value format similar to the package.nls.json file.\n\t\tconst uri = URI.joinPath(this.nlsUrl, extensionId, 'package');\n\t\ttry {\n\t\t\tconst res = await this.extensionResourceLoaderService.readExtensionResource(uri);\n\t\t\tconst json = JSON.parse(res.toString());\n\t\t\treturn localizeManifest(this.logService, manifest, json, fallbackTranslations);\n\t\t} catch (e) {\n\t\t\tthis.logService.error(e);\n\t\t\treturn localizeManifest(this.logService, manifest, fallbackTranslations);\n\t\t}\n\t}\n}\n\nregisterSingleton(IBuiltinExtensionsScannerService, BuiltinExtensionsScannerService, InstantiationType.Delayed);\n"],
  "mappings": "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",
  "names": []
}
