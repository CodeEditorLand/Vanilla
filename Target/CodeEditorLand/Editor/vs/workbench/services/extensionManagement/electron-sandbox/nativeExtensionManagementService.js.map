{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/extensionManagement/electron-sandbox/nativeExtensionManagementService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Schemas } from \"../../../../base/common/network.js\";\nimport { joinPath } from \"../../../../base/common/resources.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport { generateUuid } from \"../../../../base/common/uuid.js\";\nimport type { IChannel } from \"../../../../base/parts/ipc/common/ipc.js\";\nimport { IDownloadService } from \"../../../../platform/download/common/download.js\";\nimport type {\n\tILocalExtension,\n\tInstallOptions,\n} from \"../../../../platform/extensionManagement/common/extensionManagement.js\";\nimport {\n\tExtensionIdentifier,\n\tExtensionType,\n\tisResolverExtension,\n} from \"../../../../platform/extensions/common/extensions.js\";\nimport { IFileService } from \"../../../../platform/files/common/files.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport { IUriIdentityService } from \"../../../../platform/uriIdentity/common/uriIdentity.js\";\nimport { INativeWorkbenchEnvironmentService } from \"../../environment/electron-sandbox/environmentService.js\";\nimport { IUserDataProfileService } from \"../../userDataProfile/common/userDataProfile.js\";\nimport type {\n\tDidChangeProfileEvent,\n\tIProfileAwareExtensionManagementService,\n} from \"../common/extensionManagement.js\";\nimport { ProfileAwareExtensionManagementChannelClient } from \"../common/extensionManagementChannelClient.js\";\n\nexport class NativeExtensionManagementService\n\textends ProfileAwareExtensionManagementChannelClient\n\timplements IProfileAwareExtensionManagementService\n{\n\tconstructor(\n\t\tchannel: IChannel,\n\t\t@IUserDataProfileService\n\t\tuserDataProfileService: IUserDataProfileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IDownloadService private readonly downloadService: IDownloadService,\n\t\t@INativeWorkbenchEnvironmentService\n\t\tprivate readonly nativeEnvironmentService: INativeWorkbenchEnvironmentService,\n\t\t@ILogService private readonly logService: ILogService,\n\t) {\n\t\tsuper(channel, userDataProfileService, uriIdentityService);\n\t}\n\n\tprotected filterEvent(\n\t\tprofileLocation: URI,\n\t\tisApplicationScoped: boolean,\n\t): boolean {\n\t\treturn (\n\t\t\tisApplicationScoped ||\n\t\t\tthis.uriIdentityService.extUri.isEqual(\n\t\t\t\tthis.userDataProfileService.currentProfile.extensionsResource,\n\t\t\t\tprofileLocation,\n\t\t\t)\n\t\t);\n\t}\n\n\toverride async install(\n\t\tvsix: URI,\n\t\toptions?: InstallOptions,\n\t): Promise<ILocalExtension> {\n\t\tconst { location, cleanup } = await this.downloadVsix(vsix);\n\t\ttry {\n\t\t\treturn await super.install(location, options);\n\t\t} finally {\n\t\t\tawait cleanup();\n\t\t}\n\t}\n\n\tprivate async downloadVsix(\n\t\tvsix: URI,\n\t): Promise<{ location: URI; cleanup: () => Promise<void> }> {\n\t\tif (vsix.scheme === Schemas.file) {\n\t\t\treturn { location: vsix, async cleanup() {} };\n\t\t}\n\t\tthis.logService.trace(\"Downloading extension from\", vsix.toString());\n\t\tconst location = joinPath(\n\t\t\tthis.nativeEnvironmentService.extensionsDownloadLocation,\n\t\t\tgenerateUuid(),\n\t\t);\n\t\tawait this.downloadService.download(vsix, location);\n\t\tthis.logService.info(\"Downloaded extension to\", location.toString());\n\t\tconst cleanup = async () => {\n\t\t\ttry {\n\t\t\t\tawait this.fileService.del(location);\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t};\n\t\treturn { location, cleanup };\n\t}\n\n\tprotected override async switchExtensionsProfile(\n\t\tpreviousProfileLocation: URI,\n\t\tcurrentProfileLocation: URI,\n\t\tpreserveExtensions?: ExtensionIdentifier[],\n\t): Promise<DidChangeProfileEvent> {\n\t\tif (this.nativeEnvironmentService.remoteAuthority) {\n\t\t\tconst previousInstalledExtensions = await this.getInstalled(\n\t\t\t\tExtensionType.User,\n\t\t\t\tpreviousProfileLocation,\n\t\t\t);\n\t\t\tconst resolverExtension = previousInstalledExtensions.find((e) =>\n\t\t\t\tisResolverExtension(\n\t\t\t\t\te.manifest,\n\t\t\t\t\tthis.nativeEnvironmentService.remoteAuthority,\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (resolverExtension) {\n\t\t\t\tif (!preserveExtensions) {\n\t\t\t\t\tpreserveExtensions = [];\n\t\t\t\t}\n\t\t\t\tpreserveExtensions.push(\n\t\t\t\t\tnew ExtensionIdentifier(resolverExtension.identifier.id),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\treturn super.switchExtensionsProfile(\n\t\t\tpreviousProfileLocation,\n\t\t\tcurrentProfileLocation,\n\t\t\tpreserveExtensions,\n\t\t);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,eAAe;AACxB,SAAS,gBAAgB;AAEzB,SAAS,oBAAoB;AAE7B,SAAS,wBAAwB;AAKjC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,oBAAoB;AAC7B,SAAS,mBAAmB;AAC5B,SAAS,2BAA2B;AACpC,SAAS,0CAA0C;AACnD,SAAS,+BAA+B;AAKxC,SAAS,oDAAoD;AAEtD,IAAM,mCAAN,cACE,6CAET;AAAA,EACC,YACC,SAEA,wBACqB,oBACU,aACI,iBAElB,0BACa,YAC7B;AACD,UAAM,SAAS,wBAAwB,kBAAkB;AAN1B;AACI;AAElB;AACa;AAAA,EAG/B;AAAA,EA/CD,OAkCA;AAAA;AAAA;AAAA,EAeW,YACT,iBACA,qBACU;AACV,WACC,uBACA,KAAK,mBAAmB,OAAO;AAAA,MAC9B,KAAK,uBAAuB,eAAe;AAAA,MAC3C;AAAA,IACD;AAAA,EAEF;AAAA,EAEA,MAAe,QACd,MACA,SAC2B;AAC3B,UAAM,EAAE,UAAU,QAAQ,IAAI,MAAM,KAAK,aAAa,IAAI;AAC1D,QAAI;AACH,aAAO,MAAM,MAAM,QAAQ,UAAU,OAAO;AAAA,IAC7C,UAAE;AACD,YAAM,QAAQ;AAAA,IACf;AAAA,EACD;AAAA,EAEA,MAAc,aACb,MAC2D;AAC3D,QAAI,KAAK,WAAW,QAAQ,MAAM;AACjC,aAAO,EAAE,UAAU,MAAM,MAAM,UAAU;AAAA,MAAC,EAAE;AAAA,IAC7C;AACA,SAAK,WAAW,MAAM,8BAA8B,KAAK,SAAS,CAAC;AACnE,UAAM,WAAW;AAAA,MAChB,KAAK,yBAAyB;AAAA,MAC9B,aAAa;AAAA,IACd;AACA,UAAM,KAAK,gBAAgB,SAAS,MAAM,QAAQ;AAClD,SAAK,WAAW,KAAK,2BAA2B,SAAS,SAAS,CAAC;AACnE,UAAM,UAAU,mCAAY;AAC3B,UAAI;AACH,cAAM,KAAK,YAAY,IAAI,QAAQ;AAAA,MACpC,SAAS,OAAO;AACf,aAAK,WAAW,MAAM,KAAK;AAAA,MAC5B;AAAA,IACD,GANgB;AAOhB,WAAO,EAAE,UAAU,QAAQ;AAAA,EAC5B;AAAA,EAEA,MAAyB,wBACxB,yBACA,wBACA,oBACiC;AACjC,QAAI,KAAK,yBAAyB,iBAAiB;AAClD,YAAM,8BAA8B,MAAM,KAAK;AAAA,QAC9C,cAAc;AAAA,QACd;AAAA,MACD;AACA,YAAM,oBAAoB,4BAA4B;AAAA,QAAK,CAAC,MAC3D;AAAA,UACC,EAAE;AAAA,UACF,KAAK,yBAAyB;AAAA,QAC/B;AAAA,MACD;AACA,UAAI,mBAAmB;AACtB,YAAI,CAAC,oBAAoB;AACxB,+BAAqB,CAAC;AAAA,QACvB;AACA,2BAAmB;AAAA,UAClB,IAAI,oBAAoB,kBAAkB,WAAW,EAAE;AAAA,QACxD;AAAA,MACD;AAAA,IACD;AACA,WAAO,MAAM;AAAA,MACZ;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD;AACD;AAjGa,mCAAN;AAAA,EAMJ;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,GAbU;",
  "names": []
}
