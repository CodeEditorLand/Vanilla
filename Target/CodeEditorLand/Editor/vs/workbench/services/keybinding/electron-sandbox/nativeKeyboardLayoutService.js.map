{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/keybinding/electron-sandbox/nativeKeyboardLayoutService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IKeyboardLayoutInfo, IKeyboardMapping, IMacLinuxKeyboardMapping, IWindowsKeyboardMapping, macLinuxKeyboardMappingEquals, windowsKeyboardMappingEquals } from '../../../../platform/keyboardLayout/common/keyboardLayout.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { OperatingSystem, OS } from '../../../../base/common/platform.js';\nimport { IMainProcessService } from '../../../../platform/ipc/common/mainProcessService.js';\nimport { INativeKeyboardLayoutService as IBaseNativeKeyboardLayoutService } from '../../../../platform/keyboardLayout/common/keyboardLayoutService.js';\nimport { ProxyChannel } from '../../../../base/parts/ipc/common/ipc.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\n\nexport const INativeKeyboardLayoutService = createDecorator<INativeKeyboardLayoutService>('nativeKeyboardLayoutService');\n\nexport interface INativeKeyboardLayoutService {\n\treadonly _serviceBrand: undefined;\n\treadonly onDidChangeKeyboardLayout: Event<void>;\n\tgetRawKeyboardMapping(): IKeyboardMapping | null;\n\tgetCurrentKeyboardLayout(): IKeyboardLayoutInfo | null;\n}\n\nexport class NativeKeyboardLayoutService extends Disposable implements INativeKeyboardLayoutService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _onDidChangeKeyboardLayout = this._register(new Emitter<void>());\n\treadonly onDidChangeKeyboardLayout = this._onDidChangeKeyboardLayout.event;\n\n\tprivate readonly _keyboardLayoutService: IBaseNativeKeyboardLayoutService;\n\tprivate _initPromise: Promise<void> | null;\n\tprivate _keyboardMapping: IKeyboardMapping | null;\n\tprivate _keyboardLayoutInfo: IKeyboardLayoutInfo | null;\n\n\tconstructor(\n\t\t@IMainProcessService mainProcessService: IMainProcessService\n\t) {\n\t\tsuper();\n\t\tthis._keyboardLayoutService = ProxyChannel.toService<IBaseNativeKeyboardLayoutService>(mainProcessService.getChannel('keyboardLayout'));\n\t\tthis._initPromise = null;\n\t\tthis._keyboardMapping = null;\n\t\tthis._keyboardLayoutInfo = null;\n\n\t\tthis._register(this._keyboardLayoutService.onDidChangeKeyboardLayout(async ({ keyboardLayoutInfo, keyboardMapping }) => {\n\t\t\tawait this.initialize();\n\t\t\tif (keyboardMappingEquals(this._keyboardMapping, keyboardMapping)) {\n\t\t\t\t// the mappings are equal\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._keyboardMapping = keyboardMapping;\n\t\t\tthis._keyboardLayoutInfo = keyboardLayoutInfo;\n\t\t\tthis._onDidChangeKeyboardLayout.fire();\n\t\t}));\n\t}\n\n\tpublic initialize(): Promise<void> {\n\t\tif (!this._initPromise) {\n\t\t\tthis._initPromise = this._doInitialize();\n\t\t}\n\t\treturn this._initPromise;\n\t}\n\n\tprivate async _doInitialize(): Promise<void> {\n\t\tconst keyboardLayoutData = await this._keyboardLayoutService.getKeyboardLayoutData();\n\t\tconst { keyboardLayoutInfo, keyboardMapping } = keyboardLayoutData;\n\t\tthis._keyboardMapping = keyboardMapping;\n\t\tthis._keyboardLayoutInfo = keyboardLayoutInfo;\n\t}\n\n\tpublic getRawKeyboardMapping(): IKeyboardMapping | null {\n\t\treturn this._keyboardMapping;\n\t}\n\n\tpublic getCurrentKeyboardLayout(): IKeyboardLayoutInfo | null {\n\t\treturn this._keyboardLayoutInfo;\n\t}\n}\n\nfunction keyboardMappingEquals(a: IKeyboardMapping | null, b: IKeyboardMapping | null): boolean {\n\tif (OS === OperatingSystem.Windows) {\n\t\treturn windowsKeyboardMappingEquals(<IWindowsKeyboardMapping | null>a, <IWindowsKeyboardMapping | null>b);\n\t}\n\n\treturn macLinuxKeyboardMappingEquals(<IMacLinuxKeyboardMapping | null>a, <IMacLinuxKeyboardMapping | null>b);\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,kBAAkB;AAC3B,SAAS,qBAAqB,kBAAkB,0BAA0B,yBAAyB,+BAA+B,oCAAoC;AACtK,SAAS,SAAS,aAAa;AAC/B,SAAS,iBAAiB,UAAU;AACpC,SAAS,2BAA2B;AACpC,SAAS,gCAAgC,wCAAwC;AACjF,SAAS,oBAAoB;AAC7B,SAAS,uBAAuB;AAEzB,MAAM,+BAA+B,gBAA8C,6BAA6B;AAShH,IAAM,8BAAN,cAA0C,WAAmD;AAAA,EAvBpG,OAuBoG;AAAA;AAAA;AAAA,EAIlF,6BAA6B,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EACvE,4BAA4B,KAAK,2BAA2B;AAAA,EAEpD;AAAA,EACT;AAAA,EACA;AAAA,EACA;AAAA,EAER,YACsB,oBACpB;AACD,UAAM;AACN,SAAK,yBAAyB,aAAa,UAA4C,mBAAmB,WAAW,gBAAgB,CAAC;AACtI,SAAK,eAAe;AACpB,SAAK,mBAAmB;AACxB,SAAK,sBAAsB;AAE3B,SAAK,UAAU,KAAK,uBAAuB,0BAA0B,OAAO,EAAE,oBAAoB,gBAAgB,MAAM;AACvH,YAAM,KAAK,WAAW;AACtB,UAAI,sBAAsB,KAAK,kBAAkB,eAAe,GAAG;AAElE;AAAA,MACD;AAEA,WAAK,mBAAmB;AACxB,WAAK,sBAAsB;AAC3B,WAAK,2BAA2B,KAAK;AAAA,IACtC,CAAC,CAAC;AAAA,EACH;AAAA,EAEO,aAA4B;AAClC,QAAI,CAAC,KAAK,cAAc;AACvB,WAAK,eAAe,KAAK,cAAc;AAAA,IACxC;AACA,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,MAAc,gBAA+B;AAC5C,UAAM,qBAAqB,MAAM,KAAK,uBAAuB,sBAAsB;AACnF,UAAM,EAAE,oBAAoB,gBAAgB,IAAI;AAChD,SAAK,mBAAmB;AACxB,SAAK,sBAAsB;AAAA,EAC5B;AAAA,EAEO,wBAAiD;AACvD,WAAO,KAAK;AAAA,EACb;AAAA,EAEO,2BAAuD;AAC7D,WAAO,KAAK;AAAA,EACb;AACD;AAvDa,8BAAN;AAAA,EAaJ;AAAA,GAbU;AAyDb,SAAS,sBAAsB,GAA4B,GAAqC;AAC/F,MAAI,OAAO,gBAAgB,SAAS;AACnC,WAAO,6BAA6D,GAAmC,CAAC;AAAA,EACzG;AAEA,SAAO,8BAA+D,GAAoC,CAAC;AAC5G;AANS;",
  "names": []
}
