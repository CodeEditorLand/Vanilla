var u=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var d=(i,e,o,a)=>{for(var r=a>1?void 0:a?s(e,o):e,n=i.length-1,y;n>=0;n--)(y=i[n])&&(r=(a?y(e,o,r):y(r))||r);return a&&r&&u(e,o,r),r},p=(i,e)=>(o,a)=>e(o,a,i);import{Emitter as b}from"../../../../../vs/base/common/event.js";import{Disposable as l}from"../../../../../vs/base/common/lifecycle.js";import{OperatingSystem as g,OS as I}from"../../../../../vs/base/common/platform.js";import{ProxyChannel as c}from"../../../../../vs/base/parts/ipc/common/ipc.js";import{createDecorator as v}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IMainProcessService as K}from"../../../../../vs/platform/ipc/common/mainProcessService.js";import{macLinuxKeyboardMappingEquals as L,windowsKeyboardMappingEquals as h}from"../../../../../vs/platform/keyboardLayout/common/keyboardLayout.js";import"../../../../../vs/platform/keyboardLayout/common/keyboardLayoutService.js";const q=v("nativeKeyboardLayoutService");let t=class extends l{_onDidChangeKeyboardLayout=this._register(new b);onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;_keyboardLayoutService;_initPromise;_keyboardMapping;_keyboardLayoutInfo;constructor(e){super(),this._keyboardLayoutService=c.toService(e.getChannel("keyboardLayout")),this._initPromise=null,this._keyboardMapping=null,this._keyboardLayoutInfo=null,this._register(this._keyboardLayoutService.onDidChangeKeyboardLayout(async({keyboardLayoutInfo:o,keyboardMapping:a})=>{await this.initialize(),!m(this._keyboardMapping,a)&&(this._keyboardMapping=a,this._keyboardLayoutInfo=o,this._onDidChangeKeyboardLayout.fire())}))}initialize(){return this._initPromise||(this._initPromise=this._doInitialize()),this._initPromise}async _doInitialize(){const e=await this._keyboardLayoutService.getKeyboardLayoutData(),{keyboardLayoutInfo:o,keyboardMapping:a}=e;this._keyboardMapping=a,this._keyboardLayoutInfo=o}getRawKeyboardMapping(){return this._keyboardMapping}getCurrentKeyboardLayout(){return this._keyboardLayoutInfo}};t=d([p(0,K)],t);function m(i,e){return I===g.Windows?h(i,e):L(i,e)}export{q as INativeKeyboardLayoutService,t as NativeKeyboardLayoutService};
