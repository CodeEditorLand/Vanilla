var u=Object.defineProperty;var s=Object.getOwnPropertyDescriptor;var d=(i,e,o,a)=>{for(var r=a>1?void 0:a?s(e,o):e,n=i.length-1,y;n>=0;n--)(y=i[n])&&(r=(a?y(e,o,r):y(r))||r);return a&&r&&u(e,o,r),r},p=(i,e)=>(o,a)=>e(o,a,i);import{Disposable as b}from"../../../../base/common/lifecycle.js";import{macLinuxKeyboardMappingEquals as l,windowsKeyboardMappingEquals as g}from"../../../../platform/keyboardLayout/common/keyboardLayout.js";import{Emitter as I}from"../../../../base/common/event.js";import{OperatingSystem as c,OS as v}from"../../../../base/common/platform.js";import{IMainProcessService as K}from"../../../../platform/ipc/common/mainProcessService.js";import"../../../../platform/keyboardLayout/common/keyboardLayoutService.js";import{ProxyChannel as L}from"../../../../base/parts/ipc/common/ipc.js";import{createDecorator as h}from"../../../../platform/instantiation/common/instantiation.js";const q=h("nativeKeyboardLayoutService");let t=class extends b{_onDidChangeKeyboardLayout=this._register(new I);onDidChangeKeyboardLayout=this._onDidChangeKeyboardLayout.event;_keyboardLayoutService;_initPromise;_keyboardMapping;_keyboardLayoutInfo;constructor(e){super(),this._keyboardLayoutService=L.toService(e.getChannel("keyboardLayout")),this._initPromise=null,this._keyboardMapping=null,this._keyboardLayoutInfo=null,this._register(this._keyboardLayoutService.onDidChangeKeyboardLayout(async({keyboardLayoutInfo:o,keyboardMapping:a})=>{await this.initialize(),!m(this._keyboardMapping,a)&&(this._keyboardMapping=a,this._keyboardLayoutInfo=o,this._onDidChangeKeyboardLayout.fire())}))}initialize(){return this._initPromise||(this._initPromise=this._doInitialize()),this._initPromise}async _doInitialize(){const e=await this._keyboardLayoutService.getKeyboardLayoutData(),{keyboardLayoutInfo:o,keyboardMapping:a}=e;this._keyboardMapping=a,this._keyboardLayoutInfo=o}getRawKeyboardMapping(){return this._keyboardMapping}getCurrentKeyboardLayout(){return this._keyboardLayoutInfo}};t=d([p(0,K)],t);function m(i,e){return v===c.Windows?g(i,e):l(i,e)}export{q as INativeKeyboardLayoutService,t as NativeKeyboardLayoutService};
