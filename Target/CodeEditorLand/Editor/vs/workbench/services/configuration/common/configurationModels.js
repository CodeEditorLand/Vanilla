import{equals as C}from"../../../../base/common/objects.js";import{toValuesTree as M}from"../../../../platform/configuration/common/configuration.js";import{Configuration as h,ConfigurationModelParser as f,ConfigurationModel as c}from"../../../../platform/configuration/common/configurationModels.js";import"../../../../platform/workspaces/common/workspaces.js";import"../../../../platform/workspace/common/workspace.js";import"../../../../base/common/map.js";import"../../../../base/common/uri.js";import{isBoolean as m}from"../../../../base/common/types.js";import{distinct as _}from"../../../../base/common/arrays.js";import"../../../../platform/log/common/log.js";class D extends f{_folders=[];_transient=!1;_settingsModelParser;_launchModel;_tasksModel;constructor(r,e){super(r,e),this._settingsModelParser=new f(r,e),this._launchModel=c.createEmptyModel(e),this._tasksModel=c.createEmptyModel(e)}get folders(){return this._folders}get transient(){return this._transient}get settingsModel(){return this._settingsModelParser.configurationModel}get launchModel(){return this._launchModel}get tasksModel(){return this._tasksModel}reparseWorkspaceSettings(r){this._settingsModelParser.reparse(r)}getRestrictedWorkspaceSettings(){return this._settingsModelParser.restrictedConfigurations}doParseRaw(r,e){return this._folders=r.folders||[],this._transient=m(r.transient)&&r.transient,this._settingsModelParser.parseRaw(r.settings,e),this._launchModel=this.createConfigurationModelFrom(r,"launch"),this._tasksModel=this.createConfigurationModelFrom(r,"tasks"),super.doParseRaw(r,e)}createConfigurationModelFrom(r,e){const o=r[e];if(o){const n=M(o,t=>{}),s=Object.create(null);s[e]=n;const l=Object.keys(o).map(t=>`${e}.${t}`);return new c(s,l,[],void 0,this.logService)}return c.createEmptyModel(this.logService)}}class U extends f{constructor(e,o,n){super(e,n);this.scope=o}doParseRaw(e,o){const n=M(e,t=>{}),s=Object.create(null);s[this.scope]=n;const l=Object.keys(e).map(t=>`${this.scope}.${t}`);return{contents:s,keys:l,overrides:[]}}}class q extends h{constructor(e,o,n,s,l,t,a,u,d,i,g){super(e,o,n,s,l,t,a,u,d,g);this._workspace=i}getValue(e,o={}){return super.getValue(e,o,this._workspace)}inspect(e,o={}){return super.inspect(e,o,this._workspace)}keys(){return super.keys(this._workspace)}compareAndDeleteFolderConfiguration(e){return this._workspace&&this._workspace.folders.length>0&&this._workspace.folders[0].uri.toString()===e.toString()?{keys:[],overrides:[]}:super.compareAndDeleteFolderConfiguration(e)}compare(e){const o=(t,a,u)=>{const d=[];return d.push(...a.filter(i=>t.indexOf(i)===-1)),d.push(...t.filter(i=>a.indexOf(i)===-1)),d.push(...t.filter(i=>a.indexOf(i)===-1?!1:C(this.getValue(i,{overrideIdentifier:u}),e.getValue(i,{overrideIdentifier:u}))?this._workspace&&this._workspace.folders.some(g=>!C(this.getValue(i,{resource:g.uri,overrideIdentifier:u}),e.getValue(i,{resource:g.uri,overrideIdentifier:u}))):!0)),d},n=o(this.allKeys(),e.allKeys()),s=[],l=_([...this.allOverrideIdentifiers(),...e.allOverrideIdentifiers()]);for(const t of l){const a=o(this.getAllKeysForOverrideIdentifier(t),e.getAllKeysForOverrideIdentifier(t),t);a.length&&s.push([t,a])}return{keys:n,overrides:s}}}export{q as Configuration,U as StandaloneConfigurationModelParser,D as WorkspaceConfigurationModelParser};
