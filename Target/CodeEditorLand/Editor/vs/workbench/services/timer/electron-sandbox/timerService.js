var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var S=(a,o,e,t)=>{for(var i=t>1?void 0:t?y(o,e):o,n=a.length-1,s;n>=0;n--)(s=a[n])&&(i=(t?s(o,e,i):s(i))||i);return t&&i&&g(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import{INativeHostService as P}from"../../../../platform/native/common/native.js";import{INativeWorkbenchEnvironmentService as _}from"../../environment/electron-sandbox/environmentService.js";import{IWorkspaceContextService as b}from"../../../../platform/workspace/common/workspace.js";import{IExtensionService as C}from"../../extensions/common/extensions.js";import{IUpdateService as M}from"../../../../platform/update/common/update.js";import{ILifecycleService as k}from"../../lifecycle/common/lifecycle.js";import{IEditorService as w}from"../../editor/common/editorService.js";import{IAccessibilityService as A}from"../../../../platform/accessibility/common/accessibility.js";import{AbstractTimerService as H,ITimerService as W}from"../browser/timerService.js";import{ITelemetryService as E}from"../../../../platform/telemetry/common/telemetry.js";import{process as x}from"../../../../base/parts/sandbox/electron-sandbox/globals.js";import{InstantiationType as N,registerSingleton as R}from"../../../../platform/instantiation/common/extensions.js";import{IWorkbenchLayoutService as L}from"../../layout/browser/layoutService.js";import{IProductService as T}from"../../../../platform/product/common/productService.js";import{IStorageService as U,StorageScope as d,StorageTarget as O}from"../../../../platform/storage/common/storage.js";import{IPaneCompositePartService as B}from"../../panecomposite/browser/panecomposite.js";let v=class extends H{constructor(e,t,i,n,s,m,c,I,u,f,h,V,z){super(i,n,s,m,c,I,u,f,h);this._nativeHostService=e;this._environmentService=t;this._productService=V;this._storageService=z;this.setPerformanceMarks("main",t.window.perfMarks)}_isInitialStartup(){return!!this._environmentService.window.isInitialStartup}_didUseCachedData(){return D(this._productService,this._storageService,this._environmentService)}_getWindowCount(){return this._nativeHostService.getWindowCount()}async _extendStartupInfo(e){try{const[t,i,n,s]=await Promise.all([this._nativeHostService.getOSProperties(),this._nativeHostService.getOSStatistics(),this._nativeHostService.getOSVirtualMachineHint(),this._nativeHostService.isRunningUnderARM64Translation()]);e.totalmem=i.totalmem,e.freemem=i.freemem,e.platform=t.platform,e.release=t.release,e.arch=t.arch,e.loadavg=i.loadavg,e.isARM64Emulated=s;const m=await x.getProcessMemoryInfo();e.meminfo={workingSetSize:m.residentSet,privateBytes:m.private,sharedBytes:m.shared},e.isVMLikelyhood=Math.round(n*100);const c=t.cpus;c&&c.length>0&&(e.cpus={count:c.length,speed:c[0].speed,model:c[0].model})}catch{}}_shouldReportPerfMarks(){return super._shouldReportPerfMarks()||!!this._environmentService.args["prof-append-timers"]}};v=S([r(0,P),r(1,_),r(2,k),r(3,b),r(4,C),r(5,M),r(6,B),r(7,w),r(8,A),r(9,E),r(10,L),r(11,T),r(12,U)],v),R(W,v,N.Delayed);const l="perf/lastRunningCommit";let p;function D(a,o,e){return typeof p!="boolean"&&(!e.window.isCodeCaching||!a.commit?p=!1:o.get(l,d.APPLICATION)===a.commit?p=!0:(o.store(l,a.commit,d.APPLICATION,O.MACHINE),p=!1)),p}export{v as TimerService,D as didUseCachedData};
