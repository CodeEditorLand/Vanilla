{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/driver/browser/driver.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Terminal as XtermTerminal } from \"@xterm/xterm\";\nimport {\n\tgetClientArea,\n\tgetTopLeftOffset,\n} from \"../../../../base/browser/dom.js\";\nimport { mainWindow } from \"../../../../base/browser/window.js\";\nimport { coalesce } from \"../../../../base/common/arrays.js\";\nimport { language, locale } from \"../../../../base/common/platform.js\";\nimport { IEnvironmentService } from \"../../../../platform/environment/common/environment.js\";\nimport { IFileService } from \"../../../../platform/files/common/files.js\";\nimport type { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport localizedStrings from \"../../../../platform/languagePacks/common/localizedStrings.js\";\nimport {\n\ttype ILogFile,\n\tgetLogs,\n} from \"../../../../platform/log/browser/log.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport { Registry } from \"../../../../platform/registry/common/platform.js\";\nimport {\n\ttype IWorkbenchContributionsRegistry,\n\tExtensions as WorkbenchExtensions,\n} from \"../../../common/contributions.js\";\nimport {\n\tILifecycleService,\n\tLifecyclePhase,\n} from \"../../lifecycle/common/lifecycle.js\";\nimport type {\n\tIElement,\n\tILocaleInfo,\n\tILocalizedStrings,\n\tIWindowDriver,\n} from \"../common/driver.js\";\n\nexport class BrowserWindowDriver implements IWindowDriver {\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IEnvironmentService private readonly environmentService: IEnvironmentService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t\t@ILogService private readonly logService: ILogService\n\t) {\n\t}\n\n\tasync getLogs(): Promise<ILogFile[]> {\n\t\treturn getLogs(this.fileService, this.environmentService);\n\t}\n\n\tasync whenWorkbenchRestored(): Promise<void> {\n\t\tthis.logService.info(\n\t\t\t\"[driver] Waiting for restored lifecycle phase...\",\n\t\t);\n\t\tawait this.lifecycleService.when(LifecyclePhase.Restored);\n\t\tthis.logService.info(\n\t\t\t\"[driver] Restored lifecycle phase reached. Waiting for contributions...\",\n\t\t);\n\t\tawait Registry.as<IWorkbenchContributionsRegistry>(\n\t\t\tWorkbenchExtensions.Workbench,\n\t\t).whenRestored;\n\t\tthis.logService.info(\"[driver] Workbench contributions created.\");\n\t}\n\n\tasync setValue(selector: string, text: string): Promise<void> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\treturn Promise.reject(new Error(`Element not found: ${selector}`));\n\t\t}\n\n\t\tconst inputElement = element as HTMLInputElement;\n\t\tinputElement.value = text;\n\n\t\tconst event = new Event(\"input\", { bubbles: true, cancelable: true });\n\t\tinputElement.dispatchEvent(event);\n\t}\n\n\tasync isActiveElement(selector: string): Promise<boolean> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (element !== mainWindow.document.activeElement) {\n\t\t\tconst chain: string[] = [];\n\t\t\tlet el = mainWindow.document.activeElement;\n\n\t\t\twhile (el) {\n\t\t\t\tconst tagName = el.tagName;\n\t\t\t\tconst id = el.id ? `#${el.id}` : \"\";\n\t\t\t\tconst classes = coalesce(\n\t\t\t\t\tel.className.split(/\\s+/g).map((c) => c.trim()),\n\t\t\t\t)\n\t\t\t\t\t.map((c) => `.${c}`)\n\t\t\t\t\t.join(\"\");\n\t\t\t\tchain.unshift(`${tagName}${id}${classes}`);\n\n\t\t\t\tel = el.parentElement;\n\t\t\t}\n\n\t\t\tthrow new Error(\n\t\t\t\t`Active element not found. Current active element is '${chain.join(\" > \")}'. Looking for ${selector}`,\n\t\t\t);\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tasync getElements(\n\t\tselector: string,\n\t\trecursive: boolean,\n\t): Promise<IElement[]> {\n\t\tconst query = mainWindow.document.querySelectorAll(selector);\n\t\tconst result: IElement[] = [];\n\t\tfor (let i = 0; i < query.length; i++) {\n\t\t\tconst element = query.item(i);\n\t\t\tresult.push(this.serializeElement(element, recursive));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate serializeElement(element: Element, recursive: boolean): IElement {\n\t\tconst attributes = Object.create(null);\n\n\t\tfor (let j = 0; j < element.attributes.length; j++) {\n\t\t\tconst attr = element.attributes.item(j);\n\t\t\tif (attr) {\n\t\t\t\tattributes[attr.name] = attr.value;\n\t\t\t}\n\t\t}\n\n\t\tconst children: IElement[] = [];\n\n\t\tif (recursive) {\n\t\t\tfor (let i = 0; i < element.children.length; i++) {\n\t\t\t\tconst child = element.children.item(i);\n\t\t\t\tif (child) {\n\t\t\t\t\tchildren.push(this.serializeElement(child, true));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst { left, top } = getTopLeftOffset(element as HTMLElement);\n\n\t\treturn {\n\t\t\ttagName: element.tagName,\n\t\t\tclassName: element.className,\n\t\t\ttextContent: element.textContent || \"\",\n\t\t\tattributes,\n\t\t\tchildren,\n\t\t\tleft,\n\t\t\ttop,\n\t\t};\n\t}\n\n\tasync getElementXY(\n\t\tselector: string,\n\t\txoffset?: number,\n\t\tyoffset?: number,\n\t): Promise<{ x: number; y: number }> {\n\t\tconst offset =\n\t\t\ttypeof xoffset === \"number\" && typeof yoffset === \"number\"\n\t\t\t\t? { x: xoffset, y: yoffset }\n\t\t\t\t: undefined;\n\t\treturn this._getElementXY(selector, offset);\n\t}\n\n\tasync typeInEditor(selector: string, text: string): Promise<void> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Editor not found: ${selector}`);\n\t\t}\n\n\t\tconst textarea = element as HTMLTextAreaElement;\n\t\tconst start = textarea.selectionStart;\n\t\tconst newStart = start + text.length;\n\t\tconst value = textarea.value;\n\t\tconst newValue = value.substr(0, start) + text + value.substr(start);\n\n\t\ttextarea.value = newValue;\n\t\ttextarea.setSelectionRange(newStart, newStart);\n\n\t\tconst event = new Event(\"input\", { bubbles: true, cancelable: true });\n\t\ttextarea.dispatchEvent(event);\n\t}\n\n\tasync getTerminalBuffer(selector: string): Promise<string[]> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Terminal not found: ${selector}`);\n\t\t}\n\n\t\tconst xterm = (element as any).xterm;\n\n\t\tif (!xterm) {\n\t\t\tthrow new Error(`Xterm not found: ${selector}`);\n\t\t}\n\n\t\tconst lines: string[] = [];\n\t\tfor (let i = 0; i < xterm.buffer.active.length; i++) {\n\t\t\tlines.push(xterm.buffer.active.getLine(i)!.translateToString(true));\n\t\t}\n\n\t\treturn lines;\n\t}\n\n\tasync writeInTerminal(selector: string, text: string): Promise<void> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\tthrow new Error(`Element not found: ${selector}`);\n\t\t}\n\n\t\tconst xterm = (element as any).xterm as XtermTerminal | undefined;\n\n\t\tif (!xterm) {\n\t\t\tthrow new Error(`Xterm not found: ${selector}`);\n\t\t}\n\n\t\txterm.input(text);\n\t}\n\n\tgetLocaleInfo(): Promise<ILocaleInfo> {\n\t\treturn Promise.resolve({\n\t\t\tlanguage: language,\n\t\t\tlocale: locale,\n\t\t});\n\t}\n\n\tgetLocalizedStrings(): Promise<ILocalizedStrings> {\n\t\treturn Promise.resolve({\n\t\t\topen: localizedStrings.open,\n\t\t\tclose: localizedStrings.close,\n\t\t\tfind: localizedStrings.find,\n\t\t});\n\t}\n\n\tprotected async _getElementXY(\n\t\tselector: string,\n\t\toffset?: { x: number; y: number },\n\t): Promise<{ x: number; y: number }> {\n\t\tconst element = mainWindow.document.querySelector(selector);\n\n\t\tif (!element) {\n\t\t\treturn Promise.reject(new Error(`Element not found: ${selector}`));\n\t\t}\n\n\t\tconst { left, top } = getTopLeftOffset(element as HTMLElement);\n\t\tconst { width, height } = getClientArea(element as HTMLElement);\n\t\tlet x: number, y: number;\n\n\t\tif (offset) {\n\t\t\tx = left + offset.x;\n\t\t\ty = top + offset.y;\n\t\t} else {\n\t\t\tx = left + width / 2;\n\t\t\ty = top + height / 2;\n\t\t}\n\n\t\tx = Math.round(x);\n\t\ty = Math.round(y);\n\n\t\treturn { x, y };\n\t}\n\n\tasync exitApplication(): Promise<void> {\n\t\t// No-op in web\n\t}\n}\n\nexport function registerWindowDriver(\n\tinstantiationService: IInstantiationService,\n): void {\n\tObject.assign(mainWindow, {\n\t\tdriver: instantiationService.createInstance(BrowserWindowDriver),\n\t});\n}\n"],
  "mappings": "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",
  "names": []
}
