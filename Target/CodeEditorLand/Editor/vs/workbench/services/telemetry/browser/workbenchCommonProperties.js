import{Gesture as A}from"../../../../base/browser/touch.js";import{mixin as P}from"../../../../base/common/objects.js";import*as n from"../../../../base/common/platform.js";import*as c from"../../../../base/common/uuid.js";import{StorageScope as r,StorageTarget as D}from"../../../../platform/storage/common/storage.js";import{firstSessionDateStorageKey as b,lastSessionDateStorageKey as h,machineIdKey as u}from"../../../../platform/telemetry/common/telemetry.js";import{cleanRemoteAuthority as C}from"../../../../platform/telemetry/common/telemetryUtils.js";function y(t){return t.replace(/(\d+\.\d+)(\.\d+)+/g,"$1")}function K(t,g,f,m,l,s,p,i){const e=Object.create(null),d=t.get(b,r.APPLICATION),a=t.get(h,r.APPLICATION);let o;p?o=`Redacted-${s??"web"}`:(o=t.get(u,r.APPLICATION),o||(o=c.generateUuid(),t.store(u,o,r.APPLICATION,D.MACHINE))),e["common.firstSessionDate"]=d,e["common.lastSessionDate"]=a||"",e["common.isNewSession"]=a?"0":"1",e["common.remoteAuthority"]=C(l),e["common.machineId"]=o,e.sessionID=c.generateUuid()+Date.now(),e.commitHash=g,e.version=f,e["common.platform"]=n.PlatformToString(n.platform),e["common.product"]=s??"web",e["common.userAgent"]=n.userAgent?y(n.userAgent):void 0,e["common.isTouchDevice"]=String(A.isTouchDevice()),m&&(e["common.msftInternal"]=m);let I=0;const S=Date.now();return Object.defineProperties(e,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-S,enumerable:!0},"common.sequence":{get:()=>I++,enumerable:!0}}),i&&P(e,i()),e}export{K as resolveWorkbenchCommonProperties};
