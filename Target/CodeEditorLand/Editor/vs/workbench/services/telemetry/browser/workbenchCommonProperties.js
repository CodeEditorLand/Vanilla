import{StorageScope as n,StorageTarget as A}from"../../../../platform/storage/common/storage.js";import*as r from"../../../../base/common/platform.js";import*as c from"../../../../base/common/uuid.js";import{cleanRemoteAuthority as P}from"../../../../platform/telemetry/common/telemetryUtils.js";import{mixin as D}from"../../../../base/common/objects.js";import{firstSessionDateStorageKey as b,lastSessionDateStorageKey as h,machineIdKey as u}from"../../../../platform/telemetry/common/telemetry.js";import{Gesture as C}from"../../../../base/browser/touch.js";function T(o){return o.replace(/(\d+\.\d+)(\.\d+)+/g,"$1")}function j(o,g,f,m,l,s,d,i){const e=Object.create(null),p=o.get(b,n.APPLICATION),a=o.get(h,n.APPLICATION);let t;d?t=`Redacted-${s??"web"}`:(t=o.get(u,n.APPLICATION),t||(t=c.generateUuid(),o.store(u,t,n.APPLICATION,A.MACHINE))),e["common.firstSessionDate"]=p,e["common.lastSessionDate"]=a||"",e["common.isNewSession"]=a?"0":"1",e["common.remoteAuthority"]=P(l),e["common.machineId"]=t,e.sessionID=c.generateUuid()+Date.now(),e.commitHash=g,e.version=f,e["common.platform"]=r.PlatformToString(r.platform),e["common.product"]=s??"web",e["common.userAgent"]=r.userAgent?T(r.userAgent):void 0,e["common.isTouchDevice"]=String(C.isTouchDevice()),m&&(e["common.msftInternal"]=m);let I=0;const S=Date.now();return Object.defineProperties(e,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-S,enumerable:!0},"common.sequence":{get:()=>I++,enumerable:!0}}),i&&D(e,i()),e}export{j as resolveWorkbenchCommonProperties};
