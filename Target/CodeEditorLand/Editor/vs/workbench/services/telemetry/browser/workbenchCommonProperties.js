import{Gesture as A}from"../../../../../vs/base/browser/touch.js";import{mixin as P}from"../../../../../vs/base/common/objects.js";import*as n from"../../../../../vs/base/common/platform.js";import*as c from"../../../../../vs/base/common/uuid.js";import{StorageScope as r,StorageTarget as D}from"../../../../../vs/platform/storage/common/storage.js";import{firstSessionDateStorageKey as b,lastSessionDateStorageKey as h,machineIdKey as u}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{cleanRemoteAuthority as C}from"../../../../../vs/platform/telemetry/common/telemetryUtils.js";function T(o){return o.replace(/(\d+\.\d+)(\.\d+)+/g,"$1")}function j(o,g,f,m,l,s,d,i){const e=Object.create(null),p=o.get(b,r.APPLICATION),a=o.get(h,r.APPLICATION);let t;d?t=`Redacted-${s??"web"}`:(t=o.get(u,r.APPLICATION),t||(t=c.generateUuid(),o.store(u,t,r.APPLICATION,D.MACHINE))),e["common.firstSessionDate"]=p,e["common.lastSessionDate"]=a||"",e["common.isNewSession"]=a?"0":"1",e["common.remoteAuthority"]=C(l),e["common.machineId"]=t,e.sessionID=c.generateUuid()+Date.now(),e.commitHash=g,e.version=f,e["common.platform"]=n.PlatformToString(n.platform),e["common.product"]=s??"web",e["common.userAgent"]=n.userAgent?T(n.userAgent):void 0,e["common.isTouchDevice"]=String(A.isTouchDevice()),m&&(e["common.msftInternal"]=m);let I=0;const S=Date.now();return Object.defineProperties(e,{timestamp:{get:()=>new Date,enumerable:!0},"common.timesincesessionstart":{get:()=>Date.now()-S,enumerable:!0},"common.sequence":{get:()=>I++,enumerable:!0}}),i&&P(e,i()),e}export{j as resolveWorkbenchCommonProperties};
