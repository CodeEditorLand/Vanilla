import{timeout as r}from"../../../../base/common/async.js";import"../../../../base/common/event.js";import"../../../../base/parts/ipc/common/ipc.js";import"../../../../platform/diagnostics/common/diagnostics.js";import{createDecorator as a}from"../../../../platform/instantiation/common/instantiation.js";import"../../../../platform/remote/common/remoteAgentConnection.js";import"../../../../platform/remote/common/remoteAgentEnvironment.js";import"../../../../platform/telemetry/common/telemetry.js";const L=a("remoteAgentService"),M=new class{maxSampleCount=5;sampleDelay=2e3;initial=[];maxInitialCount=3;average=[];maxAverageCount=100;highLatencyMultiple=2;highLatencyMinThreshold=500;highLatencyMaxThreshold=1500;lastMeasurement=void 0;get latency(){return this.lastMeasurement}async measure(o){let e=1/0;for(let n=0;n<this.maxSampleCount;n++){const t=await o.getRoundTripTime();if(t===void 0)return;e=Math.min(e,t/2),await r(this.sampleDelay)}this.average.push(e),this.average.length>this.maxAverageCount&&this.average.shift();let i;return this.initial.length<this.maxInitialCount?this.initial.push(e):i=this.initial.reduce((n,t)=>n+t,0)/this.initial.length,this.lastMeasurement={initial:i,current:e,average:this.average.reduce((n,t)=>n+t,0)/this.average.length,high:typeof i>"u"?!1:e>this.highLatencyMaxThreshold||e>this.highLatencyMinThreshold&&e>i*this.highLatencyMultiple},this.lastMeasurement}};export{L as IRemoteAgentService,M as remoteConnectionLatencyMeasurer};
