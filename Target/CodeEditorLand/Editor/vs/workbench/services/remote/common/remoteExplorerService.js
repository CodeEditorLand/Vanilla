var g=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var p=(i,e,n,o)=>{for(var t=o>1?void 0:o?h(e,n):e,l=i.length-1,u;l>=0;l--)(u=i[l])&&(t=(o?u(e,n,t):u(t))||t);return o&&t&&g(e,n,t),t},s=(i,e)=>(n,o)=>e(n,o,i);import{Emitter as d}from"../../../../base/common/event.js";import*as r from"../../../../nls.js";import{InstantiationType as f,registerSingleton as T}from"../../../../platform/instantiation/common/extensions.js";import{IInstantiationService as E,createDecorator as b}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService as y,StorageScope as m,StorageTarget as c}from"../../../../platform/storage/common/storage.js";import{ITunnelService as P}from"../../../../platform/tunnel/common/tunnel.js";import{ExtensionsRegistry as _}from"../../extensions/common/extensionsRegistry.js";import{TunnelModel as v}from"./tunnelModel.js";const S=b("remoteExplorerService"),I="remote.explorerType",j="~remote.forwardedPorts",k="~remote.forwardedPortsContainer",z="remote.autoForwardPorts",G="remote.autoForwardPortsSource",L="remote.autoForwardPortsFallback",W="process",B="output",K="hybrid";var C=(t=>(t.Candidate="Candidate",t.Detected="Detected",t.Forwarded="Forwarded",t.Add="Add",t))(C||{}),x=(t=>(t[t.None=0]="None",t[t.New=1]="New",t[t.Label=2]="Label",t[t.LocalPort=3]="LocalPort",t))(x||{});const D={type:"object",required:["id"],properties:{id:{description:r.localize("getStartedWalkthrough.id","The ID of a Get Started walkthrough to open."),type:"string"}}},R=_.registerExtensionPoint({extensionPoint:"remoteHelp",jsonSchema:{description:r.localize("RemoteHelpInformationExtPoint","Contributes help information for Remote"),type:"object",properties:{getStarted:{description:r.localize("RemoteHelpInformationExtPoint.getStarted","The url, or a command that returns the url, to your project's Getting Started page, or a walkthrough ID contributed by your project's extension"),oneOf:[{type:"string"},D]},documentation:{description:r.localize("RemoteHelpInformationExtPoint.documentation","The url, or a command that returns the url, to your project's documentation page"),type:"string"},feedback:{description:r.localize("RemoteHelpInformationExtPoint.feedback","The url, or a command that returns the url, to your project's feedback reporter"),type:"string",markdownDeprecationMessage:r.localize("RemoteHelpInformationExtPoint.feedback.deprecated","Use {0} instead","`reportIssue`")},reportIssue:{description:r.localize("RemoteHelpInformationExtPoint.reportIssue","The url, or a command that returns the url, to your project's issue reporter"),type:"string"},issues:{description:r.localize("RemoteHelpInformationExtPoint.issues","The url, or a command that returns the url, to your project's issues list"),type:"string"}}}});let a=class{constructor(e,n,o){this.storageService=e;this.tunnelService=n;this._tunnelModel=o.createInstance(v),R.setHandler(t=>{this._helpInformation.push(...t),this._onDidChangeHelpInformation.fire(t)})}_serviceBrand;_targetType=[];_onDidChangeTargetType=new d;onDidChangeTargetType=this._onDidChangeTargetType.event;_onDidChangeHelpInformation=new d;onDidChangeHelpInformation=this._onDidChangeHelpInformation.event;_helpInformation=[];_tunnelModel;_editable;_onDidChangeEditable=new d;onDidChangeEditable=this._onDidChangeEditable.event;_onEnabledPortsFeatures=new d;onEnabledPortsFeatures=this._onEnabledPortsFeatures.event;_portsFeaturesEnabled=!1;namedProcesses=new Map;get helpInformation(){return this._helpInformation}set targetType(e){const n=this._targetType.length>0?this._targetType[0]:"",o=e.length>0?e[0]:"";n!==o&&(this._targetType=e,this.storageService.store(I,this._targetType.toString(),m.WORKSPACE,c.MACHINE),this.storageService.store(I,this._targetType.toString(),m.PROFILE,c.USER),this._onDidChangeTargetType.fire(this._targetType))}get targetType(){return this._targetType}get tunnelModel(){return this._tunnelModel}forward(e,n){return this.tunnelModel.forward(e,n)}close(e,n){return this.tunnelModel.close(e.host,e.port,n)}setTunnelInformation(e){e?.features&&this.tunnelService.setTunnelFeatures(e.features),this.tunnelModel.addEnvironmentTunnels(e?.environmentTunnels)}setEditable(e,n,o){o?this._editable={tunnelItem:e,data:o,editId:n}:this._editable=void 0,this._onDidChangeEditable.fire(e?{tunnel:e,editId:n}:void 0)}getEditableData(e,n){return this._editable&&(!e&&e===this._editable.tunnelItem||e&&this._editable.tunnelItem?.remotePort===e.remotePort&&this._editable.tunnelItem.remoteHost===e.remoteHost&&this._editable.editId===n)?this._editable.data:void 0}setCandidateFilter(e){return e?(this.tunnelModel.setCandidateFilter(e),{dispose:()=>{this.tunnelModel.setCandidateFilter(void 0)}}):{dispose:()=>{}}}onFoundNewCandidates(e){this.tunnelModel.setCandidates(e)}restore(){return this.tunnelModel.restoreForwarded()}enablePortsFeatures(){this._portsFeaturesEnabled=!0,this._onEnabledPortsFeatures.fire()}get portsFeaturesEnabled(){return this._portsFeaturesEnabled}};a=p([s(0,y),s(1,P),s(2,E)],a),T(S,a,f.Delayed);export{S as IRemoteExplorerService,L as PORT_AUTO_FALLBACK_SETTING,z as PORT_AUTO_FORWARD_SETTING,G as PORT_AUTO_SOURCE_SETTING,K as PORT_AUTO_SOURCE_SETTING_HYBRID,B as PORT_AUTO_SOURCE_SETTING_OUTPUT,W as PORT_AUTO_SOURCE_SETTING_PROCESS,I as REMOTE_EXPLORER_TYPE_KEY,k as TUNNEL_VIEW_CONTAINER_ID,j as TUNNEL_VIEW_ID,x as TunnelEditId,C as TunnelType};
