var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var m=(a,e,i,n)=>{for(var r=n>1?void 0:n?v(e,i):e,o=a.length-1,s;o>=0;o--)(s=a[o])&&(r=(n?s(e,i,r):s(r))||r);return n&&r&&l(e,i,r),r},t=(a,e)=>(i,n)=>e(i,n,a);import{IRemoteAgentService as f}from"./remoteAgentService.js";import{IRemoteExtensionsScannerService as g,RemoteExtensionsScannerChannelName as p}from"../../../../platform/remote/common/remoteExtensionsScanner.js";import*as h from"../../../../base/common/platform.js";import"../../../../base/parts/ipc/common/ipc.js";import"../../../../platform/extensions/common/extensions.js";import{URI as S}from"../../../../base/common/uri.js";import{IUserDataProfileService as u}from"../../userDataProfile/common/userDataProfile.js";import{IRemoteUserDataProfilesService as I}from"../../userDataProfile/common/remoteUserDataProfiles.js";import{IWorkbenchEnvironmentService as d}from"../../environment/common/environmentService.js";import{ILogService as P}from"../../../../platform/log/common/log.js";import{InstantiationType as x,registerSingleton as y}from"../../../../platform/instantiation/common/extensions.js";import{IActiveLanguagePackService as D}from"../../localization/common/locale.js";import{IWorkbenchExtensionManagementService as E}from"../../extensionManagement/common/extensionManagement.js";import"../../../../base/common/types.js";let c=class{constructor(e,i,n,r,o,s,R){this.remoteAgentService=e;this.environmentService=i;this.userDataProfileService=n;this.remoteUserDataProfilesService=r;this.activeLanguagePackService=o;this.extensionManagementService=s;this.logService=R}whenExtensionsReady(){return this.withChannel(e=>e.call("whenExtensionsReady"),void 0)}async scanExtensions(){try{const e=await this.activeLanguagePackService.getExtensionIdProvidingCurrentLocale();return await this.withChannel(async i=>{const n=this.userDataProfileService.currentProfile.isDefault?void 0:(await this.remoteUserDataProfilesService.getRemoteProfile(this.userDataProfileService.currentProfile)).extensionsResource,r=await i.call("scanExtensions",[h.language,n,this.extensionManagementService.getInstalledWorkspaceExtensionLocations(),this.environmentService.extensionDevelopmentLocationURI,e]);return r.forEach(o=>{o.extensionLocation=S.revive(o.extensionLocation)}),r},[])}catch(e){return this.logService.error(e),[]}}withChannel(e,i){const n=this.remoteAgentService.getConnection();return n?n.withChannel(p,r=>e(r)):Promise.resolve(i)}};c=m([t(0,f),t(1,d),t(2,u),t(3,I),t(4,D),t(5,E),t(6,P)],c),y(g,c,x.Delayed);
