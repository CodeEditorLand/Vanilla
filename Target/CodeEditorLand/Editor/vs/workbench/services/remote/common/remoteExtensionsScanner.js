var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var m=(a,e,i,n)=>{for(var r=n>1?void 0:n?v(e,i):e,o=a.length-1,s;o>=0;o--)(s=a[o])&&(r=(n?s(e,i,r):s(r))||r);return n&&r&&l(e,i,r),r},t=(a,e)=>(i,n)=>e(i,n,a);import*as f from"../../../../../vs/base/common/platform.js";import"../../../../../vs/base/common/types.js";import{URI as g}from"../../../../../vs/base/common/uri.js";import"../../../../../vs/base/parts/ipc/common/ipc.js";import"../../../../../vs/platform/extensions/common/extensions.js";import{InstantiationType as p,registerSingleton as h}from"../../../../../vs/platform/instantiation/common/extensions.js";import{ILogService as S}from"../../../../../vs/platform/log/common/log.js";import{IRemoteExtensionsScannerService as u,RemoteExtensionsScannerChannelName as I}from"../../../../../vs/platform/remote/common/remoteExtensionsScanner.js";import{IWorkbenchEnvironmentService as d}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IWorkbenchExtensionManagementService as P}from"../../../../../vs/workbench/services/extensionManagement/common/extensionManagement.js";import{IActiveLanguagePackService as x}from"../../../../../vs/workbench/services/localization/common/locale.js";import{IRemoteAgentService as y}from"../../../../../vs/workbench/services/remote/common/remoteAgentService.js";import{IRemoteUserDataProfilesService as D}from"../../../../../vs/workbench/services/userDataProfile/common/remoteUserDataProfiles.js";import{IUserDataProfileService as E}from"../../../../../vs/workbench/services/userDataProfile/common/userDataProfile.js";let c=class{constructor(e,i,n,r,o,s,R){this.remoteAgentService=e;this.environmentService=i;this.userDataProfileService=n;this.remoteUserDataProfilesService=r;this.activeLanguagePackService=o;this.extensionManagementService=s;this.logService=R}whenExtensionsReady(){return this.withChannel(e=>e.call("whenExtensionsReady"),void 0)}async scanExtensions(){try{const e=await this.activeLanguagePackService.getExtensionIdProvidingCurrentLocale();return await this.withChannel(async i=>{const n=this.userDataProfileService.currentProfile.isDefault?void 0:(await this.remoteUserDataProfilesService.getRemoteProfile(this.userDataProfileService.currentProfile)).extensionsResource,r=await i.call("scanExtensions",[f.language,n,this.extensionManagementService.getInstalledWorkspaceExtensionLocations(),this.environmentService.extensionDevelopmentLocationURI,e]);return r.forEach(o=>{o.extensionLocation=g.revive(o.extensionLocation)}),r},[])}catch(e){return this.logService.error(e),[]}}withChannel(e,i){const n=this.remoteAgentService.getConnection();return n?n.withChannel(I,r=>e(r)):Promise.resolve(i)}};c=m([t(0,y),t(1,d),t(2,E),t(3,D),t(4,x),t(5,P),t(6,S)],c),h(u,c,p.Delayed);
