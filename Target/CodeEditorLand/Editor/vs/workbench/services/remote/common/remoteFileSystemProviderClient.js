import{getErrorMessage as a}from"../../../../../vs/base/common/errors.js";import{Disposable as p,DisposableStore as v}from"../../../../../vs/base/common/lifecycle.js";import{Schemas as s}from"../../../../../vs/base/common/network.js";import{OperatingSystem as g}from"../../../../../vs/base/common/platform.js";import{DiskFileSystemProviderClient as l}from"../../../../../vs/platform/files/common/diskFileSystemProviderClient.js";import"../../../../../vs/platform/files/common/files.js";import"../../../../../vs/platform/log/common/log.js";import"../../../../../vs/platform/remote/common/remoteAgentEnvironment.js";import"../../../../../vs/workbench/services/remote/common/remoteAgentService.js";const d="remoteFilesystem";class m extends l{static register(o,t,n){const i=o.getConnection();if(!i)return p.None;const r=new v,c=(async()=>{try{const e=await o.getRawEnvironment();e?t.registerProvider(s.vscodeRemote,r.add(new m(e,i))):n.error("Cannot register remote filesystem provider. Remote environment doesnot exist.")}catch(e){n.error("Cannot register remote filesystem provider. Error while fetching remote environment.",a(e))}})();return r.add(t.onWillActivateFileSystemProvider(e=>{e.scheme===s.vscodeRemote&&e.join(c)})),r}constructor(o,t){super(t.getChannel(d),{pathCaseSensitive:o.os===g.Linux})}}export{d as REMOTE_FILE_SYSTEM_CHANNEL_NAME,m as RemoteFileSystemProviderClient};
