var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var S=(c,o,r,i)=>{for(var t=i>1?void 0:i?y(o,r):o,n=c.length-1,m;n>=0;n--)(m=c[n])&&(t=(i?m(o,r,t):m(t))||t);return i&&t&&g(o,r,t),t},e=(c,o)=>(r,i)=>o(r,i,c);import{URI as R}from"../../../../../vs/base/common/uri.js";import*as a from"../../../../../vs/nls.js";import{ILogService as b}from"../../../../../vs/platform/log/common/log.js";import{INativeHostService as d}from"../../../../../vs/platform/native/common/native.js";import{INotificationService as A,Severity as k}from"../../../../../vs/platform/notification/common/notification.js";import{IOpenerService as T}from"../../../../../vs/platform/opener/common/opener.js";import{IProductService as E}from"../../../../../vs/platform/product/common/productService.js";import{IRemoteAuthorityResolverService as u,RemoteAuthorityResolverError as D,RemoteConnectionType as U}from"../../../../../vs/platform/remote/common/remoteAuthorityResolver.js";import{IRemoteSocketFactoryService as W}from"../../../../../vs/platform/remote/common/remoteSocketFactoryService.js";import{ISignService as P}from"../../../../../vs/platform/sign/common/sign.js";import{ITelemetryService as _}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{registerWorkbenchContribution2 as L,WorkbenchPhase as x}from"../../../../../vs/workbench/common/contributions.js";import{IWorkbenchEnvironmentService as f}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{AbstractRemoteAgentService as C}from"../../../../../vs/workbench/services/remote/common/abstractRemoteAgentService.js";import{IRemoteAgentService as O}from"../../../../../vs/workbench/services/remote/common/remoteAgentService.js";import{IUserDataProfileService as w}from"../../../../../vs/workbench/services/userDataProfile/common/userDataProfile.js";let s=class extends C{constructor(o,r,i,t,n,m,l){super(o,r,i,t,n,m,l)}};s=S([e(0,W),e(1,w),e(2,f),e(3,E),e(4,u),e(5,P),e(6,b)],s);let v=class{constructor(o,r,i,t,n,m,l){this._remoteAgentService=o;this._remoteAuthorityResolverService=m;this._remoteAgentService.getRawEnvironment().then(void 0,p=>{if(!D.isHandled(p)){const h=[{label:a.localize("devTools","Open Developer Tools"),run:()=>n.openDevTools()}],I=this._getTroubleshootingURL();I&&h.push({label:a.localize("directUrl","Open in browser"),run:()=>l.open(I,{openExternal:!0})}),r.prompt(k.Error,a.localize("connectionError","Failed to connect to the remote extension host server (Error: {0})",p?p.message:""),h)}})}static ID="workbench.contrib.nativeRemoteConnectionFailureNotification";_getTroubleshootingURL(){const o=this._remoteAgentService.getConnection();if(!o)return null;const r=this._remoteAuthorityResolverService.getConnectionData(o.remoteAuthority);return!r||r.connectTo.type!==U.WebSocket?null:R.from({scheme:"http",authority:`${r.connectTo.host}:${r.connectTo.port}`,path:"/version"})}};v=S([e(0,O),e(1,A),e(2,f),e(3,_),e(4,d),e(5,u),e(6,T)],v),L(v.ID,v,x.BlockRestore);export{s as RemoteAgentService};
