var p=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var u=(n,e,a,o)=>{for(var t=o>1?void 0:o?S(e,a):e,s=n.length-1,L;s>=0;s--)(L=n[s])&&(t=(o?L(e,a,t):L(t))||t);return o&&t&&p(e,a,t),t},l=(n,e)=>(a,o)=>e(a,o,n);import{localize as c}from"../../../../nls.js";import{Language as m,LANGUAGE_DEFAULT as I}from"../../../../base/common/platform.js";import{IDialogService as f}from"../../../../platform/dialogs/common/dialogs.js";import"../../../../platform/languagePacks/common/languagePacks.js";import{IActiveLanguagePackService as y,ILocaleService as h}from"../common/locale.js";import{IHostService as _}from"../../host/browser/host.js";import{IProductService as O}from"../../../../platform/product/common/productService.js";import{InstantiationType as v,registerSingleton as E}from"../../../../platform/instantiation/common/extensions.js";import{CancellationToken as A}from"../../../../base/common/cancellation.js";import{IExtensionGalleryService as C}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{ILogService as T}from"../../../../platform/log/common/log.js";const r=new class i{static LOCAL_STORAGE_LOCALE_KEY="vscode.nls.locale";static LOCAL_STORAGE_EXTENSION_ID_KEY="vscode.nls.languagePackExtensionId";setLocale(e){localStorage.setItem(i.LOCAL_STORAGE_LOCALE_KEY,e),this.doSetLocaleToCookie(e)}doSetLocaleToCookie(e){document.cookie=`${i.LOCAL_STORAGE_LOCALE_KEY}=${e};path=/;max-age=3153600000`}clearLocale(){localStorage.removeItem(i.LOCAL_STORAGE_LOCALE_KEY),this.doClearLocaleToCookie()}doClearLocaleToCookie(){document.cookie=`${i.LOCAL_STORAGE_LOCALE_KEY}=;path=/;max-age=0`}setExtensionId(e){localStorage.setItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY,e)}getExtensionId(){return localStorage.getItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY)}clearExtensionId(){localStorage.removeItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY)}};let d=class{constructor(e,a,o){this.dialogService=e;this.hostService=a;this.productService=o}async setLocale(e,a=!1){const o=e.id;if(o===m.value()||!o&&m.value()===navigator.language.toLowerCase())return;o?(r.setLocale(o),e.extensionId&&r.setExtensionId(e.extensionId)):(r.clearLocale(),r.clearExtensionId()),(await this.dialogService.confirm({type:"info",message:c("relaunchDisplayLanguageMessage","To change the display language, {0} needs to reload",this.productService.nameLong),detail:c("relaunchDisplayLanguageDetail","Press the reload button to refresh the page and set the display language to {0}.",e.label),primaryButton:c({key:"reload",comment:["&& denotes a mnemonic character"]},"&&Reload")})).confirmed&&this.hostService.restart()}async clearLocalePreference(){if(r.clearLocale(),r.clearExtensionId(),m.value()===navigator.language.toLowerCase())return;(await this.dialogService.confirm({type:"info",message:c("clearDisplayLanguageMessage","To change the display language, {0} needs to reload",this.productService.nameLong),detail:c("clearDisplayLanguageDetail","Press the reload button to refresh the page and use your browser's language."),primaryButton:c({key:"reload",comment:["&& denotes a mnemonic character"]},"&&Reload")})).confirmed&&this.hostService.restart()}};d=u([l(0,f),l(1,_),l(2,O)],d);let g=class{constructor(e,a){this.galleryService=e;this.logService=a}_serviceBrand;async getExtensionIdProvidingCurrentLocale(){const e=m.value();if(e===I)return;const a=r.getExtensionId();if(a)return a;if(this.galleryService.isEnabled())try{const t=(await this.galleryService.query({text:`tag:lp-${e}`},A.None)).firstPage.find(s=>s.publisher==="MS-CEINTL"&&s.name.startsWith("vscode-language-pack"));if(t)return r.setExtensionId(t.identifier.id),t.identifier.id}catch(o){this.logService.error(o)}}};g=u([l(0,C),l(1,T)],g),E(h,d,v.Delayed),E(y,g,v.Delayed);export{d as WebLocaleService};
