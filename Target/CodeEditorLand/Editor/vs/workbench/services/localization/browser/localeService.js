var E=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var L=(n,e,t,o)=>{for(var a=o>1?void 0:o?S(e,t):e,s=n.length-1,u;s>=0;s--)(u=n[s])&&(a=(o?u(e,t,a):u(a))||a);return o&&a&&E(e,t,a),a},l=(n,e)=>(t,o)=>e(t,o,n);import{CancellationToken as I}from"../../../../base/common/cancellation.js";import{LANGUAGE_DEFAULT as f,Language as m}from"../../../../base/common/platform.js";import{localize as c}from"../../../../nls.js";import{IDialogService as y}from"../../../../platform/dialogs/common/dialogs.js";import{IExtensionGalleryService as h}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{InstantiationType as v,registerSingleton as p}from"../../../../platform/instantiation/common/extensions.js";import{ILogService as _}from"../../../../platform/log/common/log.js";import{IProductService as O}from"../../../../platform/product/common/productService.js";import{IHostService as A}from"../../host/browser/host.js";import{IActiveLanguagePackService as C,ILocaleService as T}from"../common/locale.js";const r=new class i{static LOCAL_STORAGE_LOCALE_KEY="vscode.nls.locale";static LOCAL_STORAGE_EXTENSION_ID_KEY="vscode.nls.languagePackExtensionId";setLocale(e){localStorage.setItem(i.LOCAL_STORAGE_LOCALE_KEY,e),this.doSetLocaleToCookie(e)}doSetLocaleToCookie(e){document.cookie=`${i.LOCAL_STORAGE_LOCALE_KEY}=${e};path=/;max-age=3153600000`}clearLocale(){localStorage.removeItem(i.LOCAL_STORAGE_LOCALE_KEY),this.doClearLocaleToCookie()}doClearLocaleToCookie(){document.cookie=`${i.LOCAL_STORAGE_LOCALE_KEY}=;path=/;max-age=0`}setExtensionId(e){localStorage.setItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY,e)}getExtensionId(){return localStorage.getItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY)}clearExtensionId(){localStorage.removeItem(i.LOCAL_STORAGE_EXTENSION_ID_KEY)}};let d=class{constructor(e,t,o){this.dialogService=e;this.hostService=t;this.productService=o}async setLocale(e,t=!1){const o=e.id;if(o===m.value()||!o&&m.value()===navigator.language.toLowerCase())return;o?(r.setLocale(o),e.extensionId&&r.setExtensionId(e.extensionId)):(r.clearLocale(),r.clearExtensionId()),(await this.dialogService.confirm({type:"info",message:c("relaunchDisplayLanguageMessage","To change the display language, {0} needs to reload",this.productService.nameLong),detail:c("relaunchDisplayLanguageDetail","Press the reload button to refresh the page and set the display language to {0}.",e.label),primaryButton:c({key:"reload",comment:["&& denotes a mnemonic character"]},"&&Reload")})).confirmed&&this.hostService.restart()}async clearLocalePreference(){if(r.clearLocale(),r.clearExtensionId(),m.value()===navigator.language.toLowerCase())return;(await this.dialogService.confirm({type:"info",message:c("clearDisplayLanguageMessage","To change the display language, {0} needs to reload",this.productService.nameLong),detail:c("clearDisplayLanguageDetail","Press the reload button to refresh the page and use your browser's language."),primaryButton:c({key:"reload",comment:["&& denotes a mnemonic character"]},"&&Reload")})).confirmed&&this.hostService.restart()}};d=L([l(0,y),l(1,A),l(2,O)],d);let g=class{constructor(e,t){this.galleryService=e;this.logService=t}_serviceBrand;async getExtensionIdProvidingCurrentLocale(){const e=m.value();if(e===f)return;const t=r.getExtensionId();if(t)return t;if(this.galleryService.isEnabled())try{const a=(await this.galleryService.query({text:`tag:lp-${e}`},I.None)).firstPage.find(s=>s.publisher==="MS-CEINTL"&&s.name.startsWith("vscode-language-pack"));if(a)return r.setExtensionId(a.identifier.id),a.identifier.id}catch(o){this.logService.error(o)}}};g=L([l(0,h),l(1,_)],g),p(T,d,v.Delayed),p(C,g,v.Delayed);export{d as WebLocaleService};
