import{localize as a}from"../../../../nls.js";import{isLinux as s}from"../../../../base/common/platform.js";import{AbstractDiskFileSystemProvider as n}from"../../../../platform/files/common/diskFileSystemProvider.js";import{DiskFileSystemProviderClient as l,LOCAL_FILE_SYSTEM_CHANNEL_NAME as d}from"../../../../platform/files/common/diskFileSystemProviderClient.js";import{UniversalWatcherClient as p}from"./watcherClient.js";import{LogService as v}from"../../../../platform/log/common/logService.js";class ie extends n{constructor(e,i,r,t){super(r,{watcher:{forceUniversal:!0}});this.mainProcessService=e;this.utilityProcessWorkerWorkbenchService=i;this.loggerService=t;this.registerListeners()}provider=this._register(new l(this.mainProcessService.getChannel(d),{pathCaseSensitive:s,trash:!0}));registerListeners(){this._register(this.provider.onDidChangeFile(e=>this._onDidChangeFile.fire(e))),this._register(this.provider.onDidWatchError(e=>this._onDidWatchError.fire(e)))}get onDidChangeCapabilities(){return this.provider.onDidChangeCapabilities}get capabilities(){return this.provider.capabilities}stat(e){return this.provider.stat(e)}readdir(e){return this.provider.readdir(e)}readFile(e,i){return this.provider.readFile(e,i)}readFileStream(e,i,r){return this.provider.readFileStream(e,i,r)}writeFile(e,i,r){return this.provider.writeFile(e,i,r)}open(e,i){return this.provider.open(e,i)}close(e){return this.provider.close(e)}read(e,i,r,t,o){return this.provider.read(e,i,r,t,o)}write(e,i,r,t,o){return this.provider.write(e,i,r,t,o)}mkdir(e){return this.provider.mkdir(e)}delete(e,i){return this.provider.delete(e,i)}rename(e,i,r){return this.provider.rename(e,i,r)}copy(e,i,r){return this.provider.copy(e,i,r)}cloneFile(e,i){return this.provider.cloneFile(e,i)}createUniversalWatcher(e,i,r){return new p(t=>e(t),t=>i(t),r,this.utilityProcessWorkerWorkbenchService)}createNonRecursiveWatcher(){throw new Error("Method not implemented in sandbox.")}_watcherLogService=void 0;get watcherLogService(){return this._watcherLogService||(this._watcherLogService=new v(this.loggerService.createLogger("fileWatcher",{name:a("fileWatcher","File Watcher")}))),this._watcherLogService}logWatcherMessage(e){this.watcherLogService[e.type](e.message),e.type!=="trace"&&e.type!=="debug"&&super.logWatcherMessage(e)}}export{ie as DiskFileSystemProvider};
