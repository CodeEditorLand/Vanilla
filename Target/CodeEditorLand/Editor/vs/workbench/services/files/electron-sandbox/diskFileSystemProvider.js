import{localize as s}from"../../../../nls.js";import"../../../../base/common/event.js";import{isLinux as a}from"../../../../base/common/platform.js";import"../../../../platform/files/common/files.js";import{AbstractDiskFileSystemProvider as n}from"../../../../platform/files/common/diskFileSystemProvider.js";import"../../../../platform/ipc/common/mainProcessService.js";import"../../../../base/common/cancellation.js";import"../../../../base/common/stream.js";import"../../../../base/common/uri.js";import{DiskFileSystemProviderClient as l,LOCAL_FILE_SYSTEM_CHANNEL_NAME as d}from"../../../../platform/files/common/diskFileSystemProviderClient.js";import"../../../../platform/files/common/watcher.js";import{UniversalWatcherClient as p}from"./watcherClient.js";import"../../../../platform/log/common/log.js";import"../../utilityProcess/electron-sandbox/utilityProcessWorkerWorkbenchService.js";import{LogService as v}from"../../../../platform/log/common/logService.js";class re extends n{constructor(e,r,i,t){super(i,{watcher:{forceUniversal:!0}});this.mainProcessService=e;this.utilityProcessWorkerWorkbenchService=r;this.loggerService=t;this.registerListeners()}provider=this._register(new l(this.mainProcessService.getChannel(d),{pathCaseSensitive:a,trash:!0}));setUseNextWatcher(){this.options={watcher:{forceUniversal:!0,recursive:{useNext:!0,usePolling:!1}}}}registerListeners(){this._register(this.provider.onDidChangeFile(e=>this._onDidChangeFile.fire(e))),this._register(this.provider.onDidWatchError(e=>this._onDidWatchError.fire(e)))}get onDidChangeCapabilities(){return this.provider.onDidChangeCapabilities}get capabilities(){return this.provider.capabilities}stat(e){return this.provider.stat(e)}readdir(e){return this.provider.readdir(e)}readFile(e,r){return this.provider.readFile(e,r)}readFileStream(e,r,i){return this.provider.readFileStream(e,r,i)}writeFile(e,r,i){return this.provider.writeFile(e,r,i)}open(e,r){return this.provider.open(e,r)}close(e){return this.provider.close(e)}read(e,r,i,t,o){return this.provider.read(e,r,i,t,o)}write(e,r,i,t,o){return this.provider.write(e,r,i,t,o)}mkdir(e){return this.provider.mkdir(e)}delete(e,r){return this.provider.delete(e,r)}rename(e,r,i){return this.provider.rename(e,r,i)}copy(e,r,i){return this.provider.copy(e,r,i)}cloneFile(e,r){return this.provider.cloneFile(e,r)}createUniversalWatcher(e,r,i){return new p(t=>e(t),t=>r(t),i,this.utilityProcessWorkerWorkbenchService)}createNonRecursiveWatcher(){throw new Error("Method not implemented in sandbox.")}_watcherLogService=void 0;get watcherLogService(){return this._watcherLogService||(this._watcherLogService=new v(this.loggerService.createLogger("fileWatcher",{name:s("fileWatcher","File Watcher")}))),this._watcherLogService}logWatcherMessage(e){this.watcherLogService[e.type](e.message),e.type!=="trace"&&e.type!=="debug"&&super.logWatcherMessage(e)}}export{re as DiskFileSystemProvider};
