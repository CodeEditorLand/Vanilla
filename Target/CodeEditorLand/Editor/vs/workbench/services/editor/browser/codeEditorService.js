var v=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var E=(s,n,o,e)=>{for(var r=e>1?void 0:e?C(n,o):n,t=s.length-1,i;t>=0;t--)(i=s[t])&&(r=(e?i(n,o,r):i(r))||r);return e&&r&&v(n,o,r),r},c=(s,n)=>(o,e)=>n(o,e,s);import{isEqual as m}from"../../../../base/common/resources.js";import{getCodeEditor as u,isCodeEditor as l,isCompositeEditor as f,isDiffEditor as p}from"../../../../editor/browser/editorBrowser.js";import{AbstractCodeEditorService as g}from"../../../../editor/browser/services/abstractCodeEditorService.js";import{ICodeEditorService as I}from"../../../../editor/browser/services/codeEditorService.js";import{ScrollType as h}from"../../../../editor/common/editorCommon.js";import{IConfigurationService as S}from"../../../../platform/configuration/common/configuration.js";import{InstantiationType as b,registerSingleton as y}from"../../../../platform/instantiation/common/extensions.js";import{IThemeService as P}from"../../../../platform/theme/common/themeService.js";import{applyTextEditorOptions as T}from"../../../common/editor/editorOptions.js";import{ACTIVE_GROUP as O,IEditorService as x,SIDE_GROUP as w}from"../common/editorService.js";let a=class extends g{constructor(o,e,r){super(e);this.editorService=o;this.configurationService=r;this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const o=this.editorService.activeTextEditorControl;if(l(o))return o;if(p(o))return o.getModifiedEditor();const e=this.editorService.activeEditorPane?.getControl();return f(e)&&l(e.activeCodeEditor)?e.activeCodeEditor:null}async doOpenCodeEditorFromDiff(o,e,r){const t=this.editorService.activeTextEditorControl;if(!r&&p(t)&&o.options&&o.resource&&e===t.getModifiedEditor()&&t.getModel()&&m(o.resource,t.getModel()?.modified.uri)){const i=t.getModifiedEditor();return T(o.options,i,h.Smooth),i}return null}async doOpenCodeEditor(o,e,r){if(!this.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation&&e&&!o.options?.pinned&&!r&&!m(e.getModel()?.uri,o.resource)){for(const d of this.editorService.visibleEditorPanes)if(u(d.getControl())===e){d.group.pinEditor();break}}const i=await this.editorService.openEditor(o,r?w:O);if(i){const d=i.getControl();if(l(d))return d;if(f(d)&&l(d.activeCodeEditor))return d.activeCodeEditor}return null}};a=E([c(0,x),c(1,P),c(2,S)],a),y(I,a,b.Delayed);export{a as CodeEditorService};
