var p=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var E=(s,n,o,e)=>{for(var r=e>1?void 0:e?C(n,o):n,i=s.length-1,t;i>=0;i--)(t=s[i])&&(r=(e?t(n,o,r):t(r))||r);return e&&r&&p(n,o,r),r},c=(s,n)=>(o,e)=>n(o,e,s);import{isCodeEditor as l,isDiffEditor as f,isCompositeEditor as m,getCodeEditor as u}from"../../../../editor/browser/editorBrowser.js";import{AbstractCodeEditorService as g}from"../../../../editor/browser/services/abstractCodeEditorService.js";import{ScrollType as I}from"../../../../editor/common/editorCommon.js";import"../../../../platform/editor/common/editor.js";import{IThemeService as h}from"../../../../platform/theme/common/themeService.js";import"../../../common/editor.js";import{ACTIVE_GROUP as S,IEditorService as b,SIDE_GROUP as P}from"../common/editorService.js";import{ICodeEditorService as T}from"../../../../editor/browser/services/codeEditorService.js";import{InstantiationType as O,registerSingleton as x}from"../../../../platform/instantiation/common/extensions.js";import{isEqual as v}from"../../../../base/common/resources.js";import{IConfigurationService as y}from"../../../../platform/configuration/common/configuration.js";import{applyTextEditorOptions as w}from"../../../common/editor/editorOptions.js";let a=class extends g{constructor(o,e,r){super(e);this.editorService=o;this.configurationService=r;this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditor.bind(this))),this._register(this.registerCodeEditorOpenHandler(this.doOpenCodeEditorFromDiff.bind(this)))}getActiveCodeEditor(){const o=this.editorService.activeTextEditorControl;if(l(o))return o;if(f(o))return o.getModifiedEditor();const e=this.editorService.activeEditorPane?.getControl();return m(e)&&l(e.activeCodeEditor)?e.activeCodeEditor:null}async doOpenCodeEditorFromDiff(o,e,r){const i=this.editorService.activeTextEditorControl;if(!r&&f(i)&&o.options&&o.resource&&e===i.getModifiedEditor()&&i.getModel()&&v(o.resource,i.getModel()?.modified.uri)){const t=i.getModifiedEditor();return w(o.options,t,I.Smooth),t}return null}async doOpenCodeEditor(o,e,r){if(!this.configurationService.getValue().workbench?.editor?.enablePreviewFromCodeNavigation&&e&&!o.options?.pinned&&!r&&!v(e.getModel()?.uri,o.resource)){for(const d of this.editorService.visibleEditorPanes)if(u(d.getControl())===e){d.group.pinEditor();break}}const t=await this.editorService.openEditor(o,r?P:S);if(t){const d=t.getControl();if(l(d))return d;if(m(d)&&l(d.activeCodeEditor))return d.activeCodeEditor}return null}};a=E([c(0,b),c(1,h),c(2,y)],a),x(T,a,O.Delayed);export{a as CodeEditorService};
