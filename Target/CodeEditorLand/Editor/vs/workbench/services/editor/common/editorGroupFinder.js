import{IConfigurationService as v}from"../../../../platform/configuration/common/configuration.js";import{EditorActivation as l}from"../../../../platform/editor/common/editor.js";import{EditorInputCapabilities as O,isEditorInput as m,isEditorInputWithOptions as P}from"../../../common/editor.js";import{GroupsOrder as E,IEditorGroupsService as U,preferredSideBySideGroupDirection as I}from"./editorGroupsService.js";import{AUX_WINDOW_GROUP as y,SIDE_GROUP as a}from"./editorService.js";function S(o,t,i){const p=o.get(U),r=o.get(v),d=W(t,i,p,r);return d instanceof Promise?d.then(u=>G(u,t,i,p)):G(d,t,i,p)}function G(o,t,i,p){let r;return p.activeGroup!==o&&t.options&&!t.options.inactive&&t.options.preserveFocus&&typeof t.options.activation!="number"&&i!==a&&(r=l.ACTIVATE),[o,r]}function W(o,t,i,p){let r;const d=P(o)?o.editor:o,u=o.options;if(t&&typeof t!="number")r=t;else if(typeof t=="number"&&t>=0)r=i.getGroup(t);else if(t===a){const n=I(p);let e=i.findGroup({direction:n});(!e||f(e,d))&&(e=i.addGroup(i.activeGroup,n)),r=e}else if(t===y)r=i.createAuxiliaryEditorPart().then(n=>n.activeGroup);else if(!u||typeof u.index!="number"){const n=i.getGroups(E.MOST_RECENTLY_ACTIVE);if(u?.revealIfVisible){for(const e of n)if(_(e,d)){r=e;break}}if(!r&&(u?.revealIfOpened||p.getValue("workbench.editor.revealIfOpen")||m(d)&&d.hasCapability(O.Singleton))){let e,s;for(const c of n)if(A(c,d)&&(s||(s=c),!e&&c.isActive(d)&&(e=c)),s&&e)break;r=e||s}}if(!r){let n=i.activeGroup;if(f(n,d)){for(const e of i.getGroups(E.MOST_RECENTLY_ACTIVE))if(!f(e,d)){n=e;break}f(n,d)?r=i.addGroup(n,I(p)):r=n}else r=n}return r}function f(o,t){return!(!o.isLocked||A(o,t))}function _(o,t){return o.activeEditor?o.activeEditor.matches(t):!1}function A(o,t){for(const i of o.editors)if(i.matches(t))return!0;return!1}export{S as findGroup};
