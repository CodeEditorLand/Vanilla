import e from"assert";import{DisposableStore as m}from"../../../../../base/common/lifecycle.js";import{URI as i}from"../../../../../base/common/uri.js";import{ensureNoDisposablesAreLeakedInTestSuite as u}from"../../../../../base/test/common/utils.js";import{ConfigurationTarget as d,IConfigurationService as g}from"../../../../../platform/configuration/common/configuration.js";import{TestConfigurationService as E}from"../../../../../platform/configuration/test/common/testConfigurationService.js";import{CustomEditorLabelService as o}from"../../common/customEditorLabelService.js";import{TestServiceAccessor as N,workbenchInstantiationService as $}from"../../../../test/browser/workbenchTestServices.js";suite("Custom Editor Label Service",()=>{const x=new m;setup(()=>{}),teardown(async()=>{x.clear()}),u();async function l(t=$(void 0,x)){const s=new E;return await s.setUserConfiguration(o.SETTING_ID_ENABLED,!0),t.stub(g,s),[x.add(t.createInstance(o)),s,t.createInstance(N)]}async function f(t,s){await t.setUserConfiguration(o.SETTING_ID_PATTERNS,s),t.onDidChangeConfigurationEmitter.fire({affectsConfiguration:a=>a===o.SETTING_ID_PATTERNS,source:d.USER,affectedKeys:new Set(o.SETTING_ID_PATTERNS),change:{keys:[],overrides:[]}})}test("Custom Labels: filename.extname",async()=>{const[t,s]=await l();await f(s,{"**":"${filename}.${extname}"});const a=["file.txt","file.txt1.tx2",".file.txt"];for(const n of a){const c=t.getName(i.file(n));e.strictEqual(c,n)}let r=t.getName(i.file("file"));e.strictEqual(r,"file.${extname}"),r=t.getName(i.file(".file")),e.strictEqual(r,".file.${extname}")}),test("Custom Labels: filename",async()=>{const[t,s]=await l();await f(s,{"**":"${filename}"}),e.strictEqual(t.getName(i.file("file")),"file"),e.strictEqual(t.getName(i.file("file.txt")),"file"),e.strictEqual(t.getName(i.file("file.txt1.txt2")),"file"),e.strictEqual(t.getName(i.file("folder/file.txt1.txt2")),"file"),e.strictEqual(t.getName(i.file(".file")),".file"),e.strictEqual(t.getName(i.file(".file.txt")),".file"),e.strictEqual(t.getName(i.file(".file.txt1.txt2")),".file"),e.strictEqual(t.getName(i.file("folder/.file.txt1.txt2")),".file")}),test("Custom Labels: extname(N)",async()=>{const[t,s]=await l();await f(s,{"**/ext/**":"${extname}","**/ext0/**":"${extname(0)}","**/ext1/**":"${extname(1)}","**/ext2/**":"${extname(2)}","**/extMinus1/**":"${extname(-1)}","**/extMinus2/**":"${extname(-2)}"});function a(r,n){e.strictEqual(t.getName(i.file(`test/ext/${r}`)),n.extname??"${extname}",r),e.strictEqual(t.getName(i.file(`test/ext0/${r}`)),n.ext0??"${extname(0)}",r),e.strictEqual(t.getName(i.file(`test/ext1/${r}`)),n.ext1??"${extname(1)}",r),e.strictEqual(t.getName(i.file(`test/ext2/${r}`)),n.ext2??"${extname(2)}",r),e.strictEqual(t.getName(i.file(`test/extMinus1/${r}`)),n.extMinus1??"${extname(-1)}",r),e.strictEqual(t.getName(i.file(`test/extMinus2/${r}`)),n.extMinus2??"${extname(-2)}",r)}a("file.txt",{extname:"txt",ext0:"txt",extMinus1:"txt"}),a("file.txt1.txt2",{extname:"txt1.txt2",ext0:"txt2",ext1:"txt1",extMinus1:"txt1",extMinus2:"txt2"}),a(".file.txt1.txt2",{extname:"txt1.txt2",ext0:"txt2",ext1:"txt1",extMinus1:"txt1",extMinus2:"txt2"}),a(".file.txt1.txt2.txt3.txt4",{extname:"txt1.txt2.txt3.txt4",ext0:"txt4",ext1:"txt3",ext2:"txt2",extMinus1:"txt1",extMinus2:"txt2"}),a("file",{}),a(".file",{})}),test("Custom Labels: dirname(N)",async()=>{const[t,s]=await l();await f(s,{"**":"${dirname},${dirname(0)},${dirname(1)},${dirname(2)},${dirname(-1)},${dirname(-2)}"});function a(r,n){e.strictEqual(t.getName(i.file(r))?.split(",")[0],n.dirname??"${dirname}",r),e.strictEqual(t.getName(i.file(r))?.split(",")[1],n.dir0??"${dirname(0)}",r),e.strictEqual(t.getName(i.file(r))?.split(",")[2],n.dir1??"${dirname(1)}",r),e.strictEqual(t.getName(i.file(r))?.split(",")[3],n.dir2??"${dirname(2)}",r),e.strictEqual(t.getName(i.file(r))?.split(",")[4],n.dirMinus1??"${dirname(-1)}",r),e.strictEqual(t.getName(i.file(r))?.split(",")[5],n.dirMinus2??"${dirname(-2)}",r)}a("folder/file.txt",{dirname:"folder",dir0:"folder",dirMinus1:"folder"}),a("root/folder/file.txt",{dirname:"folder",dir0:"folder",dir1:"root",dirMinus1:"root",dirMinus2:"folder"}),a("root/.folder/file.txt",{dirname:".folder",dir0:".folder",dir1:"root",dirMinus1:"root",dirMinus2:".folder"}),a("root/parent/folder/file.txt",{dirname:"folder",dir0:"folder",dir1:"parent",dir2:"root",dirMinus1:"root",dirMinus2:"parent"}),a("file.txt",{})}),test("Custom Labels: no pattern match",async()=>{const[t,s]=await l();await f(s,{"**/folder/**":"folder",file:"file"}),e.strictEqual(t.getName(i.file("file")),void 0),e.strictEqual(t.getName(i.file("file.txt")),void 0),e.strictEqual(t.getName(i.file("file.txt1.txt2")),void 0),e.strictEqual(t.getName(i.file("folder1/file.txt1.txt2")),void 0),e.strictEqual(t.getName(i.file(".file")),void 0),e.strictEqual(t.getName(i.file(".file.txt")),void 0),e.strictEqual(t.getName(i.file(".file.txt1.txt2")),void 0),e.strictEqual(t.getName(i.file("folder1/file.txt1.txt2")),void 0)})});
