var u=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var A=(d,r,e,n)=>{for(var t=n>1?void 0:n?v(r,e):r,s=d.length-1,i;s>=0;s--)(i=d[s])&&(t=(n?i(r,e,t):i(t))||t);return n&&t&&u(r,e,t),t},l=(d,r)=>(e,n)=>r(e,n,d);import{Emitter as x}from"../../../../../vs/base/common/event.js";import{Disposable as E}from"../../../../../vs/base/common/lifecycle.js";import{InstantiationType as p,registerSingleton as S}from"../../../../../vs/platform/instantiation/common/extensions.js";import{createDecorator as f}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IProductService as m}from"../../../../../vs/platform/product/common/productService.js";import{IStorageService as w,StorageScope as g,StorageTarget as h}from"../../../../../vs/platform/storage/common/storage.js";import"../../../../../vs/workbench/services/authentication/common/authentication.js";const I=f("IAuthenticationAccessService");let c=class extends E{constructor(e,n){super();this._storageService=e;this._productService=n}_serviceBrand;_onDidChangeExtensionSessionAccess=this._register(new x);onDidChangeExtensionSessionAccess=this._onDidChangeExtensionSessionAccess.event;isAccessAllowed(e,n,t){const s=this._productService.trustedExtensionAuthAccess;if(Array.isArray(s)){if(s.includes(t))return!0}else if(s?.[e]?.includes(t))return!0;const o=this.readAllowedExtensions(e,n).find(a=>a.id===t);if(o)return o.allowed!==void 0?o.allowed:!0}readAllowedExtensions(e,n){let t=[];try{const s=this._storageService.get(`${e}-${n}`,g.APPLICATION);s&&(t=JSON.parse(s))}catch{}return t}updateAllowedExtensions(e,n,t){const s=this.readAllowedExtensions(e,n);for(const i of t){const o=s.findIndex(a=>a.id===i.id);o===-1?s.push(i):s[o].allowed=i.allowed}this._storageService.store(`${e}-${n}`,JSON.stringify(s),g.APPLICATION,h.USER),this._onDidChangeExtensionSessionAccess.fire({providerId:e,accountName:n})}removeAllowedExtensions(e,n){this._storageService.remove(`${e}-${n}`,g.APPLICATION),this._onDidChangeExtensionSessionAccess.fire({providerId:e,accountName:n})}};c=A([l(0,w),l(1,m)],c),S(I,c,p.Delayed);export{c as AuthenticationAccessService,I as IAuthenticationAccessService};
