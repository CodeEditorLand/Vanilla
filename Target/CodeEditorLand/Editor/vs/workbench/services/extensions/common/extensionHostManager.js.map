{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/extensions/common/extensionHostManager.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IntervalTimer } from \"../../../../base/common/async.js\";\nimport { VSBuffer } from \"../../../../base/common/buffer.js\";\nimport * as errors from \"../../../../base/common/errors.js\";\nimport { Emitter, type Event } from \"../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport { StopWatch } from \"../../../../base/common/stopwatch.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport type { IMessagePassingProtocol } from \"../../../../base/parts/ipc/common/ipc.js\";\nimport * as nls from \"../../../../nls.js\";\nimport { Categories } from \"../../../../platform/action/common/actionCommonCategories.js\";\nimport {\n\tAction2,\n\tregisterAction2,\n} from \"../../../../platform/actions/common/actions.js\";\nimport type {\n\tExtensionIdentifier,\n\tIExtensionDescription,\n} from \"../../../../platform/extensions/common/extensions.js\";\nimport {\n\tIInstantiationService,\n\ttype ServicesAccessor,\n} from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport {\n\tRemoteAuthorityResolverErrorCode,\n\tgetRemoteAuthorityPrefix,\n} from \"../../../../platform/remote/common/remoteAuthorityResolver.js\";\nimport { ITelemetryService } from \"../../../../platform/telemetry/common/telemetry.js\";\nimport { IEditorService } from \"../../editor/common/editorService.js\";\nimport { IWorkbenchEnvironmentService } from \"../../environment/common/environmentService.js\";\nimport {\n\tExtHostCustomersRegistry,\n\ttype IInternalExtHostContext,\n} from \"./extHostCustomers.js\";\nimport {\n\ttype ExtensionHostKind,\n\textensionHostKindToString,\n} from \"./extensionHostKind.js\";\nimport type { IExtensionHostManager } from \"./extensionHostManagers.js\";\nimport type { IExtensionDescriptionDelta } from \"./extensionHostProtocol.js\";\nimport type {\n\tIExtensionHostProxy,\n\tIResolveAuthorityResult,\n} from \"./extensionHostProxy.js\";\nimport type { ExtensionRunningLocation } from \"./extensionRunningLocation.js\";\nimport {\n\tActivationKind,\n\ttype ExtensionActivationReason,\n\ttype ExtensionHostStartup,\n\ttype IExtensionHost,\n\ttype IInternalExtensionService,\n} from \"./extensions.js\";\nimport type { Proxied, ProxyIdentifier } from \"./proxyIdentifier.js\";\nimport {\n\ttype IRPCProtocolLogger,\n\tRPCProtocol,\n\tRequestInitiator,\n\ttype ResponsiveState,\n} from \"./rpcProtocol.js\";\n\n// Enable to see detailed message communication between window and extension host\nconst LOG_EXTENSION_HOST_COMMUNICATION = false;\nconst LOG_USE_COLORS = true;\n\ntype ExtensionHostStartupClassification = {\n\towner: \"alexdima\";\n\tcomment: \"The startup state of the extension host\";\n\ttime: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The time reported by Date.now().\";\n\t};\n\taction: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The action: starting, success or error.\";\n\t};\n\tkind: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The extension host kind: LocalProcess, LocalWebWorker or Remote.\";\n\t};\n\terrorName?: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The error name.\";\n\t};\n\terrorMessage?: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The error message.\";\n\t};\n\terrorStack?: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The error stack.\";\n\t};\n};\n\ntype ExtensionHostStartupEvent = {\n\ttime: number;\n\taction: \"starting\" | \"success\" | \"error\";\n\tkind: string;\n\terrorName?: string;\n\terrorMessage?: string;\n\terrorStack?: string;\n};\n\nexport class ExtensionHostManager\n\textends Disposable\n\timplements IExtensionHostManager\n{\n\tpublic readonly onDidExit: Event<[number, string | null]>;\n\n\tprivate readonly _onDidChangeResponsiveState: Emitter<ResponsiveState> =\n\t\tthis._register(new Emitter<ResponsiveState>());\n\tpublic readonly onDidChangeResponsiveState: Event<ResponsiveState> =\n\t\tthis._onDidChangeResponsiveState.event;\n\n\t/**\n\t * A map of already requested activation events to speed things up if the same activation event is triggered multiple times.\n\t */\n\tprivate readonly _cachedActivationEvents: Map<string, Promise<void>>;\n\tprivate readonly _resolvedActivationEvents: Set<string>;\n\tprivate _rpcProtocol: RPCProtocol | null;\n\tprivate readonly _customers: IDisposable[];\n\tprivate readonly _extensionHost: IExtensionHost;\n\tprivate _proxy: Promise<IExtensionHostProxy | null> | null;\n\tprivate _hasStarted = false;\n\n\tpublic get pid(): number | null {\n\t\treturn this._extensionHost.pid;\n\t}\n\n\tpublic get kind(): ExtensionHostKind {\n\t\treturn this._extensionHost.runningLocation.kind;\n\t}\n\n\tpublic get startup(): ExtensionHostStartup {\n\t\treturn this._extensionHost.startup;\n\t}\n\n\tpublic get friendyName(): string {\n\t\treturn friendlyExtHostName(this.kind, this.pid);\n\t}\n\n\tconstructor(\n\t\textensionHost: IExtensionHost,\n\t\tinitialActivationEvents: string[],\n\t\tprivate readonly _internalExtensionService: IInternalExtensionService,\n\t\t@IInstantiationService\n\t\tprivate readonly _instantiationService: IInstantiationService,\n\t\t@IWorkbenchEnvironmentService\n\t\tprivate readonly _environmentService: IWorkbenchEnvironmentService,\n\t\t@ITelemetryService\n\t\tprivate readonly _telemetryService: ITelemetryService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._cachedActivationEvents = new Map<string, Promise<void>>();\n\t\tthis._resolvedActivationEvents = new Set<string>();\n\t\tthis._rpcProtocol = null;\n\t\tthis._customers = [];\n\n\t\tthis._extensionHost = extensionHost;\n\t\tthis.onDidExit = this._extensionHost.onExit;\n\n\t\tconst startingTelemetryEvent: ExtensionHostStartupEvent = {\n\t\t\ttime: Date.now(),\n\t\t\taction: \"starting\",\n\t\t\tkind: extensionHostKindToString(this.kind),\n\t\t};\n\t\tthis._telemetryService.publicLog2<\n\t\t\tExtensionHostStartupEvent,\n\t\t\tExtensionHostStartupClassification\n\t\t>(\"extensionHostStartup\", startingTelemetryEvent);\n\n\t\tthis._proxy = this._extensionHost.start().then(\n\t\t\t(protocol) => {\n\t\t\t\tthis._hasStarted = true;\n\n\t\t\t\t// Track healthy extension host startup\n\t\t\t\tconst successTelemetryEvent: ExtensionHostStartupEvent = {\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\taction: \"success\",\n\t\t\t\t\tkind: extensionHostKindToString(this.kind),\n\t\t\t\t};\n\t\t\t\tthis._telemetryService.publicLog2<\n\t\t\t\t\tExtensionHostStartupEvent,\n\t\t\t\t\tExtensionHostStartupClassification\n\t\t\t\t>(\"extensionHostStartup\", successTelemetryEvent);\n\n\t\t\t\treturn this._createExtensionHostCustomers(this.kind, protocol);\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tthis._logService.error(\n\t\t\t\t\t`Error received from starting extension host (kind: ${extensionHostKindToString(this.kind)})`,\n\t\t\t\t);\n\t\t\t\tthis._logService.error(err);\n\n\t\t\t\t// Track errors during extension host startup\n\t\t\t\tconst failureTelemetryEvent: ExtensionHostStartupEvent = {\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t\taction: \"error\",\n\t\t\t\t\tkind: extensionHostKindToString(this.kind),\n\t\t\t\t};\n\n\t\t\t\tif (err && err.name) {\n\t\t\t\t\tfailureTelemetryEvent.errorName = err.name;\n\t\t\t\t}\n\t\t\t\tif (err && err.message) {\n\t\t\t\t\tfailureTelemetryEvent.errorMessage = err.message;\n\t\t\t\t}\n\t\t\t\tif (err && err.stack) {\n\t\t\t\t\tfailureTelemetryEvent.errorStack = err.stack;\n\t\t\t\t}\n\t\t\t\tthis._telemetryService.publicLog2<\n\t\t\t\t\tExtensionHostStartupEvent,\n\t\t\t\t\tExtensionHostStartupClassification\n\t\t\t\t>(\"extensionHostStartup\", failureTelemetryEvent);\n\n\t\t\t\treturn null;\n\t\t\t},\n\t\t);\n\t\tthis._proxy.then(() => {\n\t\t\tinitialActivationEvents.forEach((activationEvent) =>\n\t\t\t\tthis.activateByEvent(activationEvent, ActivationKind.Normal),\n\t\t\t);\n\t\t\tthis._register(\n\t\t\t\tregisterLatencyTestProvider({\n\t\t\t\t\tmeasure: () => this.measure(),\n\t\t\t\t}),\n\t\t\t);\n\t\t});\n\t}\n\n\tpublic async disconnect(): Promise<void> {\n\t\tawait this._extensionHost?.disconnect?.();\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._extensionHost?.dispose();\n\t\tthis._rpcProtocol?.dispose();\n\n\t\tfor (let i = 0, len = this._customers.length; i < len; i++) {\n\t\t\tconst customer = this._customers[i];\n\t\t\ttry {\n\t\t\t\tcustomer.dispose();\n\t\t\t} catch (err) {\n\t\t\t\terrors.onUnexpectedError(err);\n\t\t\t}\n\t\t}\n\t\tthis._proxy = null;\n\n\t\tsuper.dispose();\n\t}\n\n\tprivate async measure(): Promise<ExtHostLatencyResult | null> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\treturn null;\n\t\t}\n\t\tconst latency = await this._measureLatency(proxy);\n\t\tconst down = await this._measureDown(proxy);\n\t\tconst up = await this._measureUp(proxy);\n\t\treturn {\n\t\t\tremoteAuthority: this._extensionHost.remoteAuthority,\n\t\t\tlatency,\n\t\t\tdown,\n\t\t\tup,\n\t\t};\n\t}\n\n\tpublic async ready(): Promise<void> {\n\t\tawait this._proxy;\n\t}\n\n\tprivate async _measureLatency(proxy: IExtensionHostProxy): Promise<number> {\n\t\tconst COUNT = 10;\n\n\t\tlet sum = 0;\n\t\tfor (let i = 0; i < COUNT; i++) {\n\t\t\tconst sw = StopWatch.create();\n\t\t\tawait proxy.test_latency(i);\n\t\t\tsw.stop();\n\t\t\tsum += sw.elapsed();\n\t\t}\n\t\treturn sum / COUNT;\n\t}\n\n\tprivate static _convert(byteCount: number, elapsedMillis: number): number {\n\t\treturn (byteCount * 1000 * 8) / elapsedMillis;\n\t}\n\n\tprivate async _measureUp(proxy: IExtensionHostProxy): Promise<number> {\n\t\tconst SIZE = 10 * 1024 * 1024; // 10MB\n\n\t\tconst buff = VSBuffer.alloc(SIZE);\n\t\tconst value = Math.ceil(Math.random() * 256);\n\t\tfor (let i = 0; i < buff.byteLength; i++) {\n\t\t\tbuff.writeUInt8(i, value);\n\t\t}\n\t\tconst sw = StopWatch.create();\n\t\tawait proxy.test_up(buff);\n\t\tsw.stop();\n\t\treturn ExtensionHostManager._convert(SIZE, sw.elapsed());\n\t}\n\n\tprivate async _measureDown(proxy: IExtensionHostProxy): Promise<number> {\n\t\tconst SIZE = 10 * 1024 * 1024; // 10MB\n\n\t\tconst sw = StopWatch.create();\n\t\tawait proxy.test_down(SIZE);\n\t\tsw.stop();\n\t\treturn ExtensionHostManager._convert(SIZE, sw.elapsed());\n\t}\n\n\tprivate _createExtensionHostCustomers(\n\t\tkind: ExtensionHostKind,\n\t\tprotocol: IMessagePassingProtocol,\n\t): IExtensionHostProxy {\n\t\tlet logger: IRPCProtocolLogger | null = null;\n\t\tif (\n\t\t\tLOG_EXTENSION_HOST_COMMUNICATION ||\n\t\t\tthis._environmentService.logExtensionHostCommunication\n\t\t) {\n\t\t\tlogger = new RPCLogger(kind);\n\t\t} else if (TelemetryRPCLogger.isEnabled()) {\n\t\t\tlogger = new TelemetryRPCLogger(this._telemetryService);\n\t\t}\n\n\t\tthis._rpcProtocol = new RPCProtocol(protocol, logger);\n\t\tthis._register(\n\t\t\tthis._rpcProtocol.onDidChangeResponsiveState(\n\t\t\t\t(responsiveState: ResponsiveState) =>\n\t\t\t\t\tthis._onDidChangeResponsiveState.fire(responsiveState),\n\t\t\t),\n\t\t);\n\t\tlet extensionHostProxy: IExtensionHostProxy | null =\n\t\t\tnull as IExtensionHostProxy | null;\n\t\tlet mainProxyIdentifiers: ProxyIdentifier<any>[] = [];\n\t\tconst extHostContext: IInternalExtHostContext = {\n\t\t\tremoteAuthority: this._extensionHost.remoteAuthority,\n\t\t\textensionHostKind: this.kind,\n\t\t\tgetProxy: <T>(identifier: ProxyIdentifier<T>): Proxied<T> =>\n\t\t\t\tthis._rpcProtocol!.getProxy(identifier),\n\t\t\tset: <T, R extends T>(\n\t\t\t\tidentifier: ProxyIdentifier<T>,\n\t\t\t\tinstance: R,\n\t\t\t): R => this._rpcProtocol!.set(identifier, instance),\n\t\t\tdispose: (): void => this._rpcProtocol!.dispose(),\n\t\t\tassertRegistered: (identifiers: ProxyIdentifier<any>[]): void =>\n\t\t\t\tthis._rpcProtocol!.assertRegistered(identifiers),\n\t\t\tdrain: (): Promise<void> => this._rpcProtocol!.drain(),\n\n\t\t\t//#region internal\n\t\t\tinternalExtensionService: this._internalExtensionService,\n\t\t\t_setExtensionHostProxy: (value: IExtensionHostProxy): void => {\n\t\t\t\textensionHostProxy = value;\n\t\t\t},\n\t\t\t_setAllMainProxyIdentifiers: (\n\t\t\t\tvalue: ProxyIdentifier<any>[],\n\t\t\t): void => {\n\t\t\t\tmainProxyIdentifiers = value;\n\t\t\t},\n\t\t\t//#endregion\n\t\t};\n\n\t\t// Named customers\n\t\tconst namedCustomers = ExtHostCustomersRegistry.getNamedCustomers();\n\t\tfor (let i = 0, len = namedCustomers.length; i < len; i++) {\n\t\t\tconst [id, ctor] = namedCustomers[i];\n\t\t\ttry {\n\t\t\t\tconst instance = this._instantiationService.createInstance(\n\t\t\t\t\tctor,\n\t\t\t\t\textHostContext,\n\t\t\t\t);\n\t\t\t\tthis._customers.push(instance);\n\t\t\t\tthis._rpcProtocol.set(id, instance);\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error(\n\t\t\t\t\t`Cannot instantiate named customer: '${id.sid}'`,\n\t\t\t\t);\n\t\t\t\tthis._logService.error(err);\n\t\t\t\terrors.onUnexpectedError(err);\n\t\t\t}\n\t\t}\n\n\t\t// Customers\n\t\tconst customers = ExtHostCustomersRegistry.getCustomers();\n\t\tfor (const ctor of customers) {\n\t\t\ttry {\n\t\t\t\tconst instance = this._instantiationService.createInstance(\n\t\t\t\t\tctor,\n\t\t\t\t\textHostContext,\n\t\t\t\t);\n\t\t\t\tthis._customers.push(instance);\n\t\t\t} catch (err) {\n\t\t\t\tthis._logService.error(err);\n\t\t\t\terrors.onUnexpectedError(err);\n\t\t\t}\n\t\t}\n\n\t\tif (!extensionHostProxy) {\n\t\t\tthrow new Error(`Missing IExtensionHostProxy!`);\n\t\t}\n\n\t\t// Check that no named customers are missing\n\t\tthis._rpcProtocol.assertRegistered(mainProxyIdentifiers);\n\n\t\treturn extensionHostProxy;\n\t}\n\n\tpublic async activate(\n\t\textension: ExtensionIdentifier,\n\t\treason: ExtensionActivationReason,\n\t): Promise<boolean> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\treturn false;\n\t\t}\n\t\treturn proxy.activate(extension, reason);\n\t}\n\n\tpublic activateByEvent(\n\t\tactivationEvent: string,\n\t\tactivationKind: ActivationKind,\n\t): Promise<void> {\n\t\tif (activationKind === ActivationKind.Immediate && !this._hasStarted) {\n\t\t\treturn Promise.resolve();\n\t\t}\n\n\t\tif (!this._cachedActivationEvents.has(activationEvent)) {\n\t\t\tthis._cachedActivationEvents.set(\n\t\t\t\tactivationEvent,\n\t\t\t\tthis._activateByEvent(activationEvent, activationKind),\n\t\t\t);\n\t\t}\n\t\treturn this._cachedActivationEvents.get(activationEvent)!;\n\t}\n\n\tpublic activationEventIsDone(activationEvent: string): boolean {\n\t\treturn this._resolvedActivationEvents.has(activationEvent);\n\t}\n\n\tprivate async _activateByEvent(\n\t\tactivationEvent: string,\n\t\tactivationKind: ActivationKind,\n\t): Promise<void> {\n\t\tif (!this._proxy) {\n\t\t\treturn;\n\t\t}\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\t// this case is already covered above and logged.\n\t\t\t// i.e. the extension host could not be started\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\t!this._extensionHost.extensions!.containsActivationEvent(\n\t\t\t\tactivationEvent,\n\t\t\t)\n\t\t) {\n\t\t\tthis._resolvedActivationEvents.add(activationEvent);\n\t\t\treturn;\n\t\t}\n\n\t\tawait proxy.activateByEvent(activationEvent, activationKind);\n\t\tthis._resolvedActivationEvents.add(activationEvent);\n\t}\n\n\tpublic async getInspectPort(\n\t\ttryEnableInspector: boolean,\n\t): Promise<{ port: number; host: string } | undefined> {\n\t\tif (this._extensionHost) {\n\t\t\tif (tryEnableInspector) {\n\t\t\t\tawait this._extensionHost.enableInspectPort();\n\t\t\t}\n\t\t\tconst port = this._extensionHost.getInspectPort();\n\t\t\tif (port) {\n\t\t\t\treturn port;\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tpublic async resolveAuthority(\n\t\tremoteAuthority: string,\n\t\tresolveAttempt: number,\n\t): Promise<IResolveAuthorityResult> {\n\t\tconst sw = StopWatch.create(false);\n\t\tconst prefix = () =>\n\t\t\t`[${extensionHostKindToString(this._extensionHost.runningLocation.kind)}${this._extensionHost.runningLocation.affinity}][resolveAuthority(${getRemoteAuthorityPrefix(remoteAuthority)},${resolveAttempt})][${sw.elapsed()}ms] `;\n\t\tconst logInfo = (msg: string) =>\n\t\t\tthis._logService.info(`${prefix()}${msg}`);\n\t\tconst logError = (msg: string, err: any = undefined) =>\n\t\t\tthis._logService.error(`${prefix()}${msg}`, err);\n\n\t\tlogInfo(`obtaining proxy...`);\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\tlogError(`no proxy`);\n\t\t\treturn {\n\t\t\t\ttype: \"error\",\n\t\t\t\terror: {\n\t\t\t\t\tmessage: `Cannot resolve authority`,\n\t\t\t\t\tcode: RemoteAuthorityResolverErrorCode.Unknown,\n\t\t\t\t\tdetail: undefined,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t\tlogInfo(`invoking...`);\n\t\tconst intervalLogger = new IntervalTimer();\n\t\ttry {\n\t\t\tintervalLogger.cancelAndSet(() => logInfo(\"waiting...\"), 1000);\n\t\t\tconst resolverResult = await proxy.resolveAuthority(\n\t\t\t\tremoteAuthority,\n\t\t\t\tresolveAttempt,\n\t\t\t);\n\t\t\tintervalLogger.dispose();\n\t\t\tif (resolverResult.type === \"ok\") {\n\t\t\t\tlogInfo(`returned ${resolverResult.value.authority.connectTo}`);\n\t\t\t} else {\n\t\t\t\tlogError(`returned an error`, resolverResult.error);\n\t\t\t}\n\t\t\treturn resolverResult;\n\t\t} catch (err) {\n\t\t\tintervalLogger.dispose();\n\t\t\tlogError(`returned an error`, err);\n\t\t\treturn {\n\t\t\t\ttype: \"error\",\n\t\t\t\terror: {\n\t\t\t\t\tmessage: err.message,\n\t\t\t\t\tcode: RemoteAuthorityResolverErrorCode.Unknown,\n\t\t\t\t\tdetail: err,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tpublic async getCanonicalURI(\n\t\tremoteAuthority: string,\n\t\turi: URI,\n\t): Promise<URI | null> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\tthrow new Error(`Cannot resolve canonical URI`);\n\t\t}\n\t\treturn proxy.getCanonicalURI(remoteAuthority, uri);\n\t}\n\n\tpublic async start(\n\t\textensionRegistryVersionId: number,\n\t\tallExtensions: IExtensionDescription[],\n\t\tmyExtensions: ExtensionIdentifier[],\n\t): Promise<void> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\treturn;\n\t\t}\n\t\tconst deltaExtensions = this._extensionHost.extensions!.set(\n\t\t\textensionRegistryVersionId,\n\t\t\tallExtensions,\n\t\t\tmyExtensions,\n\t\t);\n\t\treturn proxy.startExtensionHost(deltaExtensions);\n\t}\n\n\tpublic async extensionTestsExecute(): Promise<number> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\tthrow new Error(\"Could not obtain Extension Host Proxy\");\n\t\t}\n\t\treturn proxy.extensionTestsExecute();\n\t}\n\n\tpublic representsRunningLocation(\n\t\trunningLocation: ExtensionRunningLocation,\n\t): boolean {\n\t\treturn this._extensionHost.runningLocation.equals(runningLocation);\n\t}\n\n\tpublic async deltaExtensions(\n\t\tincomingExtensionsDelta: IExtensionDescriptionDelta,\n\t): Promise<void> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\treturn;\n\t\t}\n\t\tconst outgoingExtensionsDelta = this._extensionHost.extensions!.delta(\n\t\t\tincomingExtensionsDelta,\n\t\t);\n\t\tif (!outgoingExtensionsDelta) {\n\t\t\t// The extension host already has this version of the extensions.\n\t\t\treturn;\n\t\t}\n\t\treturn proxy.deltaExtensions(outgoingExtensionsDelta);\n\t}\n\n\tpublic containsExtension(extensionId: ExtensionIdentifier): boolean {\n\t\treturn (\n\t\t\tthis._extensionHost.extensions?.containsExtension(extensionId) ??\n\t\t\tfalse\n\t\t);\n\t}\n\n\tpublic async setRemoteEnvironment(env: {\n\t\t[key: string]: string | null;\n\t}): Promise<void> {\n\t\tconst proxy = await this._proxy;\n\t\tif (!proxy) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn proxy.setRemoteEnvironment(env);\n\t}\n}\n\nexport function friendlyExtHostName(\n\tkind: ExtensionHostKind,\n\tpid: number | null,\n) {\n\tif (pid) {\n\t\treturn `${extensionHostKindToString(kind)} pid: ${pid}`;\n\t}\n\treturn `${extensionHostKindToString(kind)}`;\n}\n\nconst colorTables = [\n\t[\"#2977B1\", \"#FC802D\", \"#34A13A\", \"#D3282F\", \"#9366BA\"],\n\t[\"#8B564C\", \"#E177C0\", \"#7F7F7F\", \"#BBBE3D\", \"#2EBECD\"],\n];\n\nfunction prettyWithoutArrays(data: any): any {\n\tif (Array.isArray(data)) {\n\t\treturn data;\n\t}\n\tif (\n\t\tdata &&\n\t\ttypeof data === \"object\" &&\n\t\ttypeof data.toString === \"function\"\n\t) {\n\t\tconst result = data.toString();\n\t\tif (result !== \"[object Object]\") {\n\t\t\treturn result;\n\t\t}\n\t}\n\treturn data;\n}\n\nfunction pretty(data: any): any {\n\tif (Array.isArray(data)) {\n\t\treturn data.map(prettyWithoutArrays);\n\t}\n\treturn prettyWithoutArrays(data);\n}\n\nclass RPCLogger implements IRPCProtocolLogger {\n\tprivate _totalIncoming = 0;\n\tprivate _totalOutgoing = 0;\n\n\tconstructor(private readonly _kind: ExtensionHostKind) {}\n\n\tprivate _log(\n\t\tdirection: string,\n\t\ttotalLength: number,\n\t\tmsgLength: number,\n\t\treq: number,\n\t\tinitiator: RequestInitiator,\n\t\tstr: string,\n\t\tdata: any,\n\t): void {\n\t\tdata = pretty(data);\n\n\t\tconst colorTable = colorTables[initiator];\n\t\tconst color = LOG_USE_COLORS\n\t\t\t? colorTable[req % colorTable.length]\n\t\t\t: \"#000000\";\n\t\tlet args = [\n\t\t\t`%c[${extensionHostKindToString(this._kind)}][${direction}]%c[${String(totalLength).padStart(7)}]%c[len: ${String(msgLength).padStart(5)}]%c${String(req).padStart(5)} - ${str}`,\n\t\t\t\"color: darkgreen\",\n\t\t\t\"color: grey\",\n\t\t\t\"color: grey\",\n\t\t\t`color: ${color}`,\n\t\t];\n\t\tif (/\\($/.test(str)) {\n\t\t\targs = args.concat(data);\n\t\t\targs.push(\")\");\n\t\t} else {\n\t\t\targs.push(data);\n\t\t}\n\t\tconsole.log.apply(console, args as [string, ...string[]]);\n\t}\n\n\tlogIncoming(\n\t\tmsgLength: number,\n\t\treq: number,\n\t\tinitiator: RequestInitiator,\n\t\tstr: string,\n\t\tdata?: any,\n\t): void {\n\t\tthis._totalIncoming += msgLength;\n\t\tthis._log(\n\t\t\t\"Ext \\u2192 Win\",\n\t\t\tthis._totalIncoming,\n\t\t\tmsgLength,\n\t\t\treq,\n\t\t\tinitiator,\n\t\t\tstr,\n\t\t\tdata,\n\t\t);\n\t}\n\n\tlogOutgoing(\n\t\tmsgLength: number,\n\t\treq: number,\n\t\tinitiator: RequestInitiator,\n\t\tstr: string,\n\t\tdata?: any,\n\t): void {\n\t\tthis._totalOutgoing += msgLength;\n\t\tthis._log(\n\t\t\t\"Win \\u2192 Ext\",\n\t\t\tthis._totalOutgoing,\n\t\t\tmsgLength,\n\t\t\treq,\n\t\t\tinitiator,\n\t\t\tstr,\n\t\t\tdata,\n\t\t);\n\t}\n}\n\ninterface RPCTelemetryData {\n\ttype: string;\n\tlength: number;\n}\n\ntype RPCTelemetryDataClassification = {\n\towner: \"jrieken\";\n\tcomment: \"Insights about RPC message sizes\";\n\ttype: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The type of the RPC message\";\n\t};\n\tlength: {\n\t\tclassification: \"SystemMetaData\";\n\t\tpurpose: \"PerformanceAndHealth\";\n\t\tcomment: \"The byte-length of the RPC message\";\n\t};\n};\n\nclass TelemetryRPCLogger implements IRPCProtocolLogger {\n\tstatic isEnabled(): boolean {\n\t\t// this will be a very high frequency event, so we only log a small percentage of them\n\t\treturn Math.trunc(Math.random() * 1000) < 0.5;\n\t}\n\n\tprivate readonly _pendingRequests = new Map<number, string>();\n\n\tconstructor(\n\t\t@ITelemetryService\n\t\tprivate readonly _telemetryService: ITelemetryService,\n\t) {}\n\n\tlogIncoming(\n\t\tmsgLength: number,\n\t\treq: number,\n\t\tinitiator: RequestInitiator,\n\t\tstr: string,\n\t): void {\n\t\tif (\n\t\t\tinitiator === RequestInitiator.LocalSide &&\n\t\t\t/^receiveReply(Err)?:/.test(str)\n\t\t) {\n\t\t\t// log the size of reply messages\n\t\t\tconst requestStr =\n\t\t\t\tthis._pendingRequests.get(req) ?? \"unknown_reply\";\n\t\t\tthis._pendingRequests.delete(req);\n\t\t\tthis._telemetryService.publicLog2<\n\t\t\t\tRPCTelemetryData,\n\t\t\t\tRPCTelemetryDataClassification\n\t\t\t>(\"extensionhost.incoming\", {\n\t\t\t\ttype: `${str} ${requestStr}`,\n\t\t\t\tlength: msgLength,\n\t\t\t});\n\t\t}\n\n\t\tif (\n\t\t\tinitiator === RequestInitiator.OtherSide &&\n\t\t\t/^receiveRequest /.test(str)\n\t\t) {\n\t\t\t// incoming request\n\t\t\tthis._telemetryService.publicLog2<\n\t\t\t\tRPCTelemetryData,\n\t\t\t\tRPCTelemetryDataClassification\n\t\t\t>(\"extensionhost.incoming\", {\n\t\t\t\ttype: `${str}`,\n\t\t\t\tlength: msgLength,\n\t\t\t});\n\t\t}\n\t}\n\n\tlogOutgoing(\n\t\tmsgLength: number,\n\t\treq: number,\n\t\tinitiator: RequestInitiator,\n\t\tstr: string,\n\t): void {\n\t\tif (\n\t\t\tinitiator === RequestInitiator.LocalSide &&\n\t\t\tstr.startsWith(\"request: \")\n\t\t) {\n\t\t\tthis._pendingRequests.set(req, str);\n\t\t\tthis._telemetryService.publicLog2<\n\t\t\t\tRPCTelemetryData,\n\t\t\t\tRPCTelemetryDataClassification\n\t\t\t>(\"extensionhost.outgoing\", {\n\t\t\t\ttype: str,\n\t\t\t\tlength: msgLength,\n\t\t\t});\n\t\t}\n\t}\n}\n\ninterface ExtHostLatencyResult {\n\tremoteAuthority: string | null;\n\tup: number;\n\tdown: number;\n\tlatency: number;\n}\n\ninterface ExtHostLatencyProvider {\n\tmeasure(): Promise<ExtHostLatencyResult | null>;\n}\n\nconst providers: ExtHostLatencyProvider[] = [];\nfunction registerLatencyTestProvider(\n\tprovider: ExtHostLatencyProvider,\n): IDisposable {\n\tproviders.push(provider);\n\treturn {\n\t\tdispose: () => {\n\t\t\tfor (let i = 0; i < providers.length; i++) {\n\t\t\t\tif (providers[i] === provider) {\n\t\t\t\t\tproviders.splice(i, 1);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n}\n\nfunction getLatencyTestProviders(): ExtHostLatencyProvider[] {\n\treturn providers.slice(0);\n}\n\nregisterAction2(\n\tclass MeasureExtHostLatencyAction extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: \"editor.action.measureExtHostLatency\",\n\t\t\t\ttitle: nls.localize2(\n\t\t\t\t\t\"measureExtHostLatency\",\n\t\t\t\t\t\"Measure Extension Host Latency\",\n\t\t\t\t),\n\t\t\t\tcategory: Categories.Developer,\n\t\t\t\tf1: true,\n\t\t\t});\n\t\t}\n\n\t\tasync run(accessor: ServicesAccessor) {\n\t\t\tconst editorService = accessor.get(IEditorService);\n\n\t\t\tconst measurements = await Promise.all(\n\t\t\t\tgetLatencyTestProviders().map((provider) => provider.measure()),\n\t\t\t);\n\t\t\teditorService.openEditor({\n\t\t\t\tresource: undefined,\n\t\t\t\tcontents: measurements\n\t\t\t\t\t.map(MeasureExtHostLatencyAction._print)\n\t\t\t\t\t.join(\"\\n\\n\"),\n\t\t\t\toptions: { pinned: true },\n\t\t\t});\n\t\t}\n\n\t\tprivate static _print(m: ExtHostLatencyResult | null): string {\n\t\t\tif (!m) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\treturn `${m.remoteAuthority ? `Authority: ${m.remoteAuthority}\\n` : ``}Roundtrip latency: ${m.latency.toFixed(3)}ms\\nUp: ${MeasureExtHostLatencyAction._printSpeed(m.up)}\\nDown: ${MeasureExtHostLatencyAction._printSpeed(m.down)}\\n`;\n\t\t}\n\n\t\tprivate static _printSpeed(n: number): string {\n\t\t\tif (n <= 1024) {\n\t\t\t\treturn `${n} bps`;\n\t\t\t}\n\t\t\tif (n < 1024 * 1024) {\n\t\t\t\treturn `${(n / 1024).toFixed(1)} kbps`;\n\t\t\t}\n\t\t\treturn `${(n / 1024 / 1024).toFixed(1)} Mbps`;\n\t\t}\n\t},\n);\n"],
  "mappings": "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",
  "names": []
}
