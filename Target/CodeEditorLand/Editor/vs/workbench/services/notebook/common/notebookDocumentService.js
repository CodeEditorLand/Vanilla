import{VSBuffer as i,decodeBase64 as m,encodeBase64 as u}from"../../../../base/common/buffer.js";import{ResourceMap as a}from"../../../../base/common/map.js";import{Schemas as r}from"../../../../base/common/network.js";import{InstantiationType as f,registerSingleton as b}from"../../../../platform/instantiation/common/extensions.js";import{createDecorator as g}from"../../../../platform/instantiation/common/instantiation.js";const p=g("notebookDocumentService"),c=["W","X","Y","Z","a","b","c","d","e","f"],I=new RegExp(`^[${c.join("")}]+`),s=7;function h(o){if(o.scheme!==r.vscodeNotebookCell)return;const e=o.fragment.indexOf("s");if(e<0)return;const t=Number.parseInt(o.fragment.substring(0,e).replace(I,""),s),n=m(o.fragment.substring(e+1)).toString();if(!isNaN(t))return{handle:t,notebook:o.with({scheme:n,fragment:null})}}function R(o,e){const t=e.toString(s),d=`${t.length<c.length?c[t.length-1]:"z"}${t}s${u(i.fromString(o.scheme),!0,!0)}`;return o.with({scheme:r.vscodeNotebookCell,fragment:d})}function x(o){if(o.scheme!==r.vscodeNotebookMetadata)return;const e=m(o.fragment).toString();return o.with({scheme:e,fragment:null})}function S(o){const e=`${u(i.fromString(o.scheme),!0,!0)}`;return o.with({scheme:r.vscodeNotebookMetadata,fragment:e})}class k{_documents=new a;getNotebook(e){if(e.scheme===r.vscodeNotebookCell){const t=h(e);if(t){const n=this._documents.get(t.notebook);if(n)return n}}return this._documents.get(e)}addNotebookDocument(e){this._documents.set(e.uri,e)}removeNotebookDocument(e){this._documents.delete(e.uri)}}b(p,k,f.Delayed);export{p as INotebookDocumentService,k as NotebookDocumentWorkbenchService,R as generate,S as generateMetadataUri,h as parse,x as parseMetadataUri};
