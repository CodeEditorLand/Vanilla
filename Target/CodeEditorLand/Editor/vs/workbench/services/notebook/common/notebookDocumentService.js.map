{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/notebook/common/notebookDocumentService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer, decodeBase64, encodeBase64 } from '../../../../base/common/buffer.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { createDecorator } from '../../../../platform/instantiation/common/instantiation.js';\n\nexport const INotebookDocumentService = createDecorator<INotebookDocumentService>('notebookDocumentService');\n\nexport interface INotebookDocument {\n\treadonly uri: URI;\n\tgetCellIndex(cellUri: URI): number | undefined;\n}\n\nconst _lengths = ['W', 'X', 'Y', 'Z', 'a', 'b', 'c', 'd', 'e', 'f'];\nconst _padRegexp = new RegExp(`^[${_lengths.join('')}]+`);\nconst _radix = 7;\nexport function parse(cell: URI): { notebook: URI; handle: number } | undefined {\n\tif (cell.scheme !== Schemas.vscodeNotebookCell) {\n\t\treturn undefined;\n\t}\n\n\tconst idx = cell.fragment.indexOf('s');\n\tif (idx < 0) {\n\t\treturn undefined;\n\t}\n\n\tconst handle = parseInt(cell.fragment.substring(0, idx).replace(_padRegexp, ''), _radix);\n\tconst _scheme = decodeBase64(cell.fragment.substring(idx + 1)).toString();\n\n\tif (isNaN(handle)) {\n\t\treturn undefined;\n\t}\n\treturn {\n\t\thandle,\n\t\tnotebook: cell.with({ scheme: _scheme, fragment: null })\n\t};\n}\n\nexport function generate(notebook: URI, handle: number): URI {\n\n\tconst s = handle.toString(_radix);\n\tconst p = s.length < _lengths.length ? _lengths[s.length - 1] : 'z';\n\n\tconst fragment = `${p}${s}s${encodeBase64(VSBuffer.fromString(notebook.scheme), true, true)}`;\n\treturn notebook.with({ scheme: Schemas.vscodeNotebookCell, fragment });\n}\n\nexport function parseMetadataUri(metadata: URI): URI | undefined {\n\tif (metadata.scheme !== Schemas.vscodeNotebookMetadata) {\n\t\treturn undefined;\n\t}\n\n\tconst _scheme = decodeBase64(metadata.fragment).toString();\n\n\treturn metadata.with({ scheme: _scheme, fragment: null });\n}\n\nexport function generateMetadataUri(notebook: URI): URI {\n\tconst fragment = `${encodeBase64(VSBuffer.fromString(notebook.scheme), true, true)}`;\n\treturn notebook.with({ scheme: Schemas.vscodeNotebookMetadata, fragment });\n}\n\nexport interface INotebookDocumentService {\n\treadonly _serviceBrand: undefined;\n\n\tgetNotebook(uri: URI): INotebookDocument | undefined;\n\taddNotebookDocument(document: INotebookDocument): void;\n\tremoveNotebookDocument(document: INotebookDocument): void;\n}\n\nexport class NotebookDocumentWorkbenchService implements INotebookDocumentService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate readonly _documents = new ResourceMap<INotebookDocument>();\n\n\tgetNotebook(uri: URI): INotebookDocument | undefined {\n\t\tif (uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\tconst cellUri = parse(uri);\n\t\t\tif (cellUri) {\n\t\t\t\tconst document = this._documents.get(cellUri.notebook);\n\t\t\t\tif (document) {\n\t\t\t\t\treturn document;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn this._documents.get(uri);\n\t}\n\n\taddNotebookDocument(document: INotebookDocument) {\n\t\tthis._documents.set(document.uri, document);\n\t}\n\n\tremoveNotebookDocument(document: INotebookDocument) {\n\t\tthis._documents.delete(document.uri);\n\t}\n\n}\n\nregisterSingleton(INotebookDocumentService, NotebookDocumentWorkbenchService, InstantiationType.Delayed);\n"],
  "mappings": ";;AAKA,SAAS,UAAU,cAAc,oBAAoB;AACrD,SAAS,mBAAmB;AAC5B,SAAS,eAAe;AACxB,SAAS,WAAW;AACpB,SAAS,mBAAmB,yBAAyB;AACrD,SAAS,uBAAuB;AAEzB,MAAM,2BAA2B,gBAA0C,yBAAyB;AAO3G,MAAM,WAAW,CAAC,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,KAAK,GAAG;AAClE,MAAM,aAAa,IAAI,OAAO,KAAK,SAAS,KAAK,EAAE,CAAC,IAAI;AACxD,MAAM,SAAS;AACR,SAAS,MAAM,MAA0D;AAC/E,MAAI,KAAK,WAAW,QAAQ,oBAAoB;AAC/C,WAAO;AAAA,EACR;AAEA,QAAM,MAAM,KAAK,SAAS,QAAQ,GAAG;AACrC,MAAI,MAAM,GAAG;AACZ,WAAO;AAAA,EACR;AAEA,QAAM,SAAS,SAAS,KAAK,SAAS,UAAU,GAAG,GAAG,EAAE,QAAQ,YAAY,EAAE,GAAG,MAAM;AACvF,QAAM,UAAU,aAAa,KAAK,SAAS,UAAU,MAAM,CAAC,CAAC,EAAE,SAAS;AAExE,MAAI,MAAM,MAAM,GAAG;AAClB,WAAO;AAAA,EACR;AACA,SAAO;AAAA,IACN;AAAA,IACA,UAAU,KAAK,KAAK,EAAE,QAAQ,SAAS,UAAU,KAAK,CAAC;AAAA,EACxD;AACD;AApBgB;AAsBT,SAAS,SAAS,UAAe,QAAqB;AAE5D,QAAM,IAAI,OAAO,SAAS,MAAM;AAChC,QAAM,IAAI,EAAE,SAAS,SAAS,SAAS,SAAS,EAAE,SAAS,CAAC,IAAI;AAEhE,QAAM,WAAW,GAAG,CAAC,GAAG,CAAC,IAAI,aAAa,SAAS,WAAW,SAAS,MAAM,GAAG,MAAM,IAAI,CAAC;AAC3F,SAAO,SAAS,KAAK,EAAE,QAAQ,QAAQ,oBAAoB,SAAS,CAAC;AACtE;AAPgB;AAST,SAAS,iBAAiB,UAAgC;AAChE,MAAI,SAAS,WAAW,QAAQ,wBAAwB;AACvD,WAAO;AAAA,EACR;AAEA,QAAM,UAAU,aAAa,SAAS,QAAQ,EAAE,SAAS;AAEzD,SAAO,SAAS,KAAK,EAAE,QAAQ,SAAS,UAAU,KAAK,CAAC;AACzD;AARgB;AAUT,SAAS,oBAAoB,UAAoB;AACvD,QAAM,WAAW,GAAG,aAAa,SAAS,WAAW,SAAS,MAAM,GAAG,MAAM,IAAI,CAAC;AAClF,SAAO,SAAS,KAAK,EAAE,QAAQ,QAAQ,wBAAwB,SAAS,CAAC;AAC1E;AAHgB;AAaT,MAAM,iCAAqE;AAAA,EA5ElF,OA4EkF;AAAA;AAAA;AAAA,EAGhE,aAAa,IAAI,YAA+B;AAAA,EAEjE,YAAY,KAAyC;AACpD,QAAI,IAAI,WAAW,QAAQ,oBAAoB;AAC9C,YAAM,UAAU,MAAM,GAAG;AACzB,UAAI,SAAS;AACZ,cAAM,WAAW,KAAK,WAAW,IAAI,QAAQ,QAAQ;AACrD,YAAI,UAAU;AACb,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AAEA,WAAO,KAAK,WAAW,IAAI,GAAG;AAAA,EAC/B;AAAA,EAEA,oBAAoB,UAA6B;AAChD,SAAK,WAAW,IAAI,SAAS,KAAK,QAAQ;AAAA,EAC3C;AAAA,EAEA,uBAAuB,UAA6B;AACnD,SAAK,WAAW,OAAO,SAAS,GAAG;AAAA,EACpC;AAED;AAEA,kBAAkB,0BAA0B,kCAAkC,kBAAkB,OAAO;",
  "names": []
}
