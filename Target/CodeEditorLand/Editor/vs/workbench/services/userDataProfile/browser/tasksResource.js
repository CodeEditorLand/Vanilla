var d=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var a=(o,t,e,r)=>{for(var s=r>1?void 0:r?P(t,e):t,f=o.length-1,p;f>=0;f--)(p=o[f])&&(s=(r?p(t,e,s):p(s))||s);return r&&s&&d(t,e,s),s},i=(o,t)=>(e,r)=>t(e,r,o);import{VSBuffer as I}from"../../../../base/common/buffer.js";import{localize as g}from"../../../../nls.js";import{FileOperationError as y,FileOperationResult as h,IFileService as u}from"../../../../platform/files/common/files.js";import{IInstantiationService as k}from"../../../../platform/instantiation/common/instantiation.js";import{ILogService as m}from"../../../../platform/log/common/log.js";import{IUriIdentityService as C}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{ProfileResourceType as S}from"../../../../platform/userDataProfile/common/userDataProfile.js";import{API_OPEN_EDITOR_COMMAND_ID as D}from"../../../browser/parts/editor/editorCommands.js";import{TreeItemCollapsibleState as v}from"../../../common/views.js";import{IUserDataProfileService as R}from"../common/userDataProfile.js";let l=class{constructor(t,e,r){this.userDataProfileService=t;this.fileService=e;this.logService=r}async initialize(t){const e=JSON.parse(t);if(!e.tasks){this.logService.info("Initializing Profile: No tasks to apply...");return}await this.fileService.writeFile(this.userDataProfileService.currentProfile.tasksResource,I.fromString(e.tasks))}};l=a([i(0,R),i(1,u),i(2,m)],l);let n=class{constructor(t,e){this.fileService=t;this.logService=e}async getContent(t){const e=await this.getTasksResourceContent(t);return JSON.stringify(e)}async getTasksResourceContent(t){return{tasks:await this.getTasksContent(t)}}async apply(t,e){const r=JSON.parse(t);if(!r.tasks){this.logService.info(`Importing Profile (${e.name}): No tasks to apply...`);return}await this.fileService.writeFile(e.tasksResource,I.fromString(r.tasks))}async getTasksContent(t){try{return(await this.fileService.readFile(t.tasksResource)).value.toString()}catch(e){if(e instanceof y&&e.fileOperationResult===h.FILE_NOT_FOUND)return null;throw e}}};n=a([i(0,u),i(1,m)],n);let c=class{constructor(t,e,r){this.profile=t;this.uriIdentityService=e;this.instantiationService=r}type=S.Tasks;handle=S.Tasks;label={label:g("tasks","Tasks")};collapsibleState=v.Expanded;checkbox;async getChildren(){return[{handle:this.profile.tasksResource.toString(),resourceUri:this.profile.tasksResource,collapsibleState:v.None,parent:this,accessibilityInformation:{label:this.uriIdentityService.extUri.basename(this.profile.settingsResource)},command:{id:D,title:"",arguments:[this.profile.tasksResource,void 0,void 0]}}]}async hasContent(){return(await this.instantiationService.createInstance(n).getTasksResourceContent(this.profile)).tasks!==null}async getContent(){return this.instantiationService.createInstance(n).getContent(this.profile)}isFromDefaultProfile(){return!this.profile.isDefault&&!!this.profile.useDefaultFlags?.tasks}};c=a([i(1,C),i(2,k)],c);export{n as TasksResource,l as TasksResourceInitializer,c as TasksResourceTreeItem};
