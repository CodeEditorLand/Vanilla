import{quickSelect as x}from"../../../../../vs/base/common/arrays.js";import{CharCode as u}from"../../../../../vs/base/common/charCode.js";import{FuzzyScore as d,fuzzyScore as _,fuzzyScoreGracefulAggressive as S,FuzzyScoreOptions as L}from"../../../../../vs/base/common/filters.js";import{isWindows as w}from"../../../../../vs/base/common/platform.js";import"../../../../../vs/workbench/services/suggest/browser/simpleCompletionItem.js";class F{constructor(n,a){this.leadingLineContent=n;this.characterCountDelta=a}}var z=(o=>(o[o.Nothing=0]="Nothing",o[o.All=1]="All",o[o.Incr=2]="Incr",o))(z||{});class k{constructor(n,a,o,r){this._items=n;this._lineContext=a;this.replacementIndex=o;this.replacementLength=r}_stats;_filteredItems;_refilterKind=1;_fuzzyScoreOptions=L.default;_options={};get items(){return this._ensureCachedState(),this._filteredItems}get stats(){return this._ensureCachedState(),this._stats}get lineContext(){return this._lineContext}set lineContext(n){(this._lineContext.leadingLineContent!==n.leadingLineContent||this._lineContext.characterCountDelta!==n.characterCountDelta)&&(this._refilterKind=this._lineContext.characterCountDelta<n.characterCountDelta&&this._filteredItems?2:1,this._lineContext=n)}_ensureCachedState(){this._refilterKind!==0&&this._createCachedState()}_createCachedState(){const n=[],{leadingLineContent:a,characterCountDelta:o}=this._lineContext;let r="",h="";const p=this._refilterKind===1?this._items:this._filteredItems,f=[],g=!this._options.filterGraceful||p.length>2e3?_:S;for(let i=0;i<p.length;i++){const e=p[i],t=this.replacementLength,l=t+o;if(r.length!==l&&(r=l===0?"":a.slice(-l),h=r.toLowerCase()),e.word=r,l===0)e.score=d.Default;else{let s=0;for(;s<t;){const c=r.charCodeAt(s);if(c===u.Space||c===u.Tab)s+=1;else break}if(s>=l)e.score=d.Default;else{const c=g(r,h,s,e.completion.label,e.labelLow,0,this._fuzzyScoreOptions);if(!c)continue;e.score=c}}e.idx=i,f.push(e),n.push(e.completion.label.length)}this._filteredItems=f.sort((i,e)=>{let t=0;if((i.completion.isKeyword&&i.labelLow!==h||e.completion.isKeyword&&e.labelLow!==h)&&(t=(i.completion.isKeyword?1:0)-(e.completion.isKeyword?1:0),t!==0)||(t=e.score[0]-i.score[0],t!==0))return t;if(!a.includes(" ")&&i.fileExtLow.length>0&&e.fileExtLow.length>0){if(t=i.labelLowExcludeFileExt.length-e.labelLowExcludeFileExt.length,t!==0||(t=C(e.fileExtLow)-C(i.fileExtLow),t!==0))return t;t=i.fileExtLow.length-e.fileExtLow.length}return t}),this._refilterKind=0,this._stats={pLabelLen:n.length?x(n.length-.85,n,(i,e)=>i-e):0}}}const y=new Map(w?[["ps1",.09],["exe",.08],["bat",.07],["cmd",.07],["sh",-.05],["bash",-.05],["zsh",-.05],["fish",-.05],["csh",-.06],["ksh",-.06]]:[["ps1",.05],["bat",-.05],["cmd",-.05],["exe",-.05],["sh",.05],["bash",.05],["zsh",.05],["fish",.05],["csh",.04],["ksh",.04],["py",.05],["pl",.05]]);function C(m){return y.get(m)||0}export{F as LineContext,k as SimpleCompletionModel};
