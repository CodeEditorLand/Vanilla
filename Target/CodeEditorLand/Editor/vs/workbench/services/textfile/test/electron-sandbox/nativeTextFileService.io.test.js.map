{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/textfile/test/electron-sandbox/nativeTextFileService.io.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { NullLogService } from '../../../../../platform/log/common/log.js';\nimport { FileService } from '../../../../../platform/files/common/fileService.js';\nimport { Schemas } from '../../../../../base/common/network.js';\nimport { ITextFileService } from '../../common/textfiles.js';\nimport { TextFileEditorModelManager } from '../../common/textFileEditorModelManager.js';\nimport { DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { ServiceCollection } from '../../../../../platform/instantiation/common/serviceCollection.js';\nimport { IFileService, IStat } from '../../../../../platform/files/common/files.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { join } from '../../../../../base/common/path.js';\nimport { UTF16le, detectEncodingByBOMFromBuffer, UTF8_with_bom, UTF16be, toCanonicalName } from '../../common/encoding.js';\nimport { VSBuffer } from '../../../../../base/common/buffer.js';\nimport files from '../common/fixtures/files.js';\nimport createSuite from '../common/textFileService.io.test.js';\nimport { IWorkingCopyFileService, WorkingCopyFileService } from '../../../workingCopy/common/workingCopyFileService.js';\nimport { WorkingCopyService } from '../../../workingCopy/common/workingCopyService.js';\nimport { UriIdentityService } from '../../../../../platform/uriIdentity/common/uriIdentityService.js';\nimport { TestInMemoryFileSystemProvider } from '../../../../test/browser/workbenchTestServices.js';\nimport { TestNativeTextFileServiceWithEncodingOverrides, workbenchInstantiationService } from '../../../../test/electron-sandbox/workbenchTestServices.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\n\nsuite('Files - NativeTextFileService i/o', function () {\n\tconst disposables = new DisposableStore();\n\n\tlet service: ITextFileService;\n\tlet fileProvider: TestInMemoryFileSystemProvider;\n\tconst testDir = 'test';\n\n\tcreateSuite({\n\t\tsetup: async () => {\n\t\t\tconst instantiationService = workbenchInstantiationService(undefined, disposables);\n\n\t\t\tconst logService = new NullLogService();\n\t\t\tconst fileService = disposables.add(new FileService(logService));\n\n\t\t\tfileProvider = disposables.add(new TestInMemoryFileSystemProvider());\n\t\t\tdisposables.add(fileService.registerProvider(Schemas.file, fileProvider));\n\n\t\t\tconst collection = new ServiceCollection();\n\t\t\tcollection.set(IFileService, fileService);\n\t\t\tcollection.set(IWorkingCopyFileService, disposables.add(new WorkingCopyFileService(fileService, disposables.add(new WorkingCopyService()), instantiationService, disposables.add(new UriIdentityService(fileService)))));\n\n\t\t\tservice = disposables.add(instantiationService.createChild(collection).createInstance(TestNativeTextFileServiceWithEncodingOverrides));\n\t\t\tdisposables.add(<TextFileEditorModelManager>service.files);\n\n\t\t\tawait fileProvider.mkdir(URI.file(testDir));\n\t\t\tfor (const fileName in files) {\n\t\t\t\tawait fileProvider.writeFile(\n\t\t\t\t\tURI.file(join(testDir, fileName)),\n\t\t\t\t\tfiles[fileName],\n\t\t\t\t\t{ create: true, overwrite: false, unlock: false, atomic: false }\n\t\t\t\t);\n\t\t\t}\n\n\t\t\treturn { service, testDir };\n\t\t},\n\n\t\tteardown: async () => {\n\t\t\tdisposables.clear();\n\t\t},\n\n\t\texists,\n\t\tstat,\n\t\treadFile,\n\t\tdetectEncodingByBOM\n\t});\n\n\tasync function exists(fsPath: string): Promise<boolean> {\n\t\ttry {\n\t\t\tawait fileProvider.readFile(URI.file(fsPath));\n\t\t\treturn true;\n\t\t}\n\t\tcatch (e) {\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tasync function readFile(fsPath: string): Promise<VSBuffer>;\n\tasync function readFile(fsPath: string, encoding: string): Promise<string>;\n\tasync function readFile(fsPath: string, encoding?: string): Promise<VSBuffer | string> {\n\t\tconst file = await fileProvider.readFile(URI.file(fsPath));\n\n\t\tif (!encoding) {\n\t\t\treturn VSBuffer.wrap(file);\n\t\t}\n\n\t\treturn new TextDecoder(toCanonicalName(encoding)).decode(file);\n\t}\n\n\tasync function stat(fsPath: string): Promise<IStat> {\n\t\treturn fileProvider.stat(URI.file(fsPath));\n\t}\n\n\tasync function detectEncodingByBOM(fsPath: string): Promise<typeof UTF16be | typeof UTF16le | typeof UTF8_with_bom | null> {\n\t\ttry {\n\t\t\tconst buffer = await readFile(fsPath);\n\n\t\t\treturn detectEncodingByBOMFromBuffer(buffer.slice(0, 3), 3);\n\t\t} catch (error) {\n\t\t\treturn null; // ignore errors (like file not found)\n\t\t}\n\t}\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n});\n"],
  "mappings": ";;AAKA,SAAS,sBAAsB;AAC/B,SAAS,mBAAmB;AAC5B,SAAS,eAAe;AACxB,SAAS,wBAAwB;AACjC,SAAS,kCAAkC;AAC3C,SAAS,uBAAuB;AAChC,SAAS,yBAAyB;AAClC,SAAS,cAAc,aAAa;AACpC,SAAS,WAAW;AACpB,SAAS,YAAY;AACrB,SAAS,SAAS,+BAA+B,eAAe,SAAS,uBAAuB;AAChG,SAAS,gBAAgB;AACzB,OAAO,WAAW;AAClB,OAAO,iBAAiB;AACxB,SAAS,yBAAyB,8BAA8B;AAChE,SAAS,0BAA0B;AACnC,SAAS,0BAA0B;AACnC,SAAS,sCAAsC;AAC/C,SAAS,gDAAgD,qCAAqC;AAC9F,SAAS,+CAA+C;AAExD,MAAM,qCAAqC,WAAY;AACtD,QAAM,cAAc,IAAI,gBAAgB;AAExC,MAAI;AACJ,MAAI;AACJ,QAAM,UAAU;AAEhB,cAAY;AAAA,IACX,OAAO,mCAAY;AAClB,YAAM,uBAAuB,8BAA8B,QAAW,WAAW;AAEjF,YAAM,aAAa,IAAI,eAAe;AACtC,YAAM,cAAc,YAAY,IAAI,IAAI,YAAY,UAAU,CAAC;AAE/D,qBAAe,YAAY,IAAI,IAAI,+BAA+B,CAAC;AACnE,kBAAY,IAAI,YAAY,iBAAiB,QAAQ,MAAM,YAAY,CAAC;AAExE,YAAM,aAAa,IAAI,kBAAkB;AACzC,iBAAW,IAAI,cAAc,WAAW;AACxC,iBAAW,IAAI,yBAAyB,YAAY,IAAI,IAAI,uBAAuB,aAAa,YAAY,IAAI,IAAI,mBAAmB,CAAC,GAAG,sBAAsB,YAAY,IAAI,IAAI,mBAAmB,WAAW,CAAC,CAAC,CAAC,CAAC;AAEvN,gBAAU,YAAY,IAAI,qBAAqB,YAAY,UAAU,EAAE,eAAe,8CAA8C,CAAC;AACrI,kBAAY,IAAgC,QAAQ,KAAK;AAEzD,YAAM,aAAa,MAAM,IAAI,KAAK,OAAO,CAAC;AAC1C,iBAAW,YAAY,OAAO;AAC7B,cAAM,aAAa;AAAA,UAClB,IAAI,KAAK,KAAK,SAAS,QAAQ,CAAC;AAAA,UAChC,MAAM,QAAQ;AAAA,UACd,EAAE,QAAQ,MAAM,WAAW,OAAO,QAAQ,OAAO,QAAQ,MAAM;AAAA,QAChE;AAAA,MACD;AAEA,aAAO,EAAE,SAAS,QAAQ;AAAA,IAC3B,GA1BO;AAAA,IA4BP,UAAU,mCAAY;AACrB,kBAAY,MAAM;AAAA,IACnB,GAFU;AAAA,IAIV;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD,CAAC;AAED,iBAAe,OAAO,QAAkC;AACvD,QAAI;AACH,YAAM,aAAa,SAAS,IAAI,KAAK,MAAM,CAAC;AAC5C,aAAO;AAAA,IACR,SACO,GAAG;AACT,aAAO;AAAA,IACR;AAAA,EACD;AARe;AAYf,iBAAe,SAAS,QAAgB,UAA+C;AACtF,UAAM,OAAO,MAAM,aAAa,SAAS,IAAI,KAAK,MAAM,CAAC;AAEzD,QAAI,CAAC,UAAU;AACd,aAAO,SAAS,KAAK,IAAI;AAAA,IAC1B;AAEA,WAAO,IAAI,YAAY,gBAAgB,QAAQ,CAAC,EAAE,OAAO,IAAI;AAAA,EAC9D;AARe;AAUf,iBAAe,KAAK,QAAgC;AACnD,WAAO,aAAa,KAAK,IAAI,KAAK,MAAM,CAAC;AAAA,EAC1C;AAFe;AAIf,iBAAe,oBAAoB,QAAwF;AAC1H,QAAI;AACH,YAAM,SAAS,MAAM,SAAS,MAAM;AAEpC,aAAO,8BAA8B,OAAO,MAAM,GAAG,CAAC,GAAG,CAAC;AAAA,IAC3D,SAAS,OAAO;AACf,aAAO;AAAA,IACR;AAAA,EACD;AARe;AAUf,0CAAwC;AACzC,CAAC;",
  "names": []
}
