{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/textfile/electron-sandbox/nativeTextFileService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Promises } from \"../../../../base/common/async.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport { ICodeEditorService } from \"../../../../editor/browser/services/codeEditorService.js\";\nimport { ILanguageService } from \"../../../../editor/common/languages/language.js\";\nimport { IModelService } from \"../../../../editor/common/services/model.js\";\nimport { ITextResourceConfigurationService } from \"../../../../editor/common/services/textResourceConfiguration.js\";\nimport { localize } from \"../../../../nls.js\";\nimport {\n\tIDialogService,\n\tIFileDialogService,\n} from \"../../../../platform/dialogs/common/dialogs.js\";\nimport {\n\ttype IFileReadLimits,\n\tIFileService,\n} from \"../../../../platform/files/common/files.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport { IUriIdentityService } from \"../../../../platform/uriIdentity/common/uriIdentity.js\";\nimport { IDecorationsService } from \"../../decorations/common/decorations.js\";\nimport { INativeWorkbenchEnvironmentService } from \"../../environment/electron-sandbox/environmentService.js\";\nimport { IElevatedFileService } from \"../../files/common/elevatedFileService.js\";\nimport { IFilesConfigurationService } from \"../../filesConfiguration/common/filesConfigurationService.js\";\nimport { ILifecycleService } from \"../../lifecycle/common/lifecycle.js\";\nimport { IPathService } from \"../../path/common/pathService.js\";\nimport { IUntitledTextEditorService } from \"../../untitled/common/untitledTextEditorService.js\";\nimport { IWorkingCopyFileService } from \"../../workingCopy/common/workingCopyFileService.js\";\nimport { AbstractTextFileService } from \"../browser/textFileService.js\";\nimport {\n\ttype IReadTextFileOptions,\n\ttype ITextFileContent,\n\ttype ITextFileEditorModel,\n\tITextFileService,\n\ttype ITextFileStreamContent,\n\tTextFileEditorModelState,\n} from \"../common/textfiles.js\";\n\nexport class NativeTextFileService extends AbstractTextFileService {\n\tprotected override readonly environmentService: INativeWorkbenchEnvironmentService;\n\n\tconstructor(\n\t\t@IFileService fileService: IFileService,\n\t\t@IUntitledTextEditorService untitledTextEditorService: IUntitledTextEditorService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IModelService modelService: IModelService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IPathService pathService: IPathService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IElevatedFileService elevatedFileService: IElevatedFileService,\n\t\t@ILogService logService: ILogService,\n\t\t@IDecorationsService decorationsService: IDecorationsService,\n\t) {\n\t\tsuper(\n\t\t\tfileService,\n\t\t\tuntitledTextEditorService,\n\t\t\tlifecycleService,\n\t\t\tinstantiationService,\n\t\t\tmodelService,\n\t\t\tenvironmentService,\n\t\t\tdialogService,\n\t\t\tfileDialogService,\n\t\t\ttextResourceConfigurationService,\n\t\t\tfilesConfigurationService,\n\t\t\tcodeEditorService,\n\t\t\tpathService,\n\t\t\tworkingCopyFileService,\n\t\t\turiIdentityService,\n\t\t\tlanguageService,\n\t\t\tlogService,\n\t\t\televatedFileService,\n\t\t\tdecorationsService,\n\t\t);\n\n\t\tthis.environmentService = environmentService;\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\t\t// Lifecycle\n\t\tthis._register(\n\t\t\tthis.lifecycleService.onWillShutdown((event) =>\n\t\t\t\tevent.join(this.onWillShutdown(), {\n\t\t\t\t\tid: \"join.textFiles\",\n\t\t\t\t\tlabel: localize(\"join.textFiles\", \"Saving text files\"),\n\t\t\t\t}),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate async onWillShutdown(): Promise<void> {\n\t\tlet modelsPendingToSave: ITextFileEditorModel[];\n\n\t\t// As long as models are pending to be saved, we prolong the shutdown\n\t\t// until that has happened to ensure we are not shutting down in the\n\t\t// middle of writing to the file\n\t\t// (https://github.com/microsoft/vscode/issues/116600)\n\t\twhile (\n\t\t\t(modelsPendingToSave = this.files.models.filter((model) =>\n\t\t\t\tmodel.hasState(TextFileEditorModelState.PENDING_SAVE),\n\t\t\t)).length > 0\n\t\t) {\n\t\t\tawait Promises.settled(\n\t\t\t\tmodelsPendingToSave.map((model) =>\n\t\t\t\t\tmodel.joinState(TextFileEditorModelState.PENDING_SAVE),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t}\n\n\toverride async read(\n\t\tresource: URI,\n\t\toptions?: IReadTextFileOptions,\n\t): Promise<ITextFileContent> {\n\t\t// ensure platform limits are applied\n\t\toptions = this.ensureLimits(options);\n\n\t\treturn super.read(resource, options);\n\t}\n\n\toverride async readStream(\n\t\tresource: URI,\n\t\toptions?: IReadTextFileOptions,\n\t): Promise<ITextFileStreamContent> {\n\t\t// ensure platform limits are applied\n\t\toptions = this.ensureLimits(options);\n\n\t\treturn super.readStream(resource, options);\n\t}\n\n\tprivate ensureLimits(options?: IReadTextFileOptions): IReadTextFileOptions {\n\t\tlet ensuredOptions: IReadTextFileOptions;\n\t\tif (options) {\n\t\t\tensuredOptions = options;\n\t\t} else {\n\t\t\tensuredOptions = Object.create(null);\n\t\t}\n\n\t\tlet ensuredLimits: IFileReadLimits;\n\t\tif (ensuredOptions.limits) {\n\t\t\tensuredLimits = ensuredOptions.limits;\n\t\t} else {\n\t\t\tensuredLimits = Object.create(null);\n\t\t\tensuredOptions = {\n\t\t\t\t...ensuredOptions,\n\t\t\t\tlimits: ensuredLimits,\n\t\t\t};\n\t\t}\n\n\t\treturn ensuredOptions;\n\t}\n}\n\nregisterSingleton(\n\tITextFileService,\n\tNativeTextFileService,\n\tInstantiationType.Eager,\n);\n"],
  "mappings": "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",
  "names": []
}
