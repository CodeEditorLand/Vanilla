{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/textfile/electron-sandbox/nativeTextFileService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { localize } from '../../../../nls.js';\nimport { AbstractTextFileService } from '../browser/textFileService.js';\nimport { ITextFileService, ITextFileStreamContent, ITextFileContent, IReadTextFileOptions, TextFileEditorModelState, ITextFileEditorModel } from '../common/textfiles.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IFileService, IFileReadLimits } from '../../../../platform/files/common/files.js';\nimport { ITextResourceConfigurationService } from '../../../../editor/common/services/textResourceConfiguration.js';\nimport { IUntitledTextEditorService } from '../../untitled/common/untitledTextEditorService.js';\nimport { ILifecycleService } from '../../lifecycle/common/lifecycle.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { INativeWorkbenchEnvironmentService } from '../../environment/electron-sandbox/environmentService.js';\nimport { IDialogService, IFileDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IFilesConfigurationService } from '../../filesConfiguration/common/filesConfigurationService.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { IPathService } from '../../path/common/pathService.js';\nimport { IWorkingCopyFileService } from '../../workingCopy/common/workingCopyFileService.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IElevatedFileService } from '../../files/common/elevatedFileService.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { Promises } from '../../../../base/common/async.js';\nimport { IDecorationsService } from '../../decorations/common/decorations.js';\n\nexport class NativeTextFileService extends AbstractTextFileService {\n\n\tprotected override readonly environmentService: INativeWorkbenchEnvironmentService;\n\n\tconstructor(\n\t\t@IFileService fileService: IFileService,\n\t\t@IUntitledTextEditorService untitledTextEditorService: IUntitledTextEditorService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IModelService modelService: IModelService,\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@IFileDialogService fileDialogService: IFileDialogService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IFilesConfigurationService filesConfigurationService: IFilesConfigurationService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@IPathService pathService: IPathService,\n\t\t@IWorkingCopyFileService workingCopyFileService: IWorkingCopyFileService,\n\t\t@IUriIdentityService uriIdentityService: IUriIdentityService,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IElevatedFileService elevatedFileService: IElevatedFileService,\n\t\t@ILogService logService: ILogService,\n\t\t@IDecorationsService decorationsService: IDecorationsService\n\t) {\n\t\tsuper(fileService, untitledTextEditorService, lifecycleService, instantiationService, modelService, environmentService, dialogService, fileDialogService, textResourceConfigurationService, filesConfigurationService, codeEditorService, pathService, workingCopyFileService, uriIdentityService, languageService, logService, elevatedFileService, decorationsService);\n\n\t\tthis.environmentService = environmentService;\n\n\t\tthis.registerListeners();\n\t}\n\n\tprivate registerListeners(): void {\n\n\t\t// Lifecycle\n\t\tthis._register(this.lifecycleService.onWillShutdown(event => event.join(this.onWillShutdown(), { id: 'join.textFiles', label: localize('join.textFiles', \"Saving text files\") })));\n\t}\n\n\tprivate async onWillShutdown(): Promise<void> {\n\t\tlet modelsPendingToSave: ITextFileEditorModel[];\n\n\t\t// As long as models are pending to be saved, we prolong the shutdown\n\t\t// until that has happened to ensure we are not shutting down in the\n\t\t// middle of writing to the file\n\t\t// (https://github.com/microsoft/vscode/issues/116600)\n\t\twhile ((modelsPendingToSave = this.files.models.filter(model => model.hasState(TextFileEditorModelState.PENDING_SAVE))).length > 0) {\n\t\t\tawait Promises.settled(modelsPendingToSave.map(model => model.joinState(TextFileEditorModelState.PENDING_SAVE)));\n\t\t}\n\t}\n\n\toverride async read(resource: URI, options?: IReadTextFileOptions): Promise<ITextFileContent> {\n\n\t\t// ensure platform limits are applied\n\t\toptions = this.ensureLimits(options);\n\n\t\treturn super.read(resource, options);\n\t}\n\n\toverride async readStream(resource: URI, options?: IReadTextFileOptions): Promise<ITextFileStreamContent> {\n\n\t\t// ensure platform limits are applied\n\t\toptions = this.ensureLimits(options);\n\n\t\treturn super.readStream(resource, options);\n\t}\n\n\tprivate ensureLimits(options?: IReadTextFileOptions): IReadTextFileOptions {\n\t\tlet ensuredOptions: IReadTextFileOptions;\n\t\tif (!options) {\n\t\t\tensuredOptions = Object.create(null);\n\t\t} else {\n\t\t\tensuredOptions = options;\n\t\t}\n\n\t\tlet ensuredLimits: IFileReadLimits;\n\t\tif (!ensuredOptions.limits) {\n\t\t\tensuredLimits = Object.create(null);\n\t\t\tensuredOptions = {\n\t\t\t\t...ensuredOptions,\n\t\t\t\tlimits: ensuredLimits\n\t\t\t};\n\t\t} else {\n\t\t\tensuredLimits = ensuredOptions.limits;\n\t\t}\n\n\t\treturn ensuredOptions;\n\t}\n}\n\nregisterSingleton(ITextFileService, NativeTextFileService, InstantiationType.Eager);\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,gBAAgB;AACzB,SAAS,+BAA+B;AACxC,SAAS,kBAAkB,wBAAwB,kBAAkB,sBAAsB,0BAA0B,4BAA4B;AACjJ,SAAS,mBAAmB,yBAAyB;AACrD,SAAS,WAAW;AACpB,SAAS,cAAc,uBAAuB;AAC9C,SAAS,yCAAyC;AAClD,SAAS,kCAAkC;AAC3C,SAAS,yBAAyB;AAClC,SAAS,6BAA6B;AACtC,SAAS,qBAAqB;AAC9B,SAAS,0CAA0C;AACnD,SAAS,gBAAgB,0BAA0B;AACnD,SAAS,kCAAkC;AAC3C,SAAS,0BAA0B;AACnC,SAAS,oBAAoB;AAC7B,SAAS,+BAA+B;AACxC,SAAS,2BAA2B;AACpC,SAAS,wBAAwB;AACjC,SAAS,4BAA4B;AACrC,SAAS,mBAAmB;AAC5B,SAAS,gBAAgB;AACzB,SAAS,2BAA2B;AAE7B,IAAM,wBAAN,cAAoC,wBAAwB;AAAA,EA7BnE,OA6BmE;AAAA;AAAA;AAAA,EAEtC;AAAA,EAE5B,YACe,aACc,2BACT,kBACI,sBACR,cACqB,oBACpB,eACI,mBACe,kCACP,2BACR,mBACN,aACW,wBACJ,oBACH,iBACI,qBACT,YACQ,oBACpB;AACD,UAAM,aAAa,2BAA2B,kBAAkB,sBAAsB,cAAc,oBAAoB,eAAe,mBAAmB,kCAAkC,2BAA2B,mBAAmB,aAAa,wBAAwB,oBAAoB,iBAAiB,YAAY,qBAAqB,kBAAkB;AAEvW,SAAK,qBAAqB;AAE1B,SAAK,kBAAkB;AAAA,EACxB;AAAA,EAEQ,oBAA0B;AAGjC,SAAK,UAAU,KAAK,iBAAiB,eAAe,WAAS,MAAM,KAAK,KAAK,eAAe,GAAG,EAAE,IAAI,kBAAkB,OAAO,SAAS,kBAAkB,mBAAmB,EAAE,CAAC,CAAC,CAAC;AAAA,EAClL;AAAA,EAEA,MAAc,iBAAgC;AAC7C,QAAI;AAMJ,YAAQ,sBAAsB,KAAK,MAAM,OAAO,OAAO,WAAS,MAAM,SAAS,yBAAyB,YAAY,CAAC,GAAG,SAAS,GAAG;AACnI,YAAM,SAAS,QAAQ,oBAAoB,IAAI,WAAS,MAAM,UAAU,yBAAyB,YAAY,CAAC,CAAC;AAAA,IAChH;AAAA,EACD;AAAA,EAEA,MAAe,KAAK,UAAe,SAA2D;AAG7F,cAAU,KAAK,aAAa,OAAO;AAEnC,WAAO,MAAM,KAAK,UAAU,OAAO;AAAA,EACpC;AAAA,EAEA,MAAe,WAAW,UAAe,SAAiE;AAGzG,cAAU,KAAK,aAAa,OAAO;AAEnC,WAAO,MAAM,WAAW,UAAU,OAAO;AAAA,EAC1C;AAAA,EAEQ,aAAa,SAAsD;AAC1E,QAAI;AACJ,QAAI,CAAC,SAAS;AACb,uBAAiB,uBAAO,OAAO,IAAI;AAAA,IACpC,OAAO;AACN,uBAAiB;AAAA,IAClB;AAEA,QAAI;AACJ,QAAI,CAAC,eAAe,QAAQ;AAC3B,sBAAgB,uBAAO,OAAO,IAAI;AAClC,uBAAiB;AAAA,QAChB,GAAG;AAAA,QACH,QAAQ;AAAA,MACT;AAAA,IACD,OAAO;AACN,sBAAgB,eAAe;AAAA,IAChC;AAEA,WAAO;AAAA,EACR;AACD;AAtFa,wBAAN;AAAA,EAKJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAtBU;AAwFb,kBAAkB,kBAAkB,uBAAuB,kBAAkB,KAAK;",
  "names": []
}
