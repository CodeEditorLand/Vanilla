{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/host/electron-sandbox/nativeHostService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tdisposableWindowInterval,\n\tgetActiveDocument,\n\tgetWindowId,\n\tgetWindowsCount,\n\thasWindow,\n\tonDidRegisterWindow,\n} from \"../../../../base/browser/dom.js\";\nimport { isAuxiliaryWindow } from \"../../../../base/browser/window.js\";\nimport { memoize } from \"../../../../base/common/decorators.js\";\nimport { Emitter, Event } from \"../../../../base/common/event.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport { webUtils } from \"../../../../base/parts/sandbox/electron-sandbox/globals.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport { IMainProcessService } from \"../../../../platform/ipc/common/mainProcessService.js\";\nimport {\n\tILabelService,\n\tVerbosity,\n} from \"../../../../platform/label/common/label.js\";\nimport { INativeHostService } from \"../../../../platform/native/common/native.js\";\nimport { NativeHostService } from \"../../../../platform/native/common/nativeHostService.js\";\nimport {\n\ttype IOpenEmptyWindowOptions,\n\ttype IOpenWindowOptions,\n\ttype IPoint,\n\ttype IRectangle,\n\ttype IWindowOpenable,\n\tisFolderToOpen,\n\tisWorkspaceToOpen,\n} from \"../../../../platform/window/common/window.js\";\nimport { IWorkbenchEnvironmentService } from \"../../environment/common/environmentService.js\";\nimport { INativeWorkbenchEnvironmentService } from \"../../environment/electron-sandbox/environmentService.js\";\nimport { IHostService } from \"../browser/host.js\";\n\nclass WorkbenchNativeHostService extends NativeHostService {\n\tconstructor(\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IMainProcessService mainProcessService: IMainProcessService,\n\t) {\n\t\tsuper(environmentService.window.id, mainProcessService);\n\t}\n}\n\nclass WorkbenchHostService extends Disposable implements IHostService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tconstructor(\n\t\t@INativeHostService private readonly nativeHostService: INativeHostService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\t}\n\n\t//#region Focus\n\n\treadonly onDidChangeFocus = Event.latch(\n\t\tEvent.any(\n\t\t\tEvent.map(\n\t\t\t\tEvent.filter(\n\t\t\t\t\tthis.nativeHostService.onDidFocusMainOrAuxiliaryWindow,\n\t\t\t\t\t(id) => hasWindow(id),\n\t\t\t\t\tthis._store,\n\t\t\t\t),\n\t\t\t\t() => this.hasFocus,\n\t\t\t\tthis._store,\n\t\t\t),\n\t\t\tEvent.map(\n\t\t\t\tEvent.filter(\n\t\t\t\t\tthis.nativeHostService.onDidBlurMainOrAuxiliaryWindow,\n\t\t\t\t\t(id) => hasWindow(id),\n\t\t\t\t\tthis._store,\n\t\t\t\t),\n\t\t\t\t() => this.hasFocus,\n\t\t\t\tthis._store,\n\t\t\t),\n\t\t\tEvent.map(\n\t\t\t\tthis.onDidChangeActiveWindow,\n\t\t\t\t() => this.hasFocus,\n\t\t\t\tthis._store,\n\t\t\t),\n\t\t),\n\t\tundefined,\n\t\tthis._store,\n\t);\n\n\tget hasFocus(): boolean {\n\t\treturn getActiveDocument().hasFocus();\n\t}\n\n\tasync hadLastFocus(): Promise<boolean> {\n\t\tconst activeWindowId = await this.nativeHostService.getActiveWindowId();\n\n\t\tif (typeof activeWindowId === \"undefined\") {\n\t\t\treturn false;\n\t\t}\n\n\t\treturn activeWindowId === this.nativeHostService.windowId;\n\t}\n\n\t//#endregion\n\n\t//#region Window\n\n\t@memoize\n\tget onDidChangeActiveWindow(): Event<number> {\n\t\tconst emitter = this._register(new Emitter<number>());\n\n\t\t// Emit via native focus tracking\n\t\tthis._register(\n\t\t\tEvent.filter(\n\t\t\t\tthis.nativeHostService.onDidFocusMainOrAuxiliaryWindow,\n\t\t\t\t(id) => hasWindow(id),\n\t\t\t\tthis._store,\n\t\t\t)((id) => emitter.fire(id)),\n\t\t);\n\n\t\tthis._register(\n\t\t\tonDidRegisterWindow(({ window, disposables }) => {\n\t\t\t\t// Emit via interval: immediately when opening an auxiliary window,\n\t\t\t\t// it is possible that document focus has not yet changed, so we\n\t\t\t\t// poll for a while to ensure we catch the event.\n\t\t\t\tdisposables.add(\n\t\t\t\t\tdisposableWindowInterval(\n\t\t\t\t\t\twindow,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tconst hasFocus = window.document.hasFocus();\n\t\t\t\t\t\t\tif (hasFocus) {\n\t\t\t\t\t\t\t\temitter.fire(window.vscodeWindowId);\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\treturn hasFocus;\n\t\t\t\t\t\t},\n\t\t\t\t\t\t100,\n\t\t\t\t\t\t20,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}),\n\t\t);\n\n\t\treturn Event.latch(emitter.event, undefined, this._store);\n\t}\n\n\treadonly onDidChangeFullScreen = Event.filter(\n\t\tthis.nativeHostService.onDidChangeWindowFullScreen,\n\t\t(e) => hasWindow(e.windowId),\n\t\tthis._store,\n\t);\n\n\topenWindow(options?: IOpenEmptyWindowOptions): Promise<void>;\n\topenWindow(\n\t\ttoOpen: IWindowOpenable[],\n\t\toptions?: IOpenWindowOptions,\n\t): Promise<void>;\n\topenWindow(\n\t\targ1?: IOpenEmptyWindowOptions | IWindowOpenable[],\n\t\targ2?: IOpenWindowOptions,\n\t): Promise<void> {\n\t\tif (Array.isArray(arg1)) {\n\t\t\treturn this.doOpenWindow(arg1, arg2);\n\t\t}\n\n\t\treturn this.doOpenEmptyWindow(arg1);\n\t}\n\n\tprivate doOpenWindow(\n\t\ttoOpen: IWindowOpenable[],\n\t\toptions?: IOpenWindowOptions,\n\t): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (!!remoteAuthority) {\n\t\t\ttoOpen.forEach(\n\t\t\t\t(openable) =>\n\t\t\t\t\t(openable.label =\n\t\t\t\t\t\topenable.label || this.getRecentLabel(openable)),\n\t\t\t);\n\n\t\t\tif (options?.remoteAuthority === undefined) {\n\t\t\t\t// set the remoteAuthority of the window the request came from.\n\t\t\t\t// It will be used when the input is neither file nor vscode-remote.\n\t\t\t\toptions = options\n\t\t\t\t\t? { ...options, remoteAuthority }\n\t\t\t\t\t: { remoteAuthority };\n\t\t\t}\n\t\t}\n\n\t\treturn this.nativeHostService.openWindow(toOpen, options);\n\t}\n\n\tprivate getRecentLabel(openable: IWindowOpenable): string {\n\t\tif (isFolderToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(openable.folderUri, {\n\t\t\t\tverbose: Verbosity.LONG,\n\t\t\t});\n\t\t}\n\n\t\tif (isWorkspaceToOpen(openable)) {\n\t\t\treturn this.labelService.getWorkspaceLabel(\n\t\t\t\t{ id: \"\", configPath: openable.workspaceUri },\n\t\t\t\t{ verbose: Verbosity.LONG },\n\t\t\t);\n\t\t}\n\n\t\treturn this.labelService.getUriLabel(openable.fileUri);\n\t}\n\n\tprivate doOpenEmptyWindow(\n\t\toptions?: IOpenEmptyWindowOptions,\n\t): Promise<void> {\n\t\tconst remoteAuthority = this.environmentService.remoteAuthority;\n\t\tif (!!remoteAuthority && options?.remoteAuthority === undefined) {\n\t\t\t// set the remoteAuthority of the window the request came from\n\t\t\toptions = options\n\t\t\t\t? { ...options, remoteAuthority }\n\t\t\t\t: { remoteAuthority };\n\t\t}\n\t\treturn this.nativeHostService.openWindow(options);\n\t}\n\n\ttoggleFullScreen(targetWindow: Window): Promise<void> {\n\t\treturn this.nativeHostService.toggleFullScreen({\n\t\t\ttargetWindowId: isAuxiliaryWindow(targetWindow)\n\t\t\t\t? targetWindow.vscodeWindowId\n\t\t\t\t: undefined,\n\t\t});\n\t}\n\n\tasync moveTop(targetWindow: Window): Promise<void> {\n\t\tif (getWindowsCount() <= 1) {\n\t\t\treturn; // does not apply when only one window is opened\n\t\t}\n\n\t\treturn this.nativeHostService.moveWindowTop(\n\t\t\tisAuxiliaryWindow(targetWindow)\n\t\t\t\t? { targetWindowId: targetWindow.vscodeWindowId }\n\t\t\t\t: undefined,\n\t\t);\n\t}\n\n\tgetCursorScreenPoint(): Promise<{\n\t\treadonly point: IPoint;\n\t\treadonly display: IRectangle;\n\t}> {\n\t\treturn this.nativeHostService.getCursorScreenPoint();\n\t}\n\n\t//#endregion\n\n\t//#region Lifecycle\n\n\tfocus(targetWindow: Window, options?: { force: boolean }): Promise<void> {\n\t\treturn this.nativeHostService.focusWindow({\n\t\t\tforce: options?.force,\n\t\t\ttargetWindowId: getWindowId(targetWindow),\n\t\t});\n\t}\n\n\trestart(): Promise<void> {\n\t\treturn this.nativeHostService.relaunch();\n\t}\n\n\treload(options?: { disableExtensions?: boolean }): Promise<void> {\n\t\treturn this.nativeHostService.reload(options);\n\t}\n\n\tclose(): Promise<void> {\n\t\treturn this.nativeHostService.closeWindow();\n\t}\n\n\tasync withExpectedShutdown<T>(\n\t\texpectedShutdownTask: () => Promise<T>,\n\t): Promise<T> {\n\t\treturn await expectedShutdownTask();\n\t}\n\n\t//#endregion\n\n\t//#region File\n\n\tgetPathForFile(file: File): string {\n\t\treturn webUtils.getPathForFile(file);\n\t}\n\n\t//#endregion\n}\n\nregisterSingleton(\n\tIHostService,\n\tWorkbenchHostService,\n\tInstantiationType.Delayed,\n);\nregisterSingleton(\n\tINativeHostService,\n\tWorkbenchNativeHostService,\n\tInstantiationType.Delayed,\n);\n"],
  "mappings": "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",
  "names": []
}
