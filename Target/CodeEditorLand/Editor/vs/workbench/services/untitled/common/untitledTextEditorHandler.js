var f=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var u=(s,i,e,r)=>{for(var t=r>1?void 0:r?S(i,e):i,o=s.length-1,d;o>=0;o--)(d=s[o])&&(t=(r?d(i,e,t):d(t))||t);return r&&t&&f(i,e,t),t},n=(s,i)=>(e,r)=>i(e,r,s);import{Schemas as h}from"../../../../base/common/network.js";import{Disposable as E}from"../../../../base/common/lifecycle.js";import{URI as g}from"../../../../base/common/uri.js";import"../../../common/editor.js";import"../../../common/editor/editorInput.js";import{ITextEditorService as l}from"../../textfile/common/textEditorService.js";import{isEqual as x,toLocalResource as I}from"../../../../base/common/resources.js";import{PLAINTEXT_LANGUAGE_ID as y}from"../../../../editor/common/languages/modesRegistry.js";import"../../../../platform/instantiation/common/instantiation.js";import{IWorkbenchEnvironmentService as m}from"../../environment/common/environmentService.js";import{IFilesConfigurationService as b}from"../../filesConfiguration/common/filesConfigurationService.js";import{IPathService as p}from"../../path/common/pathService.js";import{UntitledTextEditorInput as T}from"./untitledTextEditorInput.js";import"../../../common/contributions.js";import{NO_TYPE_ID as U}from"../../workingCopy/common/workingCopy.js";import{IWorkingCopyEditorService as W}from"../../workingCopy/common/workingCopyEditorService.js";import{IUntitledTextEditorService as C}from"./untitledTextEditorService.js";let c=class{constructor(i,e,r){this.filesConfigurationService=i;this.environmentService=e;this.pathService=r}canSerialize(i){return this.filesConfigurationService.isHotExitEnabled&&!i.isDisposed()}serialize(i){if(!this.canSerialize(i))return;const e=i;let r=e.resource;e.hasAssociatedFilePath&&(r=I(r,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme));let t;const o=e.getLanguageId();(o!==y||e.hasLanguageSetExplicitly)&&(t=o);const d={resourceJSON:r.toJSON(),modeId:t,encoding:e.getEncoding()};return JSON.stringify(d)}deserialize(i,e){return i.invokeFunction(r=>{const t=JSON.parse(e),o=g.revive(t.resourceJSON),d=t.modeId,v=t.encoding;return r.get(l).createTextEditor({resource:o,languageId:d,encoding:v,forceUntitled:!0})})}};c=u([n(0,b),n(1,m),n(2,p)],c);let a=class extends E{constructor(e,r,t,o,d){super();this.environmentService=r;this.pathService=t;this.textEditorService=o;this.untitledTextEditorService=d;this._register(e.registerHandler(this))}static ID="workbench.contrib.untitledTextEditorWorkingCopyEditorHandler";handles(e){return e.resource.scheme===h.untitled&&e.typeId===U}isOpen(e,r){return this.handles(e)?r instanceof T&&x(e.resource,r.resource):!1}createEditor(e){let r;return this.untitledTextEditorService.isUntitledWithAssociatedResource(e.resource)?r=I(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):r=e.resource,this.textEditorService.createTextEditor({resource:r,forceUntitled:!0})}};a=u([n(0,W),n(1,m),n(2,p),n(3,l),n(4,C)],a);export{c as UntitledTextEditorInputSerializer,a as UntitledTextEditorWorkingCopyEditorHandler};
