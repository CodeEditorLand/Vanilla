var v=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var u=(d,i,e,t)=>{for(var r=t>1?void 0:t?S(i,e):i,o=d.length-1,s;o>=0;o--)(s=d[o])&&(r=(t?s(i,e,r):s(r))||r);return t&&r&&v(i,e,r),r},n=(d,i)=>(e,t)=>i(e,t,d);import{Disposable as h}from"../../../../base/common/lifecycle.js";import{Schemas as E}from"../../../../base/common/network.js";import{isEqual as g,toLocalResource as m}from"../../../../base/common/resources.js";import{URI as y}from"../../../../base/common/uri.js";import{PLAINTEXT_LANGUAGE_ID as x}from"../../../../editor/common/languages/modesRegistry.js";import{IWorkbenchEnvironmentService as l}from"../../environment/common/environmentService.js";import{IFilesConfigurationService as b}from"../../filesConfiguration/common/filesConfigurationService.js";import{IPathService as p}from"../../path/common/pathService.js";import{ITextEditorService as I}from"../../textfile/common/textEditorService.js";import{NO_TYPE_ID as T}from"../../workingCopy/common/workingCopy.js";import{IWorkingCopyEditorService as U}from"../../workingCopy/common/workingCopyEditorService.js";import{UntitledTextEditorInput as W}from"./untitledTextEditorInput.js";import{IUntitledTextEditorService as C}from"./untitledTextEditorService.js";let c=class{constructor(i,e,t){this.filesConfigurationService=i;this.environmentService=e;this.pathService=t}canSerialize(i){return this.filesConfigurationService.isHotExitEnabled&&!i.isDisposed()}serialize(i){if(!this.canSerialize(i))return;const e=i;let t=e.resource;e.hasAssociatedFilePath&&(t=m(t,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme));let r;const o=e.getLanguageId();(o!==x||e.hasLanguageSetExplicitly)&&(r=o);const s={resourceJSON:t.toJSON(),modeId:r,encoding:e.getEncoding()};return JSON.stringify(s)}deserialize(i,e){return i.invokeFunction(t=>{const r=JSON.parse(e),o=y.revive(r.resourceJSON),s=r.modeId,f=r.encoding;return t.get(I).createTextEditor({resource:o,languageId:s,encoding:f,forceUntitled:!0})})}};c=u([n(0,b),n(1,l),n(2,p)],c);let a=class extends h{constructor(e,t,r,o,s){super();this.environmentService=t;this.pathService=r;this.textEditorService=o;this.untitledTextEditorService=s;this._register(e.registerHandler(this))}static ID="workbench.contrib.untitledTextEditorWorkingCopyEditorHandler";handles(e){return e.resource.scheme===E.untitled&&e.typeId===T}isOpen(e,t){return this.handles(e)?t instanceof W&&g(e.resource,t.resource):!1}createEditor(e){let t;return this.untitledTextEditorService.isUntitledWithAssociatedResource(e.resource)?t=m(e.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):t=e.resource,this.textEditorService.createTextEditor({resource:t,forceUntitled:!0})}};a=u([n(0,U),n(1,l),n(2,p),n(3,I),n(4,C)],a);export{c as UntitledTextEditorInputSerializer,a as UntitledTextEditorWorkingCopyEditorHandler};
