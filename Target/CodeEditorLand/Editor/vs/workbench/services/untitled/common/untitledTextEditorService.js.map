{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/services/untitled/common/untitledTextEditorService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { createDecorator, IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { UntitledTextEditorModel, IUntitledTextEditorModel } from './untitledTextEditorModel.js';\nimport { IFilesConfiguration } from '../../../../platform/files/common/files.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { Event, Emitter } from '../../../../base/common/event.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { Disposable, DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\n\nexport const IUntitledTextEditorService = createDecorator<IUntitledTextEditorService>('untitledTextEditorService');\n\nexport interface INewUntitledTextEditorOptions {\n\n\t/**\n\t * Initial value of the untitled editor. An untitled editor with initial\n\t * value is dirty right from the beginning.\n\t */\n\tinitialValue?: string;\n\n\t/**\n\t * Preferred language id to use when saving the untitled editor.\n\t */\n\tlanguageId?: string;\n\n\t/**\n\t * Preferred encoding to use when saving the untitled editor.\n\t */\n\tencoding?: string;\n}\n\nexport interface IExistingUntitledTextEditorOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * A resource to identify the untitled editor to create or return\n\t * if already existing.\n\t *\n\t * Note: the resource will not be used unless the scheme is `untitled`.\n\t */\n\tuntitledResource?: URI;\n}\n\nexport interface INewUntitledTextEditorWithAssociatedResourceOptions extends INewUntitledTextEditorOptions {\n\n\t/**\n\t * Resource components to associate with the untitled editor. When saving\n\t * the untitled editor, the associated components will be used and the user\n\t * is not being asked to provide a file path.\n\t *\n\t * Note: currently it is not possible to specify the `scheme` to use. The\n\t * untitled editor will saved to the default local or remote resource.\n\t */\n\tassociatedResource?: { authority: string; path: string; query: string; fragment: string };\n}\n\ntype IInternalUntitledTextEditorOptions = IExistingUntitledTextEditorOptions & INewUntitledTextEditorWithAssociatedResourceOptions;\n\nexport interface IUntitledTextEditorModelManager {\n\n\t/**\n\t * Events for when untitled text editors change (e.g. getting dirty, saved or reverted).\n\t */\n\treadonly onDidChangeDirty: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor encodings change.\n\t */\n\treadonly onDidChangeEncoding: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor labels change.\n\t */\n\treadonly onDidChangeLabel: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editor models are created.\n\t */\n\treadonly onDidCreate: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Events for when untitled text editors are about to be disposed.\n\t */\n\treadonly onWillDispose: Event<IUntitledTextEditorModel>;\n\n\t/**\n\t * Creates a new untitled editor model with the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tcreate(options?: INewUntitledTextEditorOptions): IUntitledTextEditorModel;\n\tcreate(options?: INewUntitledTextEditorWithAssociatedResourceOptions): IUntitledTextEditorModel;\n\tcreate(options?: IExistingUntitledTextEditorOptions): IUntitledTextEditorModel;\n\n\t/**\n\t * Returns an existing untitled editor model if already created before.\n\t */\n\tget(resource: URI): IUntitledTextEditorModel | undefined;\n\n\t/**\n\t * Returns the value of the untitled editor, undefined if none exists\n\t * @param resource The URI of the untitled file\n\t * @returns The content, or undefined\n\t */\n\tgetValue(resource: URI): string | undefined;\n\n\t/**\n\t * Resolves an untitled editor model from the provided options. If the `untitledResource`\n\t * property is provided and the untitled editor exists, it will return that existing\n\t * instance instead of creating a new one.\n\t */\n\tresolve(options?: INewUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: INewUntitledTextEditorWithAssociatedResourceOptions): Promise<IUntitledTextEditorModel>;\n\tresolve(options?: IExistingUntitledTextEditorOptions): Promise<IUntitledTextEditorModel>;\n\n\t/**\n\t * Figures out if the given resource has an associated resource or not.\n\t */\n\tisUntitledWithAssociatedResource(resource: URI): boolean;\n\n\t/**\n\t * Waits for the model to be ready to be disposed. There may be conditions\n\t * under which the model cannot be disposed, e.g. when it is dirty. Once the\n\t * promise is settled, it is safe to dispose the model.\n\t */\n\tcanDispose(model: IUntitledTextEditorModel): true | Promise<true>;\n}\n\nexport interface IUntitledTextEditorService extends IUntitledTextEditorModelManager {\n\n\treadonly _serviceBrand: undefined;\n}\n\nexport class UntitledTextEditorService extends Disposable implements IUntitledTextEditorService {\n\n\tdeclare readonly _serviceBrand: undefined;\n\n\tprivate static readonly UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX = /Untitled-\\d+/;\n\n\tprivate readonly _onDidChangeDirty = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeDirty = this._onDidChangeDirty.event;\n\n\tprivate readonly _onDidChangeEncoding = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeEncoding = this._onDidChangeEncoding.event;\n\n\tprivate readonly _onDidCreate = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidCreate = this._onDidCreate.event;\n\n\tprivate readonly _onWillDispose = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onWillDispose = this._onWillDispose.event;\n\n\tprivate readonly _onDidChangeLabel = this._register(new Emitter<IUntitledTextEditorModel>());\n\treadonly onDidChangeLabel = this._onDidChangeLabel.event;\n\n\tprivate readonly mapResourceToModel = new ResourceMap<UntitledTextEditorModel>();\n\n\tconstructor(\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t}\n\n\tget(resource: URI): UntitledTextEditorModel | undefined {\n\t\treturn this.mapResourceToModel.get(resource);\n\t}\n\n\tgetValue(resource: URI): string | undefined {\n\t\treturn this.get(resource)?.textEditorModel?.getValue();\n\t}\n\n\tasync resolve(options?: IInternalUntitledTextEditorOptions): Promise<UntitledTextEditorModel> {\n\t\tconst model = this.doCreateOrGet(options);\n\t\tawait model.resolve();\n\n\t\treturn model;\n\t}\n\n\tcreate(options?: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\t\treturn this.doCreateOrGet(options);\n\t}\n\n\tprivate doCreateOrGet(options: IInternalUntitledTextEditorOptions = Object.create(null)): UntitledTextEditorModel {\n\t\tconst massagedOptions = this.massageOptions(options);\n\n\t\t// Return existing instance if asked for it\n\t\tif (massagedOptions.untitledResource && this.mapResourceToModel.has(massagedOptions.untitledResource)) {\n\t\t\treturn this.mapResourceToModel.get(massagedOptions.untitledResource)!;\n\t\t}\n\n\t\t// Create new instance otherwise\n\t\treturn this.doCreate(massagedOptions);\n\t}\n\n\tprivate massageOptions(options: IInternalUntitledTextEditorOptions): IInternalUntitledTextEditorOptions {\n\t\tconst massagedOptions: IInternalUntitledTextEditorOptions = Object.create(null);\n\n\t\t// Figure out associated and untitled resource\n\t\tif (options.associatedResource) {\n\t\t\tmassagedOptions.untitledResource = URI.from({\n\t\t\t\tscheme: Schemas.untitled,\n\t\t\t\tauthority: options.associatedResource.authority,\n\t\t\t\tfragment: options.associatedResource.fragment,\n\t\t\t\tpath: options.associatedResource.path,\n\t\t\t\tquery: options.associatedResource.query\n\t\t\t});\n\t\t\tmassagedOptions.associatedResource = options.associatedResource;\n\t\t} else {\n\t\t\tif (options.untitledResource?.scheme === Schemas.untitled) {\n\t\t\t\tmassagedOptions.untitledResource = options.untitledResource;\n\t\t\t}\n\t\t}\n\n\t\t// Language id\n\t\tif (options.languageId) {\n\t\t\tmassagedOptions.languageId = options.languageId;\n\t\t} else if (!massagedOptions.associatedResource) {\n\t\t\tconst configuration = this.configurationService.getValue<IFilesConfiguration>();\n\t\t\tif (configuration.files?.defaultLanguage) {\n\t\t\t\tmassagedOptions.languageId = configuration.files.defaultLanguage;\n\t\t\t}\n\t\t}\n\n\t\t// Take over encoding and initial value\n\t\tmassagedOptions.encoding = options.encoding;\n\t\tmassagedOptions.initialValue = options.initialValue;\n\n\t\treturn massagedOptions;\n\t}\n\n\tprivate doCreate(options: IInternalUntitledTextEditorOptions): UntitledTextEditorModel {\n\n\t\t// Create a new untitled resource if none is provided\n\t\tlet untitledResource = options.untitledResource;\n\t\tif (!untitledResource) {\n\t\t\tlet counter = 1;\n\t\t\tdo {\n\t\t\t\tuntitledResource = URI.from({ scheme: Schemas.untitled, path: `Untitled-${counter}` });\n\t\t\t\tcounter++;\n\t\t\t} while (this.mapResourceToModel.has(untitledResource));\n\t\t}\n\n\t\t// Create new model with provided options\n\t\tconst model = this._register(this.instantiationService.createInstance(UntitledTextEditorModel, untitledResource, !!options.associatedResource, options.initialValue, options.languageId, options.encoding));\n\n\t\tthis.registerModel(model);\n\n\t\treturn model;\n\t}\n\n\tprivate registerModel(model: UntitledTextEditorModel): void {\n\n\t\t// Install model listeners\n\t\tconst modelListeners = new DisposableStore();\n\t\tmodelListeners.add(model.onDidChangeDirty(() => this._onDidChangeDirty.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeName(() => this._onDidChangeLabel.fire(model)));\n\t\tmodelListeners.add(model.onDidChangeEncoding(() => this._onDidChangeEncoding.fire(model)));\n\t\tmodelListeners.add(model.onWillDispose(() => this._onWillDispose.fire(model)));\n\n\t\t// Remove from cache on dispose\n\t\tEvent.once(model.onWillDispose)(() => {\n\n\t\t\t// Registry\n\t\t\tthis.mapResourceToModel.delete(model.resource);\n\n\t\t\t// Listeners\n\t\t\tmodelListeners.dispose();\n\t\t});\n\n\t\t// Add to cache\n\t\tthis.mapResourceToModel.set(model.resource, model);\n\n\t\t// Emit as event\n\t\tthis._onDidCreate.fire(model);\n\n\t\t// If the model is dirty right from the beginning,\n\t\t// make sure to emit this as an event\n\t\tif (model.isDirty()) {\n\t\t\tthis._onDidChangeDirty.fire(model);\n\t\t}\n\t}\n\n\tisUntitledWithAssociatedResource(resource: URI): boolean {\n\t\treturn resource.scheme === Schemas.untitled && resource.path.length > 1 && !UntitledTextEditorService.UNTITLED_WITHOUT_ASSOCIATED_RESOURCE_REGEX.test(resource.path);\n\t}\n\n\tcanDispose(model: UntitledTextEditorModel): true | Promise<true> {\n\t\tif (model.isDisposed()) {\n\t\t\treturn true; // quick return if model already disposed\n\t\t}\n\n\t\t// promise based return in all other cases\n\t\treturn this.doCanDispose(model);\n\t}\n\n\tprivate async doCanDispose(model: UntitledTextEditorModel): Promise<true> {\n\n\t\t// dirty model: we do not allow to dispose dirty models to prevent\n\t\t// data loss cases. dirty models can only be disposed when they are\n\t\t// either saved or reverted\n\t\tif (model.isDirty()) {\n\t\t\tawait Event.toPromise(model.onDidChangeDirty);\n\n\t\t\treturn this.canDispose(model);\n\t\t}\n\n\t\treturn true;\n\t}\n}\n\nregisterSingleton(IUntitledTextEditorService, UntitledTextEditorService, InstantiationType.Delayed);\n"],
  "mappings": "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",
  "names": []
}
