var g=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var c=(a,o,e,t)=>{for(var i=t>1?void 0:t?f(o,e):o,d=a.length-1,n;d>=0;d--)(n=a[d])&&(i=(t?n(o,e,i):n(i))||i);return t&&i&&g(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import"../../../../base/common/uri.js";import{DEFAULT_EDITOR_ASSOCIATION as v,findViewStateForEditor as I,isUntitledResourceEditorInput as E,Verbosity as S}from"../../../common/editor.js";import"../../../common/editor/editorInput.js";import{AbstractTextResourceEditorInput as M}from"../../../common/editor/textResourceEditorInput.js";import"./untitledTextEditorModel.js";import{ITextFileService as R}from"../../textfile/common/textfiles.js";import{ILabelService as D}from"../../../../platform/label/common/label.js";import{IEditorService as x}from"../../editor/common/editorService.js";import{IFileService as y}from"../../../../platform/files/common/files.js";import{isEqual as l,toLocalResource as T}from"../../../../base/common/resources.js";import{IWorkbenchEnvironmentService as U}from"../../environment/common/environmentService.js";import{IPathService as b}from"../../path/common/pathService.js";import"../../../../platform/editor/common/editor.js";import{IFilesConfigurationService as L}from"../../filesConfiguration/common/filesConfigurationService.js";import{ITextModelService as C}from"../../../../editor/common/services/resolverService.js";import{DisposableStore as F,dispose as A}from"../../../../base/common/lifecycle.js";import{ITextResourceConfigurationService as P}from"../../../../editor/common/services/textResourceConfiguration.js";import{ICustomEditorLabelService as w}from"../../editor/common/customEditorLabelService.js";let s=class extends M{constructor(e,t,i,d,n,O,V,u,N,h,p){super(e.resource,void 0,d,t,i,n,u,h,p);this.model=e;this.environmentService=O;this.pathService=V;this.textModelService=N;this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate(m=>this.onDidCreateUntitledModel(m)))}static ID="workbench.editors.untitledEditorInput";get typeId(){return s.ID}get editorId(){return v.id}modelResolve=void 0;modelDisposables=this._register(new F);cachedUntitledTextEditorModelReference=void 0;registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelDisposables.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this.modelDisposables.add(e.onDidRevert(()=>this.dispose()))}onDidCreateUntitledModel(e){l(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=S.MEDIUM){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t} \u2022 ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?T(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=I(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&!e.preserveResource&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof s?l(e.resource,this.resource):E(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){A(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};s=c([r(1,R),r(2,D),r(3,x),r(4,y),r(5,U),r(6,b),r(7,L),r(8,C),r(9,P),r(10,w)],s);export{s as UntitledTextEditorInput};
