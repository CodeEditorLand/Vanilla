var g=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var c=(a,o,e,t)=>{for(var i=t>1?void 0:t?f(o,e):o,d=a.length-1,n;d>=0;d--)(n=a[d])&&(i=(t?n(o,e,i):n(i))||i);return t&&i&&g(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import{DisposableStore as v,dispose as I}from"../../../../../vs/base/common/lifecycle.js";import{isEqual as l,toLocalResource as E}from"../../../../../vs/base/common/resources.js";import"../../../../../vs/base/common/uri.js";import{ITextModelService as S}from"../../../../../vs/editor/common/services/resolverService.js";import{ITextResourceConfigurationService as M}from"../../../../../vs/editor/common/services/textResourceConfiguration.js";import"../../../../../vs/platform/editor/common/editor.js";import{IFileService as R}from"../../../../../vs/platform/files/common/files.js";import{ILabelService as D}from"../../../../../vs/platform/label/common/label.js";import{DEFAULT_EDITOR_ASSOCIATION as x,findViewStateForEditor as y,isUntitledResourceEditorInput as T,Verbosity as U}from"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/common/editor/editorInput.js";import{AbstractTextResourceEditorInput as b}from"../../../../../vs/workbench/common/editor/textResourceEditorInput.js";import{ICustomEditorLabelService as L}from"../../../../../vs/workbench/services/editor/common/customEditorLabelService.js";import{IEditorService as C}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as F}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IFilesConfigurationService as A}from"../../../../../vs/workbench/services/filesConfiguration/common/filesConfigurationService.js";import{IPathService as P}from"../../../../../vs/workbench/services/path/common/pathService.js";import{ITextFileService as w}from"../../../../../vs/workbench/services/textfile/common/textfiles.js";import"../../../../../vs/workbench/services/untitled/common/untitledTextEditorModel.js";let s=class extends b{constructor(e,t,i,d,n,O,V,u,N,h,p){super(e.resource,void 0,d,t,i,n,u,h,p);this.model=e;this.environmentService=O;this.pathService=V;this.textModelService=N;this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate(m=>this.onDidCreateUntitledModel(m)))}static ID="workbench.editors.untitledEditorInput";get typeId(){return s.ID}get editorId(){return x.id}modelResolve=void 0;modelDisposables=this._register(new v);cachedUntitledTextEditorModelReference=void 0;registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelDisposables.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this.modelDisposables.add(e.onDidRevert(()=>this.dispose()))}onDidCreateUntitledModel(e){l(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=U.MEDIUM){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t} \u2022 ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?E(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=y(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&!e.preserveResource&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof s?l(e.resource,this.resource):T(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){I(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};s=c([r(1,w),r(2,D),r(3,C),r(4,R),r(5,F),r(6,P),r(7,A),r(8,S),r(9,M),r(10,L)],s);export{s as UntitledTextEditorInput};
