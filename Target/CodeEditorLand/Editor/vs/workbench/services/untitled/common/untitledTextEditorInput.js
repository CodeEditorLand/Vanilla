var g=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var c=(a,o,e,t)=>{for(var i=t>1?void 0:t?f(o,e):o,s=a.length-1,n;s>=0;s--)(n=a[s])&&(i=(t?n(o,e,i):n(i))||i);return t&&i&&g(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import{DisposableStore as v,dispose as I}from"../../../../base/common/lifecycle.js";import{isEqual as l,toLocalResource as E}from"../../../../base/common/resources.js";import{ITextModelService as S}from"../../../../editor/common/services/resolverService.js";import{ITextResourceConfigurationService as y}from"../../../../editor/common/services/textResourceConfiguration.js";import{IFileService as M}from"../../../../platform/files/common/files.js";import{ILabelService as R}from"../../../../platform/label/common/label.js";import{DEFAULT_EDITOR_ASSOCIATION as x,Verbosity as D,findViewStateForEditor as T,isUntitledResourceEditorInput as U}from"../../../common/editor.js";import{AbstractTextResourceEditorInput as b}from"../../../common/editor/textResourceEditorInput.js";import{ICustomEditorLabelService as L}from"../../editor/common/customEditorLabelService.js";import{IEditorService as C}from"../../editor/common/editorService.js";import{IWorkbenchEnvironmentService as F}from"../../environment/common/environmentService.js";import{IFilesConfigurationService as A}from"../../filesConfiguration/common/filesConfigurationService.js";import{IPathService as P}from"../../path/common/pathService.js";import{ITextFileService as w}from"../../textfile/common/textfiles.js";let d=class extends b{constructor(e,t,i,s,n,O,V,p,N,u,m){super(e.resource,void 0,s,t,i,n,p,u,m);this.model=e;this.environmentService=O;this.pathService=V;this.textModelService=N;this.registerModelListeners(e),this._register(this.textFileService.untitled.onDidCreate(h=>this.onDidCreateUntitledModel(h)))}static ID="workbench.editors.untitledEditorInput";get typeId(){return d.ID}get editorId(){return x.id}modelResolve=void 0;modelDisposables=this._register(new v);cachedUntitledTextEditorModelReference=void 0;registerModelListeners(e){this.modelDisposables.clear(),this.modelDisposables.add(e.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this.modelDisposables.add(e.onDidChangeName(()=>this._onDidChangeLabel.fire())),this.modelDisposables.add(e.onDidRevert(()=>this.dispose()))}onDidCreateUntitledModel(e){l(e.resource,this.model.resource)&&e!==this.model&&(this.model=e,this.registerModelListeners(e))}getName(){return this.model.name}getDescription(e=D.MEDIUM){if(!this.model.hasAssociatedFilePath){const t=this.resource.path;return t!==this.getName()?t:void 0}return super.getDescription(e)}getTitle(e){if(!this.model.hasAssociatedFilePath){const t=this.getName(),i=this.getDescription();return i&&i!==t?`${t} \u2022 ${i}`:t}return super.getTitle(e)}isDirty(){return this.model.isDirty()}getEncoding(){return this.model.getEncoding()}setEncoding(e,t){return this.model.setEncoding(e)}get hasLanguageSetExplicitly(){return this.model.hasLanguageSetExplicitly}get hasAssociatedFilePath(){return this.model.hasAssociatedFilePath}setLanguageId(e,t){this.model.setLanguageId(e,t)}getLanguageId(){return this.model.getLanguageId()}async resolve(){return this.modelResolve||(this.modelResolve=(async()=>{this.cachedUntitledTextEditorModelReference=await this.textModelService.createModelReference(this.resource)})()),await this.modelResolve,this.isDisposed()&&this.disposeModelReference(),this.model}toUntyped(e){const t={resource:this.model.hasAssociatedFilePath?E(this.model.resource,this.environmentService.remoteAuthority,this.pathService.defaultUriScheme):this.resource,forceUntitled:!0,options:{override:this.editorId}};return typeof e?.preserveViewState=="number"&&(t.encoding=this.getEncoding(),t.languageId=this.getLanguageId(),t.contents=this.model.isModified()?this.model.textEditorModel?.getValue():void 0,t.options.viewState=T(this,e.preserveViewState,this.editorService),typeof t.contents=="string"&&!this.model.hasAssociatedFilePath&&!e.preserveResource&&(t.resource=void 0)),t}matches(e){return this===e?!0:e instanceof d?l(e.resource,this.resource):U(e)?super.matches(e):!1}dispose(){this.modelResolve=void 0,this.disposeModelReference(),super.dispose()}disposeModelReference(){I(this.cachedUntitledTextEditorModelReference),this.cachedUntitledTextEditorModelReference=void 0}};d=c([r(1,w),r(2,R),r(3,C),r(4,M),r(5,F),r(6,P),r(7,A),r(8,S),r(9,y),r(10,L)],d);export{d as UntitledTextEditorInput};
