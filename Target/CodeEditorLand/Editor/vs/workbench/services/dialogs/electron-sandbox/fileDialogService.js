var w=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var d=(n,o,e,i)=>{for(var t=i>1?void 0:i?U(o,e):o,a=n.length-1,s;a>=0;a--)(s=n[a])&&(t=(i?s(o,e,t):s(t))||t);return i&&t&&w(o,e,t),t},r=(n,o)=>(e,i)=>o(e,i,n);import{getActiveWindow as f}from"../../../../../vs/base/browser/dom.js";import{Schemas as m}from"../../../../../vs/base/common/network.js";import{URI as p}from"../../../../../vs/base/common/uri.js";import"../../../../../vs/base/parts/sandbox/common/electronTypes.js";import{ICodeEditorService as y}from"../../../../../vs/editor/browser/services/codeEditorService.js";import{ILanguageService as A}from"../../../../../vs/editor/common/languages/language.js";import{ICommandService as W}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as N}from"../../../../../vs/platform/configuration/common/configuration.js";import{IDialogService as H,IFileDialogService as b}from"../../../../../vs/platform/dialogs/common/dialogs.js";import{IFileService as L}from"../../../../../vs/platform/files/common/files.js";import{InstantiationType as C,registerSingleton as E}from"../../../../../vs/platform/instantiation/common/extensions.js";import{IInstantiationService as x}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{ILabelService as R}from"../../../../../vs/platform/label/common/label.js";import{ILogService as T}from"../../../../../vs/platform/log/common/log.js";import{INativeHostService as V}from"../../../../../vs/platform/native/common/native.js";import{IOpenerService as M}from"../../../../../vs/platform/opener/common/opener.js";import{IWorkspaceContextService as j}from"../../../../../vs/platform/workspace/common/workspace.js";import{IWorkspacesService as q}from"../../../../../vs/platform/workspaces/common/workspaces.js";import{AbstractFileDialogService as z}from"../../../../../vs/workbench/services/dialogs/browser/abstractFileDialogService.js";import{IEditorService as B}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as G}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IHistoryService as J}from"../../../../../vs/workbench/services/history/common/history.js";import{IHostService as K}from"../../../../../vs/workbench/services/host/browser/host.js";import{IPathService as Q}from"../../../../../vs/workbench/services/path/common/pathService.js";let l=class extends z{constructor(e,i,t,a,s,c,S,h,X,v,u,I,g,O,D,F,P,k){super(e,i,t,a,s,c,S,h,v,u,I,g,O,D,F,P,k);this.nativeHostService=X}toNativeOpenDialogOptions(e){return{forceNewWindow:e.forceNewWindow,telemetryExtraData:e.telemetryExtraData,defaultPath:e.defaultUri?.fsPath}}shouldUseSimplified(e){const i=this.configurationService.getValue("files.simpleDialog.enable")===!0,t=this.configurationService.getValue("window.openFilesInNewWindow")==="on";return{useSimplified:e!==m.file&&e!==m.vscodeUserData||i,isSetting:t}}async pickFileFolderAndOpen(e){const i=this.getFileSystemSchema(e);e.defaultUri||(e.defaultUri=await this.defaultFilePath(i));const t=this.shouldUseSimplified(i);return t.useSimplified?this.pickFileFolderAndOpenSimplified(i,e,t.isSetting):this.nativeHostService.pickFileFolderAndOpen(this.toNativeOpenDialogOptions(e))}async pickFileAndOpen(e){const i=this.getFileSystemSchema(e);e.defaultUri||(e.defaultUri=await this.defaultFilePath(i));const t=this.shouldUseSimplified(i);return t.useSimplified?this.pickFileAndOpenSimplified(i,e,t.isSetting):this.nativeHostService.pickFileAndOpen(this.toNativeOpenDialogOptions(e))}async pickFolderAndOpen(e){const i=this.getFileSystemSchema(e);return e.defaultUri||(e.defaultUri=await this.defaultFolderPath(i)),this.shouldUseSimplified(i).useSimplified?this.pickFolderAndOpenSimplified(i,e):this.nativeHostService.pickFolderAndOpen(this.toNativeOpenDialogOptions(e))}async pickWorkspaceAndOpen(e){e.availableFileSystems=this.getWorkspaceAvailableFileSystems(e);const i=this.getFileSystemSchema(e);return e.defaultUri||(e.defaultUri=await this.defaultWorkspacePath(i)),this.shouldUseSimplified(i).useSimplified?this.pickWorkspaceAndOpenSimplified(i,e):this.nativeHostService.pickWorkspaceAndOpen(this.toNativeOpenDialogOptions(e))}async pickFileToSave(e,i){const t=this.getFileSystemSchema({defaultUri:e,availableFileSystems:i}),a=this.getPickFileToSaveDialogOptions(e,i);if(this.shouldUseSimplified(t).useSimplified)return this.pickFileToSaveSimplified(t,a);{const s=await this.nativeHostService.showSaveDialog(this.toNativeSaveDialogOptions(a));if(s&&!s.canceled&&s.filePath){const c=p.file(s.filePath);return this.addFileToRecentlyOpened(c),c}}}toNativeSaveDialogOptions(e){return e.defaultUri=e.defaultUri?p.file(e.defaultUri.path):void 0,{defaultPath:e.defaultUri?.fsPath,buttonLabel:e.saveLabel,filters:e.filters,title:e.title,targetWindowId:f().vscodeWindowId}}async showSaveDialog(e){const i=this.getFileSystemSchema(e);if(this.shouldUseSimplified(i).useSimplified)return this.showSaveDialogSimplified(i,e);const t=await this.nativeHostService.showSaveDialog(this.toNativeSaveDialogOptions(e));if(t&&!t.canceled&&t.filePath)return p.file(t.filePath)}async showOpenDialog(e){const i=this.getFileSystemSchema(e);if(this.shouldUseSimplified(i).useSimplified)return this.showOpenDialogSimplified(i,e);const t={title:e.title,defaultPath:e.defaultUri?.fsPath,buttonLabel:e.openLabel,filters:e.filters,properties:[],targetWindowId:f().vscodeWindowId};t.properties.push("createDirectory"),e.canSelectFiles&&t.properties.push("openFile"),e.canSelectFolders&&t.properties.push("openDirectory"),e.canSelectMany&&t.properties.push("multiSelections");const a=await this.nativeHostService.showOpenDialog(t);return a&&Array.isArray(a.filePaths)&&a.filePaths.length>0?a.filePaths.map(p.file):void 0}};l=d([r(0,K),r(1,j),r(2,J),r(3,G),r(4,x),r(5,N),r(6,L),r(7,M),r(8,V),r(9,H),r(10,A),r(11,q),r(12,R),r(13,Q),r(14,W),r(15,B),r(16,y),r(17,T)],l),E(b,l,C.Delayed);export{l as FileDialogService};
