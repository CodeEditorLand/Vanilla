var S=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var h=(a,t,e,r)=>{for(var i=r>1?void 0:r?E(t,e):t,n=a.length-1,s;n>=0;n--)(s=a[n])&&(i=(r?s(t,e,i):s(i))||i);return r&&i&&S(t,e,i),i},m=(a,t)=>(e,r)=>t(e,r,a);import{Event as g}from"../../../base/common/event.js";import"../../../base/common/htmlContent.js";import"../../../base/common/uri.js";import{localize as v}from"../../../nls.js";import"../../../platform/instantiation/common/instantiation.js";import{Registry as D}from"../../../platform/registry/common/platform.js";import{EditorInputCapabilities as o,EditorExtensions as z,isResourceSideBySideEditorInput as c,isDiffEditorInput as b,isResourceDiffEditorInput as u,findViewStateForEditor as f,isEditorInput as C,isResourceEditorInput as N,isResourceMergeEditorInput as I,isResourceMultiDiffEditorInput as l}from"../editor.js";import{EditorInput as y}from"./editorInput.js";import{IEditorService as T}from"../../services/editor/common/editorService.js";let d=class extends y{constructor(e,r,i,n,s){super();this.preferredName=e;this.preferredDescription=r;this.secondary=i;this.primary=n;this.editorService=s;this.registerListeners()}static ID="workbench.editorinputs.sidebysideEditorInput";get typeId(){return d.ID}get capabilities(){let e=this.primary.capabilities;return e&=~o.CanSplitInGroup,this.secondary.hasCapability(o.RequiresTrust)&&(e|=o.RequiresTrust),this.secondary.hasCapability(o.Singleton)&&(e|=o.Singleton),e|=o.MultipleEditors,e}get resource(){if(this.hasIdenticalSides)return this.primary.resource}hasIdenticalSides=this.primary.matches(this.secondary);registerListeners(){this._register(g.once(g.any(this.primary.onWillDispose,this.secondary.onWillDispose))(()=>{this.isDisposed()||this.dispose()})),this._register(this.primary.onDidChangeDirty(()=>this._onDidChangeDirty.fire())),this._register(this.primary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.secondary.onDidChangeCapabilities(()=>this._onDidChangeCapabilities.fire())),this._register(this.primary.onDidChangeLabel(()=>this._onDidChangeLabel.fire())),this._register(this.secondary.onDidChangeLabel(()=>this._onDidChangeLabel.fire()))}getName(){const e=this.getPreferredName();return e||(this.hasIdenticalSides?this.primary.getName():v("sideBySideLabels","{0} - {1}",this.secondary.getName(),this.primary.getName()))}getPreferredName(){return this.preferredName}getDescription(e){const r=this.getPreferredDescription();return r||(this.hasIdenticalSides?this.primary.getDescription(e):super.getDescription(e))}getPreferredDescription(){return this.preferredDescription}getTitle(e){let r;this.hasIdenticalSides?r=this.primary.getTitle(e)??this.getName():r=super.getTitle(e);const i=this.getPreferredTitle();return i&&(r=`${i} (${r})`),r}getPreferredTitle(){if(this.preferredName&&this.preferredDescription)return`${this.preferredName} ${this.preferredDescription}`;if(this.preferredName||this.preferredDescription)return this.preferredName??this.preferredDescription}getLabelExtraClasses(){return this.hasIdenticalSides?this.primary.getLabelExtraClasses():super.getLabelExtraClasses()}getAriaLabel(){return this.hasIdenticalSides?this.primary.getAriaLabel():super.getAriaLabel()}getTelemetryDescriptor(){return{...this.primary.getTelemetryDescriptor(),...super.getTelemetryDescriptor()}}isDirty(){return this.primary.isDirty()}isSaving(){return this.primary.isSaving()}async save(e,r){const i=await this.primary.save(e,r);return this.saveResultToEditor(i)}async saveAs(e,r){const i=await this.primary.saveAs(e,r);return this.saveResultToEditor(i)}saveResultToEditor(e){if(!e||!this.hasIdenticalSides)return e;if(this.primary.matches(e))return this;if(e instanceof y)return new d(this.preferredName,this.preferredDescription,e,e,this.editorService);if(!u(e)&&!l(e)&&!c(e)&&!I(e))return{primary:e,secondary:e,label:this.preferredName,description:this.preferredDescription}}revert(e,r){return this.primary.revert(e,r)}async rename(e,r){if(!this.hasIdenticalSides)return;const i=await this.primary.rename(e,r);if(i){if(C(i.editor))return{editor:new d(this.preferredName,this.preferredDescription,i.editor,i.editor,this.editorService),options:{...i.options,viewState:f(this,e,this.editorService)}};if(N(i.editor))return{editor:{label:this.preferredName,description:this.preferredDescription,primary:i.editor,secondary:i.editor,options:{...i.options,viewState:f(this,e,this.editorService)}}}}}isReadonly(){return this.primary.isReadonly()}toUntyped(e){const r=this.primary.toUntyped(e),i=this.secondary.toUntyped(e);if(r&&i&&!u(r)&&!u(i)&&!l(r)&&!l(i)&&!c(r)&&!c(i)&&!I(r)&&!I(i)){const n={label:this.preferredName,description:this.preferredDescription,primary:r,secondary:i};return typeof e?.preserveViewState=="number"&&(n.options={viewState:f(this,e.preserveViewState,this.editorService)}),n}}matches(e){return this===e?!0:b(e)||u(e)?!1:e instanceof d?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):c(e)?this.primary.matches(e.primary)&&this.secondary.matches(e.secondary):!1}};d=h([m(4,T)],d);class R{canSerialize(t){const e=t;if(e.primary&&e.secondary){const[r,i]=this.getSerializers(e.secondary.typeId,e.primary.typeId);return!!(r?.canSerialize(e.secondary)&&i?.canSerialize(e.primary))}return!1}serialize(t){const e=t;if(e.primary&&e.secondary){const[r,i]=this.getSerializers(e.secondary.typeId,e.primary.typeId);if(i&&r){const n=i.serialize(e.primary),s=r.serialize(e.secondary);if(n&&s){const p={name:e.getPreferredName(),description:e.getPreferredDescription(),primarySerialized:n,secondarySerialized:s,primaryTypeId:e.primary.typeId,secondaryTypeId:e.secondary.typeId};return JSON.stringify(p)}}}}deserialize(t,e){const r=JSON.parse(e),[i,n]=this.getSerializers(r.secondaryTypeId,r.primaryTypeId);if(n&&i){const s=n.deserialize(t,r.primarySerialized),p=i.deserialize(t,r.secondarySerialized);if(s instanceof y&&p instanceof y)return this.createEditorInput(t,r.name,r.description,p,s)}}getSerializers(t,e){const r=D.as(z.EditorFactory);return[r.getEditorSerializer(t),r.getEditorSerializer(e)]}}class Z extends R{createEditorInput(t,e,r,i,n){return t.createInstance(d,e,r,i,n)}}export{R as AbstractSideBySideEditorInputSerializer,d as SideBySideEditorInput,Z as SideBySideEditorInputSerializer};
