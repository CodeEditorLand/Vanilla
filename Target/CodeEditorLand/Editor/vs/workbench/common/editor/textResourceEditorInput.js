var y=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var v=(f,n,e,r)=>{for(var o=r>1?void 0:r?T(n,e):n,t=f.length-1,s;t>=0;t--)(s=f[t])&&(o=(r?s(n,e,o):s(o))||o);return r&&o&&y(n,e,o),o},i=(f,n)=>(e,r)=>n(e,r,f);import{DEFAULT_EDITOR_ASSOCIATION as M,isResourceEditorInput as U}from"../editor.js";import{AbstractResourceEditorInput as b}from"./resourceEditorInput.js";import{ITextFileService as m}from"../../services/textfile/common/textfiles.js";import{IEditorService as I}from"../../services/editor/common/editorService.js";import{IFileService as g}from"../../../platform/files/common/files.js";import{ILabelService as h}from"../../../platform/label/common/label.js";import{Schemas as P}from"../../../base/common/network.js";import{isEqual as O}from"../../../base/common/resources.js";import{ITextModelService as D}from"../../../editor/common/services/resolverService.js";import{TextResourceEditorModel as w}from"./textResourceEditorModel.js";import{createTextBufferFactory as G}from"../../../editor/common/model/textModel.js";import{IFilesConfigurationService as S}from"../../services/filesConfiguration/common/filesConfigurationService.js";import{ITextResourceConfigurationService as x}from"../../../editor/common/services/textResourceConfiguration.js";import{ICustomEditorLabelService as L}from"../../services/editor/common/customEditorLabelService.js";let a=class extends b{constructor(e,r,o,t,s,l,c,u,p){super(e,r,s,l,c,u,p);this.editorService=o;this.textFileService=t}save(e,r){return this.resource.scheme!==P.untitled&&!this.fileService.hasProvider(this.resource)?this.saveAs(e,r):this.doSave(r,!1,e)}saveAs(e,r){return this.doSave(r,!0,e)}async doSave(e,r,o){let t;if(r?t=await this.textFileService.saveAs(this.resource,void 0,{...e,suggestedTarget:this.preferredResource}):t=await this.textFileService.save(this.resource,e),!!t)return{resource:t}}async revert(e,r){await this.textFileService.revert(this.resource,r)}};a=v([i(2,I),i(3,m),i(4,h),i(5,g),i(6,S),i(7,x),i(8,L)],a);let d=class extends a{constructor(e,r,o,t,s,l,c,u,p,R,E,F,C){super(e,void 0,u,c,R,p,E,F,C);this.name=r;this.description=o;this.preferredLanguageId=t;this.preferredContents=s;this.textModelService=l}static ID="workbench.editors.resourceEditorInput";get typeId(){return d.ID}get editorId(){return M.id}cachedModel=void 0;modelReference=void 0;getName(){return this.name||super.getName()}setName(e){this.name!==e&&(this.name=e,this._onDidChangeLabel.fire())}getDescription(){return this.description}setDescription(e){this.description!==e&&(this.description=e,this._onDidChangeLabel.fire())}setLanguageId(e,r){this.setPreferredLanguageId(e),this.cachedModel?.setLanguageId(e,r)}setPreferredLanguageId(e){this.preferredLanguageId=e}setPreferredContents(e){this.preferredContents=e}async resolve(){const e=this.preferredContents,r=this.preferredLanguageId;this.preferredContents=void 0,this.preferredLanguageId=void 0,this.modelReference||(this.modelReference=this.textModelService.createModelReference(this.resource));const o=await this.modelReference,t=o.object;if(!(t instanceof w))throw o.dispose(),this.modelReference=void 0,new Error(`Unexpected model for TextResourceEditorInput: ${this.resource}`);return this.cachedModel=t,(typeof e=="string"||typeof r=="string")&&t.updateTextEditorModel(typeof e=="string"?G(e):void 0,r),t}matches(e){return this===e?!0:e instanceof d?O(e.resource,this.resource):U(e)?super.matches(e):!1}dispose(){this.modelReference&&(this.modelReference.then(e=>e.dispose()),this.modelReference=void 0),this.cachedModel=void 0,super.dispose()}};d=v([i(5,D),i(6,m),i(7,I),i(8,g),i(9,h),i(10,S),i(11,x),i(12,L)],d);export{a as AbstractTextResourceEditorInput,d as TextResourceEditorInput};
