import{onUnexpectedExternalError as u}from"../../../../base/common/errors.js";import"../../../../base/common/lifecycle.js";import"../../../services/search/common/search.js";import"../../../../editor/common/languages.js";import{IWorkspaceContextService as f}from"../../../../platform/workspace/common/workspace.js";import"../../../../base/common/uri.js";import{EditorResourceAccessor as b,SideBySideEditor as y}from"../../../common/editor.js";import{IEditorService as S}from"../../../services/editor/common/editorService.js";import{CancellationToken as g}from"../../../../base/common/cancellation.js";import"../../../../platform/instantiation/common/instantiation.js";import{IFileService as I}from"../../../../platform/files/common/files.js";import{Range as c}from"../../../../editor/common/core/range.js";import{isNumber as l}from"../../../../base/common/types.js";import{RawContextKey as k}from"../../../../platform/contextkey/common/contextkey.js";import{compare as m}from"../../../../base/common/strings.js";import{groupBy as v}from"../../../../base/common/arrays.js";var p;(o=>{const r=[];function a(s){let e=s;return e&&r.push(e),{dispose(){if(e){const n=r.indexOf(e);n>=0&&(r.splice(n,1),e=void 0)}}}}o.register=a;function t(){return r.slice(0)}o.all=t})(p||={});class W{constructor(a,t){this.symbol=a;this.provider=t}}async function Q(r,a=g.None){const t=[],o=p.all().map(async e=>{try{const n=await e.provideWorkspaceSymbols(r,a);if(!n)return;for(const i of n)t.push(new W(i,e))}catch(n){u(n)}});if(await Promise.all(o),a.isCancellationRequested)return[];function s(e,n){let i=m(e.symbol.name,n.symbol.name);return i===0&&(i=e.symbol.kind-n.symbol.kind),i===0&&(i=m(e.symbol.location.uri.toString(),n.symbol.location.uri.toString())),i===0&&(e.symbol.location.range&&n.symbol.location.range?c.areIntersecting(e.symbol.location.range,n.symbol.location.range)||(i=c.compareRangesUsingStarts(e.symbol.location.range,n.symbol.location.range)):e.provider.resolveWorkspaceSymbol&&!n.provider.resolveWorkspaceSymbol?i=-1:!e.provider.resolveWorkspaceSymbol&&n.provider.resolveWorkspaceSymbol&&(i=1)),i===0&&(i=m(e.symbol.containerName??"",n.symbol.containerName??"")),i}return v(t,s).map(e=>e[0]).flat()}function V(r){const a=r.get(S),t=r.get(f),o=r.get(I);return a.editors.map(e=>b.getOriginalUri(e,{supportSideBySide:y.PRIMARY})).filter(e=>!!e&&!t.isInsideWorkspace(e)&&o.hasProvider(e))}const d=/\s?[#:\(](?:line )?(\d*)(?:[#:,](\d*))?\)?:?\s*$/;function X(r,a){if(!r||a?.some(s=>{const e=r.indexOf(s);return e===0||e>0&&!d.test(r.substring(e+1))}))return;let t;const o=d.exec(r);if(o){const s=parseInt(o[1]??"",10);if(l(s)){t={startLineNumber:s,startColumn:1,endLineNumber:s,endColumn:1};const e=parseInt(o[2]??"",10);l(e)&&(t={startLineNumber:t.startLineNumber,startColumn:e,endLineNumber:t.endLineNumber,endColumn:e})}else o[1]===""&&(t={startLineNumber:1,startColumn:1,endLineNumber:1,endColumn:1})}if(o&&t)return{filter:r.substr(0,o.index),range:t}}var x=(o=>(o[o.Idle=0]="Idle",o[o.Searching=1]="Searching",o[o.SlowSearch=2]="SlowSearch",o))(x||{});const Z=new k("searchState",0);export{Z as SearchStateKey,x as SearchUIState,W as WorkspaceSymbolItem,p as WorkspaceSymbolProviderRegistry,X as extractRangeFromFilter,V as getOutOfWorkspaceEditorResources,Q as getWorkspaceSymbols};
