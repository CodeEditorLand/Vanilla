import{KeyCode as f,KeyMod as d}from"../../../../base/common/keyCodes.js";import{isWindows as W}from"../../../../base/common/platform.js";import*as g from"../../../../nls.js";import{Action2 as S,MenuId as p,registerAction2 as C}from"../../../../platform/actions/common/actions.js";import{IClipboardService as y}from"../../../../platform/clipboard/common/clipboardService.js";import"../../../../platform/instantiation/common/instantiation.js";import{KeybindingWeight as F}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{ILabelService as M}from"../../../../platform/label/common/label.js";import{IViewsService as A}from"../../../services/views/common/viewsService.js";import*as c from"../common/constants.js";import{category as x,getSearchView as L}from"./searchActionsBase.js";import{FileMatch as b,FolderMatch as K,FolderMatchWithResource as T,Match as $,searchMatchComparer as v}from"./searchModel.js";C(class extends S{constructor(){super({id:c.SearchCommandIds.CopyMatchCommandId,title:g.localize2("copyMatchLabel","Copy"),category:x,keybinding:{weight:F.WorkbenchContrib,when:c.SearchContext.FileMatchOrMatchFocusKey,primary:d.CtrlCmd|f.KeyC},menu:[{id:p.SearchContext,when:c.SearchContext.FileMatchOrMatchFocusKey,group:"search_2",order:1}]})}async run(t,r){await O(t,r)}}),C(class extends S{constructor(){super({id:c.SearchCommandIds.CopyPathCommandId,title:g.localize2("copyPathLabel","Copy Path"),category:x,keybinding:{weight:F.WorkbenchContrib,when:c.SearchContext.FileMatchOrFolderMatchWithResourceFocusKey,primary:d.CtrlCmd|d.Alt|f.KeyC,win:{primary:d.Shift|d.Alt|f.KeyC}},menu:[{id:p.SearchContext,when:c.SearchContext.FileMatchOrFolderMatchWithResourceFocusKey,group:"search_2",order:2}]})}async run(t,r){await z(t,r)}}),C(class extends S{constructor(){super({id:c.SearchCommandIds.CopyAllCommandId,title:g.localize2("copyAllLabel","Copy All"),category:x,menu:[{id:p.SearchContext,when:c.SearchContext.HasSearchResults,group:"search_2",order:3}]})}async run(t){await V(t)}});const s=W?`\r
`:`
`;async function z(e,t){if(!t){const i=P(e);if(!(i instanceof b||i instanceof T))return;t=i}const r=e.get(y),n=e.get(M).getUriLabel(t.resource,{noPrefix:!0});await r.writeText(n)}async function O(e,t){if(!t){const i=P(e);if(!i)return;t=i}const r=e.get(y),o=e.get(M);let n;t instanceof $?n=R(t):t instanceof b?n=I(t,o).text:t instanceof K&&(n=w(t,o).text),n&&await r.writeText(n)}async function V(e){const t=e.get(A),r=e.get(y),o=e.get(M),n=L(t);if(n){const i=n.searchResult,a=k(i.folderMatches(),o);await r.writeText(a)}}function R(e,t=0){const r=()=>`${e.range().startLineNumber},${e.range().startColumn}`,o=l=>e.range().startLineNumber+l+"",n=e.fullPreviewLines(),i=n.reduce((l,h,u)=>{const m=u===0?r().length:o(u).length;return Math.max(m,l)},0);return n.map((l,h)=>{const u=h===0?r():o(h),m=" ".repeat(i-u.length);return`${" ".repeat(t)}${u}: ${m}${l}`}).join(`
`)}function j(e,t){return e instanceof b?I(e,t):w(e,t)}function I(e,t){const r=e.matches().sort(v).map(n=>R(n,2));return{text:`${t.getUriLabel(e.resource,{noPrefix:!0})}${s}${r.join(s)}`,count:r.length}}function w(e,t){const r=[];let o=0;return e.matches().sort(v).forEach(i=>{const a=j(i,t);o+=a.count,r.push(a.text)}),{text:r.join(s+s),count:o}}function k(e,t){const r=[];e=e.sort(v);for(let o=0;o<e.length;o++){const n=w(e[o],t);n.count&&r.push(n.text)}return r.join(s+s)}function P(e){const t=e.get(A);return L(t)?.getControl().getSelection()[0]}export{s as lineDelimiter};
