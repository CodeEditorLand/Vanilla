var D=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var R=(u,s,e,o)=>{for(var i=o>1?void 0:o?F(s,e):s,r=u.length-1,t;r>=0;r--)(t=u[r])&&(i=(o?t(s,e,i):t(i))||i);return o&&i&&D(s,e,i),i},m=(u,s)=>(e,o)=>s(e,o,u);import{ThrottledDelayer as N}from"../../../../base/common/async.js";import{Codicon as w}from"../../../../base/common/codicons.js";import{pieceToQuery as M,prepareQuery as A,scoreFuzzy2 as P}from"../../../../base/common/fuzzyScorer.js";import{Schemas as _}from"../../../../base/common/network.js";import{ThemeIcon as W}from"../../../../base/common/themables.js";import{ICodeEditorService as G}from"../../../../editor/browser/services/codeEditorService.js";import{Range as K}from"../../../../editor/common/core/range.js";import{SymbolKind as l,SymbolKinds as v,SymbolTag as Y}from"../../../../editor/common/languages.js";import{getSelectionSearchString as x}from"../../../../editor/contrib/find/browser/findController.js";import{localize as C}from"../../../../nls.js";import{IConfigurationService as j}from"../../../../platform/configuration/common/configuration.js";import{ILabelService as U}from"../../../../platform/label/common/label.js";import{IOpenerService as $}from"../../../../platform/opener/common/opener.js";import{PickerQuickAccessProvider as z,TriggerAction as V}from"../../../../platform/quickinput/browser/pickerQuickAccess.js";import{ACTIVE_GROUP as H,IEditorService as X,SIDE_GROUP as J}from"../../../services/editor/common/editorService.js";import{getWorkspaceSymbols as Z}from"../common/search.js";let a=class extends z{constructor(e,o,i,r,t){super(a.PREFIX,{canAcceptInBackground:!0,noResultsPick:{label:C("noSymbolResults","No matching workspace symbols")}});this.labelService=e;this.openerService=o;this.editorService=i;this.configurationService=r;this.codeEditorService=t}static PREFIX="#";static TYPING_SEARCH_DELAY=200;static TREAT_AS_GLOBAL_SYMBOL_TYPES=new Set([l.Class,l.Enum,l.File,l.Interface,l.Namespace,l.Package,l.Module]);delayer=this._register(new N(a.TYPING_SEARCH_DELAY));get defaultFilterValue(){const e=this.codeEditorService.getFocusedCodeEditor();if(e)return x(e)??void 0}get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview,openSideBySideDirection:e?.openSideBySideDirection}}_getPicks(e,o,i){return this.getSymbolPicks(e,void 0,i)}async getSymbolPicks(e,o,i){return this.delayer.trigger(async()=>i.isCancellationRequested?[]:this.doGetSymbolPicks(A(e),o,i),o?.delay)}async doGetSymbolPicks(e,o,i){let r,t;e.values&&e.values.length>1?(r=M(e.values[0]),t=M(e.values.slice(1))):r=e;const B=await Z(r.original,i);if(i.isCancellationRequested)return[];const b=[],E=this.configuration.openSideBySideDirection;for(const{symbol:n,provider:f}of B){if(o?.skipLocal&&!a.TREAT_AS_GLOBAL_SYMBOL_TYPES.has(n.kind)&&n.containerName)continue;const I=n.name,y=`$(${v.toIcon(n.kind).id}) ${I}`,T=y.length-I.length;let c,k,L=!1;if(r.original.length>0&&(r!==e&&([c,k]=P(y,{...e,values:void 0},0,T),typeof c=="number"&&(L=!0)),typeof c!="number"&&([c,k]=P(y,r,0,T),typeof c!="number")))continue;const g=n.location.uri;let d;if(g){const p=this.labelService.getUriLabel(g,{relative:!0});n.containerName?d=`${n.containerName} \u2022 ${p}`:d=p}let h,O;if(!L&&t&&t.original.length>0){if(d&&([h,O]=P(d,t)),typeof h!="number")continue;typeof c=="number"&&(c+=h)}const Q=n.tags?n.tags.indexOf(Y.Deprecated)>=0:!1;b.push({symbol:n,resource:g,score:c,label:y,ariaLabel:I,highlights:Q?void 0:{label:k,description:O},description:d,strikethrough:Q,buttons:[{iconClass:E==="right"?W.asClassName(w.splitHorizontal):W.asClassName(w.splitVertical),tooltip:E==="right"?C("openToSide","Open to the Side"):C("openToBottom","Open to the Bottom")}],trigger:(p,S)=>(this.openSymbol(f,n,i,{keyMods:S,forceOpenSideBySide:!0}),V.CLOSE_PICKER),accept:async(p,S)=>this.openSymbol(f,n,i,{keyMods:p,preserveFocus:S.inBackground,forcePinned:S.inBackground})})}return o?.skipSorting||b.sort((n,f)=>this.compareSymbols(n,f)),b}async openSymbol(e,o,i,r){let t=o;typeof e.resolveWorkspaceSymbol=="function"&&(t=await e.resolveWorkspaceSymbol(o,i)||o,i.isCancellationRequested)||(t.location.uri.scheme===_.http||t.location.uri.scheme===_.https?await this.openerService.open(t.location.uri,{fromUserGesture:!0,allowContributedOpeners:!0}):await this.editorService.openEditor({resource:t.location.uri,options:{preserveFocus:r?.preserveFocus,pinned:r.keyMods.ctrlCmd||r.forcePinned||this.configuration.openEditorPinned,selection:t.location.range?K.collapseToStart(t.location.range):void 0}},r.keyMods.alt||this.configuration.openEditorPinned&&r.keyMods.ctrlCmd||r?.forceOpenSideBySide?J:H))}compareSymbols(e,o){if(typeof e.score=="number"&&typeof o.score=="number"){if(e.score>o.score)return-1;if(e.score<o.score)return 1}if(e.symbol&&o.symbol){const i=e.symbol.name.toLowerCase(),r=o.symbol.name.toLowerCase(),t=i.localeCompare(r);if(t!==0)return t}if(e.symbol&&o.symbol){const i=v.toIcon(e.symbol.kind).id,r=v.toIcon(o.symbol.kind).id;return i.localeCompare(r)}return 0}};a=R([m(0,U),m(1,$),m(2,X),m(3,j),m(4,G)],a);export{a as SymbolsQuickAccessProvider};
