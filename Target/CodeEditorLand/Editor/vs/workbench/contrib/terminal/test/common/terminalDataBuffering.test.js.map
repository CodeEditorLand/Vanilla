{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminal/test/common/terminalDataBuffering.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../base/test/common/utils.js';\nimport { TerminalDataBufferer } from '../../../../../platform/terminal/common/terminalDataBuffering.js';\n\nconst wait = (ms: number) => new Promise(resolve => setTimeout(resolve, ms));\n\nsuite('Workbench - TerminalDataBufferer', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet bufferer: TerminalDataBufferer;\n\tlet counter: { [id: number]: number };\n\tlet data: { [id: number]: string };\n\n\tsetup(async () => {\n\t\tcounter = {};\n\t\tdata = {};\n\t\tbufferer = store.add(new TerminalDataBufferer((id, e) => {\n\t\t\tif (!(id in counter)) {\n\t\t\t\tcounter[id] = 0;\n\t\t\t}\n\t\t\tcounter[id]++;\n\t\t\tif (!(id in data)) {\n\t\t\t\tdata[id] = '';\n\t\t\t}\n\t\t\tdata[id] = e;\n\t\t}));\n\t});\n\n\ttest('start', async () => {\n\t\tconst terminalOnData = new Emitter<string>();\n\n\t\tstore.add(bufferer.startBuffering(1, terminalOnData.event, 0));\n\n\t\tterminalOnData.fire('1');\n\t\tterminalOnData.fire('2');\n\t\tterminalOnData.fire('3');\n\n\t\tawait wait(0);\n\n\t\tterminalOnData.fire('4');\n\n\t\tassert.strictEqual(counter[1], 1);\n\t\tassert.strictEqual(data[1], '123');\n\n\t\tawait wait(0);\n\n\t\tassert.strictEqual(counter[1], 2);\n\t\tassert.strictEqual(data[1], '4');\n\t});\n\n\ttest('start 2', async () => {\n\t\tconst terminal1OnData = new Emitter<string>();\n\t\tconst terminal2OnData = new Emitter<string>();\n\n\t\tstore.add(bufferer.startBuffering(1, terminal1OnData.event, 0));\n\t\tstore.add(bufferer.startBuffering(2, terminal2OnData.event, 0));\n\n\t\tterminal1OnData.fire('1');\n\t\tterminal2OnData.fire('4');\n\t\tterminal1OnData.fire('2');\n\t\tterminal2OnData.fire('5');\n\t\tterminal1OnData.fire('3');\n\t\tterminal2OnData.fire('6');\n\t\tterminal2OnData.fire('7');\n\n\t\tassert.strictEqual(counter[1], undefined);\n\t\tassert.strictEqual(data[1], undefined);\n\t\tassert.strictEqual(counter[2], undefined);\n\t\tassert.strictEqual(data[2], undefined);\n\n\t\tawait wait(0);\n\n\t\tassert.strictEqual(counter[1], 1);\n\t\tassert.strictEqual(data[1], '123');\n\t\tassert.strictEqual(counter[2], 1);\n\t\tassert.strictEqual(data[2], '4567');\n\t});\n\n\ttest('stop', async () => {\n\t\tconst terminalOnData = new Emitter<string>();\n\n\t\tbufferer.startBuffering(1, terminalOnData.event, 0);\n\n\t\tterminalOnData.fire('1');\n\t\tterminalOnData.fire('2');\n\t\tterminalOnData.fire('3');\n\n\t\tbufferer.stopBuffering(1);\n\t\tawait wait(0);\n\n\t\tassert.strictEqual(counter[1], 1);\n\t\tassert.strictEqual(data[1], '123');\n\t});\n\n\ttest('start 2 stop 1', async () => {\n\t\tconst terminal1OnData = new Emitter<string>();\n\t\tconst terminal2OnData = new Emitter<string>();\n\n\t\tbufferer.startBuffering(1, terminal1OnData.event, 0);\n\t\tstore.add(bufferer.startBuffering(2, terminal2OnData.event, 0));\n\n\t\tterminal1OnData.fire('1');\n\t\tterminal2OnData.fire('4');\n\t\tterminal1OnData.fire('2');\n\t\tterminal2OnData.fire('5');\n\t\tterminal1OnData.fire('3');\n\t\tterminal2OnData.fire('6');\n\t\tterminal2OnData.fire('7');\n\n\t\tassert.strictEqual(counter[1], undefined);\n\t\tassert.strictEqual(data[1], undefined);\n\t\tassert.strictEqual(counter[2], undefined);\n\t\tassert.strictEqual(data[2], undefined);\n\n\t\tbufferer.stopBuffering(1);\n\t\tawait wait(0);\n\n\t\tassert.strictEqual(counter[1], 1);\n\t\tassert.strictEqual(data[1], '123');\n\t\tassert.strictEqual(counter[2], 1);\n\t\tassert.strictEqual(data[2], '4567');\n\t});\n\n\ttest('dispose should flush remaining data events', async () => {\n\t\tconst terminal1OnData = new Emitter<string>();\n\t\tconst terminal2OnData = new Emitter<string>();\n\n\t\tstore.add(bufferer.startBuffering(1, terminal1OnData.event, 0));\n\t\tstore.add(bufferer.startBuffering(2, terminal2OnData.event, 0));\n\n\t\tterminal1OnData.fire('1');\n\t\tterminal2OnData.fire('4');\n\t\tterminal1OnData.fire('2');\n\t\tterminal2OnData.fire('5');\n\t\tterminal1OnData.fire('3');\n\t\tterminal2OnData.fire('6');\n\t\tterminal2OnData.fire('7');\n\n\t\tassert.strictEqual(counter[1], undefined);\n\t\tassert.strictEqual(data[1], undefined);\n\t\tassert.strictEqual(counter[2], undefined);\n\t\tassert.strictEqual(data[2], undefined);\n\n\t\tbufferer.dispose();\n\t\tawait wait(0);\n\n\t\tassert.strictEqual(counter[1], 1);\n\t\tassert.strictEqual(data[1], '123');\n\t\tassert.strictEqual(counter[2], 1);\n\t\tassert.strictEqual(data[2], '4567');\n\t});\n});\n"],
  "mappings": "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",
  "names": []
}
