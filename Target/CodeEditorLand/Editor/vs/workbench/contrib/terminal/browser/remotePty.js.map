{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminal/browser/remotePty.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Barrier } from '../../../../base/common/async.js';\nimport { IProcessPropertyMap, ITerminalChildProcess, ITerminalLaunchError, ITerminalLogService, ProcessPropertyType } from '../../../../platform/terminal/common/terminal.js';\nimport { BasePty } from '../common/basePty.js';\nimport { RemoteTerminalChannelClient } from '../common/remote/remoteTerminalChannel.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\n\nexport class RemotePty extends BasePty implements ITerminalChildProcess {\n\tprivate readonly _startBarrier: Barrier;\n\n\tconstructor(\n\t\tid: number,\n\t\tshouldPersist: boolean,\n\t\tprivate readonly _remoteTerminalChannel: RemoteTerminalChannelClient,\n\t\t@IRemoteAgentService private readonly _remoteAgentService: IRemoteAgentService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService\n\t) {\n\t\tsuper(id, shouldPersist);\n\t\tthis._startBarrier = new Barrier();\n\t}\n\n\tasync start(): Promise<ITerminalLaunchError | { injectedArgs: string[] } | undefined> {\n\t\t// Fetch the environment to check shell permissions\n\t\tconst env = await this._remoteAgentService.getEnvironment();\n\t\tif (!env) {\n\t\t\t// Extension host processes are only allowed in remote extension hosts currently\n\t\t\tthrow new Error('Could not fetch remote environment');\n\t\t}\n\n\t\tthis._logService.trace('Spawning remote agent process', { terminalId: this.id });\n\n\t\tconst startResult = await this._remoteTerminalChannel.start(this.id);\n\n\t\tif (startResult && 'message' in startResult) {\n\t\t\t// An error occurred\n\t\t\treturn startResult;\n\t\t}\n\n\t\tthis._startBarrier.open();\n\t\treturn startResult;\n\t}\n\n\tasync detach(forcePersist?: boolean): Promise<void> {\n\t\tawait this._startBarrier.wait();\n\t\treturn this._remoteTerminalChannel.detachFromProcess(this.id, forcePersist);\n\t}\n\n\tshutdown(immediate: boolean): void {\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.shutdown(this.id, immediate);\n\t\t});\n\t}\n\n\tinput(data: string): void {\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.input(this.id, data);\n\t\t});\n\t}\n\n\tprocessBinary(e: string): Promise<void> {\n\t\treturn this._remoteTerminalChannel.processBinary(this.id, e);\n\t}\n\n\tresize(cols: number, rows: number): void {\n\t\tif (this._inReplay || this._lastDimensions.cols === cols && this._lastDimensions.rows === rows) {\n\t\t\treturn;\n\t\t}\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._lastDimensions.cols = cols;\n\t\t\tthis._lastDimensions.rows = rows;\n\t\t\tthis._remoteTerminalChannel.resize(this.id, cols, rows);\n\t\t});\n\t}\n\n\tasync clearBuffer(): Promise<void> {\n\t\tawait this._remoteTerminalChannel.clearBuffer(this.id);\n\t}\n\n\tfreePortKillProcess(port: string): Promise<{ port: string; processId: string }> {\n\t\tif (!this._remoteTerminalChannel.freePortKillProcess) {\n\t\t\tthrow new Error('freePortKillProcess does not exist on the local pty service');\n\t\t}\n\t\treturn this._remoteTerminalChannel.freePortKillProcess(port);\n\t}\n\n\tacknowledgeDataEvent(charCount: number): void {\n\t\t// Support flow control for server spawned processes\n\t\tif (this._inReplay) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._startBarrier.wait().then(_ => {\n\t\t\tthis._remoteTerminalChannel.acknowledgeDataEvent(this.id, charCount);\n\t\t});\n\t}\n\n\tasync setUnicodeVersion(version: '6' | '11'): Promise<void> {\n\t\treturn this._remoteTerminalChannel.setUnicodeVersion(this.id, version);\n\t}\n\n\tasync refreshProperty<T extends ProcessPropertyType>(type: T): Promise<IProcessPropertyMap[T]> {\n\t\treturn this._remoteTerminalChannel.refreshProperty(this.id, type);\n\t}\n\n\tasync updateProperty<T extends ProcessPropertyType>(type: T, value: IProcessPropertyMap[T]): Promise<void> {\n\t\treturn this._remoteTerminalChannel.updateProperty(this.id, type, value);\n\t}\n\n\thandleOrphanQuestion() {\n\t\tthis._remoteTerminalChannel.orphanQuestionReply(this.id);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
