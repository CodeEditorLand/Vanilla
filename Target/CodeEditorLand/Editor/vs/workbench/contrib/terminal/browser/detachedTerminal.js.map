{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminal/browser/detachedTerminal.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../base/browser/dom.js\";\nimport { Delayer } from \"../../../../base/common/async.js\";\nimport { onUnexpectedError } from \"../../../../base/common/errors.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport type { OperatingSystem } from \"../../../../base/common/platform.js\";\nimport { MicrotaskDelay } from \"../../../../base/common/symbols.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { TerminalCapabilityStore } from \"../../../../platform/terminal/common/capabilities/terminalCapabilityStore.js\";\nimport type { IMergedEnvironmentVariableCollection } from \"../../../../platform/terminal/common/environmentVariable.js\";\nimport type { ITerminalBackend } from \"../../../../platform/terminal/common/terminal.js\";\nimport type { IEnvironmentVariableInfo } from \"../common/environmentVariable.js\";\nimport { type ITerminalProcessInfo, ProcessState } from \"../common/terminal.js\";\nimport type {\n\tIDetachedTerminalInstance,\n\tIDetachedXTermOptions,\n\tIDetachedXtermTerminal,\n\tITerminalContribution,\n\tIXtermAttachToElementOptions,\n} from \"./terminal.js\";\nimport { TerminalExtensionsRegistry } from \"./terminalExtensions.js\";\nimport { TerminalWidgetManager } from \"./widgets/widgetManager.js\";\nimport type { XtermTerminal } from \"./xterm/xtermTerminal.js\";\n\nexport class DetachedTerminal\n\textends Disposable\n\timplements IDetachedTerminalInstance\n{\n\tprivate readonly _widgets = this._register(new TerminalWidgetManager());\n\tpublic readonly capabilities = new TerminalCapabilityStore();\n\tprivate readonly _contributions: Map<string, ITerminalContribution> =\n\t\tnew Map();\n\n\tpublic domElement?: HTMLElement;\n\n\tpublic get xterm(): IDetachedXtermTerminal {\n\t\treturn this._xterm;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _xterm: XtermTerminal,\n\t\toptions: IDetachedXTermOptions,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\t\tthis._register(_xterm);\n\n\t\t// Initialize contributions\n\t\tconst contributionDescs =\n\t\t\tTerminalExtensionsRegistry.getTerminalContributions();\n\t\tfor (const desc of contributionDescs) {\n\t\t\tif (this._contributions.has(desc.id)) {\n\t\t\t\tonUnexpectedError(\n\t\t\t\t\tnew Error(\n\t\t\t\t\t\t`Cannot have two terminal contributions with the same id ${desc.id}`,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tif (desc.canRunInDetachedTerminals === false) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tlet contribution: ITerminalContribution;\n\t\t\ttry {\n\t\t\t\tcontribution = instantiationService.createInstance(\n\t\t\t\t\tdesc.ctor,\n\t\t\t\t\tthis,\n\t\t\t\t\toptions.processInfo,\n\t\t\t\t\tthis._widgets,\n\t\t\t\t);\n\t\t\t\tthis._contributions.set(desc.id, contribution);\n\t\t\t\tthis._register(contribution);\n\t\t\t} catch (err) {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\t\t}\n\n\t\t// xterm is already by the time DetachedTerminal is created, so trigger everything\n\t\t// on the next microtask, allowing the caller to do any extra initialization\n\t\tthis._register(new Delayer(MicrotaskDelay)).trigger(() => {\n\t\t\tfor (const contr of this._contributions.values()) {\n\t\t\t\tcontr.xtermReady?.(this._xterm);\n\t\t\t}\n\t\t});\n\t}\n\n\tget selection(): string | undefined {\n\t\treturn this._xterm && this.hasSelection()\n\t\t\t? this._xterm.raw.getSelection()\n\t\t\t: undefined;\n\t}\n\n\thasSelection(): boolean {\n\t\treturn this._xterm.hasSelection();\n\t}\n\n\tclearSelection(): void {\n\t\tthis._xterm.clearSelection();\n\t}\n\n\tfocus(force?: boolean): void {\n\t\tif (force || !dom.getActiveWindow().getSelection()?.toString()) {\n\t\t\tthis.xterm.focus();\n\t\t}\n\t}\n\n\tattachToElement(\n\t\tcontainer: HTMLElement,\n\t\toptions?: Partial<IXtermAttachToElementOptions> | undefined,\n\t): void {\n\t\tthis.domElement = container;\n\t\tconst screenElement = this._xterm.attachToElement(container, options);\n\t\tthis._widgets.attachToElement(screenElement);\n\t}\n\n\tforceScrollbarVisibility(): void {\n\t\tthis.domElement?.classList.add(\"force-scrollbar\");\n\t}\n\n\tresetScrollbarVisibility(): void {\n\t\tthis.domElement?.classList.remove(\"force-scrollbar\");\n\t}\n\n\tgetContribution<T extends ITerminalContribution>(id: string): T | null {\n\t\treturn this._contributions.get(id) as T | null;\n\t}\n}\n\n/**\n * Implements {@link ITerminalProcessInfo} for a detached terminal where most\n * properties are stubbed. Properties are mutable and can be updated by\n * the instantiator.\n */\nexport class DetachedProcessInfo implements ITerminalProcessInfo {\n\tprocessState = ProcessState.Running;\n\tptyProcessReady = Promise.resolve();\n\tshellProcessId: number | undefined;\n\tremoteAuthority: string | undefined;\n\tos: OperatingSystem | undefined;\n\tuserHome: string | undefined;\n\tinitialCwd = \"\";\n\tenvironmentVariableInfo: IEnvironmentVariableInfo | undefined;\n\tpersistentProcessId: number | undefined;\n\tshouldPersist = false;\n\thasWrittenData = false;\n\thasChildProcesses = false;\n\tbackend: ITerminalBackend | undefined;\n\tcapabilities = new TerminalCapabilityStore();\n\tshellIntegrationNonce = \"\";\n\textEnvironmentVariableCollection:\n\t\t| IMergedEnvironmentVariableCollection\n\t\t| undefined;\n\n\tconstructor(initialValues: Partial<ITerminalProcessInfo>) {\n\t\tObject.assign(this, initialValues);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
