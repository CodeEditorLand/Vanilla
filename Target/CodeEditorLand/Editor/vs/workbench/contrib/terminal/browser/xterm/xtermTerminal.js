var U=Object.defineProperty;var z=Object.getOwnPropertyDescriptor;var b=(a,s,e,t)=>{for(var i=t>1?void 0:t?z(s,e):s,o=a.length-1,r;o>=0;o--)(r=a[o])&&(i=(t?r(s,e,i):r(i))||i);return t&&i&&U(s,e,i),i},g=(a,s)=>(e,t)=>s(e,t,a);import{importAMDNodeModule as S}from"../../../../../amdX.js";import*as p from"../../../../../base/browser/dom.js";import{StandardWheelEvent as G}from"../../../../../base/browser/mouseEvent.js";import{MouseWheelClassifier as k}from"../../../../../base/browser/ui/scrollbar/scrollableElement.js";import{debounce as V}from"../../../../../base/common/decorators.js";import{Emitter as m}from"../../../../../base/common/event.js";import{Disposable as X,DisposableStore as q}from"../../../../../base/common/lifecycle.js";import"../../../../../editor/common/config/editorOptions.js";import{localize as K}from"../../../../../nls.js";import{AccessibilitySignal as j,IAccessibilitySignalService as $}from"../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{IClipboardService as Y}from"../../../../../platform/clipboard/common/clipboardService.js";import{IConfigurationService as J}from"../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as Q}from"../../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as Z}from"../../../../../platform/instantiation/common/instantiation.js";import{ILayoutService as ee}from"../../../../../platform/layout/browser/layoutService.js";import{LogLevel as v}from"../../../../../platform/log/common/log.js";import{INotificationService as te}from"../../../../../platform/notification/common/notification.js";import{ITelemetryService as ie}from"../../../../../platform/telemetry/common/telemetry.js";import{TerminalCapability as w}from"../../../../../platform/terminal/common/capabilities/capabilities.js";import{ITerminalLogService as oe,TerminalSettingId as I}from"../../../../../platform/terminal/common/terminal.js";import{ShellIntegrationAddon as re}from"../../../../../platform/terminal/common/xterm/shellIntegrationAddon.js";import{scrollbarSliderActiveBackground as ne,scrollbarSliderBackground as ae,scrollbarSliderHoverBackground as se}from"../../../../../platform/theme/common/colorRegistry.js";import{IThemeService as de}from"../../../../../platform/theme/common/themeService.js";import{PANEL_BACKGROUND as le}from"../../../../common/theme.js";import"../../common/terminal.js";import{ansiColorIdentifiers as l,TERMINAL_BACKGROUND_COLOR as ce,TERMINAL_CURSOR_BACKGROUND_COLOR as he,TERMINAL_CURSOR_FOREGROUND_COLOR as ge,TERMINAL_FIND_MATCH_BACKGROUND_COLOR as ue,TERMINAL_FIND_MATCH_BORDER_COLOR as pe,TERMINAL_FIND_MATCH_HIGHLIGHT_BACKGROUND_COLOR as me,TERMINAL_FIND_MATCH_HIGHLIGHT_BORDER_COLOR as fe,TERMINAL_FOREGROUND_COLOR as Se,TERMINAL_INACTIVE_SELECTION_BACKGROUND_COLOR as _e,TERMINAL_OVERVIEW_RULER_BORDER_COLOR as ve,TERMINAL_OVERVIEW_RULER_CURSOR_FOREGROUND_COLOR as Ce,TERMINAL_OVERVIEW_RULER_FIND_MATCH_FOREGROUND_COLOR as ye,TERMINAL_SELECTION_BACKGROUND_COLOR as Ae,TERMINAL_SELECTION_FOREGROUND_COLOR as be}from"../../common/terminalColorRegistry.js";import{TerminalContextKeys as B}from"../../common/terminalContextKey.js";import{ITerminalConfigurationService as we,XtermTerminalConstants as Ie}from"../terminal.js";import"../xterm-private.js";import{DecorationAddon as Te}from"./decorationAddon.js";import{MarkNavigationAddon as Re,ScrollPosition as De}from"./markNavigationAddon.js";var Le=(s=>(s[s.SmoothScrollDuration=125]="SmoothScrollDuration",s))(Le||{});let T,R,D,L,O,M;function Oe(a,s){let e=s.getLine(a);if(!e)return{lineData:void 0,lineIndex:a};let t=e.translateToString(!0);for(;a>0&&e.isWrapped&&(e=s.getLine(--a),!!e);)t=e.translateToString(!1)+t;return{lineData:t,lineIndex:a}}let u=class extends X{constructor(e,t,i,o,r,n,c,f,_,W,Me,We,xe,Ee,x,E,ke,N){super();this._xtermColorProvider=o;this._capabilities=r;this._configurationService=f;this._instantiationService=_;this._logService=W;this._notificationService=Me;this._themeService=We;this._telemetryService=xe;this._terminalConfigurationService=Ee;this._clipboardService=x;this._accessibilitySignalService=ke;const C=this._terminalConfigurationService.getFont(p.getActiveWindow(),void 0,!0),d=this._terminalConfigurationService.config,P=this._configurationService.getValue("editor");this.raw=this._register(new e({allowProposedApi:!0,cols:t,rows:i,documentOverride:N.mainContainer.ownerDocument,altClickMovesCursor:d.altClickMovesCursor&&P.multiCursorModifier==="alt",scrollback:d.scrollback,theme:this.getXtermTheme(),drawBoldTextInBrightColors:d.drawBoldTextInBrightColors,fontFamily:C.fontFamily,fontWeight:d.fontWeight,fontWeightBold:d.fontWeightBold,fontSize:C.fontSize,letterSpacing:C.letterSpacing,lineHeight:C.lineHeight,logLevel:F(this._logService.getLevel()),logger:this._logService,minimumContrastRatio:d.minimumContrastRatio,tabStopWidth:d.tabStopWidth,cursorBlink:d.cursorBlinking,cursorStyle:y(d.cursorStyle),cursorInactiveStyle:y(d.cursorStyleInactive),cursorWidth:d.cursorWidth,macOptionIsMeta:d.macOptionIsMeta,macOptionClickForcesSelection:d.macOptionClickForcesSelection,rightClickSelectsWord:d.rightClickBehavior==="selectWord",fastScrollModifier:"alt",fastScrollSensitivity:d.fastScrollSensitivity,scrollSensitivity:d.mouseWheelScrollSensitivity,wordSeparator:d.wordSeparators,overviewRuler:{width:14,showTopBorder:!0},ignoreBracketedPasteMode:d.ignoreBracketedPasteMode,rescaleOverlappingGlyphs:d.rescaleOverlappingGlyphs,windowOptions:{getWinSizePixels:!0,getCellSizePixels:!0,getWinSizeChars:!0}})),this._updateSmoothScrolling(),this._core=this.raw._core,this._register(this._configurationService.onDidChangeConfiguration(async h=>{h.affectsConfiguration(I.GpuAcceleration)&&(u._suggestedRendererType=void 0),(h.affectsConfiguration("terminal.integrated")||h.affectsConfiguration("editor.fastScrollSensitivity")||h.affectsConfiguration("editor.mouseWheelScrollSensitivity")||h.affectsConfiguration("editor.multiCursorModifier"))&&this.updateConfig(),h.affectsConfiguration(I.UnicodeVersion)&&this._updateUnicodeVersion(),h.affectsConfiguration(I.ShellIntegrationDecorationsEnabled)&&this._updateTheme()})),this._register(this._themeService.onDidColorThemeChange(h=>this._updateTheme(h))),this._register(this._logService.onDidChangeLogLevel(h=>this.raw.options.logLevel=F(h))),this._register(this.raw.onSelectionChange(()=>{this._onDidChangeSelection.fire(),this.isFocused&&this._anyFocusedTerminalHasSelection.set(this.raw.hasSelection())})),this._updateUnicodeVersion(),this._markNavigationAddon=this._instantiationService.createInstance(Re,r),this.raw.loadAddon(this._markNavigationAddon),this._decorationAddon=this._instantiationService.createInstance(Te,this._capabilities),this._register(this._decorationAddon.onDidRequestRunCommand(h=>this._onDidRequestRunCommand.fire(h))),this.raw.loadAddon(this._decorationAddon),this._shellIntegrationAddon=new re(n,c,this._telemetryService,this._logService),this.raw.loadAddon(this._shellIntegrationAddon),this._getClipboardAddonConstructor().then(h=>{this._clipboardAddon=this._instantiationService.createInstance(h,void 0,{async readText(A){return x.readText(A==="p"?"selection":"clipboard")},async writeText(A,H){return x.writeText(H,A==="p"?"selection":"clipboard")}}),this.raw.loadAddon(this._clipboardAddon)}),this._anyTerminalFocusContextKey=B.focusInAny.bindTo(E),this._anyFocusedTerminalHasSelection=B.textSelectedInFocused.bindTo(E)}raw;_core;static _suggestedRendererType=void 0;static _checkedWebglCompatible=!1;_attached;_isPhysicalMouseWheel=k.INSTANCE.isPhysicalMouseWheel();_markNavigationAddon;_shellIntegrationAddon;_decorationAddon;_clipboardAddon;_searchAddon;_unicode11Addon;_webglAddon;_serializeAddon;_imageAddon;_attachedDisposables=this._register(new q);_anyTerminalFocusContextKey;_anyFocusedTerminalHasSelection;_lastFindResult;get findResult(){return this._lastFindResult}get isStdinDisabled(){return!!this.raw.options.disableStdin}get isGpuAccelerated(){return!!this._webglAddon}_onDidRequestRunCommand=this._register(new m);onDidRequestRunCommand=this._onDidRequestRunCommand.event;_onDidRequestFocus=this._register(new m);onDidRequestFocus=this._onDidRequestFocus.event;_onDidRequestSendText=this._register(new m);onDidRequestSendText=this._onDidRequestSendText.event;_onDidRequestFreePort=this._register(new m);onDidRequestFreePort=this._onDidRequestFreePort.event;_onDidRequestRefreshDimensions=this._register(new m);onDidRequestRefreshDimensions=this._onDidRequestRefreshDimensions.event;_onDidChangeFindResults=this._register(new m);onDidChangeFindResults=this._onDidChangeFindResults.event;_onDidChangeSelection=this._register(new m);onDidChangeSelection=this._onDidChangeSelection.event;_onDidChangeFocus=this._register(new m);onDidChangeFocus=this._onDidChangeFocus.event;_onDidDispose=this._register(new m);onDidDispose=this._onDidDispose.event;get markTracker(){return this._markNavigationAddon}get shellIntegration(){return this._shellIntegrationAddon}get textureAtlas(){const e=this._webglAddon?.textureAtlas;if(e)return createImageBitmap(e)}get isFocused(){return this.raw.element?p.isAncestorOfActiveElement(this.raw.element):!1}*getBufferReverseIterator(){for(let e=this.raw.buffer.active.length;e>=0;e--){const{lineData:t,lineIndex:i}=Oe(e,this.raw.buffer.active);t&&(e=i,yield t)}}async getContentsAsHtml(){if(!this._serializeAddon){const e=await this._getSerializeAddonConstructor();this._serializeAddon=new e,this.raw.loadAddon(this._serializeAddon)}return this._serializeAddon.serializeAsHTML()}async getSelectionAsHtml(e){if(!this._serializeAddon){const i=await this._getSerializeAddonConstructor();this._serializeAddon=new i,this.raw.loadAddon(this._serializeAddon)}if(e){const i=e.getOutput()?.length,o=e.marker?.line;if(!i||!o)throw new Error(`No row ${o} or output length ${i} for command ${e}`);this.raw.select(0,o+1,i-Math.floor(i/this.raw.cols))}const t=this._serializeAddon.serializeAsHTML({onlySelection:!0});return e&&this.raw.clearSelection(),t}attachToElement(e,t){const i={enableGpu:!0,...t};if(this._attached||this.raw.open(e),i.enableGpu&&this._shouldLoadWebgl()&&this._enableWebglRenderer(),!this.raw.element||!this.raw.textarea)throw new Error("xterm elements not set after open");const o=this._attachedDisposables;return o.clear(),o.add(p.addDisposableListener(this.raw.textarea,"focus",()=>this._setFocused(!0))),o.add(p.addDisposableListener(this.raw.textarea,"blur",()=>this._setFocused(!1))),o.add(p.addDisposableListener(this.raw.textarea,"focusout",()=>this._setFocused(!1))),o.add(p.addDisposableListener(this.raw.element,p.EventType.MOUSE_WHEEL,r=>{const n=k.INSTANCE;n.acceptStandardWheelEvent(new G(r));const c=n.isPhysicalMouseWheel();c!==this._isPhysicalMouseWheel&&(this._isPhysicalMouseWheel=c,this._updateSmoothScrolling())},{passive:!0})),this._attached={container:e,options:i},this._attached?.container.querySelector(".xterm-screen")}_setFocused(e){this._onDidChangeFocus.fire(e),this._anyTerminalFocusContextKey.set(e),this._anyFocusedTerminalHasSelection.set(e&&this.raw.hasSelection())}write(e,t){this.raw.write(e,t)}resize(e,t){this.raw.resize(e,t)}updateConfig(){const e=this._terminalConfigurationService.config;this.raw.options.altClickMovesCursor=e.altClickMovesCursor,this._setCursorBlink(e.cursorBlinking),this._setCursorStyle(e.cursorStyle),this._setCursorStyleInactive(e.cursorStyleInactive),this._setCursorWidth(e.cursorWidth),this.raw.options.scrollback=e.scrollback,this.raw.options.drawBoldTextInBrightColors=e.drawBoldTextInBrightColors,this.raw.options.minimumContrastRatio=e.minimumContrastRatio,this.raw.options.tabStopWidth=e.tabStopWidth,this.raw.options.fastScrollSensitivity=e.fastScrollSensitivity,this.raw.options.scrollSensitivity=e.mouseWheelScrollSensitivity,this.raw.options.macOptionIsMeta=e.macOptionIsMeta;const t=this._configurationService.getValue("editor");this.raw.options.altClickMovesCursor=e.altClickMovesCursor&&t.multiCursorModifier==="alt",this.raw.options.macOptionClickForcesSelection=e.macOptionClickForcesSelection,this.raw.options.rightClickSelectsWord=e.rightClickBehavior==="selectWord",this.raw.options.wordSeparator=e.wordSeparators,this.raw.options.customGlyphs=e.customGlyphs,this.raw.options.ignoreBracketedPasteMode=e.ignoreBracketedPasteMode,this.raw.options.rescaleOverlappingGlyphs=e.rescaleOverlappingGlyphs,this.raw.options.overviewRuler={width:14,showTopBorder:!0},this._updateSmoothScrolling(),this._attached?.options.enableGpu&&(this._shouldLoadWebgl()?this._enableWebglRenderer():this._disposeOfWebglRenderer())}_updateSmoothScrolling(){this.raw.options.smoothScrollDuration=this._terminalConfigurationService.config.smoothScrolling&&this._isPhysicalMouseWheel?125:0}_shouldLoadWebgl(){return this._terminalConfigurationService.config.gpuAcceleration==="auto"&&u._suggestedRendererType===void 0||this._terminalConfigurationService.config.gpuAcceleration==="on"}forceRedraw(){this.raw.clearTextureAtlas()}clearDecorations(){this._decorationAddon?.clearDecorations()}forceRefresh(){this._core.viewport?._innerRefresh()}async findNext(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findNext(e,t)}async findPrevious(e,t){return this._updateFindColors(t),(await this._getSearchAddon()).findPrevious(e,t)}_updateFindColors(e){const t=this._themeService.getColorTheme(),i=t.getColor(ce)||t.getColor(le),o=t.getColor(ue),r=t.getColor(pe),n=t.getColor(Ce),c=t.getColor(me),f=t.getColor(fe),_=t.getColor(ye);e.decorations={activeMatchBackground:o?.toString(),activeMatchBorder:r?.toString()||"transparent",activeMatchColorOverviewRuler:n?.toString()||"transparent",matchBackground:i?c?.blend(i).toString():void 0,matchBorder:f?.toString()||"transparent",matchOverviewRuler:_?.toString()||"transparent"}}_searchAddonPromise;_getSearchAddon(){return this._searchAddonPromise||(this._searchAddonPromise=this._getSearchAddonConstructor().then(e=>(this._searchAddon=new e({highlightLimit:Ie.SearchHighlightLimit}),this.raw.loadAddon(this._searchAddon),this._searchAddon.onDidChangeResults(t=>{this._lastFindResult=t,this._onDidChangeFindResults.fire(t)}),this._searchAddon))),this._searchAddonPromise}clearSearchDecorations(){this._searchAddon?.clearDecorations()}clearActiveSearchDecoration(){this._searchAddon?.clearActiveDecoration()}getFont(){return this._terminalConfigurationService.getFont(p.getWindow(this.raw.element),this._core)}getLongestViewportWrappedLineLength(){let e=0;for(let t=this.raw.buffer.active.length-1;t>=this.raw.buffer.active.viewportY;t--){const i=this._getWrappedLineCount(t,this.raw.buffer.active);e=Math.max(e,i.lineCount*this.raw.cols-i.endSpaces||0),t=i.currentIndex}return e}_getWrappedLineCount(e,t){let i=t.getLine(e);if(!i)throw new Error("Could not get line");let o=e,r=0;for(let n=Math.min(i.length,this.raw.cols)-1;n>=0&&!i?.getCell(n)?.getChars();n--)r++;for(;i?.isWrapped&&o>0;)o--,i=t.getLine(o);return{lineCount:e-o+1,currentIndex:o,endSpaces:r}}scrollDownLine(){this.raw.scrollLines(1)}scrollDownPage(){this.raw.scrollPages(1)}scrollToBottom(){this.raw.scrollToBottom()}scrollUpLine(){this.raw.scrollLines(-1)}scrollUpPage(){this.raw.scrollPages(-1)}scrollToTop(){this.raw.scrollToTop()}scrollToLine(e,t=De.Top){this.markTracker.scrollToLine(e,t)}clearBuffer(){this.raw.clear(),this._capabilities.get(w.CommandDetection)?.handlePromptStart(),this._capabilities.get(w.CommandDetection)?.handleCommandStart(),this._accessibilitySignalService.playSignal(j.clear)}hasSelection(){return this.raw.hasSelection()}clearSelection(){this.raw.clearSelection()}selectMarkedRange(e,t,i=!1){const o=this.shellIntegration.capabilities.get(w.BufferMarkDetection);if(!o)return;const r=o.getMark(e),n=o.getMark(t);r===void 0||n===void 0||(this.raw.selectLines(r.line,n.line),i&&this.raw.scrollToLine(r.line))}selectAll(){this.raw.focus(),this.raw.selectAll()}focus(){this.raw.focus()}async copySelection(e,t){if(this.hasSelection()||e&&t)if(e){let r=function(c){c.clipboardData.types.includes("text/plain")||c.clipboardData.setData("text/plain",t?.getOutput()??""),c.clipboardData.setData("text/html",o),c.preventDefault()};var i=r;const o=await this.getSelectionAsHtml(t),n=p.getDocument(this.raw.element);n.addEventListener("copy",r),n.execCommand("copy"),n.removeEventListener("copy",r)}else await this._clipboardService.writeText(this.raw.getSelection());else this._notificationService.warn(K("terminal.integrated.copySelection.noSelection","The terminal has no selection to copy"))}_setCursorBlink(e){this.raw.options.cursorBlink!==e&&(this.raw.options.cursorBlink=e,this.raw.refresh(0,this.raw.rows-1))}_setCursorStyle(e){const t=y(e);this.raw.options.cursorStyle!==t&&(this.raw.options.cursorStyle=t)}_setCursorStyleInactive(e){const t=y(e);this.raw.options.cursorInactiveStyle!==t&&(this.raw.options.cursorInactiveStyle=t)}_setCursorWidth(e){this.raw.options.cursorWidth!==e&&(this.raw.options.cursorWidth=e)}async _enableWebglRenderer(){if(!this.raw.element||this._webglAddon)return;if(!u._checkedWebglCompatible){u._checkedWebglCompatible=!0;const i=document.createElement("canvas").getContext("webgl2"),o=i?.getExtension("WEBGL_debug_renderer_info");if(i&&o&&i.getParameter(o.UNMASKED_RENDERER_WEBGL).startsWith("ANGLE (Google, Vulkan 1.3.0 (SwiftShader Device (Subzero)")){this._disableWebglForThisSession();return}}const e=await this._getWebglAddonConstructor();this._webglAddon=new e;try{this.raw.loadAddon(this._webglAddon),this._logService.trace("Webgl was loaded"),this._webglAddon.onContextLoss(()=>{this._logService.info("Webgl lost context, disposing of webgl renderer"),this._disposeOfWebglRenderer()}),this._refreshImageAddon(),this._onDidRequestRefreshDimensions.fire()}catch(t){this._logService.warn("Webgl could not be loaded. Falling back to the DOM renderer",t),this._disableWebglForThisSession()}}_disableWebglForThisSession(){u._suggestedRendererType="dom",this._disposeOfWebglRenderer()}async _refreshImageAddon(){if(this._terminalConfigurationService.config.enableImages&&this._webglAddon){if(!this._imageAddon){const e=await this._getImageAddonConstructor();this._imageAddon=new e,this.raw.loadAddon(this._imageAddon)}}else{try{this._imageAddon?.dispose()}catch{}this._imageAddon=void 0}}async _getClipboardAddonConstructor(){return T||(T=(await S("@xterm/addon-clipboard","lib/addon-clipboard.js")).ClipboardAddon),T}async _getImageAddonConstructor(){return R||(R=(await S("@xterm/addon-image","lib/addon-image.js")).ImageAddon),R}async _getSearchAddonConstructor(){return D||(D=(await S("@xterm/addon-search","lib/addon-search.js")).SearchAddon),D}async _getUnicode11Constructor(){return O||(O=(await S("@xterm/addon-unicode11","lib/addon-unicode11.js")).Unicode11Addon),O}async _getWebglAddonConstructor(){return M||(M=(await S("@xterm/addon-webgl","lib/addon-webgl.js")).WebglAddon),M}async _getSerializeAddonConstructor(){return L||(L=(await S("@xterm/addon-serialize","lib/addon-serialize.js")).SerializeAddon),L}_disposeOfWebglRenderer(){try{this._webglAddon?.dispose()}catch{}this._webglAddon=void 0,this._refreshImageAddon()}getXtermTheme(e){e||(e=this._themeService.getColorTheme());const t=this._terminalConfigurationService.config,i=["never","gutter"].includes(t.shellIntegration?.decorationsEnabled??""),o=e.getColor(Se),r=this._xtermColorProvider.getBackgroundColor(e),n=e.getColor(ge)||o,c=e.getColor(he)||r,f=e.getColor(Ae),_=e.getColor(_e),W=e.getColor(be)||void 0;return{background:r?.toString(),foreground:o?.toString(),cursor:n?.toString(),cursorAccent:c?.toString(),selectionBackground:f?.toString(),selectionInactiveBackground:_?.toString(),selectionForeground:W?.toString(),overviewRulerBorder:i?"#0000":e.getColor(ve)?.toString(),scrollbarSliderActiveBackground:e.getColor(ne)?.toString(),scrollbarSliderBackground:e.getColor(ae)?.toString(),scrollbarSliderHoverBackground:e.getColor(se)?.toString(),black:e.getColor(l[0])?.toString(),red:e.getColor(l[1])?.toString(),green:e.getColor(l[2])?.toString(),yellow:e.getColor(l[3])?.toString(),blue:e.getColor(l[4])?.toString(),magenta:e.getColor(l[5])?.toString(),cyan:e.getColor(l[6])?.toString(),white:e.getColor(l[7])?.toString(),brightBlack:e.getColor(l[8])?.toString(),brightRed:e.getColor(l[9])?.toString(),brightGreen:e.getColor(l[10])?.toString(),brightYellow:e.getColor(l[11])?.toString(),brightBlue:e.getColor(l[12])?.toString(),brightMagenta:e.getColor(l[13])?.toString(),brightCyan:e.getColor(l[14])?.toString(),brightWhite:e.getColor(l[15])?.toString()}}_updateTheme(e){this.raw.options.theme=this.getXtermTheme(e)}refresh(){this._updateTheme(),this._decorationAddon.refreshLayouts()}async _updateUnicodeVersion(){if(!this._unicode11Addon&&this._terminalConfigurationService.config.unicodeVersion==="11"){const e=await this._getUnicode11Constructor();this._unicode11Addon=new e,this.raw.loadAddon(this._unicode11Addon)}this.raw.unicode.activeVersion!==this._terminalConfigurationService.config.unicodeVersion&&(this.raw.unicode.activeVersion=this._terminalConfigurationService.config.unicodeVersion)}_writeText(e){this.raw.write(e)}dispose(){this._anyTerminalFocusContextKey.reset(),this._anyFocusedTerminalHasSelection.reset(),this._onDidDispose.fire(),super.dispose()}};b([V(100)],u.prototype,"_refreshImageAddon",1),u=b([g(7,J),g(8,Z),g(9,oe),g(10,te),g(11,de),g(12,ie),g(13,we),g(14,Y),g(15,Q),g(16,$),g(17,ee)],u);function Lt(a,s,e,t){if(!s.charWidth||!s.charHeight)return null;const i=e*a.devicePixelRatio,o=s.charWidth*a.devicePixelRatio+s.letterSpacing,r=Math.max(Math.floor(i/o),1),n=t*a.devicePixelRatio,c=Math.ceil(s.charHeight*a.devicePixelRatio),f=Math.floor(c*s.lineHeight);return{rows:Math.max(Math.floor(n/f),1),cols:r}}function F(a){switch(a){case v.Trace:return"trace";case v.Debug:return"debug";case v.Info:return"info";case v.Warning:return"warn";case v.Error:return"error";default:return"off"}}function y(a){return a==="line"?"bar":a}export{u as XtermTerminal,Lt as getXtermScaledDimensions};
