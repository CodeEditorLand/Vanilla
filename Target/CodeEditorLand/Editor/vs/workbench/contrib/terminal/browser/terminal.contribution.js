import{KeyCode as r,KeyMod as e}from"../../../../base/common/keyCodes.js";import{Schemas as q}from"../../../../base/common/network.js";import{isIOS as O,isWindows as I}from"../../../../base/common/platform.js";import{URI as N}from"../../../../base/common/uri.js";import"./media/terminal.css";import"./media/terminalVoice.css";import"./media/widgets.css";import"./media/xterm.css";import*as C from"../../../../nls.js";import{CONTEXT_ACCESSIBILITY_MODE_ENABLED as m}from"../../../../platform/accessibility/common/accessibility.js";import{CommandsRegistry as w}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr as i}from"../../../../platform/contextkey/common/contextkey.js";import{Extensions as L}from"../../../../platform/dnd/browser/dnd.js";import{SyncDescriptor as u}from"../../../../platform/instantiation/common/descriptors.js";import{InstantiationType as l,registerSingleton as s}from"../../../../platform/instantiation/common/extensions.js";import{KeybindingsRegistry as B,KeybindingWeight as Q}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{Extensions as z}from"../../../../platform/quickinput/common/quickAccess.js";import{Registry as p}from"../../../../platform/registry/common/platform.js";import{GeneralShellType as c,ITerminalLogService as M,WindowsShellType as _}from"../../../../platform/terminal/common/terminal.js";import{TerminalLogService as F}from"../../../../platform/terminal/common/terminalLogService.js";import{registerTerminalPlatformConfiguration as G}from"../../../../platform/terminal/common/terminalPlatformConfiguration.js";import{EditorPaneDescriptor as H}from"../../../browser/editor.js";import{ViewPaneContainer as J}from"../../../browser/parts/views/viewPaneContainer.js";import{getQuickNavigateHandler as E}from"../../../browser/quickaccess.js";import{registerWorkbenchContribution2 as h,WorkbenchPhase as S}from"../../../common/contributions.js";import{EditorExtensions as A}from"../../../common/editor.js";import{Extensions as D,ViewContainerLocation as X}from"../../../common/views.js";import{TerminalSuggestSettingId as U}from"../../terminalContrib/suggest/common/terminalSuggestConfiguration.js";import{ITerminalProfileService as Y,TERMINAL_VIEW_ID as y,TerminalCommandId as T}from"../common/terminal.js";import{registerColors as $}from"../common/terminalColorRegistry.js";import{registerTerminalConfiguration as j}from"../common/terminalConfiguration.js";import{TerminalContextKeys as n,TerminalContextKeyStrings as a}from"../common/terminalContextKey.js";import{terminalStrings as Z}from"../common/terminalStrings.js";import{RemoteTerminalBackendContribution as k}from"./remoteTerminalBackend.js";import{ITerminalConfigurationService as ee,ITerminalEditorService as re,ITerminalGroupService as ie,ITerminalInstanceService as te,ITerminalService as ne,TerminalDataTransfers as b,terminalEditorId as oe}from"./terminal.js";import{registerTerminalActions as ae,terminalSendSequenceCommand as me}from"./terminalActions.js";import{setupTerminalCommands as le}from"./terminalCommands.js";import{TerminalConfigurationService as se}from"./terminalConfigurationService.js";import{TerminalEditor as ce}from"./terminalEditor.js";import{TerminalEditorInput as R}from"./terminalEditorInput.js";import{TerminalInputSerializer as pe}from"./terminalEditorSerializer.js";import{TerminalEditorService as de}from"./terminalEditorService.js";import{TerminalGroupService as fe}from"./terminalGroupService.js";import{terminalViewIcon as P}from"./terminalIcons.js";import{TerminalInstanceService as ge}from"./terminalInstanceService.js";import{TerminalMainContribution as x}from"./terminalMainContribution.js";import{setupTerminalMenus as Ce}from"./terminalMenus.js";import{TerminalProfileService as ye}from"./terminalProfileService.js";import{TerminalQuickAccessProvider as v}from"./terminalQuickAccess.js";import{TerminalService as ue}from"./terminalService.js";import{TerminalViewPane as he}from"./terminalView.js";import{TerminalWslRecommendationContribution as K}from"./terminalWslRecommendationContribution.js";s(M,F,l.Delayed),s(ee,se,l.Delayed),s(ne,ue,l.Delayed),s(re,de,l.Delayed),s(ie,fe,l.Delayed),s(te,ge,l.Delayed),s(Y,ye,l.Delayed);const Se=p.as(z.Quickaccess),Te="inTerminalPicker";Se.registerQuickAccessProvider({ctor:v,prefix:v.PREFIX,contextKey:Te,placeholder:C.localize("tasksQuickAccessPlaceholder","Type the name of a terminal to open."),helpEntries:[{description:C.localize("tasksQuickAccessHelp","Show All Opened Terminals"),commandId:T.QuickOpenTerm}]});const V="workbench.action.quickOpenNavigateNextInTerminalPicker";w.registerCommand({id:V,handler:E(V,!0)});const W="workbench.action.quickOpenNavigatePreviousInTerminalPicker";w.registerCommand({id:W,handler:E(W,!1)}),h(x.ID,x,S.BlockStartup),h(k.ID,k,S.AfterRestored),h(K.ID,K,S.Eventually),G(),j(),p.as(A.EditorFactory).registerEditorSerializer(R.ID,pe),p.as(A.EditorPane).registerEditorPane(H.create(ce,oe,Z.terminal),[new u(R)]),p.as(L.DragAndDropContribution).register({dataFormatKey:b.Terminals,getEditorInputs(d){const o=[];try{const f=JSON.parse(d);for(const g of f)o.push({resource:N.parse(g)})}catch{}return o},setData(d,o){const f=d.filter(({resource:g})=>g.scheme===q.vscodeTerminal);f.length&&o.dataTransfer?.setData(b.Terminals,JSON.stringify(f.map(({resource:g})=>g.toString())))}});const Ie=p.as(D.ViewContainersRegistry).registerViewContainer({id:y,title:C.localize2("terminal","Terminal"),icon:P,ctorDescriptor:new u(J,[y,{mergeViewWithContainerWhenSingleView:!0}]),storageId:y,hideIfEmpty:!0,order:3},X.Panel,{doNotRegisterOpenCommand:!0,isDefault:!0});p.as(D.ViewsRegistry).registerViews([{id:y,name:C.localize2("terminal","Terminal"),containerIcon:P,canToggleVisibility:!1,canMoveView:!0,ctorDescriptor:new u(he),openCommandActionDescriptor:{id:T.Toggle,mnemonicTitle:C.localize({key:"miToggleIntegratedTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal"),keybindings:{primary:e.CtrlCmd|r.Backquote,mac:{primary:e.WinCtrl|r.Backquote}},order:3}}],Ie),ae();function t(d,o){B.registerCommandAndKeybindingRule({id:T.SendSequence,weight:Q.WorkbenchContrib,when:o.when||n.focus,primary:o.primary,mac:o.mac,linux:o.linux,win:o.win,handler:me,args:{text:d}})}var we=(o=>(o[o.CtrlLetterOffset=64]="CtrlLetterOffset",o))(we||{});I&&t("",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),m.negate()),primary:e.CtrlCmd|r.KeyV}),t("\x1B[24~a",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.CtrlCmd|r.Space,mac:{primary:e.WinCtrl|r.Space}}),t("\x1B[24~b",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.Alt|r.Space}),t("\x1B[24~c",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.Shift|r.Enter}),t("\x1B[24~d",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),mac:{primary:e.Shift|e.CtrlCmd|r.RightArrow}}),t("\x1B[24~e",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate(),i.equals(`config.${U.Enabled}`,!0)),primary:e.CtrlCmd|r.Space,mac:{primary:e.WinCtrl|r.Space}}),t("\x1B[1;2H",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell)),mac:{primary:e.Shift|e.CtrlCmd|r.LeftArrow}}),t("",{when:i.and(n.focus,m),primary:e.CtrlCmd|e.Alt|r.KeyR,mac:{primary:e.WinCtrl|e.Alt|r.KeyR}}),t("\x07",{when:n.focus,primary:e.CtrlCmd|e.Alt|r.KeyG,mac:{primary:e.WinCtrl|e.Alt|r.KeyG}}),O&&t("",{when:i.and(n.focus),primary:e.WinCtrl|r.KeyC}),t("",{primary:e.CtrlCmd|r.Backspace,mac:{primary:e.Alt|r.Backspace}}),I&&t("\b",{when:i.and(n.focus,i.equals(a.ShellType,_.CommandPrompt)),primary:e.CtrlCmd|r.Backspace}),t("\x1Bd",{primary:e.CtrlCmd|r.Delete,mac:{primary:e.Alt|r.Delete}}),t("",{mac:{primary:e.CtrlCmd|r.Backspace}}),t("",{mac:{primary:e.CtrlCmd|r.LeftArrow}}),t("",{mac:{primary:e.CtrlCmd|r.RightArrow}}),t("\0",{primary:e.CtrlCmd|e.Shift|r.Digit2,mac:{primary:e.WinCtrl|e.Shift|r.Digit2}}),t("",{primary:e.CtrlCmd|e.Shift|r.Digit6,mac:{primary:e.WinCtrl|e.Shift|r.Digit6}}),t("",{primary:e.CtrlCmd|r.Slash,mac:{primary:e.WinCtrl|r.Slash}}),le(),Ce(),$();
