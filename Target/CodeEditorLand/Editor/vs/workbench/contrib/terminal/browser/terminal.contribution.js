import{KeyCode as r,KeyMod as e}from"../../../../../vs/base/common/keyCodes.js";import{Schemas as q}from"../../../../../vs/base/common/network.js";import{isIOS as O,isWindows as I}from"../../../../../vs/base/common/platform.js";import{URI as N}from"../../../../../vs/base/common/uri.js";import"vs/css!./media/terminal";import"vs/css!./media/terminalVoice";import"vs/css!./media/widgets";import"vs/css!./media/xterm";import*as C from"../../../../../vs/nls.js";import{CONTEXT_ACCESSIBILITY_MODE_ENABLED as m}from"../../../../../vs/platform/accessibility/common/accessibility.js";import{CommandsRegistry as w}from"../../../../../vs/platform/commands/common/commands.js";import{ContextKeyExpr as i}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{Extensions as L}from"../../../../../vs/platform/dnd/browser/dnd.js";import{SyncDescriptor as u}from"../../../../../vs/platform/instantiation/common/descriptors.js";import{InstantiationType as l,registerSingleton as s}from"../../../../../vs/platform/instantiation/common/extensions.js";import{KeybindingsRegistry as B,KeybindingWeight as Q}from"../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import{Extensions as z}from"../../../../../vs/platform/quickinput/common/quickAccess.js";import{Registry as p}from"../../../../../vs/platform/registry/common/platform.js";import{GeneralShellType as c,ITerminalLogService as M,WindowsShellType as _}from"../../../../../vs/platform/terminal/common/terminal.js";import{TerminalLogService as F}from"../../../../../vs/platform/terminal/common/terminalLogService.js";import{registerTerminalPlatformConfiguration as G}from"../../../../../vs/platform/terminal/common/terminalPlatformConfiguration.js";import{EditorPaneDescriptor as H}from"../../../../../vs/workbench/browser/editor.js";import{ViewPaneContainer as J}from"../../../../../vs/workbench/browser/parts/views/viewPaneContainer.js";import{getQuickNavigateHandler as E}from"../../../../../vs/workbench/browser/quickaccess.js";import{registerWorkbenchContribution2 as h,WorkbenchPhase as S}from"../../../../../vs/workbench/common/contributions.js";import{EditorExtensions as A}from"../../../../../vs/workbench/common/editor.js";import{Extensions as D,ViewContainerLocation as X}from"../../../../../vs/workbench/common/views.js";import{RemoteTerminalBackendContribution as k}from"../../../../../vs/workbench/contrib/terminal/browser/remoteTerminalBackend.js";import{ITerminalConfigurationService as U,ITerminalEditorService as Y,ITerminalGroupService as $,ITerminalInstanceService as j,ITerminalService as Z,TerminalDataTransfers as b,terminalEditorId as ee}from"../../../../../vs/workbench/contrib/terminal/browser/terminal.js";import{registerTerminalActions as re,terminalSendSequenceCommand as ie}from"../../../../../vs/workbench/contrib/terminal/browser/terminalActions.js";import{setupTerminalCommands as te}from"../../../../../vs/workbench/contrib/terminal/browser/terminalCommands.js";import{TerminalConfigurationService as ne}from"../../../../../vs/workbench/contrib/terminal/browser/terminalConfigurationService.js";import{TerminalEditor as oe}from"../../../../../vs/workbench/contrib/terminal/browser/terminalEditor.js";import{TerminalEditorInput as R}from"../../../../../vs/workbench/contrib/terminal/browser/terminalEditorInput.js";import{TerminalInputSerializer as ae}from"../../../../../vs/workbench/contrib/terminal/browser/terminalEditorSerializer.js";import{TerminalEditorService as me}from"../../../../../vs/workbench/contrib/terminal/browser/terminalEditorService.js";import{TerminalGroupService as le}from"../../../../../vs/workbench/contrib/terminal/browser/terminalGroupService.js";import{terminalViewIcon as P}from"../../../../../vs/workbench/contrib/terminal/browser/terminalIcons.js";import{TerminalInstanceService as se}from"../../../../../vs/workbench/contrib/terminal/browser/terminalInstanceService.js";import{TerminalMainContribution as x}from"../../../../../vs/workbench/contrib/terminal/browser/terminalMainContribution.js";import{setupTerminalMenus as ce}from"../../../../../vs/workbench/contrib/terminal/browser/terminalMenus.js";import{TerminalProfileService as pe}from"../../../../../vs/workbench/contrib/terminal/browser/terminalProfileService.js";import{TerminalQuickAccessProvider as v}from"../../../../../vs/workbench/contrib/terminal/browser/terminalQuickAccess.js";import{TerminalService as de}from"../../../../../vs/workbench/contrib/terminal/browser/terminalService.js";import{TerminalViewPane as fe}from"../../../../../vs/workbench/contrib/terminal/browser/terminalView.js";import{TerminalWslRecommendationContribution as K}from"../../../../../vs/workbench/contrib/terminal/browser/terminalWslRecommendationContribution.js";import{ITerminalProfileService as ge,TERMINAL_VIEW_ID as y,TerminalCommandId as T}from"../../../../../vs/workbench/contrib/terminal/common/terminal.js";import{registerColors as Ce}from"../../../../../vs/workbench/contrib/terminal/common/terminalColorRegistry.js";import{registerTerminalConfiguration as ye}from"../../../../../vs/workbench/contrib/terminal/common/terminalConfiguration.js";import{TerminalContextKeys as n,TerminalContextKeyStrings as a}from"../../../../../vs/workbench/contrib/terminal/common/terminalContextKey.js";import{terminalStrings as ue}from"../../../../../vs/workbench/contrib/terminal/common/terminalStrings.js";import{TerminalSuggestSettingId as he}from"../../../../../vs/workbench/contrib/terminalContrib/suggest/common/terminalSuggestConfiguration.js";s(M,F,l.Delayed),s(U,ne,l.Delayed),s(Z,de,l.Delayed),s(Y,me,l.Delayed),s($,le,l.Delayed),s(j,se,l.Delayed),s(ge,pe,l.Delayed);const Se=p.as(z.Quickaccess),Te="inTerminalPicker";Se.registerQuickAccessProvider({ctor:v,prefix:v.PREFIX,contextKey:Te,placeholder:C.localize("tasksQuickAccessPlaceholder","Type the name of a terminal to open."),helpEntries:[{description:C.localize("tasksQuickAccessHelp","Show All Opened Terminals"),commandId:T.QuickOpenTerm}]});const V="workbench.action.quickOpenNavigateNextInTerminalPicker";w.registerCommand({id:V,handler:E(V,!0)});const W="workbench.action.quickOpenNavigatePreviousInTerminalPicker";w.registerCommand({id:W,handler:E(W,!1)}),h(x.ID,x,S.BlockStartup),h(k.ID,k,S.AfterRestored),h(K.ID,K,S.Eventually),G(),ye(),p.as(A.EditorFactory).registerEditorSerializer(R.ID,ae),p.as(A.EditorPane).registerEditorPane(H.create(oe,ee,ue.terminal),[new u(R)]),p.as(L.DragAndDropContribution).register({dataFormatKey:b.Terminals,getEditorInputs(d){const o=[];try{const f=JSON.parse(d);for(const g of f)o.push({resource:N.parse(g)})}catch{}return o},setData(d,o){const f=d.filter(({resource:g})=>g.scheme===q.vscodeTerminal);f.length&&o.dataTransfer?.setData(b.Terminals,JSON.stringify(f.map(({resource:g})=>g.toString())))}});const Ie=p.as(D.ViewContainersRegistry).registerViewContainer({id:y,title:C.localize2("terminal","Terminal"),icon:P,ctorDescriptor:new u(J,[y,{mergeViewWithContainerWhenSingleView:!0}]),storageId:y,hideIfEmpty:!0,order:3},X.Panel,{doNotRegisterOpenCommand:!0,isDefault:!0});p.as(D.ViewsRegistry).registerViews([{id:y,name:C.localize2("terminal","Terminal"),containerIcon:P,canToggleVisibility:!1,canMoveView:!0,ctorDescriptor:new u(fe),openCommandActionDescriptor:{id:T.Toggle,mnemonicTitle:C.localize({key:"miToggleIntegratedTerminal",comment:["&& denotes a mnemonic"]},"&&Terminal"),keybindings:{primary:e.CtrlCmd|r.Backquote,mac:{primary:e.WinCtrl|r.Backquote}},order:3}}],Ie),re();function t(d,o){B.registerCommandAndKeybindingRule({id:T.SendSequence,weight:Q.WorkbenchContrib,when:o.when||n.focus,primary:o.primary,mac:o.mac,linux:o.linux,win:o.win,handler:ie,args:{text:d}})}var we=(o=>(o[o.CtrlLetterOffset=64]="CtrlLetterOffset",o))(we||{});I&&t("",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),m.negate()),primary:e.CtrlCmd|r.KeyV}),t("\x1B[24~a",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.CtrlCmd|r.Space,mac:{primary:e.WinCtrl|r.Space}}),t("\x1B[24~b",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.Alt|r.Space}),t("\x1B[24~c",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),primary:e.Shift|r.Enter}),t("\x1B[24~d",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate()),mac:{primary:e.Shift|e.CtrlCmd|r.RightArrow}}),t("\x1B[24~e",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell),n.terminalShellIntegrationEnabled,m.negate(),i.equals(`config.${he.Enabled}`,!0)),primary:e.CtrlCmd|r.Space,mac:{primary:e.WinCtrl|r.Space}}),t("\x1B[1;2H",{when:i.and(n.focus,i.equals(a.ShellType,c.PowerShell)),mac:{primary:e.Shift|e.CtrlCmd|r.LeftArrow}}),t("",{when:i.and(n.focus,m),primary:e.CtrlCmd|e.Alt|r.KeyR,mac:{primary:e.WinCtrl|e.Alt|r.KeyR}}),t("\x07",{when:n.focus,primary:e.CtrlCmd|e.Alt|r.KeyG,mac:{primary:e.WinCtrl|e.Alt|r.KeyG}}),O&&t("",{when:i.and(n.focus),primary:e.WinCtrl|r.KeyC}),t("",{primary:e.CtrlCmd|r.Backspace,mac:{primary:e.Alt|r.Backspace}}),I&&t("\b",{when:i.and(n.focus,i.equals(a.ShellType,_.CommandPrompt)),primary:e.CtrlCmd|r.Backspace}),t("\x1Bd",{primary:e.CtrlCmd|r.Delete,mac:{primary:e.Alt|r.Delete}}),t("",{mac:{primary:e.CtrlCmd|r.Backspace}}),t("",{mac:{primary:e.CtrlCmd|r.LeftArrow}}),t("",{mac:{primary:e.CtrlCmd|r.RightArrow}}),t("\0",{primary:e.CtrlCmd|e.Shift|r.Digit2,mac:{primary:e.WinCtrl|e.Shift|r.Digit2}}),t("",{primary:e.CtrlCmd|e.Shift|r.Digit6,mac:{primary:e.WinCtrl|e.Shift|r.Digit6}}),t("",{primary:e.CtrlCmd|r.Slash,mac:{primary:e.WinCtrl|r.Slash}}),te(),ce(),Ce();
