{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminal/browser/terminalEditor.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../base/browser/dom.js\";\nimport type { IBaseActionViewItemOptions } from \"../../../../base/browser/ui/actionbar/actionViewItems.js\";\nimport type { IActionViewItem } from \"../../../../base/browser/ui/actionbar/actionbar.js\";\nimport { Action, type IAction } from \"../../../../base/common/actions.js\";\nimport type { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { DisposableStore } from \"../../../../base/common/lifecycle.js\";\nimport { DropdownWithPrimaryActionViewItem } from \"../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js\";\nimport {\n\ttype IMenu,\n\tIMenuService,\n\tMenuId,\n\tMenuItemAction,\n} from \"../../../../platform/actions/common/actions.js\";\nimport { IContextKeyService } from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { IContextMenuService } from \"../../../../platform/contextview/browser/contextView.js\";\nimport type { IEditorOptions } from \"../../../../platform/editor/common/editor.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { IStorageService } from \"../../../../platform/storage/common/storage.js\";\nimport { ITelemetryService } from \"../../../../platform/telemetry/common/telemetry.js\";\nimport { IThemeService } from \"../../../../platform/theme/common/themeService.js\";\nimport { EditorPane } from \"../../../browser/parts/editor/editorPane.js\";\nimport type { IEditorOpenContext } from \"../../../common/editor.js\";\nimport type { IEditorGroup } from \"../../../services/editor/common/editorGroupsService.js\";\nimport { ACTIVE_GROUP } from \"../../../services/editor/common/editorService.js\";\nimport {\n\tIWorkbenchLayoutService,\n\tParts,\n} from \"../../../services/layout/browser/layoutService.js\";\nimport {\n\tITerminalProfileResolverService,\n\tITerminalProfileService,\n\tTerminalCommandId,\n} from \"../common/terminal.js\";\nimport {\n\tITerminalConfigurationService,\n\tITerminalEditorService,\n\tITerminalService,\n\tterminalEditorId,\n} from \"./terminal.js\";\nimport { openContextMenu } from \"./terminalContextMenu.js\";\nimport type { TerminalEditorInput } from \"./terminalEditorInput.js\";\nimport { getTerminalActionBarArgs } from \"./terminalMenus.js\";\n\nexport class TerminalEditor extends EditorPane {\n\tprivate _editorInstanceElement: HTMLElement | undefined;\n\tprivate _overflowGuardElement: HTMLElement | undefined;\n\n\tprivate _editorInput?: TerminalEditorInput = undefined;\n\n\tprivate _lastDimension?: dom.Dimension;\n\n\tprivate readonly _dropdownMenu: IMenu;\n\n\tprivate readonly _instanceMenu: IMenu;\n\n\tprivate _cancelContextMenu = false;\n\n\tprivate readonly _disposableStore = this._register(new DisposableStore());\n\n\tconstructor(\n\t\tgroup: IEditorGroup,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@ITerminalEditorService private readonly _terminalEditorService: ITerminalEditorService,\n\t\t@ITerminalProfileResolverService private readonly _terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@ITerminalService private readonly _terminalService: ITerminalService,\n\t\t@ITerminalConfigurationService private readonly _terminalConfigurationService: ITerminalConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextMenuService private readonly _contextMenuService: IContextMenuService,\n\t\t@ITerminalProfileService private readonly _terminalProfileService: ITerminalProfileService,\n\t\t@IWorkbenchLayoutService private readonly _workbenchLayoutService: IWorkbenchLayoutService\n\t) {\n\t\tsuper(terminalEditorId, group, telemetryService, themeService, storageService);\n\t\tthis._dropdownMenu = this._register(menuService.createMenu(MenuId.TerminalNewDropdownContext, contextKeyService));\n\t\tthis._instanceMenu = this._register(menuService.createMenu(MenuId.TerminalInstanceContext, contextKeyService));\n\t}\n\n\toverride async setInput(\n\t\tnewInput: TerminalEditorInput,\n\t\toptions: IEditorOptions | undefined,\n\t\tcontext: IEditorOpenContext,\n\t\ttoken: CancellationToken,\n\t) {\n\t\tthis._editorInput?.terminalInstance?.detachFromElement();\n\t\tthis._editorInput = newInput;\n\t\tawait super.setInput(newInput, options, context, token);\n\t\tthis._editorInput.terminalInstance?.attachToElement(\n\t\t\tthis._overflowGuardElement!,\n\t\t);\n\t\tif (this._lastDimension) {\n\t\t\tthis.layout(this._lastDimension);\n\t\t}\n\t\tthis._editorInput.terminalInstance?.setVisible(\n\t\t\tthis.isVisible() &&\n\t\t\t\tthis._workbenchLayoutService.isVisible(\n\t\t\t\t\tParts.EDITOR_PART,\n\t\t\t\t\tthis.window,\n\t\t\t\t),\n\t\t);\n\t\tif (this._editorInput.terminalInstance) {\n\t\t\t// since the editor does not monitor focus changes, for ex. between the terminal\n\t\t\t// panel and the editors, this is needed so that the active instance gets set\n\t\t\t// when focus changes between them.\n\t\t\tthis._register(\n\t\t\t\tthis._editorInput.terminalInstance.onDidFocus(() =>\n\t\t\t\t\tthis._setActiveInstance(),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._editorInput.setCopyLaunchConfig(\n\t\t\t\tthis._editorInput.terminalInstance.shellLaunchConfig,\n\t\t\t);\n\t\t}\n\t}\n\n\toverride clearInput(): void {\n\t\tsuper.clearInput();\n\t\tif (\n\t\t\tthis._overflowGuardElement &&\n\t\t\tthis._editorInput?.terminalInstance?.domElement.parentElement ===\n\t\t\t\tthis._overflowGuardElement\n\t\t) {\n\t\t\tthis._editorInput.terminalInstance?.detachFromElement();\n\t\t}\n\t\tthis._editorInput = undefined;\n\t}\n\n\tprivate _setActiveInstance(): void {\n\t\tif (!this._editorInput?.terminalInstance) {\n\t\t\treturn;\n\t\t}\n\t\tthis._terminalEditorService.setActiveInstance(\n\t\t\tthis._editorInput.terminalInstance,\n\t\t);\n\t}\n\n\toverride focus() {\n\t\tsuper.focus();\n\n\t\tthis._editorInput?.terminalInstance?.focus(true);\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/naming-convention\n\tprotected createEditor(parent: HTMLElement): void {\n\t\tthis._editorInstanceElement = parent;\n\t\tthis._overflowGuardElement = dom.$(\n\t\t\t\".terminal-overflow-guard.terminal-editor\",\n\t\t);\n\t\tthis._editorInstanceElement.appendChild(this._overflowGuardElement);\n\t\tthis._registerListeners();\n\t}\n\n\tprivate _registerListeners(): void {\n\t\tif (!this._editorInstanceElement) {\n\t\t\treturn;\n\t\t}\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis._editorInstanceElement,\n\t\t\t\t\"mousedown\",\n\t\t\t\tasync (event: MouseEvent) => {\n\t\t\t\t\tconst terminal = this._terminalEditorService.activeInstance;\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis._terminalEditorService.instances.length > 0 &&\n\t\t\t\t\t\tterminal\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst result = await terminal.handleMouseEvent(\n\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\tthis._instanceMenu,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\ttypeof result === \"object\" &&\n\t\t\t\t\t\t\tresult.cancelContextMenu\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis._cancelContextMenu = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis._editorInstanceElement,\n\t\t\t\t\"contextmenu\",\n\t\t\t\t(event: MouseEvent) => {\n\t\t\t\t\tconst rightClickBehavior =\n\t\t\t\t\t\tthis._terminalConfigurationService.config\n\t\t\t\t\t\t\t.rightClickBehavior;\n\t\t\t\t\tif (rightClickBehavior === \"nothing\" && !event.shiftKey) {\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\tthis._cancelContextMenu = false;\n\t\t\t\t\t\treturn;\n\t\t\t\t\t} else if (\n\t\t\t\t\t\t!this._cancelContextMenu &&\n\t\t\t\t\t\trightClickBehavior !== \"copyPaste\" &&\n\t\t\t\t\t\trightClickBehavior !== \"paste\"\n\t\t\t\t\t) {\n\t\t\t\t\t\tif (!this._cancelContextMenu) {\n\t\t\t\t\t\t\topenContextMenu(\n\t\t\t\t\t\t\t\tthis.window,\n\t\t\t\t\t\t\t\tevent,\n\t\t\t\t\t\t\t\tthis._editorInput?.terminalInstance,\n\t\t\t\t\t\t\t\tthis._instanceMenu,\n\t\t\t\t\t\t\t\tthis._contextMenuService,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\t\tevent.stopImmediatePropagation();\n\t\t\t\t\t\tthis._cancelContextMenu = false;\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\tlayout(dimension: dom.Dimension): void {\n\t\tconst instance = this._editorInput?.terminalInstance;\n\t\tif (instance) {\n\t\t\tinstance.attachToElement(this._overflowGuardElement!);\n\t\t\tinstance.layout(dimension);\n\t\t}\n\t\tthis._lastDimension = dimension;\n\t}\n\n\toverride setVisible(visible: boolean): void {\n\t\tsuper.setVisible(visible);\n\t\tthis._editorInput?.terminalInstance?.setVisible(\n\t\t\tvisible &&\n\t\t\t\tthis._workbenchLayoutService.isVisible(\n\t\t\t\t\tParts.EDITOR_PART,\n\t\t\t\t\tthis.window,\n\t\t\t\t),\n\t\t);\n\t}\n\n\toverride getActionViewItem(\n\t\taction: IAction,\n\t\toptions: IBaseActionViewItemOptions,\n\t): IActionViewItem | undefined {\n\t\tswitch (action.id) {\n\t\t\tcase TerminalCommandId.CreateTerminalEditor: {\n\t\t\t\tif (action instanceof MenuItemAction) {\n\t\t\t\t\tconst location = { viewColumn: ACTIVE_GROUP };\n\t\t\t\t\tconst actions = getTerminalActionBarArgs(\n\t\t\t\t\t\tlocation,\n\t\t\t\t\t\tthis._terminalProfileService.availableProfiles,\n\t\t\t\t\t\tthis._getDefaultProfileName(),\n\t\t\t\t\t\tthis._terminalProfileService.contributedProfiles,\n\t\t\t\t\t\tthis._terminalService,\n\t\t\t\t\t\tthis._dropdownMenu,\n\t\t\t\t\t);\n\t\t\t\t\tthis._registerDisposableActions(\n\t\t\t\t\t\tactions.dropdownAction,\n\t\t\t\t\t\tactions.dropdownMenuActions,\n\t\t\t\t\t);\n\t\t\t\t\tconst button = this._instantiationService.createInstance(\n\t\t\t\t\t\tDropdownWithPrimaryActionViewItem,\n\t\t\t\t\t\taction,\n\t\t\t\t\t\tactions.dropdownAction,\n\t\t\t\t\t\tactions.dropdownMenuActions,\n\t\t\t\t\t\tactions.className,\n\t\t\t\t\t\tthis._contextMenuService,\n\t\t\t\t\t\t{ hoverDelegate: options.hoverDelegate },\n\t\t\t\t\t);\n\t\t\t\t\treturn button;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn super.getActionViewItem(action, options);\n\t}\n\n\t/**\n\t * Actions might be of type Action (disposable) or Separator or SubmenuAction, which don't extend Disposable\n\t */\n\tprivate _registerDisposableActions(\n\t\tdropdownAction: IAction,\n\t\tdropdownMenuActions: IAction[],\n\t): void {\n\t\tthis._disposableStore.clear();\n\t\tif (dropdownAction instanceof Action) {\n\t\t\tthis._disposableStore.add(dropdownAction);\n\t\t}\n\t\tdropdownMenuActions\n\t\t\t.filter((a) => a instanceof Action)\n\t\t\t.forEach((a) => this._disposableStore.add(a));\n\t}\n\n\tprivate _getDefaultProfileName(): string {\n\t\tlet defaultProfileName;\n\t\ttry {\n\t\t\tdefaultProfileName =\n\t\t\t\tthis._terminalProfileService.getDefaultProfileName();\n\t\t} catch (e) {\n\t\t\tdefaultProfileName =\n\t\t\t\tthis._terminalProfileResolverService.defaultProfileName;\n\t\t}\n\t\treturn defaultProfileName!;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
