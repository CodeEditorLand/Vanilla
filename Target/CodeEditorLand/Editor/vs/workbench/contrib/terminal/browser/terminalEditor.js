var v=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var u=(a,o,e,t)=>{for(var i=t>1?void 0:t?f(o,e):o,n=a.length-1,s;n>=0;n--)(s=a[n])&&(i=(t?s(o,e,i):s(i))||i);return t&&i&&v(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import*as c from"../../../../../vs/base/browser/dom.js";import"../../../../../vs/base/browser/ui/actionbar/actionbar.js";import"../../../../../vs/base/browser/ui/actionbar/actionViewItems.js";import{Action as p}from"../../../../../vs/base/common/actions.js";import"../../../../../vs/base/common/cancellation.js";import{DisposableStore as _}from"../../../../../vs/base/common/lifecycle.js";import{DropdownWithPrimaryActionViewItem as S}from"../../../../../vs/platform/actions/browser/dropdownWithPrimaryActionViewItem.js";import{IMenuService as E,MenuId as I,MenuItemAction as w}from"../../../../../vs/platform/actions/common/actions.js";import{IContextKeyService as M}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as g}from"../../../../../vs/platform/contextview/browser/contextView.js";import"../../../../../vs/platform/editor/common/editor.js";import{IInstantiationService as C}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IStorageService as T}from"../../../../../vs/platform/storage/common/storage.js";import{ITelemetryService as y}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{IThemeService as b}from"../../../../../vs/platform/theme/common/themeService.js";import{EditorPane as A}from"../../../../../vs/workbench/browser/parts/editor/editorPane.js";import"../../../../../vs/workbench/common/editor.js";import{ITerminalConfigurationService as P,ITerminalEditorService as D,ITerminalService as x,terminalEditorId as V}from"../../../../../vs/workbench/contrib/terminal/browser/terminal.js";import{openContextMenu as L}from"../../../../../vs/workbench/contrib/terminal/browser/terminalContextMenu.js";import"../../../../../vs/workbench/contrib/terminal/browser/terminalEditorInput.js";import{getTerminalActionBarArgs as G}from"../../../../../vs/workbench/contrib/terminal/browser/terminalMenus.js";import{ITerminalProfileResolverService as k,ITerminalProfileService as O,TerminalCommandId as R}from"../../../../../vs/workbench/contrib/terminal/common/terminal.js";import"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import{ACTIVE_GROUP as N}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchLayoutService as B,Parts as h}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";let l=class extends A{constructor(e,t,i,n,s,F,H,W,m,d,K,j,U,$){super(V,e,t,i,n);this._terminalEditorService=s;this._terminalProfileResolverService=F;this._terminalService=H;this._terminalConfigurationService=W;this._instantiationService=K;this._contextMenuService=j;this._terminalProfileService=U;this._workbenchLayoutService=$;this._dropdownMenu=this._register(d.createMenu(I.TerminalNewDropdownContext,m)),this._instanceMenu=this._register(d.createMenu(I.TerminalInstanceContext,m))}_editorInstanceElement;_overflowGuardElement;_editorInput=void 0;_lastDimension;_dropdownMenu;_instanceMenu;_cancelContextMenu=!1;_disposableStore=this._register(new _);async setInput(e,t,i,n){this._editorInput?.terminalInstance?.detachFromElement(),this._editorInput=e,await super.setInput(e,t,i,n),this._editorInput.terminalInstance?.attachToElement(this._overflowGuardElement),this._lastDimension&&this.layout(this._lastDimension),this._editorInput.terminalInstance?.setVisible(this.isVisible()&&this._workbenchLayoutService.isVisible(h.EDITOR_PART,this.window)),this._editorInput.terminalInstance&&(this._register(this._editorInput.terminalInstance.onDidFocus(()=>this._setActiveInstance())),this._editorInput.setCopyLaunchConfig(this._editorInput.terminalInstance.shellLaunchConfig))}clearInput(){super.clearInput(),this._overflowGuardElement&&this._editorInput?.terminalInstance?.domElement.parentElement===this._overflowGuardElement&&this._editorInput.terminalInstance?.detachFromElement(),this._editorInput=void 0}_setActiveInstance(){this._editorInput?.terminalInstance&&this._terminalEditorService.setActiveInstance(this._editorInput.terminalInstance)}focus(){super.focus(),this._editorInput?.terminalInstance?.focus(!0)}createEditor(e){this._editorInstanceElement=e,this._overflowGuardElement=c.$(".terminal-overflow-guard.terminal-editor"),this._editorInstanceElement.appendChild(this._overflowGuardElement),this._registerListeners()}_registerListeners(){this._editorInstanceElement&&(this._register(c.addDisposableListener(this._editorInstanceElement,"mousedown",async e=>{const t=this._terminalEditorService.activeInstance;if(this._terminalEditorService.instances.length>0&&t){const i=await t.handleMouseEvent(e,this._instanceMenu);typeof i=="object"&&i.cancelContextMenu&&(this._cancelContextMenu=!0)}})),this._register(c.addDisposableListener(this._editorInstanceElement,"contextmenu",e=>{const t=this._terminalConfigurationService.config.rightClickBehavior;if(t==="nothing"&&!e.shiftKey){e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1;return}else!this._cancelContextMenu&&t!=="copyPaste"&&t!=="paste"&&(this._cancelContextMenu||L(this.window,e,this._editorInput?.terminalInstance,this._instanceMenu,this._contextMenuService),e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1)})))}layout(e){const t=this._editorInput?.terminalInstance;t&&(t.attachToElement(this._overflowGuardElement),t.layout(e)),this._lastDimension=e}setVisible(e){super.setVisible(e),this._editorInput?.terminalInstance?.setVisible(e&&this._workbenchLayoutService.isVisible(h.EDITOR_PART,this.window))}getActionViewItem(e,t){switch(e.id){case R.CreateTerminalEditor:if(e instanceof w){const n=G({viewColumn:N},this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return this._registerDisposableActions(n.dropdownAction,n.dropdownMenuActions),this._instantiationService.createInstance(S,e,n.dropdownAction,n.dropdownMenuActions,n.className,this._contextMenuService,{hoverDelegate:t.hoverDelegate})}}return super.getActionViewItem(e,t)}_registerDisposableActions(e,t){this._disposableStore.clear(),e instanceof p&&this._disposableStore.add(e),t.filter(i=>i instanceof p).forEach(i=>this._disposableStore.add(i))}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}};l=u([r(1,y),r(2,b),r(3,T),r(4,D),r(5,k),r(6,x),r(7,P),r(8,M),r(9,E),r(10,C),r(11,g),r(12,O),r(13,B)],l);export{l as TerminalEditor};
