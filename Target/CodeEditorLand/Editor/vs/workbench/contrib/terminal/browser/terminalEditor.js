var v=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var p=(a,o,e,t)=>{for(var i=t>1?void 0:t?f(o,e):o,n=a.length-1,s;n>=0;n--)(s=a[n])&&(i=(t?s(o,e,i):s(i))||i);return t&&i&&v(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import*as l from"../../../../base/browser/dom.js";import{Action as u}from"../../../../base/common/actions.js";import{DisposableStore as _}from"../../../../base/common/lifecycle.js";import{DropdownWithPrimaryActionViewItem as S}from"../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js";import{IMenuService as E,MenuId as I,MenuItemAction as w}from"../../../../platform/actions/common/actions.js";import{IContextKeyService as y}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as M}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as g}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService as b}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as C}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as T}from"../../../../platform/theme/common/themeService.js";import{EditorPane as A}from"../../../browser/parts/editor/editorPane.js";import{ACTIVE_GROUP as P}from"../../../services/editor/common/editorService.js";import{IWorkbenchLayoutService as D,Parts as h}from"../../../services/layout/browser/layoutService.js";import{ITerminalProfileResolverService as x,ITerminalProfileService as V,TerminalCommandId as L}from"../common/terminal.js";import{ITerminalConfigurationService as G,ITerminalEditorService as k,ITerminalService as O,terminalEditorId as R}from"./terminal.js";import{openContextMenu as j}from"./terminalContextMenu.js";import{getTerminalActionBarArgs as N}from"./terminalMenus.js";let c=class extends A{constructor(e,t,i,n,s,B,F,H,m,d,W,K,U,$){super(R,e,t,i,n);this._terminalEditorService=s;this._terminalProfileResolverService=B;this._terminalService=F;this._terminalConfigurationService=H;this._instantiationService=W;this._contextMenuService=K;this._terminalProfileService=U;this._workbenchLayoutService=$;this._dropdownMenu=this._register(d.createMenu(I.TerminalNewDropdownContext,m)),this._instanceMenu=this._register(d.createMenu(I.TerminalInstanceContext,m))}_editorInstanceElement;_overflowGuardElement;_editorInput=void 0;_lastDimension;_dropdownMenu;_instanceMenu;_cancelContextMenu=!1;_disposableStore=this._register(new _);async setInput(e,t,i,n){this._editorInput?.terminalInstance?.detachFromElement(),this._editorInput=e,await super.setInput(e,t,i,n),this._editorInput.terminalInstance?.attachToElement(this._overflowGuardElement),this._lastDimension&&this.layout(this._lastDimension),this._editorInput.terminalInstance?.setVisible(this.isVisible()&&this._workbenchLayoutService.isVisible(h.EDITOR_PART,this.window)),this._editorInput.terminalInstance&&(this._register(this._editorInput.terminalInstance.onDidFocus(()=>this._setActiveInstance())),this._editorInput.setCopyLaunchConfig(this._editorInput.terminalInstance.shellLaunchConfig))}clearInput(){super.clearInput(),this._overflowGuardElement&&this._editorInput?.terminalInstance?.domElement.parentElement===this._overflowGuardElement&&this._editorInput.terminalInstance?.detachFromElement(),this._editorInput=void 0}_setActiveInstance(){this._editorInput?.terminalInstance&&this._terminalEditorService.setActiveInstance(this._editorInput.terminalInstance)}focus(){super.focus(),this._editorInput?.terminalInstance?.focus(!0)}createEditor(e){this._editorInstanceElement=e,this._overflowGuardElement=l.$(".terminal-overflow-guard.terminal-editor"),this._editorInstanceElement.appendChild(this._overflowGuardElement),this._registerListeners()}_registerListeners(){this._editorInstanceElement&&(this._register(l.addDisposableListener(this._editorInstanceElement,"mousedown",async e=>{const t=this._terminalEditorService.activeInstance;if(this._terminalEditorService.instances.length>0&&t){const i=await t.handleMouseEvent(e,this._instanceMenu);typeof i=="object"&&i.cancelContextMenu&&(this._cancelContextMenu=!0)}})),this._register(l.addDisposableListener(this._editorInstanceElement,"contextmenu",e=>{const t=this._terminalConfigurationService.config.rightClickBehavior;if(t==="nothing"&&!e.shiftKey){e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1;return}else!this._cancelContextMenu&&t!=="copyPaste"&&t!=="paste"&&(this._cancelContextMenu||j(this.window,e,this._editorInput?.terminalInstance,this._instanceMenu,this._contextMenuService),e.preventDefault(),e.stopImmediatePropagation(),this._cancelContextMenu=!1)})))}layout(e){const t=this._editorInput?.terminalInstance;t&&(t.attachToElement(this._overflowGuardElement),t.layout(e)),this._lastDimension=e}setVisible(e){super.setVisible(e),this._editorInput?.terminalInstance?.setVisible(e&&this._workbenchLayoutService.isVisible(h.EDITOR_PART,this.window))}getActionViewItem(e,t){switch(e.id){case L.CreateTerminalEditor:if(e instanceof w){const n=N({viewColumn:P},this._terminalProfileService.availableProfiles,this._getDefaultProfileName(),this._terminalProfileService.contributedProfiles,this._terminalService,this._dropdownMenu);return this._registerDisposableActions(n.dropdownAction,n.dropdownMenuActions),this._instantiationService.createInstance(S,e,n.dropdownAction,n.dropdownMenuActions,n.className,this._contextMenuService,{hoverDelegate:t.hoverDelegate})}}return super.getActionViewItem(e,t)}_registerDisposableActions(e,t){this._disposableStore.clear(),e instanceof u&&this._disposableStore.add(e),t.filter(i=>i instanceof u).forEach(i=>this._disposableStore.add(i))}_getDefaultProfileName(){let e;try{e=this._terminalProfileService.getDefaultProfileName()}catch{e=this._terminalProfileResolverService.defaultProfileName}return e}};c=p([r(1,C),r(2,T),r(3,b),r(4,k),r(5,x),r(6,O),r(7,G),r(8,y),r(9,E),r(10,g),r(11,M),r(12,V),r(13,D)],c);export{c as TerminalEditor};
