import{Emitter as t}from"../../../../base/common/event.js";import{Disposable as n}from"../../../../base/common/lifecycle.js";import{mark as i}from"../../../../base/common/performance.js";import{URI as a}from"../../../../base/common/uri.js";import{ProcessPropertyType as s}from"../../../../platform/terminal/common/terminal.js";class h extends n{constructor(r,e){super();this.id=r;this.shouldPersist=e}_properties={cwd:"",initialCwd:"",fixedDimensions:{cols:void 0,rows:void 0},title:"",shellType:void 0,hasChildProcesses:!0,resolvedShellLaunchConfig:{},overrideDimensions:void 0,failedShellIntegrationActivation:!1,usedShellIntegrationInjection:void 0};_lastDimensions={cols:-1,rows:-1};_inReplay=!1;_onProcessData=this._register(new t);onProcessData=this._onProcessData.event;_onProcessReplayComplete=this._register(new t);onProcessReplayComplete=this._onProcessReplayComplete.event;_onProcessReady=this._register(new t);onProcessReady=this._onProcessReady.event;_onDidChangeProperty=this._register(new t);onDidChangeProperty=this._onDidChangeProperty.event;_onProcessExit=this._register(new t);onProcessExit=this._onProcessExit.event;_onRestoreCommands=this._register(new t);onRestoreCommands=this._onRestoreCommands.event;async getInitialCwd(){return this._properties.initialCwd}async getCwd(){return this._properties.cwd||this._properties.initialCwd}handleData(r){this._onProcessData.fire(r)}handleExit(r){this._onProcessExit.fire(r)}handleReady(r){this._onProcessReady.fire(r)}handleDidChangeProperty({type:r,value:e}){switch(r){case s.Cwd:this._properties.cwd=e;break;case s.InitialCwd:this._properties.initialCwd=e;break;case s.ResolvedShellLaunchConfig:e.cwd&&typeof e.cwd!="string"&&(e.cwd=a.revive(e.cwd))}this._onDidChangeProperty.fire({type:r,value:e})}async handleReplay(r){i(`code/terminal/willHandleReplay/${this.id}`);try{this._inReplay=!0;for(const e of r.events){(e.cols!==0||e.rows!==0)&&this._onDidChangeProperty.fire({type:s.OverrideDimensions,value:{cols:e.cols,rows:e.rows,forceExactSize:!0}});const o={data:e.data,trackCommit:!0};this._onProcessData.fire(o),await o.writePromise}}finally{this._inReplay=!1}r.commands&&this._onRestoreCommands.fire(r.commands),this._onDidChangeProperty.fire({type:s.OverrideDimensions,value:void 0}),i(`code/terminal/didHandleReplay/${this.id}`),this._onProcessReplayComplete.fire()}}export{h as BasePty};
