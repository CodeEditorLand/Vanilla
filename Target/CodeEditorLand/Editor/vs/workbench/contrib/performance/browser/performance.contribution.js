import{localize2 as o}from"../../../../nls.js";import{registerAction2 as n,Action2 as s}from"../../../../platform/actions/common/actions.js";import{IInstantiationService as m}from"../../../../platform/instantiation/common/instantiation.js";import{LifecyclePhase as v}from"../../../services/lifecycle/common/lifecycle.js";import{Registry as a}from"../../../../platform/registry/common/platform.js";import{Categories as c}from"../../../../platform/action/common/actionCommonCategories.js";import{Extensions as g,registerWorkbenchContribution2 as d}from"../../../common/contributions.js";import{EditorExtensions as y}from"../../../common/editor.js";import{PerfviewContrib as l,PerfviewInput as f}from"./perfviewEditor.js";import{IEditorService as S}from"../../../services/editor/common/editorService.js";import{InstantiationService as E,Trace as p}from"../../../../platform/instantiation/common/instantiationService.js";import{EventProfiling as u}from"../../../../base/common/event.js";import{InputLatencyContrib as I}from"./inputLatencyContrib.js";d(l.ID,l,{lazy:!0}),a.as(y.EditorFactory).registerEditorSerializer(f.Id,class{canSerialize(){return!0}serialize(){return""}deserialize(r){return r.createInstance(f)}}),n(class extends s{constructor(){super({id:"perfview.show",title:o("show.label","Startup Performance"),category:c.Developer,f1:!0})}run(r){const e=r.get(S),t=l.get();return e.openEditor(t.getEditorInput(),{pinned:!0})}}),n(class extends s{constructor(){super({id:"perf.insta.printAsyncCycles",title:o("cycles","Print Service Cycles"),category:c.Developer,f1:!0})}run(e){const t=e.get(m);if(t instanceof E){const i=t._globalGraph?.findCycleSlow();i?console.warn("CYCLE",i):console.warn("YEAH, no more cycles")}}}),n(class extends s{constructor(){super({id:"perf.insta.printTraces",title:o("insta.trace","Print Service Traces"),category:c.Developer,f1:!0})}run(){if(p.all.size===0){console.log("Enable via `instantiationService.ts#_enableAllTracing`");return}for(const e of p.all)console.log(e)}}),n(class extends s{constructor(){super({id:"perf.event.profiling",title:o("emitter","Print Emitter Profiles"),category:c.Developer,f1:!0})}run(){if(u.all.size===0){console.log("USE `EmitterOptions._profName` to enable profiling");return}for(const e of u.all)console.log(`${e.name}: ${e.invocationCount} invocations COST ${e.elapsedOverall}ms, ${e.listenerCount} listeners, avg cost is ${e.durations.reduce((t,i)=>t+i,0)/e.durations.length}ms`)}}),a.as(g.Workbench).registerWorkbenchContribution(I,v.Eventually);
