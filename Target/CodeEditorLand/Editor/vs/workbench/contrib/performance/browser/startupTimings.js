var I=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var m=(a,o,e,t)=>{for(var i=t>1?void 0:t?g(o,e):o,n=a.length-1,s;n>=0;n--)(s=a[n])&&(i=(t?s(o,e,i):s(i))||i);return t&&i&&I(o,e,i),i},r=(a,o)=>(e,t)=>o(e,t,a);import{hash as P}from"../../../../../vs/base/common/hash.js";import{posix as _}from"../../../../../vs/base/common/path.js";import{isCodeEditor as C}from"../../../../../vs/editor/browser/editorBrowser.js";import{ILogService as E}from"../../../../../vs/platform/log/common/log.js";import{IProductService as b}from"../../../../../vs/platform/product/common/productService.js";import{ITelemetryService as l}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{IUpdateService as S}from"../../../../../vs/platform/update/common/update.js";import{IWorkspaceTrustManagementService as f}from"../../../../../vs/platform/workspace/common/workspaceTrust.js";import"../../../../../vs/workbench/common/contributions.js";import{ViewContainerLocation as d}from"../../../../../vs/workbench/common/views.js";import*as k from"../../../../../vs/workbench/contrib/files/common/files.js";import{IEditorService as u}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IBrowserWorkbenchEnvironmentService as L}from"../../../../../vs/workbench/services/environment/browser/environmentService.js";import{ILifecycleService as h,StartupKind as W,StartupKindToString as w}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";import{IPaneCompositePartService as y}from"../../../../../vs/workbench/services/panecomposite/browser/panecomposite.js";import{ITimerService as $}from"../../../../../vs/workbench/services/timer/browser/timerService.js";let c=class{constructor(o,e,t,i,n){this._editorService=o;this._paneCompositeService=e;this._lifecycleService=t;this._updateService=i;this._workspaceTrustService=n}async _isStandardStartup(){if(this._lifecycleService.startupKind!==W.NewWindow)return w(this._lifecycleService.startupKind);if(!this._workspaceTrustService.isWorkspaceTrusted())return"Workspace not trusted";const o=this._paneCompositeService.getActivePaneComposite(d.Sidebar);if(!o||o.getId()!==k.VIEWLET_ID)return"Explorer viewlet not visible";const e=this._editorService.visibleEditorPanes;if(e.length!==1)return`Expected text editor count : 1, Actual : ${e.length}`;if(!C(e[0].getControl()))return"Active editor is not a text editor";const t=this._paneCompositeService.getActivePaneComposite(d.Panel);if(t)return`Current active panel : ${this._paneCompositeService.getPaneComposite(t.getId(),d.Panel)?.name}`;if(await this._updateService.isLatestVersion()===!1)return"Not on latest version, updates available"}};c=m([r(0,u),r(1,y),r(2,h),r(3,S),r(4,f)],c);let p=class extends c{constructor(e,t,i,n,s,x,T,A,D,M){super(e,t,i,n,s);this.timerService=x;this.logService=T;this.environmentService=A;this.telemetryService=D;this.productService=M;this.logPerfMarks()}async logPerfMarks(){if(!this.environmentService.profDurationMarkers)return;await this.timerService.whenReady();const e=await this._isStandardStartup(),t=await this.timerService.perfBaseline,[i,n]=this.environmentService.profDurationMarkers,s=`${this.timerService.getDuration(i,n)}	${this.productService.nameShort}	${(this.productService.commit||"").slice(0,10)||"0000000000"}	${this.telemetryService.sessionId}	${e===void 0?"standard_start":"NO_standard_start : "+e}	${String(t).padStart(4,"0")}ms
`;this.logService.info(`[prof-timers] ${s}`)}};p=m([r(0,u),r(1,y),r(2,h),r(3,S),r(4,f),r(5,$),r(6,E),r(7,L),r(8,l),r(9,b)],p);let v=class{constructor(o){for(const e of performance.getEntriesByType("resource"))try{const t=new URL(e.name),i=_.basename(t.pathname);o.publicLog2("startup.resource.perf",{hosthash:`H${P(t.host).toString(16)}`,name:i,duration:e.duration})}catch{}}};v=m([r(0,l)],v);export{v as BrowserResourcePerformanceMarks,p as BrowserStartupTimings,c as StartupTimings};
