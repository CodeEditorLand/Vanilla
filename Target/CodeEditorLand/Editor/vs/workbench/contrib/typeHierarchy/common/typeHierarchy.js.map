{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/typeHierarchy/common/typeHierarchy.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IRange, Range } from '../../../../editor/common/core/range.js';\nimport { SymbolKind, ProviderResult, SymbolTag } from '../../../../editor/common/languages.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { LanguageFeatureRegistry } from '../../../../editor/common/languageFeatureRegistry.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IPosition, Position } from '../../../../editor/common/core/position.js';\nimport { isNonEmptyArray } from '../../../../base/common/arrays.js';\nimport { onUnexpectedExternalError } from '../../../../base/common/errors.js';\nimport { IDisposable, RefCountedDisposable } from '../../../../base/common/lifecycle.js';\nimport { CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { assertType } from '../../../../base/common/types.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\n\nexport const enum TypeHierarchyDirection {\n\tSubtypes = 'subtypes',\n\tSupertypes = 'supertypes'\n}\n\nexport interface TypeHierarchyItem {\n\t_sessionId: string;\n\t_itemId: string;\n\tkind: SymbolKind;\n\tname: string;\n\tdetail?: string;\n\turi: URI;\n\trange: IRange;\n\tselectionRange: IRange;\n\ttags?: SymbolTag[];\n}\n\nexport interface TypeHierarchySession {\n\troots: TypeHierarchyItem[];\n\tdispose(): void;\n}\n\nexport interface TypeHierarchyProvider {\n\tprepareTypeHierarchy(document: ITextModel, position: IPosition, token: CancellationToken): ProviderResult<TypeHierarchySession>;\n\tprovideSupertypes(item: TypeHierarchyItem, token: CancellationToken): ProviderResult<TypeHierarchyItem[]>;\n\tprovideSubtypes(item: TypeHierarchyItem, token: CancellationToken): ProviderResult<TypeHierarchyItem[]>;\n}\n\nexport const TypeHierarchyProviderRegistry = new LanguageFeatureRegistry<TypeHierarchyProvider>();\n\n\n\nexport class TypeHierarchyModel {\n\n\tstatic async create(model: ITextModel, position: IPosition, token: CancellationToken): Promise<TypeHierarchyModel | undefined> {\n\t\tconst [provider] = TypeHierarchyProviderRegistry.ordered(model);\n\t\tif (!provider) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst session = await provider.prepareTypeHierarchy(model, position, token);\n\t\tif (!session) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn new TypeHierarchyModel(session.roots.reduce((p, c) => p + c._sessionId, ''), provider, session.roots, new RefCountedDisposable(session));\n\t}\n\n\treadonly root: TypeHierarchyItem;\n\n\tprivate constructor(\n\t\treadonly id: string,\n\t\treadonly provider: TypeHierarchyProvider,\n\t\treadonly roots: TypeHierarchyItem[],\n\t\treadonly ref: RefCountedDisposable,\n\t) {\n\t\tthis.root = roots[0];\n\t}\n\n\tdispose(): void {\n\t\tthis.ref.release();\n\t}\n\n\tfork(item: TypeHierarchyItem): TypeHierarchyModel {\n\t\tconst that = this;\n\t\treturn new class extends TypeHierarchyModel {\n\t\t\tconstructor() {\n\t\t\t\tsuper(that.id, that.provider, [item], that.ref.acquire());\n\t\t\t}\n\t\t};\n\t}\n\n\tasync provideSupertypes(item: TypeHierarchyItem, token: CancellationToken): Promise<TypeHierarchyItem[]> {\n\t\ttry {\n\t\t\tconst result = await this.provider.provideSupertypes(item, token);\n\t\t\tif (isNonEmptyArray(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tonUnexpectedExternalError(e);\n\t\t}\n\t\treturn [];\n\t}\n\n\tasync provideSubtypes(item: TypeHierarchyItem, token: CancellationToken): Promise<TypeHierarchyItem[]> {\n\t\ttry {\n\t\t\tconst result = await this.provider.provideSubtypes(item, token);\n\t\t\tif (isNonEmptyArray(result)) {\n\t\t\t\treturn result;\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tonUnexpectedExternalError(e);\n\t\t}\n\t\treturn [];\n\t}\n}\n\n// --- API command support\n\nconst _models = new Map<string, TypeHierarchyModel>();\n\nCommandsRegistry.registerCommand('_executePrepareTypeHierarchy', async (accessor, ...args) => {\n\tconst [resource, position] = args;\n\tassertType(URI.isUri(resource));\n\tassertType(Position.isIPosition(position));\n\n\tconst modelService = accessor.get(IModelService);\n\tlet textModel = modelService.getModel(resource);\n\tlet textModelReference: IDisposable | undefined;\n\tif (!textModel) {\n\t\tconst textModelService = accessor.get(ITextModelService);\n\t\tconst result = await textModelService.createModelReference(resource);\n\t\ttextModel = result.object.textEditorModel;\n\t\ttextModelReference = result;\n\t}\n\n\ttry {\n\t\tconst model = await TypeHierarchyModel.create(textModel, position, CancellationToken.None);\n\t\tif (!model) {\n\t\t\treturn [];\n\t\t}\n\n\t\t_models.set(model.id, model);\n\t\t_models.forEach((value, key, map) => {\n\t\t\tif (map.size > 10) {\n\t\t\t\tvalue.dispose();\n\t\t\t\t_models.delete(key);\n\t\t\t}\n\t\t});\n\t\treturn [model.root];\n\n\t} finally {\n\t\ttextModelReference?.dispose();\n\t}\n});\n\nfunction isTypeHierarchyItemDto(obj: any): obj is TypeHierarchyItem {\n\tconst item = obj as TypeHierarchyItem;\n\treturn typeof obj === 'object'\n\t\t&& typeof item.name === 'string'\n\t\t&& typeof item.kind === 'number'\n\t\t&& URI.isUri(item.uri)\n\t\t&& Range.isIRange(item.range)\n\t\t&& Range.isIRange(item.selectionRange);\n}\n\nCommandsRegistry.registerCommand('_executeProvideSupertypes', async (_accessor, ...args) => {\n\tconst [item] = args;\n\tassertType(isTypeHierarchyItemDto(item));\n\n\t// find model\n\tconst model = _models.get(item._sessionId);\n\tif (!model) {\n\t\treturn undefined;\n\t}\n\n\treturn model.provideSupertypes(item, CancellationToken.None);\n});\n\nCommandsRegistry.registerCommand('_executeProvideSubtypes', async (_accessor, ...args) => {\n\tconst [item] = args;\n\tassertType(isTypeHierarchyItemDto(item));\n\n\t// find model\n\tconst model = _models.get(item._sessionId);\n\tif (!model) {\n\t\treturn undefined;\n\t}\n\n\treturn model.provideSubtypes(item, CancellationToken.None);\n});\n"],
  "mappings": "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",
  "names": ["TypeHierarchyDirection"]
}
