{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/bulkEdit/browser/bulkCellEdits.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { groupBy } from '../../../../base/common/arrays.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { compare } from '../../../../base/common/strings.js';\nimport { isObject } from '../../../../base/common/types.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ResourceEdit } from '../../../../editor/browser/services/bulkEditService.js';\nimport { WorkspaceEditMetadata } from '../../../../editor/common/languages.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { UndoRedoGroup, UndoRedoSource } from '../../../../platform/undoRedo/common/undoRedo.js';\nimport { getNotebookEditorFromEditorPane } from '../../notebook/browser/notebookBrowser.js';\nimport { CellUri, ICellPartialMetadataEdit, ICellReplaceEdit, IDocumentMetadataEdit, ISelectionState, IWorkspaceNotebookCellEdit, SelectionStateType } from '../../notebook/common/notebookCommon.js';\nimport { INotebookEditorModelResolverService } from '../../notebook/common/notebookEditorModelResolverService.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\n\nexport class ResourceNotebookCellEdit extends ResourceEdit implements IWorkspaceNotebookCellEdit {\n\n\tstatic is(candidate: any): candidate is IWorkspaceNotebookCellEdit {\n\t\tif (candidate instanceof ResourceNotebookCellEdit) {\n\t\t\treturn true;\n\t\t}\n\t\treturn URI.isUri((<IWorkspaceNotebookCellEdit>candidate).resource)\n\t\t\t&& isObject((<IWorkspaceNotebookCellEdit>candidate).cellEdit);\n\t}\n\n\tstatic lift(edit: IWorkspaceNotebookCellEdit): ResourceNotebookCellEdit {\n\t\tif (edit instanceof ResourceNotebookCellEdit) {\n\t\t\treturn edit;\n\t\t}\n\t\treturn new ResourceNotebookCellEdit(edit.resource, edit.cellEdit, edit.notebookVersionId, edit.metadata);\n\t}\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\treadonly cellEdit: ICellPartialMetadataEdit | IDocumentMetadataEdit | ICellReplaceEdit,\n\t\treadonly notebookVersionId: number | undefined = undefined,\n\t\tmetadata?: WorkspaceEditMetadata\n\t) {\n\t\tsuper(metadata);\n\t}\n}\n\nexport class BulkCellEdits {\n\n\tconstructor(\n\t\tprivate readonly _undoRedoGroup: UndoRedoGroup,\n\t\tundoRedoSource: UndoRedoSource | undefined,\n\t\tprivate readonly _progress: IProgress<void>,\n\t\tprivate readonly _token: CancellationToken,\n\t\tprivate readonly _edits: ResourceNotebookCellEdit[],\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorModelResolverService private readonly _notebookModelService: INotebookEditorModelResolverService,\n\t) {\n\t\tthis._edits = this._edits.map(e => {\n\t\t\tif (e.resource.scheme === CellUri.scheme) {\n\t\t\t\tconst uri = CellUri.parse(e.resource)?.notebook;\n\t\t\t\tif (!uri) {\n\t\t\t\t\tthrow new Error(`Invalid notebook URI: ${e.resource}`);\n\t\t\t\t}\n\n\t\t\t\treturn new ResourceNotebookCellEdit(uri, e.cellEdit, e.notebookVersionId, e.metadata);\n\t\t\t} else {\n\t\t\t\treturn e;\n\t\t\t}\n\t\t});\n\t}\n\n\tasync apply(): Promise<readonly URI[]> {\n\t\tconst resources: URI[] = [];\n\t\tconst editsByNotebook = groupBy(this._edits, (a, b) => compare(a.resource.toString(), b.resource.toString()));\n\n\t\tfor (const group of editsByNotebook) {\n\t\t\tif (this._token.isCancellationRequested) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tconst [first] = group;\n\t\t\tconst ref = await this._notebookModelService.resolve(first.resource);\n\n\t\t\t// check state\n\t\t\tif (typeof first.notebookVersionId === 'number' && ref.object.notebook.versionId !== first.notebookVersionId) {\n\t\t\t\tref.dispose();\n\t\t\t\tthrow new Error(`Notebook '${first.resource}' has changed in the meantime`);\n\t\t\t}\n\n\t\t\t// apply edits\n\t\t\tconst edits = group.map(entry => entry.cellEdit);\n\t\t\tconst computeUndo = !ref.object.isReadonly();\n\t\t\tconst editor = getNotebookEditorFromEditorPane(this._editorService.activeEditorPane);\n\t\t\tconst initialSelectionState: ISelectionState | undefined = editor?.textModel?.uri.toString() === ref.object.notebook.uri.toString() ? {\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: editor.getFocus(),\n\t\t\t\tselections: editor.getSelections()\n\t\t\t} : undefined;\n\t\t\tref.object.notebook.applyEdits(edits, true, initialSelectionState, () => undefined, this._undoRedoGroup, computeUndo);\n\t\t\tref.dispose();\n\n\t\t\tthis._progress.report(undefined);\n\n\t\t\tresources.push(first.resource);\n\t\t}\n\n\t\treturn resources;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
