{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/issue/browser/issueFormService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { safeInnerHtml } from \"../../../../base/browser/dom.js\";\nimport { DisposableStore } from \"../../../../base/common/lifecycle.js\";\nimport Severity from \"../../../../base/common/severity.js\";\nimport \"./media/issueReporter.css\";\nimport { localize } from \"../../../../nls.js\";\nimport {\n\tIMenuService,\n\tMenuId,\n} from \"../../../../platform/actions/common/actions.js\";\nimport { IContextKeyService } from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { IDialogService } from \"../../../../platform/dialogs/common/dialogs.js\";\nimport {\n\tExtensionIdentifier,\n\tExtensionIdentifierSet,\n} from \"../../../../platform/extensions/common/extensions.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { ILogService } from \"../../../../platform/log/common/log.js\";\nimport product from \"../../../../platform/product/common/product.js\";\nimport type { IRectangle } from \"../../../../platform/window/common/window.js\";\nimport {\n\tAuxiliaryWindowMode,\n\tIAuxiliaryWindowService,\n} from \"../../../services/auxiliaryWindow/browser/auxiliaryWindowService.js\";\nimport { IHostService } from \"../../../services/host/browser/host.js\";\nimport type { IIssueFormService, IssueReporterData } from \"../common/issue.js\";\nimport BaseHtml from \"./issueReporterPage.js\";\nimport { IssueWebReporter } from \"./issueReporterService.js\";\n\nexport interface IssuePassData {\n\tissueTitle: string;\n\tissueBody: string;\n}\n\nexport class IssueFormService implements IIssueFormService {\n\treadonly _serviceBrand: undefined;\n\n\tprotected currentData: IssueReporterData | undefined;\n\n\tprotected issueReporterWindow: Window | null = null;\n\tprotected extensionIdentifierSet: ExtensionIdentifierSet =\n\t\tnew ExtensionIdentifierSet();\n\n\tprotected arch = \"\";\n\tprotected release = \"\";\n\tprotected type = \"\";\n\n\tconstructor(\n\t\t@IInstantiationService\n\t\tprotected readonly instantiationService: IInstantiationService,\n\t\t@IAuxiliaryWindowService\n\t\tprotected readonly auxiliaryWindowService: IAuxiliaryWindowService,\n\t\t@IMenuService protected readonly menuService: IMenuService,\n\t\t@IContextKeyService\n\t\tprotected readonly contextKeyService: IContextKeyService,\n\t\t@ILogService protected readonly logService: ILogService,\n\t\t@IDialogService protected readonly dialogService: IDialogService,\n\t\t@IHostService protected readonly hostService: IHostService,\n\t) {}\n\n\tasync openReporter(data: IssueReporterData): Promise<void> {\n\t\tif (this.hasToReload(data)) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.openAuxIssueReporter(data);\n\n\t\tif (this.issueReporterWindow) {\n\t\t\tconst issueReporter = this.instantiationService.createInstance(\n\t\t\t\tIssueWebReporter,\n\t\t\t\tfalse,\n\t\t\t\tdata,\n\t\t\t\t{ type: this.type, arch: this.arch, release: this.release },\n\t\t\t\tproduct,\n\t\t\t\tthis.issueReporterWindow,\n\t\t\t);\n\t\t\tissueReporter.render();\n\t\t}\n\t}\n\n\tasync openAuxIssueReporter(\n\t\tdata: IssueReporterData,\n\t\tbounds?: IRectangle,\n\t): Promise<void> {\n\t\tlet issueReporterBounds: Partial<IRectangle> = {\n\t\t\twidth: 700,\n\t\t\theight: 800,\n\t\t};\n\n\t\t// Center Issue Reporter Window based on bounds from native host service\n\t\tif (bounds && bounds.x && bounds.y) {\n\t\t\tconst centerX = bounds.x + bounds.width / 2;\n\t\t\tconst centerY = bounds.y + bounds.height / 2;\n\t\t\tissueReporterBounds = {\n\t\t\t\t...issueReporterBounds,\n\t\t\t\tx: centerX - 350,\n\t\t\t\ty: centerY - 400,\n\t\t\t};\n\t\t}\n\n\t\tconst disposables = new DisposableStore();\n\n\t\t// Auxiliary Window\n\t\tconst auxiliaryWindow = disposables.add(\n\t\t\tawait this.auxiliaryWindowService.open({\n\t\t\t\tmode: AuxiliaryWindowMode.Normal,\n\t\t\t\tbounds: issueReporterBounds,\n\t\t\t\tnativeTitlebar: true,\n\t\t\t\tdisableFullscreen: true,\n\t\t\t}),\n\t\t);\n\n\t\tif (auxiliaryWindow) {\n\t\t\tawait auxiliaryWindow.whenStylesHaveLoaded;\n\t\t\tauxiliaryWindow.window.document.title = \"Issue Reporter\";\n\t\t\tauxiliaryWindow.window.document.body.classList.add(\n\t\t\t\t\"issue-reporter-body\",\n\t\t\t);\n\n\t\t\t// custom issue reporter wrapper\n\t\t\tconst div = document.createElement(\"div\");\n\t\t\tdiv.classList.add(\"monaco-workbench\");\n\n\t\t\t// removes preset monaco-workbench\n\t\t\tauxiliaryWindow.container.remove();\n\t\t\tauxiliaryWindow.window.document.body.appendChild(div);\n\t\t\tsafeInnerHtml(div, BaseHtml());\n\n\t\t\tthis.issueReporterWindow = auxiliaryWindow.window;\n\t\t} else {\n\t\t\tconsole.error(\"Failed to open auxiliary window\");\n\t\t}\n\n\t\t// handle closing issue reporter\n\t\tthis.issueReporterWindow?.addEventListener(\"beforeunload\", () => {\n\t\t\tauxiliaryWindow.window.close();\n\t\t\tthis.issueReporterWindow = null;\n\t\t});\n\t}\n\n\tasync sendReporterMenu(\n\t\textensionId: string,\n\t): Promise<IssueReporterData | undefined> {\n\t\tconst menu = this.menuService.createMenu(\n\t\t\tMenuId.IssueReporter,\n\t\t\tthis.contextKeyService,\n\t\t);\n\n\t\t// render menu and dispose\n\t\tconst actions = menu\n\t\t\t.getActions({ renderShortTitle: true })\n\t\t\t.flatMap((entry) => entry[1]);\n\t\tfor (const action of actions) {\n\t\t\ttry {\n\t\t\t\tif (\n\t\t\t\t\taction.item &&\n\t\t\t\t\t\"source\" in action.item &&\n\t\t\t\t\taction.item.source?.id === extensionId\n\t\t\t\t) {\n\t\t\t\t\tthis.extensionIdentifierSet.add(extensionId);\n\t\t\t\t\tawait action.run();\n\t\t\t\t}\n\t\t\t} catch (error) {\n\t\t\t\tconsole.error(error);\n\t\t\t}\n\t\t}\n\n\t\tif (!this.extensionIdentifierSet.has(extensionId)) {\n\t\t\t// send undefined to indicate no action was taken\n\t\t\treturn undefined;\n\t\t}\n\n\t\t// we found the extension, now we clean up the menu and remove it from the set. This is to ensure that we do duplicate extension identifiers\n\t\tthis.extensionIdentifierSet.delete(\n\t\t\tnew ExtensionIdentifier(extensionId),\n\t\t);\n\t\tmenu.dispose();\n\n\t\tconst result = this.currentData;\n\n\t\t// reset current data.\n\t\tthis.currentData = undefined;\n\n\t\treturn result ?? undefined;\n\t}\n\n\t//#region used by issue reporter\n\n\tasync closeReporter(): Promise<void> {\n\t\tthis.issueReporterWindow?.close();\n\t}\n\n\tasync reloadWithExtensionsDisabled(): Promise<void> {\n\t\tif (this.issueReporterWindow) {\n\t\t\ttry {\n\t\t\t\tawait this.hostService.reload({ disableExtensions: true });\n\t\t\t} catch (error) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t}\n\n\tasync showConfirmCloseDialog(): Promise<void> {\n\t\tawait this.dialogService.prompt({\n\t\t\ttype: Severity.Warning,\n\t\t\tmessage: localize(\n\t\t\t\t\"confirmCloseIssueReporter\",\n\t\t\t\t\"Your input will not be saved. Are you sure you want to close this window?\",\n\t\t\t),\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\tlabel: localize(\n\t\t\t\t\t\t{ key: \"yes\", comment: [\"&& denotes a mnemonic\"] },\n\t\t\t\t\t\t\"&&Yes\",\n\t\t\t\t\t),\n\t\t\t\t\trun: () => {\n\t\t\t\t\t\tthis.closeReporter();\n\t\t\t\t\t\tthis.issueReporterWindow = null;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: localize(\"cancel\", \"Cancel\"),\n\t\t\t\t\trun: () => {},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tasync showClipboardDialog(): Promise<boolean> {\n\t\tlet result = false;\n\n\t\tawait this.dialogService.prompt({\n\t\t\ttype: Severity.Warning,\n\t\t\tmessage: localize(\n\t\t\t\t\"issueReporterWriteToClipboard\",\n\t\t\t\t\"There is too much data to send to GitHub directly. The data will be copied to the clipboard, please paste it into the GitHub issue page that is opened.\",\n\t\t\t),\n\t\t\tbuttons: [\n\t\t\t\t{\n\t\t\t\t\tlabel: localize(\n\t\t\t\t\t\t{ key: \"ok\", comment: [\"&& denotes a mnemonic\"] },\n\t\t\t\t\t\t\"&&OK\",\n\t\t\t\t\t),\n\t\t\t\t\trun: () => {\n\t\t\t\t\t\tresult = true;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tlabel: localize(\"cancel\", \"Cancel\"),\n\t\t\t\t\trun: () => {\n\t\t\t\t\t\tresult = false;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\n\t\treturn result;\n\t}\n\n\thasToReload(data: IssueReporterData): boolean {\n\t\tif (\n\t\t\tdata.extensionId &&\n\t\t\tthis.extensionIdentifierSet.has(data.extensionId)\n\t\t) {\n\t\t\tthis.currentData = data;\n\t\t\tthis.issueReporterWindow?.focus();\n\t\t\treturn true;\n\t\t}\n\n\t\tif (this.issueReporterWindow) {\n\t\t\tthis.issueReporterWindow.focus();\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAIA,SAAS,qBAAqB;AAC9B,SAAS,uBAAuB;AAChC,OAAO,cAAc;AACrB,OAAO;AACP,SAAS,gBAAgB;AACzB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,0BAA0B;AACnC,SAAS,sBAAsB;AAC/B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,6BAA6B;AACtC,SAAS,mBAAmB;AAC5B,OAAO,aAAa;AAEpB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,oBAAoB;AAE7B,OAAO,cAAc;AACrB,SAAS,wBAAwB;AAO1B,IAAM,mBAAN,MAAoD;AAAA,EAa1D,YAEoB,sBAEA,wBACc,aAEd,mBACa,YACG,eACF,aAChC;AATkB;AAEA;AACc;AAEd;AACa;AACG;AACF;AAAA,EAC/B;AAAA,EA7DJ,OAqC2D;AAAA;AAAA;AAAA,EACjD;AAAA,EAEC;AAAA,EAEA,sBAAqC;AAAA,EACrC,yBACT,IAAI,uBAAuB;AAAA,EAElB,OAAO;AAAA,EACP,UAAU;AAAA,EACV,OAAO;AAAA,EAejB,MAAM,aAAa,MAAwC;AAC1D,QAAI,KAAK,YAAY,IAAI,GAAG;AAC3B;AAAA,IACD;AAEA,UAAM,KAAK,qBAAqB,IAAI;AAEpC,QAAI,KAAK,qBAAqB;AAC7B,YAAM,gBAAgB,KAAK,qBAAqB;AAAA,QAC/C;AAAA,QACA;AAAA,QACA;AAAA,QACA,EAAE,MAAM,KAAK,MAAM,MAAM,KAAK,MAAM,SAAS,KAAK,QAAQ;AAAA,QAC1D;AAAA,QACA,KAAK;AAAA,MACN;AACA,oBAAc,OAAO;AAAA,IACtB;AAAA,EACD;AAAA,EAEA,MAAM,qBACL,MACA,QACgB;AAChB,QAAI,sBAA2C;AAAA,MAC9C,OAAO;AAAA,MACP,QAAQ;AAAA,IACT;AAGA,QAAI,UAAU,OAAO,KAAK,OAAO,GAAG;AACnC,YAAM,UAAU,OAAO,IAAI,OAAO,QAAQ;AAC1C,YAAM,UAAU,OAAO,IAAI,OAAO,SAAS;AAC3C,4BAAsB;AAAA,QACrB,GAAG;AAAA,QACH,GAAG,UAAU;AAAA,QACb,GAAG,UAAU;AAAA,MACd;AAAA,IACD;AAEA,UAAM,cAAc,IAAI,gBAAgB;AAGxC,UAAM,kBAAkB,YAAY;AAAA,MACnC,MAAM,KAAK,uBAAuB,KAAK;AAAA,QACtC,MAAM,oBAAoB;AAAA,QAC1B,QAAQ;AAAA,QACR,gBAAgB;AAAA,QAChB,mBAAmB;AAAA,MACpB,CAAC;AAAA,IACF;AAEA,QAAI,iBAAiB;AACpB,YAAM,gBAAgB;AACtB,sBAAgB,OAAO,SAAS,QAAQ;AACxC,sBAAgB,OAAO,SAAS,KAAK,UAAU;AAAA,QAC9C;AAAA,MACD;AAGA,YAAM,MAAM,SAAS,cAAc,KAAK;AACxC,UAAI,UAAU,IAAI,kBAAkB;AAGpC,sBAAgB,UAAU,OAAO;AACjC,sBAAgB,OAAO,SAAS,KAAK,YAAY,GAAG;AACpD,oBAAc,KAAK,SAAS,CAAC;AAE7B,WAAK,sBAAsB,gBAAgB;AAAA,IAC5C,OAAO;AACN,cAAQ,MAAM,iCAAiC;AAAA,IAChD;AAGA,SAAK,qBAAqB,iBAAiB,gBAAgB,MAAM;AAChE,sBAAgB,OAAO,MAAM;AAC7B,WAAK,sBAAsB;AAAA,IAC5B,CAAC;AAAA,EACF;AAAA,EAEA,MAAM,iBACL,aACyC;AACzC,UAAM,OAAO,KAAK,YAAY;AAAA,MAC7B,OAAO;AAAA,MACP,KAAK;AAAA,IACN;AAGA,UAAM,UAAU,KACd,WAAW,EAAE,kBAAkB,KAAK,CAAC,EACrC,QAAQ,CAAC,UAAU,MAAM,CAAC,CAAC;AAC7B,eAAW,UAAU,SAAS;AAC7B,UAAI;AACH,YACC,OAAO,QACP,YAAY,OAAO,QACnB,OAAO,KAAK,QAAQ,OAAO,aAC1B;AACD,eAAK,uBAAuB,IAAI,WAAW;AAC3C,gBAAM,OAAO,IAAI;AAAA,QAClB;AAAA,MACD,SAAS,OAAO;AACf,gBAAQ,MAAM,KAAK;AAAA,MACpB;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,uBAAuB,IAAI,WAAW,GAAG;AAElD,aAAO;AAAA,IACR;AAGA,SAAK,uBAAuB;AAAA,MAC3B,IAAI,oBAAoB,WAAW;AAAA,IACpC;AACA,SAAK,QAAQ;AAEb,UAAM,SAAS,KAAK;AAGpB,SAAK,cAAc;AAEnB,WAAO,UAAU;AAAA,EAClB;AAAA;AAAA,EAIA,MAAM,gBAA+B;AACpC,SAAK,qBAAqB,MAAM;AAAA,EACjC;AAAA,EAEA,MAAM,+BAA8C;AACnD,QAAI,KAAK,qBAAqB;AAC7B,UAAI;AACH,cAAM,KAAK,YAAY,OAAO,EAAE,mBAAmB,KAAK,CAAC;AAAA,MAC1D,SAAS,OAAO;AACf,aAAK,WAAW,MAAM,KAAK;AAAA,MAC5B;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,yBAAwC;AAC7C,UAAM,KAAK,cAAc,OAAO;AAAA,MAC/B,MAAM,SAAS;AAAA,MACf,SAAS;AAAA,QACR;AAAA,QACA;AAAA,MACD;AAAA,MACA,SAAS;AAAA,QACR;AAAA,UACC,OAAO;AAAA,YACN,EAAE,KAAK,OAAO,SAAS,CAAC,uBAAuB,EAAE;AAAA,YACjD;AAAA,UACD;AAAA,UACA,KAAK,6BAAM;AACV,iBAAK,cAAc;AACnB,iBAAK,sBAAsB;AAAA,UAC5B,GAHK;AAAA,QAIN;AAAA,QACA;AAAA,UACC,OAAO,SAAS,UAAU,QAAQ;AAAA,UAClC,KAAK,6BAAM;AAAA,UAAC,GAAP;AAAA,QACN;AAAA,MACD;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEA,MAAM,sBAAwC;AAC7C,QAAI,SAAS;AAEb,UAAM,KAAK,cAAc,OAAO;AAAA,MAC/B,MAAM,SAAS;AAAA,MACf,SAAS;AAAA,QACR;AAAA,QACA;AAAA,MACD;AAAA,MACA,SAAS;AAAA,QACR;AAAA,UACC,OAAO;AAAA,YACN,EAAE,KAAK,MAAM,SAAS,CAAC,uBAAuB,EAAE;AAAA,YAChD;AAAA,UACD;AAAA,UACA,KAAK,6BAAM;AACV,qBAAS;AAAA,UACV,GAFK;AAAA,QAGN;AAAA,QACA;AAAA,UACC,OAAO,SAAS,UAAU,QAAQ;AAAA,UAClC,KAAK,6BAAM;AACV,qBAAS;AAAA,UACV,GAFK;AAAA,QAGN;AAAA,MACD;AAAA,IACD,CAAC;AAED,WAAO;AAAA,EACR;AAAA,EAEA,YAAY,MAAkC;AAC7C,QACC,KAAK,eACL,KAAK,uBAAuB,IAAI,KAAK,WAAW,GAC/C;AACD,WAAK,cAAc;AACnB,WAAK,qBAAqB,MAAM;AAChC,aAAO;AAAA,IACR;AAEA,QAAI,KAAK,qBAAqB;AAC7B,WAAK,oBAAoB,MAAM;AAC/B,aAAO;AAAA,IACR;AAEA,WAAO;AAAA,EACR;AACD;AAlPa,mBAAN;AAAA,EAcJ;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,GAvBU;",
  "names": []
}
