var m=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var u=(d,e,r,i)=>{for(var o=i>1?void 0:i?h(e,r):e,t=d.length-1,s;t>=0;t--)(s=d[t])&&(o=(i?s(e,r,o):s(o))||o);return i&&o&&m(e,r,o),o},n=(d,e)=>(r,i)=>e(r,i,d);import{safeInnerHtml as f}from"../../../../base/browser/dom.js";import{DisposableStore as w}from"../../../../base/common/lifecycle.js";import p from"../../../../base/common/severity.js";import"./media/issueReporter.css";import{localize as a}from"../../../../nls.js";import{IMenuService as y,MenuId as I}from"../../../../platform/actions/common/actions.js";import{IContextKeyService as v}from"../../../../platform/contextkey/common/contextkey.js";import{IDialogService as S}from"../../../../platform/dialogs/common/dialogs.js";import{ExtensionIdentifier as R,ExtensionIdentifierSet as g}from"../../../../platform/extensions/common/extensions.js";import{IInstantiationService as x}from"../../../../platform/instantiation/common/instantiation.js";import{ILogService as W}from"../../../../platform/log/common/log.js";import b from"../../../../platform/product/common/product.js";import"../../../../platform/window/common/window.js";import D from"./issueReporterPage.js";import{IssueWebReporter as C}from"./issueReporterService.js";import"../common/issue.js";import{AuxiliaryWindowMode as P,IAuxiliaryWindowService as T}from"../../../services/auxiliaryWindow/browser/auxiliaryWindowService.js";import{IHostService as A}from"../../../services/host/browser/host.js";let c=class{constructor(e,r,i,o,t,s,l){this.instantiationService=e;this.auxiliaryWindowService=r;this.menuService=i;this.contextKeyService=o;this.logService=t;this.dialogService=s;this.hostService=l}_serviceBrand;currentData;issueReporterWindow=null;extensionIdentifierSet=new g;arch="";release="";type="";async openReporter(e){this.hasToReload(e)||(await this.openAuxIssueReporter(e),this.issueReporterWindow&&this.instantiationService.createInstance(C,!1,e,{type:this.type,arch:this.arch,release:this.release},b,this.issueReporterWindow).render())}async openAuxIssueReporter(e,r){let i={width:700,height:800};if(r&&r.x&&r.y){const s=r.x+r.width/2,l=r.y+r.height/2;i={...i,x:s-350,y:l-400}}const t=new w().add(await this.auxiliaryWindowService.open({mode:P.Normal,bounds:i,nativeTitlebar:!0,disableFullscreen:!0}));if(t){await t.whenStylesHaveLoaded,t.window.document.title="Issue Reporter",t.window.document.body.classList.add("issue-reporter-body");const s=document.createElement("div");s.classList.add("monaco-workbench"),t.container.remove(),t.window.document.body.appendChild(s),f(s,D()),this.issueReporterWindow=t.window}this.issueReporterWindow?.addEventListener("beforeunload",()=>{t.window.close(),this.issueReporterWindow=null})}async sendReporterMenu(e){const r=this.menuService.createMenu(I.IssueReporter,this.contextKeyService),i=r.getActions({renderShortTitle:!0}).flatMap(t=>t[1]);for(const t of i)try{t.item&&"source"in t.item&&t.item.source?.id===e&&(this.extensionIdentifierSet.add(e),await t.run())}catch{}if(!this.extensionIdentifierSet.has(e))return;this.extensionIdentifierSet.delete(new R(e)),r.dispose();const o=this.currentData;return this.currentData=void 0,o??void 0}async closeReporter(){this.issueReporterWindow?.close()}async reloadWithExtensionsDisabled(){if(this.issueReporterWindow)try{await this.hostService.reload({disableExtensions:!0})}catch(e){this.logService.error(e)}}async showConfirmCloseDialog(){await this.dialogService.prompt({type:p.Warning,message:a("confirmCloseIssueReporter","Your input will not be saved. Are you sure you want to close this window?"),buttons:[{label:a({key:"yes",comment:["&& denotes a mnemonic"]},"&&Yes"),run:()=>{this.closeReporter(),this.issueReporterWindow=null}},{label:a("cancel","Cancel"),run:()=>{}}]})}async showClipboardDialog(){let e=!1;return await this.dialogService.prompt({type:p.Warning,message:a("issueReporterWriteToClipboard","There is too much data to send to GitHub directly. The data will be copied to the clipboard, please paste it into the GitHub issue page that is opened."),buttons:[{label:a({key:"ok",comment:["&& denotes a mnemonic"]},"&&OK"),run:()=>{e=!0}},{label:a("cancel","Cancel"),run:()=>{e=!1}}]}),e}hasToReload(e){return e.extensionId&&this.extensionIdentifierSet.has(e.extensionId)?(this.currentData=e,this.issueReporterWindow?.focus(),!0):this.issueReporterWindow?(this.issueReporterWindow.focus(),!0):!1}};c=u([n(0,x),n(1,T),n(2,y),n(3,v),n(4,W),n(5,S),n(6,A)],c);export{c as IssueFormService};
