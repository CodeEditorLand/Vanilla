var N=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var E=(e,t,o,a)=>{for(var u=a>1?void 0:a?V(t,o):t,v=e.length-1,g;v>=0;v--)(g=e[v])&&(u=(a?g(t,o,u):g(u))||u);return a&&u&&N(t,o,u),u},s=(e,t)=>(o,a)=>t(o,a,e);import{getZoomLevel as h}from"../../../../base/browser/browser.js";import{mainWindow as R}from"../../../../base/browser/window.js";import{ipcRenderer as f}from"../../../../base/parts/sandbox/electron-sandbox/globals.js";import{IMenuService as _,MenuId as z}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as G}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as q}from"../../../../platform/contextkey/common/contextkey.js";import{IExtensionManagementService as Z}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{ExtensionIdentifier as B,ExtensionIdentifierSet as J,ExtensionType as D}from"../../../../platform/extensions/common/extensions.js";import{InstantiationType as Q,registerSingleton as X}from"../../../../platform/instantiation/common/extensions.js";import{IIssueMainService as Y}from"../../../../platform/issue/common/issue.js";import{buttonBackground as C,buttonForeground as M,buttonHoverBackground as T,foreground as w,inputActiveOptionBorder as A,inputBackground as F,inputBorder as W,inputForeground as U,inputValidationErrorBackground as L,inputValidationErrorBorder as O,inputValidationErrorForeground as K,scrollbarSliderActiveBackground as j,scrollbarSliderBackground as ee,scrollbarSliderHoverBackground as H,textLinkActiveForeground as P,textLinkForeground as $}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as re}from"../../../../platform/theme/common/themeService.js";import{IWorkspaceTrustManagementService as ne}from"../../../../platform/workspace/common/workspaceTrust.js";import{SIDE_BAR_BACKGROUND as b}from"../../../common/theme.js";import{IWorkbenchAssignmentService as te}from"../../../services/assignment/common/assignmentService.js";import{IAuthenticationService as oe}from"../../../services/authentication/common/authentication.js";import{IWorkbenchExtensionEnablementService as ie}from"../../../services/extensionManagement/common/extensionManagement.js";import{IIntegrityService as se}from"../../../services/integrity/common/integrity.js";import{IIssueFormService as ae,IWorkbenchIssueService as ue}from"../common/issue.js";let I=class{constructor(t,o,a,u,v,g,S,y,p,k,l,m){this.issueMainService=t;this.issueFormService=o;this.themeService=a;this.extensionManagementService=u;this.extensionEnablementService=v;this.workspaceTrustManagementService=g;this.experimentService=S;this.authenticationService=y;this.integrityService=p;this.menuService=k;this.contextKeyService=l;this.configurationService=m;f.on("vscode:triggerReporterMenu",async(i,n)=>{const c=n.extensionId;this.menuService.getMenuActions(z.IssueReporter,this.contextKeyService,{renderShortTitle:!0}).flatMap(d=>d[1]).forEach(async d=>{try{d.item&&"source"in d.item&&d.item.source?.id===c&&(this.extensionIdentifierSet.add(c),await d.run())}catch{}}),this.extensionIdentifierSet.has(c)||f.send(`vscode:triggerReporterMenuResponse:${c}`,void 0)})}extensionIdentifierSet=new J;async openReporter(t={}){const o=[],a=[],u=t;try{const m=(await this.extensionManagementService.getInstalled()).filter(i=>this.extensionEnablementService.isEnabled(i)||t.extensionId&&i.identifier.id===t.extensionId);o.push(...m.map(i=>{const{manifest:n}=i,c=n.contributes?Object.keys(n.contributes):[],x=!n.main&&!n.browser&&c.length===1&&c[0]==="themes",d=i.type===D.System;return{name:n.name,publisher:n.publisher,version:n.version,repositoryUrl:n.repository&&n.repository.url,bugsUrl:n.bugs&&n.bugs.url,displayName:n.displayName,id:i.identifier.id,data:t.data,uri:t.uri,isTheme:x,isBuiltin:d,extensionData:"Extensions data loading"}})),a.push(...m.map(i=>{const{manifest:n}=i,c=n.contributes?Object.keys(n.contributes):[],x=!n.main&&!n.browser&&c.length===1&&c[0]==="themes",d=i.type===D.System;return{name:n.name,publisher:n.publisher,version:n.version,repositoryUrl:n.repository&&n.repository.url,bugsUrl:n.bugs&&n.bugs.url,displayName:n.displayName,id:i.identifier.id,data:t.data,uri:t.uri,isTheme:x,isBuiltin:d,extensionData:"Extensions data loading"}}))}catch(l){o.push({name:"Workbench Issue Service",publisher:"Unknown",version:"0.0.0",repositoryUrl:void 0,bugsUrl:void 0,extensionData:"Extensions data loading",displayName:`Extensions not loaded: ${l}`,id:"workbench.issue",isTheme:!1,isBuiltin:!0}),a.push({name:"Workbench Issue Service",publisher:"Unknown",version:"0.0.0",repositoryUrl:void 0,bugsUrl:void 0,extensionData:"Extensions data loading",displayName:`Extensions not loaded: ${l}`,id:"workbench.issue",isTheme:!1,isBuiltin:!0})}const v=await this.experimentService.getCurrentExperiments();let g="";try{g=(await this.authenticationService.getSessions("github")).filter(i=>i.scopes.includes("repo"))[0]?.accessToken}catch{}let S=!1;try{S=!(await this.integrityService.isPure()).isPure}catch{}const y=this.themeService.getColorTheme(),p=Object.assign({styles:ce(y),zoomLevel:h(R),enabledExtensions:o,experiments:v?.join(`
`),restrictedMode:!this.workspaceTrustManagementService.isWorkspaceTrusted(),isUnsupported:S,githubAccessToken:g},t),k=Object.assign({styles:de(y),zoomLevel:h(R),enabledExtensions:a,experiments:v?.join(`
`),restrictedMode:!this.workspaceTrustManagementService.isWorkspaceTrusted(),isUnsupported:S,githubAccessToken:g},u);if(p.extensionId){const l=o.some(m=>B.equals(m.id,p.extensionId))}return p.extensionId&&this.extensionIdentifierSet.has(p.extensionId)&&(f.send(`vscode:triggerReporterMenuResponse:${p.extensionId}`,p),this.extensionIdentifierSet.delete(new B(p.extensionId))),this.configurationService.getValue("issueReporter.experimental.auxWindow")?this.issueFormService.openReporter(p):this.issueMainService.openReporter(k)}};I=E([s(0,Y),s(1,ae),s(2,re),s(3,Z),s(4,ie),s(5,ne),s(6,te),s(7,oe),s(8,se),s(9,_),s(10,q),s(11,G)],I);function ce(e){return{backgroundColor:r(e,b),color:r(e,w),textLinkColor:r(e,$),textLinkActiveForeground:r(e,P),inputBackground:r(e,F),inputForeground:r(e,U),inputBorder:r(e,W),inputActiveBorder:r(e,A),inputErrorBorder:r(e,O),inputErrorBackground:r(e,L),inputErrorForeground:r(e,K),buttonBackground:r(e,C),buttonForeground:r(e,M),buttonHoverBackground:r(e,T),sliderActiveColor:r(e,j),sliderBackgroundColor:r(e,b),sliderHoverColor:r(e,H)}}function de(e){return{backgroundColor:r(e,b),color:r(e,w),textLinkColor:r(e,$),textLinkActiveForeground:r(e,P),inputBackground:r(e,F),inputForeground:r(e,U),inputBorder:r(e,W),inputActiveBorder:r(e,A),inputErrorBorder:r(e,O),inputErrorBackground:r(e,L),inputErrorForeground:r(e,K),buttonBackground:r(e,C),buttonForeground:r(e,M),buttonHoverBackground:r(e,T),sliderActiveColor:r(e,j),sliderBackgroundColor:r(e,ee),sliderHoverColor:r(e,H)}}function r(e,t){const o=e.getColor(t);return o?o.toString():void 0}X(ue,I,Q.Delayed);export{I as NativeIssueService,ce as getIssueReporterStyles,de as oldGetIssueReporterStyles};
