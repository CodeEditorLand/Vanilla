var I=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var a=(s,r,i,t)=>{for(var e=t>1?void 0:t?v(r,i):r,n=s.length-1,d;n>=0;n--)(d=s[n])&&(e=(t?d(r,i,e):d(e))||e);return t&&e&&I(r,i,e),e},o=(s,r)=>(i,t)=>r(i,t,s);import"../../../../base/browser/dom.js";import"../../../../base/common/cancellation.js";import{MultiDiffEditorWidget as E}from"../../../../editor/browser/widget/multiDiffEditor/multiDiffEditorWidget.js";import"../../../../editor/browser/widget/multiDiffEditor/workbenchUIElementFactory.js";import{ITextResourceConfigurationService as D}from"../../../../editor/common/services/textResourceConfiguration.js";import{IInstantiationService as m}from"../../../../platform/instantiation/common/instantiation.js";import"../../../../platform/instantiation/common/instantiationService.js";import{IStorageService as h}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as g}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as S}from"../../../../platform/theme/common/themeService.js";import{ResourceLabel as w}from"../../../browser/labels.js";import{AbstractEditorWithViewState as M}from"../../../browser/parts/editor/editorWithViewState.js";import"../../../common/composite.js";import"../../../common/editor.js";import"../../../common/editor/editorInput.js";import{MultiDiffEditorInput as _}from"./multiDiffEditorInput.js";import{IEditorGroupsService as C}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as W}from"../../../services/editor/common/editorService.js";import"../../../../base/common/uri.js";import"../../../../editor/browser/widget/multiDiffEditor/multiDiffEditorViewModel.js";import"../../../../editor/browser/widget/multiDiffEditor/multiDiffEditorWidgetImpl.js";import"../../../../editor/browser/editorBrowser.js";import"../../../../editor/common/editorCommon.js";import{Range as V}from"../../../../editor/common/core/range.js";import"./multiDiffSourceResolverService.js";import{IEditorProgressService as y}from"../../../../platform/progress/common/progress.js";let f=class extends M{constructor(i,t,e,n,d,l,c,p,R){super(f.ID,i,"multiDiffEditor",e,t,d,p,n,l,c);this.editorProgressService=R}static ID="multiDiffEditor";_multiDiffEditorWidget=void 0;_viewModel;get viewModel(){return this._viewModel}createEditor(i){this._multiDiffEditorWidget=this._register(this.instantiationService.createInstance(E,i,this.instantiationService.createInstance(u))),this._register(this._multiDiffEditorWidget.onDidChangeActiveControl(()=>{this._onDidChangeControl.fire()}))}async setInput(i,t,e,n){await super.setInput(i,t,e,n),this._viewModel=await i.getViewModel(),this._multiDiffEditorWidget.setViewModel(this._viewModel);const d=this.loadEditorViewState(i,e);d&&this._multiDiffEditorWidget.setViewState(d),this._applyOptions(t)}setOptions(i){this._applyOptions(i)}_applyOptions(i){const t=i?.viewState;!t||!t.revealData||this._multiDiffEditorWidget?.reveal(t.revealData.resource,{range:t.revealData.range?V.lift(t.revealData.range):void 0,highlight:!0})}async clearInput(){await super.clearInput(),this._multiDiffEditorWidget.setViewModel(void 0)}layout(i){this._multiDiffEditorWidget.layout(i)}getControl(){return this._multiDiffEditorWidget.getActiveControl()}focus(){super.focus(),this._multiDiffEditorWidget?.getActiveControl()?.focus()}hasFocus(){return this._multiDiffEditorWidget?.getActiveControl()?.hasTextFocus()||super.hasFocus()}computeEditorViewState(i){return this._multiDiffEditorWidget.getViewState()}tracksEditorViewState(i){return i instanceof _}toEditorViewStateResource(i){return i.resource}tryGetCodeEditor(i){return this._multiDiffEditorWidget.tryGetCodeEditor(i)}findDocumentDiffItem(i){const t=this._multiDiffEditorWidget.findDocumentDiffItem(i);return t?t.multiDiffEditorItem:void 0}async showWhile(i){return this.editorProgressService.showWhile(i)}};f=a([o(1,m),o(2,g),o(3,S),o(4,h),o(5,W),o(6,C),o(7,D),o(8,y)],f);let u=class{constructor(r){this._instantiationService=r}createResourceLabel(r){const i=this._instantiationService.createInstance(w,r,{});return{setUri(t,e={}){t?i.element.setFile(t,{strikethrough:e.strikethrough}):i.element.clear()},dispose(){i.dispose()}}}};u=a([o(0,m)],u);export{f as MultiDiffEditor};
