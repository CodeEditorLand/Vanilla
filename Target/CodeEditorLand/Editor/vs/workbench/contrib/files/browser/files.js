import{isActiveElement as I}from"../../../../../vs/base/browser/dom.js";import{List as g}from"../../../../../vs/base/browser/ui/list/listWidget.js";import{AsyncDataTree as S}from"../../../../../vs/base/browser/ui/tree/asyncDataTree.js";import{coalesce as b}from"../../../../../vs/base/common/arrays.js";import{URI as x}from"../../../../../vs/base/common/uri.js";import"../../../../../vs/editor/browser/services/bulkEditService.js";import{createDecorator as h}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IListService as C}from"../../../../../vs/platform/list/browser/listService.js";import"../../../../../vs/platform/progress/common/progress.js";import{EditorResourceAccessor as R,SideBySideEditor as F}from"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/common/views.js";import{ExplorerItem as L}from"../../../../../vs/workbench/contrib/files/common/explorerModel.js";import{OpenEditor as f}from"../../../../../vs/workbench/contrib/files/common/files.js";import"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import"../../../../../vs/workbench/services/editor/common/editorService.js";const Z=h("explorerService");function P(r){const e=r.lastFocusedList,s=e?.getHTMLElement();if(s&&I(s)){let o;if(e instanceof g){const i=e.getFocusedElements();i.length&&(o=i[0])}else if(e instanceof S){const i=e.getFocus();i.length&&(o=i[0])}return o}}function U(r,e,s){if(x.isUri(r))return r;const o=P(s);return o instanceof L?o.resource:o instanceof f?o.getResource():R.getOriginalUri(e.activeEditor,{supportSideBySide:F.PRIMARY})}function $(r,e,s,o,i){const c=e.lastFocusedList,d=c?.getHTMLElement();if(d&&I(d)){if(c instanceof S&&c.getFocus().every(t=>t instanceof L)){const t=i.getContext(!0,!0);if(t.length)return t.map(l=>l.resource)}if(c instanceof g){const t=b(c.getSelectedElements().filter(n=>n instanceof f).map(n=>n.getResource())),l=c.getFocusedElements(),a=l.length?l[0]:void 0;let p;if(x.isUri(r))p=r.toString();else if(a instanceof f){const n=a.getResource();p=n?n.toString():void 0}const E=t.findIndex(n=>n.toString()===p);if(E!==-1){const n=t[E];return t.splice(E,1),t.unshift(n),t}}}const u=o.activeGroup.selectedEditors;if(u.length>1&&x.isUri(r)){const t=u.findIndex(l=>l.matches({resource:r}));if(t!==-1){const l=u[t];return u.splice(t,1),u.unshift(l),u.map(a=>R.getOriginalUri(a)).filter(a=>!!a)}}const v=U(r,s,e);return v?[v]:[]}function ee(r){const e=r.get(C).lastFocusedList,s=e?.getHTMLElement();if(s&&I(s)&&e instanceof g){const o=b(e.getSelectedElements().filter(m=>m instanceof f)),i=e.getFocusedElements(),c=i.length?i[0]:void 0;let d;return c instanceof f&&(d=c),o.some(m=>m===d)?o:d?[d]:void 0}}export{Z as IExplorerService,$ as getMultiSelectedResources,ee as getOpenEditorsViewMultiSelection,U as getResourceForCommand};
