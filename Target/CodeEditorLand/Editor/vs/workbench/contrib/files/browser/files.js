import{isActiveElement as I}from"../../../../base/browser/dom.js";import{List as g}from"../../../../base/browser/ui/list/listWidget.js";import{AsyncDataTree as S}from"../../../../base/browser/ui/tree/asyncDataTree.js";import{coalesce as b}from"../../../../base/common/arrays.js";import{URI as v}from"../../../../base/common/uri.js";import{createDecorator as L}from"../../../../platform/instantiation/common/instantiation.js";import{IListService as h}from"../../../../platform/list/browser/listService.js";import{EditorResourceAccessor as R,SideBySideEditor as C}from"../../../common/editor.js";import{ExplorerItem as y}from"../common/explorerModel.js";import{OpenEditor as f}from"../common/files.js";const B=L("explorerService");function F(r){const e=r.lastFocusedList,s=e?.getHTMLElement();if(s&&I(s)){let o;if(e instanceof g){const i=e.getFocusedElements();i.length&&(o=i[0])}else if(e instanceof S){const i=e.getFocus();i.length&&(o=i[0])}return o}}function P(r,e,s){if(v.isUri(r))return r;const o=F(s);return o instanceof y?o.resource:o instanceof f?o.getResource():R.getOriginalUri(e.activeEditor,{supportSideBySide:C.PRIMARY})}function A(r,e,s,o,i){const c=e.lastFocusedList,d=c?.getHTMLElement();if(d&&I(d)){if(c instanceof S&&c.getFocus().every(t=>t instanceof y)){const t=i.getContext(!0,!0);if(t.length)return t.map(l=>l.resource)}if(c instanceof g){const t=b(c.getSelectedElements().filter(n=>n instanceof f).map(n=>n.getResource())),l=c.getFocusedElements(),a=l.length?l[0]:void 0;let p;if(v.isUri(r))p=r.toString();else if(a instanceof f){const n=a.getResource();p=n?n.toString():void 0}const E=t.findIndex(n=>n.toString()===p);if(E!==-1){const n=t[E];return t.splice(E,1),t.unshift(n),t}}}const u=o.activeGroup.selectedEditors;if(u.length>1&&v.isUri(r)){const t=u.findIndex(l=>l.matches({resource:r}));if(t!==-1){const l=u[t];return u.splice(t,1),u.unshift(l),u.map(a=>R.getOriginalUri(a)).filter(a=>!!a)}}const x=P(r,s,e);return x?[x]:[]}function H(r){const e=r.get(h).lastFocusedList,s=e?.getHTMLElement();if(s&&I(s)&&e instanceof g){const o=b(e.getSelectedElements().filter(m=>m instanceof f)),i=e.getFocusedElements(),c=i.length?i[0]:void 0;let d;return c instanceof f&&(d=c),o.some(m=>m===d)?o:d?[d]:void 0}}export{B as IExplorerService,A as getMultiSelectedResources,H as getOpenEditorsViewMultiSelection,P as getResourceForCommand};
