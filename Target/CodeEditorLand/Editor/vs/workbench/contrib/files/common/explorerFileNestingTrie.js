var l=class{root=new g;constructor(t){for(let[e,s]of t)for(let i of s)this.root.add(e,i)}toString(){return this.root.toString()}getAttributes(t,e){let s=t.lastIndexOf(".");return s<1?{dirname:e,basename:t,extname:""}:{dirname:e,basename:t.substring(0,s),extname:t.substring(s+1)}}nest(t,e){let s=new g;for(let n of t){let a=this.getAttributes(n,e),u=this.root.get(n,a);for(let o of u)s.add(o,n)}let i=(n,a=new Set)=>{if(a.has(n))return[];a.add(n);let u=this.getAttributes(n,e),o=s.get(n,u);return o.length===0?[n]:o.length===1&&o[0]===n?[n]:o.flatMap(d=>i(d,a))},r=new Map;for(let n of t){let a=i(n);a.length===0&&(a=[n]);for(let u of a){let o=r.get(u);o||r.set(u,o=new Set),n!==u&&o.add(n)}}return r}},g=class c{value=new p;map=new Map;constructor(){}add(t,e){if(t==="")this.value.add(t,e);else if(t[0]==="*")this.value.add(t,e);else{let s=t[0],i=t.slice(1),r=this.map.get(s);r||this.map.set(s,r=new c),r.add(i,e)}}get(t,e){let s=[];s.push(...this.value.get(t,e));let i=t[0],r=t.slice(1),n=this.map.get(i);return n&&s.push(...n.get(r,e)),s}toString(t=""){let e=[];return this.value.hasItems&&e.push(`* => 
`+this.value.toString(t+"  ")),[...this.map.entries()].map(([s,i])=>e.push("^"+s+` => 
`+i.toString(t+"  "))),e.map(s=>t+s).join(`
`)}},p=class c{star=[];epsilon=[];map=new Map;hasItems=!1;constructor(){}add(t,e){if(this.hasItems=!0,t==="*")this.star.push(new h(e));else if(t==="")this.epsilon.push(new h(e));else{let s=t[t.length-1],i=t.slice(0,t.length-1);if(s==="*")throw Error("Unexpected star in SufTrie key: "+t);{let r=this.map.get(s);r||this.map.set(s,r=new c),r.add(i,e)}}}get(t,e){let s=[];t===""&&s.push(...this.epsilon.map(a=>a.substitute(e))),this.star.length&&s.push(...this.star.map(a=>a.substitute(e,t)));let i=t[t.length-1],r=t.slice(0,t.length-1),n=this.map.get(i);return n&&s.push(...n.get(r,e)),s}toString(t=""){let e=[];return this.star.length&&e.push("* => "+this.star.join("; ")),this.epsilon.length&&e.push("\u03B5 => "+this.epsilon.join("; ")),[...this.map.entries()].map(([s,i])=>e.push(s+`$ => 
`+i.toString(t+"  "))),e.map(s=>t+s).join(`
`)}};var m=/\$[({](capture|basename|dirname|extname)[)}]/g,h=class{tokens=[];constructor(t){m.lastIndex=0;let e,s=0;for(;e=m.exec(t);){let i=t.slice(s,e.index);this.tokens.push(i);let r=e[1];switch(r){case"basename":case"dirname":case"extname":case"capture":this.tokens.push({capture:r});break;default:throw Error("unknown substitution type: "+r)}s=e.index+e[0].length}if(s!==t.length){let i=t.slice(s,t.length);this.tokens.push(i)}}substitute(t,e){return this.tokens.map(s=>{if(typeof s=="string")return s;switch(s.capture){case"basename":return t.basename;case"dirname":return t.dirname;case"extname":return t.extname;case"capture":return e||""}}).join("")}};export{l as ExplorerFileNestingTrie,g as PreTrie,p as SufTrie};
