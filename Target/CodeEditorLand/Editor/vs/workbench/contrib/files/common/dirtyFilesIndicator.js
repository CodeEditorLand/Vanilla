var p=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var c=(o,r,i,e)=>{for(var t=e>1?void 0:e?d(r,i):r,s=o.length-1,v;s>=0;s--)(v=o[s])&&(t=(e?v(r,i,t):v(t))||t);return e&&t&&p(r,i,t),t},n=(o,r)=>(i,e)=>r(i,e,o);import{Disposable as y,MutableDisposable as g}from"../../../../../vs/base/common/lifecycle.js";import*as l from"../../../../../vs/nls.js";import"../../../../../vs/workbench/common/contributions.js";import{VIEWLET_ID as u}from"../../../../../vs/workbench/contrib/files/common/files.js";import{IActivityService as C,NumberBadge as h}from"../../../../../vs/workbench/services/activity/common/activity.js";import{IFilesConfigurationService as f}from"../../../../../vs/workbench/services/filesConfiguration/common/filesConfigurationService.js";import{WorkingCopyCapabilities as m}from"../../../../../vs/workbench/services/workingCopy/common/workingCopy.js";import{IWorkingCopyService as b}from"../../../../../vs/workbench/services/workingCopy/common/workingCopyService.js";let a=class extends y{constructor(i,e,t){super();this.activityService=i;this.workingCopyService=e;this.filesConfigurationService=t;this.updateActivityBadge(),this.registerListeners()}static ID="workbench.contrib.dirtyFilesIndicator";badgeHandle=this._register(new g);lastKnownDirtyCount=0;registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(i=>this.onWorkingCopyDidChangeDirty(i)))}onWorkingCopyDidChangeDirty(i){const e=i.isDirty();e&&!(i.capabilities&m.Untitled)&&this.filesConfigurationService.hasShortAutoSaveDelay(i.resource)||(e||this.lastKnownDirtyCount>0)&&this.updateActivityBadge()}updateActivityBadge(){const i=this.lastKnownDirtyCount=this.workingCopyService.dirtyCount;i>0?this.badgeHandle.value=this.activityService.showViewContainerActivity(u,{badge:new h(i,e=>e===1?l.localize("dirtyFile","1 unsaved file"):l.localize("dirtyFiles","{0} unsaved files",i))}):this.badgeHandle.clear()}};a=c([n(0,C),n(1,b),n(2,f)],a);export{a as DirtyFilesIndicator};
