var l=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var p=(o,r,i,e)=>{for(var t=e>1?void 0:e?y(r,i):r,s=o.length-1,c;s>=0;s--)(c=o[s])&&(t=(e?c(r,i,t):c(t))||t);return e&&t&&l(r,i,t),t},n=(o,r)=>(i,e)=>r(i,e,o);import{Disposable as d,MutableDisposable as g}from"../../../../base/common/lifecycle.js";import*as v from"../../../../nls.js";import{IActivityService as u,NumberBadge as C}from"../../../services/activity/common/activity.js";import{IFilesConfigurationService as h}from"../../../services/filesConfiguration/common/filesConfigurationService.js";import{WorkingCopyCapabilities as m}from"../../../services/workingCopy/common/workingCopy.js";import{IWorkingCopyService as f}from"../../../services/workingCopy/common/workingCopyService.js";import{VIEWLET_ID as b}from"./files.js";let a=class extends d{constructor(i,e,t){super();this.activityService=i;this.workingCopyService=e;this.filesConfigurationService=t;this.updateActivityBadge(),this.registerListeners()}static ID="workbench.contrib.dirtyFilesIndicator";badgeHandle=this._register(new g);lastKnownDirtyCount=0;registerListeners(){this._register(this.workingCopyService.onDidChangeDirty(i=>this.onWorkingCopyDidChangeDirty(i)))}onWorkingCopyDidChangeDirty(i){const e=i.isDirty();e&&!(i.capabilities&m.Untitled)&&this.filesConfigurationService.hasShortAutoSaveDelay(i.resource)||(e||this.lastKnownDirtyCount>0)&&this.updateActivityBadge()}updateActivityBadge(){const i=this.lastKnownDirtyCount=this.workingCopyService.dirtyCount;i>0?this.badgeHandle.value=this.activityService.showViewContainerActivity(b,{badge:new C(i,e=>e===1?v.localize("dirtyFile","1 unsaved file"):v.localize("dirtyFiles","{0} unsaved files",i))}):this.badgeHandle.clear()}};a=p([n(0,u),n(1,f),n(2,h)],a);export{a as DirtyFilesIndicator};
