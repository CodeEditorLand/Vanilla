import r from"assert";import{Emitter as S}from"../../../../../base/common/event.js";import{ensureNoDisposablesAreLeakedInTestSuite as w,toResource as C}from"../../../../../base/test/common/utils.js";import{TestFileService as x}from"../../../../test/browser/workbenchTestServices.js";import{ExplorerItem as D}from"../../common/explorerModel.js";import{getContext as f}from"../../browser/views/explorerView.js";import{listInvalidItemForeground as I}from"../../../../../platform/theme/common/colorRegistry.js";import{CompressedNavigationController as N}from"../../browser/views/explorerViewer.js";import*as m from"../../../../../base/browser/dom.js";import{DisposableStore as b}from"../../../../../base/common/lifecycle.js";import{provideDecorations as h}from"../../browser/views/explorerDecorationsProvider.js";import{TestConfigurationService as y}from"../../../../../platform/configuration/test/common/testConfigurationService.js";import{NullFilesConfigurationService as T}from"../../../../test/common/workbenchTestServices.js";suite("Files - ExplorerView",()=>{const p=m.$,E=w(),q=new x,v=new y;function l(s,t,i,o,a,n,c=!1,u=!1){return new D(C.call(this,s),q,v,T,void 0,i,c,!1,!1,t,n,u)}test("getContext",async function(){const s=new Date().getTime(),t=l.call(this,"/","/",!0,!1,8096,s),i=l.call(this,"/path","path",!0,!1,8096,s),o=l.call(this,"/path/to","to",!0,!1,8096,s),a=l.call(this,"/path/to/stat","stat",!1,!1,8096,s),n={getCompressedNavigationController:c=>{}};r.deepStrictEqual(f([t],[i,o,a],!0,n),[i,o,a]),r.deepStrictEqual(f([t],[t,o,a],!0,n),[t,o,a]),r.deepStrictEqual(f([t],[o,t,a],!1,n),[t]),r.deepStrictEqual(f([],[o,t,a],!1,n),[]),r.deepStrictEqual(f([],[o,t,a],!0,n),[o,t,a])}),test("decoration provider",async function(){const s=new Date().getTime(),t=l.call(this,"/path","path",!0,!1,8096,s);t.error=new Error("A test error");const i=l.call(this,"/path/to","to",!0,!1,8096,s,!0),o=l.call(this,"/path/to/stat","stat",!1,!1,8096,s);r.strictEqual(h(o),void 0),r.deepStrictEqual(h(i),{tooltip:"Symbolic Link",letter:"\u2937"}),r.deepStrictEqual(h(t),{tooltip:"Unable to resolve workspace folder (A test error)",letter:"!",color:I});const a=l.call(this,"/path/to/stat","stat",!1,!1,8096,s,!1,!0);r.deepStrictEqual(h(a),{tooltip:"Unknown File Type",letter:"?"})}),test("compressed navigation controller",async function(){const s=p(".file"),t=p(".label"),i=p(".label-name"),o=p(".label-name"),a=p(".label-name"),n=new Date().getTime(),c=l.call(this,"/path","path",!0,!1,8096,n),u=l.call(this,"/path/to","to",!0,!1,8096,n),d=l.call(this,"/path/to/stat","stat",!1,!1,8096,n);m.append(s,t),m.append(t,i),m.append(t,o),m.append(t,a);const g=new S,e=new N("id",[c,u,d],{container:s,templateDisposables:E.add(new b),elementDisposables:E.add(new b),contribs:[],label:{container:t,onDidRender:g.event}},1,!1);E.add(e),r.strictEqual(e.count,3),r.strictEqual(e.index,2),r.strictEqual(e.current,d),e.next(),r.strictEqual(e.current,d),e.previous(),r.strictEqual(e.current,u),e.previous(),r.strictEqual(e.current,c),e.previous(),r.strictEqual(e.current,c),e.last(),r.strictEqual(e.current,d),e.first(),r.strictEqual(e.current,c),e.setIndex(1),r.strictEqual(e.current,u),e.setIndex(44),r.strictEqual(e.current,u)})});
