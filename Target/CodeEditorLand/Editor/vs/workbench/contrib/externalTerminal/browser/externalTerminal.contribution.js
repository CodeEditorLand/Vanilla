var D=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var x=(s,o,e,n)=>{for(var t=n>1?void 0:n?N(o,e):o,m=s.length-1,c;m>=0;m--)(c=s[m])&&(t=(n?c(o,e,t):c(t))||t);return n&&t&&D(o,e,t),t},S=(s,o)=>(e,n)=>o(e,n,s);import*as g from"../../../../nls.js";import{IConfigurationService as E}from"../../../../platform/configuration/common/configuration.js";import{URI as K}from"../../../../base/common/uri.js";import{MenuId as C,MenuRegistry as M}from"../../../../platform/actions/common/actions.js";import{ITerminalGroupService as k,ITerminalService as L}from"../../terminal/browser/terminal.js";import{ResourceContextKey as I}from"../../../common/contextkeys.js";import{IFileService as P}from"../../../../platform/files/common/files.js";import{getMultiSelectedResources as G,IExplorerService as z}from"../../files/browser/files.js";import{CommandsRegistry as U}from"../../../../platform/commands/common/commands.js";import{Schemas as d}from"../../../../base/common/network.js";import{distinct as _}from"../../../../base/common/arrays.js";import{IRemoteAgentService as V}from"../../../services/remote/common/remoteAgentService.js";import{ContextKeyExpr as a}from"../../../../platform/contextkey/common/contextkey.js";import{Extensions as F}from"../../../common/contributions.js";import{Disposable as j}from"../../../../base/common/lifecycle.js";import{isWindows as B}from"../../../../base/common/platform.js";import{dirname as h,basename as H}from"../../../../base/common/path.js";import{LifecyclePhase as J}from"../../../services/lifecycle/common/lifecycle.js";import{Registry as Q}from"../../../../platform/registry/common/platform.js";import{IExternalTerminalService as X}from"../../../../platform/externalTerminal/common/externalTerminal.js";import{TerminalLocation as Y}from"../../../../platform/terminal/common/terminal.js";import{IListService as Z}from"../../../../platform/list/browser/listService.js";import{IEditorService as $}from"../../../services/editor/common/editorService.js";import{IEditorGroupsService as ee}from"../../../services/editor/common/editorGroupsService.js";const w="openInTerminal",y="openInIntegratedTerminal";function b(s,o){U.registerCommand({id:s,handler:async(e,n)=>{const t=e.get(E),m=e.get(P),c=e.get(L),R=e.get(V),O=e.get(k);let f;try{f=e.get(X)}catch{}const T=G(n,e.get(Z),e.get($),e.get(ee),e.get(z));return m.resolveAll(T.map(u=>({resource:u}))).then(async u=>{const A=t.getValue(),W=R.getConnection()||o==="integrated",v=_(u.filter(r=>r.success));if(W){const r={},q=v.map(({stat:l})=>{const i=l.resource;return l.isDirectory?i:K.from({scheme:i.scheme,authority:i.authority,fragment:i.fragment,query:i.query,path:h(i.path)})});for(const l of q){if(r[l.path])return;r[l.path]=!0;const i=await c.createTerminal({config:{cwd:l}});i&&i.target!==Y.Editor&&(T.length===1||!n||l.path===n.path||l.path===h(n.path))&&(c.setActiveInstance(i),O.showPanel(!0))}}else f&&_(v.map(({stat:r})=>r.isDirectory?r.resource.fsPath:h(r.resource.fsPath))).forEach(r=>{f.openTerminal(A.terminal.external,r)})})}})}b(w,"external"),b(y,"integrated");let p=class extends j{constructor(e){super();this._configurationService=e;const n=a.and(I.Scheme.isEqualTo(d.file),a.or(a.equals("config.terminal.explorerKind","integrated"),a.equals("config.terminal.explorerKind","both"))),t=a.and(I.Scheme.isEqualTo(d.file),a.or(a.equals("config.terminal.explorerKind","external"),a.equals("config.terminal.explorerKind","both")));this._openInIntegratedTerminalMenuItem={group:"navigation",order:30,command:{id:y,title:g.localize("scopedConsoleAction.Integrated","Open in Integrated Terminal")},when:a.or(n,I.Scheme.isEqualTo(d.vscodeRemote))},this._openInTerminalMenuItem={group:"navigation",order:31,command:{id:w,title:g.localize("scopedConsoleAction.external","Open in External Terminal")},when:t},M.appendMenuItem(C.ExplorerContext,this._openInTerminalMenuItem),M.appendMenuItem(C.ExplorerContext,this._openInIntegratedTerminalMenuItem),this._register(this._configurationService.onDidChangeConfiguration(m=>{(m.affectsConfiguration("terminal.explorerKind")||m.affectsConfiguration("terminal.external"))&&this._refreshOpenInTerminalMenuItemTitle()})),this._refreshOpenInTerminalMenuItemTitle()}_openInIntegratedTerminalMenuItem;_openInTerminalMenuItem;isWindows(){const e=this._configurationService.getValue().terminal;if(B&&e.external?.windowsExec){const n=H(e.external.windowsExec);if(n==="wt"||n==="wt.exe")return!0}return!1}_refreshOpenInTerminalMenuItemTitle(){this.isWindows()&&(this._openInTerminalMenuItem.command.title=g.localize("scopedConsoleAction.wt","Open in Windows Terminal"))}};p=x([S(0,E)],p),Q.as(F.Workbench).registerWorkbenchContribution(p,J.Restored);export{p as ExternalTerminalContribution};
