{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/url/browser/trustedDomains.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { URI } from '../../../../base/common/uri.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { IQuickInputService, IQuickPickItem } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../../services/environment/browser/environmentService.js';\n\nconst TRUSTED_DOMAINS_URI = URI.parse('trustedDomains:/Trusted Domains');\n\nexport const TRUSTED_DOMAINS_STORAGE_KEY = 'http.linkProtectionTrustedDomains';\nexport const TRUSTED_DOMAINS_CONTENT_STORAGE_KEY = 'http.linkProtectionTrustedDomainsContent';\n\nexport const manageTrustedDomainSettingsCommand = {\n\tid: 'workbench.action.manageTrustedDomain',\n\tdescription: {\n\t\tdescription: localize2('trustedDomain.manageTrustedDomain', 'Manage Trusted Domains'),\n\t\targs: []\n\t},\n\thandler: async (accessor: ServicesAccessor) => {\n\t\tconst editorService = accessor.get(IEditorService);\n\t\teditorService.openEditor({ resource: TRUSTED_DOMAINS_URI, languageId: 'jsonc', options: { pinned: true } });\n\t\treturn;\n\t}\n};\n\ntype ConfigureTrustedDomainsQuickPickItem = IQuickPickItem & ({ id: 'manage' } | { id: 'trust'; toTrust: string });\n\nexport async function configureOpenerTrustedDomainsHandler(\n\ttrustedDomains: string[],\n\tdomainToConfigure: string,\n\tresource: URI,\n\tquickInputService: IQuickInputService,\n\tstorageService: IStorageService,\n\teditorService: IEditorService,\n\ttelemetryService: ITelemetryService,\n) {\n\tconst parsedDomainToConfigure = URI.parse(domainToConfigure);\n\tconst toplevelDomainSegements = parsedDomainToConfigure.authority.split('.');\n\tconst domainEnd = toplevelDomainSegements.slice(toplevelDomainSegements.length - 2).join('.');\n\tconst topLevelDomain = '*.' + domainEnd;\n\tconst options: ConfigureTrustedDomainsQuickPickItem[] = [];\n\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.trustDomain', 'Trust {0}', domainToConfigure),\n\t\tid: 'trust',\n\t\ttoTrust: domainToConfigure,\n\t\tpicked: true\n\t});\n\n\tconst isIP =\n\t\ttoplevelDomainSegements.length === 4 &&\n\t\ttoplevelDomainSegements.every(segment =>\n\t\t\tNumber.isInteger(+segment) || Number.isInteger(+segment.split(':')[0]));\n\n\tif (isIP) {\n\t\tif (parsedDomainToConfigure.authority.includes(':')) {\n\t\t\tconst base = parsedDomainToConfigure.authority.split(':')[0];\n\t\t\toptions.push({\n\t\t\t\ttype: 'item',\n\t\t\t\tlabel: localize('trustedDomain.trustAllPorts', 'Trust {0} on all ports', base),\n\t\t\t\ttoTrust: base + ':*',\n\t\t\t\tid: 'trust'\n\t\t\t});\n\t\t}\n\t} else {\n\t\toptions.push({\n\t\t\ttype: 'item',\n\t\t\tlabel: localize('trustedDomain.trustSubDomain', 'Trust {0} and all its subdomains', domainEnd),\n\t\t\ttoTrust: topLevelDomain,\n\t\t\tid: 'trust'\n\t\t});\n\t}\n\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.trustAllDomains', 'Trust all domains (disables link protection)'),\n\t\ttoTrust: '*',\n\t\tid: 'trust'\n\t});\n\toptions.push({\n\t\ttype: 'item',\n\t\tlabel: localize('trustedDomain.manageTrustedDomains', 'Manage Trusted Domains'),\n\t\tid: 'manage'\n\t});\n\n\tconst pickedResult = await quickInputService.pick<ConfigureTrustedDomainsQuickPickItem>(\n\t\toptions, { activeItem: options[0] }\n\t);\n\n\tif (pickedResult && pickedResult.id) {\n\t\tswitch (pickedResult.id) {\n\t\t\tcase 'manage':\n\t\t\t\tawait editorService.openEditor({\n\t\t\t\t\tresource: TRUSTED_DOMAINS_URI.with({ fragment: resource.toString() }),\n\t\t\t\t\tlanguageId: 'jsonc',\n\t\t\t\t\toptions: { pinned: true }\n\t\t\t\t});\n\t\t\t\treturn trustedDomains;\n\t\t\tcase 'trust': {\n\t\t\t\tconst itemToTrust = pickedResult.toTrust;\n\t\t\t\tif (trustedDomains.indexOf(itemToTrust) === -1) {\n\t\t\t\t\tstorageService.remove(TRUSTED_DOMAINS_CONTENT_STORAGE_KEY, StorageScope.APPLICATION);\n\t\t\t\t\tstorageService.store(\n\t\t\t\t\t\tTRUSTED_DOMAINS_STORAGE_KEY,\n\t\t\t\t\t\tJSON.stringify([...trustedDomains, itemToTrust]),\n\t\t\t\t\t\tStorageScope.APPLICATION,\n\t\t\t\t\t\tStorageTarget.USER\n\t\t\t\t\t);\n\n\t\t\t\t\treturn [...trustedDomains, itemToTrust];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\treturn [];\n}\n\nexport interface IStaticTrustedDomains {\n\treadonly defaultTrustedDomains: string[];\n\treadonly trustedDomains: string[];\n}\n\nexport async function readTrustedDomains(accessor: ServicesAccessor): Promise<IStaticTrustedDomains> {\n\tconst { defaultTrustedDomains, trustedDomains } = readStaticTrustedDomains(accessor);\n\treturn {\n\t\tdefaultTrustedDomains,\n\t\ttrustedDomains,\n\t};\n}\n\nexport function readStaticTrustedDomains(accessor: ServicesAccessor): IStaticTrustedDomains {\n\tconst storageService = accessor.get(IStorageService);\n\tconst productService = accessor.get(IProductService);\n\tconst environmentService = accessor.get(IBrowserWorkbenchEnvironmentService);\n\n\tconst defaultTrustedDomains = [\n\t\t...productService.linkProtectionTrustedDomains ?? [],\n\t\t...environmentService.options?.additionalTrustedDomains ?? []\n\t];\n\n\tlet trustedDomains: string[] = [];\n\ttry {\n\t\tconst trustedDomainsSrc = storageService.get(TRUSTED_DOMAINS_STORAGE_KEY, StorageScope.APPLICATION);\n\t\tif (trustedDomainsSrc) {\n\t\t\ttrustedDomains = JSON.parse(trustedDomainsSrc);\n\t\t}\n\t} catch (err) { }\n\n\treturn {\n\t\tdefaultTrustedDomains,\n\t\ttrustedDomains,\n\t};\n}\n"],
  "mappings": "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",
  "names": []
}
