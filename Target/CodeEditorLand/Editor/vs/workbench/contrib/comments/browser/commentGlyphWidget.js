import{Color as r}from"../../../../base/common/color.js";import{Emitter as u}from"../../../../base/common/event.js";import{Disposable as h,toDisposable as p}from"../../../../base/common/lifecycle.js";import{ContentWidgetPositionPreference as g}from"../../../../editor/browser/editorBrowser.js";import{CommentThreadState as v}from"../../../../editor/common/languages.js";import{OverviewRulerLane as _}from"../../../../editor/common/model.js";import{ModelDecorationOptions as D}from"../../../../editor/common/model/textModel.js";import*as o from"../../../../nls.js";import{darken as b,editorBackground as s,editorForeground as m,listInactiveSelectionBackground as c,opaque as d,registerColor as t}from"../../../../platform/theme/common/colorRegistry.js";import{themeColorFromId as C}from"../../../../platform/theme/common/themeService.js";const f=t("editorGutter.commentRangeForeground",{dark:d(c,s),light:b(d(c,s),.05),hcDark:r.white,hcLight:r.black},o.localize("editorGutterCommentRangeForeground","Editor gutter decoration color for commenting ranges. This color should be opaque.")),a=t("editorOverviewRuler.commentForeground",f,o.localize("editorOverviewRuler.commentForeground","Editor overview ruler decoration color for resolved comments. This color should be opaque.")),N=t("editorOverviewRuler.commentUnresolvedForeground",a,o.localize("editorOverviewRuler.commentUnresolvedForeground","Editor overview ruler decoration color for unresolved comments. This color should be opaque.")),O=t("editorGutter.commentGlyphForeground",{dark:m,light:m,hcDark:r.black,hcLight:r.white},o.localize("editorGutterCommentGlyphForeground","Editor gutter decoration color for commenting glyphs."));t("editorGutter.commentUnresolvedGlyphForeground",O,o.localize("editorGutterCommentUnresolvedGlyphForeground","Editor gutter decoration color for commenting glyphs for unresolved comment threads."));class l extends h{static description="comment-glyph-widget";_lineNumber;_editor;_threadState;_commentsDecorations;_commentsOptions;_onDidChangeLineNumber=this._register(new u);onDidChangeLineNumber=this._onDidChangeLineNumber.event;constructor(e,i){super(),this._commentsOptions=this.createDecorationOptions(),this._editor=e,this._commentsDecorations=this._editor.createDecorationsCollection(),this._register(this._commentsDecorations.onDidChange(y=>{const n=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;n&&n.endLineNumber!==this._lineNumber&&(this._lineNumber=n.endLineNumber,this._onDidChangeLineNumber.fire(this._lineNumber))})),this._register(p(()=>this._commentsDecorations.clear())),this.setLineNumber(i)}createDecorationOptions(){const e=this._threadState===v.Unresolved,i={description:l.description,isWholeLine:!0,overviewRuler:{color:C(e?N:a),position:_.Center},collapseOnReplaceEdit:!0,linesDecorationsClassName:`comment-range-glyph comment-thread${e?"-unresolved":""}`};return D.createDynamic(i)}setThreadState(e){this._threadState!==e&&(this._threadState=e,this._commentsOptions=this.createDecorationOptions(),this._updateDecorations())}_updateDecorations(){const e=[{range:{startLineNumber:this._lineNumber,startColumn:1,endLineNumber:this._lineNumber,endColumn:1},options:this._commentsOptions}];this._commentsDecorations.set(e)}setLineNumber(e){this._lineNumber=e,this._updateDecorations()}getPosition(){const e=this._commentsDecorations.length>0?this._commentsDecorations.getRange(0):null;return{position:{lineNumber:e?e.endLineNumber:this._lineNumber,column:1},preference:[g.EXACT]}}}export{l as CommentGlyphWidget,f as overviewRulerCommentingRangeForeground};
