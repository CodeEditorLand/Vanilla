{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/comments/browser/commentThreadHeader.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { ActionBar } from '../../../../base/browser/ui/actionbar/actionbar.js';\nimport { Action, ActionRunner } from '../../../../base/common/actions.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { Disposable, IDisposable, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport * as strings from '../../../../base/common/strings.js';\nimport * as languages from '../../../../editor/common/languages.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport * as nls from '../../../../nls.js';\nimport { createActionViewItem } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenu, MenuItemAction, SubmenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { registerIcon } from '../../../../platform/theme/common/iconRegistry.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { CommentMenus } from './commentMenus.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { MarshalledCommentThread } from '../../../common/comments.js';\n\nconst collapseIcon = registerIcon('review-comment-collapse', Codicon.chevronUp, nls.localize('collapseIcon', 'Icon to collapse a review comment.'));\nconst COLLAPSE_ACTION_CLASS = 'expand-review-action ' + ThemeIcon.asClassName(collapseIcon);\nconst DELETE_ACTION_CLASS = 'expand-review-action ' + ThemeIcon.asClassName(Codicon.trashcan);\n\nfunction threadHasComments(comments: ReadonlyArray<languages.Comment> | undefined): comments is ReadonlyArray<languages.Comment> {\n\treturn !!comments && comments.length > 0;\n}\n\nexport class CommentThreadHeader<T = IRange> extends Disposable {\n\tprivate _headElement: HTMLElement;\n\tprivate _headingLabel!: HTMLElement;\n\tprivate _actionbarWidget!: ActionBar;\n\tprivate _collapseAction!: Action;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\tprivate _delegate: { collapse: () => void },\n\t\tprivate _commentMenus: CommentMenus,\n\t\tprivate _commentThread: languages.CommentThread<T>,\n\t\tprivate _contextKeyService: IContextKeyService,\n\t\tprivate instantiationService: IInstantiationService,\n\t\tprivate _contextMenuService: IContextMenuService\n\t) {\n\t\tsuper();\n\t\tthis._headElement = <HTMLDivElement>dom.$('.head');\n\t\tcontainer.appendChild(this._headElement);\n\t\tthis._register(toDisposable(() => this._headElement.remove()));\n\t\tthis._fillHead();\n\t}\n\n\tprotected _fillHead(): void {\n\t\tconst titleElement = dom.append(this._headElement, dom.$('.review-title'));\n\n\t\tthis._headingLabel = dom.append(titleElement, dom.$('span.filename'));\n\t\tthis.createThreadLabel();\n\n\t\tconst actionsContainer = dom.append(this._headElement, dom.$('.review-actions'));\n\t\tthis._actionbarWidget = new ActionBar(actionsContainer, {\n\t\t\tactionViewItemProvider: createActionViewItem.bind(undefined, this.instantiationService)\n\t\t});\n\n\t\tthis._register(this._actionbarWidget);\n\n\t\tconst collapseClass = threadHasComments(this._commentThread.comments) ? COLLAPSE_ACTION_CLASS : DELETE_ACTION_CLASS;\n\t\tthis._collapseAction = new Action('review.expand', nls.localize('label.collapse', \"Collapse\"), collapseClass, true, () => this._delegate.collapse());\n\t\tif (!threadHasComments(this._commentThread.comments)) {\n\t\t\tconst commentsChanged: MutableDisposable<IDisposable> = this._register(new MutableDisposable());\n\t\t\tcommentsChanged.value = this._commentThread.onDidChangeComments(() => {\n\t\t\t\tif (threadHasComments(this._commentThread.comments)) {\n\t\t\t\t\tthis._collapseAction.class = COLLAPSE_ACTION_CLASS;\n\t\t\t\t\tcommentsChanged.clear();\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst menu = this._commentMenus.getCommentThreadTitleActions(this._contextKeyService);\n\t\tthis._register(menu);\n\t\tthis.setActionBarActions(menu);\n\n\t\tthis._register(menu);\n\t\tthis._register(menu.onDidChange(e => {\n\t\t\tthis.setActionBarActions(menu);\n\t\t}));\n\n\t\tthis._register(dom.addDisposableListener(this._headElement, dom.EventType.CONTEXT_MENU, e => {\n\t\t\treturn this.onContextMenu(e);\n\t\t}));\n\n\t\tthis._actionbarWidget.context = this._commentThread;\n\t}\n\n\tprivate setActionBarActions(menu: IMenu): void {\n\t\tconst groups = menu.getActions({ shouldForwardArgs: true }).reduce((r, [, actions]) => [...r, ...actions], <(MenuItemAction | SubmenuItemAction)[]>[]);\n\t\tthis._actionbarWidget.clear();\n\t\tthis._actionbarWidget.push([...groups, this._collapseAction], { label: false, icon: true });\n\t}\n\n\tupdateCommentThread(commentThread: languages.CommentThread<T>) {\n\t\tthis._commentThread = commentThread;\n\n\t\tthis._actionbarWidget.context = this._commentThread;\n\t\tthis.createThreadLabel();\n\t}\n\n\tcreateThreadLabel() {\n\t\tlet label: string | undefined;\n\t\tlabel = this._commentThread.label;\n\n\t\tif (label === undefined) {\n\t\t\tif (!(this._commentThread.comments && this._commentThread.comments.length)) {\n\t\t\t\tlabel = nls.localize('startThread', \"Start discussion\");\n\t\t\t}\n\t\t}\n\n\t\tif (label) {\n\t\t\tthis._headingLabel.textContent = strings.escape(label);\n\t\t\tthis._headingLabel.setAttribute('aria-label', label);\n\t\t}\n\t}\n\n\tupdateHeight(headHeight: number) {\n\t\tthis._headElement.style.height = `${headHeight}px`;\n\t\tthis._headElement.style.lineHeight = this._headElement.style.height;\n\t}\n\n\tprivate onContextMenu(e: MouseEvent) {\n\t\tconst actions = this._commentMenus.getCommentThreadTitleContextActions(this._contextKeyService).getActions({ shouldForwardArgs: true }).map((value) => value[1]).flat();\n\t\tif (!actions.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst event = new StandardMouseEvent(dom.getWindow(this._headElement), e);\n\t\tthis._contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => event,\n\t\t\tgetActions: () => actions,\n\t\t\tactionRunner: new ActionRunner(),\n\t\t\tgetActionsContext: (): MarshalledCommentThread => {\n\t\t\t\treturn {\n\t\t\t\t\tcommentControlHandle: this._commentThread.controllerHandle,\n\t\t\t\t\tcommentThreadHandle: this._commentThread.commentThreadHandle,\n\t\t\t\t\t$mid: MarshalledId.CommentThread\n\t\t\t\t};\n\t\t\t},\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
