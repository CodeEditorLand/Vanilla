{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/comments/browser/commentThreadHeader.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../base/browser/dom.js\";\nimport { StandardMouseEvent } from \"../../../../base/browser/mouseEvent.js\";\nimport { ActionBar } from \"../../../../base/browser/ui/actionbar/actionbar.js\";\nimport { Action, ActionRunner } from \"../../../../base/common/actions.js\";\nimport { Codicon } from \"../../../../base/common/codicons.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\tMutableDisposable,\n\ttoDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport { MarshalledId } from \"../../../../base/common/marshallingIds.js\";\nimport * as strings from \"../../../../base/common/strings.js\";\nimport { ThemeIcon } from \"../../../../base/common/themables.js\";\nimport type { IRange } from \"../../../../editor/common/core/range.js\";\nimport type * as languages from \"../../../../editor/common/languages.js\";\nimport * as nls from \"../../../../nls.js\";\nimport { createActionViewItem } from \"../../../../platform/actions/browser/menuEntryActionViewItem.js\";\nimport type {\n\tIMenu,\n\tMenuItemAction,\n\tSubmenuItemAction,\n} from \"../../../../platform/actions/common/actions.js\";\nimport type { IContextKeyService } from \"../../../../platform/contextkey/common/contextkey.js\";\nimport type { IContextMenuService } from \"../../../../platform/contextview/browser/contextView.js\";\nimport type { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { registerIcon } from \"../../../../platform/theme/common/iconRegistry.js\";\nimport type { MarshalledCommentThread } from \"../../../common/comments.js\";\nimport type { CommentMenus } from \"./commentMenus.js\";\n\nconst collapseIcon = registerIcon(\n\t\"review-comment-collapse\",\n\tCodicon.chevronUp,\n\tnls.localize(\"collapseIcon\", \"Icon to collapse a review comment.\"),\n);\nconst COLLAPSE_ACTION_CLASS =\n\t\"expand-review-action \" + ThemeIcon.asClassName(collapseIcon);\nconst DELETE_ACTION_CLASS =\n\t\"expand-review-action \" + ThemeIcon.asClassName(Codicon.trashcan);\n\nfunction threadHasComments(\n\tcomments: ReadonlyArray<languages.Comment> | undefined,\n): comments is ReadonlyArray<languages.Comment> {\n\treturn !!comments && comments.length > 0;\n}\n\nexport class CommentThreadHeader<T = IRange> extends Disposable {\n\tprivate _headElement: HTMLElement;\n\tprivate _headingLabel!: HTMLElement;\n\tprivate _actionbarWidget!: ActionBar;\n\tprivate _collapseAction!: Action;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\tprivate _delegate: { collapse: () => void },\n\t\tprivate _commentMenus: CommentMenus,\n\t\tprivate _commentThread: languages.CommentThread<T>,\n\t\tprivate _contextKeyService: IContextKeyService,\n\t\tprivate instantiationService: IInstantiationService,\n\t\tprivate _contextMenuService: IContextMenuService,\n\t) {\n\t\tsuper();\n\t\tthis._headElement = <HTMLDivElement>dom.$(\".head\");\n\t\tcontainer.appendChild(this._headElement);\n\t\tthis._register(toDisposable(() => this._headElement.remove()));\n\t\tthis._fillHead();\n\t}\n\n\tprotected _fillHead(): void {\n\t\tconst titleElement = dom.append(\n\t\t\tthis._headElement,\n\t\t\tdom.$(\".review-title\"),\n\t\t);\n\n\t\tthis._headingLabel = dom.append(titleElement, dom.$(\"span.filename\"));\n\t\tthis.createThreadLabel();\n\n\t\tconst actionsContainer = dom.append(\n\t\t\tthis._headElement,\n\t\t\tdom.$(\".review-actions\"),\n\t\t);\n\t\tthis._actionbarWidget = new ActionBar(actionsContainer, {\n\t\t\tactionViewItemProvider: createActionViewItem.bind(\n\t\t\t\tundefined,\n\t\t\t\tthis.instantiationService,\n\t\t\t),\n\t\t});\n\n\t\tthis._register(this._actionbarWidget);\n\n\t\tconst collapseClass = threadHasComments(this._commentThread.comments)\n\t\t\t? COLLAPSE_ACTION_CLASS\n\t\t\t: DELETE_ACTION_CLASS;\n\t\tthis._collapseAction = new Action(\n\t\t\t\"review.expand\",\n\t\t\tnls.localize(\"label.collapse\", \"Collapse\"),\n\t\t\tcollapseClass,\n\t\t\ttrue,\n\t\t\t() => this._delegate.collapse(),\n\t\t);\n\t\tif (!threadHasComments(this._commentThread.comments)) {\n\t\t\tconst commentsChanged: MutableDisposable<IDisposable> =\n\t\t\t\tthis._register(new MutableDisposable());\n\t\t\tcommentsChanged.value = this._commentThread.onDidChangeComments(\n\t\t\t\t() => {\n\t\t\t\t\tif (threadHasComments(this._commentThread.comments)) {\n\t\t\t\t\t\tthis._collapseAction.class = COLLAPSE_ACTION_CLASS;\n\t\t\t\t\t\tcommentsChanged.clear();\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tconst menu = this._commentMenus.getCommentThreadTitleActions(\n\t\t\tthis._contextKeyService,\n\t\t);\n\t\tthis._register(menu);\n\t\tthis.setActionBarActions(menu);\n\n\t\tthis._register(menu);\n\t\tthis._register(\n\t\t\tmenu.onDidChange((e) => {\n\t\t\t\tthis.setActionBarActions(menu);\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tthis._headElement,\n\t\t\t\tdom.EventType.CONTEXT_MENU,\n\t\t\t\t(e) => {\n\t\t\t\t\treturn this.onContextMenu(e);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._actionbarWidget.context = this._commentThread;\n\t}\n\n\tprivate setActionBarActions(menu: IMenu): void {\n\t\tconst groups = menu\n\t\t\t.getActions({ shouldForwardArgs: true })\n\t\t\t.reduce(\n\t\t\t\t(r, [, actions]) => [...r, ...actions],\n\t\t\t\t<(MenuItemAction | SubmenuItemAction)[]>[],\n\t\t\t);\n\t\tthis._actionbarWidget.clear();\n\t\tthis._actionbarWidget.push([...groups, this._collapseAction], {\n\t\t\tlabel: false,\n\t\t\ticon: true,\n\t\t});\n\t}\n\n\tupdateCommentThread(commentThread: languages.CommentThread<T>) {\n\t\tthis._commentThread = commentThread;\n\n\t\tthis._actionbarWidget.context = this._commentThread;\n\t\tthis.createThreadLabel();\n\t}\n\n\tcreateThreadLabel() {\n\t\tlet label: string | undefined;\n\t\tlabel = this._commentThread.label;\n\n\t\tif (label === undefined) {\n\t\t\tif (\n\t\t\t\t!(\n\t\t\t\t\tthis._commentThread.comments &&\n\t\t\t\t\tthis._commentThread.comments.length\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tlabel = nls.localize(\"startThread\", \"Start discussion\");\n\t\t\t}\n\t\t}\n\n\t\tif (label) {\n\t\t\tthis._headingLabel.textContent = strings.escape(label);\n\t\t\tthis._headingLabel.setAttribute(\"aria-label\", label);\n\t\t}\n\t}\n\n\tupdateHeight(headHeight: number) {\n\t\tthis._headElement.style.height = `${headHeight}px`;\n\t\tthis._headElement.style.lineHeight = this._headElement.style.height;\n\t}\n\n\tprivate onContextMenu(e: MouseEvent) {\n\t\tconst actions = this._commentMenus\n\t\t\t.getCommentThreadTitleContextActions(this._contextKeyService)\n\t\t\t.getActions({ shouldForwardArgs: true })\n\t\t\t.flatMap((value) => value[1]);\n\t\tif (!actions.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst event = new StandardMouseEvent(\n\t\t\tdom.getWindow(this._headElement),\n\t\t\te,\n\t\t);\n\t\tthis._contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => event,\n\t\t\tgetActions: () => actions,\n\t\t\tactionRunner: new ActionRunner(),\n\t\t\tgetActionsContext: (): MarshalledCommentThread => {\n\t\t\t\treturn {\n\t\t\t\t\tcommentControlHandle: this._commentThread.controllerHandle,\n\t\t\t\t\tcommentThreadHandle:\n\t\t\t\t\t\tthis._commentThread.commentThreadHandle,\n\t\t\t\t\t$mid: MarshalledId.CommentThread,\n\t\t\t\t};\n\t\t\t},\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
