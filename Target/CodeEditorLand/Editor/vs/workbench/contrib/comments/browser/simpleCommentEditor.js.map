{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/comments/browser/simpleCommentEditor.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\ttype EditorAction,\n\tEditorContributionInstantiation,\n\tEditorExtensionsRegistry,\n\ttype IEditorContributionDescription,\n} from \"../../../../editor/browser/editorExtensions.js\";\nimport { ICodeEditorService } from \"../../../../editor/browser/services/codeEditorService.js\";\nimport {\n\tCodeEditorWidget,\n\ttype ICodeEditorWidgetOptions,\n} from \"../../../../editor/browser/widget/codeEditor/codeEditorWidget.js\";\nimport {\n\tEditorOption,\n\ttype IEditorOptions,\n} from \"../../../../editor/common/config/editorOptions.js\";\nimport { ICommandService } from \"../../../../platform/commands/common/commands.js\";\nimport {\n\ttype IContextKey,\n\ttype IContextKeyService,\n\tRawContextKey,\n} from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\n\nimport { clamp } from \"../../../../base/common/numbers.js\";\nimport type { ICodeEditor } from \"../../../../editor/browser/editorBrowser.js\";\nimport { ILanguageConfigurationService } from \"../../../../editor/common/languages/languageConfigurationRegistry.js\";\nimport { ILanguageFeaturesService } from \"../../../../editor/common/services/languageFeatures.js\";\nimport { CodeActionController } from \"../../../../editor/contrib/codeAction/browser/codeActionController.js\";\nimport { ContextMenuController } from \"../../../../editor/contrib/contextmenu/browser/contextmenu.js\";\nimport { CopyPasteController } from \"../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js\";\nimport { DropIntoEditorController } from \"../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js\";\nimport { ContentHoverController } from \"../../../../editor/contrib/hover/browser/contentHoverController.js\";\nimport { GlyphHoverController } from \"../../../../editor/contrib/hover/browser/glyphHoverController.js\";\nimport { InlineCompletionsController } from \"../../../../editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js\";\nimport { LinkDetector } from \"../../../../editor/contrib/links/browser/links.js\";\nimport { MessageController } from \"../../../../editor/contrib/message/browser/messageController.js\";\nimport { SnippetController2 } from \"../../../../editor/contrib/snippet/browser/snippetController2.js\";\nimport { SuggestController } from \"../../../../editor/contrib/suggest/browser/suggestController.js\";\nimport { IAccessibilityService } from \"../../../../platform/accessibility/common/accessibility.js\";\nimport { MenuId } from \"../../../../platform/actions/common/actions.js\";\nimport type { IConfigurationService } from \"../../../../platform/configuration/common/configuration.js\";\nimport { INotificationService } from \"../../../../platform/notification/common/notification.js\";\nimport { IThemeService } from \"../../../../platform/theme/common/themeService.js\";\nimport { EditorDictation } from \"../../codeEditor/browser/dictation/editorDictation.js\";\n// Allowed Editor Contributions:\nimport { MenuPreventer } from \"../../codeEditor/browser/menuPreventer.js\";\nimport { SelectionClipboardContributionID } from \"../../codeEditor/browser/selectionClipboard.js\";\nimport { TabCompletionController } from \"../../snippets/browser/tabCompletion.js\";\nimport { CommentContextKeys } from \"../common/commentContextKeys.js\";\nimport type { ICommentThreadWidget } from \"../common/commentThreadWidget.js\";\n\nexport const ctxCommentEditorFocused = new RawContextKey<boolean>(\n\t\"commentEditorFocused\",\n\tfalse,\n);\nexport const MIN_EDITOR_HEIGHT = 5 * 18;\nexport const MAX_EDITOR_HEIGHT = 25 * 18;\n\nexport interface LayoutableEditor {\n\tgetLayoutInfo(): { height: number };\n}\n\nexport class SimpleCommentEditor extends CodeEditorWidget {\n\tprivate _parentThread: ICommentThreadWidget;\n\tprivate _commentEditorFocused: IContextKey<boolean>;\n\tprivate _commentEditorEmpty: IContextKey<boolean>;\n\n\tconstructor(\n\t\tdomElement: HTMLElement,\n\t\toptions: IEditorOptions,\n\t\tscopedContextKeyService: IContextKeyService,\n\t\tparentThread: ICommentThreadWidget,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ICodeEditorService codeEditorService: ICodeEditorService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@ILanguageConfigurationService\n\t\tlanguageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService\n\t\tlanguageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tconst codeEditorWidgetOptions: ICodeEditorWidgetOptions = {\n\t\t\tcontributions: <IEditorContributionDescription[]>[\n\t\t\t\t{\n\t\t\t\t\tid: MenuPreventer.ID,\n\t\t\t\t\tctor: MenuPreventer,\n\t\t\t\t\tinstantiation:\n\t\t\t\t\t\tEditorContributionInstantiation.BeforeFirstInteraction,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: ContextMenuController.ID,\n\t\t\t\t\tctor: ContextMenuController,\n\t\t\t\t\tinstantiation:\n\t\t\t\t\t\tEditorContributionInstantiation.BeforeFirstInteraction,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: SuggestController.ID,\n\t\t\t\t\tctor: SuggestController,\n\t\t\t\t\tinstantiation: EditorContributionInstantiation.Eager,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: SnippetController2.ID,\n\t\t\t\t\tctor: SnippetController2,\n\t\t\t\t\tinstantiation: EditorContributionInstantiation.Lazy,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tid: TabCompletionController.ID,\n\t\t\t\t\tctor: TabCompletionController,\n\t\t\t\t\tinstantiation: EditorContributionInstantiation.Eager,\n\t\t\t\t}, // eager because it needs to define a context key\n\t\t\t\t{\n\t\t\t\t\tid: EditorDictation.ID,\n\t\t\t\t\tctor: EditorDictation,\n\t\t\t\t\tinstantiation: EditorContributionInstantiation.Lazy,\n\t\t\t\t},\n\t\t\t\t...EditorExtensionsRegistry.getSomeEditorContributions([\n\t\t\t\t\tCopyPasteController.ID,\n\t\t\t\t\tDropIntoEditorController.ID,\n\t\t\t\t\tLinkDetector.ID,\n\t\t\t\t\tMessageController.ID,\n\t\t\t\t\tContentHoverController.ID,\n\t\t\t\t\tGlyphHoverController.ID,\n\t\t\t\t\tSelectionClipboardContributionID,\n\t\t\t\t\tInlineCompletionsController.ID,\n\t\t\t\t\tCodeActionController.ID,\n\t\t\t\t]),\n\t\t\t],\n\t\t\tcontextMenuId: MenuId.SimpleEditorContext,\n\t\t};\n\n\t\tsuper(\n\t\t\tdomElement,\n\t\t\toptions,\n\t\t\tcodeEditorWidgetOptions,\n\t\t\tinstantiationService,\n\t\t\tcodeEditorService,\n\t\t\tcommandService,\n\t\t\tscopedContextKeyService,\n\t\t\tthemeService,\n\t\t\tnotificationService,\n\t\t\taccessibilityService,\n\t\t\tlanguageConfigurationService,\n\t\t\tlanguageFeaturesService,\n\t\t);\n\n\t\tthis._commentEditorFocused = ctxCommentEditorFocused.bindTo(\n\t\t\tscopedContextKeyService,\n\t\t);\n\t\tthis._commentEditorEmpty = CommentContextKeys.commentIsEmpty.bindTo(\n\t\t\tscopedContextKeyService,\n\t\t);\n\t\tthis._commentEditorEmpty.set(!this.getModel()?.getValueLength());\n\t\tthis._parentThread = parentThread;\n\n\t\tthis._register(\n\t\t\tthis.onDidFocusEditorWidget((_) =>\n\t\t\t\tthis._commentEditorFocused.set(true),\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.onDidChangeModelContent((e) =>\n\t\t\t\tthis._commentEditorEmpty.set(\n\t\t\t\t\t!this.getModel()?.getValueLength(),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tthis.onDidBlurEditorWidget((_) =>\n\t\t\t\tthis._commentEditorFocused.reset(),\n\t\t\t),\n\t\t);\n\t}\n\n\tgetParentThread(): ICommentThreadWidget {\n\t\treturn this._parentThread;\n\t}\n\n\tprotected _getActions(): Iterable<EditorAction> {\n\t\treturn EditorExtensionsRegistry.getEditorActions();\n\t}\n\n\tpublic static getEditorOptions(\n\t\tconfigurationService: IConfigurationService,\n\t): IEditorOptions {\n\t\treturn {\n\t\t\twordWrap: \"on\",\n\t\t\tglyphMargin: false,\n\t\t\tlineNumbers: \"off\",\n\t\t\tfolding: false,\n\t\t\tselectOnLineNumbers: false,\n\t\t\tscrollbar: {\n\t\t\t\tvertical: \"visible\",\n\t\t\t\tverticalScrollbarSize: 14,\n\t\t\t\thorizontal: \"auto\",\n\t\t\t\tuseShadows: true,\n\t\t\t\tverticalHasArrows: false,\n\t\t\t\thorizontalHasArrows: false,\n\t\t\t\talwaysConsumeMouseWheel: false,\n\t\t\t},\n\t\t\toverviewRulerLanes: 2,\n\t\t\tlineDecorationsWidth: 0,\n\t\t\tscrollBeyondLastLine: false,\n\t\t\trenderLineHighlight: \"none\",\n\t\t\tfixedOverflowWidgets: true,\n\t\t\tacceptSuggestionOnEnter: \"smart\",\n\t\t\tminimap: {\n\t\t\t\tenabled: false,\n\t\t\t},\n\t\t\tdropIntoEditor: { enabled: true },\n\t\t\tautoClosingBrackets: configurationService.getValue(\n\t\t\t\t\"editor.autoClosingBrackets\",\n\t\t\t),\n\t\t\tquickSuggestions: false,\n\t\t\taccessibilitySupport: configurationService.getValue<\n\t\t\t\t\"auto\" | \"off\" | \"on\"\n\t\t\t>(\"editor.accessibilitySupport\"),\n\t\t\tfontFamily: configurationService.getValue(\"editor.fontFamily\"),\n\t\t};\n\t}\n}\n\nexport function calculateEditorHeight(\n\tparentEditor: LayoutableEditor,\n\teditor: ICodeEditor,\n\tcurrentHeight: number,\n): number {\n\tconst layoutInfo = editor.getLayoutInfo();\n\tconst lineHeight = editor.getOption(EditorOption.lineHeight);\n\tconst contentHeight = editor._getViewModel()?.getLineCount()! * lineHeight; // Can't just call getContentHeight() because it returns an incorrect, large, value when the editor is first created.\n\tif (\n\t\tcontentHeight > layoutInfo.height ||\n\t\t(contentHeight < layoutInfo.height && currentHeight > MIN_EDITOR_HEIGHT)\n\t) {\n\t\tconst linesToAdd = Math.ceil(\n\t\t\t(contentHeight - layoutInfo.height) / lineHeight,\n\t\t);\n\t\tconst proposedHeight = layoutInfo.height + lineHeight * linesToAdd;\n\t\treturn clamp(\n\t\t\tproposedHeight,\n\t\t\tMIN_EDITOR_HEIGHT,\n\t\t\tclamp(\n\t\t\t\tparentEditor.getLayoutInfo().height - 90,\n\t\t\t\tMIN_EDITOR_HEIGHT,\n\t\t\t\tMAX_EDITOR_HEIGHT,\n\t\t\t),\n\t\t);\n\t}\n\treturn currentHeight;\n}\n"],
  "mappings": "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",
  "names": []
}
