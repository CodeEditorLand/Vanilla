{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/replNotebook/browser/replEditorInput.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Codicon } from \"../../../../base/common/codicons.js\";\nimport type { IReference } from \"../../../../base/common/lifecycle.js\";\nimport type { ThemeIcon } from \"../../../../base/common/themables.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport {\n\ttype IResolvedTextEditorModel,\n\tITextModelService,\n} from \"../../../../editor/common/services/resolverService.js\";\nimport { ITextResourceConfigurationService } from \"../../../../editor/common/services/textResourceConfiguration.js\";\nimport { localize } from \"../../../../nls.js\";\nimport { IConfigurationService } from \"../../../../platform/configuration/common/configuration.js\";\nimport { IFileDialogService } from \"../../../../platform/dialogs/common/dialogs.js\";\nimport { IFileService } from \"../../../../platform/files/common/files.js\";\nimport { ILabelService } from \"../../../../platform/label/common/label.js\";\nimport { registerIcon } from \"../../../../platform/theme/common/iconRegistry.js\";\nimport { EditorInputCapabilities } from \"../../../common/editor.js\";\nimport { ICustomEditorLabelService } from \"../../../services/editor/common/customEditorLabelService.js\";\nimport { IEditorService } from \"../../../services/editor/common/editorService.js\";\nimport { IExtensionService } from \"../../../services/extensions/common/extensions.js\";\nimport { IFilesConfigurationService } from \"../../../services/filesConfiguration/common/filesConfigurationService.js\";\nimport { IInteractiveHistoryService } from \"../../interactive/browser/interactiveHistoryService.js\";\nimport type { NotebookTextModel } from \"../../notebook/common/model/notebookTextModel.js\";\nimport {\n\tCellEditType,\n\tCellKind,\n\tNotebookSetting,\n} from \"../../notebook/common/notebookCommon.js\";\nimport {\n\ttype ICompositeNotebookEditorInput,\n\tNotebookEditorInput,\n} from \"../../notebook/common/notebookEditorInput.js\";\nimport { INotebookEditorModelResolverService } from \"../../notebook/common/notebookEditorModelResolverService.js\";\nimport { INotebookService } from \"../../notebook/common/notebookService.js\";\n\nconst replTabIcon = registerIcon(\n\t\"repl-editor-label-icon\",\n\tCodicon.debugLineByLine,\n\tlocalize(\"replEditorLabelIcon\", \"Icon of the REPL editor label.\"),\n);\n\nexport class ReplEditorInput\n\textends NotebookEditorInput\n\timplements ICompositeNotebookEditorInput\n{\n\tstatic override ID = \"workbench.editorinputs.replEditorInput\";\n\n\tprivate inputModelRef: IReference<IResolvedTextEditorModel> | undefined;\n\tprivate isScratchpad: boolean;\n\tprivate label: string;\n\tprivate isDisposing = false;\n\n\tconstructor(\n\t\tresource: URI,\n\t\tlabel: string | undefined,\n\t\t@INotebookService _notebookService: INotebookService,\n\t\t@INotebookEditorModelResolverService\n\t\t_notebookModelResolverService: INotebookEditorModelResolverService,\n\t\t@IFileDialogService _fileDialogService: IFileDialogService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IFilesConfigurationService\n\t\tfilesConfigurationService: IFilesConfigurationService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@ITextResourceConfigurationService\n\t\ttextResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@ICustomEditorLabelService\n\t\tcustomEditorLabelService: ICustomEditorLabelService,\n\t\t@IInteractiveHistoryService\n\t\tpublic readonly historyService: IInteractiveHistoryService,\n\t\t@ITextModelService\n\t\tprivate readonly _textModelService: ITextModelService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t) {\n\t\tsuper(\n\t\t\tresource,\n\t\t\tundefined,\n\t\t\t\"jupyter-notebook\",\n\t\t\t{},\n\t\t\t_notebookService,\n\t\t\t_notebookModelResolverService,\n\t\t\t_fileDialogService,\n\t\t\tlabelService,\n\t\t\tfileService,\n\t\t\tfilesConfigurationService,\n\t\t\textensionService,\n\t\t\teditorService,\n\t\t\ttextResourceConfigurationService,\n\t\t\tcustomEditorLabelService,\n\t\t);\n\t\tthis.isScratchpad =\n\t\t\tresource.scheme === \"untitled\" &&\n\t\t\tconfigurationService.getValue<boolean>(\n\t\t\t\tNotebookSetting.InteractiveWindowPromptToSave,\n\t\t\t) !== true;\n\t\tthis.label = label ?? this.createEditorLabel(resource);\n\t}\n\n\toverride getIcon(): ThemeIcon | undefined {\n\t\treturn replTabIcon;\n\t}\n\n\tprivate createEditorLabel(resource: URI | undefined): string {\n\t\tif (!resource) {\n\t\t\treturn \"REPL\";\n\t\t}\n\n\t\tif (resource.scheme === \"untitled\") {\n\t\t\tconst match = /Untitled-(\\d+)\\./.exec(resource.path);\n\t\t\tif (match?.length === 2) {\n\t\t\t\treturn `REPL - ${match[1]}`;\n\t\t\t}\n\t\t}\n\n\t\tconst filename = resource.path.split(\"/\").pop();\n\t\treturn filename ? `REPL - ${filename}` : \"REPL\";\n\t}\n\n\toverride get typeId(): string {\n\t\treturn ReplEditorInput.ID;\n\t}\n\n\toverride get editorId(): string | undefined {\n\t\treturn \"repl\";\n\t}\n\n\toverride getName() {\n\t\treturn this.label;\n\t}\n\n\tget editorInputs() {\n\t\treturn [this];\n\t}\n\n\toverride get capabilities() {\n\t\tconst capabilities = super.capabilities;\n\t\tconst scratchPad = this.isScratchpad\n\t\t\t? EditorInputCapabilities.Scratchpad\n\t\t\t: 0;\n\n\t\treturn capabilities | EditorInputCapabilities.Readonly | scratchPad;\n\t}\n\n\toverride async resolve() {\n\t\tconst model = await super.resolve();\n\t\tif (model) {\n\t\t\tawait this.ensureInputBoxCell(model.notebook);\n\t\t}\n\n\t\treturn model;\n\t}\n\n\tprivate async ensureInputBoxCell(notebook: NotebookTextModel) {\n\t\tconst lastCell = notebook.cells[notebook.cells.length - 1];\n\n\t\tif (\n\t\t\t!lastCell ||\n\t\t\tlastCell.cellKind === CellKind.Markup ||\n\t\t\tlastCell.outputs.length > 0 ||\n\t\t\tlastCell.internalMetadata.executionOrder !== undefined\n\t\t) {\n\t\t\tnotebook.applyEdits(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\teditType: CellEditType.Replace,\n\t\t\t\t\t\tindex: notebook.cells.length,\n\t\t\t\t\t\tcount: 0,\n\t\t\t\t\t\tcells: [\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcellKind: CellKind.Code,\n\t\t\t\t\t\t\t\tlanguage: \"python\",\n\t\t\t\t\t\t\t\tmime: undefined,\n\t\t\t\t\t\t\t\toutputs: [],\n\t\t\t\t\t\t\t\tsource: \"\",\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttrue,\n\t\t\t\tundefined,\n\t\t\t\t() => undefined,\n\t\t\t\tundefined,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t}\n\t}\n\n\tasync resolveInput(notebook: NotebookTextModel) {\n\t\tif (this.inputModelRef) {\n\t\t\treturn this.inputModelRef.object.textEditorModel;\n\t\t}\n\t\tconst lastCell = notebook.cells[notebook.cells.length - 1];\n\t\tif (!lastCell) {\n\t\t\tthrow new Error(\n\t\t\t\t\"The REPL editor requires at least one cell for the input box.\",\n\t\t\t);\n\t\t}\n\n\t\tthis.inputModelRef = await this._textModelService.createModelReference(\n\t\t\tlastCell.uri,\n\t\t);\n\t\treturn this.inputModelRef.object.textEditorModel;\n\t}\n\n\toverride dispose() {\n\t\tif (!this.isDisposing) {\n\t\t\tthis.isDisposing = true;\n\t\t\tthis.editorModelReference?.object.revert({ soft: true });\n\t\t\tthis.inputModelRef?.dispose();\n\t\t\tsuper.dispose();\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
