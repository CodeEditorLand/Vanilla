var b=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var a=(d,o,e,t)=>{for(var r=t>1?void 0:t?x(o,e):o,l=d.length-1,s;l>=0;l--)(s=d[l])&&(r=(t?s(o,e,r):s(r))||r);return t&&r&&b(o,e,r),r},i=(d,o)=>(e,t)=>o(e,t,d);import"../../../../../vs/base/common/lifecycle.js";import"../../../../../vs/base/common/uri.js";import{ITextModelService as E}from"../../../../../vs/editor/common/services/resolverService.js";import{ITextResourceConfigurationService as M}from"../../../../../vs/editor/common/services/textResourceConfiguration.js";import{IConfigurationService as R}from"../../../../../vs/platform/configuration/common/configuration.js";import{IFileDialogService as C}from"../../../../../vs/platform/dialogs/common/dialogs.js";import{IFileService as y}from"../../../../../vs/platform/files/common/files.js";import{ILabelService as T}from"../../../../../vs/platform/label/common/label.js";import{EditorInputCapabilities as c}from"../../../../../vs/workbench/common/editor.js";import{IInteractiveHistoryService as N}from"../../../../../vs/workbench/contrib/interactive/browser/interactiveHistoryService.js";import"../../../../../vs/workbench/contrib/notebook/common/model/notebookTextModel.js";import{CellEditType as k,CellKind as p,NotebookSetting as L}from"../../../../../vs/workbench/contrib/notebook/common/notebookCommon.js";import{NotebookEditorInput as w}from"../../../../../vs/workbench/contrib/notebook/common/notebookEditorInput.js";import{INotebookEditorModelResolverService as D}from"../../../../../vs/workbench/contrib/notebook/common/notebookEditorModelResolverService.js";import{INotebookService as P}from"../../../../../vs/workbench/contrib/notebook/common/notebookService.js";import{ICustomEditorLabelService as F}from"../../../../../vs/workbench/services/editor/common/customEditorLabelService.js";import{IEditorService as j}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IExtensionService as U}from"../../../../../vs/workbench/services/extensions/common/extensions.js";import{IFilesConfigurationService as K}from"../../../../../vs/workbench/services/filesConfiguration/common/filesConfigurationService.js";let n=class extends w{constructor(e,t,r,l,s,u,f,v,m,I,h,S,B,H,g){super(e,void 0,"jupyter-notebook",{},r,l,s,u,f,v,m,I,h,S);this.historyService=B;this._textModelService=H;this.isScratchpad=e.scheme==="untitled"&&g.getValue(L.InteractiveWindowPromptToSave)!==!0,this.label=t??this.createEditorLabel(e)}static ID="workbench.editorinputs.replEditorInput";inputModelRef;isScratchpad;label;isDisposing=!1;createEditorLabel(e){if(!e)return"REPL";if(e.scheme==="untitled"){const r=new RegExp("Untitled-(\\d+).").exec(e.path);if(r?.length===2)return`REPL - ${r[1]}`}const t=e.path.split("/").pop();return t?`REPL - ${t}`:"REPL"}get typeId(){return n.ID}get editorId(){return"repl"}getName(){return this.label}get editorInputs(){return[this]}get capabilities(){const e=super.capabilities,t=this.isScratchpad?c.Scratchpad:0;return e|c.Readonly|t}async resolve(){const e=await super.resolve();return e&&await this.ensureInputBoxCell(e.notebook),e}async ensureInputBoxCell(e){const t=e.cells[e.cells.length-1];(!t||t.cellKind===p.Markup||t.outputs.length>0||t.internalMetadata.executionOrder!==void 0)&&e.applyEdits([{editType:k.Replace,index:e.cells.length,count:0,cells:[{cellKind:p.Code,language:"python",mime:void 0,outputs:[],source:""}]}],!0,void 0,()=>{},void 0,!1)}async resolveInput(e){if(this.inputModelRef)return this.inputModelRef.object.textEditorModel;const t=e.cells[e.cells.length-1];if(!t)throw new Error("The REPL editor requires at least one cell for the input box.");return this.inputModelRef=await this._textModelService.createModelReference(t.uri),this.inputModelRef.object.textEditorModel}dispose(){this.isDisposing||(this.isDisposing=!0,this.editorModelReference?.object.revert({soft:!0}),this.inputModelRef?.dispose(),super.dispose())}};n=a([i(2,P),i(3,D),i(4,C),i(5,T),i(6,y),i(7,K),i(8,U),i(9,j),i(10,M),i(11,F),i(12,N),i(13,E),i(14,R)],n);export{n as ReplEditorInput};
