import{Disposable as f}from"../../../../../vs/base/common/lifecycle.js";import*as u from"../../../../../vs/nls.js";import{ContextKeyExpr as a}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{Registry as b}from"../../../../../vs/platform/registry/common/platform.js";import"../../../../../vs/workbench/common/contributions.js";import{Extensions as g}from"../../../../../vs/workbench/common/views.js";import{isProposedApiEnabled as V}from"../../../../../vs/workbench/services/extensions/common/extensions.js";import"../../../../../vs/workbench/services/extensions/common/extensionsRegistry.js";import{ViewIdentifierMap as W}from"./viewsWelcomeExtensionPoint.js";const x=b.as(g.ViewsRegistry);class G extends f{viewWelcomeContents=new Map;constructor(n){super(),n.setHandler((t,{added:s,removed:r})=>{for(const i of r)for(const e of i.value)this.viewWelcomeContents.get(e)?.dispose();const l=new Map;for(const i of s)for(const e of i.value){const{group:p,order:d}=I(e,i),m=a.deserialize(e.enablement),w=W[e.view]??e.view;let c=l.get(w);c||(c=new Map,l.set(w,c)),c.set(e,{content:e.contents,when:a.deserialize(e.when),precondition:m,group:p,order:d})}for(const[i,e]of l){const p=x.registerViewWelcomeContent2(i,e);for(const[d,m]of p)this.viewWelcomeContents.set(d,m)}})}}function I(o,n){let t,s;if(o.group){if(!V(n.description,"contribViewsWelcome"))return n.collector.warn(u.localize("ViewsWelcomeExtensionPoint.proposedAPI",`The viewsWelcome contribution in '{0}' requires 'enabledApiProposals: ["contribViewsWelcome"]' in order to use the 'group' proposed property.`,n.description.identifier.value)),{group:t,order:s};const r=o.group.lastIndexOf("@");r>0?(t=o.group.substr(0,r),s=Number(o.group.substr(r+1))||void 0):t=o.group}return{group:t,order:s}}export{G as ViewsWelcomeContribution};
