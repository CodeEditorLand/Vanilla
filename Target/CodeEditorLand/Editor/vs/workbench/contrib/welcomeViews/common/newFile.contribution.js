var C=Object.defineProperty;var F=Object.getOwnPropertyDescriptor;var y=(p,u,i,s)=>{for(var n=s>1?void 0:s?F(u,i):u,r=p.length-1,e;r>=0;r--)(e=p[r])&&(n=(s?e(u,i,n):e(n))||n);return s&&n&&C(u,i,n),n},d=(p,u)=>(i,s)=>u(i,s,p);import{promiseWithResolvers as N}from"../../../../../vs/base/common/async.js";import{KeyCode as D,KeyMod as h}from"../../../../../vs/base/common/keyCodes.js";import{Disposable as P,DisposableStore as x}from"../../../../../vs/base/common/lifecycle.js";import{assertIsDefined as E}from"../../../../../vs/base/common/types.js";import{localize as a,localize2 as k}from"../../../../../vs/nls.js";import"../../../../../vs/platform/action/common/action.js";import{Action2 as K,IMenuService as A,MenuId as b,MenuItemAction as Q,MenuRegistry as W,registerAction2 as R}from"../../../../../vs/platform/actions/common/actions.js";import{ICommandService as M}from"../../../../../vs/platform/commands/common/commands.js";import{IContextKeyService as z}from"../../../../../vs/platform/contextkey/common/contextkey.js";import"../../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as B}from"../../../../../vs/platform/keybinding/common/keybinding.js";import{KeybindingWeight as L}from"../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import{IQuickInputService as q}from"../../../../../vs/platform/quickinput/common/quickInput.js";import{Registry as O}from"../../../../../vs/platform/registry/common/platform.js";import{Extensions as T}from"../../../../../vs/workbench/common/contributions.js";import{LifecyclePhase as U}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";const I=a("Built-In","Built-In"),G=k("Create","Create");R(class extends K{constructor(){super({id:"welcome.showNewFileEntries",title:k("welcome.newFile","New File..."),category:G,f1:!0,keybinding:{primary:h.Alt+h.CtrlCmd+h.WinCtrl+D.KeyN,weight:L.WorkbenchContrib},menu:{id:b.MenubarFileMenu,group:"1_new",order:2}})}async run(p){return E(l.Instance).run()}});let l=class extends P{constructor(i,s,n,r,e){super();this.quickInputService=i;this.contextKeyService=s;this.commandService=n;this.keybindingService=r;l.Instance=this,this._register({dispose(){l.Instance===this&&(l.Instance=void 0)}}),this.menu=e.createMenu(b.NewFile,s)}static Instance;menu;allEntries(){const i=[];for(const[s,n]of this.menu.getActions({renderShortTitle:!0}))for(const r of n)r instanceof Q&&i.push({commandID:r.item.id,from:r.item.source?.title??I,title:r.label,group:s});return i}async run(){const i=this.allEntries();if(i.length===0)throw Error("Unexpected empty new items list");return i.length===1?(this.commandService.executeCommand(i[0].commandID),!0):this.selectNewEntry(i)}async selectNewEntry(i){const{promise:s,resolve:n}=N(),r=new x,e=this.quickInputService.createQuickPick({useSeparators:!0});e.title=a("newFileTitle","New File..."),e.placeholder=a("newFilePlaceholder","Select File Type or Enter File Name..."),e.sortByLabel=!1,e.matchOnDetail=!0,e.matchOnDescription=!0;const w=(o,t)=>{const c={file:1,notebook:2};if(c[o.group]&&c[t.group]){if(c[o.group]!==c[t.group])return c[t.group]-c[o.group]}else{if(c[o.group])return 1;if(c[t.group])return-1}return o.from===I?1:t.from===I?-1:o.from.localeCompare(t.from)},S={file:a("file","File"),notebook:a("notebook","Notebook")},f=o=>{const t=[];let c;o.sort((m,g)=>-w(m,g)).forEach(m=>{const g=m.commandID,v=this.keybindingService.lookupKeybinding(g||"",this.contextKeyService);c!==m.group&&(t.push({type:"separator",label:S[m.group]??m.group}),c=m.group),t.push({...m,label:m.title,type:"item",keybinding:v,buttons:g?[{iconClass:"codicon codicon-gear",tooltip:a("change keybinding","Configure Keybinding")}]:[],detail:"",description:m.from})}),e.items=t};return f(i),r.add(this.menu.onDidChange(()=>f(this.allEntries()))),r.add(e.onDidChangeValue(o=>{if(o===""){f(i);return}const t={commandID:"workbench.action.files.newFile",commandArgs:{languageId:void 0,viewType:void 0,fileName:o},title:a("miNewFileWithName","Create New File ({0})",o),group:"file",from:I};f([t,...i])})),r.add(e.onDidAccept(async o=>{const t=e.selectedItems[0];n(!!t),e.hide(),t&&await this.commandService.executeCommand(t.commandID,t.commandArgs)})),r.add(e.onDidHide(()=>{e.dispose(),r.dispose(),n(!1)})),r.add(e.onDidTriggerItemButton(o=>{e.hide(),this.commandService.executeCommand("workbench.action.openGlobalKeybindings",o.item.commandID),n(!1)})),e.show(),s}};l=y([d(0,q),d(1,z),d(2,M),d(3,B),d(4,A)],l),O.as(T.Workbench).registerWorkbenchContribution(l,U.Restored),W.appendMenuItem(b.NewFile,{group:"file",command:{id:"workbench.action.files.newUntitledFile",title:a("miNewFile2","Text File")},order:1});
