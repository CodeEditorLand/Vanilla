import"./media/welcomeWidget.css";import{$ as l,append as b,hide as v}from"../../../../base/browser/dom.js";import{renderFormattedText as C}from"../../../../base/browser/formattedTextRenderer.js";import{ActionBar as y}from"../../../../base/browser/ui/actionbar/actionbar.js";import{ButtonBar as k}from"../../../../base/browser/ui/button/button.js";import{renderLabelWithIcons as W}from"../../../../base/browser/ui/iconLabel/iconLabels.js";import{Action as x}from"../../../../base/common/actions.js";import{Codicon as E}from"../../../../base/common/codicons.js";import"../../../../base/common/color.js";import{MarkdownString as _}from"../../../../base/common/htmlContent.js";import{mnemonicButtonLabel as S}from"../../../../base/common/labels.js";import{Disposable as I}from"../../../../base/common/lifecycle.js";import{parseLinkedText as A}from"../../../../base/common/linkedText.js";import{ThemeIcon as B}from"../../../../base/common/themables.js";import{OverlayWidgetPositionPreference as T}from"../../../../editor/browser/editorBrowser.js";import{MarkdownRenderer as D}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{localize as L}from"../../../../nls.js";import"../../../../platform/commands/common/commands.js";import"../../../../platform/instantiation/common/instantiation.js";import{Link as R}from"../../../../platform/opener/browser/link.js";import"../../../../platform/opener/common/opener.js";import"../../../../platform/telemetry/common/telemetry.js";import{defaultButtonStyles as M}from"../../../../platform/theme/browser/defaultStyles.js";import{contrastBorder as N,editorWidgetBackground as O,editorWidgetForeground as $,widgetBorder as H,widgetShadow as P}from"../../../../platform/theme/common/colorRegistry.js";import{registerThemingParticipant as V}from"../../../../platform/theme/common/themeService.js";class Ee extends I{constructor(t,o,i,e,r){super();this._editor=t;this.instantiationService=o;this.commandService=i;this.telemetryService=e;this.openerService=r;this._rootDomNode=document.createElement("div"),this._rootDomNode.className="welcome-widget",this.element=this._rootDomNode.appendChild(l(".monaco-dialog-box")),this.element.setAttribute("role","dialog"),v(this._rootDomNode),this.messageContainer=this.element.appendChild(l(".dialog-message-container"))}_rootDomNode;element;messageContainer;markdownRenderer=this.instantiationService.createInstance(D,{});async executeCommand(t,...o){try{await this.commandService.executeCommand(t,...o),this.telemetryService.publicLog2("workbenchActionExecuted",{id:t,from:"welcomeWidget"})}catch{}}async render(t,o,i,e){this._editor._getViewModel()&&(await this.buildWidgetContent(t,o,i,e),this._editor.addOverlayWidget(this),this._show(),this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidgetRendered",from:"welcomeWidget"}))}async buildWidgetContent(t,o,i,e){const r=this._register(new y(this.element,{})),d=this._register(new x("dialog.close",L("dialogClose","Close Dialog"),B.asClassName(E.dialogClose),!0,async()=>{this._hide()}));r.push(d,{icon:!0,label:!1});const n=(c,w)=>{const p=new _(void 0,{supportThemeIcons:!0,supportHtml:!0});return p.appendMarkdown(`<a class="copilot">$(${w})</a>`),p.appendMarkdown(c),p},m=this.messageContainer.appendChild(l("#monaco-dialog-message-detail.dialog-message-detail-title")),h=this.markdownRenderer.render(n(t,"zap"));m.appendChild(h.element),this.buildStepMarkdownDescription(this.messageContainer,o.split(`
`).filter(c=>c).map(c=>A(c)));const f=this.messageContainer.appendChild(l(".dialog-buttons-row")).appendChild(l(".dialog-buttons")),g=this._register(new k(f)),u=this._register(g.addButtonWithDescription({title:!0,secondary:!1,...M}));u.label=S(i,!0),this._register(u.onDidClick(async()=>{await this.executeCommand(e)})),g.buttons[0].focus()}buildStepMarkdownDescription(t,o){for(const i of o){const e=b(t,l("p"));for(const r of i.nodes)if(typeof r=="string"){const d=W(r);for(const n of d)typeof n=="string"?e.appendChild(C(n,{inline:!0,renderCodeSegments:!0})):e.appendChild(n)}else{const d=this.instantiationService.createInstance(R,e,r,{opener:n=>{this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidetLinkAction",from:"welcomeWidget"}),this.openerService.open(n,{allowCommands:!0})}});this._register(d)}}return t}getId(){return"editor.contrib.welcomeWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:T.TOP_RIGHT_CORNER}}_isVisible=!1;_show(){this._isVisible||(this._isVisible=!0,this._rootDomNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!0,this._rootDomNode.style.display="none",this._editor.removeOverlayWidget(this),this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidgetDismissed",from:"welcomeWidget"}))}}V((s,a)=>{const t=(n,m)=>{m&&a.addRule(`.monaco-editor ${n} { background-color: ${m}; }`)},o=s.getColor(O);t(".welcome-widget",o);const i=s.getColor(P);i&&a.addRule(`.welcome-widget { box-shadow: 0 0 8px 2px ${i}; }`);const e=s.getColor(H);e&&a.addRule(`.welcome-widget { border-left: 1px solid ${e}; border-right: 1px solid ${e}; border-bottom: 1px solid ${e}; }`);const r=s.getColor(N);r&&a.addRule(`.welcome-widget { border: 1px solid ${r}; }`);const d=s.getColor($);d&&a.addRule(`.welcome-widget { color: ${d}; }`)});export{Ee as WelcomeWidget};
