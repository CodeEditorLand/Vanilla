import"./media/welcomeWidget.css";import{Disposable as b}from"../../../../base/common/lifecycle.js";import{OverlayWidgetPositionPreference as v}from"../../../../editor/browser/editorBrowser.js";import{$ as l,append as C,hide as y}from"../../../../base/browser/dom.js";import{MarkdownString as k}from"../../../../base/common/htmlContent.js";import{MarkdownRenderer as W}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import"../../../../platform/instantiation/common/instantiation.js";import{ButtonBar as x}from"../../../../base/browser/ui/button/button.js";import{mnemonicButtonLabel as E}from"../../../../base/common/labels.js";import"../../../../platform/commands/common/commands.js";import{defaultButtonStyles as _}from"../../../../platform/theme/browser/defaultStyles.js";import"../../../../platform/telemetry/common/telemetry.js";import{Action as S}from"../../../../base/common/actions.js";import{ActionBar as I}from"../../../../base/browser/ui/actionbar/actionbar.js";import{localize as A}from"../../../../nls.js";import{ThemeIcon as B}from"../../../../base/common/themables.js";import{Codicon as T}from"../../../../base/common/codicons.js";import{parseLinkedText as D}from"../../../../base/common/linkedText.js";import{Link as L}from"../../../../platform/opener/browser/link.js";import{renderLabelWithIcons as R}from"../../../../base/browser/ui/iconLabel/iconLabels.js";import{renderFormattedText as M}from"../../../../base/browser/formattedTextRenderer.js";import"../../../../platform/opener/common/opener.js";import{registerThemingParticipant as N}from"../../../../platform/theme/common/themeService.js";import"../../../../base/common/color.js";import{contrastBorder as O,editorWidgetBackground as $,editorWidgetForeground as H,widgetBorder as P,widgetShadow as V}from"../../../../platform/theme/common/colorRegistry.js";class Ee extends b{constructor(t,o,i,e,r){super();this._editor=t;this.instantiationService=o;this.commandService=i;this.telemetryService=e;this.openerService=r;this._rootDomNode=document.createElement("div"),this._rootDomNode.className="welcome-widget",this.element=this._rootDomNode.appendChild(l(".monaco-dialog-box")),this.element.setAttribute("role","dialog"),y(this._rootDomNode),this.messageContainer=this.element.appendChild(l(".dialog-message-container"))}_rootDomNode;element;messageContainer;markdownRenderer=this.instantiationService.createInstance(W,{});async executeCommand(t,...o){try{await this.commandService.executeCommand(t,...o),this.telemetryService.publicLog2("workbenchActionExecuted",{id:t,from:"welcomeWidget"})}catch{}}async render(t,o,i,e){this._editor._getViewModel()&&(await this.buildWidgetContent(t,o,i,e),this._editor.addOverlayWidget(this),this._show(),this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidgetRendered",from:"welcomeWidget"}))}async buildWidgetContent(t,o,i,e){const r=this._register(new I(this.element,{})),d=this._register(new S("dialog.close",A("dialogClose","Close Dialog"),B.asClassName(T.dialogClose),!0,async()=>{this._hide()}));r.push(d,{icon:!0,label:!1});const n=(c,w)=>{const p=new k(void 0,{supportThemeIcons:!0,supportHtml:!0});return p.appendMarkdown(`<a class="copilot">$(${w})</a>`),p.appendMarkdown(c),p},m=this.messageContainer.appendChild(l("#monaco-dialog-message-detail.dialog-message-detail-title")),h=this.markdownRenderer.render(n(t,"zap"));m.appendChild(h.element),this.buildStepMarkdownDescription(this.messageContainer,o.split(`
`).filter(c=>c).map(c=>D(c)));const f=this.messageContainer.appendChild(l(".dialog-buttons-row")).appendChild(l(".dialog-buttons")),g=this._register(new x(f)),u=this._register(g.addButtonWithDescription({title:!0,secondary:!1,..._}));u.label=E(i,!0),this._register(u.onDidClick(async()=>{await this.executeCommand(e)})),g.buttons[0].focus()}buildStepMarkdownDescription(t,o){for(const i of o){const e=C(t,l("p"));for(const r of i.nodes)if(typeof r=="string"){const d=R(r);for(const n of d)typeof n=="string"?e.appendChild(M(n,{inline:!0,renderCodeSegments:!0})):e.appendChild(n)}else{const d=this.instantiationService.createInstance(L,e,r,{opener:n=>{this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidetLinkAction",from:"welcomeWidget"}),this.openerService.open(n,{allowCommands:!0})}});this._register(d)}}return t}getId(){return"editor.contrib.welcomeWidget"}getDomNode(){return this._rootDomNode}getPosition(){return{preference:v.TOP_RIGHT_CORNER}}_isVisible=!1;_show(){this._isVisible||(this._isVisible=!0,this._rootDomNode.style.display="block")}_hide(){this._isVisible&&(this._isVisible=!0,this._rootDomNode.style.display="none",this._editor.removeOverlayWidget(this),this.telemetryService.publicLog2("workbenchActionExecuted",{id:"welcomeWidgetDismissed",from:"welcomeWidget"}))}}N((s,a)=>{const t=(n,m)=>{m&&a.addRule(`.monaco-editor ${n} { background-color: ${m}; }`)},o=s.getColor($);t(".welcome-widget",o);const i=s.getColor(V);i&&a.addRule(`.welcome-widget { box-shadow: 0 0 8px 2px ${i}; }`);const e=s.getColor(P);e&&a.addRule(`.welcome-widget { border-left: 1px solid ${e}; border-right: 1px solid ${e}; border-bottom: 1px solid ${e}; }`);const r=s.getColor(O);r&&a.addRule(`.welcome-widget { border: 1px solid ${r}; }`);const d=s.getColor(H);d&&a.addRule(`.welcome-widget { color: ${d}; }`)});export{Ee as WelcomeWidget};
