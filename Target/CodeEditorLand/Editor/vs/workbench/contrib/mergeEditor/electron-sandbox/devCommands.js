import{VSBuffer as w}from"../../../../base/common/buffer.js";import{Codicon as M}from"../../../../base/common/codicons.js";import{randomPath as P}from"../../../../base/common/extpath.js";import{URI as o}from"../../../../base/common/uri.js";import{ILanguageService as j}from"../../../../editor/common/languages/language.js";import{localize as A,localize2 as I}from"../../../../nls.js";import"../../../../platform/action/common/action.js";import{Action2 as R}from"../../../../platform/actions/common/actions.js";import{IClipboardService as T}from"../../../../platform/clipboard/common/clipboardService.js";import{INativeEnvironmentService as x}from"../../../../platform/environment/common/environment.js";import{IFileService as J}from"../../../../platform/files/common/files.js";import"../../../../platform/instantiation/common/instantiation.js";import{IQuickInputService as N}from"../../../../platform/quickinput/common/quickInput.js";import"../../../common/editor.js";import{IEditorService as O}from"../../../services/editor/common/editorService.js";import{MergeEditor as B}from"../browser/view/mergeEditor.js";import"../browser/view/viewModel.js";import"../common/mergeEditor.js";const b=I("mergeEditor","Merge Editor (Dev)");class U extends R{constructor(){super({id:"merge.dev.openContentsJson",category:b,title:I("merge.dev.openState","Open Merge Editor State from JSON"),icon:M.layoutCentered,f1:!0})}async run(e,r){const t=e.get(N),p=e.get(T),d=e.get(O),m=e.get(j),g=e.get(x),i=e.get(J);r||(r={});let n;if(r.data)n=r.data;else{const c=await t.input({prompt:A("mergeEditor.enterJSON","Enter JSON"),value:await p.readText()});if(c===void 0)return;n=c!==""?JSON.parse(c):{base:"",input1:"",input2:"",result:"",languageId:"plaintext"}}const a=o.joinPath(g.tmpDir,P()),s=m.getExtensions(n.languageId)[0]||"",f=o.joinPath(a,`/base${s}`),S=o.joinPath(a,`/input1${s}`),E=o.joinPath(a,`/input2${s}`),v=o.joinPath(a,`/result${s}`),V=o.joinPath(a,`/initialResult${s}`);async function u(c,h){await i.writeFile(c,w.fromString(h))}const y=await k(t,r.resultState);await Promise.all([u(f,n.base),u(S,n.input1),u(E,n.input2),u(v,y?n.initialResult||"":n.result),u(V,n.initialResult||"")]);const C={base:{resource:f},input1:{resource:S,label:"Input 1",description:"Input 1",detail:"(from JSON)"},input2:{resource:E,label:"Input 2",description:"Input 2",detail:"(from JSON)"},result:{resource:v}};d.openEditor(C)}}async function k(l,e){return e?e==="initial":(await l.pick([{label:"result",result:!1},{label:"initial result",result:!0}],{canPickMany:!1}))?.result}class $ extends R{constructor(e){super(e)}run(e){const{activeEditorPane:r}=e.get(O);if(r instanceof B){const t=r.viewModel.get();if(!t)return;this.runWithViewModel(t,e)}}}class le extends ${constructor(){super({id:"merge.dev.openSelectionInTemporaryMergeEditor",category:b,title:I("merge.dev.openSelectionInTemporaryMergeEditor","Open Selection In Temporary Merge Editor"),icon:M.layoutCentered,f1:!0})}async runWithViewModel(e,r){const t=e.selectionInBase.get()?.rangesInBase;if(!t||t.length===0)return;const p=t.map(i=>e.model.base.getValueInRange(i)).join(`
`),d=t.map(i=>e.inputCodeEditorView1.editor.getModel().getValueInRange(e.model.translateBaseRangeToInput(1,i))).join(`
`),m=t.map(i=>e.inputCodeEditorView2.editor.getModel().getValueInRange(e.model.translateBaseRangeToInput(2,i))).join(`
`),g=t.map(i=>e.resultCodeEditorView.editor.getModel().getValueInRange(e.model.translateBaseRangeToResult(i))).join(`
`);new U().run(r,{data:{base:p,input1:d,input2:m,result:g,languageId:e.resultCodeEditorView.editor.getModel().getLanguageId()}})}}export{U as MergeEditorOpenContentsFromJSON,le as OpenSelectionInTemporaryMergeEditor};
