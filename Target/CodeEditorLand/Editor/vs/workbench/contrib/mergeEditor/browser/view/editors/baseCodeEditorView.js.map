{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/mergeEditor/browser/view/editors/baseCodeEditorView.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h, reset } from \"../../../../../../base/browser/dom.js\";\nimport { renderLabelWithIcons } from \"../../../../../../base/browser/ui/iconLabel/iconLabels.js\";\nimport { BugIndicatingError } from \"../../../../../../base/common/errors.js\";\nimport {\n\ttype IObservable,\n\tautorun,\n\tautorunWithStore,\n\tderived,\n} from \"../../../../../../base/common/observable.js\";\nimport {\n\ttype IModelDeltaDecoration,\n\tMinimapPosition,\n\tOverviewRulerLane,\n} from \"../../../../../../editor/common/model.js\";\nimport { localize } from \"../../../../../../nls.js\";\nimport { MenuId } from \"../../../../../../platform/actions/common/actions.js\";\nimport { IConfigurationService } from \"../../../../../../platform/configuration/common/configuration.js\";\nimport { IInstantiationService } from \"../../../../../../platform/instantiation/common/instantiation.js\";\nimport { applyObservableDecorations } from \"../../utils.js\";\nimport {\n\thandledConflictMinimapOverViewRulerColor,\n\tunhandledConflictMinimapOverViewRulerColor,\n} from \"../colors.js\";\nimport { EditorGutter } from \"../editorGutter.js\";\nimport type { MergeEditorViewModel } from \"../viewModel.js\";\nimport {\n\tCodeEditorView,\n\tTitleMenu,\n\tcreateSelectionsAutorun,\n} from \"./codeEditorView.js\";\n\nexport class BaseCodeEditorView extends CodeEditorView {\n\tconstructor(\n\t\tviewModel: IObservable<MergeEditorViewModel | undefined>,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t) {\n\t\tsuper(instantiationService, viewModel, configurationService);\n\n\t\tthis._register(\n\t\t\tcreateSelectionsAutorun(this, (baseRange, viewModel) => baseRange),\n\t\t);\n\n\t\tthis._register(\n\t\t\tinstantiationService.createInstance(\n\t\t\t\tTitleMenu,\n\t\t\t\tMenuId.MergeBaseToolbar,\n\t\t\t\tthis.htmlElements.title,\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorunWithStore((reader, store) => {\n\t\t\t\t/** @description update checkboxes */\n\t\t\t\tif (this.checkboxesVisible.read(reader)) {\n\t\t\t\t\tstore.add(\n\t\t\t\t\t\tnew EditorGutter(\n\t\t\t\t\t\t\tthis.editor,\n\t\t\t\t\t\t\tthis.htmlElements.gutterDiv,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tgetIntersectingGutterItems: (\n\t\t\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\t\t\treader,\n\t\t\t\t\t\t\t\t) => [],\n\t\t\t\t\t\t\t\tcreateView: (item, target) => {\n\t\t\t\t\t\t\t\t\tthrow new BugIndicatingError();\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorun((reader) => {\n\t\t\t\t/** @description update labels & text model */\n\t\t\t\tconst vm = this.viewModel.read(reader);\n\t\t\t\tif (!vm) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis.editor.setModel(vm.model.base);\n\t\t\t\treset(\n\t\t\t\t\tthis.htmlElements.title,\n\t\t\t\t\t...renderLabelWithIcons(localize(\"base\", \"Base\")),\n\t\t\t\t);\n\n\t\t\t\tconst baseShowDiffAgainst = vm.baseShowDiffAgainst.read(reader);\n\n\t\t\t\tlet node: Node | undefined;\n\t\t\t\tif (baseShowDiffAgainst) {\n\t\t\t\t\tconst label = localize(\n\t\t\t\t\t\t\"compareWith\",\n\t\t\t\t\t\t\"Comparing with {0}\",\n\t\t\t\t\t\tbaseShowDiffAgainst === 1\n\t\t\t\t\t\t\t? vm.model.input1.title\n\t\t\t\t\t\t\t: vm.model.input2.title,\n\t\t\t\t\t);\n\t\t\t\t\tconst tooltip = localize(\n\t\t\t\t\t\t\"compareWithTooltip\",\n\t\t\t\t\t\t\"Differences are highlighted with a background color.\",\n\t\t\t\t\t);\n\t\t\t\t\tnode = h(\"span\", { title: tooltip }, [label]).root;\n\t\t\t\t}\n\t\t\t\treset(this.htmlElements.description, ...(node ? [node] : []));\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tapplyObservableDecorations(this.editor, this.decorations),\n\t\t);\n\t}\n\n\tprivate readonly decorations = derived(this, (reader) => {\n\t\tconst viewModel = this.viewModel.read(reader);\n\t\tif (!viewModel) {\n\t\t\treturn [];\n\t\t}\n\t\tconst model = viewModel.model;\n\t\tconst textModel = model.base;\n\n\t\tconst activeModifiedBaseRange =\n\t\t\tviewModel.activeModifiedBaseRange.read(reader);\n\t\tconst showNonConflictingChanges =\n\t\t\tviewModel.showNonConflictingChanges.read(reader);\n\t\tconst showDeletionMarkers = this.showDeletionMarkers.read(reader);\n\n\t\tconst result: IModelDeltaDecoration[] = [];\n\t\tfor (const modifiedBaseRange of model.modifiedBaseRanges.read(reader)) {\n\t\t\tconst range = modifiedBaseRange.baseRange;\n\t\t\tif (!range) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst isHandled = model.isHandled(modifiedBaseRange).read(reader);\n\t\t\tif (\n\t\t\t\t!modifiedBaseRange.isConflicting &&\n\t\t\t\tisHandled &&\n\t\t\t\t!showNonConflictingChanges\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst blockClassNames = [\"merge-editor-block\"];\n\t\t\tlet blockPadding: [\n\t\t\t\ttop: number,\n\t\t\t\tright: number,\n\t\t\t\tbottom: number,\n\t\t\t\tleft: number,\n\t\t\t] = [0, 0, 0, 0];\n\t\t\tif (isHandled) {\n\t\t\t\tblockClassNames.push(\"handled\");\n\t\t\t}\n\t\t\tif (modifiedBaseRange === activeModifiedBaseRange) {\n\t\t\t\tblockClassNames.push(\"focused\");\n\t\t\t\tblockPadding = [0, 2, 0, 2];\n\t\t\t}\n\t\t\tblockClassNames.push(\"base\");\n\n\t\t\tconst inputToDiffAgainst =\n\t\t\t\tviewModel.baseShowDiffAgainst.read(reader);\n\n\t\t\tif (inputToDiffAgainst) {\n\t\t\t\tfor (const diff of modifiedBaseRange.getInputDiffs(\n\t\t\t\t\tinputToDiffAgainst,\n\t\t\t\t)) {\n\t\t\t\t\tconst range = diff.inputRange.toInclusiveRange();\n\t\t\t\t\tif (range) {\n\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\tclassName: `merge-editor-diff base`,\n\t\t\t\t\t\t\t\tdescription: \"Merge Editor\",\n\t\t\t\t\t\t\t\tisWholeLine: true,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\tfor (const diff2 of diff.rangeMappings) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tshowDeletionMarkers ||\n\t\t\t\t\t\t\t!diff2.inputRange.isEmpty()\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tresult.push({\n\t\t\t\t\t\t\t\trange: diff2.inputRange,\n\t\t\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\t\t\tclassName: diff2.inputRange.isEmpty()\n\t\t\t\t\t\t\t\t\t\t? `merge-editor-diff-empty-word base`\n\t\t\t\t\t\t\t\t\t\t: `merge-editor-diff-word base`,\n\t\t\t\t\t\t\t\t\tdescription: \"Merge Editor\",\n\t\t\t\t\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tresult.push({\n\t\t\t\trange: range.toInclusiveRangeOrEmpty(),\n\t\t\t\toptions: {\n\t\t\t\t\tshowIfCollapsed: true,\n\t\t\t\t\tblockClassName: blockClassNames.join(\" \"),\n\t\t\t\t\tblockPadding,\n\t\t\t\t\tblockIsAfterEnd:\n\t\t\t\t\t\trange.startLineNumber > textModel.getLineCount(),\n\t\t\t\t\tdescription: \"Merge Editor\",\n\t\t\t\t\tminimap: {\n\t\t\t\t\t\tposition: MinimapPosition.Gutter,\n\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\tid: isHandled\n\t\t\t\t\t\t\t\t? handledConflictMinimapOverViewRulerColor\n\t\t\t\t\t\t\t\t: unhandledConflictMinimapOverViewRulerColor,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t\toverviewRuler: modifiedBaseRange.isConflicting\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tposition: OverviewRulerLane.Center,\n\t\t\t\t\t\t\t\tcolor: {\n\t\t\t\t\t\t\t\t\tid: isHandled\n\t\t\t\t\t\t\t\t\t\t? handledConflictMinimapOverViewRulerColor\n\t\t\t\t\t\t\t\t\t\t: unhandledConflictMinimapOverViewRulerColor,\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t\treturn result;\n\t});\n}\n"],
  "mappings": "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",
  "names": ["viewModel", "reader", "range"]
}
