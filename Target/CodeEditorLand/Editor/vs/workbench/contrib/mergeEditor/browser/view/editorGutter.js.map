{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/mergeEditor/browser/view/editorGutter.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { h, reset } from \"../../../../../base/browser/dom.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport {\n\ttype IReader,\n\tautorun,\n\tobservableFromEvent,\n\tobservableSignal,\n\tobservableSignalFromEvent,\n\ttransaction,\n} from \"../../../../../base/common/observable.js\";\nimport type { CodeEditorWidget } from \"../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js\";\nimport { LineRange } from \"../model/lineRange.js\";\n\nexport class EditorGutter<\n\tT extends IGutterItemInfo = IGutterItemInfo,\n> extends Disposable {\n\tprivate readonly scrollTop = observableFromEvent(\n\t\tthis,\n\t\tthis._editor.onDidScrollChange,\n\t\t(e) =>\n\t\t\t/** @description editor.onDidScrollChange */ this._editor.getScrollTop(),\n\t);\n\tprivate readonly isScrollTopZero = this.scrollTop.map(\n\t\t(scrollTop) => /** @description isScrollTopZero */ scrollTop === 0,\n\t);\n\tprivate readonly modelAttached = observableFromEvent(\n\t\tthis,\n\t\tthis._editor.onDidChangeModel,\n\t\t(e) =>\n\t\t\t/** @description editor.onDidChangeModel */ this._editor.hasModel(),\n\t);\n\n\tprivate readonly editorOnDidChangeViewZones = observableSignalFromEvent(\n\t\t\"onDidChangeViewZones\",\n\t\tthis._editor.onDidChangeViewZones,\n\t);\n\tprivate readonly editorOnDidContentSizeChange = observableSignalFromEvent(\n\t\t\"onDidContentSizeChange\",\n\t\tthis._editor.onDidContentSizeChange,\n\t);\n\tprivate readonly domNodeSizeChanged =\n\t\tobservableSignal(\"domNodeSizeChanged\");\n\n\tconstructor(\n\t\tprivate readonly _editor: CodeEditorWidget,\n\t\tprivate readonly _domNode: HTMLElement,\n\t\tprivate readonly itemProvider: IGutterItemProvider<T>,\n\t) {\n\t\tsuper();\n\t\tthis._domNode.className = \"gutter monaco-editor\";\n\t\tconst scrollDecoration = this._domNode.appendChild(\n\t\t\th(\"div.scroll-decoration\", {\n\t\t\t\trole: \"presentation\",\n\t\t\t\tariaHidden: \"true\",\n\t\t\t\tstyle: { width: \"100%\" },\n\t\t\t}).root,\n\t\t);\n\n\t\tconst o = new ResizeObserver(() => {\n\t\t\ttransaction((tx) => {\n\t\t\t\t/** @description ResizeObserver: size changed */\n\t\t\t\tthis.domNodeSizeChanged.trigger(tx);\n\t\t\t});\n\t\t});\n\t\to.observe(this._domNode);\n\t\tthis._register(toDisposable(() => o.disconnect()));\n\n\t\tthis._register(\n\t\t\tautorun((reader) => {\n\t\t\t\t/** @description update scroll decoration */\n\t\t\t\tscrollDecoration.className = this.isScrollTopZero.read(reader)\n\t\t\t\t\t? \"\"\n\t\t\t\t\t: \"scroll-decoration\";\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tautorun((reader) =>\n\t\t\t\t/** @description EditorGutter.Render */ this.render(reader),\n\t\t\t),\n\t\t);\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\n\t\treset(this._domNode);\n\t}\n\n\tprivate readonly views = new Map<string, ManagedGutterItemView>();\n\n\tprivate render(reader: IReader): void {\n\t\tif (!this.modelAttached.read(reader)) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.domNodeSizeChanged.read(reader);\n\t\tthis.editorOnDidChangeViewZones.read(reader);\n\t\tthis.editorOnDidContentSizeChange.read(reader);\n\n\t\tconst scrollTop = this.scrollTop.read(reader);\n\n\t\tconst visibleRanges = this._editor.getVisibleRanges();\n\t\tconst unusedIds = new Set(this.views.keys());\n\n\t\tif (visibleRanges.length > 0) {\n\t\t\tconst visibleRange = visibleRanges[0];\n\n\t\t\tconst visibleRange2 = new LineRange(\n\t\t\t\tvisibleRange.startLineNumber,\n\t\t\t\tvisibleRange.endLineNumber - visibleRange.startLineNumber,\n\t\t\t).deltaEnd(1);\n\n\t\t\tconst gutterItems = this.itemProvider.getIntersectingGutterItems(\n\t\t\t\tvisibleRange2,\n\t\t\t\treader,\n\t\t\t);\n\n\t\t\tfor (const gutterItem of gutterItems) {\n\t\t\t\tif (!gutterItem.range.touches(visibleRange2)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tunusedIds.delete(gutterItem.id);\n\t\t\t\tlet view = this.views.get(gutterItem.id);\n\t\t\t\tif (view) {\n\t\t\t\t\tview.gutterItemView.update(gutterItem);\n\t\t\t\t} else {\n\t\t\t\t\tconst viewDomNode = document.createElement(\"div\");\n\t\t\t\t\tthis._domNode.appendChild(viewDomNode);\n\t\t\t\t\tconst itemView = this.itemProvider.createView(\n\t\t\t\t\t\tgutterItem,\n\t\t\t\t\t\tviewDomNode,\n\t\t\t\t\t);\n\t\t\t\t\tview = new ManagedGutterItemView(itemView, viewDomNode);\n\t\t\t\t\tthis.views.set(gutterItem.id, view);\n\t\t\t\t}\n\n\t\t\t\tconst top =\n\t\t\t\t\tgutterItem.range.startLineNumber <=\n\t\t\t\t\tthis._editor.getModel()!.getLineCount()\n\t\t\t\t\t\t? this._editor.getTopForLineNumber(\n\t\t\t\t\t\t\t\tgutterItem.range.startLineNumber,\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t) - scrollTop\n\t\t\t\t\t\t: this._editor.getBottomForLineNumber(\n\t\t\t\t\t\t\t\tgutterItem.range.startLineNumber - 1,\n\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t) - scrollTop;\n\t\t\t\tconst bottom =\n\t\t\t\t\tthis._editor.getBottomForLineNumber(\n\t\t\t\t\t\tgutterItem.range.endLineNumberExclusive - 1,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t) - scrollTop;\n\n\t\t\t\tconst height = bottom - top;\n\n\t\t\t\tview.domNode.style.top = `${top}px`;\n\t\t\t\tview.domNode.style.height = `${height}px`;\n\n\t\t\t\tview.gutterItemView.layout(\n\t\t\t\t\ttop,\n\t\t\t\t\theight,\n\t\t\t\t\t0,\n\t\t\t\t\tthis._domNode.clientHeight,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tfor (const id of unusedIds) {\n\t\t\tconst view = this.views.get(id)!;\n\t\t\tview.gutterItemView.dispose();\n\t\t\tview.domNode.remove();\n\t\t\tthis.views.delete(id);\n\t\t}\n\t}\n}\n\nclass ManagedGutterItemView {\n\tconstructor(\n\t\tpublic readonly gutterItemView: IGutterItemView<any>,\n\t\tpublic readonly domNode: HTMLDivElement,\n\t) {}\n}\n\nexport interface IGutterItemProvider<TItem extends IGutterItemInfo> {\n\tgetIntersectingGutterItems(range: LineRange, reader: IReader): TItem[];\n\n\tcreateView(item: TItem, target: HTMLElement): IGutterItemView<TItem>;\n}\n\nexport interface IGutterItemInfo {\n\tid: string;\n\trange: LineRange;\n}\n\nexport interface IGutterItemView<T extends IGutterItemInfo>\n\textends IDisposable {\n\tupdate(item: T): void;\n\tlayout(\n\t\ttop: number,\n\t\theight: number,\n\t\tviewTop: number,\n\t\tviewHeight: number,\n\t): void;\n}\n"],
  "mappings": "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",
  "names": []
}
