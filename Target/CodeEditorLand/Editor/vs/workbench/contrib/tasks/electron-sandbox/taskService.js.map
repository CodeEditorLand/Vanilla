{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/tasks/electron-sandbox/taskService.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as nls from '../../../../nls.js';\nimport * as semver from '../../../../base/common/semver/semver.js';\nimport { IWorkspaceFolder, IWorkspaceContextService } from '../../../../platform/workspace/common/workspace.js';\nimport { ITaskSystem } from '../common/taskSystem.js';\nimport { ExecutionEngine } from '../common/tasks.js';\nimport * as TaskConfig from '../common/taskConfiguration.js';\nimport { AbstractTaskService } from '../browser/abstractTaskService.js';\nimport { ITaskFilter, ITaskService } from '../common/taskService.js';\nimport { InstantiationType, registerSingleton } from '../../../../platform/instantiation/common/extensions.js';\nimport { TerminalTaskSystem } from '../browser/terminalTaskSystem.js';\nimport { IConfirmationResult, IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { TerminateResponseCode } from '../../../../base/common/processes.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { ILogService } from '../../../../platform/log/common/log.js';\nimport { IMarkerService } from '../../../../platform/markers/common/markers.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { IProgressService } from '../../../../platform/progress/common/progress.js';\nimport { IQuickInputService } from '../../../../platform/quickinput/common/quickInput.js';\nimport { IStorageService } from '../../../../platform/storage/common/storage.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { IViewDescriptorService } from '../../../common/views.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { IOutputService } from '../../../services/output/common/output.js';\nimport { ITerminalGroupService, ITerminalService } from '../../terminal/browser/terminal.js';\nimport { IConfigurationResolverService } from '../../../services/configurationResolver/common/configurationResolver.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { ILifecycleService } from '../../../services/lifecycle/common/lifecycle.js';\nimport { IPathService } from '../../../services/path/common/pathService.js';\nimport { IPreferencesService } from '../../../services/preferences/common/preferences.js';\nimport { ITextFileService } from '../../../services/textfile/common/textfiles.js';\nimport { IWorkspaceTrustManagementService, IWorkspaceTrustRequestService } from '../../../../platform/workspace/common/workspaceTrust.js';\nimport { ITerminalProfileResolverService } from '../../terminal/common/terminal.js';\nimport { IPaneCompositePartService } from '../../../services/panecomposite/browser/panecomposite.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { IRemoteAgentService } from '../../../services/remote/common/remoteAgentService.js';\nimport { IAccessibilitySignalService } from '../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\n\ninterface IWorkspaceFolderConfigurationResult {\n\tworkspaceFolder: IWorkspaceFolder;\n\tconfig: TaskConfig.IExternalTaskRunnerConfiguration | undefined;\n\thasErrors: boolean;\n}\n\nexport class TaskService extends AbstractTaskService {\n\tconstructor(@IConfigurationService configurationService: IConfigurationService,\n\t\t@IMarkerService markerService: IMarkerService,\n\t\t@IOutputService outputService: IOutputService,\n\t\t@IPaneCompositePartService paneCompositeService: IPaneCompositePartService,\n\t\t@IViewsService viewsService: IViewsService,\n\t\t@ICommandService commandService: ICommandService,\n\t\t@IEditorService editorService: IEditorService,\n\t\t@IFileService fileService: IFileService,\n\t\t@IWorkspaceContextService contextService: IWorkspaceContextService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@ITextFileService textFileService: ITextFileService,\n\t\t@ILifecycleService lifecycleService: ILifecycleService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IQuickInputService quickInputService: IQuickInputService,\n\t\t@IConfigurationResolverService configurationResolverService: IConfigurationResolverService,\n\t\t@ITerminalService terminalService: ITerminalService,\n\t\t@ITerminalGroupService terminalGroupService: ITerminalGroupService,\n\t\t@IStorageService storageService: IStorageService,\n\t\t@IProgressService progressService: IProgressService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IDialogService dialogService: IDialogService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IWorkbenchEnvironmentService environmentService: IWorkbenchEnvironmentService,\n\t\t@ITerminalProfileResolverService terminalProfileResolverService: ITerminalProfileResolverService,\n\t\t@IPathService pathService: IPathService,\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@IPreferencesService preferencesService: IPreferencesService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IWorkspaceTrustRequestService workspaceTrustRequestService: IWorkspaceTrustRequestService,\n\t\t@IWorkspaceTrustManagementService workspaceTrustManagementService: IWorkspaceTrustManagementService,\n\t\t@ILogService logService: ILogService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IRemoteAgentService remoteAgentService: IRemoteAgentService,\n\t\t@IAccessibilitySignalService accessibilitySignalService: IAccessibilitySignalService\n\t) {\n\t\tsuper(configurationService,\n\t\t\tmarkerService,\n\t\t\toutputService,\n\t\t\tpaneCompositeService,\n\t\t\tviewsService,\n\t\t\tcommandService,\n\t\t\teditorService,\n\t\t\tfileService,\n\t\t\tcontextService,\n\t\t\ttelemetryService,\n\t\t\ttextFileService,\n\t\t\tmodelService,\n\t\t\textensionService,\n\t\t\tquickInputService,\n\t\t\tconfigurationResolverService,\n\t\t\tterminalService,\n\t\t\tterminalGroupService,\n\t\t\tstorageService,\n\t\t\tprogressService,\n\t\t\topenerService,\n\t\t\tdialogService,\n\t\t\tnotificationService,\n\t\t\tcontextKeyService,\n\t\t\tenvironmentService,\n\t\t\tterminalProfileResolverService,\n\t\t\tpathService,\n\t\t\ttextModelResolverService,\n\t\t\tpreferencesService,\n\t\t\tviewDescriptorService,\n\t\t\tworkspaceTrustRequestService,\n\t\t\tworkspaceTrustManagementService,\n\t\t\tlogService,\n\t\t\tthemeService,\n\t\t\tlifecycleService,\n\t\t\tremoteAgentService,\n\t\t\tinstantiationService\n\t\t);\n\t\tthis._register(lifecycleService.onBeforeShutdown(event => event.veto(this.beforeShutdown(), 'veto.tasks')));\n\t}\n\n\tprotected _getTaskSystem(): ITaskSystem {\n\t\tif (this._taskSystem) {\n\t\t\treturn this._taskSystem;\n\t\t}\n\t\tconst taskSystem = this._createTerminalTaskSystem();\n\t\tthis._taskSystem = taskSystem;\n\t\tthis._taskSystemListeners =\n\t\t\t[\n\t\t\t\tthis._taskSystem.onDidStateChange((event) => {\n\t\t\t\t\tthis._taskRunningState.set(this._taskSystem!.isActiveSync());\n\t\t\t\t\tthis._onDidStateChange.fire(event);\n\t\t\t\t})\n\t\t\t];\n\t\treturn this._taskSystem;\n\t}\n\n\tprotected _computeLegacyConfiguration(workspaceFolder: IWorkspaceFolder): Promise<IWorkspaceFolderConfigurationResult> {\n\t\tconst { config, hasParseErrors } = this._getConfiguration(workspaceFolder);\n\t\tif (hasParseErrors) {\n\t\t\treturn Promise.resolve({ workspaceFolder: workspaceFolder, hasErrors: true, config: undefined });\n\t\t}\n\t\tif (config) {\n\t\t\treturn Promise.resolve({ workspaceFolder, config, hasErrors: false });\n\t\t} else {\n\t\t\treturn Promise.resolve({ workspaceFolder: workspaceFolder, hasErrors: true, config: undefined });\n\t\t}\n\t}\n\n\tprotected _versionAndEngineCompatible(filter?: ITaskFilter): boolean {\n\t\tconst range = filter && filter.version ? filter.version : undefined;\n\t\tconst engine = this.executionEngine;\n\n\t\treturn (range === undefined) || ((semver.satisfies('0.1.0', range) && engine === ExecutionEngine.Process) || (semver.satisfies('2.0.0', range) && engine === ExecutionEngine.Terminal));\n\t}\n\n\tpublic beforeShutdown(): boolean | Promise<boolean> {\n\t\tif (!this._taskSystem) {\n\t\t\treturn false;\n\t\t}\n\t\tif (!this._taskSystem.isActiveSync()) {\n\t\t\treturn false;\n\t\t}\n\t\t// The terminal service kills all terminal on shutdown. So there\n\t\t// is nothing we can do to prevent this here.\n\t\tif (this._taskSystem instanceof TerminalTaskSystem) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet terminatePromise: Promise<IConfirmationResult>;\n\t\tif (this._taskSystem.canAutoTerminate()) {\n\t\t\tterminatePromise = Promise.resolve({ confirmed: true });\n\t\t} else {\n\t\t\tterminatePromise = this._dialogService.confirm({\n\t\t\t\tmessage: nls.localize('TaskSystem.runningTask', 'There is a task running. Do you want to terminate it?'),\n\t\t\t\tprimaryButton: nls.localize({ key: 'TaskSystem.terminateTask', comment: ['&& denotes a mnemonic'] }, \"&&Terminate Task\")\n\t\t\t});\n\t\t}\n\n\t\treturn terminatePromise.then(res => {\n\t\t\tif (res.confirmed) {\n\t\t\t\treturn this._taskSystem!.terminateAll().then((responses) => {\n\t\t\t\t\tlet success = true;\n\t\t\t\t\tlet code: number | undefined = undefined;\n\t\t\t\t\tfor (const response of responses) {\n\t\t\t\t\t\tsuccess = success && response.success;\n\t\t\t\t\t\t// We only have a code in the old output runner which only has one task\n\t\t\t\t\t\t// So we can use the first code.\n\t\t\t\t\t\tif (code === undefined && response.code !== undefined) {\n\t\t\t\t\t\t\tcode = response.code;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tif (success) {\n\t\t\t\t\t\tthis._taskSystem = undefined;\n\t\t\t\t\t\tthis._disposeTaskSystemListeners();\n\t\t\t\t\t\treturn false; // no veto\n\t\t\t\t\t} else if (code && code === TerminateResponseCode.ProcessNotFound) {\n\t\t\t\t\t\treturn this._dialogService.confirm({\n\t\t\t\t\t\t\tmessage: nls.localize('TaskSystem.noProcess', 'The launched task doesn\\'t exist anymore. If the task spawned background processes exiting VS Code might result in orphaned processes. To avoid this start the last background process with a wait flag.'),\n\t\t\t\t\t\t\tprimaryButton: nls.localize({ key: 'TaskSystem.exitAnyways', comment: ['&& denotes a mnemonic'] }, \"&&Exit Anyways\"),\n\t\t\t\t\t\t\ttype: 'info'\n\t\t\t\t\t\t}).then(res => !res.confirmed);\n\t\t\t\t\t}\n\t\t\t\t\treturn true; // veto\n\t\t\t\t}, (err) => {\n\t\t\t\t\treturn true; // veto\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn true; // veto\n\t\t});\n\t}\n}\n\nregisterSingleton(ITaskService, TaskService, InstantiationType.Delayed);\n"],
  "mappings": "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",
  "names": ["res"]
}
