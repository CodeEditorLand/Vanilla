{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/inlayHints/browser/inlayHintsAccessibilty.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { KeyCode } from '../../../../base/common/keyCodes.js';\nimport { DisposableStore } from '../../../../base/common/lifecycle.js';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { EditorAction2, EditorContributionInstantiation, registerEditorContribution } from '../../../../editor/browser/editorExtensions.js';\nimport { IEditorContribution } from '../../../../editor/common/editorCommon.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { InlayHintItem, asCommandLink } from '../../../../editor/contrib/inlayHints/browser/inlayHints.js';\nimport { InlayHintsController } from '../../../../editor/contrib/inlayHints/browser/inlayHintsController.js';\nimport { localize, localize2 } from '../../../../nls.js';\nimport { registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { AccessibilitySignal, IAccessibilitySignalService } from '../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js';\nimport { IContextKey, IContextKeyService, RawContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../../../platform/keybinding/common/keybindingsRegistry.js';\nimport { Link } from '../../../../platform/opener/browser/link.js';\n\n\nexport class InlayHintsAccessibility implements IEditorContribution {\n\n\tstatic readonly IsReading = new RawContextKey<boolean>('isReadingLineWithInlayHints', false, { type: 'boolean', description: localize('isReadingLineWithInlayHints', \"Whether the current line and its inlay hints are currently focused\") });\n\n\tstatic readonly ID: string = 'editor.contrib.InlayHintsAccessibility';\n\n\tstatic get(editor: ICodeEditor): InlayHintsAccessibility | undefined {\n\t\treturn editor.getContribution<InlayHintsAccessibility>(InlayHintsAccessibility.ID) ?? undefined;\n\t}\n\n\tprivate readonly _ariaElement: HTMLSpanElement;\n\tprivate readonly _ctxIsReading: IContextKey<boolean>;\n\n\tprivate readonly _sessionDispoosables = new DisposableStore();\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService,\n\t\t@IInstantiationService private readonly _instaService: IInstantiationService,\n\t) {\n\t\tthis._ariaElement = document.createElement('span');\n\t\tthis._ariaElement.style.position = 'fixed';\n\t\tthis._ariaElement.className = 'inlayhint-accessibility-element';\n\t\tthis._ariaElement.tabIndex = 0;\n\t\tthis._ariaElement.setAttribute('aria-description', localize('description', \"Code with Inlay Hint Information\"));\n\n\t\tthis._ctxIsReading = InlayHintsAccessibility.IsReading.bindTo(contextKeyService);\n\t}\n\n\tdispose(): void {\n\t\tthis._sessionDispoosables.dispose();\n\t\tthis._ctxIsReading.reset();\n\t\tthis._ariaElement.remove();\n\t}\n\n\tprivate _reset(): void {\n\t\tdom.clearNode(this._ariaElement);\n\t\tthis._sessionDispoosables.clear();\n\t\tthis._ctxIsReading.reset();\n\t}\n\n\tprivate async _read(line: number, hints: InlayHintItem[]) {\n\n\t\tthis._sessionDispoosables.clear();\n\n\t\tif (!this._ariaElement.isConnected) {\n\t\t\tthis._editor.getDomNode()?.appendChild(this._ariaElement);\n\t\t}\n\n\t\tif (!this._editor.hasModel() || !this._ariaElement.isConnected) {\n\t\t\tthis._ctxIsReading.set(false);\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._sessionDispoosables.add(cts);\n\n\t\tfor (const hint of hints) {\n\t\t\tawait hint.resolve(cts.token);\n\t\t}\n\n\t\tif (cts.token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst model = this._editor.getModel();\n\t\t// const text = this._editor.getModel().getLineContent(line);\n\t\tconst newChildren: (string | HTMLElement)[] = [];\n\n\t\tlet start = 0;\n\t\tlet tooLongToRead = false;\n\n\t\tfor (const item of hints) {\n\n\t\t\t// text\n\t\t\tconst part = model.getValueInRange({ startLineNumber: line, startColumn: start + 1, endLineNumber: line, endColumn: item.hint.position.column });\n\t\t\tif (part.length > 0) {\n\t\t\t\tnewChildren.push(part);\n\t\t\t\tstart = item.hint.position.column - 1;\n\t\t\t}\n\n\t\t\t// check length\n\t\t\tif (start > 750) {\n\t\t\t\tnewChildren.push('\u2026');\n\t\t\t\ttooLongToRead = true;\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\t// hint\n\t\t\tconst em = document.createElement('em');\n\t\t\tconst { label } = item.hint;\n\t\t\tif (typeof label === 'string') {\n\t\t\t\tem.innerText = label;\n\t\t\t} else {\n\t\t\t\tfor (const part of label) {\n\t\t\t\t\tif (part.command) {\n\t\t\t\t\t\tconst link = this._instaService.createInstance(Link, em,\n\t\t\t\t\t\t\t{ href: asCommandLink(part.command), label: part.label, title: part.command.title },\n\t\t\t\t\t\t\tundefined\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis._sessionDispoosables.add(link);\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tem.innerText += part.label;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tnewChildren.push(em);\n\t\t}\n\n\t\t// trailing text\n\t\tif (!tooLongToRead) {\n\t\t\tnewChildren.push(model.getValueInRange({ startLineNumber: line, startColumn: start + 1, endLineNumber: line, endColumn: Number.MAX_SAFE_INTEGER }));\n\t\t}\n\n\t\tdom.reset(this._ariaElement, ...newChildren);\n\t\tthis._ariaElement.focus();\n\t\tthis._ctxIsReading.set(true);\n\n\t\t// reset on blur\n\t\tthis._sessionDispoosables.add(dom.addDisposableListener(this._ariaElement, 'focusout', () => {\n\t\t\tthis._reset();\n\t\t}));\n\t}\n\n\n\n\tstartInlayHintsReading(): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst line = this._editor.getPosition().lineNumber;\n\t\tconst hints = InlayHintsController.get(this._editor)?.getInlayHintsForLine(line);\n\t\tif (!hints || hints.length === 0) {\n\t\t\tthis._accessibilitySignalService.playSignal(AccessibilitySignal.noInlayHints);\n\t\t} else {\n\t\t\tthis._read(line, hints);\n\t\t}\n\t}\n\n\tstopInlayHintsReading(): void {\n\t\tthis._reset();\n\t\tthis._editor.focus();\n\t}\n}\n\n\nregisterAction2(class StartReadHints extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'inlayHints.startReadingLineWithHint',\n\t\t\ttitle: localize2('read.title', \"Read Line With Inline Hints\"),\n\t\t\tprecondition: EditorContextKeys.hasInlayHintsProvider,\n\t\t\tf1: true\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\tconst ctrl = InlayHintsAccessibility.get(editor);\n\t\tctrl?.startInlayHintsReading();\n\t}\n});\n\nregisterAction2(class StopReadHints extends EditorAction2 {\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'inlayHints.stopReadingLineWithHint',\n\t\t\ttitle: localize2('stop.title', \"Stop Inlay Hints Reading\"),\n\t\t\tprecondition: InlayHintsAccessibility.IsReading,\n\t\t\tf1: true,\n\t\t\tkeybinding: {\n\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t\tprimary: KeyCode.Escape\n\t\t\t}\n\t\t});\n\t}\n\n\trunEditorCommand(_accessor: ServicesAccessor, editor: ICodeEditor) {\n\t\tconst ctrl = InlayHintsAccessibility.get(editor);\n\t\tctrl?.stopInlayHintsReading();\n\t}\n});\n\nregisterEditorContribution(InlayHintsAccessibility.ID, InlayHintsAccessibility, EditorContributionInstantiation.Lazy);\n"],
  "mappings": "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",
  "names": ["part"]
}
