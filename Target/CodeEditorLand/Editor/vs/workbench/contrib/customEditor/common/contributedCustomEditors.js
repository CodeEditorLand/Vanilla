import{Emitter as p}from"../../../../base/common/event.js";import{Disposable as l}from"../../../../base/common/lifecycle.js";import*as u from"../../../../nls.js";import{StorageScope as a,StorageTarget as m}from"../../../../platform/storage/common/storage.js";import{Memento as c}from"../../../common/memento.js";import{RegisteredEditorPriority as o}from"../../../services/editor/common/editorResolverService.js";import{CustomEditorInfo as d}from"./customEditor.js";import{customEditorsExtensionPoint as E}from"./extensionPoint.js";class s extends l{static CUSTOM_EDITORS_STORAGE_ID="customEditors";static CUSTOM_EDITORS_ENTRY_ID="editors";_editors=new Map;_memento;constructor(t){super(),this._memento=new c(s.CUSTOM_EDITORS_STORAGE_ID,t);const i=this._memento.getMemento(a.PROFILE,m.MACHINE);for(const e of i[s.CUSTOM_EDITORS_ENTRY_ID]||[])this.add(new d(e));E.setHandler(e=>{this.update(e)})}_onChange=this._register(new p);onChange=this._onChange.event;update(t){this._editors.clear();for(const e of t)for(const r of e.value)this.add(new d({id:r.viewType,displayName:r.displayName,providerDisplayName:e.description.isBuiltin?u.localize("builtinProviderDisplayName","Built-in"):e.description.displayName||e.description.identifier.value,selector:r.selector||[],priority:f(r,e.description)}));const i=this._memento.getMemento(a.PROFILE,m.MACHINE);i[s.CUSTOM_EDITORS_ENTRY_ID]=Array.from(this._editors.values()),this._memento.saveMemento(),this._onChange.fire()}[Symbol.iterator](){return this._editors.values()}get(t){return this._editors.get(t)}getContributedEditors(t){return Array.from(this._editors.values()).filter(i=>i.matches(t))}add(t){this._editors.has(t.id)||this._editors.set(t.id,t)}}function f(n,t){switch(n.priority){case o.default:case o.option:return n.priority;case o.builtin:return t.isBuiltin?o.builtin:o.default;default:return o.default}}export{s as ContributedCustomEditors};
