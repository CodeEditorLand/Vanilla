{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/customEditor/common/contributedCustomEditors.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport * as nls from '../../../../nls.js';\nimport { IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { Memento } from '../../../common/memento.js';\nimport { CustomEditorDescriptor, CustomEditorInfo } from './customEditor.js';\nimport { customEditorsExtensionPoint, ICustomEditorsExtensionPoint } from './extensionPoint.js';\nimport { RegisteredEditorPriority } from '../../../services/editor/common/editorResolverService.js';\nimport { IExtensionPointUser } from '../../../services/extensions/common/extensionsRegistry.js';\n\nexport class ContributedCustomEditors extends Disposable {\n\n\tprivate static readonly CUSTOM_EDITORS_STORAGE_ID = 'customEditors';\n\tprivate static readonly CUSTOM_EDITORS_ENTRY_ID = 'editors';\n\n\tprivate readonly _editors = new Map<string, CustomEditorInfo>();\n\tprivate readonly _memento: Memento;\n\n\tconstructor(storageService: IStorageService) {\n\t\tsuper();\n\n\t\tthis._memento = new Memento(ContributedCustomEditors.CUSTOM_EDITORS_STORAGE_ID, storageService);\n\n\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tfor (const info of (mementoObject[ContributedCustomEditors.CUSTOM_EDITORS_ENTRY_ID] || []) as CustomEditorDescriptor[]) {\n\t\t\tthis.add(new CustomEditorInfo(info));\n\t\t}\n\n\t\tcustomEditorsExtensionPoint.setHandler(extensions => {\n\t\t\tthis.update(extensions);\n\t\t});\n\t}\n\n\tprivate readonly _onChange = this._register(new Emitter<void>());\n\tpublic readonly onChange = this._onChange.event;\n\n\tprivate update(extensions: readonly IExtensionPointUser<ICustomEditorsExtensionPoint[]>[]) {\n\t\tthis._editors.clear();\n\n\t\tfor (const extension of extensions) {\n\t\t\tfor (const webviewEditorContribution of extension.value) {\n\t\t\t\tthis.add(new CustomEditorInfo({\n\t\t\t\t\tid: webviewEditorContribution.viewType,\n\t\t\t\t\tdisplayName: webviewEditorContribution.displayName,\n\t\t\t\t\tproviderDisplayName: extension.description.isBuiltin ? nls.localize('builtinProviderDisplayName', \"Built-in\") : extension.description.displayName || extension.description.identifier.value,\n\t\t\t\t\tselector: webviewEditorContribution.selector || [],\n\t\t\t\t\tpriority: getPriorityFromContribution(webviewEditorContribution, extension.description),\n\t\t\t\t}));\n\t\t\t}\n\t\t}\n\n\t\tconst mementoObject = this._memento.getMemento(StorageScope.PROFILE, StorageTarget.MACHINE);\n\t\tmementoObject[ContributedCustomEditors.CUSTOM_EDITORS_ENTRY_ID] = Array.from(this._editors.values());\n\t\tthis._memento.saveMemento();\n\n\t\tthis._onChange.fire();\n\t}\n\n\tpublic [Symbol.iterator](): Iterator<CustomEditorInfo> {\n\t\treturn this._editors.values();\n\t}\n\n\tpublic get(viewType: string): CustomEditorInfo | undefined {\n\t\treturn this._editors.get(viewType);\n\t}\n\n\tpublic getContributedEditors(resource: URI): readonly CustomEditorInfo[] {\n\t\treturn Array.from(this._editors.values())\n\t\t\t.filter(customEditor => customEditor.matches(resource));\n\t}\n\n\tprivate add(info: CustomEditorInfo): void {\n\t\tif (this._editors.has(info.id)) {\n\t\t\tconsole.error(`Custom editor with id '${info.id}' already registered`);\n\t\t\treturn;\n\t\t}\n\t\tthis._editors.set(info.id, info);\n\t}\n}\n\nfunction getPriorityFromContribution(\n\tcontribution: ICustomEditorsExtensionPoint,\n\textension: IExtensionDescription,\n): RegisteredEditorPriority {\n\tswitch (contribution.priority) {\n\t\tcase RegisteredEditorPriority.default:\n\t\tcase RegisteredEditorPriority.option:\n\t\t\treturn contribution.priority;\n\n\t\tcase RegisteredEditorPriority.builtin:\n\t\t\t// Builtin is only valid for builtin extensions\n\t\t\treturn extension.isBuiltin ? RegisteredEditorPriority.builtin : RegisteredEditorPriority.default;\n\n\t\tdefault:\n\t\t\treturn RegisteredEditorPriority.default;\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,eAAe;AACxB,SAAS,kBAAkB;AAC3B,SAAS,WAAW;AACpB,YAAY,SAAS;AACrB,SAAS,6BAA6B;AACtC,SAAS,iBAAiB,cAAc,qBAAqB;AAC7D,SAAS,eAAe;AACxB,SAAS,wBAAwB,wBAAwB;AACzD,SAAS,6BAA6B,oCAAoC;AAC1E,SAAS,gCAAgC;AACzC,SAAS,2BAA2B;AAE7B,MAAM,iCAAiC,WAAW;AAAA,EAjBzD,OAiByD;AAAA;AAAA;AAAA,EAExD,OAAwB,4BAA4B;AAAA,EACpD,OAAwB,0BAA0B;AAAA,EAEjC,WAAW,oBAAI,IAA8B;AAAA,EAC7C;AAAA,EAEjB,YAAY,gBAAiC;AAC5C,UAAM;AAEN,SAAK,WAAW,IAAI,QAAQ,yBAAyB,2BAA2B,cAAc;AAE9F,UAAM,gBAAgB,KAAK,SAAS,WAAW,aAAa,SAAS,cAAc,OAAO;AAC1F,eAAW,QAAS,cAAc,yBAAyB,uBAAuB,KAAK,CAAC,GAAgC;AACvH,WAAK,IAAI,IAAI,iBAAiB,IAAI,CAAC;AAAA,IACpC;AAEA,gCAA4B,WAAW,gBAAc;AACpD,WAAK,OAAO,UAAU;AAAA,IACvB,CAAC;AAAA,EACF;AAAA,EAEiB,YAAY,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC/C,WAAW,KAAK,UAAU;AAAA,EAElC,OAAO,YAA4E;AAC1F,SAAK,SAAS,MAAM;AAEpB,eAAW,aAAa,YAAY;AACnC,iBAAW,6BAA6B,UAAU,OAAO;AACxD,aAAK,IAAI,IAAI,iBAAiB;AAAA,UAC7B,IAAI,0BAA0B;AAAA,UAC9B,aAAa,0BAA0B;AAAA,UACvC,qBAAqB,UAAU,YAAY,YAAY,IAAI,SAAS,8BAA8B,UAAU,IAAI,UAAU,YAAY,eAAe,UAAU,YAAY,WAAW;AAAA,UACtL,UAAU,0BAA0B,YAAY,CAAC;AAAA,UACjD,UAAU,4BAA4B,2BAA2B,UAAU,WAAW;AAAA,QACvF,CAAC,CAAC;AAAA,MACH;AAAA,IACD;AAEA,UAAM,gBAAgB,KAAK,SAAS,WAAW,aAAa,SAAS,cAAc,OAAO;AAC1F,kBAAc,yBAAyB,uBAAuB,IAAI,MAAM,KAAK,KAAK,SAAS,OAAO,CAAC;AACnG,SAAK,SAAS,YAAY;AAE1B,SAAK,UAAU,KAAK;AAAA,EACrB;AAAA,EAEA,CAAQ,OAAO,QAAQ,IAAgC;AACtD,WAAO,KAAK,SAAS,OAAO;AAAA,EAC7B;AAAA,EAEO,IAAI,UAAgD;AAC1D,WAAO,KAAK,SAAS,IAAI,QAAQ;AAAA,EAClC;AAAA,EAEO,sBAAsB,UAA4C;AACxE,WAAO,MAAM,KAAK,KAAK,SAAS,OAAO,CAAC,EACtC,OAAO,kBAAgB,aAAa,QAAQ,QAAQ,CAAC;AAAA,EACxD;AAAA,EAEQ,IAAI,MAA8B;AACzC,QAAI,KAAK,SAAS,IAAI,KAAK,EAAE,GAAG;AAC/B,cAAQ,MAAM,0BAA0B,KAAK,EAAE,sBAAsB;AACrE;AAAA,IACD;AACA,SAAK,SAAS,IAAI,KAAK,IAAI,IAAI;AAAA,EAChC;AACD;AAEA,SAAS,4BACR,cACA,WAC2B;AAC3B,UAAQ,aAAa,UAAU;AAAA,IAC9B,KAAK,yBAAyB;AAAA,IAC9B,KAAK,yBAAyB;AAC7B,aAAO,aAAa;AAAA,IAErB,KAAK,yBAAyB;AAE7B,aAAO,UAAU,YAAY,yBAAyB,UAAU,yBAAyB;AAAA,IAE1F;AACC,aAAO,yBAAyB;AAAA,EAClC;AACD;AAhBS;",
  "names": []
}
