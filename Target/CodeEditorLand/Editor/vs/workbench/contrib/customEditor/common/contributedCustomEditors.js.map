{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/customEditor/common/contributedCustomEditors.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from \"../../../../base/common/event.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport * as nls from \"../../../../nls.js\";\nimport type { IExtensionDescription } from \"../../../../platform/extensions/common/extensions.js\";\nimport {\n\ttype IStorageService,\n\tStorageScope,\n\tStorageTarget,\n} from \"../../../../platform/storage/common/storage.js\";\nimport { Memento } from \"../../../common/memento.js\";\nimport { RegisteredEditorPriority } from \"../../../services/editor/common/editorResolverService.js\";\nimport type { IExtensionPointUser } from \"../../../services/extensions/common/extensionsRegistry.js\";\nimport {\n\ttype CustomEditorDescriptor,\n\tCustomEditorInfo,\n} from \"./customEditor.js\";\nimport {\n\ttype ICustomEditorsExtensionPoint,\n\tcustomEditorsExtensionPoint,\n} from \"./extensionPoint.js\";\n\nexport class ContributedCustomEditors extends Disposable {\n\tprivate static readonly CUSTOM_EDITORS_STORAGE_ID = \"customEditors\";\n\tprivate static readonly CUSTOM_EDITORS_ENTRY_ID = \"editors\";\n\n\tprivate readonly _editors = new Map<string, CustomEditorInfo>();\n\tprivate readonly _memento: Memento;\n\n\tconstructor(storageService: IStorageService) {\n\t\tsuper();\n\n\t\tthis._memento = new Memento(\n\t\t\tContributedCustomEditors.CUSTOM_EDITORS_STORAGE_ID,\n\t\t\tstorageService,\n\t\t);\n\n\t\tconst mementoObject = this._memento.getMemento(\n\t\t\tStorageScope.PROFILE,\n\t\t\tStorageTarget.MACHINE,\n\t\t);\n\t\tfor (const info of (mementoObject[\n\t\t\tContributedCustomEditors.CUSTOM_EDITORS_ENTRY_ID\n\t\t] || []) as CustomEditorDescriptor[]) {\n\t\t\tthis.add(new CustomEditorInfo(info));\n\t\t}\n\n\t\tcustomEditorsExtensionPoint.setHandler((extensions) => {\n\t\t\tthis.update(extensions);\n\t\t});\n\t}\n\n\tprivate readonly _onChange = this._register(new Emitter<void>());\n\tpublic readonly onChange = this._onChange.event;\n\n\tprivate update(\n\t\textensions: readonly IExtensionPointUser<\n\t\t\tICustomEditorsExtensionPoint[]\n\t\t>[],\n\t) {\n\t\tthis._editors.clear();\n\n\t\tfor (const extension of extensions) {\n\t\t\tfor (const webviewEditorContribution of extension.value) {\n\t\t\t\tthis.add(\n\t\t\t\t\tnew CustomEditorInfo({\n\t\t\t\t\t\tid: webviewEditorContribution.viewType,\n\t\t\t\t\t\tdisplayName: webviewEditorContribution.displayName,\n\t\t\t\t\t\tproviderDisplayName: extension.description.isBuiltin\n\t\t\t\t\t\t\t? nls.localize(\n\t\t\t\t\t\t\t\t\t\"builtinProviderDisplayName\",\n\t\t\t\t\t\t\t\t\t\"Built-in\",\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t: extension.description.displayName ||\n\t\t\t\t\t\t\t\textension.description.identifier.value,\n\t\t\t\t\t\tselector: webviewEditorContribution.selector || [],\n\t\t\t\t\t\tpriority: getPriorityFromContribution(\n\t\t\t\t\t\t\twebviewEditorContribution,\n\t\t\t\t\t\t\textension.description,\n\t\t\t\t\t\t),\n\t\t\t\t\t}),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst mementoObject = this._memento.getMemento(\n\t\t\tStorageScope.PROFILE,\n\t\t\tStorageTarget.MACHINE,\n\t\t);\n\t\tmementoObject[ContributedCustomEditors.CUSTOM_EDITORS_ENTRY_ID] =\n\t\t\tArray.from(this._editors.values());\n\t\tthis._memento.saveMemento();\n\n\t\tthis._onChange.fire();\n\t}\n\n\tpublic [Symbol.iterator](): Iterator<CustomEditorInfo> {\n\t\treturn this._editors.values();\n\t}\n\n\tpublic get(viewType: string): CustomEditorInfo | undefined {\n\t\treturn this._editors.get(viewType);\n\t}\n\n\tpublic getContributedEditors(resource: URI): readonly CustomEditorInfo[] {\n\t\treturn Array.from(this._editors.values()).filter((customEditor) =>\n\t\t\tcustomEditor.matches(resource),\n\t\t);\n\t}\n\n\tprivate add(info: CustomEditorInfo): void {\n\t\tif (this._editors.has(info.id)) {\n\t\t\tconsole.error(\n\t\t\t\t`Custom editor with id '${info.id}' already registered`,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tthis._editors.set(info.id, info);\n\t}\n}\n\nfunction getPriorityFromContribution(\n\tcontribution: ICustomEditorsExtensionPoint,\n\textension: IExtensionDescription,\n): RegisteredEditorPriority {\n\tswitch (contribution.priority) {\n\t\tcase RegisteredEditorPriority.default:\n\t\tcase RegisteredEditorPriority.option:\n\t\t\treturn contribution.priority;\n\n\t\tcase RegisteredEditorPriority.builtin:\n\t\t\t// Builtin is only valid for builtin extensions\n\t\t\treturn extension.isBuiltin\n\t\t\t\t? RegisteredEditorPriority.builtin\n\t\t\t\t: RegisteredEditorPriority.default;\n\n\t\tdefault:\n\t\t\treturn RegisteredEditorPriority.default;\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,eAAe;AACxB,SAAS,kBAAkB;AAE3B,YAAY,SAAS;AAErB;AAAA,EAEC;AAAA,EACA;AAAA,OACM;AACP,SAAS,eAAe;AACxB,SAAS,gCAAgC;AAEzC;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EAEC;AAAA,OACM;AAEA,MAAM,iCAAiC,WAAW;AAAA,EA3BzD,OA2ByD;AAAA;AAAA;AAAA,EACxD,OAAwB,4BAA4B;AAAA,EACpD,OAAwB,0BAA0B;AAAA,EAEjC,WAAW,oBAAI,IAA8B;AAAA,EAC7C;AAAA,EAEjB,YAAY,gBAAiC;AAC5C,UAAM;AAEN,SAAK,WAAW,IAAI;AAAA,MACnB,yBAAyB;AAAA,MACzB;AAAA,IACD;AAEA,UAAM,gBAAgB,KAAK,SAAS;AAAA,MACnC,aAAa;AAAA,MACb,cAAc;AAAA,IACf;AACA,eAAW,QAAS,cACnB,yBAAyB,uBAC1B,KAAK,CAAC,GAAgC;AACrC,WAAK,IAAI,IAAI,iBAAiB,IAAI,CAAC;AAAA,IACpC;AAEA,gCAA4B,WAAW,CAAC,eAAe;AACtD,WAAK,OAAO,UAAU;AAAA,IACvB,CAAC;AAAA,EACF;AAAA,EAEiB,YAAY,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC/C,WAAW,KAAK,UAAU;AAAA,EAElC,OACP,YAGC;AACD,SAAK,SAAS,MAAM;AAEpB,eAAW,aAAa,YAAY;AACnC,iBAAW,6BAA6B,UAAU,OAAO;AACxD,aAAK;AAAA,UACJ,IAAI,iBAAiB;AAAA,YACpB,IAAI,0BAA0B;AAAA,YAC9B,aAAa,0BAA0B;AAAA,YACvC,qBAAqB,UAAU,YAAY,YACxC,IAAI;AAAA,cACJ;AAAA,cACA;AAAA,YACD,IACC,UAAU,YAAY,eACvB,UAAU,YAAY,WAAW;AAAA,YACnC,UAAU,0BAA0B,YAAY,CAAC;AAAA,YACjD,UAAU;AAAA,cACT;AAAA,cACA,UAAU;AAAA,YACX;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD;AAAA,IACD;AAEA,UAAM,gBAAgB,KAAK,SAAS;AAAA,MACnC,aAAa;AAAA,MACb,cAAc;AAAA,IACf;AACA,kBAAc,yBAAyB,uBAAuB,IAC7D,MAAM,KAAK,KAAK,SAAS,OAAO,CAAC;AAClC,SAAK,SAAS,YAAY;AAE1B,SAAK,UAAU,KAAK;AAAA,EACrB;AAAA,EAEA,CAAQ,OAAO,QAAQ,IAAgC;AACtD,WAAO,KAAK,SAAS,OAAO;AAAA,EAC7B;AAAA,EAEO,IAAI,UAAgD;AAC1D,WAAO,KAAK,SAAS,IAAI,QAAQ;AAAA,EAClC;AAAA,EAEO,sBAAsB,UAA4C;AACxE,WAAO,MAAM,KAAK,KAAK,SAAS,OAAO,CAAC,EAAE;AAAA,MAAO,CAAC,iBACjD,aAAa,QAAQ,QAAQ;AAAA,IAC9B;AAAA,EACD;AAAA,EAEQ,IAAI,MAA8B;AACzC,QAAI,KAAK,SAAS,IAAI,KAAK,EAAE,GAAG;AAC/B,cAAQ;AAAA,QACP,0BAA0B,KAAK,EAAE;AAAA,MAClC;AACA;AAAA,IACD;AACA,SAAK,SAAS,IAAI,KAAK,IAAI,IAAI;AAAA,EAChC;AACD;AAEA,SAAS,4BACR,cACA,WAC2B;AAC3B,UAAQ,aAAa,UAAU;AAAA,IAC9B,KAAK,yBAAyB;AAAA,IAC9B,KAAK,yBAAyB;AAC7B,aAAO,aAAa;AAAA,IAErB,KAAK,yBAAyB;AAE7B,aAAO,UAAU,YACd,yBAAyB,UACzB,yBAAyB;AAAA,IAE7B;AACC,aAAO,yBAAyB;AAAA,EAClC;AACD;AAlBS;",
  "names": []
}
