var v=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var l=(a,r,e,t)=>{for(var i=t>1?void 0:t?p(r,e):r,n=a.length-1,o;n>=0;n--)(o=a[n])&&(i=(t?o(r,e,i):o(i))||i);return t&&i&&v(r,e,i),i},h=(a,r)=>(e,t)=>r(e,t,a);import{Emitter as d}from"../../../../../vs/base/common/event.js";import"../../../../../vs/base/common/htmlContent.js";import{Disposable as u}from"../../../../../vs/base/common/lifecycle.js";import{isEqual as g}from"../../../../../vs/base/common/resources.js";import"../../../../../vs/base/common/uri.js";import{ITextModelService as y}from"../../../../../vs/editor/common/services/resolverService.js";import"../../../../../vs/platform/instantiation/common/instantiation.js";import"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/contrib/customEditor/common/customEditor.js";import{ITextFileService as m,TextFileEditorModelState as I}from"../../../../../vs/workbench/services/textfile/common/textfiles.js";let s=class extends u{constructor(e,t,i,n){super();this.viewType=e;this._resource=t;this._model=i;this.textFileService=n;this._register(i),this._textFileModel=this.textFileService.files.get(t),this._textFileModel&&(this._register(this._textFileModel.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._register(this._textFileModel.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._register(this.textFileService.files.onDidChangeDirty(o=>{g(this.resource,o.resource)&&(this._onDidChangeDirty.fire(),this._onDidChangeContent.fire())}))}static async create(e,t,i){return e.invokeFunction(async n=>{const c=await n.get(y).createModelReference(i);return e.createInstance(s,t,i,c)})}_textFileModel;_onDidChangeOrphaned=this._register(new d);onDidChangeOrphaned=this._onDidChangeOrphaned.event;_onDidChangeReadonly=this._register(new d);onDidChangeReadonly=this._onDidChangeReadonly.event;get resource(){return this._resource}isReadonly(){return this._model.object.isReadonly()}get backupId(){}get canHotExit(){return!0}isDirty(){return this.textFileService.isDirty(this.resource)}isOrphaned(){return!!this._textFileModel?.hasState(I.ORPHAN)}_onDidChangeDirty=this._register(new d);onDidChangeDirty=this._onDidChangeDirty.event;_onDidChangeContent=this._register(new d);onDidChangeContent=this._onDidChangeContent.event;async revert(e){return this.textFileService.revert(this.resource,e)}saveCustomEditor(e){return this.textFileService.save(this.resource,e)}async saveCustomEditorAs(e,t,i){return!!await this.textFileService.saveAs(e,t,i)}};s=l([h(3,m)],s);export{s as CustomTextEditorModel};
