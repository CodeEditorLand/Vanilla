var p=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var v=(a,r,e,i)=>{for(var t=i>1?void 0:i?u(r,e):r,o=a.length-1,s;o>=0;o--)(s=a[o])&&(t=(i?s(r,e,t):s(t))||t);return i&&t&&p(r,e,t),t},l=(a,r)=>(e,i)=>r(e,i,a);import{Emitter as d}from"../../../../base/common/event.js";import"../../../../base/common/htmlContent.js";import{Disposable as m}from"../../../../base/common/lifecycle.js";import{basename as g}from"../../../../base/common/path.js";import{isEqual as I}from"../../../../base/common/resources.js";import"../../../../base/common/uri.js";import{ITextModelService as y}from"../../../../editor/common/services/resolverService.js";import{localize as _}from"../../../../nls.js";import"../../../../platform/instantiation/common/instantiation.js";import{ILabelService as f}from"../../../../platform/label/common/label.js";import"../../../common/editor.js";import"./customEditor.js";import{IExtensionService as b}from"../../../../workbench/services/extensions/common/extensions.js";import{ITextFileService as x,TextFileEditorModelState as D}from"../../../services/textfile/common/textfiles.js";let n=class extends m{constructor(e,i,t,o,s,c){super();this.viewType=e;this._resource=i;this._model=t;this.textFileService=o;this._labelService=s;this._register(t),this._textFileModel=this.textFileService.files.get(i),this._textFileModel&&(this._register(this._textFileModel.onDidChangeOrphaned(()=>this._onDidChangeOrphaned.fire())),this._register(this._textFileModel.onDidChangeReadonly(()=>this._onDidChangeReadonly.fire()))),this._register(this.textFileService.files.onDidChangeDirty(h=>{I(this.resource,h.resource)&&(this._onDidChangeDirty.fire(),this._onDidChangeContent.fire())})),this._register(c.onWillStop(h=>{h.veto(!0,_("vetoExtHostRestart","A custom text editor for '{0}' is open.",this.resource.path))}))}static async create(e,i,t){return e.invokeFunction(async o=>{const c=await o.get(y).createModelReference(t);return e.createInstance(n,i,t,c)})}_textFileModel;_onDidChangeOrphaned=this._register(new d);onDidChangeOrphaned=this._onDidChangeOrphaned.event;_onDidChangeReadonly=this._register(new d);onDidChangeReadonly=this._onDidChangeReadonly.event;get resource(){return this._resource}get name(){return g(this._labelService.getUriLabel(this._resource))}isReadonly(){return this._model.object.isReadonly()}get backupId(){}get canHotExit(){return!0}isDirty(){return this.textFileService.isDirty(this.resource)}isOrphaned(){return!!this._textFileModel?.hasState(D.ORPHAN)}_onDidChangeDirty=this._register(new d);onDidChangeDirty=this._onDidChangeDirty.event;_onDidChangeContent=this._register(new d);onDidChangeContent=this._onDidChangeContent.event;async revert(e){return this.textFileService.revert(this.resource,e)}saveCustomEditor(e){return this.textFileService.save(this.resource,e)}async saveCustomEditorAs(e,i,t){return!!await this.textFileService.saveAs(e,i,t)}};n=v([l(3,x),l(4,f),l(5,b)],n);export{n as CustomTextEditorModel};
