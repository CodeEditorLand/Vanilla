var ce=Object.defineProperty;var ue=Object.getOwnPropertyDescriptor;var f=(d,u,t,r)=>{for(var s=r>1?void 0:r?ue(u,t):u,i=d.length-1,a;i>=0;i--)(a=d[i])&&(s=(r?a(u,t,s):a(s))||s);return r&&s&&ce(u,t,s),s},o=(d,u)=>(t,r)=>u(t,r,d);import"vs/css!./media/workspaceTrustEditor";import{Codicon as I}from"../../../../../vs/base/common/codicons.js";import{MarkdownString as y}from"../../../../../vs/base/common/htmlContent.js";import{Disposable as W,MutableDisposable as de}from"../../../../../vs/base/common/lifecycle.js";import{dirname as Y,resolve as pe}from"../../../../../vs/base/common/path.js";import{isWeb as le}from"../../../../../vs/base/common/platform.js";import{basename as me,dirname as he}from"../../../../../vs/base/common/resources.js";import{URI as ke}from"../../../../../vs/base/common/uri.js";import{localize as e,localize2 as F}from"../../../../../vs/nls.js";import{Action2 as $,registerAction2 as z}from"../../../../../vs/platform/actions/common/actions.js";import{ICommandService as Se}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as fe}from"../../../../../vs/platform/configuration/common/configuration.js";import{Extensions as ge,ConfigurationScope as g}from"../../../../../vs/platform/configuration/common/configurationRegistry.js";import{ContextKeyExpr as E,IContextKeyService as we}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IDialogService as V}from"../../../../../vs/platform/dialogs/common/dialogs.js";import{IEnvironmentService as ve}from"../../../../../vs/platform/environment/common/environment.js";import{IFileService as be}from"../../../../../vs/platform/files/common/files.js";import{SyncDescriptor as Te}from"../../../../../vs/platform/instantiation/common/descriptors.js";import{IInstantiationService as Ie}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{ILabelService as ye,Verbosity as We}from"../../../../../vs/platform/label/common/label.js";import{Severity as C}from"../../../../../vs/platform/notification/common/notification.js";import{IProductService as Ee}from"../../../../../vs/platform/product/common/productService.js";import{Registry as h}from"../../../../../vs/platform/registry/common/platform.js";import{IStorageService as Ce,StorageScope as R,StorageTarget as j}from"../../../../../vs/platform/storage/common/storage.js";import{ITelemetryService as Re}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{isVirtualWorkspace as Me}from"../../../../../vs/platform/workspace/common/virtualWorkspace.js";import{isEmptyWorkspaceIdentifier as De,isSingleFolderWorkspaceIdentifier as P,IWorkspaceContextService as O,toWorkspaceIdentifier as x,WorkbenchState as p}from"../../../../../vs/platform/workspace/common/workspace.js";import{IWorkspaceTrustEnablementService as L,IWorkspaceTrustManagementService as M,IWorkspaceTrustRequestService as H,WorkspaceTrustUriResponse as _}from"../../../../../vs/platform/workspace/common/workspaceTrust.js";import{EditorPaneDescriptor as Ae}from"../../../../../vs/workbench/browser/editor.js";import{securityConfigurationNodeBase as Fe}from"../../../../../vs/workbench/common/configuration.js";import{registerWorkbenchContribution2 as Pe,Extensions as B,WorkbenchPhase as Oe}from"../../../../../vs/workbench/common/contributions.js";import{EditorExtensions as J}from"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/common/editor/editorInput.js";import{LIST_WORKSPACE_UNSUPPORTED_EXTENSIONS_COMMAND_ID as q}from"../../../../../vs/workbench/contrib/extensions/common/extensions.js";import{WORKSPACE_TRUST_SETTING_TAG as k}from"../../../../../vs/workbench/contrib/preferences/common/preferences.js";import{shieldIcon as xe,WorkspaceTrustEditor as Q}from"../../../../../vs/workbench/contrib/workspace/browser/workspaceTrustEditor.js";import{MANAGE_TRUST_COMMAND_ID as m,WorkspaceTrustContext as D}from"../../../../../vs/workbench/contrib/workspace/common/workspace.js";import{IBannerService as Le}from"../../../../../vs/workbench/services/banner/browser/bannerService.js";import{IEditorService as _e}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as Be}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IHostService as qe}from"../../../../../vs/workbench/services/host/browser/host.js";import{LifecyclePhase as N}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";import{IPreferencesService as Ne}from"../../../../../vs/workbench/services/preferences/common/preferences.js";import{IRemoteAgentService as Ue}from"../../../../../vs/workbench/services/remote/common/remoteAgentService.js";import{IStatusbarService as Ke,StatusbarAlignment as Ge}from"../../../../../vs/workbench/services/statusbar/browser/statusbar.js";import{WorkspaceTrustEditorInput as A}from"../../../../../vs/workbench/services/workspaces/browser/workspaceTrustEditorInput.js";import{WORKSPACE_TRUST_BANNER as Z,WORKSPACE_TRUST_EMPTY_WINDOW as X,WORKSPACE_TRUST_ENABLED as U,WORKSPACE_TRUST_STARTUP_PROMPT as ee,WORKSPACE_TRUST_UNTRUSTED_FILES as te}from"../../../../../vs/workbench/services/workspaces/common/workspaceTrust.js";const re="workbench.banner.restrictedMode",se="workspace.trust.startupPrompt.shown",oe="workbench.banner.restrictedMode.dismissed";let w=class extends W{_ctxWorkspaceTrustEnabled;_ctxWorkspaceTrustState;constructor(u,t,r){super(),this._ctxWorkspaceTrustEnabled=D.IsEnabled.bindTo(u),this._ctxWorkspaceTrustEnabled.set(t.isWorkspaceTrustEnabled()),this._ctxWorkspaceTrustState=D.IsTrusted.bindTo(u),this._ctxWorkspaceTrustState.set(r.isWorkspaceTrusted()),this._register(r.onDidChangeTrust(s=>this._ctxWorkspaceTrustState.set(s)))}};w=f([o(0,we),o(1,L),o(2,M)],w),h.as(B.Workbench).registerWorkbenchContribution(w,N.Restored);let S=class extends W{constructor(t,r,s,i,a){super();this.dialogService=t;this.commandService=r;this.workspaceContextService=s;this.workspaceTrustManagementService=i;this.workspaceTrustRequestService=a;this.registerListeners()}static ID="workbench.contrib.workspaceTrustRequestHandler";get useWorkspaceLanguage(){return!P(x(this.workspaceContextService.getWorkspace()))}registerListeners(){this._register(this.workspaceTrustRequestService.onDidInitiateOpenFilesTrustRequest(async()=>{await this.workspaceTrustManagementService.workspaceResolved;const t=[this.workspaceContextService.getWorkbenchState()!==p.EMPTY?e("openLooseFileWorkspaceDetails","You are trying to open untrusted files in a workspace which is trusted."):e("openLooseFileWindowDetails","You are trying to open untrusted files in a window which is trusted."),e("openLooseFileLearnMore","If you don't want to open untrusted files, we recommend to open them in Restricted Mode in a new window as the files may be malicious. See [our docs](https://aka.ms/vscode-workspace-trust) to learn more.")];await this.dialogService.prompt({type:C.Info,message:this.workspaceContextService.getWorkbenchState()!==p.EMPTY?e("openLooseFileWorkspaceMesssage","Do you want to allow untrusted files in this workspace?"):e("openLooseFileWindowMesssage","Do you want to allow untrusted files in this window?"),buttons:[{label:e({key:"open",comment:["&& denotes a mnemonic"]},"&&Open"),run:({checkboxChecked:r})=>this.workspaceTrustRequestService.completeOpenFilesTrustRequest(_.Open,!!r)},{label:e({key:"newWindow",comment:["&& denotes a mnemonic"]},"Open in &&Restricted Mode"),run:({checkboxChecked:r})=>this.workspaceTrustRequestService.completeOpenFilesTrustRequest(_.OpenInNewWindow,!!r)}],cancelButton:{run:()=>this.workspaceTrustRequestService.completeOpenFilesTrustRequest(_.Cancel)},checkbox:{label:e("openLooseFileWorkspaceCheckbox","Remember my decision for all workspaces"),checked:!1},custom:{icon:I.shield,markdownDetails:t.map(r=>({markdown:new y(r)}))}})})),this._register(this.workspaceTrustRequestService.onDidInitiateWorkspaceTrustRequest(async t=>{await this.workspaceTrustManagementService.workspaceResolved;const r=this.useWorkspaceLanguage?e("workspaceTrust","Do you trust the authors of the files in this workspace?"):e("folderTrust","Do you trust the authors of the files in this folder?"),s=e("immediateTrustRequestMessage","A feature you are trying to use may be a security risk if you do not trust the source of the files or folders you currently have open."),i=t?.message??s,a=t?.buttons??[{label:this.useWorkspaceLanguage?e({key:"grantWorkspaceTrustButton",comment:["&& denotes a mnemonic"]},"&&Trust Workspace & Continue"):e({key:"grantFolderTrustButton",comment:["&& denotes a mnemonic"]},"&&Trust Folder & Continue"),type:"ContinueWithTrust"},{label:e({key:"manageWorkspaceTrustButton",comment:["&& denotes a mnemonic"]},"&&Manage"),type:"Manage"}];a.some(c=>c.type==="Cancel")||a.push({label:e("cancelWorkspaceTrustButton","Cancel"),type:"Cancel"});const{result:n}=await this.dialogService.prompt({type:C.Info,message:r,custom:{icon:I.shield,markdownDetails:[{markdown:new y(i)},{markdown:new y(e("immediateTrustRequestLearnMore","If you don't trust the authors of these files, we do not recommend continuing as the files may be malicious. See [our docs](https://aka.ms/vscode-workspace-trust) to learn more."))}]},buttons:a.filter(c=>c.type!=="Cancel").map(c=>({label:c.label,run:()=>c.type})),cancelButton:(()=>{const c=a.find(l=>l.type==="Cancel");if(c)return{label:c.label,run:()=>c.type}})()});switch(n){case"ContinueWithTrust":await this.workspaceTrustRequestService.completeWorkspaceTrustRequest(!0);break;case"ContinueWithoutTrust":await this.workspaceTrustRequestService.completeWorkspaceTrustRequest(void 0);break;case"Manage":this.workspaceTrustRequestService.cancelWorkspaceTrustRequest(),await this.commandService.executeCommand(m);break;case"Cancel":this.workspaceTrustRequestService.cancelWorkspaceTrustRequest();break}}))}};S=f([o(0,V),o(1,Se),o(2,O),o(3,M),o(4,H)],S);let v=class extends W{constructor(t,r,s,i,a,n,c,l,T,K,G,ze,Ve,je,He){super();this.dialogService=t;this.workspaceContextService=r;this.workspaceTrustEnablementService=s;this.workspaceTrustManagementService=i;this.configurationService=a;this.statusbarService=n;this.storageService=c;this.workspaceTrustRequestService=l;this.bannerService=T;this.labelService=K;this.hostService=G;this.productService=ze;this.remoteAgentService=Ve;this.environmentService=je;this.fileService=He;this.statusbarEntryAccessor=this._register(new de),(async()=>{if(await this.workspaceTrustManagementService.workspaceTrustInitialized,this.workspaceTrustEnablementService.isWorkspaceTrustEnabled())if(this.registerListeners(),this.updateStatusbarEntry(this.workspaceTrustManagementService.isWorkspaceTrusted()),this.hostService.hasFocus)this.showModalOnStart();else{const ie=this.hostService.onDidChangeFocus(ne=>{ne&&(ie.dispose(),this.showModalOnStart())})}})()}entryId="status.workspaceTrust";statusbarEntryAccessor;registerListeners(){this._register(this.workspaceContextService.onWillChangeWorkspaceFolders(t=>{if(t.fromCache||!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled())return;const r=async s=>{if(this.workspaceTrustManagementService.isWorkspaceTrusted()&&(s.changes.added.length||s.changes.changed.length)){const a=await Promise.all(s.changes.added.map(n=>this.workspaceTrustManagementService.getUriTrustInfo(n.uri)));if(!a.map(n=>n.trusted).every(n=>n)){const{confirmed:n}=await this.dialogService.confirm({type:C.Info,message:e("addWorkspaceFolderMessage","Do you trust the authors of the files in this folder?"),detail:e("addWorkspaceFolderDetail","You are adding files that are not currently trusted to a trusted workspace. Do you trust the authors of these new files?"),cancelButton:e("no","No"),custom:{icon:I.shield}});await this.workspaceTrustManagementService.setUrisTrust(a.map(c=>c.uri),n)}}};return t.join(r(t))})),this._register(this.workspaceTrustManagementService.onDidChangeTrust(t=>{this.updateWorkbenchIndicators(t)})),this._register(this.workspaceTrustRequestService.onDidInitiateWorkspaceTrustRequestOnStartup(async()=>{let t,r,s,i;const a=await this.isAiGeneratedWorkspace();a&&this.productService.aiGeneratedWorkspaceTrust?(t=this.productService.aiGeneratedWorkspaceTrust.title,r=this.productService.aiGeneratedWorkspaceTrust.startupTrustRequestLearnMore,s=this.productService.aiGeneratedWorkspaceTrust.trustOption,i=this.productService.aiGeneratedWorkspaceTrust.dontTrustOption):console.warn("AI generated workspace trust dialog contents not available.");const n=t??(this.useWorkspaceLanguage?e("workspaceTrust","Do you trust the authors of the files in this workspace?"):e("folderTrust","Do you trust the authors of the files in this folder?"));let c;const l=x(this.workspaceContextService.getWorkspace()),T=P(l),K=De(l);if(!a&&this.workspaceTrustManagementService.canSetParentFolderTrust()){const G=me(he(l.uri));c=e("checkboxString","Trust the authors of all files in the parent folder '{0}'",G)}this.doShowModal(n,{label:s??e({key:"trustOption",comment:["&& denotes a mnemonic"]},"&&Yes, I trust the authors"),sublabel:T?e("trustFolderOptionDescription","Trust folder and enable all features"):e("trustWorkspaceOptionDescription","Trust workspace and enable all features")},{label:i??e({key:"dontTrustOption",comment:["&& denotes a mnemonic"]},"&&No, I don't trust the authors"),sublabel:T?e("dontTrustFolderOptionDescription","Browse folder in restricted mode"):e("dontTrustWorkspaceOptionDescription","Browse workspace in restricted mode")},[T?e("folderStartupTrustDetails","{0} provides features that may automatically execute files in this folder.",this.productService.nameShort):e("workspaceStartupTrustDetails","{0} provides features that may automatically execute files in this workspace.",this.productService.nameShort),r??e("startupTrustRequestLearnMore","If you don't trust the authors of these files, we recommend to continue in restricted mode as the files may be malicious. See [our docs](https://aka.ms/vscode-workspace-trust) to learn more."),K?"":`\`${this.labelService.getWorkspaceLabel(l,{verbose:We.LONG})}\``],c)}))}updateWorkbenchIndicators(t){const r=this.getBannerItem(!t);this.updateStatusbarEntry(t),r&&(t?this.bannerService.hide(re):this.bannerService.show(r))}async doShowModal(t,r,s,i,a){await this.dialogService.prompt({type:C.Info,message:t,checkbox:a?{label:a}:void 0,buttons:[{label:r.label,run:async({checkboxChecked:n})=>{n?await this.workspaceTrustManagementService.setParentFolderTrust(!0):await this.workspaceTrustRequestService.completeWorkspaceTrustRequest(!0)}},{label:s.label,run:()=>{this.updateWorkbenchIndicators(!1),this.workspaceTrustRequestService.cancelWorkspaceTrustRequest()}}],custom:{buttonDetails:[r.sublabel,s.sublabel],disableCloseAction:!0,icon:I.shield,markdownDetails:i.map(n=>({markdown:new y(n)}))}}),this.storageService.store(se,!0,R.WORKSPACE,j.MACHINE)}async showModalOnStart(){if(this.workspaceTrustManagementService.isWorkspaceTrusted()){this.updateWorkbenchIndicators(!0);return}if(this.workspaceTrustManagementService.canSetWorkspaceTrust()){if(Me(this.workspaceContextService.getWorkspace())){this.updateWorkbenchIndicators(!1);return}if(this.workspaceContextService.getWorkbenchState()===p.EMPTY){this.updateWorkbenchIndicators(!1);return}if(this.startupPromptSetting==="never"){this.updateWorkbenchIndicators(!1);return}if(this.startupPromptSetting==="once"&&this.storageService.getBoolean(se,R.WORKSPACE,!1)){this.updateWorkbenchIndicators(!1);return}this.workspaceTrustRequestService.requestWorkspaceTrustOnStartup()}}get startupPromptSetting(){return this.configurationService.getValue(ee)}get useWorkspaceLanguage(){return!P(x(this.workspaceContextService.getWorkspace()))}async isAiGeneratedWorkspace(){const t=ke.joinPath(this.environmentService.workspaceStorageHome,"aiGeneratedWorkspaces.json");return await this.fileService.exists(t).then(async r=>{if(r)try{const s=await this.fileService.readFile(t);if(JSON.parse(s.value.toString()).indexOf(this.workspaceContextService.getWorkspace().folders[0].uri.toString())>-1)return!0}catch{}return!1})}getBannerItem(t){const r=this.storageService.getBoolean(oe,R.WORKSPACE,!1);if(this.bannerSetting==="never"||this.bannerSetting==="untilDismissed"&&r)return;const s=[{label:e("restrictedModeBannerManage","Manage"),href:"command:"+m},{label:e("restrictedModeBannerLearnMore","Learn More"),href:"https://aka.ms/vscode-workspace-trust"}];return{id:re,icon:xe,ariaLabel:this.getBannerItemAriaLabels(),message:this.getBannerItemMessages(),actions:s,onClose:()=>{t&&this.storageService.store(oe,!0,R.WORKSPACE,j.MACHINE)}}}getBannerItemAriaLabels(){switch(this.workspaceContextService.getWorkbenchState()){case p.EMPTY:return e("restrictedModeBannerAriaLabelWindow","Restricted Mode is intended for safe code browsing. Trust this window to enable all features. Use navigation keys to access banner actions.");case p.FOLDER:return e("restrictedModeBannerAriaLabelFolder","Restricted Mode is intended for safe code browsing. Trust this folder to enable all features. Use navigation keys to access banner actions.");case p.WORKSPACE:return e("restrictedModeBannerAriaLabelWorkspace","Restricted Mode is intended for safe code browsing. Trust this workspace to enable all features. Use navigation keys to access banner actions.")}}getBannerItemMessages(){switch(this.workspaceContextService.getWorkbenchState()){case p.EMPTY:return e("restrictedModeBannerMessageWindow","Restricted Mode is intended for safe code browsing. Trust this window to enable all features.");case p.FOLDER:return e("restrictedModeBannerMessageFolder","Restricted Mode is intended for safe code browsing. Trust this folder to enable all features.");case p.WORKSPACE:return e("restrictedModeBannerMessageWorkspace","Restricted Mode is intended for safe code browsing. Trust this workspace to enable all features.")}}get bannerSetting(){const t=this.configurationService.getValue(Z);return t!=="always"&&le&&!this.remoteAgentService.getConnection()?.remoteAuthority?"never":t}getRestrictedModeStatusbarEntry(){let t="",r;switch(this.workspaceContextService.getWorkbenchState()){case p.EMPTY:{t=e("status.ariaUntrustedWindow","Restricted Mode: Some features are disabled because this window is not trusted."),r={value:e({key:"status.tooltipUntrustedWindow2",comment:["[abc]({n}) are links.  Only translate `features are disabled` and `window is not trusted`. Do not change brackets and parentheses or {n}"]},`Running in Restricted Mode

Some [features are disabled]({0}) because this [window is not trusted]({1}).`,`command:${q}`,`command:${m}`),isTrusted:!0,supportThemeIcons:!0};break}case p.FOLDER:{t=e("status.ariaUntrustedFolder","Restricted Mode: Some features are disabled because this folder is not trusted."),r={value:e({key:"status.tooltipUntrustedFolder2",comment:["[abc]({n}) are links.  Only translate `features are disabled` and `folder is not trusted`. Do not change brackets and parentheses or {n}"]},`Running in Restricted Mode

Some [features are disabled]({0}) because this [folder is not trusted]({1}).`,`command:${q}`,`command:${m}`),isTrusted:!0,supportThemeIcons:!0};break}case p.WORKSPACE:{t=e("status.ariaUntrustedWorkspace","Restricted Mode: Some features are disabled because this workspace is not trusted."),r={value:e({key:"status.tooltipUntrustedWorkspace2",comment:["[abc]({n}) are links. Only translate `features are disabled` and `workspace is not trusted`. Do not change brackets and parentheses or {n}"]},`Running in Restricted Mode

Some [features are disabled]({0}) because this [workspace is not trusted]({1}).`,`command:${q}`,`command:${m}`),isTrusted:!0,supportThemeIcons:!0};break}}return{name:e("status.WorkspaceTrust","Workspace Trust"),text:`$(shield) ${e("untrusted","Restricted Mode")}`,ariaLabel:t,tooltip:r,command:m,kind:"prominent"}}updateStatusbarEntry(t){if(t&&this.statusbarEntryAccessor.value){this.statusbarEntryAccessor.clear();return}if(!t&&!this.statusbarEntryAccessor.value){const r=this.getRestrictedModeStatusbarEntry();this.statusbarEntryAccessor.value=this.statusbarService.addEntry(r,this.entryId,Ge.LEFT,.99*Number.MAX_VALUE)}}};v=f([o(0,V),o(1,O),o(2,L),o(3,M),o(4,fe),o(5,Ke),o(6,Ce),o(7,H),o(8,Le),o(9,ye),o(10,qe),o(11,Ee),o(12,Ue),o(13,ve),o(14,be)],v),Pe(S.ID,S,Oe.BlockRestore),h.as(B.Workbench).registerWorkbenchContribution(v,N.Restored);class Ye{canSerialize(u){return!0}serialize(u){return""}deserialize(u){return u.createInstance(A)}}h.as(J.EditorFactory).registerEditorSerializer(A.ID,Ye),h.as(J.EditorPane).registerEditorPane(Ae.create(Q,Q.ID,e("workspaceTrustEditor","Workspace Trust Editor")),[new Te(A)]);const $e="workbench.trust.configure",ae=F("workspacesCategory","Workspaces");z(class extends ${constructor(){super({id:$e,title:F("configureWorkspaceTrustSettings","Configure Workspace Trust Settings"),precondition:E.and(D.IsEnabled,E.equals(`config.${U}`,!0)),category:ae,f1:!0})}run(d){d.get(Ne).openUserSettings({jsonEditor:!1,query:`@tag:${k}`})}}),z(class extends ${constructor(){super({id:m,title:F("manageWorkspaceTrust","Manage Workspace Trust"),precondition:E.and(D.IsEnabled,E.equals(`config.${U}`,!0)),category:ae,f1:!0})}run(d){const u=d.get(_e),r=d.get(Ie).createInstance(A);u.openEditor(r,{pinned:!0})}}),h.as(ge.Configuration).registerConfiguration({...Fe,properties:{[U]:{type:"boolean",default:!0,description:e("workspace.trust.description","Controls whether or not Workspace Trust is enabled within VS Code."),tags:[k],scope:g.APPLICATION},[ee]:{type:"string",default:"once",description:e("workspace.trust.startupPrompt.description","Controls when the startup prompt to trust a workspace is shown."),tags:[k],scope:g.APPLICATION,enum:["always","once","never"],enumDescriptions:[e("workspace.trust.startupPrompt.always","Ask for trust every time an untrusted workspace is opened."),e("workspace.trust.startupPrompt.once","Ask for trust the first time an untrusted workspace is opened."),e("workspace.trust.startupPrompt.never","Do not ask for trust when an untrusted workspace is opened.")]},[Z]:{type:"string",default:"untilDismissed",description:e("workspace.trust.banner.description","Controls when the restricted mode banner is shown."),tags:[k],scope:g.APPLICATION,enum:["always","untilDismissed","never"],enumDescriptions:[e("workspace.trust.banner.always","Show the banner every time an untrusted workspace is open."),e("workspace.trust.banner.untilDismissed","Show the banner when an untrusted workspace is opened until dismissed."),e("workspace.trust.banner.never","Do not show the banner when an untrusted workspace is open.")]},[te]:{type:"string",default:"prompt",markdownDescription:e("workspace.trust.untrustedFiles.description","Controls how to handle opening untrusted files in a trusted workspace. This setting also applies to opening files in an empty window which is trusted via `#{0}#`.",X),tags:[k],scope:g.APPLICATION,enum:["prompt","open","newWindow"],enumDescriptions:[e("workspace.trust.untrustedFiles.prompt","Ask how to handle untrusted files for each workspace. Once untrusted files are introduced to a trusted workspace, you will not be prompted again."),e("workspace.trust.untrustedFiles.open","Always allow untrusted files to be introduced to a trusted workspace without prompting."),e("workspace.trust.untrustedFiles.newWindow","Always open untrusted files in a separate window in restricted mode without prompting.")]},[X]:{type:"boolean",default:!0,markdownDescription:e("workspace.trust.emptyWindow.description","Controls whether or not the empty window is trusted by default within VS Code. When used with `#{0}#`, you can enable the full functionality of VS Code without prompting in an empty window.",te),tags:[k],scope:g.APPLICATION}}});let b=class extends W{constructor(t,r,s,i,a){super();this.environmentService=t;this.telemetryService=r;this.workspaceContextService=s;this.workspaceTrustEnablementService=i;this.workspaceTrustManagementService=a;this.workspaceTrustManagementService.workspaceTrustInitialized.then(()=>{this.logInitialWorkspaceTrustInfo(),this.logWorkspaceTrust(this.workspaceTrustManagementService.isWorkspaceTrusted()),this._register(this.workspaceTrustManagementService.onDidChangeTrust(n=>this.logWorkspaceTrust(n)))})}logInitialWorkspaceTrustInfo(){if(!this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()){const t=this.environmentService.disableWorkspaceTrust;this.telemetryService.publicLog2("workspaceTrustDisabled",{reason:t?"cli":"setting"});return}this.telemetryService.publicLog2("workspaceTrustFolderCounts",{trustedFoldersCount:this.workspaceTrustManagementService.getTrustedUris().length})}async logWorkspaceTrust(t){if(this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&(this.telemetryService.publicLog2("workspaceTrustStateChanged",{workspaceId:this.workspaceContextService.getWorkspace().id,isTrusted:t}),t)){const r=s=>{let i=pe(s),a=0;for(;Y(i)!==i&&a<100;)i=Y(i),a++;return a};for(const s of this.workspaceContextService.getWorkspace().folders){const{trusted:i,uri:a}=await this.workspaceTrustManagementService.getUriTrustInfo(s.uri);if(!i)continue;const n=r(s.uri.fsPath),c=r(a.fsPath),l=n-c;this.telemetryService.publicLog2("workspaceFolderDepthBelowTrustedFolder",{workspaceFolderDepth:n,trustedFolderDepth:c,delta:l})}}}};b=f([o(0,Be),o(1,Re),o(2,O),o(3,L),o(4,M)],b),h.as(B.Workbench).registerWorkbenchContribution(b,N.Restored);export{w as WorkspaceTrustContextKeys,S as WorkspaceTrustRequestHandler,v as WorkspaceTrustUXHandler};
