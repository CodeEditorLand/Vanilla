var pe=Object.defineProperty;var fe=Object.getOwnPropertyDescriptor;var k=(w,v,e,t)=>{for(var i=t>1?void 0:t?fe(v,e):v,s=w.length-1,r;s>=0;s--)(r=w[s])&&(i=(t?r(v,e,i):r(i))||i);return t&&i&&pe(v,e,i),i},h=(w,v)=>(e,t)=>v(e,t,w);import*as a from"../../../../base/browser/dom.js";import{StandardKeyboardEvent as Te}from"../../../../base/browser/keyboardEvent.js";import{ActionBar as me}from"../../../../base/browser/ui/actionbar/actionbar.js";import*as Ee from"../../../../base/browser/ui/aria/aria.js";import{Button as ve}from"../../../../base/browser/ui/button/button.js";import{Action as Z}from"../../../../base/common/actions.js";import{Delayer as b}from"../../../../base/common/async.js";import{CancellationToken as Ie,CancellationTokenSource as ye}from"../../../../base/common/cancellation.js";import{fromNow as Ce}from"../../../../base/common/date.js";import{isCancellationError as Re}from"../../../../base/common/errors.js";import{Emitter as we,Event as ee}from"../../../../base/common/event.js";import{Iterable as Me}from"../../../../base/common/iterator.js";import{KeyCode as te}from"../../../../base/common/keyCodes.js";import{Disposable as De,DisposableStore as be,MutableDisposable as Oe,dispose as _e}from"../../../../base/common/lifecycle.js";import*as H from"../../../../base/common/platform.js";import{URI as U}from"../../../../base/common/uri.js";import"./media/settingsEditor2.css";import{Orientation as Fe,Sizing as Le,SplitView as xe}from"../../../../base/browser/ui/splitview/splitview.js";import{Color as ie}from"../../../../base/common/color.js";import{ThemeIcon as se}from"../../../../base/common/themables.js";import{ILanguageService as We}from"../../../../editor/common/languages/language.js";import{ITextResourceConfigurationService as Ne}from"../../../../editor/common/services/textResourceConfiguration.js";import{localize as I}from"../../../../nls.js";import{ICommandService as Ae}from"../../../../platform/commands/common/commands.js";import{ConfigurationTarget as S}from"../../../../platform/configuration/common/configuration.js";import{ConfigurationScope as re,Extensions as Ve}from"../../../../platform/configuration/common/configurationRegistry.js";import{IContextKeyService as Pe}from"../../../../platform/contextkey/common/contextkey.js";import{IExtensionGalleryService as Ue,IExtensionManagementService as Ge}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{IInstantiationService as ke}from"../../../../platform/instantiation/common/instantiation.js";import{ILogService as He}from"../../../../platform/log/common/log.js";import{IProductService as Be}from"../../../../platform/product/common/productService.js";import{IEditorProgressService as Ke}from"../../../../platform/progress/common/progress.js";import{Registry as $e}from"../../../../platform/registry/common/platform.js";import{IStorageService as ze,StorageScope as L,StorageTarget as ne}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as oe}from"../../../../platform/telemetry/common/telemetry.js";import{defaultButtonStyles as qe}from"../../../../platform/theme/browser/defaultStyles.js";import{asCssVariable as x,badgeBackground as je,badgeForeground as Ye,contrastBorder as Xe,editorForeground as Qe}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as Je}from"../../../../platform/theme/common/themeService.js";import{IUserDataSyncEnablementService as ae,IUserDataSyncService as Ze,SyncStatus as le}from"../../../../platform/userDataSync/common/userDataSync.js";import{IWorkspaceTrustManagementService as et}from"../../../../platform/workspace/common/workspaceTrust.js";import{registerNavigableContainer as tt}from"../../../browser/actions/widgetNavigationCommands.js";import{EditorPane as it}from"../../../browser/parts/editor/editorPane.js";import{IWorkbenchConfigurationService as st}from"../../../services/configuration/common/configuration.js";import{IEditorGroupsService as rt}from"../../../services/editor/common/editorGroupsService.js";import{IExtensionService as nt}from"../../../services/extensions/common/extensions.js";import{IPreferencesService as ot,SettingMatchType as at,SettingValueType as C,validateSettingsEditorOptions as lt}from"../../../services/preferences/common/preferences.js";import{Settings2EditorModel as ct,nullRange as W}from"../../../services/preferences/common/preferencesModels.js";import{IUserDataProfileService as ht}from"../../../services/userDataProfile/common/userDataProfile.js";import{IUserDataSyncWorkbenchService as dt}from"../../../services/userDataSync/common/userDataSync.js";import{SuggestEnabledInput as gt}from"../../codeEditor/browser/suggestEnabledInput/suggestEnabledInput.js";import{CONTEXT_SETTINGS_EDITOR as ut,CONTEXT_SETTINGS_ROW_FOCUS as St,CONTEXT_SETTINGS_SEARCH_FOCUS as pt,CONTEXT_TOC_ROW_FOCUS as ft,ENABLE_LANGUAGE_FILTER as Tt,EXTENSION_SETTING_TAG as B,FEATURE_SETTING_TAG as E,ID_SETTING_TAG as ce,IPreferencesSearchService as mt,LANGUAGE_SETTING_TAG as M,MODIFIED_SETTING_TAG as K,POLICY_SETTING_TAG as Et,REQUIRE_TRUSTED_WORKSPACE_SETTING_TAG as vt,SETTINGS_EDITOR_COMMAND_CLEAR_SEARCH_RESULTS as It,SETTINGS_EDITOR_COMMAND_SUGGEST_FILTERS as yt,WORKSPACE_TRUST_SETTING_TAG as Ct,getExperimentalExtensionToggleData as Rt}from"../common/preferences.js";import{settingsHeaderBorder as wt,settingsSashBorder as $,settingsTextInputBorder as Mt}from"../common/settingsEditorColorRegistry.js";import{preferencesClearInputIcon as Dt,preferencesFilterIcon as bt}from"./preferencesIcons.js";import{SettingsTargetsWidget as Ot}from"./preferencesWidgets.js";import{getCommonlyUsedData as _t,tocData as Ft}from"./settingsLayout.js";import{SettingsSearchFilterDropdownMenuActionViewItem as Lt}from"./settingsSearchMenu.js";import{AbstractSettingRenderer as G,SettingTreeRenderers as xt,SettingsTree as Wt,createTocTreeForExtensionSettings as Nt,resolveConfiguredUntrustedSettings as At,resolveSettingsTree as he}from"./settingsTree.js";import{SearchResultIdx as R,SearchResultModel as de,SettingsTreeGroupElement as ge,SettingsTreeModel as Vt,SettingsTreeSettingElement as z,parseQuery as q}from"./settingsTreeModels.js";import{TOCTree as Pt,TOCTreeModel as Ut,createTOCIterator as Gt}from"./tocTree.js";var kt=(i=>(i[i.Search=0]="Search",i[i.TableOfContents=1]="TableOfContents",i[i.SettingTree=2]="SettingTree",i[i.SettingControl=3]="SettingControl",i))(kt||{});function ue(w){return Me.map(w.children,v=>({element:v,children:v instanceof ge?ue(v):void 0}))}const p=a.$,j=I("SearchSettings.AriaLabel","Search settings"),Se="workbench.settings.settingsSearchTocBehavior",Ht="settingsEditorState";let c=class extends it{constructor(e,t,i,s,r,n,o,l,d,g,f,O,u,T,m,Y,A,_,F,V,X,P){super(c.ID,e,t,r,f);this.configurationService=i;this.preferencesService=n;this.instantiationService=o;this.preferencesSearchService=l;this.logService=d;this.storageService=f;this.editorGroupService=O;this.userDataSyncWorkbenchService=u;this.userDataSyncEnablementService=T;this.workspaceTrustManagementService=m;this.extensionService=Y;this.languageService=A;this.extensionManagementService=_;this.productService=F;this.extensionGalleryService=V;this.editorProgressService=X;this.delayedFilterLogging=new b(1e3),this.searchDelayer=new b(300),this.viewState={settingsTarget:S.USER_LOCAL},this.settingFastUpdateDelayer=new b(c.SETTING_UPDATE_FAST_DEBOUNCE),this.settingSlowUpdateDelayer=new b(c.SETTING_UPDATE_SLOW_DEBOUNCE),this.searchInputDelayer=new b(c.SEARCH_DEBOUNCE),this.updatedConfigSchemaDelayer=new b(c.CONFIG_SCHEMA_UPDATE_DELAYER),this.inSettingsEditorContextKey=ut.bindTo(g),this.searchFocusContextKey=pt.bindTo(g),this.tocRowFocused=ft.bindTo(g),this.settingRowFocused=St.bindTo(g),this.scheduledRefreshes=new Map,this.editorMemento=this.getEditorMemento(O,s,Ht),this.dismissedExtensionSettings=this.storageService.get(this.DISMISSED_EXTENSION_SETTINGS_STORAGE_KEY,L.PROFILE,"").split(this.DISMISSED_EXTENSION_SETTINGS_DELIMITER),this._register(i.onDidChangeConfiguration(y=>{y.source!==S.DEFAULT&&this.onConfigUpdate(y.affectedKeys)})),this._register(P.onDidChangeCurrentProfile(y=>{y.join(this.whenCurrentProfileChanged())})),this._register(m.onDidChangeTrust(()=>{this.searchResultModel?.updateWorkspaceTrust(m.isWorkspaceTrusted()),this.settingsTreeModel&&(this.settingsTreeModel.updateWorkspaceTrust(m.isWorkspaceTrusted()),this.renderTree())})),this._register(i.onDidChangeRestrictedSettings(y=>{y.default.length&&this.currentSettingsModel&&this.updateElementsByKey(new Set(y.default))})),this._register(_.onDidInstallExtensions(()=>{this.refreshInstalledExtensionsList()})),this._register(_.onDidUninstallExtension(()=>{this.refreshInstalledExtensionsList()})),this.modelDisposables=this._register(new be),Tt&&!c.SUGGESTIONS.includes(`@${M}`)&&c.SUGGESTIONS.push(`@${M}`),this.inputChangeListener=this._register(new Oe)}static ID="workbench.editor.settings2";static NUM_INSTANCES=0;static SEARCH_DEBOUNCE=200;static SETTING_UPDATE_FAST_DEBOUNCE=200;static SETTING_UPDATE_SLOW_DEBOUNCE=1e3;static CONFIG_SCHEMA_UPDATE_DELAYER=500;static TOC_MIN_WIDTH=100;static TOC_RESET_WIDTH=200;static EDITOR_MIN_WIDTH=500;static NARROW_TOTAL_WIDTH=this.TOC_RESET_WIDTH+this.EDITOR_MIN_WIDTH;static SUGGESTIONS=[`@${K}`,"@tag:notebookLayout","@tag:notebookOutputLayout",`@tag:${vt}`,`@tag:${Ct}`,"@tag:sync","@tag:usesOnlineServices","@tag:telemetry","@tag:accessibility",`@${ce}`,`@${B}`,`@${E}scm`,`@${E}explorer`,`@${E}search`,`@${E}debug`,`@${E}extensions`,`@${E}terminal`,`@${E}task`,`@${E}problems`,`@${E}output`,`@${E}comments`,`@${E}remote`,`@${E}timeline`,`@${E}notebook`,`@${Et}`];static shouldSettingUpdateFast(e){return Array.isArray(e)?!1:e===C.Enum||e===C.Array||e===C.BooleanObject||e===C.Object||e===C.Complex||e===C.Boolean||e===C.Exclude||e===C.Include}defaultSettingsEditorModel;modelDisposables;rootElement;headerContainer;bodyContainer;searchWidget;countElement;controlsElement;settingsTargetsWidget;splitView;settingsTreeContainer;settingsTree;settingRenderers;tocTreeModel;settingsTreeModel;noResultsMessage;clearFilterLinkContainer;tocTreeContainer;tocTree;delayedFilterLogging;searchDelayer;searchInProgress=null;searchInputDelayer;updatedConfigSchemaDelayer;settingFastUpdateDelayer;settingSlowUpdateDelayer;pendingSettingUpdate=null;viewState;_searchResultModel=null;searchResultLabel=null;lastSyncedLabel=null;settingsOrderByTocIndex=null;tocRowFocused;settingRowFocused;inSettingsEditorContextKey;searchFocusContextKey;scheduledRefreshes;_currentFocusContext=0;hasWarnedMissingSettings=!1;tocTreeDisposed=!1;editorMemento;tocFocusedElement=null;treeFocusedElement=null;settingsTreeScrollTop=0;dimension;installedExtensionIds=[];dismissedExtensionSettings=[];DISMISSED_EXTENSION_SETTINGS_STORAGE_KEY="settingsEditor2.dismissedExtensionSettings";DISMISSED_EXTENSION_SETTINGS_DELIMITER="	";inputChangeListener;async whenCurrentProfileChanged(){this.updatedConfigSchemaDelayer.trigger(()=>{this.dismissedExtensionSettings=this.storageService.get(this.DISMISSED_EXTENSION_SETTINGS_STORAGE_KEY,L.PROFILE,"").split(this.DISMISSED_EXTENSION_SETTINGS_DELIMITER),this.onConfigUpdate(void 0,!0)})}get minimumWidth(){return c.EDITOR_MIN_WIDTH}get maximumWidth(){return Number.POSITIVE_INFINITY}get minimumHeight(){return 180}set minimumWidth(e){}set maximumWidth(e){}get currentSettingsModel(){return this.searchResultModel||this.settingsTreeModel}get searchResultModel(){return this._searchResultModel}set searchResultModel(e){this._searchResultModel=e,this.rootElement.classList.toggle("search-mode",!!this._searchResultModel)}get focusedSettingDOMElement(){const e=this.settingsTree.getFocus()[0];if(e instanceof z)return this.settingRenderers.getDOMElementsForSettingKey(this.settingsTree.getHTMLElement(),e.setting.key)[0]}get currentFocusContext(){return this._currentFocusContext}createEditor(e){e.setAttribute("tabindex","-1"),this.rootElement=a.append(e,p(".settings-editor",{tabindex:"-1"})),this.createHeader(this.rootElement),this.createBody(this.rootElement),this.addCtrlAInterceptor(this.rootElement),this.updateStyles(),this._register(tt({name:"settingsEditor2",focusNotifiers:[this],focusNextWidget:()=>{this.searchWidget.inputWidget.hasWidgetFocus()&&this.focusTOC()},focusPreviousWidget:()=>{this.searchWidget.inputWidget.hasWidgetFocus()||this.focusSearch()}}))}async setInput(e,t,i,s){if(this.inSettingsEditorContextKey.set(!0),await super.setInput(e,t,i,s),!this.input)return;const r=await this.input.resolve();if(!(s.isCancellationRequested||!(r instanceof ct))){if(this.modelDisposables.clear(),this.modelDisposables.add(r.onDidChangeGroups(()=>{this.updatedConfigSchemaDelayer.trigger(()=>{this.onConfigUpdate(void 0,!1,!0)})})),this.defaultSettingsEditorModel=r,t=t||lt({}),!this.viewState.settingsTarget||!this.settingsTargetsWidget.settingsTarget){const n=t.viewState&&t.viewState.settingsTarget;!t.target&&!n&&(t.target=S.USER_LOCAL)}this._setOptions(t),this.onConfigUpdate(void 0,!0).then(()=>{this.inputChangeListener.value=e.onWillDispose(()=>{this.searchWidget.setValue("")}),this.updateTreeScrollSync()}),await this.refreshInstalledExtensionsList()}}async refreshInstalledExtensionsList(){const e=await this.extensionManagementService.getInstalled();this.installedExtensionIds=e.filter(t=>t.manifest.contributes?.configuration).map(t=>t.identifier.id)}restoreCachedState(){const e=this.input&&this.editorMemento.loadEditorState(this.group,this.input);if(e&&typeof e.target=="object"&&(e.target=U.revive(e.target)),e){const t=e.target;this.settingsTargetsWidget.settingsTarget=t,this.viewState.settingsTarget=t,this.searchWidget.getValue()||this.searchWidget.setValue(e.searchQuery)}return this.input&&this.editorMemento.clearEditorState(this.input,this.group),e??null}getViewState(){return this.viewState}setOptions(e){super.setOptions(e),e&&this._setOptions(e)}_setOptions(e){e.focusSearch&&!H.isIOS&&this.focusSearch();const t=e.viewState?e.viewState:void 0,i=t?.query??e.query;i!==void 0&&(this.searchWidget.setValue(i),this.viewState.query=i);const s=e.folderUri??t?.settingsTarget??e.target;s&&this.settingsTargetsWidget.updateTarget(s)}clearInput(){this.inSettingsEditorContextKey.set(!1),super.clearInput()}layout(e){if(this.dimension=e,!this.isVisible())return;this.layoutSplitView(e);const i=Math.min(this.headerContainer.clientWidth,e.width)-24*2-10-this.countElement.clientWidth-this.controlsElement.clientWidth-12;this.searchWidget.layout(new a.Dimension(i,20)),this.rootElement.classList.toggle("narrow-width",e.width<c.NARROW_TOTAL_WIDTH)}focus(){if(super.focus(),this._currentFocusContext===0)H.isIOS||this.focusSearch();else if(this._currentFocusContext===3){const e=this.focusedSettingDOMElement;if(e){const t=e.querySelector(G.CONTROL_SELECTOR);if(t){t.focus();return}}}else this._currentFocusContext===2?this.settingsTree.domFocus():this._currentFocusContext===1&&this.tocTree.domFocus()}setEditorVisible(e){super.setEditorVisible(e),e||setTimeout(()=>{this.searchWidget.onHide()},0)}focusSettings(e=!1){if(this.settingsTree.getFocus().length||this.settingsTree.focusFirst(),this.settingsTree.domFocus(),e){const i=this.settingsTree.getHTMLElement().querySelector(`.focused ${G.CONTROL_SELECTOR}`);i&&i.focus()}}focusTOC(){this.tocTree.domFocus()}showContextMenu(){const e=this.settingsTree.getFocus()[0],t=this.focusedSettingDOMElement;t&&e instanceof z&&this.settingRenderers.showContextMenu(e,t)}focusSearch(e,t=!0){e&&this.searchWidget&&this.searchWidget.setValue(e),this.searchWidget.focus(t&&!this.searchInputDelayer.isTriggered)}clearSearchResults(){this.searchWidget.setValue(""),this.focusSearch()}clearSearchFilters(){const t=this.searchWidget.getValue().split(" ").filter(i=>i.length&&!c.SUGGESTIONS.some(s=>i.startsWith(s)));this.searchWidget.setValue(t.join(" "))}updateInputAriaLabel(){let e=j;this.searchResultLabel&&(e+=`. ${this.searchResultLabel}`),this.lastSyncedLabel&&(e+=`. ${this.lastSyncedLabel}`),this.searchWidget.updateAriaLabel(e)}createHeader(e){this.headerContainer=a.append(e,p(".settings-header"));const t=a.append(this.headerContainer,p(".search-container")),i=new Z(It,I("clearInput","Clear Settings Search Input"),se.asClassName(Dt),!1,async()=>this.clearSearchResults()),s=new Z(yt,I("filterInput","Filter Settings"),se.asClassName(bt));this.searchWidget=this._register(this.instantiationService.createInstance(gt,`${c.ID}.searchbox`,t,{triggerCharacters:["@",":"],provideResults:l=>{const d=l.split(/\s/g);return d[d.length-1].startsWith(`@${M}`)?this.languageService.getRegisteredLanguageIds().map(f=>`@${M}${f} `).sort().filter(f=>!l.includes(f)):d[d.length-1].startsWith(`@${B}`)?this.installedExtensionIds.map(f=>`@${B}${f} `).sort().filter(f=>!l.includes(f)):d[d.length-1].startsWith("@")?c.SUGGESTIONS.filter(g=>!l.includes(g)).map(g=>g.endsWith(":")?g:g+" "):[]}},j,"settingseditor:searchinput"+c.NUM_INSTANCES++,{placeholderText:j,focusContextKey:this.searchFocusContextKey,styleOverrides:{inputBorder:Mt}})),this._register(this.searchWidget.onDidFocus(()=>{this._currentFocusContext=0})),this.countElement=a.append(t,a.$(".settings-count-widget.monaco-count-badge.long")),this.countElement.style.backgroundColor=x(je),this.countElement.style.color=x(Ye),this.countElement.style.border=`1px solid ${x(Xe)}`,this._register(this.searchWidget.onInputDidChange(()=>{const l=this.searchWidget.getValue();i.enabled=!!l,this.searchInputDelayer.trigger(()=>this.onSearchInputChanged())}));const r=a.append(this.headerContainer,p(".settings-header-controls"));r.style.borderColor=x(wt);const n=a.append(r,p(".settings-target-container"));if(this.settingsTargetsWidget=this._register(this.instantiationService.createInstance(Ot,n,{enableRemoteSettings:!0})),this.settingsTargetsWidget.settingsTarget=S.USER_LOCAL,this.settingsTargetsWidget.onDidTargetChange(l=>this.onDidSettingsTargetChange(l)),this._register(a.addDisposableListener(n,a.EventType.KEY_DOWN,l=>{new Te(l).keyCode===te.DownArrow&&this.focusSettings()})),this.userDataSyncWorkbenchService.enabled&&this.userDataSyncEnablementService.canToggleEnablement()){const l=this._register(this.instantiationService.createInstance(N,this.window,r));this._register(l.onDidChangeLastSyncedLabel(d=>{this.lastSyncedLabel=d,this.updateInputAriaLabel()}))}this.controlsElement=a.append(t,a.$(".settings-clear-widget")),this._register(new me(this.controlsElement,{actionViewItemProvider:(l,d)=>{if(l.id===s.id)return this.instantiationService.createInstance(Lt,l,d,this.actionRunner,this.searchWidget)}})).push([i,s],{label:!1,icon:!0})}onDidSettingsTargetChange(e){this.viewState.settingsTarget=e,this.onConfigUpdate(void 0,!0)}onDidDismissExtensionSetting(e){this.dismissedExtensionSettings.includes(e)||this.dismissedExtensionSettings.push(e),this.storageService.store(this.DISMISSED_EXTENSION_SETTINGS_STORAGE_KEY,this.dismissedExtensionSettings.join(this.DISMISSED_EXTENSION_SETTINGS_DELIMITER),L.PROFILE,ne.USER),this.onConfigUpdate(void 0,!0)}onDidClickSetting(e,t){const i=this.currentSettingsModel.getElementsByName(e.targetKey)?.[0];let s=!1;if(i){let r=.5;try{const n=this.settingsTree.getRelativeTop(e.source);n!==null&&(r=n)}catch{}this.viewState.filterToCategory&&e.source.displayCategory!==i.displayCategory&&this.tocTree.setFocus([]);try{this.settingsTree.reveal(i,r)}catch{s=!0}if(!s){setTimeout(()=>{this.settingsTree.setFocus([i])},50);const n=this.settingRenderers.getDOMElementsForSettingKey(this.settingsTree.getHTMLElement(),e.targetKey);if(n&&n[0]){const o=n[0].querySelector(G.CONTROL_SELECTOR);o&&o.focus()}}}!t&&(!i||s)&&this.triggerSearch("").then(()=>{this.searchWidget.setValue(""),this.onDidClickSetting(e,!0)})}switchToSettingsFile(){const e=q(this.searchWidget.getValue()).query;return this.openSettingsFile({query:e})}async openSettingsFile(e){const t=this.settingsTargetsWidget.settingsTarget,i={jsonEditor:!0,...e};if(t===S.USER_LOCAL)return e?.revealSetting&&$e.as(Ve.Configuration).getConfigurationProperties()[e?.revealSetting.key]?.scope===re.APPLICATION?this.preferencesService.openApplicationSettings(i):this.preferencesService.openUserSettings(i);if(t===S.USER_REMOTE)return this.preferencesService.openRemoteSettings(i);if(t===S.WORKSPACE)return this.preferencesService.openWorkspaceSettings(i);if(U.isUri(t))return this.preferencesService.openFolderSettings({folderUri:t,...i})}createBody(e){this.bodyContainer=a.append(e,p(".settings-body")),this.noResultsMessage=a.append(this.bodyContainer,p(".no-results-message")),this.noResultsMessage.innerText=I("noResults","No Settings Found"),this.clearFilterLinkContainer=p("span.clear-search-filters"),this.clearFilterLinkContainer.textContent=" - ";const t=a.append(this.clearFilterLinkContainer,p("a.pointer.prominent",{tabindex:0},I("clearSearchFilters","Clear Filters")));this._register(a.addDisposableListener(t,a.EventType.CLICK,r=>{a.EventHelper.stop(r,!1),this.clearSearchFilters()})),a.append(this.noResultsMessage,this.clearFilterLinkContainer),this.noResultsMessage.style.color=x(Qe),this.tocTreeContainer=p(".settings-toc-container"),this.settingsTreeContainer=p(".settings-tree-container"),this.createTOC(this.tocTreeContainer),this.createSettingsTree(this.settingsTreeContainer),this.splitView=this._register(new xe(this.bodyContainer,{orientation:Fe.HORIZONTAL,proportionalLayout:!0}));const i=this.storageService.getNumber("settingsEditor2.splitViewWidth",L.PROFILE,c.TOC_RESET_WIDTH);this.splitView.addView({onDidChange:ee.None,element:this.tocTreeContainer,minimumSize:c.TOC_MIN_WIDTH,maximumSize:Number.POSITIVE_INFINITY,layout:(r,n,o)=>{this.tocTreeContainer.style.width=`${r}px`,this.tocTree.layout(o,r)}},i,void 0,!0),this.splitView.addView({onDidChange:ee.None,element:this.settingsTreeContainer,minimumSize:c.EDITOR_MIN_WIDTH,maximumSize:Number.POSITIVE_INFINITY,layout:(r,n,o)=>{this.settingsTreeContainer.style.width=`${r}px`,this.settingsTree.layout(o,r)}},Le.Distribute,void 0,!0),this._register(this.splitView.onDidSashReset(()=>{const r=this.splitView.getViewSize(0)+this.splitView.getViewSize(1);this.splitView.resizeView(0,c.TOC_RESET_WIDTH),this.splitView.resizeView(1,r-c.TOC_RESET_WIDTH)})),this._register(this.splitView.onDidSashChange(()=>{const r=this.splitView.getViewSize(0);this.storageService.store("settingsEditor2.splitViewWidth",r,L.PROFILE,ne.USER)}));const s=this.theme.getColor($);this.splitView.style({separatorBorder:s})}addCtrlAInterceptor(e){this._register(a.addStandardDisposableListener(e,a.EventType.KEY_DOWN,t=>{t.keyCode===te.KeyA&&(H.isMacintosh?t.metaKey:t.ctrlKey)&&!a.isEditableElement(t.target)&&(t.browserEvent.stopPropagation(),t.browserEvent.preventDefault())}))}createTOC(e){this.tocTreeModel=this.instantiationService.createInstance(Ut,this.viewState),this.tocTree=this._register(this.instantiationService.createInstance(Pt,a.append(e,p(".settings-toc-wrapper",{role:"navigation","aria-label":I("settings","Settings")})),this.viewState)),this.tocTreeDisposed=!1,this._register(this.tocTree.onDidFocus(()=>{this._currentFocusContext=1})),this._register(this.tocTree.onDidChangeFocus(t=>{const i=t.elements?.[0]??null;this.tocFocusedElement!==i&&(this.tocFocusedElement=i,this.tocTree.setSelection(i?[i]:[]),this.searchResultModel?this.viewState.filterToCategory!==i&&(this.viewState.filterToCategory=i??void 0,this.renderTree(void 0,!0),this.settingsTree.scrollTop=0):i&&(!t.browserEvent||!t.browserEvent.fromScroll)&&(this.settingsTree.reveal(i,0),this.settingsTree.setFocus([i])))})),this._register(this.tocTree.onDidFocus(()=>{this.tocRowFocused.set(!0)})),this._register(this.tocTree.onDidBlur(()=>{this.tocRowFocused.set(!1)})),this._register(this.tocTree.onDidDispose(()=>{this.tocTreeDisposed=!0}))}applyFilter(e){if(this.searchWidget&&!this.searchWidget.getValue().includes(e)){const t=`${e} ${this.searchWidget.getValue().trimStart()}`;this.focusSearch(t,!1)}}removeLanguageFilters(){if(this.searchWidget&&this.searchWidget.getValue().includes(`@${M}`)){const t=this.searchWidget.getValue().split(" ").filter(i=>!i.startsWith(`@${M}`)).join(" ");this.focusSearch(t,!1)}}createSettingsTree(e){this.settingRenderers=this._register(this.instantiationService.createInstance(xt)),this._register(this.settingRenderers.onDidChangeSetting(t=>this.onDidChangeSetting(t.key,t.value,t.type,t.manualReset,t.scope))),this._register(this.settingRenderers.onDidDismissExtensionSetting(t=>this.onDidDismissExtensionSetting(t))),this._register(this.settingRenderers.onDidOpenSettings(t=>{this.openSettingsFile({revealSetting:{key:t,edit:!0}})})),this._register(this.settingRenderers.onDidClickSettingLink(t=>this.onDidClickSetting(t))),this._register(this.settingRenderers.onDidFocusSetting(t=>{this.settingsTree.setFocus([t]),this._currentFocusContext=3,this.settingRowFocused.set(!1)})),this._register(this.settingRenderers.onDidChangeSettingHeight(t=>{const{element:i,height:s}=t;try{this.settingsTree.updateElementHeight(i,s)}catch{}})),this._register(this.settingRenderers.onApplyFilter(t=>this.applyFilter(t))),this._register(this.settingRenderers.onDidClickOverrideElement(t=>{this.removeLanguageFilters(),t.language&&this.applyFilter(`@${M}${t.language}`),t.scope==="workspace"?this.settingsTargetsWidget.updateTarget(S.WORKSPACE):t.scope==="user"?this.settingsTargetsWidget.updateTarget(S.USER_LOCAL):t.scope==="remote"&&this.settingsTargetsWidget.updateTarget(S.USER_REMOTE),this.applyFilter(`@${ce}${t.settingKey}`)})),this.settingsTree=this._register(this.instantiationService.createInstance(Wt,e,this.viewState,this.settingRenderers.allRenderers)),this._register(this.settingsTree.onDidScroll(()=>{this.settingsTree.scrollTop!==this.settingsTreeScrollTop&&(this.settingsTreeScrollTop=this.settingsTree.scrollTop,setTimeout(()=>{this.updateTreeScrollSync()},0))})),this._register(this.settingsTree.onDidFocus(()=>{const t=e.ownerDocument.activeElement?.classList;t&&t.contains("monaco-list")&&t.contains("settings-editor-tree")&&(this._currentFocusContext=2,this.settingRowFocused.set(!0),this.treeFocusedElement??=this.settingsTree.firstVisibleElement??null,this.treeFocusedElement&&(this.treeFocusedElement.tabbable=!0))})),this._register(this.settingsTree.onDidBlur(()=>{this.settingRowFocused.set(!1),this.treeFocusedElement=null})),this._register(this.settingsTree.onDidChangeFocus(t=>{const i=t.elements[0];this.treeFocusedElement!==i&&(this.treeFocusedElement&&(this.treeFocusedElement.tabbable=!1),this.treeFocusedElement=i,this.treeFocusedElement&&(this.treeFocusedElement.tabbable=!0),this.settingsTree.setSelection(i?[i]:[]))}))}onDidChangeSetting(e,t,i,s,r){const o=q(this.searchWidget.getValue()).languageFilter;(s||this.pendingSettingUpdate&&this.pendingSettingUpdate.key!==e)&&this.updateChangedSetting(e,t,s,o,r),this.pendingSettingUpdate={key:e,value:t,languageFilter:o},c.shouldSettingUpdateFast(i)?this.settingFastUpdateDelayer.trigger(()=>this.updateChangedSetting(e,t,s,o,r)):this.settingSlowUpdateDelayer.trigger(()=>this.updateChangedSetting(e,t,s,o,r))}updateTreeScrollSync(){if(this.settingRenderers.cancelSuggesters(),this.searchResultModel||!this.tocTreeModel)return;const e=this.settingsTree.firstVisibleElement,t=e instanceof z?e.parent:e instanceof ge?e:null;let i=!0;try{this.tocTree.getNode(t)}catch{i=!1}if(i&&t&&this.tocTree.getSelection()[0]!==t){const s=this.getAncestors(t);s.forEach(o=>this.tocTree.expand(o)),this.tocTree.reveal(t);const r=this.tocTree.getRelativeTop(t);if(typeof r!="number")return;this.tocTree.collapseAll(),s.forEach(o=>this.tocTree.expand(o)),r<0||r>1?this.tocTree.reveal(t):this.tocTree.reveal(t,r),this.tocTree.expand(t),this.tocTree.setSelection([t]);const n=new KeyboardEvent("keydown");n.fromScroll=!0,this.tocTree.setFocus([t],n)}}getAncestors(e){const t=[];for(;e.parent;)e.parent.id!=="root"&&t.push(e.parent),e=e.parent;return t.reverse()}updateChangedSetting(e,t,i,s,r){const n=this.settingsTargetsWidget.settingsTarget,o=U.isUri(n)?n:void 0,l=(o?S.WORKSPACE_FOLDER:n)??S.USER_LOCAL,d={resource:o,overrideIdentifiers:s?[s]:void 0},f=l===S.WORKSPACE||l===S.WORKSPACE_FOLDER||!!s,O=f?i:t===void 0,u=this.configurationService.inspect(e,d);return!f&&u.defaultValue===t&&(t=void 0),this.configurationService.updateValue(e,t,d,l,{handleDirtyFile:"save"}).then(()=>{const T=this.searchWidget.getValue();T.includes(`@${K}`)&&this.refreshTOCTree(),this.renderTree(e,O);const m={key:e,query:T,searchResults:this.searchResultModel?.getUniqueResults()??null,rawResults:this.searchResultModel?.getRawResults()??null,showConfiguredOnly:!!this.viewState.tagFilters&&this.viewState.tagFilters.has(K),isReset:typeof t>"u",settingsTarget:this.settingsTargetsWidget.settingsTarget};return this.pendingSettingUpdate=null,this.reportModifiedSetting(m)})}reportModifiedSetting(e){let t,i,s;if(e.searchResults&&(s=e.searchResults.filterMatches.findIndex(o=>o.setting.key===e.key),this.searchResultModel)){const o=this.searchResultModel.getRawResults();if(o[R.Local]&&s>=0&&(t=o[R.Local].filterMatches.some(d=>d.setting.key===e.key)?"local":"remote"),o[R.Remote]){const l=o[R.Remote].filterMatches.findIndex(d=>d.setting.key===e.key);i=l>=0?l:void 0}}const r=e.settingsTarget===S.USER_LOCAL?"user":e.settingsTarget===S.USER_REMOTE?"user_remote":e.settingsTarget===S.WORKSPACE?"workspace":"folder",n={key:e.key,groupId:t,nlpIndex:i,displayIndex:s,showConfiguredOnly:e.showConfiguredOnly,isReset:e.isReset,target:r};this.telemetryService.publicLog2("settingsEditor.settingModified",n)}scheduleRefresh(e,t=""){if(t&&this.scheduledRefreshes.has(t))return;t||(_e(this.scheduledRefreshes.values()),this.scheduledRefreshes.clear());const i=a.trackFocus(e);this.scheduledRefreshes.set(t,i),i.onDidBlur(()=>{i.dispose(),this.scheduledRefreshes.delete(t),this.onConfigUpdate(new Set([t]))})}createSettingsOrderByTocIndex(e){const t=new Map;function i(s,r=0){if(s.settings)for(const n of s.settings)t.has(n.key)||t.set(n.key,r++);if(s.children)for(const n of s.children)r=i(n,r);return r}return i(e),t}refreshModels(e){this.settingsTreeModel.update(e),this.tocTreeModel.settingsTreeRoot=this.settingsTreeModel.root,this.settingsOrderByTocIndex=this.createSettingsOrderByTocIndex(e)}async onConfigUpdate(e,t=!1,i=!1){if(e&&this.settingsTreeModel)return this.updateElementsByKey(e);if(!this.defaultSettingsEditorModel)return;const s=this.defaultSettingsEditorModel.settingsGroups.slice(1),r=s.filter(u=>!u.extensionInfo),n=he(Ft,r,this.logService),o=n.tree;if(n.leftoverSettings.size&&!this.hasWarnedMissingSettings){const u=[];n.leftoverSettings.forEach(T=>{u.push(T.key)}),this.logService.warn(`SettingsEditor2: Settings not included in settingsLayout.ts: ${u.join(", ")}`),this.hasWarnedMissingSettings=!0}const l=[];let d=!1;const g=await Rt(this.extensionGalleryService,this.productService);if(g&&s.filter(u=>u.extensionInfo).length)for(const u in g.settingsEditorRecommendedExtensions){const T=g.recommendedExtensionsGalleryInfo[u];if(!T)continue;const m=T.identifier.id,Y=this.installedExtensionIds.includes(m),A=s.findIndex(D=>D.extensionInfo&&D.extensionInfo.id.toLowerCase()===m.toLowerCase()&&D.sections.length===1&&D.sections[0].settings.length===1&&D.sections[0].settings[0].displayExtensionId);if(Y||this.dismissedExtensionSettings.includes(m)){A!==-1&&(s.splice(A,1),d=!0);continue}if(A!==-1)continue;let _=null;try{_=await this.extensionGalleryService.getManifest(T,Ie.None)}catch{continue}const F=_?.contributes?.configuration;let V;Array.isArray(F)?F.length===1&&(V=F[0].title):V=F?.title;const X=g.settingsEditorRecommendedExtensions[u],P=T.displayName??T.name??m,y=`${u}.manageExtension`,Q={range:W,key:y,keyRange:W,value:null,valueRange:W,description:[X.onSettingsEditorOpen?.descriptionOverride??T.description],descriptionIsMarkdown:!1,descriptionRanges:[],scope:re.WINDOW,type:"null",displayExtensionId:m,extensionGroupTitle:V??P,categoryLabel:"Extensions",title:P},J={sections:[{settings:[Q]}],id:m,title:Q.extensionGroupTitle,titleRange:W,range:W,extensionInfo:{id:m,displayName:T.displayName}};s.push(J),l.push(J),d=!0}o.children.push(await Nt(this.extensionService,s.filter(u=>u.extensionInfo)));const f=_t(g),O=he(f,s,this.logService);if(o.children.unshift(O.tree),g&&d&&this.defaultSettingsEditorModel.setAdditionalGroups(l),!this.workspaceTrustManagementService.isWorkspaceTrusted()&&(this.viewState.settingsTarget instanceof U||this.viewState.settingsTarget===S.WORKSPACE)){const u=At(s,this.viewState.settingsTarget,this.viewState.languageFilter,this.configurationService);u.length&&o.children.unshift({id:"workspaceTrust",label:I("settings require trust","Workspace Trust"),settings:u})}if(this.searchResultModel?.updateChildren(),this.settingsTreeModel){if(this.refreshModels(o),i&&this.searchResultModel)return await this.onSearchInputChanged();this.refreshTOCTree(),this.renderTree(void 0,t)}else this.settingsTreeModel=this.instantiationService.createInstance(Vt,this.viewState,this.workspaceTrustManagementService.isWorkspaceTrusted()),this.refreshModels(o),(this.viewState.query?void 0:this.restoreCachedState())?.searchQuery||this.searchWidget.getValue()?await this.onSearchInputChanged():(this.refreshTOCTree(),this.refreshTree(),this.tocTree.collapseAll())}updateElementsByKey(e){e.size?(this.searchResultModel&&e.forEach(t=>this.searchResultModel.updateElementsByName(t)),this.settingsTreeModel&&e.forEach(t=>this.settingsTreeModel.updateElementsByName(t)),e.forEach(t=>this.renderTree(t))):this.renderTree()}getActiveControlInSettingsTree(){const e=this.settingsTree.getHTMLElement(),t=e.ownerDocument.activeElement;return t&&a.isAncestorOfActiveElement(e)?t:null}renderTree(e,t=!1){if(!t&&e&&this.scheduledRefreshes.has(e)){this.updateModifiedLabelForKey(e);return}if(this.contextViewFocused()){const r=this.window.document.querySelector(".context-view");r&&this.scheduleRefresh(r,e);return}const i=this.getActiveControlInSettingsTree(),s=i&&this.settingRenderers.getSettingDOMElementForDOMElement(i);if(s&&!t)if(e){if(s.getAttribute(G.SETTING_KEY_ATTR)===e&&s.parentElement&&!s.parentElement.classList.contains("setting-item-list")){this.updateModifiedLabelForKey(e),this.scheduleRefresh(s,e);return}}else{this.scheduleRefresh(s);return}if(this.renderResultCountMessages(),e){const r=this.currentSettingsModel.getElementsByName(e);if(r&&r.length)r.length>=2,this.refreshSingleElement(r[0]);else return}else this.refreshTree()}contextViewFocused(){return!!a.findParentWithClass(this.rootElement.ownerDocument.activeElement,"context-view")}refreshSingleElement(e){this.isVisible()&&this.settingsTree.rerender(e)}refreshTree(){this.isVisible()&&this.settingsTree.setChildren(null,ue(this.currentSettingsModel.root))}refreshTOCTree(){this.isVisible()&&(this.tocTreeModel.update(),this.tocTree.setChildren(null,Gt(this.tocTreeModel,this.tocTree)))}updateModifiedLabelForKey(e){const t=this.currentSettingsModel.getElementsByName(e),i=t&&t[0]&&t[0].isConfigured,s=this.settingRenderers.getDOMElementsForSettingKey(this.settingsTree.getHTMLElement(),e);s&&s[0]&&s[0].classList.toggle("is-configured",!!i)}async onSearchInputChanged(){if(!this.currentSettingsModel)return;const e=this.searchWidget.getValue().trim();this.viewState.query=e,this.delayedFilterLogging.cancel(),await this.triggerSearch(e.replace(/\u203A/g," ")),e&&this.searchResultModel&&this.delayedFilterLogging.trigger(()=>this.reportFilteringUsed(this.searchResultModel))}parseSettingFromJSON(e){const t=e.match(/"([a-zA-Z.]+)": /);return t&&t[1]}toggleTocBySearchBehaviorType(){this.configurationService.getValue(Se)==="hide"?(this.splitView.setViewVisible(0,!1),this.splitView.style({separatorBorder:ie.transparent})):(this.splitView.setViewVisible(0,!0),this.splitView.style({separatorBorder:this.theme.getColor($)}))}async triggerSearch(e){const t=this.editorProgressService.show(!0);if(this.viewState.tagFilters=new Set,this.viewState.extensionFilters=new Set,this.viewState.featureFilters=new Set,this.viewState.idFilters=new Set,this.viewState.languageFilter=void 0,e){const i=q(e);e=i.query,i.tags.forEach(s=>this.viewState.tagFilters.add(s)),i.extensionFilters.forEach(s=>this.viewState.extensionFilters.add(s)),i.featureFilters.forEach(s=>this.viewState.featureFilters.add(s)),i.idFilters.forEach(s=>this.viewState.idFilters.add(s)),this.viewState.languageFilter=i.languageFilter}this.settingsTargetsWidget.updateLanguageFilterIndicators(this.viewState.languageFilter),e&&e!=="@"?(e=this.parseSettingFromJSON(e)||e,await this.triggerFilterPreferences(e),this.toggleTocBySearchBehaviorType()):(this.viewState.tagFilters.size||this.viewState.extensionFilters.size||this.viewState.featureFilters.size||this.viewState.idFilters.size||this.viewState.languageFilter?this.searchResultModel=this.createFilterModel():this.searchResultModel=null,this.searchDelayer.cancel(),this.searchInProgress&&(this.searchInProgress.cancel(),this.searchInProgress.dispose(),this.searchInProgress=null),this.tocTree.setFocus([]),this.viewState.filterToCategory=void 0,this.tocTreeModel.currentSearchModel=this.searchResultModel,this.searchResultModel?(this.tocTree.setSelection([]),this.tocTree.expandAll(),this.refreshTOCTree(),this.renderResultCountMessages(),this.refreshTree(),this.toggleTocBySearchBehaviorType()):this.tocTreeDisposed||(this.tocTree.collapseAll(),this.refreshTOCTree(),this.renderResultCountMessages(),this.refreshTree(),this.splitView.setViewVisible(0,!0))),t.done()}createFilterModel(){const e=this.instantiationService.createInstance(de,this.viewState,this.settingsOrderByTocIndex,this.workspaceTrustManagementService.isWorkspaceTrusted()),t={filterMatches:[]};for(const i of this.defaultSettingsEditorModel.settingsGroups.slice(1))for(const s of i.sections)for(const r of s.settings)t.filterMatches.push({setting:r,matches:[],matchType:at.None,score:0});return e.setResult(0,t),e}reportFilteringUsed(e){if(!e)return;const t={},i=e.getRawResults(),s=i[R.Local];s&&(t.filterResult=s.filterMatches.length);const r=i[R.Remote];r&&(t.nlpResult=r.filterMatches.length);const n=e.getUniqueResults(),o={"counts.nlpResult":t.nlpResult,"counts.filterResult":t.filterResult,"counts.uniqueResultsCount":n?.filterMatches.length};this.telemetryService.publicLog2("settingsEditor.filter",o)}async triggerFilterPreferences(e){this.searchInProgress&&(this.searchInProgress.cancel(),this.searchInProgress=null);const t=this.searchInProgress=new ye;return this.searchDelayer.trigger(async()=>{if(!t.token.isCancellationRequested){const i=await this.localFilterPreferences(e,t.token);i&&!i.exactMatch&&!t.token.isCancellationRequested&&await this.remoteSearchPreferences(e,t.token),this.onDidFinishSearch()}})}onDidFinishSearch(){this.tocTreeModel.currentSearchModel=this.searchResultModel,this.tocTreeModel.update(),this.tocTree.setFocus([]),this.viewState.filterToCategory=void 0,this.tocTree.expandAll(),this.settingsTree.scrollTop=0,this.refreshTOCTree(),this.renderTree(void 0,!0)}localFilterPreferences(e,t){const i=this.preferencesSearchService.getLocalSearchProvider(e);return this.filterOrSearchPreferences(e,R.Local,i,t)}remoteSearchPreferences(e,t){const i=this.preferencesSearchService.getRemoteSearchProvider(e);return this.filterOrSearchPreferences(e,R.Remote,i,t)}async filterOrSearchPreferences(e,t,i,s){const r=await this._filterOrSearchPreferencesModel(e,this.defaultSettingsEditorModel,i,s);return s?.isCancellationRequested?null:(this.searchResultModel??=this.instantiationService.createInstance(de,this.viewState,this.settingsOrderByTocIndex,this.workspaceTrustManagementService.isWorkspaceTrusted()),this.searchResultModel.setResult(t,r),r)}renderResultCountMessages(){if(this.currentSettingsModel)if(this.clearFilterLinkContainer.style.display=this.viewState.tagFilters&&this.viewState.tagFilters.size>0?"initial":"none",this.searchResultModel){const e=this.searchResultModel.getUniqueResultsCount();let t;switch(e){case 0:t=I("noResults","No Settings Found");break;case 1:t=I("oneResult","1 Setting Found");break;default:t=I("moreThanOneResult","{0} Settings Found",e)}this.searchResultLabel=t,this.updateInputAriaLabel(),this.countElement.innerText=t,Ee.status(t),this.countElement.style.display!=="block"&&(this.countElement.style.display="block",this.layout(this.dimension)),this.rootElement.classList.toggle("no-results",e===0),this.splitView.el.style.visibility=e===0?"hidden":"visible"}else{this.countElement.style.display!=="none"&&(this.searchResultLabel=null,this.updateInputAriaLabel(),this.countElement.style.display="none",this.countElement.innerText="",this.layout(this.dimension)),this.rootElement.classList.remove("no-results"),this.splitView.el.style.visibility="visible";return}}_filterOrSearchPreferencesModel(e,t,i,s){return(i?i.searchModel(t,s):Promise.resolve(null)).then(void 0,n=>Re(n)?Promise.reject(n):null)}layoutSplitView(e){const t=e.height-97;if(this.splitView.el.style.height=`${t}px`,this.splitView.layout(this.bodyContainer.clientWidth,t),!(this.configurationService.getValue(Se)==="hide"&&this.searchResultModel)){const r=this.splitView.isViewVisible(0),n=this.bodyContainer.clientWidth>=c.NARROW_TOTAL_WIDTH;this.splitView.setViewVisible(0,n),!r&&n&&this.bodyContainer.clientWidth>=c.EDITOR_MIN_WIDTH+c.TOC_RESET_WIDTH&&this.splitView.resizeView(0,c.TOC_RESET_WIDTH),this.splitView.style({separatorBorder:n?this.theme.getColor($):ie.transparent})}}saveState(){if(this.isVisible()){const e=this.searchWidget.getValue().trim(),t=this.settingsTargetsWidget.settingsTarget;this.input&&this.editorMemento.saveEditorState(this.group,this.input,{searchQuery:e,target:t})}else this.input&&this.editorMemento.clearEditorState(this.input,this.group);super.saveState()}};c=k([h(1,oe),h(2,st),h(3,Ne),h(4,Je),h(5,ot),h(6,ke),h(7,mt),h(8,He),h(9,Pe),h(10,ze),h(11,rt),h(12,dt),h(13,ae),h(14,et),h(15,nt),h(16,We),h(17,Ge),h(18,Be),h(19,Ue),h(20,Ke),h(21,ht)],c);let N=class extends De{constructor(e,t,i,s,r,n){super();this.commandService=i;this.userDataSyncService=s;this.userDataSyncEnablementService=r;const o=a.append(t,p(".settings-right-controls")),l=a.append(o,p(".turn-on-sync"));this.turnOnSyncButton=this._register(new ve(l,{title:!0,...qe})),this.lastSyncedLabel=a.append(o,p(".last-synced-label")),a.hide(this.lastSyncedLabel),this.turnOnSyncButton.enabled=!0,this.turnOnSyncButton.label=I("turnOnSyncButton","Backup and Sync Settings"),a.hide(this.turnOnSyncButton.element),this._register(this.turnOnSyncButton.onDidClick(async()=>{n.publicLog2("sync/turnOnSyncFromSettings"),await this.commandService.executeCommand("workbench.userDataSync.actions.turnOn")})),this.updateLastSyncedTime(),this._register(this.userDataSyncService.onDidChangeLastSyncTime(()=>{this.updateLastSyncedTime()})),this._register(new a.WindowIntervalTimer).cancelAndSet(()=>this.updateLastSyncedTime(),60*1e3,e),this.update(),this._register(this.userDataSyncService.onDidChangeStatus(()=>{this.update()})),this._register(this.userDataSyncEnablementService.onDidChangeEnablement(()=>{this.update()}))}lastSyncedLabel;turnOnSyncButton;_onDidChangeLastSyncedLabel=this._register(new we);onDidChangeLastSyncedLabel=this._onDidChangeLastSyncedLabel.event;updateLastSyncedTime(){const e=this.userDataSyncService.lastSyncTime;let t;if(typeof e=="number"){const i=Ce(e,!0,void 0,!0);t=I("lastSyncedLabel","Last synced: {0}",i)}else t="";this.lastSyncedLabel.textContent=t,this._onDidChangeLastSyncedLabel.fire(t)}update(){this.userDataSyncService.status!==le.Uninitialized&&(this.userDataSyncEnablementService.isEnabled()||this.userDataSyncService.status!==le.Idle?(a.show(this.lastSyncedLabel),a.hide(this.turnOnSyncButton.element)):(a.hide(this.lastSyncedLabel),a.show(this.turnOnSyncButton.element)))}};N=k([h(2,Ae),h(3,Ze),h(4,ae),h(5,oe)],N);export{c as SettingsEditor2,kt as SettingsFocusContext,ue as createGroupIterator};
