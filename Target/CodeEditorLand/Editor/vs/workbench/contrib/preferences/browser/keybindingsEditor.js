var G=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var E=(g,n,e,i)=>{for(var t=i>1?void 0:i?U(n,e):n,o=g.length-1,a;o>=0;o--)(a=g[o])&&(t=(i?a(n,e,t):a(t))||t);return i&&t&&G(n,e,t),t},c=(g,n)=>(e,i)=>n(e,i,g);import"./media/keybindingsEditor.css";import*as r from"../../../../base/browser/dom.js";import{StandardKeyboardEvent as q}from"../../../../base/browser/keyboardEvent.js";import{ActionBar as z}from"../../../../base/browser/ui/actionbar/actionbar.js";import{HighlightedLabel as f}from"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as x}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{KeybindingLabel as X}from"../../../../base/browser/ui/keybindingLabel/keybindingLabel.js";import{ToggleActionViewItem as J}from"../../../../base/browser/ui/toggle/toggle.js";import{ToolBar as Z}from"../../../../base/browser/ui/toolbar/toolbar.js";import{Action as M,Separator as k}from"../../../../base/common/actions.js";import{Delayer as N}from"../../../../base/common/async.js";import{Emitter as K,Event as Q}from"../../../../base/common/event.js";import{KeyCode as P}from"../../../../base/common/keyCodes.js";import{Disposable as ee,DisposableStore as A,toDisposable as ie}from"../../../../base/common/lifecycle.js";import{OS as ne,isIOS as te}from"../../../../base/common/platform.js";import{ThemeIcon as L}from"../../../../base/common/themables.js";import{isString as R}from"../../../../base/common/types.js";import{EditorExtensionsRegistry as oe}from"../../../../editor/browser/editorExtensions.js";import{CompletionItemKind as re}from"../../../../editor/common/languages.js";import{localize as s}from"../../../../nls.js";import{IAccessibilityService as se}from"../../../../platform/accessibility/common/accessibility.js";import{MenuId as ae,MenuRegistry as de,isIMenuItem as ce}from"../../../../platform/actions/common/actions.js";import{IClipboardService as le}from"../../../../platform/clipboard/common/clipboardService.js";import{IConfigurationService as ge}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as F,RawContextKey as be}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as ye}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as D}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as _}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as j}from"../../../../platform/keybinding/common/keybinding.js";import{WorkbenchTable as he}from"../../../../platform/list/browser/listService.js";import{INotificationService as me}from"../../../../platform/notification/common/notification.js";import{IStorageService as ue,StorageScope as H,StorageTarget as W}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as pe}from"../../../../platform/telemetry/common/telemetry.js";import{defaultKeybindingLabelStyles as Ie,defaultToggleStyles as ve,getInputBoxStyle as Ee}from"../../../../platform/theme/browser/defaultStyles.js";import{asCssVariable as O,badgeBackground as fe,badgeForeground as Ke,contrastBorder as Ce,editorBackground as Le,foreground as Te,listActiveSelectionBackground as Se,listActiveSelectionForeground as ke,listFocusBackground as Ae,listFocusForeground as we,listHoverBackground as xe,listHoverForeground as Me,listInactiveSelectionBackground as De,listInactiveSelectionForeground as _e,registerColor as Y,tableOddRowsBackgroundColor as V}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as He,registerThemingParticipant as We}from"../../../../platform/theme/common/themeService.js";import{registerNavigableContainer as Oe}from"../../../browser/actions/widgetNavigationCommands.js";import{EditorPane as Be}from"../../../browser/parts/editor/editorPane.js";import{WORKBENCH_BACKGROUND as Ne}from"../../../common/theme.js";import{IEditorService as Pe}from"../../../services/editor/common/editorService.js";import{IKeybindingEditingService as Re}from"../../../services/keybinding/common/keybindingEditing.js";import{KEYBINDING_ENTRY_TEMPLATE_ID as T}from"../../../services/preferences/browser/keybindingsEditorModel.js";import{AccessibilityVerbositySettingId as Fe}from"../../accessibility/browser/accessibilityConfiguration.js";import{SuggestEnabledInput as je}from"../../codeEditor/browser/suggestEnabledInput/suggestEnabledInput.js";import{IExtensionsWorkbenchService as Ye}from"../../extensions/common/extensions.js";import{CONTEXT_KEYBINDINGS_EDITOR as Ve,CONTEXT_KEYBINDINGS_SEARCH_FOCUS as $e,CONTEXT_KEYBINDING_FOCUS as Ge,CONTEXT_WHEN_FOCUS as Ue,KEYBINDINGS_EDITOR_COMMAND_ADD as qe,KEYBINDINGS_EDITOR_COMMAND_CLEAR_SEARCH_RESULTS as ze,KEYBINDINGS_EDITOR_COMMAND_COPY as Xe,KEYBINDINGS_EDITOR_COMMAND_COPY_COMMAND as Je,KEYBINDINGS_EDITOR_COMMAND_COPY_COMMAND_TITLE as Ze,KEYBINDINGS_EDITOR_COMMAND_DEFINE as B,KEYBINDINGS_EDITOR_COMMAND_DEFINE_WHEN as Qe,KEYBINDINGS_EDITOR_COMMAND_RECORD_SEARCH_KEYS as ei,KEYBINDINGS_EDITOR_COMMAND_REMOVE as ii,KEYBINDINGS_EDITOR_COMMAND_RESET as ni,KEYBINDINGS_EDITOR_COMMAND_SHOW_SIMILAR as ti,KEYBINDINGS_EDITOR_COMMAND_SORTBY_PRECEDENCE as oi}from"../common/preferences.js";import{settingsTextInputBorder as ri}from"../common/settingsEditorColorRegistry.js";import{DefineKeybindingWidget as si,KeybindingsSearchWidget as ai}from"./keybindingWidgets.js";import{keybindingsAddIcon as di,keybindingsEditIcon as ci,keybindingsRecordKeysIcon as li,keybindingsSortIcon as gi,preferencesClearInputIcon as bi}from"./preferencesIcons.js";const l=r.$;let C=class extends Be{constructor(e,i,t,o,a,d,y,m,b,h,ui,$,pi,Ii){super(C.ID,e,i,t,$);this.keybindingsService=o;this.contextMenuService=a;this.keybindingEditingService=d;this.contextKeyService=y;this.notificationService=m;this.clipboardService=b;this.instantiationService=h;this.editorService=ui;this.configurationService=pi;this.accessibilityService=Ii;this.delayedFiltering=new N(300),this._register(o.onDidUpdateKeybindings(()=>this.render(!!this.keybindingFocusContextKey.get()))),this.keybindingsEditorContextKey=Ve.bindTo(this.contextKeyService),this.searchFocusContextKey=$e.bindTo(this.contextKeyService),this.keybindingFocusContextKey=Ge.bindTo(this.contextKeyService),this.searchHistoryDelayer=new N(500),this.recordKeysAction=new M(ei,s("recordKeysLabel","Record Keys"),L.asClassName(li)),this.recordKeysAction.checked=!1,this.sortByPrecedenceAction=new M(oi,s("sortByPrecedeneLabel","Sort by Precedence (Highest first)"),L.asClassName(gi)),this.sortByPrecedenceAction.checked=!1,this.overflowWidgetsDomNode=l(".keybindings-overflow-widgets-container.monaco-editor")}static ID="workbench.editor.keybindings";_onDefineWhenExpression=this._register(new K);onDefineWhenExpression=this._onDefineWhenExpression.event;_onRejectWhenExpression=this._register(new K);onRejectWhenExpression=this._onRejectWhenExpression.event;_onAcceptWhenExpression=this._register(new K);onAcceptWhenExpression=this._onAcceptWhenExpression.event;_onLayout=this._register(new K);onLayout=this._onLayout.event;keybindingsEditorModel=null;headerContainer;actionsContainer;searchWidget;searchHistoryDelayer;overlayContainer;defineKeybindingWidget;unAssignedKeybindingItemToRevealAndFocus=null;tableEntries=[];keybindingsTableContainer;keybindingsTable;dimension=null;delayedFiltering;latestEmptyFilters=[];keybindingsEditorContextKey;keybindingFocusContextKey;searchFocusContextKey;sortByPrecedenceAction;recordKeysAction;ariaLabelElement;overflowWidgetsDomNode;create(e){super.create(e),this._register(Oe({name:"keybindingsEditor",focusNotifiers:[this],focusNextWidget:()=>{this.searchWidget.hasFocus()&&this.focusKeybindings()},focusPreviousWidget:()=>{this.searchWidget.hasFocus()||this.focusSearch()}}))}createEditor(e){const i=r.append(e,l("div",{class:"keybindings-editor"}));this.createAriaLabelElement(i),this.createOverlayContainer(i),this.createHeader(i),this.createBody(i)}setInput(e,i,t,o){return this.keybindingsEditorContextKey.set(!0),super.setInput(e,i,t,o).then(()=>this.render(!!(i&&i.preserveFocus)))}clearInput(){super.clearInput(),this.keybindingsEditorContextKey.reset(),this.keybindingFocusContextKey.reset()}layout(e){this.dimension=e,this.layoutSearchWidget(e),this.overlayContainer.style.width=e.width+"px",this.overlayContainer.style.height=e.height+"px",this.defineKeybindingWidget.layout(this.dimension),this.layoutKeybindingsTable(),this._onLayout.fire()}focus(){super.focus();const e=this.activeKeybindingEntry;e?this.selectEntry(e):te||this.searchWidget.focus()}get activeKeybindingEntry(){const e=this.keybindingsTable.getFocusedElements()[0];return e&&e.templateId===T?e:null}async defineKeybinding(e,i){this.selectEntry(e),this.showOverlayContainer();try{const t=await this.defineKeybindingWidget.define();t&&await this.updateKeybinding(e,t,e.keybindingItem.when,i)}catch(t){this.onKeybindingEditingError(t)}finally{this.hideOverlayContainer(),this.selectEntry(e)}}defineWhenExpression(e){e.keybindingItem.keybinding&&(this.selectEntry(e),this._onDefineWhenExpression.fire(e))}rejectWhenExpression(e){this._onRejectWhenExpression.fire(e)}acceptWhenExpression(e){this._onAcceptWhenExpression.fire(e)}async updateKeybinding(e,i,t,o){((e.keybindingItem.keybinding?e.keybindingItem.keybinding.getUserSettingsLabel():"")!==i||e.keybindingItem.when!==t)&&(o?await this.keybindingEditingService.addKeybinding(e.keybindingItem.keybindingItem,i,t||void 0):await this.keybindingEditingService.editKeybinding(e.keybindingItem.keybindingItem,i,t||void 0),e.keybindingItem.keybinding||(this.unAssignedKeybindingItemToRevealAndFocus=e))}async removeKeybinding(e){if(this.selectEntry(e),e.keybindingItem.keybinding)try{await this.keybindingEditingService.removeKeybinding(e.keybindingItem.keybindingItem),this.focus()}catch(i){this.onKeybindingEditingError(i),this.selectEntry(e)}}async resetKeybinding(e){this.selectEntry(e);try{await this.keybindingEditingService.resetKeybinding(e.keybindingItem.keybindingItem),e.keybindingItem.keybinding||(this.unAssignedKeybindingItemToRevealAndFocus=e),this.selectEntry(e)}catch(i){this.onKeybindingEditingError(i),this.selectEntry(e)}}async copyKeybinding(e){this.selectEntry(e);const i={key:e.keybindingItem.keybinding&&e.keybindingItem.keybinding.getUserSettingsLabel()||"",command:e.keybindingItem.command};e.keybindingItem.when&&(i.when=e.keybindingItem.when),await this.clipboardService.writeText(JSON.stringify(i,null,"  "))}async copyKeybindingCommand(e){this.selectEntry(e),await this.clipboardService.writeText(e.keybindingItem.command)}async copyKeybindingCommandTitle(e){this.selectEntry(e),await this.clipboardService.writeText(e.keybindingItem.commandLabel)}focusSearch(){this.searchWidget.focus()}search(e){this.focusSearch(),this.searchWidget.setValue(e),this.selectEntry(0)}clearSearchResults(){this.searchWidget.clear()}showSimilarKeybindings(e){const i=`"${e.keybindingItem.keybinding.getAriaLabel()}"`;i!==this.searchWidget.getValue()&&this.searchWidget.setValue(i)}createAriaLabelElement(e){this.ariaLabelElement=r.append(e,r.$("")),this.ariaLabelElement.setAttribute("id","keybindings-editor-aria-label-element"),this.ariaLabelElement.setAttribute("aria-live","assertive")}createOverlayContainer(e){this.overlayContainer=r.append(e,l(".overlay-container")),this.overlayContainer.style.position="absolute",this.overlayContainer.style.zIndex="40",this.defineKeybindingWidget=this._register(this.instantiationService.createInstance(si,this.overlayContainer)),this._register(this.defineKeybindingWidget.onDidChange(i=>this.defineKeybindingWidget.printExisting(this.keybindingsEditorModel.fetch(`"${i}"`).length))),this._register(this.defineKeybindingWidget.onShowExistingKeybidings(i=>this.searchWidget.setValue(`"${i}"`))),this.hideOverlayContainer()}showOverlayContainer(){this.overlayContainer.style.display="block"}hideOverlayContainer(){this.overlayContainer.style.display="none"}createHeader(e){this.headerContainer=r.append(e,l(".keybindings-header"));const i=s("SearchKeybindings.FullTextSearchPlaceholder","Type to search in keybindings"),t=s("SearchKeybindings.KeybindingsSearchPlaceholder","Recording Keys. Press Escape to exit"),o=new M(ze,s("clearInput","Clear Keybindings Search Input"),L.asClassName(bi),!1,async()=>this.clearSearchResults()),a=r.append(this.headerContainer,l(".search-container"));this.searchWidget=this._register(this.instantiationService.createInstance(ai,a,{ariaLabel:i,placeholder:i,focusKey:this.searchFocusContextKey,ariaLabelledBy:"keybindings-editor-aria-label-element",recordEnter:!0,quoteRecordedKeys:!0,history:this.getMemento(H.PROFILE,W.USER).searchHistory||[],inputBoxStyles:Ee({inputBorder:ri})})),this._register(this.searchWidget.onDidChange(b=>{o.enabled=!!b,this.delayedFiltering.trigger(()=>this.filterKeybindings()),this.updateSearchOptions()})),this._register(this.searchWidget.onEscape(()=>this.recordKeysAction.checked=!1)),this.actionsContainer=r.append(a,r.$(".keybindings-search-actions-container"));const d=this.createRecordingBadge(this.actionsContainer);this._register(this.sortByPrecedenceAction.onDidChange(b=>{b.checked!==void 0&&this.renderKeybindingsEntries(!1),this.updateSearchOptions()})),this._register(this.recordKeysAction.onDidChange(b=>{b.checked!==void 0&&(d.classList.toggle("disabled",!b.checked),b.checked?(this.searchWidget.inputBox.setPlaceHolder(t),this.searchWidget.inputBox.setAriaLabel(t),this.searchWidget.startRecordingKeys(),this.searchWidget.focus()):(this.searchWidget.inputBox.setPlaceHolder(i),this.searchWidget.inputBox.setAriaLabel(i),this.searchWidget.stopRecordingKeys(),this.searchWidget.focus()),this.updateSearchOptions())}));const y=[this.recordKeysAction,this.sortByPrecedenceAction,o],m=this._register(new Z(this.actionsContainer,this.contextMenuService,{actionViewItemProvider:(b,h)=>{if(b.id===this.sortByPrecedenceAction.id||b.id===this.recordKeysAction.id)return new J(null,b,{...h,keybinding:this.keybindingsService.lookupKeybinding(b.id)?.getLabel(),toggleStyles:ve})},getKeyBinding:b=>this.keybindingsService.lookupKeybinding(b.id)}));m.setActions(y),this._register(this.keybindingsService.onDidUpdateKeybindings(()=>m.setActions(y)))}updateSearchOptions(){const e=this.input;e&&(e.searchOptions={searchValue:this.searchWidget.getValue(),recordKeybindings:!!this.recordKeysAction.checked,sortByPrecedence:!!this.sortByPrecedenceAction.checked})}createRecordingBadge(e){const i=r.append(e,r.$(".recording-badge.monaco-count-badge.long.disabled"));return i.textContent=s("recording","Recording Keys"),i.style.backgroundColor=O(fe),i.style.color=O(Ke),i.style.border=`1px solid ${O(Ce)}`,i}layoutSearchWidget(e){this.searchWidget.layout(e),this.headerContainer.classList.toggle("small",e.width<400),this.searchWidget.inputBox.inputElement.style.paddingRight=`${r.getTotalWidth(this.actionsContainer)+12}px`}createBody(e){const i=r.append(e,l(".keybindings-body"));this.createTable(i)}createTable(e){this.keybindingsTableContainer=r.append(e,l(".keybindings-table-container")),this.keybindingsTable=this._register(this.instantiationService.createInstance(he,"KeybindingsEditor",this.keybindingsTableContainer,new yi,[{label:"",tooltip:"",weight:0,minimumWidth:40,maximumWidth:40,templateId:u.TEMPLATE_ID,project(i){return i}},{label:s("command","Command"),tooltip:"",weight:.3,templateId:p.TEMPLATE_ID,project(i){return i}},{label:s("keybinding","Keybinding"),tooltip:"",weight:.2,templateId:w.TEMPLATE_ID,project(i){return i}},{label:s("when","When"),tooltip:"",weight:.35,templateId:v.TEMPLATE_ID,project(i){return i}},{label:s("source","Source"),tooltip:"",weight:.15,templateId:I.TEMPLATE_ID,project(i){return i}}],[this.instantiationService.createInstance(u,this),this.instantiationService.createInstance(p),this.instantiationService.createInstance(w),this.instantiationService.createInstance(v,this),this.instantiationService.createInstance(I)],{identityProvider:{getId:i=>i.id},horizontalScrolling:!1,accessibilityProvider:new mi(this.configurationService),keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:i=>i.keybindingItem.commandLabel||i.keybindingItem.command},overrideStyles:{listBackground:Le},multipleSelectionSupport:!1,setRowLineHeight:!1,openOnSingleClick:!1,transformOptimization:!1})),this._register(this.keybindingsTable.onContextMenu(i=>this.onContextMenu(i))),this._register(this.keybindingsTable.onDidChangeFocus(i=>this.onFocusChange())),this._register(this.keybindingsTable.onDidFocus(()=>{this.keybindingsTable.getHTMLElement().classList.add("focused"),this.onFocusChange()})),this._register(this.keybindingsTable.onDidBlur(()=>{this.keybindingsTable.getHTMLElement().classList.remove("focused"),this.keybindingFocusContextKey.reset()})),this._register(this.keybindingsTable.onDidOpen(i=>{if(i.browserEvent?.defaultPrevented)return;const t=this.activeKeybindingEntry;t&&this.defineKeybinding(t,!1)})),r.append(this.keybindingsTableContainer,this.overflowWidgetsDomNode)}async render(e){if(this.input){const i=this.input;this.keybindingsEditorModel=await i.resolve(),await this.keybindingsEditorModel.resolve(this.getActionsLabels()),this.renderKeybindingsEntries(!1,e),i.searchOptions?(this.recordKeysAction.checked=i.searchOptions.recordKeybindings,this.sortByPrecedenceAction.checked=i.searchOptions.sortByPrecedence,this.searchWidget.setValue(i.searchOptions.searchValue)):this.updateSearchOptions()}}getActionsLabels(){const e=new Map;for(const i of oe.getEditorActions())e.set(i.id,i.label);for(const i of de.getMenuItems(ae.CommandPalette))if(ce(i)){const t=typeof i.command.title=="string"?i.command.title:i.command.title.value,o=i.command.category?typeof i.command.category=="string"?i.command.category:i.command.category.value:void 0;e.set(i.command.id,o?`${o}: ${t}`:t)}return e}filterKeybindings(){this.renderKeybindingsEntries(this.searchWidget.hasFocus()),this.searchHistoryDelayer.trigger(()=>{this.searchWidget.inputBox.addToHistory(),this.getMemento(H.PROFILE,W.USER).searchHistory=this.searchWidget.inputBox.getHistory(),this.saveState()})}clearKeyboardShortcutSearchHistory(){this.searchWidget.inputBox.clearHistory(),this.getMemento(H.PROFILE,W.USER).searchHistory=this.searchWidget.inputBox.getHistory(),this.saveState()}renderKeybindingsEntries(e,i){if(this.keybindingsEditorModel){const t=this.searchWidget.getValue(),o=this.keybindingsEditorModel.fetch(t,this.sortByPrecedenceAction.checked);this.accessibilityService.alert(s("foundResults","{0} results",o.length)),this.ariaLabelElement.setAttribute("aria-label",this.getAriaLabel(o)),o.length===0&&this.latestEmptyFilters.push(t);const a=this.keybindingsTable.getSelection()[0];if(this.tableEntries=o,this.keybindingsTable.splice(0,this.keybindingsTable.length,this.tableEntries),this.layoutKeybindingsTable(),e)this.keybindingsTable.setSelection([]),this.keybindingsTable.setFocus([]);else if(this.unAssignedKeybindingItemToRevealAndFocus){const d=this.getNewIndexOfUnassignedKeybinding(this.unAssignedKeybindingItemToRevealAndFocus);d!==-1&&(this.keybindingsTable.reveal(d,.2),this.selectEntry(d)),this.unAssignedKeybindingItemToRevealAndFocus=null}else a!==-1&&a<this.tableEntries.length?this.selectEntry(a,i):this.editorService.activeEditorPane===this&&!i&&this.focus()}}getAriaLabel(e){return this.sortByPrecedenceAction.checked?s("show sorted keybindings","Showing {0} Keybindings in precedence order",e.length):s("show keybindings","Showing {0} Keybindings in alphabetical order",e.length)}layoutKeybindingsTable(){if(!this.dimension)return;const e=this.dimension.height-(r.getDomNodePagePosition(this.headerContainer).height+12);this.keybindingsTableContainer.style.height=`${e}px`,this.keybindingsTable.layout(e)}getIndexOf(e){const i=this.tableEntries.indexOf(e);if(i===-1){for(let t=0;t<this.tableEntries.length;t++)if(this.tableEntries[t].id===e.id)return t}return i}getNewIndexOfUnassignedKeybinding(e){for(let i=0;i<this.tableEntries.length;i++){const t=this.tableEntries[i];if(t.templateId===T&&t.keybindingItem.command===e.keybindingItem.command)return i}return-1}selectEntry(e,i=!0){const t=typeof e=="number"?e:this.getIndexOf(e);t!==-1&&t<this.keybindingsTable.length&&(i&&(this.keybindingsTable.domFocus(),this.keybindingsTable.setFocus([t])),this.keybindingsTable.setSelection([t]))}focusKeybindings(){this.keybindingsTable.domFocus();const e=this.keybindingsTable.getFocus();this.keybindingsTable.setFocus([e.length?e[0]:0])}selectKeybinding(e){this.selectEntry(e)}recordSearchKeys(){this.recordKeysAction.checked=!0}toggleSortByPrecedence(){this.sortByPrecedenceAction.checked=!this.sortByPrecedenceAction.checked}onContextMenu(e){if(e.element&&e.element.templateId===T){const i=e.element;this.selectEntry(i),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>[this.createCopyAction(i),this.createCopyCommandAction(i),this.createCopyCommandTitleAction(i),new k,...i.keybindingItem.keybinding?[this.createDefineKeybindingAction(i),this.createAddKeybindingAction(i)]:[this.createDefineKeybindingAction(i)],new k,this.createRemoveAction(i),this.createResetAction(i),new k,this.createDefineWhenExpressionAction(i),new k,this.createShowConflictsAction(i)]})}}onFocusChange(){this.keybindingFocusContextKey.reset();const e=this.keybindingsTable.getFocusedElements()[0];e&&e.templateId===T&&this.keybindingFocusContextKey.set(!0)}createDefineKeybindingAction(e){return{label:e.keybindingItem.keybinding?s("changeLabel","Change Keybinding..."):s("addLabel","Add Keybinding..."),enabled:!0,id:B,run:()=>this.defineKeybinding(e,!1)}}createAddKeybindingAction(e){return{label:s("addLabel","Add Keybinding..."),enabled:!0,id:qe,run:()=>this.defineKeybinding(e,!0)}}createDefineWhenExpressionAction(e){return{label:s("editWhen","Change When Expression"),enabled:!!e.keybindingItem.keybinding,id:Qe,run:()=>this.defineWhenExpression(e)}}createRemoveAction(e){return{label:s("removeLabel","Remove Keybinding"),enabled:!!e.keybindingItem.keybinding,id:ii,run:()=>this.removeKeybinding(e)}}createResetAction(e){return{label:s("resetLabel","Reset Keybinding"),enabled:!e.keybindingItem.keybindingItem.isDefault,id:ni,run:()=>this.resetKeybinding(e)}}createShowConflictsAction(e){return{label:s("showSameKeybindings","Show Same Keybindings"),enabled:!!e.keybindingItem.keybinding,id:ti,run:()=>this.showSimilarKeybindings(e)}}createCopyAction(e){return{label:s("copyLabel","Copy"),enabled:!0,id:Xe,run:()=>this.copyKeybinding(e)}}createCopyCommandAction(e){return{label:s("copyCommandLabel","Copy Command ID"),enabled:!0,id:Je,run:()=>this.copyKeybindingCommand(e)}}createCopyCommandTitleAction(e){return{label:s("copyCommandTitleLabel","Copy Command Title"),enabled:!!e.keybindingItem.commandLabel,id:Ze,run:()=>this.copyKeybindingCommandTitle(e)}}onKeybindingEditingError(e){this.notificationService.error(typeof e=="string"?e:s("error","Error '{0}' while editing the keybinding. Please open 'keybindings.json' file and check for errors.",`${e}`))}};C=E([c(1,pe),c(2,He),c(3,j),c(4,ye),c(5,Re),c(6,F),c(7,me),c(8,le),c(9,_),c(10,Pe),c(11,ue),c(12,ge),c(13,se)],C);class yi{headerRowHeight=30;getHeight(n){if(n.templateId===T){const e=n.keybindingItem.commandLabel&&n.commandIdMatches,i=!!n.commandDefaultLabelMatches,t=!!n.extensionIdMatches;if(e&&i)return 60;if(t||e||i)return 40}return 24}}let u=class{constructor(n,e){this.keybindingsEditor=n;this.keybindingsService=e}static TEMPLATE_ID="actions";templateId=u.TEMPLATE_ID;renderTemplate(n){const e=r.append(n,l(".actions"));return{actionBar:new z(e)}}renderElement(n,e,i,t){i.actionBar.clear();const o=[];n.keybindingItem.keybinding?o.push(this.createEditAction(n)):o.push(this.createAddAction(n)),i.actionBar.push(o,{icon:!0})}createEditAction(n){const e=this.keybindingsService.lookupKeybinding(B);return{class:L.asClassName(ci),enabled:!0,id:"editKeybinding",tooltip:e?s("editKeybindingLabelWithKey","Change Keybinding {0}",`(${e.getLabel()})`):s("editKeybindingLabel","Change Keybinding"),run:()=>this.keybindingsEditor.defineKeybinding(n,!1)}}createAddAction(n){const e=this.keybindingsService.lookupKeybinding(B);return{class:L.asClassName(di),enabled:!0,id:"addKeybinding",tooltip:e?s("addKeybindingLabelWithKey","Add Keybinding {0}",`(${e.getLabel()})`):s("addKeybindingLabel","Add Keybinding"),run:()=>this.keybindingsEditor.defineKeybinding(n,!1)}}disposeTemplate(n){n.actionBar.dispose()}};u=E([c(1,j)],u);let p=class{constructor(n){this._hoverService=n}static TEMPLATE_ID="commands";templateId=p.TEMPLATE_ID;renderTemplate(n){const e=r.append(n,l(".command")),i=this._hoverService.setupManagedHover(x("mouse"),e,""),t=r.append(e,l(".command-label")),o=new f(t),a=r.append(e,l(".command-default-label")),d=new f(a),y=r.append(e,l(".command-id.code")),m=new f(y);return{commandColumn:e,commandColumnHover:i,commandLabelContainer:t,commandLabel:o,commandDefaultLabelContainer:a,commandDefaultLabel:d,commandIdLabelContainer:y,commandIdLabel:m}}renderElement(n,e,i,t){const o=n.keybindingItem,a=!!(o.commandLabel&&n.commandIdMatches),d=!!n.commandDefaultLabelMatches;i.commandColumn.classList.toggle("vertical-align-column",a||d);const y=o.commandLabel?s("title","{0} ({1})",o.commandLabel,o.command):o.command;i.commandColumn.setAttribute("aria-label",y),i.commandColumnHover.update(y),o.commandLabel?(i.commandLabelContainer.classList.remove("hide"),i.commandLabel.set(o.commandLabel,n.commandLabelMatches)):(i.commandLabelContainer.classList.add("hide"),i.commandLabel.set(void 0)),n.commandDefaultLabelMatches?(i.commandDefaultLabelContainer.classList.remove("hide"),i.commandDefaultLabel.set(o.commandDefaultLabel,n.commandDefaultLabelMatches)):(i.commandDefaultLabelContainer.classList.add("hide"),i.commandDefaultLabel.set(void 0)),n.commandIdMatches||!o.commandLabel?(i.commandIdLabelContainer.classList.remove("hide"),i.commandIdLabel.set(o.command,n.commandIdMatches)):(i.commandIdLabelContainer.classList.add("hide"),i.commandIdLabel.set(void 0))}disposeTemplate(n){n.commandColumnHover.dispose(),n.commandDefaultLabel.dispose(),n.commandIdLabel.dispose(),n.commandLabel.dispose()}};p=E([c(0,D)],p);class w{static TEMPLATE_ID="keybindings";templateId=w.TEMPLATE_ID;constructor(){}renderTemplate(n){const e=r.append(n,l(".keybinding"));return{keybindingLabel:new X(r.append(e,l("div.keybinding-label")),ne,Ie)}}renderElement(n,e,i,t){n.keybindingItem.keybinding?i.keybindingLabel.set(n.keybindingItem.keybinding,n.keybindingMatches):i.keybindingLabel.set(void 0,void 0)}disposeTemplate(n){n.keybindingLabel.dispose()}}function hi(g,n){const e=new A;return e.add(r.addDisposableListener(g,r.EventType.CLICK,r.finalHandler(n))),e.add(r.addDisposableListener(g,r.EventType.KEY_UP,i=>{const t=new q(i);(t.equals(P.Space)||t.equals(P.Enter))&&(i.preventDefault(),i.stopPropagation(),n())})),e}let I=class{constructor(n,e){this.extensionsWorkbenchService=n;this.hoverService=e}static TEMPLATE_ID="source";templateId=I.TEMPLATE_ID;renderTemplate(n){const e=r.append(n,l(".source")),i=this.hoverService.setupManagedHover(x("mouse"),e,""),t=new f(r.append(e,l(".source-label"))),o=r.append(e,l(".extension-container")),a=r.append(o,l("a.extension-label",{tabindex:0})),d=new f(r.append(o,l(".extension-id-container.code")));return{sourceColumn:e,sourceColumnHover:i,sourceLabel:t,extensionLabel:a,extensionContainer:o,extensionId:d,disposables:new A}}renderElement(n,e,i,t){if(i.disposables.clear(),R(n.keybindingItem.source))i.extensionContainer.classList.add("hide"),i.sourceLabel.element.classList.remove("hide"),i.sourceColumnHover.update(""),i.sourceLabel.set(n.keybindingItem.source||"-",n.sourceMatches);else{i.extensionContainer.classList.remove("hide"),i.sourceLabel.element.classList.add("hide");const o=n.keybindingItem.source,a=o.displayName??o.identifier.value;i.sourceColumnHover.update(s("extension label","Extension ({0})",a)),i.extensionLabel.textContent=a,i.disposables.add(hi(i.extensionLabel,()=>{this.extensionsWorkbenchService.open(o.identifier.value)})),n.extensionIdMatches?(i.extensionId.element.classList.remove("hide"),i.extensionId.set(o.identifier.value,n.extensionIdMatches)):(i.extensionId.element.classList.add("hide"),i.extensionId.set(void 0))}}disposeTemplate(n){n.sourceColumnHover.dispose(),n.disposables.dispose(),n.sourceLabel.dispose(),n.extensionId.dispose()}};I=E([c(0,Ye),c(1,D)],I);let S=class extends ee{input;_onDidAccept=this._register(new K);onDidAccept=this._onDidAccept.event;_onDidReject=this._register(new K);onDidReject=this._onDidReject.event;constructor(n,e,i,t){super();const o=Ue.bindTo(t);this.input=this._register(i.createInstance(je,"keyboardshortcutseditor#wheninput",n,{provideResults:()=>{const a=[];for(const d of be.all())a.push({label:d.key,documentation:d.description,detail:d.type,kind:re.Constant});return a},triggerCharacters:["!"," "],wordDefinition:/[a-zA-Z.]+/,alwaysShowSuggestions:!0},"","keyboardshortcutseditor#wheninput",{focusContextKey:o,overflowWidgetsDomNode:e.overflowWidgetsDomNode})),this._register(r.addDisposableListener(this.input.element,r.EventType.DBLCLICK,a=>r.EventHelper.stop(a))),this._register(ie(()=>o.reset())),this._register(e.onAcceptWhenExpression(()=>this._onDidAccept.fire(this.input.getValue()))),this._register(Q.any(e.onRejectWhenExpression,this.input.onDidBlur)(()=>this._onDidReject.fire()))}layout(n){this.input.layout(n)}show(n){this.input.setValue(n),this.input.focus(!0)}};S=E([c(2,_),c(3,F)],S);let v=class{constructor(n,e,i){this.keybindingsEditor=n;this.hoverService=e;this.instantiationService=i}static TEMPLATE_ID="when";templateId=v.TEMPLATE_ID;renderTemplate(n){const e=r.append(n,l(".when")),i=r.append(e,l("div.when-label")),t=new f(i),o=r.append(e,l("div.when-input-container"));return{element:e,whenLabelContainer:i,whenLabel:t,whenInputContainer:o,disposables:new A}}renderElement(n,e,i,t){i.disposables.clear();const o=i.disposables.add(new A);i.disposables.add(this.keybindingsEditor.onDefineWhenExpression(a=>{if(n===a){i.element.classList.add("input-mode");const d=o.add(this.instantiationService.createInstance(S,i.whenInputContainer,this.keybindingsEditor));d.layout(new r.Dimension(i.element.parentElement.clientWidth,18)),d.show(n.keybindingItem.when||"");const y=()=>{o.clear(),i.element.classList.remove("input-mode"),i.element.parentElement.style.paddingLeft="10px",r.clearNode(i.whenInputContainer)};o.add(d.onDidAccept(m=>{y(),this.keybindingsEditor.updateKeybinding(n,n.keybindingItem.keybinding&&n.keybindingItem.keybinding.getUserSettingsLabel()||"",m),this.keybindingsEditor.selectKeybinding(n)})),o.add(d.onDidReject(()=>{y(),this.keybindingsEditor.selectKeybinding(n)})),i.element.parentElement.style.paddingLeft="0px"}})),i.whenLabelContainer.classList.toggle("code",!!n.keybindingItem.when),i.whenLabelContainer.classList.toggle("empty",!n.keybindingItem.when),n.keybindingItem.when?(i.whenLabel.set(n.keybindingItem.when,n.whenMatches,n.keybindingItem.when),i.disposables.add(this.hoverService.setupManagedHover(x("mouse"),i.element,n.keybindingItem.when))):i.whenLabel.set("-")}disposeTemplate(n){n.disposables.dispose(),n.whenLabel.dispose()}};v=E([c(1,D),c(2,_)],v);class mi{constructor(n){this.configurationService=n}getWidgetAriaLabel(){return s("keybindingsLabel","Keybindings")}getAriaLabel({keybindingItem:n}){const e=[n.commandLabel?n.commandLabel:n.command,n.keybinding?.getAriaLabel()||s("noKeybinding","No keybinding assigned"),n.when?n.when:s("noWhen","No when context"),R(n.source)?n.source:n.source.description??n.source.identifier.value];if(this.configurationService.getValue(Fe.KeybindingsEditor)){const i=s("keyboard shortcuts aria label","use space or enter to change the keybinding.");e.push(i)}return e.join(", ")}}Y("keybindingTable.headerBackground",V,"Background color for the keyboard shortcuts table header."),Y("keybindingTable.rowsBackground",V,"Background color for the keyboard shortcuts table alternating rows."),We((g,n)=>{const e=g.getColor(Te);if(e){const h=e.transparent(.8).makeOpaque(Ne(g));n.addRule(`.keybindings-editor > .keybindings-body > .keybindings-table-container .monaco-table .monaco-table-tr .monaco-table-td .code { color: ${h}; }`)}const i=g.getColor(ke),t=g.getColor(Se);if(i&&t){const h=i.transparent(.8).makeOpaque(t);n.addRule(`.keybindings-editor > .keybindings-body > .keybindings-table-container .monaco-table.focused .monaco-list-row.selected .monaco-table-tr .monaco-table-td .code { color: ${h}; }`)}const o=g.getColor(_e),a=g.getColor(De);if(o&&a){const h=o.transparent(.8).makeOpaque(a);n.addRule(`.keybindings-editor > .keybindings-body > .keybindings-table-container .monaco-table .monaco-list-row.selected .monaco-table-tr .monaco-table-td .code { color: ${h}; }`)}const d=g.getColor(we),y=g.getColor(Ae);if(d&&y){const h=d.transparent(.8).makeOpaque(y);n.addRule(`.keybindings-editor > .keybindings-body > .keybindings-table-container .monaco-table.focused .monaco-list-row.focused .monaco-table-tr .monaco-table-td .code { color: ${h}; }`)}const m=g.getColor(Me),b=g.getColor(xe);if(m&&b){const h=m.transparent(.8).makeOpaque(b);n.addRule(`.keybindings-editor > .keybindings-body > .keybindings-table-container .monaco-table.focused .monaco-list-row:hover:not(.focused):not(.selected) .monaco-table-tr .monaco-table-td .code { color: ${h}; }`)}});export{C as KeybindingsEditor};
