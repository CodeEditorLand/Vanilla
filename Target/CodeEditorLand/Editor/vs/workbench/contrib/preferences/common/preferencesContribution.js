var b=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var p=(a,n,e,i)=>{for(var t=i>1?void 0:i?T(n,e):n,o=a.length-1,s;o>=0;o--)(s=a[o])&&(t=(i?s(n,e,t):s(t))||t);return i&&t&&b(n,e,t),t},r=(a,n)=>(e,i)=>n(e,i,a);import{Disposable as y,dispose as S}from"../../../../../vs/base/common/lifecycle.js";import{isEqual as g}from"../../../../../vs/base/common/resources.js";import*as c from"../../../../../vs/nls.js";import{ConfigurationTarget as d,IConfigurationService as R}from"../../../../../vs/platform/configuration/common/configuration.js";import{ConfigurationScope as h,Extensions as k}from"../../../../../vs/platform/configuration/common/configurationRegistry.js";import{IFileService as D}from"../../../../../vs/platform/files/common/files.js";import{IInstantiationService as O}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{Registry as W}from"../../../../../vs/platform/registry/common/platform.js";import{IWorkspaceContextService as L,WorkbenchState as v}from"../../../../../vs/platform/workspace/common/workspace.js";import{workbenchConfigurationNodeBase as w}from"../../../../../vs/workbench/common/configuration.js";import"../../../../../vs/workbench/common/contributions.js";import"../../../../../vs/workbench/common/editor.js";import{SideBySideEditorInput as P}from"../../../../../vs/workbench/common/editor/sideBySideEditorInput.js";import{SettingsFileSystemProvider as u}from"../../../../../vs/workbench/contrib/preferences/common/settingsFilesystemProvider.js";import{IEditorResolverService as _,RegisteredEditorPriority as x}from"../../../../../vs/workbench/services/editor/common/editorResolverService.js";import{DEFAULT_SETTINGS_EDITOR_SETTING as m,FOLDER_SETTINGS_PATH as I,IPreferencesService as N,USE_SPLIT_JSON_SETTING as E}from"../../../../../vs/workbench/services/preferences/common/preferences.js";import{ITextEditorService as F}from"../../../../../vs/workbench/services/textfile/common/textEditorService.js";import{IUserDataProfileService as A}from"../../../../../vs/workbench/services/userDataProfile/common/userDataProfile.js";let l=class extends y{constructor(e,i,t,o,s,z,U,G){super();this.instantiationService=i;this.preferencesService=t;this.userDataProfileService=o;this.workspaceService=s;this.configurationService=z;this.editorResolverService=U;this.textEditorService=G;this._register(this.configurationService.onDidChangeConfiguration(f=>{(f.affectsConfiguration(E)||f.affectsConfiguration(m))&&this.handleSettingsEditorRegistration()})),this.handleSettingsEditorRegistration();const C=this._register(this.instantiationService.createInstance(u));this._register(e.registerProvider(u.SCHEMA,C))}static ID="workbench.contrib.preferences";editorOpeningListener;handleSettingsEditorRegistration(){S(this.editorOpeningListener),(this.configurationService.getValue(E)||this.configurationService.getValue(m))&&(this.editorOpeningListener=this.editorResolverService.registerEditor("**/settings.json",{id:P.ID,label:c.localize("splitSettingsEditorLabel","Split Settings Editor"),priority:x.builtin},{},{createEditorInput:({resource:e,options:i})=>{if(g(e,this.userDataProfileService.currentProfile.settingsResource))return{editor:this.preferencesService.createSplitJsonEditorInput(d.USER_LOCAL,e),options:i};const t=this.workspaceService.getWorkbenchState();if(t===v.FOLDER){const o=this.workspaceService.getWorkspace().folders;if(g(e,o[0].toResource(I)))return{editor:this.preferencesService.createSplitJsonEditorInput(d.WORKSPACE,e),options:i}}else if(t===v.WORKSPACE){const o=this.workspaceService.getWorkspace().folders;for(const s of o)if(g(e,s.toResource(I)))return{editor:this.preferencesService.createSplitJsonEditorInput(d.WORKSPACE_FOLDER,e),options:i}}return{editor:this.textEditorService.createTextEditor({resource:e}),options:i}}}))}dispose(){S(this.editorOpeningListener),super.dispose()}};l=p([r(0,D),r(1,O),r(2,N),r(3,A),r(4,L),r(5,R),r(6,_),r(7,F)],l);const B=W.as(k.Configuration);B.registerConfiguration({...w,properties:{"workbench.settings.enableNaturalLanguageSearch":{type:"boolean",description:c.localize("enableNaturalLanguageSettingsSearch","Controls whether to enable the natural language search mode for settings. The natural language search is provided by a Microsoft online service."),default:!0,scope:h.WINDOW,tags:["usesOnlineServices"]},"workbench.settings.settingsSearchTocBehavior":{type:"string",enum:["hide","filter"],enumDescriptions:[c.localize("settingsSearchTocBehavior.hide","Hide the Table of Contents while searching."),c.localize("settingsSearchTocBehavior.filter","Filter the Table of Contents to just categories that have matching settings. Clicking on a category will filter the results to that category.")],description:c.localize("settingsSearchTocBehavior","Controls the behavior of the Settings editor Table of Contents while searching. If this setting is being changed in the Settings editor, the setting will take effect after the search query is modified."),default:"filter",scope:h.WINDOW}}});export{l as PreferencesContribution};
