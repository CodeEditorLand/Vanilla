{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/limitIndicator/browser/limitIndicator.contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable, IDisposable } from '../../../../base/common/lifecycle.js';\nimport Severity from '../../../../base/common/severity.js';\nimport { ICodeEditor, getCodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { ILanguageStatus, ILanguageStatusService } from '../../../services/languageStatus/common/languageStatusService.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContributionsRegistry, IWorkbenchContribution } from '../../../common/contributions.js';\nimport { LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\nimport { Event } from '../../../../base/common/event.js';\nimport * as nls from '../../../../nls.js';\n\nimport { FoldingController } from '../../../../editor/contrib/folding/browser/folding.js';\nimport { ColorDetector } from '../../../../editor/contrib/colorPicker/browser/colorDetector.js';\n\nconst openSettingsCommand = 'workbench.action.openSettings';\nconst configureSettingsLabel = nls.localize('status.button.configure', \"Configure\");\n\n/**\n * Uses that language status indicator to show information which language features have been limited for performance reasons.\n * Currently this is used for folding ranges and for color decorators.\n */\nexport class LimitIndicatorContribution extends Disposable implements IWorkbenchContribution {\n\n\tconstructor(\n\t\t@IEditorService editorService: IEditorService,\n\t\t@ILanguageStatusService languageStatusService: ILanguageStatusService\n\t) {\n\t\tsuper();\n\n\t\tconst accessors = [new ColorDecorationAccessor(), new FoldingRangeAccessor()];\n\t\tconst statusEntries = accessors.map(indicator => new LanguageStatusEntry(languageStatusService, indicator));\n\t\tstatusEntries.forEach(entry => this._register(entry));\n\n\t\tlet control: any;\n\n\t\tconst onActiveEditorChanged = () => {\n\t\t\tconst activeControl = editorService.activeTextEditorControl;\n\t\t\tif (activeControl === control) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tcontrol = activeControl;\n\t\t\tconst editor = getCodeEditor(activeControl);\n\n\t\t\tstatusEntries.forEach(statusEntry => statusEntry.onActiveEditorChanged(editor));\n\t\t};\n\t\tthis._register(editorService.onDidActiveEditorChange(onActiveEditorChanged));\n\n\t\tonActiveEditorChanged();\n\t}\n\n}\n\n\nexport interface LimitInfo {\n\treadonly onDidChange: Event<void>;\n\n\treadonly computed: number;\n\treadonly limited: number | false;\n}\n\ninterface LanguageFeatureAccessor {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly label: string;\n\treadonly source: string;\n\treadonly settingsId: string;\n\tgetLimitReporter(editor: ICodeEditor): LimitInfo | undefined;\n}\n\nclass ColorDecorationAccessor implements LanguageFeatureAccessor {\n\treadonly id = 'decoratorsLimitInfo';\n\treadonly name = nls.localize('colorDecoratorsStatusItem.name', 'Color Decorator Status');\n\treadonly label = nls.localize('status.limitedColorDecorators.short', 'Color Decorators');\n\treadonly source = nls.localize('colorDecoratorsStatusItem.source', 'Color Decorators');\n\treadonly settingsId = 'editor.colorDecoratorsLimit';\n\n\tgetLimitReporter(editor: ICodeEditor): LimitInfo | undefined {\n\t\treturn ColorDetector.get(editor)?.limitReporter;\n\t}\n}\n\nclass FoldingRangeAccessor implements LanguageFeatureAccessor {\n\treadonly id = 'foldingLimitInfo';\n\treadonly name = nls.localize('foldingRangesStatusItem.name', 'Folding Status');\n\treadonly label = nls.localize('status.limitedFoldingRanges.short', 'Folding Ranges');\n\treadonly source = nls.localize('foldingRangesStatusItem.source', 'Folding');\n\treadonly settingsId = 'editor.foldingMaximumRegions';\n\n\tgetLimitReporter(editor: ICodeEditor): LimitInfo | undefined {\n\t\treturn FoldingController.get(editor)?.limitReporter;\n\t}\n}\n\nclass LanguageStatusEntry {\n\n\tprivate _limitStatusItem: IDisposable | undefined;\n\tprivate _indicatorChangeListener: IDisposable | undefined;\n\n\tconstructor(private languageStatusService: ILanguageStatusService, private accessor: LanguageFeatureAccessor) {\n\t}\n\n\tonActiveEditorChanged(editor: ICodeEditor | null): boolean {\n\t\tif (this._indicatorChangeListener) {\n\t\t\tthis._indicatorChangeListener.dispose();\n\t\t\tthis._indicatorChangeListener = undefined;\n\t\t}\n\n\t\tlet info: LimitInfo | undefined;\n\t\tif (editor) {\n\t\t\tinfo = this.accessor.getLimitReporter(editor);\n\t\t}\n\t\tthis.updateStatusItem(info);\n\t\tif (info) {\n\t\t\tthis._indicatorChangeListener = info.onDidChange(_ => {\n\t\t\t\tthis.updateStatusItem(info);\n\t\t\t});\n\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\n\tprivate updateStatusItem(info: LimitInfo | undefined) {\n\t\tif (this._limitStatusItem) {\n\t\t\tthis._limitStatusItem.dispose();\n\t\t\tthis._limitStatusItem = undefined;\n\t\t}\n\t\tif (info && info.limited !== false) {\n\t\t\tconst status: ILanguageStatus = {\n\t\t\t\tid: this.accessor.id,\n\t\t\t\tselector: '*',\n\t\t\t\tname: this.accessor.name,\n\t\t\t\tseverity: Severity.Warning,\n\t\t\t\tlabel: this.accessor.label,\n\t\t\t\tdetail: nls.localize('status.limited.details', 'only {0} shown for performance reasons', info.limited),\n\t\t\t\tcommand: { id: openSettingsCommand, arguments: [this.accessor.settingsId], title: configureSettingsLabel },\n\t\t\t\taccessibilityInfo: undefined,\n\t\t\t\tsource: this.accessor.source,\n\t\t\t\tbusy: false\n\t\t\t};\n\t\t\tthis._limitStatusItem = this.languageStatusService.addStatus(status);\n\t\t}\n\t}\n\n\tpublic dispose() {\n\t\tthis._limitStatusItem?.dispose;\n\t\tthis._limitStatusItem = undefined;\n\t\tthis._indicatorChangeListener?.dispose;\n\t\tthis._indicatorChangeListener = undefined;\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(\n\tLimitIndicatorContribution,\n\tLifecyclePhase.Restored\n);\n"],
  "mappings": "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",
  "names": []
}
