{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/deprecatedExtensionMigrator/browser/deprecatedExtensionMigrator.contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from \"../../../../base/common/actions.js\";\nimport { onUnexpectedError } from \"../../../../base/common/errors.js\";\nimport { isDefined } from \"../../../../base/common/types.js\";\nimport { localize } from \"../../../../nls.js\";\nimport {\n\tConfigurationTarget,\n\tIConfigurationService,\n} from \"../../../../platform/configuration/common/configuration.js\";\nimport {\n\tINotificationService,\n\tSeverity,\n} from \"../../../../platform/notification/common/notification.js\";\nimport { IOpenerService } from \"../../../../platform/opener/common/opener.js\";\nimport { Registry } from \"../../../../platform/registry/common/platform.js\";\nimport {\n\tIStorageService,\n\tStorageScope,\n\tStorageTarget,\n} from \"../../../../platform/storage/common/storage.js\";\nimport {\n\ttype IWorkbenchContributionsRegistry,\n\tExtensions as WorkbenchExtensions,\n} from \"../../../common/contributions.js\";\nimport { EnablementState } from \"../../../services/extensionManagement/common/extensionManagement.js\";\nimport { LifecyclePhase } from \"../../../services/lifecycle/common/lifecycle.js\";\nimport { IExtensionsWorkbenchService } from \"../../extensions/common/extensions.js\";\n\nclass DeprecatedExtensionMigratorContribution {\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IOpenerService private readonly openerService: IOpenerService\n\t) {\n\t\tthis.init().catch(onUnexpectedError);\n\t}\n\n\tprivate async init(): Promise<void> {\n\t\tconst bracketPairColorizerId = \"coenraads.bracket-pair-colorizer\";\n\n\t\tawait this.extensionsWorkbenchService.queryLocal();\n\t\tconst extension = this.extensionsWorkbenchService.installed.find(\n\t\t\t(e) => e.identifier.id === bracketPairColorizerId,\n\t\t);\n\t\tif (\n\t\t\t!extension ||\n\t\t\t(extension.enablementState !== EnablementState.EnabledGlobally &&\n\t\t\t\textension.enablementState !== EnablementState.EnabledWorkspace)\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst state = await this.getState();\n\t\tconst disablementLogEntry = state.disablementLog.some(\n\t\t\t(d) => d.extensionId === bracketPairColorizerId,\n\t\t);\n\n\t\tif (disablementLogEntry) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.disablementLog.push({\n\t\t\textensionId: bracketPairColorizerId,\n\t\t\tdisablementDateTime: new Date().getTime(),\n\t\t});\n\t\tawait this.setState(state);\n\n\t\tawait this.extensionsWorkbenchService.setEnablement(\n\t\t\textension,\n\t\t\tEnablementState.DisabledGlobally,\n\t\t);\n\n\t\tconst nativeBracketPairColorizationEnabledKey =\n\t\t\t\"editor.bracketPairColorization.enabled\";\n\t\tconst bracketPairColorizationEnabled =\n\t\t\t!!this.configurationService.inspect(\n\t\t\t\tnativeBracketPairColorizationEnabledKey,\n\t\t\t).user;\n\n\t\tthis.notificationService.notify({\n\t\t\tmessage: localize(\n\t\t\t\t\"bracketPairColorizer.notification\",\n\t\t\t\t\"The extension 'Bracket pair Colorizer' got disabled because it was deprecated.\",\n\t\t\t),\n\t\t\tseverity: Severity.Info,\n\t\t\tactions: {\n\t\t\t\tprimary: [\n\t\t\t\t\tnew Action(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\tlocalize(\n\t\t\t\t\t\t\t\"bracketPairColorizer.notification.action.uninstall\",\n\t\t\t\t\t\t\t\"Uninstall Extension\",\n\t\t\t\t\t\t),\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.extensionsWorkbenchService.uninstall(\n\t\t\t\t\t\t\t\textension,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t],\n\t\t\t\tsecondary: [\n\t\t\t\t\tbracketPairColorizationEnabled\n\t\t\t\t\t\t? undefined\n\t\t\t\t\t\t: new Action(\n\t\t\t\t\t\t\t\t\"\",\n\t\t\t\t\t\t\t\tlocalize(\n\t\t\t\t\t\t\t\t\t\"bracketPairColorizer.notification.action.enableNative\",\n\t\t\t\t\t\t\t\t\t\"Enable Native Bracket Pair Colorization\",\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\t\t\tthis.configurationService.updateValue(\n\t\t\t\t\t\t\t\t\t\tnativeBracketPairColorizationEnabledKey,\n\t\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t\t\tConfigurationTarget.USER,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\tnew Action(\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\tlocalize(\n\t\t\t\t\t\t\t\"bracketPairColorizer.notification.action.showMoreInfo\",\n\t\t\t\t\t\t\t\"More Info\",\n\t\t\t\t\t\t),\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.openerService.open(\n\t\t\t\t\t\t\t\t\"https://github.com/microsoft/vscode/issues/155179\",\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t].filter(isDefined),\n\t\t\t},\n\t\t});\n\t}\n\n\tprivate readonly storageKey = \"deprecatedExtensionMigrator.state\";\n\n\tprivate async getState(): Promise<State> {\n\t\tconst jsonStr = await this.storageService.get(\n\t\t\tthis.storageKey,\n\t\t\tStorageScope.APPLICATION,\n\t\t\t\"\",\n\t\t);\n\t\tif (jsonStr === \"\") {\n\t\t\treturn { disablementLog: [] };\n\t\t}\n\t\treturn JSON.parse(jsonStr) as State;\n\t}\n\n\tprivate async setState(state: State): Promise<void> {\n\t\tconst json = JSON.stringify(state);\n\t\tawait this.storageService.store(\n\t\t\tthis.storageKey,\n\t\t\tjson,\n\t\t\tStorageScope.APPLICATION,\n\t\t\tStorageTarget.USER,\n\t\t);\n\t}\n}\n\ninterface State {\n\tdisablementLog: {\n\t\textensionId: string;\n\t\tdisablementDateTime: number;\n\t}[];\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(\n\tDeprecatedExtensionMigratorContribution,\n\tLifecyclePhase.Restored,\n);\n"],
  "mappings": "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",
  "names": []
}
