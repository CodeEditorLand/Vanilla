{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/deprecatedExtensionMigrator/browser/deprecatedExtensionMigrator.contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from '../../../../base/common/actions.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { isDefined } from '../../../../base/common/types.js';\nimport { localize } from '../../../../nls.js';\nimport { ConfigurationTarget, IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { INotificationService, Severity } from '../../../../platform/notification/common/notification.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { Extensions as WorkbenchExtensions, IWorkbenchContributionsRegistry } from '../../../common/contributions.js';\nimport { IExtensionsWorkbenchService } from '../../extensions/common/extensions.js';\nimport { EnablementState } from '../../../services/extensionManagement/common/extensionManagement.js';\nimport { LifecyclePhase } from '../../../services/lifecycle/common/lifecycle.js';\n\nclass DeprecatedExtensionMigratorContribution {\n\tconstructor(\n\t\t@IConfigurationService private readonly configurationService: IConfigurationService,\n\t\t@IExtensionsWorkbenchService private readonly extensionsWorkbenchService: IExtensionsWorkbenchService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IOpenerService private readonly openerService: IOpenerService\n\t) {\n\t\tthis.init().catch(onUnexpectedError);\n\t}\n\n\tprivate async init(): Promise<void> {\n\t\tconst bracketPairColorizerId = 'coenraads.bracket-pair-colorizer';\n\n\t\tawait this.extensionsWorkbenchService.queryLocal();\n\t\tconst extension = this.extensionsWorkbenchService.installed.find(e => e.identifier.id === bracketPairColorizerId);\n\t\tif (\n\t\t\t!extension ||\n\t\t\t((extension.enablementState !== EnablementState.EnabledGlobally) &&\n\t\t\t\t(extension.enablementState !== EnablementState.EnabledWorkspace))\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst state = await this.getState();\n\t\tconst disablementLogEntry = state.disablementLog.some(d => d.extensionId === bracketPairColorizerId);\n\n\t\tif (disablementLogEntry) {\n\t\t\treturn;\n\t\t}\n\n\t\tstate.disablementLog.push({ extensionId: bracketPairColorizerId, disablementDateTime: new Date().getTime() });\n\t\tawait this.setState(state);\n\n\t\tawait this.extensionsWorkbenchService.setEnablement(extension, EnablementState.DisabledGlobally);\n\n\t\tconst nativeBracketPairColorizationEnabledKey = 'editor.bracketPairColorization.enabled';\n\t\tconst bracketPairColorizationEnabled = !!this.configurationService.inspect(nativeBracketPairColorizationEnabledKey).user;\n\n\t\tthis.notificationService.notify({\n\t\t\tmessage: localize('bracketPairColorizer.notification', \"The extension 'Bracket pair Colorizer' got disabled because it was deprecated.\"),\n\t\t\tseverity: Severity.Info,\n\t\t\tactions: {\n\t\t\t\tprimary: [\n\t\t\t\t\tnew Action('', localize('bracketPairColorizer.notification.action.uninstall', \"Uninstall Extension\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.extensionsWorkbenchService.uninstall(extension);\n\t\t\t\t\t}),\n\t\t\t\t],\n\t\t\t\tsecondary: [\n\t\t\t\t\t!bracketPairColorizationEnabled ? new Action('', localize('bracketPairColorizer.notification.action.enableNative', \"Enable Native Bracket Pair Colorization\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.configurationService.updateValue(nativeBracketPairColorizationEnabledKey, true, ConfigurationTarget.USER);\n\t\t\t\t\t}) : undefined,\n\t\t\t\t\tnew Action('', localize('bracketPairColorizer.notification.action.showMoreInfo', \"More Info\"), undefined, undefined, () => {\n\t\t\t\t\t\tthis.openerService.open('https://github.com/microsoft/vscode/issues/155179');\n\t\t\t\t\t}),\n\t\t\t\t].filter(isDefined),\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate readonly storageKey = 'deprecatedExtensionMigrator.state';\n\n\tprivate async getState(): Promise<State> {\n\t\tconst jsonStr = await this.storageService.get(this.storageKey, StorageScope.APPLICATION, '');\n\t\tif (jsonStr === '') {\n\t\t\treturn { disablementLog: [] };\n\t\t}\n\t\treturn JSON.parse(jsonStr) as State;\n\t}\n\n\tprivate async setState(state: State): Promise<void> {\n\t\tconst json = JSON.stringify(state);\n\t\tawait this.storageService.store(this.storageKey, json, StorageScope.APPLICATION, StorageTarget.USER);\n\t}\n}\n\ninterface State {\n\tdisablementLog: {\n\t\textensionId: string;\n\t\tdisablementDateTime: number;\n\t}[];\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(WorkbenchExtensions.Workbench).registerWorkbenchContribution(DeprecatedExtensionMigratorContribution, LifecyclePhase.Restored);\n"],
  "mappings": "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",
  "names": []
}
