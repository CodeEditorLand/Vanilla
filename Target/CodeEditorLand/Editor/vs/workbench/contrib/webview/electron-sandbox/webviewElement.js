var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var w=(d,n,e,i)=>{for(var t=i>1?void 0:i?y(n,e):n,o=d.length-1,a;o>=0;o--)(a=d[o])&&(t=(i?a(n,e,t):a(t))||t);return i&&t&&g(n,e,t),t},r=(d,n)=>(e,i)=>n(e,i,d);import{Delayer as _}from"../../../../base/common/async.js";import{Schemas as F}from"../../../../base/common/network.js";import{consumeStream as M}from"../../../../base/common/stream.js";import{ProxyChannel as C}from"../../../../base/parts/ipc/common/ipc.js";import{IAccessibilityService as H}from"../../../../platform/accessibility/common/accessibility.js";import{IConfigurationService as B}from"../../../../platform/configuration/common/configuration.js";import{IContextMenuService as W}from"../../../../platform/contextview/browser/contextView.js";import{IFileService as A}from"../../../../platform/files/common/files.js";import{IInstantiationService as D}from"../../../../platform/instantiation/common/instantiation.js";import{IMainProcessService as x}from"../../../../platform/ipc/common/mainProcessService.js";import{ILogService as L}from"../../../../platform/log/common/log.js";import{INativeHostService as R}from"../../../../platform/native/common/native.js";import{INotificationService as T}from"../../../../platform/notification/common/notification.js";import{IRemoteAuthorityResolverService as N}from"../../../../platform/remote/common/remoteAuthorityResolver.js";import{ITelemetryService as K}from"../../../../platform/telemetry/common/telemetry.js";import{ITunnelService as P}from"../../../../platform/tunnel/common/tunnel.js";import{IWorkbenchEnvironmentService as V}from"../../../services/environment/common/environmentService.js";import{WebviewElement as j}from"../browser/webviewElement.js";import{WindowIgnoreMenuShortcutsManager as k}from"./windowIgnoreMenuShortcutsManager.js";let f=class extends j{constructor(e,i,t,o,a,v,s,c,l,h,p,S,I,u,b){super(e,i,h,t,S,s,a,l,c,v,o,u,b);this._nativeHostService=I;this._webviewKeyboardHandler=new k(h,p,I),this._webviewMainService=C.toService(p.getChannel("webview")),e.options.enableFindWidget&&(this._register(this.onDidHtmlChange(m=>{this._findStarted&&this._cachedHtmlContent!==m&&(this.stopFind(!1),this._cachedHtmlContent=m)})),this._register(this._webviewMainService.onFoundInFrame(m=>{this._hasFindResult.fire(m.matches>0)})))}_webviewKeyboardHandler;_findStarted=!1;_cachedHtmlContent;_webviewMainService;_iframeDelayer=this._register(new _(200));get platform(){return"electron"}dispose(){this._webviewKeyboardHandler.didBlur(),super.dispose()}webviewContentEndpoint(e){return`${F.vscodeWebview}://${e}`}streamToBuffer(e){return M(e,i=>{const t=i.reduce((s,c)=>s+c.byteLength,0),o=new ArrayBuffer(t),a=new Uint8Array(o);let v=0;for(const s of i)a.set(s.buffer,v),v+=s.byteLength;return o})}find(e,i){if(this.element)if(this._findStarted){const t={forward:!i,findNext:!1,matchCase:!1};this._webviewMainService.findInFrame({windowId:this._nativeHostService.windowId},this.id,e,t)}else this.updateFind(e)}updateFind(e){if(!e||!this.element)return;const i={forward:!0,findNext:!0,matchCase:!1};this._iframeDelayer.trigger(()=>{this._findStarted=!0,this._webviewMainService.findInFrame({windowId:this._nativeHostService.windowId},this.id,e,i)})}stopFind(e){this.element&&(this._iframeDelayer.cancel(),this._findStarted=!1,this._webviewMainService.stopFindInFrame({windowId:this._nativeHostService.windowId},this.id,{keepSelection:e}),this._onDidStopFind.fire())}handleFocusChange(e){super.handleFocusChange(e),e?this._webviewKeyboardHandler.didFocus():this._webviewKeyboardHandler.didBlur()}};f=w([r(2,W),r(3,P),r(4,A),r(5,K),r(6,V),r(7,N),r(8,L),r(9,B),r(10,x),r(11,T),r(12,R),r(13,D),r(14,H)],f);export{f as ElectronWebviewElement};
