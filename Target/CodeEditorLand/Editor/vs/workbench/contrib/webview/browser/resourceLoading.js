import{isUNC as m}from"../../../../base/common/extpath.js";import{Schemas as u}from"../../../../base/common/network.js";import{normalize as f,sep as p}from"../../../../base/common/path.js";import{URI as y}from"../../../../base/common/uri.js";import{FileOperationError as R,FileOperationResult as h}from"../../../../platform/files/common/files.js";import{getWebviewContentMimeType as I}from"../../../../platform/webview/common/mimeTypes.js";var s;(a=>{let e;(r=>(r[r.Success=0]="Success",r[r.Failed=1]="Failed",r[r.AccessDenied=2]="AccessDenied",r[r.NotModified=3]="NotModified"))(e=a.Type||={});class o{constructor(t,l,F,r){this.stream=t;this.etag=l;this.mtime=F;this.mimeType=r}type=0}a.StreamSuccess=o,a.Failed={type:1},a.AccessDenied={type:2};class d{constructor(t,l){this.mimeType=t;this.mtime=l}type=3}a.NotModified=d})(s||={});async function O(e,o,n,i,d){i.debug(`loadLocalResource - begin. requestUri=${e}`);const a=S(e,o.roots);if(i.debug(`loadLocalResource - found resource to load. requestUri=${e}, resourceToLoad=${a}`),!a)return s.AccessDenied;const c=I(e);try{const t=await n.readFileStream(a,{etag:o.ifNoneMatch},d);return new s.StreamSuccess(t.value,t.etag,t.mtime,c)}catch(t){return t instanceof R&&t.fileOperationResult===h.FILE_NOT_MODIFIED_SINCE?new s.NotModified(c,t.options?.mtime):(i.debug(`loadLocalResource - Error using fileReader. requestUri=${e}`),s.Failed)}}function S(e,o){for(const n of o)if(g(n,e))return b(e)}function g(e,o){if(e.scheme!==o.scheme)return!1;let n=f(o.fsPath),i=f(e.fsPath+(e.fsPath.endsWith(p)?"":p));return m(e.fsPath)&&m(o.fsPath)&&(i=i.toLowerCase(),n=n.toLowerCase()),n.startsWith(i)}function b(e){return e.scheme===u.vscodeRemote?y.from({scheme:u.vscodeRemote,authority:e.authority,path:"/vscode-resource",query:JSON.stringify({requestResourcePath:e.path})}):e}export{s as WebviewResourceResponse,O as loadLocalResource};
