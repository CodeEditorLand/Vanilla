{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/test/browser/contrib/notebookOutline.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { setupInstantiationService, withTestNotebook } from '../testNotebookEditor.js';\nimport { OutlineTarget } from '../../../../../services/outline/browser/outline.js';\nimport { IFileIconTheme, IThemeService } from '../../../../../../platform/theme/common/themeService.js';\nimport { mock } from '../../../../../../base/test/common/mock.js';\nimport { Event } from '../../../../../../base/common/event.js';\nimport { IEditorService } from '../../../../../services/editor/common/editorService.js';\nimport { IMarkerService } from '../../../../../../platform/markers/common/markers.js';\nimport { MarkerService } from '../../../../../../platform/markers/common/markerService.js';\nimport { CellKind, IOutputDto, NotebookCellMetadata } from '../../../common/notebookCommon.js';\nimport { IActiveNotebookEditor, INotebookEditorPane } from '../../../browser/notebookBrowser.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { NotebookCellOutline, NotebookOutlineCreator } from '../../../browser/contrib/outline/notebookOutline.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\nimport { ILanguageFeaturesService } from '../../../../../../editor/common/services/languageFeatures.js';\nimport { LanguageFeaturesService } from '../../../../../../editor/common/services/languageFeaturesService.js';\nimport { IEditorPaneSelectionChangeEvent } from '../../../../../common/editor.js';\nimport { CancellationToken } from '../../../../../../base/common/cancellation.js';\nimport { INotebookOutlineEntryFactory, NotebookOutlineEntryFactory } from '../../../browser/viewModel/notebookOutlineEntryFactory.js';\n\nsuite('Notebook Outline', function () {\n\n\tlet disposables: DisposableStore;\n\tlet instantiationService: TestInstantiationService;\n\tlet symbolsCached: boolean;\n\n\tteardown(() => disposables.dispose());\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(() => {\n\t\tsymbolsCached = false;\n\t\tdisposables = new DisposableStore();\n\t\tinstantiationService = setupInstantiationService(disposables);\n\t\tinstantiationService.set(IEditorService, new class extends mock<IEditorService>() { });\n\t\tinstantiationService.set(ILanguageFeaturesService, new LanguageFeaturesService());\n\t\tinstantiationService.set(IMarkerService, disposables.add(new MarkerService()));\n\t\tinstantiationService.set(IThemeService, new class extends mock<IThemeService>() {\n\t\t\toverride onDidFileIconThemeChange = Event.None;\n\t\t\toverride getFileIconTheme(): IFileIconTheme {\n\t\t\t\treturn { hasFileIcons: true, hasFolderIcons: true, hidesExplorerArrows: false };\n\t\t\t}\n\t\t});\n\t});\n\n\n\tasync function withNotebookOutline<R = any>(\n\t\tcells: [source: string, lang: string, kind: CellKind, output?: IOutputDto[], metadata?: NotebookCellMetadata][],\n\t\ttarget: OutlineTarget,\n\t\tcallback: (outline: NotebookCellOutline, editor: IActiveNotebookEditor) => R,\n\t): Promise<R> {\n\n\t\treturn withTestNotebook(cells, async (editor) => {\n\t\t\tif (!editor.hasModel()) {\n\t\t\t\tassert.ok(false, 'MUST have active text editor');\n\t\t\t}\n\t\t\tconst notebookEditorPane = new class extends mock<INotebookEditorPane>() {\n\t\t\t\toverride getControl() {\n\t\t\t\t\treturn editor;\n\t\t\t\t}\n\t\t\t\toverride onDidChangeModel: Event<void> = Event.None;\n\t\t\t\toverride onDidChangeSelection: Event<IEditorPaneSelectionChangeEvent> = Event.None;\n\t\t\t};\n\n\n\t\t\tconst testOutlineEntryFactory = instantiationService.createInstance(NotebookOutlineEntryFactory) as any;\n\t\t\ttestOutlineEntryFactory.cacheSymbols = async () => { symbolsCached = true; };\n\t\t\tinstantiationService.stub(INotebookOutlineEntryFactory, testOutlineEntryFactory);\n\n\t\t\tconst outline = await instantiationService.createInstance(NotebookOutlineCreator).createOutline(notebookEditorPane, target, CancellationToken.None);\n\n\t\t\tdisposables.add(outline!);\n\t\t\treturn callback(outline as NotebookCellOutline, editor);\n\t\t});\n\n\t}\n\n\ttest('basic', async function () {\n\t\tawait withNotebookOutline([], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements(), []);\n\t\t});\n\t});\n\n\ttest('special characters in heading', async function () {\n\t\tawait withNotebookOutline([\n\t\t\t['# Hell\u00F6 & H\u00E4llo', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'Hell\u00F6 & H\u00E4llo');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['# bo<i>ld</i>', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'bold');\n\t\t});\n\t});\n\n\ttest('Notebook falsely detects \"empty cells\"', async function () {\n\t\tawait withNotebookOutline([\n\t\t\t['  \u7684\u65F6\u4EE3   ', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, '\u7684\u65F6\u4EE3');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['   ', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'empty cell');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['+++++[]{}--)(0  ', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, '+++++[]{}--)(0');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['+++++[]{}--)(0 Hello **&^ ', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, '+++++[]{}--)(0 Hello **&^');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['!@#$\\n \u00DCberschr\u00EFft', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, '!@#$');\n\t\t});\n\t});\n\n\ttest('Heading text defines entry label', async function () {\n\t\treturn await withNotebookOutline([\n\t\t\t['foo\\n # h1', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 1);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'h1');\n\t\t});\n\t});\n\n\ttest('Notebook outline ignores markdown headings #115200', async function () {\n\t\tawait withNotebookOutline([\n\t\t\t['## h2 \\n# h1', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 2);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'h2');\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[1].label, 'h1');\n\t\t});\n\n\t\tawait withNotebookOutline([\n\t\t\t['## h2', 'md', CellKind.Markup],\n\t\t\t['# h1', 'md', CellKind.Markup]\n\t\t], OutlineTarget.OutlinePane, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements().length, 2);\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[0].label, 'h2');\n\t\t\tassert.deepStrictEqual(outline.config.quickPickDataSource.getQuickPickElements()[1].label, 'h1');\n\t\t});\n\t});\n\n\ttest('Symbols for goto quickpick are pre-cached', async function () {\n\t\tawait withNotebookOutline([\n\t\t\t['a = 1\\nb = 2', 'python', CellKind.Code]\n\t\t], OutlineTarget.QuickPick, outline => {\n\t\t\tassert.ok(outline instanceof NotebookCellOutline);\n\t\t\tassert.strictEqual(symbolsCached, true);\n\t\t});\n\t});\n});\n"],
  "mappings": "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",
  "names": []
}
