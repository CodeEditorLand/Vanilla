var A=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var g=(s,e,i,o)=>{for(var n=o>1?void 0:o?P(e,i):e,r=s.length-1,c;r>=0;r--)(c=s[r])&&(n=(o?c(e,i,n):c(n))||n);return o&&n&&A(e,i,n),n},l=(s,e)=>(i,o)=>e(i,o,s);import"./notebookDiff.css";import*as t from"../../../../../base/browser/dom.js";import"../../../../../base/browser/mouseEvent.js";import{PixelRatio as _}from"../../../../../base/browser/pixelRatio.js";import"../../../../../base/browser/ui/list/list.js";import{isMonacoEditor as R,MouseController as W}from"../../../../../base/browser/ui/list/listWidget.js";import{DisposableStore as C}from"../../../../../base/common/lifecycle.js";import{CodeEditorWidget as N}from"../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import{DiffEditorWidget as K}from"../../../../../editor/browser/widget/diffEditor/diffEditorWidget.js";import"../../../../../editor/common/config/editorOptions.js";import{BareFontInfo as z}from"../../../../../editor/common/config/fontInfo.js";import{localize as j}from"../../../../../nls.js";import{IAccessibilityService as G}from"../../../../../platform/accessibility/common/accessibility.js";import{WorkbenchToolBar as U}from"../../../../../platform/actions/browser/toolbar.js";import{IMenuService as q,MenuItemAction as J}from"../../../../../platform/actions/common/actions.js";import{IConfigurationService as k}from"../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as Q}from"../../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as X}from"../../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as b}from"../../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as Y}from"../../../../../platform/keybinding/common/keybinding.js";import{IListService as Z,WorkbenchList as ee}from"../../../../../platform/list/browser/listService.js";import{INotificationService as oe}from"../../../../../platform/notification/common/notification.js";import{IThemeService as te}from"../../../../../platform/theme/common/themeService.js";import{CodiconActionViewItem as ie}from"../view/cellParts/cellActionView.js";import{fixedDiffEditorOptions as ne,fixedEditorOptions as re}from"./diffCellEditorOptions.js";import{CellDiffPlaceholderElement as le,CollapsedCellOverlayWidget as ce,DeletedElement as se,getOptimizedNestedCodeEditorWidgetOptions as x,InsertElement as ae,ModifiedElement as y,UnchangedCellOverlayWidget as de}from"./diffComponents.js";import"./diffElementViewModel.js";import{DIFF_CELL_MARGIN as me}from"./notebookDiffEditorBrowser.js";let S=class{constructor(e,i){this.configurationService=i;const o=this.configurationService.getValue("editor");this.lineHeight=z.createFromRawSettings(o,_.getInstance(e).value).lineHeight}lineHeight;getHeight(e){return e.getHeight(this.lineHeight)}hasDynamicHeight(e){return!1}getTemplateId(e){switch(e.type){case"delete":case"insert":return m.TEMPLATE_ID;case"modified":case"unchanged":return p.TEMPLATE_ID;case"placeholder":return d.TEMPLATE_ID}}};S=g([l(1,k)],S);let d=class{constructor(e,i){this.notebookEditor=e;this.instantiationService=i}static TEMPLATE_ID="cell_diff_placeholder";get templateId(){return d.TEMPLATE_ID}renderTemplate(e){const i=t.$(".cell-placeholder-body");t.append(e,i);const o=new C,n=new ce(i),r=t.append(i,t.$(".contents")),c=t.append(r,t.$("span.text",{title:j("notebook.diff.hiddenCells.expandAll","Double click to show")}));return{body:i,container:e,placeholder:c,marginOverlay:n,elementDisposables:o}}renderElement(e,i,o,n){o.body.classList.remove("left","right","full"),o.elementDisposables.add(this.instantiationService.createInstance(le,e,o))}disposeTemplate(e){e.container.innerText=""}disposeElement(e,i,o){o.elementDisposables.clear()}};d=g([l(1,b)],d);let m=class{constructor(e,i){this.notebookEditor=e;this.instantiationService=i}static TEMPLATE_ID="cell_diff_single";get templateId(){return m.TEMPLATE_ID}renderTemplate(e){const i=t.$(".cell-body");t.append(e,i);const o=t.$(".cell-diff-editor-container");t.append(i,o);const n=t.append(i,t.$(".diagonal-fill")),r=t.append(o,t.$(".input-header-container")),c=t.append(o,t.$(".source-container")),{editor:u,editorContainer:a}=this._buildSourceEditor(c),f=t.append(o,t.$(".metadata-header-container")),E=t.append(o,t.$(".metadata-info-container")),w=t.append(o,t.$(".output-header-container")),$=t.append(o,t.$(".output-info-container")),h=t.append(i,t.$(".border-container")),T=t.append(h,t.$(".left-border")),v=t.append(h,t.$(".right-border")),M=t.append(h,t.$(".top-border")),D=t.append(h,t.$(".bottom-border"));return{body:i,container:e,editorContainer:a,diffEditorContainer:o,diagonalFill:n,cellHeaderContainer:r,sourceEditor:u,metadataHeaderContainer:f,metadataInfoContainer:E,outputHeaderContainer:w,outputInfoContainer:$,leftBorder:T,rightBorder:v,topBorder:M,bottomBorder:D,elementDisposables:new C}}_buildSourceEditor(e){const i=t.append(e,t.$(".editor-container"));return{editor:this.instantiationService.createInstance(N,i,{...re,glyphMargin:!1,dimension:{width:(this.notebookEditor.getLayoutInfo().width-2*me)/2-18,height:0},automaticLayout:!1,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode()},{}),editorContainer:i}}renderElement(e,i,o,n){switch(o.body.classList.remove("left","right","full"),e.type){case"delete":o.elementDisposables.add(this.instantiationService.createInstance(se,this.notebookEditor,e,o));return;case"insert":o.elementDisposables.add(this.instantiationService.createInstance(ae,this.notebookEditor,e,o));return;default:break}}disposeTemplate(e){e.container.innerText="",e.sourceEditor.dispose(),e.elementDisposables.dispose()}disposeElement(e,i,o){o.elementDisposables.clear()}};m=g([l(1,b)],m);let p=class{constructor(e,i,o,n,r,c,u,a,f){this.notebookEditor=e;this.instantiationService=i;this.contextMenuService=o;this.keybindingService=n;this.menuService=r;this.contextKeyService=c;this.notificationService=u;this.themeService=a;this.accessibilityService=f}static TEMPLATE_ID="cell_diff_side_by_side";get templateId(){return p.TEMPLATE_ID}renderTemplate(e){const i=t.$(".cell-body");t.append(e,i);const o=t.$(".cell-diff-editor-container");t.append(i,o);const n=t.append(o,t.$(".input-header-container")),r=t.append(o,t.$(".source-container")),{editor:c,editorContainer:u}=this._buildSourceEditor(r),a=t.append(r,t.$(".editor-input-toolbar-container")),f=t.append(a,t.$("div.property-toolbar")),E=this.instantiationService.createInstance(U,f,{actionViewItemProvider:(B,O)=>{if(B instanceof J)return new ie(B,{hoverDelegate:O.hoverDelegate},this.keybindingService,this.notificationService,this.contextKeyService,this.themeService,this.contextMenuService,this.accessibilityService)},highlightToggledItems:!0}),w=t.append(o,t.$(".metadata-header-container")),$=t.append(o,t.$(".metadata-info-container")),h=t.append(o,t.$(".output-header-container")),T=t.append(o,t.$(".output-info-container")),v=t.append(i,t.$(".border-container")),M=t.append(v,t.$(".left-border")),D=t.append(v,t.$(".right-border")),L=t.append(v,t.$(".top-border")),V=t.append(v,t.$(".bottom-border")),F=new de(i),H=new C;return{body:i,container:e,diffEditorContainer:o,cellHeaderContainer:n,sourceEditor:c,editorContainer:u,inputToolbarContainer:a,toolbar:E,metadataHeaderContainer:w,metadataInfoContainer:$,outputHeaderContainer:h,outputInfoContainer:T,leftBorder:M,rightBorder:D,topBorder:L,bottomBorder:V,marginOverlay:F,elementDisposables:H}}_buildSourceEditor(e){const i=t.append(e,t.$(".editor-container"));return{editor:this.instantiationService.createInstance(K,i,{...ne,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),originalEditable:!1,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:0,width:0},renderSideBySide:!0,useInlineViewWhenSpaceIsLimited:!1},{originalEditor:x(),modifiedEditor:x()}),editorContainer:i}}renderElement(e,i,o,n){switch(o.body.classList.remove("left","right","full"),e.type){case"unchanged":o.elementDisposables.add(this.instantiationService.createInstance(y,this.notebookEditor,e,o));return;case"modified":o.elementDisposables.add(this.instantiationService.createInstance(y,this.notebookEditor,e,o));return;default:break}}disposeTemplate(e){e.container.innerText="",e.sourceEditor.dispose(),e.toolbar?.dispose(),e.elementDisposables.dispose()}disposeElement(e,i,o){o.toolbar&&(o.toolbar.context=void 0),o.elementDisposables.clear()}};p=g([l(1,b),l(2,X),l(3,Y),l(4,q),l(5,Q),l(6,oe),l(7,te),l(8,G)],p);class pe extends W{onViewPointer(e){if(R(e.browserEvent.target)){const i=typeof e.index>"u"?[]:[e.index];this.list.setFocus(i,e.browserEvent)}else super.onViewPointer(e)}}let I=class extends ee{styleElement;get rowsContainer(){return this.view.containerDomNode}constructor(e,i,o,n,r,c,u,a,f){super(e,i,o,n,c,r,u,a,f)}createMouseController(e){return new pe(this)}getCellViewScrollTop(e){const i=this.indexOf(e);return this.view.elementTop(i)}getScrollHeight(){return this.view.scrollHeight}triggerScrollFromMouseWheelEvent(e){this.view.delegateScrollFromMouseWheelEvent(e)}delegateVerticalScrollbarPointerDown(e){this.view.delegateVerticalScrollbarPointerDown(e)}clear(){super.splice(0,this.length)}updateElementHeight2(e,i){const o=this.indexOf(e),n=this.getFocus();this.view.updateElementHeight(o,i,n.length?n[0]:null)}style(e){const i=this.view.domId;this.styleElement||(this.styleElement=t.createStyleSheet(this.view.domNode));const o=i&&`.${i}`,n=[];e.listBackground&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows { background: ${e.listBackground}; }`),e.listFocusBackground&&(n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused { background-color: ${e.listFocusBackground}; }`),n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused:hover { background-color: ${e.listFocusBackground}; }`)),e.listFocusForeground&&n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused { color: ${e.listFocusForeground}; }`),e.listActiveSelectionBackground&&(n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected { background-color: ${e.listActiveSelectionBackground}; }`),n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected:hover { background-color: ${e.listActiveSelectionBackground}; }`)),e.listActiveSelectionForeground&&n.push(`.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected { color: ${e.listActiveSelectionForeground}; }`),e.listFocusAndSelectionBackground&&n.push(`
				.monaco-drag-image,
				.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected.focused { background-color: ${e.listFocusAndSelectionBackground}; }
			`),e.listFocusAndSelectionForeground&&n.push(`
				.monaco-drag-image,
				.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected.focused { color: ${e.listFocusAndSelectionForeground}; }
			`),e.listInactiveFocusBackground&&(n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused { background-color:  ${e.listInactiveFocusBackground}; }`),n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused:hover { background-color:  ${e.listInactiveFocusBackground}; }`)),e.listInactiveSelectionBackground&&(n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected { background-color:  ${e.listInactiveSelectionBackground}; }`),n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected:hover { background-color:  ${e.listInactiveSelectionBackground}; }`)),e.listInactiveSelectionForeground&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected { color: ${e.listInactiveSelectionForeground}; }`),e.listHoverBackground&&n.push(`.monaco-list${o}:not(.drop-target) > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row:hover:not(.selected):not(.focused) { background-color:  ${e.listHoverBackground}; }`),e.listHoverForeground&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row:hover:not(.selected):not(.focused) { color:  ${e.listHoverForeground}; }`),e.listSelectionOutline&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.selected { outline: 1px dotted ${e.listSelectionOutline}; outline-offset: -1px; }`),e.listFocusOutline&&n.push(`
				.monaco-drag-image,
				.monaco-list${o}:focus > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused { outline: 1px solid ${e.listFocusOutline}; outline-offset: -1px; }
			`),e.listInactiveFocusOutline&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row.focused { outline: 1px dotted ${e.listInactiveFocusOutline}; outline-offset: -1px; }`),e.listHoverOutline&&n.push(`.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows > .monaco-list-row:hover { outline: 1px dashed ${e.listHoverOutline}; outline-offset: -1px; }`),e.listDropOverBackground&&n.push(`
				.monaco-list${o}.drop-target,
				.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-rows.drop-target,
				.monaco-list${o} > div.monaco-scrollable-element > .monaco-list-row.drop-target { background-color: ${e.listDropOverBackground} !important; color: inherit !important; }
			`);const r=n.join(`
`);r!==this.styleElement.textContent&&(this.styleElement.textContent=r)}};I=g([l(6,Z),l(7,k),l(8,b)],I);export{d as CellDiffPlaceholderRenderer,p as CellDiffSideBySideRenderer,m as CellDiffSingleSideRenderer,S as NotebookCellTextDiffListDelegate,pe as NotebookMouseController,I as NotebookTextDiffList};
