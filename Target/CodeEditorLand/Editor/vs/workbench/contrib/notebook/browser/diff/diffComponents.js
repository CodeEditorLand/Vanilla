var st=Object.defineProperty;var rt=Object.getOwnPropertyDescriptor;var b=(m,t,e,i)=>{for(var o=i>1?void 0:i?rt(t,e):t,a=m.length-1,r;a>=0;a--)(r=m[a])&&(o=(i?r(t,e,o):r(o))||o);return i&&o&&st(t,e,o),o},s=(m,t)=>(e,i)=>t(e,i,m);import*as d from"../../../../../../vs/base/browser/dom.js";import{renderIcon as X,renderLabelWithIcons as Q}from"../../../../../../vs/base/browser/ui/iconLabel/iconLabels.js";import"../../../../../../vs/base/browser/ui/toolbar/toolbar.js";import"../../../../../../vs/base/common/actions.js";import{Emitter as Z}from"../../../../../../vs/base/common/event.js";import{Disposable as I,DisposableStore as v}from"../../../../../../vs/base/common/lifecycle.js";import{Schemas as W}from"../../../../../../vs/base/common/network.js";import{EditorExtensionsRegistry as lt}from"../../../../../../vs/editor/browser/editorExtensions.js";import{CodeEditorWidget as tt}from"../../../../../../vs/editor/browser/widget/codeEditor/codeEditorWidget.js";import{DiffEditorWidget as A}from"../../../../../../vs/editor/browser/widget/diffEditor/diffEditorWidget.js";import"../../../../../../vs/editor/common/editorCommon.js";import{ILanguageService as B}from"../../../../../../vs/editor/common/languages/language.js";import{IModelService as $}from"../../../../../../vs/editor/common/services/model.js";import{ITextModelService as K}from"../../../../../../vs/editor/common/services/resolverService.js";import{ITextResourceConfigurationService as P}from"../../../../../../vs/editor/common/services/textResourceConfiguration.js";import{ContextMenuController as ht}from"../../../../../../vs/editor/contrib/contextmenu/browser/contextmenu.js";import{SnippetController2 as ut}from"../../../../../../vs/editor/contrib/snippet/browser/snippetController2.js";import{SuggestController as ct}from"../../../../../../vs/editor/contrib/suggest/browser/suggestController.js";import{localize as M}from"../../../../../../vs/nls.js";import{IAccessibilityService as pt}from"../../../../../../vs/platform/accessibility/common/accessibility.js";import{createAndFillInActionBarActions as H}from"../../../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as ft}from"../../../../../../vs/platform/actions/browser/toolbar.js";import{IMenuService as w,MenuId as S,MenuItemAction as gt}from"../../../../../../vs/platform/actions/common/actions.js";import{ICommandService as mt}from"../../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as z}from"../../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as D}from"../../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as O}from"../../../../../../vs/platform/contextview/browser/contextView.js";import{IInstantiationService as U}from"../../../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as x}from"../../../../../../vs/platform/keybinding/common/keybinding.js";import{INotificationService as k}from"../../../../../../vs/platform/notification/common/notification.js";import{ITelemetryService as _t}from"../../../../../../vs/platform/telemetry/common/telemetry.js";import{IThemeService as Ct}from"../../../../../../vs/platform/theme/common/themeService.js";import{AccessibilityVerbositySettingId as yt}from"../../../../../../vs/workbench/contrib/accessibility/browser/accessibilityConfiguration.js";import{MenuPreventer as St}from"../../../../../../vs/workbench/contrib/codeEditor/browser/menuPreventer.js";import{SelectionClipboardContributionID as Et}from"../../../../../../vs/workbench/contrib/codeEditor/browser/selectionClipboard.js";import{fixedDiffEditorOptions as j,fixedEditorOptions as et,fixedEditorPadding as L,fixedEditorPaddingSingleLineCells as bt}from"../../../../../../vs/workbench/contrib/notebook/browser/diff/diffCellEditorOptions.js";import{OutputContainer as V}from"../../../../../../vs/workbench/contrib/notebook/browser/diff/diffElementOutputs.js";import{getFormattedMetadataJSON as it,getFormattedOutputJSON as T,OUTPUT_EDITOR_HEIGHT_MAGIC as J,OutputComparison as ot,outputEqual as It,PropertyFoldingState as f,SideBySideDiffElementViewModel as vt}from"../../../../../../vs/workbench/contrib/notebook/browser/diff/diffElementViewModel.js";import"../../../../../../vs/workbench/contrib/notebook/browser/diff/diffNestedCellViewModel.js";import{DIFF_CELL_MARGIN as at,DiffSide as g,NOTEBOOK_DIFF_CELL_IGNORE_WHITESPACE as Mt,NOTEBOOK_DIFF_CELL_INPUT as Ht,NOTEBOOK_DIFF_CELL_PROPERTY as wt,NOTEBOOK_DIFF_CELL_PROPERTY_EXPANDED as Dt}from"../../../../../../vs/workbench/contrib/notebook/browser/diff/notebookDiffEditorBrowser.js";import{collapsedIcon as Ot,expandedIcon as xt}from"../../../../../../vs/workbench/contrib/notebook/browser/notebookIcons.js";import{CodiconActionViewItem as kt}from"../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellActionView.js";import{CellEditType as Lt,CellUri as G}from"../../../../../../vs/workbench/contrib/notebook/common/notebookCommon.js";import{TabCompletionController as Vt}from"../../../../../../vs/workbench/contrib/snippets/browser/tabCompletion.js";function E(){return{isSimpleWidget:!1,contributions:lt.getSomeEditorContributions([St.ID,Et,ht.ID,ct.ID,ut.ID,Vt.ID])}}class Be extends I{constructor(t,e){super(),e.body.classList.remove("left","right","full");const i=t.hiddenCells.length===1?M("hiddenCell","{0} hidden cell",t.hiddenCells.length):M("hiddenCells","{0} hidden cells",t.hiddenCells.length);e.placeholder.innerText=i,this._register(d.addDisposableListener(e.placeholder,"dblclick",o=>{o.button===0&&(o.preventDefault(),t.showHiddenCells())})),this._register(e.marginOverlay.onAction(()=>t.showHiddenCells())),e.marginOverlay.show()}}let _=class extends I{constructor(e,i,o,a,r,l,n,h,u,c,p,C,y){super();this.cell=e;this.propertyHeaderContainer=i;this.notebookEditor=o;this.accessor=a;this.contextMenuService=r;this.keybindingService=l;this.commandService=n;this.notificationService=h;this.menuService=u;this.contextKeyService=c;this.themeService=p;this.telemetryService=C;this.accessibilityService=y}_foldingIndicator;_statusSpan;_description;_toolbar;_menu;_propertyExpanded;buildHeader(){const e=this.accessor.checkIfModified(this.cell);this._foldingIndicator=d.append(this.propertyHeaderContainer,d.$(".property-folding-indicator")),this._foldingIndicator.classList.add(this.accessor.prefix),this._updateFoldingIcon();const i=d.append(this.propertyHeaderContainer,d.$("div.property-status"));this._statusSpan=d.append(i,d.$("span")),this._description=d.append(i,d.$("span.property-description")),e?(this._statusSpan.textContent=this.accessor.changedLabel,this._statusSpan.style.fontWeight="bold",e.reason&&(this._description.textContent=e.reason),this.propertyHeaderContainer.classList.add("modified")):(this._statusSpan.textContent=this.accessor.unChangedLabel,this._description.textContent="",this.propertyHeaderContainer.classList.remove("modified"));const o=d.append(this.propertyHeaderContainer,d.$("div.property-toolbar"));this._toolbar=new ft(o,{actionViewItemProvider:(n,h)=>{if(n instanceof gt)return new kt(n,{hoverDelegate:h.hoverDelegate},this.keybindingService,this.notificationService,this.contextKeyService,this.themeService,this.contextMenuService,this.accessibilityService)}},this.menuService,this.contextKeyService,this.contextMenuService,this.keybindingService,this.commandService,this.telemetryService),this._register(this._toolbar),this._toolbar.context={cell:this.cell};const a=this.contextKeyService.createScoped(o);this._register(a),wt.bindTo(a).set(!!e),this._propertyExpanded=Dt.bindTo(a),this._menu=this.menuService.createMenu(this.accessor.menuId,a),this._register(this._menu);const l=[];H(this._menu,{shouldForwardArgs:!0},l),this._toolbar.setActions(l),this._register(this._menu.onDidChange(()=>{const n=[];H(this._menu,{shouldForwardArgs:!0},n),this._toolbar.setActions(n)})),this._register(this.notebookEditor.onMouseUp(n=>{if(!n.event.target)return;const h=n.event.target;if(h.classList.contains("codicon-notebook-collapsed")||h.classList.contains("codicon-notebook-expanded")){const u=h.parentElement;if(!u||!u.classList.contains(this.accessor.prefix)||!u.classList.contains("property-folding-indicator"))return;if(n.target===this.cell){const p=this.accessor.getFoldingState(this.cell);this.accessor.updateFoldingState(this.cell,p===f.Expanded?f.Collapsed:f.Expanded),this._updateFoldingIcon(),this.accessor.updateInfoRendering(this.cell.renderOutput)}}})),this._updateFoldingIcon(),this.accessor.updateInfoRendering(this.cell.renderOutput)}refresh(){const e=this.accessor.checkIfModified(this.cell);if(e){this._statusSpan.textContent=this.accessor.changedLabel,this._statusSpan.style.fontWeight="bold",e.reason&&(this._description.textContent=e.reason),this.propertyHeaderContainer.classList.add("modified");const i=[];H(this._menu,void 0,i),this._toolbar.setActions(i)}else this._statusSpan.textContent=this.accessor.unChangedLabel,this._statusSpan.style.fontWeight="normal",this._description.textContent="",this.propertyHeaderContainer.classList.remove("modified"),this._toolbar.setActions([])}_updateFoldingIcon(){this.accessor.getFoldingState(this.cell)===f.Collapsed?(d.reset(this._foldingIndicator,X(Ot)),this._propertyExpanded?.set(!1)):(d.reset(this._foldingIndicator,X(xt)),this._propertyExpanded?.set(!0))}};_=b([s(4,O),s(5,x),s(6,mt),s(7,k),s(8,w),s(9,D),s(10,Ct),s(11,_t),s(12,pt)],_);class nt extends I{constructor(e,i,o,a,r,l,n,h,u,c,p,C,y,Y,Tt){super();this.notebookEditor=e;this.cell=i;this.templateData=o;this.style=a;this.instantiationService=r;this.languageService=l;this.modelService=n;this.textModelService=h;this.contextMenuService=u;this.keybindingService=c;this.notificationService=p;this.menuService=C;this.contextKeyService=y;this.configurationService=Y;this.textConfigurationService=Tt;this._isDisposed=!1,this._metadataEditorDisposeStore=this._register(new v),this._outputEditorDisposeStore=this._register(new v),this._register(i.onDidLayoutChange(q=>{this.layout(q)})),this._register(i.onDidLayoutChange(q=>this.updateBorders())),this.init(),this.buildBody(),this._register(i.onDidStateChange(()=>{this.updateOutputRendering(this.cell.renderOutput)}))}_metadataLocalDisposable=this._register(new v);_outputLocalDisposable=this._register(new v);_ignoreMetadata=!1;_ignoreOutputs=!1;_cellHeaderContainer;_editorContainer;_cellHeader;_metadataHeaderContainer;_metadataHeader;_metadataInfoContainer;_metadataEditorContainer;_metadataEditorDisposeStore;_metadataEditor;_outputHeaderContainer;_outputHeader;_outputInfoContainer;_outputEditorContainer;_outputViewContainer;_outputLeftContainer;_outputRightContainer;_outputMetadataContainer;_outputEmptyElement;_outputLeftView;_outputRightView;_outputEditorDisposeStore;_outputEditor;_outputMetadataEditor;_diffEditorContainer;_diagonalFill;_isDisposed;buildBody(){const e=this.templateData.body;switch(this._diffEditorContainer=this.templateData.diffEditorContainer,e.classList.remove("left","right","full"),this.style){case"left":e.classList.add("left");break;case"right":e.classList.add("right");break;default:e.classList.add("full");break}this.styleContainer(this._diffEditorContainer),this.updateSourceEditor(),this.cell.modified&&this._register(this.cell.modified.textModel.onDidChangeContent(()=>this._cellHeader.refresh())),this._ignoreMetadata=this.configurationService.getValue("notebook.diff.ignoreMetadata"),this._ignoreMetadata?this._disposeMetadata():this._buildMetadata(),this._ignoreOutputs=this.configurationService.getValue("notebook.diff.ignoreOutputs")||!!this.notebookEditor.textModel?.transientOptions.transientOutputs,this._ignoreOutputs?this._disposeOutput():this._buildOutput(),this._register(this.configurationService.onDidChangeConfiguration(i=>{let o=!1,a=!1;if(i.affectsConfiguration("notebook.diff.ignoreMetadata")){const r=this.configurationService.getValue("notebook.diff.ignoreMetadata");r!==void 0&&this._ignoreMetadata!==r&&(this._ignoreMetadata=r,this._metadataLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():(this.cell.metadataStatusHeight=25,this._buildMetadata(),this.updateMetadataRendering(),o=!0))}if(i.affectsConfiguration("notebook.diff.ignoreOutputs")){const r=this.configurationService.getValue("notebook.diff.ignoreOutputs");r!==void 0&&this._ignoreOutputs!==(r||this.notebookEditor.textModel?.transientOptions.transientOutputs)&&(this._ignoreOutputs=r||!!this.notebookEditor.textModel?.transientOptions.transientOutputs,this._outputLocalDisposable.clear(),this._ignoreOutputs?this._disposeOutput():(this.cell.outputStatusHeight=25,this._buildOutput(),a=!0))}(o||a)&&this.layout({metadataHeight:o,outputTotalHeight:a})}))}updateMetadataRendering(){this.cell.metadataFoldingState===f.Expanded?(this._metadataInfoContainer.style.display="block",!this._metadataEditorContainer||!this._metadataEditor?(this._metadataEditorContainer=d.append(this._metadataInfoContainer,d.$(".metadata-editor-container")),this._buildMetadataEditor()):this.cell.metadataHeight=this._metadataEditor.getContentHeight()):(this._metadataInfoContainer.style.display="none",this.cell.metadataHeight=0)}updateOutputRendering(e){this.cell.outputFoldingState===f.Expanded?(this._outputInfoContainer.style.display="block",e?(this._hideOutputsRaw(),this._buildOutputRendererContainer(),this._showOutputsRenderer(),this._showOutputsEmptyView()):(this._hideOutputsRenderer(),this._buildOutputRawContainer(),this._showOutputsRaw())):(this._outputInfoContainer.style.display="none",this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView())}_buildOutputRawContainer(){this._outputEditorContainer||(this._outputEditorContainer=d.append(this._outputInfoContainer,d.$(".output-editor-container")),this._buildOutputEditor())}_showOutputsRaw(){this._outputEditorContainer&&(this._outputEditorContainer.style.display="block",this.cell.rawOutputHeight=this._outputEditor.getContentHeight())}_showOutputsEmptyView(){this.cell.layoutChange()}_hideOutputsRaw(){this._outputEditorContainer&&(this._outputEditorContainer.style.display="none",this.cell.rawOutputHeight=0)}_hideOutputsEmptyView(){this.cell.layoutChange()}_applySanitizedMetadataChanges(e,i){const o={};try{const a=JSON.parse(i),r=new Set([...Object.keys(a)]);for(const n of r)switch(n){case"inputCollapsed":case"outputCollapsed":typeof a[n]=="boolean"?o[n]=a[n]:o[n]=e[n];break;default:o[n]=a[n];break}const l=this.notebookEditor.textModel.cells.indexOf(this.cell.modified.textModel);if(l<0)return;this.notebookEditor.textModel.applyEdits([{editType:Lt.Metadata,index:l,metadata:o}],!0,void 0,()=>{},void 0,!0)}catch{}}async _buildMetadataEditor(){if(this._metadataEditorDisposeStore.clear(),this.cell instanceof vt){this._metadataEditor=this.instantiationService.createInstance(A,this._metadataEditorContainer,{...j,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!1,originalEditable:!1,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:this.cell.layoutInfo.metadataHeight,width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!0,!0)}},{originalEditor:E(),modifiedEditor:E()}),this.layout({metadataHeight:!0}),this._metadataEditorDisposeStore.add(this._metadataEditor),this._metadataEditorContainer?.classList.add("diff");const e=await this.textModelService.createModelReference(G.generateCellPropertyUri(this.cell.originalDocument.uri,this.cell.original.handle,W.vscodeNotebookCellMetadata)),i=await this.textModelService.createModelReference(G.generateCellPropertyUri(this.cell.modifiedDocument.uri,this.cell.modified.handle,W.vscodeNotebookCellMetadata));this._metadataEditor.setModel({original:e.object.textEditorModel,modified:i.object.textEditorModel}),this._metadataEditorDisposeStore.add(e),this._metadataEditorDisposeStore.add(i),this.cell.metadataHeight=this._metadataEditor.getContentHeight(),this._metadataEditorDisposeStore.add(this._metadataEditor.onDidContentSizeChange(a=>{a.contentHeightChanged&&this.cell.metadataFoldingState===f.Expanded&&(this.cell.metadataHeight=a.contentHeight)}));let o=!1;this._metadataEditorDisposeStore.add(i.object.textEditorModel.onDidChangeContent(()=>{o=!0;const a=i.object.textEditorModel.getValue();this._applySanitizedMetadataChanges(this.cell.modified.metadata,a),this._metadataHeader.refresh(),o=!1})),this._metadataEditorDisposeStore.add(this.cell.modified.textModel.onDidChangeMetadata(()=>{if(o)return;const a=it(this.notebookEditor.textModel,this.cell.modified?.metadata||{},this.cell.modified?.language);i.object.textEditorModel.setValue(a)}));return}else{this._metadataEditor=this.instantiationService.createInstance(tt,this._metadataEditorContainer,{...et,dimension:{width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight},overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!1},{}),this.layout({metadataHeight:!0}),this._metadataEditorDisposeStore.add(this._metadataEditor);const e=this.languageService.createById("jsonc"),i=it(this.notebookEditor.textModel,this.cell.type==="insert"?this.cell.modified.metadata||{}:this.cell.original.metadata||{}),o=this.cell.type==="insert"?this.cell.modified.uri:this.cell.original.uri,a=this.cell.type==="insert"?this.cell.modified.handle:this.cell.original.handle,r=G.generateCellPropertyUri(o,a,W.vscodeNotebookCellMetadata),l=this.modelService.createModel(i,e,r,!1);this._metadataEditor.setModel(l),this._metadataEditorDisposeStore.add(l),this.cell.metadataHeight=this._metadataEditor.getContentHeight(),this._metadataEditorDisposeStore.add(this._metadataEditor.onDidContentSizeChange(n=>{n.contentHeightChanged&&this.cell.metadataFoldingState===f.Expanded&&(this.cell.metadataHeight=n.contentHeight)}))}}_buildOutputEditor(){if(this._outputEditorDisposeStore.clear(),(this.cell.type==="modified"||this.cell.type==="unchanged")&&!this.notebookEditor.textModel.transientOptions.transientOutputs){const a=T(this.cell.original?.outputs||[]),r=T(this.cell.modified?.outputs||[]);if(a!==r){const l=this.languageService.createById("json"),n=this.modelService.createModel(a,l,void 0,!0),h=this.modelService.createModel(r,l,void 0,!0);this._outputEditorDisposeStore.add(n),this._outputEditorDisposeStore.add(h);const u=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,c=Math.max(n.getLineCount(),h.getLineCount());this._outputEditor=this.instantiationService.createInstance(A,this._outputEditorContainer,{...j,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!0,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:Math.min(J,this.cell.layoutInfo.rawOutputHeight||u*c),width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0)},accessibilityVerbose:this.configurationService.getValue(yt.DiffEditor)??!1},{originalEditor:E(),modifiedEditor:E()}),this._outputEditorDisposeStore.add(this._outputEditor),this._outputEditorContainer?.classList.add("diff"),this._outputEditor.setModel({original:n,modified:h}),this._outputEditor.restoreViewState(this.cell.getOutputEditorViewState()),this.cell.rawOutputHeight=this._outputEditor.getContentHeight(),this._outputEditorDisposeStore.add(this._outputEditor.onDidContentSizeChange(p=>{p.contentHeightChanged&&this.cell.outputFoldingState===f.Expanded&&(this.cell.rawOutputHeight=p.contentHeight)})),this._outputEditorDisposeStore.add(this.cell.modified.textModel.onDidChangeOutputs(()=>{const p=T(this.cell.modified?.outputs||[]);h.setValue(p),this._outputHeader.refresh()}));return}}this._outputEditor=this.instantiationService.createInstance(tt,this._outputEditorContainer,{...et,dimension:{width:Math.min(J,this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,this.cell.type==="unchanged"||this.cell.type==="modified")-32),height:this.cell.layoutInfo.rawOutputHeight},overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode()},{}),this._outputEditorDisposeStore.add(this._outputEditor);const e=this.languageService.createById("json"),i=T(this.notebookEditor.textModel.transientOptions.transientOutputs?[]:this.cell.type==="insert"?this.cell.modified.outputs||[]:this.cell.original.outputs||[]),o=this.modelService.createModel(i,e,void 0,!0);this._outputEditorDisposeStore.add(o),this._outputEditor.setModel(o),this._outputEditor.restoreViewState(this.cell.getOutputEditorViewState()),this.cell.rawOutputHeight=this._outputEditor.getContentHeight(),this._outputEditorDisposeStore.add(this._outputEditor.onDidContentSizeChange(a=>{a.contentHeightChanged&&this.cell.outputFoldingState===f.Expanded&&(this.cell.rawOutputHeight=a.contentHeight)}))}layoutNotebookCell(){this.notebookEditor.layoutNotebookCell(this.cell,this.cell.layoutInfo.totalHeight)}updateBorders(){this.templateData.leftBorder.style.height=`${this.cell.layoutInfo.totalHeight-32}px`,this.templateData.rightBorder.style.height=`${this.cell.layoutInfo.totalHeight-32}px`,this.templateData.bottomBorder.style.top=`${this.cell.layoutInfo.totalHeight-32}px`}dispose(){this._outputEditor&&this.cell.saveOutputEditorViewState(this._outputEditor.saveViewState()),this._metadataEditor&&this.cell.saveMetadataEditorViewState(this._metadataEditor.saveViewState()),this._metadataEditorDisposeStore.dispose(),this._outputEditorDisposeStore.dispose(),this._isDisposed=!0,super.dispose()}}class dt extends nt{_editor;cell;templateData;constructor(t,e,i,o,a,r,l,n,h,u,c,p,C,y,Y){super(t,e,i,o,a,r,l,n,h,u,c,p,C,y,Y),this.cell=e,this.templateData=i,this.updateBorders()}init(){this._diagonalFill=this.templateData.diagonalFill}buildBody(){const t=this.templateData.body;switch(this._diffEditorContainer=this.templateData.diffEditorContainer,t.classList.remove("left","right","full"),this.style){case"left":t.classList.add("left");break;case"right":t.classList.add("right");break;default:t.classList.add("full");break}this.styleContainer(this._diffEditorContainer),this.updateSourceEditor(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():this._buildMetadata(),this.configurationService.getValue("notebook.diff.ignoreOutputs")||this.notebookEditor.textModel?.transientOptions.transientOutputs?this._disposeOutput():this._buildOutput(),this._register(this.configurationService.onDidChangeConfiguration(e=>{let i=!1,o=!1;e.affectsConfiguration("notebook.diff.ignoreMetadata")&&(this._metadataLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreMetadata")?this._disposeMetadata():(this.cell.metadataStatusHeight=25,this._buildMetadata(),this.updateMetadataRendering(),i=!0)),e.affectsConfiguration("notebook.diff.ignoreOutputs")&&(this._outputLocalDisposable.clear(),this.configurationService.getValue("notebook.diff.ignoreOutputs")||this.notebookEditor.textModel?.transientOptions.transientOutputs?this._disposeOutput():(this.cell.outputStatusHeight=25,this._buildOutput(),o=!0)),(i||o)&&this.layout({metadataHeight:i,outputTotalHeight:o})}))}updateSourceEditor(){this._cellHeaderContainer=this.templateData.cellHeaderContainer,this._cellHeaderContainer.style.display="flex",this._cellHeaderContainer.innerText="",this._editorContainer=this.templateData.editorContainer,this._editorContainer.classList.add("diff");const t=()=>{if(this.cell.cellFoldingState===f.Collapsed){this._editorContainer.style.display="none",this.cell.editorHeight=0;return}const e=this.nestedCellViewModel.textModel.textBuffer.getLineCount(),i=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,o=e*i+L.top+L.bottom;if(this._editorContainer.style.height=`${o}px`,this._editorContainer.style.display="block",this._editor){const a=this._editor.getContentHeight();a>=0&&(this.cell.editorHeight=a);return}this._editor=this.templateData.sourceEditor,this._editor.layout({width:(this.notebookEditor.getLayoutInfo().width-2*at)/2-18,height:o}),this._editor.updateOptions({readOnly:this.readonly}),this.cell.editorHeight=o,this._register(this._editor.onDidContentSizeChange(a=>{this.cell.cellFoldingState===f.Expanded&&a.contentHeightChanged&&this.cell.layoutInfo.editorHeight!==a.contentHeight&&(this.cell.editorHeight=a.contentHeight)})),this._initializeSourceDiffEditor(this.nestedCellViewModel)};this._cellHeader=this._register(this.instantiationService.createInstance(_,this.cell,this._cellHeaderContainer,this.notebookEditor,{updateInfoRendering:()=>t(),checkIfModified:e=>({reason:void 0}),getFoldingState:e=>e.cellFoldingState,updateFoldingState:(e,i)=>e.cellFoldingState=i,unChangedLabel:"Input",changedLabel:"Input",prefix:"input",menuId:S.NotebookDiffCellInputTitle})),this._cellHeader.buildHeader(),t(),this._initializeSourceDiffEditor(this.nestedCellViewModel)}calculateDiagonalFillHeight(){return this.cell.layoutInfo.cellStatusHeight+this.cell.layoutInfo.editorHeight+this.cell.layoutInfo.editorMargin+this.cell.layoutInfo.metadataStatusHeight+this.cell.layoutInfo.metadataHeight+this.cell.layoutInfo.outputTotalHeight+this.cell.layoutInfo.outputStatusHeight}async _initializeSourceDiffEditor(t){const e=await this.textModelService.createModelReference(t.uri);if(this._isDisposed)return;const i=e.object.textEditorModel;this._register(e),this._editor.setModel(i);const o=this.cell.getSourceEditorViewState();o&&this._editor.restoreViewState(o);const a=this._editor.getContentHeight();this.cell.editorHeight=a;const r=`${this.calculateDiagonalFillHeight()}px`;this._diagonalFill.style.height!==r&&(this._diagonalFill.style.height=r)}_disposeMetadata(){this.cell.metadataStatusHeight=0,this.cell.metadataHeight=0,this.templateData.cellHeaderContainer.style.display="none",this.templateData.metadataHeaderContainer.style.display="none",this.templateData.metadataInfoContainer.style.display="none",this._metadataEditor=void 0}_buildMetadata(){this._metadataHeaderContainer=this.templateData.metadataHeaderContainer,this._metadataInfoContainer=this.templateData.metadataInfoContainer,this._metadataHeaderContainer.style.display="flex",this._metadataInfoContainer.style.display="block",this._metadataHeaderContainer.innerText="",this._metadataInfoContainer.innerText="",this._metadataHeader=this.instantiationService.createInstance(_,this.cell,this._metadataHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateMetadataRendering.bind(this),checkIfModified:t=>t.checkMetadataIfModified(),getFoldingState:t=>t.metadataFoldingState,updateFoldingState:(t,e)=>{t.metadataFoldingState=e},unChangedLabel:"Metadata",changedLabel:"Metadata changed",prefix:"metadata",menuId:S.NotebookDiffCellMetadataTitle}),this._metadataLocalDisposable.add(this._metadataHeader),this._metadataHeader.buildHeader()}_buildOutput(){this.templateData.outputHeaderContainer.style.display="flex",this.templateData.outputInfoContainer.style.display="block",this._outputHeaderContainer=this.templateData.outputHeaderContainer,this._outputInfoContainer=this.templateData.outputInfoContainer,this._outputHeaderContainer.innerText="",this._outputInfoContainer.innerText="",this._outputHeader=this.instantiationService.createInstance(_,this.cell,this._outputHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateOutputRendering.bind(this),checkIfModified:t=>t.checkIfOutputsModified(),getFoldingState:t=>t.outputFoldingState,updateFoldingState:(t,e)=>{t.outputFoldingState=e},unChangedLabel:"Outputs",changedLabel:"Outputs changed",prefix:"output",menuId:S.NotebookDiffCellOutputsTitle}),this._outputLocalDisposable.add(this._outputHeader),this._outputHeader.buildHeader()}_disposeOutput(){this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView(),this.cell.rawOutputHeight=0,this.cell.outputStatusHeight=0,this.templateData.outputHeaderContainer.style.display="none",this.templateData.outputInfoContainer.style.display="none",this._outputViewContainer=void 0}}let R=class extends dt{constructor(t,e,i,o,a,r,l,n,h,u,c,p,C,y){super(t,e,i,"left",l,o,a,r,n,h,u,c,p,C,y)}get nestedCellViewModel(){return this.cell.original}get readonly(){return!0}styleContainer(t){t.classList.remove("inserted"),t.classList.add("removed")}layout(t){d.scheduleAtNextAnimationFrame(d.getWindow(this._diffEditorContainer),()=>{(t.editorHeight||t.outerWidth)&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.metadataHeight}),(t.outputTotalHeight||t.outerWidth)&&this._outputEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.outputTotalHeight}),this._diagonalFill&&(this._diagonalFill.style.height=`${this.calculateDiagonalFillHeight()}px`),this.layoutNotebookCell()})}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=d.append(this._outputInfoContainer,d.$(".output-view-container")),this._outputEmptyElement=d.append(this._outputViewContainer,d.$(".output-empty-view"));const t=d.append(this._outputEmptyElement,d.$("span"));t.innerText="No outputs to render",this.cell.original.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this.cell.layoutChange(),this._outputLeftView=this.instantiationService.createInstance(V,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.original,g.Original,this._outputViewContainer),this._register(this._outputLeftView),this._outputLeftView.render();const e=this.notebookEditor.onDidDynamicOutputRendered(i=>{i.cell.uri.toString()===this.cell.original.uri.toString()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),e.dispose())});this._register(e)}this._outputViewContainer.style.display="block"}_decorate(){this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[])}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputLeftView?.showOutputs(),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputLeftView?.hideOutputs())}dispose(){this._editor&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};R=b([s(3,B),s(4,$),s(5,K),s(6,U),s(7,O),s(8,x),s(9,k),s(10,w),s(11,D),s(12,z),s(13,P)],R);let F=class extends dt{constructor(t,e,i,o,a,r,l,n,h,u,c,p,C,y){super(t,e,i,"right",o,a,r,l,n,h,u,c,p,C,y)}get nestedCellViewModel(){return this.cell.modified}get readonly(){return!1}styleContainer(t){t.classList.remove("removed"),t.classList.add("inserted")}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=d.append(this._outputInfoContainer,d.$(".output-view-container")),this._outputEmptyElement=d.append(this._outputViewContainer,d.$(".output-empty-view")),this._outputEmptyElement.innerText="No outputs to render",this.cell.modified.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this.cell.layoutChange(),this._outputRightView=this.instantiationService.createInstance(V,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.modified,g.Modified,this._outputViewContainer),this._register(this._outputRightView),this._outputRightView.render();const t=this.notebookEditor.onDidDynamicOutputRendered(e=>{e.cell.uri.toString()===this.cell.modified.uri.toString()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[]),t.dispose())});this._register(t)}this._outputViewContainer.style.display="block"}_decorate(){this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[])}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputRightView?.showOutputs(),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputRightView?.hideOutputs())}layout(t){d.scheduleAtNextAnimationFrame(d.getWindow(this._diffEditorContainer),()=>{(t.editorHeight||t.outerWidth)&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight}),(t.outputTotalHeight||t.outerWidth)&&this._outputEditor?.layout({width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!1),height:this.cell.layoutInfo.outputTotalHeight}),this.layoutNotebookCell(),this._diagonalFill&&(this._diagonalFill.style.height=`${this.calculateDiagonalFillHeight()}px`)})}dispose(){this._editor&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};F=b([s(3,U),s(4,B),s(5,$),s(6,K),s(7,O),s(8,x),s(9,k),s(10,w),s(11,D),s(12,z),s(13,P)],F);let N=class extends nt{_editor;_editorViewStateChanged;_toolbar;_menu;cell;templateData;constructor(t,e,i,o,a,r,l,n,h,u,c,p,C,y){super(t,e,i,"full",o,a,r,l,n,h,u,c,p,C,y),this.cell=e,this.templateData=i,this._editorViewStateChanged=!1,this.updateBorders()}init(){}styleContainer(t){t.classList.remove("inserted","removed")}buildBody(){super.buildBody(),this.cell.displayIconToHideUnmodifiedCells?(this._register(this.templateData.marginOverlay.onAction(()=>this.cell.hideUnchangedCells())),this.templateData.marginOverlay.show()):this.templateData.marginOverlay.hide()}_disposeMetadata(){this.cell.metadataStatusHeight=0,this.cell.metadataHeight=0,this.templateData.metadataHeaderContainer.style.display="none",this.templateData.metadataInfoContainer.style.display="none",this._metadataEditor=void 0}_buildMetadata(){this._metadataHeaderContainer=this.templateData.metadataHeaderContainer,this._metadataInfoContainer=this.templateData.metadataInfoContainer,this._metadataHeaderContainer.style.display="flex",this._metadataInfoContainer.style.display="block",this._metadataHeaderContainer.innerText="",this._metadataInfoContainer.innerText="",this._metadataHeader=this.instantiationService.createInstance(_,this.cell,this._metadataHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateMetadataRendering.bind(this),checkIfModified:t=>t.checkMetadataIfModified(),getFoldingState:t=>t.metadataFoldingState,updateFoldingState:(t,e)=>{t.metadataFoldingState=e},unChangedLabel:"Metadata",changedLabel:"Metadata changed",prefix:"metadata",menuId:S.NotebookDiffCellMetadataTitle}),this._metadataLocalDisposable.add(this._metadataHeader),this._metadataHeader.buildHeader()}_disposeOutput(){this._hideOutputsRaw(),this._hideOutputsRenderer(),this._hideOutputsEmptyView(),this.cell.rawOutputHeight=0,this.cell.outputStatusHeight=0,this.templateData.outputHeaderContainer.style.display="none",this.templateData.outputInfoContainer.style.display="none",this._outputViewContainer=void 0}_buildOutput(){this.templateData.outputHeaderContainer.style.display="flex",this.templateData.outputInfoContainer.style.display="block",this._outputHeaderContainer=this.templateData.outputHeaderContainer,this._outputInfoContainer=this.templateData.outputInfoContainer,this._outputHeaderContainer.innerText="",this._outputInfoContainer.innerText="",this.cell.checkIfOutputsModified()?this._outputInfoContainer.classList.add("modified"):this._outputInfoContainer.classList.remove("modified"),this._outputHeader=this.instantiationService.createInstance(_,this.cell,this._outputHeaderContainer,this.notebookEditor,{updateInfoRendering:this.updateOutputRendering.bind(this),checkIfModified:t=>t.checkIfOutputsModified(),getFoldingState:t=>t.outputFoldingState,updateFoldingState:(t,e)=>{t.outputFoldingState=e},unChangedLabel:"Outputs",changedLabel:"Outputs changed",prefix:"output",menuId:S.NotebookDiffCellOutputsTitle}),this._outputLocalDisposable.add(this._outputHeader),this._outputHeader.buildHeader()}_buildOutputRendererContainer(){if(!this._outputViewContainer){this._outputViewContainer=d.append(this._outputInfoContainer,d.$(".output-view-container")),this._outputEmptyElement=d.append(this._outputViewContainer,d.$(".output-empty-view")),this._outputEmptyElement.innerText="No outputs to render",!this.cell.checkIfOutputsModified()&&this.cell.modified.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this.cell.layoutChange(),this._register(this.cell.modified.textModel.onDidChangeOutputs(()=>{!this.cell.checkIfOutputsModified()&&this.cell.modified.outputs.length===0?this._outputEmptyElement.style.display="block":this._outputEmptyElement.style.display="none",this._decorate()})),this._outputLeftContainer=d.append(this._outputViewContainer,d.$(".output-view-container-left")),this._outputRightContainer=d.append(this._outputViewContainer,d.$(".output-view-container-right")),this._outputMetadataContainer=d.append(this._outputViewContainer,d.$(".output-view-container-metadata"));const t=this.cell.checkIfOutputsModified(),e=t&&t.kind===ot.Metadata&&this.cell.original.outputs.length===1&&this.cell.modified.outputs.length===1&&It(this.cell.original.outputs[0],this.cell.modified.outputs[0])===ot.Metadata;if(t&&!e){const i=this.notebookEditor.onDidDynamicOutputRendered(a=>{a.cell.uri.toString()===this.cell.original.uri.toString()&&this.cell.checkIfOutputsModified()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),i.dispose())}),o=this.notebookEditor.onDidDynamicOutputRendered(a=>{a.cell.uri.toString()===this.cell.modified.uri.toString()&&this.cell.checkIfOutputsModified()&&(this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[]),o.dispose())});this._register(i),this._register(o)}if(this._outputLeftView=this.instantiationService.createInstance(V,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.original,g.Original,this._outputLeftContainer),this._outputLeftView.render(),this._register(this._outputLeftView),this._outputRightView=this.instantiationService.createInstance(V,this.notebookEditor,this.notebookEditor.textModel,this.cell,this.cell.modified,g.Modified,this._outputRightContainer),this._outputRightView.render(),this._register(this._outputRightView),t&&!e&&this._decorate(),e){this._outputMetadataContainer.style.top=`${this.cell.layoutInfo.rawOutputHeight}px`,this._outputMetadataEditor=this.instantiationService.createInstance(A,this._outputMetadataContainer,{...j,overflowWidgetsDomNode:this.notebookEditor.getOverflowContainerDomNode(),readOnly:!0,ignoreTrimWhitespace:!1,automaticLayout:!1,dimension:{height:J,width:this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0)}},{originalEditor:E(),modifiedEditor:E()}),this._register(this._outputMetadataEditor);const i=JSON.stringify(this.cell.original.outputs[0].metadata??{},void 0,"	"),o=JSON.stringify(this.cell.modified.outputs[0].metadata??{},void 0,"	"),a=this.languageService.createById("json"),r=this.modelService.createModel(i,a,void 0,!0),l=this.modelService.createModel(o,a,void 0,!0);this._outputMetadataEditor.setModel({original:r,modified:l}),this.cell.outputMetadataHeight=this._outputMetadataEditor.getContentHeight(),this._register(this._outputMetadataEditor.onDidContentSizeChange(n=>{this.cell.outputMetadataHeight=n.contentHeight}))}}this._outputViewContainer.style.display="block"}_decorate(){this.cell.checkIfOutputsModified()?(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,["nb-cellDeleted"],[]),this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,["nb-cellAdded"],[])):(this.notebookEditor.deltaCellOutputContainerClassNames(g.Original,this.cell.original.id,[],["nb-cellDeleted"]),this.notebookEditor.deltaCellOutputContainerClassNames(g.Modified,this.cell.modified.id,[],["nb-cellAdded"]))}_showOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="block",this._outputLeftView?.showOutputs(),this._outputRightView?.showOutputs(),this._outputMetadataEditor?.layout(),this._decorate())}_hideOutputsRenderer(){this._outputViewContainer&&(this._outputViewContainer.style.display="none",this._outputLeftView?.hideOutputs(),this._outputRightView?.hideOutputs())}updateSourceEditor(){this._cellHeaderContainer=this.templateData.cellHeaderContainer,this._cellHeaderContainer.style.display="flex",this._cellHeaderContainer.innerText="";const t=this.cell.modified;this._editorContainer=this.templateData.editorContainer,this._editorContainer.classList.add("diff");const e=()=>{if(this.cell.cellFoldingState===f.Collapsed){this._editorContainer.style.display="none",this.cell.editorHeight=0;return}const n=t.textModel.textBuffer.getLineCount(),h=this.notebookEditor.getLayoutInfo().fontInfo.lineHeight||17,u=this.cell.layoutInfo.editorHeight!==0?this.cell.layoutInfo.editorHeight:n*h+L.top+L.bottom;if(this._editorContainer.style.height=`${u}px`,this._editorContainer.style.display="block",this._editor){const c=this._editor.getContentHeight();c>=0&&(this.cell.editorHeight=c);return}this._editor=this.templateData.sourceEditor,n===1&&this._editor.updateOptions({padding:bt}),this._editor.layout({width:this.notebookEditor.getLayoutInfo().width-2*at,height:u}),this._register(this._editor.onDidContentSizeChange(c=>{this.cell.cellFoldingState===f.Expanded&&c.contentHeightChanged&&this.cell.layoutInfo.editorHeight!==c.contentHeight&&(this.cell.editorHeight=c.contentHeight)})),this._initializeSourceDiffEditor()};this._cellHeader=this._register(this.instantiationService.createInstance(_,this.cell,this._cellHeaderContainer,this.notebookEditor,{updateInfoRendering:()=>e(),checkIfModified:n=>n.modified?.textModel.getValue()!==n.original?.textModel.getValue()?{reason:void 0}:!1,getFoldingState:n=>n.cellFoldingState,updateFoldingState:(n,h)=>n.cellFoldingState=h,unChangedLabel:"Input",changedLabel:"Input changed",prefix:"input",menuId:S.NotebookDiffCellInputTitle})),this._cellHeader.buildHeader(),e();const i=this.contextKeyService.createScoped(this.templateData.inputToolbarContainer);this._register(i);const o=Ht.bindTo(i);o.set(this.cell.modified.textModel.getValue()!==this.cell.original.textModel.getValue());const a=Mt.bindTo(i),r=this.textConfigurationService.getValue(this.cell.modified.uri,"diffEditor.ignoreTrimWhitespace");a.set(r),this._toolbar=this.templateData.toolbar,this._toolbar.context={cell:this.cell};const l=()=>{const n=this.textConfigurationService.getValue(this.cell.modified.uri,"diffEditor.ignoreTrimWhitespace");a.set(n);const h=this.cell.modified.textModel.getValue()!==this.cell.original.textModel.getValue();if(o.set(h),h){const u=[],c=this.menuService.getMenuActions(S.NotebookDiffCellInputTitle,i,{shouldForwardArgs:!0});H(c,u),this._toolbar.setActions(u)}else this._toolbar.setActions([])};this._register(this.cell.modified.textModel.onDidChangeContent(()=>l())),this._register(this.textConfigurationService.onDidChangeConfiguration(n=>{n.affectsConfiguration(this.cell.modified.uri,"diffEditor")&&n.affectedKeys.has("diffEditor.ignoreTrimWhitespace")&&l()})),l()}async _initializeSourceDiffEditor(){const t=this.cell.original,e=this.cell.modified,i=await this.textModelService.createModelReference(t.uri),o=await this.textModelService.createModelReference(e.uri);if(this._isDisposed)return;const a=i.object.textEditorModel,r=o.object.textEditorModel;this._register(i),this._register(o),this._editor.setModel({original:a,modified:r});const l=()=>{this._editorViewStateChanged=!0},n=c=>{(c.scrollTopChanged||c.scrollLeftChanged)&&(this._editorViewStateChanged=!0)};this.updateEditorOptionsForWhitespace(),this._register(this._editor.getOriginalEditor().onDidChangeCursorSelection(l)),this._register(this._editor.getOriginalEditor().onDidScrollChange(n)),this._register(this._editor.getModifiedEditor().onDidChangeCursorSelection(l)),this._register(this._editor.getModifiedEditor().onDidScrollChange(n));const h=this.cell.getSourceEditorViewState();h&&this._editor.restoreViewState(h);const u=this._editor.getContentHeight();this.cell.editorHeight=u}updateEditorOptionsForWhitespace(){const t=this._editor;if(!t)return;const e=t.getModel()?.modified.uri||t.getModel()?.original.uri;if(!e)return;const i=this.textConfigurationService.getValue(e,"diffEditor.ignoreTrimWhitespace");t.updateOptions({ignoreTrimWhitespace:i}),this._register(this.textConfigurationService.onDidChangeConfiguration(o=>{if(o.affectsConfiguration(e,"diffEditor")&&o.affectedKeys.has("diffEditor.ignoreTrimWhitespace")){const a=this.textConfigurationService.getValue(e,"diffEditor.ignoreTrimWhitespace");t.updateOptions({ignoreTrimWhitespace:a})}}))}layout(t){d.scheduleAtNextAnimationFrame(d.getWindow(this._diffEditorContainer),()=>{t.editorHeight&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout({width:this._editor.getViewWidth(),height:this.cell.layoutInfo.editorHeight})),t.outerWidth&&this._editor&&(this._editorContainer.style.height=`${this.cell.layoutInfo.editorHeight}px`,this._editor.layout()),(t.metadataHeight||t.outerWidth)&&this._metadataEditorContainer&&(this._metadataEditorContainer.style.height=`${this.cell.layoutInfo.metadataHeight}px`,this._metadataEditor?.layout({width:this._editor?.getViewWidth()||this.cell.getComputedCellContainerWidth(this.notebookEditor.getLayoutInfo(),!1,!0),height:this.cell.layoutInfo.metadataHeight})),(t.outputTotalHeight||t.outerWidth)&&(this._outputEditorContainer&&(this._outputEditorContainer.style.height=`${this.cell.layoutInfo.outputTotalHeight}px`,this._outputEditor?.layout()),this._outputMetadataContainer&&(this._outputMetadataContainer.style.height=`${this.cell.layoutInfo.outputMetadataHeight}px`,this._outputMetadataContainer.style.top=`${this.cell.layoutInfo.outputTotalHeight-this.cell.layoutInfo.outputMetadataHeight}px`,this._outputMetadataEditor?.layout())),this.layoutNotebookCell()})}dispose(){this._editor&&this._editorViewStateChanged&&this.cell.saveSpirceEditorViewState(this._editor.saveViewState()),super.dispose()}};N=b([s(3,U),s(4,B),s(5,$),s(6,K),s(7,O),s(8,x),s(9,k),s(10,w),s(11,D),s(12,z),s(13,P)],N);class $e extends I{constructor(e){super();this.container=e;this._nodes.root.style.display="none",e.appendChild(this._nodes.root)}_nodes=d.h("div.diff-hidden-cells",[d.h("div.center@content",{style:{display:"flex"}},[d.$("a",{title:M("showUnchangedCells","Show Unchanged Cells"),role:"button",onclick:()=>{this._action.fire()}},...Q("$(unfold)"))])]);_action=this._register(new Z);onAction=this._action.event;show(){this._nodes.root.style.display="block"}hide(){this._nodes.root.style.display="none"}dispose(){this.hide(),this.container.removeChild(this._nodes.root),d.reset(this._nodes.root),super.dispose()}}class Ke extends I{constructor(e){super();this.container=e;this._nodes.root.style.display="none",e.appendChild(this._nodes.root)}_nodes=d.h("div.diff-hidden-cells",[d.h("div.center@content",{style:{display:"flex"}},[d.$("a",{title:M("hideUnchangedCells","Hide Unchanged Cells"),role:"button",onclick:()=>{this._action.fire()}},...Q("$(fold)"))])]);_action=this._register(new Z);onAction=this._action.event;show(){this._nodes.root.style.display="block"}hide(){this._nodes.root.style.display="none"}dispose(){this.hide(),this.container.removeChild(this._nodes.root),d.reset(this._nodes.root),super.dispose()}}export{Be as CellDiffPlaceholderElement,$e as CollapsedCellOverlayWidget,R as DeletedElement,F as InsertElement,N as ModifiedElement,Ke as UnchangedCellOverlayWidget,E as getOptimizedNestedCodeEditorWidgetOptions};
