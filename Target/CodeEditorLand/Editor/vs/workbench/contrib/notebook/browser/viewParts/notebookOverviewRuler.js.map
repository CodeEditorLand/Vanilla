{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/viewParts/notebookOverviewRuler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { getWindow } from \"../../../../../base/browser/dom.js\";\nimport {\n\ttype FastDomNode,\n\tcreateFastDomNode,\n} from \"../../../../../base/browser/fastDomNode.js\";\nimport { PixelRatio } from \"../../../../../base/browser/pixelRatio.js\";\nimport {\n\tIThemeService,\n\tThemable,\n} from \"../../../../../platform/theme/common/themeService.js\";\nimport {\n\ttype INotebookEditorDelegate,\n\tNotebookOverviewRulerLane,\n} from \"../notebookBrowser.js\";\n\nexport class NotebookOverviewRuler extends Themable {\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate _lanes = 3;\n\n\tconstructor(\n\t\treadonly notebookEditor: INotebookEditorDelegate,\n\t\tcontainer: HTMLElement,\n\t\t@IThemeService themeService: IThemeService,\n\t) {\n\t\tsuper(themeService);\n\t\tthis._domNode = createFastDomNode(document.createElement(\"canvas\"));\n\t\tthis._domNode.setPosition(\"relative\");\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain(\"strict\");\n\n\t\tcontainer.appendChild(this._domNode.domNode);\n\n\t\tthis._register(\n\t\t\tnotebookEditor.onDidChangeDecorations(() => {\n\t\t\t\tthis.layout();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tPixelRatio.getInstance(\n\t\t\t\tgetWindow(this._domNode.domNode),\n\t\t\t).onDidChange(() => {\n\t\t\t\tthis.layout();\n\t\t\t}),\n\t\t);\n\t}\n\n\tlayout() {\n\t\tconst width = 10;\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tconst scrollHeight = layoutInfo.scrollHeight;\n\t\tconst height = layoutInfo.height;\n\t\tconst ratio = PixelRatio.getInstance(\n\t\t\tgetWindow(this._domNode.domNode),\n\t\t).value;\n\t\tthis._domNode.setWidth(width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.domNode.width = width * ratio;\n\t\tthis._domNode.domNode.height = height * ratio;\n\t\tconst ctx = this._domNode.domNode.getContext(\"2d\")!;\n\t\tctx.clearRect(0, 0, width * ratio, height * ratio);\n\t\tthis._render(\n\t\t\tctx,\n\t\t\twidth * ratio,\n\t\t\theight * ratio,\n\t\t\tscrollHeight * ratio,\n\t\t\tratio,\n\t\t);\n\t}\n\n\tprivate _render(\n\t\tctx: CanvasRenderingContext2D,\n\t\twidth: number,\n\t\theight: number,\n\t\tscrollHeight: number,\n\t\tratio: number,\n\t) {\n\t\tconst viewModel = this.notebookEditor.getViewModel();\n\t\tconst fontInfo = this.notebookEditor.getLayoutInfo().fontInfo;\n\t\tconst laneWidth = width / this._lanes;\n\n\t\tlet currentFrom = 0;\n\n\t\tif (viewModel) {\n\t\t\tfor (let i = 0; i < viewModel.viewCells.length; i++) {\n\t\t\t\tconst viewCell = viewModel.viewCells[i];\n\t\t\t\tconst textBuffer = viewCell.textBuffer;\n\t\t\t\tconst decorations = viewCell.getCellDecorations();\n\t\t\t\tconst cellHeight =\n\t\t\t\t\t(viewCell.layoutInfo.totalHeight / scrollHeight) *\n\t\t\t\t\tratio *\n\t\t\t\t\theight;\n\n\t\t\t\tdecorations\n\t\t\t\t\t.filter((decoration) => decoration.overviewRuler)\n\t\t\t\t\t.forEach((decoration) => {\n\t\t\t\t\t\tconst overviewRuler = decoration.overviewRuler!;\n\t\t\t\t\t\tconst fillStyle =\n\t\t\t\t\t\t\tthis.getColor(overviewRuler.color) ?? \"#000000\";\n\t\t\t\t\t\tconst lineHeight = Math.min(\n\t\t\t\t\t\t\tfontInfo.lineHeight,\n\t\t\t\t\t\t\t(viewCell.layoutInfo.editorHeight /\n\t\t\t\t\t\t\t\tscrollHeight /\n\t\t\t\t\t\t\t\ttextBuffer.getLineCount()) *\n\t\t\t\t\t\t\t\tratio *\n\t\t\t\t\t\t\t\theight,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst lineNumbers = overviewRuler.modelRanges\n\t\t\t\t\t\t\t.map((range) => range.startLineNumber)\n\t\t\t\t\t\t\t.reduce((previous: number[], current: number) => {\n\t\t\t\t\t\t\t\tif (previous.length === 0) {\n\t\t\t\t\t\t\t\t\tprevious.push(current);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconst last = previous[previous.length - 1];\n\t\t\t\t\t\t\t\t\tif (last !== current) {\n\t\t\t\t\t\t\t\t\t\tprevious.push(current);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\treturn previous;\n\t\t\t\t\t\t\t}, [] as number[]);\n\n\t\t\t\t\t\tlet x = 0;\n\t\t\t\t\t\tswitch (overviewRuler.position) {\n\t\t\t\t\t\t\tcase NotebookOverviewRulerLane.Left:\n\t\t\t\t\t\t\t\tx = 0;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase NotebookOverviewRulerLane.Center:\n\t\t\t\t\t\t\t\tx = laneWidth;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tcase NotebookOverviewRulerLane.Right:\n\t\t\t\t\t\t\t\tx = laneWidth * 2;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\tdefault:\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst width =\n\t\t\t\t\t\t\toverviewRuler.position ===\n\t\t\t\t\t\t\tNotebookOverviewRulerLane.Full\n\t\t\t\t\t\t\t\t? laneWidth * 3\n\t\t\t\t\t\t\t\t: laneWidth;\n\n\t\t\t\t\t\tfor (let i = 0; i < lineNumbers.length; i++) {\n\t\t\t\t\t\t\tctx.fillStyle = fillStyle;\n\t\t\t\t\t\t\tconst lineNumber = lineNumbers[i];\n\t\t\t\t\t\t\tconst offset = (lineNumber - 1) * lineHeight;\n\t\t\t\t\t\t\tctx.fillRect(\n\t\t\t\t\t\t\t\tx,\n\t\t\t\t\t\t\t\tcurrentFrom + offset,\n\t\t\t\t\t\t\t\twidth,\n\t\t\t\t\t\t\t\tlineHeight,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tif (overviewRuler.includeOutput) {\n\t\t\t\t\t\t\tctx.fillStyle = fillStyle;\n\t\t\t\t\t\t\tconst outputOffset =\n\t\t\t\t\t\t\t\t(viewCell.layoutInfo.editorHeight /\n\t\t\t\t\t\t\t\t\tscrollHeight) *\n\t\t\t\t\t\t\t\tratio *\n\t\t\t\t\t\t\t\theight;\n\t\t\t\t\t\t\tconst decorationHeight =\n\t\t\t\t\t\t\t\t(fontInfo.lineHeight / scrollHeight) *\n\t\t\t\t\t\t\t\tratio *\n\t\t\t\t\t\t\t\theight;\n\t\t\t\t\t\t\tctx.fillRect(\n\t\t\t\t\t\t\t\tlaneWidth,\n\t\t\t\t\t\t\t\tcurrentFrom + outputOffset,\n\t\t\t\t\t\t\t\tlaneWidth,\n\t\t\t\t\t\t\t\tdecorationHeight,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\n\t\t\t\tcurrentFrom += cellHeight;\n\t\t\t}\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["width", "i"]
}
