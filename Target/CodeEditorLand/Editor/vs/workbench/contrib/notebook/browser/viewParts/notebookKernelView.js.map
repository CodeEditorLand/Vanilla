{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/viewParts/notebookKernelView.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tActionViewItem,\n\ttype IActionViewItemOptions,\n} from \"../../../../../base/browser/ui/actionbar/actionViewItems.js\";\nimport { Action, type IAction } from \"../../../../../base/common/actions.js\";\nimport type { Event } from \"../../../../../base/common/event.js\";\nimport { ThemeIcon } from \"../../../../../base/common/themables.js\";\nimport { localize, localize2 } from \"../../../../../nls.js\";\nimport {\n\tAction2,\n\tMenuId,\n\tregisterAction2,\n} from \"../../../../../platform/actions/common/actions.js\";\nimport {\n\tContextKeyExpr,\n\ttype IContextKeyService,\n} from \"../../../../../platform/contextkey/common/contextkey.js\";\nimport { ExtensionIdentifier } from \"../../../../../platform/extensions/common/extensions.js\";\nimport {\n\tIInstantiationService,\n\ttype ServicesAccessor,\n} from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { IEditorService } from \"../../../../services/editor/common/editorService.js\";\nimport type { NotebookTextModel } from \"../../common/model/notebookTextModel.js\";\nimport {\n\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\tNOTEBOOK_KERNEL_COUNT,\n} from \"../../common/notebookContextKeys.js\";\nimport {\n\tINotebookKernelHistoryService,\n\tINotebookKernelService,\n} from \"../../common/notebookKernelService.js\";\nimport {\n\tNOTEBOOK_ACTIONS_CATEGORY,\n\tSELECT_KERNEL_ID,\n} from \"../controller/coreActions.js\";\nimport {\n\ttype INotebookEditor,\n\tgetNotebookEditorFromEditorPane,\n} from \"../notebookBrowser.js\";\nimport { selectKernelIcon } from \"../notebookIcons.js\";\nimport {\n\tKernelPickerMRUStrategy,\n\ttype KernelQuickPickContext,\n} from \"./notebookKernelQuickPickStrategy.js\";\n\nfunction getEditorFromContext(\n\teditorService: IEditorService,\n\tcontext?: KernelQuickPickContext,\n): INotebookEditor | undefined {\n\tlet editor: INotebookEditor | undefined;\n\tif (context !== undefined && \"notebookEditorId\" in context) {\n\t\tconst editorId = context.notebookEditorId;\n\t\tconst matchingEditor = editorService.visibleEditorPanes.find(\n\t\t\t(editorPane) => {\n\t\t\t\tconst notebookEditor =\n\t\t\t\t\tgetNotebookEditorFromEditorPane(editorPane);\n\t\t\t\treturn notebookEditor?.getId() === editorId;\n\t\t\t},\n\t\t);\n\t\teditor = getNotebookEditorFromEditorPane(matchingEditor);\n\t} else if (context !== undefined && \"notebookEditor\" in context) {\n\t\teditor = context?.notebookEditor;\n\t} else {\n\t\teditor = getNotebookEditorFromEditorPane(\n\t\t\teditorService.activeEditorPane,\n\t\t);\n\t}\n\n\treturn editor;\n}\n\nregisterAction2(\n\tclass extends Action2 {\n\t\tconstructor() {\n\t\t\tsuper({\n\t\t\t\tid: SELECT_KERNEL_ID,\n\t\t\t\tcategory: NOTEBOOK_ACTIONS_CATEGORY,\n\t\t\t\ttitle: localize2(\n\t\t\t\t\t\"notebookActions.selectKernel\",\n\t\t\t\t\t\"Select Notebook Kernel\",\n\t\t\t\t),\n\t\t\t\ticon: selectKernelIcon,\n\t\t\t\tf1: true,\n\t\t\t\tprecondition: NOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\tmenu: [\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.EditorTitle,\n\t\t\t\t\t\twhen: ContextKeyExpr.and(\n\t\t\t\t\t\t\tNOTEBOOK_IS_ACTIVE_EDITOR,\n\t\t\t\t\t\t\tContextKeyExpr.notEquals(\n\t\t\t\t\t\t\t\t\"config.notebook.globalToolbar\",\n\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t\tgroup: \"navigation\",\n\t\t\t\t\t\torder: -10,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.NotebookToolbar,\n\t\t\t\t\t\twhen: ContextKeyExpr.equals(\n\t\t\t\t\t\t\t\"config.notebook.globalToolbar\",\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t),\n\t\t\t\t\t\tgroup: \"status\",\n\t\t\t\t\t\torder: -10,\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tid: MenuId.InteractiveToolbar,\n\t\t\t\t\t\twhen: NOTEBOOK_KERNEL_COUNT.notEqualsTo(0),\n\t\t\t\t\t\tgroup: \"status\",\n\t\t\t\t\t\torder: -10,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\tmetadata: {\n\t\t\t\t\tdescription: localize(\n\t\t\t\t\t\t\"notebookActions.selectKernel.args\",\n\t\t\t\t\t\t\"Notebook Kernel Args\",\n\t\t\t\t\t),\n\t\t\t\t\targs: [\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tname: \"kernelInfo\",\n\t\t\t\t\t\t\tdescription: \"The kernel info\",\n\t\t\t\t\t\t\tschema: {\n\t\t\t\t\t\t\t\ttype: \"object\",\n\t\t\t\t\t\t\t\trequired: [\"id\", \"extension\"],\n\t\t\t\t\t\t\t\tproperties: {\n\t\t\t\t\t\t\t\t\tid: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\textension: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\tnotebookEditorId: {\n\t\t\t\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tasync run(\n\t\t\taccessor: ServicesAccessor,\n\t\t\tcontext?: KernelQuickPickContext,\n\t\t): Promise<boolean> {\n\t\t\tconst instantiationService = accessor.get(IInstantiationService);\n\t\t\tconst editorService = accessor.get(IEditorService);\n\n\t\t\tconst editor = getEditorFromContext(editorService, context);\n\n\t\t\tif (!editor || !editor.hasModel()) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tlet controllerId =\n\t\t\t\tcontext && \"id\" in context ? context.id : undefined;\n\t\t\tlet extensionId =\n\t\t\t\tcontext && \"extension\" in context\n\t\t\t\t\t? context.extension\n\t\t\t\t\t: undefined;\n\n\t\t\tif (\n\t\t\t\tcontrollerId &&\n\t\t\t\t(typeof controllerId !== \"string\" ||\n\t\t\t\t\ttypeof extensionId !== \"string\")\n\t\t\t) {\n\t\t\t\t// validate context: id & extension MUST be strings\n\t\t\t\tcontrollerId = undefined;\n\t\t\t\textensionId = undefined;\n\t\t\t}\n\n\t\t\tconst notebook = editor.textModel;\n\t\t\tconst notebookKernelService = accessor.get(INotebookKernelService);\n\t\t\tconst matchResult =\n\t\t\t\tnotebookKernelService.getMatchingKernel(notebook);\n\t\t\tconst { selected } = matchResult;\n\n\t\t\tif (\n\t\t\t\tselected &&\n\t\t\t\tcontrollerId &&\n\t\t\t\tselected.id === controllerId &&\n\t\t\t\tExtensionIdentifier.equals(selected.extension, extensionId)\n\t\t\t) {\n\t\t\t\t// current kernel is wanted kernel -> done\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst wantedKernelId = controllerId\n\t\t\t\t? `${extensionId}/${controllerId}`\n\t\t\t\t: undefined;\n\t\t\tconst strategy = instantiationService.createInstance(\n\t\t\t\tKernelPickerMRUStrategy,\n\t\t\t);\n\t\t\treturn strategy.showQuickPick(editor, wantedKernelId);\n\t\t}\n\t},\n);\n\nexport class NotebooKernelActionViewItem extends ActionViewItem {\n\tprivate _kernelLabel?: HTMLAnchorElement;\n\n\tconstructor(\n\t\tactualAction: IAction,\n\t\tprivate readonly _editor:\n\t\t\t| {\n\t\t\t\t\tonDidChangeModel: Event<void>;\n\t\t\t\t\ttextModel: NotebookTextModel | undefined;\n\t\t\t\t\tscopedContextKeyService?: IContextKeyService;\n\t\t\t  }\n\t\t\t| INotebookEditor,\n\t\toptions: IActionViewItemOptions,\n\t\t@INotebookKernelService\n\t\tprivate readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookKernelHistoryService\n\t\tprivate readonly _notebookKernelHistoryService: INotebookKernelHistoryService,\n\t) {\n\t\tsuper(\n\t\t\tundefined,\n\t\t\tnew Action(\n\t\t\t\t\"fakeAction\",\n\t\t\t\tundefined,\n\t\t\t\tThemeIcon.asClassName(selectKernelIcon),\n\t\t\t\ttrue,\n\t\t\t\t(event) => actualAction.run(event),\n\t\t\t),\n\t\t\t{ ...options, label: false, icon: true },\n\t\t);\n\t\tthis._register(_editor.onDidChangeModel(this._update, this));\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidAddKernel(this._update, this),\n\t\t);\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidRemoveKernel(this._update, this),\n\t\t);\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidChangeNotebookAffinity(\n\t\t\t\tthis._update,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidChangeSelectedNotebooks(\n\t\t\t\tthis._update,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidChangeSourceActions(this._update, this),\n\t\t);\n\t\tthis._register(\n\t\t\t_notebookKernelService.onDidChangeKernelDetectionTasks(\n\t\t\t\tthis._update,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\t}\n\n\toverride render(container: HTMLElement): void {\n\t\tthis._update();\n\t\tsuper.render(container);\n\t\tcontainer.classList.add(\"kernel-action-view-item\");\n\t\tthis._kernelLabel = document.createElement(\"a\");\n\t\tcontainer.appendChild(this._kernelLabel);\n\t\tthis.updateLabel();\n\t}\n\n\tprotected override updateLabel() {\n\t\tif (this._kernelLabel) {\n\t\t\tthis._kernelLabel.classList.add(\"kernel-label\");\n\t\t\tthis._kernelLabel.innerText = this._action.label;\n\t\t}\n\t}\n\n\tprotected _update(): void {\n\t\tconst notebook = this._editor.textModel;\n\n\t\tif (!notebook) {\n\t\t\tthis._resetAction();\n\t\t\treturn;\n\t\t}\n\n\t\tKernelPickerMRUStrategy.updateKernelStatusAction(\n\t\t\tnotebook,\n\t\t\tthis._action,\n\t\t\tthis._notebookKernelService,\n\t\t\tthis._notebookKernelHistoryService,\n\t\t);\n\n\t\tthis.updateClass();\n\t}\n\n\tprivate _resetAction(): void {\n\t\tthis._action.enabled = false;\n\t\tthis._action.label = \"\";\n\t\tthis._action.class = \"\";\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
