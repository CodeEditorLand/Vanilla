import"../../../../../../vs/base/browser/ui/list/listView.js";import"../../../../../../vs/base/common/event.js";import"../../../../../../vs/base/common/lifecycle.js";import"../../../../../../vs/base/common/scrollable.js";import"../../../../../../vs/platform/configuration/common/configuration.js";import{CellFocusMode as s}from"../../../../../../vs/workbench/contrib/notebook/browser/notebookBrowser.js";import"../../../../../../vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.js";import"../../../../../../vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.js";import{CellKind as a,NotebookCellExecutionState as u,NotebookSetting as h}from"../../../../../../vs/workbench/contrib/notebook/common/notebookCommon.js";import"../../../../../../vs/workbench/contrib/notebook/common/notebookExecutionStateService.js";class B{constructor(e,o,t){this.notebookExecutionStateService=e;this.configurationService=o;this.scrollEvent=t}stopAnchoring=!1;executionWatcher;scrollWatcher;shouldAnchor(e,o,t,i){if(e.element(o).focusMode===s.Editor)return!0;if(this.stopAnchoring)return!1;const r=e.elementTop(o)+e.elementHeight(o)+t,n=e.renderHeight+e.getScrollTop()>r,l=this.configurationService.getValue(h.scrollToRevealCell)!=="none",c=t>0;return l&&c&&!n?(this.watchAchorDuringExecution(i),!0):!1}watchAchorDuringExecution(e){if(!this.executionWatcher&&e.cellKind===a.Code){const o=this.notebookExecutionStateService.getCellExecution(e.uri);o&&o.state===u.Executing&&(this.executionWatcher=e.onDidStopExecution(()=>{this.executionWatcher?.dispose(),this.executionWatcher=void 0,this.scrollWatcher?.dispose(),this.stopAnchoring=!1}),this.scrollWatcher=this.scrollEvent(t=>{t.scrollTop<t.oldScrollTop&&(this.stopAnchoring=!0,this.scrollWatcher?.dispose())}))}}dispose(){this.executionWatcher?.dispose(),this.scrollWatcher?.dispose()}}export{B as NotebookCellAnchor};
