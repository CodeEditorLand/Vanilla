{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/cellParts/codeCellRunToolbar.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ToolBar } from \"../../../../../../base/browser/ui/toolbar/toolbar.js\";\nimport { Action, type IAction } from \"../../../../../../base/common/actions.js\";\nimport { DisposableStore } from \"../../../../../../base/common/lifecycle.js\";\nimport { MarshalledId } from \"../../../../../../base/common/marshallingIds.js\";\nimport { EditorContextKeys } from \"../../../../../../editor/common/editorContextKeys.js\";\nimport { localize } from \"../../../../../../nls.js\";\nimport { DropdownWithPrimaryActionViewItem } from \"../../../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js\";\nimport { createAndFillInActionBarActions } from \"../../../../../../platform/actions/browser/menuEntryActionViewItem.js\";\nimport {\n\ttype IMenu,\n\tIMenuService,\n\tMenuItemAction,\n} from \"../../../../../../platform/actions/common/actions.js\";\nimport type {\n\tIContextKeyService,\n\tIScopedContextKeyService,\n} from \"../../../../../../platform/contextkey/common/contextkey.js\";\nimport { InputFocusedContext } from \"../../../../../../platform/contextkey/common/contextkeys.js\";\nimport { IContextMenuService } from \"../../../../../../platform/contextview/browser/contextView.js\";\nimport { IInstantiationService } from \"../../../../../../platform/instantiation/common/instantiation.js\";\nimport { IKeybindingService } from \"../../../../../../platform/keybinding/common/keybinding.js\";\nimport {\n\tNOTEBOOK_CELL_EXECUTION_STATE,\n\tNOTEBOOK_CELL_LIST_FOCUSED,\n\tNOTEBOOK_CELL_TYPE,\n\tNOTEBOOK_EDITOR_FOCUSED,\n} from \"../../../common/notebookContextKeys.js\";\nimport type { INotebookCellActionContext } from \"../../controller/coreActions.js\";\nimport type {\n\tICellViewModel,\n\tINotebookEditorDelegate,\n} from \"../../notebookBrowser.js\";\nimport { CellContentPart } from \"../cellPart.js\";\nimport { registerCellToolbarStickyScroll } from \"./cellToolbarStickyScroll.js\";\n\nexport class RunToolbar extends CellContentPart {\n\tprivate toolbar!: ToolBar;\n\n\tprivate primaryMenu: IMenu;\n\tprivate secondaryMenu: IMenu;\n\n\tconstructor(\n\t\treadonly notebookEditor: INotebookEditorDelegate,\n\t\treadonly contextKeyService: IContextKeyService,\n\t\treadonly cellContainer: HTMLElement,\n\t\treadonly runButtonContainer: HTMLElement,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.primaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecutePrimary!, contextKeyService));\n\t\tthis.secondaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecuteToolbar, contextKeyService));\n\t\tthis.createRunCellToolbar(runButtonContainer, cellContainer, contextKeyService);\n\t\tconst updateActions = () => {\n\t\t\tconst actions = this.getCellToolbarActions(this.primaryMenu);\n\t\t\tconst primary = actions.primary[0]; // Only allow one primary action\n\t\t\tthis.toolbar.setActions(primary ? [primary] : []);\n\t\t};\n\t\tupdateActions();\n\t\tthis._register(this.primaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.secondaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.notebookEditor.notebookOptions.onDidChangeOptions(updateActions));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.cellDisposables.add(\n\t\t\tregisterCellToolbarStickyScroll(\n\t\t\t\tthis.notebookEditor,\n\t\t\t\telement,\n\t\t\t\tthis.runButtonContainer,\n\t\t\t),\n\t\t);\n\n\t\tif (this.notebookEditor.hasModel()) {\n\t\t\tconst context: INotebookCellActionContext & { $mid: number } = {\n\t\t\t\tui: true,\n\t\t\t\tcell: element,\n\t\t\t\tnotebookEditor: this.notebookEditor,\n\t\t\t\t$mid: MarshalledId.NotebookCellActionContext,\n\t\t\t};\n\t\t\tthis.toolbar.context = context;\n\t\t}\n\t}\n\n\tgetCellToolbarActions(menu: IMenu): {\n\t\tprimary: IAction[];\n\t\tsecondary: IAction[];\n\t} {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\n\t\tcreateAndFillInActionBarActions(\n\t\t\tmenu,\n\t\t\t{ shouldForwardArgs: true },\n\t\t\tresult,\n\t\t\t(g) => /^inline/.test(g),\n\t\t);\n\n\t\treturn result;\n\t}\n\n\tprivate createRunCellToolbar(\n\t\tcontainer: HTMLElement,\n\t\tcellContainer: HTMLElement,\n\t\tcontextKeyService: IContextKeyService,\n\t) {\n\t\tconst actionViewItemDisposables = this._register(new DisposableStore());\n\t\tconst dropdownAction = this._register(\n\t\t\tnew Action(\n\t\t\t\t\"notebook.moreRunActions\",\n\t\t\t\tlocalize(\"notebook.moreRunActionsLabel\", \"More...\"),\n\t\t\t\t\"codicon-chevron-down\",\n\t\t\t\ttrue,\n\t\t\t),\n\t\t);\n\n\t\tconst keybindingProvider = (action: IAction) =>\n\t\t\tthis.keybindingService.lookupKeybinding(\n\t\t\t\taction.id,\n\t\t\t\texecutionContextKeyService,\n\t\t\t);\n\t\tconst executionContextKeyService = this._register(\n\t\t\tgetCodeCellExecutionContextKeyService(contextKeyService),\n\t\t);\n\t\tthis.toolbar = this._register(\n\t\t\tnew ToolBar(container, this.contextMenuService, {\n\t\t\t\tgetKeyBinding: keybindingProvider,\n\t\t\t\tactionViewItemProvider: (_action, _options) => {\n\t\t\t\t\tactionViewItemDisposables.clear();\n\n\t\t\t\t\tconst primary = this.getCellToolbarActions(this.primaryMenu)\n\t\t\t\t\t\t.primary[0];\n\t\t\t\t\tif (!(primary instanceof MenuItemAction)) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst secondary = this.getCellToolbarActions(\n\t\t\t\t\t\tthis.secondaryMenu,\n\t\t\t\t\t).secondary;\n\t\t\t\t\tif (!secondary.length) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst item = this.instantiationService.createInstance(\n\t\t\t\t\t\tDropdownWithPrimaryActionViewItem,\n\t\t\t\t\t\tprimary,\n\t\t\t\t\t\tdropdownAction,\n\t\t\t\t\t\tsecondary,\n\t\t\t\t\t\t\"notebook-cell-run-toolbar\",\n\t\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t..._options,\n\t\t\t\t\t\t\tgetKeyBinding: keybindingProvider,\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tactionViewItemDisposables.add(\n\t\t\t\t\t\titem.onDidChangeDropdownVisibility((visible) => {\n\t\t\t\t\t\t\tcellContainer.classList.toggle(\n\t\t\t\t\t\t\t\t\"cell-run-toolbar-dropdown-active\",\n\t\t\t\t\t\t\t\tvisible,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\n\t\t\t\t\treturn item;\n\t\t\t\t},\n\t\t\t\trenderDropdownAsChildElement: true,\n\t\t\t}),\n\t\t);\n\t}\n}\n\nexport function getCodeCellExecutionContextKeyService(\n\tcontextKeyService: IContextKeyService,\n): IScopedContextKeyService {\n\t// Create a fake ContextKeyService, and look up the keybindings within this context.\n\tconst executionContextKeyService = contextKeyService.createScoped(\n\t\tdocument.createElement(\"div\"),\n\t);\n\tInputFocusedContext.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.editorTextFocus\n\t\t.bindTo(executionContextKeyService)\n\t\t.set(true);\n\tEditorContextKeys.focus.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.textInputFocus\n\t\t.bindTo(executionContextKeyService)\n\t\t.set(true);\n\tNOTEBOOK_CELL_EXECUTION_STATE.bindTo(executionContextKeyService).set(\n\t\t\"idle\",\n\t);\n\tNOTEBOOK_CELL_LIST_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_EDITOR_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_CELL_TYPE.bindTo(executionContextKeyService).set(\"code\");\n\n\treturn executionContextKeyService;\n}\n"],
  "mappings": "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",
  "names": []
}
