{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/cellParts/codeCellRunToolbar.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { ToolBar } from '../../../../../../base/browser/ui/toolbar/toolbar.js';\nimport { Action, IAction } from '../../../../../../base/common/actions.js';\nimport { DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { MarshalledId } from '../../../../../../base/common/marshallingIds.js';\nimport { EditorContextKeys } from '../../../../../../editor/common/editorContextKeys.js';\nimport { localize } from '../../../../../../nls.js';\nimport { DropdownWithPrimaryActionViewItem } from '../../../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js';\nimport { createAndFillInActionBarActions } from '../../../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenu, IMenuService, MenuItemAction } from '../../../../../../platform/actions/common/actions.js';\nimport { IContextKeyService, IScopedContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { InputFocusedContext } from '../../../../../../platform/contextkey/common/contextkeys.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../../../../../platform/keybinding/common/keybinding.js';\nimport { INotebookCellActionContext } from '../../controller/coreActions.js';\nimport { ICellViewModel, INotebookEditorDelegate } from '../../notebookBrowser.js';\nimport { CellContentPart } from '../cellPart.js';\nimport { registerCellToolbarStickyScroll } from './cellToolbarStickyScroll.js';\nimport { NOTEBOOK_CELL_EXECUTION_STATE, NOTEBOOK_CELL_LIST_FOCUSED, NOTEBOOK_CELL_TYPE, NOTEBOOK_EDITOR_FOCUSED } from '../../../common/notebookContextKeys.js';\n\nexport class RunToolbar extends CellContentPart {\n\tprivate toolbar!: ToolBar;\n\n\tprivate primaryMenu: IMenu;\n\tprivate secondaryMenu: IMenu;\n\n\tconstructor(\n\t\treadonly notebookEditor: INotebookEditorDelegate,\n\t\treadonly contextKeyService: IContextKeyService,\n\t\treadonly cellContainer: HTMLElement,\n\t\treadonly runButtonContainer: HTMLElement,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IContextMenuService private readonly contextMenuService: IContextMenuService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis.primaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecutePrimary!, contextKeyService));\n\t\tthis.secondaryMenu = this._register(menuService.createMenu(this.notebookEditor.creationOptions.menuIds.cellExecuteToolbar, contextKeyService));\n\t\tthis.createRunCellToolbar(runButtonContainer, cellContainer, contextKeyService);\n\t\tconst updateActions = () => {\n\t\t\tconst actions = this.getCellToolbarActions(this.primaryMenu);\n\t\t\tconst primary = actions.primary[0]; // Only allow one primary action\n\t\t\tthis.toolbar.setActions(primary ? [primary] : []);\n\t\t};\n\t\tupdateActions();\n\t\tthis._register(this.primaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.secondaryMenu.onDidChange(updateActions));\n\t\tthis._register(this.notebookEditor.notebookOptions.onDidChangeOptions(updateActions));\n\t}\n\n\toverride didRenderCell(element: ICellViewModel): void {\n\t\tthis.cellDisposables.add(registerCellToolbarStickyScroll(this.notebookEditor, element, this.runButtonContainer));\n\n\t\tif (this.notebookEditor.hasModel()) {\n\t\t\tconst context: INotebookCellActionContext & { $mid: number } = {\n\t\t\t\tui: true,\n\t\t\t\tcell: element,\n\t\t\t\tnotebookEditor: this.notebookEditor,\n\t\t\t\t$mid: MarshalledId.NotebookCellActionContext\n\t\t\t};\n\t\t\tthis.toolbar.context = context;\n\t\t}\n\t}\n\n\tgetCellToolbarActions(menu: IMenu): { primary: IAction[]; secondary: IAction[] } {\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\n\t\tcreateAndFillInActionBarActions(menu, { shouldForwardArgs: true }, result, g => /^inline/.test(g));\n\n\t\treturn result;\n\t}\n\n\tprivate createRunCellToolbar(container: HTMLElement, cellContainer: HTMLElement, contextKeyService: IContextKeyService) {\n\t\tconst actionViewItemDisposables = this._register(new DisposableStore());\n\t\tconst dropdownAction = this._register(new Action('notebook.moreRunActions', localize('notebook.moreRunActionsLabel', \"More...\"), 'codicon-chevron-down', true));\n\n\t\tconst keybindingProvider = (action: IAction) => this.keybindingService.lookupKeybinding(action.id, executionContextKeyService);\n\t\tconst executionContextKeyService = this._register(getCodeCellExecutionContextKeyService(contextKeyService));\n\t\tthis.toolbar = this._register(new ToolBar(container, this.contextMenuService, {\n\t\t\tgetKeyBinding: keybindingProvider,\n\t\t\tactionViewItemProvider: (_action, _options) => {\n\t\t\t\tactionViewItemDisposables.clear();\n\n\t\t\t\tconst primary = this.getCellToolbarActions(this.primaryMenu).primary[0];\n\t\t\t\tif (!(primary instanceof MenuItemAction)) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst secondary = this.getCellToolbarActions(this.secondaryMenu).secondary;\n\t\t\t\tif (!secondary.length) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst item = this.instantiationService.createInstance(DropdownWithPrimaryActionViewItem,\n\t\t\t\t\tprimary,\n\t\t\t\t\tdropdownAction,\n\t\t\t\t\tsecondary,\n\t\t\t\t\t'notebook-cell-run-toolbar',\n\t\t\t\t\tthis.contextMenuService,\n\t\t\t\t\t{\n\t\t\t\t\t\t..._options,\n\t\t\t\t\t\tgetKeyBinding: keybindingProvider\n\t\t\t\t\t});\n\t\t\t\tactionViewItemDisposables.add(item.onDidChangeDropdownVisibility(visible => {\n\t\t\t\t\tcellContainer.classList.toggle('cell-run-toolbar-dropdown-active', visible);\n\t\t\t\t}));\n\n\t\t\t\treturn item;\n\t\t\t},\n\t\t\trenderDropdownAsChildElement: true\n\t\t}));\n\t}\n}\n\nexport function getCodeCellExecutionContextKeyService(contextKeyService: IContextKeyService): IScopedContextKeyService {\n\t// Create a fake ContextKeyService, and look up the keybindings within this context.\n\tconst executionContextKeyService = contextKeyService.createScoped(document.createElement('div'));\n\tInputFocusedContext.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.editorTextFocus.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.focus.bindTo(executionContextKeyService).set(true);\n\tEditorContextKeys.textInputFocus.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_CELL_EXECUTION_STATE.bindTo(executionContextKeyService).set('idle');\n\tNOTEBOOK_CELL_LIST_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_EDITOR_FOCUSED.bindTo(executionContextKeyService).set(true);\n\tNOTEBOOK_CELL_TYPE.bindTo(executionContextKeyService).set('code');\n\n\treturn executionContextKeyService;\n}\n"],
  "mappings": "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",
  "names": []
}
