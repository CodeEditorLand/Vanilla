var h=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var l=(a,o,e,r)=>{for(var t=r>1?void 0:r?k(o,e):o,i=a.length-1,n;i>=0;i--)(n=a[i])&&(t=(r?n(o,e,t):n(t))||t);return r&&t&&h(o,e,t),t},m=(a,o)=>(e,r)=>o(e,r,a);import{throttle as b}from"../../../../../../base/common/decorators.js";import{Disposable as g}from"../../../../../../base/common/lifecycle.js";import{isEqual as f}from"../../../../../../base/common/resources.js";import{IMarkerNavigationService as _,MarkerList as I}from"../../../../../../editor/contrib/gotoError/browser/markerNavigationService.js";import{IConfigurationService as S}from"../../../../../../platform/configuration/common/configuration.js";import{IMarkerService as p,MarkerSeverity as c}from"../../../../../../platform/markers/common/markers.js";import{editorErrorForeground as E,editorWarningForeground as y}from"../../../../../../platform/theme/common/colorRegistry.js";import{WorkbenchPhase as D,registerWorkbenchContribution2 as C}from"../../../../../common/contributions.js";import{CellUri as u}from"../../../common/notebookCommon.js";import{NotebookOverviewRulerLane as R}from"../../notebookBrowser.js";import{registerNotebookContribution as N}from"../../notebookEditorExtensions.js";let d=class{constructor(o,e,r){this._markerService=o;this._configService=r;this._dispoables=e.registerProvider(this)}static ID="workbench.contrib.markerListProvider";_dispoables;dispose(){this._dispoables.dispose()}getMarkerList(o){if(!o)return;const e=u.parse(o);if(e)return new I(r=>u.parse(r)?.notebook.toString()===e.notebook.toString(),this._markerService,this._configService)}};d=l([m(0,p),m(1,_),m(2,S)],d);let s=class extends g{constructor(e,r){super();this._notebookEditor=e;this._markerService=r;this._update(),this._register(this._notebookEditor.onDidChangeModel(()=>this._update())),this._register(this._markerService.onMarkerChanged(t=>{t.some(i=>this._notebookEditor.getCellsInRange().some(n=>f(n.uri,i)))&&this._update()}))}static id="workbench.notebook.markerDecoration";_markersOverviewRulerDecorations=[];_update(){if(!this._notebookEditor.hasModel())return;const e=[];this._notebookEditor.getCellsInRange().forEach(r=>{this._markerService.read({resource:r.uri,severities:c.Error|c.Warning}).forEach(i=>{const n=i.severity===c.Error?E:y,v={startLineNumber:i.startLineNumber,startColumn:i.startColumn,endLineNumber:i.endLineNumber,endColumn:i.endColumn};e.push({handle:r.handle,options:{overviewRuler:{color:n,modelRanges:[v],includeOutput:!1,position:R.Right}}})})}),this._markersOverviewRulerDecorations=this._notebookEditor.deltaCellDecorations(this._markersOverviewRulerDecorations,e)}};l([b(100)],s.prototype,"_update",1),s=l([m(1,p)],s),C(d.ID,d,D.BlockRestore),N(s.id,s);
