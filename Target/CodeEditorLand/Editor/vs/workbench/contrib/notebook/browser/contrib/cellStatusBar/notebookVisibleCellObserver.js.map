{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/cellStatusBar/notebookVisibleCellObserver.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { diffSets } from \"../../../../../../base/common/collections.js\";\nimport { Emitter } from \"../../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n} from \"../../../../../../base/common/lifecycle.js\";\nimport { isDefined } from \"../../../../../../base/common/types.js\";\nimport { cellRangesToIndexes } from \"../../../common/notebookRange.js\";\nimport type { ICellViewModel, INotebookEditor } from \"../../notebookBrowser.js\";\n\nexport interface ICellVisibilityChangeEvent {\n\tadded: ICellViewModel[];\n\tremoved: ICellViewModel[];\n}\n\nexport class NotebookVisibleCellObserver extends Disposable {\n\tprivate readonly _onDidChangeVisibleCells = this._register(\n\t\tnew Emitter<ICellVisibilityChangeEvent>(),\n\t);\n\treadonly onDidChangeVisibleCells = this._onDidChangeVisibleCells.event;\n\n\tprivate readonly _viewModelDisposables = this._register(\n\t\tnew DisposableStore(),\n\t);\n\n\tprivate _visibleCells: ICellViewModel[] = [];\n\n\tget visibleCells(): ICellViewModel[] {\n\t\treturn this._visibleCells;\n\t}\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tthis._notebookEditor.onDidChangeVisibleRanges(\n\t\t\t\tthis._updateVisibleCells,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._notebookEditor.onDidChangeModel(this._onModelChange, this),\n\t\t);\n\t\tthis._updateVisibleCells();\n\t}\n\n\tprivate _onModelChange() {\n\t\tthis._viewModelDisposables.clear();\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._viewModelDisposables.add(\n\t\t\t\tthis._notebookEditor.onDidChangeViewCells(() =>\n\t\t\t\t\tthis.updateEverything(),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\n\t\tthis.updateEverything();\n\t}\n\n\tprotected updateEverything(): void {\n\t\tthis._onDidChangeVisibleCells.fire({\n\t\t\tadded: [],\n\t\t\tremoved: Array.from(this._visibleCells),\n\t\t});\n\t\tthis._visibleCells = [];\n\t\tthis._updateVisibleCells();\n\t}\n\n\tprivate _updateVisibleCells(): void {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newVisibleCells = cellRangesToIndexes(\n\t\t\tthis._notebookEditor.visibleRanges,\n\t\t)\n\t\t\t.map((index) => this._notebookEditor.cellAt(index))\n\t\t\t.filter(isDefined);\n\t\tconst newVisibleHandles = new Set(\n\t\t\tnewVisibleCells.map((cell) => cell.handle),\n\t\t);\n\t\tconst oldVisibleHandles = new Set(\n\t\t\tthis._visibleCells.map((cell) => cell.handle),\n\t\t);\n\t\tconst diff = diffSets(oldVisibleHandles, newVisibleHandles);\n\n\t\tconst added = diff.added\n\t\t\t.map((handle) => this._notebookEditor.getCellByHandle(handle))\n\t\t\t.filter(isDefined);\n\t\tconst removed = diff.removed\n\t\t\t.map((handle) => this._notebookEditor.getCellByHandle(handle))\n\t\t\t.filter(isDefined);\n\n\t\tthis._visibleCells = newVisibleCells;\n\t\tthis._onDidChangeVisibleCells.fire({\n\t\t\tadded,\n\t\t\tremoved,\n\t\t});\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,gBAAgB;AACzB,SAAS,eAAe;AACxB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,iBAAiB;AAC1B,SAAS,2BAA2B;AAQ7B,MAAM,oCAAoC,WAAW;AAAA,EAgB3D,YAA6B,iBAAkC;AAC9D,UAAM;AADsB;AAG5B,SAAK;AAAA,MACJ,KAAK,gBAAgB;AAAA,QACpB,KAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD;AACA,SAAK;AAAA,MACJ,KAAK,gBAAgB,iBAAiB,KAAK,gBAAgB,IAAI;AAAA,IAChE;AACA,SAAK,oBAAoB;AAAA,EAC1B;AAAA,EAjDD,OAoB4D;AAAA;AAAA;AAAA,EAC1C,2BAA2B,KAAK;AAAA,IAChD,IAAI,QAAoC;AAAA,EACzC;AAAA,EACS,0BAA0B,KAAK,yBAAyB;AAAA,EAEhD,wBAAwB,KAAK;AAAA,IAC7C,IAAI,gBAAgB;AAAA,EACrB;AAAA,EAEQ,gBAAkC,CAAC;AAAA,EAE3C,IAAI,eAAiC;AACpC,WAAO,KAAK;AAAA,EACb;AAAA,EAiBQ,iBAAiB;AACxB,SAAK,sBAAsB,MAAM;AACjC,QAAI,KAAK,gBAAgB,SAAS,GAAG;AACpC,WAAK,sBAAsB;AAAA,QAC1B,KAAK,gBAAgB;AAAA,UAAqB,MACzC,KAAK,iBAAiB;AAAA,QACvB;AAAA,MACD;AAAA,IACD;AAEA,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAEU,mBAAyB;AAClC,SAAK,yBAAyB,KAAK;AAAA,MAClC,OAAO,CAAC;AAAA,MACR,SAAS,MAAM,KAAK,KAAK,aAAa;AAAA,IACvC,CAAC;AACD,SAAK,gBAAgB,CAAC;AACtB,SAAK,oBAAoB;AAAA,EAC1B;AAAA,EAEQ,sBAA4B;AACnC,QAAI,CAAC,KAAK,gBAAgB,SAAS,GAAG;AACrC;AAAA,IACD;AAEA,UAAM,kBAAkB;AAAA,MACvB,KAAK,gBAAgB;AAAA,IACtB,EACE,IAAI,CAAC,UAAU,KAAK,gBAAgB,OAAO,KAAK,CAAC,EACjD,OAAO,SAAS;AAClB,UAAM,oBAAoB,IAAI;AAAA,MAC7B,gBAAgB,IAAI,CAAC,SAAS,KAAK,MAAM;AAAA,IAC1C;AACA,UAAM,oBAAoB,IAAI;AAAA,MAC7B,KAAK,cAAc,IAAI,CAAC,SAAS,KAAK,MAAM;AAAA,IAC7C;AACA,UAAM,OAAO,SAAS,mBAAmB,iBAAiB;AAE1D,UAAM,QAAQ,KAAK,MACjB,IAAI,CAAC,WAAW,KAAK,gBAAgB,gBAAgB,MAAM,CAAC,EAC5D,OAAO,SAAS;AAClB,UAAM,UAAU,KAAK,QACnB,IAAI,CAAC,WAAW,KAAK,gBAAgB,gBAAgB,MAAM,CAAC,EAC5D,OAAO,SAAS;AAElB,SAAK,gBAAgB;AACrB,SAAK,yBAAyB,KAAK;AAAA,MAClC;AAAA,MACA;AAAA,IACD,CAAC;AAAA,EACF;AACD;",
  "names": []
}
