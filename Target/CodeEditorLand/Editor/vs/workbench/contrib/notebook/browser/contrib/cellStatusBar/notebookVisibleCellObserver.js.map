{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/cellStatusBar/notebookVisibleCellObserver.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { diffSets } from '../../../../../../base/common/collections.js';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../../../../../base/common/lifecycle.js';\nimport { isDefined } from '../../../../../../base/common/types.js';\nimport { ICellViewModel, INotebookEditor } from '../../notebookBrowser.js';\nimport { cellRangesToIndexes } from '../../../common/notebookRange.js';\n\nexport interface ICellVisibilityChangeEvent {\n\tadded: ICellViewModel[];\n\tremoved: ICellViewModel[];\n}\n\nexport class NotebookVisibleCellObserver extends Disposable {\n\tprivate readonly _onDidChangeVisibleCells = this._register(new Emitter<ICellVisibilityChangeEvent>());\n\treadonly onDidChangeVisibleCells = this._onDidChangeVisibleCells.event;\n\n\tprivate readonly _viewModelDisposables = this._register(new DisposableStore());\n\n\tprivate _visibleCells: ICellViewModel[] = [];\n\n\tget visibleCells(): ICellViewModel[] {\n\t\treturn this._visibleCells;\n\t}\n\n\tconstructor(private readonly _notebookEditor: INotebookEditor) {\n\t\tsuper();\n\n\t\tthis._register(this._notebookEditor.onDidChangeVisibleRanges(this._updateVisibleCells, this));\n\t\tthis._register(this._notebookEditor.onDidChangeModel(this._onModelChange, this));\n\t\tthis._updateVisibleCells();\n\t}\n\n\tprivate _onModelChange() {\n\t\tthis._viewModelDisposables.clear();\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._viewModelDisposables.add(this._notebookEditor.onDidChangeViewCells(() => this.updateEverything()));\n\t\t}\n\n\t\tthis.updateEverything();\n\t}\n\n\tprotected updateEverything(): void {\n\t\tthis._onDidChangeVisibleCells.fire({ added: [], removed: Array.from(this._visibleCells) });\n\t\tthis._visibleCells = [];\n\t\tthis._updateVisibleCells();\n\t}\n\n\tprivate _updateVisibleCells(): void {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newVisibleCells = cellRangesToIndexes(this._notebookEditor.visibleRanges)\n\t\t\t.map(index => this._notebookEditor.cellAt(index))\n\t\t\t.filter(isDefined);\n\t\tconst newVisibleHandles = new Set(newVisibleCells.map(cell => cell.handle));\n\t\tconst oldVisibleHandles = new Set(this._visibleCells.map(cell => cell.handle));\n\t\tconst diff = diffSets(oldVisibleHandles, newVisibleHandles);\n\n\t\tconst added = diff.added\n\t\t\t.map(handle => this._notebookEditor.getCellByHandle(handle))\n\t\t\t.filter(isDefined);\n\t\tconst removed = diff.removed\n\t\t\t.map(handle => this._notebookEditor.getCellByHandle(handle))\n\t\t\t.filter(isDefined);\n\n\t\tthis._visibleCells = newVisibleCells;\n\t\tthis._onDidChangeVisibleCells.fire({\n\t\t\tadded,\n\t\t\tremoved\n\t\t});\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,gBAAgB;AACzB,SAAS,eAAe;AACxB,SAAS,YAAY,uBAAuB;AAC5C,SAAS,iBAAiB;AAC1B,SAAS,gBAAgB,uBAAuB;AAChD,SAAS,2BAA2B;AAO7B,MAAM,oCAAoC,WAAW;AAAA,EAY3D,YAA6B,iBAAkC;AAC9D,UAAM;AADsB;AAG5B,SAAK,UAAU,KAAK,gBAAgB,yBAAyB,KAAK,qBAAqB,IAAI,CAAC;AAC5F,SAAK,UAAU,KAAK,gBAAgB,iBAAiB,KAAK,gBAAgB,IAAI,CAAC;AAC/E,SAAK,oBAAoB;AAAA,EAC1B;AAAA,EAnCD,OAiB4D;AAAA;AAAA;AAAA,EAC1C,2BAA2B,KAAK,UAAU,IAAI,QAAoC,CAAC;AAAA,EAC3F,0BAA0B,KAAK,yBAAyB;AAAA,EAEhD,wBAAwB,KAAK,UAAU,IAAI,gBAAgB,CAAC;AAAA,EAErE,gBAAkC,CAAC;AAAA,EAE3C,IAAI,eAAiC;AACpC,WAAO,KAAK;AAAA,EACb;AAAA,EAUQ,iBAAiB;AACxB,SAAK,sBAAsB,MAAM;AACjC,QAAI,KAAK,gBAAgB,SAAS,GAAG;AACpC,WAAK,sBAAsB,IAAI,KAAK,gBAAgB,qBAAqB,MAAM,KAAK,iBAAiB,CAAC,CAAC;AAAA,IACxG;AAEA,SAAK,iBAAiB;AAAA,EACvB;AAAA,EAEU,mBAAyB;AAClC,SAAK,yBAAyB,KAAK,EAAE,OAAO,CAAC,GAAG,SAAS,MAAM,KAAK,KAAK,aAAa,EAAE,CAAC;AACzF,SAAK,gBAAgB,CAAC;AACtB,SAAK,oBAAoB;AAAA,EAC1B;AAAA,EAEQ,sBAA4B;AACnC,QAAI,CAAC,KAAK,gBAAgB,SAAS,GAAG;AACrC;AAAA,IACD;AAEA,UAAM,kBAAkB,oBAAoB,KAAK,gBAAgB,aAAa,EAC5E,IAAI,WAAS,KAAK,gBAAgB,OAAO,KAAK,CAAC,EAC/C,OAAO,SAAS;AAClB,UAAM,oBAAoB,IAAI,IAAI,gBAAgB,IAAI,UAAQ,KAAK,MAAM,CAAC;AAC1E,UAAM,oBAAoB,IAAI,IAAI,KAAK,cAAc,IAAI,UAAQ,KAAK,MAAM,CAAC;AAC7E,UAAM,OAAO,SAAS,mBAAmB,iBAAiB;AAE1D,UAAM,QAAQ,KAAK,MACjB,IAAI,YAAU,KAAK,gBAAgB,gBAAgB,MAAM,CAAC,EAC1D,OAAO,SAAS;AAClB,UAAM,UAAU,KAAK,QACnB,IAAI,YAAU,KAAK,gBAAgB,gBAAgB,MAAM,CAAC,EAC1D,OAAO,SAAS;AAElB,SAAK,gBAAgB;AACrB,SAAK,yBAAyB,KAAK;AAAA,MAClC;AAAA,MACA;AAAA,IACD,CAAC;AAAA,EACF;AACD;",
  "names": []
}
