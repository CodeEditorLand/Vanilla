{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/notebookEditorWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport \"./media/notebook.css\";\nimport \"./media/notebookCellChat.css\";\nimport \"./media/notebookCellEditorHint.css\";\nimport \"./media/notebookCellInsertToolbar.css\";\nimport \"./media/notebookCellStatusBar.css\";\nimport \"./media/notebookCellTitleToolbar.css\";\nimport \"./media/notebookFocusIndicator.css\";\nimport \"./media/notebookToolbar.css\";\nimport \"./media/notebookDnd.css\";\nimport \"./media/notebookFolding.css\";\nimport \"./media/notebookCellOutput.css\";\nimport \"./media/notebookEditorStickyScroll.css\";\nimport \"./media/notebookKernelActionViewItem.css\";\nimport \"./media/notebookOutline.css\";\nimport * as DOM from \"../../../../base/browser/dom.js\";\nimport type {\n\tIMouseWheelEvent,\n\tStandardMouseEvent,\n} from \"../../../../base/browser/mouseEvent.js\";\nimport { PixelRatio } from \"../../../../base/browser/pixelRatio.js\";\nimport type { IListContextMenuEvent } from \"../../../../base/browser/ui/list/list.js\";\nimport { mainWindow } from \"../../../../base/browser/window.js\";\nimport {\n\tDeferredPromise,\n\tSequencerByKey,\n} from \"../../../../base/common/async.js\";\nimport type { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { Color, RGBA } from \"../../../../base/common/color.js\";\nimport { onUnexpectedError } from \"../../../../base/common/errors.js\";\nimport { Emitter, Event } from \"../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n\ttype IDisposable,\n\tcombinedDisposable,\n\tdispose,\n\ttoDisposable,\n} from \"../../../../base/common/lifecycle.js\";\nimport { Schemas } from \"../../../../base/common/network.js\";\nimport { setTimeout0 } from \"../../../../base/common/platform.js\";\nimport { extname, isEqual } from \"../../../../base/common/resources.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport { generateUuid } from \"../../../../base/common/uuid.js\";\nimport { FontMeasurements } from \"../../../../editor/browser/config/fontMeasurements.js\";\nimport type { ICodeEditor } from \"../../../../editor/browser/editorBrowser.js\";\nimport { EditorExtensionsRegistry } from \"../../../../editor/browser/editorExtensions.js\";\nimport type { IEditorOptions } from \"../../../../editor/common/config/editorOptions.js\";\nimport {\n\tBareFontInfo,\n\ttype FontInfo,\n} from \"../../../../editor/common/config/fontInfo.js\";\nimport type { IDimension } from \"../../../../editor/common/core/dimension.js\";\nimport { Range } from \"../../../../editor/common/core/range.js\";\nimport type { Selection } from \"../../../../editor/common/core/selection.js\";\nimport { CopyPasteController } from \"../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js\";\nimport { DropIntoEditorController } from \"../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js\";\nimport { SuggestController } from \"../../../../editor/contrib/suggest/browser/suggestController.js\";\nimport * as nls from \"../../../../nls.js\";\nimport { MenuId } from \"../../../../platform/actions/common/actions.js\";\nimport { IConfigurationService } from \"../../../../platform/configuration/common/configuration.js\";\nimport {\n\ttype IContextKey,\n\tIContextKeyService,\n\tRawContextKey,\n} from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { IContextMenuService } from \"../../../../platform/contextview/browser/contextView.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { ServiceCollection } from \"../../../../platform/instantiation/common/serviceCollection.js\";\nimport { IKeybindingService } from \"../../../../platform/keybinding/common/keybinding.js\";\nimport { ILayoutService } from \"../../../../platform/layout/browser/layoutService.js\";\nimport {\n\tZIndex,\n\tregisterZIndex,\n} from \"../../../../platform/layout/browser/zIndexRegistry.js\";\nimport {\n\tIEditorProgressService,\n\ttype IProgressRunner,\n} from \"../../../../platform/progress/common/progress.js\";\nimport { ITelemetryService } from \"../../../../platform/telemetry/common/telemetry.js\";\nimport {\n\tcontrastBorder,\n\terrorForeground,\n\tfocusBorder,\n\tforeground,\n\tlistInactiveSelectionBackground,\n\tregisterColor,\n\tscrollbarSliderActiveBackground,\n\tscrollbarSliderBackground,\n\tscrollbarSliderHoverBackground,\n\ttransparent,\n} from \"../../../../platform/theme/common/colorRegistry.js\";\nimport { FloatingEditorClickMenu } from \"../../../browser/codeeditor.js\";\nimport {\n\tEDITOR_PANE_BACKGROUND,\n\tPANEL_BORDER,\n\tSIDE_BAR_BACKGROUND,\n} from \"../../../common/theme.js\";\nimport { IEditorGroupsService } from \"../../../services/editor/common/editorGroupsService.js\";\nimport { AccessibilityVerbositySettingId } from \"../../accessibility/browser/accessibilityConfiguration.js\";\nimport { debugIconStartForeground } from \"../../debug/browser/debugColors.js\";\nimport { PreventDefaultContextMenuItemsContextKeyName } from \"../../webview/browser/webview.contribution.js\";\nimport type { IWebviewElement } from \"../../webview/browser/webview.js\";\nimport type { NotebookTextModel } from \"../common/model/notebookTextModel.js\";\nimport {\n\tCellEditType,\n\tCellKind,\n\ttype INotebookFindOptions,\n\tNotebookFindScopeType,\n\tRENDERER_NOT_AVAILABLE,\n\tSelectionStateType,\n} from \"../common/notebookCommon.js\";\nimport {\n\tNOTEBOOK_CURSOR_NAVIGATION_MODE,\n\tNOTEBOOK_EDITOR_EDITABLE,\n\tNOTEBOOK_EDITOR_FOCUSED,\n\tNOTEBOOK_OUTPUT_FOCUSED,\n\tNOTEBOOK_OUTPUT_INPUT_FOCUSED,\n} from \"../common/notebookContextKeys.js\";\nimport { INotebookExecutionService } from \"../common/notebookExecutionService.js\";\nimport { INotebookExecutionStateService } from \"../common/notebookExecutionStateService.js\";\nimport { INotebookKernelService } from \"../common/notebookKernelService.js\";\nimport { INotebookLoggingService } from \"../common/notebookLoggingService.js\";\nimport type { NotebookPerfMarks } from \"../common/notebookPerformance.js\";\nimport {\n\ttype ICellRange,\n\tcellRangesToIndexes,\n} from \"../common/notebookRange.js\";\nimport { INotebookRendererMessagingService } from \"../common/notebookRendererMessagingService.js\";\nimport { INotebookService } from \"../common/notebookService.js\";\nimport { CellFindMatchModel } from \"./contrib/find/findModel.js\";\nimport { NotebookAccessibilityProvider } from \"./notebookAccessibilityProvider.js\";\nimport {\n\tCellEditState,\n\ttype CellFindMatchWithIndex,\n\tCellFocusMode,\n\ttype CellLayoutContext,\n\tCellRevealRangeType,\n\tCellRevealType,\n\ttype IActiveNotebookEditorDelegate,\n\ttype IBaseCellEditorOptions,\n\ttype ICellOutputViewModel,\n\ttype ICellViewModel,\n\ttype ICommonCellInfo,\n\ttype IDisplayOutputLayoutUpdateRequest,\n\ttype IFocusNotebookCellOptions,\n\ttype IInsetRenderOutput,\n\ttype IModelDecorationsChangeAccessor,\n\ttype INotebookDeltaDecoration,\n\ttype INotebookEditor,\n\ttype INotebookEditorContribution,\n\ttype INotebookEditorContributionDescription,\n\ttype INotebookEditorCreationOptions,\n\ttype INotebookEditorDelegate,\n\ttype INotebookEditorMouseEvent,\n\ttype INotebookEditorOptions,\n\ttype INotebookEditorViewState,\n\ttype INotebookViewCellsUpdateEvent,\n\ttype INotebookViewZoneChangeAccessor,\n\ttype INotebookWebviewMessage,\n\tRenderOutputType,\n\tScrollToRevealBehavior,\n} from \"./notebookBrowser.js\";\nimport { NotebookEditorExtensionsRegistry } from \"./notebookEditorExtensions.js\";\nimport { notebookDebug } from \"./notebookLogger.js\";\nimport {\n\tNotebookOptions,\n\tOutputInnerContainerTopPadding,\n} from \"./notebookOptions.js\";\nimport {\n\ttype NotebookCellStateChangedEvent,\n\tNotebookLayoutChangedEvent,\n\ttype NotebookLayoutInfo,\n} from \"./notebookViewEvents.js\";\nimport { INotebookEditorService } from \"./services/notebookEditorService.js\";\nimport { CellContextKeyManager } from \"./view/cellParts/cellContextKeys.js\";\nimport { CellDragAndDropController } from \"./view/cellParts/cellDnd.js\";\nimport { NotebookCellEditorPool } from \"./view/notebookCellEditorPool.js\";\nimport {\n\tListViewInfoAccessor,\n\tNOTEBOOK_WEBVIEW_BOUNDARY,\n\tNotebookCellList,\n} from \"./view/notebookCellList.js\";\nimport type { INotebookCellList } from \"./view/notebookRenderingCommon.js\";\nimport { BackLayerWebView } from \"./view/renderers/backLayerWebView.js\";\nimport {\n\tCodeCellRenderer,\n\tMarkupCellRenderer,\n\tNotebookCellListDelegate,\n} from \"./view/renderers/cellRenderer.js\";\nimport type {\n\tIAckOutputHeight,\n\tIMarkupCellInitialization,\n} from \"./view/renderers/webviewMessages.js\";\nimport { BaseCellEditorOptions } from \"./viewModel/cellEditorOptions.js\";\nimport {\n\tCodeCellViewModel,\n\toutputDisplayLimit,\n} from \"./viewModel/codeCellViewModel.js\";\nimport { NotebookEventDispatcher } from \"./viewModel/eventDispatcher.js\";\nimport { MarkupCellViewModel } from \"./viewModel/markupCellViewModel.js\";\nimport {\n\ttype CellViewModel,\n\tNotebookViewModel,\n} from \"./viewModel/notebookViewModelImpl.js\";\nimport { ViewContext } from \"./viewModel/viewContext.js\";\nimport { NotebookStickyScroll } from \"./viewParts/notebookEditorStickyScroll.js\";\nimport { NotebookEditorWorkbenchToolbar } from \"./viewParts/notebookEditorToolbar.js\";\nimport { NotebookEditorContextKeys } from \"./viewParts/notebookEditorWidgetContextKeys.js\";\nimport { NotebookHorizontalTracker } from \"./viewParts/notebookHorizontalTracker.js\";\nimport { NotebookOverviewRuler } from \"./viewParts/notebookOverviewRuler.js\";\nimport { ListTopCellToolbar } from \"./viewParts/notebookTopCellToolbar.js\";\n\nconst $ = DOM.$;\n\nexport function getDefaultNotebookCreationOptions(): INotebookEditorCreationOptions {\n\t// We inlined the id to avoid loading comment contrib in tests\n\tconst skipContributions = [\n\t\t\"editor.contrib.review\",\n\t\tFloatingEditorClickMenu.ID,\n\t\t\"editor.contrib.dirtydiff\",\n\t\t\"editor.contrib.testingOutputPeek\",\n\t\t\"editor.contrib.testingDecorations\",\n\t\t\"store.contrib.stickyScrollController\",\n\t\t\"editor.contrib.findController\",\n\t\t\"editor.contrib.emptyTextEditorHint\",\n\t];\n\tconst contributions =\n\t\tEditorExtensionsRegistry.getEditorContributions().filter(\n\t\t\t(c) => skipContributions.indexOf(c.id) === -1,\n\t\t);\n\n\treturn {\n\t\tmenuIds: {\n\t\t\tnotebookToolbar: MenuId.NotebookToolbar,\n\t\t\tcellTitleToolbar: MenuId.NotebookCellTitle,\n\t\t\tcellDeleteToolbar: MenuId.NotebookCellDelete,\n\t\t\tcellInsertToolbar: MenuId.NotebookCellBetween,\n\t\t\tcellTopInsertToolbar: MenuId.NotebookCellListTop,\n\t\t\tcellExecuteToolbar: MenuId.NotebookCellExecute,\n\t\t\tcellExecutePrimary: MenuId.NotebookCellExecutePrimary,\n\t\t},\n\t\tcellEditorContributions: contributions,\n\t};\n}\n\nexport class NotebookEditorWidget\n\textends Disposable\n\timplements INotebookEditorDelegate, INotebookEditor\n{\n\t//#region Eventing\n\tprivate readonly _onDidChangeCellState = this._register(\n\t\tnew Emitter<NotebookCellStateChangedEvent>(),\n\t);\n\treadonly onDidChangeCellState = this._onDidChangeCellState.event;\n\tprivate readonly _onDidChangeViewCells = this._register(\n\t\tnew Emitter<INotebookViewCellsUpdateEvent>(),\n\t);\n\treadonly onDidChangeViewCells: Event<INotebookViewCellsUpdateEvent> =\n\t\tthis._onDidChangeViewCells.event;\n\tprivate readonly _onWillChangeModel = this._register(\n\t\tnew Emitter<NotebookTextModel | undefined>(),\n\t);\n\treadonly onWillChangeModel: Event<NotebookTextModel | undefined> =\n\t\tthis._onWillChangeModel.event;\n\tprivate readonly _onDidChangeModel = this._register(\n\t\tnew Emitter<NotebookTextModel | undefined>(),\n\t);\n\treadonly onDidChangeModel: Event<NotebookTextModel | undefined> =\n\t\tthis._onDidChangeModel.event;\n\tprivate readonly _onDidAttachViewModel = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidAttachViewModel: Event<void> =\n\t\tthis._onDidAttachViewModel.event;\n\tprivate readonly _onDidChangeOptions = this._register(new Emitter<void>());\n\treadonly onDidChangeOptions: Event<void> = this._onDidChangeOptions.event;\n\tprivate readonly _onDidChangeDecorations = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidChangeDecorations: Event<void> =\n\t\tthis._onDidChangeDecorations.event;\n\tprivate readonly _onDidScroll = this._register(new Emitter<void>());\n\treadonly onDidScroll: Event<void> = this._onDidScroll.event;\n\tprivate readonly _onDidChangeLayout = this._register(new Emitter<void>());\n\treadonly onDidChangeLayout: Event<void> = this._onDidChangeLayout.event;\n\tprivate readonly _onDidChangeActiveCell = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidChangeActiveCell: Event<void> =\n\t\tthis._onDidChangeActiveCell.event;\n\tprivate readonly _onDidChangeFocus = this._register(new Emitter<void>());\n\treadonly onDidChangeFocus: Event<void> = this._onDidChangeFocus.event;\n\tprivate readonly _onDidChangeSelection = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidChangeSelection: Event<void> =\n\t\tthis._onDidChangeSelection.event;\n\tprivate readonly _onDidChangeVisibleRanges = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidChangeVisibleRanges: Event<void> =\n\t\tthis._onDidChangeVisibleRanges.event;\n\tprivate readonly _onDidFocusEmitter = this._register(new Emitter<void>());\n\treadonly onDidFocusWidget = this._onDidFocusEmitter.event;\n\tprivate readonly _onDidBlurEmitter = this._register(new Emitter<void>());\n\treadonly onDidBlurWidget = this._onDidBlurEmitter.event;\n\tprivate readonly _onDidChangeActiveEditor = this._register(\n\t\tnew Emitter<this>(),\n\t);\n\treadonly onDidChangeActiveEditor: Event<this> =\n\t\tthis._onDidChangeActiveEditor.event;\n\tprivate readonly _onDidChangeActiveKernel = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\treadonly onDidChangeActiveKernel: Event<void> =\n\t\tthis._onDidChangeActiveKernel.event;\n\tprivate readonly _onMouseUp: Emitter<INotebookEditorMouseEvent> =\n\t\tthis._register(new Emitter<INotebookEditorMouseEvent>());\n\treadonly onMouseUp: Event<INotebookEditorMouseEvent> =\n\t\tthis._onMouseUp.event;\n\tprivate readonly _onMouseDown: Emitter<INotebookEditorMouseEvent> =\n\t\tthis._register(new Emitter<INotebookEditorMouseEvent>());\n\treadonly onMouseDown: Event<INotebookEditorMouseEvent> =\n\t\tthis._onMouseDown.event;\n\tprivate readonly _onDidReceiveMessage = this._register(\n\t\tnew Emitter<INotebookWebviewMessage>(),\n\t);\n\treadonly onDidReceiveMessage: Event<INotebookWebviewMessage> =\n\t\tthis._onDidReceiveMessage.event;\n\tprivate readonly _onDidRenderOutput = this._register(\n\t\tnew Emitter<ICellOutputViewModel>(),\n\t);\n\tprivate readonly onDidRenderOutput = this._onDidRenderOutput.event;\n\tprivate readonly _onDidRemoveOutput = this._register(\n\t\tnew Emitter<ICellOutputViewModel>(),\n\t);\n\tprivate readonly onDidRemoveOutput = this._onDidRemoveOutput.event;\n\tprivate readonly _onDidResizeOutputEmitter = this._register(\n\t\tnew Emitter<ICellViewModel>(),\n\t);\n\treadonly onDidResizeOutput = this._onDidResizeOutputEmitter.event;\n\n\t//#endregion\n\tprivate _overlayContainer!: HTMLElement;\n\tprivate _notebookTopToolbarContainer!: HTMLElement;\n\tprivate _notebookTopToolbar!: NotebookEditorWorkbenchToolbar;\n\tprivate _notebookStickyScrollContainer!: HTMLElement;\n\tprivate _notebookStickyScroll!: NotebookStickyScroll;\n\tprivate _notebookOverviewRulerContainer!: HTMLElement;\n\tprivate _notebookOverviewRuler!: NotebookOverviewRuler;\n\tprivate _body!: HTMLElement;\n\tprivate _styleElement!: HTMLStyleElement;\n\tprivate _overflowContainer!: HTMLElement;\n\tprivate _webview: BackLayerWebView<ICommonCellInfo> | null = null;\n\tprivate _webviewResolvePromise: Promise<BackLayerWebView<ICommonCellInfo> | null> | null =\n\t\tnull;\n\tprivate _webviewTransparentCover: HTMLElement | null = null;\n\tprivate _listDelegate: NotebookCellListDelegate | null = null;\n\tprivate _list!: INotebookCellList;\n\tprivate _listViewInfoAccessor!: ListViewInfoAccessor;\n\tprivate _dndController: CellDragAndDropController | null = null;\n\tprivate _listTopCellToolbar: ListTopCellToolbar | null = null;\n\tprivate _renderedEditors: Map<ICellViewModel, ICodeEditor> = new Map();\n\tprivate _editorPool!: NotebookCellEditorPool;\n\tprivate _viewContext: ViewContext;\n\tprivate _notebookViewModel: NotebookViewModel | undefined;\n\tprivate readonly _localStore: DisposableStore = this._register(\n\t\tnew DisposableStore(),\n\t);\n\tprivate _localCellStateListeners: DisposableStore[] = [];\n\tprivate _fontInfo: FontInfo | undefined;\n\tprivate _dimension?: DOM.Dimension;\n\tprivate _position?: DOM.IDomPosition;\n\tprivate _shadowElement?: HTMLElement;\n\tprivate _shadowElementViewInfo: {\n\t\theight: number;\n\t\twidth: number;\n\t\ttop: number;\n\t\tleft: number;\n\t} | null = null;\n\n\tprivate readonly _editorFocus: IContextKey<boolean>;\n\tprivate readonly _outputFocus: IContextKey<boolean>;\n\tprivate readonly _editorEditable: IContextKey<boolean>;\n\tprivate readonly _cursorNavMode: IContextKey<boolean>;\n\tprivate readonly _outputInputFocus: IContextKey<boolean>;\n\tprotected readonly _contributions = new Map<\n\t\tstring,\n\t\tINotebookEditorContribution\n\t>();\n\tprivate _scrollBeyondLastLine: boolean;\n\tprivate readonly _insetModifyQueueByOutputId = new SequencerByKey<string>();\n\tprivate _cellContextKeyManager: CellContextKeyManager | null = null;\n\tprivate readonly _uuid = generateUuid();\n\tprivate _focusTracker!: DOM.IFocusTracker;\n\tprivate _webviewFocused = false;\n\tprivate _isVisible = false;\n\tget isVisible() {\n\t\treturn this._isVisible;\n\t}\n\n\tprivate _isDisposed = false;\n\n\tget isDisposed() {\n\t\treturn this._isDisposed;\n\t}\n\n\tset viewModel(newModel: NotebookViewModel | undefined) {\n\t\tthis._onWillChangeModel.fire(this._notebookViewModel?.notebookDocument);\n\t\tthis._notebookViewModel = newModel;\n\t\tthis._onDidChangeModel.fire(newModel?.notebookDocument);\n\t}\n\n\tget viewModel() {\n\t\treturn this._notebookViewModel;\n\t}\n\n\tget textModel() {\n\t\treturn this._notebookViewModel?.notebookDocument;\n\t}\n\n\tget isReadOnly() {\n\t\treturn this._notebookViewModel?.options.isReadOnly ?? false;\n\t}\n\n\tget activeCodeEditor(): ICodeEditor | undefined {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [focused] = this._list.getFocusedElements();\n\t\treturn this._renderedEditors.get(focused);\n\t}\n\n\tget activeCellAndCodeEditor(): [ICellViewModel, ICodeEditor] | undefined {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst [focused] = this._list.getFocusedElements();\n\t\tconst editor = this._renderedEditors.get(focused);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\t\treturn [focused, editor];\n\t}\n\n\tget codeEditors(): [ICellViewModel, ICodeEditor][] {\n\t\treturn [...this._renderedEditors];\n\t}\n\n\tget visibleRanges() {\n\t\treturn this._list.visibleRanges || [];\n\t}\n\n\tprivate _baseCellEditorOptions = new Map<string, IBaseCellEditorOptions>();\n\n\treadonly isEmbedded: boolean;\n\tprivate _readOnly: boolean;\n\tprivate readonly _inRepl: boolean;\n\n\tpublic readonly scopedContextKeyService: IContextKeyService;\n\tprivate readonly instantiationService: IInstantiationService;\n\tprivate readonly _notebookOptions: NotebookOptions;\n\n\tprivate _currentProgress: IProgressRunner | undefined;\n\n\tget notebookOptions() {\n\t\treturn this._notebookOptions;\n\t}\n\n\tconstructor(\n\t\treadonly creationOptions: INotebookEditorCreationOptions,\n\t\tdimension: DOM.Dimension | undefined,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IEditorGroupsService editorGroupsService: IEditorGroupsService,\n\t\t@INotebookRendererMessagingService\n\t\tprivate readonly notebookRendererMessaging: INotebookRendererMessagingService,\n\t\t@INotebookEditorService\n\t\tprivate readonly notebookEditorService: INotebookEditorService,\n\t\t@INotebookKernelService\n\t\tprivate readonly notebookKernelService: INotebookKernelService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IConfigurationService\n\t\tprivate readonly configurationService: IConfigurationService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@ILayoutService private readonly layoutService: ILayoutService,\n\t\t@IContextMenuService\n\t\tprivate readonly contextMenuService: IContextMenuService,\n\t\t@ITelemetryService private readonly telemetryService: ITelemetryService,\n\t\t@INotebookExecutionService\n\t\tprivate readonly notebookExecutionService: INotebookExecutionService,\n\t\t@INotebookExecutionStateService\n\t\tprivate readonly notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@IEditorProgressService\n\t\tprivate editorProgressService: IEditorProgressService,\n\t\t@INotebookLoggingService\n\t\tprivate readonly logService: INotebookLoggingService,\n\t\t@IKeybindingService\n\t\tprivate readonly keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tthis._dimension = dimension;\n\n\t\tthis.isEmbedded = creationOptions.isEmbedded ?? false;\n\t\tthis._readOnly = creationOptions.isReadOnly ?? false;\n\t\tthis._inRepl = creationOptions.forRepl ?? false;\n\n\t\tthis._overlayContainer = document.createElement(\"div\");\n\t\tthis.scopedContextKeyService = this._register(\n\t\t\tcontextKeyService.createScoped(this._overlayContainer),\n\t\t);\n\t\tthis.instantiationService = this._register(\n\t\t\tinstantiationService.createChild(\n\t\t\t\tnew ServiceCollection([\n\t\t\t\t\tIContextKeyService,\n\t\t\t\t\tthis.scopedContextKeyService,\n\t\t\t\t]),\n\t\t\t),\n\t\t);\n\n\t\tthis._notebookOptions =\n\t\t\tcreationOptions.options ??\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookOptions,\n\t\t\t\tthis.creationOptions?.codeWindow ?? mainWindow,\n\t\t\t\tthis._readOnly,\n\t\t\t\tundefined,\n\t\t\t);\n\t\tthis._register(this._notebookOptions);\n\t\tconst eventDispatcher = this._register(new NotebookEventDispatcher());\n\t\tthis._viewContext = new ViewContext(\n\t\t\tthis._notebookOptions,\n\t\t\teventDispatcher,\n\t\t\t(language) => this.getBaseCellEditorOptions(language),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._viewContext.eventDispatcher.onDidChangeLayout(() => {\n\t\t\t\tthis._onDidChangeLayout.fire();\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._viewContext.eventDispatcher.onDidChangeCellState((e) => {\n\t\t\t\tthis._onDidChangeCellState.fire(e);\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\t_notebookService.onDidChangeOutputRenderers(() => {\n\t\t\t\tthis._updateOutputRenderers();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookEditorContextKeys,\n\t\t\t\tthis,\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tnotebookKernelService.onDidChangeSelectedNotebooks((e) => {\n\t\t\t\tif (isEqual(e.notebook, this.viewModel?.uri)) {\n\t\t\t\t\tthis._loadKernelPreloads();\n\t\t\t\t\tthis._onDidChangeActiveKernel.fire();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._scrollBeyondLastLine =\n\t\t\tthis.configurationService.getValue<boolean>(\n\t\t\t\t\"editor.scrollBeyondLastLine\",\n\t\t\t);\n\n\t\tthis._register(\n\t\t\tthis.configurationService.onDidChangeConfiguration((e) => {\n\t\t\t\tif (e.affectsConfiguration(\"editor.scrollBeyondLastLine\")) {\n\t\t\t\t\tthis._scrollBeyondLastLine =\n\t\t\t\t\t\tthis.configurationService.getValue<boolean>(\n\t\t\t\t\t\t\t\"editor.scrollBeyondLastLine\",\n\t\t\t\t\t\t);\n\t\t\t\t\tif (this._dimension && this._isVisible) {\n\t\t\t\t\t\tthis.layout(this._dimension);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._notebookOptions.onDidChangeOptions((e) => {\n\t\t\t\tif (\n\t\t\t\t\te.cellStatusBarVisibility ||\n\t\t\t\t\te.cellToolbarLocation ||\n\t\t\t\t\te.cellToolbarInteraction\n\t\t\t\t) {\n\t\t\t\t\tthis._updateForNotebookConfiguration();\n\t\t\t\t}\n\n\t\t\t\tif (e.fontFamily) {\n\t\t\t\t\tthis._generateFontInfo();\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\te.compactView ||\n\t\t\t\t\te.focusIndicator ||\n\t\t\t\t\te.insertToolbarPosition ||\n\t\t\t\t\te.cellToolbarLocation ||\n\t\t\t\t\te.dragAndDropEnabled ||\n\t\t\t\t\te.fontSize ||\n\t\t\t\t\te.markupFontSize ||\n\t\t\t\t\te.markdownLineHeight ||\n\t\t\t\t\te.fontFamily ||\n\t\t\t\t\te.insertToolbarAlignment ||\n\t\t\t\t\te.outputFontSize ||\n\t\t\t\t\te.outputLineHeight ||\n\t\t\t\t\te.outputFontFamily ||\n\t\t\t\t\te.outputWordWrap ||\n\t\t\t\t\te.outputScrolling ||\n\t\t\t\t\te.outputLinkifyFilePaths ||\n\t\t\t\t\te.minimalError\n\t\t\t\t) {\n\t\t\t\t\tthis._styleElement?.remove();\n\t\t\t\t\tthis._createLayoutStyles();\n\t\t\t\t\tthis._webview?.updateOptions({\n\t\t\t\t\t\t...this.notebookOptions.computeWebviewOptions(),\n\t\t\t\t\t\tfontFamily: this._generateFontFamily(),\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\tif (this._dimension && this._isVisible) {\n\t\t\t\t\tthis.layout(this._dimension);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tconst container = creationOptions.codeWindow\n\t\t\t? this.layoutService.getContainer(creationOptions.codeWindow)\n\t\t\t: this.layoutService.mainContainer;\n\t\tthis._register(\n\t\t\teditorGroupsService.getPart(container).onDidScroll((e) => {\n\t\t\t\tif (!this._shadowElement || !this._isVisible) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.updateShadowElement(this._shadowElement, this._dimension);\n\t\t\t\tthis.layoutContainerOverShadowElement(\n\t\t\t\t\tthis._dimension,\n\t\t\t\t\tthis._position,\n\t\t\t\t);\n\t\t\t}),\n\t\t);\n\n\t\tthis.notebookEditorService.addNotebookEditor(this);\n\n\t\tconst id = generateUuid();\n\t\tthis._overlayContainer.id = `notebook-${id}`;\n\t\tthis._overlayContainer.className = \"notebookOverlay\";\n\t\tthis._overlayContainer.classList.add(\"notebook-editor\");\n\t\tthis._overlayContainer.inert = true;\n\t\tthis._overlayContainer.style.visibility = \"hidden\";\n\n\t\tcontainer.appendChild(this._overlayContainer);\n\n\t\tthis._createBody(this._overlayContainer);\n\t\tthis._generateFontInfo();\n\t\tthis._isVisible = true;\n\t\tthis._editorFocus = NOTEBOOK_EDITOR_FOCUSED.bindTo(\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t\tthis._outputFocus = NOTEBOOK_OUTPUT_FOCUSED.bindTo(\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t\tthis._outputInputFocus = NOTEBOOK_OUTPUT_INPUT_FOCUSED.bindTo(\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t\tthis._editorEditable = NOTEBOOK_EDITOR_EDITABLE.bindTo(\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t\tthis._cursorNavMode = NOTEBOOK_CURSOR_NAVIGATION_MODE.bindTo(\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t\t// Never display the native cut/copy context menu items in notebooks\n\t\tnew RawContextKey<boolean>(\n\t\t\tPreventDefaultContextMenuItemsContextKeyName,\n\t\t\tfalse,\n\t\t)\n\t\t\t.bindTo(this.scopedContextKeyService)\n\t\t\t.set(true);\n\n\t\tthis._editorEditable.set(!creationOptions.isReadOnly);\n\n\t\tlet contributions: INotebookEditorContributionDescription[];\n\t\tif (Array.isArray(this.creationOptions.contributions)) {\n\t\t\tcontributions = this.creationOptions.contributions;\n\t\t} else {\n\t\t\tcontributions =\n\t\t\t\tNotebookEditorExtensionsRegistry.getEditorContributions();\n\t\t}\n\t\tfor (const desc of contributions) {\n\t\t\tlet contribution: INotebookEditorContribution | undefined;\n\t\t\ttry {\n\t\t\t\tcontribution = this.instantiationService.createInstance(\n\t\t\t\t\tdesc.ctor,\n\t\t\t\t\tthis,\n\t\t\t\t);\n\t\t\t} catch (err) {\n\t\t\t\tonUnexpectedError(err);\n\t\t\t}\n\t\t\tif (contribution) {\n\t\t\t\tif (this._contributions.has(desc.id)) {\n\t\t\t\t\tcontribution.dispose();\n\t\t\t\t\tthrow new Error(`DUPLICATE notebook editor contribution: '${desc.id}'`);\n\t\t\t\t} else {\n\t\t\t\t\tthis._contributions.set(desc.id, contribution);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._updateForNotebookConfiguration();\n\t}\n\n\tprivate _debugFlag = false;\n\n\tprivate _debug(...args: any[]) {\n\t\tif (!this._debugFlag) {\n\t\t\treturn;\n\t\t}\n\n\t\tnotebookDebug(...args);\n\t}\n\n\t/**\n\t * EditorId\n\t */\n\tpublic getId(): string {\n\t\treturn this._uuid;\n\t}\n\n\tgetViewModel(): NotebookViewModel | undefined {\n\t\treturn this.viewModel;\n\t}\n\n\tgetLength() {\n\t\treturn this.viewModel?.length ?? 0;\n\t}\n\n\tgetSelections() {\n\t\treturn this.viewModel?.getSelections() ?? [];\n\t}\n\n\tsetSelections(selections: ICellRange[]) {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst focus = this.viewModel.getFocus();\n\t\tthis.viewModel.updateSelectionsState({\n\t\t\tkind: SelectionStateType.Index,\n\t\t\tfocus: focus,\n\t\t\tselections: selections,\n\t\t});\n\t}\n\n\tgetFocus() {\n\t\treturn this.viewModel?.getFocus() ?? { start: 0, end: 0 };\n\t}\n\n\tsetFocus(focus: ICellRange) {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst selections = this.viewModel.getSelections();\n\t\tthis.viewModel.updateSelectionsState({\n\t\t\tkind: SelectionStateType.Index,\n\t\t\tfocus: focus,\n\t\t\tselections: selections,\n\t\t});\n\t}\n\n\tgetSelectionViewModels(): ICellViewModel[] {\n\t\tif (!this.viewModel) {\n\t\t\treturn [];\n\t\t}\n\n\t\tconst cellsSet = new Set<number>();\n\n\t\treturn this.viewModel\n\t\t\t.getSelections()\n\t\t\t.map((range) =>\n\t\t\t\tthis.viewModel!.viewCells.slice(range.start, range.end),\n\t\t\t)\n\t\t\t.reduce((a, b) => {\n\t\t\t\tb.forEach((cell) => {\n\t\t\t\t\tif (!cellsSet.has(cell.handle)) {\n\t\t\t\t\t\tcellsSet.add(cell.handle);\n\t\t\t\t\t\ta.push(cell);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\treturn a;\n\t\t\t}, [] as ICellViewModel[]);\n\t}\n\n\thasModel(): this is IActiveNotebookEditorDelegate {\n\t\treturn !!this._notebookViewModel;\n\t}\n\n\tshowProgress(): void {\n\t\tthis._currentProgress = this.editorProgressService.show(true);\n\t}\n\n\thideProgress(): void {\n\t\tif (this._currentProgress) {\n\t\t\tthis._currentProgress.done();\n\t\t\tthis._currentProgress = undefined;\n\t\t}\n\t}\n\n\t//#region Editor Core\n\n\tgetBaseCellEditorOptions(language: string): IBaseCellEditorOptions {\n\t\tconst existingOptions = this._baseCellEditorOptions.get(language);\n\n\t\tif (existingOptions) {\n\t\t\treturn existingOptions;\n\t\t} else {\n\t\t\tconst options = new BaseCellEditorOptions(\n\t\t\t\tthis,\n\t\t\t\tthis.notebookOptions,\n\t\t\t\tthis.configurationService,\n\t\t\t\tlanguage,\n\t\t\t);\n\t\t\tthis._baseCellEditorOptions.set(language, options);\n\t\t\treturn options;\n\t\t}\n\t}\n\n\tprivate _updateForNotebookConfiguration() {\n\t\tif (!this._overlayContainer) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._overlayContainer.classList.remove(\"cell-title-toolbar-left\");\n\t\tthis._overlayContainer.classList.remove(\"cell-title-toolbar-right\");\n\t\tthis._overlayContainer.classList.remove(\"cell-title-toolbar-hidden\");\n\t\tconst cellToolbarLocation =\n\t\t\tthis._notebookOptions.computeCellToolbarLocation(\n\t\t\t\tthis.viewModel?.viewType,\n\t\t\t);\n\t\tthis._overlayContainer.classList.add(\n\t\t\t`cell-title-toolbar-${cellToolbarLocation}`,\n\t\t);\n\n\t\tconst cellToolbarInteraction =\n\t\t\tthis._notebookOptions.getDisplayOptions().cellToolbarInteraction;\n\t\tlet cellToolbarInteractionState = \"hover\";\n\t\tthis._overlayContainer.classList.remove(\"cell-toolbar-hover\");\n\t\tthis._overlayContainer.classList.remove(\"cell-toolbar-click\");\n\n\t\tif (\n\t\t\tcellToolbarInteraction === \"hover\" ||\n\t\t\tcellToolbarInteraction === \"click\"\n\t\t) {\n\t\t\tcellToolbarInteractionState = cellToolbarInteraction;\n\t\t}\n\t\tthis._overlayContainer.classList.add(\n\t\t\t`cell-toolbar-${cellToolbarInteractionState}`,\n\t\t);\n\t}\n\n\tprivate _generateFontInfo(): void {\n\t\tconst editorOptions =\n\t\t\tthis.configurationService.getValue<IEditorOptions>(\"editor\");\n\t\tconst targetWindow = DOM.getWindow(this.getDomNode());\n\t\tthis._fontInfo = FontMeasurements.readFontInfo(\n\t\t\ttargetWindow,\n\t\t\tBareFontInfo.createFromRawSettings(\n\t\t\t\teditorOptions,\n\t\t\t\tPixelRatio.getInstance(targetWindow).value,\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _createBody(parent: HTMLElement): void {\n\t\tthis._notebookTopToolbarContainer = document.createElement(\"div\");\n\t\tthis._notebookTopToolbarContainer.classList.add(\n\t\t\t\"notebook-toolbar-container\",\n\t\t);\n\t\tthis._notebookTopToolbarContainer.style.display = \"none\";\n\t\tDOM.append(parent, this._notebookTopToolbarContainer);\n\n\t\tthis._notebookStickyScrollContainer = document.createElement(\"div\");\n\t\tthis._notebookStickyScrollContainer.classList.add(\n\t\t\t\"notebook-sticky-scroll-container\",\n\t\t);\n\t\tDOM.append(parent, this._notebookStickyScrollContainer);\n\n\t\tthis._body = document.createElement(\"div\");\n\t\tDOM.append(parent, this._body);\n\n\t\tthis._body.classList.add(\"cell-list-container\");\n\t\tthis._createLayoutStyles();\n\t\tthis._createCellList();\n\n\t\tthis._notebookOverviewRulerContainer = document.createElement(\"div\");\n\t\tthis._notebookOverviewRulerContainer.classList.add(\n\t\t\t\"notebook-overview-ruler-container\",\n\t\t);\n\t\tthis._list.scrollableElement.appendChild(\n\t\t\tthis._notebookOverviewRulerContainer,\n\t\t);\n\t\tthis._registerNotebookOverviewRuler();\n\n\t\tthis._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookHorizontalTracker,\n\t\t\t\tthis,\n\t\t\t\tthis._list.scrollableElement,\n\t\t\t),\n\t\t);\n\n\t\tthis._overflowContainer = document.createElement(\"div\");\n\t\tthis._overflowContainer.classList.add(\n\t\t\t\"notebook-overflow-widget-container\",\n\t\t\t\"monaco-editor\",\n\t\t);\n\t\tDOM.append(parent, this._overflowContainer);\n\t}\n\n\tprivate _generateFontFamily() {\n\t\treturn (\n\t\t\tthis._fontInfo?.fontFamily ??\n\t\t\t`\"SF Mono\", Monaco, Menlo, Consolas, \"Ubuntu Mono\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Courier New\", monospace`\n\t\t);\n\t}\n\n\tprivate _createLayoutStyles(): void {\n\t\tthis._styleElement = DOM.createStyleSheet(this._body);\n\t\tconst {\n\t\t\tcellRightMargin,\n\t\t\tcellTopMargin,\n\t\t\tcellRunGutter,\n\t\t\tcellBottomMargin,\n\t\t\tcodeCellLeftMargin,\n\t\t\tmarkdownCellGutter,\n\t\t\tmarkdownCellLeftMargin,\n\t\t\tmarkdownCellBottomMargin,\n\t\t\tmarkdownCellTopMargin,\n\t\t\tcollapsedIndicatorHeight,\n\t\t\tfocusIndicator,\n\t\t\tinsertToolbarPosition,\n\t\t\toutputFontSize,\n\t\t\tfocusIndicatorLeftMargin,\n\t\t\tfocusIndicatorGap,\n\t\t} = this._notebookOptions.getLayoutConfiguration();\n\n\t\tconst { insertToolbarAlignment, compactView, fontSize } =\n\t\t\tthis._notebookOptions.getDisplayOptions();\n\n\t\tconst getCellEditorContainerLeftMargin =\n\t\t\tthis._notebookOptions.getCellEditorContainerLeftMargin();\n\n\t\tconst { bottomToolbarGap, bottomToolbarHeight } =\n\t\t\tthis._notebookOptions.computeBottomToolbarDimensions(\n\t\t\t\tthis.viewModel?.viewType,\n\t\t\t);\n\n\t\tconst styleSheets: string[] = [];\n\t\tif (!this._fontInfo) {\n\t\t\tthis._generateFontInfo();\n\t\t}\n\n\t\tconst fontFamily = this._generateFontFamily();\n\n\t\tstyleSheets.push(`\n\t\t.notebook-editor {\n\t\t\t--notebook-cell-output-font-size: ${outputFontSize}px;\n\t\t\t--notebook-cell-input-preview-font-size: ${fontSize}px;\n\t\t\t--notebook-cell-input-preview-font-family: ${fontFamily};\n\t\t}\n\t\t`);\n\n\t\tif (compactView) {\n\t\t\tstyleSheets.push(\n\t\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .markdown-cell-row div.cell.code { margin-left: ${getCellEditorContainerLeftMargin}px; }`,\n\t\t\t);\n\t\t} else {\n\t\t\tstyleSheets.push(\n\t\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .markdown-cell-row div.cell.code { margin-left: ${codeCellLeftMargin}px; }`,\n\t\t\t);\n\t\t}\n\n\t\t// focus indicator\n\t\tif (focusIndicator === \"border\") {\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-top:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-bottom:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .markdown-cell-row .cell-inner-container:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .markdown-cell-row .cell-inner-container:after {\n\t\t\t\tcontent: \"\";\n\t\t\t\tposition: absolute;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 1px;\n\t\t\t}\n\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-left:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-right:before {\n\t\t\t\tcontent: \"\";\n\t\t\t\tposition: absolute;\n\t\t\t\twidth: 1px;\n\t\t\t\theight: 100%;\n\t\t\t\tz-index: 10;\n\t\t\t}\n\n\t\t\t/* top border */\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-top:before {\n\t\t\t\tborder-top: 1px solid transparent;\n\t\t\t}\n\n\t\t\t/* left border */\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-left:before {\n\t\t\t\tborder-left: 1px solid transparent;\n\t\t\t}\n\n\t\t\t/* bottom border */\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-bottom:before {\n\t\t\t\tborder-bottom: 1px solid transparent;\n\t\t\t}\n\n\t\t\t/* right border */\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-right:before {\n\t\t\t\tborder-right: 1px solid transparent;\n\t\t\t}\n\t\t\t`);\n\n\t\t\t// left and right border margins\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.code-cell-row.focused .cell-focus-indicator-left:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.code-cell-row.focused .cell-focus-indicator-right:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list.selection-multiple .monaco-list-row.code-cell-row.selected .cell-focus-indicator-left:before,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list.selection-multiple .monaco-list-row.code-cell-row.selected .cell-focus-indicator-right:before {\n\t\t\t\ttop: -${cellTopMargin}px; height: calc(100% + ${cellTopMargin + cellBottomMargin}px)\n\t\t\t}`);\n\t\t} else {\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-left .codeOutput-focus-indicator {\n\t\t\t\tborder-left: 3px solid transparent;\n\t\t\t\tborder-radius: 4px;\n\t\t\t\twidth: 0px;\n\t\t\t\tmargin-left: ${focusIndicatorLeftMargin}px;\n\t\t\t\tborder-color: var(--vscode-notebook-inactiveFocusedCellBorder) !important;\n\t\t\t}\n\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.focused .cell-focus-indicator-left .codeOutput-focus-indicator-container,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-output-hover .cell-focus-indicator-left .codeOutput-focus-indicator-container,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .markdown-cell-hover .cell-focus-indicator-left .codeOutput-focus-indicator-container,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row:hover .cell-focus-indicator-left .codeOutput-focus-indicator-container {\n\t\t\t\tdisplay: block;\n\t\t\t}\n\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-left .codeOutput-focus-indicator-container:hover .codeOutput-focus-indicator {\n\t\t\t\tborder-left: 5px solid transparent;\n\t\t\t\tmargin-left: ${focusIndicatorLeftMargin - 1}px;\n\t\t\t}\n\t\t\t`);\n\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row.focused .cell-inner-container.cell-output-focus .cell-focus-indicator-left .codeOutput-focus-indicator,\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list:focus-within .monaco-list-row.focused .cell-inner-container .cell-focus-indicator-left .codeOutput-focus-indicator {\n\t\t\t\tborder-color: var(--vscode-notebook-focusedCellBorder) !important;\n\t\t\t}\n\n\t\t\t.monaco-workbench .notebookOverlay .monaco-list .monaco-list-row .cell-inner-container .cell-focus-indicator-left .output-focus-indicator {\n\t\t\t\tmargin-top: ${focusIndicatorGap}px;\n\t\t\t}\n\t\t\t`);\n\t\t}\n\n\t\t// between cell insert toolbar\n\t\tif (\n\t\t\tinsertToolbarPosition === \"betweenCells\" ||\n\t\t\tinsertToolbarPosition === \"both\"\n\t\t) {\n\t\t\tstyleSheets.push(\n\t\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container { display: flex; }`,\n\t\t\t);\n\t\t\tstyleSheets.push(\n\t\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .view-zones .cell-list-top-cell-toolbar-container { display: flex; }`,\n\t\t\t);\n\t\t} else {\n\t\t\tstyleSheets.push(\n\t\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container { display: none; }`,\n\t\t\t);\n\t\t\tstyleSheets.push(\n\t\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .view-zones .cell-list-top-cell-toolbar-container { display: none; }`,\n\t\t\t);\n\t\t}\n\n\t\tif (insertToolbarAlignment === \"left\") {\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container .action-item:first-child,\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container .action-item:first-child, .monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container .action-item:first-child {\n\t\t\t\tmargin-right: 0px !important;\n\t\t\t}`);\n\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container .monaco-toolbar .action-label,\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container .monaco-toolbar .action-label, .monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container .monaco-toolbar .action-label {\n\t\t\t\tpadding: 0px !important;\n\t\t\t\tjustify-content: center;\n\t\t\t\tborder-radius: 4px;\n\t\t\t}`);\n\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container,\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container, .monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container {\n\t\t\t\talign-items: flex-start;\n\t\t\t\tjustify-content: left;\n\t\t\t\tmargin: 0 16px 0 ${8 + codeCellLeftMargin}px;\n\t\t\t}`);\n\n\t\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay .cell-list-top-cell-toolbar-container,\n\t\t\t.notebookOverlay .cell-bottom-toolbar-container .action-item {\n\t\t\t\tborder: 0px;\n\t\t\t}`);\n\t\t}\n\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .code-cell-row div.cell.code { margin-left: ${getCellEditorContainerLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row div.cell { margin-right: ${cellRightMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row > .cell-inner-container { padding-top: ${cellTopMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .markdown-cell-row > .cell-inner-container { padding-bottom: ${markdownCellBottomMargin}px; padding-top: ${markdownCellTopMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .markdown-cell-row > .cell-inner-container.webview-backed-markdown-cell { padding: 0; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .markdown-cell-row > .webview-backed-markdown-cell.markdown-cell-edit-mode .cell.code { padding-bottom: ${markdownCellBottomMargin}px; padding-top: ${markdownCellTopMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .output { margin: 0px ${cellRightMargin}px 0px ${getCellEditorContainerLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .output { width: calc(100% - ${getCellEditorContainerLeftMargin + cellRightMargin}px); }`,\n\t\t);\n\n\t\t// comment\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-comment-container { left: ${getCellEditorContainerLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-comment-container { width: calc(100% - ${getCellEditorContainerLeftMargin + cellRightMargin}px); }`,\n\t\t);\n\n\t\t// output collapse button\n\t\tstyleSheets.push(\n\t\t\t`.monaco-workbench .notebookOverlay .output .output-collapse-container .expandButton { left: -${cellRunGutter}px; }`,\n\t\t);\n\t\tstyleSheets.push(`.monaco-workbench .notebookOverlay .output .output-collapse-container .expandButton {\n\t\t\tposition: absolute;\n\t\t\twidth: ${cellRunGutter}px;\n\t\t\tpadding: 6px 0px;\n\t\t}`);\n\n\t\t// show more container\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .output-show-more-container { margin: 0px ${cellRightMargin}px 0px ${getCellEditorContainerLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .output-show-more-container { width: calc(100% - ${getCellEditorContainerLeftMargin + cellRightMargin}px); }`,\n\t\t);\n\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row div.cell.markdown { padding-left: ${cellRunGutter}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container .notebook-folding-indicator { left: ${(markdownCellGutter - 20) / 2 + markdownCellLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay > .cell-list-container .notebook-folded-hint { left: ${markdownCellGutter + markdownCellLeftMargin + 8}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row :not(.webview-backed-markdown-cell) .cell-focus-indicator-top { height: ${cellTopMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-side { bottom: ${bottomToolbarGap}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row.code-cell-row .cell-focus-indicator-left { width: ${getCellEditorContainerLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row.markdown-cell-row .cell-focus-indicator-left { width: ${codeCellLeftMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator.cell-focus-indicator-right { width: ${cellRightMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row .cell-focus-indicator-bottom { height: ${cellBottomMargin}px; }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.notebookOverlay .monaco-list .monaco-list-row .cell-shadow-container-bottom { top: ${cellBottomMargin}px; }`,\n\t\t);\n\n\t\tstyleSheets.push(`\n\t\t\t.notebookOverlay .monaco-list .monaco-list-row:has(+ .monaco-list-row.selected) .cell-focus-indicator-bottom {\n\t\t\t\theight: ${bottomToolbarGap + cellBottomMargin}px;\n\t\t\t}\n\t\t`);\n\n\t\tstyleSheets.push(`\n\t\t\t.notebookOverlay .monaco-list .monaco-list-row.code-cell-row.nb-multiCellHighlight:has(+ .monaco-list-row.nb-multiCellHighlight) .cell-focus-indicator-bottom {\n\t\t\t\theight: ${bottomToolbarGap + cellBottomMargin}px;\n\t\t\t\tbackground-color: var(--vscode-notebook-symbolHighlightBackground) !important;\n\t\t\t}\n\n\t\t\t.notebookOverlay .monaco-list .monaco-list-row.markdown-cell-row.nb-multiCellHighlight:has(+ .monaco-list-row.nb-multiCellHighlight) .cell-focus-indicator-bottom {\n\t\t\t\theight: ${bottomToolbarGap + cellBottomMargin - 6}px;\n\t\t\t\tbackground-color: var(--vscode-notebook-symbolHighlightBackground) !important;\n\t\t\t}\n\t\t`);\n\n\t\tstyleSheets.push(`\n\t\t\t.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .input-collapse-container .cell-collapse-preview {\n\t\t\t\tline-height: ${collapsedIndicatorHeight}px;\n\t\t\t}\n\n\t\t\t.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .input-collapse-container .cell-collapse-preview .monaco-tokenized-source {\n\t\t\t\tmax-height: ${collapsedIndicatorHeight}px;\n\t\t\t}\n\t\t`);\n\n\t\tstyleSheets.push(\n\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-bottom-toolbar-container .monaco-toolbar { height: ${bottomToolbarHeight}px }`,\n\t\t);\n\t\tstyleSheets.push(\n\t\t\t`.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .view-zones .cell-list-top-cell-toolbar-container .monaco-toolbar { height: ${bottomToolbarHeight}px }`,\n\t\t);\n\n\t\t// cell toolbar\n\t\tstyleSheets.push(`.monaco-workbench .notebookOverlay.cell-title-toolbar-right > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-title-toolbar {\n\t\t\tright: ${cellRightMargin + 26}px;\n\t\t}\n\t\t.monaco-workbench .notebookOverlay.cell-title-toolbar-left > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-title-toolbar {\n\t\t\tleft: ${getCellEditorContainerLeftMargin + 16}px;\n\t\t}\n\t\t.monaco-workbench .notebookOverlay.cell-title-toolbar-hidden > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .cell-title-toolbar {\n\t\t\tdisplay: none;\n\t\t}`);\n\n\t\t// cell output innert container\n\t\tstyleSheets.push(`\n\t\t.monaco-workbench .notebookOverlay .output > div.foreground.output-inner-container {\n\t\t\tpadding: ${OutputInnerContainerTopPadding}px 8px;\n\t\t}\n\t\t.monaco-workbench .notebookOverlay > .cell-list-container > .monaco-list > .monaco-scrollable-element > .monaco-list-rows > .monaco-list-row .output-collapse-container {\n\t\t\tpadding: ${OutputInnerContainerTopPadding}px 8px;\n\t\t}\n\t\t`);\n\n\t\t// chat\n\t\tstyleSheets.push(`\n\t\t.monaco-workbench .notebookOverlay .cell-chat-part {\n\t\t\tmargin: 0 ${cellRightMargin}px 6px 4px;\n\t\t}\n\t\t`);\n\n\t\tthis._styleElement.textContent = styleSheets.join(\"\\n\");\n\t}\n\n\tprivate _createCellList(): void {\n\t\tthis._body.classList.add(\"cell-list-container\");\n\t\tthis._dndController = this._register(\n\t\t\tnew CellDragAndDropController(this, this._body),\n\t\t);\n\t\tconst getScopedContextKeyService = (container: HTMLElement) =>\n\t\t\tthis._list.contextKeyService.createScoped(container);\n\t\tthis._editorPool = this._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookCellEditorPool,\n\t\t\t\tthis,\n\t\t\t\tgetScopedContextKeyService,\n\t\t\t),\n\t\t);\n\t\tconst renderers = [\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tCodeCellRenderer,\n\t\t\t\tthis,\n\t\t\t\tthis._renderedEditors,\n\t\t\t\tthis._editorPool,\n\t\t\t\tthis._dndController,\n\t\t\t\tgetScopedContextKeyService,\n\t\t\t),\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tMarkupCellRenderer,\n\t\t\t\tthis,\n\t\t\t\tthis._dndController,\n\t\t\t\tthis._renderedEditors,\n\t\t\t\tgetScopedContextKeyService,\n\t\t\t),\n\t\t];\n\n\t\trenderers.forEach((renderer) => {\n\t\t\tthis._register(renderer);\n\t\t});\n\n\t\tthis._listDelegate = this.instantiationService.createInstance(\n\t\t\tNotebookCellListDelegate,\n\t\t\tDOM.getWindow(this.getDomNode()),\n\t\t);\n\t\tthis._register(this._listDelegate);\n\n\t\tconst accessibilityProvider = new NotebookAccessibilityProvider(\n\t\t\tthis.notebookExecutionStateService,\n\t\t\t() => this.viewModel,\n\t\t\tthis.keybindingService,\n\t\t\tthis.configurationService,\n\t\t);\n\t\tthis._register(accessibilityProvider);\n\n\t\tthis._list = this.instantiationService.createInstance(\n\t\t\tNotebookCellList,\n\t\t\t\"NotebookCellList\",\n\t\t\tthis._body,\n\t\t\tthis._viewContext.notebookOptions,\n\t\t\tthis._listDelegate,\n\t\t\trenderers,\n\t\t\tthis.scopedContextKeyService,\n\t\t\t{\n\t\t\t\tsetRowLineHeight: false,\n\t\t\t\tsetRowHeight: false,\n\t\t\t\tsupportDynamicHeights: true,\n\t\t\t\thorizontalScrolling: false,\n\t\t\t\tkeyboardSupport: false,\n\t\t\t\tmouseSupport: true,\n\t\t\t\tmultipleSelectionSupport: true,\n\t\t\t\tselectionNavigation: true,\n\t\t\t\ttypeNavigationEnabled: true,\n\t\t\t\tpaddingTop: 0,\n\t\t\t\tpaddingBottom: 0,\n\t\t\t\ttransformOptimization: false, //(isMacintosh && isNative) || getTitleBarStyle(this.configurationService, this.environmentService) === 'native',\n\t\t\t\tinitialSize: this._dimension,\n\t\t\t\tstyleController: (_suffix: string) => {\n\t\t\t\t\treturn this._list;\n\t\t\t\t},\n\t\t\t\toverrideStyles: {\n\t\t\t\t\tlistBackground: notebookEditorBackground,\n\t\t\t\t\tlistActiveSelectionBackground: notebookEditorBackground,\n\t\t\t\t\tlistActiveSelectionForeground: foreground,\n\t\t\t\t\tlistFocusAndSelectionBackground: notebookEditorBackground,\n\t\t\t\t\tlistFocusAndSelectionForeground: foreground,\n\t\t\t\t\tlistFocusBackground: notebookEditorBackground,\n\t\t\t\t\tlistFocusForeground: foreground,\n\t\t\t\t\tlistHoverForeground: foreground,\n\t\t\t\t\tlistHoverBackground: notebookEditorBackground,\n\t\t\t\t\tlistHoverOutline: focusBorder,\n\t\t\t\t\tlistFocusOutline: focusBorder,\n\t\t\t\t\tlistInactiveSelectionBackground: notebookEditorBackground,\n\t\t\t\t\tlistInactiveSelectionForeground: foreground,\n\t\t\t\t\tlistInactiveFocusBackground: notebookEditorBackground,\n\t\t\t\t\tlistInactiveFocusOutline: notebookEditorBackground,\n\t\t\t\t},\n\t\t\t\taccessibilityProvider,\n\t\t\t},\n\t\t);\n\t\tthis._dndController.setList(this._list);\n\n\t\t// create Webview\n\n\t\tthis._register(this._list);\n\t\tthis._listViewInfoAccessor = new ListViewInfoAccessor(this._list);\n\t\tthis._register(this._listViewInfoAccessor);\n\n\t\tthis._register(combinedDisposable(...renderers));\n\n\t\t// top cell toolbar\n\t\tthis._listTopCellToolbar = this._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tListTopCellToolbar,\n\t\t\t\tthis,\n\t\t\t\tthis.notebookOptions,\n\t\t\t),\n\t\t);\n\n\t\t// transparent cover\n\t\tthis._webviewTransparentCover = DOM.append(\n\t\t\tthis._list.rowsContainer,\n\t\t\t$(\".webview-cover\"),\n\t\t);\n\t\tthis._webviewTransparentCover.style.display = \"none\";\n\n\t\tthis._register(\n\t\t\tDOM.addStandardDisposableGenericMouseDownListener(\n\t\t\t\tthis._overlayContainer,\n\t\t\t\t(e: StandardMouseEvent) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\te.target.classList.contains(\"slider\") &&\n\t\t\t\t\t\tthis._webviewTransparentCover\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis._webviewTransparentCover.style.display = \"block\";\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tDOM.addStandardDisposableGenericMouseUpListener(\n\t\t\t\tthis._overlayContainer,\n\t\t\t\t() => {\n\t\t\t\t\tif (this._webviewTransparentCover) {\n\t\t\t\t\t\t// no matter when\n\t\t\t\t\t\tthis._webviewTransparentCover.style.display = \"none\";\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onMouseDown((e) => {\n\t\t\t\tif (e.element) {\n\t\t\t\t\tthis._onMouseDown.fire({\n\t\t\t\t\t\tevent: e.browserEvent,\n\t\t\t\t\t\ttarget: e.element,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onMouseUp((e) => {\n\t\t\t\tif (e.element) {\n\t\t\t\t\tthis._onMouseUp.fire({\n\t\t\t\t\t\tevent: e.browserEvent,\n\t\t\t\t\t\ttarget: e.element,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onDidChangeFocus((_e) => {\n\t\t\t\tthis._onDidChangeActiveEditor.fire(this);\n\t\t\t\tthis._onDidChangeActiveCell.fire();\n\t\t\t\tthis._onDidChangeFocus.fire();\n\t\t\t\tthis._cursorNavMode.set(false);\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onContextMenu((e) => {\n\t\t\t\tthis.showListContextMenu(e);\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onDidChangeVisibleRanges(() => {\n\t\t\t\tthis._onDidChangeVisibleRanges.fire();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis._list.onDidScroll((e) => {\n\t\t\t\tif (e.scrollTop !== e.oldScrollTop) {\n\t\t\t\t\tthis._onDidScroll.fire();\n\t\t\t\t\tthis.clearActiveCellWidgets();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._focusTracker = this._register(DOM.trackFocus(this.getDomNode()));\n\t\tthis._register(\n\t\t\tthis._focusTracker.onDidBlur(() => {\n\t\t\t\tthis._editorFocus.set(false);\n\t\t\t\tthis.viewModel?.setEditorFocus(false);\n\t\t\t\tthis._onDidBlurEmitter.fire();\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._focusTracker.onDidFocus(() => {\n\t\t\t\tthis._editorFocus.set(true);\n\t\t\t\tthis.viewModel?.setEditorFocus(true);\n\t\t\t\tthis._onDidFocusEmitter.fire();\n\t\t\t}),\n\t\t);\n\n\t\tthis._registerNotebookActionsToolbar();\n\t\tthis._registerNotebookStickyScroll();\n\n\t\tthis._register(\n\t\t\tthis.configurationService.onDidChangeConfiguration((e) => {\n\t\t\t\tif (\n\t\t\t\t\te.affectsConfiguration(\n\t\t\t\t\t\tAccessibilityVerbositySettingId.Notebook,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tthis._list.ariaLabel =\n\t\t\t\t\t\taccessibilityProvider?.getWidgetAriaLabel();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate showListContextMenu(e: IListContextMenuEvent<CellViewModel>) {\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tmenuId: MenuId.NotebookCellTitle,\n\t\t\tcontextKeyService: this.scopedContextKeyService,\n\t\t\tgetAnchor: () => e.anchor,\n\t\t});\n\t}\n\n\tprivate _registerNotebookOverviewRuler() {\n\t\tthis._notebookOverviewRuler = this._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookOverviewRuler,\n\t\t\t\tthis,\n\t\t\t\tthis._notebookOverviewRulerContainer,\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _registerNotebookActionsToolbar() {\n\t\tthis._notebookTopToolbar = this._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookEditorWorkbenchToolbar,\n\t\t\t\tthis,\n\t\t\t\tthis.scopedContextKeyService,\n\t\t\t\tthis._notebookOptions,\n\t\t\t\tthis._notebookTopToolbarContainer,\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._notebookTopToolbar.onDidChangeVisibility(() => {\n\t\t\t\tif (this._dimension && this._isVisible) {\n\t\t\t\t\tthis.layout(this._dimension);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate _registerNotebookStickyScroll() {\n\t\tthis._notebookStickyScroll = this._register(\n\t\t\tthis.instantiationService.createInstance(\n\t\t\t\tNotebookStickyScroll,\n\t\t\t\tthis._notebookStickyScrollContainer,\n\t\t\t\tthis,\n\t\t\t\tthis._list,\n\t\t\t\t(sizeDelta) => {\n\t\t\t\t\tif (this.isDisposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._dimension && this._isVisible) {\n\t\t\t\t\t\tif (sizeDelta > 0) {\n\t\t\t\t\t\t\t// delta > 0 ==> sticky is growing, cell list shrinking\n\t\t\t\t\t\t\tthis.layout(this._dimension);\n\t\t\t\t\t\t\tthis.setScrollTop(this.scrollTop + sizeDelta);\n\t\t\t\t\t\t} else if (sizeDelta < 0) {\n\t\t\t\t\t\t\t// delta < 0 ==> sticky is shrinking, cell list growing\n\t\t\t\t\t\t\tthis.setScrollTop(this.scrollTop + sizeDelta);\n\t\t\t\t\t\t\tthis.layout(this._dimension);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tthis._onDidScroll.fire();\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _updateOutputRenderers() {\n\t\tif (!this.viewModel || !this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._webview.updateOutputRenderers();\n\t\tthis.viewModel.viewCells.forEach((cell) => {\n\t\t\tcell.outputsViewModels.forEach((output) => {\n\t\t\t\tif (\n\t\t\t\t\toutput.pickedMimeType?.rendererId === RENDERER_NOT_AVAILABLE\n\t\t\t\t) {\n\t\t\t\t\toutput.resetRenderer();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tgetDomNode() {\n\t\treturn this._overlayContainer;\n\t}\n\n\tgetOverflowContainerDomNode() {\n\t\treturn this._overflowContainer;\n\t}\n\n\tgetInnerWebview(): IWebviewElement | undefined {\n\t\treturn this._webview?.webview;\n\t}\n\n\tsetEditorProgressService(\n\t\teditorProgressService: IEditorProgressService,\n\t): void {\n\t\tthis.editorProgressService = editorProgressService;\n\t}\n\n\tsetParentContextKeyService(\n\t\tparentContextKeyService: IContextKeyService,\n\t): void {\n\t\tthis.scopedContextKeyService.updateParent(parentContextKeyService);\n\t}\n\n\tasync setModel(\n\t\ttextModel: NotebookTextModel,\n\t\tviewState: INotebookEditorViewState | undefined,\n\t\tperf?: NotebookPerfMarks,\n\t): Promise<void> {\n\t\tif (this.viewModel === undefined || !this.viewModel.equal(textModel)) {\n\t\t\tconst oldBottomToolbarDimensions =\n\t\t\t\tthis._notebookOptions.computeBottomToolbarDimensions(\n\t\t\t\t\tthis.viewModel?.viewType,\n\t\t\t\t);\n\t\t\tthis._detachModel();\n\t\t\tawait this._attachModel(textModel, viewState, perf);\n\t\t\tconst newBottomToolbarDimensions =\n\t\t\t\tthis._notebookOptions.computeBottomToolbarDimensions(\n\t\t\t\t\tthis.viewModel?.viewType,\n\t\t\t\t);\n\n\t\t\tif (\n\t\t\t\toldBottomToolbarDimensions.bottomToolbarGap !==\n\t\t\t\t\tnewBottomToolbarDimensions.bottomToolbarGap ||\n\t\t\t\toldBottomToolbarDimensions.bottomToolbarHeight !==\n\t\t\t\t\tnewBottomToolbarDimensions.bottomToolbarHeight\n\t\t\t) {\n\t\t\t\tthis._styleElement?.remove();\n\t\t\t\tthis._createLayoutStyles();\n\t\t\t\tthis._webview?.updateOptions({\n\t\t\t\t\t...this.notebookOptions.computeWebviewOptions(),\n\t\t\t\t\tfontFamily: this._generateFontFamily(),\n\t\t\t\t});\n\t\t\t}\n\t\t\ttype WorkbenchNotebookOpenClassification = {\n\t\t\t\towner: \"rebornix\";\n\t\t\t\tcomment: \"Identify the notebook editor view type\";\n\t\t\t\tscheme: {\n\t\t\t\t\tclassification: \"SystemMetaData\";\n\t\t\t\t\tpurpose: \"FeatureInsight\";\n\t\t\t\t\tcomment: \"File system provider scheme for the resource\";\n\t\t\t\t};\n\t\t\t\text: {\n\t\t\t\t\tclassification: \"SystemMetaData\";\n\t\t\t\t\tpurpose: \"FeatureInsight\";\n\t\t\t\t\tcomment: \"File extension for the resource\";\n\t\t\t\t};\n\t\t\t\tviewType: {\n\t\t\t\t\tclassification: \"SystemMetaData\";\n\t\t\t\t\tpurpose: \"FeatureInsight\";\n\t\t\t\t\tcomment: \"View type of the notebook editor\";\n\t\t\t\t};\n\t\t\t};\n\n\t\t\ttype WorkbenchNotebookOpenEvent = {\n\t\t\t\tscheme: string;\n\t\t\t\text: string;\n\t\t\t\tviewType: string;\n\t\t\t};\n\n\t\t\tthis.telemetryService.publicLog2<\n\t\t\t\tWorkbenchNotebookOpenEvent,\n\t\t\t\tWorkbenchNotebookOpenClassification\n\t\t\t>(\"notebook/editorOpened\", {\n\t\t\t\tscheme: textModel.uri.scheme,\n\t\t\t\text: extname(textModel.uri),\n\t\t\t\tviewType: textModel.viewType,\n\t\t\t});\n\t\t} else {\n\t\t\tthis.restoreListViewState(viewState);\n\t\t}\n\n\t\tthis._restoreSelectedKernel(viewState);\n\n\t\t// load preloads for matching kernel\n\t\tthis._loadKernelPreloads();\n\n\t\t// clear state\n\t\tthis._dndController?.clearGlobalDragState();\n\n\t\tthis._localStore.add(\n\t\t\tthis._list.onDidChangeFocus(() => {\n\t\t\t\tthis.updateContextKeysOnFocusChange();\n\t\t\t}),\n\t\t);\n\n\t\tthis.updateContextKeysOnFocusChange();\n\t\t// render markdown top down on idle\n\t\tthis._backgroundMarkdownRendering();\n\t}\n\n\tprivate _backgroundMarkdownRenderRunning = false;\n\tprivate _backgroundMarkdownRendering() {\n\t\tif (this._backgroundMarkdownRenderRunning) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._backgroundMarkdownRenderRunning = true;\n\t\tDOM.runWhenWindowIdle(DOM.getWindow(this.getDomNode()), (deadline) => {\n\t\t\tthis._backgroundMarkdownRenderingWithDeadline(deadline);\n\t\t});\n\t}\n\n\tprivate _backgroundMarkdownRenderingWithDeadline(deadline: IdleDeadline) {\n\t\tconst endTime = Date.now() + deadline.timeRemaining();\n\n\t\tconst execute = () => {\n\t\t\ttry {\n\t\t\t\tthis._backgroundMarkdownRenderRunning = true;\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this.viewModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst firstMarkupCell = this.viewModel.viewCells.find(\n\t\t\t\t\t(cell) =>\n\t\t\t\t\t\tcell.cellKind === CellKind.Markup &&\n\t\t\t\t\t\t!this._webview?.markupPreviewMapping.has(cell.id) &&\n\t\t\t\t\t\t!this.cellIsHidden(cell),\n\t\t\t\t) as MarkupCellViewModel | undefined;\n\t\t\t\tif (!firstMarkupCell) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.createMarkupPreview(firstMarkupCell);\n\t\t\t} finally {\n\t\t\t\tthis._backgroundMarkdownRenderRunning = false;\n\t\t\t}\n\n\t\t\tif (Date.now() < endTime) {\n\t\t\t\tsetTimeout0(execute);\n\t\t\t} else {\n\t\t\t\tthis._backgroundMarkdownRendering();\n\t\t\t}\n\t\t};\n\n\t\texecute();\n\t}\n\n\tprivate updateContextKeysOnFocusChange() {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst focused = this._list.getFocusedElements()[0];\n\t\tif (focused) {\n\t\t\tif (!this._cellContextKeyManager) {\n\t\t\t\tthis._cellContextKeyManager = this._localStore.add(\n\t\t\t\t\tthis.instantiationService.createInstance(\n\t\t\t\t\t\tCellContextKeyManager,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tfocused as CellViewModel,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis._cellContextKeyManager.updateForElement(\n\t\t\t\tfocused as CellViewModel,\n\t\t\t);\n\t\t}\n\t}\n\n\tasync setOptions(options: INotebookEditorOptions | undefined) {\n\t\tif (options?.isReadOnly !== undefined) {\n\t\t\tthis._readOnly = options?.isReadOnly;\n\t\t}\n\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.viewModel.updateOptions({ isReadOnly: this._readOnly });\n\t\tthis.notebookOptions.updateOptions(this._readOnly);\n\n\t\t// reveal cell if editor options tell to do so\n\t\tconst cellOptions =\n\t\t\toptions?.cellOptions ?? this._parseIndexedCellOptions(options);\n\t\tif (cellOptions) {\n\t\t\tconst cell = this.viewModel.viewCells.find(\n\t\t\t\t(cell) =>\n\t\t\t\t\tcell.uri.toString() === cellOptions.resource.toString(),\n\t\t\t);\n\t\t\tif (cell) {\n\t\t\t\tthis.focusElement(cell);\n\t\t\t\tconst selection = cellOptions.options?.selection;\n\t\t\t\tif (selection) {\n\t\t\t\t\tcell.updateEditState(CellEditState.Editing, \"setOptions\");\n\t\t\t\t\tcell.focusMode = CellFocusMode.Editor;\n\t\t\t\t\tawait this.revealRangeInCenterIfOutsideViewportAsync(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\tnew Range(\n\t\t\t\t\t\t\tselection.startLineNumber,\n\t\t\t\t\t\t\tselection.startColumn,\n\t\t\t\t\t\t\tselection.endLineNumber ||\n\t\t\t\t\t\t\t\tselection.startLineNumber,\n\t\t\t\t\t\t\tselection.endColumn || selection.startColumn,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tthis._list.revealCell(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\toptions?.cellRevealType ??\n\t\t\t\t\t\t\tCellRevealType.CenterIfOutsideViewport,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tconst editor = this._renderedEditors.get(cell)!;\n\t\t\t\tif (editor) {\n\t\t\t\t\tif (cellOptions.options?.selection) {\n\t\t\t\t\t\tconst { selection } = cellOptions.options;\n\t\t\t\t\t\tconst editorSelection = new Range(\n\t\t\t\t\t\t\tselection.startLineNumber,\n\t\t\t\t\t\t\tselection.startColumn,\n\t\t\t\t\t\t\tselection.endLineNumber ||\n\t\t\t\t\t\t\t\tselection.startLineNumber,\n\t\t\t\t\t\t\tselection.endColumn || selection.startColumn,\n\t\t\t\t\t\t);\n\t\t\t\t\t\teditor.setSelection(editorSelection);\n\t\t\t\t\t\teditor.revealPositionInCenterIfOutsideViewport({\n\t\t\t\t\t\t\tlineNumber: selection.startLineNumber,\n\t\t\t\t\t\t\tcolumn: selection.startColumn,\n\t\t\t\t\t\t});\n\t\t\t\t\t\tawait this.revealRangeInCenterIfOutsideViewportAsync(\n\t\t\t\t\t\t\tcell,\n\t\t\t\t\t\t\teditorSelection,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tif (!cellOptions.options?.preserveFocus) {\n\t\t\t\t\t\teditor.focus();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// select cells if options tell to do so\n\t\t// todo@rebornix https://github.com/microsoft/vscode/issues/118108 support selections not just focus\n\t\t// todo@rebornix support multipe selections\n\t\tif (options?.cellSelections) {\n\t\t\tconst focusCellIndex = options.cellSelections[0].start;\n\t\t\tconst focusedCell = this.viewModel.cellAt(focusCellIndex);\n\t\t\tif (focusedCell) {\n\t\t\t\tthis.viewModel.updateSelectionsState({\n\t\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\t\tfocus: { start: focusCellIndex, end: focusCellIndex + 1 },\n\t\t\t\t\tselections: options.cellSelections,\n\t\t\t\t});\n\t\t\t\tthis.revealInCenterIfOutsideViewport(focusedCell);\n\t\t\t}\n\t\t}\n\n\t\tthis._updateForOptions();\n\t\tthis._onDidChangeOptions.fire();\n\t}\n\n\tprivate _parseIndexedCellOptions(\n\t\toptions: INotebookEditorOptions | undefined,\n\t) {\n\t\tif (options?.indexedCellOptions) {\n\t\t\t// convert index based selections\n\t\t\tconst cell = this.cellAt(options.indexedCellOptions.index);\n\t\t\tif (cell) {\n\t\t\t\treturn {\n\t\t\t\t\tresource: cell.uri,\n\t\t\t\t\toptions: {\n\t\t\t\t\t\tselection: options.indexedCellOptions.selection,\n\t\t\t\t\t\tpreserveFocus: false,\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _detachModel() {\n\t\tthis._localStore.clear();\n\t\tdispose(this._localCellStateListeners);\n\t\tthis._list.detachViewModel();\n\t\tthis.viewModel?.dispose();\n\t\t// avoid event\n\t\tthis.viewModel = undefined;\n\t\tthis._webview?.dispose();\n\t\tthis._webview?.element.remove();\n\t\tthis._webview = null;\n\t\tthis._list.clear();\n\t}\n\n\tprivate _updateForOptions(): void {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._editorEditable.set(!this.viewModel.options.isReadOnly);\n\t\tthis._overflowContainer.classList.toggle(\n\t\t\t\"notebook-editor-editable\",\n\t\t\t!this.viewModel.options.isReadOnly,\n\t\t);\n\t\tthis.getDomNode().classList.toggle(\n\t\t\t\"notebook-editor-editable\",\n\t\t\t!this.viewModel.options.isReadOnly,\n\t\t);\n\t}\n\n\tprivate async _resolveWebview(): Promise<BackLayerWebView<ICommonCellInfo> | null> {\n\t\tif (!this.textModel) {\n\t\t\treturn null;\n\t\t}\n\n\t\tif (this._webviewResolvePromise) {\n\t\t\treturn this._webviewResolvePromise;\n\t\t}\n\n\t\tif (!this._webview) {\n\t\t\tthis._ensureWebview(\n\t\t\t\tthis.getId(),\n\t\t\t\tthis.textModel.viewType,\n\t\t\t\tthis.textModel.uri,\n\t\t\t);\n\t\t}\n\n\t\tthis._webviewResolvePromise = (async () => {\n\t\t\tif (!this._webview) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Notebook output webview object is not created successfully.\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tawait this._webview.createWebview(\n\t\t\t\tthis.creationOptions.codeWindow ?? mainWindow,\n\t\t\t);\n\t\t\tif (!this._webview.webview) {\n\t\t\t\tthrow new Error(\n\t\t\t\t\t\"Notebook output webview element was not created successfully.\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tthis._localStore.add(\n\t\t\t\tthis._webview.webview.onDidBlur(() => {\n\t\t\t\t\tthis._outputFocus.set(false);\n\t\t\t\t\tthis._webviewFocused = false;\n\n\t\t\t\t\tthis.updateEditorFocus();\n\t\t\t\t\tthis.updateCellFocusMode();\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tthis._localStore.add(\n\t\t\t\tthis._webview.webview.onDidFocus(() => {\n\t\t\t\t\tthis._outputFocus.set(true);\n\t\t\t\t\tthis.updateEditorFocus();\n\t\t\t\t\tthis._webviewFocused = true;\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tthis._localStore.add(\n\t\t\t\tthis._webview.onMessage((e) => {\n\t\t\t\t\tthis._onDidReceiveMessage.fire(e);\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\treturn this._webview;\n\t\t})();\n\n\t\treturn this._webviewResolvePromise;\n\t}\n\n\tprivate _ensureWebview(id: string, viewType: string, resource: URI) {\n\t\tif (this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst that = this;\n\n\t\tthis._webview = this.instantiationService.createInstance(\n\t\t\tBackLayerWebView,\n\t\t\t{\n\t\t\t\tget creationOptions() {\n\t\t\t\t\treturn that.creationOptions;\n\t\t\t\t},\n\t\t\t\tsetScrollTop(scrollTop: number) {\n\t\t\t\t\tthat._list.scrollTop = scrollTop;\n\t\t\t\t},\n\t\t\t\ttriggerScroll(event: IMouseWheelEvent) {\n\t\t\t\t\tthat._list.triggerScrollFromMouseWheelEvent(event);\n\t\t\t\t},\n\t\t\t\tgetCellByInfo: that.getCellByInfo.bind(that),\n\t\t\t\tgetCellById: that._getCellById.bind(that),\n\t\t\t\ttoggleNotebookCellSelection:\n\t\t\t\t\tthat._toggleNotebookCellSelection.bind(that),\n\t\t\t\tfocusNotebookCell: that.focusNotebookCell.bind(that),\n\t\t\t\tfocusNextNotebookCell: that.focusNextNotebookCell.bind(that),\n\t\t\t\tupdateOutputHeight: that._updateOutputHeight.bind(that),\n\t\t\t\tscheduleOutputHeightAck:\n\t\t\t\t\tthat._scheduleOutputHeightAck.bind(that),\n\t\t\t\tupdateMarkupCellHeight: that._updateMarkupCellHeight.bind(that),\n\t\t\t\tsetMarkupCellEditState: that._setMarkupCellEditState.bind(that),\n\t\t\t\tdidStartDragMarkupCell: that._didStartDragMarkupCell.bind(that),\n\t\t\t\tdidDragMarkupCell: that._didDragMarkupCell.bind(that),\n\t\t\t\tdidDropMarkupCell: that._didDropMarkupCell.bind(that),\n\t\t\t\tdidEndDragMarkupCell: that._didEndDragMarkupCell.bind(that),\n\t\t\t\tdidResizeOutput: that._didResizeOutput.bind(that),\n\t\t\t\tupdatePerformanceMetadata:\n\t\t\t\t\tthat._updatePerformanceMetadata.bind(that),\n\t\t\t\tdidFocusOutputInputChange:\n\t\t\t\t\tthat._didFocusOutputInputChange.bind(that),\n\t\t\t},\n\t\t\tid,\n\t\t\tviewType,\n\t\t\tresource,\n\t\t\t{\n\t\t\t\t...this._notebookOptions.computeWebviewOptions(),\n\t\t\t\tfontFamily: this._generateFontFamily(),\n\t\t\t},\n\t\t\tthis.notebookRendererMessaging.getScoped(this._uuid),\n\t\t);\n\n\t\tthis._webview.element.style.width = \"100%\";\n\n\t\t// attach the webview container to the DOM tree first\n\t\tthis._list.attachWebview(this._webview.element);\n\t}\n\n\tprivate async _attachModel(\n\t\ttextModel: NotebookTextModel,\n\t\tviewState: INotebookEditorViewState | undefined,\n\t\tperf?: NotebookPerfMarks,\n\t) {\n\t\tthis._ensureWebview(this.getId(), textModel.viewType, textModel.uri);\n\n\t\tthis.viewModel = this.instantiationService.createInstance(\n\t\t\tNotebookViewModel,\n\t\t\ttextModel.viewType,\n\t\t\ttextModel,\n\t\t\tthis._viewContext,\n\t\t\tthis.getLayoutInfo(),\n\t\t\t{ isReadOnly: this._readOnly, inRepl: this._inRepl },\n\t\t);\n\t\tthis._viewContext.eventDispatcher.emit([\n\t\t\tnew NotebookLayoutChangedEvent(\n\t\t\t\t{ width: true, fontInfo: true },\n\t\t\t\tthis.getLayoutInfo(),\n\t\t\t),\n\t\t]);\n\t\tthis.notebookOptions.updateOptions(this._readOnly);\n\n\t\tthis._updateForOptions();\n\t\tthis._updateForNotebookConfiguration();\n\n\t\t// restore view states, including contributions\n\n\t\t{\n\t\t\t// restore view state\n\t\t\tthis.viewModel.restoreEditorViewState(viewState);\n\n\t\t\t// contribution state restore\n\n\t\t\tconst contributionsState = viewState?.contributionsState || {};\n\t\t\tfor (const [id, contribution] of this._contributions) {\n\t\t\t\tif (typeof contribution.restoreViewState === \"function\") {\n\t\t\t\t\tcontribution.restoreViewState(contributionsState[id]);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tthis._localStore.add(\n\t\t\tthis.viewModel.onDidChangeViewCells((e) => {\n\t\t\t\tthis._onDidChangeViewCells.fire(e);\n\t\t\t}),\n\t\t);\n\n\t\tthis._localStore.add(\n\t\t\tthis.viewModel.onDidChangeSelection(() => {\n\t\t\t\tthis._onDidChangeSelection.fire();\n\t\t\t\tthis.updateSelectedMarkdownPreviews();\n\t\t\t}),\n\t\t);\n\n\t\tthis._localStore.add(\n\t\t\tthis._list.onWillScroll((e) => {\n\t\t\t\tif (this._webview?.isResolved()) {\n\t\t\t\t\tthis._webviewTransparentCover!.style.transform =\n\t\t\t\t\t\t`translateY(${e.scrollTop})`;\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tlet hasPendingChangeContentHeight = false;\n\t\tthis._localStore.add(\n\t\t\tthis._list.onDidChangeContentHeight(() => {\n\t\t\t\tif (hasPendingChangeContentHeight) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\thasPendingChangeContentHeight = true;\n\n\t\t\t\tthis._localStore.add(\n\t\t\t\t\tDOM.scheduleAtNextAnimationFrame(\n\t\t\t\t\t\tDOM.getWindow(this.getDomNode()),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\thasPendingChangeContentHeight = false;\n\t\t\t\t\t\t\tthis._updateScrollHeight();\n\t\t\t\t\t\t},\n\t\t\t\t\t\t100,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}),\n\t\t);\n\n\t\tthis._localStore.add(\n\t\t\tthis._list.onDidRemoveOutputs((outputs) => {\n\t\t\t\toutputs.forEach((output) => this.removeInset(output));\n\t\t\t}),\n\t\t);\n\t\tthis._localStore.add(\n\t\t\tthis._list.onDidHideOutputs((outputs) => {\n\t\t\t\toutputs.forEach((output) => this.hideInset(output));\n\t\t\t}),\n\t\t);\n\t\tthis._localStore.add(\n\t\t\tthis._list.onDidRemoveCellsFromView((cells) => {\n\t\t\t\tconst hiddenCells: MarkupCellViewModel[] = [];\n\t\t\t\tconst deletedCells: MarkupCellViewModel[] = [];\n\n\t\t\t\tfor (const cell of cells) {\n\t\t\t\t\tif (cell.cellKind === CellKind.Markup) {\n\t\t\t\t\t\tconst mdCell = cell as MarkupCellViewModel;\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.viewModel?.viewCells.find(\n\t\t\t\t\t\t\t\t(cell) => cell.handle === mdCell.handle,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Cell has been folded but is still in model\n\t\t\t\t\t\t\thiddenCells.push(mdCell);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Cell was deleted\n\t\t\t\t\t\t\tdeletedCells.push(mdCell);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tthis.hideMarkupPreviews(hiddenCells);\n\t\t\t\tthis.deleteMarkupPreviews(deletedCells);\n\t\t\t}),\n\t\t);\n\n\t\t// init rendering\n\t\tawait this._warmupWithMarkdownRenderer(this.viewModel, viewState, perf);\n\n\t\tperf?.mark(\"customMarkdownLoaded\");\n\n\t\t// model attached\n\t\tthis._localCellStateListeners = this.viewModel.viewCells.map((cell) =>\n\t\t\tthis._bindCellListener(cell),\n\t\t);\n\t\tthis._lastCellWithEditorFocus =\n\t\t\tthis.viewModel.viewCells.find(\n\t\t\t\t(viewCell) =>\n\t\t\t\t\tthis.getActiveCell() === viewCell &&\n\t\t\t\t\tviewCell.focusMode === CellFocusMode.Editor,\n\t\t\t) ?? null;\n\n\t\tthis._localStore.add(\n\t\t\tthis.viewModel.onDidChangeViewCells((e) => {\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// update cell listener\n\t\t\t\t[...e.splices].reverse().forEach((splice) => {\n\t\t\t\t\tconst [start, deleted, newCells] = splice;\n\t\t\t\t\tconst deletedCells = this._localCellStateListeners.splice(\n\t\t\t\t\t\tstart,\n\t\t\t\t\t\tdeleted,\n\t\t\t\t\t\t...newCells.map((cell) => this._bindCellListener(cell)),\n\t\t\t\t\t);\n\n\t\t\t\t\tdispose(deletedCells);\n\t\t\t\t});\n\n\t\t\t\tif (\n\t\t\t\t\te.splices.some((s) =>\n\t\t\t\t\t\ts[2].some((cell) => cell.cellKind === CellKind.Markup),\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tthis._backgroundMarkdownRendering();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tif (this._dimension) {\n\t\t\tthis._list.layout(\n\t\t\t\tthis.getBodyHeight(this._dimension.height),\n\t\t\t\tthis._dimension.width,\n\t\t\t);\n\t\t} else {\n\t\t\tthis._list.layout();\n\t\t}\n\n\t\tthis._dndController?.clearGlobalDragState();\n\n\t\t// restore list state at last, it must be after list layout\n\t\tthis.restoreListViewState(viewState);\n\t}\n\n\tprivate _bindCellListener(cell: ICellViewModel) {\n\t\tconst store = new DisposableStore();\n\n\t\tstore.add(\n\t\t\tcell.onDidChangeLayout((e) => {\n\t\t\t\t// e.totalHeight will be false it's not changed\n\t\t\t\tif (e.totalHeight || e.outerWidth) {\n\t\t\t\t\tthis.layoutNotebookCell(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\tcell.layoutInfo.totalHeight,\n\t\t\t\t\t\te.context,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tif (cell.cellKind === CellKind.Code) {\n\t\t\tstore.add(\n\t\t\t\t(cell as CodeCellViewModel).onDidRemoveOutputs((outputs) => {\n\t\t\t\t\toutputs.forEach((output) => this.removeInset(output));\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tstore.add(\n\t\t\t(cell as CellViewModel).onDidChangeState((e) => {\n\t\t\t\tif (\n\t\t\t\t\te.inputCollapsedChanged &&\n\t\t\t\t\tcell.isInputCollapsed &&\n\t\t\t\t\tcell.cellKind === CellKind.Markup\n\t\t\t\t) {\n\t\t\t\t\tthis.hideMarkupPreviews([cell as MarkupCellViewModel]);\n\t\t\t\t}\n\n\t\t\t\tif (\n\t\t\t\t\te.outputCollapsedChanged &&\n\t\t\t\t\tcell.isOutputCollapsed &&\n\t\t\t\t\tcell.cellKind === CellKind.Code\n\t\t\t\t) {\n\t\t\t\t\tcell.outputsViewModels.forEach((output) =>\n\t\t\t\t\t\tthis.hideInset(output),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (e.focusModeChanged) {\n\t\t\t\t\tthis._validateCellFocusMode(cell);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\treturn store;\n\t}\n\n\tprivate _lastCellWithEditorFocus: ICellViewModel | null = null;\n\tprivate _validateCellFocusMode(cell: ICellViewModel) {\n\t\tif (cell.focusMode !== CellFocusMode.Editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (\n\t\t\tthis._lastCellWithEditorFocus &&\n\t\t\tthis._lastCellWithEditorFocus !== cell\n\t\t) {\n\t\t\tthis._lastCellWithEditorFocus.focusMode = CellFocusMode.Container;\n\t\t}\n\n\t\tthis._lastCellWithEditorFocus = cell;\n\t}\n\n\tprivate async _warmupWithMarkdownRenderer(\n\t\tviewModel: NotebookViewModel,\n\t\tviewState: INotebookEditorViewState | undefined,\n\t\tperf?: NotebookPerfMarks,\n\t) {\n\t\tthis.logService.debug(\n\t\t\t\"NotebookEditorWidget\",\n\t\t\t\"warmup \" + this.viewModel?.uri.toString(),\n\t\t);\n\t\tawait this._resolveWebview();\n\t\tperf?.mark(\"webviewCommLoaded\");\n\n\t\tthis.logService.debug(\n\t\t\t\"NotebookEditorWidget\",\n\t\t\t\"warmup - webview resolved\",\n\t\t);\n\n\t\t// make sure that the webview is not visible otherwise users will see pre-rendered markdown cells in wrong position as the list view doesn't have a correct `top` offset yet\n\t\tthis._webview!.element.style.visibility = \"hidden\";\n\t\t// warm up can take around 200ms to load markdown libraries, etc.\n\t\tawait this._warmupViewportMarkdownCells(viewModel, viewState);\n\t\tthis.logService.debug(\n\t\t\t\"NotebookEditorWidget\",\n\t\t\t\"warmup - viewport warmed up\",\n\t\t);\n\n\t\t// todo@rebornix @mjbvz, is this too complicated?\n\n\t\t/* now the webview is ready, and requests to render markdown are fast enough\n\t\t * we can start rendering the list view\n\t\t * render\n\t\t *   - markdown cell -> request to webview to (10ms, basically just latency between UI and iframe)\n\t\t *   - code cell -> render in place\n\t\t */\n\t\tthis._list.layout(0, 0);\n\t\tthis._list.attachViewModel(viewModel);\n\n\t\t// now the list widget has a correct contentHeight/scrollHeight\n\t\t// setting scrollTop will work properly\n\t\t// after setting scroll top, the list view will update `top` of the scrollable element, e.g. `top: -584px`\n\t\tthis._list.scrollTop = viewState?.scrollPosition?.top ?? 0;\n\t\tthis._debug(\"finish initial viewport warmup and view state restore.\");\n\t\tthis._webview!.element.style.visibility = \"visible\";\n\t\tthis.logService.debug(\n\t\t\t\"NotebookEditorWidget\",\n\t\t\t\"warmup - list view model attached, set to visible\",\n\t\t);\n\t\tthis._onDidAttachViewModel.fire();\n\t}\n\n\tprivate async _warmupViewportMarkdownCells(\n\t\tviewModel: NotebookViewModel,\n\t\tviewState: INotebookEditorViewState | undefined,\n\t) {\n\t\tif (viewState && viewState.cellTotalHeights) {\n\t\t\tconst totalHeightCache = viewState.cellTotalHeights;\n\t\t\tconst scrollTop = viewState.scrollPosition?.top ?? 0;\n\t\t\tconst scrollBottom =\n\t\t\t\tscrollTop + Math.max(this._dimension?.height ?? 0, 1080);\n\n\t\t\tlet offset = 0;\n\t\t\tconst requests: [ICellViewModel, number][] = [];\n\n\t\t\tfor (let i = 0; i < viewModel.length; i++) {\n\t\t\t\tconst cell = viewModel.cellAt(i)!;\n\t\t\t\tconst cellHeight = totalHeightCache[i] ?? 0;\n\n\t\t\t\tif (offset + cellHeight < scrollTop) {\n\t\t\t\t\toffset += cellHeight;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (cell.cellKind === CellKind.Markup) {\n\t\t\t\t\trequests.push([cell, offset]);\n\t\t\t\t}\n\n\t\t\t\toffset += cellHeight;\n\n\t\t\t\tif (offset > scrollBottom) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tawait this._webview!.initializeMarkup(\n\t\t\t\trequests.map(([model, offset]) =>\n\t\t\t\t\tthis.createMarkupCellInitialization(model, offset),\n\t\t\t\t),\n\t\t\t);\n\t\t} else {\n\t\t\tconst initRequests = viewModel.viewCells\n\t\t\t\t.filter((cell) => cell.cellKind === CellKind.Markup)\n\t\t\t\t.slice(0, 5)\n\t\t\t\t.map((cell) =>\n\t\t\t\t\tthis.createMarkupCellInitialization(cell, -10000),\n\t\t\t\t);\n\n\t\t\tawait this._webview!.initializeMarkup(initRequests);\n\n\t\t\t// no cached view state so we are rendering the first viewport\n\t\t\t// after above async call, we already get init height for markdown cells, we can update their offset\n\t\t\tlet offset = 0;\n\t\t\tconst offsetUpdateRequests: { id: string; top: number }[] = [];\n\t\t\tconst scrollBottom = Math.max(this._dimension?.height ?? 0, 1080);\n\t\t\tfor (const cell of viewModel.viewCells) {\n\t\t\t\tif (cell.cellKind === CellKind.Markup) {\n\t\t\t\t\toffsetUpdateRequests.push({ id: cell.id, top: offset });\n\t\t\t\t}\n\n\t\t\t\toffset += cell.getHeight(\n\t\t\t\t\tthis.getLayoutInfo().fontInfo.lineHeight,\n\t\t\t\t);\n\n\t\t\t\tif (offset > scrollBottom) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._webview?.updateScrollTops([], offsetUpdateRequests);\n\t\t}\n\t}\n\n\tprivate createMarkupCellInitialization(\n\t\tmodel: ICellViewModel,\n\t\toffset: number,\n\t): IMarkupCellInitialization {\n\t\treturn {\n\t\t\tmime: model.mime,\n\t\t\tcellId: model.id,\n\t\t\tcellHandle: model.handle,\n\t\t\tcontent: model.getText(),\n\t\t\toffset: offset,\n\t\t\tvisible: false,\n\t\t\tmetadata: model.metadata,\n\t\t};\n\t}\n\n\trestoreListViewState(\n\t\tviewState: INotebookEditorViewState | undefined,\n\t): void {\n\t\tif (!this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (viewState?.scrollPosition !== undefined) {\n\t\t\tthis._list.scrollTop = viewState.scrollPosition.top;\n\t\t\tthis._list.scrollLeft = viewState.scrollPosition.left;\n\t\t} else {\n\t\t\tthis._list.scrollTop = 0;\n\t\t\tthis._list.scrollLeft = 0;\n\t\t}\n\n\t\tconst focusIdx =\n\t\t\ttypeof viewState?.focus === \"number\" ? viewState.focus : 0;\n\t\tif (focusIdx < this.viewModel.length) {\n\t\t\tconst element = this.viewModel.cellAt(focusIdx);\n\t\t\tif (element) {\n\t\t\t\tthis.viewModel?.updateSelectionsState({\n\t\t\t\t\tkind: SelectionStateType.Handle,\n\t\t\t\t\tprimary: element.handle,\n\t\t\t\t\tselections: [element.handle],\n\t\t\t\t});\n\t\t\t}\n\t\t} else if (this._list.length > 0) {\n\t\t\tthis.viewModel.updateSelectionsState({\n\t\t\t\tkind: SelectionStateType.Index,\n\t\t\t\tfocus: { start: 0, end: 1 },\n\t\t\t\tselections: [{ start: 0, end: 1 }],\n\t\t\t});\n\t\t}\n\n\t\tif (viewState?.editorFocused) {\n\t\t\tconst cell = this.viewModel.cellAt(focusIdx);\n\t\t\tif (cell) {\n\t\t\t\tcell.focusMode = CellFocusMode.Editor;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _restoreSelectedKernel(\n\t\tviewState: INotebookEditorViewState | undefined,\n\t): void {\n\t\tif (viewState?.selectedKernelId && this.textModel) {\n\t\t\tconst matching = this.notebookKernelService.getMatchingKernel(\n\t\t\t\tthis.textModel,\n\t\t\t);\n\t\t\tconst kernel = matching.all.find(\n\t\t\t\t(k) => k.id === viewState.selectedKernelId,\n\t\t\t);\n\t\t\t// Selected kernel may have already been picked prior to the view state loading\n\t\t\t// If so, don't overwrite it with the saved kernel.\n\t\t\tif (kernel && !matching.selected) {\n\t\t\t\tthis.notebookKernelService.selectKernelForNotebook(\n\t\t\t\t\tkernel,\n\t\t\t\t\tthis.textModel,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tgetEditorViewState(): INotebookEditorViewState {\n\t\tconst state = this.viewModel?.getEditorViewState();\n\t\tif (!state) {\n\t\t\treturn {\n\t\t\t\teditingCells: {},\n\t\t\t\tcellLineNumberStates: {},\n\t\t\t\teditorViewStates: {},\n\t\t\t\tcollapsedInputCells: {},\n\t\t\t\tcollapsedOutputCells: {},\n\t\t\t};\n\t\t}\n\n\t\tif (this._list) {\n\t\t\tstate.scrollPosition = {\n\t\t\t\tleft: this._list.scrollLeft,\n\t\t\t\ttop: this._list.scrollTop,\n\t\t\t};\n\t\t\tconst cellHeights: { [key: number]: number } = {};\n\t\t\tfor (let i = 0; i < this.viewModel!.length; i++) {\n\t\t\t\tconst elm = this.viewModel!.cellAt(i) as CellViewModel;\n\t\t\t\tcellHeights[i] = elm.layoutInfo.totalHeight;\n\t\t\t}\n\n\t\t\tstate.cellTotalHeights = cellHeights;\n\n\t\t\tif (this.viewModel) {\n\t\t\t\tconst focusRange = this.viewModel.getFocus();\n\t\t\t\tconst element = this.viewModel.cellAt(focusRange.start);\n\t\t\t\tif (element) {\n\t\t\t\t\tconst itemDOM = this._list.domElementOfElement(element);\n\t\t\t\t\tconst editorFocused =\n\t\t\t\t\t\telement.getEditState() === CellEditState.Editing &&\n\t\t\t\t\t\t!!(\n\t\t\t\t\t\t\titemDOM &&\n\t\t\t\t\t\t\titemDOM.ownerDocument.activeElement &&\n\t\t\t\t\t\t\titemDOM.contains(\n\t\t\t\t\t\t\t\titemDOM.ownerDocument.activeElement,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t);\n\n\t\t\t\t\tstate.editorFocused = editorFocused;\n\t\t\t\t\tstate.focus = focusRange.start;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t// Save contribution view states\n\t\tconst contributionsState: { [key: string]: unknown } = {};\n\t\tfor (const [id, contribution] of this._contributions) {\n\t\t\tif (typeof contribution.saveViewState === \"function\") {\n\t\t\t\tcontributionsState[id] = contribution.saveViewState();\n\t\t\t}\n\t\t}\n\t\tstate.contributionsState = contributionsState;\n\t\tif (this.textModel?.uri.scheme === Schemas.untitled) {\n\t\t\tstate.selectedKernelId = this.activeKernel?.id;\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate _allowScrollBeyondLastLine() {\n\t\treturn this._scrollBeyondLastLine && !this.isEmbedded;\n\t}\n\n\tprivate getBodyHeight(dimensionHeight: number) {\n\t\treturn Math.max(\n\t\t\tdimensionHeight -\n\t\t\t\t(this._notebookTopToolbar?.useGlobalToolbar\n\t\t\t\t\t? /** Toolbar height */ 26\n\t\t\t\t\t: 0),\n\t\t\t0,\n\t\t);\n\t}\n\n\tlayout(\n\t\tdimension: DOM.Dimension,\n\t\tshadowElement?: HTMLElement,\n\t\tposition?: DOM.IDomPosition,\n\t): void {\n\t\tif (!shadowElement && this._shadowElementViewInfo === null) {\n\t\t\tthis._dimension = dimension;\n\t\t\tthis._position = position;\n\t\t\treturn;\n\t\t}\n\n\t\tif (dimension.width <= 0 || dimension.height <= 0) {\n\t\t\tthis.onWillHide();\n\t\t\treturn;\n\t\t}\n\n\t\tconst whenContainerStylesLoaded =\n\t\t\tthis.layoutService.whenContainerStylesLoaded(\n\t\t\t\tDOM.getWindow(this.getDomNode()),\n\t\t\t);\n\t\tif (whenContainerStylesLoaded) {\n\t\t\t// In floating windows, we need to ensure that the\n\t\t\t// container is ready for us to compute certain\n\t\t\t// layout related properties.\n\t\t\twhenContainerStylesLoaded.then(() =>\n\t\t\t\tthis.layoutNotebook(dimension, shadowElement, position),\n\t\t\t);\n\t\t} else {\n\t\t\tthis.layoutNotebook(dimension, shadowElement, position);\n\t\t}\n\t}\n\n\tprivate layoutNotebook(\n\t\tdimension: DOM.Dimension,\n\t\tshadowElement?: HTMLElement,\n\t\tposition?: DOM.IDomPosition,\n\t) {\n\t\tif (shadowElement) {\n\t\t\tthis.updateShadowElement(shadowElement, dimension, position);\n\t\t}\n\n\t\tif (\n\t\t\tthis._shadowElementViewInfo &&\n\t\t\tthis._shadowElementViewInfo.width <= 0 &&\n\t\t\tthis._shadowElementViewInfo.height <= 0\n\t\t) {\n\t\t\tthis.onWillHide();\n\t\t\treturn;\n\t\t}\n\n\t\tthis._dimension = dimension;\n\t\tthis._position = position;\n\t\tconst newBodyHeight =\n\t\t\tthis.getBodyHeight(dimension.height) -\n\t\t\tthis.getLayoutInfo().stickyHeight;\n\t\tDOM.size(this._body, dimension.width, newBodyHeight);\n\n\t\tconst newCellListHeight = newBodyHeight;\n\t\tif (this._list.getRenderHeight() < newCellListHeight) {\n\t\t\t// the new dimension is larger than the list viewport, update its additional height first, otherwise the list view will move down a bit (as the `scrollBottom` will move down)\n\t\t\tthis._list.updateOptions({\n\t\t\t\tpaddingBottom: this._allowScrollBeyondLastLine()\n\t\t\t\t\t? Math.max(0, newCellListHeight - 50)\n\t\t\t\t\t: 0,\n\t\t\t\tpaddingTop: 0,\n\t\t\t});\n\t\t\tthis._list.layout(newCellListHeight, dimension.width);\n\t\t} else {\n\t\t\t// the new dimension is smaller than the list viewport, if we update the additional height, the `scrollBottom` will move up, which moves the whole list view upwards a bit. So we run a layout first.\n\t\t\tthis._list.layout(newCellListHeight, dimension.width);\n\t\t\tthis._list.updateOptions({\n\t\t\t\tpaddingBottom: this._allowScrollBeyondLastLine()\n\t\t\t\t\t? Math.max(0, newCellListHeight - 50)\n\t\t\t\t\t: 0,\n\t\t\t\tpaddingTop: 0,\n\t\t\t});\n\t\t}\n\n\t\tthis._overlayContainer.inert = false;\n\t\tthis._overlayContainer.style.visibility = \"visible\";\n\t\tthis._overlayContainer.style.display = \"block\";\n\t\tthis._overlayContainer.style.position = \"absolute\";\n\t\tthis._overlayContainer.style.overflow = \"hidden\";\n\n\t\tthis.layoutContainerOverShadowElement(dimension, position);\n\n\t\tif (this._webviewTransparentCover) {\n\t\t\tthis._webviewTransparentCover.style.height = `${dimension.height}px`;\n\t\t\tthis._webviewTransparentCover.style.width = `${dimension.width}px`;\n\t\t}\n\n\t\tthis._notebookTopToolbar.layout(this._dimension);\n\t\tthis._notebookOverviewRuler.layout();\n\n\t\tthis._viewContext?.eventDispatcher.emit([\n\t\t\tnew NotebookLayoutChangedEvent(\n\t\t\t\t{ width: true, fontInfo: true },\n\t\t\t\tthis.getLayoutInfo(),\n\t\t\t),\n\t\t]);\n\t}\n\n\tprivate updateShadowElement(\n\t\tshadowElement: HTMLElement,\n\t\tdimension?: IDimension,\n\t\tposition?: DOM.IDomPosition,\n\t) {\n\t\tthis._shadowElement = shadowElement;\n\t\tif (dimension && position) {\n\t\t\tthis._shadowElementViewInfo = {\n\t\t\t\theight: dimension.height,\n\t\t\t\twidth: dimension.width,\n\t\t\t\ttop: position.top,\n\t\t\t\tleft: position.left,\n\t\t\t};\n\t\t} else {\n\t\t\t// We have to recompute position and size ourselves (which is slow)\n\t\t\tconst containerRect = shadowElement.getBoundingClientRect();\n\t\t\tthis._shadowElementViewInfo = {\n\t\t\t\theight: containerRect.height,\n\t\t\t\twidth: containerRect.width,\n\t\t\t\ttop: containerRect.top,\n\t\t\t\tleft: containerRect.left,\n\t\t\t};\n\t\t}\n\t}\n\n\tprivate layoutContainerOverShadowElement(\n\t\tdimension?: DOM.Dimension,\n\t\tposition?: DOM.IDomPosition,\n\t): void {\n\t\tif (dimension && position) {\n\t\t\tthis._overlayContainer.style.top = `${position.top}px`;\n\t\t\tthis._overlayContainer.style.left = `${position.left}px`;\n\t\t\tthis._overlayContainer.style.width = `${dimension.width}px`;\n\t\t\tthis._overlayContainer.style.height = `${dimension.height}px`;\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._shadowElementViewInfo) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst elementContainerRect =\n\t\t\tthis._overlayContainer.parentElement?.getBoundingClientRect();\n\t\tthis._overlayContainer.style.top = `${this._shadowElementViewInfo.top - (elementContainerRect?.top || 0)}px`;\n\t\tthis._overlayContainer.style.left = `${this._shadowElementViewInfo.left - (elementContainerRect?.left || 0)}px`;\n\t\tthis._overlayContainer.style.width = `${dimension ? dimension.width : this._shadowElementViewInfo.width}px`;\n\t\tthis._overlayContainer.style.height = `${dimension ? dimension.height : this._shadowElementViewInfo.height}px`;\n\t}\n\n\t//#endregion\n\n\t//#region Focus tracker\n\tfocus() {\n\t\tthis._isVisible = true;\n\t\tthis._editorFocus.set(true);\n\n\t\tif (this._webviewFocused) {\n\t\t\tthis._webview?.focusWebview();\n\t\t} else {\n\t\t\tif (this.viewModel) {\n\t\t\t\tconst focusRange = this.viewModel.getFocus();\n\t\t\t\tconst element = this.viewModel.cellAt(focusRange.start);\n\n\t\t\t\t// The notebook editor doesn't have focus yet\n\t\t\t\tif (!this.hasEditorFocus()) {\n\t\t\t\t\tthis.focusContainer();\n\t\t\t\t\t// trigger editor to update as FocusTracker might not emit focus change event\n\t\t\t\t\tthis.updateEditorFocus();\n\t\t\t\t}\n\n\t\t\t\tif (element && element.focusMode === CellFocusMode.Editor) {\n\t\t\t\t\telement.updateEditState(\n\t\t\t\t\t\tCellEditState.Editing,\n\t\t\t\t\t\t\"editorWidget.focus\",\n\t\t\t\t\t);\n\t\t\t\t\telement.focusMode = CellFocusMode.Editor;\n\t\t\t\t\tthis.focusEditor(element);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._list.domFocus();\n\t\t}\n\n\t\tif (this._currentProgress) {\n\t\t\t// The editor forces progress to hide when switching editors. So if progress should be visible, force it to show when the editor is focused.\n\t\t\tthis.showProgress();\n\t\t}\n\t}\n\n\tonShow() {\n\t\tthis._isVisible = true;\n\t}\n\n\tprivate focusEditor(activeElement: CellViewModel): void {\n\t\tfor (const [element, editor] of this._renderedEditors.entries()) {\n\t\t\tif (element === activeElement) {\n\t\t\t\teditor.focus();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t}\n\n\tfocusContainer(clearSelection = false) {\n\t\tif (this._webviewFocused) {\n\t\t\tthis._webview?.focusWebview();\n\t\t} else {\n\t\t\tthis._list.focusContainer(clearSelection);\n\t\t}\n\t}\n\n\tselectOutputContent(cell: ICellViewModel) {\n\t\tthis._webview?.selectOutputContents(cell);\n\t}\n\n\tselectInputContents(cell: ICellViewModel) {\n\t\tthis._webview?.selectInputContents(cell);\n\t}\n\n\tonWillHide() {\n\t\tthis._isVisible = false;\n\t\tthis._editorFocus.set(false);\n\t\tthis._overlayContainer.inert = true;\n\t\tthis._overlayContainer.style.visibility = \"hidden\";\n\t\tthis._overlayContainer.style.left = \"-50000px\";\n\t\tthis._notebookTopToolbarContainer.style.display = \"none\";\n\t\tthis.clearActiveCellWidgets();\n\t}\n\n\tprivate clearActiveCellWidgets() {\n\t\tthis._renderedEditors.forEach((editor, cell) => {\n\t\t\tif (this.getActiveCell() === cell && editor) {\n\t\t\t\tSuggestController.get(editor)?.cancelSuggestWidget();\n\t\t\t\tDropIntoEditorController.get(editor)?.clearWidgets();\n\t\t\t\tCopyPasteController.get(editor)?.clearWidgets();\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate editorHasDomFocus(): boolean {\n\t\treturn DOM.isAncestorOfActiveElement(this.getDomNode());\n\t}\n\n\tupdateEditorFocus() {\n\t\t// Note - focus going to the webview will fire 'blur', but the webview element will be\n\t\t// a descendent of the notebook editor root.\n\t\tthis._focusTracker.refreshState();\n\t\tconst focused = this.editorHasDomFocus();\n\t\tthis._editorFocus.set(focused);\n\t\tthis.viewModel?.setEditorFocus(focused);\n\t}\n\n\tupdateCellFocusMode() {\n\t\tconst activeCell = this.getActiveCell();\n\n\t\tif (\n\t\t\tactiveCell?.focusMode === CellFocusMode.Output &&\n\t\t\t!this._webviewFocused\n\t\t) {\n\t\t\t// output previously has focus, but now it's blurred.\n\t\t\tactiveCell.focusMode = CellFocusMode.Container;\n\t\t}\n\t}\n\n\thasEditorFocus() {\n\t\t// _editorFocus is driven by the FocusTracker, which is only guaranteed to _eventually_ fire blur.\n\t\t// If we need to know whether we have focus at this instant, we need to check the DOM manually.\n\t\tthis.updateEditorFocus();\n\t\treturn this.editorHasDomFocus();\n\t}\n\n\thasWebviewFocus() {\n\t\treturn this._webviewFocused;\n\t}\n\n\thasOutputTextSelection() {\n\t\tif (!this.hasEditorFocus()) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst windowSelection = DOM.getWindow(this.getDomNode()).getSelection();\n\t\tif (windowSelection?.rangeCount !== 1) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst activeSelection = windowSelection.getRangeAt(0);\n\t\tif (\n\t\t\tactiveSelection.startContainer === activeSelection.endContainer &&\n\t\t\tactiveSelection.endOffset - activeSelection.startOffset === 0\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tlet container: any = activeSelection.commonAncestorContainer;\n\n\t\tif (!this._body.contains(container)) {\n\t\t\treturn false;\n\t\t}\n\n\t\twhile (container && container !== this._body) {\n\t\t\tif (\n\t\t\t\t(container as HTMLElement).classList &&\n\t\t\t\t(container as HTMLElement).classList.contains(\"output\")\n\t\t\t) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tcontainer = container.parentNode;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\t_didFocusOutputInputChange(hasFocus: boolean) {\n\t\tthis._outputInputFocus.set(hasFocus);\n\t}\n\n\t//#endregion\n\n\t//#region Editor Features\n\n\tfocusElement(cell: ICellViewModel) {\n\t\tthis.viewModel?.updateSelectionsState({\n\t\t\tkind: SelectionStateType.Handle,\n\t\t\tprimary: cell.handle,\n\t\t\tselections: [cell.handle],\n\t\t});\n\t}\n\n\tget scrollTop() {\n\t\treturn this._list.scrollTop;\n\t}\n\n\tget scrollBottom() {\n\t\treturn this._list.scrollTop + this._list.getRenderHeight();\n\t}\n\n\tgetAbsoluteTopOfElement(cell: ICellViewModel) {\n\t\treturn this._list.getCellViewScrollTop(cell);\n\t}\n\n\tgetHeightOfElement(cell: ICellViewModel) {\n\t\treturn this._list.elementHeight(cell);\n\t}\n\n\tscrollToBottom() {\n\t\tthis._list.scrollToBottom();\n\t}\n\n\tsetScrollTop(scrollTop: number): void {\n\t\tthis._list.scrollTop = scrollTop;\n\t}\n\n\trevealCellRangeInView(range: ICellRange) {\n\t\treturn this._list.revealCells(range);\n\t}\n\n\trevealInView(cell: ICellViewModel) {\n\t\treturn this._list.revealCell(cell, CellRevealType.Default);\n\t}\n\n\trevealInViewAtTop(cell: ICellViewModel) {\n\t\tthis._list.revealCell(cell, CellRevealType.Top);\n\t}\n\n\trevealInCenter(cell: ICellViewModel) {\n\t\tthis._list.revealCell(cell, CellRevealType.Center);\n\t}\n\n\tasync revealInCenterIfOutsideViewport(cell: ICellViewModel) {\n\t\tawait this._list.revealCell(\n\t\t\tcell,\n\t\t\tCellRevealType.CenterIfOutsideViewport,\n\t\t);\n\t}\n\n\tasync revealFirstLineIfOutsideViewport(cell: ICellViewModel) {\n\t\tawait this._list.revealCell(\n\t\t\tcell,\n\t\t\tCellRevealType.FirstLineIfOutsideViewport,\n\t\t);\n\t}\n\n\tasync revealLineInViewAsync(\n\t\tcell: ICellViewModel,\n\t\tline: number,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\tnew Range(line, 1, line, 1),\n\t\t\tCellRevealRangeType.Default,\n\t\t);\n\t}\n\n\tasync revealLineInCenterAsync(\n\t\tcell: ICellViewModel,\n\t\tline: number,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\tnew Range(line, 1, line, 1),\n\t\t\tCellRevealRangeType.Center,\n\t\t);\n\t}\n\n\tasync revealLineInCenterIfOutsideViewportAsync(\n\t\tcell: ICellViewModel,\n\t\tline: number,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\tnew Range(line, 1, line, 1),\n\t\t\tCellRevealRangeType.CenterIfOutsideViewport,\n\t\t);\n\t}\n\n\tasync revealRangeInViewAsync(\n\t\tcell: ICellViewModel,\n\t\trange: Selection | Range,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\trange,\n\t\t\tCellRevealRangeType.Default,\n\t\t);\n\t}\n\n\tasync revealRangeInCenterAsync(\n\t\tcell: ICellViewModel,\n\t\trange: Selection | Range,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\trange,\n\t\t\tCellRevealRangeType.Center,\n\t\t);\n\t}\n\n\tasync revealRangeInCenterIfOutsideViewportAsync(\n\t\tcell: ICellViewModel,\n\t\trange: Selection | Range,\n\t): Promise<void> {\n\t\treturn this._list.revealRangeInCell(\n\t\t\tcell,\n\t\t\trange,\n\t\t\tCellRevealRangeType.CenterIfOutsideViewport,\n\t\t);\n\t}\n\n\trevealCellOffsetInCenter(cell: ICellViewModel, offset: number) {\n\t\treturn this._list.revealCellOffsetInCenter(cell, offset);\n\t}\n\n\trevealOffsetInCenterIfOutsideViewport(offset: number) {\n\t\treturn this._list.revealOffsetInCenterIfOutsideViewport(offset);\n\t}\n\n\tgetViewIndexByModelIndex(index: number): number {\n\t\tif (!this._listViewInfoAccessor) {\n\t\t\treturn -1;\n\t\t}\n\t\tconst cell = this.viewModel?.viewCells[index];\n\t\tif (!cell) {\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn this._listViewInfoAccessor.getViewIndex(cell);\n\t}\n\n\tgetViewHeight(cell: ICellViewModel): number {\n\t\tif (!this._listViewInfoAccessor) {\n\t\t\treturn -1;\n\t\t}\n\n\t\treturn this._listViewInfoAccessor.getViewHeight(cell);\n\t}\n\n\tgetCellRangeFromViewRange(\n\t\tstartIndex: number,\n\t\tendIndex: number,\n\t): ICellRange | undefined {\n\t\treturn this._listViewInfoAccessor.getCellRangeFromViewRange(\n\t\t\tstartIndex,\n\t\t\tendIndex,\n\t\t);\n\t}\n\n\tgetCellsInRange(range?: ICellRange): ReadonlyArray<ICellViewModel> {\n\t\treturn this._listViewInfoAccessor.getCellsInRange(range);\n\t}\n\n\tsetCellEditorSelection(cell: ICellViewModel, range: Range): void {\n\t\tthis._list.setCellEditorSelection(cell, range);\n\t}\n\n\tsetHiddenAreas(_ranges: ICellRange[]): boolean {\n\t\treturn this._list.setHiddenAreas(_ranges, true);\n\t}\n\n\tgetVisibleRangesPlusViewportAboveAndBelow(): ICellRange[] {\n\t\treturn this._listViewInfoAccessor.getVisibleRangesPlusViewportAboveAndBelow();\n\t}\n\n\t//#endregion\n\n\t//#region Decorations\n\n\tdeltaCellDecorations(\n\t\toldDecorations: string[],\n\t\tnewDecorations: INotebookDeltaDecoration[],\n\t): string[] {\n\t\tconst ret =\n\t\t\tthis.viewModel?.deltaCellDecorations(\n\t\t\t\toldDecorations,\n\t\t\t\tnewDecorations,\n\t\t\t) || [];\n\t\tthis._onDidChangeDecorations.fire();\n\t\treturn ret;\n\t}\n\n\tdeltaCellContainerClassNames(\n\t\tcellId: string,\n\t\tadded: string[],\n\t\tremoved: string[],\n\t) {\n\t\tthis._webview?.deltaCellContainerClassNames(cellId, added, removed);\n\t}\n\n\tchangeModelDecorations<T>(\n\t\tcallback: (changeAccessor: IModelDecorationsChangeAccessor) => T,\n\t): T | null {\n\t\treturn this.viewModel?.changeModelDecorations<T>(callback) || null;\n\t}\n\n\t//#endregion\n\n\t//#region View Zones\n\tchangeViewZones(\n\t\tcallback: (accessor: INotebookViewZoneChangeAccessor) => void,\n\t): void {\n\t\tthis._list.changeViewZones(callback);\n\t}\n\t//#endregion\n\n\t//#region Kernel/Execution\n\n\tprivate async _loadKernelPreloads(): Promise<void> {\n\t\tif (!this.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst { selected } = this.notebookKernelService.getMatchingKernel(\n\t\t\tthis.textModel,\n\t\t);\n\t\tif (!this._webview?.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\t\tthis._webview?.updateKernelPreloads(selected);\n\t}\n\n\tget activeKernel() {\n\t\treturn (\n\t\t\tthis.textModel &&\n\t\t\tthis.notebookKernelService.getSelectedOrSuggestedKernel(\n\t\t\t\tthis.textModel,\n\t\t\t)\n\t\t);\n\t}\n\n\tasync cancelNotebookCells(cells?: Iterable<ICellViewModel>): Promise<void> {\n\t\tif (!this.viewModel || !this.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (!cells) {\n\t\t\tcells = this.viewModel.viewCells;\n\t\t}\n\t\treturn this.notebookExecutionService.cancelNotebookCellHandles(\n\t\t\tthis.textModel,\n\t\t\tArray.from(cells).map((cell) => cell.handle),\n\t\t);\n\t}\n\n\tasync executeNotebookCells(\n\t\tcells?: Iterable<ICellViewModel>,\n\t): Promise<void> {\n\t\tif (!this.viewModel || !this.hasModel()) {\n\t\t\tthis.logService.info(\n\t\t\t\t\"notebookEditorWidget\",\n\t\t\t\t\"No NotebookViewModel, cannot execute cells\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\tif (!cells) {\n\t\t\tcells = this.viewModel.viewCells;\n\t\t}\n\t\treturn this.notebookExecutionService.executeNotebookCells(\n\t\t\tthis.textModel,\n\t\t\tArray.from(cells).map((c) => c.model),\n\t\t\tthis.scopedContextKeyService,\n\t\t);\n\t}\n\n\t//#endregion\n\n\t//#region Cell operations/layout API\n\tprivate _pendingLayouts: WeakMap<ICellViewModel, IDisposable> | null =\n\t\tnew WeakMap<ICellViewModel, IDisposable>();\n\tasync layoutNotebookCell(\n\t\tcell: ICellViewModel,\n\t\theight: number,\n\t\tcontext?: CellLayoutContext,\n\t): Promise<void> {\n\t\tthis._debug(\"layout cell\", cell.handle, height);\n\t\tconst viewIndex = this._list.getViewIndex(cell);\n\t\tif (viewIndex === undefined) {\n\t\t\t// the cell is hidden\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._pendingLayouts?.has(cell)) {\n\t\t\tthis._pendingLayouts?.get(cell)!.dispose();\n\t\t}\n\n\t\tconst deferred = new DeferredPromise<void>();\n\t\tconst doLayout = () => {\n\t\t\tif (this._isDisposed) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this.viewModel?.hasCell(cell)) {\n\t\t\t\t// Cell removed in the meantime?\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._list.getViewIndex(cell) === undefined) {\n\t\t\t\t// Cell can be hidden\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._list.elementHeight(cell) === height) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._pendingLayouts?.delete(cell);\n\n\t\t\tif (!this.hasEditorFocus()) {\n\t\t\t\t// Do not scroll inactive notebook\n\t\t\t\t// https://github.com/microsoft/vscode/issues/145340\n\t\t\t\tconst cellIndex = this.viewModel?.getCellIndex(cell);\n\t\t\t\tconst visibleRanges = this.visibleRanges;\n\t\t\t\tif (\n\t\t\t\t\tcellIndex !== undefined &&\n\t\t\t\t\tvisibleRanges &&\n\t\t\t\t\tvisibleRanges.length &&\n\t\t\t\t\tvisibleRanges[0].start === cellIndex &&\n\t\t\t\t\t// cell is partially visible\n\t\t\t\t\tthis._list.scrollTop > this.getAbsoluteTopOfElement(cell)\n\t\t\t\t) {\n\t\t\t\t\treturn this._list.updateElementHeight2(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\theight,\n\t\t\t\t\t\tMath.min(cellIndex + 1, this.getLength() - 1),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._list.updateElementHeight2(cell, height);\n\t\t\tdeferred.complete(undefined);\n\t\t};\n\n\t\tif (this._list.inRenderingTransaction) {\n\t\t\tconst layoutDisposable = DOM.scheduleAtNextAnimationFrame(\n\t\t\t\tDOM.getWindow(this.getDomNode()),\n\t\t\t\tdoLayout,\n\t\t\t);\n\n\t\t\tthis._pendingLayouts?.set(\n\t\t\t\tcell,\n\t\t\t\ttoDisposable(() => {\n\t\t\t\t\tlayoutDisposable.dispose();\n\t\t\t\t\tdeferred.complete(undefined);\n\t\t\t\t}),\n\t\t\t);\n\t\t} else {\n\t\t\tdoLayout();\n\t\t}\n\n\t\treturn deferred.p;\n\t}\n\n\tgetActiveCell() {\n\t\tconst elements = this._list.getFocusedElements();\n\n\t\tif (elements && elements.length) {\n\t\t\treturn elements[0];\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate _toggleNotebookCellSelection(\n\t\tselectedCell: ICellViewModel,\n\t\tselectFromPrevious: boolean,\n\t): void {\n\t\tconst currentSelections = this._list.getSelectedElements();\n\t\tconst isSelected = currentSelections.includes(selectedCell);\n\n\t\tconst previousSelection = selectFromPrevious\n\t\t\t? (currentSelections[currentSelections.length - 1] ?? selectedCell)\n\t\t\t: selectedCell;\n\t\tconst selectedIndex = this._list.getViewIndex(selectedCell)!;\n\t\tconst previousIndex = this._list.getViewIndex(previousSelection)!;\n\n\t\tconst cellsInSelectionRange = this.getCellsInViewRange(\n\t\t\tselectedIndex,\n\t\t\tpreviousIndex,\n\t\t);\n\t\tif (isSelected) {\n\t\t\t// Deselect\n\t\t\tthis._list.selectElements(\n\t\t\t\tcurrentSelections.filter(\n\t\t\t\t\t(current) => !cellsInSelectionRange.includes(current),\n\t\t\t\t),\n\t\t\t);\n\t\t} else {\n\t\t\t// Add to selection\n\t\t\tthis.focusElement(selectedCell);\n\t\t\tthis._list.selectElements([\n\t\t\t\t...currentSelections.filter(\n\t\t\t\t\t(current) => !cellsInSelectionRange.includes(current),\n\t\t\t\t),\n\t\t\t\t...cellsInSelectionRange,\n\t\t\t]);\n\t\t}\n\t}\n\n\tprivate getCellsInViewRange(\n\t\tfromInclusive: number,\n\t\ttoInclusive: number,\n\t): ICellViewModel[] {\n\t\tconst selectedCellsInRange: ICellViewModel[] = [];\n\t\tfor (let index = 0; index < this._list.length; ++index) {\n\t\t\tconst cell = this._list.element(index);\n\t\t\tif (cell) {\n\t\t\t\tif (\n\t\t\t\t\t(index >= fromInclusive && index <= toInclusive) ||\n\t\t\t\t\t(index >= toInclusive && index <= fromInclusive)\n\t\t\t\t) {\n\t\t\t\t\tselectedCellsInRange.push(cell);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn selectedCellsInRange;\n\t}\n\n\tasync focusNotebookCell(\n\t\tcell: ICellViewModel,\n\t\tfocusItem: \"editor\" | \"container\" | \"output\",\n\t\toptions?: IFocusNotebookCellOptions,\n\t) {\n\t\tif (this._isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tcell.focusedOutputId = undefined;\n\n\t\tif (focusItem === \"editor\") {\n\t\t\tthis.focusElement(cell);\n\t\t\tthis._list.focusView();\n\n\t\t\tcell.updateEditState(CellEditState.Editing, \"focusNotebookCell\");\n\t\t\tcell.focusMode = CellFocusMode.Editor;\n\t\t\tif (!options?.skipReveal) {\n\t\t\t\tif (typeof options?.focusEditorLine === \"number\") {\n\t\t\t\t\tthis._cursorNavMode.set(true);\n\t\t\t\t\tawait this.revealLineInViewAsync(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\toptions.focusEditorLine,\n\t\t\t\t\t);\n\t\t\t\t\tconst editor = this._renderedEditors.get(cell)!;\n\t\t\t\t\tconst focusEditorLine = options.focusEditorLine;\n\t\t\t\t\teditor?.setSelection({\n\t\t\t\t\t\tstartLineNumber: focusEditorLine,\n\t\t\t\t\t\tstartColumn: 1,\n\t\t\t\t\t\tendLineNumber: focusEditorLine,\n\t\t\t\t\t\tendColumn: 1,\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\tconst selectionsStartPosition =\n\t\t\t\t\t\tcell.getSelectionsStartPosition();\n\t\t\t\t\tif (selectionsStartPosition?.length) {\n\t\t\t\t\t\tconst firstSelectionPosition =\n\t\t\t\t\t\t\tselectionsStartPosition[0];\n\t\t\t\t\t\tawait this.revealRangeInViewAsync(\n\t\t\t\t\t\t\tcell,\n\t\t\t\t\t\t\tRange.fromPositions(\n\t\t\t\t\t\t\t\tfirstSelectionPosition,\n\t\t\t\t\t\t\t\tfirstSelectionPosition,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tawait this.revealInView(cell);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (focusItem === \"output\") {\n\t\t\tthis.focusElement(cell);\n\n\t\t\tif (!this.hasEditorFocus()) {\n\t\t\t\tthis._list.focusView();\n\t\t\t}\n\n\t\t\tif (!this._webview) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst firstOutputId = cell.outputsViewModels.find(\n\t\t\t\t(o) => o.model.alternativeOutputId,\n\t\t\t)?.model.alternativeOutputId;\n\t\t\tconst focusElementId =\n\t\t\t\toptions?.outputId ?? firstOutputId ?? cell.id;\n\t\t\tthis._webview.focusOutput(\n\t\t\t\tfocusElementId,\n\t\t\t\toptions?.altOutputId,\n\t\t\t\toptions?.outputWebviewFocused || this._webviewFocused,\n\t\t\t);\n\n\t\t\tcell.updateEditState(CellEditState.Preview, \"focusNotebookCell\");\n\t\t\tcell.focusMode = CellFocusMode.Output;\n\t\t\tcell.focusedOutputId = options?.outputId;\n\t\t\tthis._outputFocus.set(true);\n\t\t\tif (!options?.skipReveal) {\n\t\t\t\tthis.revealInCenterIfOutsideViewport(cell);\n\t\t\t}\n\t\t} else {\n\t\t\t// focus container\n\t\t\tconst itemDOM = this._list.domElementOfElement(cell);\n\t\t\tif (\n\t\t\t\titemDOM &&\n\t\t\t\titemDOM.ownerDocument.activeElement &&\n\t\t\t\titemDOM.contains(itemDOM.ownerDocument.activeElement)\n\t\t\t) {\n\t\t\t\t(itemDOM.ownerDocument.activeElement as HTMLElement).blur();\n\t\t\t}\n\n\t\t\tthis._webview?.blurOutput();\n\n\t\t\tcell.updateEditState(CellEditState.Preview, \"focusNotebookCell\");\n\t\t\tcell.focusMode = CellFocusMode.Container;\n\n\t\t\tthis.focusElement(cell);\n\t\t\tif (!options?.skipReveal) {\n\t\t\t\tif (typeof options?.focusEditorLine === \"number\") {\n\t\t\t\t\tthis._cursorNavMode.set(true);\n\t\t\t\t\tawait this.revealInView(cell);\n\t\t\t\t} else if (\n\t\t\t\t\toptions?.revealBehavior === ScrollToRevealBehavior.firstLine\n\t\t\t\t) {\n\t\t\t\t\tawait this.revealFirstLineIfOutsideViewport(cell);\n\t\t\t\t} else if (\n\t\t\t\t\toptions?.revealBehavior === ScrollToRevealBehavior.fullCell\n\t\t\t\t) {\n\t\t\t\t\tawait this.revealInView(cell);\n\t\t\t\t} else {\n\t\t\t\t\tawait this.revealInCenterIfOutsideViewport(cell);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._list.focusView();\n\t\t\tthis.updateEditorFocus();\n\t\t}\n\t}\n\n\tasync focusNextNotebookCell(\n\t\tcell: ICellViewModel,\n\t\tfocusItem: \"editor\" | \"container\" | \"output\",\n\t) {\n\t\tconst idx = this.viewModel?.getCellIndex(cell);\n\t\tif (typeof idx !== \"number\") {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newCell = this.viewModel?.cellAt(idx + 1);\n\t\tif (!newCell) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this.focusNotebookCell(newCell, focusItem);\n\t}\n\n\t//#endregion\n\n\t//#region Find\n\n\tprivate async _warmupCell(viewCell: CodeCellViewModel) {\n\t\tif (viewCell.isOutputCollapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputs = viewCell.outputsViewModels;\n\t\tfor (const output of outputs.slice(0, outputDisplayLimit)) {\n\t\t\tconst [mimeTypes, pick] = output.resolveMimeTypes(\n\t\t\t\tthis.textModel!,\n\t\t\t\tundefined,\n\t\t\t);\n\t\t\tif (\n\t\t\t\t!mimeTypes.find((mimeType) => mimeType.isTrusted) ||\n\t\t\t\tmimeTypes.length === 0\n\t\t\t) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst pickedMimeTypeRenderer = mimeTypes[pick];\n\n\t\t\tif (!pickedMimeTypeRenderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst renderer = this._notebookService.getRendererInfo(\n\t\t\t\tpickedMimeTypeRenderer.rendererId,\n\t\t\t);\n\n\t\t\tif (!renderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: IInsetRenderOutput = {\n\t\t\t\ttype: RenderOutputType.Extension,\n\t\t\t\trenderer,\n\t\t\t\tsource: output,\n\t\t\t\tmimeType: pickedMimeTypeRenderer.mimeType,\n\t\t\t};\n\t\t\tconst inset = this._webview?.insetMapping.get(result.source);\n\t\t\tif (!inset || !inset.initialized) {\n\t\t\t\tconst p = new Promise<void>((resolve) => {\n\t\t\t\t\tthis._register(\n\t\t\t\t\t\tEvent.any(\n\t\t\t\t\t\t\tthis.onDidRenderOutput,\n\t\t\t\t\t\t\tthis.onDidRemoveOutput,\n\t\t\t\t\t\t)((e) => {\n\t\t\t\t\t\t\tif (e.model === result.source.model) {\n\t\t\t\t\t\t\t\tresolve();\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}),\n\t\t\t\t\t);\n\t\t\t\t});\n\t\t\t\tthis.createOutput(viewCell, result, 0, false);\n\t\t\t\tawait p;\n\t\t\t} else {\n\t\t\t\t// request to update its visibility\n\t\t\t\tthis.createOutput(viewCell, result, 0, false);\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\t}\n\n\tprivate async _warmupAll(includeOutput: boolean) {\n\t\tif (!this.hasModel() || !this.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cells = this.viewModel.viewCells;\n\t\tconst requests = [];\n\n\t\tfor (let i = 0; i < cells.length; i++) {\n\t\t\tif (\n\t\t\t\tcells[i].cellKind === CellKind.Markup &&\n\t\t\t\t!this._webview!.markupPreviewMapping.has(cells[i].id)\n\t\t\t) {\n\t\t\t\trequests.push(this.createMarkupPreview(cells[i]));\n\t\t\t}\n\t\t}\n\n\t\tif (includeOutput && this._list) {\n\t\t\tfor (let i = 0; i < this._list.length; i++) {\n\t\t\t\tconst cell = this._list.element(i);\n\n\t\t\t\tif (cell?.cellKind === CellKind.Code) {\n\t\t\t\t\trequests.push(this._warmupCell(cell as CodeCellViewModel));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn Promise.all(requests);\n\t}\n\n\tasync find(\n\t\tquery: string,\n\t\toptions: INotebookFindOptions,\n\t\ttoken: CancellationToken,\n\t\tskipWarmup = false,\n\t\tshouldGetSearchPreviewInfo = false,\n\t\townerID?: string,\n\t): Promise<CellFindMatchWithIndex[]> {\n\t\tif (!this._notebookViewModel) {\n\t\t\treturn [];\n\t\t}\n\n\t\tif (!ownerID) {\n\t\t\townerID = this.getId();\n\t\t}\n\n\t\tconst findMatches = this._notebookViewModel\n\t\t\t.find(query, options)\n\t\t\t.filter((match) => match.length > 0);\n\n\t\tif (\n\t\t\t(!options.includeMarkupPreview && !options.includeOutput) ||\n\t\t\toptions.findScope?.findScopeType === NotebookFindScopeType.Text\n\t\t) {\n\t\t\tthis._webview?.findStop(ownerID);\n\t\t\treturn findMatches;\n\t\t}\n\n\t\t// search in webview enabled\n\n\t\tconst matchMap: { [key: string]: CellFindMatchWithIndex } = {};\n\t\tfindMatches.forEach((match) => {\n\t\t\tmatchMap[match.cell.id] = match;\n\t\t});\n\n\t\tif (this._webview) {\n\t\t\t// request all outputs to be rendered\n\t\t\t// measure perf\n\t\t\tconst start = Date.now();\n\t\t\tawait this._warmupAll(!!options.includeOutput);\n\t\t\tconst end = Date.now();\n\t\t\tthis.logService.debug(\"Find\", `Warmup time: ${end - start}ms`);\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\tlet findIds: string[] = [];\n\t\t\tif (\n\t\t\t\toptions.findScope &&\n\t\t\t\toptions.findScope.findScopeType ===\n\t\t\t\t\tNotebookFindScopeType.Cells &&\n\t\t\t\toptions.findScope.selectedCellRanges\n\t\t\t) {\n\t\t\t\tconst selectedIndexes = cellRangesToIndexes(\n\t\t\t\t\toptions.findScope.selectedCellRanges,\n\t\t\t\t);\n\t\t\t\tfindIds = selectedIndexes.map<string>(\n\t\t\t\t\t(index) =>\n\t\t\t\t\t\tthis._notebookViewModel?.viewCells[index].id ?? \"\",\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst webviewMatches = await this._webview.find(query, {\n\t\t\t\tcaseSensitive: options.caseSensitive,\n\t\t\t\twholeWord: options.wholeWord,\n\t\t\t\tincludeMarkup: !!options.includeMarkupPreview,\n\t\t\t\tincludeOutput: !!options.includeOutput,\n\t\t\t\tshouldGetSearchPreviewInfo,\n\t\t\t\townerID,\n\t\t\t\tfindIds: findIds,\n\t\t\t});\n\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// attach webview matches to model find matches\n\t\t\twebviewMatches.forEach((match) => {\n\t\t\t\tconst cell = this._notebookViewModel!.viewCells.find(\n\t\t\t\t\t(cell) => cell.id === match.cellId,\n\t\t\t\t);\n\n\t\t\t\tif (!cell) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (match.type === \"preview\") {\n\t\t\t\t\t// markup preview\n\t\t\t\t\tif (\n\t\t\t\t\t\tcell.getEditState() === CellEditState.Preview &&\n\t\t\t\t\t\t!options.includeMarkupPreview\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tcell.getEditState() === CellEditState.Editing &&\n\t\t\t\t\t\toptions.includeMarkupInput\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else if (!options.includeOutput) {\n\t\t\t\t\t// skip outputs if not included\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst exisitingMatch = matchMap[match.cellId];\n\n\t\t\t\tif (exisitingMatch) {\n\t\t\t\t\texisitingMatch.webviewMatches.push(match);\n\t\t\t\t} else {\n\t\t\t\t\tmatchMap[match.cellId] = new CellFindMatchModel(\n\t\t\t\t\t\tthis._notebookViewModel!.viewCells.find(\n\t\t\t\t\t\t\t(cell) => cell.id === match.cellId,\n\t\t\t\t\t\t)!,\n\t\t\t\t\t\tthis._notebookViewModel!.viewCells.findIndex(\n\t\t\t\t\t\t\t(cell) => cell.id === match.cellId,\n\t\t\t\t\t\t)!,\n\t\t\t\t\t\t[],\n\t\t\t\t\t\t[match],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tconst ret: CellFindMatchWithIndex[] = [];\n\t\tthis._notebookViewModel.viewCells.forEach((cell, index) => {\n\t\t\tif (matchMap[cell.id]) {\n\t\t\t\tret.push(\n\t\t\t\t\tnew CellFindMatchModel(\n\t\t\t\t\t\tcell,\n\t\t\t\t\t\tindex,\n\t\t\t\t\t\tmatchMap[cell.id].contentMatches,\n\t\t\t\t\t\tmatchMap[cell.id].webviewMatches,\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\n\t\treturn ret;\n\t}\n\n\tasync findHighlightCurrent(\n\t\tmatchIndex: number,\n\t\townerID?: string,\n\t): Promise<number> {\n\t\tif (!this._webview) {\n\t\t\treturn 0;\n\t\t}\n\n\t\treturn this._webview?.findHighlightCurrent(\n\t\t\tmatchIndex,\n\t\t\townerID ?? this.getId(),\n\t\t);\n\t}\n\n\tasync findUnHighlightCurrent(\n\t\tmatchIndex: number,\n\t\townerID?: string,\n\t): Promise<void> {\n\t\tif (!this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn this._webview?.findUnHighlightCurrent(\n\t\t\tmatchIndex,\n\t\t\townerID ?? this.getId(),\n\t\t);\n\t}\n\n\tfindStop(ownerID?: string) {\n\t\tthis._webview?.findStop(ownerID ?? this.getId());\n\t}\n\n\t//#endregion\n\n\t//#region MISC\n\n\tgetLayoutInfo(): NotebookLayoutInfo {\n\t\tif (!this._list) {\n\t\t\tthrow new Error(\"Editor is not initalized successfully\");\n\t\t}\n\n\t\tif (!this._fontInfo) {\n\t\t\tthis._generateFontInfo();\n\t\t}\n\n\t\treturn {\n\t\t\twidth: this._dimension?.width ?? 0,\n\t\t\theight: this._dimension?.height ?? 0,\n\t\t\tscrollHeight: this._list?.getScrollHeight() ?? 0,\n\t\t\tfontInfo: this._fontInfo!,\n\t\t\tstickyHeight:\n\t\t\t\tthis._notebookStickyScroll?.getCurrentStickyHeight() ?? 0,\n\t\t};\n\t}\n\n\tasync createMarkupPreview(cell: MarkupCellViewModel) {\n\t\tif (!this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._webview.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\n\t\tif (!this._webview || !this._list.webviewElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.viewModel || !this._list.viewModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.viewModel.getCellIndex(cell) === -1) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this.cellIsHidden(cell)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst webviewTop = Number.parseInt(\n\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t10,\n\t\t);\n\t\tconst top = !!webviewTop ? 0 - webviewTop : 0;\n\n\t\tconst cellTop = this._list.getCellViewScrollTop(cell);\n\t\tawait this._webview.showMarkupPreview({\n\t\t\tmime: cell.mime,\n\t\t\tcellHandle: cell.handle,\n\t\t\tcellId: cell.id,\n\t\t\tcontent: cell.getText(),\n\t\t\toffset: cellTop + top,\n\t\t\tvisible: true,\n\t\t\tmetadata: cell.metadata,\n\t\t});\n\t}\n\n\tprivate cellIsHidden(cell: ICellViewModel): boolean {\n\t\tconst modelIndex = this.viewModel!.getCellIndex(cell);\n\t\tconst foldedRanges = this.viewModel!.getHiddenRanges();\n\t\treturn foldedRanges.some(\n\t\t\t(range) => modelIndex >= range.start && modelIndex <= range.end,\n\t\t);\n\t}\n\n\tasync unhideMarkupPreviews(cells: readonly MarkupCellViewModel[]) {\n\t\tif (!this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._webview.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\n\t\tawait this._webview?.unhideMarkupPreviews(cells.map((cell) => cell.id));\n\t}\n\n\tasync hideMarkupPreviews(cells: readonly MarkupCellViewModel[]) {\n\t\tif (!this._webview || !cells.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._webview.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\n\t\tawait this._webview?.hideMarkupPreviews(cells.map((cell) => cell.id));\n\t}\n\n\tasync deleteMarkupPreviews(cells: readonly MarkupCellViewModel[]) {\n\t\tif (!this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._webview.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\n\t\tawait this._webview?.deleteMarkupPreviews(cells.map((cell) => cell.id));\n\t}\n\n\tprivate async updateSelectedMarkdownPreviews(): Promise<void> {\n\t\tif (!this._webview) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._webview.isResolved()) {\n\t\t\tawait this._resolveWebview();\n\t\t}\n\n\t\tconst selectedCells = this.getSelectionViewModels().map(\n\t\t\t(cell) => cell.id,\n\t\t);\n\n\t\t// Only show selection when there is more than 1 cell selected\n\t\tawait this._webview?.updateMarkupPreviewSelections(\n\t\t\tselectedCells.length > 1 ? selectedCells : [],\n\t\t);\n\t}\n\n\tasync createOutput(\n\t\tcell: CodeCellViewModel,\n\t\toutput: IInsetRenderOutput,\n\t\toffset: number,\n\t\tcreateWhenIdle: boolean,\n\t): Promise<void> {\n\t\tthis._insetModifyQueueByOutputId.queue(\n\t\t\toutput.source.model.outputId,\n\t\t\tasync () => {\n\t\t\t\tif (this._isDisposed || !this._webview) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this._webview.isResolved()) {\n\t\t\t\t\tawait this._resolveWebview();\n\t\t\t\t}\n\n\t\t\t\tif (!this._webview) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this._list.webviewElement) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (output.type === RenderOutputType.Extension) {\n\t\t\t\t\tthis.notebookRendererMessaging.prepare(output.renderer.id);\n\t\t\t\t}\n\n\t\t\t\tconst webviewTop = Number.parseInt(\n\t\t\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t\t\t10,\n\t\t\t\t);\n\t\t\t\tconst top = !!webviewTop ? 0 - webviewTop : 0;\n\n\t\t\t\tconst cellTop = this._list.getCellViewScrollTop(cell) + top;\n\n\t\t\t\tconst existingOutput = this._webview.insetMapping.get(\n\t\t\t\t\toutput.source,\n\t\t\t\t);\n\t\t\t\tif (\n\t\t\t\t\t!existingOutput ||\n\t\t\t\t\t(!existingOutput.renderer &&\n\t\t\t\t\t\toutput.type === RenderOutputType.Extension)\n\t\t\t\t) {\n\t\t\t\t\tif (createWhenIdle) {\n\t\t\t\t\t\tthis._webview.requestCreateOutputWhenWebviewIdle(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcellId: cell.id,\n\t\t\t\t\t\t\t\tcellHandle: cell.handle,\n\t\t\t\t\t\t\t\tcellUri: cell.uri,\n\t\t\t\t\t\t\t\texecutionId: cell.internalMetadata.executionId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toutput,\n\t\t\t\t\t\t\tcellTop,\n\t\t\t\t\t\t\toffset,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._webview.createOutput(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcellId: cell.id,\n\t\t\t\t\t\t\t\tcellHandle: cell.handle,\n\t\t\t\t\t\t\t\tcellUri: cell.uri,\n\t\t\t\t\t\t\t\texecutionId: cell.internalMetadata.executionId,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\toutput,\n\t\t\t\t\t\t\tcellTop,\n\t\t\t\t\t\t\toffset,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t} else if (\n\t\t\t\t\texistingOutput.renderer &&\n\t\t\t\t\toutput.type === RenderOutputType.Extension &&\n\t\t\t\t\texistingOutput.renderer.id !== output.renderer.id\n\t\t\t\t) {\n\t\t\t\t\t// switch mimetype\n\t\t\t\t\tthis._webview.removeInsets([output.source]);\n\t\t\t\t\tthis._webview.createOutput(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcellId: cell.id,\n\t\t\t\t\t\t\tcellHandle: cell.handle,\n\t\t\t\t\t\t\tcellUri: cell.uri,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutput,\n\t\t\t\t\t\tcellTop,\n\t\t\t\t\t\toffset,\n\t\t\t\t\t);\n\t\t\t\t} else if (\n\t\t\t\t\texistingOutput.versionId !== output.source.model.versionId\n\t\t\t\t) {\n\t\t\t\t\tthis._webview.updateOutput(\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcellId: cell.id,\n\t\t\t\t\t\t\tcellHandle: cell.handle,\n\t\t\t\t\t\t\tcellUri: cell.uri,\n\t\t\t\t\t\t\texecutionId: cell.internalMetadata.executionId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\toutput,\n\t\t\t\t\t\tcellTop,\n\t\t\t\t\t\toffset,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tconst outputIndex = cell.outputsViewModels.indexOf(\n\t\t\t\t\t\toutput.source,\n\t\t\t\t\t);\n\t\t\t\t\tconst outputOffset = cell.getOutputOffset(outputIndex);\n\t\t\t\t\tthis._webview.updateScrollTops(\n\t\t\t\t\t\t[\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tcell,\n\t\t\t\t\t\t\t\toutput: output.source,\n\t\t\t\t\t\t\t\tcellTop,\n\t\t\t\t\t\t\t\toutputOffset,\n\t\t\t\t\t\t\t\tforceDisplay: !cell.isOutputCollapsed,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tasync updateOutput(\n\t\tcell: CodeCellViewModel,\n\t\toutput: IInsetRenderOutput,\n\t\toffset: number,\n\t): Promise<void> {\n\t\tthis._insetModifyQueueByOutputId.queue(\n\t\t\toutput.source.model.outputId,\n\t\t\tasync () => {\n\t\t\t\tif (\n\t\t\t\t\tthis._isDisposed ||\n\t\t\t\t\t!this._webview ||\n\t\t\t\t\tcell.isOutputCollapsed\n\t\t\t\t) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this._webview.isResolved()) {\n\t\t\t\t\tawait this._resolveWebview();\n\t\t\t\t}\n\n\t\t\t\tif (!this._webview || !this._list.webviewElement) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (!this._webview.insetMapping.has(output.source)) {\n\t\t\t\t\treturn this.createOutput(cell, output, offset, false);\n\t\t\t\t}\n\n\t\t\t\tif (output.type === RenderOutputType.Extension) {\n\t\t\t\t\tthis.notebookRendererMessaging.prepare(output.renderer.id);\n\t\t\t\t}\n\n\t\t\t\tconst webviewTop = Number.parseInt(\n\t\t\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t\t\t10,\n\t\t\t\t);\n\t\t\t\tconst top = !!webviewTop ? 0 - webviewTop : 0;\n\n\t\t\t\tconst cellTop = this._list.getCellViewScrollTop(cell) + top;\n\t\t\t\tthis._webview.updateOutput(\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: cell.id,\n\t\t\t\t\t\tcellHandle: cell.handle,\n\t\t\t\t\t\tcellUri: cell.uri,\n\t\t\t\t\t},\n\t\t\t\t\toutput,\n\t\t\t\t\tcellTop,\n\t\t\t\t\toffset,\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\tasync copyOutputImage(cellOutput: ICellOutputViewModel): Promise<void> {\n\t\tthis._webview?.copyImage(cellOutput);\n\t}\n\n\tremoveInset(output: ICellOutputViewModel) {\n\t\tthis._insetModifyQueueByOutputId.queue(\n\t\t\toutput.model.outputId,\n\t\t\tasync () => {\n\t\t\t\tif (this._isDisposed || !this._webview) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this._webview?.isResolved()) {\n\t\t\t\t\tthis._webview.removeInsets([output]);\n\t\t\t\t}\n\n\t\t\t\tthis._onDidRemoveOutput.fire(output);\n\t\t\t},\n\t\t);\n\t}\n\n\thideInset(output: ICellOutputViewModel) {\n\t\tthis._insetModifyQueueByOutputId.queue(\n\t\t\toutput.model.outputId,\n\t\t\tasync () => {\n\t\t\t\tif (this._isDisposed || !this._webview) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (this._webview?.isResolved()) {\n\t\t\t\t\tthis._webview.hideInset(output);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\t//#region --- webview IPC ----\n\tpostMessage(message: any) {\n\t\tif (this._webview?.isResolved()) {\n\t\t\tthis._webview.postKernelMessage(message);\n\t\t}\n\t}\n\n\t//#endregion\n\n\taddClassName(className: string) {\n\t\tthis._overlayContainer.classList.add(className);\n\t}\n\n\tremoveClassName(className: string) {\n\t\tthis._overlayContainer.classList.remove(className);\n\t}\n\n\tcellAt(index: number): ICellViewModel | undefined {\n\t\treturn this.viewModel?.cellAt(index);\n\t}\n\n\tgetCellByInfo(cellInfo: ICommonCellInfo): ICellViewModel {\n\t\tconst { cellHandle } = cellInfo;\n\t\treturn this.viewModel?.viewCells.find(\n\t\t\t(vc) => vc.handle === cellHandle,\n\t\t) as CodeCellViewModel;\n\t}\n\n\tgetCellByHandle(handle: number): ICellViewModel | undefined {\n\t\treturn this.viewModel?.getCellByHandle(handle);\n\t}\n\n\tgetCellIndex(cell: ICellViewModel) {\n\t\treturn this.viewModel?.getCellIndexByHandle(cell.handle);\n\t}\n\n\tgetNextVisibleCellIndex(index: number): number | undefined {\n\t\treturn this.viewModel?.getNextVisibleCellIndex(index);\n\t}\n\n\tgetPreviousVisibleCellIndex(index: number): number | undefined {\n\t\treturn this.viewModel?.getPreviousVisibleCellIndex(index);\n\t}\n\n\tprivate _updateScrollHeight() {\n\t\tif (this._isDisposed || !this._webview?.isResolved()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._list.webviewElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst scrollHeight = this._list.scrollHeight;\n\t\tthis._webview.element.style.height = `${scrollHeight + NOTEBOOK_WEBVIEW_BOUNDARY * 2}px`;\n\n\t\tconst webviewTop = Number.parseInt(\n\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t10,\n\t\t);\n\t\tconst top = !!webviewTop ? 0 - webviewTop : 0;\n\n\t\tconst updateItems: IDisplayOutputLayoutUpdateRequest[] = [];\n\t\tconst removedItems: ICellOutputViewModel[] = [];\n\t\tthis._webview?.insetMapping.forEach((value, key) => {\n\t\t\tconst cell = this.viewModel?.getCellByHandle(\n\t\t\t\tvalue.cellInfo.cellHandle,\n\t\t\t);\n\t\t\tif (!cell || !(cell instanceof CodeCellViewModel)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.viewModel?.viewCells.find(\n\t\t\t\t(cell) => cell.handle === value.cellInfo.cellHandle,\n\t\t\t);\n\t\t\tconst viewIndex = this._list.getViewIndex(cell);\n\n\t\t\tif (viewIndex === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (cell.outputsViewModels.indexOf(key) < 0) {\n\t\t\t\t// output is already gone\n\t\t\t\tremovedItems.push(key);\n\t\t\t}\n\n\t\t\tconst cellTop = this._list.getCellViewScrollTop(cell);\n\t\t\tconst outputIndex = cell.outputsViewModels.indexOf(key);\n\t\t\tconst outputOffset = cell.getOutputOffset(outputIndex);\n\t\t\tupdateItems.push({\n\t\t\t\tcell,\n\t\t\t\toutput: key,\n\t\t\t\tcellTop: cellTop + top,\n\t\t\t\toutputOffset,\n\t\t\t\tforceDisplay: false,\n\t\t\t});\n\t\t});\n\n\t\tthis._webview.removeInsets(removedItems);\n\n\t\tconst markdownUpdateItems: { id: string; top: number }[] = [];\n\t\tfor (const cellId of this._webview.markupPreviewMapping.keys()) {\n\t\t\tconst cell = this.viewModel?.viewCells.find(\n\t\t\t\t(cell) => cell.id === cellId,\n\t\t\t);\n\t\t\tif (cell) {\n\t\t\t\tconst cellTop = this._list.getCellViewScrollTop(cell);\n\t\t\t\t// markdownUpdateItems.push({ id: cellId, top: cellTop });\n\t\t\t\tmarkdownUpdateItems.push({ id: cellId, top: cellTop + top });\n\t\t\t}\n\t\t}\n\n\t\tif (markdownUpdateItems.length || updateItems.length) {\n\t\t\tthis._debug(\n\t\t\t\t\"_list.onDidChangeContentHeight/markdown\",\n\t\t\t\tmarkdownUpdateItems,\n\t\t\t);\n\t\t\tthis._webview?.updateScrollTops(updateItems, markdownUpdateItems);\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region BacklayerWebview delegate\n\tprivate _updateOutputHeight(\n\t\tcellInfo: ICommonCellInfo,\n\t\toutput: ICellOutputViewModel,\n\t\toutputHeight: number,\n\t\tisInit: boolean,\n\t\tsource?: string,\n\t): void {\n\t\tconst cell = this.viewModel?.viewCells.find(\n\t\t\t(vc) => vc.handle === cellInfo.cellHandle,\n\t\t);\n\t\tif (cell && cell instanceof CodeCellViewModel) {\n\t\t\tconst outputIndex = cell.outputsViewModels.indexOf(output);\n\t\t\tthis._debug(\"update cell output\", cell.handle, outputHeight);\n\t\t\tcell.updateOutputHeight(outputIndex, outputHeight, source);\n\t\t\tthis.layoutNotebookCell(cell, cell.layoutInfo.totalHeight);\n\n\t\t\tif (isInit) {\n\t\t\t\tthis._onDidRenderOutput.fire(output);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate readonly _pendingOutputHeightAcks = new Map<\n\t\t/* outputId */ string,\n\t\tIAckOutputHeight\n\t>();\n\n\tprivate _scheduleOutputHeightAck(\n\t\tcellInfo: ICommonCellInfo,\n\t\toutputId: string,\n\t\theight: number,\n\t) {\n\t\tconst wasEmpty = this._pendingOutputHeightAcks.size === 0;\n\t\tthis._pendingOutputHeightAcks.set(outputId, {\n\t\t\tcellId: cellInfo.cellId,\n\t\t\toutputId,\n\t\t\theight,\n\t\t});\n\n\t\tif (wasEmpty) {\n\t\t\tDOM.scheduleAtNextAnimationFrame(\n\t\t\t\tDOM.getWindow(this.getDomNode()),\n\t\t\t\t() => {\n\t\t\t\t\tthis._debug(\"ack height\");\n\t\t\t\t\tthis._updateScrollHeight();\n\n\t\t\t\t\tthis._webview?.ackHeight([\n\t\t\t\t\t\t...this._pendingOutputHeightAcks.values(),\n\t\t\t\t\t]);\n\n\t\t\t\t\tthis._pendingOutputHeightAcks.clear();\n\t\t\t\t},\n\t\t\t\t-1,\n\t\t\t); // -1 priority because this depends on calls to layoutNotebookCell, and that may be called multiple times before this runs\n\t\t}\n\t}\n\n\tprivate _getCellById(cellId: string): ICellViewModel | undefined {\n\t\treturn this.viewModel?.viewCells.find((vc) => vc.id === cellId);\n\t}\n\n\tprivate _updateMarkupCellHeight(\n\t\tcellId: string,\n\t\theight: number,\n\t\tisInit: boolean,\n\t) {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell && cell instanceof MarkupCellViewModel) {\n\t\t\tconst { bottomToolbarGap } =\n\t\t\t\tthis._notebookOptions.computeBottomToolbarDimensions(\n\t\t\t\t\tthis.viewModel?.viewType,\n\t\t\t\t);\n\t\t\tthis._debug(\n\t\t\t\t\"updateMarkdownCellHeight\",\n\t\t\t\tcell.handle,\n\t\t\t\theight + bottomToolbarGap,\n\t\t\t\tisInit,\n\t\t\t);\n\t\t\tcell.renderedMarkdownHeight = height;\n\t\t}\n\t}\n\n\tprivate _setMarkupCellEditState(\n\t\tcellId: string,\n\t\teditState: CellEditState,\n\t): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\tthis.revealInView(cell);\n\t\t\tcell.updateEditState(editState, \"setMarkdownCellEditState\");\n\t\t}\n\t}\n\n\tprivate _didStartDragMarkupCell(\n\t\tcellId: string,\n\t\tevent: { dragOffsetY: number },\n\t): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\tconst webviewOffset = this._list.webviewElement\n\t\t\t\t? -Number.parseInt(\n\t\t\t\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t\t\t\t10,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\t\t\tthis._dndController?.startExplicitDrag(\n\t\t\t\tcell,\n\t\t\t\tevent.dragOffsetY - webviewOffset,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate _didDragMarkupCell(\n\t\tcellId: string,\n\t\tevent: { dragOffsetY: number },\n\t): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\tconst webviewOffset = this._list.webviewElement\n\t\t\t\t? -Number.parseInt(\n\t\t\t\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t\t\t\t10,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\t\t\tthis._dndController?.explicitDrag(\n\t\t\t\tcell,\n\t\t\t\tevent.dragOffsetY - webviewOffset,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate _didDropMarkupCell(\n\t\tcellId: string,\n\t\tevent: { dragOffsetY: number; ctrlKey: boolean; altKey: boolean },\n\t): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\tconst webviewOffset = this._list.webviewElement\n\t\t\t\t? -Number.parseInt(\n\t\t\t\t\t\tthis._list.webviewElement.domNode.style.top,\n\t\t\t\t\t\t10,\n\t\t\t\t\t)\n\t\t\t\t: 0;\n\t\t\tevent.dragOffsetY -= webviewOffset;\n\t\t\tthis._dndController?.explicitDrop(cell, event);\n\t\t}\n\t}\n\n\tprivate _didEndDragMarkupCell(cellId: string): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell instanceof MarkupCellViewModel) {\n\t\t\tthis._dndController?.endExplicitDrag(cell);\n\t\t}\n\t}\n\n\tprivate _didResizeOutput(cellId: string): void {\n\t\tconst cell = this._getCellById(cellId);\n\t\tif (cell) {\n\t\t\tthis._onDidResizeOutputEmitter.fire(cell);\n\t\t}\n\t}\n\n\tprivate _updatePerformanceMetadata(\n\t\tcellId: string,\n\t\texecutionId: string,\n\t\tduration: number,\n\t\trendererId: string,\n\t): void {\n\t\tif (!this.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = this._getCellById(cellId);\n\t\tconst cellIndex = cell ? this.getCellIndex(cell) : undefined;\n\t\tif (\n\t\t\tcell?.internalMetadata.executionId === executionId &&\n\t\t\tcellIndex !== undefined\n\t\t) {\n\t\t\tconst renderDurationMap =\n\t\t\t\tcell.internalMetadata.renderDuration || {};\n\t\t\trenderDurationMap[rendererId] =\n\t\t\t\t(renderDurationMap[rendererId] ?? 0) + duration;\n\n\t\t\tthis.textModel.applyEdits(\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\t\t\t\tindex: cellIndex,\n\t\t\t\t\t\tinternalMetadata: {\n\t\t\t\t\t\t\texecutionId: executionId,\n\t\t\t\t\t\t\trenderDuration: renderDurationMap,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t\ttrue,\n\t\t\t\tundefined,\n\t\t\t\t() => undefined,\n\t\t\t\tundefined,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t}\n\t}\n\n\t//#endregion\n\n\t//#region Editor Contributions\n\tgetContribution<T extends INotebookEditorContribution>(id: string): T {\n\t\treturn <T>(this._contributions.get(id) || null);\n\t}\n\n\t//#endregion\n\n\toverride dispose() {\n\t\tthis._isDisposed = true;\n\t\t// dispose webview first\n\t\tthis._webview?.dispose();\n\t\tthis._webview = null;\n\n\t\tthis.notebookEditorService.removeNotebookEditor(this);\n\t\tdispose(this._contributions.values());\n\t\tthis._contributions.clear();\n\n\t\tthis._localStore.clear();\n\t\tdispose(this._localCellStateListeners);\n\t\tthis._list.dispose();\n\t\tthis._listTopCellToolbar?.dispose();\n\n\t\tthis._overlayContainer.remove();\n\t\tthis.viewModel?.dispose();\n\n\t\tthis._renderedEditors.clear();\n\t\tthis._baseCellEditorOptions.forEach((v) => v.dispose());\n\t\tthis._baseCellEditorOptions.clear();\n\n\t\tthis._notebookOverviewRulerContainer.remove();\n\n\t\tsuper.dispose();\n\n\t\t// unref\n\t\tthis._webview = null;\n\t\tthis._webviewResolvePromise = null;\n\t\tthis._webviewTransparentCover = null;\n\t\tthis._dndController = null;\n\t\tthis._listTopCellToolbar = null;\n\t\tthis._notebookViewModel = undefined;\n\t\tthis._cellContextKeyManager = null;\n\t\tthis._notebookTopToolbar = null!;\n\t\tthis._list = null!;\n\t\tthis._listViewInfoAccessor = null!;\n\t\tthis._pendingLayouts = null;\n\t\tthis._listDelegate = null;\n\t}\n\n\ttoJSON(): { notebookUri: URI | undefined } {\n\t\treturn {\n\t\t\tnotebookUri: this.viewModel?.uri,\n\t\t};\n\t}\n}\n\nregisterZIndex(ZIndex.Base, 5, \"notebook-progress-bar\");\nregisterZIndex(ZIndex.Base, 10, \"notebook-list-insertion-indicator\");\nregisterZIndex(ZIndex.Base, 20, \"notebook-cell-editor-outline\");\nregisterZIndex(ZIndex.Base, 25, \"notebook-scrollbar\");\nregisterZIndex(ZIndex.Base, 26, \"notebook-cell-status\");\nregisterZIndex(ZIndex.Base, 26, \"notebook-folding-indicator\");\nregisterZIndex(ZIndex.Base, 27, \"notebook-output\");\nregisterZIndex(ZIndex.Base, 28, \"notebook-cell-bottom-toolbar-container\");\nregisterZIndex(ZIndex.Base, 29, \"notebook-run-button-container\");\nregisterZIndex(ZIndex.Base, 29, \"notebook-input-collapse-condicon\");\nregisterZIndex(ZIndex.Base, 30, \"notebook-cell-output-toolbar\");\nregisterZIndex(ZIndex.Sash, 1, \"notebook-cell-expand-part-button\");\nregisterZIndex(ZIndex.Sash, 2, \"notebook-cell-toolbar\");\nregisterZIndex(ZIndex.Sash, 3, \"notebook-cell-toolbar-dropdown-active\");\n\nexport const notebookCellBorder = registerColor(\n\t\"notebook.cellBorderColor\",\n\t{\n\t\tdark: transparent(listInactiveSelectionBackground, 1),\n\t\tlight: transparent(listInactiveSelectionBackground, 1),\n\t\thcDark: PANEL_BORDER,\n\t\thcLight: PANEL_BORDER,\n\t},\n\tnls.localize(\n\t\t\"notebook.cellBorderColor\",\n\t\t\"The border color for notebook cells.\",\n\t),\n);\n\nexport const focusedEditorBorderColor = registerColor(\n\t\"notebook.focusedEditorBorder\",\n\tfocusBorder,\n\tnls.localize(\n\t\t\"notebook.focusedEditorBorder\",\n\t\t\"The color of the notebook cell editor border.\",\n\t),\n);\n\nexport const cellStatusIconSuccess = registerColor(\n\t\"notebookStatusSuccessIcon.foreground\",\n\tdebugIconStartForeground,\n\tnls.localize(\n\t\t\"notebookStatusSuccessIcon.foreground\",\n\t\t\"The error icon color of notebook cells in the cell status bar.\",\n\t),\n);\n\nexport const runningCellRulerDecorationColor = registerColor(\n\t\"notebookEditorOverviewRuler.runningCellForeground\",\n\tdebugIconStartForeground,\n\tnls.localize(\n\t\t\"notebookEditorOverviewRuler.runningCellForeground\",\n\t\t\"The color of the running cell decoration in the notebook editor overview ruler.\",\n\t),\n);\n\nexport const cellStatusIconError = registerColor(\n\t\"notebookStatusErrorIcon.foreground\",\n\terrorForeground,\n\tnls.localize(\n\t\t\"notebookStatusErrorIcon.foreground\",\n\t\t\"The error icon color of notebook cells in the cell status bar.\",\n\t),\n);\n\nexport const cellStatusIconRunning = registerColor(\n\t\"notebookStatusRunningIcon.foreground\",\n\tforeground,\n\tnls.localize(\n\t\t\"notebookStatusRunningIcon.foreground\",\n\t\t\"The running icon color of notebook cells in the cell status bar.\",\n\t),\n);\n\nexport const notebookOutputContainerBorderColor = registerColor(\n\t\"notebook.outputContainerBorderColor\",\n\tnull,\n\tnls.localize(\n\t\t\"notebook.outputContainerBorderColor\",\n\t\t\"The border color of the notebook output container.\",\n\t),\n);\n\nexport const notebookOutputContainerColor = registerColor(\n\t\"notebook.outputContainerBackgroundColor\",\n\tnull,\n\tnls.localize(\n\t\t\"notebook.outputContainerBackgroundColor\",\n\t\t\"The color of the notebook output container background.\",\n\t),\n);\n\n// TODO@rebornix currently also used for toolbar border, if we keep all of this, pick a generic name\nexport const CELL_TOOLBAR_SEPERATOR = registerColor(\n\t\"notebook.cellToolbarSeparator\",\n\t{\n\t\tdark: Color.fromHex(\"#808080\").transparent(0.35),\n\t\tlight: Color.fromHex(\"#808080\").transparent(0.35),\n\t\thcDark: contrastBorder,\n\t\thcLight: contrastBorder,\n\t},\n\tnls.localize(\n\t\t\"notebook.cellToolbarSeparator\",\n\t\t\"The color of the separator in the cell bottom toolbar\",\n\t),\n);\n\nexport const focusedCellBackground = registerColor(\n\t\"notebook.focusedCellBackground\",\n\tnull,\n\tnls.localize(\n\t\t\"focusedCellBackground\",\n\t\t\"The background color of a cell when the cell is focused.\",\n\t),\n);\n\nexport const selectedCellBackground = registerColor(\n\t\"notebook.selectedCellBackground\",\n\t{\n\t\tdark: listInactiveSelectionBackground,\n\t\tlight: listInactiveSelectionBackground,\n\t\thcDark: null,\n\t\thcLight: null,\n\t},\n\tnls.localize(\n\t\t\"selectedCellBackground\",\n\t\t\"The background color of a cell when the cell is selected.\",\n\t),\n);\n\nexport const cellHoverBackground = registerColor(\n\t\"notebook.cellHoverBackground\",\n\t{\n\t\tdark: transparent(focusedCellBackground, 0.5),\n\t\tlight: transparent(focusedCellBackground, 0.7),\n\t\thcDark: null,\n\t\thcLight: null,\n\t},\n\tnls.localize(\n\t\t\"notebook.cellHoverBackground\",\n\t\t\"The background color of a cell when the cell is hovered.\",\n\t),\n);\n\nexport const selectedCellBorder = registerColor(\n\t\"notebook.selectedCellBorder\",\n\t{\n\t\tdark: notebookCellBorder,\n\t\tlight: notebookCellBorder,\n\t\thcDark: contrastBorder,\n\t\thcLight: contrastBorder,\n\t},\n\tnls.localize(\n\t\t\"notebook.selectedCellBorder\",\n\t\t\"The color of the cell's top and bottom border when the cell is selected but not focused.\",\n\t),\n);\n\nexport const inactiveSelectedCellBorder = registerColor(\n\t\"notebook.inactiveSelectedCellBorder\",\n\t{\n\t\tdark: null,\n\t\tlight: null,\n\t\thcDark: focusBorder,\n\t\thcLight: focusBorder,\n\t},\n\tnls.localize(\n\t\t\"notebook.inactiveSelectedCellBorder\",\n\t\t\"The color of the cell's borders when multiple cells are selected.\",\n\t),\n);\n\nexport const focusedCellBorder = registerColor(\n\t\"notebook.focusedCellBorder\",\n\tfocusBorder,\n\tnls.localize(\n\t\t\"notebook.focusedCellBorder\",\n\t\t\"The color of the cell's focus indicator borders when the cell is focused.\",\n\t),\n);\n\nexport const inactiveFocusedCellBorder = registerColor(\n\t\"notebook.inactiveFocusedCellBorder\",\n\tnotebookCellBorder,\n\tnls.localize(\n\t\t\"notebook.inactiveFocusedCellBorder\",\n\t\t\"The color of the cell's top and bottom border when a cell is focused while the primary focus is outside of the editor.\",\n\t),\n);\n\nexport const cellStatusBarItemHover = registerColor(\n\t\"notebook.cellStatusBarItemHoverBackground\",\n\t{\n\t\tlight: new Color(new RGBA(0, 0, 0, 0.08)),\n\t\tdark: new Color(new RGBA(255, 255, 255, 0.15)),\n\t\thcDark: new Color(new RGBA(255, 255, 255, 0.15)),\n\t\thcLight: new Color(new RGBA(0, 0, 0, 0.08)),\n\t},\n\tnls.localize(\n\t\t\"notebook.cellStatusBarItemHoverBackground\",\n\t\t\"The background color of notebook cell status bar items.\",\n\t),\n);\n\nexport const cellInsertionIndicator = registerColor(\n\t\"notebook.cellInsertionIndicator\",\n\tfocusBorder,\n\tnls.localize(\n\t\t\"notebook.cellInsertionIndicator\",\n\t\t\"The color of the notebook cell insertion indicator.\",\n\t),\n);\n\nexport const listScrollbarSliderBackground = registerColor(\n\t\"notebookScrollbarSlider.background\",\n\tscrollbarSliderBackground,\n\tnls.localize(\n\t\t\"notebookScrollbarSliderBackground\",\n\t\t\"Notebook scrollbar slider background color.\",\n\t),\n);\n\nexport const listScrollbarSliderHoverBackground = registerColor(\n\t\"notebookScrollbarSlider.hoverBackground\",\n\tscrollbarSliderHoverBackground,\n\tnls.localize(\n\t\t\"notebookScrollbarSliderHoverBackground\",\n\t\t\"Notebook scrollbar slider background color when hovering.\",\n\t),\n);\n\nexport const listScrollbarSliderActiveBackground = registerColor(\n\t\"notebookScrollbarSlider.activeBackground\",\n\tscrollbarSliderActiveBackground,\n\tnls.localize(\n\t\t\"notebookScrollbarSliderActiveBackground\",\n\t\t\"Notebook scrollbar slider background color when clicked on.\",\n\t),\n);\n\nexport const cellSymbolHighlight = registerColor(\n\t\"notebook.symbolHighlightBackground\",\n\t{\n\t\tdark: Color.fromHex(\"#ffffff0b\"),\n\t\tlight: Color.fromHex(\"#fdff0033\"),\n\t\thcDark: null,\n\t\thcLight: null,\n\t},\n\tnls.localize(\n\t\t\"notebook.symbolHighlightBackground\",\n\t\t\"Background color of highlighted cell\",\n\t),\n);\n\nexport const cellEditorBackground = registerColor(\n\t\"notebook.cellEditorBackground\",\n\t{\n\t\tlight: SIDE_BAR_BACKGROUND,\n\t\tdark: SIDE_BAR_BACKGROUND,\n\t\thcDark: null,\n\t\thcLight: null,\n\t},\n\tnls.localize(\n\t\t\"notebook.cellEditorBackground\",\n\t\t\"Cell editor background color.\",\n\t),\n);\n\nconst notebookEditorBackground = registerColor(\n\t\"notebook.editorBackground\",\n\t{\n\t\tlight: EDITOR_PANE_BACKGROUND,\n\t\tdark: EDITOR_PANE_BACKGROUND,\n\t\thcDark: null,\n\t\thcLight: null,\n\t},\n\tnls.localize(\"notebook.editorBackground\", \"Notebook background color.\"),\n);\n"],
  "mappings": ";;;;;;;;;;;;AAKA,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,OAAO;AACP,YAAY,SAAS;AAKrB,SAAS,kBAAkB;AAE3B,SAAS,kBAAkB;AAC3B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAEP,SAAS,OAAO,YAAY;AAC5B,SAAS,yBAAyB;AAClC,SAAS,SAAS,aAAa;AAC/B;AAAA,EACC;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,eAAe;AACxB,SAAS,mBAAmB;AAC5B,SAAS,SAAS,eAAe;AAEjC,SAAS,oBAAoB;AAC7B,SAAS,wBAAwB;AAEjC,SAAS,gCAAgC;AAEzC;AAAA,EACC;AAAA,OAEM;AAEP,SAAS,aAAa;AAEtB,SAAS,2BAA2B;AACpC,SAAS,gCAAgC;AACzC,SAAS,yBAAyB;AAClC,YAAY,SAAS;AACrB,SAAS,cAAc;AACvB,SAAS,6BAA6B;AACtC;AAAA,EAEC;AAAA,EACA;AAAA,OACM;AACP,SAAS,2BAA2B;AACpC,SAAS,6BAA6B;AACtC,SAAS,yBAAyB;AAClC,SAAS,0BAA0B;AACnC,SAAS,sBAAsB;AAC/B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,OAEM;AACP,SAAS,yBAAyB;AAClC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,+BAA+B;AACxC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,4BAA4B;AACrC,SAAS,uCAAuC;AAChD,SAAS,gCAAgC;AACzC,SAAS,oDAAoD;AAG7D;AAAA,EACC;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,iCAAiC;AAC1C,SAAS,sCAAsC;AAC/C,SAAS,8BAA8B;AACvC,SAAS,+BAA+B;AAExC;AAAA,EAEC;AAAA,OACM;AACP,SAAS,yCAAyC;AAClD,SAAS,wBAAwB;AACjC,SAAS,0BAA0B;AACnC,SAAS,qCAAqC;AAC9C;AAAA,EACC;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,EAsBA;AAAA,EACA;AAAA,OACM;AACP,SAAS,wCAAwC;AACjD,SAAS,qBAAqB;AAC9B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP;AAAA,EAEC;AAAA,OAEM;AACP,SAAS,8BAA8B;AACvC,SAAS,6BAA6B;AACtC,SAAS,iCAAiC;AAC1C,SAAS,8BAA8B;AACvC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AAEP,SAAS,wBAAwB;AACjC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AAKP,SAAS,6BAA6B;AACtC;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,+BAA+B;AACxC,SAAS,2BAA2B;AACpC;AAAA,EAEC;AAAA,OACM;AACP,SAAS,mBAAmB;AAC5B,SAAS,4BAA4B;AACrC,SAAS,sCAAsC;AAC/C,SAAS,iCAAiC;AAC1C,SAAS,iCAAiC;AAC1C,SAAS,6BAA6B;AACtC,SAAS,0BAA0B;AAEnC,MAAM,IAAI,IAAI;AAEP,SAAS,oCAAoE;AAEnF,QAAM,oBAAoB;AAAA,IACzB;AAAA,IACA,wBAAwB;AAAA,IACxB;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACD;AACA,QAAM,gBACL,yBAAyB,uBAAuB,EAAE;AAAA,IACjD,CAAC,MAAM,kBAAkB,QAAQ,EAAE,EAAE,MAAM;AAAA,EAC5C;AAED,SAAO;AAAA,IACN,SAAS;AAAA,MACR,iBAAiB,OAAO;AAAA,MACxB,kBAAkB,OAAO;AAAA,MACzB,mBAAmB,OAAO;AAAA,MAC1B,mBAAmB,OAAO;AAAA,MAC1B,sBAAsB,OAAO;AAAA,MAC7B,oBAAoB,OAAO;AAAA,MAC3B,oBAAoB,OAAO;AAAA,IAC5B;AAAA,IACA,yBAAyB;AAAA,EAC1B;AACD;AA7BgB;AA+BT,IAAM,uBAAN,cACE,WAET;AAAA,EA+NC,YACU,iBACT,WACuB,sBACD,qBAEL,2BAEA,uBAEA,uBACkB,kBAElB,sBACG,mBACa,eAEhB,oBACmB,kBAEnB,0BAEA,+BAET,uBAES,YAEA,mBAChB;AACD,UAAM;AA7BG;AAKQ;AAEA;AAEA;AACkB;AAElB;AAEgB;AAEhB;AACmB;AAEnB;AAEA;AAET;AAES;AAEA;AAIjB,SAAK,aAAa;AAElB,SAAK,aAAa,gBAAgB,cAAc;AAChD,SAAK,YAAY,gBAAgB,cAAc;AAC/C,SAAK,UAAU,gBAAgB,WAAW;AAE1C,SAAK,oBAAoB,SAAS,cAAc,KAAK;AACrD,SAAK,0BAA0B,KAAK;AAAA,MACnC,kBAAkB,aAAa,KAAK,iBAAiB;AAAA,IACtD;AACA,SAAK,uBAAuB,KAAK;AAAA,MAChC,qBAAqB;AAAA,QACpB,IAAI,kBAAkB;AAAA,UACrB;AAAA,UACA,KAAK;AAAA,QACN,CAAC;AAAA,MACF;AAAA,IACD;AAEA,SAAK,mBACJ,gBAAgB,WAChB,KAAK,qBAAqB;AAAA,MACzB;AAAA,MACA,KAAK,iBAAiB,cAAc;AAAA,MACpC,KAAK;AAAA,MACL;AAAA,IACD;AACD,SAAK,UAAU,KAAK,gBAAgB;AACpC,UAAM,kBAAkB,KAAK,UAAU,IAAI,wBAAwB,CAAC;AACpE,SAAK,eAAe,IAAI;AAAA,MACvB,KAAK;AAAA,MACL;AAAA,MACA,CAAC,aAAa,KAAK,yBAAyB,QAAQ;AAAA,IACrD;AACA,SAAK;AAAA,MACJ,KAAK,aAAa,gBAAgB,kBAAkB,MAAM;AACzD,aAAK,mBAAmB,KAAK;AAAA,MAC9B,CAAC;AAAA,IACF;AACA,SAAK;AAAA,MACJ,KAAK,aAAa,gBAAgB,qBAAqB,CAAC,MAAM;AAC7D,aAAK,sBAAsB,KAAK,CAAC;AAAA,MAClC,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,iBAAiB,2BAA2B,MAAM;AACjD,aAAK,uBAAuB;AAAA,MAC7B,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,sBAAsB,6BAA6B,CAAC,MAAM;AACzD,YAAI,QAAQ,EAAE,UAAU,KAAK,WAAW,GAAG,GAAG;AAC7C,eAAK,oBAAoB;AACzB,eAAK,yBAAyB,KAAK;AAAA,QACpC;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,wBACJ,KAAK,qBAAqB;AAAA,MACzB;AAAA,IACD;AAED,SAAK;AAAA,MACJ,KAAK,qBAAqB,yBAAyB,CAAC,MAAM;AACzD,YAAI,EAAE,qBAAqB,6BAA6B,GAAG;AAC1D,eAAK,wBACJ,KAAK,qBAAqB;AAAA,YACzB;AAAA,UACD;AACD,cAAI,KAAK,cAAc,KAAK,YAAY;AACvC,iBAAK,OAAO,KAAK,UAAU;AAAA,UAC5B;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,iBAAiB,mBAAmB,CAAC,MAAM;AAC/C,YACC,EAAE,2BACF,EAAE,uBACF,EAAE,wBACD;AACD,eAAK,gCAAgC;AAAA,QACtC;AAEA,YAAI,EAAE,YAAY;AACjB,eAAK,kBAAkB;AAAA,QACxB;AAEA,YACC,EAAE,eACF,EAAE,kBACF,EAAE,yBACF,EAAE,uBACF,EAAE,sBACF,EAAE,YACF,EAAE,kBACF,EAAE,sBACF,EAAE,cACF,EAAE,0BACF,EAAE,kBACF,EAAE,oBACF,EAAE,oBACF,EAAE,kBACF,EAAE,mBACF,EAAE,0BACF,EAAE,cACD;AACD,eAAK,eAAe,OAAO;AAC3B,eAAK,oBAAoB;AACzB,eAAK,UAAU,cAAc;AAAA,YAC5B,GAAG,KAAK,gBAAgB,sBAAsB;AAAA,YAC9C,YAAY,KAAK,oBAAoB;AAAA,UACtC,CAAC;AAAA,QACF;AAEA,YAAI,KAAK,cAAc,KAAK,YAAY;AACvC,eAAK,OAAO,KAAK,UAAU;AAAA,QAC5B;AAAA,MACD,CAAC;AAAA,IACF;AAEA,UAAM,YAAY,gBAAgB,aAC/B,KAAK,cAAc,aAAa,gBAAgB,UAAU,IAC1D,KAAK,cAAc;AACtB,SAAK;AAAA,MACJ,oBAAoB,QAAQ,SAAS,EAAE,YAAY,CAAC,MAAM;AACzD,YAAI,CAAC,KAAK,kBAAkB,CAAC,KAAK,YAAY;AAC7C;AAAA,QACD;AAEA,aAAK,oBAAoB,KAAK,gBAAgB,KAAK,UAAU;AAC7D,aAAK;AAAA,UACJ,KAAK;AAAA,UACL,KAAK;AAAA,QACN;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,sBAAsB,kBAAkB,IAAI;AAEjD,UAAM,KAAK,aAAa;AACxB,SAAK,kBAAkB,KAAK,YAAY,EAAE;AAC1C,SAAK,kBAAkB,YAAY;AACnC,SAAK,kBAAkB,UAAU,IAAI,iBAAiB;AACtD,SAAK,kBAAkB,QAAQ;AAC/B,SAAK,kBAAkB,MAAM,aAAa;AAE1C,cAAU,YAAY,KAAK,iBAAiB;AAE5C,SAAK,YAAY,KAAK,iBAAiB;AACvC,SAAK,kBAAkB;AACvB,SAAK,aAAa;AAClB,SAAK,eAAe,wBAAwB;AAAA,MAC3C,KAAK;AAAA,IACN;AACA,SAAK,eAAe,wBAAwB;AAAA,MAC3C,KAAK;AAAA,IACN;AACA,SAAK,oBAAoB,8BAA8B;AAAA,MACtD,KAAK;AAAA,IACN;AACA,SAAK,kBAAkB,yBAAyB;AAAA,MAC/C,KAAK;AAAA,IACN;AACA,SAAK,iBAAiB,gCAAgC;AAAA,MACrD,KAAK;AAAA,IACN;AAEA,QAAI;AAAA,MACH;AAAA,MACA;AAAA,IACD,EACE,OAAO,KAAK,uBAAuB,EACnC,IAAI,IAAI;AAEV,SAAK,gBAAgB,IAAI,CAAC,gBAAgB,UAAU;AAEpD,QAAI;AACJ,QAAI,MAAM,QAAQ,KAAK,gBAAgB,aAAa,GAAG;AACtD,sBAAgB,KAAK,gBAAgB;AAAA,IACtC,OAAO;AACN,sBACC,iCAAiC,uBAAuB;AAAA,IAC1D;AACA,eAAW,QAAQ,eAAe;AACjC,UAAI;AACJ,UAAI;AACH,uBAAe,KAAK,qBAAqB;AAAA,UACxC,KAAK;AAAA,UACL;AAAA,QACD;AAAA,MACD,SAAS,KAAK;AACb,0BAAkB,GAAG;AAAA,MACtB;AACA,UAAI,cAAc;AACjB,YAAI,KAAK,eAAe,IAAI,KAAK,EAAE,GAAG;AACrC,uBAAa,QAAQ;AACrB,gBAAM,IAAI,MAAM,4CAA4C,KAAK,EAAE,GAAG;AAAA,QACvE,OAAO;AACN,eAAK,eAAe,IAAI,KAAK,IAAI,YAAY;AAAA,QAC9C;AAAA,MACD;AAAA,IACD;AAEA,SAAK,gCAAgC;AAAA,EACtC;AAAA,EArtBD,OA6PA;AAAA;AAAA;AAAA;AAAA,EAEkB,wBAAwB,KAAK;AAAA,IAC7C,IAAI,QAAuC;AAAA,EAC5C;AAAA,EACS,uBAAuB,KAAK,sBAAsB;AAAA,EAC1C,wBAAwB,KAAK;AAAA,IAC7C,IAAI,QAAuC;AAAA,EAC5C;AAAA,EACS,uBACR,KAAK,sBAAsB;AAAA,EACX,qBAAqB,KAAK;AAAA,IAC1C,IAAI,QAAuC;AAAA,EAC5C;AAAA,EACS,oBACR,KAAK,mBAAmB;AAAA,EACR,oBAAoB,KAAK;AAAA,IACzC,IAAI,QAAuC;AAAA,EAC5C;AAAA,EACS,mBACR,KAAK,kBAAkB;AAAA,EACP,wBAAwB,KAAK;AAAA,IAC7C,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,uBACR,KAAK,sBAAsB;AAAA,EACX,sBAAsB,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAChE,qBAAkC,KAAK,oBAAoB;AAAA,EACnD,0BAA0B,KAAK;AAAA,IAC/C,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,yBACR,KAAK,wBAAwB;AAAA,EACb,eAAe,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EACzD,cAA2B,KAAK,aAAa;AAAA,EACrC,qBAAqB,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC/D,oBAAiC,KAAK,mBAAmB;AAAA,EACjD,yBAAyB,KAAK;AAAA,IAC9C,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,wBACR,KAAK,uBAAuB;AAAA,EACZ,oBAAoB,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC9D,mBAAgC,KAAK,kBAAkB;AAAA,EAC/C,wBAAwB,KAAK;AAAA,IAC7C,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,uBACR,KAAK,sBAAsB;AAAA,EACX,4BAA4B,KAAK;AAAA,IACjD,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,2BACR,KAAK,0BAA0B;AAAA,EACf,qBAAqB,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC/D,mBAAmB,KAAK,mBAAmB;AAAA,EACnC,oBAAoB,KAAK,UAAU,IAAI,QAAc,CAAC;AAAA,EAC9D,kBAAkB,KAAK,kBAAkB;AAAA,EACjC,2BAA2B,KAAK;AAAA,IAChD,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,0BACR,KAAK,yBAAyB;AAAA,EACd,2BAA2B,KAAK;AAAA,IAChD,IAAI,QAAc;AAAA,EACnB;AAAA,EACS,0BACR,KAAK,yBAAyB;AAAA,EACd,aAChB,KAAK,UAAU,IAAI,QAAmC,CAAC;AAAA,EAC/C,YACR,KAAK,WAAW;AAAA,EACA,eAChB,KAAK,UAAU,IAAI,QAAmC,CAAC;AAAA,EAC/C,cACR,KAAK,aAAa;AAAA,EACF,uBAAuB,KAAK;AAAA,IAC5C,IAAI,QAAiC;AAAA,EACtC;AAAA,EACS,sBACR,KAAK,qBAAqB;AAAA,EACV,qBAAqB,KAAK;AAAA,IAC1C,IAAI,QAA8B;AAAA,EACnC;AAAA,EACiB,oBAAoB,KAAK,mBAAmB;AAAA,EAC5C,qBAAqB,KAAK;AAAA,IAC1C,IAAI,QAA8B;AAAA,EACnC;AAAA,EACiB,oBAAoB,KAAK,mBAAmB;AAAA,EAC5C,4BAA4B,KAAK;AAAA,IACjD,IAAI,QAAwB;AAAA,EAC7B;AAAA,EACS,oBAAoB,KAAK,0BAA0B;AAAA;AAAA,EAGpD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,WAAqD;AAAA,EACrD,yBACP;AAAA,EACO,2BAA+C;AAAA,EAC/C,gBAAiD;AAAA,EACjD;AAAA,EACA;AAAA,EACA,iBAAmD;AAAA,EACnD,sBAAiD;AAAA,EACjD,mBAAqD,oBAAI,IAAI;AAAA,EAC7D;AAAA,EACA;AAAA,EACA;AAAA,EACS,cAA+B,KAAK;AAAA,IACpD,IAAI,gBAAgB;AAAA,EACrB;AAAA,EACQ,2BAA8C,CAAC;AAAA,EAC/C;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA,yBAKG;AAAA,EAEM;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACE,iBAAiB,oBAAI,IAGtC;AAAA,EACM;AAAA,EACS,8BAA8B,IAAI,eAAuB;AAAA,EAClE,yBAAuD;AAAA,EAC9C,QAAQ,aAAa;AAAA,EAC9B;AAAA,EACA,kBAAkB;AAAA,EAClB,aAAa;AAAA,EACrB,IAAI,YAAY;AACf,WAAO,KAAK;AAAA,EACb;AAAA,EAEQ,cAAc;AAAA,EAEtB,IAAI,aAAa;AAChB,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,IAAI,UAAU,UAAyC;AACtD,SAAK,mBAAmB,KAAK,KAAK,oBAAoB,gBAAgB;AACtE,SAAK,qBAAqB;AAC1B,SAAK,kBAAkB,KAAK,UAAU,gBAAgB;AAAA,EACvD;AAAA,EAEA,IAAI,YAAY;AACf,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,IAAI,YAAY;AACf,WAAO,KAAK,oBAAoB;AAAA,EACjC;AAAA,EAEA,IAAI,aAAa;AAChB,WAAO,KAAK,oBAAoB,QAAQ,cAAc;AAAA,EACvD;AAAA,EAEA,IAAI,mBAA4C;AAC/C,QAAI,KAAK,aAAa;AACrB;AAAA,IACD;AAEA,UAAM,CAAC,OAAO,IAAI,KAAK,MAAM,mBAAmB;AAChD,WAAO,KAAK,iBAAiB,IAAI,OAAO;AAAA,EACzC;AAAA,EAEA,IAAI,0BAAqE;AACxE,QAAI,KAAK,aAAa;AACrB;AAAA,IACD;AAEA,UAAM,CAAC,OAAO,IAAI,KAAK,MAAM,mBAAmB;AAChD,UAAM,SAAS,KAAK,iBAAiB,IAAI,OAAO;AAChD,QAAI,CAAC,QAAQ;AACZ;AAAA,IACD;AACA,WAAO,CAAC,SAAS,MAAM;AAAA,EACxB;AAAA,EAEA,IAAI,cAA+C;AAClD,WAAO,CAAC,GAAG,KAAK,gBAAgB;AAAA,EACjC;AAAA,EAEA,IAAI,gBAAgB;AACnB,WAAO,KAAK,MAAM,iBAAiB,CAAC;AAAA,EACrC;AAAA,EAEQ,yBAAyB,oBAAI,IAAoC;AAAA,EAEhE;AAAA,EACD;AAAA,EACS;AAAA,EAED;AAAA,EACC;AAAA,EACA;AAAA,EAET;AAAA,EAER,IAAI,kBAAkB;AACrB,WAAO,KAAK;AAAA,EACb;AAAA,EA6PQ,aAAa;AAAA,EAEb,UAAU,MAAa;AAC9B,QAAI,CAAC,KAAK,YAAY;AACrB;AAAA,IACD;AAEA,kBAAc,GAAG,IAAI;AAAA,EACtB;AAAA;AAAA;AAAA;AAAA,EAKO,QAAgB;AACtB,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,eAA8C;AAC7C,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,YAAY;AACX,WAAO,KAAK,WAAW,UAAU;AAAA,EAClC;AAAA,EAEA,gBAAgB;AACf,WAAO,KAAK,WAAW,cAAc,KAAK,CAAC;AAAA,EAC5C;AAAA,EAEA,cAAc,YAA0B;AACvC,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,UAAM,QAAQ,KAAK,UAAU,SAAS;AACtC,SAAK,UAAU,sBAAsB;AAAA,MACpC,MAAM,mBAAmB;AAAA,MACzB;AAAA,MACA;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEA,WAAW;AACV,WAAO,KAAK,WAAW,SAAS,KAAK,EAAE,OAAO,GAAG,KAAK,EAAE;AAAA,EACzD;AAAA,EAEA,SAAS,OAAmB;AAC3B,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,UAAM,aAAa,KAAK,UAAU,cAAc;AAChD,SAAK,UAAU,sBAAsB;AAAA,MACpC,MAAM,mBAAmB;AAAA,MACzB;AAAA,MACA;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEA,yBAA2C;AAC1C,QAAI,CAAC,KAAK,WAAW;AACpB,aAAO,CAAC;AAAA,IACT;AAEA,UAAM,WAAW,oBAAI,IAAY;AAEjC,WAAO,KAAK,UACV,cAAc,EACd;AAAA,MAAI,CAAC,UACL,KAAK,UAAW,UAAU,MAAM,MAAM,OAAO,MAAM,GAAG;AAAA,IACvD,EACC,OAAO,CAAC,GAAG,MAAM;AACjB,QAAE,QAAQ,CAAC,SAAS;AACnB,YAAI,CAAC,SAAS,IAAI,KAAK,MAAM,GAAG;AAC/B,mBAAS,IAAI,KAAK,MAAM;AACxB,YAAE,KAAK,IAAI;AAAA,QACZ;AAAA,MACD,CAAC;AAED,aAAO;AAAA,IACR,GAAG,CAAC,CAAqB;AAAA,EAC3B;AAAA,EAEA,WAAkD;AACjD,WAAO,CAAC,CAAC,KAAK;AAAA,EACf;AAAA,EAEA,eAAqB;AACpB,SAAK,mBAAmB,KAAK,sBAAsB,KAAK,IAAI;AAAA,EAC7D;AAAA,EAEA,eAAqB;AACpB,QAAI,KAAK,kBAAkB;AAC1B,WAAK,iBAAiB,KAAK;AAC3B,WAAK,mBAAmB;AAAA,IACzB;AAAA,EACD;AAAA;AAAA,EAIA,yBAAyB,UAA0C;AAClE,UAAM,kBAAkB,KAAK,uBAAuB,IAAI,QAAQ;AAEhE,QAAI,iBAAiB;AACpB,aAAO;AAAA,IACR,OAAO;AACN,YAAM,UAAU,IAAI;AAAA,QACnB;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL;AAAA,MACD;AACA,WAAK,uBAAuB,IAAI,UAAU,OAAO;AACjD,aAAO;AAAA,IACR;AAAA,EACD;AAAA,EAEQ,kCAAkC;AACzC,QAAI,CAAC,KAAK,mBAAmB;AAC5B;AAAA,IACD;AAEA,SAAK,kBAAkB,UAAU,OAAO,yBAAyB;AACjE,SAAK,kBAAkB,UAAU,OAAO,0BAA0B;AAClE,SAAK,kBAAkB,UAAU,OAAO,2BAA2B;AACnE,UAAM,sBACL,KAAK,iBAAiB;AAAA,MACrB,KAAK,WAAW;AAAA,IACjB;AACD,SAAK,kBAAkB,UAAU;AAAA,MAChC,sBAAsB,mBAAmB;AAAA,IAC1C;AAEA,UAAM,yBACL,KAAK,iBAAiB,kBAAkB,EAAE;AAC3C,QAAI,8BAA8B;AAClC,SAAK,kBAAkB,UAAU,OAAO,oBAAoB;AAC5D,SAAK,kBAAkB,UAAU,OAAO,oBAAoB;AAE5D,QACC,2BAA2B,WAC3B,2BAA2B,SAC1B;AACD,oCAA8B;AAAA,IAC/B;AACA,SAAK,kBAAkB,UAAU;AAAA,MAChC,gBAAgB,2BAA2B;AAAA,IAC5C;AAAA,EACD;AAAA,EAEQ,oBAA0B;AACjC,UAAM,gBACL,KAAK,qBAAqB,SAAyB,QAAQ;AAC5D,UAAM,eAAe,IAAI,UAAU,KAAK,WAAW,CAAC;AACpD,SAAK,YAAY,iBAAiB;AAAA,MACjC;AAAA,MACA,aAAa;AAAA,QACZ;AAAA,QACA,WAAW,YAAY,YAAY,EAAE;AAAA,MACtC;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,YAAY,QAA2B;AAC9C,SAAK,+BAA+B,SAAS,cAAc,KAAK;AAChE,SAAK,6BAA6B,UAAU;AAAA,MAC3C;AAAA,IACD;AACA,SAAK,6BAA6B,MAAM,UAAU;AAClD,QAAI,OAAO,QAAQ,KAAK,4BAA4B;AAEpD,SAAK,iCAAiC,SAAS,cAAc,KAAK;AAClE,SAAK,+BAA+B,UAAU;AAAA,MAC7C;AAAA,IACD;AACA,QAAI,OAAO,QAAQ,KAAK,8BAA8B;AAEtD,SAAK,QAAQ,SAAS,cAAc,KAAK;AACzC,QAAI,OAAO,QAAQ,KAAK,KAAK;AAE7B,SAAK,MAAM,UAAU,IAAI,qBAAqB;AAC9C,SAAK,oBAAoB;AACzB,SAAK,gBAAgB;AAErB,SAAK,kCAAkC,SAAS,cAAc,KAAK;AACnE,SAAK,gCAAgC,UAAU;AAAA,MAC9C;AAAA,IACD;AACA,SAAK,MAAM,kBAAkB;AAAA,MAC5B,KAAK;AAAA,IACN;AACA,SAAK,+BAA+B;AAEpC,SAAK;AAAA,MACJ,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK,MAAM;AAAA,MACZ;AAAA,IACD;AAEA,SAAK,qBAAqB,SAAS,cAAc,KAAK;AACtD,SAAK,mBAAmB,UAAU;AAAA,MACjC;AAAA,MACA;AAAA,IACD;AACA,QAAI,OAAO,QAAQ,KAAK,kBAAkB;AAAA,EAC3C;AAAA,EAEQ,sBAAsB;AAC7B,WACC,KAAK,WAAW,cAChB;AAAA,EAEF;AAAA,EAEQ,sBAA4B;AACnC,SAAK,gBAAgB,IAAI,iBAAiB,KAAK,KAAK;AACpD,UAAM;AAAA,MACL;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD,IAAI,KAAK,iBAAiB,uBAAuB;AAEjD,UAAM,EAAE,wBAAwB,aAAa,SAAS,IACrD,KAAK,iBAAiB,kBAAkB;AAEzC,UAAM,mCACL,KAAK,iBAAiB,iCAAiC;AAExD,UAAM,EAAE,kBAAkB,oBAAoB,IAC7C,KAAK,iBAAiB;AAAA,MACrB,KAAK,WAAW;AAAA,IACjB;AAED,UAAM,cAAwB,CAAC;AAC/B,QAAI,CAAC,KAAK,WAAW;AACpB,WAAK,kBAAkB;AAAA,IACxB;AAEA,UAAM,aAAa,KAAK,oBAAoB;AAE5C,gBAAY,KAAK;AAAA;AAAA,uCAEoB,cAAc;AAAA,8CACP,QAAQ;AAAA,gDACN,UAAU;AAAA;AAAA,GAEvD;AAED,QAAI,aAAa;AAChB,kBAAY;AAAA,QACX,2JAA2J,gCAAgC;AAAA,MAC5L;AAAA,IACD,OAAO;AACN,kBAAY;AAAA,QACX,2JAA2J,kBAAkB;AAAA,MAC9K;AAAA,IACD;AAGA,QAAI,mBAAmB,UAAU;AAChC,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAuChB;AAGD,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,YAKR,aAAa,2BAA2B,gBAAgB,gBAAgB;AAAA,KAC/E;AAAA,IACH,OAAO;AACN,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,mBAKD,wBAAwB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBAaxB,2BAA2B,CAAC;AAAA;AAAA,IAE3C;AAED,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAOF,iBAAiB;AAAA;AAAA,IAE/B;AAAA,IACF;AAGA,QACC,0BAA0B,kBAC1B,0BAA0B,QACzB;AACD,kBAAY;AAAA,QACX;AAAA,MACD;AACA,kBAAY;AAAA,QACX;AAAA,MACD;AAAA,IACD,OAAO;AACN,kBAAY;AAAA,QACX;AAAA,MACD;AACA,kBAAY;AAAA,QACX;AAAA,MACD;AAAA,IACD;AAEA,QAAI,2BAA2B,QAAQ;AACtC,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA,KAIf;AAEF,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAMf;AAEF,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA;AAAA,uBAKG,IAAI,kBAAkB;AAAA,KACxC;AAEF,kBAAY,KAAK;AAAA;AAAA;AAAA;AAAA,KAIf;AAAA,IACH;AAEA,gBAAY;AAAA,MACX,uJAAuJ,gCAAgC;AAAA,IACxL;AACA,gBAAY;AAAA,MACX,qJAAqJ,eAAe;AAAA,IACrK;AACA,gBAAY;AAAA,MACX,mKAAmK,aAAa;AAAA,IACjL;AACA,gBAAY;AAAA,MACX,wKAAwK,wBAAwB,oBAAoB,qBAAqB;AAAA,IAC1O;AACA,gBAAY;AAAA,MACX;AAAA,IACD;AACA,gBAAY;AAAA,MACX,mNAAmN,wBAAwB,oBAAoB,qBAAqB;AAAA,IACrR;AACA,gBAAY;AAAA,MACX,0CAA0C,eAAe,UAAU,gCAAgC;AAAA,IACpG;AACA,gBAAY;AAAA,MACX,iDAAiD,mCAAmC,eAAe;AAAA,IACpG;AAGA,gBAAY;AAAA,MACX,4JAA4J,gCAAgC;AAAA,IAC7L;AACA,gBAAY;AAAA,MACX,yKAAyK,mCAAmC,eAAe;AAAA,IAC5N;AAGA,gBAAY;AAAA,MACX,gGAAgG,aAAa;AAAA,IAC9G;AACA,gBAAY,KAAK;AAAA;AAAA,YAEP,aAAa;AAAA;AAAA,IAErB;AAGF,gBAAY;AAAA,MACX,8DAA8D,eAAe,UAAU,gCAAgC;AAAA,IACxH;AACA,gBAAY;AAAA,MACX,qEAAqE,mCAAmC,eAAe;AAAA,IACxH;AAEA,gBAAY;AAAA,MACX,8JAA8J,aAAa;AAAA,IAC5K;AACA,gBAAY;AAAA,MACX,kGAAkG,qBAAqB,MAAM,IAAI,sBAAsB;AAAA,IACxJ;AACA,gBAAY;AAAA,MACX,yEAAyE,qBAAqB,yBAAyB,CAAC;AAAA,IACzH;AACA,gBAAY;AAAA,MACX,0HAA0H,aAAa;AAAA,IACxI;AACA,gBAAY;AAAA,MACX,uFAAuF,gBAAgB;AAAA,IACxG;AACA,gBAAY;AAAA,MACX,oGAAoG,gCAAgC;AAAA,IACrI;AACA,gBAAY;AAAA,MACX,wGAAwG,kBAAkB;AAAA,IAC3H;AACA,gBAAY;AAAA,MACX,4GAA4G,eAAe;AAAA,IAC5H;AACA,gBAAY;AAAA,MACX,yFAAyF,gBAAgB;AAAA,IAC1G;AACA,gBAAY;AAAA,MACX,uFAAuF,gBAAgB;AAAA,IACxG;AAEA,gBAAY,KAAK;AAAA;AAAA,cAEL,mBAAmB,gBAAgB;AAAA;AAAA,GAE9C;AAED,gBAAY,KAAK;AAAA;AAAA,cAEL,mBAAmB,gBAAgB;AAAA;AAAA;AAAA;AAAA;AAAA,cAKnC,mBAAmB,mBAAmB,CAAC;AAAA;AAAA;AAAA,GAGlD;AAED,gBAAY,KAAK;AAAA;AAAA,mBAEA,wBAAwB;AAAA;AAAA;AAAA;AAAA,kBAIzB,wBAAwB;AAAA;AAAA,GAEvC;AAED,gBAAY;AAAA,MACX,yMAAyM,mBAAmB;AAAA,IAC7N;AACA,gBAAY;AAAA,MACX,2MAA2M,mBAAmB;AAAA,IAC/N;AAGA,gBAAY,KAAK;AAAA,YACP,kBAAkB,EAAE;AAAA;AAAA;AAAA,WAGrB,mCAAmC,EAAE;AAAA;AAAA;AAAA;AAAA,IAI5C;AAGF,gBAAY,KAAK;AAAA;AAAA,cAEL,8BAA8B;AAAA;AAAA;AAAA,cAG9B,8BAA8B;AAAA;AAAA,GAEzC;AAGD,gBAAY,KAAK;AAAA;AAAA,eAEJ,eAAe;AAAA;AAAA,GAE3B;AAED,SAAK,cAAc,cAAc,YAAY,KAAK,IAAI;AAAA,EACvD;AAAA,EAEQ,kBAAwB;AAC/B,SAAK,MAAM,UAAU,IAAI,qBAAqB;AAC9C,SAAK,iBAAiB,KAAK;AAAA,MAC1B,IAAI,0BAA0B,MAAM,KAAK,KAAK;AAAA,IAC/C;AACA,UAAM,6BAA6B,wBAAC,cACnC,KAAK,MAAM,kBAAkB,aAAa,SAAS,GADjB;AAEnC,SAAK,cAAc,KAAK;AAAA,MACvB,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA;AAAA,MACD;AAAA,IACD;AACA,UAAM,YAAY;AAAA,MACjB,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,QACL;AAAA,MACD;AAAA,MACA,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD;AAEA,cAAU,QAAQ,CAAC,aAAa;AAC/B,WAAK,UAAU,QAAQ;AAAA,IACxB,CAAC;AAED,SAAK,gBAAgB,KAAK,qBAAqB;AAAA,MAC9C;AAAA,MACA,IAAI,UAAU,KAAK,WAAW,CAAC;AAAA,IAChC;AACA,SAAK,UAAU,KAAK,aAAa;AAEjC,UAAM,wBAAwB,IAAI;AAAA,MACjC,KAAK;AAAA,MACL,MAAM,KAAK;AAAA,MACX,KAAK;AAAA,MACL,KAAK;AAAA,IACN;AACA,SAAK,UAAU,qBAAqB;AAEpC,SAAK,QAAQ,KAAK,qBAAqB;AAAA,MACtC;AAAA,MACA;AAAA,MACA,KAAK;AAAA,MACL,KAAK,aAAa;AAAA,MAClB,KAAK;AAAA,MACL;AAAA,MACA,KAAK;AAAA,MACL;AAAA,QACC,kBAAkB;AAAA,QAClB,cAAc;AAAA,QACd,uBAAuB;AAAA,QACvB,qBAAqB;AAAA,QACrB,iBAAiB;AAAA,QACjB,cAAc;AAAA,QACd,0BAA0B;AAAA,QAC1B,qBAAqB;AAAA,QACrB,uBAAuB;AAAA,QACvB,YAAY;AAAA,QACZ,eAAe;AAAA,QACf,uBAAuB;AAAA;AAAA,QACvB,aAAa,KAAK;AAAA,QAClB,iBAAiB,wBAAC,YAAoB;AACrC,iBAAO,KAAK;AAAA,QACb,GAFiB;AAAA,QAGjB,gBAAgB;AAAA,UACf,gBAAgB;AAAA,UAChB,+BAA+B;AAAA,UAC/B,+BAA+B;AAAA,UAC/B,iCAAiC;AAAA,UACjC,iCAAiC;AAAA,UACjC,qBAAqB;AAAA,UACrB,qBAAqB;AAAA,UACrB,qBAAqB;AAAA,UACrB,qBAAqB;AAAA,UACrB,kBAAkB;AAAA,UAClB,kBAAkB;AAAA,UAClB,iCAAiC;AAAA,UACjC,iCAAiC;AAAA,UACjC,6BAA6B;AAAA,UAC7B,0BAA0B;AAAA,QAC3B;AAAA,QACA;AAAA,MACD;AAAA,IACD;AACA,SAAK,eAAe,QAAQ,KAAK,KAAK;AAItC,SAAK,UAAU,KAAK,KAAK;AACzB,SAAK,wBAAwB,IAAI,qBAAqB,KAAK,KAAK;AAChE,SAAK,UAAU,KAAK,qBAAqB;AAEzC,SAAK,UAAU,mBAAmB,GAAG,SAAS,CAAC;AAG/C,SAAK,sBAAsB,KAAK;AAAA,MAC/B,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACN;AAAA,IACD;AAGA,SAAK,2BAA2B,IAAI;AAAA,MACnC,KAAK,MAAM;AAAA,MACX,EAAE,gBAAgB;AAAA,IACnB;AACA,SAAK,yBAAyB,MAAM,UAAU;AAE9C,SAAK;AAAA,MACJ,IAAI;AAAA,QACH,KAAK;AAAA,QACL,CAAC,MAA0B;AAC1B,cACC,EAAE,OAAO,UAAU,SAAS,QAAQ,KACpC,KAAK,0BACJ;AACD,iBAAK,yBAAyB,MAAM,UAAU;AAAA,UAC/C;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,IAAI;AAAA,QACH,KAAK;AAAA,QACL,MAAM;AACL,cAAI,KAAK,0BAA0B;AAElC,iBAAK,yBAAyB,MAAM,UAAU;AAAA,UAC/C;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,YAAY,CAAC,MAAM;AAC7B,YAAI,EAAE,SAAS;AACd,eAAK,aAAa,KAAK;AAAA,YACtB,OAAO,EAAE;AAAA,YACT,QAAQ,EAAE;AAAA,UACX,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,UAAU,CAAC,MAAM;AAC3B,YAAI,EAAE,SAAS;AACd,eAAK,WAAW,KAAK;AAAA,YACpB,OAAO,EAAE;AAAA,YACT,QAAQ,EAAE;AAAA,UACX,CAAC;AAAA,QACF;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,iBAAiB,CAAC,OAAO;AACnC,aAAK,yBAAyB,KAAK,IAAI;AACvC,aAAK,uBAAuB,KAAK;AACjC,aAAK,kBAAkB,KAAK;AAC5B,aAAK,eAAe,IAAI,KAAK;AAAA,MAC9B,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,cAAc,CAAC,MAAM;AAC/B,aAAK,oBAAoB,CAAC;AAAA,MAC3B,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,yBAAyB,MAAM;AACzC,aAAK,0BAA0B,KAAK;AAAA,MACrC,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,MAAM,YAAY,CAAC,MAAM;AAC7B,YAAI,EAAE,cAAc,EAAE,cAAc;AACnC,eAAK,aAAa,KAAK;AACvB,eAAK,uBAAuB;AAAA,QAC7B;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,gBAAgB,KAAK,UAAU,IAAI,WAAW,KAAK,WAAW,CAAC,CAAC;AACrE,SAAK;AAAA,MACJ,KAAK,cAAc,UAAU,MAAM;AAClC,aAAK,aAAa,IAAI,KAAK;AAC3B,aAAK,WAAW,eAAe,KAAK;AACpC,aAAK,kBAAkB,KAAK;AAAA,MAC7B,CAAC;AAAA,IACF;AACA,SAAK;AAAA,MACJ,KAAK,cAAc,WAAW,MAAM;AACnC,aAAK,aAAa,IAAI,IAAI;AAC1B,aAAK,WAAW,eAAe,IAAI;AACnC,aAAK,mBAAmB,KAAK;AAAA,MAC9B,CAAC;AAAA,IACF;AAEA,SAAK,gCAAgC;AACrC,SAAK,8BAA8B;AAEnC,SAAK;AAAA,MACJ,KAAK,qBAAqB,yBAAyB,CAAC,MAAM;AACzD,YACC,EAAE;AAAA,UACD,gCAAgC;AAAA,QACjC,GACC;AACD,eAAK,MAAM,YACV,uBAAuB,mBAAmB;AAAA,QAC5C;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,oBAAoB,GAAyC;AACpE,SAAK,mBAAmB,gBAAgB;AAAA,MACvC,QAAQ,OAAO;AAAA,MACf,mBAAmB,KAAK;AAAA,MACxB,WAAW,6BAAM,EAAE,QAAR;AAAA,IACZ,CAAC;AAAA,EACF;AAAA,EAEQ,iCAAiC;AACxC,SAAK,yBAAyB,KAAK;AAAA,MAClC,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,kCAAkC;AACzC,SAAK,sBAAsB,KAAK;AAAA,MAC/B,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA;AAAA,QACA,KAAK;AAAA,QACL,KAAK;AAAA,QACL,KAAK;AAAA,MACN;AAAA,IACD;AACA,SAAK;AAAA,MACJ,KAAK,oBAAoB,sBAAsB,MAAM;AACpD,YAAI,KAAK,cAAc,KAAK,YAAY;AACvC,eAAK,OAAO,KAAK,UAAU;AAAA,QAC5B;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,gCAAgC;AACvC,SAAK,wBAAwB,KAAK;AAAA,MACjC,KAAK,qBAAqB;AAAA,QACzB;AAAA,QACA,KAAK;AAAA,QACL;AAAA,QACA,KAAK;AAAA,QACL,CAAC,cAAc;AACd,cAAI,KAAK,YAAY;AACpB;AAAA,UACD;AAEA,cAAI,KAAK,cAAc,KAAK,YAAY;AACvC,gBAAI,YAAY,GAAG;AAElB,mBAAK,OAAO,KAAK,UAAU;AAC3B,mBAAK,aAAa,KAAK,YAAY,SAAS;AAAA,YAC7C,WAAW,YAAY,GAAG;AAEzB,mBAAK,aAAa,KAAK,YAAY,SAAS;AAC5C,mBAAK,OAAO,KAAK,UAAU;AAAA,YAC5B;AAAA,UACD;AAEA,eAAK,aAAa,KAAK;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,yBAAyB;AAChC,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,UAAU;AACtC;AAAA,IACD;AAEA,SAAK,SAAS,sBAAsB;AACpC,SAAK,UAAU,UAAU,QAAQ,CAAC,SAAS;AAC1C,WAAK,kBAAkB,QAAQ,CAAC,WAAW;AAC1C,YACC,OAAO,gBAAgB,eAAe,wBACrC;AACD,iBAAO,cAAc;AAAA,QACtB;AAAA,MACD,CAAC;AAAA,IACF,CAAC;AAAA,EACF;AAAA,EAEA,aAAa;AACZ,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,8BAA8B;AAC7B,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,kBAA+C;AAC9C,WAAO,KAAK,UAAU;AAAA,EACvB;AAAA,EAEA,yBACC,uBACO;AACP,SAAK,wBAAwB;AAAA,EAC9B;AAAA,EAEA,2BACC,yBACO;AACP,SAAK,wBAAwB,aAAa,uBAAuB;AAAA,EAClE;AAAA,EAEA,MAAM,SACL,WACA,WACA,MACgB;AAChB,QAAI,KAAK,cAAc,UAAa,CAAC,KAAK,UAAU,MAAM,SAAS,GAAG;AACrE,YAAM,6BACL,KAAK,iBAAiB;AAAA,QACrB,KAAK,WAAW;AAAA,MACjB;AACD,WAAK,aAAa;AAClB,YAAM,KAAK,aAAa,WAAW,WAAW,IAAI;AAClD,YAAM,6BACL,KAAK,iBAAiB;AAAA,QACrB,KAAK,WAAW;AAAA,MACjB;AAED,UACC,2BAA2B,qBAC1B,2BAA2B,oBAC5B,2BAA2B,wBAC1B,2BAA2B,qBAC3B;AACD,aAAK,eAAe,OAAO;AAC3B,aAAK,oBAAoB;AACzB,aAAK,UAAU,cAAc;AAAA,UAC5B,GAAG,KAAK,gBAAgB,sBAAsB;AAAA,UAC9C,YAAY,KAAK,oBAAoB;AAAA,QACtC,CAAC;AAAA,MACF;AA2BA,WAAK,iBAAiB,WAGpB,yBAAyB;AAAA,QAC1B,QAAQ,UAAU,IAAI;AAAA,QACtB,KAAK,QAAQ,UAAU,GAAG;AAAA,QAC1B,UAAU,UAAU;AAAA,MACrB,CAAC;AAAA,IACF,OAAO;AACN,WAAK,qBAAqB,SAAS;AAAA,IACpC;AAEA,SAAK,uBAAuB,SAAS;AAGrC,SAAK,oBAAoB;AAGzB,SAAK,gBAAgB,qBAAqB;AAE1C,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,iBAAiB,MAAM;AACjC,aAAK,+BAA+B;AAAA,MACrC,CAAC;AAAA,IACF;AAEA,SAAK,+BAA+B;AAEpC,SAAK,6BAA6B;AAAA,EACnC;AAAA,EAEQ,mCAAmC;AAAA,EACnC,+BAA+B;AACtC,QAAI,KAAK,kCAAkC;AAC1C;AAAA,IACD;AAEA,SAAK,mCAAmC;AACxC,QAAI,kBAAkB,IAAI,UAAU,KAAK,WAAW,CAAC,GAAG,CAAC,aAAa;AACrE,WAAK,yCAAyC,QAAQ;AAAA,IACvD,CAAC;AAAA,EACF;AAAA,EAEQ,yCAAyC,UAAwB;AACxE,UAAM,UAAU,KAAK,IAAI,IAAI,SAAS,cAAc;AAEpD,UAAM,UAAU,6BAAM;AACrB,UAAI;AACH,aAAK,mCAAmC;AACxC,YAAI,KAAK,aAAa;AACrB;AAAA,QACD;AAEA,YAAI,CAAC,KAAK,WAAW;AACpB;AAAA,QACD;AAEA,cAAM,kBAAkB,KAAK,UAAU,UAAU;AAAA,UAChD,CAAC,SACA,KAAK,aAAa,SAAS,UAC3B,CAAC,KAAK,UAAU,qBAAqB,IAAI,KAAK,EAAE,KAChD,CAAC,KAAK,aAAa,IAAI;AAAA,QACzB;AACA,YAAI,CAAC,iBAAiB;AACrB;AAAA,QACD;AAEA,aAAK,oBAAoB,eAAe;AAAA,MACzC,UAAE;AACD,aAAK,mCAAmC;AAAA,MACzC;AAEA,UAAI,KAAK,IAAI,IAAI,SAAS;AACzB,oBAAY,OAAO;AAAA,MACpB,OAAO;AACN,aAAK,6BAA6B;AAAA,MACnC;AAAA,IACD,GA/BgB;AAiChB,YAAQ;AAAA,EACT;AAAA,EAEQ,iCAAiC;AACxC,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,UAAM,UAAU,KAAK,MAAM,mBAAmB,EAAE,CAAC;AACjD,QAAI,SAAS;AACZ,UAAI,CAAC,KAAK,wBAAwB;AACjC,aAAK,yBAAyB,KAAK,YAAY;AAAA,UAC9C,KAAK,qBAAqB;AAAA,YACzB;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAEA,WAAK,uBAAuB;AAAA,QAC3B;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,WAAW,SAA6C;AAC7D,QAAI,SAAS,eAAe,QAAW;AACtC,WAAK,YAAY,SAAS;AAAA,IAC3B;AAEA,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,SAAK,UAAU,cAAc,EAAE,YAAY,KAAK,UAAU,CAAC;AAC3D,SAAK,gBAAgB,cAAc,KAAK,SAAS;AAGjD,UAAM,cACL,SAAS,eAAe,KAAK,yBAAyB,OAAO;AAC9D,QAAI,aAAa;AAChB,YAAM,OAAO,KAAK,UAAU,UAAU;AAAA,QACrC,CAACA,UACAA,MAAK,IAAI,SAAS,MAAM,YAAY,SAAS,SAAS;AAAA,MACxD;AACA,UAAI,MAAM;AACT,aAAK,aAAa,IAAI;AACtB,cAAM,YAAY,YAAY,SAAS;AACvC,YAAI,WAAW;AACd,eAAK,gBAAgB,cAAc,SAAS,YAAY;AACxD,eAAK,YAAY,cAAc;AAC/B,gBAAM,KAAK;AAAA,YACV;AAAA,YACA,IAAI;AAAA,cACH,UAAU;AAAA,cACV,UAAU;AAAA,cACV,UAAU,iBACT,UAAU;AAAA,cACX,UAAU,aAAa,UAAU;AAAA,YAClC;AAAA,UACD;AAAA,QACD,OAAO;AACN,eAAK,MAAM;AAAA,YACV;AAAA,YACA,SAAS,kBACR,eAAe;AAAA,UACjB;AAAA,QACD;AAEA,cAAM,SAAS,KAAK,iBAAiB,IAAI,IAAI;AAC7C,YAAI,QAAQ;AACX,cAAI,YAAY,SAAS,WAAW;AACnC,kBAAM,EAAE,WAAAC,WAAU,IAAI,YAAY;AAClC,kBAAM,kBAAkB,IAAI;AAAA,cAC3BA,WAAU;AAAA,cACVA,WAAU;AAAA,cACVA,WAAU,iBACTA,WAAU;AAAA,cACXA,WAAU,aAAaA,WAAU;AAAA,YAClC;AACA,mBAAO,aAAa,eAAe;AACnC,mBAAO,wCAAwC;AAAA,cAC9C,YAAYA,WAAU;AAAA,cACtB,QAAQA,WAAU;AAAA,YACnB,CAAC;AACD,kBAAM,KAAK;AAAA,cACV;AAAA,cACA;AAAA,YACD;AAAA,UACD;AACA,cAAI,CAAC,YAAY,SAAS,eAAe;AACxC,mBAAO,MAAM;AAAA,UACd;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAKA,QAAI,SAAS,gBAAgB;AAC5B,YAAM,iBAAiB,QAAQ,eAAe,CAAC,EAAE;AACjD,YAAM,cAAc,KAAK,UAAU,OAAO,cAAc;AACxD,UAAI,aAAa;AAChB,aAAK,UAAU,sBAAsB;AAAA,UACpC,MAAM,mBAAmB;AAAA,UACzB,OAAO,EAAE,OAAO,gBAAgB,KAAK,iBAAiB,EAAE;AAAA,UACxD,YAAY,QAAQ;AAAA,QACrB,CAAC;AACD,aAAK,gCAAgC,WAAW;AAAA,MACjD;AAAA,IACD;AAEA,SAAK,kBAAkB;AACvB,SAAK,oBAAoB,KAAK;AAAA,EAC/B;AAAA,EAEQ,yBACP,SACC;AACD,QAAI,SAAS,oBAAoB;AAEhC,YAAM,OAAO,KAAK,OAAO,QAAQ,mBAAmB,KAAK;AACzD,UAAI,MAAM;AACT,eAAO;AAAA,UACN,UAAU,KAAK;AAAA,UACf,SAAS;AAAA,YACR,WAAW,QAAQ,mBAAmB;AAAA,YACtC,eAAe;AAAA,UAChB;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAEA,WAAO;AAAA,EACR;AAAA,EAEQ,eAAe;AACtB,SAAK,YAAY,MAAM;AACvB,YAAQ,KAAK,wBAAwB;AACrC,SAAK,MAAM,gBAAgB;AAC3B,SAAK,WAAW,QAAQ;AAExB,SAAK,YAAY;AACjB,SAAK,UAAU,QAAQ;AACvB,SAAK,UAAU,QAAQ,OAAO;AAC9B,SAAK,WAAW;AAChB,SAAK,MAAM,MAAM;AAAA,EAClB;AAAA,EAEQ,oBAA0B;AACjC,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,SAAK,gBAAgB,IAAI,CAAC,KAAK,UAAU,QAAQ,UAAU;AAC3D,SAAK,mBAAmB,UAAU;AAAA,MACjC;AAAA,MACA,CAAC,KAAK,UAAU,QAAQ;AAAA,IACzB;AACA,SAAK,WAAW,EAAE,UAAU;AAAA,MAC3B;AAAA,MACA,CAAC,KAAK,UAAU,QAAQ;AAAA,IACzB;AAAA,EACD;AAAA,EAEA,MAAc,kBAAqE;AAClF,QAAI,CAAC,KAAK,WAAW;AACpB,aAAO;AAAA,IACR;AAEA,QAAI,KAAK,wBAAwB;AAChC,aAAO,KAAK;AAAA,IACb;AAEA,QAAI,CAAC,KAAK,UAAU;AACnB,WAAK;AAAA,QACJ,KAAK,MAAM;AAAA,QACX,KAAK,UAAU;AAAA,QACf,KAAK,UAAU;AAAA,MAChB;AAAA,IACD;AAEA,SAAK,0BAA0B,YAAY;AAC1C,UAAI,CAAC,KAAK,UAAU;AACnB,cAAM,IAAI;AAAA,UACT;AAAA,QACD;AAAA,MACD;AAEA,YAAM,KAAK,SAAS;AAAA,QACnB,KAAK,gBAAgB,cAAc;AAAA,MACpC;AACA,UAAI,CAAC,KAAK,SAAS,SAAS;AAC3B,cAAM,IAAI;AAAA,UACT;AAAA,QACD;AAAA,MACD;AAEA,WAAK,YAAY;AAAA,QAChB,KAAK,SAAS,QAAQ,UAAU,MAAM;AACrC,eAAK,aAAa,IAAI,KAAK;AAC3B,eAAK,kBAAkB;AAEvB,eAAK,kBAAkB;AACvB,eAAK,oBAAoB;AAAA,QAC1B,CAAC;AAAA,MACF;AAEA,WAAK,YAAY;AAAA,QAChB,KAAK,SAAS,QAAQ,WAAW,MAAM;AACtC,eAAK,aAAa,IAAI,IAAI;AAC1B,eAAK,kBAAkB;AACvB,eAAK,kBAAkB;AAAA,QACxB,CAAC;AAAA,MACF;AAEA,WAAK,YAAY;AAAA,QAChB,KAAK,SAAS,UAAU,CAAC,MAAM;AAC9B,eAAK,qBAAqB,KAAK,CAAC;AAAA,QACjC,CAAC;AAAA,MACF;AAEA,aAAO,KAAK;AAAA,IACb,GAAG;AAEH,WAAO,KAAK;AAAA,EACb;AAAA,EAEQ,eAAe,IAAY,UAAkB,UAAe;AACnE,QAAI,KAAK,UAAU;AAClB;AAAA,IACD;AAEA,UAAM,OAAO;AAEb,SAAK,WAAW,KAAK,qBAAqB;AAAA,MACzC;AAAA,MACA;AAAA,QACC,IAAI,kBAAkB;AACrB,iBAAO,KAAK;AAAA,QACb;AAAA,QACA,aAAa,WAAmB;AAC/B,eAAK,MAAM,YAAY;AAAA,QACxB;AAAA,QACA,cAAc,OAAyB;AACtC,eAAK,MAAM,iCAAiC,KAAK;AAAA,QAClD;AAAA,QACA,eAAe,KAAK,cAAc,KAAK,IAAI;AAAA,QAC3C,aAAa,KAAK,aAAa,KAAK,IAAI;AAAA,QACxC,6BACC,KAAK,6BAA6B,KAAK,IAAI;AAAA,QAC5C,mBAAmB,KAAK,kBAAkB,KAAK,IAAI;AAAA,QACnD,uBAAuB,KAAK,sBAAsB,KAAK,IAAI;AAAA,QAC3D,oBAAoB,KAAK,oBAAoB,KAAK,IAAI;AAAA,QACtD,yBACC,KAAK,yBAAyB,KAAK,IAAI;AAAA,QACxC,wBAAwB,KAAK,wBAAwB,KAAK,IAAI;AAAA,QAC9D,wBAAwB,KAAK,wBAAwB,KAAK,IAAI;AAAA,QAC9D,wBAAwB,KAAK,wBAAwB,KAAK,IAAI;AAAA,QAC9D,mBAAmB,KAAK,mBAAmB,KAAK,IAAI;AAAA,QACpD,mBAAmB,KAAK,mBAAmB,KAAK,IAAI;AAAA,QACpD,sBAAsB,KAAK,sBAAsB,KAAK,IAAI;AAAA,QAC1D,iBAAiB,KAAK,iBAAiB,KAAK,IAAI;AAAA,QAChD,2BACC,KAAK,2BAA2B,KAAK,IAAI;AAAA,QAC1C,2BACC,KAAK,2BAA2B,KAAK,IAAI;AAAA,MAC3C;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,QACC,GAAG,KAAK,iBAAiB,sBAAsB;AAAA,QAC/C,YAAY,KAAK,oBAAoB;AAAA,MACtC;AAAA,MACA,KAAK,0BAA0B,UAAU,KAAK,KAAK;AAAA,IACpD;AAEA,SAAK,SAAS,QAAQ,MAAM,QAAQ;AAGpC,SAAK,MAAM,cAAc,KAAK,SAAS,OAAO;AAAA,EAC/C;AAAA,EAEA,MAAc,aACb,WACA,WACA,MACC;AACD,SAAK,eAAe,KAAK,MAAM,GAAG,UAAU,UAAU,UAAU,GAAG;AAEnE,SAAK,YAAY,KAAK,qBAAqB;AAAA,MAC1C;AAAA,MACA,UAAU;AAAA,MACV;AAAA,MACA,KAAK;AAAA,MACL,KAAK,cAAc;AAAA,MACnB,EAAE,YAAY,KAAK,WAAW,QAAQ,KAAK,QAAQ;AAAA,IACpD;AACA,SAAK,aAAa,gBAAgB,KAAK;AAAA,MACtC,IAAI;AAAA,QACH,EAAE,OAAO,MAAM,UAAU,KAAK;AAAA,QAC9B,KAAK,cAAc;AAAA,MACpB;AAAA,IACD,CAAC;AACD,SAAK,gBAAgB,cAAc,KAAK,SAAS;AAEjD,SAAK,kBAAkB;AACvB,SAAK,gCAAgC;AAIrC;AAEC,WAAK,UAAU,uBAAuB,SAAS;AAI/C,YAAM,qBAAqB,WAAW,sBAAsB,CAAC;AAC7D,iBAAW,CAAC,IAAI,YAAY,KAAK,KAAK,gBAAgB;AACrD,YAAI,OAAO,aAAa,qBAAqB,YAAY;AACxD,uBAAa,iBAAiB,mBAAmB,EAAE,CAAC;AAAA,QACrD;AAAA,MACD;AAAA,IACD;AAEA,SAAK,YAAY;AAAA,MAChB,KAAK,UAAU,qBAAqB,CAAC,MAAM;AAC1C,aAAK,sBAAsB,KAAK,CAAC;AAAA,MAClC,CAAC;AAAA,IACF;AAEA,SAAK,YAAY;AAAA,MAChB,KAAK,UAAU,qBAAqB,MAAM;AACzC,aAAK,sBAAsB,KAAK;AAChC,aAAK,+BAA+B;AAAA,MACrC,CAAC;AAAA,IACF;AAEA,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,aAAa,CAAC,MAAM;AAC9B,YAAI,KAAK,UAAU,WAAW,GAAG;AAChC,eAAK,yBAA0B,MAAM,YACpC,cAAc,EAAE,SAAS;AAAA,QAC3B;AAAA,MACD,CAAC;AAAA,IACF;AAEA,QAAI,gCAAgC;AACpC,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,yBAAyB,MAAM;AACzC,YAAI,+BAA+B;AAClC;AAAA,QACD;AACA,wCAAgC;AAEhC,aAAK,YAAY;AAAA,UAChB,IAAI;AAAA,YACH,IAAI,UAAU,KAAK,WAAW,CAAC;AAAA,YAC/B,MAAM;AACL,8CAAgC;AAChC,mBAAK,oBAAoB;AAAA,YAC1B;AAAA,YACA;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,mBAAmB,CAAC,YAAY;AAC1C,gBAAQ,QAAQ,CAAC,WAAW,KAAK,YAAY,MAAM,CAAC;AAAA,MACrD,CAAC;AAAA,IACF;AACA,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,iBAAiB,CAAC,YAAY;AACxC,gBAAQ,QAAQ,CAAC,WAAW,KAAK,UAAU,MAAM,CAAC;AAAA,MACnD,CAAC;AAAA,IACF;AACA,SAAK,YAAY;AAAA,MAChB,KAAK,MAAM,yBAAyB,CAAC,UAAU;AAC9C,cAAM,cAAqC,CAAC;AAC5C,cAAM,eAAsC,CAAC;AAE7C,mBAAW,QAAQ,OAAO;AACzB,cAAI,KAAK,aAAa,SAAS,QAAQ;AACtC,kBAAM,SAAS;AACf,gBACC,KAAK,WAAW,UAAU;AAAA,cACzB,CAACD,UAASA,MAAK,WAAW,OAAO;AAAA,YAClC,GACC;AAED,0BAAY,KAAK,MAAM;AAAA,YACxB,OAAO;AAEN,2BAAa,KAAK,MAAM;AAAA,YACzB;AAAA,UACD;AAAA,QACD;AAEA,aAAK,mBAAmB,WAAW;AACnC,aAAK,qBAAqB,YAAY;AAAA,MACvC,CAAC;AAAA,IACF;AAGA,UAAM,KAAK,4BAA4B,KAAK,WAAW,WAAW,IAAI;AAEtE,UAAM,KAAK,sBAAsB;AAGjC,SAAK,2BAA2B,KAAK,UAAU,UAAU;AAAA,MAAI,CAAC,SAC7D,KAAK,kBAAkB,IAAI;AAAA,IAC5B;AACA,SAAK,2BACJ,KAAK,UAAU,UAAU;AAAA,MACxB,CAAC,aACA,KAAK,cAAc,MAAM,YACzB,SAAS,cAAc,cAAc;AAAA,IACvC,KAAK;AAEN,SAAK,YAAY;AAAA,MAChB,KAAK,UAAU,qBAAqB,CAAC,MAAM;AAC1C,YAAI,KAAK,aAAa;AACrB;AAAA,QACD;AAGA,SAAC,GAAG,EAAE,OAAO,EAAE,QAAQ,EAAE,QAAQ,CAAC,WAAW;AAC5C,gBAAM,CAAC,OAAO,SAAS,QAAQ,IAAI;AACnC,gBAAM,eAAe,KAAK,yBAAyB;AAAA,YAClD;AAAA,YACA;AAAA,YACA,GAAG,SAAS,IAAI,CAAC,SAAS,KAAK,kBAAkB,IAAI,CAAC;AAAA,UACvD;AAEA,kBAAQ,YAAY;AAAA,QACrB,CAAC;AAED,YACC,EAAE,QAAQ;AAAA,UAAK,CAAC,MACf,EAAE,CAAC,EAAE,KAAK,CAAC,SAAS,KAAK,aAAa,SAAS,MAAM;AAAA,QACtD,GACC;AACD,eAAK,6BAA6B;AAAA,QACnC;AAAA,MACD,CAAC;AAAA,IACF;AAEA,QAAI,KAAK,YAAY;AACpB,WAAK,MAAM;AAAA,QACV,KAAK,cAAc,KAAK,WAAW,MAAM;AAAA,QACzC,KAAK,WAAW;AAAA,MACjB;AAAA,IACD,OAAO;AACN,WAAK,MAAM,OAAO;AAAA,IACnB;AAEA,SAAK,gBAAgB,qBAAqB;AAG1C,SAAK,qBAAqB,SAAS;AAAA,EACpC;AAAA,EAEQ,kBAAkB,MAAsB;AAC/C,UAAM,QAAQ,IAAI,gBAAgB;AAElC,UAAM;AAAA,MACL,KAAK,kBAAkB,CAAC,MAAM;AAE7B,YAAI,EAAE,eAAe,EAAE,YAAY;AAClC,eAAK;AAAA,YACJ;AAAA,YACA,KAAK,WAAW;AAAA,YAChB,EAAE;AAAA,UACH;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,QAAI,KAAK,aAAa,SAAS,MAAM;AACpC,YAAM;AAAA,QACJ,KAA2B,mBAAmB,CAAC,YAAY;AAC3D,kBAAQ,QAAQ,CAAC,WAAW,KAAK,YAAY,MAAM,CAAC;AAAA,QACrD,CAAC;AAAA,MACF;AAAA,IACD;AAEA,UAAM;AAAA,MACJ,KAAuB,iBAAiB,CAAC,MAAM;AAC/C,YACC,EAAE,yBACF,KAAK,oBACL,KAAK,aAAa,SAAS,QAC1B;AACD,eAAK,mBAAmB,CAAC,IAA2B,CAAC;AAAA,QACtD;AAEA,YACC,EAAE,0BACF,KAAK,qBACL,KAAK,aAAa,SAAS,MAC1B;AACD,eAAK,kBAAkB;AAAA,YAAQ,CAAC,WAC/B,KAAK,UAAU,MAAM;AAAA,UACtB;AAAA,QACD;AAEA,YAAI,EAAE,kBAAkB;AACvB,eAAK,uBAAuB,IAAI;AAAA,QACjC;AAAA,MACD,CAAC;AAAA,IACF;AAEA,WAAO;AAAA,EACR;AAAA,EAEQ,2BAAkD;AAAA,EAClD,uBAAuB,MAAsB;AACpD,QAAI,KAAK,cAAc,cAAc,QAAQ;AAC5C;AAAA,IACD;AAEA,QACC,KAAK,4BACL,KAAK,6BAA6B,MACjC;AACD,WAAK,yBAAyB,YAAY,cAAc;AAAA,IACzD;AAEA,SAAK,2BAA2B;AAAA,EACjC;AAAA,EAEA,MAAc,4BACb,WACA,WACA,MACC;AACD,SAAK,WAAW;AAAA,MACf;AAAA,MACA,YAAY,KAAK,WAAW,IAAI,SAAS;AAAA,IAC1C;AACA,UAAM,KAAK,gBAAgB;AAC3B,UAAM,KAAK,mBAAmB;AAE9B,SAAK,WAAW;AAAA,MACf;AAAA,MACA;AAAA,IACD;AAGA,SAAK,SAAU,QAAQ,MAAM,aAAa;AAE1C,UAAM,KAAK,6BAA6B,WAAW,SAAS;AAC5D,SAAK,WAAW;AAAA,MACf;AAAA,MACA;AAAA,IACD;AAUA,SAAK,MAAM,OAAO,GAAG,CAAC;AACtB,SAAK,MAAM,gBAAgB,SAAS;AAKpC,SAAK,MAAM,YAAY,WAAW,gBAAgB,OAAO;AACzD,SAAK,OAAO,wDAAwD;AACpE,SAAK,SAAU,QAAQ,MAAM,aAAa;AAC1C,SAAK,WAAW;AAAA,MACf;AAAA,MACA;AAAA,IACD;AACA,SAAK,sBAAsB,KAAK;AAAA,EACjC;AAAA,EAEA,MAAc,6BACb,WACA,WACC;AACD,QAAI,aAAa,UAAU,kBAAkB;AAC5C,YAAM,mBAAmB,UAAU;AACnC,YAAM,YAAY,UAAU,gBAAgB,OAAO;AACnD,YAAM,eACL,YAAY,KAAK,IAAI,KAAK,YAAY,UAAU,GAAG,IAAI;AAExD,UAAI,SAAS;AACb,YAAM,WAAuC,CAAC;AAE9C,eAAS,IAAI,GAAG,IAAI,UAAU,QAAQ,KAAK;AAC1C,cAAM,OAAO,UAAU,OAAO,CAAC;AAC/B,cAAM,aAAa,iBAAiB,CAAC,KAAK;AAE1C,YAAI,SAAS,aAAa,WAAW;AACpC,oBAAU;AACV;AAAA,QACD;AAEA,YAAI,KAAK,aAAa,SAAS,QAAQ;AACtC,mBAAS,KAAK,CAAC,MAAM,MAAM,CAAC;AAAA,QAC7B;AAEA,kBAAU;AAEV,YAAI,SAAS,cAAc;AAC1B;AAAA,QACD;AAAA,MACD;AAEA,YAAM,KAAK,SAAU;AAAA,QACpB,SAAS;AAAA,UAAI,CAAC,CAAC,OAAOE,OAAM,MAC3B,KAAK,+BAA+B,OAAOA,OAAM;AAAA,QAClD;AAAA,MACD;AAAA,IACD,OAAO;AACN,YAAM,eAAe,UAAU,UAC7B,OAAO,CAAC,SAAS,KAAK,aAAa,SAAS,MAAM,EAClD,MAAM,GAAG,CAAC,EACV;AAAA,QAAI,CAAC,SACL,KAAK,+BAA+B,MAAM,IAAM;AAAA,MACjD;AAED,YAAM,KAAK,SAAU,iBAAiB,YAAY;AAIlD,UAAI,SAAS;AACb,YAAM,uBAAsD,CAAC;AAC7D,YAAM,eAAe,KAAK,IAAI,KAAK,YAAY,UAAU,GAAG,IAAI;AAChE,iBAAW,QAAQ,UAAU,WAAW;AACvC,YAAI,KAAK,aAAa,SAAS,QAAQ;AACtC,+BAAqB,KAAK,EAAE,IAAI,KAAK,IAAI,KAAK,OAAO,CAAC;AAAA,QACvD;AAEA,kBAAU,KAAK;AAAA,UACd,KAAK,cAAc,EAAE,SAAS;AAAA,QAC/B;AAEA,YAAI,SAAS,cAAc;AAC1B;AAAA,QACD;AAAA,MACD;AAEA,WAAK,UAAU,iBAAiB,CAAC,GAAG,oBAAoB;AAAA,IACzD;AAAA,EACD;AAAA,EAEQ,+BACP,OACA,QAC4B;AAC5B,WAAO;AAAA,MACN,MAAM,MAAM;AAAA,MACZ,QAAQ,MAAM;AAAA,MACd,YAAY,MAAM;AAAA,MAClB,SAAS,MAAM,QAAQ;AAAA,MACvB;AAAA,MACA,SAAS;AAAA,MACT,UAAU,MAAM;AAAA,IACjB;AAAA,EACD;AAAA,EAEA,qBACC,WACO;AACP,QAAI,CAAC,KAAK,WAAW;AACpB;AAAA,IACD;AAEA,QAAI,WAAW,mBAAmB,QAAW;AAC5C,WAAK,MAAM,YAAY,UAAU,eAAe;AAChD,WAAK,MAAM,aAAa,UAAU,eAAe;AAAA,IAClD,OAAO;AACN,WAAK,MAAM,YAAY;AACvB,WAAK,MAAM,aAAa;AAAA,IACzB;AAEA,UAAM,WACL,OAAO,WAAW,UAAU,WAAW,UAAU,QAAQ;AAC1D,QAAI,WAAW,KAAK,UAAU,QAAQ;AACrC,YAAM,UAAU,KAAK,UAAU,OAAO,QAAQ;AAC9C,UAAI,SAAS;AACZ,aAAK,WAAW,sBAAsB;AAAA,UACrC,MAAM,mBAAmB;AAAA,UACzB,SAAS,QAAQ;AAAA,UACjB,YAAY,CAAC,QAAQ,MAAM;AAAA,QAC5B,CAAC;AAAA,MACF;AAAA,IACD,WAAW,KAAK,MAAM,SAAS,GAAG;AACjC,WAAK,UAAU,sBAAsB;AAAA,QACpC,MAAM,mBAAmB;AAAA,QACzB,OAAO,EAAE,OAAO,GAAG,KAAK,EAAE;AAAA,QAC1B,YAAY,CAAC,EAAE,OAAO,GAAG,KAAK,EAAE,CAAC;AAAA,MAClC,CAAC;AAAA,IACF;AAEA,QAAI,WAAW,eAAe;AAC7B,YAAM,OAAO,KAAK,UAAU,OAAO,QAAQ;AAC3C,UAAI,MAAM;AACT,aAAK,YAAY,cAAc;AAAA,MAChC;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,uBACP,WACO;AACP,QAAI,WAAW,oBAAoB,KAAK,WAAW;AAClD,YAAM,WAAW,KAAK,sBAAsB;AAAA,QAC3C,KAAK;AAAA,MACN;AACA,YAAM,SAAS,SAAS,IAAI;AAAA,QAC3B,CAAC,MAAM,EAAE,OAAO,UAAU;AAAA,MAC3B;AAGA,UAAI,UAAU,CAAC,SAAS,UAAU;AACjC,aAAK,sBAAsB;AAAA,UAC1B;AAAA,UACA,KAAK;AAAA,QACN;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,qBAA+C;AAC9C,UAAM,QAAQ,KAAK,WAAW,mBAAmB;AACjD,QAAI,CAAC,OAAO;AACX,aAAO;AAAA,QACN,cAAc,CAAC;AAAA,QACf,sBAAsB,CAAC;AAAA,QACvB,kBAAkB,CAAC;AAAA,QACnB,qBAAqB,CAAC;AAAA,QACtB,sBAAsB,CAAC;AAAA,MACxB;AAAA,IACD;AAEA,QAAI,KAAK,OAAO;AACf,YAAM,iBAAiB;AAAA,QACtB,MAAM,KAAK,MAAM;AAAA,QACjB,KAAK,KAAK,MAAM;AAAA,MACjB;AACA,YAAM,cAAyC,CAAC;AAChD,eAAS,IAAI,GAAG,IAAI,KAAK,UAAW,QAAQ,KAAK;AAChD,cAAM,MAAM,KAAK,UAAW,OAAO,CAAC;AACpC,oBAAY,CAAC,IAAI,IAAI,WAAW;AAAA,MACjC;AAEA,YAAM,mBAAmB;AAEzB,UAAI,KAAK,WAAW;AACnB,cAAM,aAAa,KAAK,UAAU,SAAS;AAC3C,cAAM,UAAU,KAAK,UAAU,OAAO,WAAW,KAAK;AACtD,YAAI,SAAS;AACZ,gBAAM,UAAU,KAAK,MAAM,oBAAoB,OAAO;AACtD,gBAAM,gBACL,QAAQ,aAAa,MAAM,cAAc,WACzC,CAAC,EACA,WACA,QAAQ,cAAc,iBACtB,QAAQ;AAAA,YACP,QAAQ,cAAc;AAAA,UACvB;AAGF,gBAAM,gBAAgB;AACtB,gBAAM,QAAQ,WAAW;AAAA,QAC1B;AAAA,MACD;AAAA,IACD;AAGA,UAAM,qBAAiD,CAAC;AACxD,eAAW,CAAC,IAAI,YAAY,KAAK,KAAK,gBAAgB;AACrD,UAAI,OAAO,aAAa,kBAAkB,YAAY;AACrD,2BAAmB,EAAE,IAAI,aAAa,cAAc;AAAA,MACrD;AAAA,IACD;AACA,UAAM,qBAAqB;AAC3B,QAAI,KAAK,WAAW,IAAI,WAAW,QAAQ,UAAU;AACpD,YAAM,mBAAmB,KAAK,cAAc;AAAA,IAC7C;AAEA,WAAO;AAAA,EACR;AAAA,EAEQ,6BAA6B;AACpC,WAAO,KAAK,yBAAyB,CAAC,KAAK;AAAA,EAC5C;AAAA,EAEQ,cAAc,iBAAyB;AAC9C,WAAO,KAAK;AAAA,MACX,mBACE,KAAK,qBAAqB;AAAA;AAAA,QACF;AAAA,UACtB;AAAA,MACJ;AAAA,IACD;AAAA,EACD;AAAA,EAEA,OACC,WACA,eACA,UACO;AACP,QAAI,CAAC,iBAAiB,KAAK,2BAA2B,MAAM;AAC3D,WAAK,aAAa;AAClB,WAAK,YAAY;AACjB;AAAA,IACD;AAEA,QAAI,UAAU,SAAS,KAAK,UAAU,UAAU,GAAG;AAClD,WAAK,WAAW;AAChB;AAAA,IACD;AAEA,UAAM,4BACL,KAAK,cAAc;AAAA,MAClB,IAAI,UAAU,KAAK,WAAW,CAAC;AAAA,IAChC;AACD,QAAI,2BAA2B;AAI9B,gCAA0B;AAAA,QAAK,MAC9B,KAAK,eAAe,WAAW,eAAe,QAAQ;AAAA,MACvD;AAAA,IACD,OAAO;AACN,WAAK,eAAe,WAAW,eAAe,QAAQ;AAAA,IACvD;AAAA,EACD;AAAA,EAEQ,eACP,WACA,eACA,UACC;AACD,QAAI,eAAe;AAClB,WAAK,oBAAoB,eAAe,WAAW,QAAQ;AAAA,IAC5D;AAEA,QACC,KAAK,0BACL,KAAK,uBAAuB,SAAS,KACrC,KAAK,uBAAuB,UAAU,GACrC;AACD,WAAK,WAAW;AAChB;AAAA,IACD;AAEA,SAAK,aAAa;AAClB,SAAK,YAAY;AACjB,UAAM,gBACL,KAAK,cAAc,UAAU,MAAM,IACnC,KAAK,cAAc,EAAE;AACtB,QAAI,KAAK,KAAK,OAAO,UAAU,OAAO,aAAa;AAEnD,UAAM,oBAAoB;AAC1B,QAAI,KAAK,MAAM,gBAAgB,IAAI,mBAAmB;AAErD,WAAK,MAAM,cAAc;AAAA,QACxB,eAAe,KAAK,2BAA2B,IAC5C,KAAK,IAAI,GAAG,oBAAoB,EAAE,IAClC;AAAA,QACH,YAAY;AAAA,MACb,CAAC;AACD,WAAK,MAAM,OAAO,mBAAmB,UAAU,KAAK;AAAA,IACrD,OAAO;AAEN,WAAK,MAAM,OAAO,mBAAmB,UAAU,KAAK;AACpD,WAAK,MAAM,cAAc;AAAA,QACxB,eAAe,KAAK,2BAA2B,IAC5C,KAAK,IAAI,GAAG,oBAAoB,EAAE,IAClC;AAAA,QACH,YAAY;AAAA,MACb,CAAC;AAAA,IACF;AAEA,SAAK,kBAAkB,QAAQ;AAC/B,SAAK,kBAAkB,MAAM,aAAa;AAC1C,SAAK,kBAAkB,MAAM,UAAU;AACvC,SAAK,kBAAkB,MAAM,WAAW;AACxC,SAAK,kBAAkB,MAAM,WAAW;AAExC,SAAK,iCAAiC,WAAW,QAAQ;AAEzD,QAAI,KAAK,0BAA0B;AAClC,WAAK,yBAAyB,MAAM,SAAS,GAAG,UAAU,MAAM;AAChE,WAAK,yBAAyB,MAAM,QAAQ,GAAG,UAAU,KAAK;AAAA,IAC/D;AAEA,SAAK,oBAAoB,OAAO,KAAK,UAAU;AAC/C,SAAK,uBAAuB,OAAO;AAEnC,SAAK,cAAc,gBAAgB,KAAK;AAAA,MACvC,IAAI;AAAA,QACH,EAAE,OAAO,MAAM,UAAU,KAAK;AAAA,QAC9B,KAAK,cAAc;AAAA,MACpB;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEQ,oBACP,eACA,WACA,UACC;AACD,SAAK,iBAAiB;AACtB,QAAI,aAAa,UAAU;AAC1B,WAAK,yBAAyB;AAAA,QAC7B,QAAQ,UAAU;AAAA,QAClB,OAAO,UAAU;AAAA,QACjB,KAAK,SAAS;AAAA,QACd,MAAM,SAAS;AAAA,MAChB;AAAA,IACD,OAAO;AAEN,YAAM,gBAAgB,cAAc,sBAAsB;AAC1D,WAAK,yBAAyB;AAAA,QAC7B,QAAQ,cAAc;AAAA,QACtB,OAAO,cAAc;AAAA,QACrB,KAAK,cAAc;AAAA,QACnB,MAAM,cAAc;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,iCACP,WACA,UACO;AACP,QAAI,aAAa,UAAU;AAC1B,WAAK,kBAAkB,MAAM,MAAM,GAAG,SAAS,GAAG;AAClD,WAAK,kBAAkB,MAAM,OAAO,GAAG,SAAS,IAAI;AACpD,WAAK,kBAAkB,MAAM,QAAQ,GAAG,UAAU,KAAK;AACvD,WAAK,kBAAkB,MAAM,SAAS,GAAG,UAAU,MAAM;AACzD;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,wBAAwB;AACjC;AAAA,IACD;AAEA,UAAM,uBACL,KAAK,kBAAkB,eAAe,sBAAsB;AAC7D,SAAK,kBAAkB,MAAM,MAAM,GAAG,KAAK,uBAAuB,OAAO,sBAAsB,OAAO,EAAE;AACxG,SAAK,kBAAkB,MAAM,OAAO,GAAG,KAAK,uBAAuB,QAAQ,sBAAsB,QAAQ,EAAE;AAC3G,SAAK,kBAAkB,MAAM,QAAQ,GAAG,YAAY,UAAU,QAAQ,KAAK,uBAAuB,KAAK;AACvG,SAAK,kBAAkB,MAAM,SAAS,GAAG,YAAY,UAAU,SAAS,KAAK,uBAAuB,MAAM;AAAA,EAC3G;AAAA;AAAA;AAAA,EAKA,QAAQ;AACP,SAAK,aAAa;AAClB,SAAK,aAAa,IAAI,IAAI;AAE1B,QAAI,KAAK,iBAAiB;AACzB,WAAK,UAAU,aAAa;AAAA,IAC7B,OAAO;AACN,UAAI,KAAK,WAAW;AACnB,cAAM,aAAa,KAAK,UAAU,SAAS;AAC3C,cAAM,UAAU,KAAK,UAAU,OAAO,WAAW,KAAK;AAGtD,YAAI,CAAC,KAAK,eAAe,GAAG;AAC3B,eAAK,eAAe;AAEpB,eAAK,kBAAkB;AAAA,QACxB;AAEA,YAAI,WAAW,QAAQ,cAAc,cAAc,QAAQ;AAC1D,kBAAQ;AAAA,YACP,cAAc;AAAA,YACd;AAAA,UACD;AACA,kBAAQ,YAAY,cAAc;AAClC,eAAK,YAAY,OAAO;AACxB;AAAA,QACD;AAAA,MACD;AAEA,WAAK,MAAM,SAAS;AAAA,IACrB;AAEA,QAAI,KAAK,kBAAkB;AAE1B,WAAK,aAAa;AAAA,IACnB;AAAA,EACD;AAAA,EAEA,SAAS;AACR,SAAK,aAAa;AAAA,EACnB;AAAA,EAEQ,YAAY,eAAoC;AACvD,eAAW,CAAC,SAAS,MAAM,KAAK,KAAK,iBAAiB,QAAQ,GAAG;AAChE,UAAI,YAAY,eAAe;AAC9B,eAAO,MAAM;AACb;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,eAAe,iBAAiB,OAAO;AACtC,QAAI,KAAK,iBAAiB;AACzB,WAAK,UAAU,aAAa;AAAA,IAC7B,OAAO;AACN,WAAK,MAAM,eAAe,cAAc;AAAA,IACzC;AAAA,EACD;AAAA,EAEA,oBAAoB,MAAsB;AACzC,SAAK,UAAU,qBAAqB,IAAI;AAAA,EACzC;AAAA,EAEA,oBAAoB,MAAsB;AACzC,SAAK,UAAU,oBAAoB,IAAI;AAAA,EACxC;AAAA,EAEA,aAAa;AACZ,SAAK,aAAa;AAClB,SAAK,aAAa,IAAI,KAAK;AAC3B,SAAK,kBAAkB,QAAQ;AAC/B,SAAK,kBAAkB,MAAM,aAAa;AAC1C,SAAK,kBAAkB,MAAM,OAAO;AACpC,SAAK,6BAA6B,MAAM,UAAU;AAClD,SAAK,uBAAuB;AAAA,EAC7B;AAAA,EAEQ,yBAAyB;AAChC,SAAK,iBAAiB,QAAQ,CAAC,QAAQ,SAAS;AAC/C,UAAI,KAAK,cAAc,MAAM,QAAQ,QAAQ;AAC5C,0BAAkB,IAAI,MAAM,GAAG,oBAAoB;AACnD,iCAAyB,IAAI,MAAM,GAAG,aAAa;AACnD,4BAAoB,IAAI,MAAM,GAAG,aAAa;AAAA,MAC/C;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAEQ,oBAA6B;AACpC,WAAO,IAAI,0BAA0B,KAAK,WAAW,CAAC;AAAA,EACvD;AAAA,EAEA,oBAAoB;AAGnB,SAAK,cAAc,aAAa;AAChC,UAAM,UAAU,KAAK,kBAAkB;AACvC,SAAK,aAAa,IAAI,OAAO;AAC7B,SAAK,WAAW,eAAe,OAAO;AAAA,EACvC;AAAA,EAEA,sBAAsB;AACrB,UAAM,aAAa,KAAK,cAAc;AAEtC,QACC,YAAY,cAAc,cAAc,UACxC,CAAC,KAAK,iBACL;AAED,iBAAW,YAAY,cAAc;AAAA,IACtC;AAAA,EACD;AAAA,EAEA,iBAAiB;AAGhB,SAAK,kBAAkB;AACvB,WAAO,KAAK,kBAAkB;AAAA,EAC/B;AAAA,EAEA,kBAAkB;AACjB,WAAO,KAAK;AAAA,EACb;AAAA,EAEA,yBAAyB;AACxB,QAAI,CAAC,KAAK,eAAe,GAAG;AAC3B,aAAO;AAAA,IACR;AAEA,UAAM,kBAAkB,IAAI,UAAU,KAAK,WAAW,CAAC,EAAE,aAAa;AACtE,QAAI,iBAAiB,eAAe,GAAG;AACtC,aAAO;AAAA,IACR;AAEA,UAAM,kBAAkB,gBAAgB,WAAW,CAAC;AACpD,QACC,gBAAgB,mBAAmB,gBAAgB,gBACnD,gBAAgB,YAAY,gBAAgB,gBAAgB,GAC3D;AACD,aAAO;AAAA,IACR;AAEA,QAAI,YAAiB,gBAAgB;AAErC,QAAI,CAAC,KAAK,MAAM,SAAS,SAAS,GAAG;AACpC,aAAO;AAAA,IACR;AAEA,WAAO,aAAa,cAAc,KAAK,OAAO;AAC7C,UACE,UAA0B,aAC1B,UAA0B,UAAU,SAAS,QAAQ,GACrD;AACD,eAAO;AAAA,MACR;AAEA,kBAAY,UAAU;AAAA,IACvB;AAEA,WAAO;AAAA,EACR;AAAA,EAEA,2BAA2B,UAAmB;AAC7C,SAAK,kBAAkB,IAAI,QAAQ;AAAA,EACpC;AAAA;AAAA;AAAA,EAMA,aAAa,MAAsB;AAClC,SAAK,WAAW,sBAAsB;AAAA,MACrC,MAAM,mBAAmB;AAAA,MACzB,SAAS,KAAK;AAAA,MACd,YAAY,CAAC,KAAK,MAAM;AAAA,IACzB,CAAC;AAAA,EACF;AAAA,EAEA,IAAI,YAAY;AACf,WAAO,KAAK,MAAM;AAAA,EACnB;AAAA,EAEA,IAAI,eAAe;AAClB,WAAO,KAAK,MAAM,YAAY,KAAK,MAAM,gBAAgB;AAAA,EAC1D;AAAA,EAEA,wBAAwB,MAAsB;AAC7C,WAAO,KAAK,MAAM,qBAAqB,IAAI;AAAA,EAC5C;AAAA,EAEA,mBAAmB,MAAsB;AACxC,WAAO,KAAK,MAAM,cAAc,IAAI;AAAA,EACrC;AAAA,EAEA,iBAAiB;AAChB,SAAK,MAAM,eAAe;AAAA,EAC3B;AAAA,EAEA,aAAa,WAAyB;AACrC,SAAK,MAAM,YAAY;AAAA,EACxB;AAAA,EAEA,sBAAsB,OAAmB;AACxC,WAAO,KAAK,MAAM,YAAY,KAAK;AAAA,EACpC;AAAA,EAEA,aAAa,MAAsB;AAClC,WAAO,KAAK,MAAM,WAAW,MAAM,eAAe,OAAO;AAAA,EAC1D;AAAA,EAEA,kBAAkB,MAAsB;AACvC,SAAK,MAAM,WAAW,MAAM,eAAe,GAAG;AAAA,EAC/C;AAAA,EAEA,eAAe,MAAsB;AACpC,SAAK,MAAM,WAAW,MAAM,eAAe,MAAM;AAAA,EAClD;AAAA,EAEA,MAAM,gCAAgC,MAAsB;AAC3D,UAAM,KAAK,MAAM;AAAA,MAChB;AAAA,MACA,eAAe;AAAA,IAChB;AAAA,EACD;AAAA,EAEA,MAAM,iCAAiC,MAAsB;AAC5D,UAAM,KAAK,MAAM;AAAA,MAChB;AAAA,MACA,eAAe;AAAA,IAChB;AAAA,EACD;AAAA,EAEA,MAAM,sBACL,MACA,MACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC;AAAA,MAC1B,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,MAAM,wBACL,MACA,MACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC;AAAA,MAC1B,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,MAAM,yCACL,MACA,MACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA,IAAI,MAAM,MAAM,GAAG,MAAM,CAAC;AAAA,MAC1B,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,MAAM,uBACL,MACA,OACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA;AAAA,MACA,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,MAAM,yBACL,MACA,OACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA;AAAA,MACA,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,MAAM,0CACL,MACA,OACgB;AAChB,WAAO,KAAK,MAAM;AAAA,MACjB;AAAA,MACA;AAAA,MACA,oBAAoB;AAAA,IACrB;AAAA,EACD;AAAA,EAEA,yBAAyB,MAAsB,QAAgB;AAC9D,WAAO,KAAK,MAAM,yBAAyB,MAAM,MAAM;AAAA,EACxD;AAAA,EAEA,sCAAsC,QAAgB;AACrD,WAAO,KAAK,MAAM,sCAAsC,MAAM;AAAA,EAC/D;AAAA,EAEA,yBAAyB,OAAuB;AAC/C,QAAI,CAAC,KAAK,uBAAuB;AAChC,aAAO;AAAA,IACR;AACA,UAAM,OAAO,KAAK,WAAW,UAAU,KAAK;AAC5C,QAAI,CAAC,MAAM;AACV,aAAO;AAAA,IACR;AAEA,WAAO,KAAK,sBAAsB,aAAa,IAAI;AAAA,EACpD;AAAA,EAEA,cAAc,MAA8B;AAC3C,QAAI,CAAC,KAAK,uBAAuB;AAChC,aAAO;AAAA,IACR;AAEA,WAAO,KAAK,sBAAsB,cAAc,IAAI;AAAA,EACrD;AAAA,EAEA,0BACC,YACA,UACyB;AACzB,WAAO,KAAK,sBAAsB;AAAA,MACjC;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAAA,EAEA,gBAAgB,OAAmD;AAClE,WAAO,KAAK,sBAAsB,gBAAgB,KAAK;AAAA,EACxD;AAAA,EAEA,uBAAuB,MAAsB,OAAoB;AAChE,SAAK,MAAM,uBAAuB,MAAM,KAAK;AAAA,EAC9C;AAAA,EAEA,eAAe,SAAgC;AAC9C,WAAO,KAAK,MAAM,eAAe,SAAS,IAAI;AAAA,EAC/C;AAAA,EAEA,4CAA0D;AACzD,WAAO,KAAK,sBAAsB,0CAA0C;AAAA,EAC7E;AAAA;AAAA;AAAA,EAMA,qBACC,gBACA,gBACW;AACX,UAAM,MACL,KAAK,WAAW;AAAA,MACf;AAAA,MACA;AAAA,IACD,KAAK,CAAC;AACP,SAAK,wBAAwB,KAAK;AAClC,WAAO;AAAA,EACR;AAAA,EAEA,6BACC,QACA,OACA,SACC;AACD,SAAK,UAAU,6BAA6B,QAAQ,OAAO,OAAO;AAAA,EACnE;AAAA,EAEA,uBACC,UACW;AACX,WAAO,KAAK,WAAW,uBAA0B,QAAQ,KAAK;AAAA,EAC/D;AAAA;AAAA;AAAA,EAKA,gBACC,UACO;AACP,SAAK,MAAM,gBAAgB,QAAQ;AAAA,EACpC;AAAA;AAAA;AAAA,EAKA,MAAc,sBAAqC;AAClD,QAAI,CAAC,KAAK,SAAS,GAAG;AACrB;AAAA,IACD;AACA,UAAM,EAAE,SAAS,IAAI,KAAK,sBAAsB;AAAA,MAC/C,KAAK;AAAA,IACN;AACA,QAAI,CAAC,KAAK,UAAU,WAAW,GAAG;AACjC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AACA,SAAK,UAAU,qBAAqB,QAAQ;AAAA,EAC7C;AAAA,EAEA,IAAI,eAAe;AAClB,WACC,KAAK,aACL,KAAK,sBAAsB;AAAA,MAC1B,KAAK;AAAA,IACN;AAAA,EAEF;AAAA,EAEA,MAAM,oBAAoB,OAAiD;AAC1E,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,SAAS,GAAG;AACxC;AAAA,IACD;AACA,QAAI,CAAC,OAAO;AACX,cAAQ,KAAK,UAAU;AAAA,IACxB;AACA,WAAO,KAAK,yBAAyB;AAAA,MACpC,KAAK;AAAA,MACL,MAAM,KAAK,KAAK,EAAE,IAAI,CAAC,SAAS,KAAK,MAAM;AAAA,IAC5C;AAAA,EACD;AAAA,EAEA,MAAM,qBACL,OACgB;AAChB,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,SAAS,GAAG;AACxC,WAAK,WAAW;AAAA,QACf;AAAA,QACA;AAAA,MACD;AACA;AAAA,IACD;AACA,QAAI,CAAC,OAAO;AACX,cAAQ,KAAK,UAAU;AAAA,IACxB;AACA,WAAO,KAAK,yBAAyB;AAAA,MACpC,KAAK;AAAA,MACL,MAAM,KAAK,KAAK,EAAE,IAAI,CAAC,MAAM,EAAE,KAAK;AAAA,MACpC,KAAK;AAAA,IACN;AAAA,EACD;AAAA;AAAA;AAAA,EAKQ,kBACP,oBAAI,QAAqC;AAAA,EAC1C,MAAM,mBACL,MACA,QACA,SACgB;AAChB,SAAK,OAAO,eAAe,KAAK,QAAQ,MAAM;AAC9C,UAAM,YAAY,KAAK,MAAM,aAAa,IAAI;AAC9C,QAAI,cAAc,QAAW;AAE5B;AAAA,IACD;AAEA,QAAI,KAAK,iBAAiB,IAAI,IAAI,GAAG;AACpC,WAAK,iBAAiB,IAAI,IAAI,EAAG,QAAQ;AAAA,IAC1C;AAEA,UAAM,WAAW,IAAI,gBAAsB;AAC3C,UAAM,WAAW,6BAAM;AACtB,UAAI,KAAK,aAAa;AACrB;AAAA,MACD;AAEA,UAAI,CAAC,KAAK,WAAW,QAAQ,IAAI,GAAG;AAEnC;AAAA,MACD;AAEA,UAAI,KAAK,MAAM,aAAa,IAAI,MAAM,QAAW;AAEhD;AAAA,MACD;AAEA,UAAI,KAAK,MAAM,cAAc,IAAI,MAAM,QAAQ;AAC9C;AAAA,MACD;AAEA,WAAK,iBAAiB,OAAO,IAAI;AAEjC,UAAI,CAAC,KAAK,eAAe,GAAG;AAG3B,cAAM,YAAY,KAAK,WAAW,aAAa,IAAI;AACnD,cAAM,gBAAgB,KAAK;AAC3B,YACC,cAAc,UACd,iBACA,cAAc,UACd,cAAc,CAAC,EAAE,UAAU;AAAA,QAE3B,KAAK,MAAM,YAAY,KAAK,wBAAwB,IAAI,GACvD;AACD,iBAAO,KAAK,MAAM;AAAA,YACjB;AAAA,YACA;AAAA,YACA,KAAK,IAAI,YAAY,GAAG,KAAK,UAAU,IAAI,CAAC;AAAA,UAC7C;AAAA,QACD;AAAA,MACD;AAEA,WAAK,MAAM,qBAAqB,MAAM,MAAM;AAC5C,eAAS,SAAS,MAAS;AAAA,IAC5B,GA5CiB;AA8CjB,QAAI,KAAK,MAAM,wBAAwB;AACtC,YAAM,mBAAmB,IAAI;AAAA,QAC5B,IAAI,UAAU,KAAK,WAAW,CAAC;AAAA,QAC/B;AAAA,MACD;AAEA,WAAK,iBAAiB;AAAA,QACrB;AAAA,QACA,aAAa,MAAM;AAClB,2BAAiB,QAAQ;AACzB,mBAAS,SAAS,MAAS;AAAA,QAC5B,CAAC;AAAA,MACF;AAAA,IACD,OAAO;AACN,eAAS;AAAA,IACV;AAEA,WAAO,SAAS;AAAA,EACjB;AAAA,EAEA,gBAAgB;AACf,UAAM,WAAW,KAAK,MAAM,mBAAmB;AAE/C,QAAI,YAAY,SAAS,QAAQ;AAChC,aAAO,SAAS,CAAC;AAAA,IAClB;AAEA,WAAO;AAAA,EACR;AAAA,EAEQ,6BACP,cACA,oBACO;AACP,UAAM,oBAAoB,KAAK,MAAM,oBAAoB;AACzD,UAAM,aAAa,kBAAkB,SAAS,YAAY;AAE1D,UAAM,oBAAoB,qBACtB,kBAAkB,kBAAkB,SAAS,CAAC,KAAK,eACpD;AACH,UAAM,gBAAgB,KAAK,MAAM,aAAa,YAAY;AAC1D,UAAM,gBAAgB,KAAK,MAAM,aAAa,iBAAiB;AAE/D,UAAM,wBAAwB,KAAK;AAAA,MAClC;AAAA,MACA;AAAA,IACD;AACA,QAAI,YAAY;AAEf,WAAK,MAAM;AAAA,QACV,kBAAkB;AAAA,UACjB,CAAC,YAAY,CAAC,sBAAsB,SAAS,OAAO;AAAA,QACrD;AAAA,MACD;AAAA,IACD,OAAO;AAEN,WAAK,aAAa,YAAY;AAC9B,WAAK,MAAM,eAAe;AAAA,QACzB,GAAG,kBAAkB;AAAA,UACpB,CAAC,YAAY,CAAC,sBAAsB,SAAS,OAAO;AAAA,QACrD;AAAA,QACA,GAAG;AAAA,MACJ,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,oBACP,eACA,aACmB;AACnB,UAAM,uBAAyC,CAAC;AAChD,aAAS,QAAQ,GAAG,QAAQ,KAAK,MAAM,QAAQ,EAAE,OAAO;AACvD,YAAM,OAAO,KAAK,MAAM,QAAQ,KAAK;AACrC,UAAI,MAAM;AACT,YACE,SAAS,iBAAiB,SAAS,eACnC,SAAS,eAAe,SAAS,eACjC;AACD,+BAAqB,KAAK,IAAI;AAAA,QAC/B;AAAA,MACD;AAAA,IACD;AACA,WAAO;AAAA,EACR;AAAA,EAEA,MAAM,kBACL,MACA,WACA,SACC;AACD,QAAI,KAAK,aAAa;AACrB;AAAA,IACD;AAEA,SAAK,kBAAkB;AAEvB,QAAI,cAAc,UAAU;AAC3B,WAAK,aAAa,IAAI;AACtB,WAAK,MAAM,UAAU;AAErB,WAAK,gBAAgB,cAAc,SAAS,mBAAmB;AAC/D,WAAK,YAAY,cAAc;AAC/B,UAAI,CAAC,SAAS,YAAY;AACzB,YAAI,OAAO,SAAS,oBAAoB,UAAU;AACjD,eAAK,eAAe,IAAI,IAAI;AAC5B,gBAAM,KAAK;AAAA,YACV;AAAA,YACA,QAAQ;AAAA,UACT;AACA,gBAAM,SAAS,KAAK,iBAAiB,IAAI,IAAI;AAC7C,gBAAM,kBAAkB,QAAQ;AAChC,kBAAQ,aAAa;AAAA,YACpB,iBAAiB;AAAA,YACjB,aAAa;AAAA,YACb,eAAe;AAAA,YACf,WAAW;AAAA,UACZ,CAAC;AAAA,QACF,OAAO;AACN,gBAAM,0BACL,KAAK,2BAA2B;AACjC,cAAI,yBAAyB,QAAQ;AACpC,kBAAM,yBACL,wBAAwB,CAAC;AAC1B,kBAAM,KAAK;AAAA,cACV;AAAA,cACA,MAAM;AAAA,gBACL;AAAA,gBACA;AAAA,cACD;AAAA,YACD;AAAA,UACD,OAAO;AACN,kBAAM,KAAK,aAAa,IAAI;AAAA,UAC7B;AAAA,QACD;AAAA,MACD;AAAA,IACD,WAAW,cAAc,UAAU;AAClC,WAAK,aAAa,IAAI;AAEtB,UAAI,CAAC,KAAK,eAAe,GAAG;AAC3B,aAAK,MAAM,UAAU;AAAA,MACtB;AAEA,UAAI,CAAC,KAAK,UAAU;AACnB;AAAA,MACD;AAEA,YAAM,gBAAgB,KAAK,kBAAkB;AAAA,QAC5C,CAAC,MAAM,EAAE,MAAM;AAAA,MAChB,GAAG,MAAM;AACT,YAAM,iBACL,SAAS,YAAY,iBAAiB,KAAK;AAC5C,WAAK,SAAS;AAAA,QACb;AAAA,QACA,SAAS;AAAA,QACT,SAAS,wBAAwB,KAAK;AAAA,MACvC;AAEA,WAAK,gBAAgB,cAAc,SAAS,mBAAmB;AAC/D,WAAK,YAAY,cAAc;AAC/B,WAAK,kBAAkB,SAAS;AAChC,WAAK,aAAa,IAAI,IAAI;AAC1B,UAAI,CAAC,SAAS,YAAY;AACzB,aAAK,gCAAgC,IAAI;AAAA,MAC1C;AAAA,IACD,OAAO;AAEN,YAAM,UAAU,KAAK,MAAM,oBAAoB,IAAI;AACnD,UACC,WACA,QAAQ,cAAc,iBACtB,QAAQ,SAAS,QAAQ,cAAc,aAAa,GACnD;AACD,QAAC,QAAQ,cAAc,cAA8B,KAAK;AAAA,MAC3D;AAEA,WAAK,UAAU,WAAW;AAE1B,WAAK,gBAAgB,cAAc,SAAS,mBAAmB;AAC/D,WAAK,YAAY,cAAc;AAE/B,WAAK,aAAa,IAAI;AACtB,UAAI,CAAC,SAAS,YAAY;AACzB,YAAI,OAAO,SAAS,oBAAoB,UAAU;AACjD,eAAK,eAAe,IAAI,IAAI;AAC5B,gBAAM,KAAK,aAAa,IAAI;AAAA,QAC7B,WACC,SAAS,mBAAmB,uBAAuB,WAClD;AACD,gBAAM,KAAK,iCAAiC,IAAI;AAAA,QACjD,WACC,SAAS,mBAAmB,uBAAuB,UAClD;AACD,gBAAM,KAAK,aAAa,IAAI;AAAA,QAC7B,OAAO;AACN,gBAAM,KAAK,gCAAgC,IAAI;AAAA,QAChD;AAAA,MACD;AACA,WAAK,MAAM,UAAU;AACrB,WAAK,kBAAkB;AAAA,IACxB;AAAA,EACD;AAAA,EAEA,MAAM,sBACL,MACA,WACC;AACD,UAAM,MAAM,KAAK,WAAW,aAAa,IAAI;AAC7C,QAAI,OAAO,QAAQ,UAAU;AAC5B;AAAA,IACD;AAEA,UAAM,UAAU,KAAK,WAAW,OAAO,MAAM,CAAC;AAC9C,QAAI,CAAC,SAAS;AACb;AAAA,IACD;AAEA,UAAM,KAAK,kBAAkB,SAAS,SAAS;AAAA,EAChD;AAAA;AAAA;AAAA,EAMA,MAAc,YAAY,UAA6B;AACtD,QAAI,SAAS,mBAAmB;AAC/B;AAAA,IACD;AAEA,UAAM,UAAU,SAAS;AACzB,eAAW,UAAU,QAAQ,MAAM,GAAG,kBAAkB,GAAG;AAC1D,YAAM,CAAC,WAAW,IAAI,IAAI,OAAO;AAAA,QAChC,KAAK;AAAA,QACL;AAAA,MACD;AACA,UACC,CAAC,UAAU,KAAK,CAAC,aAAa,SAAS,SAAS,KAChD,UAAU,WAAW,GACpB;AACD;AAAA,MACD;AAEA,YAAM,yBAAyB,UAAU,IAAI;AAE7C,UAAI,CAAC,wBAAwB;AAC5B;AAAA,MACD;AAEA,YAAM,WAAW,KAAK,iBAAiB;AAAA,QACtC,uBAAuB;AAAA,MACxB;AAEA,UAAI,CAAC,UAAU;AACd;AAAA,MACD;AAEA,YAAM,SAA6B;AAAA,QAClC,MAAM,iBAAiB;AAAA,QACvB;AAAA,QACA,QAAQ;AAAA,QACR,UAAU,uBAAuB;AAAA,MAClC;AACA,YAAM,QAAQ,KAAK,UAAU,aAAa,IAAI,OAAO,MAAM;AAC3D,UAAI,CAAC,SAAS,CAAC,MAAM,aAAa;AACjC,cAAM,IAAI,IAAI,QAAc,CAAC,YAAY;AACxC,eAAK;AAAA,YACJ,MAAM;AAAA,cACL,KAAK;AAAA,cACL,KAAK;AAAA,YACN,EAAE,CAAC,MAAM;AACR,kBAAI,EAAE,UAAU,OAAO,OAAO,OAAO;AACpC,wBAAQ;AAAA,cACT;AAAA,YACD,CAAC;AAAA,UACF;AAAA,QACD,CAAC;AACD,aAAK,aAAa,UAAU,QAAQ,GAAG,KAAK;AAC5C,cAAM;AAAA,MACP,OAAO;AAEN,aAAK,aAAa,UAAU,QAAQ,GAAG,KAAK;AAAA,MAC7C;AAEA;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAc,WAAW,eAAwB;AAChD,QAAI,CAAC,KAAK,SAAS,KAAK,CAAC,KAAK,WAAW;AACxC;AAAA,IACD;AAEA,UAAM,QAAQ,KAAK,UAAU;AAC7B,UAAM,WAAW,CAAC;AAElB,aAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AACtC,UACC,MAAM,CAAC,EAAE,aAAa,SAAS,UAC/B,CAAC,KAAK,SAAU,qBAAqB,IAAI,MAAM,CAAC,EAAE,EAAE,GACnD;AACD,iBAAS,KAAK,KAAK,oBAAoB,MAAM,CAAC,CAAC,CAAC;AAAA,MACjD;AAAA,IACD;AAEA,QAAI,iBAAiB,KAAK,OAAO;AAChC,eAAS,IAAI,GAAG,IAAI,KAAK,MAAM,QAAQ,KAAK;AAC3C,cAAM,OAAO,KAAK,MAAM,QAAQ,CAAC;AAEjC,YAAI,MAAM,aAAa,SAAS,MAAM;AACrC,mBAAS,KAAK,KAAK,YAAY,IAAyB,CAAC;AAAA,QAC1D;AAAA,MACD;AAAA,IACD;AAEA,WAAO,QAAQ,IAAI,QAAQ;AAAA,EAC5B;AAAA,EAEA,MAAM,KACL,OACA,SACA,OACA,aAAa,OACb,6BAA6B,OAC7B,SACoC;AACpC,QAAI,CAAC,KAAK,oBAAoB;AAC7B,aAAO,CAAC;AAAA,IACT;AAEA,QAAI,CAAC,SAAS;AACb,gBAAU,KAAK,MAAM;AAAA,IACtB;AAEA,UAAM,cAAc,KAAK,mBACvB,KAAK,OAAO,OAAO,EACnB,OAAO,CAAC,UAAU,MAAM,SAAS,CAAC;AAEpC,QACE,CAAC,QAAQ,wBAAwB,CAAC,QAAQ,iBAC3C,QAAQ,WAAW,kBAAkB,sBAAsB,MAC1D;AACD,WAAK,UAAU,SAAS,OAAO;AAC/B,aAAO;AAAA,IACR;AAIA,UAAM,WAAsD,CAAC;AAC7D,gBAAY,QAAQ,CAAC,UAAU;AAC9B,eAAS,MAAM,KAAK,EAAE,IAAI;AAAA,IAC3B,CAAC;AAED,QAAI,KAAK,UAAU;AAGlB,YAAM,QAAQ,KAAK,IAAI;AACvB,YAAM,KAAK,WAAW,CAAC,CAAC,QAAQ,aAAa;AAC7C,YAAM,MAAM,KAAK,IAAI;AACrB,WAAK,WAAW,MAAM,QAAQ,gBAAgB,MAAM,KAAK,IAAI;AAE7D,UAAI,MAAM,yBAAyB;AAClC,eAAO,CAAC;AAAA,MACT;AAEA,UAAI,UAAoB,CAAC;AACzB,UACC,QAAQ,aACR,QAAQ,UAAU,kBACjB,sBAAsB,SACvB,QAAQ,UAAU,oBACjB;AACD,cAAM,kBAAkB;AAAA,UACvB,QAAQ,UAAU;AAAA,QACnB;AACA,kBAAU,gBAAgB;AAAA,UACzB,CAAC,UACA,KAAK,oBAAoB,UAAU,KAAK,EAAE,MAAM;AAAA,QAClD;AAAA,MACD;AAEA,YAAM,iBAAiB,MAAM,KAAK,SAAS,KAAK,OAAO;AAAA,QACtD,eAAe,QAAQ;AAAA,QACvB,WAAW,QAAQ;AAAA,QACnB,eAAe,CAAC,CAAC,QAAQ;AAAA,QACzB,eAAe,CAAC,CAAC,QAAQ;AAAA,QACzB;AAAA,QACA;AAAA,QACA;AAAA,MACD,CAAC;AAED,UAAI,MAAM,yBAAyB;AAClC,eAAO,CAAC;AAAA,MACT;AAGA,qBAAe,QAAQ,CAAC,UAAU;AACjC,cAAM,OAAO,KAAK,mBAAoB,UAAU;AAAA,UAC/C,CAACF,UAASA,MAAK,OAAO,MAAM;AAAA,QAC7B;AAEA,YAAI,CAAC,MAAM;AACV;AAAA,QACD;AAEA,YAAI,MAAM,SAAS,WAAW;AAE7B,cACC,KAAK,aAAa,MAAM,cAAc,WACtC,CAAC,QAAQ,sBACR;AACD;AAAA,UACD;AAEA,cACC,KAAK,aAAa,MAAM,cAAc,WACtC,QAAQ,oBACP;AACD;AAAA,UACD;AAAA,QACD,WAAW,CAAC,QAAQ,eAAe;AAElC;AAAA,QACD;AAEA,cAAM,iBAAiB,SAAS,MAAM,MAAM;AAE5C,YAAI,gBAAgB;AACnB,yBAAe,eAAe,KAAK,KAAK;AAAA,QACzC,OAAO;AACN,mBAAS,MAAM,MAAM,IAAI,IAAI;AAAA,YAC5B,KAAK,mBAAoB,UAAU;AAAA,cAClC,CAACA,UAASA,MAAK,OAAO,MAAM;AAAA,YAC7B;AAAA,YACA,KAAK,mBAAoB,UAAU;AAAA,cAClC,CAACA,UAASA,MAAK,OAAO,MAAM;AAAA,YAC7B;AAAA,YACA,CAAC;AAAA,YACD,CAAC,KAAK;AAAA,UACP;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,UAAM,MAAgC,CAAC;AACvC,SAAK,mBAAmB,UAAU,QAAQ,CAAC,MAAM,UAAU;AAC1D,UAAI,SAAS,KAAK,EAAE,GAAG;AACtB,YAAI;AAAA,UACH,IAAI;AAAA,YACH;AAAA,YACA;AAAA,YACA,SAAS,KAAK,EAAE,EAAE;AAAA,YAClB,SAAS,KAAK,EAAE,EAAE;AAAA,UACnB;AAAA,QACD;AAAA,MACD;AAAA,IACD,CAAC;AAED,WAAO;AAAA,EACR;AAAA,EAEA,MAAM,qBACL,YACA,SACkB;AAClB,QAAI,CAAC,KAAK,UAAU;AACnB,aAAO;AAAA,IACR;AAEA,WAAO,KAAK,UAAU;AAAA,MACrB;AAAA,MACA,WAAW,KAAK,MAAM;AAAA,IACvB;AAAA,EACD;AAAA,EAEA,MAAM,uBACL,YACA,SACgB;AAChB,QAAI,CAAC,KAAK,UAAU;AACnB;AAAA,IACD;AAEA,WAAO,KAAK,UAAU;AAAA,MACrB;AAAA,MACA,WAAW,KAAK,MAAM;AAAA,IACvB;AAAA,EACD;AAAA,EAEA,SAAS,SAAkB;AAC1B,SAAK,UAAU,SAAS,WAAW,KAAK,MAAM,CAAC;AAAA,EAChD;AAAA;AAAA;AAAA,EAMA,gBAAoC;AACnC,QAAI,CAAC,KAAK,OAAO;AAChB,YAAM,IAAI,MAAM,uCAAuC;AAAA,IACxD;AAEA,QAAI,CAAC,KAAK,WAAW;AACpB,WAAK,kBAAkB;AAAA,IACxB;AAEA,WAAO;AAAA,MACN,OAAO,KAAK,YAAY,SAAS;AAAA,MACjC,QAAQ,KAAK,YAAY,UAAU;AAAA,MACnC,cAAc,KAAK,OAAO,gBAAgB,KAAK;AAAA,MAC/C,UAAU,KAAK;AAAA,MACf,cACC,KAAK,uBAAuB,uBAAuB,KAAK;AAAA,IAC1D;AAAA,EACD;AAAA,EAEA,MAAM,oBAAoB,MAA2B;AACpD,QAAI,CAAC,KAAK,UAAU;AACnB;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AAEA,QAAI,CAAC,KAAK,YAAY,CAAC,KAAK,MAAM,gBAAgB;AACjD;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,aAAa,CAAC,KAAK,MAAM,WAAW;AAC7C;AAAA,IACD;AAEA,QAAI,KAAK,UAAU,aAAa,IAAI,MAAM,IAAI;AAC7C;AAAA,IACD;AAEA,QAAI,KAAK,aAAa,IAAI,GAAG;AAC5B;AAAA,IACD;AAEA,UAAM,aAAa,OAAO;AAAA,MACzB,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,MACxC;AAAA,IACD;AACA,UAAM,MAAM,CAAC,CAAC,aAAa,IAAI,aAAa;AAE5C,UAAM,UAAU,KAAK,MAAM,qBAAqB,IAAI;AACpD,UAAM,KAAK,SAAS,kBAAkB;AAAA,MACrC,MAAM,KAAK;AAAA,MACX,YAAY,KAAK;AAAA,MACjB,QAAQ,KAAK;AAAA,MACb,SAAS,KAAK,QAAQ;AAAA,MACtB,QAAQ,UAAU;AAAA,MAClB,SAAS;AAAA,MACT,UAAU,KAAK;AAAA,IAChB,CAAC;AAAA,EACF;AAAA,EAEQ,aAAa,MAA+B;AACnD,UAAM,aAAa,KAAK,UAAW,aAAa,IAAI;AACpD,UAAM,eAAe,KAAK,UAAW,gBAAgB;AACrD,WAAO,aAAa;AAAA,MACnB,CAAC,UAAU,cAAc,MAAM,SAAS,cAAc,MAAM;AAAA,IAC7D;AAAA,EACD;AAAA,EAEA,MAAM,qBAAqB,OAAuC;AACjE,QAAI,CAAC,KAAK,UAAU;AACnB;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AAEA,UAAM,KAAK,UAAU,qBAAqB,MAAM,IAAI,CAAC,SAAS,KAAK,EAAE,CAAC;AAAA,EACvE;AAAA,EAEA,MAAM,mBAAmB,OAAuC;AAC/D,QAAI,CAAC,KAAK,YAAY,CAAC,MAAM,QAAQ;AACpC;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AAEA,UAAM,KAAK,UAAU,mBAAmB,MAAM,IAAI,CAAC,SAAS,KAAK,EAAE,CAAC;AAAA,EACrE;AAAA,EAEA,MAAM,qBAAqB,OAAuC;AACjE,QAAI,CAAC,KAAK,UAAU;AACnB;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AAEA,UAAM,KAAK,UAAU,qBAAqB,MAAM,IAAI,CAAC,SAAS,KAAK,EAAE,CAAC;AAAA,EACvE;AAAA,EAEA,MAAc,iCAAgD;AAC7D,QAAI,CAAC,KAAK,UAAU;AACnB;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,YAAM,KAAK,gBAAgB;AAAA,IAC5B;AAEA,UAAM,gBAAgB,KAAK,uBAAuB,EAAE;AAAA,MACnD,CAAC,SAAS,KAAK;AAAA,IAChB;AAGA,UAAM,KAAK,UAAU;AAAA,MACpB,cAAc,SAAS,IAAI,gBAAgB,CAAC;AAAA,IAC7C;AAAA,EACD;AAAA,EAEA,MAAM,aACL,MACA,QACA,QACA,gBACgB;AAChB,SAAK,4BAA4B;AAAA,MAChC,OAAO,OAAO,MAAM;AAAA,MACpB,YAAY;AACX,YAAI,KAAK,eAAe,CAAC,KAAK,UAAU;AACvC;AAAA,QACD;AAEA,YAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,gBAAM,KAAK,gBAAgB;AAAA,QAC5B;AAEA,YAAI,CAAC,KAAK,UAAU;AACnB;AAAA,QACD;AAEA,YAAI,CAAC,KAAK,MAAM,gBAAgB;AAC/B;AAAA,QACD;AAEA,YAAI,OAAO,SAAS,iBAAiB,WAAW;AAC/C,eAAK,0BAA0B,QAAQ,OAAO,SAAS,EAAE;AAAA,QAC1D;AAEA,cAAM,aAAa,OAAO;AAAA,UACzB,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,UACxC;AAAA,QACD;AACA,cAAM,MAAM,CAAC,CAAC,aAAa,IAAI,aAAa;AAE5C,cAAM,UAAU,KAAK,MAAM,qBAAqB,IAAI,IAAI;AAExD,cAAM,iBAAiB,KAAK,SAAS,aAAa;AAAA,UACjD,OAAO;AAAA,QACR;AACA,YACC,CAAC,kBACA,CAAC,eAAe,YAChB,OAAO,SAAS,iBAAiB,WACjC;AACD,cAAI,gBAAgB;AACnB,iBAAK,SAAS;AAAA,cACb;AAAA,gBACC,QAAQ,KAAK;AAAA,gBACb,YAAY,KAAK;AAAA,gBACjB,SAAS,KAAK;AAAA,gBACd,aAAa,KAAK,iBAAiB;AAAA,cACpC;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACD;AAAA,UACD,OAAO;AACN,iBAAK,SAAS;AAAA,cACb;AAAA,gBACC,QAAQ,KAAK;AAAA,gBACb,YAAY,KAAK;AAAA,gBACjB,SAAS,KAAK;AAAA,gBACd,aAAa,KAAK,iBAAiB;AAAA,cACpC;AAAA,cACA;AAAA,cACA;AAAA,cACA;AAAA,YACD;AAAA,UACD;AAAA,QACD,WACC,eAAe,YACf,OAAO,SAAS,iBAAiB,aACjC,eAAe,SAAS,OAAO,OAAO,SAAS,IAC9C;AAED,eAAK,SAAS,aAAa,CAAC,OAAO,MAAM,CAAC;AAC1C,eAAK,SAAS;AAAA,YACb;AAAA,cACC,QAAQ,KAAK;AAAA,cACb,YAAY,KAAK;AAAA,cACjB,SAAS,KAAK;AAAA,YACf;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAAA,QACD,WACC,eAAe,cAAc,OAAO,OAAO,MAAM,WAChD;AACD,eAAK,SAAS;AAAA,YACb;AAAA,cACC,QAAQ,KAAK;AAAA,cACb,YAAY,KAAK;AAAA,cACjB,SAAS,KAAK;AAAA,cACd,aAAa,KAAK,iBAAiB;AAAA,YACpC;AAAA,YACA;AAAA,YACA;AAAA,YACA;AAAA,UACD;AAAA,QACD,OAAO;AACN,gBAAM,cAAc,KAAK,kBAAkB;AAAA,YAC1C,OAAO;AAAA,UACR;AACA,gBAAM,eAAe,KAAK,gBAAgB,WAAW;AACrD,eAAK,SAAS;AAAA,YACb;AAAA,cACC;AAAA,gBACC;AAAA,gBACA,QAAQ,OAAO;AAAA,gBACf;AAAA,gBACA;AAAA,gBACA,cAAc,CAAC,KAAK;AAAA,cACrB;AAAA,YACD;AAAA,YACA,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,aACL,MACA,QACA,QACgB;AAChB,SAAK,4BAA4B;AAAA,MAChC,OAAO,OAAO,MAAM;AAAA,MACpB,YAAY;AACX,YACC,KAAK,eACL,CAAC,KAAK,YACN,KAAK,mBACJ;AACD;AAAA,QACD;AAEA,YAAI,CAAC,KAAK,SAAS,WAAW,GAAG;AAChC,gBAAM,KAAK,gBAAgB;AAAA,QAC5B;AAEA,YAAI,CAAC,KAAK,YAAY,CAAC,KAAK,MAAM,gBAAgB;AACjD;AAAA,QACD;AAEA,YAAI,CAAC,KAAK,SAAS,aAAa,IAAI,OAAO,MAAM,GAAG;AACnD,iBAAO,KAAK,aAAa,MAAM,QAAQ,QAAQ,KAAK;AAAA,QACrD;AAEA,YAAI,OAAO,SAAS,iBAAiB,WAAW;AAC/C,eAAK,0BAA0B,QAAQ,OAAO,SAAS,EAAE;AAAA,QAC1D;AAEA,cAAM,aAAa,OAAO;AAAA,UACzB,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,UACxC;AAAA,QACD;AACA,cAAM,MAAM,CAAC,CAAC,aAAa,IAAI,aAAa;AAE5C,cAAM,UAAU,KAAK,MAAM,qBAAqB,IAAI,IAAI;AACxD,aAAK,SAAS;AAAA,UACb;AAAA,YACC,QAAQ,KAAK;AAAA,YACb,YAAY,KAAK;AAAA,YACjB,SAAS,KAAK;AAAA,UACf;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,gBAAgB,YAAiD;AACtE,SAAK,UAAU,UAAU,UAAU;AAAA,EACpC;AAAA,EAEA,YAAY,QAA8B;AACzC,SAAK,4BAA4B;AAAA,MAChC,OAAO,MAAM;AAAA,MACb,YAAY;AACX,YAAI,KAAK,eAAe,CAAC,KAAK,UAAU;AACvC;AAAA,QACD;AAEA,YAAI,KAAK,UAAU,WAAW,GAAG;AAChC,eAAK,SAAS,aAAa,CAAC,MAAM,CAAC;AAAA,QACpC;AAEA,aAAK,mBAAmB,KAAK,MAAM;AAAA,MACpC;AAAA,IACD;AAAA,EACD;AAAA,EAEA,UAAU,QAA8B;AACvC,SAAK,4BAA4B;AAAA,MAChC,OAAO,MAAM;AAAA,MACb,YAAY;AACX,YAAI,KAAK,eAAe,CAAC,KAAK,UAAU;AACvC;AAAA,QACD;AAEA,YAAI,KAAK,UAAU,WAAW,GAAG;AAChC,eAAK,SAAS,UAAU,MAAM;AAAA,QAC/B;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA,EAGA,YAAY,SAAc;AACzB,QAAI,KAAK,UAAU,WAAW,GAAG;AAChC,WAAK,SAAS,kBAAkB,OAAO;AAAA,IACxC;AAAA,EACD;AAAA;AAAA,EAIA,aAAa,WAAmB;AAC/B,SAAK,kBAAkB,UAAU,IAAI,SAAS;AAAA,EAC/C;AAAA,EAEA,gBAAgB,WAAmB;AAClC,SAAK,kBAAkB,UAAU,OAAO,SAAS;AAAA,EAClD;AAAA,EAEA,OAAO,OAA2C;AACjD,WAAO,KAAK,WAAW,OAAO,KAAK;AAAA,EACpC;AAAA,EAEA,cAAc,UAA2C;AACxD,UAAM,EAAE,WAAW,IAAI;AACvB,WAAO,KAAK,WAAW,UAAU;AAAA,MAChC,CAAC,OAAO,GAAG,WAAW;AAAA,IACvB;AAAA,EACD;AAAA,EAEA,gBAAgB,QAA4C;AAC3D,WAAO,KAAK,WAAW,gBAAgB,MAAM;AAAA,EAC9C;AAAA,EAEA,aAAa,MAAsB;AAClC,WAAO,KAAK,WAAW,qBAAqB,KAAK,MAAM;AAAA,EACxD;AAAA,EAEA,wBAAwB,OAAmC;AAC1D,WAAO,KAAK,WAAW,wBAAwB,KAAK;AAAA,EACrD;AAAA,EAEA,4BAA4B,OAAmC;AAC9D,WAAO,KAAK,WAAW,4BAA4B,KAAK;AAAA,EACzD;AAAA,EAEQ,sBAAsB;AAC7B,QAAI,KAAK,eAAe,CAAC,KAAK,UAAU,WAAW,GAAG;AACrD;AAAA,IACD;AAEA,QAAI,CAAC,KAAK,MAAM,gBAAgB;AAC/B;AAAA,IACD;AAEA,UAAM,eAAe,KAAK,MAAM;AAChC,SAAK,SAAS,QAAQ,MAAM,SAAS,GAAG,eAAe,4BAA4B,CAAC;AAEpF,UAAM,aAAa,OAAO;AAAA,MACzB,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,MACxC;AAAA,IACD;AACA,UAAM,MAAM,CAAC,CAAC,aAAa,IAAI,aAAa;AAE5C,UAAM,cAAmD,CAAC;AAC1D,UAAM,eAAuC,CAAC;AAC9C,SAAK,UAAU,aAAa,QAAQ,CAAC,OAAO,QAAQ;AACnD,YAAM,OAAO,KAAK,WAAW;AAAA,QAC5B,MAAM,SAAS;AAAA,MAChB;AACA,UAAI,CAAC,QAAQ,EAAE,gBAAgB,oBAAoB;AAClD;AAAA,MACD;AAEA,WAAK,WAAW,UAAU;AAAA,QACzB,CAACA,UAASA,MAAK,WAAW,MAAM,SAAS;AAAA,MAC1C;AACA,YAAM,YAAY,KAAK,MAAM,aAAa,IAAI;AAE9C,UAAI,cAAc,QAAW;AAC5B;AAAA,MACD;AAEA,UAAI,KAAK,kBAAkB,QAAQ,GAAG,IAAI,GAAG;AAE5C,qBAAa,KAAK,GAAG;AAAA,MACtB;AAEA,YAAM,UAAU,KAAK,MAAM,qBAAqB,IAAI;AACpD,YAAM,cAAc,KAAK,kBAAkB,QAAQ,GAAG;AACtD,YAAM,eAAe,KAAK,gBAAgB,WAAW;AACrD,kBAAY,KAAK;AAAA,QAChB;AAAA,QACA,QAAQ;AAAA,QACR,SAAS,UAAU;AAAA,QACnB;AAAA,QACA,cAAc;AAAA,MACf,CAAC;AAAA,IACF,CAAC;AAED,SAAK,SAAS,aAAa,YAAY;AAEvC,UAAM,sBAAqD,CAAC;AAC5D,eAAW,UAAU,KAAK,SAAS,qBAAqB,KAAK,GAAG;AAC/D,YAAM,OAAO,KAAK,WAAW,UAAU;AAAA,QACtC,CAACA,UAASA,MAAK,OAAO;AAAA,MACvB;AACA,UAAI,MAAM;AACT,cAAM,UAAU,KAAK,MAAM,qBAAqB,IAAI;AAEpD,4BAAoB,KAAK,EAAE,IAAI,QAAQ,KAAK,UAAU,IAAI,CAAC;AAAA,MAC5D;AAAA,IACD;AAEA,QAAI,oBAAoB,UAAU,YAAY,QAAQ;AACrD,WAAK;AAAA,QACJ;AAAA,QACA;AAAA,MACD;AACA,WAAK,UAAU,iBAAiB,aAAa,mBAAmB;AAAA,IACjE;AAAA,EACD;AAAA;AAAA;AAAA,EAKQ,oBACP,UACA,QACA,cACA,QACA,QACO;AACP,UAAM,OAAO,KAAK,WAAW,UAAU;AAAA,MACtC,CAAC,OAAO,GAAG,WAAW,SAAS;AAAA,IAChC;AACA,QAAI,QAAQ,gBAAgB,mBAAmB;AAC9C,YAAM,cAAc,KAAK,kBAAkB,QAAQ,MAAM;AACzD,WAAK,OAAO,sBAAsB,KAAK,QAAQ,YAAY;AAC3D,WAAK,mBAAmB,aAAa,cAAc,MAAM;AACzD,WAAK,mBAAmB,MAAM,KAAK,WAAW,WAAW;AAEzD,UAAI,QAAQ;AACX,aAAK,mBAAmB,KAAK,MAAM;AAAA,MACpC;AAAA,IACD;AAAA,EACD;AAAA,EAEiB,2BAA2B,oBAAI,IAG9C;AAAA,EAEM,yBACP,UACA,UACA,QACC;AACD,UAAM,WAAW,KAAK,yBAAyB,SAAS;AACxD,SAAK,yBAAyB,IAAI,UAAU;AAAA,MAC3C,QAAQ,SAAS;AAAA,MACjB;AAAA,MACA;AAAA,IACD,CAAC;AAED,QAAI,UAAU;AACb,UAAI;AAAA,QACH,IAAI,UAAU,KAAK,WAAW,CAAC;AAAA,QAC/B,MAAM;AACL,eAAK,OAAO,YAAY;AACxB,eAAK,oBAAoB;AAEzB,eAAK,UAAU,UAAU;AAAA,YACxB,GAAG,KAAK,yBAAyB,OAAO;AAAA,UACzC,CAAC;AAED,eAAK,yBAAyB,MAAM;AAAA,QACrC;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,aAAa,QAA4C;AAChE,WAAO,KAAK,WAAW,UAAU,KAAK,CAAC,OAAO,GAAG,OAAO,MAAM;AAAA,EAC/D;AAAA,EAEQ,wBACP,QACA,QACA,QACC;AACD,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,QAAQ,gBAAgB,qBAAqB;AAChD,YAAM,EAAE,iBAAiB,IACxB,KAAK,iBAAiB;AAAA,QACrB,KAAK,WAAW;AAAA,MACjB;AACD,WAAK;AAAA,QACJ;AAAA,QACA,KAAK;AAAA,QACL,SAAS;AAAA,QACT;AAAA,MACD;AACA,WAAK,yBAAyB;AAAA,IAC/B;AAAA,EACD;AAAA,EAEQ,wBACP,QACA,WACO;AACP,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,gBAAgB,qBAAqB;AACxC,WAAK,aAAa,IAAI;AACtB,WAAK,gBAAgB,WAAW,0BAA0B;AAAA,IAC3D;AAAA,EACD;AAAA,EAEQ,wBACP,QACA,OACO;AACP,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,gBAAgB,qBAAqB;AACxC,YAAM,gBAAgB,KAAK,MAAM,iBAC9B,CAAC,OAAO;AAAA,QACR,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,QACxC;AAAA,MACD,IACC;AACH,WAAK,gBAAgB;AAAA,QACpB;AAAA,QACA,MAAM,cAAc;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,mBACP,QACA,OACO;AACP,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,gBAAgB,qBAAqB;AACxC,YAAM,gBAAgB,KAAK,MAAM,iBAC9B,CAAC,OAAO;AAAA,QACR,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,QACxC;AAAA,MACD,IACC;AACH,WAAK,gBAAgB;AAAA,QACpB;AAAA,QACA,MAAM,cAAc;AAAA,MACrB;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,mBACP,QACA,OACO;AACP,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,gBAAgB,qBAAqB;AACxC,YAAM,gBAAgB,KAAK,MAAM,iBAC9B,CAAC,OAAO;AAAA,QACR,KAAK,MAAM,eAAe,QAAQ,MAAM;AAAA,QACxC;AAAA,MACD,IACC;AACH,YAAM,eAAe;AACrB,WAAK,gBAAgB,aAAa,MAAM,KAAK;AAAA,IAC9C;AAAA,EACD;AAAA,EAEQ,sBAAsB,QAAsB;AACnD,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,gBAAgB,qBAAqB;AACxC,WAAK,gBAAgB,gBAAgB,IAAI;AAAA,IAC1C;AAAA,EACD;AAAA,EAEQ,iBAAiB,QAAsB;AAC9C,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,QAAI,MAAM;AACT,WAAK,0BAA0B,KAAK,IAAI;AAAA,IACzC;AAAA,EACD;AAAA,EAEQ,2BACP,QACA,aACA,UACA,YACO;AACP,QAAI,CAAC,KAAK,SAAS,GAAG;AACrB;AAAA,IACD;AAEA,UAAM,OAAO,KAAK,aAAa,MAAM;AACrC,UAAM,YAAY,OAAO,KAAK,aAAa,IAAI,IAAI;AACnD,QACC,MAAM,iBAAiB,gBAAgB,eACvC,cAAc,QACb;AACD,YAAM,oBACL,KAAK,iBAAiB,kBAAkB,CAAC;AAC1C,wBAAkB,UAAU,KAC1B,kBAAkB,UAAU,KAAK,KAAK;AAExC,WAAK,UAAU;AAAA,QACd;AAAA,UACC;AAAA,YACC,UAAU,aAAa;AAAA,YACvB,OAAO;AAAA,YACP,kBAAkB;AAAA,cACjB;AAAA,cACA,gBAAgB;AAAA,YACjB;AAAA,UACD;AAAA,QACD;AAAA,QACA;AAAA,QACA;AAAA,QACA,MAAM;AAAA,QACN;AAAA,QACA;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA;AAAA;AAAA,EAKA,gBAAuD,IAAe;AACrE,WAAW,KAAK,eAAe,IAAI,EAAE,KAAK;AAAA,EAC3C;AAAA;AAAA,EAIS,UAAU;AAClB,SAAK,cAAc;AAEnB,SAAK,UAAU,QAAQ;AACvB,SAAK,WAAW;AAEhB,SAAK,sBAAsB,qBAAqB,IAAI;AACpD,YAAQ,KAAK,eAAe,OAAO,CAAC;AACpC,SAAK,eAAe,MAAM;AAE1B,SAAK,YAAY,MAAM;AACvB,YAAQ,KAAK,wBAAwB;AACrC,SAAK,MAAM,QAAQ;AACnB,SAAK,qBAAqB,QAAQ;AAElC,SAAK,kBAAkB,OAAO;AAC9B,SAAK,WAAW,QAAQ;AAExB,SAAK,iBAAiB,MAAM;AAC5B,SAAK,uBAAuB,QAAQ,CAAC,MAAM,EAAE,QAAQ,CAAC;AACtD,SAAK,uBAAuB,MAAM;AAElC,SAAK,gCAAgC,OAAO;AAE5C,UAAM,QAAQ;AAGd,SAAK,WAAW;AAChB,SAAK,yBAAyB;AAC9B,SAAK,2BAA2B;AAChC,SAAK,iBAAiB;AACtB,SAAK,sBAAsB;AAC3B,SAAK,qBAAqB;AAC1B,SAAK,yBAAyB;AAC9B,SAAK,sBAAsB;AAC3B,SAAK,QAAQ;AACb,SAAK,wBAAwB;AAC7B,SAAK,kBAAkB;AACvB,SAAK,gBAAgB;AAAA,EACtB;AAAA,EAEA,SAA2C;AAC1C,WAAO;AAAA,MACN,aAAa,KAAK,WAAW;AAAA,IAC9B;AAAA,EACD;AACD;AA3mIa,uBAAN;AAAA,EAqOJ;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EAEA;AAAA,EAEA;AAAA,EAEA;AAAA,EAEA;AAAA,GA7PU;AA6mIb,eAAe,OAAO,MAAM,GAAG,uBAAuB;AACtD,eAAe,OAAO,MAAM,IAAI,mCAAmC;AACnE,eAAe,OAAO,MAAM,IAAI,8BAA8B;AAC9D,eAAe,OAAO,MAAM,IAAI,oBAAoB;AACpD,eAAe,OAAO,MAAM,IAAI,sBAAsB;AACtD,eAAe,OAAO,MAAM,IAAI,4BAA4B;AAC5D,eAAe,OAAO,MAAM,IAAI,iBAAiB;AACjD,eAAe,OAAO,MAAM,IAAI,wCAAwC;AACxE,eAAe,OAAO,MAAM,IAAI,+BAA+B;AAC/D,eAAe,OAAO,MAAM,IAAI,kCAAkC;AAClE,eAAe,OAAO,MAAM,IAAI,8BAA8B;AAC9D,eAAe,OAAO,MAAM,GAAG,kCAAkC;AACjE,eAAe,OAAO,MAAM,GAAG,uBAAuB;AACtD,eAAe,OAAO,MAAM,GAAG,uCAAuC;AAE/D,MAAM,qBAAqB;AAAA,EACjC;AAAA,EACA;AAAA,IACC,MAAM,YAAY,iCAAiC,CAAC;AAAA,IACpD,OAAO,YAAY,iCAAiC,CAAC;AAAA,IACrD,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,2BAA2B;AAAA,EACvC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,wBAAwB;AAAA,EACpC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,kCAAkC;AAAA,EAC9C;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,sBAAsB;AAAA,EAClC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,wBAAwB;AAAA,EACpC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,qCAAqC;AAAA,EACjD;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,+BAA+B;AAAA,EAC3C;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAGO,MAAM,yBAAyB;AAAA,EACrC;AAAA,EACA;AAAA,IACC,MAAM,MAAM,QAAQ,SAAS,EAAE,YAAY,IAAI;AAAA,IAC/C,OAAO,MAAM,QAAQ,SAAS,EAAE,YAAY,IAAI;AAAA,IAChD,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,wBAAwB;AAAA,EACpC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,yBAAyB;AAAA,EACrC;AAAA,EACA;AAAA,IACC,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,sBAAsB;AAAA,EAClC;AAAA,EACA;AAAA,IACC,MAAM,YAAY,uBAAuB,GAAG;AAAA,IAC5C,OAAO,YAAY,uBAAuB,GAAG;AAAA,IAC7C,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,qBAAqB;AAAA,EACjC;AAAA,EACA;AAAA,IACC,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,6BAA6B;AAAA,EACzC;AAAA,EACA;AAAA,IACC,MAAM;AAAA,IACN,OAAO;AAAA,IACP,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,oBAAoB;AAAA,EAChC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,4BAA4B;AAAA,EACxC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,yBAAyB;AAAA,EACrC;AAAA,EACA;AAAA,IACC,OAAO,IAAI,MAAM,IAAI,KAAK,GAAG,GAAG,GAAG,IAAI,CAAC;AAAA,IACxC,MAAM,IAAI,MAAM,IAAI,KAAK,KAAK,KAAK,KAAK,IAAI,CAAC;AAAA,IAC7C,QAAQ,IAAI,MAAM,IAAI,KAAK,KAAK,KAAK,KAAK,IAAI,CAAC;AAAA,IAC/C,SAAS,IAAI,MAAM,IAAI,KAAK,GAAG,GAAG,GAAG,IAAI,CAAC;AAAA,EAC3C;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,yBAAyB;AAAA,EACrC;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,gCAAgC;AAAA,EAC5C;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,qCAAqC;AAAA,EACjD;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,sCAAsC;AAAA,EAClD;AAAA,EACA;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,sBAAsB;AAAA,EAClC;AAAA,EACA;AAAA,IACC,MAAM,MAAM,QAAQ,WAAW;AAAA,IAC/B,OAAO,MAAM,QAAQ,WAAW;AAAA,IAChC,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEO,MAAM,uBAAuB;AAAA,EACnC;AAAA,EACA;AAAA,IACC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI;AAAA,IACH;AAAA,IACA;AAAA,EACD;AACD;AAEA,MAAM,2BAA2B;AAAA,EAChC;AAAA,EACA;AAAA,IACC,OAAO;AAAA,IACP,MAAM;AAAA,IACN,QAAQ;AAAA,IACR,SAAS;AAAA,EACV;AAAA,EACA,IAAI,SAAS,6BAA6B,4BAA4B;AACvE;",
  "names": ["cell", "selection", "offset"]
}
