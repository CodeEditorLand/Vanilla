{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/cellParts/markupCell.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from \"../../../../../../base/browser/dom.js\";\nimport { renderIcon } from \"../../../../../../base/browser/ui/iconLabel/iconLabels.js\";\nimport {\n\tdisposableTimeout,\n\traceCancellation,\n} from \"../../../../../../base/common/async.js\";\nimport { CancellationTokenSource } from \"../../../../../../base/common/cancellation.js\";\nimport { Codicon } from \"../../../../../../base/common/codicons.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n\tMutableDisposable,\n\ttoDisposable,\n} from \"../../../../../../base/common/lifecycle.js\";\nimport { ThemeIcon } from \"../../../../../../base/common/themables.js\";\nimport type { ICodeEditor } from \"../../../../../../editor/browser/editorBrowser.js\";\nimport { CodeEditorWidget } from \"../../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js\";\nimport type { IEditorOptions } from \"../../../../../../editor/common/config/editorOptions.js\";\nimport { EditorContextKeys } from \"../../../../../../editor/common/editorContextKeys.js\";\nimport { ILanguageService } from \"../../../../../../editor/common/languages/language.js\";\nimport { tokenizeToStringSync } from \"../../../../../../editor/common/languages/textToHtmlTokenizer.js\";\nimport type { IReadonlyTextBuffer } from \"../../../../../../editor/common/model.js\";\nimport { WordHighlighterContribution } from \"../../../../../../editor/contrib/wordHighlighter/browser/wordHighlighter.js\";\nimport { localize } from \"../../../../../../nls.js\";\nimport { IAccessibilityService } from \"../../../../../../platform/accessibility/common/accessibility.js\";\nimport { IConfigurationService } from \"../../../../../../platform/configuration/common/configuration.js\";\nimport { IContextKeyService } from \"../../../../../../platform/contextkey/common/contextkey.js\";\nimport { IInstantiationService } from \"../../../../../../platform/instantiation/common/instantiation.js\";\nimport { ServiceCollection } from \"../../../../../../platform/instantiation/common/serviceCollection.js\";\nimport { IKeybindingService } from \"../../../../../../platform/keybinding/common/keybinding.js\";\nimport {\n\tCellEditState,\n\tCellFocusMode,\n\tCellFoldingState,\n\tEXPAND_CELL_INPUT_COMMAND_ID,\n\ttype IActiveNotebookEditorDelegate,\n\ttype ICellViewModel,\n} from \"../../notebookBrowser.js\";\nimport { collapsedIcon, expandedIcon } from \"../../notebookIcons.js\";\nimport type { MarkupCellViewModel } from \"../../viewModel/markupCellViewModel.js\";\nimport type { MarkdownCellRenderTemplate } from \"../notebookRenderingCommon.js\";\nimport { CellEditorOptions } from \"./cellEditorOptions.js\";\n\nexport class MarkupCell extends Disposable {\n\tprivate editor: CodeEditorWidget | null = null;\n\n\tprivate markdownAccessibilityContainer!: HTMLElement;\n\tprivate editorPart: HTMLElement;\n\n\tprivate readonly localDisposables = this._register(new DisposableStore());\n\tprivate readonly focusSwitchDisposable = this._register(\n\t\tnew MutableDisposable(),\n\t);\n\tprivate readonly editorDisposables = this._register(new DisposableStore());\n\tprivate foldingState: CellFoldingState;\n\tprivate cellEditorOptions: CellEditorOptions;\n\tprivate editorOptions: IEditorOptions;\n\tprivate _isDisposed = false;\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: IActiveNotebookEditorDelegate,\n\t\tprivate readonly viewCell: MarkupCellViewModel,\n\t\tprivate readonly templateData: MarkdownCellRenderTemplate,\n\t\tprivate readonly renderedEditors: Map<ICellViewModel, ICodeEditor | undefined>,\n\t\t@IAccessibilityService private readonly accessibilityService: IAccessibilityService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t\t@IKeybindingService private keybindingService: IKeybindingService,\n\t) {\n\t\tsuper();\n\n\t\tthis.constructDOM();\n\t\tthis.editorPart = templateData.editorPart;\n\t\tthis.cellEditorOptions = this._register(new CellEditorOptions(this.notebookEditor.getBaseCellEditorOptions(viewCell.language), this.notebookEditor.notebookOptions, this.configurationService));\n\t\tthis.cellEditorOptions.setLineNumbers(this.viewCell.lineNumbers);\n\t\tthis.editorOptions = this.cellEditorOptions.getValue(this.viewCell.internalMetadata, this.viewCell.uri);\n\n\t\tthis._register(toDisposable(() => renderedEditors.delete(this.viewCell)));\n\t\tthis.registerListeners();\n\n\t\t// update for init state\n\t\tthis.templateData.cellParts.scheduleRenderCell(this.viewCell);\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.templateData.cellParts.unrenderCell(this.viewCell);\n\t\t}));\n\n\t\tthis._register(this.accessibilityService.onDidChangeScreenReaderOptimized(() => {\n\t\t\tthis.viewUpdate();\n\t\t}));\n\n\t\tthis.updateForHover();\n\t\tthis.updateForFocusModeChange();\n\t\tthis.foldingState = viewCell.foldingState;\n\t\tthis.layoutFoldingIndicator();\n\t\tthis.updateFoldingIconShowClass();\n\n\t\t// the markdown preview's height might already be updated after the renderer calls `element.getHeight()`\n\t\tif (this.viewCell.layoutInfo.totalHeight > 0) {\n\t\t\tthis.relayoutCell();\n\t\t}\n\n\t\tthis.applyDecorations();\n\t\tthis.viewUpdate();\n\n\t\tthis.layoutCellParts();\n\t\tthis._register(this.viewCell.onDidChangeLayout(() => {\n\t\t\tthis.layoutCellParts();\n\t\t}));\n\t}\n\n\tlayoutCellParts() {\n\t\tthis.templateData.cellParts.updateInternalLayoutNow(this.viewCell);\n\t}\n\n\tprivate constructDOM() {\n\t\t// Create an element that is only used to announce markup cell content to screen readers\n\t\tconst id = `aria-markup-cell-${this.viewCell.id}`;\n\t\tthis.markdownAccessibilityContainer = this.templateData.cellContainer;\n\t\tthis.markdownAccessibilityContainer.id = id;\n\t\t// Hide the element from non-screen readers\n\t\tthis.markdownAccessibilityContainer.style.height = \"1px\";\n\t\tthis.markdownAccessibilityContainer.style.overflow = \"hidden\";\n\t\tthis.markdownAccessibilityContainer.style.position = \"absolute\";\n\t\tthis.markdownAccessibilityContainer.style.top = \"100000px\";\n\t\tthis.markdownAccessibilityContainer.style.left = \"10000px\";\n\t\tthis.markdownAccessibilityContainer.ariaHidden = \"false\";\n\n\t\tthis.templateData.rootContainer.setAttribute(\"aria-describedby\", id);\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"webview-backed-markdown-cell\",\n\t\t\ttrue,\n\t\t);\n\t}\n\n\tprivate registerListeners() {\n\t\tthis._register(\n\t\t\tthis.viewCell.onDidChangeState((e) => {\n\t\t\t\tthis.templateData.cellParts.updateState(this.viewCell, e);\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.viewCell.model.onDidChangeMetadata(() => {\n\t\t\t\tthis.viewUpdate();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.viewCell.onDidChangeState((e) => {\n\t\t\t\tif (e.editStateChanged || e.contentChanged) {\n\t\t\t\t\tthis.viewUpdate();\n\t\t\t\t}\n\n\t\t\t\tif (e.focusModeChanged) {\n\t\t\t\t\tthis.updateForFocusModeChange();\n\t\t\t\t}\n\n\t\t\t\tif (e.foldingStateChanged) {\n\t\t\t\t\tconst foldingState = this.viewCell.foldingState;\n\n\t\t\t\t\tif (foldingState !== this.foldingState) {\n\t\t\t\t\t\tthis.foldingState = foldingState;\n\t\t\t\t\t\tthis.layoutFoldingIndicator();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tif (e.cellIsHoveredChanged) {\n\t\t\t\t\tthis.updateForHover();\n\t\t\t\t}\n\n\t\t\t\tif (e.inputCollapsedChanged) {\n\t\t\t\t\tthis.updateCollapsedState();\n\t\t\t\t\tthis.viewUpdate();\n\t\t\t\t}\n\n\t\t\t\tif (e.cellLineNumberChanged) {\n\t\t\t\t\tthis.cellEditorOptions.setLineNumbers(\n\t\t\t\t\t\tthis.viewCell.lineNumbers,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.notebookEditor.notebookOptions.onDidChangeOptions((e) => {\n\t\t\t\tif (e.showFoldingControls) {\n\t\t\t\t\tthis.updateFoldingIconShowClass();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.viewCell.onDidChangeLayout((e) => {\n\t\t\t\tconst layoutInfo = this.editor?.getLayoutInfo();\n\t\t\t\tif (\n\t\t\t\t\te.outerWidth &&\n\t\t\t\t\tthis.viewCell.getEditState() === CellEditState.Editing &&\n\t\t\t\t\tlayoutInfo &&\n\t\t\t\t\tlayoutInfo.width !== this.viewCell.layoutInfo.editorWidth\n\t\t\t\t) {\n\t\t\t\t\tthis.onCellEditorWidthChange();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.cellEditorOptions.onDidChange(() =>\n\t\t\t\tthis.updateMarkupCellOptions(),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate updateMarkupCellOptions(): any {\n\t\tthis.updateEditorOptions(\n\t\t\tthis.cellEditorOptions.getUpdatedValue(\n\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\tthis.viewCell.uri,\n\t\t\t),\n\t\t);\n\n\t\tif (this.editor) {\n\t\t\tthis.editor.updateOptions(\n\t\t\t\tthis.cellEditorOptions.getUpdatedValue(\n\t\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\t\tthis.viewCell.uri,\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\tthis._register({\n\t\t\t\tdispose() {\n\t\t\t\t\tcts.dispose(true);\n\t\t\t\t},\n\t\t\t});\n\t\t\traceCancellation(this.viewCell.resolveTextModel(), cts.token).then(\n\t\t\t\t(model) => {\n\t\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (model) {\n\t\t\t\t\t\tmodel.updateOptions({\n\t\t\t\t\t\t\tindentSize: this.cellEditorOptions.indentSize,\n\t\t\t\t\t\t\ttabSize: this.cellEditorOptions.tabSize,\n\t\t\t\t\t\t\tinsertSpaces: this.cellEditorOptions.insertSpaces,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate updateCollapsedState() {\n\t\tif (this.viewCell.isInputCollapsed) {\n\t\t\tthis.notebookEditor.hideMarkupPreviews([this.viewCell]);\n\t\t} else {\n\t\t\tthis.notebookEditor.unhideMarkupPreviews([this.viewCell]);\n\t\t}\n\t}\n\n\tprivate updateForHover(): void {\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"markdown-cell-hover\",\n\t\t\tthis.viewCell.cellIsHovered,\n\t\t);\n\t}\n\n\tprivate updateForFocusModeChange() {\n\t\tif (this.viewCell.focusMode === CellFocusMode.Editor) {\n\t\t\tthis.focusEditorIfNeeded();\n\t\t}\n\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"cell-editor-focus\",\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor,\n\t\t);\n\t}\n\n\tprivate applyDecorations() {\n\t\t// apply decorations\n\t\tthis._register(\n\t\t\tthis.viewCell.onCellDecorationsChanged((e) => {\n\t\t\t\te.added.forEach((options) => {\n\t\t\t\t\tif (options.className) {\n\t\t\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t\t\t[options.className],\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.templateData.rootContainer.classList.add(\n\t\t\t\t\t\t\toptions.className,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\te.removed.forEach((options) => {\n\t\t\t\t\tif (options.className) {\n\t\t\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\t[options.className],\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis.templateData.rootContainer.classList.remove(\n\t\t\t\t\t\t\toptions.className,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\n\t\tthis.viewCell.getCellDecorations().forEach((options) => {\n\t\t\tif (options.className) {\n\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t[options.className],\n\t\t\t\t\t[],\n\t\t\t\t);\n\t\t\t\tthis.templateData.rootContainer.classList.add(\n\t\t\t\t\toptions.className,\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\toverride dispose() {\n\t\tthis._isDisposed = true;\n\n\t\t// move focus back to the cell list otherwise the focus goes to body\n\t\tif (\n\t\t\tthis.notebookEditor.getActiveCell() === this.viewCell &&\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor &&\n\t\t\t(this.notebookEditor.hasEditorFocus() ||\n\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.activeElement ===\n\t\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.body)\n\t\t) {\n\t\t\tthis.notebookEditor.focusContainer();\n\t\t}\n\n\t\tthis.viewCell.detachTextEditor();\n\t\tsuper.dispose();\n\t}\n\n\tprivate updateFoldingIconShowClass() {\n\t\tconst showFoldingIcon =\n\t\t\tthis.notebookEditor.notebookOptions.getDisplayOptions()\n\t\t\t\t.showFoldingControls;\n\t\tthis.templateData.foldingIndicator.classList.remove(\n\t\t\t\"mouseover\",\n\t\t\t\"always\",\n\t\t);\n\t\tthis.templateData.foldingIndicator.classList.add(showFoldingIcon);\n\t}\n\n\tprivate viewUpdate(): void {\n\t\tif (this.viewCell.isInputCollapsed) {\n\t\t\tthis.viewUpdateCollapsed();\n\t\t} else if (this.viewCell.getEditState() === CellEditState.Editing) {\n\t\t\tthis.viewUpdateEditing();\n\t\t} else {\n\t\t\tthis.viewUpdatePreview();\n\t\t}\n\t}\n\n\tprivate viewUpdateCollapsed(): void {\n\t\tDOM.show(this.templateData.cellInputCollapsedContainer);\n\t\tDOM.hide(this.editorPart);\n\n\t\tthis.templateData.cellInputCollapsedContainer.innerText = \"\";\n\n\t\tconst markdownIcon = DOM.append(\n\t\t\tthis.templateData.cellInputCollapsedContainer,\n\t\t\tDOM.$(\"span\"),\n\t\t);\n\t\tmarkdownIcon.classList.add(\n\t\t\t...ThemeIcon.asClassNameArray(Codicon.markdown),\n\t\t);\n\n\t\tconst element = DOM.$(\"div\");\n\t\telement.classList.add(\"cell-collapse-preview\");\n\t\tconst richEditorText = this.getRichText(\n\t\t\tthis.viewCell.textBuffer,\n\t\t\tthis.viewCell.language,\n\t\t);\n\t\tDOM.safeInnerHtml(element, richEditorText);\n\t\tthis.templateData.cellInputCollapsedContainer.appendChild(element);\n\n\t\tconst expandIcon = DOM.append(element, DOM.$(\"span.expandInputIcon\"));\n\t\texpandIcon.classList.add(...ThemeIcon.asClassNameArray(Codicon.more));\n\t\tconst keybinding = this.keybindingService.lookupKeybinding(\n\t\t\tEXPAND_CELL_INPUT_COMMAND_ID,\n\t\t);\n\t\tif (keybinding) {\n\t\t\telement.title = localize(\n\t\t\t\t\"cellExpandInputButtonLabelWithDoubleClick\",\n\t\t\t\t\"Double-click to expand cell input ({0})\",\n\t\t\t\tkeybinding.getLabel(),\n\t\t\t);\n\t\t\texpandIcon.title = localize(\n\t\t\t\t\"cellExpandInputButtonLabel\",\n\t\t\t\t\"Expand Cell Input ({0})\",\n\t\t\t\tkeybinding.getLabel(),\n\t\t\t);\n\t\t}\n\n\t\tthis.markdownAccessibilityContainer.ariaHidden = \"true\";\n\n\t\tthis.templateData.container.classList.toggle(\"input-collapsed\", true);\n\t\tthis.viewCell.renderedMarkdownHeight = 0;\n\t\tthis.viewCell.layoutChange({});\n\t}\n\n\tprivate getRichText(buffer: IReadonlyTextBuffer, language: string) {\n\t\treturn tokenizeToStringSync(\n\t\t\tthis.languageService,\n\t\t\tbuffer.getLineContent(1),\n\t\t\tlanguage,\n\t\t);\n\t}\n\n\tprivate viewUpdateEditing(): void {\n\t\t// switch to editing mode\n\t\tlet editorHeight: number;\n\n\t\tDOM.show(this.editorPart);\n\t\tthis.markdownAccessibilityContainer.ariaHidden = \"true\";\n\t\tDOM.hide(this.templateData.cellInputCollapsedContainer);\n\n\t\tthis.notebookEditor.hideMarkupPreviews([this.viewCell]);\n\n\t\tthis.templateData.container.classList.toggle(\"input-collapsed\", false);\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"markdown-cell-edit-mode\",\n\t\t\ttrue,\n\t\t);\n\n\t\tif (this.editor && this.editor.hasModel()) {\n\t\t\teditorHeight = this.editor.getContentHeight();\n\n\t\t\t// not first time, we don't need to create editor\n\t\t\tthis.viewCell.attachTextEditor(this.editor);\n\t\t\tthis.focusEditorIfNeeded();\n\n\t\t\tthis.bindEditorListeners(this.editor);\n\n\t\t\tthis.editor.layout({\n\t\t\t\twidth: this.viewCell.layoutInfo.editorWidth,\n\t\t\t\theight: editorHeight,\n\t\t\t});\n\t\t} else {\n\t\t\tthis.editorDisposables.clear();\n\t\t\tconst width =\n\t\t\t\tthis.notebookEditor.notebookOptions.computeMarkdownCellEditorWidth(\n\t\t\t\t\tthis.notebookEditor.getLayoutInfo().width,\n\t\t\t\t);\n\t\t\tconst lineNum = this.viewCell.lineCount;\n\t\t\tconst lineHeight =\n\t\t\t\tthis.viewCell.layoutInfo.fontInfo?.lineHeight || 17;\n\t\t\tconst editorPadding =\n\t\t\t\tthis.notebookEditor.notebookOptions.computeEditorPadding(\n\t\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\t\tthis.viewCell.uri,\n\t\t\t\t);\n\t\t\teditorHeight =\n\t\t\t\tMath.max(lineNum, 1) * lineHeight +\n\t\t\t\teditorPadding.top +\n\t\t\t\teditorPadding.bottom;\n\n\t\t\tthis.templateData.editorContainer.innerText = \"\";\n\n\t\t\t// create a special context key service that set the inCompositeEditor-contextkey\n\t\t\tconst editorContextKeyService = this.contextKeyService.createScoped(\n\t\t\t\tthis.templateData.editorPart,\n\t\t\t);\n\t\t\tEditorContextKeys.inCompositeEditor\n\t\t\t\t.bindTo(editorContextKeyService)\n\t\t\t\t.set(true);\n\t\t\tconst editorInstaService = this.editorDisposables.add(\n\t\t\t\tthis.instantiationService.createChild(\n\t\t\t\t\tnew ServiceCollection([\n\t\t\t\t\t\tIContextKeyService,\n\t\t\t\t\t\teditorContextKeyService,\n\t\t\t\t\t]),\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis.editorDisposables.add(editorContextKeyService);\n\n\t\t\tthis.editor = this.editorDisposables.add(\n\t\t\t\teditorInstaService.createInstance(\n\t\t\t\t\tCodeEditorWidget,\n\t\t\t\t\tthis.templateData.editorContainer,\n\t\t\t\t\t{\n\t\t\t\t\t\t...this.editorOptions,\n\t\t\t\t\t\tdimension: {\n\t\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\t\theight: editorHeight,\n\t\t\t\t\t\t},\n\t\t\t\t\t\t// overflowWidgetsDomNode: this.notebookEditor.getOverflowContainerDomNode()\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tcontributions:\n\t\t\t\t\t\t\tthis.notebookEditor.creationOptions\n\t\t\t\t\t\t\t\t.cellEditorContributions,\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis.templateData.currentEditor = this.editor;\n\t\t\tthis.editorDisposables.add(\n\t\t\t\tthis.editor.onDidBlurEditorWidget(() => {\n\t\t\t\t\tif (this.editor) {\n\t\t\t\t\t\tWordHighlighterContribution.get(\n\t\t\t\t\t\t\tthis.editor,\n\t\t\t\t\t\t)?.stopHighlighting();\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\t\t\tthis.editorDisposables.add(\n\t\t\t\tthis.editor.onDidFocusEditorWidget(() => {\n\t\t\t\t\tif (this.editor) {\n\t\t\t\t\t\tWordHighlighterContribution.get(\n\t\t\t\t\t\t\tthis.editor,\n\t\t\t\t\t\t)?.restoreViewState(true);\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tconst cts = new CancellationTokenSource();\n\t\t\tthis.editorDisposables.add({\n\t\t\t\tdispose() {\n\t\t\t\t\tcts.dispose(true);\n\t\t\t\t},\n\t\t\t});\n\t\t\traceCancellation(this.viewCell.resolveTextModel(), cts.token).then(\n\t\t\t\t(model) => {\n\t\t\t\t\tif (!model) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.editor!.setModel(model);\n\t\t\t\t\tmodel.updateOptions({\n\t\t\t\t\t\tindentSize: this.cellEditorOptions.indentSize,\n\t\t\t\t\t\ttabSize: this.cellEditorOptions.tabSize,\n\t\t\t\t\t\tinsertSpaces: this.cellEditorOptions.insertSpaces,\n\t\t\t\t\t});\n\n\t\t\t\t\tconst realContentHeight = this.editor!.getContentHeight();\n\t\t\t\t\tif (realContentHeight !== editorHeight) {\n\t\t\t\t\t\tthis.editor!.layout({\n\t\t\t\t\t\t\twidth: width,\n\t\t\t\t\t\t\theight: realContentHeight,\n\t\t\t\t\t\t});\n\t\t\t\t\t\teditorHeight = realContentHeight;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.viewCell.attachTextEditor(this.editor!);\n\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.viewCell.getEditState() === CellEditState.Editing\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.focusEditorIfNeeded();\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.bindEditorListeners(this.editor!);\n\n\t\t\t\t\tthis.viewCell.editorHeight = editorHeight;\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\n\t\tthis.viewCell.editorHeight = editorHeight;\n\t\tthis.focusEditorIfNeeded();\n\t\tthis.renderedEditors.set(this.viewCell, this.editor);\n\t}\n\n\tprivate viewUpdatePreview(): void {\n\t\tthis.viewCell.detachTextEditor();\n\t\tDOM.hide(this.editorPart);\n\t\tDOM.hide(this.templateData.cellInputCollapsedContainer);\n\t\tthis.markdownAccessibilityContainer.ariaHidden = \"false\";\n\t\tthis.templateData.container.classList.toggle(\"input-collapsed\", false);\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"markdown-cell-edit-mode\",\n\t\t\tfalse,\n\t\t);\n\n\t\tthis.renderedEditors.delete(this.viewCell);\n\n\t\tthis.markdownAccessibilityContainer.innerText = \"\";\n\t\tif (this.viewCell.renderedHtml) {\n\t\t\tif (this.accessibilityService.isScreenReaderOptimized()) {\n\t\t\t\tDOM.safeInnerHtml(\n\t\t\t\t\tthis.markdownAccessibilityContainer,\n\t\t\t\t\tthis.viewCell.renderedHtml,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tDOM.clearNode(this.markdownAccessibilityContainer);\n\t\t\t}\n\t\t}\n\n\t\tthis.notebookEditor.createMarkupPreview(this.viewCell);\n\t}\n\n\tprivate focusEditorIfNeeded() {\n\t\tif (\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor &&\n\t\t\t(this.notebookEditor.hasEditorFocus() ||\n\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.activeElement ===\n\t\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.body)\n\t\t) {\n\t\t\t// Don't steal focus from other workbench parts, but if body has focus, we can take it\n\t\t\tif (!this.editor) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.editor.focus();\n\n\t\t\tconst primarySelection = this.editor.getSelection();\n\t\t\tif (!primarySelection) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.notebookEditor.revealRangeInViewAsync(\n\t\t\t\tthis.viewCell,\n\t\t\t\tprimarySelection,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate layoutEditor(dimension: DOM.IDimension): void {\n\t\tthis.editor?.layout(dimension);\n\t}\n\n\tprivate onCellEditorWidthChange(): void {\n\t\tconst realContentHeight = this.editor!.getContentHeight();\n\t\tthis.layoutEditor({\n\t\t\twidth: this.viewCell.layoutInfo.editorWidth,\n\t\t\theight: realContentHeight,\n\t\t});\n\n\t\t// LET the content size observer to handle it\n\t\t// this.viewCell.editorHeight = realContentHeight;\n\t\t// this.relayoutCell();\n\t}\n\n\trelayoutCell(): void {\n\t\tthis.notebookEditor.layoutNotebookCell(\n\t\t\tthis.viewCell,\n\t\t\tthis.viewCell.layoutInfo.totalHeight,\n\t\t);\n\t\tthis.layoutFoldingIndicator();\n\t}\n\n\tupdateEditorOptions(newValue: IEditorOptions): void {\n\t\tthis.editorOptions = newValue;\n\t\tthis.editor?.updateOptions(this.editorOptions);\n\t}\n\n\tprivate layoutFoldingIndicator() {\n\t\tswitch (this.foldingState) {\n\t\t\tcase CellFoldingState.None:\n\t\t\t\tthis.templateData.foldingIndicator.style.display = \"none\";\n\t\t\t\tthis.templateData.foldingIndicator.innerText = \"\";\n\t\t\t\tbreak;\n\t\t\tcase CellFoldingState.Collapsed:\n\t\t\t\tthis.templateData.foldingIndicator.style.display = \"\";\n\t\t\t\tDOM.reset(\n\t\t\t\t\tthis.templateData.foldingIndicator,\n\t\t\t\t\trenderIcon(collapsedIcon),\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase CellFoldingState.Expanded:\n\t\t\t\tthis.templateData.foldingIndicator.style.display = \"\";\n\t\t\t\tDOM.reset(\n\t\t\t\t\tthis.templateData.foldingIndicator,\n\t\t\t\t\trenderIcon(expandedIcon),\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tprivate bindEditorListeners(editor: CodeEditorWidget) {\n\t\tthis.localDisposables.clear();\n\t\tthis.focusSwitchDisposable.clear();\n\n\t\tthis.localDisposables.add(\n\t\t\teditor.onDidContentSizeChange((e) => {\n\t\t\t\tif (e.contentHeightChanged) {\n\t\t\t\t\tthis.onCellEditorHeightChange(editor, e.contentHeight);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis.localDisposables.add(\n\t\t\teditor.onDidChangeCursorSelection((e) => {\n\t\t\t\tif (e.source === \"restoreState\") {\n\t\t\t\t\t// do not reveal the cell into view if this selection change was caused by restoring editors...\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst selections = editor.getSelections();\n\n\t\t\t\tif (selections?.length) {\n\t\t\t\t\tconst contentHeight = editor.getContentHeight();\n\t\t\t\t\tconst layoutContentHeight =\n\t\t\t\t\t\tthis.viewCell.layoutInfo.editorHeight;\n\n\t\t\t\t\tif (contentHeight !== layoutContentHeight) {\n\t\t\t\t\t\tthis.onCellEditorHeightChange(editor, contentHeight);\n\t\t\t\t\t}\n\t\t\t\t\tconst lastSelection = selections[selections.length - 1];\n\t\t\t\t\tthis.notebookEditor.revealRangeInViewAsync(\n\t\t\t\t\t\tthis.viewCell,\n\t\t\t\t\t\tlastSelection,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tconst updateFocusMode = () =>\n\t\t\t(this.viewCell.focusMode = editor.hasWidgetFocus()\n\t\t\t\t? CellFocusMode.Editor\n\t\t\t\t: CellFocusMode.Container);\n\t\tthis.localDisposables.add(\n\t\t\teditor.onDidFocusEditorWidget(() => {\n\t\t\t\tupdateFocusMode();\n\t\t\t}),\n\t\t);\n\n\t\tthis.localDisposables.add(\n\t\t\teditor.onDidBlurEditorWidget(() => {\n\t\t\t\t// this is for a special case:\n\t\t\t\t// users click the status bar empty space, which we will then focus the editor\n\t\t\t\t// so we don't want to update the focus state too eagerly\n\t\t\t\tif (\n\t\t\t\t\tthis.templateData.container.ownerDocument.activeElement?.contains(\n\t\t\t\t\t\tthis.templateData.container,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tthis.focusSwitchDisposable.value = disposableTimeout(\n\t\t\t\t\t\t() => updateFocusMode(),\n\t\t\t\t\t\t300,\n\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tupdateFocusMode();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tupdateFocusMode();\n\t}\n\n\tprivate onCellEditorHeightChange(\n\t\teditor: CodeEditorWidget,\n\t\tnewHeight: number,\n\t): void {\n\t\tconst viewLayout = editor.getLayoutInfo();\n\t\tthis.viewCell.editorHeight = newHeight;\n\t\teditor.layout({\n\t\t\twidth: viewLayout.width,\n\t\t\theight: newHeight,\n\t\t});\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,YAAY,SAAS;AACrB,SAAS,kBAAkB;AAC3B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,+BAA+B;AACxC,SAAS,eAAe;AACxB;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,iBAAiB;AAE1B,SAAS,wBAAwB;AAEjC,SAAS,yBAAyB;AAClC,SAAS,wBAAwB;AACjC,SAAS,4BAA4B;AAErC,SAAS,mCAAmC;AAC5C,SAAS,gBAAgB;AACzB,SAAS,6BAA6B;AACtC,SAAS,6BAA6B;AACtC,SAAS,0BAA0B;AACnC,SAAS,6BAA6B;AACtC,SAAS,yBAAyB;AAClC,SAAS,0BAA0B;AACnC;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OAGM;AACP,SAAS,eAAe,oBAAoB;AAG5C,SAAS,yBAAyB;AAE3B,IAAM,aAAN,cAAyB,WAAW;AAAA,EAgB1C,YACkB,gBACA,UACA,cACA,iBACuB,sBACH,mBACG,sBACL,iBACJ,sBACH,mBAC3B;AACD,UAAM;AAXW;AACA;AACA;AACA;AACuB;AACH;AACG;AACL;AACJ;AACH;AAI5B,SAAK,aAAa;AAClB,SAAK,aAAa,aAAa;AAC/B,SAAK,oBAAoB,KAAK,UAAU,IAAI,kBAAkB,KAAK,eAAe,yBAAyB,SAAS,QAAQ,GAAG,KAAK,eAAe,iBAAiB,KAAK,oBAAoB,CAAC;AAC9L,SAAK,kBAAkB,eAAe,KAAK,SAAS,WAAW;AAC/D,SAAK,gBAAgB,KAAK,kBAAkB,SAAS,KAAK,SAAS,kBAAkB,KAAK,SAAS,GAAG;AAEtG,SAAK,UAAU,aAAa,MAAM,gBAAgB,OAAO,KAAK,QAAQ,CAAC,CAAC;AACxE,SAAK,kBAAkB;AAGvB,SAAK,aAAa,UAAU,mBAAmB,KAAK,QAAQ;AAE5D,SAAK,UAAU,aAAa,MAAM;AACjC,WAAK,aAAa,UAAU,aAAa,KAAK,QAAQ;AAAA,IACvD,CAAC,CAAC;AAEF,SAAK,UAAU,KAAK,qBAAqB,iCAAiC,MAAM;AAC/E,WAAK,WAAW;AAAA,IACjB,CAAC,CAAC;AAEF,SAAK,eAAe;AACpB,SAAK,yBAAyB;AAC9B,SAAK,eAAe,SAAS;AAC7B,SAAK,uBAAuB;AAC5B,SAAK,2BAA2B;AAGhC,QAAI,KAAK,SAAS,WAAW,cAAc,GAAG;AAC7C,WAAK,aAAa;AAAA,IACnB;AAEA,SAAK,iBAAiB;AACtB,SAAK,WAAW;AAEhB,SAAK,gBAAgB;AACrB,SAAK,UAAU,KAAK,SAAS,kBAAkB,MAAM;AACpD,WAAK,gBAAgB;AAAA,IACtB,CAAC,CAAC;AAAA,EACH;AAAA,EApHD,OAgD2C;AAAA;AAAA;AAAA,EAClC,SAAkC;AAAA,EAElC;AAAA,EACA;AAAA,EAES,mBAAmB,KAAK,UAAU,IAAI,gBAAgB,CAAC;AAAA,EACvD,wBAAwB,KAAK;AAAA,IAC7C,IAAI,kBAAkB;AAAA,EACvB;AAAA,EACiB,oBAAoB,KAAK,UAAU,IAAI,gBAAgB,CAAC;AAAA,EACjE;AAAA,EACA;AAAA,EACA;AAAA,EACA,cAAc;AAAA,EAwDtB,kBAAkB;AACjB,SAAK,aAAa,UAAU,wBAAwB,KAAK,QAAQ;AAAA,EAClE;AAAA,EAEQ,eAAe;AAEtB,UAAM,KAAK,oBAAoB,KAAK,SAAS,EAAE;AAC/C,SAAK,iCAAiC,KAAK,aAAa;AACxD,SAAK,+BAA+B,KAAK;AAEzC,SAAK,+BAA+B,MAAM,SAAS;AACnD,SAAK,+BAA+B,MAAM,WAAW;AACrD,SAAK,+BAA+B,MAAM,WAAW;AACrD,SAAK,+BAA+B,MAAM,MAAM;AAChD,SAAK,+BAA+B,MAAM,OAAO;AACjD,SAAK,+BAA+B,aAAa;AAEjD,SAAK,aAAa,cAAc,aAAa,oBAAoB,EAAE;AACnE,SAAK,aAAa,UAAU,UAAU;AAAA,MACrC;AAAA,MACA;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,oBAAoB;AAC3B,SAAK;AAAA,MACJ,KAAK,SAAS,iBAAiB,CAAC,MAAM;AACrC,aAAK,aAAa,UAAU,YAAY,KAAK,UAAU,CAAC;AAAA,MACzD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,SAAS,MAAM,oBAAoB,MAAM;AAC7C,aAAK,WAAW;AAAA,MACjB,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,SAAS,iBAAiB,CAAC,MAAM;AACrC,YAAI,EAAE,oBAAoB,EAAE,gBAAgB;AAC3C,eAAK,WAAW;AAAA,QACjB;AAEA,YAAI,EAAE,kBAAkB;AACvB,eAAK,yBAAyB;AAAA,QAC/B;AAEA,YAAI,EAAE,qBAAqB;AAC1B,gBAAM,eAAe,KAAK,SAAS;AAEnC,cAAI,iBAAiB,KAAK,cAAc;AACvC,iBAAK,eAAe;AACpB,iBAAK,uBAAuB;AAAA,UAC7B;AAAA,QACD;AAEA,YAAI,EAAE,sBAAsB;AAC3B,eAAK,eAAe;AAAA,QACrB;AAEA,YAAI,EAAE,uBAAuB;AAC5B,eAAK,qBAAqB;AAC1B,eAAK,WAAW;AAAA,QACjB;AAEA,YAAI,EAAE,uBAAuB;AAC5B,eAAK,kBAAkB;AAAA,YACtB,KAAK,SAAS;AAAA,UACf;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,eAAe,gBAAgB,mBAAmB,CAAC,MAAM;AAC7D,YAAI,EAAE,qBAAqB;AAC1B,eAAK,2BAA2B;AAAA,QACjC;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,SAAS,kBAAkB,CAAC,MAAM;AACtC,cAAM,aAAa,KAAK,QAAQ,cAAc;AAC9C,YACC,EAAE,cACF,KAAK,SAAS,aAAa,MAAM,cAAc,WAC/C,cACA,WAAW,UAAU,KAAK,SAAS,WAAW,aAC7C;AACD,eAAK,wBAAwB;AAAA,QAC9B;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,kBAAkB;AAAA,QAAY,MAClC,KAAK,wBAAwB;AAAA,MAC9B;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,0BAA+B;AACtC,SAAK;AAAA,MACJ,KAAK,kBAAkB;AAAA,QACtB,KAAK,SAAS;AAAA,QACd,KAAK,SAAS;AAAA,MACf;AAAA,IACD;AAEA,QAAI,KAAK,QAAQ;AAChB,WAAK,OAAO;AAAA,QACX,KAAK,kBAAkB;AAAA,UACtB,KAAK,SAAS;AAAA,UACd,KAAK,SAAS;AAAA,QACf;AAAA,MACD;AAEA,YAAM,MAAM,IAAI,wBAAwB;AACxC,WAAK,UAAU;AAAA,QACd,UAAU;AACT,cAAI,QAAQ,IAAI;AAAA,QACjB;AAAA,MACD,CAAC;AACD,uBAAiB,KAAK,SAAS,iBAAiB,GAAG,IAAI,KAAK,EAAE;AAAA,QAC7D,CAAC,UAAU;AACV,cAAI,KAAK,aAAa;AACrB;AAAA,UACD;AAEA,cAAI,OAAO;AACV,kBAAM,cAAc;AAAA,cACnB,YAAY,KAAK,kBAAkB;AAAA,cACnC,SAAS,KAAK,kBAAkB;AAAA,cAChC,cAAc,KAAK,kBAAkB;AAAA,YACtC,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,uBAAuB;AAC9B,QAAI,KAAK,SAAS,kBAAkB;AACnC,WAAK,eAAe,mBAAmB,CAAC,KAAK,QAAQ,CAAC;AAAA,IACvD,OAAO;AACN,WAAK,eAAe,qBAAqB,CAAC,KAAK,QAAQ,CAAC;AAAA,IACzD;AAAA,EACD;AAAA,EAEQ,iBAAuB;AAC9B,SAAK,aAAa,UAAU,UAAU;AAAA,MACrC;AAAA,MACA,KAAK,SAAS;AAAA,IACf;AAAA,EACD;AAAA,EAEQ,2BAA2B;AAClC,QAAI,KAAK,SAAS,cAAc,cAAc,QAAQ;AACrD,WAAK,oBAAoB;AAAA,IAC1B;AAEA,SAAK,aAAa,UAAU,UAAU;AAAA,MACrC;AAAA,MACA,KAAK,SAAS,cAAc,cAAc;AAAA,IAC3C;AAAA,EACD;AAAA,EAEQ,mBAAmB;AAE1B,SAAK;AAAA,MACJ,KAAK,SAAS,yBAAyB,CAAC,MAAM;AAC7C,UAAE,MAAM,QAAQ,CAAC,YAAY;AAC5B,cAAI,QAAQ,WAAW;AACtB,iBAAK,eAAe;AAAA,cACnB,KAAK,SAAS;AAAA,cACd,CAAC,QAAQ,SAAS;AAAA,cAClB,CAAC;AAAA,YACF;AACA,iBAAK,aAAa,cAAc,UAAU;AAAA,cACzC,QAAQ;AAAA,YACT;AAAA,UACD;AAAA,QACD,CAAC;AAED,UAAE,QAAQ,QAAQ,CAAC,YAAY;AAC9B,cAAI,QAAQ,WAAW;AACtB,iBAAK,eAAe;AAAA,cACnB,KAAK,SAAS;AAAA,cACd,CAAC;AAAA,cACD,CAAC,QAAQ,SAAS;AAAA,YACnB;AACA,iBAAK,aAAa,cAAc,UAAU;AAAA,cACzC,QAAQ;AAAA,YACT;AAAA,UACD;AAAA,QACD,CAAC;AAAA,MACF,CAAC;AAAA,IACF;AAEA,SAAK,SAAS,mBAAmB,EAAE,QAAQ,CAAC,YAAY;AACvD,UAAI,QAAQ,WAAW;AACtB,aAAK,eAAe;AAAA,UACnB,KAAK,SAAS;AAAA,UACd,CAAC,QAAQ,SAAS;AAAA,UAClB,CAAC;AAAA,QACF;AACA,aAAK,aAAa,cAAc,UAAU;AAAA,UACzC,QAAQ;AAAA,QACT;AAAA,MACD;AAAA,IACD,CAAC;AAAA,EACF;AAAA,EAES,UAAU;AAClB,SAAK,cAAc;AAGnB,QACC,KAAK,eAAe,cAAc,MAAM,KAAK,YAC7C,KAAK,SAAS,cAAc,cAAc,WACzC,KAAK,eAAe,eAAe,KACnC,KAAK,eAAe,WAAW,EAAE,cAAc,kBAC9C,KAAK,eAAe,WAAW,EAAE,cAAc,OAChD;AACD,WAAK,eAAe,eAAe;AAAA,IACpC;AAEA,SAAK,SAAS,iBAAiB;AAC/B,UAAM,QAAQ;AAAA,EACf;AAAA,EAEQ,6BAA6B;AACpC,UAAM,kBACL,KAAK,eAAe,gBAAgB,kBAAkB,EACpD;AACH,SAAK,aAAa,iBAAiB,UAAU;AAAA,MAC5C;AAAA,MACA;AAAA,IACD;AACA,SAAK,aAAa,iBAAiB,UAAU,IAAI,eAAe;AAAA,EACjE;AAAA,EAEQ,aAAmB;AAC1B,QAAI,KAAK,SAAS,kBAAkB;AACnC,WAAK,oBAAoB;AAAA,IAC1B,WAAW,KAAK,SAAS,aAAa,MAAM,cAAc,SAAS;AAClE,WAAK,kBAAkB;AAAA,IACxB,OAAO;AACN,WAAK,kBAAkB;AAAA,IACxB;AAAA,EACD;AAAA,EAEQ,sBAA4B;AACnC,QAAI,KAAK,KAAK,aAAa,2BAA2B;AACtD,QAAI,KAAK,KAAK,UAAU;AAExB,SAAK,aAAa,4BAA4B,YAAY;AAE1D,UAAM,eAAe,IAAI;AAAA,MACxB,KAAK,aAAa;AAAA,MAClB,IAAI,EAAE,MAAM;AAAA,IACb;AACA,iBAAa,UAAU;AAAA,MACtB,GAAG,UAAU,iBAAiB,QAAQ,QAAQ;AAAA,IAC/C;AAEA,UAAM,UAAU,IAAI,EAAE,KAAK;AAC3B,YAAQ,UAAU,IAAI,uBAAuB;AAC7C,UAAM,iBAAiB,KAAK;AAAA,MAC3B,KAAK,SAAS;AAAA,MACd,KAAK,SAAS;AAAA,IACf;AACA,QAAI,cAAc,SAAS,cAAc;AACzC,SAAK,aAAa,4BAA4B,YAAY,OAAO;AAEjE,UAAM,aAAa,IAAI,OAAO,SAAS,IAAI,EAAE,sBAAsB,CAAC;AACpE,eAAW,UAAU,IAAI,GAAG,UAAU,iBAAiB,QAAQ,IAAI,CAAC;AACpE,UAAM,aAAa,KAAK,kBAAkB;AAAA,MACzC;AAAA,IACD;AACA,QAAI,YAAY;AACf,cAAQ,QAAQ;AAAA,QACf;AAAA,QACA;AAAA,QACA,WAAW,SAAS;AAAA,MACrB;AACA,iBAAW,QAAQ;AAAA,QAClB;AAAA,QACA;AAAA,QACA,WAAW,SAAS;AAAA,MACrB;AAAA,IACD;AAEA,SAAK,+BAA+B,aAAa;AAEjD,SAAK,aAAa,UAAU,UAAU,OAAO,mBAAmB,IAAI;AACpE,SAAK,SAAS,yBAAyB;AACvC,SAAK,SAAS,aAAa,CAAC,CAAC;AAAA,EAC9B;AAAA,EAEQ,YAAY,QAA6B,UAAkB;AAClE,WAAO;AAAA,MACN,KAAK;AAAA,MACL,OAAO,eAAe,CAAC;AAAA,MACvB;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,oBAA0B;AAEjC,QAAI;AAEJ,QAAI,KAAK,KAAK,UAAU;AACxB,SAAK,+BAA+B,aAAa;AACjD,QAAI,KAAK,KAAK,aAAa,2BAA2B;AAEtD,SAAK,eAAe,mBAAmB,CAAC,KAAK,QAAQ,CAAC;AAEtD,SAAK,aAAa,UAAU,UAAU,OAAO,mBAAmB,KAAK;AACrE,SAAK,aAAa,UAAU,UAAU;AAAA,MACrC;AAAA,MACA;AAAA,IACD;AAEA,QAAI,KAAK,UAAU,KAAK,OAAO,SAAS,GAAG;AAC1C,qBAAe,KAAK,OAAO,iBAAiB;AAG5C,WAAK,SAAS,iBAAiB,KAAK,MAAM;AAC1C,WAAK,oBAAoB;AAEzB,WAAK,oBAAoB,KAAK,MAAM;AAEpC,WAAK,OAAO,OAAO;AAAA,QAClB,OAAO,KAAK,SAAS,WAAW;AAAA,QAChC,QAAQ;AAAA,MACT,CAAC;AAAA,IACF,OAAO;AACN,WAAK,kBAAkB,MAAM;AAC7B,YAAM,QACL,KAAK,eAAe,gBAAgB;AAAA,QACnC,KAAK,eAAe,cAAc,EAAE;AAAA,MACrC;AACD,YAAM,UAAU,KAAK,SAAS;AAC9B,YAAM,aACL,KAAK,SAAS,WAAW,UAAU,cAAc;AAClD,YAAM,gBACL,KAAK,eAAe,gBAAgB;AAAA,QACnC,KAAK,SAAS;AAAA,QACd,KAAK,SAAS;AAAA,MACf;AACD,qBACC,KAAK,IAAI,SAAS,CAAC,IAAI,aACvB,cAAc,MACd,cAAc;AAEf,WAAK,aAAa,gBAAgB,YAAY;AAG9C,YAAM,0BAA0B,KAAK,kBAAkB;AAAA,QACtD,KAAK,aAAa;AAAA,MACnB;AACA,wBAAkB,kBAChB,OAAO,uBAAuB,EAC9B,IAAI,IAAI;AACV,YAAM,qBAAqB,KAAK,kBAAkB;AAAA,QACjD,KAAK,qBAAqB;AAAA,UACzB,IAAI,kBAAkB;AAAA,YACrB;AAAA,YACA;AAAA,UACD,CAAC;AAAA,QACF;AAAA,MACD;AACA,WAAK,kBAAkB,IAAI,uBAAuB;AAElD,WAAK,SAAS,KAAK,kBAAkB;AAAA,QACpC,mBAAmB;AAAA,UAClB;AAAA,UACA,KAAK,aAAa;AAAA,UAClB;AAAA,YACC,GAAG,KAAK;AAAA,YACR,WAAW;AAAA,cACV;AAAA,cACA,QAAQ;AAAA,YACT;AAAA;AAAA,UAED;AAAA,UACA;AAAA,YACC,eACC,KAAK,eAAe,gBAClB;AAAA,UACJ;AAAA,QACD;AAAA,MACD;AACA,WAAK,aAAa,gBAAgB,KAAK;AACvC,WAAK,kBAAkB;AAAA,QACtB,KAAK,OAAO,sBAAsB,MAAM;AACvC,cAAI,KAAK,QAAQ;AAChB,wCAA4B;AAAA,cAC3B,KAAK;AAAA,YACN,GAAG,iBAAiB;AAAA,UACrB;AAAA,QACD,CAAC;AAAA,MACF;AACA,WAAK,kBAAkB;AAAA,QACtB,KAAK,OAAO,uBAAuB,MAAM;AACxC,cAAI,KAAK,QAAQ;AAChB,wCAA4B;AAAA,cAC3B,KAAK;AAAA,YACN,GAAG,iBAAiB,IAAI;AAAA,UACzB;AAAA,QACD,CAAC;AAAA,MACF;AAEA,YAAM,MAAM,IAAI,wBAAwB;AACxC,WAAK,kBAAkB,IAAI;AAAA,QAC1B,UAAU;AACT,cAAI,QAAQ,IAAI;AAAA,QACjB;AAAA,MACD,CAAC;AACD,uBAAiB,KAAK,SAAS,iBAAiB,GAAG,IAAI,KAAK,EAAE;AAAA,QAC7D,CAAC,UAAU;AACV,cAAI,CAAC,OAAO;AACX;AAAA,UACD;AAEA,eAAK,OAAQ,SAAS,KAAK;AAC3B,gBAAM,cAAc;AAAA,YACnB,YAAY,KAAK,kBAAkB;AAAA,YACnC,SAAS,KAAK,kBAAkB;AAAA,YAChC,cAAc,KAAK,kBAAkB;AAAA,UACtC,CAAC;AAED,gBAAM,oBAAoB,KAAK,OAAQ,iBAAiB;AACxD,cAAI,sBAAsB,cAAc;AACvC,iBAAK,OAAQ,OAAO;AAAA,cACnB;AAAA,cACA,QAAQ;AAAA,YACT,CAAC;AACD,2BAAe;AAAA,UAChB;AAEA,eAAK,SAAS,iBAAiB,KAAK,MAAO;AAE3C,cACC,KAAK,SAAS,aAAa,MAAM,cAAc,SAC9C;AACD,iBAAK,oBAAoB;AAAA,UAC1B;AAEA,eAAK,oBAAoB,KAAK,MAAO;AAErC,eAAK,SAAS,eAAe;AAAA,QAC9B;AAAA,MACD;AAAA,IACD;AAEA,SAAK,SAAS,eAAe;AAC7B,SAAK,oBAAoB;AACzB,SAAK,gBAAgB,IAAI,KAAK,UAAU,KAAK,MAAM;AAAA,EACpD;AAAA,EAEQ,oBAA0B;AACjC,SAAK,SAAS,iBAAiB;AAC/B,QAAI,KAAK,KAAK,UAAU;AACxB,QAAI,KAAK,KAAK,aAAa,2BAA2B;AACtD,SAAK,+BAA+B,aAAa;AACjD,SAAK,aAAa,UAAU,UAAU,OAAO,mBAAmB,KAAK;AACrE,SAAK,aAAa,UAAU,UAAU;AAAA,MACrC;AAAA,MACA;AAAA,IACD;AAEA,SAAK,gBAAgB,OAAO,KAAK,QAAQ;AAEzC,SAAK,+BAA+B,YAAY;AAChD,QAAI,KAAK,SAAS,cAAc;AAC/B,UAAI,KAAK,qBAAqB,wBAAwB,GAAG;AACxD,YAAI;AAAA,UACH,KAAK;AAAA,UACL,KAAK,SAAS;AAAA,QACf;AAAA,MACD,OAAO;AACN,YAAI,UAAU,KAAK,8BAA8B;AAAA,MAClD;AAAA,IACD;AAEA,SAAK,eAAe,oBAAoB,KAAK,QAAQ;AAAA,EACtD;AAAA,EAEQ,sBAAsB;AAC7B,QACC,KAAK,SAAS,cAAc,cAAc,WACzC,KAAK,eAAe,eAAe,KACnC,KAAK,eAAe,WAAW,EAAE,cAAc,kBAC9C,KAAK,eAAe,WAAW,EAAE,cAAc,OAChD;AAED,UAAI,CAAC,KAAK,QAAQ;AACjB;AAAA,MACD;AAEA,WAAK,OAAO,MAAM;AAElB,YAAM,mBAAmB,KAAK,OAAO,aAAa;AAClD,UAAI,CAAC,kBAAkB;AACtB;AAAA,MACD;AAEA,WAAK,eAAe;AAAA,QACnB,KAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,aAAa,WAAiC;AACrD,SAAK,QAAQ,OAAO,SAAS;AAAA,EAC9B;AAAA,EAEQ,0BAAgC;AACvC,UAAM,oBAAoB,KAAK,OAAQ,iBAAiB;AACxD,SAAK,aAAa;AAAA,MACjB,OAAO,KAAK,SAAS,WAAW;AAAA,MAChC,QAAQ;AAAA,IACT,CAAC;AAAA,EAKF;AAAA,EAEA,eAAqB;AACpB,SAAK,eAAe;AAAA,MACnB,KAAK;AAAA,MACL,KAAK,SAAS,WAAW;AAAA,IAC1B;AACA,SAAK,uBAAuB;AAAA,EAC7B;AAAA,EAEA,oBAAoB,UAAgC;AACnD,SAAK,gBAAgB;AACrB,SAAK,QAAQ,cAAc,KAAK,aAAa;AAAA,EAC9C;AAAA,EAEQ,yBAAyB;AAChC,YAAQ,KAAK,cAAc;AAAA,MAC1B,KAAK,iBAAiB;AACrB,aAAK,aAAa,iBAAiB,MAAM,UAAU;AACnD,aAAK,aAAa,iBAAiB,YAAY;AAC/C;AAAA,MACD,KAAK,iBAAiB;AACrB,aAAK,aAAa,iBAAiB,MAAM,UAAU;AACnD,YAAI;AAAA,UACH,KAAK,aAAa;AAAA,UAClB,WAAW,aAAa;AAAA,QACzB;AACA;AAAA,MACD,KAAK,iBAAiB;AACrB,aAAK,aAAa,iBAAiB,MAAM,UAAU;AACnD,YAAI;AAAA,UACH,KAAK,aAAa;AAAA,UAClB,WAAW,YAAY;AAAA,QACxB;AACA;AAAA,MAED;AACC;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,oBAAoB,QAA0B;AACrD,SAAK,iBAAiB,MAAM;AAC5B,SAAK,sBAAsB,MAAM;AAEjC,SAAK,iBAAiB;AAAA,MACrB,OAAO,uBAAuB,CAAC,MAAM;AACpC,YAAI,EAAE,sBAAsB;AAC3B,eAAK,yBAAyB,QAAQ,EAAE,aAAa;AAAA,QACtD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,iBAAiB;AAAA,MACrB,OAAO,2BAA2B,CAAC,MAAM;AACxC,YAAI,EAAE,WAAW,gBAAgB;AAEhC;AAAA,QACD;AAEA,cAAM,aAAa,OAAO,cAAc;AAExC,YAAI,YAAY,QAAQ;AACvB,gBAAM,gBAAgB,OAAO,iBAAiB;AAC9C,gBAAM,sBACL,KAAK,SAAS,WAAW;AAE1B,cAAI,kBAAkB,qBAAqB;AAC1C,iBAAK,yBAAyB,QAAQ,aAAa;AAAA,UACpD;AACA,gBAAM,gBAAgB,WAAW,WAAW,SAAS,CAAC;AACtD,eAAK,eAAe;AAAA,YACnB,KAAK;AAAA,YACL;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAEA,UAAM,kBAAkB,6BACtB,KAAK,SAAS,YAAY,OAAO,eAAe,IAC9C,cAAc,SACd,cAAc,WAHM;AAIxB,SAAK,iBAAiB;AAAA,MACrB,OAAO,uBAAuB,MAAM;AACnC,wBAAgB;AAAA,MACjB,CAAC;AAAA,IACF;AAEA,SAAK,iBAAiB;AAAA,MACrB,OAAO,sBAAsB,MAAM;AAIlC,YACC,KAAK,aAAa,UAAU,cAAc,eAAe;AAAA,UACxD,KAAK,aAAa;AAAA,QACnB,GACC;AACD,eAAK,sBAAsB,QAAQ;AAAA,YAClC,MAAM,gBAAgB;AAAA,YACtB;AAAA,UACD;AAAA,QACD,OAAO;AACN,0BAAgB;AAAA,QACjB;AAAA,MACD,CAAC;AAAA,IACF;AAEA,oBAAgB;AAAA,EACjB;AAAA,EAEQ,yBACP,QACA,WACO;AACP,UAAM,aAAa,OAAO,cAAc;AACxC,SAAK,SAAS,eAAe;AAC7B,WAAO,OAAO;AAAA,MACb,OAAO,WAAW;AAAA,MAClB,QAAQ;AAAA,IACT,CAAC;AAAA,EACF;AACD;AAptBa,aAAN;AAAA,EAqBJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GA1BU;",
  "names": []
}
