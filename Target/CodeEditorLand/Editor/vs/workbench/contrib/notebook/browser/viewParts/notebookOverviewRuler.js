var F=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var v=(h,d,i,n)=>{for(var t=n>1?void 0:n?M(d,i):d,s=h.length-1,e;s>=0;s--)(e=h[s])&&(t=(n?e(d,i,t):e(t))||t);return n&&t&&F(d,i,t),t},H=(h,d)=>(i,n)=>d(i,n,h);import{getWindow as D}from"../../../../../base/browser/dom.js";import{createFastDomNode as S}from"../../../../../base/browser/fastDomNode.js";import{PixelRatio as E}from"../../../../../base/browser/pixelRatio.js";import{IThemeService as T,Themable as W}from"../../../../../platform/theme/common/themeService.js";import{NotebookOverviewRulerLane as u}from"../notebookBrowser.js";let g=class extends W{constructor(i,n,t){super(t);this.notebookEditor=i;this._domNode=S(document.createElement("canvas")),this._domNode.setPosition("relative"),this._domNode.setLayerHinting(!0),this._domNode.setContain("strict"),n.appendChild(this._domNode.domNode),this._register(i.onDidChangeDecorations(()=>{this.layout()})),this._register(E.getInstance(D(this._domNode.domNode)).onDidChange(()=>{this.layout()}))}_domNode;_lanes=3;layout(){const n=this.notebookEditor.getLayoutInfo(),t=n.scrollHeight,s=n.height,e=E.getInstance(D(this._domNode.domNode)).value;this._domNode.setWidth(10),this._domNode.setHeight(s),this._domNode.domNode.width=10*e,this._domNode.domNode.height=s*e;const l=this._domNode.domNode.getContext("2d");l.clearRect(0,0,10*e,s*e),this._render(l,10*e,s*e,t*e,e)}_render(i,n,t,s,e){const l=this.notebookEditor.getViewModel(),y=this.notebookEditor.getLayoutInfo().fontInfo,r=n/this._lanes;let N=0;if(l)for(let b=0;b<l.viewCells.length;b++){const m=l.viewCells[b],L=m.textBuffer,R=m.getCellDecorations(),k=m.layoutInfo.totalHeight/s*e*t;R.filter(_=>_.overviewRuler).forEach(_=>{const c=_.overviewRuler,p=this.getColor(c.color)??"#000000",w=Math.min(y.lineHeight,m.layoutInfo.editorHeight/s/L.getLineCount()*e*t),C=c.modelRanges.map(o=>o.startLineNumber).reduce((o,a)=>((o.length===0||o[o.length-1]!==a)&&o.push(a),o),[]);let f=0;switch(c.position){case u.Left:f=0;break;case u.Center:f=r;break;case u.Right:f=r*2;break;default:break}const x=c.position===u.Full?r*3:r;for(let o=0;o<C.length;o++){i.fillStyle=p;const I=(C[o]-1)*w;i.fillRect(f,N+I,x,w)}if(c.includeOutput){i.fillStyle=p;const o=m.layoutInfo.editorHeight/s*e*t,a=y.lineHeight/s*e*t;i.fillRect(r,N+o,r,a)}}),N+=k}}};g=v([H(2,T)],g);export{g as NotebookOverviewRuler};
