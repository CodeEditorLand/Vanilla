import{Disposable as I,DisposableStore as y,dispose as b}from"../../../../../../base/common/lifecycle.js";import{localize2 as n}from"../../../../../../nls.js";import{Categories as a}from"../../../../../../platform/action/common/actionCommonCategories.js";import{Action2 as c,registerAction2 as d}from"../../../../../../platform/actions/common/actions.js";import{IEditorService as u}from"../../../../../services/editor/common/editorService.js";import{CellStatusbarAlignment as f}from"../../../common/notebookCommon.js";import{INotebookService as v}from"../../../common/notebookService.js";import{getNotebookEditorFromEditorPane as m}from"../../notebookBrowser.js";import{registerNotebookContribution as E}from"../../notebookEditorExtensions.js";class h extends I{constructor(e){super();this._notebookEditor=e;this._register(this._notebookEditor.onDidChangeModel(()=>{this._update()})),this._update()}static id="workbench.notebook.troubleshoot";_localStore=this._register(new y);_cellStateListeners=[];_enabled=!1;_cellStatusItems=[];toggle(){this._enabled=!this._enabled,this._update()}_update(){this._localStore.clear(),this._cellStateListeners.forEach(e=>e.dispose()),this._notebookEditor.hasModel()&&this._updateListener()}_log(e,t){if(this._enabled){const o=this._notebookEditor.getViewHeight(e)}}_updateListener(){if(!this._notebookEditor.hasModel())return;for(let o=0;o<this._notebookEditor.getLength();o++){const s=this._notebookEditor.cellAt(o);this._cellStateListeners.push(s.onDidChangeLayout(l=>{this._log(s,l)}))}this._localStore.add(this._notebookEditor.onDidChangeViewCells(o=>{[...o.splices].reverse().forEach(s=>{const[l,g,k]=s,_=this._cellStateListeners.splice(l,g,...k.map(p=>p.onDidChangeLayout(C=>{this._log(p,C)})));b(_)})}));const e=this._notebookEditor.getViewModel();let t=[];this._enabled&&(t=this._getItemsForCells()),this._cellStatusItems=e.deltaCellStatusBarItems(this._cellStatusItems,t)}_getItemsForCells(){const e=[];for(let t=0;t<this._notebookEditor.getLength();t++)e.push({handle:t,items:[{text:`index: ${t}`,alignment:f.Left,priority:Number.MAX_SAFE_INTEGER}]});return e}dispose(){b(this._cellStateListeners),super.dispose()}}E(h.id,h),d(class extends c{constructor(){super({id:"notebook.toggleLayoutTroubleshoot",title:n("workbench.notebook.toggleLayoutTroubleshoot","Toggle Layout Troubleshoot"),category:a.Developer,f1:!0})}async run(r){const i=r.get(u),e=m(i.activeEditorPane);if(!e)return;e.getContribution(h.id)?.toggle()}}),d(class extends c{constructor(){super({id:"notebook.inspectLayout",title:n("workbench.notebook.inspectLayout","Inspect Notebook Layout"),category:a.Developer,f1:!0})}async run(r){const i=r.get(u),e=m(i.activeEditorPane);if(!(!e||!e.hasModel()))for(let t=0;t<e.getLength();t++){const o=e.cellAt(t)}}}),d(class extends c{constructor(){super({id:"notebook.clearNotebookEdtitorTypeCache",title:n("workbench.notebook.clearNotebookEdtitorTypeCache","Clear Notebook Editor Type Cache"),category:a.Developer,f1:!0})}async run(r){r.get(v).clearEditorCache()}});export{h as TroubleshootController};
