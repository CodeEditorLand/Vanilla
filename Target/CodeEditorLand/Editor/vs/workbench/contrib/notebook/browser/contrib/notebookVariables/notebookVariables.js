var b=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var p=(n,o,e,i)=>{for(var t=i>1?void 0:i?m(o,e):o,s=n.length-1,a;s>=0;s--)(a=n[s])&&(t=(i?a(o,e,t):a(t))||t);return i&&t&&b(o,e,t),t},r=(n,o)=>(e,i)=>o(e,i,n);import{Disposable as f}from"../../../../../../base/common/lifecycle.js";import*as g from"../../../../../../nls.js";import{IConfigurationService as I}from"../../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as u}from"../../../../../../platform/contextkey/common/contextkey.js";import{SyncDescriptor as E}from"../../../../../../platform/instantiation/common/descriptors.js";import{Registry as d}from"../../../../../../platform/registry/common/platform.js";import{Extensions as S}from"../../../../../common/views.js";import{IEditorService as w}from"../../../../../services/editor/common/editorService.js";import{VIEWLET_ID as V}from"../../../../debug/common/debug.js";import{NotebookSetting as v}from"../../../common/notebookCommon.js";import{INotebookExecutionStateService as y}from"../../../common/notebookExecutionStateService.js";import{INotebookKernelService as C}from"../../../common/notebookKernelService.js";import{INotebookService as k}from"../../../common/notebookService.js";import{getNotebookEditorFromEditorPane as D}from"../../notebookBrowser.js";import{variablesViewIcon as x}from"../../notebookIcons.js";import{NOTEBOOK_VARIABLE_VIEW_ENABLED as h}from"./notebookVariableContextKeys.js";import{NotebookVariablesView as R}from"./notebookVariablesView.js";let c=class extends f{constructor(e,i,t,s,a,K){super();this.configurationService=i;this.editorService=t;this.notebookExecutionStateService=s;this.notebookKernelService=a;this.notebookDocumentService=K;this.viewEnabled=h.bindTo(e),this.listeners.push(this.editorService.onDidActiveEditorChange(()=>this.handleInitEvent())),this.listeners.push(this.notebookExecutionStateService.onDidChangeExecution(l=>this.handleInitEvent(l.notebook))),this.configListener=i.onDidChangeConfiguration(l=>this.handleConfigChange(l))}listeners=[];configListener;initialized=!1;viewEnabled;handleConfigChange(e){e.affectsConfiguration(v.notebookVariablesView)&&(this.configurationService.getValue(v.notebookVariablesView)?this.initialized?this.viewEnabled.set(!0):this.handleInitEvent():this.viewEnabled.set(!1))}handleInitEvent(e){this.configurationService.getValue(v.notebookVariablesView)&&(e||this.editorService.activeEditorPane?.getId()==="workbench.editor.notebook")&&this.hasVariableProvider(e)&&!this.initialized&&this.initializeView()&&(this.viewEnabled.set(!0),this.initialized=!0,this.listeners.forEach(i=>i.dispose()))}hasVariableProvider(e){const i=e?this.notebookDocumentService.getNotebookTextModel(e):D(this.editorService.activeEditorPane)?.getViewModel()?.notebookDocument;return i&&this.notebookKernelService.getMatchingKernel(i).selected?.hasVariableProvider}initializeView(){const e=d.as("workbench.registry.view.containers").get(V);if(e){const i=d.as(S.ViewsRegistry),t={id:"NOTEBOOK_VARIABLES",name:g.localize2("notebookVariables","Notebook Variables"),containerIcon:x,ctorDescriptor:new E(R),order:50,weight:5,canToggleVisibility:!0,canMoveView:!0,collapsed:!0,when:h};return i.registerViews([t],e),!0}return!1}dispose(){super.dispose(),this.listeners.forEach(e=>e.dispose()),this.configListener.dispose()}};c=p([r(0,u),r(1,I),r(2,w),r(3,y),r(4,C),r(5,k)],c);export{c as NotebookVariables};
