var b=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var d=(n,o,e,i)=>{for(var t=i>1?void 0:i?f(o,e):o,s=n.length-1,a;s>=0;s--)(a=n[s])&&(t=(i?a(o,e,t):a(t))||t);return i&&t&&b(o,e,t),t},r=(n,o)=>(e,i)=>o(e,i,n);import{Disposable as m}from"../../../../../../../vs/base/common/lifecycle.js";import"../../../../../../../vs/base/common/uri.js";import*as g from"../../../../../../../vs/nls.js";import{IConfigurationService as I}from"../../../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as u}from"../../../../../../../vs/platform/contextkey/common/contextkey.js";import{SyncDescriptor as E}from"../../../../../../../vs/platform/instantiation/common/descriptors.js";import{Registry as h}from"../../../../../../../vs/platform/registry/common/platform.js";import"../../../../../../../vs/workbench/common/contributions.js";import{Extensions as S}from"../../../../../../../vs/workbench/common/views.js";import{VIEWLET_ID as w}from"../../../../../../../vs/workbench/contrib/debug/common/debug.js";import{NOTEBOOK_VARIABLE_VIEW_ENABLED as p}from"../../../../../../../vs/workbench/contrib/notebook/browser/contrib/notebookVariables/notebookVariableContextKeys.js";import{NotebookVariablesView as V}from"../../../../../../../vs/workbench/contrib/notebook/browser/contrib/notebookVariables/notebookVariablesView.js";import{getNotebookEditorFromEditorPane as C}from"../../../../../../../vs/workbench/contrib/notebook/browser/notebookBrowser.js";import{variablesViewIcon as k}from"../../../../../../../vs/workbench/contrib/notebook/browser/notebookIcons.js";import{NotebookSetting as v}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookCommon.js";import{INotebookExecutionStateService as y}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookExecutionStateService.js";import{INotebookKernelService as D}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookKernelService.js";import{INotebookService as x}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookService.js";import{IEditorService as R}from"../../../../../../../vs/workbench/services/editor/common/editorService.js";let c=class extends m{constructor(e,i,t,s,a,K){super();this.configurationService=i;this.editorService=t;this.notebookExecutionStateService=s;this.notebookKernelService=a;this.notebookDocumentService=K;this.viewEnabled=p.bindTo(e),this.listeners.push(this.editorService.onDidActiveEditorChange(()=>this.handleInitEvent())),this.listeners.push(this.notebookExecutionStateService.onDidChangeExecution(l=>this.handleInitEvent(l.notebook))),this.configListener=i.onDidChangeConfiguration(l=>this.handleConfigChange(l))}listeners=[];configListener;initialized=!1;viewEnabled;handleConfigChange(e){e.affectsConfiguration(v.notebookVariablesView)&&(this.configurationService.getValue(v.notebookVariablesView)?this.initialized?this.viewEnabled.set(!0):this.handleInitEvent():this.viewEnabled.set(!1))}handleInitEvent(e){this.configurationService.getValue(v.notebookVariablesView)&&(e||this.editorService.activeEditorPane?.getId()==="workbench.editor.notebook")&&this.hasVariableProvider(e)&&!this.initialized&&this.initializeView()&&(this.viewEnabled.set(!0),this.initialized=!0,this.listeners.forEach(i=>i.dispose()))}hasVariableProvider(e){const i=e?this.notebookDocumentService.getNotebookTextModel(e):C(this.editorService.activeEditorPane)?.getViewModel()?.notebookDocument;return i&&this.notebookKernelService.getMatchingKernel(i).selected?.hasVariableProvider}initializeView(){const e=h.as("workbench.registry.view.containers").get(w);if(e){const i=h.as(S.ViewsRegistry),t={id:"NOTEBOOK_VARIABLES",name:g.localize2("notebookVariables","Notebook Variables"),containerIcon:k,ctorDescriptor:new E(V),order:50,weight:5,canToggleVisibility:!0,canMoveView:!0,collapsed:!0,when:p};return i.registerViews([t],e),!0}return!1}dispose(){super.dispose(),this.listeners.forEach(e=>e.dispose()),this.configListener.dispose()}};c=d([r(0,u),r(1,I),r(2,R),r(3,y),r(4,D),r(5,x)],c);export{c as NotebookVariables};
