{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/diff/notebookDiffOverviewRuler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../base/browser/dom.js';\nimport { createFastDomNode, FastDomNode } from '../../../../../base/browser/fastDomNode.js';\nimport { PixelRatio } from '../../../../../base/browser/pixelRatio.js';\nimport { Color } from '../../../../../base/common/color.js';\nimport { DisposableStore, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { defaultInsertColor, defaultRemoveColor, diffInserted, diffOverviewRulerInserted, diffOverviewRulerRemoved, diffRemoved } from '../../../../../platform/theme/common/colorRegistry.js';\nimport { IColorTheme, IThemeService, Themable } from '../../../../../platform/theme/common/themeService.js';\nimport { IDiffElementViewModelBase } from './diffElementViewModel.js';\nimport { NotebookDiffEditorEventDispatcher } from './eventDispatcher.js';\nimport { INotebookTextDiffEditor } from './notebookDiffEditorBrowser.js';\n\nconst MINIMUM_SLIDER_SIZE = 20;\n\nexport class NotebookDiffOverviewRuler extends Themable {\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _overviewViewportDomElement: FastDomNode<HTMLElement>;\n\n\tprivate _diffElementViewModels: readonly IDiffElementViewModelBase[] = [];\n\tprivate _lanes = 2;\n\n\tprivate _insertColor: Color | null;\n\tprivate _insertColorHex: string | null;\n\tprivate _removeColor: Color | null;\n\tprivate _removeColorHex: string | null;\n\n\tprivate readonly _disposables: DisposableStore;\n\tprivate _renderAnimationFrame: IDisposable | null;\n\n\tconstructor(readonly notebookEditor: INotebookTextDiffEditor, readonly width: number, container: HTMLElement, @IThemeService themeService: IThemeService) {\n\t\tsuper(themeService);\n\t\tthis._insertColor = null;\n\t\tthis._removeColor = null;\n\t\tthis._insertColorHex = null;\n\t\tthis._removeColorHex = null;\n\t\tthis._disposables = this._register(new DisposableStore());\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._domNode = createFastDomNode(document.createElement('canvas'));\n\t\tthis._domNode.setPosition('relative');\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain('strict');\n\n\t\tcontainer.appendChild(this._domNode.domNode);\n\n\t\tthis._overviewViewportDomElement = createFastDomNode(document.createElement('div'));\n\t\tthis._overviewViewportDomElement.setClassName('diffViewport');\n\t\tthis._overviewViewportDomElement.setPosition('absolute');\n\t\tthis._overviewViewportDomElement.setWidth(width);\n\t\tcontainer.appendChild(this._overviewViewportDomElement.domNode);\n\n\t\tthis._register(PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).onDidChange(() => {\n\t\t\tthis._scheduleRender();\n\t\t}));\n\n\t\tthis._register(this.themeService.onDidColorThemeChange(e => {\n\t\t\tconst colorChanged = this.applyColors(e);\n\t\t\tif (colorChanged) {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}\n\t\t}));\n\t\tthis.applyColors(this.themeService.getColorTheme());\n\n\t\tthis._register(this.notebookEditor.onDidScroll(() => {\n\t\t\tthis._renderOverviewViewport();\n\t\t}));\n\n\t\tthis._register(DOM.addStandardDisposableListener(container, DOM.EventType.POINTER_DOWN, (e) => {\n\t\t\tthis.notebookEditor.delegateVerticalScrollbarPointerDown(e);\n\t\t}));\n\t}\n\n\tprivate applyColors(theme: IColorTheme): boolean {\n\t\tconst newInsertColor = theme.getColor(diffOverviewRulerInserted) || (theme.getColor(diffInserted) || defaultInsertColor).transparent(2);\n\t\tconst newRemoveColor = theme.getColor(diffOverviewRulerRemoved) || (theme.getColor(diffRemoved) || defaultRemoveColor).transparent(2);\n\t\tconst hasChanges = !newInsertColor.equals(this._insertColor) || !newRemoveColor.equals(this._removeColor);\n\t\tthis._insertColor = newInsertColor;\n\t\tthis._removeColor = newRemoveColor;\n\t\tif (this._insertColor) {\n\t\t\tthis._insertColorHex = Color.Format.CSS.formatHexA(this._insertColor);\n\t\t}\n\n\t\tif (this._removeColor) {\n\t\t\tthis._removeColorHex = Color.Format.CSS.formatHexA(this._removeColor);\n\t\t}\n\n\t\treturn hasChanges;\n\t}\n\n\tlayout() {\n\t\tthis._layoutNow();\n\t}\n\n\tupdateViewModels(elements: readonly IDiffElementViewModelBase[], eventDispatcher: NotebookDiffEditorEventDispatcher | undefined) {\n\t\tthis._disposables.clear();\n\n\t\tthis._diffElementViewModels = elements;\n\n\t\tif (eventDispatcher) {\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\n\t\t\tthis._disposables.add(eventDispatcher.onDidChangeCellLayout(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}));\n\t\t}\n\n\t\tthis._scheduleRender();\n\t}\n\n\tprivate _scheduleRender(): void {\n\t\tif (this._renderAnimationFrame === null) {\n\t\t\tthis._renderAnimationFrame = DOM.runAtThisOrScheduleAtNextAnimationFrame(DOM.getWindow(this._domNode.domNode), this._onRenderScheduled.bind(this), 16);\n\t\t}\n\t}\n\n\tprivate _onRenderScheduled(): void {\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._layoutNow();\n\t}\n\n\tprivate _layoutNow() {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tconst height = layoutInfo.height;\n\t\tconst contentHeight = this._diffElementViewModels.map(view => view.totalHeight).reduce((a, b) => a + b, 0);\n\t\tconst ratio = PixelRatio.getInstance(DOM.getWindow(this._domNode.domNode)).value;\n\t\tthis._domNode.setWidth(this.width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.domNode.width = this.width * ratio;\n\t\tthis._domNode.domNode.height = height * ratio;\n\t\tconst ctx = this._domNode.domNode.getContext('2d')!;\n\t\tctx.clearRect(0, 0, this.width * ratio, height * ratio);\n\t\tthis._renderCanvas(ctx, this.width * ratio, height * ratio, contentHeight * ratio, ratio);\n\t\tthis._renderOverviewViewport();\n\t}\n\n\tprivate _renderOverviewViewport(): void {\n\t\tconst layout = this._computeOverviewViewport();\n\t\tif (!layout) {\n\t\t\tthis._overviewViewportDomElement.setTop(0);\n\t\t\tthis._overviewViewportDomElement.setHeight(0);\n\t\t} else {\n\t\t\tthis._overviewViewportDomElement.setTop(layout.top);\n\t\t\tthis._overviewViewportDomElement.setHeight(layout.height);\n\t\t}\n\t}\n\n\tprivate _computeOverviewViewport(): { height: number; top: number } | null {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tif (!layoutInfo) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst scrollTop = this.notebookEditor.getScrollTop();\n\t\tconst scrollHeight = this.notebookEditor.getScrollHeight();\n\n\t\tconst computedAvailableSize = Math.max(0, layoutInfo.height);\n\t\tconst computedRepresentableSize = Math.max(0, computedAvailableSize - 2 * 0);\n\t\tconst visibleSize = layoutInfo.height;\n\t\tconst computedSliderSize = Math.round(Math.max(MINIMUM_SLIDER_SIZE, Math.floor(visibleSize * computedRepresentableSize / scrollHeight)));\n\t\tconst computedSliderRatio = (computedRepresentableSize - computedSliderSize) / (scrollHeight - visibleSize);\n\t\tconst computedSliderPosition = Math.round(scrollTop * computedSliderRatio);\n\n\t\treturn {\n\t\t\theight: computedSliderSize,\n\t\t\ttop: computedSliderPosition\n\t\t};\n\t}\n\n\tprivate _renderCanvas(ctx: CanvasRenderingContext2D, width: number, height: number, scrollHeight: number, ratio: number) {\n\t\tif (!this._insertColorHex || !this._removeColorHex) {\n\t\t\t// no op when colors are not yet known\n\t\t\treturn;\n\t\t}\n\n\t\tconst laneWidth = width / this._lanes;\n\t\tlet currentFrom = 0;\n\t\tfor (let i = 0; i < this._diffElementViewModels.length; i++) {\n\t\t\tconst element = this._diffElementViewModels[i];\n\n\t\t\tconst cellHeight = Math.round((element.totalHeight / scrollHeight) * ratio * height);\n\t\t\tswitch (element.type) {\n\t\t\t\tcase 'insert':\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'delete':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'unchanged':\n\t\t\t\tcase 'unchangedMetadata':\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'modified':\n\t\t\t\tcase 'modifiedMetadata':\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\n\t\t\tcurrentFrom += cellHeight;\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tif (this._renderAnimationFrame !== null) {\n\t\t\tthis._renderAnimationFrame.dispose();\n\t\t\tthis._renderAnimationFrame = null;\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
