{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/diff/notebookDiffOverviewRuler.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from \"../../../../../base/browser/dom.js\";\nimport {\n\ttype FastDomNode,\n\tcreateFastDomNode,\n} from \"../../../../../base/browser/fastDomNode.js\";\nimport { PixelRatio } from \"../../../../../base/browser/pixelRatio.js\";\nimport { Color } from \"../../../../../base/common/color.js\";\nimport {\n\tDisposableStore,\n\ttype IDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport {\n\tdefaultInsertColor,\n\tdefaultRemoveColor,\n\tdiffInserted,\n\tdiffOverviewRulerInserted,\n\tdiffOverviewRulerRemoved,\n\tdiffRemoved,\n} from \"../../../../../platform/theme/common/colorRegistry.js\";\nimport {\n\ttype IColorTheme,\n\tIThemeService,\n\tThemable,\n} from \"../../../../../platform/theme/common/themeService.js\";\nimport type { IDiffElementViewModelBase } from \"./diffElementViewModel.js\";\nimport type { NotebookDiffEditorEventDispatcher } from \"./eventDispatcher.js\";\nimport type { INotebookTextDiffEditor } from \"./notebookDiffEditorBrowser.js\";\n\nconst MINIMUM_SLIDER_SIZE = 20;\n\nexport class NotebookDiffOverviewRuler extends Themable {\n\tprivate readonly _domNode: FastDomNode<HTMLCanvasElement>;\n\tprivate readonly _overviewViewportDomElement: FastDomNode<HTMLElement>;\n\n\tprivate _diffElementViewModels: readonly IDiffElementViewModelBase[] = [];\n\tprivate _lanes = 2;\n\n\tprivate _insertColor: Color | null;\n\tprivate _insertColorHex: string | null;\n\tprivate _removeColor: Color | null;\n\tprivate _removeColorHex: string | null;\n\n\tprivate readonly _disposables: DisposableStore;\n\tprivate _renderAnimationFrame: IDisposable | null;\n\n\tconstructor(\n\t\treadonly notebookEditor: INotebookTextDiffEditor,\n\t\treadonly width: number,\n\t\tcontainer: HTMLElement,\n\t\t@IThemeService themeService: IThemeService,\n\t) {\n\t\tsuper(themeService);\n\t\tthis._insertColor = null;\n\t\tthis._removeColor = null;\n\t\tthis._insertColorHex = null;\n\t\tthis._removeColorHex = null;\n\t\tthis._disposables = this._register(new DisposableStore());\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._domNode = createFastDomNode(document.createElement(\"canvas\"));\n\t\tthis._domNode.setPosition(\"relative\");\n\t\tthis._domNode.setLayerHinting(true);\n\t\tthis._domNode.setContain(\"strict\");\n\n\t\tcontainer.appendChild(this._domNode.domNode);\n\n\t\tthis._overviewViewportDomElement = createFastDomNode(\n\t\t\tdocument.createElement(\"div\"),\n\t\t);\n\t\tthis._overviewViewportDomElement.setClassName(\"diffViewport\");\n\t\tthis._overviewViewportDomElement.setPosition(\"absolute\");\n\t\tthis._overviewViewportDomElement.setWidth(width);\n\t\tcontainer.appendChild(this._overviewViewportDomElement.domNode);\n\n\t\tthis._register(\n\t\t\tPixelRatio.getInstance(\n\t\t\t\tDOM.getWindow(this._domNode.domNode),\n\t\t\t).onDidChange(() => {\n\t\t\t\tthis._scheduleRender();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.themeService.onDidColorThemeChange((e) => {\n\t\t\t\tconst colorChanged = this.applyColors(e);\n\t\t\t\tif (colorChanged) {\n\t\t\t\t\tthis._scheduleRender();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis.applyColors(this.themeService.getColorTheme());\n\n\t\tthis._register(\n\t\t\tthis.notebookEditor.onDidScroll(() => {\n\t\t\t\tthis._renderOverviewViewport();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tDOM.addStandardDisposableListener(\n\t\t\t\tcontainer,\n\t\t\t\tDOM.EventType.POINTER_DOWN,\n\t\t\t\t(e) => {\n\t\t\t\t\tthis.notebookEditor.delegateVerticalScrollbarPointerDown(e);\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate applyColors(theme: IColorTheme): boolean {\n\t\tconst newInsertColor =\n\t\t\ttheme.getColor(diffOverviewRulerInserted) ||\n\t\t\t(theme.getColor(diffInserted) || defaultInsertColor).transparent(2);\n\t\tconst newRemoveColor =\n\t\t\ttheme.getColor(diffOverviewRulerRemoved) ||\n\t\t\t(theme.getColor(diffRemoved) || defaultRemoveColor).transparent(2);\n\t\tconst hasChanges =\n\t\t\t!newInsertColor.equals(this._insertColor) ||\n\t\t\t!newRemoveColor.equals(this._removeColor);\n\t\tthis._insertColor = newInsertColor;\n\t\tthis._removeColor = newRemoveColor;\n\t\tif (this._insertColor) {\n\t\t\tthis._insertColorHex = Color.Format.CSS.formatHexA(\n\t\t\t\tthis._insertColor,\n\t\t\t);\n\t\t}\n\n\t\tif (this._removeColor) {\n\t\t\tthis._removeColorHex = Color.Format.CSS.formatHexA(\n\t\t\t\tthis._removeColor,\n\t\t\t);\n\t\t}\n\n\t\treturn hasChanges;\n\t}\n\n\tlayout() {\n\t\tthis._layoutNow();\n\t}\n\n\tupdateViewModels(\n\t\telements: readonly IDiffElementViewModelBase[],\n\t\teventDispatcher: NotebookDiffEditorEventDispatcher | undefined,\n\t) {\n\t\tthis._disposables.clear();\n\n\t\tthis._diffElementViewModels = elements;\n\n\t\tif (eventDispatcher) {\n\t\t\tthis._disposables.add(\n\t\t\t\teventDispatcher.onDidChangeLayout(() => {\n\t\t\t\t\tthis._scheduleRender();\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tthis._disposables.add(\n\t\t\t\teventDispatcher.onDidChangeCellLayout(() => {\n\t\t\t\t\tthis._scheduleRender();\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\tthis._scheduleRender();\n\t}\n\n\tprivate _scheduleRender(): void {\n\t\tif (this._renderAnimationFrame === null) {\n\t\t\tthis._renderAnimationFrame =\n\t\t\t\tDOM.runAtThisOrScheduleAtNextAnimationFrame(\n\t\t\t\t\tDOM.getWindow(this._domNode.domNode),\n\t\t\t\t\tthis._onRenderScheduled.bind(this),\n\t\t\t\t\t16,\n\t\t\t\t);\n\t\t}\n\t}\n\n\tprivate _onRenderScheduled(): void {\n\t\tthis._renderAnimationFrame = null;\n\t\tthis._layoutNow();\n\t}\n\n\tprivate _layoutNow() {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tconst height = layoutInfo.height;\n\t\tconst contentHeight = this._diffElementViewModels\n\t\t\t.map((view) => view.totalHeight)\n\t\t\t.reduce((a, b) => a + b, 0);\n\t\tconst ratio = PixelRatio.getInstance(\n\t\t\tDOM.getWindow(this._domNode.domNode),\n\t\t).value;\n\t\tthis._domNode.setWidth(this.width);\n\t\tthis._domNode.setHeight(height);\n\t\tthis._domNode.domNode.width = this.width * ratio;\n\t\tthis._domNode.domNode.height = height * ratio;\n\t\tconst ctx = this._domNode.domNode.getContext(\"2d\")!;\n\t\tctx.clearRect(0, 0, this.width * ratio, height * ratio);\n\t\tthis._renderCanvas(\n\t\t\tctx,\n\t\t\tthis.width * ratio,\n\t\t\theight * ratio,\n\t\t\tcontentHeight * ratio,\n\t\t\tratio,\n\t\t);\n\t\tthis._renderOverviewViewport();\n\t}\n\n\tprivate _renderOverviewViewport(): void {\n\t\tconst layout = this._computeOverviewViewport();\n\t\tif (layout) {\n\t\t\tthis._overviewViewportDomElement.setTop(layout.top);\n\t\t\tthis._overviewViewportDomElement.setHeight(layout.height);\n\t\t} else {\n\t\t\tthis._overviewViewportDomElement.setTop(0);\n\t\t\tthis._overviewViewportDomElement.setHeight(0);\n\t\t}\n\t}\n\n\tprivate _computeOverviewViewport(): { height: number; top: number } | null {\n\t\tconst layoutInfo = this.notebookEditor.getLayoutInfo();\n\t\tif (!layoutInfo) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst scrollTop = this.notebookEditor.getScrollTop();\n\t\tconst scrollHeight = this.notebookEditor.getScrollHeight();\n\n\t\tconst computedAvailableSize = Math.max(0, layoutInfo.height);\n\t\tconst computedRepresentableSize = Math.max(\n\t\t\t0,\n\t\t\tcomputedAvailableSize - 2 * 0,\n\t\t);\n\t\tconst visibleSize = layoutInfo.height;\n\t\tconst computedSliderSize = Math.round(\n\t\t\tMath.max(\n\t\t\t\tMINIMUM_SLIDER_SIZE,\n\t\t\t\tMath.floor(\n\t\t\t\t\t(visibleSize * computedRepresentableSize) / scrollHeight,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tconst computedSliderRatio =\n\t\t\t(computedRepresentableSize - computedSliderSize) /\n\t\t\t(scrollHeight - visibleSize);\n\t\tconst computedSliderPosition = Math.round(\n\t\t\tscrollTop * computedSliderRatio,\n\t\t);\n\n\t\treturn {\n\t\t\theight: computedSliderSize,\n\t\t\ttop: computedSliderPosition,\n\t\t};\n\t}\n\n\tprivate _renderCanvas(\n\t\tctx: CanvasRenderingContext2D,\n\t\twidth: number,\n\t\theight: number,\n\t\tscrollHeight: number,\n\t\tratio: number,\n\t) {\n\t\tif (!this._insertColorHex || !this._removeColorHex) {\n\t\t\t// no op when colors are not yet known\n\t\t\treturn;\n\t\t}\n\n\t\tconst laneWidth = width / this._lanes;\n\t\tlet currentFrom = 0;\n\t\tfor (let i = 0; i < this._diffElementViewModels.length; i++) {\n\t\t\tconst element = this._diffElementViewModels[i];\n\n\t\t\tconst cellHeight = Math.round(\n\t\t\t\t(element.totalHeight / scrollHeight) * ratio * height,\n\t\t\t);\n\t\t\tswitch (element.type) {\n\t\t\t\tcase \"insert\":\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"delete\":\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"unchanged\":\n\t\t\t\t\tbreak;\n\t\t\t\tcase \"modified\":\n\t\t\t\t\tctx.fillStyle = this._removeColorHex;\n\t\t\t\t\tctx.fillRect(0, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tctx.fillStyle = this._insertColorHex;\n\t\t\t\t\tctx.fillRect(laneWidth, currentFrom, laneWidth, cellHeight);\n\t\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tcurrentFrom += cellHeight;\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tif (this._renderAnimationFrame !== null) {\n\t\t\tthis._renderAnimationFrame.dispose();\n\t\t\tthis._renderAnimationFrame = null;\n\t\t}\n\n\t\tsuper.dispose();\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,YAAY,SAAS;AACrB;AAAA,EAEC;AAAA,OACM;AACP,SAAS,kBAAkB;AAC3B,SAAS,aAAa;AACtB;AAAA,EACC;AAAA,OAEM;AACP;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP;AAAA,EAEC;AAAA,EACA;AAAA,OACM;AAKP,MAAM,sBAAsB;AAErB,IAAM,4BAAN,cAAwC,SAAS;AAAA,EAevD,YACU,gBACA,OACT,WACe,cACd;AACD,UAAM,YAAY;AALT;AACA;AAKT,SAAK,eAAe;AACpB,SAAK,eAAe;AACpB,SAAK,kBAAkB;AACvB,SAAK,kBAAkB;AACvB,SAAK,eAAe,KAAK,UAAU,IAAI,gBAAgB,CAAC;AACxD,SAAK,wBAAwB;AAC7B,SAAK,WAAW,kBAAkB,SAAS,cAAc,QAAQ,CAAC;AAClE,SAAK,SAAS,YAAY,UAAU;AACpC,SAAK,SAAS,gBAAgB,IAAI;AAClC,SAAK,SAAS,WAAW,QAAQ;AAEjC,cAAU,YAAY,KAAK,SAAS,OAAO;AAE3C,SAAK,8BAA8B;AAAA,MAClC,SAAS,cAAc,KAAK;AAAA,IAC7B;AACA,SAAK,4BAA4B,aAAa,cAAc;AAC5D,SAAK,4BAA4B,YAAY,UAAU;AACvD,SAAK,4BAA4B,SAAS,KAAK;AAC/C,cAAU,YAAY,KAAK,4BAA4B,OAAO;AAE9D,SAAK;AAAA,MACJ,WAAW;AAAA,QACV,IAAI,UAAU,KAAK,SAAS,OAAO;AAAA,MACpC,EAAE,YAAY,MAAM;AACnB,aAAK,gBAAgB;AAAA,MACtB,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,KAAK,aAAa,sBAAsB,CAAC,MAAM;AAC9C,cAAM,eAAe,KAAK,YAAY,CAAC;AACvC,YAAI,cAAc;AACjB,eAAK,gBAAgB;AAAA,QACtB;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK,YAAY,KAAK,aAAa,cAAc,CAAC;AAElD,SAAK;AAAA,MACJ,KAAK,eAAe,YAAY,MAAM;AACrC,aAAK,wBAAwB;AAAA,MAC9B,CAAC;AAAA,IACF;AAEA,SAAK;AAAA,MACJ,IAAI;AAAA,QACH;AAAA,QACA,IAAI,UAAU;AAAA,QACd,CAAC,MAAM;AACN,eAAK,eAAe,qCAAqC,CAAC;AAAA,QAC3D;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EA/GD,OAmCwD;AAAA;AAAA;AAAA,EACtC;AAAA,EACA;AAAA,EAET,yBAA+D,CAAC;AAAA,EAChE,SAAS;AAAA,EAET;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAES;AAAA,EACT;AAAA,EAiEA,YAAY,OAA6B;AAChD,UAAM,iBACL,MAAM,SAAS,yBAAyB,MACvC,MAAM,SAAS,YAAY,KAAK,oBAAoB,YAAY,CAAC;AACnE,UAAM,iBACL,MAAM,SAAS,wBAAwB,MACtC,MAAM,SAAS,WAAW,KAAK,oBAAoB,YAAY,CAAC;AAClE,UAAM,aACL,CAAC,eAAe,OAAO,KAAK,YAAY,KACxC,CAAC,eAAe,OAAO,KAAK,YAAY;AACzC,SAAK,eAAe;AACpB,SAAK,eAAe;AACpB,QAAI,KAAK,cAAc;AACtB,WAAK,kBAAkB,MAAM,OAAO,IAAI;AAAA,QACvC,KAAK;AAAA,MACN;AAAA,IACD;AAEA,QAAI,KAAK,cAAc;AACtB,WAAK,kBAAkB,MAAM,OAAO,IAAI;AAAA,QACvC,KAAK;AAAA,MACN;AAAA,IACD;AAEA,WAAO;AAAA,EACR;AAAA,EAEA,SAAS;AACR,SAAK,WAAW;AAAA,EACjB;AAAA,EAEA,iBACC,UACA,iBACC;AACD,SAAK,aAAa,MAAM;AAExB,SAAK,yBAAyB;AAE9B,QAAI,iBAAiB;AACpB,WAAK,aAAa;AAAA,QACjB,gBAAgB,kBAAkB,MAAM;AACvC,eAAK,gBAAgB;AAAA,QACtB,CAAC;AAAA,MACF;AAEA,WAAK,aAAa;AAAA,QACjB,gBAAgB,sBAAsB,MAAM;AAC3C,eAAK,gBAAgB;AAAA,QACtB,CAAC;AAAA,MACF;AAAA,IACD;AAEA,SAAK,gBAAgB;AAAA,EACtB;AAAA,EAEQ,kBAAwB;AAC/B,QAAI,KAAK,0BAA0B,MAAM;AACxC,WAAK,wBACJ,IAAI;AAAA,QACH,IAAI,UAAU,KAAK,SAAS,OAAO;AAAA,QACnC,KAAK,mBAAmB,KAAK,IAAI;AAAA,QACjC;AAAA,MACD;AAAA,IACF;AAAA,EACD;AAAA,EAEQ,qBAA2B;AAClC,SAAK,wBAAwB;AAC7B,SAAK,WAAW;AAAA,EACjB;AAAA,EAEQ,aAAa;AACpB,UAAM,aAAa,KAAK,eAAe,cAAc;AACrD,UAAM,SAAS,WAAW;AAC1B,UAAM,gBAAgB,KAAK,uBACzB,IAAI,CAAC,SAAS,KAAK,WAAW,EAC9B,OAAO,CAAC,GAAG,MAAM,IAAI,GAAG,CAAC;AAC3B,UAAM,QAAQ,WAAW;AAAA,MACxB,IAAI,UAAU,KAAK,SAAS,OAAO;AAAA,IACpC,EAAE;AACF,SAAK,SAAS,SAAS,KAAK,KAAK;AACjC,SAAK,SAAS,UAAU,MAAM;AAC9B,SAAK,SAAS,QAAQ,QAAQ,KAAK,QAAQ;AAC3C,SAAK,SAAS,QAAQ,SAAS,SAAS;AACxC,UAAM,MAAM,KAAK,SAAS,QAAQ,WAAW,IAAI;AACjD,QAAI,UAAU,GAAG,GAAG,KAAK,QAAQ,OAAO,SAAS,KAAK;AACtD,SAAK;AAAA,MACJ;AAAA,MACA,KAAK,QAAQ;AAAA,MACb,SAAS;AAAA,MACT,gBAAgB;AAAA,MAChB;AAAA,IACD;AACA,SAAK,wBAAwB;AAAA,EAC9B;AAAA,EAEQ,0BAAgC;AACvC,UAAM,SAAS,KAAK,yBAAyB;AAC7C,QAAI,QAAQ;AACX,WAAK,4BAA4B,OAAO,OAAO,GAAG;AAClD,WAAK,4BAA4B,UAAU,OAAO,MAAM;AAAA,IACzD,OAAO;AACN,WAAK,4BAA4B,OAAO,CAAC;AACzC,WAAK,4BAA4B,UAAU,CAAC;AAAA,IAC7C;AAAA,EACD;AAAA,EAEQ,2BAAmE;AAC1E,UAAM,aAAa,KAAK,eAAe,cAAc;AACrD,QAAI,CAAC,YAAY;AAChB,aAAO;AAAA,IACR;AAEA,UAAM,YAAY,KAAK,eAAe,aAAa;AACnD,UAAM,eAAe,KAAK,eAAe,gBAAgB;AAEzD,UAAM,wBAAwB,KAAK,IAAI,GAAG,WAAW,MAAM;AAC3D,UAAM,4BAA4B,KAAK;AAAA,MACtC;AAAA,MACA,wBAAwB,IAAI;AAAA,IAC7B;AACA,UAAM,cAAc,WAAW;AAC/B,UAAM,qBAAqB,KAAK;AAAA,MAC/B,KAAK;AAAA,QACJ;AAAA,QACA,KAAK;AAAA,UACH,cAAc,4BAA6B;AAAA,QAC7C;AAAA,MACD;AAAA,IACD;AACA,UAAM,uBACJ,4BAA4B,uBAC5B,eAAe;AACjB,UAAM,yBAAyB,KAAK;AAAA,MACnC,YAAY;AAAA,IACb;AAEA,WAAO;AAAA,MACN,QAAQ;AAAA,MACR,KAAK;AAAA,IACN;AAAA,EACD;AAAA,EAEQ,cACP,KACA,OACA,QACA,cACA,OACC;AACD,QAAI,CAAC,KAAK,mBAAmB,CAAC,KAAK,iBAAiB;AAEnD;AAAA,IACD;AAEA,UAAM,YAAY,QAAQ,KAAK;AAC/B,QAAI,cAAc;AAClB,aAAS,IAAI,GAAG,IAAI,KAAK,uBAAuB,QAAQ,KAAK;AAC5D,YAAM,UAAU,KAAK,uBAAuB,CAAC;AAE7C,YAAM,aAAa,KAAK;AAAA,QACtB,QAAQ,cAAc,eAAgB,QAAQ;AAAA,MAChD;AACA,cAAQ,QAAQ,MAAM;AAAA,QACrB,KAAK;AACJ,cAAI,YAAY,KAAK;AACrB,cAAI,SAAS,WAAW,aAAa,WAAW,UAAU;AAC1D;AAAA,QACD,KAAK;AACJ,cAAI,YAAY,KAAK;AACrB,cAAI,SAAS,GAAG,aAAa,WAAW,UAAU;AAClD;AAAA,QACD,KAAK;AACJ;AAAA,QACD,KAAK;AACJ,cAAI,YAAY,KAAK;AACrB,cAAI,SAAS,GAAG,aAAa,WAAW,UAAU;AAClD,cAAI,YAAY,KAAK;AACrB,cAAI,SAAS,WAAW,aAAa,WAAW,UAAU;AAC1D;AAAA,MACF;AAEA,qBAAe;AAAA,IAChB;AAAA,EACD;AAAA,EAES,UAAU;AAClB,QAAI,KAAK,0BAA0B,MAAM;AACxC,WAAK,sBAAsB,QAAQ;AACnC,WAAK,wBAAwB;AAAA,IAC9B;AAEA,UAAM,QAAQ;AAAA,EACf;AACD;AAjRa,4BAAN;AAAA,EAmBJ;AAAA,GAnBU;",
  "names": []
}
