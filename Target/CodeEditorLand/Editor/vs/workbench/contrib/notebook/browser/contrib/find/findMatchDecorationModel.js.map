{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/find/findMatchDecorationModel.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport { Disposable } from \"../../../../../../base/common/lifecycle.js\";\nimport type { Range } from \"../../../../../../editor/common/core/range.js\";\nimport type { IModelDeltaDecoration } from \"../../../../../../editor/common/model.js\";\nimport type { ModelDecorationOptions } from \"../../../../../../editor/common/model/textModel.js\";\nimport { FindDecorations } from \"../../../../../../editor/contrib/find/browser/findDecorations.js\";\nimport {\n\toverviewRulerFindMatchForeground,\n\toverviewRulerSelectionHighlightForeground,\n} from \"../../../../../../platform/theme/common/colorRegistry.js\";\nimport {\n\ttype CellFindMatchWithIndex,\n\ttype ICellModelDecorations,\n\ttype ICellModelDeltaDecorations,\n\ttype ICellViewModel,\n\ttype INotebookDeltaDecoration,\n\ttype INotebookEditor,\n\tNotebookOverviewRulerLane,\n} from \"../../notebookBrowser.js\";\n\nexport class FindMatchDecorationModel extends Disposable {\n\tprivate _allMatchesDecorations: ICellModelDecorations[] = [];\n\tprivate _currentMatchCellDecorations: string[] = [];\n\tprivate _allMatchesCellDecorations: string[] = [];\n\tprivate _currentMatchDecorations:\n\t\t| { kind: \"input\"; decorations: ICellModelDecorations[] }\n\t\t| { kind: \"output\"; index: number }\n\t\t| null = null;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\tprivate readonly ownerID: string,\n\t) {\n\t\tsuper();\n\t}\n\n\tpublic get currentMatchDecorations() {\n\t\treturn this._currentMatchDecorations;\n\t}\n\n\tprivate clearDecorations() {\n\t\tthis.clearCurrentFindMatchDecoration();\n\t\tthis.setAllFindMatchesDecorations([]);\n\t}\n\n\tpublic async highlightCurrentFindMatchDecorationInCell(\n\t\tcell: ICellViewModel,\n\t\tcellRange: Range,\n\t): Promise<number | null> {\n\t\tthis.clearCurrentFindMatchDecoration();\n\n\t\t// match is an editor FindMatch, we update find match decoration in the editor\n\t\t// we will highlight the match in the webview\n\t\tthis._notebookEditor.changeModelDecorations((accessor) => {\n\t\t\tconst findMatchesOptions: ModelDecorationOptions =\n\t\t\t\tFindDecorations._CURRENT_FIND_MATCH_DECORATION;\n\n\t\t\tconst decorations: IModelDeltaDecoration[] = [\n\t\t\t\t{ range: cellRange, options: findMatchesOptions },\n\t\t\t];\n\t\t\tconst deltaDecoration: ICellModelDeltaDecorations = {\n\t\t\t\townerId: cell.handle,\n\t\t\t\tdecorations: decorations,\n\t\t\t};\n\n\t\t\tthis._currentMatchDecorations = {\n\t\t\t\tkind: \"input\",\n\t\t\t\tdecorations: accessor.deltaDecorations(\n\t\t\t\t\tthis._currentMatchDecorations?.kind === \"input\"\n\t\t\t\t\t\t? this._currentMatchDecorations.decorations\n\t\t\t\t\t\t: [],\n\t\t\t\t\t[deltaDecoration],\n\t\t\t\t),\n\t\t\t};\n\t\t});\n\n\t\tthis._currentMatchCellDecorations =\n\t\t\tthis._notebookEditor.deltaCellDecorations(\n\t\t\t\tthis._currentMatchCellDecorations,\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\thandle: cell.handle,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\toverviewRuler: {\n\t\t\t\t\t\t\t\tcolor: overviewRulerSelectionHighlightForeground,\n\t\t\t\t\t\t\t\tmodelRanges: [cellRange],\n\t\t\t\t\t\t\t\tincludeOutput: false,\n\t\t\t\t\t\t\t\tposition: NotebookOverviewRulerLane.Center,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t);\n\n\t\treturn null;\n\t}\n\n\tpublic async highlightCurrentFindMatchDecorationInWebview(\n\t\tcell: ICellViewModel,\n\t\tindex: number,\n\t): Promise<number | null> {\n\t\tthis.clearCurrentFindMatchDecoration();\n\n\t\tconst offset = await this._notebookEditor.findHighlightCurrent(\n\t\t\tindex,\n\t\t\tthis.ownerID,\n\t\t);\n\t\tthis._currentMatchDecorations = { kind: \"output\", index: index };\n\n\t\tthis._currentMatchCellDecorations =\n\t\t\tthis._notebookEditor.deltaCellDecorations(\n\t\t\t\tthis._currentMatchCellDecorations,\n\t\t\t\t[\n\t\t\t\t\t{\n\t\t\t\t\t\thandle: cell.handle,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\toverviewRuler: {\n\t\t\t\t\t\t\t\tcolor: overviewRulerSelectionHighlightForeground,\n\t\t\t\t\t\t\t\tmodelRanges: [],\n\t\t\t\t\t\t\t\tincludeOutput: true,\n\t\t\t\t\t\t\t\tposition: NotebookOverviewRulerLane.Center,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t} satisfies INotebookDeltaDecoration,\n\t\t\t\t],\n\t\t\t);\n\n\t\treturn offset;\n\t}\n\n\tpublic clearCurrentFindMatchDecoration() {\n\t\tif (this._currentMatchDecorations?.kind === \"input\") {\n\t\t\tthis._notebookEditor.changeModelDecorations((accessor) => {\n\t\t\t\taccessor.deltaDecorations(\n\t\t\t\t\tthis._currentMatchDecorations?.kind === \"input\"\n\t\t\t\t\t\t? this._currentMatchDecorations.decorations\n\t\t\t\t\t\t: [],\n\t\t\t\t\t[],\n\t\t\t\t);\n\t\t\t\tthis._currentMatchDecorations = null;\n\t\t\t});\n\t\t} else if (this._currentMatchDecorations?.kind === \"output\") {\n\t\t\tthis._notebookEditor.findUnHighlightCurrent(\n\t\t\t\tthis._currentMatchDecorations.index,\n\t\t\t\tthis.ownerID,\n\t\t\t);\n\t\t}\n\n\t\tthis._currentMatchCellDecorations =\n\t\t\tthis._notebookEditor.deltaCellDecorations(\n\t\t\t\tthis._currentMatchCellDecorations,\n\t\t\t\t[],\n\t\t\t);\n\t}\n\n\tpublic setAllFindMatchesDecorations(\n\t\tcellFindMatches: CellFindMatchWithIndex[],\n\t) {\n\t\tthis._notebookEditor.changeModelDecorations((accessor) => {\n\t\t\tconst findMatchesOptions: ModelDecorationOptions =\n\t\t\t\tFindDecorations._FIND_MATCH_DECORATION;\n\n\t\t\tconst deltaDecorations: ICellModelDeltaDecorations[] =\n\t\t\t\tcellFindMatches.map((cellFindMatch) => {\n\t\t\t\t\t// Find matches\n\t\t\t\t\tconst newFindMatchesDecorations: IModelDeltaDecoration[] =\n\t\t\t\t\t\tnew Array<IModelDeltaDecoration>(\n\t\t\t\t\t\t\tcellFindMatch.contentMatches.length,\n\t\t\t\t\t\t);\n\t\t\t\t\tfor (\n\t\t\t\t\t\tlet i = 0;\n\t\t\t\t\t\ti < cellFindMatch.contentMatches.length;\n\t\t\t\t\t\ti++\n\t\t\t\t\t) {\n\t\t\t\t\t\tnewFindMatchesDecorations[i] = {\n\t\t\t\t\t\t\trange: cellFindMatch.contentMatches[i].range,\n\t\t\t\t\t\t\toptions: findMatchesOptions,\n\t\t\t\t\t\t};\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\townerId: cellFindMatch.cell.handle,\n\t\t\t\t\t\tdecorations: newFindMatchesDecorations,\n\t\t\t\t\t};\n\t\t\t\t});\n\n\t\t\tthis._allMatchesDecorations = accessor.deltaDecorations(\n\t\t\t\tthis._allMatchesDecorations,\n\t\t\t\tdeltaDecorations,\n\t\t\t);\n\t\t});\n\n\t\tthis._allMatchesCellDecorations =\n\t\t\tthis._notebookEditor.deltaCellDecorations(\n\t\t\t\tthis._allMatchesCellDecorations,\n\t\t\t\tcellFindMatches.map((cellFindMatch) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\townerId: cellFindMatch.cell.handle,\n\t\t\t\t\t\thandle: cellFindMatch.cell.handle,\n\t\t\t\t\t\toptions: {\n\t\t\t\t\t\t\toverviewRuler: {\n\t\t\t\t\t\t\t\tcolor: overviewRulerFindMatchForeground,\n\t\t\t\t\t\t\t\tmodelRanges: cellFindMatch.contentMatches.map(\n\t\t\t\t\t\t\t\t\t(match) => match.range,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tincludeOutput:\n\t\t\t\t\t\t\t\t\tcellFindMatch.webviewMatches.length > 0,\n\t\t\t\t\t\t\t\tposition: NotebookOverviewRulerLane.Center,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t);\n\t}\n\n\tstopWebviewFind() {\n\t\tthis._notebookEditor.findStop(this.ownerID);\n\t}\n\n\toverride dispose() {\n\t\tthis.clearDecorations();\n\t\tsuper.dispose();\n\t}\n}\n"],
  "mappings": ";;AAIA,SAAS,kBAAkB;AAI3B,SAAS,uBAAuB;AAChC;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP;AAAA,EAOC;AAAA,OACM;AAEA,MAAM,iCAAiC,WAAW;AAAA,EASxD,YACkB,iBACA,SAChB;AACD,UAAM;AAHW;AACA;AAAA,EAGlB;AAAA,EArCD,OAuByD;AAAA;AAAA;AAAA,EAChD,yBAAkD,CAAC;AAAA,EACnD,+BAAyC,CAAC;AAAA,EAC1C,6BAAuC,CAAC;AAAA,EACxC,2BAGE;AAAA,EASV,IAAW,0BAA0B;AACpC,WAAO,KAAK;AAAA,EACb;AAAA,EAEQ,mBAAmB;AAC1B,SAAK,gCAAgC;AACrC,SAAK,6BAA6B,CAAC,CAAC;AAAA,EACrC;AAAA,EAEA,MAAa,0CACZ,MACA,WACyB;AACzB,SAAK,gCAAgC;AAIrC,SAAK,gBAAgB,uBAAuB,CAAC,aAAa;AACzD,YAAM,qBACL,gBAAgB;AAEjB,YAAM,cAAuC;AAAA,QAC5C,EAAE,OAAO,WAAW,SAAS,mBAAmB;AAAA,MACjD;AACA,YAAM,kBAA8C;AAAA,QACnD,SAAS,KAAK;AAAA,QACd;AAAA,MACD;AAEA,WAAK,2BAA2B;AAAA,QAC/B,MAAM;AAAA,QACN,aAAa,SAAS;AAAA,UACrB,KAAK,0BAA0B,SAAS,UACrC,KAAK,yBAAyB,cAC9B,CAAC;AAAA,UACJ,CAAC,eAAe;AAAA,QACjB;AAAA,MACD;AAAA,IACD,CAAC;AAED,SAAK,+BACJ,KAAK,gBAAgB;AAAA,MACpB,KAAK;AAAA,MACL;AAAA,QACC;AAAA,UACC,QAAQ,KAAK;AAAA,UACb,SAAS;AAAA,YACR,eAAe;AAAA,cACd,OAAO;AAAA,cACP,aAAa,CAAC,SAAS;AAAA,cACvB,eAAe;AAAA,cACf,UAAU,0BAA0B;AAAA,YACrC;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,WAAO;AAAA,EACR;AAAA,EAEA,MAAa,6CACZ,MACA,OACyB;AACzB,SAAK,gCAAgC;AAErC,UAAM,SAAS,MAAM,KAAK,gBAAgB;AAAA,MACzC;AAAA,MACA,KAAK;AAAA,IACN;AACA,SAAK,2BAA2B,EAAE,MAAM,UAAU,MAAa;AAE/D,SAAK,+BACJ,KAAK,gBAAgB;AAAA,MACpB,KAAK;AAAA,MACL;AAAA,QACC;AAAA,UACC,QAAQ,KAAK;AAAA,UACb,SAAS;AAAA,YACR,eAAe;AAAA,cACd,OAAO;AAAA,cACP,aAAa,CAAC;AAAA,cACd,eAAe;AAAA,cACf,UAAU,0BAA0B;AAAA,YACrC;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAAA,IACD;AAED,WAAO;AAAA,EACR;AAAA,EAEO,kCAAkC;AACxC,QAAI,KAAK,0BAA0B,SAAS,SAAS;AACpD,WAAK,gBAAgB,uBAAuB,CAAC,aAAa;AACzD,iBAAS;AAAA,UACR,KAAK,0BAA0B,SAAS,UACrC,KAAK,yBAAyB,cAC9B,CAAC;AAAA,UACJ,CAAC;AAAA,QACF;AACA,aAAK,2BAA2B;AAAA,MACjC,CAAC;AAAA,IACF,WAAW,KAAK,0BAA0B,SAAS,UAAU;AAC5D,WAAK,gBAAgB;AAAA,QACpB,KAAK,yBAAyB;AAAA,QAC9B,KAAK;AAAA,MACN;AAAA,IACD;AAEA,SAAK,+BACJ,KAAK,gBAAgB;AAAA,MACpB,KAAK;AAAA,MACL,CAAC;AAAA,IACF;AAAA,EACF;AAAA,EAEO,6BACN,iBACC;AACD,SAAK,gBAAgB,uBAAuB,CAAC,aAAa;AACzD,YAAM,qBACL,gBAAgB;AAEjB,YAAM,mBACL,gBAAgB,IAAI,CAAC,kBAAkB;AAEtC,cAAM,4BACL,IAAI;AAAA,UACH,cAAc,eAAe;AAAA,QAC9B;AACD,iBACK,IAAI,GACR,IAAI,cAAc,eAAe,QACjC,KACC;AACD,oCAA0B,CAAC,IAAI;AAAA,YAC9B,OAAO,cAAc,eAAe,CAAC,EAAE;AAAA,YACvC,SAAS;AAAA,UACV;AAAA,QACD;AAEA,eAAO;AAAA,UACN,SAAS,cAAc,KAAK;AAAA,UAC5B,aAAa;AAAA,QACd;AAAA,MACD,CAAC;AAEF,WAAK,yBAAyB,SAAS;AAAA,QACtC,KAAK;AAAA,QACL;AAAA,MACD;AAAA,IACD,CAAC;AAED,SAAK,6BACJ,KAAK,gBAAgB;AAAA,MACpB,KAAK;AAAA,MACL,gBAAgB,IAAI,CAAC,kBAAkB;AACtC,eAAO;AAAA,UACN,SAAS,cAAc,KAAK;AAAA,UAC5B,QAAQ,cAAc,KAAK;AAAA,UAC3B,SAAS;AAAA,YACR,eAAe;AAAA,cACd,OAAO;AAAA,cACP,aAAa,cAAc,eAAe;AAAA,gBACzC,CAAC,UAAU,MAAM;AAAA,cAClB;AAAA,cACA,eACC,cAAc,eAAe,SAAS;AAAA,cACvC,UAAU,0BAA0B;AAAA,YACrC;AAAA,UACD;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACF;AAAA,EAEA,kBAAkB;AACjB,SAAK,gBAAgB,SAAS,KAAK,OAAO;AAAA,EAC3C;AAAA,EAES,UAAU;AAClB,SAAK,iBAAiB;AACtB,UAAM,QAAQ;AAAA,EACf;AACD;",
  "names": []
}
