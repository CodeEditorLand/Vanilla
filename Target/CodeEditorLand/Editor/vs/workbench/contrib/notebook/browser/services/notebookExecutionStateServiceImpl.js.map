{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/services/notebookExecutionStateServiceImpl.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\tcombinedDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { ResourceMap } from \"../../../../../base/common/map.js\";\nimport { isEqual } from \"../../../../../base/common/resources.js\";\nimport type { URI } from \"../../../../../base/common/uri.js\";\nimport { generateUuid } from \"../../../../../base/common/uuid.js\";\nimport {\n\tAccessibilitySignal,\n\tIAccessibilitySignalService,\n} from \"../../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { ILogService } from \"../../../../../platform/log/common/log.js\";\nimport type { NotebookTextModel } from \"../../common/model/notebookTextModel.js\";\nimport {\n\tCellEditType,\n\tCellUri,\n\ttype ICellEditOperation,\n\tNotebookCellExecutionState,\n\ttype NotebookCellInternalMetadata,\n\tNotebookExecutionState,\n\ttype NotebookTextModelWillAddRemoveEvent,\n} from \"../../common/notebookCommon.js\";\nimport {\n\tCellExecutionUpdateType,\n\tINotebookExecutionService,\n} from \"../../common/notebookExecutionService.js\";\nimport {\n\ttype ICellExecuteUpdate,\n\ttype ICellExecutionComplete,\n\ttype ICellExecutionStateChangedEvent,\n\ttype ICellExecutionStateUpdate,\n\ttype IExecutionStateChangedEvent,\n\ttype IFailedCellInfo,\n\ttype INotebookCellExecution,\n\ttype INotebookExecution,\n\tINotebookExecutionStateService,\n\ttype INotebookFailStateChangedEvent,\n\tNotebookExecutionType,\n} from \"../../common/notebookExecutionStateService.js\";\nimport { INotebookKernelService } from \"../../common/notebookKernelService.js\";\nimport { INotebookService } from \"../../common/notebookService.js\";\n\nexport class NotebookExecutionStateService\n\textends Disposable\n\timplements INotebookExecutionStateService\n{\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _executions = new ResourceMap<\n\t\tMap<number, CellExecution>\n\t>();\n\tprivate readonly _notebookExecutions = new ResourceMap<\n\t\t[NotebookExecution, IDisposable]\n\t>();\n\tprivate readonly _notebookListeners =\n\t\tnew ResourceMap<NotebookExecutionListeners>();\n\tprivate readonly _cellListeners = new ResourceMap<IDisposable>();\n\tprivate readonly _lastFailedCells = new ResourceMap<IFailedCellInfo>();\n\n\tprivate readonly _onDidChangeExecution = this._register(\n\t\tnew Emitter<\n\t\t\tICellExecutionStateChangedEvent | IExecutionStateChangedEvent\n\t\t>(),\n\t);\n\tonDidChangeExecution = this._onDidChangeExecution.event;\n\n\tprivate readonly _onDidChangeLastRunFailState = this._register(\n\t\tnew Emitter<INotebookFailStateChangedEvent>(),\n\t);\n\tonDidChangeLastRunFailState = this._onDidChangeLastRunFailState.event;\n\n\tconstructor(\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilitySignalService private readonly _accessibilitySignalService: IAccessibilitySignalService\n\t) {\n\t\tsuper();\n\t}\n\n\tgetLastFailedCellForNotebook(notebook: URI): number | undefined {\n\t\tconst failedCell = this._lastFailedCells.get(notebook);\n\t\treturn failedCell?.visible ? failedCell.cellHandle : undefined;\n\t}\n\n\tforceCancelNotebookExecutions(notebookUri: URI): void {\n\t\tconst notebookCellExecutions = this._executions.get(notebookUri);\n\t\tif (notebookCellExecutions) {\n\t\t\tfor (const exe of notebookCellExecutions.values()) {\n\t\t\t\tthis._onCellExecutionDidComplete(\n\t\t\t\t\tnotebookUri,\n\t\t\t\t\texe.cellHandle,\n\t\t\t\t\texe,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (this._notebookExecutions.has(notebookUri)) {\n\t\t\tthis._onExecutionDidComplete(notebookUri);\n\t\t}\n\t}\n\n\tgetCellExecution(cellUri: URI): INotebookCellExecution | undefined {\n\t\tconst parsed = CellUri.parse(cellUri);\n\t\tif (!parsed) {\n\t\t\tthrow new Error(`Not a cell URI: ${cellUri}`);\n\t\t}\n\n\t\tconst exeMap = this._executions.get(parsed.notebook);\n\t\tif (exeMap) {\n\t\t\treturn exeMap.get(parsed.handle);\n\t\t}\n\n\t\treturn undefined;\n\t}\n\tgetExecution(notebook: URI): INotebookExecution | undefined {\n\t\treturn this._notebookExecutions.get(notebook)?.[0];\n\t}\n\n\tgetCellExecutionsForNotebook(notebook: URI): INotebookCellExecution[] {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? Array.from(exeMap.values()) : [];\n\t}\n\n\tgetCellExecutionsByHandleForNotebook(\n\t\tnotebook: URI,\n\t): Map<number, INotebookCellExecution> | undefined {\n\t\tconst exeMap = this._executions.get(notebook);\n\t\treturn exeMap ? new Map(exeMap.entries()) : undefined;\n\t}\n\n\tprivate _onCellExecutionDidChange(\n\t\tnotebookUri: URI,\n\t\tcellHandle: number,\n\t\texe: CellExecution,\n\t): void {\n\t\tthis._onDidChangeExecution.fire(\n\t\t\tnew NotebookCellExecutionEvent(notebookUri, cellHandle, exe),\n\t\t);\n\t}\n\n\tprivate _onCellExecutionDidComplete(\n\t\tnotebookUri: URI,\n\t\tcellHandle: number,\n\t\texe: CellExecution,\n\t\tlastRunSuccess?: boolean,\n\t): void {\n\t\tconst notebookExecutions = this._executions.get(notebookUri);\n\t\tif (!notebookExecutions) {\n\t\t\tthis._logService.debug(\n\t\t\t\t`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\texe.dispose();\n\t\tconst cellUri = CellUri.generate(notebookUri, cellHandle);\n\t\tthis._cellListeners.get(cellUri)?.dispose();\n\t\tthis._cellListeners.delete(cellUri);\n\t\tnotebookExecutions.delete(cellHandle);\n\t\tif (notebookExecutions.size === 0) {\n\t\t\tthis._executions.delete(notebookUri);\n\t\t\tthis._notebookListeners.get(notebookUri)?.dispose();\n\t\t\tthis._notebookListeners.delete(notebookUri);\n\t\t}\n\n\t\tif (lastRunSuccess !== undefined) {\n\t\t\tif (lastRunSuccess) {\n\t\t\t\tif (this._executions.size === 0) {\n\t\t\t\t\tthis._accessibilitySignalService.playSignal(\n\t\t\t\t\t\tAccessibilitySignal.notebookCellCompleted,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\tthis._clearLastFailedCell(notebookUri);\n\t\t\t} else {\n\t\t\t\tthis._accessibilitySignalService.playSignal(\n\t\t\t\t\tAccessibilitySignal.notebookCellFailed,\n\t\t\t\t);\n\t\t\t\tthis._setLastFailedCell(notebookUri, cellHandle);\n\t\t\t}\n\t\t}\n\n\t\tthis._onDidChangeExecution.fire(\n\t\t\tnew NotebookCellExecutionEvent(notebookUri, cellHandle),\n\t\t);\n\t}\n\n\tprivate _onExecutionDidChange(\n\t\tnotebookUri: URI,\n\t\texe: NotebookExecution,\n\t): void {\n\t\tthis._onDidChangeExecution.fire(\n\t\t\tnew NotebookExecutionEvent(notebookUri, exe),\n\t\t);\n\t}\n\n\tprivate _onExecutionDidComplete(notebookUri: URI): void {\n\t\tconst disposables = this._notebookExecutions.get(notebookUri);\n\t\tif (!Array.isArray(disposables)) {\n\t\t\tthis._logService.debug(\n\t\t\t\t`NotebookExecutionStateService#_onCellExecutionDidComplete - unknown notebook ${notebookUri.toString()}`,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tthis._notebookExecutions.delete(notebookUri);\n\t\tthis._onDidChangeExecution.fire(\n\t\t\tnew NotebookExecutionEvent(notebookUri),\n\t\t);\n\t\tdisposables.forEach((d) => d.dispose());\n\t}\n\n\tcreateCellExecution(\n\t\tnotebookUri: URI,\n\t\tcellHandle: number,\n\t): INotebookCellExecution {\n\t\tconst notebook =\n\t\t\tthis._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tlet notebookExecutionMap = this._executions.get(notebookUri);\n\t\tif (!notebookExecutionMap) {\n\t\t\tconst listeners = this._instantiationService.createInstance(\n\t\t\t\tNotebookExecutionListeners,\n\t\t\t\tnotebookUri,\n\t\t\t);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\n\t\t\tnotebookExecutionMap = new Map<number, CellExecution>();\n\t\t\tthis._executions.set(notebookUri, notebookExecutionMap);\n\t\t}\n\n\t\tlet exe = notebookExecutionMap.get(cellHandle);\n\t\tif (!exe) {\n\t\t\texe = this._createNotebookCellExecution(notebook, cellHandle);\n\t\t\tnotebookExecutionMap.set(cellHandle, exe);\n\t\t\texe.initialize();\n\t\t\tthis._onDidChangeExecution.fire(\n\t\t\t\tnew NotebookCellExecutionEvent(notebookUri, cellHandle, exe),\n\t\t\t);\n\t\t}\n\n\t\treturn exe;\n\t}\n\tcreateExecution(notebookUri: URI): INotebookExecution {\n\t\tconst notebook =\n\t\t\tthis._notebookService.getNotebookTextModel(notebookUri);\n\t\tif (!notebook) {\n\t\t\tthrow new Error(`Notebook not found: ${notebookUri.toString()}`);\n\t\t}\n\n\t\tif (!this._notebookListeners.has(notebookUri)) {\n\t\t\tconst listeners = this._instantiationService.createInstance(\n\t\t\t\tNotebookExecutionListeners,\n\t\t\t\tnotebookUri,\n\t\t\t);\n\t\t\tthis._notebookListeners.set(notebookUri, listeners);\n\t\t}\n\n\t\tlet info = this._notebookExecutions.get(notebookUri);\n\t\tif (!info) {\n\t\t\tinfo = this._createNotebookExecution(notebook);\n\t\t\tthis._notebookExecutions.set(notebookUri, info);\n\t\t\tthis._onDidChangeExecution.fire(\n\t\t\t\tnew NotebookExecutionEvent(notebookUri, info[0]),\n\t\t\t);\n\t\t}\n\n\t\treturn info[0];\n\t}\n\n\tprivate _createNotebookCellExecution(\n\t\tnotebook: NotebookTextModel,\n\t\tcellHandle: number,\n\t): CellExecution {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: CellExecution = this._instantiationService.createInstance(\n\t\t\tCellExecution,\n\t\t\tcellHandle,\n\t\t\tnotebook,\n\t\t);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() =>\n\t\t\t\tthis._onCellExecutionDidChange(notebookUri, cellHandle, exe),\n\t\t\t),\n\t\t\texe.onDidComplete((lastRunSuccess) =>\n\t\t\t\tthis._onCellExecutionDidComplete(\n\t\t\t\t\tnotebookUri,\n\t\t\t\t\tcellHandle,\n\t\t\t\t\texe,\n\t\t\t\t\tlastRunSuccess,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tthis._cellListeners.set(\n\t\t\tCellUri.generate(notebookUri, cellHandle),\n\t\t\tdisposable,\n\t\t);\n\n\t\treturn exe;\n\t}\n\n\tprivate _createNotebookExecution(\n\t\tnotebook: NotebookTextModel,\n\t): [NotebookExecution, IDisposable] {\n\t\tconst notebookUri = notebook.uri;\n\t\tconst exe: NotebookExecution =\n\t\t\tthis._instantiationService.createInstance(\n\t\t\t\tNotebookExecution,\n\t\t\t\tnotebook,\n\t\t\t);\n\t\tconst disposable = combinedDisposable(\n\t\t\texe.onDidUpdate(() => this._onExecutionDidChange(notebookUri, exe)),\n\t\t\texe.onDidComplete(() => this._onExecutionDidComplete(notebookUri)),\n\t\t);\n\t\treturn [exe, disposable];\n\t}\n\n\tprivate _setLastFailedCell(notebookURI: URI, cellHandle: number): void {\n\t\tconst prevLastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\t\tconst notebook =\n\t\t\tthis._notebookService.getNotebookTextModel(notebookURI);\n\t\tif (!notebook) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst newLastFailedCellInfo: IFailedCellInfo = {\n\t\t\tcellHandle: cellHandle,\n\t\t\tdisposable: prevLastFailedCellInfo\n\t\t\t\t? prevLastFailedCellInfo.disposable\n\t\t\t\t: this._getFailedCellListener(notebook),\n\t\t\tvisible: true,\n\t\t};\n\n\t\tthis._lastFailedCells.set(notebookURI, newLastFailedCellInfo);\n\n\t\tthis._onDidChangeLastRunFailState.fire({\n\t\t\tvisible: true,\n\t\t\tnotebook: notebookURI,\n\t\t});\n\t}\n\n\tprivate _setLastFailedCellVisibility(\n\t\tnotebookURI: URI,\n\t\tvisible: boolean,\n\t): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tthis._lastFailedCells.set(notebookURI, {\n\t\t\t\tcellHandle: lastFailedCellInfo.cellHandle,\n\t\t\t\tdisposable: lastFailedCellInfo.disposable,\n\t\t\t\tvisible: visible,\n\t\t\t});\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({\n\t\t\tvisible: visible,\n\t\t\tnotebook: notebookURI,\n\t\t});\n\t}\n\n\tprivate _clearLastFailedCell(notebookURI: URI): void {\n\t\tconst lastFailedCellInfo = this._lastFailedCells.get(notebookURI);\n\n\t\tif (lastFailedCellInfo) {\n\t\t\tlastFailedCellInfo.disposable?.dispose();\n\t\t\tthis._lastFailedCells.delete(notebookURI);\n\t\t}\n\n\t\tthis._onDidChangeLastRunFailState.fire({\n\t\t\tvisible: false,\n\t\t\tnotebook: notebookURI,\n\t\t});\n\t}\n\n\tprivate _getFailedCellListener(notebook: NotebookTextModel): IDisposable {\n\t\treturn notebook.onWillAddRemoveCells(\n\t\t\t(e: NotebookTextModelWillAddRemoveEvent) => {\n\t\t\t\tconst lastFailedCell = this._lastFailedCells.get(\n\t\t\t\t\tnotebook.uri,\n\t\t\t\t)?.cellHandle;\n\t\t\t\tif (lastFailedCell !== undefined) {\n\t\t\t\t\tconst lastFailedCellPos = notebook.cells.findIndex(\n\t\t\t\t\t\t(c) => c.handle === lastFailedCell,\n\t\t\t\t\t);\n\t\t\t\t\te.rawEvent.changes.forEach(\n\t\t\t\t\t\t([start, deleteCount, addedCells]) => {\n\t\t\t\t\t\t\tif (deleteCount) {\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tlastFailedCellPos >= start &&\n\t\t\t\t\t\t\t\t\tlastFailedCellPos < start + deleteCount\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tthis._setLastFailedCellVisibility(\n\t\t\t\t\t\t\t\t\t\tnotebook.uri,\n\t\t\t\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\taddedCells.some(\n\t\t\t\t\t\t\t\t\t(cell) => cell.handle === lastFailedCell,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tthis._setLastFailedCellVisibility(\n\t\t\t\t\t\t\t\t\tnotebook.uri,\n\t\t\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._executions.forEach((executionMap) => {\n\t\t\texecutionMap.forEach((execution) => execution.dispose());\n\t\t\texecutionMap.clear();\n\t\t});\n\t\tthis._executions.clear();\n\t\tthis._notebookExecutions.forEach((disposables) => {\n\t\t\tdisposables.forEach((d) => d.dispose());\n\t\t});\n\t\tthis._notebookExecutions.clear();\n\n\t\tthis._cellListeners.forEach((disposable) => disposable.dispose());\n\t\tthis._notebookListeners.forEach((disposable) => disposable.dispose());\n\t\tthis._lastFailedCells.forEach((elem) => elem.disposable.dispose());\n\t}\n}\n\nclass NotebookCellExecutionEvent implements ICellExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.cell;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly cellHandle: number,\n\t\treadonly changed?: CellExecution,\n\t) {}\n\n\taffectsCell(cell: URI): boolean {\n\t\tconst parsedUri = CellUri.parse(cell);\n\t\treturn (\n\t\t\t!!parsedUri &&\n\t\t\tisEqual(this.notebook, parsedUri.notebook) &&\n\t\t\tthis.cellHandle === parsedUri.handle\n\t\t);\n\t}\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionEvent implements IExecutionStateChangedEvent {\n\treadonly type = NotebookExecutionType.notebook;\n\tconstructor(\n\t\treadonly notebook: URI,\n\t\treadonly changed?: NotebookExecution,\n\t) {}\n\n\taffectsNotebook(notebook: URI): boolean {\n\t\treturn isEqual(this.notebook, notebook);\n\t}\n}\n\nclass NotebookExecutionListeners extends Disposable {\n\tprivate readonly _notebookModel: NotebookTextModel;\n\n\tconstructor(\n\t\tnotebook: URI,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@INotebookExecutionService private readonly _notebookExecutionService: INotebookExecutionService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor ${notebook.toString()}`);\n\n\t\tconst notebookModel = this._notebookService.getNotebookTextModel(notebook);\n\t\tif (!notebookModel) {\n\t\t\tthrow new Error('Notebook not found: ' + notebook);\n\t\t}\n\n\t\tthis._notebookModel = notebookModel;\n\t\tthis._register(this._notebookModel.onWillAddRemoveCells(e => this.onWillAddRemoveCells(e)));\n\t\tthis._register(this._notebookModel.onWillDispose(() => this.onWillDisposeDocument()));\n\t}\n\n\tprivate cancelAll(): void {\n\t\tthis._logService.debug(`NotebookExecutionListeners#cancelAll`);\n\t\tconst exes =\n\t\t\tthis._notebookExecutionStateService.getCellExecutionsForNotebook(\n\t\t\t\tthis._notebookModel.uri,\n\t\t\t);\n\t\tthis._notebookExecutionService.cancelNotebookCellHandles(\n\t\t\tthis._notebookModel,\n\t\t\texes.map((exe) => exe.cellHandle),\n\t\t);\n\t}\n\n\tprivate onWillDisposeDocument(): void {\n\t\tthis._logService.debug(`NotebookExecution#onWillDisposeDocument`);\n\t\tthis.cancelAll();\n\t}\n\n\tprivate onWillAddRemoveCells(e: NotebookTextModelWillAddRemoveEvent): void {\n\t\tconst notebookExes =\n\t\t\tthis._notebookExecutionStateService.getCellExecutionsByHandleForNotebook(\n\t\t\t\tthis._notebookModel.uri,\n\t\t\t);\n\n\t\tconst executingDeletedHandles = new Set<number>();\n\t\tconst pendingDeletedHandles = new Set<number>();\n\t\tif (notebookExes) {\n\t\t\te.rawEvent.changes.forEach(([start, deleteCount]) => {\n\t\t\t\tif (deleteCount) {\n\t\t\t\t\tconst deletedHandles = this._notebookModel.cells\n\t\t\t\t\t\t.slice(start, start + deleteCount)\n\t\t\t\t\t\t.map((c) => c.handle);\n\t\t\t\t\tdeletedHandles.forEach((h) => {\n\t\t\t\t\t\tconst exe = notebookExes.get(h);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\texe?.state === NotebookCellExecutionState.Executing\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\texecutingDeletedHandles.add(h);\n\t\t\t\t\t\t} else if (exe) {\n\t\t\t\t\t\t\tpendingDeletedHandles.add(h);\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tif (executingDeletedHandles.size || pendingDeletedHandles.size) {\n\t\t\tconst kernel =\n\t\t\t\tthis._notebookKernelService.getSelectedOrSuggestedKernel(\n\t\t\t\t\tthis._notebookModel,\n\t\t\t\t);\n\t\t\tif (kernel) {\n\t\t\t\tconst implementsInterrupt = kernel.implementsInterrupt;\n\t\t\t\tconst handlesToCancel = implementsInterrupt\n\t\t\t\t\t? [...executingDeletedHandles]\n\t\t\t\t\t: [...executingDeletedHandles, ...pendingDeletedHandles];\n\t\t\t\tthis._logService.debug(\n\t\t\t\t\t`NotebookExecution#onWillAddRemoveCells, ${JSON.stringify([...handlesToCancel])}`,\n\t\t\t\t);\n\t\t\t\tif (handlesToCancel.length) {\n\t\t\t\t\tkernel.cancelNotebookCellExecution(\n\t\t\t\t\t\tthis._notebookModel.uri,\n\t\t\t\t\t\thandlesToCancel,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n}\n\nfunction updateToEdit(\n\tupdate: ICellExecuteUpdate,\n\tcellHandle: number,\n): ICellEditOperation {\n\tif (update.editType === CellExecutionUpdateType.Output) {\n\t\treturn {\n\t\t\teditType: CellEditType.Output,\n\t\t\thandle: update.cellHandle,\n\t\t\tappend: update.append,\n\t\t\toutputs: update.outputs,\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.OutputItems) {\n\t\treturn {\n\t\t\teditType: CellEditType.OutputItems,\n\t\t\titems: update.items,\n\t\t\tappend: update.append,\n\t\t\toutputId: update.outputId,\n\t\t};\n\t} else if (update.editType === CellExecutionUpdateType.ExecutionState) {\n\t\tconst newInternalMetadata: Partial<NotebookCellInternalMetadata> = {};\n\t\tif (typeof update.executionOrder !== \"undefined\") {\n\t\t\tnewInternalMetadata.executionOrder = update.executionOrder;\n\t\t}\n\t\tif (typeof update.runStartTime !== \"undefined\") {\n\t\t\tnewInternalMetadata.runStartTime = update.runStartTime;\n\t\t}\n\t\treturn {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: cellHandle,\n\t\t\tinternalMetadata: newInternalMetadata,\n\t\t};\n\t}\n\n\tthrow new Error(\"Unknown cell update type\");\n}\n\nclass CellExecution extends Disposable implements INotebookCellExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(\n\t\tnew Emitter<boolean | undefined>(),\n\t);\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookCellExecutionState =\n\t\tNotebookCellExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tprivate _didPause = false;\n\tget didPause() {\n\t\treturn this._didPause;\n\t}\n\n\tprivate _isPaused = false;\n\tget isPaused() {\n\t\treturn this._isPaused;\n\t}\n\n\tconstructor(\n\t\treadonly cellHandle: number,\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`CellExecution#ctor ${this.getCellLog()}`);\n\t}\n\n\tinitialize() {\n\t\tconst startExecuteEdit: ICellEditOperation = {\n\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\thandle: this.cellHandle,\n\t\t\tinternalMetadata: {\n\t\t\t\texecutionId: generateUuid(),\n\t\t\t\trunStartTime: null,\n\t\t\t\trunEndTime: null,\n\t\t\t\tlastRunSuccess: null,\n\t\t\t\texecutionOrder: null,\n\t\t\t\trenderDuration: null,\n\t\t\t},\n\t\t};\n\t\tthis._applyExecutionEdits([startExecuteEdit]);\n\t}\n\n\tprivate getCellLog(): string {\n\t\treturn `${this._notebookModel.uri.toString()}, ${this.cellHandle}`;\n\t}\n\n\tprivate logUpdates(updates: ICellExecuteUpdate[]): void {\n\t\tconst updateTypes = updates\n\t\t\t.map((u) => CellExecutionUpdateType[u.editType])\n\t\t\t.join(\", \");\n\t\tthis._logService.debug(\n\t\t\t`CellExecution#updateExecution ${this.getCellLog()}, [${updateTypes}]`,\n\t\t);\n\t}\n\n\tconfirm() {\n\t\tthis._logService.debug(`CellExecution#confirm ${this.getCellLog()}`);\n\t\tthis._state = NotebookCellExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tupdate(updates: ICellExecuteUpdate[]): void {\n\t\tthis.logUpdates(updates);\n\t\tif (\n\t\t\tupdates.some(\n\t\t\t\t(u) => u.editType === CellExecutionUpdateType.ExecutionState,\n\t\t\t)\n\t\t) {\n\t\t\tthis._state = NotebookCellExecutionState.Executing;\n\t\t}\n\n\t\tif (\n\t\t\t!this._didPause &&\n\t\t\tupdates.some(\n\t\t\t\t(u) =>\n\t\t\t\t\tu.editType === CellExecutionUpdateType.ExecutionState &&\n\t\t\t\t\tu.didPause,\n\t\t\t)\n\t\t) {\n\t\t\tthis._didPause = true;\n\t\t}\n\n\t\tconst lastIsPausedUpdate = [...updates]\n\t\t\t.reverse()\n\t\t\t.find(\n\t\t\t\t(u) =>\n\t\t\t\t\tu.editType === CellExecutionUpdateType.ExecutionState &&\n\t\t\t\t\ttypeof u.isPaused === \"boolean\",\n\t\t\t);\n\t\tif (lastIsPausedUpdate) {\n\t\t\tthis._isPaused = (lastIsPausedUpdate as ICellExecutionStateUpdate)\n\t\t\t\t.isPaused!;\n\t\t}\n\n\t\tconst cellModel = this._notebookModel.cells.find(\n\t\t\t(c) => c.handle === this.cellHandle,\n\t\t);\n\t\tif (cellModel) {\n\t\t\tconst edits = updates.map((update) =>\n\t\t\t\tupdateToEdit(update, this.cellHandle),\n\t\t\t);\n\t\t\tthis._applyExecutionEdits(edits);\n\t\t} else {\n\t\t\tthis._logService.debug(\n\t\t\t\t`CellExecution#update, updating cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`,\n\t\t\t);\n\t\t}\n\n\t\tif (\n\t\t\tupdates.some(\n\t\t\t\t(u) => u.editType === CellExecutionUpdateType.ExecutionState,\n\t\t\t)\n\t\t) {\n\t\t\tthis._onDidUpdate.fire();\n\t\t}\n\t}\n\n\tcomplete(completionData: ICellExecutionComplete): void {\n\t\tconst cellModel = this._notebookModel.cells.find(\n\t\t\t(c) => c.handle === this.cellHandle,\n\t\t);\n\t\tif (cellModel) {\n\t\t\tconst edit: ICellEditOperation = {\n\t\t\t\teditType: CellEditType.PartialInternalMetadata,\n\t\t\t\thandle: this.cellHandle,\n\t\t\t\tinternalMetadata: {\n\t\t\t\t\tlastRunSuccess: completionData.lastRunSuccess,\n\t\t\t\t\trunStartTime: this._didPause\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: cellModel.internalMetadata.runStartTime,\n\t\t\t\t\trunEndTime: this._didPause\n\t\t\t\t\t\t? null\n\t\t\t\t\t\t: completionData.runEndTime,\n\t\t\t\t\terror: completionData.error,\n\t\t\t\t},\n\t\t\t};\n\t\t\tthis._applyExecutionEdits([edit]);\n\t\t} else {\n\t\t\tthis._logService.debug(\n\t\t\t\t`CellExecution#complete, completing cell not in notebook: ${this._notebookModel.uri.toString()}, ${this.cellHandle}`,\n\t\t\t);\n\t\t}\n\n\t\tthis._onDidComplete.fire(completionData.lastRunSuccess);\n\t}\n\n\tprivate _applyExecutionEdits(edits: ICellEditOperation[]): void {\n\t\tthis._notebookModel.applyEdits(\n\t\t\tedits,\n\t\t\ttrue,\n\t\t\tundefined,\n\t\t\t() => undefined,\n\t\t\tundefined,\n\t\t\tfalse,\n\t\t);\n\t}\n}\n\nclass NotebookExecution extends Disposable implements INotebookExecution {\n\tprivate readonly _onDidUpdate = this._register(new Emitter<void>());\n\treadonly onDidUpdate = this._onDidUpdate.event;\n\n\tprivate readonly _onDidComplete = this._register(new Emitter<void>());\n\treadonly onDidComplete = this._onDidComplete.event;\n\n\tprivate _state: NotebookExecutionState = NotebookExecutionState.Unconfirmed;\n\tget state() {\n\t\treturn this._state;\n\t}\n\n\tget notebook(): URI {\n\t\treturn this._notebookModel.uri;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookModel: NotebookTextModel,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._logService.debug(`NotebookExecution#ctor`);\n\t}\n\tprivate debug(message: string) {\n\t\tthis._logService.debug(\n\t\t\t`${message} ${this._notebookModel.uri.toString()}`,\n\t\t);\n\t}\n\n\tconfirm() {\n\t\tthis.debug(`Execution#confirm`);\n\t\tthis._state = NotebookExecutionState.Pending;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tbegin(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Executing;\n\t\tthis._onDidUpdate.fire();\n\t}\n\n\tcomplete(): void {\n\t\tthis.debug(`Execution#begin`);\n\t\tthis._state = NotebookExecutionState.Unconfirmed;\n\t\tthis._onDidComplete.fire();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
