var ue=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var P=(S,p,t,o)=>{for(var e=o>1?void 0:o?Ce(p,t):p,r=S.length-1,l;r>=0;r--)(l=S[r])&&(e=(o?l(p,t,e):l(e))||e);return o&&e&&ue(p,t,e),e},d=(S,p)=>(t,o)=>p(t,o,S);import*as n from"../../../../../../base/browser/dom.js";import{FastDomNode as C}from"../../../../../../base/browser/fastDomNode.js";import{PixelRatio as be}from"../../../../../../base/browser/pixelRatio.js";import{Disposable as fe,DisposableStore as O}from"../../../../../../base/common/lifecycle.js";import{CodeEditorWidget as Ie}from"../../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import{BareFontInfo as he}from"../../../../../../editor/common/config/fontInfo.js";import{EditorContextKeys as Ee}from"../../../../../../editor/common/editorContextKeys.js";import{PLAINTEXT_LANGUAGE_ID as we}from"../../../../../../editor/common/languages/modesRegistry.js";import{localize as ve}from"../../../../../../nls.js";import{IMenuService as z}from"../../../../../../platform/actions/common/actions.js";import{IConfigurationService as B}from"../../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as j}from"../../../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as G}from"../../../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as J}from"../../../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as $}from"../../../../../../platform/instantiation/common/serviceCollection.js";import{IKeybindingService as U}from"../../../../../../platform/keybinding/common/keybinding.js";import{INotificationService as X}from"../../../../../../platform/notification/common/notification.js";import{CellKind as Se}from"../../../common/notebookCommon.js";import{INotebookExecutionStateService as ge}from"../../../common/notebookExecutionStateService.js";import{CellPartsCollection as q}from"../cellPart.js";import{CellComments as Q}from"../cellParts/cellComments.js";import{CellContextKeyPart as Y}from"../cellParts/cellContextKeys.js";import{CellDecorations as Z}from"../cellParts/cellDecorations.js";import{CellDragAndDropPart as ee}from"../cellParts/cellDnd.js";import{CodeCellDragImageRenderer as ke}from"../cellParts/cellDragRenderer.js";import{CellEditorOptions as Te}from"../cellParts/cellEditorOptions.js";import{CellExecutionPart as Me}from"../cellParts/cellExecution.js";import{CellFocusPart as oe}from"../cellParts/cellFocus.js";import{CellFocusIndicator as te}from"../cellParts/cellFocusIndicator.js";import{CellProgressBar as ye}from"../cellParts/cellProgressBar.js";import{CellEditorStatusBar as ne}from"../cellParts/cellStatusPart.js";import{BetweenCellToolbar as ie,CellTitleToolbarPart as re}from"../cellParts/cellToolbars.js";import{CellChatPart as de}from"../cellParts/chat/cellChatPart.js";import{CodeCell as xe}from"../cellParts/codeCell.js";import{RunToolbar as De}from"../cellParts/codeCellRunToolbar.js";import{CollapsedCellInput as le}from"../cellParts/collapsedCellInput.js";import{CollapsedCellOutput as Pe}from"../cellParts/collapsedCellOutput.js";import{FoldedCellHint as Oe}from"../cellParts/foldedCellHint.js";import{MarkupCell as Le}from"../cellParts/markupCell.js";const i=n.$;let L=class extends fe{constructor(t,o){super();this.configurationService=o;const e=this.configurationService.getValue("editor");this.lineHeight=he.createFromRawSettings(e,be.getInstance(t).value).lineHeight}lineHeight;getHeight(t){return t.getHeight(this.lineHeight)}getDynamicHeight(t){return t.getDynamicHeight()}getTemplateId(t){return t.cellKind===Se.Markup?w.TEMPLATE_ID:v.TEMPLATE_ID}};L=P([d(1,B)],L);class ce{constructor(p,t,o,e,r,l,b,f,c,h){this.instantiationService=p;this.notebookEditor=t;this.contextMenuService=o;this.menuService=e;this.keybindingService=l;this.notificationService=b;this.contextKeyServiceProvider=f;this.dndController=h;this.editorOptions=new Te(this.notebookEditor.getBaseCellEditorOptions(c),this.notebookEditor.notebookOptions,r)}editorOptions;dispose(){this.editorOptions.dispose(),this.dndController=void 0}}let w=class extends ce{constructor(t,o,e,r,l,b,f,c,h,m,E){super(b,t,f,c,l,h,m,r,"markdown",o);this.renderedEditors=e;this._notebookExecutionStateService=E}static TEMPLATE_ID="markdown_cell";_notebookExecutionStateService;get templateId(){return w.TEMPLATE_ID}renderTemplate(t){t.classList.add("markdown-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),b=n.append(o,i(".cell-title-toolbar")),f=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(c.domNode,n.$(".notebook-folding-indicator")),m=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),E=n.append(o,i(".cell.code")),u=n.append(E,i(".cell-editor-part")),k=n.append(u,i(".cell-chat-part")),I=n.append(E,i(".input-collapse-container"));I.style.display="none";const N=n.append(u,i(".cell-editor-container"));u.style.display="none";const V=n.append(o,i(".cell-comment-container")),T=n.append(o,i(".cell.markdown")),K=n.append(o,i(".cell-bottom-toolbar-container")),a=e.add(this.instantiationService.createChild(new $([j,r]))),M={toggle:(A,H)=>o.classList.toggle(A,H)},g=e.add(a.createInstance(re,b,M,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),R=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),y=new q(n.getWindow(t),[e.add(a.createInstance(de,this.notebookEditor,k)),e.add(a.createInstance(ne,this.notebookEditor,o,u,void 0)),e.add(new te(this.notebookEditor,g,f,c,m,R)),e.add(new Oe(this.notebookEditor,n.append(o,i(".notebook-folded-hint")),this._notebookExecutionStateService)),e.add(new Z(t,l)),e.add(a.createInstance(Q,this.notebookEditor,V)),e.add(new le(this.notebookEditor,I)),e.add(new oe(o,void 0,this.notebookEditor)),e.add(new ee(o)),e.add(a.createInstance(Y,this.notebookEditor))],[g,e.add(a.createInstance(ie,this.notebookEditor,b,K))]);return e.add(y),{rootContainer:t,cellInputCollapsedContainer:I,instantiationService:a,container:o,cellContainer:T,editorPart:u,editorContainer:N,foldingIndicator:h,templateDisposables:e,elementDisposables:new O,cellParts:y,toJSON:()=>({})}}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,e.currentEditor=void 0,e.editorPart.style.display="none",e.cellContainer.innerText="",r!==void 0&&e.elementDisposables.add(e.instantiationService.createInstance(Le,this.notebookEditor,t,e,this.renderedEditors))}disposeTemplate(t){t.elementDisposables.dispose(),t.templateDisposables.dispose()}disposeElement(t,o,e){e.elementDisposables.clear()}};w=P([d(4,B),d(5,J),d(6,G),d(7,z),d(8,U),d(9,X),d(10,ge)],w);let v=class extends ce{constructor(t,o,e,r,l,b,f,c,h,m,E){super(h,t,f,c,b,m,E,l,we,r);this.renderedEditors=o;this.editorPool=e}static TEMPLATE_ID="code_cell";get templateId(){return v.TEMPLATE_ID}renderTemplate(t){t.classList.add("code-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),b=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),f=n.append(o,i(".cell-title-toolbar")),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(o,i(".cell-chat-part")),m=n.append(o,i(".cell.code")),E=n.append(m,i(".run-button-container")),u=n.append(m,i(".input-collapse-container"));u.style.display="none";const k=n.append(c.domNode,i("div.execution-count-label"));k.title=ve("cellExecutionOrderCountLabel","Execution Order");const I=n.append(m,i(".cell-editor-part")),N=n.append(I,i(".cell-editor-container")),V=n.append(o,i(".cell-comment-container")),T=e.add(this.contextKeyServiceProvider(I)),K=e.add(this.instantiationService.createChild(new $([j,T])));Ee.inCompositeEditor.bindTo(T).set(!0);const a=K.createInstance(Ie,N,{...this.editorOptions.getDefaultValue(),dimension:{width:0,height:0},scrollbar:{vertical:"hidden",horizontal:"auto",handleMouseWheel:!1,useShadows:!1}},{contributions:this.notebookEditor.creationOptions.cellEditorContributions});e.add(a);const M=new C(n.append(o,i(".output"))),g=n.append(M.domNode,i(".output-collapse-container")),R=new C(n.append(o,i(".output-show-more-container"))),y=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),x=n.append(o,i(".cell-editor-focus-sink"));x.setAttribute("tabindex","0");const A=n.append(o,i(".cell-bottom-toolbar-container")),H=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),s=e.add(this.instantiationService.createChild(new $([j,r]))),ae={toggle:(pe,me)=>o.classList.toggle(pe,me)},F=e.add(s.createInstance(re,f,ae,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),_=e.add(new te(this.notebookEditor,F,b,c,y,H)),W=new q(n.getWindow(t),[_,e.add(s.createInstance(de,this.notebookEditor,h)),e.add(s.createInstance(ne,this.notebookEditor,o,I,a)),e.add(s.createInstance(ye,I,u)),e.add(s.createInstance(De,this.notebookEditor,r,o,E)),e.add(new Z(t,l)),e.add(s.createInstance(Q,this.notebookEditor,V)),e.add(s.createInstance(Me,this.notebookEditor,k)),e.add(s.createInstance(Pe,this.notebookEditor,g)),e.add(new le(this.notebookEditor,u)),e.add(new oe(o,x,this.notebookEditor)),e.add(new ee(o)),e.add(s.createInstance(Y,this.notebookEditor))],[F,e.add(s.createInstance(ie,this.notebookEditor,f,A))]);e.add(W);const D={rootContainer:t,editorPart:I,cellInputCollapsedContainer:u,cellOutputCollapsedContainer:g,instantiationService:s,container:o,cellContainer:m,focusSinkElement:x,outputContainer:M,outputShowMoreContainer:R,editor:a,templateDisposables:e,elementDisposables:new O,cellParts:W,toJSON:()=>({})},se=[c.domNode,_.codeFocusIndicator.domNode,_.outputFocusIndicator.domNode];return this.dndController?.registerDragHandle(D,t,se,()=>new ke().getDragImage(D,D.editor,"code")),D}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,r!==void 0&&(e.outputContainer.domNode.innerText="",e.outputContainer.domNode.appendChild(e.cellOutputCollapsedContainer),e.elementDisposables.add(e.instantiationService.createInstance(xe,this.notebookEditor,t,e,this.editorPool)),this.renderedEditors.set(t,e.editor))}disposeTemplate(t){t.templateDisposables.clear()}disposeElement(t,o,e,r){e.elementDisposables.clear(),this.renderedEditors.delete(t)}};v=P([d(5,B),d(6,G),d(7,z),d(8,J),d(9,U),d(10,X)],v);export{v as CodeCellRenderer,w as MarkupCellRenderer,L as NotebookCellListDelegate};
