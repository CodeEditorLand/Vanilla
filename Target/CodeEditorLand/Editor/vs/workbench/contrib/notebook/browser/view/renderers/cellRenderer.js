var ue=Object.defineProperty;var Ce=Object.getOwnPropertyDescriptor;var P=(w,p,t,o)=>{for(var e=o>1?void 0:o?Ce(p,t):p,r=w.length-1,l;r>=0;r--)(l=w[r])&&(e=(o?l(p,t,e):l(e))||e);return o&&e&&ue(p,t,e),e},d=(w,p)=>(t,o)=>p(t,o,w);import*as n from"../../../../../../../vs/base/browser/dom.js";import{FastDomNode as C}from"../../../../../../../vs/base/browser/fastDomNode.js";import{PixelRatio as fe}from"../../../../../../../vs/base/browser/pixelRatio.js";import"../../../../../../../vs/base/browser/ui/list/list.js";import{Disposable as Ie,DisposableStore as O}from"../../../../../../../vs/base/common/lifecycle.js";import"../../../../../../../vs/editor/browser/editorBrowser.js";import{CodeEditorWidget as be}from"../../../../../../../vs/editor/browser/widget/codeEditor/codeEditorWidget.js";import"../../../../../../../vs/editor/common/config/editorOptions.js";import{BareFontInfo as he}from"../../../../../../../vs/editor/common/config/fontInfo.js";import{EditorContextKeys as Ee}from"../../../../../../../vs/editor/common/editorContextKeys.js";import{PLAINTEXT_LANGUAGE_ID as ve}from"../../../../../../../vs/editor/common/languages/modesRegistry.js";import{localize as Se}from"../../../../../../../vs/nls.js";import{IMenuService as G}from"../../../../../../../vs/platform/actions/common/actions.js";import{IConfigurationService as $}from"../../../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as B}from"../../../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as J}from"../../../../../../../vs/platform/contextview/browser/contextView.js";import{IInstantiationService as U}from"../../../../../../../vs/platform/instantiation/common/instantiation.js";import{ServiceCollection as F}from"../../../../../../../vs/platform/instantiation/common/serviceCollection.js";import{IKeybindingService as X}from"../../../../../../../vs/platform/keybinding/common/keybinding.js";import{INotificationService as j}from"../../../../../../../vs/platform/notification/common/notification.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/notebookBrowser.js";import{CellPartsCollection as q}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellPart.js";import{CellComments as Q}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellComments.js";import{CellContextKeyPart as Y}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellContextKeys.js";import{CellDecorations as Z}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellDecorations.js";import{CellDragAndDropPart as ee}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellDnd.js";import{CodeCellDragImageRenderer as we}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellDragRenderer.js";import{CellEditorOptions as ge}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellEditorOptions.js";import{CellExecutionPart as ke}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellExecution.js";import{CellFocusPart as oe}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellFocus.js";import{CellFocusIndicator as te}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellFocusIndicator.js";import{CellProgressBar as Te}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellProgressBar.js";import{CellEditorStatusBar as ne}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellStatusPart.js";import{BetweenCellToolbar as ie,CellTitleToolbarPart as re}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/cellToolbars.js";import{CellChatPart as de}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/chat/cellChatPart.js";import{CodeCell as Me}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/codeCell.js";import{RunToolbar as xe}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/codeCellRunToolbar.js";import{CollapsedCellInput as le}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/collapsedCellInput.js";import{CollapsedCellOutput as ye}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/collapsedCellOutput.js";import{FoldedCellHint as De}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/foldedCellHint.js";import{MarkupCell as Pe}from"../../../../../../../vs/workbench/contrib/notebook/browser/view/cellParts/markupCell.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/view/notebookCellEditorPool.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/view/notebookRenderingCommon.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/viewModel/codeCellViewModel.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/viewModel/markupCellViewModel.js";import"../../../../../../../vs/workbench/contrib/notebook/browser/viewModel/notebookViewModelImpl.js";import{CellKind as Oe}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookCommon.js";import{INotebookExecutionStateService as Le}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookExecutionStateService.js";const i=n.$;let L=class extends Ie{constructor(t,o){super();this.configurationService=o;const e=this.configurationService.getValue("editor");this.lineHeight=he.createFromRawSettings(e,fe.getInstance(t).value).lineHeight}lineHeight;getHeight(t){return t.getHeight(this.lineHeight)}getDynamicHeight(t){return t.getDynamicHeight()}getTemplateId(t){return t.cellKind===Oe.Markup?v.TEMPLATE_ID:S.TEMPLATE_ID}};L=P([d(1,$)],L);class ce{constructor(p,t,o,e,r,l,f,I,c,h){this.instantiationService=p;this.notebookEditor=t;this.contextMenuService=o;this.menuService=e;this.keybindingService=l;this.notificationService=f;this.contextKeyServiceProvider=I;this.dndController=h;this.editorOptions=new ge(this.notebookEditor.getBaseCellEditorOptions(c),this.notebookEditor.notebookOptions,r)}editorOptions;dispose(){this.editorOptions.dispose(),this.dndController=void 0}}let v=class extends ce{constructor(t,o,e,r,l,f,I,c,h,m,E){super(f,t,I,c,l,h,m,r,"markdown",o);this.renderedEditors=e;this._notebookExecutionStateService=E}static TEMPLATE_ID="markdown_cell";_notebookExecutionStateService;get templateId(){return v.TEMPLATE_ID}renderTemplate(t){t.classList.add("markdown-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),f=n.append(o,i(".cell-title-toolbar")),I=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(c.domNode,n.$(".notebook-folding-indicator")),m=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),E=n.append(o,i(".cell.code")),u=n.append(E,i(".cell-editor-part")),k=n.append(u,i(".cell-chat-part")),b=n.append(E,i(".input-collapse-container"));b.style.display="none";const N=n.append(u,i(".cell-editor-container"));u.style.display="none";const K=n.append(o,i(".cell-comment-container")),T=n.append(o,i(".cell.markdown")),V=n.append(o,i(".cell-bottom-toolbar-container")),a=e.add(this.instantiationService.createChild(new F([B,r]))),M={toggle:(A,H)=>o.classList.toggle(A,H)},g=e.add(a.createInstance(re,f,M,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),R=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),x=new q(n.getWindow(t),[e.add(a.createInstance(de,this.notebookEditor,k)),e.add(a.createInstance(ne,this.notebookEditor,o,u,void 0)),e.add(new te(this.notebookEditor,g,I,c,m,R)),e.add(new De(this.notebookEditor,n.append(o,i(".notebook-folded-hint")),this._notebookExecutionStateService)),e.add(new Z(t,l)),e.add(a.createInstance(Q,this.notebookEditor,K)),e.add(new le(this.notebookEditor,b)),e.add(new oe(o,void 0,this.notebookEditor)),e.add(new ee(o)),e.add(a.createInstance(Y,this.notebookEditor))],[g,e.add(a.createInstance(ie,this.notebookEditor,f,V))]);return e.add(x),{rootContainer:t,cellInputCollapsedContainer:b,instantiationService:a,container:o,cellContainer:T,editorPart:u,editorContainer:N,foldingIndicator:h,templateDisposables:e,elementDisposables:new O,cellParts:x,toJSON:()=>({})}}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,e.currentEditor=void 0,e.editorPart.style.display="none",e.cellContainer.innerText="",r!==void 0&&e.elementDisposables.add(e.instantiationService.createInstance(Pe,this.notebookEditor,t,e,this.renderedEditors))}disposeTemplate(t){t.elementDisposables.dispose(),t.templateDisposables.dispose()}disposeElement(t,o,e){e.elementDisposables.clear()}};v=P([d(4,$),d(5,U),d(6,J),d(7,G),d(8,X),d(9,j),d(10,Le)],v);let S=class extends ce{constructor(t,o,e,r,l,f,I,c,h,m,E){super(h,t,I,c,f,m,E,l,ve,r);this.renderedEditors=o;this.editorPool=e}static TEMPLATE_ID="code_cell";get templateId(){return S.TEMPLATE_ID}renderTemplate(t){t.classList.add("code-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),f=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),I=n.append(o,i(".cell-title-toolbar")),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(o,i(".cell-chat-part")),m=n.append(o,i(".cell.code")),E=n.append(m,i(".run-button-container")),u=n.append(m,i(".input-collapse-container"));u.style.display="none";const k=n.append(c.domNode,i("div.execution-count-label"));k.title=Se("cellExecutionOrderCountLabel","Execution Order");const b=n.append(m,i(".cell-editor-part")),N=n.append(b,i(".cell-editor-container")),K=n.append(o,i(".cell-comment-container")),T=e.add(this.contextKeyServiceProvider(b)),V=e.add(this.instantiationService.createChild(new F([B,T])));Ee.inCompositeEditor.bindTo(T).set(!0);const a=V.createInstance(be,N,{...this.editorOptions.getDefaultValue(),dimension:{width:0,height:0},scrollbar:{vertical:"hidden",horizontal:"auto",handleMouseWheel:!1,useShadows:!1}},{contributions:this.notebookEditor.creationOptions.cellEditorContributions});e.add(a);const M=new C(n.append(o,i(".output"))),g=n.append(M.domNode,i(".output-collapse-container")),R=new C(n.append(o,i(".output-show-more-container"))),x=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),y=n.append(o,i(".cell-editor-focus-sink"));y.setAttribute("tabindex","0");const A=n.append(o,i(".cell-bottom-toolbar-container")),H=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),s=e.add(this.instantiationService.createChild(new F([B,r]))),ae={toggle:(pe,me)=>o.classList.toggle(pe,me)},W=e.add(s.createInstance(re,I,ae,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),_=e.add(new te(this.notebookEditor,W,f,c,x,H)),z=new q(n.getWindow(t),[_,e.add(s.createInstance(de,this.notebookEditor,h)),e.add(s.createInstance(ne,this.notebookEditor,o,b,a)),e.add(s.createInstance(Te,b,u)),e.add(s.createInstance(xe,this.notebookEditor,r,o,E)),e.add(new Z(t,l)),e.add(s.createInstance(Q,this.notebookEditor,K)),e.add(s.createInstance(ke,this.notebookEditor,k)),e.add(s.createInstance(ye,this.notebookEditor,g)),e.add(new le(this.notebookEditor,u)),e.add(new oe(o,y,this.notebookEditor)),e.add(new ee(o)),e.add(s.createInstance(Y,this.notebookEditor))],[W,e.add(s.createInstance(ie,this.notebookEditor,I,A))]);e.add(z);const D={rootContainer:t,editorPart:b,cellInputCollapsedContainer:u,cellOutputCollapsedContainer:g,instantiationService:s,container:o,cellContainer:m,focusSinkElement:y,outputContainer:M,outputShowMoreContainer:R,editor:a,templateDisposables:e,elementDisposables:new O,cellParts:z,toJSON:()=>({})},se=[c.domNode,_.codeFocusIndicator.domNode,_.outputFocusIndicator.domNode];return this.dndController?.registerDragHandle(D,t,se,()=>new we().getDragImage(D,D.editor,"code")),D}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,r!==void 0&&(e.outputContainer.domNode.innerText="",e.outputContainer.domNode.appendChild(e.cellOutputCollapsedContainer),e.elementDisposables.add(e.instantiationService.createInstance(Me,this.notebookEditor,t,e,this.editorPool)),this.renderedEditors.set(t,e.editor))}disposeTemplate(t){t.templateDisposables.clear()}disposeElement(t,o,e,r){e.elementDisposables.clear(),this.renderedEditors.delete(t)}};S=P([d(5,$),d(6,J),d(7,G),d(8,U),d(9,X),d(10,j)],S);export{S as CodeCellRenderer,v as MarkupCellRenderer,L as NotebookCellListDelegate};
