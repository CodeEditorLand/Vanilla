var Ie=Object.defineProperty;var be=Object.getOwnPropertyDescriptor;var D=(w,p,t,o)=>{for(var e=o>1?void 0:o?be(p,t):p,r=w.length-1,l;r>=0;r--)(l=w[r])&&(e=(o?l(p,t,e):l(e))||e);return o&&e&&Ie(p,t,e),e},d=(w,p)=>(t,o)=>p(t,o,w);import{PixelRatio as he}from"../../../../../../base/browser/pixelRatio.js";import*as n from"../../../../../../base/browser/dom.js";import{FastDomNode as C}from"../../../../../../base/browser/fastDomNode.js";import"../../../../../../base/browser/ui/list/list.js";import{Disposable as Ee,DisposableStore as O}from"../../../../../../base/common/lifecycle.js";import"../../../../../../editor/browser/editorBrowser.js";import{CodeEditorWidget as ve}from"../../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import"../../../../../../editor/common/config/editorOptions.js";import{BareFontInfo as Se}from"../../../../../../editor/common/config/fontInfo.js";import{EditorContextKeys as we}from"../../../../../../editor/common/editorContextKeys.js";import{PLAINTEXT_LANGUAGE_ID as ge}from"../../../../../../editor/common/languages/modesRegistry.js";import{localize as ke}from"../../../../../../nls.js";import{IMenuService as X}from"../../../../../../platform/actions/common/actions.js";import{IConfigurationService as $}from"../../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as B}from"../../../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as j}from"../../../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as q}from"../../../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as F}from"../../../../../../platform/instantiation/common/serviceCollection.js";import{IKeybindingService as Q}from"../../../../../../platform/keybinding/common/keybinding.js";import{INotificationService as Y}from"../../../../../../platform/notification/common/notification.js";import"../../notebookBrowser.js";import{CellPartsCollection as Z}from"../cellPart.js";import{CellChatPart as ee}from"../cellParts/chat/cellChatPart.js";import{CellComments as oe}from"../cellParts/cellComments.js";import{CellContextKeyPart as te}from"../cellParts/cellContextKeys.js";import{CellDecorations as ne}from"../cellParts/cellDecorations.js";import{CellDragAndDropPart as ie}from"../cellParts/cellDnd.js";import{CodeCellDragImageRenderer as Te}from"../cellParts/cellDragRenderer.js";import{CellEditorOptions as Me}from"../cellParts/cellEditorOptions.js";import{CellExecutionPart as xe}from"../cellParts/cellExecution.js";import{CellFocusPart as re}from"../cellParts/cellFocus.js";import{CellFocusIndicator as de}from"../cellParts/cellFocusIndicator.js";import{CellProgressBar as ye}from"../cellParts/cellProgressBar.js";import{CellEditorStatusBar as le}from"../cellParts/cellStatusPart.js";import{BetweenCellToolbar as ce,CellTitleToolbarPart as ae}from"../cellParts/cellToolbars.js";import{CodeCell as Pe}from"../cellParts/codeCell.js";import{RunToolbar as De}from"../cellParts/codeCellRunToolbar.js";import{CollapsedCellInput as se}from"../cellParts/collapsedCellInput.js";import{CollapsedCellOutput as Oe}from"../cellParts/collapsedCellOutput.js";import{FoldedCellHint as Le}from"../cellParts/foldedCellHint.js";import{MarkupCell as Ne}from"../cellParts/markupCell.js";import"../notebookRenderingCommon.js";import"../../viewModel/codeCellViewModel.js";import"../../viewModel/markupCellViewModel.js";import"../../viewModel/notebookViewModelImpl.js";import{CellKind as Ke}from"../../../common/notebookCommon.js";import{INotebookExecutionStateService as Ve}from"../../../common/notebookExecutionStateService.js";import"../notebookCellEditorPool.js";const i=n.$;let L=class extends Ee{constructor(t,o){super();this.configurationService=o;const e=this.configurationService.getValue("editor");this.lineHeight=Se.createFromRawSettings(e,he.getInstance(t).value).lineHeight}lineHeight;getHeight(t){return t.getHeight(this.lineHeight)}getDynamicHeight(t){return t.getDynamicHeight()}getTemplateId(t){return t.cellKind===Ke.Markup?v.TEMPLATE_ID:S.TEMPLATE_ID}};L=D([d(1,$)],L);class pe{constructor(p,t,o,e,r,l,f,I,c,h){this.instantiationService=p;this.notebookEditor=t;this.contextMenuService=o;this.menuService=e;this.keybindingService=l;this.notificationService=f;this.contextKeyServiceProvider=I;this.dndController=h;this.editorOptions=new Me(this.notebookEditor.getBaseCellEditorOptions(c),this.notebookEditor.notebookOptions,r)}editorOptions;dispose(){this.editorOptions.dispose(),this.dndController=void 0}}let v=class extends pe{constructor(t,o,e,r,l,f,I,c,h,m,E){super(f,t,I,c,l,h,m,r,"markdown",o);this.renderedEditors=e;this._notebookExecutionStateService=E}static TEMPLATE_ID="markdown_cell";_notebookExecutionStateService;get templateId(){return v.TEMPLATE_ID}renderTemplate(t){t.classList.add("markdown-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),f=n.append(o,i(".cell-title-toolbar")),I=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(c.domNode,n.$(".notebook-folding-indicator")),m=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),E=n.append(o,i(".cell.code")),u=n.append(E,i(".cell-editor-part")),k=n.append(u,i(".cell-chat-part")),b=n.append(E,i(".input-collapse-container"));b.style.display="none";const N=n.append(u,i(".cell-editor-container"));u.style.display="none";const K=n.append(o,i(".cell-comment-container")),T=n.append(o,i(".cell.markdown")),V=n.append(o,i(".cell-bottom-toolbar-container")),a=e.add(this.instantiationService.createChild(new F([B,r]))),M={toggle:(A,H)=>o.classList.toggle(A,H)},g=e.add(a.createInstance(ae,f,M,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),R=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),x=new Z(n.getWindow(t),[e.add(a.createInstance(ee,this.notebookEditor,k)),e.add(a.createInstance(le,this.notebookEditor,o,u,void 0)),e.add(new de(this.notebookEditor,g,I,c,m,R)),e.add(new Le(this.notebookEditor,n.append(o,i(".notebook-folded-hint")),this._notebookExecutionStateService)),e.add(new ne(t,l)),e.add(a.createInstance(oe,this.notebookEditor,K)),e.add(new se(this.notebookEditor,b)),e.add(new re(o,void 0,this.notebookEditor)),e.add(new ie(o)),e.add(a.createInstance(te,this.notebookEditor))],[g,e.add(a.createInstance(ce,this.notebookEditor,f,V))]);return e.add(x),{rootContainer:t,cellInputCollapsedContainer:b,instantiationService:a,container:o,cellContainer:T,editorPart:u,editorContainer:N,foldingIndicator:h,templateDisposables:e,elementDisposables:new O,cellParts:x,toJSON:()=>({})}}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,e.currentEditor=void 0,e.editorPart.style.display="none",e.cellContainer.innerText="",r!==void 0&&e.elementDisposables.add(e.instantiationService.createInstance(Ne,this.notebookEditor,t,e,this.renderedEditors))}disposeTemplate(t){t.elementDisposables.dispose(),t.templateDisposables.dispose()}disposeElement(t,o,e){e.elementDisposables.clear()}};v=D([d(4,$),d(5,q),d(6,j),d(7,X),d(8,Q),d(9,Y),d(10,Ve)],v);let S=class extends pe{constructor(t,o,e,r,l,f,I,c,h,m,E){super(h,t,I,c,f,m,E,l,ge,r);this.renderedEditors=o;this.editorPool=e}static TEMPLATE_ID="code_cell";get templateId(){return S.TEMPLATE_ID}renderTemplate(t){t.classList.add("code-cell-row");const o=n.append(t,n.$(".cell-inner-container")),e=new O,r=e.add(this.contextKeyServiceProvider(o)),l=n.append(t,i(".cell-decoration")),f=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-top"))),I=n.append(o,i(".cell-title-toolbar")),c=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-left"))),h=n.append(o,i(".cell-chat-part")),m=n.append(o,i(".cell.code")),E=n.append(m,i(".run-button-container")),u=n.append(m,i(".input-collapse-container"));u.style.display="none";const k=n.append(c.domNode,i("div.execution-count-label"));k.title=ke("cellExecutionOrderCountLabel","Execution Order");const b=n.append(m,i(".cell-editor-part")),N=n.append(b,i(".cell-editor-container")),K=n.append(o,i(".cell-comment-container")),T=e.add(this.contextKeyServiceProvider(b)),V=e.add(this.instantiationService.createChild(new F([B,T])));we.inCompositeEditor.bindTo(T).set(!0);const a=V.createInstance(ve,N,{...this.editorOptions.getDefaultValue(),dimension:{width:0,height:0},scrollbar:{vertical:"hidden",horizontal:"auto",handleMouseWheel:!1,useShadows:!1}},{contributions:this.notebookEditor.creationOptions.cellEditorContributions});e.add(a);const M=new C(n.append(o,i(".output"))),g=n.append(M.domNode,i(".output-collapse-container")),R=new C(n.append(o,i(".output-show-more-container"))),x=new C(n.append(o,n.$(".cell-focus-indicator.cell-focus-indicator-side.cell-focus-indicator-right"))),y=n.append(o,i(".cell-editor-focus-sink"));y.setAttribute("tabindex","0");const A=n.append(o,i(".cell-bottom-toolbar-container")),H=new C(n.append(o,i(".cell-focus-indicator.cell-focus-indicator-bottom"))),s=e.add(this.instantiationService.createChild(new F([B,r]))),me={toggle:(Ce,fe)=>o.classList.toggle(Ce,fe)},W=e.add(s.createInstance(ae,I,me,this.notebookEditor.creationOptions.menuIds.cellTitleToolbar,this.notebookEditor.creationOptions.menuIds.cellDeleteToolbar,this.notebookEditor)),_=e.add(new de(this.notebookEditor,W,f,c,x,H)),z=[_,e.add(s.createInstance(ee,this.notebookEditor,h)),e.add(s.createInstance(le,this.notebookEditor,o,b,a)),e.add(s.createInstance(ye,b,u)),e.add(new ne(t,l)),e.add(s.createInstance(oe,this.notebookEditor,K)),e.add(s.createInstance(xe,this.notebookEditor,k)),e.add(s.createInstance(Oe,this.notebookEditor,g)),e.add(new se(this.notebookEditor,u)),e.add(new re(o,y,this.notebookEditor)),e.add(new ie(o)),e.add(s.createInstance(te,this.notebookEditor))],{cellExecutePrimary:G,cellExecuteToolbar:J}=this.notebookEditor.creationOptions.menuIds;G&&J&&z.push(e.add(s.createInstance(De,this.notebookEditor,r,o,E,G,J)));const U=new Z(n.getWindow(t),z,[W,e.add(s.createInstance(ce,this.notebookEditor,I,A))]);e.add(U);const P={rootContainer:t,editorPart:b,cellInputCollapsedContainer:u,cellOutputCollapsedContainer:g,instantiationService:s,container:o,cellContainer:m,focusSinkElement:y,outputContainer:M,outputShowMoreContainer:R,editor:a,templateDisposables:e,elementDisposables:new O,cellParts:U,toJSON:()=>({})},ue=[c.domNode,_.codeFocusIndicator.domNode,_.outputFocusIndicator.domNode];return this.dndController?.registerDragHandle(P,t,ue,()=>new Te().getDragImage(P,P.editor,"code")),P}renderElement(t,o,e,r){if(!this.notebookEditor.hasModel())throw new Error("The notebook editor is not attached with view model yet.");e.currentRenderedCell=t,r!==void 0&&(e.outputContainer.domNode.innerText="",e.outputContainer.domNode.appendChild(e.cellOutputCollapsedContainer),e.elementDisposables.add(e.instantiationService.createInstance(Pe,this.notebookEditor,t,e,this.editorPool)),this.renderedEditors.set(t,e.editor))}disposeTemplate(t){t.templateDisposables.clear()}disposeElement(t,o,e,r){e.elementDisposables.clear(),this.renderedEditors.delete(t)}};S=D([d(5,$),d(6,j),d(7,X),d(8,q),d(9,Q),d(10,Y)],S);export{S as CodeCellRenderer,v as MarkupCellRenderer,L as NotebookCellListDelegate};
