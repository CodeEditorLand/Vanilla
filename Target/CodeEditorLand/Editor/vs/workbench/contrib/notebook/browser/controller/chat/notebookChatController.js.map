{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/controller/chat/notebookChatController.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension, IFocusTracker, WindowIntervalTimer, getWindow, scheduleAtNextAnimationFrame, trackFocus } from '../../../../../../base/browser/dom.js';\nimport { CancelablePromise, DeferredPromise, Queue, createCancelablePromise, disposableTimeout } from '../../../../../../base/common/async.js';\nimport { CancellationToken, CancellationTokenSource } from '../../../../../../base/common/cancellation.js';\nimport { Emitter } from '../../../../../../base/common/event.js';\nimport { Disposable, DisposableStore, MutableDisposable, toDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { LRUCache } from '../../../../../../base/common/map.js';\nimport { Schemas } from '../../../../../../base/common/network.js';\nimport { MovingAverage } from '../../../../../../base/common/numbers.js';\nimport { isEqual } from '../../../../../../base/common/resources.js';\nimport { StopWatch } from '../../../../../../base/common/stopwatch.js';\nimport { assertType } from '../../../../../../base/common/types.js';\nimport { URI } from '../../../../../../base/common/uri.js';\nimport { IActiveCodeEditor } from '../../../../../../editor/browser/editorBrowser.js';\nimport { CodeEditorWidget } from '../../../../../../editor/browser/widget/codeEditor/codeEditorWidget.js';\nimport { ISingleEditOperation } from '../../../../../../editor/common/core/editOperation.js';\nimport { Position } from '../../../../../../editor/common/core/position.js';\nimport { Selection } from '../../../../../../editor/common/core/selection.js';\nimport { TextEdit } from '../../../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../../../editor/common/languages/language.js';\nimport { ICursorStateComputer, ITextModel } from '../../../../../../editor/common/model.js';\nimport { IEditorWorkerService } from '../../../../../../editor/common/services/editorWorker.js';\nimport { IModelService } from '../../../../../../editor/common/services/model.js';\nimport { localize } from '../../../../../../nls.js';\nimport { IContextKey, IContextKeyService } from '../../../../../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../../../../../platform/instantiation/common/instantiation.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../../../platform/storage/common/storage.js';\nimport { ChatAgentLocation } from '../../../../chat/common/chatAgents.js';\nimport { ChatModel, IChatModel } from '../../../../chat/common/chatModel.js';\nimport { IChatService } from '../../../../chat/common/chatService.js';\nimport { countWords } from '../../../../chat/common/chatWordCounter.js';\nimport { ProgressingEditsOptions } from '../../../../inlineChat/browser/inlineChatStrategies.js';\nimport { InlineChatWidget } from '../../../../inlineChat/browser/inlineChatWidget.js';\nimport { asProgressiveEdit, performAsyncTextEdit } from '../../../../inlineChat/browser/utils.js';\nimport { insertCell, runDeleteAction } from '../cellOperations.js';\nimport { CTX_NOTEBOOK_CELL_CHAT_FOCUSED, CTX_NOTEBOOK_CHAT_HAS_ACTIVE_REQUEST, CTX_NOTEBOOK_CHAT_OUTER_FOCUS_POSITION, CTX_NOTEBOOK_CHAT_USER_DID_EDIT, MENU_CELL_CHAT_WIDGET_STATUS } from './notebookChatContext.js';\nimport { ICellViewModel, INotebookEditor, INotebookEditorContribution, INotebookViewZone } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { CellKind } from '../../../common/notebookCommon.js';\nimport { INotebookExecutionStateService, NotebookExecutionType } from '../../../common/notebookExecutionStateService.js';\n\nclass NotebookChatWidget extends Disposable implements INotebookViewZone {\n\tset afterModelPosition(afterModelPosition: number) {\n\t\tthis.notebookViewZone.afterModelPosition = afterModelPosition;\n\t}\n\n\tget afterModelPosition(): number {\n\t\treturn this.notebookViewZone.afterModelPosition;\n\t}\n\n\tset heightInPx(heightInPx: number) {\n\t\tthis.notebookViewZone.heightInPx = heightInPx;\n\t}\n\n\tget heightInPx(): number {\n\t\treturn this.notebookViewZone.heightInPx;\n\t}\n\n\tprivate _editingCell: ICellViewModel | null = null;\n\n\tget editingCell() {\n\t\treturn this._editingCell;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\treadonly id: string,\n\t\treadonly notebookViewZone: INotebookViewZone,\n\t\treadonly domNode: HTMLElement,\n\t\treadonly widgetContainer: HTMLElement,\n\t\treadonly inlineChatWidget: InlineChatWidget,\n\t\treadonly parentEditor: CodeEditorWidget,\n\t\tprivate readonly _languageService: ILanguageService,\n\t) {\n\t\tsuper();\n\n\t\tconst updateHeight = () => {\n\t\t\tif (this.heightInPx === inlineChatWidget.contentHeight) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.heightInPx = inlineChatWidget.contentHeight;\n\t\t\tthis._notebookEditor.changeViewZones(accessor => {\n\t\t\t\taccessor.layoutZone(id);\n\t\t\t});\n\t\t\tthis._layoutWidget(inlineChatWidget, widgetContainer);\n\t\t};\n\n\t\tthis._register(inlineChatWidget.onDidChangeHeight(() => {\n\t\t\tupdateHeight();\n\t\t}));\n\n\t\tthis._register(inlineChatWidget.chatWidget.onDidChangeHeight(() => {\n\t\t\tupdateHeight();\n\t\t}));\n\n\t\tthis.heightInPx = inlineChatWidget.contentHeight;\n\t\tthis._layoutWidget(inlineChatWidget, widgetContainer);\n\t}\n\n\tlayout() {\n\t\tthis._layoutWidget(this.inlineChatWidget, this.widgetContainer);\n\t}\n\n\trestoreEditingCell(initEditingCell: ICellViewModel) {\n\t\tthis._editingCell = initEditingCell;\n\n\t\tconst decorationIds = this._notebookEditor.deltaCellDecorations([], [{\n\t\t\thandle: this._editingCell.handle,\n\t\t\toptions: { className: 'nb-chatGenerationHighlight', outputClassName: 'nb-chatGenerationHighlight' }\n\t\t}]);\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis._notebookEditor.deltaCellDecorations(decorationIds, []);\n\t\t}));\n\t}\n\n\thasFocus() {\n\t\treturn this.inlineChatWidget.hasFocus();\n\t}\n\n\tfocus() {\n\t\tthis.updateNotebookEditorFocusNSelections();\n\t\tthis.inlineChatWidget.focus();\n\t}\n\n\tupdateNotebookEditorFocusNSelections() {\n\t\tthis._notebookEditor.focusContainer(true);\n\t\tthis._notebookEditor.setFocus({ start: this.afterModelPosition, end: this.afterModelPosition });\n\t\tthis._notebookEditor.setSelections([{\n\t\t\tstart: this.afterModelPosition,\n\t\t\tend: this.afterModelPosition\n\t\t}]);\n\t}\n\n\tgetEditingCell() {\n\t\treturn this._editingCell;\n\t}\n\n\tasync getOrCreateEditingCell(): Promise<{ cell: ICellViewModel; editor: IActiveCodeEditor } | undefined> {\n\t\tif (this._editingCell) {\n\t\t\tconst codeEditor = this._notebookEditor.codeEditors.find(ce => ce[0] === this._editingCell)?.[1];\n\t\t\tif (codeEditor?.hasModel()) {\n\t\t\t\treturn {\n\t\t\t\t\tcell: this._editingCell,\n\t\t\t\t\teditor: codeEditor\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst widgetHasFocus = this.inlineChatWidget.hasFocus();\n\n\t\tthis._editingCell = insertCell(this._languageService, this._notebookEditor, this.afterModelPosition, CellKind.Code, 'above');\n\n\t\tif (!this._editingCell) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tawait this._notebookEditor.revealFirstLineIfOutsideViewport(this._editingCell);\n\n\t\t// update decoration\n\t\tconst decorationIds = this._notebookEditor.deltaCellDecorations([], [{\n\t\t\thandle: this._editingCell.handle,\n\t\t\toptions: { className: 'nb-chatGenerationHighlight', outputClassName: 'nb-chatGenerationHighlight' }\n\t\t}]);\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis._notebookEditor.deltaCellDecorations(decorationIds, []);\n\t\t}));\n\n\t\tif (widgetHasFocus) {\n\t\t\tthis.focus();\n\t\t}\n\n\t\tconst codeEditor = this._notebookEditor.codeEditors.find(ce => ce[0] === this._editingCell)?.[1];\n\t\tif (codeEditor?.hasModel()) {\n\t\t\treturn {\n\t\t\t\tcell: this._editingCell,\n\t\t\t\teditor: codeEditor\n\t\t\t};\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tasync discardChange() {\n\t\tif (this._notebookEditor.hasModel() && this._editingCell) {\n\t\t\t// remove the cell from the notebook\n\t\t\trunDeleteAction(this._notebookEditor, this._editingCell);\n\t\t}\n\t}\n\n\tprivate _layoutWidget(inlineChatWidget: InlineChatWidget, widgetContainer: HTMLElement) {\n\t\tconst layoutConfiguration = this._notebookEditor.notebookOptions.getLayoutConfiguration();\n\t\tconst rightMargin = layoutConfiguration.cellRightMargin;\n\t\tconst leftMargin = this._notebookEditor.notebookOptions.getCellEditorContainerLeftMargin();\n\t\tconst maxWidth = 640;\n\t\tconst width = Math.min(maxWidth, this._notebookEditor.getLayoutInfo().width - leftMargin - rightMargin);\n\n\t\tinlineChatWidget.layout(new Dimension(width, this.heightInPx));\n\t\tinlineChatWidget.domNode.style.width = `${width}px`;\n\t\twidgetContainer.style.left = `${leftMargin}px`;\n\t}\n\n\toverride dispose() {\n\t\tthis._notebookEditor.changeViewZones(accessor => {\n\t\t\taccessor.removeZone(this.id);\n\t\t});\n\t\tthis.domNode.remove();\n\t\tsuper.dispose();\n\t}\n}\n\nexport interface INotebookCellTextModelLike { uri: URI; viewType: string }\nclass NotebookCellTextModelLikeId {\n\tstatic str(k: INotebookCellTextModelLike): string {\n\t\treturn `${k.viewType}/${k.uri.toString()}`;\n\t}\n\tstatic obj(s: string): INotebookCellTextModelLike {\n\t\tconst idx = s.indexOf('/');\n\t\treturn {\n\t\t\tviewType: s.substring(0, idx),\n\t\t\turi: URI.parse(s.substring(idx + 1))\n\t\t};\n\t}\n}\n\nexport class NotebookChatController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.chatController';\n\tstatic counter: number = 0;\n\n\tpublic static get(editor: INotebookEditor): NotebookChatController | null {\n\t\treturn editor.getContribution<NotebookChatController>(NotebookChatController.id);\n\t}\n\n\t// History\n\tprivate static _storageKey = 'inline-chat-history';\n\tprivate static _promptHistory: string[] = [];\n\tprivate _historyOffset: number = -1;\n\tprivate _historyCandidate: string = '';\n\tprivate _historyUpdate: (prompt: string) => void;\n\tprivate _promptCache = new LRUCache<string, string>(1000, 0.7);\n\tprivate readonly _onDidChangePromptCache = this._register(new Emitter<{ cell: URI }>());\n\treadonly onDidChangePromptCache = this._onDidChangePromptCache.event;\n\n\tprivate _strategy: EditStrategy | undefined;\n\tprivate _sessionCtor: CancelablePromise<void> | undefined;\n\tprivate _warmupRequestCts?: CancellationTokenSource;\n\tprivate _activeRequestCts?: CancellationTokenSource;\n\tprivate readonly _ctxHasActiveRequest: IContextKey<boolean>;\n\tprivate readonly _ctxCellWidgetFocused: IContextKey<boolean>;\n\tprivate readonly _ctxUserDidEdit: IContextKey<boolean>;\n\tprivate readonly _ctxOuterFocusPosition: IContextKey<'above' | 'below' | ''>;\n\tprivate readonly _userEditingDisposables = this._register(new DisposableStore());\n\tprivate readonly _widgetDisposableStore = this._register(new DisposableStore());\n\tprivate _focusTracker: IFocusTracker | undefined;\n\tprivate _widget: NotebookChatWidget | undefined;\n\n\tprivate readonly _model: MutableDisposable<ChatModel> = this._register(new MutableDisposable());\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IEditorWorkerService private readonly _editorWorkerService: IEditorWorkerService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@INotebookExecutionStateService private _executionStateService: INotebookExecutionStateService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IChatService private readonly _chatService: IChatService\n\t) {\n\t\tsuper();\n\t\tthis._ctxHasActiveRequest = CTX_NOTEBOOK_CHAT_HAS_ACTIVE_REQUEST.bindTo(this._contextKeyService);\n\t\tthis._ctxCellWidgetFocused = CTX_NOTEBOOK_CELL_CHAT_FOCUSED.bindTo(this._contextKeyService);\n\t\tthis._ctxUserDidEdit = CTX_NOTEBOOK_CHAT_USER_DID_EDIT.bindTo(this._contextKeyService);\n\t\tthis._ctxOuterFocusPosition = CTX_NOTEBOOK_CHAT_OUTER_FOCUS_POSITION.bindTo(this._contextKeyService);\n\n\t\tthis._registerFocusTracker();\n\n\t\tNotebookChatController._promptHistory = JSON.parse(this._storageService.get(NotebookChatController._storageKey, StorageScope.PROFILE, '[]'));\n\t\tthis._historyUpdate = (prompt: string) => {\n\t\t\tconst idx = NotebookChatController._promptHistory.indexOf(prompt);\n\t\t\tif (idx >= 0) {\n\t\t\t\tNotebookChatController._promptHistory.splice(idx, 1);\n\t\t\t}\n\t\t\tNotebookChatController._promptHistory.unshift(prompt);\n\t\t\tthis._historyOffset = -1;\n\t\t\tthis._historyCandidate = '';\n\t\t\tthis._storageService.store(NotebookChatController._storageKey, JSON.stringify(NotebookChatController._promptHistory), StorageScope.PROFILE, StorageTarget.USER);\n\t\t};\n\t}\n\n\tprivate _registerFocusTracker() {\n\t\tthis._register(this._notebookEditor.onDidChangeFocus(() => {\n\t\t\tif (!this._widget) {\n\t\t\t\tthis._ctxOuterFocusPosition.set('');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst widgetIndex = this._widget.afterModelPosition;\n\t\t\tconst focus = this._notebookEditor.getFocus().start;\n\n\t\t\tif (focus + 1 === widgetIndex) {\n\t\t\t\tthis._ctxOuterFocusPosition.set('above');\n\t\t\t} else if (focus === widgetIndex) {\n\t\t\t\tthis._ctxOuterFocusPosition.set('below');\n\t\t\t} else {\n\t\t\t\tthis._ctxOuterFocusPosition.set('');\n\t\t\t}\n\t\t}));\n\t}\n\n\trun(index: number, input: string | undefined, autoSend: boolean | undefined): void {\n\t\tif (this._widget) {\n\t\t\tif (this._widget.afterModelPosition !== index) {\n\t\t\t\tconst window = getWindow(this._widget.domNode);\n\t\t\t\tthis._disposeWidget();\n\n\t\t\t\tscheduleAtNextAnimationFrame(window, () => {\n\t\t\t\t\tthis._createWidget(index, input, autoSend, undefined);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._createWidget(index, input, autoSend, undefined);\n\t\t// TODO: reveal widget to the center if it's out of the viewport\n\t}\n\n\trestore(editingCell: ICellViewModel, input: string) {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._notebookEditor.textModel.cells.indexOf(editingCell.model);\n\n\t\tif (index < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._widget) {\n\t\t\tif (this._widget.afterModelPosition !== index) {\n\t\t\t\tthis._disposeWidget();\n\t\t\t\tconst window = getWindow(this._widget.domNode);\n\n\t\t\t\tscheduleAtNextAnimationFrame(window, () => {\n\t\t\t\t\tthis._createWidget(index, input, false, editingCell);\n\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis._createWidget(index, input, false, editingCell);\n\t}\n\n\tprivate _disposeWidget() {\n\t\tthis._widget?.dispose();\n\t\tthis._widget = undefined;\n\t\tthis._widgetDisposableStore.clear();\n\n\t\tthis._historyOffset = -1;\n\t\tthis._historyCandidate = '';\n\t}\n\n\n\tprivate _createWidget(index: number, input: string | undefined, autoSend: boolean | undefined, initEditingCell: ICellViewModel | undefined) {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\t// Clear the widget if it's already there\n\t\tthis._widgetDisposableStore.clear();\n\n\t\tconst viewZoneContainer = document.createElement('div');\n\t\tviewZoneContainer.classList.add('monaco-editor');\n\t\tconst widgetContainer = document.createElement('div');\n\t\twidgetContainer.style.position = 'absolute';\n\t\tviewZoneContainer.appendChild(widgetContainer);\n\n\t\tthis._focusTracker = this._widgetDisposableStore.add(trackFocus(viewZoneContainer));\n\t\tthis._widgetDisposableStore.add(this._focusTracker.onDidFocus(() => {\n\t\t\tthis._updateNotebookEditorFocusNSelections();\n\t\t}));\n\n\t\tconst fakeParentEditorElement = document.createElement('div');\n\n\t\tconst fakeParentEditor = this._widgetDisposableStore.add(this._instantiationService.createInstance(\n\t\t\tCodeEditorWidget,\n\t\t\tfakeParentEditorElement,\n\t\t\t{\n\t\t\t},\n\t\t\t{ isSimpleWidget: true }\n\t\t));\n\n\t\tconst inputBoxFragment = `notebook-chat-input-${NotebookChatController.counter++}`;\n\t\tconst notebookUri = this._notebookEditor.textModel.uri;\n\t\tconst inputUri = notebookUri.with({ scheme: Schemas.untitled, fragment: inputBoxFragment });\n\t\tconst result: ITextModel = this._modelService.createModel('', null, inputUri, false);\n\t\tfakeParentEditor.setModel(result);\n\n\t\tconst inlineChatWidget = this._widgetDisposableStore.add(this._instantiationService.createInstance(\n\t\t\tInlineChatWidget,\n\t\t\t{\n\t\t\t\tlocation: ChatAgentLocation.Notebook,\n\t\t\t\tresolveData: () => {\n\t\t\t\t\tconst sessionInputUri = this.getSessionInputUri();\n\t\t\t\t\tif (!sessionInputUri) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\ttype: ChatAgentLocation.Notebook,\n\t\t\t\t\t\tsessionInputUri\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\tstatusMenuId: MENU_CELL_CHAT_WIDGET_STATUS,\n\t\t\t\tchatWidgetViewOptions: {\n\t\t\t\t\trendererOptions: {\n\t\t\t\t\t\trenderTextEditsAsSummary: (uri) => {\n\t\t\t\t\t\t\treturn isEqual(uri, this._widget?.parentEditor.getModel()?.uri)\n\t\t\t\t\t\t\t\t|| isEqual(uri, this._notebookEditor.textModel?.uri);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t\tmenus: {\n\t\t\t\t\t\ttelemetrySource: 'notebook-generate-cell'\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t));\n\t\tinlineChatWidget.placeholder = localize('default.placeholder', \"Ask a question\");\n\t\tinlineChatWidget.updateInfo(localize('welcome.1', \"AI-generated code may be incorrect\"));\n\t\twidgetContainer.appendChild(inlineChatWidget.domNode);\n\t\tthis._widgetDisposableStore.add(inlineChatWidget.onDidChangeInput(() => {\n\t\t\tthis._warmupRequestCts?.dispose(true);\n\t\t\tthis._warmupRequestCts = undefined;\n\t\t}));\n\n\t\tthis._notebookEditor.changeViewZones(accessor => {\n\t\t\tconst notebookViewZone = {\n\t\t\t\tafterModelPosition: index,\n\t\t\t\theightInPx: 80,\n\t\t\t\tdomNode: viewZoneContainer\n\t\t\t};\n\n\t\t\tconst id = accessor.addZone(notebookViewZone);\n\t\t\tthis._scrollWidgetIntoView(index);\n\n\t\t\tthis._widget = new NotebookChatWidget(\n\t\t\t\tthis._notebookEditor,\n\t\t\t\tid,\n\t\t\t\tnotebookViewZone,\n\t\t\t\tviewZoneContainer,\n\t\t\t\twidgetContainer,\n\t\t\t\tinlineChatWidget,\n\t\t\t\tfakeParentEditor,\n\t\t\t\tthis._languageService\n\t\t\t);\n\n\t\t\tif (initEditingCell) {\n\t\t\t\tthis._widget.restoreEditingCell(initEditingCell);\n\t\t\t\tthis._updateUserEditingState();\n\t\t\t}\n\n\t\t\tthis._ctxCellWidgetFocused.set(true);\n\n\t\t\tdisposableTimeout(() => {\n\t\t\t\tthis._focusWidget();\n\t\t\t}, 0, this._store);\n\n\t\t\tthis._sessionCtor = createCancelablePromise<void>(async token => {\n\t\t\t\tawait this._startSession(token);\n\t\t\t\tassertType(this._model.value);\n\t\t\t\tconst model = this._model.value;\n\t\t\t\tthis._widget?.inlineChatWidget.setChatModel(model);\n\n\t\t\t\tif (fakeParentEditor.hasModel()) {\n\n\t\t\t\t\tif (this._widget) {\n\t\t\t\t\t\tthis._focusWidget();\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._widget && input) {\n\t\t\t\t\t\tthis._widget.inlineChatWidget.value = input;\n\n\t\t\t\t\t\tif (autoSend) {\n\t\t\t\t\t\t\tthis.acceptInput();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t}\n\n\tprivate async _startSession(token: CancellationToken) {\n\t\tif (!this._model.value) {\n\t\t\tthis._model.value = this._chatService.startSession(ChatAgentLocation.Editor, token);\n\n\t\t\tif (!this._model.value) {\n\t\t\t\tthrow new Error('Failed to start chat session');\n\t\t\t}\n\t\t}\n\n\t\tthis._strategy = new EditStrategy();\n\t}\n\n\tprivate _scrollWidgetIntoView(index: number) {\n\t\tif (index === 0 || this._notebookEditor.getLength() === 0) {\n\t\t\t// the cell is at the beginning of the notebook\n\t\t\tthis._notebookEditor.revealOffsetInCenterIfOutsideViewport(0);\n\t\t} else {\n\t\t\t// the cell is at the end of the notebook\n\t\t\tconst previousCell = this._notebookEditor.cellAt(Math.min(index - 1, this._notebookEditor.getLength() - 1));\n\t\t\tif (previousCell) {\n\t\t\t\tconst cellTop = this._notebookEditor.getAbsoluteTopOfElement(previousCell);\n\t\t\t\tconst cellHeight = this._notebookEditor.getHeightOfElement(previousCell);\n\n\t\t\t\tthis._notebookEditor.revealOffsetInCenterIfOutsideViewport(cellTop + cellHeight + 48 /** center of the dialog */);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _focusWidget() {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._updateNotebookEditorFocusNSelections();\n\t\tthis._widget.focus();\n\t}\n\n\tprivate _updateNotebookEditorFocusNSelections() {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._widget.updateNotebookEditorFocusNSelections();\n\t}\n\n\thasSession(chatModel: IChatModel) {\n\t\treturn this._model.value === chatModel;\n\t}\n\n\tgetSessionInputUri() {\n\t\treturn this._widget?.parentEditor.getModel()?.uri;\n\t}\n\n\tasync acceptInput() {\n\t\tassertType(this._widget);\n\t\tawait this._sessionCtor;\n\t\tassertType(this._model.value);\n\t\tassertType(this._strategy);\n\n\t\tconst lastInput = this._widget.inlineChatWidget.value;\n\t\tthis._historyUpdate(lastInput);\n\n\t\tconst editor = this._widget.parentEditor;\n\t\tconst textModel = editor.getModel();\n\n\t\tif (!editor.hasModel() || !textModel) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._widget.editingCell && this._widget.editingCell.textBuffer.getLength() > 0) {\n\t\t\t// it already contains some text, clear it\n\t\t\tconst ref = await this._widget.editingCell.resolveTextModel();\n\t\t\tref.setValue('');\n\t\t}\n\n\t\tconst editingCellIndex = this._widget.editingCell ? this._notebookEditor.getCellIndex(this._widget.editingCell) : undefined;\n\t\tif (editingCellIndex !== undefined) {\n\t\t\tthis._notebookEditor.setSelections([{\n\t\t\t\tstart: editingCellIndex,\n\t\t\t\tend: editingCellIndex + 1\n\t\t\t}]);\n\t\t} else {\n\t\t\t// Update selection to the widget index\n\t\t\tthis._notebookEditor.setSelections([{\n\t\t\t\tstart: this._widget.afterModelPosition,\n\t\t\t\tend: this._widget.afterModelPosition\n\t\t\t}]);\n\t\t}\n\n\t\tthis._ctxHasActiveRequest.set(true);\n\n\t\tthis._activeRequestCts?.cancel();\n\t\tthis._activeRequestCts = new CancellationTokenSource();\n\n\t\tconst store = new DisposableStore();\n\n\t\ttry {\n\t\t\tthis._ctxHasActiveRequest.set(true);\n\n\t\t\tconst progressiveEditsQueue = new Queue();\n\t\t\tconst progressiveEditsClock = StopWatch.create();\n\t\t\tconst progressiveEditsAvgDuration = new MovingAverage();\n\t\t\tconst progressiveEditsCts = new CancellationTokenSource(this._activeRequestCts.token);\n\n\t\t\tconst responsePromise = new DeferredPromise<void>();\n\t\t\tconst response = await this._widget.inlineChatWidget.chatWidget.acceptInput();\n\t\t\tif (response) {\n\t\t\t\tlet lastLength = 0;\n\n\t\t\t\tstore.add(response.onDidChange(e => {\n\t\t\t\t\tif (response.isCanceled) {\n\t\t\t\t\t\tprogressiveEditsCts.cancel();\n\t\t\t\t\t\tresponsePromise.complete();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (response.isComplete) {\n\t\t\t\t\t\tresponsePromise.complete();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst edits = response.response.value.map(part => {\n\t\t\t\t\t\tif (part.kind === 'textEditGroup'\n\t\t\t\t\t\t\t// && isEqual(part.uri, this._session?.textModelN.uri)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn part.edits;\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\treturn [];\n\t\t\t\t\t\t}\n\t\t\t\t\t}).flat();\n\n\t\t\t\t\tconst newEdits = edits.slice(lastLength);\n\t\t\t\t\t// console.log('NEW edits', newEdits, edits);\n\t\t\t\t\tif (newEdits.length === 0) {\n\t\t\t\t\t\treturn; // NO change\n\t\t\t\t\t}\n\t\t\t\t\tlastLength = edits.length;\n\t\t\t\t\tprogressiveEditsAvgDuration.update(progressiveEditsClock.elapsed());\n\t\t\t\t\tprogressiveEditsClock.reset();\n\n\t\t\t\t\tprogressiveEditsQueue.queue(async () => {\n\t\t\t\t\t\tfor (const edits of newEdits) {\n\t\t\t\t\t\t\tawait this._makeChanges(edits, {\n\t\t\t\t\t\t\t\tduration: progressiveEditsAvgDuration.value,\n\t\t\t\t\t\t\t\ttoken: progressiveEditsCts.token\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}));\n\t\t\t}\n\n\t\t\tawait responsePromise.p;\n\t\t\tawait progressiveEditsQueue.whenIdle();\n\n\t\t\tthis._userEditingDisposables.clear();\n\t\t\t// monitor user edits\n\t\t\tconst editingCell = this._widget.getEditingCell();\n\t\t\tif (editingCell) {\n\t\t\t\tthis._userEditingDisposables.add(editingCell.model.onDidChangeContent(() => this._updateUserEditingState()));\n\t\t\t\tthis._userEditingDisposables.add(editingCell.model.onDidChangeLanguage(() => this._updateUserEditingState()));\n\t\t\t\tthis._userEditingDisposables.add(editingCell.model.onDidChangeMetadata(() => this._updateUserEditingState()));\n\t\t\t\tthis._userEditingDisposables.add(editingCell.model.onDidChangeInternalMetadata(() => this._updateUserEditingState()));\n\t\t\t\tthis._userEditingDisposables.add(editingCell.model.onDidChangeOutputs(() => this._updateUserEditingState()));\n\t\t\t\tthis._userEditingDisposables.add(this._executionStateService.onDidChangeExecution(e => {\n\t\t\t\t\tif (e.type === NotebookExecutionType.cell && e.affectsCell(editingCell.uri)) {\n\t\t\t\t\t\tthis._updateUserEditingState();\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t}\n\t\t} catch (e) {\n\t\t} finally {\n\t\t\tstore.dispose();\n\n\t\t\tthis._ctxHasActiveRequest.set(false);\n\t\t\tthis._widget.inlineChatWidget.updateInfo('');\n\t\t\tthis._widget.inlineChatWidget.updateToolbar(true);\n\t\t}\n\t}\n\n\tprivate async _makeChanges(edits: TextEdit[], opts: ProgressingEditsOptions | undefined) {\n\t\tassertType(this._strategy);\n\t\tassertType(this._widget);\n\n\t\tconst editingCell = await this._widget.getOrCreateEditingCell();\n\n\t\tif (!editingCell) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editor = editingCell.editor;\n\n\t\tconst moreMinimalEdits = await this._editorWorkerService.computeMoreMinimalEdits(editor.getModel().uri, edits);\n\t\t// this._log('edits from PROVIDER and after making them MORE MINIMAL', this._activeSession.provider.debugName, edits, moreMinimalEdits);\n\n\t\tif (moreMinimalEdits?.length === 0) {\n\t\t\t// nothing left to do\n\t\t\treturn;\n\t\t}\n\n\t\tconst actualEdits = !opts && moreMinimalEdits ? moreMinimalEdits : edits;\n\t\tconst editOperations = actualEdits.map(TextEdit.asEditOperation);\n\n\t\ttry {\n\t\t\tif (opts) {\n\t\t\t\tawait this._strategy.makeProgressiveChanges(editor, editOperations, opts);\n\t\t\t} else {\n\t\t\t\tawait this._strategy.makeChanges(editor, editOperations);\n\t\t\t}\n\t\t} finally {\n\t\t}\n\t}\n\n\tprivate _updateUserEditingState() {\n\t\tthis._ctxUserDidEdit.set(true);\n\t}\n\n\tasync acceptSession() {\n\t\tassertType(this._model);\n\t\tassertType(this._strategy);\n\n\t\tconst editor = this._widget?.parentEditor;\n\t\tif (!editor?.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst editingCell = this._widget?.getEditingCell();\n\n\t\tif (editingCell && this._notebookEditor.hasModel()) {\n\t\t\tconst cellId = NotebookCellTextModelLikeId.str({ uri: editingCell.uri, viewType: this._notebookEditor.textModel.viewType });\n\t\t\tif (this._widget?.inlineChatWidget.value) {\n\t\t\t\tthis._promptCache.set(cellId, this._widget.inlineChatWidget.value);\n\t\t\t}\n\t\t\tthis._onDidChangePromptCache.fire({ cell: editingCell.uri });\n\t\t}\n\n\t\ttry {\n\t\t\tthis._model.clear();\n\t\t} catch (_err) { }\n\n\t\tthis.dismiss(false);\n\t}\n\n\tasync focusAbove() {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._widget.afterModelPosition;\n\t\tconst prev = index - 1;\n\t\tif (prev < 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = this._notebookEditor.cellAt(prev);\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this._notebookEditor.focusNotebookCell(cell, 'editor');\n\t}\n\n\tasync focusNext() {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst index = this._widget.afterModelPosition;\n\t\tconst cell = this._notebookEditor.cellAt(index);\n\t\tif (!cell) {\n\t\t\treturn;\n\t\t}\n\n\t\tawait this._notebookEditor.focusNotebookCell(cell, 'editor');\n\t}\n\n\thasFocus() {\n\t\treturn this._widget?.hasFocus() ?? false;\n\t}\n\n\tfocus() {\n\t\tthis._focusWidget();\n\t}\n\n\tfocusNearestWidget(index: number, direction: 'above' | 'below') {\n\t\tswitch (direction) {\n\t\t\tcase 'above':\n\t\t\t\tif (this._widget?.afterModelPosition === index) {\n\t\t\t\t\tthis._focusWidget();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 'below':\n\t\t\t\tif (this._widget?.afterModelPosition === index + 1) {\n\t\t\t\t\tthis._focusWidget();\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tbreak;\n\t\t}\n\t}\n\n\tpopulateHistory(up: boolean) {\n\t\tif (!this._widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst len = NotebookChatController._promptHistory.length;\n\t\tif (len === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._historyOffset === -1) {\n\t\t\t// remember the current value\n\t\t\tthis._historyCandidate = this._widget.inlineChatWidget.value;\n\t\t}\n\n\t\tconst newIdx = this._historyOffset + (up ? 1 : -1);\n\t\tif (newIdx >= len) {\n\t\t\t// reached the end\n\t\t\treturn;\n\t\t}\n\n\t\tlet entry: string;\n\t\tif (newIdx < 0) {\n\t\t\tentry = this._historyCandidate;\n\t\t\tthis._historyOffset = -1;\n\t\t} else {\n\t\t\tentry = NotebookChatController._promptHistory[newIdx];\n\t\t\tthis._historyOffset = newIdx;\n\t\t}\n\n\t\tthis._widget.inlineChatWidget.value = entry;\n\t\tthis._widget.inlineChatWidget.selectAll();\n\t}\n\n\tasync cancelCurrentRequest(discard: boolean) {\n\t\tthis._activeRequestCts?.cancel();\n\t}\n\n\tgetEditingCell() {\n\t\treturn this._widget?.getEditingCell();\n\t}\n\n\tdiscard() {\n\t\tthis._activeRequestCts?.cancel();\n\t\tthis._widget?.discardChange();\n\t\tthis.dismiss(true);\n\t}\n\n\tdismiss(discard: boolean) {\n\t\tconst widget = this._widget;\n\t\tconst widgetIndex = widget?.afterModelPosition;\n\t\tconst currentFocus = this._notebookEditor.getFocus();\n\t\tconst isWidgetFocused = currentFocus.start === widgetIndex && currentFocus.end === widgetIndex;\n\n\t\tif (widget && isWidgetFocused) {\n\t\t\t// change focus only when the widget is focused\n\t\t\tconst editingCell = widget.getEditingCell();\n\t\t\tconst shouldFocusEditingCell = editingCell && !discard;\n\t\t\tconst shouldFocusTopCell = widgetIndex === 0 && this._notebookEditor.getLength() > 0;\n\t\t\tconst shouldFocusAboveCell = widgetIndex !== 0 && this._notebookEditor.cellAt(widgetIndex - 1);\n\n\t\t\tif (shouldFocusEditingCell) {\n\t\t\t\tthis._notebookEditor.focusNotebookCell(editingCell, 'container');\n\t\t\t} else if (shouldFocusTopCell) {\n\t\t\t\tthis._notebookEditor.focusNotebookCell(this._notebookEditor.cellAt(0)!, 'container');\n\t\t\t} else if (shouldFocusAboveCell) {\n\t\t\t\tthis._notebookEditor.focusNotebookCell(this._notebookEditor.cellAt(widgetIndex - 1)!, 'container');\n\t\t\t}\n\t\t}\n\n\t\tthis._ctxCellWidgetFocused.set(false);\n\t\tthis._ctxUserDidEdit.set(false);\n\t\tthis._sessionCtor?.cancel();\n\t\tthis._sessionCtor = undefined;\n\t\tthis._model.clear();\n\t\tthis._widget?.dispose();\n\t\tthis._widget = undefined;\n\t\tthis._widgetDisposableStore.clear();\n\t}\n\n\t// check if a cell is generated by prompt by checking prompt cache\n\tisCellGeneratedByChat(cell: ICellViewModel) {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t// no model attached yet\n\t\t\treturn false;\n\t\t}\n\n\t\tconst cellId = NotebookCellTextModelLikeId.str({ uri: cell.uri, viewType: this._notebookEditor.textModel.viewType });\n\t\treturn this._promptCache.has(cellId);\n\t}\n\n\t// get prompt from cache\n\tgetPromptFromCache(cell: ICellViewModel) {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t// no model attached yet\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst cellId = NotebookCellTextModelLikeId.str({ uri: cell.uri, viewType: this._notebookEditor.textModel.viewType });\n\t\treturn this._promptCache.get(cellId);\n\t}\n\tpublic override dispose(): void {\n\t\tthis.dismiss(false);\n\t\tsuper.dispose();\n\t}\n}\n\nexport class EditStrategy {\n\tprivate _editCount: number = 0;\n\n\tconstructor() {\n\t}\n\n\tasync makeProgressiveChanges(editor: IActiveCodeEditor, edits: ISingleEditOperation[], opts: ProgressingEditsOptions): Promise<void> {\n\t\t// push undo stop before first edit\n\t\tif (++this._editCount === 1) {\n\t\t\teditor.pushUndoStop();\n\t\t}\n\n\t\tconst durationInSec = opts.duration / 1000;\n\t\tfor (const edit of edits) {\n\t\t\tconst wordCount = countWords(edit.text ?? '');\n\t\t\tconst speed = wordCount / durationInSec;\n\t\t\t// console.log({ durationInSec, wordCount, speed: wordCount / durationInSec });\n\t\t\tawait performAsyncTextEdit(editor.getModel(), asProgressiveEdit(new WindowIntervalTimer(), edit, speed, opts.token));\n\t\t}\n\t}\n\n\tasync makeChanges(editor: IActiveCodeEditor, edits: ISingleEditOperation[]): Promise<void> {\n\t\tconst cursorStateComputerAndInlineDiffCollection: ICursorStateComputer = (undoEdits) => {\n\t\t\tlet last: Position | null = null;\n\t\t\tfor (const edit of undoEdits) {\n\t\t\t\tlast = !last || last.isBefore(edit.range.getEndPosition()) ? edit.range.getEndPosition() : last;\n\t\t\t\t// this._inlineDiffDecorations.collectEditOperation(edit);\n\t\t\t}\n\t\t\treturn last && [Selection.fromPositions(last)];\n\t\t};\n\n\t\t// push undo stop before first edit\n\t\tif (++this._editCount === 1) {\n\t\t\teditor.pushUndoStop();\n\t\t}\n\t\teditor.executeEdits('inline-chat-live', edits, cursorStateComputerAndInlineDiffCollection);\n\t}\n}\n\n\nregisterNotebookContribution(NotebookChatController.id, NotebookChatController);\n"],
  "mappings": "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",
  "names": ["codeEditor", "edits"]
}
