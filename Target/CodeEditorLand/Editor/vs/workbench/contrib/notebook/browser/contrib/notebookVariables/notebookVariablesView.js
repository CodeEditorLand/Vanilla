var k=Object.defineProperty;var g=Object.getOwnPropertyDescriptor;var v=(c,r,t,e)=>{for(var i=e>1?void 0:e?g(r,t):r,n=c.length-1,a;n>=0;n--)(a=c[n])&&(i=(e?a(r,t,i):a(i))||i);return e&&i&&k(r,t,i),i},o=(c,r)=>(t,e)=>r(t,e,c);import"../../../../../../../vs/base/browser/ui/tree/tree.js";import"../../../../../../../vs/base/common/actions.js";import{RunOnceScheduler as E}from"../../../../../../../vs/base/common/async.js";import"../../../../../../../vs/base/common/uri.js";import*as N from"../../../../../../../vs/nls.js";import"../../../../../../../vs/platform/action/common/action.js";import{createAndFillInContextMenuActions as f}from"../../../../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{IMenuService as y,MenuId as x}from"../../../../../../../vs/platform/actions/common/actions.js";import{ICommandService as C}from"../../../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as A}from"../../../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as T}from"../../../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as V}from"../../../../../../../vs/platform/contextview/browser/contextView.js";import{IHoverService as M}from"../../../../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as _}from"../../../../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as D}from"../../../../../../../vs/platform/keybinding/common/keybinding.js";import{WorkbenchAsyncDataTree as O}from"../../../../../../../vs/platform/list/browser/listService.js";import{IOpenerService as L}from"../../../../../../../vs/platform/opener/common/opener.js";import{IQuickInputService as w}from"../../../../../../../vs/platform/quickinput/common/quickInput.js";import{ITelemetryService as R}from"../../../../../../../vs/platform/telemetry/common/telemetry.js";import{IThemeService as B}from"../../../../../../../vs/platform/theme/common/themeService.js";import{ViewPane as K}from"../../../../../../../vs/workbench/browser/parts/views/viewPane.js";import{IViewDescriptorService as P}from"../../../../../../../vs/workbench/common/views.js";import{CONTEXT_VARIABLE_EXTENSIONID as X,CONTEXT_VARIABLE_INTERFACES as U,CONTEXT_VARIABLE_LANGUAGE as F,CONTEXT_VARIABLE_NAME as z,CONTEXT_VARIABLE_TYPE as H,CONTEXT_VARIABLE_VALUE as W}from"../../../../../../../vs/workbench/contrib/debug/common/debug.js";import{NotebookVariableDataSource as G}from"../../../../../../../vs/workbench/contrib/notebook/browser/contrib/notebookVariables/notebookVariablesDataSource.js";import{NotebookVariableAccessibilityProvider as Q,NotebookVariableRenderer as q,NotebookVariablesDelegate as Y}from"../../../../../../../vs/workbench/contrib/notebook/browser/contrib/notebookVariables/notebookVariablesTree.js";import{getNotebookEditorFromEditorPane as j}from"../../../../../../../vs/workbench/contrib/notebook/browser/notebookBrowser.js";import"../../../../../../../vs/workbench/contrib/notebook/common/model/notebookTextModel.js";import{INotebookExecutionStateService as J}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookExecutionStateService.js";import{INotebookKernelService as Z}from"../../../../../../../vs/workbench/contrib/notebook/common/notebookKernelService.js";import{IEditorService as $}from"../../../../../../../vs/workbench/services/editor/common/editorService.js";let s=class extends K{constructor(t,e,i,n,a,d,u,l,h,m,p,ee,te,b,I,S,oe){super(t,a,d,l,u,m,h,p,b,I,S);this.editorService=e;this.notebookKernelService=i;this.notebookExecutionStateService=n;this.quickInputService=ee;this.commandService=te;this.menuService=oe;this._register(this.editorService.onDidActiveEditorChange(this.handleActiveEditorChange.bind(this))),this._register(this.notebookKernelService.onDidNotebookVariablesUpdate(this.handleVariablesChanged.bind(this))),this._register(this.notebookExecutionStateService.onDidChangeExecution(this.handleExecutionStateChange.bind(this))),this.setActiveNotebook(),this.dataSource=new G(this.notebookKernelService),this.updateScheduler=new E(()=>this.tree?.updateChildren(),100)}static ID="notebookVariablesView";static TITLE=N.localize2("notebook.notebookVariables","Notebook Variables");tree;activeNotebook;dataSource;updateScheduler;renderBody(t){super.renderBody(t),this.element.classList.add("debug-pane"),this.tree=this.instantiationService.createInstance(O,"notebookVariablesTree",t,new Y,[new q(this.hoverService)],this.dataSource,{accessibilityProvider:new Q,identityProvider:{getId:e=>e.id}}),this.tree.layout(),this.activeNotebook&&this.tree.setInput({kind:"root",notebook:this.activeNotebook}),this._register(this.tree.onContextMenu(e=>this.onContextMenu(e)))}onContextMenu(t){if(!t.element)return;const e=t.element,i={source:e.notebook.uri.toString(),name:e.name,value:e.value,type:e.type,expression:e.expression,language:e.language,extensionId:e.extensionId},n=[],a=this.contextKeyService.createOverlay([[z.key,e.name],[W.key,e.value],[H.key,e.type],[U.key,e.interfaces],[F.key,e.language],[X.key,e.extensionId]]),d=this.menuService.getMenuActions(x.NotebookVariablesContext,a,{arg:i,shouldForwardArgs:!0});f(d,n),this.contextMenuService.showContextMenu({getAnchor:()=>t.anchor,getActions:()=>n})}layoutBody(t,e){super.layoutBody(t,e),this.tree?.layout(t,e)}setActiveNotebook(){const t=this.activeNotebook,e=this.editorService.activeEditorPane;if(e?.getId()==="workbench.editor.notebook"||e?.getId()==="workbench.editor.interactive"){const i=j(e)?.getViewModel()?.notebookDocument;this.activeNotebook=i}return t!==this.activeNotebook}handleActiveEditorChange(){this.setActiveNotebook()&&this.activeNotebook&&(this.tree?.setInput({kind:"root",notebook:this.activeNotebook}),this.updateScheduler.schedule())}handleExecutionStateChange(t){this.activeNotebook&&t.affectsNotebook(this.activeNotebook.uri)&&(this.dataSource.cancel(),t.changed===void 0?this.updateScheduler.schedule():this.updateScheduler.cancel())}handleVariablesChanged(t){this.activeNotebook&&t.toString()===this.activeNotebook.uri.toString()&&(this.tree?.setInput({kind:"root",notebook:this.activeNotebook}),this.updateScheduler.schedule())}};s=v([o(1,$),o(2,Z),o(3,J),o(4,D),o(5,V),o(6,T),o(7,A),o(8,_),o(9,P),o(10,L),o(11,w),o(12,C),o(13,B),o(14,R),o(15,M),o(16,y)],s);export{s as NotebookVariablesView};
