var g=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var l=(s,r,t,e)=>{for(var o=e>1?void 0:e?f(r,t):r,n=s.length-1,a;n>=0;n--)(a=s[n])&&(o=(e?a(r,t,o):a(o))||o);return e&&o&&g(r,t,o),o},i=(s,r)=>(t,e)=>r(t,e,s);import"../../../../../../base/browser/ui/tree/tree.js";import"../../../../../../base/common/actions.js";import{RunOnceScheduler as N}from"../../../../../../base/common/async.js";import"../../../../../../base/common/uri.js";import*as v from"../../../../../../nls.js";import"../../../../../../platform/action/common/action.js";import{createAndFillInContextMenuActions as x}from"../../../../../../platform/actions/browser/menuEntryActionViewItem.js";import{IMenuService as A,MenuId as y}from"../../../../../../platform/actions/common/actions.js";import{ICommandService as T}from"../../../../../../platform/commands/common/commands.js";import{IConfigurationService as C}from"../../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as M}from"../../../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as V}from"../../../../../../platform/contextview/browser/contextView.js";import{IHoverService as L}from"../../../../../../platform/hover/browser/hover.js";import{IInstantiationService as O}from"../../../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as D}from"../../../../../../platform/keybinding/common/keybinding.js";import{WorkbenchAsyncDataTree as _}from"../../../../../../platform/list/browser/listService.js";import{IOpenerService as P}from"../../../../../../platform/opener/common/opener.js";import{IQuickInputService as R}from"../../../../../../platform/quickinput/common/quickInput.js";import{ITelemetryService as B}from"../../../../../../platform/telemetry/common/telemetry.js";import{IThemeService as K}from"../../../../../../platform/theme/common/themeService.js";import{ViewPane as X}from"../../../../../browser/parts/views/viewPane.js";import{IViewDescriptorService as w}from"../../../../../common/views.js";import{CONTEXT_VARIABLE_EXTENSIONID as z,CONTEXT_VARIABLE_INTERFACES as F,CONTEXT_VARIABLE_LANGUAGE as U,CONTEXT_VARIABLE_NAME as H,CONTEXT_VARIABLE_TYPE as W,CONTEXT_VARIABLE_VALUE as G}from"../../../../debug/common/debug.js";import{NotebookVariableDataSource as Q}from"./notebookVariablesDataSource.js";import{NotebookVariableAccessibilityProvider as q,NotebookVariableRenderer as Y,NotebookVariablesDelegate as j}from"./notebookVariablesTree.js";import{getNotebookEditorFromEditorPane as u}from"../../notebookBrowser.js";import"../../../common/model/notebookTextModel.js";import{INotebookExecutionStateService as J}from"../../../common/notebookExecutionStateService.js";import{INotebookKernelService as Z}from"../../../common/notebookKernelService.js";import{IEditorService as $}from"../../../../../services/editor/common/editorService.js";import"../../../../../common/editor.js";import{isCompositeNotebookEditorInput as ee}from"../../../common/notebookEditorInput.js";let c=class extends X{constructor(t,e,o,n,a,d,m,h,p,b,I,te,oe,S,k,E,ie){super(t,a,d,h,m,b,p,I,S,k,E);this.editorService=e;this.notebookKernelService=o;this.notebookExecutionStateService=n;this.quickInputService=te;this.commandService=oe;this.menuService=ie;this._register(this.editorService.onDidActiveEditorChange(this.handleActiveEditorChange.bind(this))),this._register(this.notebookKernelService.onDidNotebookVariablesUpdate(this.handleVariablesChanged.bind(this))),this._register(this.notebookExecutionStateService.onDidChangeExecution(this.handleExecutionStateChange.bind(this))),this.activeNotebook=this.getActiveNotebook()?.notebookDocument,this.dataSource=new Q(this.notebookKernelService),this.updateScheduler=new N(()=>this.tree?.updateChildren(),100)}static ID="notebookVariablesView";static NOTEBOOK_TITLE=v.localize2("notebook.notebookVariables","Notebook Variables");static REPL_TITLE=v.localize2("notebook.ReplVariables","REPL Variables");tree;activeNotebook;dataSource;updateScheduler;renderBody(t){super.renderBody(t),this.element.classList.add("debug-pane"),this.tree=this.instantiationService.createInstance(_,"notebookVariablesTree",t,new j,[this.instantiationService.createInstance(Y)],this.dataSource,{accessibilityProvider:new q,identityProvider:{getId:e=>e.id}}),this.tree.layout(),this.activeNotebook&&this.tree.setInput({kind:"root",notebook:this.activeNotebook}),this._register(this.tree.onContextMenu(e=>this.onContextMenu(e)))}onContextMenu(t){if(!t.element)return;const e=t.element,o={source:e.notebook.uri.toString(),name:e.name,value:e.value,type:e.type,expression:e.expression,language:e.language,extensionId:e.extensionId},n=[],a=this.contextKeyService.createOverlay([[H.key,e.name],[G.key,e.value],[W.key,e.type],[F.key,e.interfaces],[U.key,e.language],[z.key,e.extensionId]]),d=this.menuService.getMenuActions(y.NotebookVariablesContext,a,{arg:o,shouldForwardArgs:!0});x(d,n),this.contextMenuService.showContextMenu({getAnchor:()=>t.anchor,getActions:()=>n})}layoutBody(t,e){super.layoutBody(t,e),this.tree?.layout(t,e)}setActiveNotebook(t,e){this.activeNotebook=t,this.tree?.setInput({kind:"root",notebook:t}),this.updateScheduler.schedule(),ee(e.input)?this.updateTitle(c.REPL_TITLE.value):this.updateTitle(c.NOTEBOOK_TITLE.value)}getActiveNotebook(){const t=this.editorService.activeEditorPane,e=u(t)?.textModel;return e&&t?{notebookDocument:e,notebookEditor:t}:void 0}handleActiveEditorChange(){const t=this.getActiveNotebook();t&&t.notebookDocument!==this.activeNotebook&&this.setActiveNotebook(t.notebookDocument,t.notebookEditor)}handleExecutionStateChange(t){this.activeNotebook&&t.affectsNotebook(this.activeNotebook.uri)?(this.dataSource.cancel(),t.changed===void 0?this.updateScheduler.schedule():this.updateScheduler.cancel()):this.getActiveNotebook()||this.editorService.visibleEditorPanes.forEach(e=>{const o=u(e)?.textModel;o&&t.affectsNotebook(o.uri)&&this.setActiveNotebook(o,e)})}handleVariablesChanged(t){this.activeNotebook&&t.toString()===this.activeNotebook.uri.toString()?this.updateScheduler.schedule():this.getActiveNotebook()||this.editorService.visibleEditorPanes.forEach(e=>{const o=u(e)?.textModel;o&&o.uri.toString()===t.toString()&&this.setActiveNotebook(o,e)})}};c=l([i(1,$),i(2,Z),i(3,J),i(4,D),i(5,V),i(6,M),i(7,C),i(8,O),i(9,w),i(10,P),i(11,R),i(12,T),i(13,K),i(14,B),i(15,L),i(16,A)],c);export{c as NotebookVariablesView};
