import"../../../../../../vs/base/common/actions.js";import"../../../../../../vs/base/common/jsonSchema.js";import{MarshalledId as y}from"../../../../../../vs/base/common/marshallingIds.js";import{isEqual as T}from"../../../../../../vs/base/common/resources.js";import"../../../../../../vs/base/common/types.js";import{URI as E}from"../../../../../../vs/base/common/uri.js";import"../../../../../../vs/editor/browser/editorBrowser.js";import{localize as C,localize2 as S}from"../../../../../../vs/nls.js";import{Action2 as x,MenuId as s,MenuRegistry as m}from"../../../../../../vs/platform/actions/common/actions.js";import{ContextKeyExpr as a}from"../../../../../../vs/platform/contextkey/common/contextkey.js";import"../../../../../../vs/platform/instantiation/common/instantiation.js";import{KeybindingWeight as p}from"../../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import{ITelemetryService as f}from"../../../../../../vs/platform/telemetry/common/telemetry.js";import{isEditorCommandsContext as O}from"../../../../../../vs/workbench/common/editor.js";import{cellRangeToViewCells as _,getNotebookEditorFromEditorPane as I}from"../../../../../../vs/workbench/contrib/notebook/browser/notebookBrowser.js";import{INotebookEditorService as M}from"../../../../../../vs/workbench/contrib/notebook/browser/services/notebookEditorService.js";import{INTERACTIVE_WINDOW_IS_ACTIVE_EDITOR as W,NOTEBOOK_EDITOR_EDITABLE as R,NOTEBOOK_EDITOR_FOCUSED as w,NOTEBOOK_IS_ACTIVE_EDITOR as k,NOTEBOOK_KERNEL_COUNT as U,NOTEBOOK_KERNEL_SOURCE_COUNT as F}from"../../../../../../vs/workbench/contrib/notebook/common/notebookContextKeys.js";import{isICellRange as g}from"../../../../../../vs/workbench/contrib/notebook/common/notebookRange.js";import{IEditorService as A}from"../../../../../../vs/workbench/services/editor/common/editorService.js";const Ie="_notebook.selectKernel",h=S("notebookActions.category","Notebook"),ke="inline/cell",ge="inline/output",he=p.EditorContrib,Ne=p.WorkbenchContrib+1;var L=(r=>(r[r.EditCell=0]="EditCell",r[r.ExecuteAboveCells=1]="ExecuteAboveCells",r[r.ExecuteCellAndBelow=2]="ExecuteCellAndBelow",r[r.SaveCell=3]="SaveCell",r[r.SplitCell=4]="SplitCell",r[r.ClearCellOutput=5]="ClearCellOutput",r))(L||{}),P=(i=>(i.Copy="1_copy",i.Insert="2_insert",i.Edit="3_edit",i.Share="4_share",i))(P||{});function N(n){const e=I(n.activeEditorPane);if(!e||!e.hasModel())return;const t=e.getActiveCell(),o=e.getSelectionViewModels();return{cell:t,selectedCells:o,notebookEditor:e}}function V(n,e){const o=n.get(M).listNotebookEditors().find(i=>i.hasModel()&&i.textModel.uri.toString()===e.toString());if(o&&o.hasModel())return o}function K(n,e){const t=E.revive(e);if(t){const o=V(n,t);if(o)return{notebookEditor:o}}}function ve(n,e){let t;for(const[,o]of n.notebookEditor.codeEditors)if(T(o.getModel()?.uri,e.uri)){t=o;break}return t}class D extends x{constructor(e){if(e.f1!==!1){e.f1=!1;const t={id:s.CommandPalette,when:a.or(k,W)};e.menu?Array.isArray(e.menu)||(e.menu=[e.menu]):e.menu=[],e.menu=[...e.menu,t]}e.category=h,super(e)}async run(e,t,...o){const l=!!t?this.isNotebookActionContext(t)?"notebookToolbar":"editorToolbar":void 0;if(!(!this.isNotebookActionContext(t)&&(t=this.getEditorContextFromArgsOrActive(e,t,...o),!t)))return l!==void 0&&e.get(f).publicLog2("workbenchActionExecuted",{id:this.desc.id,from:l}),this.runWithContext(e,t)}isNotebookActionContext(e){return!!e&&!!e.notebookEditor}getEditorContextFromArgsOrActive(e,t,...o){return N(e.get(A))}}class ye extends x{constructor(e){if(e.f1!==!1){e.f1=!1;const t={id:s.CommandPalette,when:k};e.menu?Array.isArray(e.menu)||(e.menu=[e.menu]):e.menu=[],e.menu=[...e.menu,t]}e.category=h,super(e)}parseArgs(e,...t){}isCellToolbarContext(e){return!!e&&!!e.notebookEditor&&e.$mid===y.NotebookCellActionContext}async run(e,...t){const o=t[0],i=this.isCellToolbarContext(o),l=O(o),r=i?"cellToolbar":l?"editorToolbar":"other",u=e.get(f);if(i)return u.publicLog2("workbenchActionExecuted",{id:this.desc.id,from:r}),this.runWithContext(e,o);const d=this.parseArgs(e,...t);if(d)return u.publicLog2("workbenchActionExecuted",{id:this.desc.id,from:r}),this.runWithContext(e,d);const c=b(e);if(c){const v=c.getSelections().length===0?[c.getFocus()]:c.getSelections();return u.publicLog2("workbenchActionExecuted",{id:this.desc.id,from:r}),this.runWithContext(e,{ui:!1,notebookEditor:c,selectedCells:_(c,v)})}}}class Te extends D{isCellActionContext(e){return!!e&&!!e.notebookEditor&&!!e.cell}getCellContextFromArgs(e,t,...o){}async run(e,t,...o){if(this.isCellActionContext(t))return e.get(f).publicLog2("workbenchActionExecuted",{id:this.desc.id,from:"cellToolbar"}),this.runWithContext(e,t);const i=this.getCellContextFromArgs(e,t,...o);if(i)return this.runWithContext(e,i);const l=this.getEditorContextFromArgsOrActive(e);if(this.isCellActionContext(l))return this.runWithContext(e,l)}}const Se=a.or(a.greater(U.key,0),a.greater(F.key,0));function B(n){if(n===void 0)return!1;const e=n.ranges;return!(!e||!Array.isArray(e)||e.some(t=>!g(t))||n.document&&!E.revive(n.document))}function b(n,e){const t=K(n,e)?.notebookEditor;if(t)return t;const o=I(n.get(A).activeEditorPane);if(!(!o||!o.hasModel()))return o}function Oe(n,...e){const t=e[0];if(B(t)){const i=b(n,t.document);if(!i)return;const r=t.ranges.map(d=>i.getCellsInRange(d).slice(0)).flat(),u=t.autoReveal;return{ui:!1,notebookEditor:i,selectedCells:r,autoReveal:u}}if(g(t)){const i=e[1],l=b(n,i);return l?{ui:!1,notebookEditor:l,selectedCells:l.getCellsInRange(t)}:void 0}const o=N(n.get(A));return o?{ui:!1,notebookEditor:o.notebookEditor,selectedCells:o.selectedCells??[],cell:o.cell}:void 0}const _e=[{isOptional:!0,name:"options",description:"The cell range options",schema:{type:"object",required:["ranges"],properties:{ranges:{type:"array",items:[{type:"object",required:["start","end"],properties:{start:{type:"number"},end:{type:"number"}}}]},document:{type:"object",description:"The document uri"},autoReveal:{type:"boolean",description:"Whether the cell should be revealed into view automatically"}}}}];m.appendMenuItem(s.NotebookCellTitle,{submenu:s.NotebookCellInsert,title:C("notebookMenu.insertCell","Insert Cell"),group:"2_insert",when:R.isEqualTo(!0)}),m.appendMenuItem(s.EditorContext,{submenu:s.NotebookCellTitle,title:C("notebookMenu.cellTitle","Notebook Cell"),group:"2_insert",when:w}),m.appendMenuItem(s.NotebookCellTitle,{title:C("miShare","Share"),submenu:s.EditorContextShare,group:"4_share"});export{ke as CELL_TITLE_CELL_GROUP_ID,ge as CELL_TITLE_OUTPUT_GROUP_ID,P as CellOverflowToolbarGroups,L as CellToolbarOrder,h as NOTEBOOK_ACTIONS_CATEGORY,he as NOTEBOOK_EDITOR_WIDGET_ACTION_WEIGHT,Ne as NOTEBOOK_OUTPUT_WEBVIEW_ACTION_WEIGHT,D as NotebookAction,Te as NotebookCellAction,ye as NotebookMultiCellAction,Ie as SELECT_KERNEL_ID,_e as cellExecutionArgs,Se as executeNotebookCondition,ve as findTargetCellEditor,N as getContextFromActiveEditor,K as getContextFromUri,b as getEditorFromArgsOrActivePane,Oe as parseMultiCellExecutionArgs};
