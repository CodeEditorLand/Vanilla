var _=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var m=(r,e,t,n)=>{for(var i=n>1?void 0:n?v(e,t):e,o=r.length-1,s;o>=0;o--)(s=r[o])&&(i=(n?s(e,t,i):s(i))||i);return n&&i&&_(e,t,i),i},c=(r,e)=>(t,n)=>e(t,n,r);import{ActionViewItem as y}from"../../../../../base/browser/ui/actionbar/actionViewItems.js";import{Action as K}from"../../../../../base/common/actions.js";import{ThemeIcon as T}from"../../../../../base/common/themables.js";import{localize as C,localize2 as A}from"../../../../../nls.js";import{Action2 as N,MenuId as p,registerAction2 as S}from"../../../../../platform/actions/common/actions.js";import{ContextKeyExpr as u}from"../../../../../platform/contextkey/common/contextkey.js";import{ExtensionIdentifier as x}from"../../../../../platform/extensions/common/extensions.js";import{IInstantiationService as L}from"../../../../../platform/instantiation/common/instantiation.js";import{IEditorService as O}from"../../../../services/editor/common/editorService.js";import{NOTEBOOK_IS_ACTIVE_EDITOR as f,NOTEBOOK_KERNEL_COUNT as M}from"../../common/notebookContextKeys.js";import{INotebookKernelHistoryService as D,INotebookKernelService as k}from"../../common/notebookKernelService.js";import{NOTEBOOK_ACTIONS_CATEGORY as P,SELECT_KERNEL_ID as w}from"../controller/coreActions.js";import{getNotebookEditorFromEditorPane as h}from"../notebookBrowser.js";import{selectKernelIcon as b}from"../notebookIcons.js";import{KernelPickerMRUStrategy as g}from"./notebookKernelQuickPickStrategy.js";function R(r,e){let t;if(e!==void 0&&"notebookEditorId"in e){const n=e.notebookEditorId,i=r.visibleEditorPanes.find(o=>h(o)?.getId()===n);t=h(i)}else e!==void 0&&"notebookEditor"in e?t=e?.notebookEditor:t=h(r.activeEditorPane);return t}S(class extends N{constructor(){super({id:w,category:P,title:A("notebookActions.selectKernel","Select Notebook Kernel"),icon:b,f1:!0,precondition:f,menu:[{id:p.EditorTitle,when:u.and(f,u.notEquals("config.notebook.globalToolbar",!0)),group:"navigation",order:-10},{id:p.NotebookToolbar,when:u.equals("config.notebook.globalToolbar",!0),group:"status",order:-10},{id:p.InteractiveToolbar,when:M.notEqualsTo(0),group:"status",order:-10}],metadata:{description:C("notebookActions.selectKernel.args","Notebook Kernel Args"),args:[{name:"kernelInfo",description:"The kernel info",schema:{type:"object",required:["id","extension"],properties:{id:{type:"string"},extension:{type:"string"},notebookEditorId:{type:"string"}}}}]}})}async run(r,e){const t=r.get(L),n=r.get(O),i=R(n,e);if(!i||!i.hasModel())return!1;let o=e&&"id"in e?e.id:void 0,s=e&&"extension"in e?e.extension:void 0;o&&(typeof o!="string"||typeof s!="string")&&(o=void 0,s=void 0);const a=i.textModel,E=r.get(k).getMatchingKernel(a),{selected:l}=E;if(l&&o&&l.id===o&&x.equals(l.extension,s))return!0;const I=o?`${s}/${o}`:void 0;return t.createInstance(g).showQuickPick(i,I)}});let d=class extends y{constructor(t,n,i,o,s){super(void 0,new K("fakeAction",void 0,T.asClassName(b),!0,a=>t.run(a)),{...i,label:!1,icon:!0});this._editor=n;this._notebookKernelService=o;this._notebookKernelHistoryService=s;this._register(n.onDidChangeModel(this._update,this)),this._register(o.onDidAddKernel(this._update,this)),this._register(o.onDidRemoveKernel(this._update,this)),this._register(o.onDidChangeNotebookAffinity(this._update,this)),this._register(o.onDidChangeSelectedNotebooks(this._update,this)),this._register(o.onDidChangeSourceActions(this._update,this)),this._register(o.onDidChangeKernelDetectionTasks(this._update,this))}_kernelLabel;render(t){this._update(),super.render(t),t.classList.add("kernel-action-view-item"),this._kernelLabel=document.createElement("a"),t.appendChild(this._kernelLabel),this.updateLabel()}updateLabel(){this._kernelLabel&&(this._kernelLabel.classList.add("kernel-label"),this._kernelLabel.innerText=this._action.label)}_update(){const t=this._editor.textModel;if(!t){this._resetAction();return}g.updateKernelStatusAction(t,this._action,this._notebookKernelService,this._notebookKernelHistoryService),this.updateClass()}_resetAction(){this._action.enabled=!1,this._action.label="",this._action.class=""}};d=m([c(3,k),c(4,D)],d);export{d as NotebooKernelActionViewItem};
