{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/execute/executionEditorProgress.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { throttle } from '../../../../../../base/common/decorators.js';\nimport { Disposable, MutableDisposable } from '../../../../../../base/common/lifecycle.js';\nimport { INotebookEditor, INotebookEditorContribution } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { NotebookCellExecutionState } from '../../../common/notebookCommon.js';\nimport { INotebookCellExecution, INotebookExecutionStateService } from '../../../common/notebookExecutionStateService.js';\nimport { IUserActivityService } from '../../../../../services/userActivity/common/userActivityService.js';\n\nexport class ExecutionEditorProgressController extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.executionEditorProgress';\n\n\tprivate readonly _activityMutex = this._register(new MutableDisposable());\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService,\n\t\t@IUserActivityService private readonly _userActivity: IUserActivityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(_notebookEditor.onDidScroll(() => this._update()));\n\n\t\tthis._register(_notebookExecutionStateService.onDidChangeExecution(e => {\n\t\t\tif (e.notebook.toString() !== this._notebookEditor.textModel?.uri.toString()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._update();\n\t\t}));\n\n\t\tthis._register(_notebookEditor.onDidChangeModel(() => this._update()));\n\t}\n\n\t@throttle(100)\n\tprivate _update() {\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cellExecutions = this._notebookExecutionStateService.getCellExecutionsForNotebook(this._notebookEditor.textModel?.uri)\n\t\t\t.filter(exe => exe.state === NotebookCellExecutionState.Executing);\n\t\tconst notebookExecution = this._notebookExecutionStateService.getExecution(this._notebookEditor.textModel?.uri);\n\t\tconst executionIsVisible = (exe: INotebookCellExecution) => {\n\t\t\tfor (const range of this._notebookEditor.visibleRanges) {\n\t\t\t\tfor (const cell of this._notebookEditor.getCellsInRange(range)) {\n\t\t\t\t\tif (cell.handle === exe.cellHandle) {\n\t\t\t\t\t\tconst top = this._notebookEditor.getAbsoluteTopOfElement(cell);\n\t\t\t\t\t\tif (this._notebookEditor.scrollTop < top + 5) {\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn false;\n\t\t};\n\n\t\tconst hasAnyExecution = cellExecutions.length || notebookExecution;\n\t\tif (hasAnyExecution && !this._activityMutex.value) {\n\t\t\tthis._activityMutex.value = this._userActivity.markActive();\n\t\t} else if (!hasAnyExecution && this._activityMutex.value) {\n\t\t\tthis._activityMutex.clear();\n\t\t}\n\n\t\tconst shouldShowEditorProgressbarForCellExecutions = cellExecutions.length && !cellExecutions.some(executionIsVisible) && !cellExecutions.some(e => e.isPaused);\n\t\tconst showEditorProgressBar = !!notebookExecution || shouldShowEditorProgressbarForCellExecutions;\n\t\tif (showEditorProgressBar) {\n\t\t\tthis._notebookEditor.showProgress();\n\t\t} else {\n\t\t\tthis._notebookEditor.hideProgress();\n\t\t}\n\t}\n}\n\n\nregisterNotebookContribution(ExecutionEditorProgressController.id, ExecutionEditorProgressController);\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,gBAAgB;AACzB,SAAS,YAAY,yBAAyB;AAC9C,SAAS,iBAAiB,mCAAmC;AAC7D,SAAS,oCAAoC;AAC7C,SAAS,kCAAkC;AAC3C,SAAS,wBAAwB,sCAAsC;AACvE,SAAS,4BAA4B;AAE9B,IAAM,oCAAN,cAAgD,WAAkD;AAAA,EAKxG,YACkB,iBACgC,gCACV,eACtC;AACD,UAAM;AAJW;AACgC;AACV;AAIvC,SAAK,UAAU,gBAAgB,YAAY,MAAM,KAAK,QAAQ,CAAC,CAAC;AAEhE,SAAK,UAAU,+BAA+B,qBAAqB,OAAK;AACvE,UAAI,EAAE,SAAS,SAAS,MAAM,KAAK,gBAAgB,WAAW,IAAI,SAAS,GAAG;AAC7E;AAAA,MACD;AAEA,WAAK,QAAQ;AAAA,IACd,CAAC,CAAC;AAEF,SAAK,UAAU,gBAAgB,iBAAiB,MAAM,KAAK,QAAQ,CAAC,CAAC;AAAA,EACtE;AAAA,EApCD,OAayG;AAAA;AAAA;AAAA,EACxG,OAAO,KAAa;AAAA,EAEH,iBAAiB,KAAK,UAAU,IAAI,kBAAkB,CAAC;AAAA,EAuBhE,UAAU;AACjB,QAAI,CAAC,KAAK,gBAAgB,SAAS,GAAG;AACrC;AAAA,IACD;AAEA,UAAM,iBAAiB,KAAK,+BAA+B,6BAA6B,KAAK,gBAAgB,WAAW,GAAG,EACzH,OAAO,SAAO,IAAI,UAAU,2BAA2B,SAAS;AAClE,UAAM,oBAAoB,KAAK,+BAA+B,aAAa,KAAK,gBAAgB,WAAW,GAAG;AAC9G,UAAM,qBAAqB,wBAAC,QAAgC;AAC3D,iBAAW,SAAS,KAAK,gBAAgB,eAAe;AACvD,mBAAW,QAAQ,KAAK,gBAAgB,gBAAgB,KAAK,GAAG;AAC/D,cAAI,KAAK,WAAW,IAAI,YAAY;AACnC,kBAAM,MAAM,KAAK,gBAAgB,wBAAwB,IAAI;AAC7D,gBAAI,KAAK,gBAAgB,YAAY,MAAM,GAAG;AAC7C,qBAAO;AAAA,YACR;AAAA,UACD;AAAA,QACD;AAAA,MACD;AAEA,aAAO;AAAA,IACR,GAb2B;AAe3B,UAAM,kBAAkB,eAAe,UAAU;AACjD,QAAI,mBAAmB,CAAC,KAAK,eAAe,OAAO;AAClD,WAAK,eAAe,QAAQ,KAAK,cAAc,WAAW;AAAA,IAC3D,WAAW,CAAC,mBAAmB,KAAK,eAAe,OAAO;AACzD,WAAK,eAAe,MAAM;AAAA,IAC3B;AAEA,UAAM,+CAA+C,eAAe,UAAU,CAAC,eAAe,KAAK,kBAAkB,KAAK,CAAC,eAAe,KAAK,OAAK,EAAE,QAAQ;AAC9J,UAAM,wBAAwB,CAAC,CAAC,qBAAqB;AACrD,QAAI,uBAAuB;AAC1B,WAAK,gBAAgB,aAAa;AAAA,IACnC,OAAO;AACN,WAAK,gBAAgB,aAAa;AAAA,IACnC;AAAA,EACD;AACD;AAtCS;AAAA,EADP,SAAS,GAAG;AAAA,GAzBD,kCA0BJ;AA1BI,oCAAN;AAAA,EAOJ;AAAA,EACA;AAAA,GARU;AAmEb,6BAA6B,kCAAkC,IAAI,iCAAiC;",
  "names": []
}
