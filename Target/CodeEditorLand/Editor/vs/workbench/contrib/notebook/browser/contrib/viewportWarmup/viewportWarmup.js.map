{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/viewportWarmup/viewportWarmup.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { RunOnceScheduler } from '../../../../../../base/common/async.js';\nimport { Disposable } from '../../../../../../base/common/lifecycle.js';\nimport { IAccessibilityService } from '../../../../../../platform/accessibility/common/accessibility.js';\nimport { CellEditState, IInsetRenderOutput, INotebookEditor, INotebookEditorContribution, INotebookEditorDelegate, RenderOutputType } from '../../notebookBrowser.js';\nimport { registerNotebookContribution } from '../../notebookEditorExtensions.js';\nimport { CodeCellViewModel, outputDisplayLimit } from '../../viewModel/codeCellViewModel.js';\nimport { CellKind } from '../../../common/notebookCommon.js';\nimport { cellRangesToIndexes } from '../../../common/notebookRange.js';\nimport { INotebookService } from '../../../common/notebookService.js';\n\nclass NotebookViewportContribution extends Disposable implements INotebookEditorContribution {\n\tstatic id: string = 'workbench.notebook.viewportWarmup';\n\tprivate readonly _warmupViewport: RunOnceScheduler;\n\tprivate readonly _warmupDocument: RunOnceScheduler | null = null;\n\n\tconstructor(\n\t\tprivate readonly _notebookEditor: INotebookEditor,\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t) {\n\t\tsuper();\n\n\t\tthis._warmupViewport = new RunOnceScheduler(() => this._warmupViewportNow(), 200);\n\t\tthis._register(this._warmupViewport);\n\t\tthis._register(this._notebookEditor.onDidScroll(() => {\n\t\t\tthis._warmupViewport.schedule();\n\t\t}));\n\n\t\tthis._warmupDocument = new RunOnceScheduler(() => this._warmupDocumentNow(), 200);\n\t\tthis._register(this._warmupDocument);\n\t\tthis._register(this._notebookEditor.onDidAttachViewModel(() => {\n\t\t\tif (this._notebookEditor.hasModel()) {\n\t\t\t\tthis._warmupDocument?.schedule();\n\t\t\t}\n\t\t}));\n\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tthis._warmupDocument?.schedule();\n\t\t}\n\t}\n\n\tprivate _warmupDocumentNow() {\n\t\tif (this._notebookEditor.hasModel()) {\n\t\t\tfor (let i = 0; i < this._notebookEditor.getLength(); i++) {\n\t\t\t\tconst cell = this._notebookEditor.cellAt(i);\n\n\t\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t\t// TODO@rebornix currently we disable markdown cell rendering in webview for accessibility\n\t\t\t\t\t// this._notebookEditor.createMarkupPreview(cell);\n\t\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _warmupViewportNow() {\n\t\tif (this._notebookEditor.isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst visibleRanges = this._notebookEditor.getVisibleRangesPlusViewportAboveAndBelow();\n\t\tcellRangesToIndexes(visibleRanges).forEach(index => {\n\t\t\tconst cell = this._notebookEditor.cellAt(index);\n\n\t\t\tif (cell?.cellKind === CellKind.Markup && cell?.getEditState() === CellEditState.Preview && !cell.isInputCollapsed) {\n\t\t\t\t(this._notebookEditor as INotebookEditorDelegate).createMarkupPreview(cell);\n\t\t\t} else if (cell?.cellKind === CellKind.Code) {\n\t\t\t\tthis._warmupCodeCell((cell as CodeCellViewModel));\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate _warmupCodeCell(viewCell: CodeCellViewModel) {\n\t\tif (viewCell.isOutputCollapsed) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputs = viewCell.outputsViewModels;\n\t\tfor (const output of outputs.slice(0, outputDisplayLimit)) {\n\t\t\tconst [mimeTypes, pick] = output.resolveMimeTypes(this._notebookEditor.textModel!, undefined);\n\t\t\tif (!mimeTypes.find(mimeType => mimeType.isTrusted) || mimeTypes.length === 0) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tconst pickedMimeTypeRenderer = mimeTypes[pick];\n\n\t\t\tif (!pickedMimeTypeRenderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._notebookEditor.hasModel()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst renderer = this._notebookService.getRendererInfo(pickedMimeTypeRenderer.rendererId);\n\n\t\t\tif (!renderer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst result: IInsetRenderOutput = { type: RenderOutputType.Extension, renderer, source: output, mimeType: pickedMimeTypeRenderer.mimeType };\n\t\t\tthis._notebookEditor.createOutput(viewCell, result, 0, true);\n\t\t}\n\n\t}\n}\n\nregisterNotebookContribution(NotebookViewportContribution.id, NotebookViewportContribution);\n"],
  "mappings": "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",
  "names": []
}
