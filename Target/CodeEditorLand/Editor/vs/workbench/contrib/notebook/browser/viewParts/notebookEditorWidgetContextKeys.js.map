{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/viewParts/notebookEditorWidgetContextKeys.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from '../../../../../base/browser/dom.js';\nimport { DisposableStore, dispose, IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IContextKey, IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { ICellViewModel, INotebookEditorDelegate, KERNEL_EXTENSIONS } from '../notebookBrowser.js';\nimport { NOTEBOOK_CELL_TOOLBAR_LOCATION, NOTEBOOK_HAS_OUTPUTS, NOTEBOOK_HAS_RUNNING_CELL, NOTEBOOK_HAS_SOMETHING_RUNNING, NOTEBOOK_INTERRUPTIBLE_KERNEL, NOTEBOOK_KERNEL, NOTEBOOK_KERNEL_COUNT, NOTEBOOK_KERNEL_SELECTED, NOTEBOOK_KERNEL_SOURCE_COUNT, NOTEBOOK_LAST_CELL_FAILED, NOTEBOOK_MISSING_KERNEL_EXTENSION, NOTEBOOK_USE_CONSOLIDATED_OUTPUT_BUTTON, NOTEBOOK_VIEW_TYPE } from '../../common/notebookContextKeys.js';\nimport { ICellExecutionStateChangedEvent, IExecutionStateChangedEvent, INotebookExecutionStateService, INotebookFailStateChangedEvent, NotebookExecutionType } from '../../common/notebookExecutionStateService.js';\nimport { INotebookKernelService } from '../../common/notebookKernelService.js';\nimport { IExtensionService } from '../../../../services/extensions/common/extensions.js';\n\nexport class NotebookEditorContextKeys {\n\n\tprivate readonly _notebookKernel: IContextKey<string>;\n\tprivate readonly _notebookKernelCount: IContextKey<number>;\n\tprivate readonly _notebookKernelSourceCount: IContextKey<number>;\n\tprivate readonly _notebookKernelSelected: IContextKey<boolean>;\n\tprivate readonly _interruptibleKernel: IContextKey<boolean>;\n\tprivate readonly _someCellRunning: IContextKey<boolean>;\n\tprivate readonly _kernelRunning: IContextKey<boolean>;\n\tprivate readonly _hasOutputs: IContextKey<boolean>;\n\tprivate readonly _useConsolidatedOutputButton: IContextKey<boolean>;\n\tprivate readonly _viewType!: IContextKey<string>;\n\tprivate readonly _missingKernelExtension: IContextKey<boolean>;\n\tprivate readonly _cellToolbarLocation: IContextKey<'left' | 'right' | 'hidden'>;\n\tprivate readonly _lastCellFailed: IContextKey<boolean>;\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _viewModelDisposables = new DisposableStore();\n\tprivate readonly _cellOutputsListeners: IDisposable[] = [];\n\tprivate readonly _selectedKernelDisposables = new DisposableStore();\n\n\tconstructor(\n\t\tprivate readonly _editor: INotebookEditorDelegate,\n\t\t@INotebookKernelService private readonly _notebookKernelService: INotebookKernelService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IExtensionService private readonly _extensionService: IExtensionService,\n\t\t@INotebookExecutionStateService private readonly _notebookExecutionStateService: INotebookExecutionStateService\n\t) {\n\t\tthis._notebookKernel = NOTEBOOK_KERNEL.bindTo(contextKeyService);\n\t\tthis._notebookKernelCount = NOTEBOOK_KERNEL_COUNT.bindTo(contextKeyService);\n\t\tthis._notebookKernelSelected = NOTEBOOK_KERNEL_SELECTED.bindTo(contextKeyService);\n\t\tthis._interruptibleKernel = NOTEBOOK_INTERRUPTIBLE_KERNEL.bindTo(contextKeyService);\n\t\tthis._someCellRunning = NOTEBOOK_HAS_RUNNING_CELL.bindTo(contextKeyService);\n\t\tthis._kernelRunning = NOTEBOOK_HAS_SOMETHING_RUNNING.bindTo(contextKeyService);\n\t\tthis._useConsolidatedOutputButton = NOTEBOOK_USE_CONSOLIDATED_OUTPUT_BUTTON.bindTo(contextKeyService);\n\t\tthis._hasOutputs = NOTEBOOK_HAS_OUTPUTS.bindTo(contextKeyService);\n\t\tthis._viewType = NOTEBOOK_VIEW_TYPE.bindTo(contextKeyService);\n\t\tthis._missingKernelExtension = NOTEBOOK_MISSING_KERNEL_EXTENSION.bindTo(contextKeyService);\n\t\tthis._notebookKernelSourceCount = NOTEBOOK_KERNEL_SOURCE_COUNT.bindTo(contextKeyService);\n\t\tthis._cellToolbarLocation = NOTEBOOK_CELL_TOOLBAR_LOCATION.bindTo(contextKeyService);\n\t\tthis._lastCellFailed = NOTEBOOK_LAST_CELL_FAILED.bindTo(contextKeyService);\n\n\t\tthis._handleDidChangeModel();\n\t\tthis._updateForNotebookOptions();\n\n\t\tthis._disposables.add(_editor.onDidChangeModel(this._handleDidChangeModel, this));\n\t\tthis._disposables.add(_notebookKernelService.onDidAddKernel(this._updateKernelContext, this));\n\t\tthis._disposables.add(_notebookKernelService.onDidChangeSelectedNotebooks(this._updateKernelContext, this));\n\t\tthis._disposables.add(_notebookKernelService.onDidChangeSourceActions(this._updateKernelContext, this));\n\t\tthis._disposables.add(_editor.notebookOptions.onDidChangeOptions(this._updateForNotebookOptions, this));\n\t\tthis._disposables.add(_extensionService.onDidChangeExtensions(this._updateForInstalledExtension, this));\n\t\tthis._disposables.add(_notebookExecutionStateService.onDidChangeExecution(this._updateForExecution, this));\n\t\tthis._disposables.add(_notebookExecutionStateService.onDidChangeLastRunFailState(this._updateForLastRunFailState, this));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._viewModelDisposables.dispose();\n\t\tthis._notebookKernelCount.reset();\n\t\tthis._notebookKernelSourceCount.reset();\n\t\tthis._interruptibleKernel.reset();\n\t\tthis._someCellRunning.reset();\n\t\tthis._kernelRunning.reset();\n\t\tthis._viewType.reset();\n\t\tdispose(this._cellOutputsListeners);\n\t\tthis._cellOutputsListeners.length = 0;\n\t}\n\n\tprivate _handleDidChangeModel(): void {\n\n\t\tthis._updateKernelContext();\n\t\tthis._updateForNotebookOptions();\n\n\t\tthis._viewModelDisposables.clear();\n\t\tdispose(this._cellOutputsListeners);\n\t\tthis._cellOutputsListeners.length = 0;\n\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst recomputeOutputsExistence = () => {\n\t\t\tlet hasOutputs = false;\n\t\t\tif (this._editor.hasModel()) {\n\t\t\t\tfor (let i = 0; i < this._editor.getLength(); i++) {\n\t\t\t\t\tif (this._editor.cellAt(i).outputsViewModels.length > 0) {\n\t\t\t\t\t\thasOutputs = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis._hasOutputs.set(hasOutputs);\n\t\t};\n\n\t\tconst layoutDisposable = this._viewModelDisposables.add(new DisposableStore());\n\n\t\tconst addCellOutputsListener = (c: ICellViewModel) => {\n\t\t\treturn c.model.onDidChangeOutputs(() => {\n\t\t\t\tlayoutDisposable.clear();\n\n\t\t\t\tlayoutDisposable.add(DOM.scheduleAtNextAnimationFrame(DOM.getWindow(this._editor.getDomNode()), () => {\n\t\t\t\t\trecomputeOutputsExistence();\n\t\t\t\t}));\n\t\t\t});\n\t\t};\n\n\t\tfor (let i = 0; i < this._editor.getLength(); i++) {\n\t\t\tconst cell = this._editor.cellAt(i);\n\t\t\tthis._cellOutputsListeners.push(addCellOutputsListener(cell));\n\t\t}\n\n\t\trecomputeOutputsExistence();\n\t\tthis._updateForInstalledExtension();\n\n\t\tthis._viewModelDisposables.add(this._editor.onDidChangeViewCells(e => {\n\t\t\t[...e.splices].reverse().forEach(splice => {\n\t\t\t\tconst [start, deleted, newCells] = splice;\n\t\t\t\tconst deletedCellOutputStates = this._cellOutputsListeners.splice(start, deleted, ...newCells.map(addCellOutputsListener));\n\t\t\t\tdispose(deletedCellOutputStates);\n\t\t\t});\n\t\t}));\n\t\tthis._viewType.set(this._editor.textModel.viewType);\n\t}\n\tprivate _updateForExecution(e: ICellExecutionStateChangedEvent | IExecutionStateChangedEvent): void {\n\t\tif (this._editor.textModel) {\n\t\t\tconst notebookExe = this._notebookExecutionStateService.getExecution(this._editor.textModel.uri);\n\t\t\tconst notebookCellExe = this._notebookExecutionStateService.getCellExecutionsForNotebook(this._editor.textModel.uri);\n\t\t\tthis._kernelRunning.set(notebookCellExe.length > 0 || !!notebookExe);\n\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\tthis._someCellRunning.set(notebookCellExe.length > 0);\n\t\t\t}\n\t\t} else {\n\t\t\tthis._kernelRunning.set(false);\n\t\t\tif (e.type === NotebookExecutionType.cell) {\n\t\t\t\tthis._someCellRunning.set(false);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _updateForLastRunFailState(e: INotebookFailStateChangedEvent): void {\n\t\tif (e.notebook === this._editor.textModel?.uri) {\n\t\t\tthis._lastCellFailed.set(e.visible);\n\t\t}\n\t}\n\n\tprivate async _updateForInstalledExtension(): Promise<void> {\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst viewType = this._editor.textModel.viewType;\n\t\tconst kernelExtensionId = KERNEL_EXTENSIONS.get(viewType);\n\t\tthis._missingKernelExtension.set(\n\t\t\t!!kernelExtensionId && !(await this._extensionService.getExtension(kernelExtensionId)));\n\t}\n\n\tprivate _updateKernelContext(): void {\n\t\tif (!this._editor.hasModel()) {\n\t\t\tthis._notebookKernelCount.reset();\n\t\t\tthis._notebookKernelSourceCount.reset();\n\t\t\tthis._interruptibleKernel.reset();\n\t\t\treturn;\n\t\t}\n\n\t\tconst { selected, all } = this._notebookKernelService.getMatchingKernel(this._editor.textModel);\n\t\tconst sourceActions = this._notebookKernelService.getSourceActions(this._editor.textModel, this._editor.scopedContextKeyService);\n\t\tthis._notebookKernelCount.set(all.length);\n\t\tthis._notebookKernelSourceCount.set(sourceActions.length);\n\t\tthis._interruptibleKernel.set(selected?.implementsInterrupt ?? false);\n\t\tthis._notebookKernelSelected.set(Boolean(selected));\n\t\tthis._notebookKernel.set(selected?.id ?? '');\n\n\t\tthis._selectedKernelDisposables.clear();\n\t\tif (selected) {\n\t\t\tthis._selectedKernelDisposables.add(selected.onDidChange(() => {\n\t\t\t\tthis._interruptibleKernel.set(selected?.implementsInterrupt ?? false);\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate _updateForNotebookOptions(): void {\n\t\tconst layout = this._editor.notebookOptions.getDisplayOptions();\n\t\tthis._useConsolidatedOutputButton.set(layout.consolidatedOutputButton);\n\t\tthis._cellToolbarLocation.set(this._editor.notebookOptions.computeCellToolbarLocation(this._editor.textModel?.viewType));\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
