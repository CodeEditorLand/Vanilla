{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/services/notebookKernelServiceImpl.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tgetActiveWindow,\n\trunWhenWindowIdle,\n} from \"../../../../../base/browser/dom.js\";\nimport type { IAction } from \"../../../../../base/common/actions.js\";\nimport { Emitter, type Event } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { LRUCache, ResourceMap } from \"../../../../../base/common/map.js\";\nimport { MarshalledId } from \"../../../../../base/common/marshallingIds.js\";\nimport { Schemas } from \"../../../../../base/common/network.js\";\nimport { URI } from \"../../../../../base/common/uri.js\";\nimport {\n\ttype IMenu,\n\tIMenuService,\n\tMenuId,\n} from \"../../../../../platform/actions/common/actions.js\";\nimport { IContextKeyService } from \"../../../../../platform/contextkey/common/contextkey.js\";\nimport {\n\tIStorageService,\n\tStorageScope,\n\tStorageTarget,\n} from \"../../../../../platform/storage/common/storage.js\";\nimport type {\n\tINotebookKernelSourceAction,\n\tINotebookTextModel,\n} from \"../../common/notebookCommon.js\";\nimport type {\n\tIKernelSourceActionProvider,\n\tINotebookKernel,\n\tINotebookKernelDetectionTask,\n\tINotebookKernelMatchResult,\n\tINotebookKernelService,\n\tINotebookSourceActionChangeEvent,\n\tINotebookTextModelLike,\n\tISelectedNotebooksChangeEvent,\n\tISourceAction,\n} from \"../../common/notebookKernelService.js\";\nimport { INotebookService } from \"../../common/notebookService.js\";\n\nclass KernelInfo {\n\tprivate static _logicClock = 0;\n\n\treadonly kernel: INotebookKernel;\n\tpublic score: number;\n\treadonly time: number;\n\n\treadonly notebookPriorities = new ResourceMap<number>();\n\n\tconstructor(kernel: INotebookKernel) {\n\t\tthis.kernel = kernel;\n\t\tthis.score = -1;\n\t\tthis.time = KernelInfo._logicClock++;\n\t}\n}\n\nclass NotebookTextModelLikeId {\n\tstatic str(k: INotebookTextModelLike): string {\n\t\treturn `${k.notebookType}/${k.uri.toString()}`;\n\t}\n\tstatic obj(s: string): INotebookTextModelLike {\n\t\tconst idx = s.indexOf(\"/\");\n\t\treturn {\n\t\t\tnotebookType: s.substring(0, idx),\n\t\t\turi: URI.parse(s.substring(idx + 1)),\n\t\t};\n\t}\n}\n\nclass SourceAction extends Disposable implements ISourceAction {\n\texecution: Promise<void> | undefined;\n\tprivate readonly _onDidChangeState = this._register(new Emitter<void>());\n\treadonly onDidChangeState = this._onDidChangeState.event;\n\n\tconstructor(\n\t\treadonly action: IAction,\n\t\treadonly model: INotebookTextModelLike,\n\t\treadonly isPrimary: boolean,\n\t) {\n\t\tsuper();\n\t}\n\n\tasync runAction() {\n\t\tif (this.execution) {\n\t\t\treturn this.execution;\n\t\t}\n\n\t\tthis.execution = this._runAction();\n\t\tthis._onDidChangeState.fire();\n\t\tawait this.execution;\n\t\tthis.execution = undefined;\n\t\tthis._onDidChangeState.fire();\n\t}\n\n\tprivate async _runAction(): Promise<void> {\n\t\ttry {\n\t\t\tawait this.action.run({\n\t\t\t\turi: this.model.uri,\n\t\t\t\t$mid: MarshalledId.NotebookActionContext,\n\t\t\t});\n\t\t} catch (error) {\n\t\t\tconsole.warn(`Kernel source command failed: ${error}`);\n\t\t}\n\t}\n}\n\ninterface IKernelInfoCache {\n\tmenu: IMenu;\n\tactions: [ISourceAction, IDisposable][];\n}\n\nexport class NotebookKernelService\n\textends Disposable\n\timplements INotebookKernelService\n{\n\tdeclare _serviceBrand: undefined;\n\n\tprivate readonly _kernels = new Map<string, KernelInfo>();\n\n\tprivate readonly _notebookBindings = new LRUCache<string, string>(\n\t\t1000,\n\t\t0.7,\n\t);\n\n\tprivate readonly _onDidChangeNotebookKernelBinding = this._register(\n\t\tnew Emitter<ISelectedNotebooksChangeEvent>(),\n\t);\n\tprivate readonly _onDidAddKernel = this._register(\n\t\tnew Emitter<INotebookKernel>(),\n\t);\n\tprivate readonly _onDidRemoveKernel = this._register(\n\t\tnew Emitter<INotebookKernel>(),\n\t);\n\tprivate readonly _onDidChangeNotebookAffinity = this._register(\n\t\tnew Emitter<void>(),\n\t);\n\tprivate readonly _onDidChangeSourceActions = this._register(\n\t\tnew Emitter<INotebookSourceActionChangeEvent>(),\n\t);\n\tprivate readonly _onDidNotebookVariablesChange = this._register(\n\t\tnew Emitter<URI>(),\n\t);\n\tprivate readonly _kernelSources = new Map<string, IKernelInfoCache>();\n\tprivate readonly _kernelSourceActionsUpdates = new Map<\n\t\tstring,\n\t\tIDisposable\n\t>();\n\tprivate readonly _kernelDetectionTasks = new Map<\n\t\tstring,\n\t\tINotebookKernelDetectionTask[]\n\t>();\n\tprivate readonly _onDidChangeKernelDetectionTasks = this._register(\n\t\tnew Emitter<string>(),\n\t);\n\tprivate readonly _kernelSourceActionProviders = new Map<\n\t\tstring,\n\t\tIKernelSourceActionProvider[]\n\t>();\n\n\treadonly onDidChangeSelectedNotebooks: Event<ISelectedNotebooksChangeEvent> =\n\t\tthis._onDidChangeNotebookKernelBinding.event;\n\treadonly onDidAddKernel: Event<INotebookKernel> =\n\t\tthis._onDidAddKernel.event;\n\treadonly onDidRemoveKernel: Event<INotebookKernel> =\n\t\tthis._onDidRemoveKernel.event;\n\treadonly onDidChangeNotebookAffinity: Event<void> =\n\t\tthis._onDidChangeNotebookAffinity.event;\n\treadonly onDidChangeSourceActions: Event<INotebookSourceActionChangeEvent> =\n\t\tthis._onDidChangeSourceActions.event;\n\treadonly onDidChangeKernelDetectionTasks: Event<string> =\n\t\tthis._onDidChangeKernelDetectionTasks.event;\n\treadonly onDidNotebookVariablesUpdate: Event<URI> =\n\t\tthis._onDidNotebookVariablesChange.event;\n\n\tprivate static _storageNotebookBinding =\n\t\t\"notebook.controller2NotebookBindings\";\n\n\tconstructor(\n\t\t@INotebookService private readonly _notebookService: INotebookService,\n\t\t@IStorageService private readonly _storageService: IStorageService,\n\t\t@IMenuService private readonly _menuService: IMenuService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService\n\t) {\n\t\tsuper();\n\n\t\t// auto associate kernels to new notebook documents, also emit event when\n\t\t// a notebook has been closed (but don't update the memento)\n\t\tthis._register(_notebookService.onDidAddNotebookDocument(this._tryAutoBindNotebook, this));\n\t\tthis._register(_notebookService.onWillRemoveNotebookDocument(notebook => {\n\t\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\t\tconst kernelId = this._notebookBindings.get(id);\n\t\t\tif (kernelId && notebook.uri.scheme === Schemas.untitled) {\n\t\t\t\tthis.selectKernelForNotebook(undefined, notebook);\n\t\t\t}\n\t\t\tthis._kernelSourceActionsUpdates.get(id)?.dispose();\n\t\t\tthis._kernelSourceActionsUpdates.delete(id);\n\t\t}));\n\n\t\t// restore from storage\n\t\ttry {\n\t\t\tconst data = JSON.parse(this._storageService.get(NotebookKernelService._storageNotebookBinding, StorageScope.WORKSPACE, '[]'));\n\t\t\tthis._notebookBindings.fromJSON(data);\n\t\t} catch {\n\t\t\t// ignore\n\t\t}\n\t}\n\n\toverride dispose() {\n\t\tthis._kernels.clear();\n\t\tthis._kernelSources.forEach((v) => {\n\t\t\tv.menu.dispose();\n\t\t\tv.actions.forEach((a) => a[1].dispose());\n\t\t});\n\t\tthis._kernelSourceActionsUpdates.forEach((v) => {\n\t\t\tv.dispose();\n\t\t});\n\t\tthis._kernelSourceActionsUpdates.clear();\n\t\tsuper.dispose();\n\t}\n\n\tprivate _persistSoonHandle?: IDisposable;\n\n\tprivate _persistMementos(): void {\n\t\tthis._persistSoonHandle?.dispose();\n\t\tthis._persistSoonHandle = runWhenWindowIdle(\n\t\t\tgetActiveWindow(),\n\t\t\t() => {\n\t\t\t\tthis._storageService.store(\n\t\t\t\t\tNotebookKernelService._storageNotebookBinding,\n\t\t\t\t\tJSON.stringify(this._notebookBindings),\n\t\t\t\t\tStorageScope.WORKSPACE,\n\t\t\t\t\tStorageTarget.MACHINE,\n\t\t\t\t);\n\t\t\t},\n\t\t\t100,\n\t\t);\n\t}\n\n\tprivate static _score(\n\t\tkernel: INotebookKernel,\n\t\tnotebook: INotebookTextModelLike,\n\t): number {\n\t\tif (kernel.viewType === \"*\") {\n\t\t\treturn 5;\n\t\t} else if (kernel.viewType === notebook.notebookType) {\n\t\t\treturn 10;\n\t\t} else {\n\t\t\treturn 0;\n\t\t}\n\t}\n\n\tprivate _tryAutoBindNotebook(\n\t\tnotebook: INotebookTextModel,\n\t\tonlyThisKernel?: INotebookKernel,\n\t): void {\n\t\tconst id = this._notebookBindings.get(\n\t\t\tNotebookTextModelLikeId.str(notebook),\n\t\t);\n\t\tif (!id) {\n\t\t\t// no kernel associated\n\t\t\treturn;\n\t\t}\n\t\tconst existingKernel = this._kernels.get(id);\n\t\tif (\n\t\t\t!existingKernel ||\n\t\t\t!NotebookKernelService._score(existingKernel.kernel, notebook)\n\t\t) {\n\t\t\t// associated kernel not known, not matching\n\t\t\treturn;\n\t\t}\n\t\tif (!onlyThisKernel || existingKernel.kernel === onlyThisKernel) {\n\t\t\tthis._onDidChangeNotebookKernelBinding.fire({\n\t\t\t\tnotebook: notebook.uri,\n\t\t\t\toldKernel: undefined,\n\t\t\t\tnewKernel: existingKernel.kernel.id,\n\t\t\t});\n\t\t}\n\t}\n\n\tnotifyVariablesChange(notebookUri: URI): void {\n\t\tthis._onDidNotebookVariablesChange.fire(notebookUri);\n\t}\n\n\tregisterKernel(kernel: INotebookKernel): IDisposable {\n\t\tif (this._kernels.has(kernel.id)) {\n\t\t\tthrow new Error(\n\t\t\t\t`NOTEBOOK CONTROLLER with id '${kernel.id}' already exists`,\n\t\t\t);\n\t\t}\n\n\t\tthis._kernels.set(kernel.id, new KernelInfo(kernel));\n\t\tthis._onDidAddKernel.fire(kernel);\n\n\t\t// auto associate the new kernel to existing notebooks it was\n\t\t// associated to in the past.\n\t\tfor (const notebook of this._notebookService.getNotebookTextModels()) {\n\t\t\tthis._tryAutoBindNotebook(notebook, kernel);\n\t\t}\n\n\t\treturn toDisposable(() => {\n\t\t\tif (this._kernels.delete(kernel.id)) {\n\t\t\t\tthis._onDidRemoveKernel.fire(kernel);\n\t\t\t}\n\t\t\tfor (const [key, candidate] of Array.from(this._notebookBindings)) {\n\t\t\t\tif (candidate === kernel.id) {\n\t\t\t\t\tthis._onDidChangeNotebookKernelBinding.fire({\n\t\t\t\t\t\tnotebook: NotebookTextModelLikeId.obj(key).uri,\n\t\t\t\t\t\toldKernel: kernel.id,\n\t\t\t\t\t\tnewKernel: undefined,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tgetMatchingKernel(\n\t\tnotebook: INotebookTextModelLike,\n\t): INotebookKernelMatchResult {\n\t\t// all applicable kernels\n\t\tconst kernels: {\n\t\t\tkernel: INotebookKernel;\n\t\t\tinstanceAffinity: number;\n\t\t\tscore: number;\n\t\t}[] = [];\n\t\tfor (const info of this._kernels.values()) {\n\t\t\tconst score = NotebookKernelService._score(info.kernel, notebook);\n\t\t\tif (score) {\n\t\t\t\tkernels.push({\n\t\t\t\t\tscore,\n\t\t\t\t\tkernel: info.kernel,\n\t\t\t\t\tinstanceAffinity:\n\t\t\t\t\t\tinfo.notebookPriorities.get(notebook.uri) ??\n\t\t\t\t\t\t1 /* vscode.NotebookControllerPriority.Default */,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tkernels.sort(\n\t\t\t(a, b) =>\n\t\t\t\tb.instanceAffinity - a.instanceAffinity ||\n\t\t\t\ta.score - b.score ||\n\t\t\t\ta.kernel.label.localeCompare(b.kernel.label),\n\t\t);\n\t\tconst all = kernels.map((obj) => obj.kernel);\n\n\t\t// bound kernel\n\t\tconst selectedId = this._notebookBindings.get(\n\t\t\tNotebookTextModelLikeId.str(notebook),\n\t\t);\n\t\tconst selected = selectedId\n\t\t\t? this._kernels.get(selectedId)?.kernel\n\t\t\t: undefined;\n\t\tconst suggestions = kernels\n\t\t\t.filter((item) => item.instanceAffinity > 1)\n\t\t\t.map((item) => item.kernel);\n\t\tconst hidden = kernels\n\t\t\t.filter((item) => item.instanceAffinity < 0)\n\t\t\t.map((item) => item.kernel);\n\t\treturn { all, selected, suggestions, hidden };\n\t}\n\n\tgetSelectedOrSuggestedKernel(\n\t\tnotebook: INotebookTextModel,\n\t): INotebookKernel | undefined {\n\t\tconst info = this.getMatchingKernel(notebook);\n\t\tif (info.selected) {\n\t\t\treturn info.selected;\n\t\t}\n\n\t\tconst preferred = info.all.filter(\n\t\t\t(kernel) =>\n\t\t\t\tthis._kernels\n\t\t\t\t\t.get(kernel.id)\n\t\t\t\t\t?.notebookPriorities.get(notebook.uri) ===\n\t\t\t\t2 /* vscode.NotebookControllerPriority.Preferred */,\n\t\t);\n\t\tif (preferred.length === 1) {\n\t\t\treturn preferred[0];\n\t\t}\n\n\t\treturn info.all.length === 1 ? info.all[0] : undefined;\n\t}\n\n\t// a notebook has one kernel, a kernel has N notebooks\n\t// notebook <-1----N-> kernel\n\tselectKernelForNotebook(\n\t\tkernel: INotebookKernel | undefined,\n\t\tnotebook: INotebookTextModelLike,\n\t): void {\n\t\tconst key = NotebookTextModelLikeId.str(notebook);\n\t\tconst oldKernel = this._notebookBindings.get(key);\n\t\tif (oldKernel !== kernel?.id) {\n\t\t\tif (kernel) {\n\t\t\t\tthis._notebookBindings.set(key, kernel.id);\n\t\t\t} else {\n\t\t\t\tthis._notebookBindings.delete(key);\n\t\t\t}\n\t\t\tthis._onDidChangeNotebookKernelBinding.fire({\n\t\t\t\tnotebook: notebook.uri,\n\t\t\t\toldKernel,\n\t\t\t\tnewKernel: kernel?.id,\n\t\t\t});\n\t\t\tthis._persistMementos();\n\t\t}\n\t}\n\n\tpreselectKernelForNotebook(\n\t\tkernel: INotebookKernel,\n\t\tnotebook: INotebookTextModelLike,\n\t): void {\n\t\tconst key = NotebookTextModelLikeId.str(notebook);\n\t\tconst oldKernel = this._notebookBindings.get(key);\n\t\tif (oldKernel !== kernel?.id) {\n\t\t\tthis._notebookBindings.set(key, kernel.id);\n\t\t\tthis._persistMementos();\n\t\t}\n\t}\n\n\tupdateKernelNotebookAffinity(\n\t\tkernel: INotebookKernel,\n\t\tnotebook: URI,\n\t\tpreference: number | undefined,\n\t): void {\n\t\tconst info = this._kernels.get(kernel.id);\n\t\tif (!info) {\n\t\t\tthrow new Error(`UNKNOWN kernel '${kernel.id}'`);\n\t\t}\n\t\tif (preference === undefined) {\n\t\t\tinfo.notebookPriorities.delete(notebook);\n\t\t} else {\n\t\t\tinfo.notebookPriorities.set(notebook, preference);\n\t\t}\n\t\tthis._onDidChangeNotebookAffinity.fire();\n\t}\n\n\tgetRunningSourceActions(notebook: INotebookTextModelLike) {\n\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\tconst existingInfo = this._kernelSources.get(id);\n\t\tif (existingInfo) {\n\t\t\treturn existingInfo.actions\n\t\t\t\t.filter((action) => action[0].execution)\n\t\t\t\t.map((action) => action[0]);\n\t\t}\n\n\t\treturn [];\n\t}\n\n\tgetSourceActions(\n\t\tnotebook: INotebookTextModelLike,\n\t\tcontextKeyService: IContextKeyService | undefined,\n\t): ISourceAction[] {\n\t\tcontextKeyService = contextKeyService ?? this._contextKeyService;\n\t\tconst id = NotebookTextModelLikeId.str(notebook);\n\t\tconst existingInfo = this._kernelSources.get(id);\n\n\t\tif (existingInfo) {\n\t\t\treturn existingInfo.actions.map((a) => a[0]);\n\t\t}\n\n\t\tconst sourceMenu = this._register(\n\t\t\tthis._menuService.createMenu(\n\t\t\t\tMenuId.NotebookKernelSource,\n\t\t\t\tcontextKeyService,\n\t\t\t),\n\t\t);\n\t\tconst info: IKernelInfoCache = { menu: sourceMenu, actions: [] };\n\n\t\tconst loadActionsFromMenu = (\n\t\t\tmenu: IMenu,\n\t\t\tdocument: INotebookTextModelLike,\n\t\t) => {\n\t\t\tconst groups = menu.getActions({ shouldForwardArgs: true });\n\t\t\tconst sourceActions: [ISourceAction, IDisposable][] = [];\n\t\t\tgroups.forEach((group) => {\n\t\t\t\tconst isPrimary = /^primary/.test(group[0]);\n\t\t\t\tgroup[1].forEach((action) => {\n\t\t\t\t\tconst sourceAction = new SourceAction(\n\t\t\t\t\t\taction,\n\t\t\t\t\t\tdocument,\n\t\t\t\t\t\tisPrimary,\n\t\t\t\t\t);\n\t\t\t\t\tconst stateChangeListener = sourceAction.onDidChangeState(\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis._onDidChangeSourceActions.fire({\n\t\t\t\t\t\t\t\tnotebook: document.uri,\n\t\t\t\t\t\t\t\tviewType: document.notebookType,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t},\n\t\t\t\t\t);\n\t\t\t\t\tsourceActions.push([sourceAction, stateChangeListener]);\n\t\t\t\t});\n\t\t\t});\n\t\t\tinfo.actions = sourceActions;\n\t\t\tthis._kernelSources.set(id, info);\n\t\t\tthis._onDidChangeSourceActions.fire({\n\t\t\t\tnotebook: document.uri,\n\t\t\t\tviewType: document.notebookType,\n\t\t\t});\n\t\t};\n\n\t\tthis._kernelSourceActionsUpdates.get(id)?.dispose();\n\t\tthis._kernelSourceActionsUpdates.set(\n\t\t\tid,\n\t\t\tsourceMenu.onDidChange(() => {\n\t\t\t\tloadActionsFromMenu(sourceMenu, notebook);\n\t\t\t}),\n\t\t);\n\n\t\tloadActionsFromMenu(sourceMenu, notebook);\n\n\t\treturn info.actions.map((a) => a[0]);\n\t}\n\n\tregisterNotebookKernelDetectionTask(\n\t\ttask: INotebookKernelDetectionTask,\n\t): IDisposable {\n\t\tconst notebookType = task.notebookType;\n\t\tconst all = this._kernelDetectionTasks.get(notebookType) ?? [];\n\t\tall.push(task);\n\t\tthis._kernelDetectionTasks.set(notebookType, all);\n\t\tthis._onDidChangeKernelDetectionTasks.fire(notebookType);\n\t\treturn toDisposable(() => {\n\t\t\tconst all = this._kernelDetectionTasks.get(notebookType) ?? [];\n\t\t\tconst idx = all.indexOf(task);\n\t\t\tif (idx >= 0) {\n\t\t\t\tall.splice(idx, 1);\n\t\t\t\tthis._kernelDetectionTasks.set(notebookType, all);\n\t\t\t\tthis._onDidChangeKernelDetectionTasks.fire(notebookType);\n\t\t\t}\n\t\t});\n\t}\n\n\tgetKernelDetectionTasks(\n\t\tnotebook: INotebookTextModelLike,\n\t): INotebookKernelDetectionTask[] {\n\t\treturn this._kernelDetectionTasks.get(notebook.notebookType) ?? [];\n\t}\n\n\tregisterKernelSourceActionProvider(\n\t\tviewType: string,\n\t\tprovider: IKernelSourceActionProvider,\n\t): IDisposable {\n\t\tconst providers = this._kernelSourceActionProviders.get(viewType) ?? [];\n\t\tproviders.push(provider);\n\t\tthis._kernelSourceActionProviders.set(viewType, providers);\n\t\tthis._onDidChangeSourceActions.fire({ viewType: viewType });\n\n\t\tconst eventEmitterDisposable = provider.onDidChangeSourceActions?.(\n\t\t\t() => {\n\t\t\t\tthis._onDidChangeSourceActions.fire({ viewType: viewType });\n\t\t\t},\n\t\t);\n\n\t\treturn toDisposable(() => {\n\t\t\tconst providers =\n\t\t\t\tthis._kernelSourceActionProviders.get(viewType) ?? [];\n\t\t\tconst idx = providers.indexOf(provider);\n\t\t\tif (idx >= 0) {\n\t\t\t\tproviders.splice(idx, 1);\n\t\t\t\tthis._kernelSourceActionProviders.set(viewType, providers);\n\t\t\t}\n\n\t\t\teventEmitterDisposable?.dispose();\n\t\t});\n\t}\n\n\t/**\n\t * Get kernel source actions from providers\n\t */\n\tgetKernelSourceActions2(\n\t\tnotebook: INotebookTextModelLike,\n\t): Promise<INotebookKernelSourceAction[]> {\n\t\tconst viewType = notebook.notebookType;\n\t\tconst providers = this._kernelSourceActionProviders.get(viewType) ?? [];\n\t\tconst promises = providers.map((provider) =>\n\t\t\tprovider.provideKernelSourceActions(),\n\t\t);\n\t\treturn Promise.all(promises).then((actions) => {\n\t\t\treturn actions.reduce((a, b) => a.concat(b), []);\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": ["all", "providers"]
}
