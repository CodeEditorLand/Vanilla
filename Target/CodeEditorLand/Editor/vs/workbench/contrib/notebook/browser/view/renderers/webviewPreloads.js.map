{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { Event } from '../../../../../../base/common/event.js';\nimport type { IDisposable } from '../../../../../../base/common/lifecycle.js';\nimport type * as webviewMessages from './webviewMessages.js';\nimport type { NotebookCellMetadata } from '../../../common/notebookCommon.js';\nimport type * as rendererApi from 'vscode-notebook-renderer';\n\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n// import { RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\n// We can ONLY IMPORT as type in this module. This also applies to const enums that would evaporate\n// in normal compiles but remain a dependency in transpile-only compiles\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n\n// !! IMPORTANT !! everything must be in-line within the webviewPreloads\n// function. Imports are not allowed. This is stringified and injected into\n// the webview.\n\ndeclare module globalThis {\n\tconst acquireVsCodeApi: () => ({\n\t\tgetState(): { [key: string]: unknown };\n\t\tsetState(data: { [key: string]: unknown }): void;\n\t\tpostMessage: (msg: unknown) => void;\n\t});\n}\n\ndeclare class ResizeObserver {\n\tconstructor(onChange: (entries: { target: HTMLElement; contentRect?: ClientRect }[]) => void);\n\tobserve(element: Element): void;\n\tdisconnect(): void;\n}\n\ndeclare class Highlight {\n\tconstructor();\n\tadd(range: AbstractRange): void;\n\tclear(): void;\n\tpriority: number;\n}\n\ninterface CSSHighlights {\n\tset(rule: string, highlight: Highlight): void;\n}\ndeclare namespace CSS {\n\tlet highlights: CSSHighlights | undefined;\n}\n\n\ntype Listener<T> = { fn: (evt: T) => void; thisArg: unknown };\n\ninterface EmitterLike<T> {\n\tfire(data: T): void;\n\tevent: Event<T>;\n}\n\ninterface PreloadStyles {\n\treadonly outputNodePadding: number;\n\treadonly outputNodeLeftPadding: number;\n\treadonly tokenizationCss: string;\n}\n\nexport interface PreloadOptions {\n\tdragAndDropEnabled: boolean;\n}\n\nexport interface RenderOptions {\n\treadonly lineLimit: number;\n\treadonly outputScrolling: boolean;\n\treadonly outputWordWrap: boolean;\n\treadonly linkifyFilePaths: boolean;\n\treadonly minimalError: boolean;\n}\n\ninterface PreloadContext {\n\treadonly nonce: string;\n\treadonly style: PreloadStyles;\n\treadonly options: PreloadOptions;\n\treadonly renderOptions: RenderOptions;\n\treadonly rendererData: readonly webviewMessages.RendererMetadata[];\n\treadonly staticPreloadsData: readonly webviewMessages.StaticPreloadMetadata[];\n\treadonly isWorkspaceTrusted: boolean;\n}\n\ndeclare function requestIdleCallback(callback: (args: IdleDeadline) => void, options?: { timeout: number }): number;\ndeclare function cancelIdleCallback(handle: number): void;\n\ndeclare function __import(path: string): Promise<any>;\n\nasync function webviewPreloads(ctx: PreloadContext) {\n\n\t/* eslint-disable no-restricted-globals, no-restricted-syntax */\n\n\t// The use of global `window` should be fine in this context, even\n\t// with aux windows. This code is running from within an `iframe`\n\t// where there is only one `window` object anyway.\n\n\tconst userAgent = navigator.userAgent;\n\tconst isChrome = (userAgent.indexOf('Chrome') >= 0);\n\tconst textEncoder = new TextEncoder();\n\tconst textDecoder = new TextDecoder();\n\n\tfunction promiseWithResolvers<T>(): { promise: Promise<T>; resolve: (value: T | PromiseLike<T>) => void; reject: (err?: any) => void } {\n\t\tlet resolve: (value: T | PromiseLike<T>) => void;\n\t\tlet reject: (reason?: any) => void;\n\t\tconst promise = new Promise<T>((res, rej) => {\n\t\t\tresolve = res;\n\t\t\treject = rej;\n\t\t});\n\t\treturn { promise, resolve: resolve!, reject: reject! };\n\t}\n\n\tlet currentOptions = ctx.options;\n\tconst isWorkspaceTrusted = ctx.isWorkspaceTrusted;\n\tlet currentRenderOptions = ctx.renderOptions;\n\tconst settingChange: EmitterLike<RenderOptions> = createEmitter<RenderOptions>();\n\n\tconst acquireVsCodeApi = globalThis.acquireVsCodeApi;\n\tconst vscode = acquireVsCodeApi();\n\tdelete (globalThis as any).acquireVsCodeApi;\n\n\tconst tokenizationStyle = new CSSStyleSheet();\n\ttokenizationStyle.replaceSync(ctx.style.tokenizationCss);\n\n\tconst runWhenIdle: (callback: (idle: IdleDeadline) => void, timeout?: number) => IDisposable = (typeof requestIdleCallback !== 'function' || typeof cancelIdleCallback !== 'function')\n\t\t? (runner) => {\n\t\t\tsetTimeout(() => {\n\t\t\t\tif (disposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tconst end = Date.now() + 15; // one frame at 64fps\n\t\t\t\trunner(Object.freeze({\n\t\t\t\t\tdidTimeout: true,\n\t\t\t\t\ttimeRemaining() {\n\t\t\t\t\t\treturn Math.max(0, end - Date.now());\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t});\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\t: (runner, timeout?) => {\n\t\t\tconst handle: number = requestIdleCallback(runner, typeof timeout === 'number' ? { timeout } : undefined);\n\t\t\tlet disposed = false;\n\t\t\treturn {\n\t\t\t\tdispose() {\n\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t\tdisposed = true;\n\t\t\t\t\tcancelIdleCallback(handle);\n\t\t\t\t}\n\t\t\t};\n\t\t};\n\tfunction getOutputContainer(event: FocusEvent | MouseEvent) {\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLElement && node.classList.contains('output')) {\n\t\t\t\treturn {\n\t\t\t\t\tid: node.id\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\tlet lastFocusedOutput: { id: string } | undefined = undefined;\n\tconst handleOutputFocusOut = (event: FocusEvent) => {\n\t\tconst outputFocus = event && getOutputContainer(event);\n\t\tif (!outputFocus) {\n\t\t\treturn;\n\t\t}\n\t\t// Possible we're tabbing through the elements of the same output.\n\t\t// Lets see if focus is set back to the same output.\n\t\tlastFocusedOutput = undefined;\n\t\tsetTimeout(() => {\n\t\t\tif (lastFocusedOutput?.id === outputFocus.id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpostNotebookMessage<webviewMessages.IOutputBlurMessage>('outputBlur', outputFocus);\n\t\t}, 0);\n\t};\n\n\t// check if an input element is focused within the output element\n\tconst checkOutputInputFocus = (e: FocusEvent) => {\n\t\tlastFocusedOutput = getOutputContainer(e);\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (!activeElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = lastFocusedOutput?.id;\n\t\tif (id && (isEditableElement(activeElement) || activeElement.tagName === 'SELECT')) {\n\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused: true, id });\n\n\t\t\tactiveElement.addEventListener('blur', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused: false, id });\n\t\t\t}, { once: true });\n\t\t}\n\t};\n\n\tconst handleInnerClick = (event: MouseEvent) => {\n\t\tif (!event || !event.view || !event.view.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputFocus = lastFocusedOutput = getOutputContainer(event);\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLAnchorElement && node.href) {\n\t\t\t\tif (node.href.startsWith('blob:')) {\n\t\t\t\t\tif (outputFocus) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', outputFocus);\n\t\t\t\t\t}\n\n\t\t\t\t\thandleBlobUrlClick(node.href, node.download);\n\t\t\t\t} else if (node.href.startsWith('data:')) {\n\t\t\t\t\tif (outputFocus) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', outputFocus);\n\t\t\t\t\t}\n\t\t\t\t\thandleDataUrl(node.href, node.download);\n\t\t\t\t} else if (node.getAttribute('href')?.trim().startsWith('#')) {\n\t\t\t\t\t// Scrolling to location within current doc\n\n\t\t\t\t\tif (!node.hash) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>('scroll-to-reveal', { scrollTop: 0 });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst targetId = node.hash.substring(1);\n\n\t\t\t\t\t// Check outer document first\n\t\t\t\t\tlet scrollTarget: Element | null | undefined = event.view.document.getElementById(targetId);\n\n\t\t\t\t\tif (!scrollTarget) {\n\t\t\t\t\t\t// Fallback to checking preview shadow doms\n\t\t\t\t\t\tfor (const preview of event.view.document.querySelectorAll('.preview')) {\n\t\t\t\t\t\t\tscrollTarget = preview.shadowRoot?.getElementById(targetId);\n\t\t\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\tconst scrollTop = scrollTarget.getBoundingClientRect().top + event.view.scrollY;\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>('scroll-to-reveal', { scrollTop });\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst href = node.getAttribute('href');\n\t\t\t\t\tif (href) {\n\t\t\t\t\t\tif (href.startsWith('command:') && outputFocus) {\n\t\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', outputFocus);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IClickedLinkMessage>('clicked-link', { href });\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (outputFocus) {\n\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', outputFocus);\n\t\t}\n\t};\n\n\tconst blurOutput = () => {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection) {\n\t\t\treturn;\n\t\t}\n\t\tselection.removeAllRanges();\n\t};\n\n\tconst selectOutputContents = (cellOrOutputId: string) => {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellOutputContainer = window.document.getElementById(cellOrOutputId);\n\t\tif (!cellOutputContainer) {\n\t\t\treturn;\n\t\t}\n\t\tselection.removeAllRanges();\n\t\tconst range = document.createRange();\n\t\trange.selectNode(cellOutputContainer);\n\t\tselection.addRange(range);\n\n\t};\n\n\tconst selectInputContents = (cellOrOutputId: string) => {\n\t\tconst cellOutputContainer = window.document.getElementById(cellOrOutputId);\n\t\tif (!cellOutputContainer) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t(activeElement as HTMLInputElement).select();\n\t\t}\n\t};\n\n\tconst onPageUpDownSelectionHandler = (e: KeyboardEvent) => {\n\t\tif (!lastFocusedOutput?.id || !e.shiftKey) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If we're pressing `Shift+Up/Down` then we want to select a line at a time.\n\t\tif (e.shiftKey && (e.code === 'ArrowUp' || e.code === 'ArrowDown')) {\n\t\t\te.stopPropagation(); // We don't want the notebook to handle this, default behavior is what we need.\n\t\t\treturn;\n\t\t}\n\n\t\t// We want to handle just `Shift + PageUp/PageDown` & `Shift + Cmd + ArrowUp/ArrowDown` (for mac)\n\t\tif (!(e.code === 'PageUp' || e.code === 'PageDown') && !(e.metaKey && (e.code === 'ArrowDown' || e.code === 'ArrowUp'))) {\n\t\t\treturn;\n\t\t}\n\t\tconst outputContainer = window.document.getElementById(lastFocusedOutput.id);\n\t\tconst selection = window.getSelection();\n\t\tif (!outputContainer || !selection?.anchorNode) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t// Leave for default behavior.\n\t\t\treturn;\n\t\t}\n\n\t\t// These should change the scroll position, not adjust the selected cell in the notebook\n\t\te.stopPropagation(); // We don't want the notebook to handle this.\n\t\te.preventDefault(); // We will handle selection.\n\n\t\tconst { anchorNode, anchorOffset } = selection;\n\t\tconst range = document.createRange();\n\t\tif (e.code === 'PageDown' || e.code === 'ArrowDown') {\n\t\t\trange.setStart(anchorNode, anchorOffset);\n\t\t\trange.setEnd(outputContainer, 1);\n\t\t}\n\t\telse {\n\t\t\trange.setStart(outputContainer, 0);\n\t\t\trange.setEnd(anchorNode, anchorOffset);\n\t\t}\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\t};\n\n\tconst disableNativeSelectAll = (e: KeyboardEvent) => {\n\t\tif (!lastFocusedOutput?.id) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t// The input element will handle this.\n\t\t\treturn;\n\t\t}\n\n\t\tif ((e.key === 'a' && e.ctrlKey) || (e.metaKey && e.key === 'a')) {\n\t\t\te.preventDefault(); // We will handle selection in editor code.\n\t\t\treturn;\n\t\t}\n\t};\n\n\tconst handleDataUrl = async (data: string | ArrayBuffer | null, downloadName: string) => {\n\t\tpostNotebookMessage<webviewMessages.IClickedDataUrlMessage>('clicked-data-url', {\n\t\t\tdata,\n\t\t\tdownloadName\n\t\t});\n\t};\n\n\tconst handleBlobUrlClick = async (url: string, downloadName: string) => {\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst blob = await response.blob();\n\t\t\tconst reader = new FileReader();\n\t\t\treader.addEventListener('load', () => {\n\t\t\t\thandleDataUrl(reader.result, downloadName);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob);\n\t\t} catch (e) {\n\t\t\tconsole.error(e.message);\n\t\t}\n\t};\n\n\twindow.document.body.addEventListener('click', handleInnerClick);\n\twindow.document.body.addEventListener('focusin', checkOutputInputFocus);\n\twindow.document.body.addEventListener('focusout', handleOutputFocusOut);\n\twindow.document.body.addEventListener('keydown', onPageUpDownSelectionHandler);\n\twindow.document.body.addEventListener('keydown', disableNativeSelectAll);\n\n\tinterface RendererContext extends rendererApi.RendererContext<unknown> {\n\t\treadonly onDidChangeSettings: Event<RenderOptions>;\n\t\treadonly settings: RenderOptions;\n\t}\n\n\tinterface RendererModule {\n\t\treadonly activate: rendererApi.ActivationFunction;\n\t}\n\n\tinterface KernelPreloadContext {\n\t\treadonly onDidReceiveKernelMessage: Event<unknown>;\n\t\tpostKernelMessage(data: unknown): void;\n\t}\n\n\tinterface KernelPreloadModule {\n\t\tactivate(ctx: KernelPreloadContext): Promise<void> | void;\n\t}\n\n\tinterface IObservedElement {\n\t\tid: string;\n\t\toutput: boolean;\n\t\tlastKnownPadding: number;\n\t\tlastKnownHeight: number;\n\t\tcellId: string;\n\t}\n\n\tfunction createKernelContext(): KernelPreloadContext {\n\t\treturn Object.freeze({\n\t\t\tonDidReceiveKernelMessage: onDidReceiveKernelMessage.event,\n\t\t\tpostKernelMessage: (data: unknown) => postNotebookMessage('customKernelMessage', { message: data }),\n\t\t});\n\t}\n\n\tasync function runKernelPreload(url: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await activateModuleKernelPreload(url);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync function activateModuleKernelPreload(url: string) {\n\t\tconst module: KernelPreloadModule = await __import(url);\n\t\tif (!module.activate) {\n\t\t\tconsole.error(`Notebook preload '${url}' was expected to be a module but it does not export an 'activate' function`);\n\t\t\treturn;\n\t\t}\n\t\treturn module.activate(createKernelContext());\n\t}\n\n\tconst dimensionUpdater = new class {\n\t\tprivate readonly pending = new Map<string, webviewMessages.DimensionUpdate>();\n\n\t\tupdateHeight(id: string, height: number, options: { init?: boolean; isOutput?: boolean }) {\n\t\t\tif (!this.pending.size) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.updateImmediately();\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tconst update = this.pending.get(id);\n\t\t\tif (update && update.isOutput) {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\tinit: update.init,\n\t\t\t\t\tisOutput: update.isOutput\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\t...options,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tupdateImmediately() {\n\t\t\tif (!this.pending.size) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpostNotebookMessage<webviewMessages.IDimensionMessage>('dimension', {\n\t\t\t\tupdates: Array.from(this.pending.values())\n\t\t\t});\n\t\t\tthis.pending.clear();\n\t\t}\n\t};\n\n\tfunction elementHasContent(height: number) {\n\t\t// we need to account for a potential 1px top and bottom border on a child within the output container\n\t\treturn height > 2.1;\n\t}\n\n\tconst resizeObserver = new class {\n\n\t\tprivate readonly _observer: ResizeObserver;\n\n\t\tprivate readonly _observedElements = new WeakMap<Element, IObservedElement>();\n\t\tprivate _outputResizeTimer: any;\n\n\t\tconstructor() {\n\t\t\tthis._observer = new ResizeObserver(entries => {\n\t\t\t\tfor (const entry of entries) {\n\t\t\t\t\tif (!window.document.body.contains(entry.target)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst observedElementInfo = this._observedElements.get(entry.target);\n\t\t\t\t\tif (!observedElementInfo) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.postResizeMessage(observedElementInfo.cellId);\n\n\t\t\t\t\tif (entry.target.id !== observedElementInfo.id) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!entry.contentRect) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!observedElementInfo.output) {\n\t\t\t\t\t\t// markup, update directly\n\t\t\t\t\t\tthis.updateHeight(observedElementInfo, entry.target.offsetHeight);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst hasContent = elementHasContent(entry.contentRect.height);\n\t\t\t\t\tconst shouldUpdatePadding =\n\t\t\t\t\t\t(hasContent && observedElementInfo.lastKnownPadding === 0) ||\n\t\t\t\t\t\t(!hasContent && observedElementInfo.lastKnownPadding !== 0);\n\n\t\t\t\t\tif (shouldUpdatePadding) {\n\t\t\t\t\t\t// Do not update dimension in resize observer\n\t\t\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\t\t\tif (hasContent) {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}px`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `0px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.updateHeight(observedElementInfo, hasContent ? entry.target.offsetHeight : 0);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.updateHeight(observedElementInfo, hasContent ? entry.target.offsetHeight : 0);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tprivate updateHeight(observedElementInfo: IObservedElement, offsetHeight: number) {\n\t\t\tif (observedElementInfo.lastKnownHeight !== offsetHeight) {\n\t\t\t\tobservedElementInfo.lastKnownHeight = offsetHeight;\n\t\t\t\tdimensionUpdater.updateHeight(observedElementInfo.id, offsetHeight, {\n\t\t\t\t\tisOutput: observedElementInfo.output\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic observe(container: Element, id: string, output: boolean, cellId: string) {\n\t\t\tif (this._observedElements.has(container)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._observedElements.set(container, { id, output, lastKnownPadding: ctx.style.outputNodePadding, lastKnownHeight: -1, cellId });\n\t\t\tthis._observer.observe(container);\n\t\t}\n\n\t\tprivate postResizeMessage(cellId: string) {\n\t\t\t// Debounce this callback to only happen after\n\t\t\t// 250 ms. Don't need resize events that often.\n\t\t\tclearTimeout(this._outputResizeTimer);\n\t\t\tthis._outputResizeTimer = setTimeout(() => {\n\t\t\t\tpostNotebookMessage('outputResized', {\n\t\t\t\t\tcellId\n\t\t\t\t});\n\t\t\t}, 250);\n\n\t\t}\n\t};\n\n\tlet previousDelta: number | undefined;\n\tlet scrollTimeout: any /* NodeJS.Timeout */ | undefined;\n\tlet scrolledElement: Element | undefined;\n\tlet lastTimeScrolled: number | undefined;\n\tfunction flagRecentlyScrolled(node: Element, deltaY?: number) {\n\t\tscrolledElement = node;\n\t\tif (deltaY === undefined) {\n\t\t\tlastTimeScrolled = Date.now();\n\t\t\tpreviousDelta = undefined;\n\t\t\tnode.setAttribute('recentlyScrolled', 'true');\n\t\t\tclearTimeout(scrollTimeout);\n\t\t\tscrollTimeout = setTimeout(() => { scrolledElement?.removeAttribute('recentlyScrolled'); }, 300);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (node.hasAttribute('recentlyScrolled')) {\n\t\t\tif (lastTimeScrolled && Date.now() - lastTimeScrolled > 400) {\n\t\t\t\t// it has been a while since we actually scrolled\n\t\t\t\t// if scroll velocity increases significantly, it's likely a new scroll event\n\t\t\t\tif (!!previousDelta && deltaY < 0 && deltaY < previousDelta - 8) {\n\t\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\t\tscrolledElement?.removeAttribute('recentlyScrolled');\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (!!previousDelta && deltaY > 0 && deltaY > previousDelta + 8) {\n\t\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\t\tscrolledElement?.removeAttribute('recentlyScrolled');\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// the tail end of a smooth scrolling event (from a trackpad) can go on for a while\n\t\t\t\t// so keep swallowing it, but we can shorten the timeout since the events occur rapidly\n\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\tscrollTimeout = setTimeout(() => { scrolledElement?.removeAttribute('recentlyScrolled'); }, 50);\n\t\t\t} else {\n\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\tscrollTimeout = setTimeout(() => { scrolledElement?.removeAttribute('recentlyScrolled'); }, 300);\n\t\t\t}\n\n\t\t\tpreviousDelta = deltaY;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction eventTargetShouldHandleScroll(event: WheelEvent) {\n\t\tfor (let node = event.target as Node | null; node; node = node.parentNode) {\n\t\t\tif (!(node instanceof Element) || node.id === 'container' || node.classList.contains('cell_container') || node.classList.contains('markup') || node.classList.contains('output_container')) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// scroll up\n\t\t\tif (event.deltaY < 0 && node.scrollTop > 0) {\n\t\t\t\t// there is still some content to scroll\n\t\t\t\tflagRecentlyScrolled(node);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// scroll down\n\t\t\tif (event.deltaY > 0 && node.scrollTop + node.clientHeight < node.scrollHeight) {\n\t\t\t\t// per https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight\n\t\t\t\t// scrollTop is not rounded but scrollHeight and clientHeight are\n\t\t\t\t// so we need to check if the difference is less than some threshold\n\t\t\t\tif (node.scrollHeight - node.scrollTop - node.clientHeight < 2) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if the node is not scrollable, we can continue. We don't check the computed style always as it's expensive\n\t\t\t\tif (window.getComputedStyle(node).overflowY === 'hidden' || window.getComputedStyle(node).overflowY === 'visible') {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tflagRecentlyScrolled(node);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (flagRecentlyScrolled(node, event.deltaY)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst handleWheel = (event: WheelEvent & { wheelDeltaX?: number; wheelDeltaY?: number; wheelDelta?: number }) => {\n\t\tif (event.defaultPrevented || eventTargetShouldHandleScroll(event)) {\n\t\t\treturn;\n\t\t}\n\t\tpostNotebookMessage<webviewMessages.IWheelMessage>('did-scroll-wheel', {\n\t\t\tpayload: {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\t// Refs https://github.com/microsoft/vscode/issues/146403#issuecomment-1854538928\n\t\t\t\twheelDelta: event.wheelDelta && isChrome ? (event.wheelDelta / window.devicePixelRatio) : event.wheelDelta,\n\t\t\t\twheelDeltaX: event.wheelDeltaX && isChrome ? (event.wheelDeltaX / window.devicePixelRatio) : event.wheelDeltaX,\n\t\t\t\twheelDeltaY: event.wheelDeltaY && isChrome ? (event.wheelDeltaY / window.devicePixelRatio) : event.wheelDeltaY,\n\t\t\t\tdetail: event.detail,\n\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\ttype: event.type\n\t\t\t}\n\t\t});\n\t};\n\n\tfunction focusFirstFocusableOrContainerInOutput(cellOrOutputId: string, alternateId?: string) {\n\t\tconst cellOutputContainer = window.document.getElementById(cellOrOutputId) ??\n\t\t\t(alternateId ? window.document.getElementById(alternateId) : undefined);\n\t\tif (cellOutputContainer) {\n\t\t\tif (cellOutputContainer.contains(window.document.activeElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = cellOutputContainer.id;\n\t\t\tlet focusableElement = cellOutputContainer.querySelector('[tabindex=\"0\"], [href], button, input, option, select, textarea') as HTMLElement | null;\n\t\t\tif (!focusableElement) {\n\t\t\t\tfocusableElement = cellOutputContainer;\n\t\t\t\tfocusableElement.tabIndex = -1;\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused: false, id });\n\t\t\t} else {\n\t\t\t\tconst inputFocused = isEditableElement(focusableElement);\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>('outputInputFocus', { inputFocused, id });\n\t\t\t}\n\n\t\t\tlastFocusedOutput = cellOutputContainer;\n\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>('outputFocus', { id: cellOutputContainer.id });\n\t\t\tfocusableElement.focus();\n\t\t}\n\t}\n\n\tfunction createFocusSink(cellId: string, focusNext?: boolean) {\n\t\tconst element = document.createElement('div');\n\t\telement.id = `focus-sink-${cellId}`;\n\t\telement.tabIndex = 0;\n\t\telement.addEventListener('focus', () => {\n\t\t\tpostNotebookMessage<webviewMessages.IFocusEditorMessage>('focus-editor', {\n\t\t\t\tcellId: cellId,\n\t\t\t\tfocusNext\n\t\t\t});\n\t\t});\n\n\t\treturn element;\n\t}\n\n\tfunction _internalHighlightRange(range: Range, tagName = 'mark', attributes = {}) {\n\t\t// derived from https://github.com/Treora/dom-highlight-range/blob/master/highlight-range.js\n\n\t\t// Return an array of the text nodes in the range. Split the start and end nodes if required.\n\t\tfunction _textNodesInRange(range: Range): Text[] {\n\t\t\tif (!range.startContainer.ownerDocument) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// If the start or end node is a text node and only partly in the range, split it.\n\t\t\tif (range.startContainer.nodeType === Node.TEXT_NODE && range.startOffset > 0) {\n\t\t\t\tconst startContainer = range.startContainer as Text;\n\t\t\t\tconst endOffset = range.endOffset; // (this may get lost when the splitting the node)\n\t\t\t\tconst createdNode = startContainer.splitText(range.startOffset);\n\t\t\t\tif (range.endContainer === startContainer) {\n\t\t\t\t\t// If the end was in the same container, it will now be in the newly created node.\n\t\t\t\t\trange.setEnd(createdNode, endOffset - range.startOffset);\n\t\t\t\t}\n\n\t\t\t\trange.setStart(createdNode, 0);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\trange.endContainer.nodeType === Node.TEXT_NODE\n\t\t\t\t&& range.endOffset < (range.endContainer as Text).length\n\t\t\t) {\n\t\t\t\t(range.endContainer as Text).splitText(range.endOffset);\n\t\t\t}\n\n\t\t\t// Collect the text nodes.\n\t\t\tconst walker = range.startContainer.ownerDocument.createTreeWalker(\n\t\t\t\trange.commonAncestorContainer,\n\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\tnode => range.intersectsNode(node) ? NodeFilter.FILTER_ACCEPT : NodeFilter.FILTER_REJECT,\n\t\t\t);\n\n\t\t\twalker.currentNode = range.startContainer;\n\n\t\t\t// // Optimise by skipping nodes that are explicitly outside the range.\n\t\t\t// const NodeTypesWithCharacterOffset = [\n\t\t\t//  Node.TEXT_NODE,\n\t\t\t//  Node.PROCESSING_INSTRUCTION_NODE,\n\t\t\t//  Node.COMMENT_NODE,\n\t\t\t// ];\n\t\t\t// if (!NodeTypesWithCharacterOffset.includes(range.startContainer.nodeType)) {\n\t\t\t//   if (range.startOffset < range.startContainer.childNodes.length) {\n\t\t\t//     walker.currentNode = range.startContainer.childNodes[range.startOffset];\n\t\t\t//   } else {\n\t\t\t//     walker.nextSibling(); // TODO verify this is correct.\n\t\t\t//   }\n\t\t\t// }\n\n\t\t\tconst nodes: Text[] = [];\n\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t}\n\n\t\t\twhile (walker.nextNode() && range.comparePoint(walker.currentNode, 0) !== 1) {\n\t\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn nodes;\n\t\t}\n\n\t\t// Replace [node] with <tagName ...attributes>[node]</tagName>\n\t\tfunction wrapNodeInHighlight(node: Text, tagName: string, attributes: any) {\n\t\t\tconst highlightElement = node.ownerDocument.createElement(tagName);\n\t\t\tObject.keys(attributes).forEach(key => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t\tconst tempRange = node.ownerDocument.createRange();\n\t\t\ttempRange.selectNode(node);\n\t\t\ttempRange.surroundContents(highlightElement);\n\t\t\treturn highlightElement;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\treturn {\n\t\t\t\tremove: () => { },\n\t\t\t\tupdate: () => { }\n\t\t\t};\n\t\t}\n\n\t\t// First put all nodes in an array (splits start and end nodes if needed)\n\t\tconst nodes = _textNodesInRange(range);\n\n\t\t// Highlight each node\n\t\tconst highlightElements: Element[] = [];\n\t\tfor (const nodeIdx in nodes) {\n\t\t\tconst highlightElement = wrapNodeInHighlight(nodes[nodeIdx], tagName, attributes);\n\t\t\thighlightElements.push(highlightElement);\n\t\t}\n\n\t\t// Remove a highlight element created with wrapNodeInHighlight.\n\t\tfunction _removeHighlight(highlightElement: Element) {\n\t\t\tif (highlightElement.childNodes.length === 1) {\n\t\t\t\thighlightElement.parentNode?.replaceChild(highlightElement.firstChild!, highlightElement);\n\t\t\t} else {\n\t\t\t\t// If the highlight somehow contains multiple nodes now, move them all.\n\t\t\t\twhile (highlightElement.firstChild) {\n\t\t\t\t\thighlightElement.parentNode?.insertBefore(highlightElement.firstChild, highlightElement);\n\t\t\t\t}\n\t\t\t\thighlightElement.remove();\n\t\t\t}\n\t\t}\n\n\t\t// Return a function that cleans up the highlightElements.\n\t\tfunction _removeHighlights() {\n\t\t\t// Remove each of the created highlightElements.\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_removeHighlight(highlightElements[highlightIdx]);\n\t\t\t}\n\t\t}\n\n\t\tfunction _updateHighlight(highlightElement: Element, attributes: any = {}) {\n\t\t\tObject.keys(attributes).forEach(key => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t}\n\n\t\tfunction updateHighlights(attributes: any) {\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_updateHighlight(highlightElements[highlightIdx], attributes);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tremove: _removeHighlights,\n\t\t\tupdate: updateHighlights\n\t\t};\n\t}\n\n\tinterface ICommonRange {\n\t\tcollapsed: boolean;\n\t\tcommonAncestorContainer: Node;\n\t\tendContainer: Node;\n\t\tendOffset: number;\n\t\tstartContainer: Node;\n\t\tstartOffset: number;\n\n\t}\n\n\tinterface IHighlightResult {\n\t\trange: ICommonRange;\n\t\tdispose: () => void;\n\t\tupdate: (color: string | undefined, className: string | undefined) => void;\n\t}\n\n\tfunction selectRange(_range: ICommonRange) {\n\t\tconst sel = window.getSelection();\n\t\tif (sel) {\n\t\t\ttry {\n\t\t\t\tsel.removeAllRanges();\n\t\t\t\tconst r = document.createRange();\n\t\t\t\tr.setStart(_range.startContainer, _range.startOffset);\n\t\t\t\tr.setEnd(_range.endContainer, _range.endOffset);\n\t\t\t\tsel.addRange(r);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction highlightRange(range: Range, useCustom: boolean, tagName = 'mark', attributes = {}): IHighlightResult {\n\t\tif (useCustom) {\n\t\t\tconst ret = _internalHighlightRange(range, tagName, attributes);\n\t\t\treturn {\n\t\t\t\trange: range,\n\t\t\t\tdispose: ret.remove,\n\t\t\t\tupdate: (color: string | undefined, className: string | undefined) => {\n\t\t\t\t\tif (className === undefined) {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\t'style': `background-color: ${color}`\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\t'class': className\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t} else {\n\t\t\twindow.document.execCommand('hiliteColor', false, matchColor);\n\t\t\tconst cloneRange = window.getSelection()!.getRangeAt(0).cloneRange();\n\t\t\tconst _range = {\n\t\t\t\tcollapsed: cloneRange.collapsed,\n\t\t\t\tcommonAncestorContainer: cloneRange.commonAncestorContainer,\n\t\t\t\tendContainer: cloneRange.endContainer,\n\t\t\t\tendOffset: cloneRange.endOffset,\n\t\t\t\tstartContainer: cloneRange.startContainer,\n\t\t\t\tstartOffset: cloneRange.startOffset\n\t\t\t};\n\t\t\treturn {\n\t\t\t\trange: _range,\n\t\t\t\tdispose: () => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = 'On';\n\t\t\t\t\t\twindow.document.execCommand('removeFormat', false, undefined);\n\t\t\t\t\t\tdocument.designMode = 'Off';\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: (color: string | undefined, className: string | undefined) => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = 'On';\n\t\t\t\t\t\twindow.document.execCommand('removeFormat', false, undefined);\n\t\t\t\t\t\twindow.document.execCommand('hiliteColor', false, color);\n\t\t\t\t\t\tdocument.designMode = 'Off';\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction createEmitter<T>(listenerChange: (listeners: Set<Listener<T>>) => void = () => undefined): EmitterLike<T> {\n\t\tconst listeners = new Set<Listener<T>>();\n\t\treturn {\n\t\t\tfire(data) {\n\t\t\t\tfor (const listener of [...listeners]) {\n\t\t\t\t\tlistener.fn.call(listener.thisArg, data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevent(fn, thisArg, disposables) {\n\t\t\t\tconst listenerObj = { fn, thisArg };\n\t\t\t\tconst disposable: IDisposable = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tlisteners.delete(listenerObj);\n\t\t\t\t\t\tlistenerChange(listeners);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlisteners.add(listenerObj);\n\t\t\t\tlistenerChange(listeners);\n\n\t\t\t\tif (disposables instanceof Array) {\n\t\t\t\t\tdisposables.push(disposable);\n\t\t\t\t} else if (disposables) {\n\t\t\t\t\tdisposables.add(disposable);\n\t\t\t\t}\n\n\t\t\t\treturn disposable;\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction showRenderError(errorText: string, outputNode: HTMLElement, errors: readonly Error[]) {\n\t\toutputNode.innerText = errorText;\n\t\tconst errList = document.createElement('ul');\n\t\tfor (const result of errors) {\n\t\t\tconsole.error(result);\n\t\t\tconst item = document.createElement('li');\n\t\t\titem.innerText = result.message;\n\t\t\terrList.appendChild(item);\n\t\t}\n\t\toutputNode.appendChild(errList);\n\t}\n\n\tconst outputItemRequests = new class {\n\t\tprivate _requestPool = 0;\n\t\tprivate readonly _requests = new Map</*requestId*/number, { resolve: (x: webviewMessages.OutputItemEntry | undefined) => void }>();\n\n\t\tgetOutputItem(outputId: string, mime: string) {\n\t\t\tconst requestId = this._requestPool++;\n\n\t\t\tconst { promise, resolve } = promiseWithResolvers<webviewMessages.OutputItemEntry | undefined>();\n\t\t\tthis._requests.set(requestId, { resolve });\n\n\t\t\tpostNotebookMessage<webviewMessages.IGetOutputItemMessage>('getOutputItem', { requestId, outputId, mime });\n\t\t\treturn promise;\n\t\t}\n\n\t\tresolveOutputItem(requestId: number, output: webviewMessages.OutputItemEntry | undefined) {\n\t\t\tconst request = this._requests.get(requestId);\n\t\t\tif (!request) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._requests.delete(requestId);\n\t\t\trequest.resolve(output);\n\t\t}\n\t};\n\n\tinterface AdditionalOutputItemInfo {\n\t\treadonly mime: string;\n\t\tgetItem(): Promise<rendererApi.OutputItem | undefined>;\n\t}\n\n\tinterface ExtendedOutputItem extends rendererApi.OutputItem {\n\t\treadonly _allOutputItems: ReadonlyArray<AdditionalOutputItemInfo>;\n\t\tappendedText?(): string | undefined;\n\t}\n\n\tlet hasWarnedAboutAllOutputItemsProposal = false;\n\n\tfunction createOutputItem(\n\t\tid: string,\n\t\tmime: string,\n\t\tmetadata: unknown,\n\t\tvalueBytes: Uint8Array,\n\t\tallOutputItemData: ReadonlyArray<{ readonly mime: string }>,\n\t\tappended?: { valueBytes: Uint8Array; previousVersion: number }\n\t): ExtendedOutputItem {\n\n\t\tfunction create(\n\t\t\tid: string,\n\t\t\tmime: string,\n\t\t\tmetadata: unknown,\n\t\t\tvalueBytes: Uint8Array,\n\t\t\tappended?: { valueBytes: Uint8Array; previousVersion: number }\n\t\t): ExtendedOutputItem {\n\t\t\treturn Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\t\t\t\tmetadata,\n\n\t\t\t\tappendedText(): string | undefined {\n\t\t\t\t\tif (appended) {\n\t\t\t\t\t\treturn textDecoder.decode(appended.valueBytes);\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata(): Uint8Array {\n\t\t\t\t\treturn valueBytes;\n\t\t\t\t},\n\n\t\t\t\ttext(): string {\n\t\t\t\t\treturn textDecoder.decode(valueBytes);\n\t\t\t\t},\n\n\t\t\t\tjson() {\n\t\t\t\t\treturn JSON.parse(this.text());\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([valueBytes], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\tget _allOutputItems() {\n\t\t\t\t\tif (!hasWarnedAboutAllOutputItemsProposal) {\n\t\t\t\t\t\thasWarnedAboutAllOutputItemsProposal = true;\n\t\t\t\t\t\tconsole.warn(`'_allOutputItems' is proposed API. DO NOT ship an extension that depends on it!`);\n\t\t\t\t\t}\n\t\t\t\t\treturn allOutputItemList;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tconst allOutputItemCache = new Map</*mime*/string, Promise<(rendererApi.OutputItem & ExtendedOutputItem) | undefined>>();\n\t\tconst allOutputItemList = Object.freeze(allOutputItemData.map(outputItem => {\n\t\t\tconst mime = outputItem.mime;\n\t\t\treturn Object.freeze({\n\t\t\t\tmime,\n\t\t\t\tgetItem() {\n\t\t\t\t\tconst existingTask = allOutputItemCache.get(mime);\n\t\t\t\t\tif (existingTask) {\n\t\t\t\t\t\treturn existingTask;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst task = outputItemRequests.getOutputItem(id, mime).then(item => {\n\t\t\t\t\t\treturn item ? create(id, item.mime, metadata, item.valueBytes) : undefined;\n\t\t\t\t\t});\n\t\t\t\t\tallOutputItemCache.set(mime, task);\n\n\t\t\t\t\treturn task;\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\n\t\tconst item = create(id, mime, metadata, valueBytes, appended);\n\t\tallOutputItemCache.set(mime, Promise.resolve(item));\n\t\treturn item;\n\t}\n\n\tconst onDidReceiveKernelMessage = createEmitter<unknown>();\n\n\tconst ttPolicy = window.trustedTypes?.createPolicy('notebookRenderer', {\n\t\tcreateHTML: value => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t\tcreateScript: value => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t});\n\n\twindow.addEventListener('wheel', handleWheel);\n\n\tinterface IFindMatch {\n\t\ttype: 'preview' | 'output';\n\t\tid: string;\n\t\tcellId: string;\n\t\tcontainer: Node;\n\t\toriginalRange: Range;\n\t\tisShadow: boolean;\n\t\tsearchPreviewInfo?: ISearchPreviewInfo;\n\t\thighlightResult?: IHighlightResult;\n\t}\n\n\tinterface ISearchPreviewInfo {\n\t\tline: string;\n\t\trange: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t};\n\t}\n\n\tinterface IHighlighter {\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void;\n\t\tremoveHighlights(ownerID: string): void;\n\t\thighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tdispose(): void;\n\t}\n\n\tinterface IHighlightInfo {\n\t\tmatches: IFindMatch[];\n\t\tcurrentMatchIndex: number;\n\t}\n\n\tconst matchColor = window.getComputedStyle(window.document.getElementById('_defaultColorPalatte')!).color;\n\tconst currentMatchColor = window.getComputedStyle(window.document.getElementById('_defaultColorPalatte')!).backgroundColor;\n\n\tclass JSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\n\t\tconstructor(\n\t\t) {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t}\n\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void {\n\t\t\tfor (let i = matches.length - 1; i >= 0; i--) {\n\t\t\t\tconst match = matches[i];\n\t\t\t\tconst ret = highlightRange(match.originalRange, true, 'mark', match.isShadow ? {\n\t\t\t\t\t'style': 'background-color: ' + matchColor + ';',\n\t\t\t\t} : {\n\t\t\t\t\t'class': 'find-match'\n\t\t\t\t});\n\t\t\t\tmatch.highlightResult = ret;\n\t\t\t}\n\n\t\t\tconst highlightInfo: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1\n\t\t\t};\n\t\t\tthis._activeHighlightInfo.set(ownerID, highlightInfo);\n\t\t}\n\n\t\tremoveHighlights(ownerID: string): void {\n\t\t\tthis._activeHighlightInfo.get(ownerID)?.matches.forEach(match => {\n\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t});\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error('Modified current highlight match before adding highlight list.');\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch = highlightInfo.matches[highlightInfo.currentMatchIndex];\n\t\t\toldMatch?.highlightResult?.update(matchColor, oldMatch.isShadow ? undefined : 'find-match');\n\n\t\t\tconst match = highlightInfo.matches[index];\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst sel = window.getSelection();\n\t\t\tif (!!match && !!sel && match.highlightResult) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = window.document.getElementById(match.id)!.getBoundingClientRect().top;\n\t\t\t\t\tconst tempRange = document.createRange();\n\t\t\t\t\ttempRange.selectNode(match.highlightResult.range.startContainer);\n\n\t\t\t\t\tmatch.highlightResult.range.startContainer.parentElement?.scrollIntoView({ behavior: 'auto', block: 'end', inline: 'nearest' });\n\n\t\t\t\t\tconst rangeOffset = tempRange.getBoundingClientRect().top;\n\t\t\t\t\ttempRange.detach();\n\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\n\t\t\t\tmatch.highlightResult?.update(currentMatchColor, match.isShadow ? undefined : 'current-find-match');\n\n\t\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\t\tpostNotebookMessage('didFindHighlightCurrent', {\n\t\t\t\t\toffset\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch = highlightInfo.matches[index];\n\t\t\tif (oldMatch && oldMatch.highlightResult) {\n\t\t\t\toldMatch.highlightResult.update(matchColor, oldMatch.isShadow ? undefined : 'find-match');\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\tthis._activeHighlightInfo.forEach(highlightInfo => {\n\t\t\t\thighlightInfo.matches.forEach(match => {\n\t\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tclass CSSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\t\tprivate _matchesHighlight: Highlight;\n\t\tprivate _currentMatchesHighlight: Highlight;\n\n\t\tconstructor() {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t\tthis._matchesHighlight = new Highlight();\n\t\t\tthis._matchesHighlight.priority = 1;\n\t\t\tthis._currentMatchesHighlight = new Highlight();\n\t\t\tthis._currentMatchesHighlight.priority = 2;\n\t\t\tCSS.highlights?.set(`find-highlight`, this._matchesHighlight);\n\t\t\tCSS.highlights?.set(`current-find-highlight`, this._currentMatchesHighlight);\n\t\t}\n\n\t\t_refreshRegistry(updateMatchesHighlight = true) {\n\t\t\t// for performance reasons, only update the full list of highlights when we need to\n\t\t\tif (updateMatchesHighlight) {\n\t\t\t\tthis._matchesHighlight.clear();\n\t\t\t}\n\n\t\t\tthis._currentMatchesHighlight.clear();\n\n\t\t\tthis._activeHighlightInfo.forEach((highlightInfo) => {\n\n\t\t\t\tif (updateMatchesHighlight) {\n\t\t\t\t\tfor (let i = 0; i < highlightInfo.matches.length; i++) {\n\t\t\t\t\t\tthis._matchesHighlight.add(highlightInfo.matches[i].originalRange);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (highlightInfo.currentMatchIndex < highlightInfo.matches.length && highlightInfo.currentMatchIndex >= 0) {\n\t\t\t\t\tthis._currentMatchesHighlight.add(highlightInfo.matches[highlightInfo.currentMatchIndex].originalRange);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\taddHighlights(\n\t\t\tmatches: IFindMatch[],\n\t\t\townerID: string\n\t\t) {\n\n\t\t\tfor (let i = 0; i < matches.length; i++) {\n\t\t\t\tthis._matchesHighlight.add(matches[i].originalRange);\n\t\t\t}\n\n\t\t\tconst newEntry: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1,\n\t\t\t};\n\n\t\t\tthis._activeHighlightInfo.set(ownerID, newEntry);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error('Modified current highlight match before adding highlight list.');\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst match = highlightInfo.matches[index];\n\n\t\t\tif (match) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = window.document.getElementById(match.id)!.getBoundingClientRect().top;\n\t\t\t\t\tmatch.originalRange.startContainer.parentElement?.scrollIntoView({ behavior: 'auto', block: 'end', inline: 'nearest' });\n\t\t\t\t\tconst rangeOffset = match.originalRange.getBoundingClientRect().top;\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t\tpostNotebookMessage('didFindHighlightCurrent', {\n\t\t\t\t\t\toffset\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._refreshRegistry(false);\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = -1;\n\t\t}\n\n\t\tremoveHighlights(ownerID: string) {\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t\tthis._refreshRegistry();\n\t\t}\n\n\t\tdispose(): void {\n\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\tthis._currentMatchesHighlight.clear();\n\t\t\tthis._matchesHighlight.clear();\n\t\t}\n\t}\n\n\tconst _highlighter = (CSS.highlights) ? new CSSHighlighter() : new JSHighlighter();\n\n\tfunction extractSelectionLine(selection: Selection): ISearchPreviewInfo {\n\t\tconst range = selection.getRangeAt(0);\n\n\t\t// we need to keep a reference to the old selection range to re-apply later\n\t\tconst oldRange = range.cloneRange();\n\t\tconst captureLength = selection.toString().length;\n\n\t\t// use selection API to modify selection to get entire line (the first line if multi-select)\n\n\t\t// collapse selection to start so that the cursor position is at beginning of match\n\t\tselection.collapseToStart();\n\n\t\t// extend selection in both directions to select the line\n\t\tselection.modify('move', 'backward', 'lineboundary');\n\t\tselection.modify('extend', 'forward', 'lineboundary');\n\n\t\tconst line = selection.toString();\n\n\t\t// using the original range and the new range, we can find the offset of the match from the line start.\n\t\tconst rangeStart = getStartOffset(selection.getRangeAt(0), oldRange);\n\n\t\t// line range for match\n\t\tconst lineRange = {\n\t\t\tstart: rangeStart,\n\t\t\tend: rangeStart + captureLength,\n\t\t};\n\n\t\t// re-add the old range so that the selection is restored\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(oldRange);\n\n\t\treturn { line, range: lineRange };\n\t}\n\n\tfunction getStartOffset(lineRange: Range, originalRange: Range) {\n\t\t// sometimes, the old and new range are in different DOM elements (ie: when the match is inside of <b></b>)\n\t\t// so we need to find the first common ancestor DOM element and find the positions of the old and new range relative to that.\n\t\tconst firstCommonAncestor = findFirstCommonAncestor(lineRange.startContainer, originalRange.startContainer);\n\n\t\tconst selectionOffset = getSelectionOffsetRelativeTo(firstCommonAncestor, lineRange.startContainer) + lineRange.startOffset;\n\t\tconst textOffset = getSelectionOffsetRelativeTo(firstCommonAncestor, originalRange.startContainer) + originalRange.startOffset;\n\t\treturn textOffset - selectionOffset;\n\t}\n\n\t// modified from https://stackoverflow.com/a/68583466/16253823\n\tfunction findFirstCommonAncestor(nodeA: Node, nodeB: Node) {\n\t\tconst range = new Range();\n\t\trange.setStart(nodeA, 0);\n\t\trange.setEnd(nodeB, 0);\n\t\treturn range.commonAncestorContainer;\n\t}\n\n\tfunction getTextContentLength(node: Node): number {\n\t\tlet length = 0;\n\n\t\tif (node.nodeType === Node.TEXT_NODE) {\n\t\t\tlength += node.textContent?.length || 0;\n\t\t} else {\n\t\t\tfor (const childNode of node.childNodes) {\n\t\t\t\tlength += getTextContentLength(childNode);\n\t\t\t}\n\t\t}\n\n\t\treturn length;\n\t}\n\n\t// modified from https://stackoverflow.com/a/48812529/16253823\n\tfunction getSelectionOffsetRelativeTo(parentElement: Node, currentNode: Node | null): number {\n\t\tif (!currentNode) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet offset = 0;\n\n\t\tif (currentNode === parentElement || !parentElement.contains(currentNode)) {\n\t\t\treturn offset;\n\t\t}\n\n\n\t\t// count the number of chars before the current dom elem and the start of the dom\n\t\tlet prevSibling = currentNode.previousSibling;\n\t\twhile (prevSibling) {\n\t\t\toffset += getTextContentLength(prevSibling);\n\t\t\tprevSibling = prevSibling.previousSibling;\n\t\t}\n\n\t\treturn offset + getSelectionOffsetRelativeTo(parentElement, currentNode.parentNode);\n\t}\n\n\tconst find = (query: string, options: { wholeWord?: boolean; caseSensitive?: boolean; includeMarkup: boolean; includeOutput: boolean; shouldGetSearchPreviewInfo: boolean; ownerID: string; findIds: string[] }) => {\n\t\tlet find = true;\n\t\tlet matches: IFindMatch[] = [];\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(window.document.getElementById('findStart')!);\n\t\tconst sel = window.getSelection();\n\t\tsel?.removeAllRanges();\n\t\tsel?.addRange(range);\n\n\t\tviewModel.toggleDragDropEnabled(false);\n\n\t\ttry {\n\t\t\tdocument.designMode = 'On';\n\n\t\t\twhile (find && matches.length < 500) {\n\t\t\t\tfind = (window as any).find(query, /* caseSensitive*/ !!options.caseSensitive,\n\t\t\t\t/* backwards*/ false,\n\t\t\t\t/* wrapAround*/ false,\n\t\t\t\t/* wholeWord */ !!options.wholeWord,\n\t\t\t\t/* searchInFrames*/ true,\n\t\t\t\t\tfalse);\n\n\t\t\t\tif (find) {\n\t\t\t\t\tconst selection = window.getSelection();\n\t\t\t\t\tif (!selection) {\n\t\t\t\t\t\tconsole.log('no selection');\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Markdown preview are rendered in a shadow DOM.\n\t\t\t\t\tif (options.includeMarkup && selection.rangeCount > 0 && selection.getRangeAt(0).startContainer.nodeType === 1\n\t\t\t\t\t\t&& (selection.getRangeAt(0).startContainer as Element).classList.contains('markup')) {\n\t\t\t\t\t\t// markdown preview container\n\t\t\t\t\t\tconst preview = (selection.anchorNode?.firstChild as Element);\n\t\t\t\t\t\tconst root = preview.shadowRoot as ShadowRoot & { getSelection: () => Selection };\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection ? root?.getSelection() : null;\n\t\t\t\t\t\t// find the match in the shadow dom by checking the selection inside the shadow dom\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: 'preview',\n\t\t\t\t\t\t\t\tid: preview.id,\n\t\t\t\t\t\t\t\tcellId: preview.id,\n\t\t\t\t\t\t\t\tcontainer: preview,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(shadowSelection) : undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Outputs might be rendered inside a shadow DOM.\n\t\t\t\t\tif (options.includeOutput && selection.rangeCount > 0 && selection.getRangeAt(0).startContainer.nodeType === 1\n\t\t\t\t\t\t&& (selection.getRangeAt(0).startContainer as Element).classList.contains('output_container')) {\n\t\t\t\t\t\t// output container\n\t\t\t\t\t\tconst cellId = selection.getRangeAt(0).startContainer.parentElement!.id;\n\t\t\t\t\t\tconst outputNode = (selection.anchorNode?.firstChild as Element);\n\t\t\t\t\t\tconst root = outputNode.shadowRoot as ShadowRoot & { getSelection: () => Selection };\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection ? root?.getSelection() : null;\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: 'output',\n\t\t\t\t\t\t\t\tid: outputNode.id,\n\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\tcontainer: outputNode,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(shadowSelection) : undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst anchorNode = selection.anchorNode?.parentElement;\n\n\t\t\t\t\tif (anchorNode) {\n\t\t\t\t\t\tconst lastEl: any = matches.length ? matches[matches.length - 1] : null;\n\n\t\t\t\t\t\t// Optimization: avoid searching for the output container\n\t\t\t\t\t\tif (lastEl && lastEl.container.contains(anchorNode) && options.includeOutput) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: lastEl.type,\n\t\t\t\t\t\t\t\tid: lastEl.id,\n\t\t\t\t\t\t\t\tcellId: lastEl.cellId,\n\t\t\t\t\t\t\t\tcontainer: lastEl.container,\n\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\toriginalRange: selection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(selection) : undefined,\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Traverse up the DOM to find the container\n\t\t\t\t\t\t\tfor (let node = anchorNode as Element | null; node; node = node.parentElement) {\n\t\t\t\t\t\t\t\tif (!(node instanceof Element)) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (node.classList.contains('output') && options.includeOutput) {\n\t\t\t\t\t\t\t\t\t// inside output\n\t\t\t\t\t\t\t\t\tconst cellId = node.parentElement?.parentElement?.id;\n\t\t\t\t\t\t\t\t\tif (cellId) {\n\t\t\t\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\t\t\t\ttype: 'output',\n\t\t\t\t\t\t\t\t\t\t\tid: node.id,\n\t\t\t\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\t\t\t\tcontainer: node,\n\t\t\t\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\t\t\t\toriginalRange: selection.getRangeAt(0),\n\t\t\t\t\t\t\t\t\t\t\tsearchPreviewInfo: options.shouldGetSearchPreviewInfo ? extractSelectionLine(selection) : undefined,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (node.id === 'container' || node === window.document.body) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\n\n\t\tmatches = matches.filter(match => options.findIds.length ? options.findIds.includes(match.cellId) : true);\n\t\t_highlighter.addHighlights(matches, options.ownerID);\n\t\twindow.document.getSelection()?.removeAllRanges();\n\n\t\tviewModel.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\n\t\tdocument.designMode = 'Off';\n\n\t\tpostNotebookMessage('didFind', {\n\t\t\tmatches: matches.map((match, index) => ({\n\t\t\t\ttype: match.type,\n\t\t\t\tid: match.id,\n\t\t\t\tcellId: match.cellId,\n\t\t\t\tindex,\n\t\t\t\tsearchPreviewInfo: match.searchPreviewInfo,\n\t\t\t}))\n\t\t});\n\t};\n\n\tconst copyOutputImage = async (outputId: string, altOutputId: string, retries = 5) => {\n\t\tif (!window.document.hasFocus() && retries > 0) {\n\t\t\t// copyImage can be called from outside of the webview, which means this function may be running whilst the webview is gaining focus.\n\t\t\t// Since navigator.clipboard.write requires the document to be focused, we need to wait for focus.\n\t\t\t// We cannot use a listener, as there is a high chance the focus is gained during the setup of the listener resulting in us missing it.\n\t\t\tsetTimeout(() => { copyOutputImage(outputId, altOutputId, retries - 1); }, 50);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst outputElement = window.document.getElementById(outputId)\n\t\t\t\t?? window.document.getElementById(altOutputId);\n\n\t\t\tlet image = outputElement?.querySelector('img');\n\n\t\t\tif (!image) {\n\t\t\t\tconst svgImage = outputElement?.querySelector('svg.output-image') ??\n\t\t\t\t\toutputElement?.querySelector('div.svgContainerStyle > svg');\n\n\t\t\t\tif (svgImage) {\n\t\t\t\t\timage = new Image();\n\t\t\t\t\timage.src = 'data:image/svg+xml,' + encodeURIComponent(svgImage.outerHTML);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (image) {\n\t\t\t\tconst imageToCopy = image;\n\t\t\t\tawait navigator.clipboard.write([new ClipboardItem({\n\t\t\t\t\t'image/png': new Promise((resolve) => {\n\t\t\t\t\t\tconst canvas = document.createElement('canvas');\n\t\t\t\t\t\tcanvas.width = imageToCopy.naturalWidth;\n\t\t\t\t\t\tcanvas.height = imageToCopy.naturalHeight;\n\t\t\t\t\t\tconst context = canvas.getContext('2d');\n\t\t\t\t\t\tcontext!.drawImage(imageToCopy, 0, 0);\n\n\t\t\t\t\t\tcanvas.toBlob((blob) => {\n\t\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\t\tresolve(blob);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tconsole.error('No blob data to write to clipboard');\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tcanvas.remove();\n\t\t\t\t\t\t}, 'image/png');\n\t\t\t\t\t})\n\t\t\t\t})]);\n\t\t\t} else {\n\t\t\t\tconsole.error('Could not find image element to copy for output with id', outputId);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error('Could not copy image:', e);\n\t\t}\n\t};\n\n\twindow.addEventListener('message', async rawEvent => {\n\t\tconst event = rawEvent as ({ data: webviewMessages.ToWebviewMessage });\n\n\t\tswitch (event.data.type) {\n\t\t\tcase 'initializeMarkup': {\n\t\t\t\ttry {\n\t\t\t\t\tawait Promise.all(event.data.cells.map(info => viewModel.ensureMarkupCell(info)));\n\t\t\t\t} finally {\n\t\t\t\t\tdimensionUpdater.updateImmediately();\n\t\t\t\t\tpostNotebookMessage('initializedMarkup', { requestId: event.data.requestId });\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'createMarkupCell':\n\t\t\t\tviewModel.ensureMarkupCell(event.data.cell);\n\t\t\t\tbreak;\n\n\t\t\tcase 'showMarkupCell':\n\t\t\t\tviewModel.showMarkupCell(event.data.id, event.data.top, event.data.content, event.data.metadata);\n\t\t\t\tbreak;\n\n\t\t\tcase 'hideMarkupCells':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.hideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'unhideMarkupCells':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.unhideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'deleteMarkupCell':\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.deleteMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'updateSelectedMarkupCells':\n\t\t\t\tviewModel.updateSelectedCells(event.data.selectedCellIds);\n\t\t\t\tbreak;\n\n\t\t\tcase 'html': {\n\t\t\t\tconst data = event.data;\n\t\t\t\tif (data.createOnIdle) {\n\t\t\t\t\toutputRunner.enqueueIdle(data.outputId, signal => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutputRunner.enqueue(data.outputId, signal => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'view-scroll':\n\t\t\t\t{\n\t\t\t\t\t// const date = new Date();\n\t\t\t\t\t// console.log('----- will scroll ----  ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\n\t\t\t\t\tevent.data.widgets.forEach(widget => {\n\t\t\t\t\t\toutputRunner.enqueue(widget.outputId, () => {\n\t\t\t\t\t\t\tviewModel.updateOutputsScroll([widget]);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t\tviewModel.updateMarkupScrolls(event.data.markupCells);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\tcase 'clear':\n\t\t\t\trenderers.clearAll();\n\t\t\t\tviewModel.clearAll();\n\t\t\t\twindow.document.getElementById('container')!.innerText = '';\n\t\t\t\tbreak;\n\n\t\t\tcase 'clearOutput': {\n\t\t\t\tconst { cellId, rendererId, outputId } = event.data;\n\t\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\t\tviewModel.clearOutput(cellId, outputId, rendererId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'hideOutput': {\n\t\t\t\tconst { cellId, outputId } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.hideOutput(cellId);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'showOutput': {\n\t\t\t\tconst { outputId, cellTop, cellId, content } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.showOutput(cellId, outputId, cellTop);\n\t\t\t\t\tif (content) {\n\t\t\t\t\t\tviewModel.updateAndRerender(cellId, outputId, content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'copyImage': {\n\t\t\t\tawait copyOutputImage(event.data.outputId, event.data.altOutputId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'ack-dimension': {\n\t\t\t\tfor (const { cellId, outputId, height } of event.data.updates) {\n\t\t\t\t\tviewModel.updateOutputHeight(cellId, outputId, height);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'preload': {\n\t\t\t\tconst resources = event.data.resources;\n\t\t\t\tfor (const { uri } of resources) {\n\t\t\t\t\tkernelPreloads.load(uri);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'updateRenderers': {\n\t\t\t\tconst { rendererData } = event.data;\n\t\t\t\trenderers.updateRendererData(rendererData);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'focus-output':\n\t\t\t\tfocusFirstFocusableOrContainerInOutput(event.data.cellOrOutputId, event.data.alternateId);\n\t\t\t\tbreak;\n\t\t\tcase 'blur-output':\n\t\t\t\tblurOutput();\n\t\t\t\tbreak;\n\t\t\tcase 'select-output-contents':\n\t\t\t\tselectOutputContents(event.data.cellOrOutputId);\n\t\t\t\tbreak;\n\t\t\tcase 'select-input-contents':\n\t\t\t\tselectInputContents(event.data.cellOrOutputId);\n\t\t\t\tbreak;\n\t\t\tcase 'decorations': {\n\t\t\t\tlet outputContainer = window.document.getElementById(event.data.cellId);\n\t\t\t\tif (!outputContainer) {\n\t\t\t\t\tviewModel.ensureOutputCell(event.data.cellId, -100000, true);\n\t\t\t\t\toutputContainer = window.document.getElementById(event.data.cellId);\n\t\t\t\t}\n\t\t\t\toutputContainer?.classList.add(...event.data.addedClassNames);\n\t\t\t\toutputContainer?.classList.remove(...event.data.removedClassNames);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'customKernelMessage':\n\t\t\t\tonDidReceiveKernelMessage.fire(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase 'customRendererMessage':\n\t\t\t\trenderers.getRenderer(event.data.rendererId)?.receiveMessage(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase 'notebookStyles': {\n\t\t\t\tconst documentStyle = window.document.documentElement.style;\n\n\t\t\t\tfor (let i = documentStyle.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst property = documentStyle[i];\n\n\t\t\t\t\t// Don't remove properties that the webview might have added separately\n\t\t\t\t\tif (property && property.startsWith('--notebook-')) {\n\t\t\t\t\t\tdocumentStyle.removeProperty(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Re-add new properties\n\t\t\t\tfor (const [name, value] of Object.entries(event.data.styles)) {\n\t\t\t\t\tdocumentStyle.setProperty(`--${name}`, value);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'notebookOptions':\n\t\t\t\tcurrentOptions = event.data.options;\n\t\t\t\tviewModel.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\t\t\t\tcurrentRenderOptions = event.data.renderOptions;\n\t\t\t\tsettingChange.fire(currentRenderOptions);\n\t\t\t\tbreak;\n\t\t\tcase 'tokenizedCodeBlock': {\n\t\t\t\tconst { codeBlockId, html } = event.data;\n\t\t\t\tMarkdownCodeBlock.highlightCodeBlock(codeBlockId, html);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'tokenizedStylesChanged': {\n\t\t\t\ttokenizationStyle.replaceSync(event.data.css);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'find': {\n\t\t\t\t_highlighter.removeHighlights(event.data.options.ownerID);\n\t\t\t\tfind(event.data.query, event.data.options);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findHighlightCurrent': {\n\t\t\t\t_highlighter?.highlightCurrentMatch(event.data.index, event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findUnHighlightCurrent': {\n\t\t\t\t_highlighter?.unHighlightCurrentMatch(event.data.index, event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'findStop': {\n\t\t\t\t_highlighter.removeHighlights(event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase 'returnOutputItem': {\n\t\t\t\toutputItemRequests.resolveOutputItem(event.data.requestId, event.data.output);\n\t\t\t}\n\t\t}\n\t});\n\n\tconst renderFallbackErrorName = 'vscode.fallbackToNextRenderer';\n\n\tclass Renderer {\n\n\t\tprivate _onMessageEvent = createEmitter();\n\t\tprivate _loadPromise?: Promise<rendererApi.RendererApi | undefined>;\n\t\tprivate _api: rendererApi.RendererApi | undefined;\n\n\t\tconstructor(\n\t\t\tpublic readonly data: webviewMessages.RendererMetadata,\n\t\t) { }\n\n\t\tpublic receiveMessage(message: unknown) {\n\t\t\tthis._onMessageEvent.fire(message);\n\t\t}\n\n\t\tpublic async renderOutputItem(item: rendererApi.OutputItem, element: HTMLElement, signal: AbortSignal): Promise<void> {\n\t\t\ttry {\n\t\t\t\tawait this.load();\n\t\t\t} catch (e) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(`Error loading renderer '${this.data.id}'`, element, e instanceof Error ? [e] : []);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._api) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(`Renderer '${this.data.id}' does not implement renderOutputItem`, element, []);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst renderStart = performance.now();\n\t\t\t\tawait this._api.renderOutputItem(item, element, signal);\n\t\t\t\tthis.postDebugMessage('Rendered output item', { id: item.id, duration: `${performance.now() - renderStart}ms` });\n\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\tshowRenderError(`Error rendering output item using '${this.data.id}'`, element, e instanceof Error ? [e] : []);\n\t\t\t\tthis.postDebugMessage('Rendering output item failed', { id: item.id, error: e + '' });\n\t\t\t}\n\t\t}\n\n\t\tpublic disposeOutputItem(id?: string): void {\n\t\t\tthis._api?.disposeOutputItem?.(id);\n\t\t}\n\n\t\tprivate createRendererContext(): RendererContext {\n\t\t\tconst { id, messaging } = this.data;\n\t\t\tconst context: RendererContext = {\n\t\t\t\tsetState: newState => vscode.setState({ ...vscode.getState(), [id]: newState }),\n\t\t\t\tgetState: <T>() => {\n\t\t\t\t\tconst state = vscode.getState();\n\t\t\t\t\treturn typeof state === 'object' && state ? state[id] as T : undefined;\n\t\t\t\t},\n\t\t\t\tgetRenderer: async (id: string) => {\n\t\t\t\t\tconst renderer = renderers.getRenderer(id);\n\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (renderer._api) {\n\t\t\t\t\t\treturn renderer._api;\n\t\t\t\t\t}\n\t\t\t\t\treturn renderer.load();\n\t\t\t\t},\n\t\t\t\tworkspace: {\n\t\t\t\t\tget isTrusted() { return isWorkspaceTrusted; }\n\t\t\t\t},\n\t\t\t\tsettings: {\n\t\t\t\t\tget lineLimit() { return currentRenderOptions.lineLimit; },\n\t\t\t\t\tget outputScrolling() { return currentRenderOptions.outputScrolling; },\n\t\t\t\t\tget outputWordWrap() { return currentRenderOptions.outputWordWrap; },\n\t\t\t\t\tget linkifyFilePaths() { return currentRenderOptions.linkifyFilePaths; },\n\t\t\t\t\tget minimalError() { return currentRenderOptions.minimalError; },\n\t\t\t\t},\n\t\t\t\tget onDidChangeSettings() { return settingChange.event; }\n\t\t\t};\n\n\t\t\tif (messaging) {\n\t\t\t\tcontext.onDidReceiveMessage = this._onMessageEvent.event;\n\t\t\t\tcontext.postMessage = message => postNotebookMessage('customRendererMessage', { rendererId: id, message });\n\t\t\t}\n\n\t\t\treturn Object.freeze(context);\n\t\t}\n\n\t\tprivate load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis._loadPromise ??= this._load();\n\t\t\treturn this._loadPromise;\n\t\t}\n\n\t\t/** Inner function cached in the _loadPromise(). */\n\t\tprivate async _load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis.postDebugMessage('Start loading renderer');\n\n\t\t\ttry {\n\t\t\t\t// Preloads need to be loaded before loading renderers.\n\t\t\t\tawait kernelPreloads.waitForAllCurrent();\n\n\t\t\t\tconst importStart = performance.now();\n\t\t\t\tconst module: RendererModule = await __import(this.data.entrypoint.path);\n\t\t\t\tthis.postDebugMessage('Imported renderer', { duration: `${performance.now() - importStart}ms` });\n\n\t\t\t\tif (!module) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._api = await module.activate(this.createRendererContext());\n\t\t\t\tthis.postDebugMessage('Activated renderer', { duration: `${performance.now() - importStart}ms` });\n\n\t\t\t\tconst dependantRenderers = ctx.rendererData\n\t\t\t\t\t.filter(d => d.entrypoint.extends === this.data.id);\n\n\t\t\t\tif (dependantRenderers.length) {\n\t\t\t\t\tthis.postDebugMessage('Activating dependant renderers', { dependents: dependantRenderers.map(x => x.id).join(', ') });\n\t\t\t\t}\n\n\t\t\t\t// Load all renderers that extend this renderer\n\t\t\t\tawait Promise.all(dependantRenderers.map(async d => {\n\t\t\t\t\tconst renderer = renderers.getRenderer(d.id);\n\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\tthrow new Error(`Could not find extending renderer: ${d.id}`);\n\t\t\t\t\t}\n\n\t\t\t\t\ttry {\n\t\t\t\t\t\treturn await renderer.load();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t// Squash any errors extends errors. They won't prevent the renderer\n\t\t\t\t\t\t// itself from working, so just log them.\n\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\tthis.postDebugMessage('Activating dependant renderer failed', { dependent: d.id, error: e + '' });\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t}));\n\n\t\t\t\treturn this._api;\n\t\t\t} catch (e) {\n\t\t\t\tthis.postDebugMessage('Loading renderer failed');\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\tprivate postDebugMessage(msg: string, data?: Record<string, string>) {\n\t\t\tpostNotebookMessage<webviewMessages.ILogRendererDebugMessage>('logRendererDebugMessage', {\n\t\t\t\tmessage: `[renderer ${this.data.id}] - ${msg}`,\n\t\t\t\tdata\n\t\t\t});\n\t\t}\n\t}\n\n\tconst kernelPreloads = new class {\n\t\tprivate readonly preloads = new Map<string /* uri */, Promise<unknown>>();\n\n\t\t/**\n\t\t * Returns a promise that resolves when the given preload is activated.\n\t\t */\n\t\tpublic waitFor(uri: string) {\n\t\t\treturn this.preloads.get(uri) || Promise.resolve(new Error(`Preload not ready: ${uri}`));\n\t\t}\n\n\t\t/**\n\t\t * Loads a preload.\n\t\t * @param uri URI to load from\n\t\t * @param originalUri URI to show in an error message if the preload is invalid.\n\t\t */\n\t\tpublic load(uri: string) {\n\t\t\tconst promise = Promise.all([\n\t\t\t\trunKernelPreload(uri),\n\t\t\t\tthis.waitForAllCurrent(),\n\t\t\t]);\n\n\t\t\tthis.preloads.set(uri, promise);\n\t\t\treturn promise;\n\t\t}\n\n\t\t/**\n\t\t * Returns a promise that waits for all currently-registered preloads to\n\t\t * activate before resolving.\n\t\t */\n\t\tpublic waitForAllCurrent() {\n\t\t\treturn Promise.all([...this.preloads.values()].map(p => p.catch(err => err)));\n\t\t}\n\t};\n\n\tconst outputRunner = new class {\n\t\tprivate readonly outputs = new Map<string, { abort: AbortController; queue: Promise<unknown> }>();\n\n\t\t/**\n\t\t * Pushes the action onto the list of actions for the given output ID,\n\t\t * ensuring that it's run in-order.\n\t\t */\n\t\tpublic enqueue(outputId: string, action: (cancelSignal: AbortSignal) => unknown) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst record = this.outputs.get(outputId);\n\t\t\tif (!record) {\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.outputs.set(outputId, { abort: controller, queue: new Promise(r => r(action(controller.signal))) });\n\t\t\t} else {\n\t\t\t\trecord.queue = record.queue.then(async r => {\n\t\t\t\t\tif (!record.abort.signal.aborted) {\n\t\t\t\t\t\tawait action(record.abort.signal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tprivate pendingOutputCreationRequest: Map<string, IDisposable> = new Map();\n\n\t\tpublic enqueueIdle(outputId: string, action: (cancelSignal: AbortSignal) => unknown) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\toutputRunner.pendingOutputCreationRequest.set(outputId, runWhenIdle(() => {\n\t\t\t\toutputRunner.enqueue(outputId, action);\n\t\t\t\toutputRunner.pendingOutputCreationRequest.delete(outputId);\n\t\t\t}));\n\t\t}\n\n\t\t/**\n\t\t * Cancels the rendering of all outputs.\n\t\t */\n\t\tpublic cancelAll() {\n\t\t\t// Delete all pending idle requests\n\t\t\tthis.pendingOutputCreationRequest.forEach(r => r.dispose());\n\t\t\tthis.pendingOutputCreationRequest.clear();\n\n\t\t\tfor (const { abort } of this.outputs.values()) {\n\t\t\t\tabort.abort();\n\t\t\t}\n\t\t\tthis.outputs.clear();\n\t\t}\n\n\t\t/**\n\t\t * Cancels any ongoing rendering out an output.\n\t\t */\n\t\tpublic cancelOutput(outputId: string) {\n\t\t\t// Delete the pending idle request if it exists\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst output = this.outputs.get(outputId);\n\t\t\tif (output) {\n\t\t\t\toutput.abort.abort();\n\t\t\t\tthis.outputs.delete(outputId);\n\t\t\t}\n\t\t}\n\t};\n\n\tconst renderers = new class {\n\t\tprivate readonly _renderers = new Map</* id */ string, Renderer>();\n\n\t\tconstructor() {\n\t\t\tfor (const renderer of ctx.rendererData) {\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\t\t}\n\n\t\tpublic getRenderer(id: string): Renderer | undefined {\n\t\t\treturn this._renderers.get(id);\n\t\t}\n\n\t\tprivate rendererEqual(a: webviewMessages.RendererMetadata, b: webviewMessages.RendererMetadata) {\n\t\t\tif (a.id !== b.id || a.entrypoint.path !== b.entrypoint.path || a.entrypoint.extends !== b.entrypoint.extends || a.messaging !== b.messaging) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (a.mimeTypes.length !== b.mimeTypes.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < a.mimeTypes.length; i++) {\n\t\t\t\tif (a.mimeTypes[i] !== b.mimeTypes[i]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tpublic updateRendererData(rendererData: readonly webviewMessages.RendererMetadata[]) {\n\t\t\tconst oldKeys = new Set(this._renderers.keys());\n\t\t\tconst newKeys = new Set(rendererData.map(d => d.id));\n\n\t\t\tfor (const renderer of rendererData) {\n\t\t\t\tconst existing = this._renderers.get(renderer.id);\n\t\t\t\tif (existing && this.rendererEqual(existing.data, renderer)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\n\t\t\tfor (const key of oldKeys) {\n\t\t\t\tif (!newKeys.has(key)) {\n\t\t\t\t\tthis._renderers.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate addRenderer(renderer: webviewMessages.RendererMetadata) {\n\t\t\tthis._renderers.set(renderer.id, new Renderer(renderer));\n\t\t}\n\n\t\tpublic clearAll() {\n\t\t\toutputRunner.cancelAll();\n\t\t\tfor (const renderer of this._renderers.values()) {\n\t\t\t\trenderer.disposeOutputItem();\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(rendererId: string, outputId: string) {\n\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\tthis._renderers.get(rendererId)?.disposeOutputItem(outputId);\n\t\t}\n\n\t\tpublic async render(item: ExtendedOutputItem, preferredRendererId: string | undefined, element: HTMLElement, signal: AbortSignal): Promise<void> {\n\t\t\tconst primaryRenderer = this.findRenderer(preferredRendererId, item);\n\t\t\tif (!primaryRenderer) {\n\t\t\t\tconst errorMessage = (window.document.documentElement.style.getPropertyValue('--notebook-cell-renderer-not-found-error') || '').replace('$0', () => item.mime);\n\t\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Try primary renderer first\n\t\t\tif (!(await this._doRender(item, element, primaryRenderer, signal)).continue) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Primary renderer failed in an expected way. Fallback to render the next mime types\n\t\t\tfor (const additionalItemData of item._allOutputItems) {\n\t\t\t\tif (additionalItemData.mime === item.mime) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst additionalItem = await additionalItemData.getItem();\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (additionalItem) {\n\t\t\t\t\tconst renderer = this.findRenderer(undefined, additionalItem);\n\t\t\t\t\tif (renderer) {\n\t\t\t\t\t\tif (!(await this._doRender(additionalItem, element, renderer, signal)).continue) {\n\t\t\t\t\t\t\treturn; // We rendered successfully\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// All renderers have failed and there is nothing left to fallback to\n\t\t\tconst errorMessage = (window.document.documentElement.style.getPropertyValue('--notebook-cell-renderer-fallbacks-exhausted') || '').replace('$0', () => item.mime);\n\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t}\n\n\t\tprivate async _doRender(item: rendererApi.OutputItem, element: HTMLElement, renderer: Renderer, signal: AbortSignal): Promise<{ continue: boolean }> {\n\t\t\ttry {\n\t\t\t\tawait renderer.renderOutputItem(item, element, signal);\n\t\t\t\treturn { continue: false }; // We rendered successfully\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn { continue: false };\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\treturn { continue: true };\n\t\t\t\t} else {\n\t\t\t\t\tthrow e; // Bail and let callers handle unknown errors\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate findRenderer(preferredRendererId: string | undefined, info: rendererApi.OutputItem) {\n\t\t\tlet renderer: Renderer | undefined;\n\n\t\t\tif (typeof preferredRendererId === 'string') {\n\t\t\t\trenderer = Array.from(this._renderers.values())\n\t\t\t\t\t.find((renderer) => renderer.data.id === preferredRendererId);\n\t\t\t} else {\n\t\t\t\tconst renderers = Array.from(this._renderers.values())\n\t\t\t\t\t.filter((renderer) => renderer.data.mimeTypes.includes(info.mime) && !renderer.data.entrypoint.extends);\n\n\t\t\t\tif (renderers.length) {\n\t\t\t\t\t// De-prioritize built-in renderers\n\t\t\t\t\trenderers.sort((a, b) => +a.data.isBuiltin - +b.data.isBuiltin);\n\n\t\t\t\t\t// Use first renderer we find in sorted list\n\t\t\t\t\trenderer = renderers[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn renderer;\n\t\t}\n\n\t\tprivate showRenderError(info: rendererApi.OutputItem, element: HTMLElement, errorMessage: string) {\n\t\t\tconst errorContainer = document.createElement('div');\n\n\t\t\tconst error = document.createElement('div');\n\t\t\terror.className = 'no-renderer-error';\n\t\t\terror.innerText = errorMessage;\n\n\t\t\tconst cellText = document.createElement('div');\n\t\t\tcellText.innerText = info.text();\n\n\t\t\terrorContainer.appendChild(error);\n\t\t\terrorContainer.appendChild(cellText);\n\n\t\t\telement.innerText = '';\n\t\t\telement.appendChild(errorContainer);\n\t\t}\n\t}();\n\n\tconst viewModel = new class ViewModel {\n\n\t\tprivate readonly _markupCells = new Map<string, MarkupCell>();\n\t\tprivate readonly _outputCells = new Map<string, OutputCell>();\n\n\t\tpublic clearAll() {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.dispose();\n\t\t\t}\n\t\t\tthis._markupCells.clear();\n\n\t\t\tfor (const output of this._outputCells.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis._outputCells.clear();\n\t\t}\n\n\t\tprivate async createMarkupCell(init: webviewMessages.IMarkupCellInitialization, top: number, visible: boolean): Promise<MarkupCell> {\n\t\t\tconst existing = this._markupCells.get(init.cellId);\n\t\t\tif (existing) {\n\t\t\t\tconsole.error(`Trying to create markup that already exists: ${init.cellId}`);\n\t\t\t\treturn existing;\n\t\t\t}\n\n\t\t\tconst cell = new MarkupCell(init.cellId, init.mime, init.content, top, init.metadata);\n\t\t\tcell.element.style.visibility = visible ? '' : 'hidden';\n\t\t\tthis._markupCells.set(init.cellId, cell);\n\n\t\t\tawait cell.ready;\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic async ensureMarkupCell(info: webviewMessages.IMarkupCellInitialization): Promise<void> {\n\t\t\tlet cell = this._markupCells.get(info.cellId);\n\t\t\tif (cell) {\n\t\t\t\tcell.element.style.visibility = info.visible ? '' : 'hidden';\n\t\t\t\tawait cell.updateContentAndRender(info.content, info.metadata);\n\t\t\t} else {\n\t\t\t\tcell = await this.createMarkupCell(info, info.offset, info.visible);\n\t\t\t}\n\t\t}\n\n\t\tpublic deleteMarkupCell(id: string) {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tif (cell) {\n\t\t\t\tcell.remove();\n\t\t\t\tcell.dispose();\n\t\t\t\tthis._markupCells.delete(id);\n\t\t\t}\n\t\t}\n\n\t\tpublic async updateMarkupContent(id: string, newContent: string, metadata: NotebookCellMetadata): Promise<void> {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tawait cell?.updateContentAndRender(newContent, metadata);\n\t\t}\n\n\t\tpublic showMarkupCell(id: string, top: number, newContent: string | undefined, metadata: NotebookCellMetadata | undefined): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.show(top, newContent, metadata);\n\t\t}\n\n\t\tpublic hideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic unhideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.unhide();\n\t\t}\n\n\t\tprivate getExpectedMarkupCell(id: string): MarkupCell | undefined {\n\t\t\tconst cell = this._markupCells.get(id);\n\t\t\tif (!cell) {\n\t\t\t\tconsole.log(`Could not find markup cell '${id}'`);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic updateSelectedCells(selectedCellIds: readonly string[]) {\n\t\t\tconst selectedCellSet = new Set<string>(selectedCellIds);\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.setSelected(selectedCellSet.has(cell.id));\n\t\t\t}\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(dragAndDropEnabled: boolean) {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.toggleDragDropEnabled(dragAndDropEnabled);\n\t\t\t}\n\t\t}\n\n\t\tpublic updateMarkupScrolls(markupCells: readonly webviewMessages.IMarkupCellScrollTops[]) {\n\t\t\tfor (const { id, top } of markupCells) {\n\t\t\t\tconst cell = this._markupCells.get(id);\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.element.style.top = `${top}px`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic async renderOutputCell(data: webviewMessages.ICreationRequestMessage, signal: AbortSignal): Promise<void> {\n\t\t\tconst preloadErrors = await Promise.all<undefined | Error>(\n\t\t\t\tdata.requiredPreloads.map(p => kernelPreloads.waitFor(p.uri).then(() => undefined, err => err))\n\t\t\t);\n\t\t\tif (signal.aborted) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst cellOutput = this.ensureOutputCell(data.cellId, data.cellTop, false);\n\t\t\treturn cellOutput.renderOutputElement(data, preloadErrors, signal);\n\t\t}\n\n\t\tpublic ensureOutputCell(cellId: string, cellTop: number, skipCellTopUpdateIfExist: boolean): OutputCell {\n\t\t\tlet cell = this._outputCells.get(cellId);\n\t\t\tconst existed = !!cell;\n\t\t\tif (!cell) {\n\t\t\t\tcell = new OutputCell(cellId);\n\t\t\t\tthis._outputCells.set(cellId, cell);\n\t\t\t}\n\n\t\t\tif (existed && skipCellTopUpdateIfExist) {\n\t\t\t\treturn cell;\n\t\t\t}\n\n\t\t\tcell.element.style.top = cellTop + 'px';\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic clearOutput(cellId: string, outputId: string, rendererId: string | undefined) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.clearOutput(outputId, rendererId);\n\t\t}\n\n\t\tpublic showOutput(cellId: string, outputId: string, top: number) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.show(outputId, top);\n\t\t}\n\n\t\tpublic updateAndRerender(cellId: string, outputId: string, content: webviewMessages.ICreationContent) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateContentAndRerender(outputId, content);\n\t\t}\n\n\t\tpublic hideOutput(cellId: string) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic updateOutputHeight(cellId: string, outputId: string, height: number) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateOutputHeight(outputId, height);\n\t\t}\n\n\t\tpublic updateOutputsScroll(updates: webviewMessages.IContentWidgetTopRequest[]) {\n\t\t\tfor (const request of updates) {\n\t\t\t\tconst cell = this._outputCells.get(request.cellId);\n\t\t\t\tcell?.updateScroll(request);\n\t\t\t}\n\t\t}\n\t}();\n\n\tclass MarkdownCodeBlock {\n\t\tprivate static pendingCodeBlocksToHighlight = new Map<string, HTMLElement>();\n\n\t\tpublic static highlightCodeBlock(id: string, html: string) {\n\t\t\tconst el = MarkdownCodeBlock.pendingCodeBlocksToHighlight.get(id);\n\t\t\tif (!el) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst trustedHtml = ttPolicy?.createHTML(html) ?? html;\n\t\t\tel.innerHTML = trustedHtml as string; // CodeQL [SM03712] The rendered content comes from VS Code's tokenizer and is considered safe\n\t\t\tconst root = el.getRootNode();\n\t\t\tif (root instanceof ShadowRoot) {\n\t\t\t\tif (!root.adoptedStyleSheets.includes(tokenizationStyle)) {\n\t\t\t\t\troot.adoptedStyleSheets.push(tokenizationStyle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic static requestHighlightCodeBlock(root: HTMLElement | ShadowRoot) {\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = [];\n\t\t\tlet i = 0;\n\t\t\tfor (const el of root.querySelectorAll('.vscode-code-block')) {\n\t\t\t\tconst lang = el.getAttribute('data-vscode-code-block-lang');\n\t\t\t\tif (el.textContent && lang) {\n\t\t\t\t\tconst id = `${Date.now()}-${i++}`;\n\t\t\t\t\tcodeBlocks.push({ value: el.textContent, lang: lang, id });\n\t\t\t\t\tMarkdownCodeBlock.pendingCodeBlocksToHighlight.set(id, el as HTMLElement);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn codeBlocks;\n\t\t}\n\t}\n\n\tclass MarkupCell {\n\n\t\tpublic readonly ready: Promise<void>;\n\n\t\tpublic readonly id: string;\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate readonly outputItem: ExtendedOutputItem;\n\n\t\t/// Internal field that holds text content\n\t\tprivate _content: { readonly value: string; readonly version: number; readonly metadata: NotebookCellMetadata };\n\n\t\tprivate _isDisposed = false;\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(id: string, mime: string, content: string, top: number, metadata: NotebookCellMetadata) {\n\t\t\tconst self = this;\n\t\t\tthis.id = id;\n\t\t\tthis._content = { value: content, version: 0, metadata: metadata };\n\n\t\t\tconst { promise, resolve, reject } = promiseWithResolvers<void>();\n\t\t\tthis.ready = promise;\n\n\t\t\tlet cachedData: { readonly version: number; readonly value: Uint8Array } | undefined;\n\t\t\tthis.outputItem = Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\n\t\t\t\tget metadata(): NotebookCellMetadata {\n\t\t\t\t\treturn self._content.metadata;\n\t\t\t\t},\n\n\t\t\t\ttext: (): string => {\n\t\t\t\t\treturn this._content.value;\n\t\t\t\t},\n\n\t\t\t\tjson: () => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata: (): Uint8Array => {\n\t\t\t\t\tif (cachedData?.version === this._content.version) {\n\t\t\t\t\t\treturn cachedData.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst data = textEncoder.encode(this._content.value);\n\t\t\t\t\tcachedData = { version: this._content.version, value: data };\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([this.data()], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\t_allOutputItems: [{\n\t\t\t\t\tmime,\n\t\t\t\t\tgetItem: async () => this.outputItem,\n\t\t\t\t}]\n\t\t\t});\n\n\t\t\tconst root = window.document.getElementById('container')!;\n\t\t\tconst markupCell = document.createElement('div');\n\t\t\tmarkupCell.className = 'markup';\n\t\t\tmarkupCell.style.position = 'absolute';\n\t\t\tmarkupCell.style.width = '100%';\n\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.id = this.id;\n\t\t\tthis.element.classList.add('preview');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.top = top + 'px';\n\t\t\tthis.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\t\t\tmarkupCell.appendChild(this.element);\n\t\t\troot.appendChild(markupCell);\n\n\t\t\tthis.addEventListeners();\n\n\t\t\tthis.updateContentAndRender(this._content.value, this._content.metadata).then(() => {\n\t\t\t\tif (!this._isDisposed) {\n\t\t\t\t\tresizeObserver.observe(this.element, this.id, false, this.id);\n\t\t\t\t}\n\t\t\t\tresolve();\n\t\t\t}, () => reject());\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._isDisposed = true;\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tprivate addEventListeners() {\n\t\t\tthis.element.addEventListener('dblclick', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IToggleMarkupPreviewMessage>('toggleMarkupPreview', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('click', e => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IClickMarkupCellMessage>('clickMarkupCell', {\n\t\t\t\t\tcellId: this.id,\n\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('contextmenu', e => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IContextMenuMarkupCellMessage>('contextMenuMarkupCell', {\n\t\t\t\t\tcellId: this.id,\n\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\tclientY: e.clientY,\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('mouseenter', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMarkupCellMessage>('mouseEnterMarkupCell', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('mouseleave', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMarkupCellMessage>('mouseLeaveMarkupCell', { cellId: this.id });\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('dragstart', e => {\n\t\t\t\tmarkupCellDragManager.startDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('drag', e => {\n\t\t\t\tmarkupCellDragManager.updateDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener('dragend', e => {\n\t\t\t\tmarkupCellDragManager.endDrag(e, this.id);\n\t\t\t});\n\t\t}\n\n\t\tpublic async updateContentAndRender(newContent: string, metadata: NotebookCellMetadata): Promise<void> {\n\t\t\tthis._content = { value: newContent, version: this._content.version + 1, metadata };\n\n\t\t\tthis.renderTaskAbort?.abort();\n\n\t\t\tconst controller = new AbortController();\n\t\t\tthis.renderTaskAbort = controller;\n\t\t\ttry {\n\t\t\t\tawait renderers.render(this.outputItem, undefined, this.element, this.renderTaskAbort.signal);\n\t\t\t} finally {\n\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst root = (this.element.shadowRoot ?? this.element);\n\t\t\tconst html = [];\n\t\t\tfor (const child of root.children) {\n\t\t\t\tswitch (child.tagName) {\n\t\t\t\t\tcase 'LINK':\n\t\t\t\t\tcase 'SCRIPT':\n\t\t\t\t\tcase 'STYLE':\n\t\t\t\t\t\t// not worth sending over since it will be stripped before rendering\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\thtml.push(child.outerHTML);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tpostNotebookMessage<webviewMessages.IRenderedMarkupMessage>('renderedMarkup', {\n\t\t\t\tcellId: this.id,\n\t\t\t\thtml: html.join(''),\n\t\t\t\tcodeBlocks\n\t\t\t});\n\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false\n\t\t\t});\n\t\t}\n\n\t\tpublic show(top: number, newContent: string | undefined, metadata: NotebookCellMetadata | undefined): void {\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.element.style.top = `${top}px`;\n\t\t\tif (typeof newContent === 'string' || metadata) {\n\t\t\t\tthis.updateContentAndRender(newContent ?? this._content.value, metadata ?? this._content.metadata);\n\t\t\t} else {\n\t\t\t\tthis.updateMarkupDimensions();\n\t\t\t}\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = 'hidden';\n\t\t}\n\n\t\tpublic unhide() {\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.updateMarkupDimensions();\n\t\t}\n\n\t\tpublic remove() {\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tprivate async updateMarkupDimensions() {\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false\n\t\t\t});\n\t\t}\n\n\t\tpublic setSelected(selected: boolean) {\n\t\t\tthis.element.classList.toggle('selected', selected);\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(enabled: boolean) {\n\t\t\tif (enabled) {\n\t\t\t\tthis.element.classList.add('draggable');\n\t\t\t\tthis.element.setAttribute('draggable', 'true');\n\t\t\t} else {\n\t\t\t\tthis.element.classList.remove('draggable');\n\t\t\t\tthis.element.removeAttribute('draggable');\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputCell {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate readonly outputElements = new Map</*outputId*/ string, OutputContainer>();\n\n\t\tconstructor(cellId: string) {\n\t\t\tconst container = window.document.getElementById('container')!;\n\n\t\t\tconst upperWrapperElement = createFocusSink(cellId);\n\t\t\tcontainer.appendChild(upperWrapperElement);\n\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.outline = '0';\n\n\t\t\tthis.element.id = cellId;\n\t\t\tthis.element.classList.add('cell_container');\n\n\t\t\tcontainer.appendChild(this.element);\n\t\t\tthis.element = this.element;\n\n\t\t\tconst lowerWrapperElement = createFocusSink(cellId, true);\n\t\t\tcontainer.appendChild(lowerWrapperElement);\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tfor (const output of this.outputElements.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis.outputElements.clear();\n\t\t}\n\n\t\tprivate createOutputElement(data: webviewMessages.ICreationRequestMessage): OutputElement {\n\t\t\tlet outputContainer = this.outputElements.get(data.outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\toutputContainer = new OutputContainer(data.outputId);\n\t\t\t\tthis.element.appendChild(outputContainer.element);\n\t\t\t\tthis.outputElements.set(data.outputId, outputContainer);\n\t\t\t}\n\n\t\t\treturn outputContainer.createOutputElement(data.outputId, data.outputOffset, data.left, data.cellId);\n\t\t}\n\n\t\tpublic async renderOutputElement(data: webviewMessages.ICreationRequestMessage, preloadErrors: ReadonlyArray<Error | undefined>, signal: AbortSignal) {\n\t\t\tconst startTime = Date.now();\n\t\t\tconst outputElement /** outputNode */ = this.createOutputElement(data);\n\t\t\tawait outputElement.render(data.content, data.rendererId, preloadErrors, signal);\n\n\t\t\t// don't hide until after this step so that the height is right\n\t\t\toutputElement/** outputNode */.element.style.visibility = data.initiallyHidden ? 'hidden' : '';\n\n\t\t\tif (!!data.executionId && !!data.rendererId) {\n\t\t\t\tlet outputSize: number | undefined = undefined;\n\t\t\t\tlet mimeType: string | undefined = undefined;\n\t\t\t\tif (data.content.type === 1 /* extension */) {\n\t\t\t\t\toutputSize = data.content.output.valueBytes.length;\n\t\t\t\t\tmimeType = data.content.output.mime;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<webviewMessages.IPerformanceMessage>('notebookPerformanceMessage', {\n\t\t\t\t\tcellId: data.cellId,\n\t\t\t\t\texecutionId: data.executionId,\n\t\t\t\t\tduration: Date.now() - startTime,\n\t\t\t\t\trendererId: data.rendererId,\n\t\t\t\t\toutputSize,\n\t\t\t\t\tmimeType\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(outputId: string, rendererId: string | undefined) {\n\t\t\tconst output = this.outputElements.get(outputId);\n\t\t\toutput?.clear(rendererId);\n\t\t\toutput?.dispose();\n\t\t\tthis.outputElements.delete(outputId);\n\t\t}\n\n\t\tpublic show(outputId: string, top: number) {\n\t\t\tconst outputContainer = this.outputElements.get(outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.element.style.visibility = '';\n\t\t\tthis.element.style.top = `${top}px`;\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = 'hidden';\n\t\t}\n\n\t\tpublic updateContentAndRerender(outputId: string, content: webviewMessages.ICreationContent) {\n\t\t\tthis.outputElements.get(outputId)?.updateContentAndRender(content);\n\t\t}\n\n\t\tpublic updateOutputHeight(outputId: string, height: number) {\n\t\t\tthis.outputElements.get(outputId)?.updateHeight(height);\n\t\t}\n\n\t\tpublic updateScroll(request: webviewMessages.IContentWidgetTopRequest) {\n\t\t\tthis.element.style.top = `${request.cellTop}px`;\n\n\t\t\tconst outputElement = this.outputElements.get(request.outputId);\n\t\t\tif (outputElement) {\n\t\t\t\toutputElement.updateScroll(request.outputOffset);\n\n\t\t\t\tif (request.forceDisplay && outputElement.outputNode) {\n\t\t\t\t\t// TODO @rebornix @mjbvz, there is a misalignment here.\n\t\t\t\t\t// We set output visibility on cell container, other than output container or output node itself.\n\t\t\t\t\toutputElement.outputNode.element.style.visibility = '';\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (request.forceDisplay) {\n\t\t\t\tthis.element.style.visibility = '';\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputContainer {\n\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate _outputNode?: OutputElement;\n\n\t\tget outputNode() {\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tconstructor(\n\t\t\tprivate readonly outputId: string,\n\t\t) {\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.classList.add('output_container');\n\t\t\tthis.element.setAttribute('data-vscode-context', JSON.stringify({ 'preventDefaultContextMenuItems': true }));\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.overflow = 'hidden';\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._outputNode?.dispose();\n\t\t}\n\n\t\tpublic clear(rendererId: string | undefined) {\n\t\t\tif (rendererId) {\n\t\t\t\trenderers.clearOutput(rendererId, this.outputId);\n\t\t\t}\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tpublic updateHeight(height: number) {\n\t\t\tthis.element.style.maxHeight = `${height}px`;\n\t\t\tthis.element.style.height = `${height}px`;\n\t\t}\n\n\t\tpublic updateScroll(outputOffset: number) {\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\t\t}\n\n\t\tpublic createOutputElement(outputId: string, outputOffset: number, left: number, cellId: string): OutputElement {\n\t\t\tthis.element.innerText = '';\n\t\t\tthis.element.style.maxHeight = '0px';\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\n\t\t\tthis._outputNode?.dispose();\n\t\t\tthis._outputNode = new OutputElement(outputId, left, cellId);\n\t\t\tthis.element.appendChild(this._outputNode.element);\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tpublic updateContentAndRender(content: webviewMessages.ICreationContent) {\n\t\t\tthis._outputNode?.updateAndRerender(content);\n\t\t}\n\t}\n\n\tvscode.postMessage({\n\t\t__vscode_notebook_message: true,\n\t\ttype: 'initialized'\n\t});\n\n\tfor (const preload of ctx.staticPreloadsData) {\n\t\tkernelPreloads.load(preload.entrypoint);\n\t}\n\n\tfunction postNotebookMessage<T extends webviewMessages.FromWebviewMessage>(\n\t\ttype: T['type'],\n\t\tproperties: Omit<T, '__vscode_notebook_message' | 'type'>\n\t) {\n\t\tvscode.postMessage({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype,\n\t\t\t...properties\n\t\t});\n\t}\n\n\tclass OutputElement {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate _content?: {\n\t\t\treadonly preferredRendererId: string | undefined;\n\t\t\treadonly preloadErrors: ReadonlyArray<Error | undefined>;\n\t\t};\n\t\tprivate hasResizeObserver = false;\n\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(\n\t\t\tprivate readonly outputId: string,\n\t\t\tleft: number,\n\t\t\tpublic readonly cellId: string\n\t\t) {\n\t\t\tthis.element = document.createElement('div');\n\t\t\tthis.element.id = outputId;\n\t\t\tthis.element.classList.add('output');\n\t\t\tthis.element.style.position = 'absolute';\n\t\t\tthis.element.style.top = `0px`;\n\t\t\tthis.element.style.left = left + 'px';\n\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\n\t\t\tthis.element.addEventListener('mouseenter', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMessage>('mouseenter', { id: outputId });\n\t\t\t});\n\t\t\tthis.element.addEventListener('mouseleave', () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMessage>('mouseleave', { id: outputId });\n\t\t\t});\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tpublic async render(content: webviewMessages.ICreationContent, preferredRendererId: string | undefined, preloadErrors: ReadonlyArray<Error | undefined>, signal?: AbortSignal) {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\n\t\t\tthis._content = { preferredRendererId, preloadErrors };\n\t\t\tif (content.type === 0 /* RenderOutputType.Html */) {\n\t\t\t\tconst trustedHtml = ttPolicy?.createHTML(content.htmlContent) ?? content.htmlContent;\n\t\t\t\tthis.element.innerHTML = trustedHtml as string;  // CodeQL [SM03712] The content comes from renderer extensions, not from direct user input.\n\t\t\t} else if (preloadErrors.some(e => e instanceof Error)) {\n\t\t\t\tconst errors = preloadErrors.filter((e): e is Error => e instanceof Error);\n\t\t\t\tshowRenderError(`Error loading preloads`, this.element, errors);\n\t\t\t} else {\n\t\t\t\tconst item = createOutputItem(this.outputId, content.output.mime, content.metadata, content.output.valueBytes, content.allOutputs, content.output.appended);\n\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.renderTaskAbort = controller;\n\n\t\t\t\t// Abort rendering if caller aborts\n\t\t\t\tsignal?.addEventListener('abort', () => controller.abort());\n\n\t\t\t\ttry {\n\t\t\t\t\tawait renderers.render(item, preferredRendererId, this.element, controller.signal);\n\t\t\t\t} finally {\n\t\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.hasResizeObserver) {\n\t\t\t\tthis.hasResizeObserver = true;\n\t\t\t\tresizeObserver.observe(this.element, this.outputId, true, this.cellId);\n\t\t\t}\n\n\t\t\tconst offsetHeight = this.element.offsetHeight;\n\t\t\tconst cps = document.defaultView!.getComputedStyle(this.element);\n\t\t\tconst verticalPadding = parseFloat(cps.paddingTop) + parseFloat(cps.paddingBottom);\n\t\t\tconst contentHeight = offsetHeight - verticalPadding;\n\t\t\tif (elementHasContent(contentHeight) && cps.padding === '0px') {\n\t\t\t\t// we set padding to zero if the output has no content (then we can have a zero-height output DOM node)\n\t\t\t\t// thus we need to ensure the padding is accounted when updating the init height of the output\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, offsetHeight + ctx.style.outputNodePadding * 2, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true\n\t\t\t\t});\n\n\t\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\t\t\t} else if (elementHasContent(contentHeight)) {\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, this.element.offsetHeight, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true\n\t\t\t\t});\n\t\t\t\tthis.element.style.padding = `0 ${ctx.style.outputNodePadding}px 0 ${ctx.style.outputNodeLeftPadding}`;\n\t\t\t} else {\n\t\t\t\t// we have a zero-height output DOM node\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, 0, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst root = this.element.shadowRoot ?? this.element;\n\t\t\tconst codeBlocks: Array<{ value: string; lang: string; id: string }> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tif (codeBlocks.length > 0) {\n\t\t\t\tpostNotebookMessage<webviewMessages.IRenderedCellOutputMessage>('renderedCellOutput', {\n\t\t\t\t\tcodeBlocks\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic updateAndRerender(content: webviewMessages.ICreationContent) {\n\t\t\tif (this._content) {\n\t\t\t\tthis.render(content, this._content.preferredRendererId, this._content.preloadErrors);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst markupCellDragManager = new class MarkupCellDragManager {\n\n\t\tprivate currentDrag: { cellId: string; clientY: number } | undefined;\n\n\t\t// Transparent overlay that prevents elements from inside the webview from eating\n\t\t// drag events.\n\t\tprivate dragOverlay?: HTMLElement;\n\n\t\tconstructor() {\n\t\t\twindow.document.addEventListener('dragover', e => {\n\t\t\t\t// Allow dropping dragged markup cells\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\twindow.document.addEventListener('drop', e => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst drag = this.currentDrag;\n\t\t\t\tif (!drag) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDropMessage>('cell-drop', {\n\t\t\t\t\tcellId: drag.cellId,\n\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\n\t\tstartDrag(e: DragEvent, cellId: string) {\n\t\t\tif (!e.dataTransfer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!currentOptions.dragAndDropEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\n\t\t\tconst overlayZIndex = 9999;\n\t\t\tif (!this.dragOverlay) {\n\t\t\t\tthis.dragOverlay = document.createElement('div');\n\t\t\t\tthis.dragOverlay.style.position = 'absolute';\n\t\t\t\tthis.dragOverlay.style.top = '0';\n\t\t\t\tthis.dragOverlay.style.left = '0';\n\t\t\t\tthis.dragOverlay.style.zIndex = `${overlayZIndex}`;\n\t\t\t\tthis.dragOverlay.style.width = '100%';\n\t\t\t\tthis.dragOverlay.style.height = '100%';\n\t\t\t\tthis.dragOverlay.style.background = 'transparent';\n\t\t\t\twindow.document.body.appendChild(this.dragOverlay);\n\t\t\t}\n\t\t\t(e.target as HTMLElement).style.zIndex = `${overlayZIndex + 1}`;\n\t\t\t(e.target as HTMLElement).classList.add('dragging');\n\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragStartMessage>('cell-drag-start', {\n\t\t\t\tcellId: cellId,\n\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t});\n\n\t\t\t// Continuously send updates while dragging instead of relying on `updateDrag`.\n\t\t\t// This lets us scroll the list based on drag position.\n\t\t\tconst trySendDragUpdate = () => {\n\t\t\t\tif (this.currentDrag?.cellId !== cellId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDragMessage>('cell-drag', {\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t\tdragOffsetY: this.currentDrag.clientY,\n\t\t\t\t});\n\t\t\t\twindow.requestAnimationFrame(trySendDragUpdate);\n\t\t\t};\n\t\t\twindow.requestAnimationFrame(trySendDragUpdate);\n\t\t}\n\n\t\tupdateDrag(e: DragEvent, cellId: string) {\n\t\t\tif (cellId !== this.currentDrag?.cellId) {\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t} else {\n\t\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\t\t\t}\n\t\t}\n\n\t\tendDrag(e: DragEvent, cellId: string) {\n\t\t\tthis.currentDrag = undefined;\n\t\t\t(e.target as HTMLElement).classList.remove('dragging');\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragEndMessage>('cell-drag-end', {\n\t\t\t\tcellId: cellId\n\t\t\t});\n\n\t\t\tif (this.dragOverlay) {\n\t\t\t\tthis.dragOverlay.remove();\n\t\t\t\tthis.dragOverlay = undefined;\n\t\t\t}\n\n\t\t\t(e.target as HTMLElement).style.zIndex = '';\n\t\t}\n\t}();\n}\n\nexport function preloadsScriptStr(styleValues: PreloadStyles, options: PreloadOptions, renderOptions: RenderOptions, renderers: readonly webviewMessages.RendererMetadata[], preloads: readonly webviewMessages.StaticPreloadMetadata[], isWorkspaceTrusted: boolean, nonce: string) {\n\tconst ctx: PreloadContext = {\n\t\tstyle: styleValues,\n\t\toptions,\n\t\trenderOptions,\n\t\trendererData: renderers,\n\t\tstaticPreloadsData: preloads,\n\t\tisWorkspaceTrusted,\n\t\tnonce,\n\t};\n\t// TS will try compiling `import()` in webviewPreloads, so use a helper function instead\n\t// of using `import(...)` directly\n\treturn `\n\t\tconst __import = (x) => import(x);\n\t\t(${webviewPreloads})(\n\t\t\tJSON.parse(decodeURIComponent(\"${encodeURIComponent(JSON.stringify(ctx))}\"))\n\t\t)\\n//# sourceURL=notebookWebviewPreloads.js\\n`;\n}\n\nexport function isEditableElement(element: Element): boolean {\n\treturn element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea' || 'editContext' in element;\n}\n"],
  "mappings": "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",
  "names": ["range", "nodes", "tagName", "attributes", "id", "mime", "metadata", "valueBytes", "appended", "item", "find", "errorMessage", "renderer", "renderers"]
}
