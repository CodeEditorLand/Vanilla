{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/renderers/webviewPreloads.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as rendererApi from \"vscode-notebook-renderer\";\nimport type { Event } from \"../../../../../../base/common/event.js\";\nimport type { IDisposable } from \"../../../../../../base/common/lifecycle.js\";\nimport type { NotebookCellMetadata } from \"../../../common/notebookCommon.js\";\nimport type * as webviewMessages from \"./webviewMessages.js\";\n\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n// import { RenderOutputType } from 'vs/workbench/contrib/notebook/browser/notebookBrowser';\n// We can ONLY IMPORT as type in this module. This also applies to const enums that would evaporate\n// in normal compiles but remain a dependency in transpile-only compiles\n// !! IMPORTANT !! ----------------------------------------------------------------------------------\n\n// !! IMPORTANT !! everything must be in-line within the webviewPreloads\n// function. Imports are not allowed. This is stringified and injected into\n// the webview.\n\ndeclare namespace globalThis {\n\tconst acquireVsCodeApi: () => {\n\t\tgetState(): { [key: string]: unknown };\n\t\tsetState(data: { [key: string]: unknown }): void;\n\t\tpostMessage: (msg: unknown) => void;\n\t};\n}\n\ndeclare class ResizeObserver {\n\tconstructor(\n\t\tonChange: (\n\t\t\tentries: { target: HTMLElement; contentRect?: ClientRect }[],\n\t\t) => void,\n\t);\n\tobserve(element: Element): void;\n\tdisconnect(): void;\n}\n\ndeclare class Highlight {\n\tconstructor();\n\tadd(range: AbstractRange): void;\n\tclear(): void;\n\tpriority: number;\n}\n\ninterface CSSHighlights {\n\tset(rule: string, highlight: Highlight): void;\n}\ndeclare namespace CSS {\n\tlet highlights: CSSHighlights | undefined;\n}\n\ntype Listener<T> = { fn: (evt: T) => void; thisArg: unknown };\n\ninterface EmitterLike<T> {\n\tfire(data: T): void;\n\tevent: Event<T>;\n}\n\ninterface PreloadStyles {\n\treadonly outputNodePadding: number;\n\treadonly outputNodeLeftPadding: number;\n\treadonly tokenizationCss: string;\n}\n\nexport interface PreloadOptions {\n\tdragAndDropEnabled: boolean;\n}\n\nexport interface RenderOptions {\n\treadonly lineLimit: number;\n\treadonly outputScrolling: boolean;\n\treadonly outputWordWrap: boolean;\n\treadonly linkifyFilePaths: boolean;\n\treadonly minimalError: boolean;\n}\n\ninterface PreloadContext {\n\treadonly nonce: string;\n\treadonly style: PreloadStyles;\n\treadonly options: PreloadOptions;\n\treadonly renderOptions: RenderOptions;\n\treadonly rendererData: readonly webviewMessages.RendererMetadata[];\n\treadonly staticPreloadsData: readonly webviewMessages.StaticPreloadMetadata[];\n\treadonly isWorkspaceTrusted: boolean;\n}\n\ndeclare function requestIdleCallback(\n\tcallback: (args: IdleDeadline) => void,\n\toptions?: { timeout: number },\n): number;\ndeclare function cancelIdleCallback(handle: number): void;\n\ndeclare function __import(path: string): Promise<any>;\n\nasync function webviewPreloads(ctx: PreloadContext) {\n\t/* eslint-disable no-restricted-globals, no-restricted-syntax */\n\n\t// The use of global `window` should be fine in this context, even\n\t// with aux windows. This code is running from within an `iframe`\n\t// where there is only one `window` object anyway.\n\n\tconst userAgent = navigator.userAgent;\n\tconst isChrome = userAgent.indexOf(\"Chrome\") >= 0;\n\tconst textEncoder = new TextEncoder();\n\tconst textDecoder = new TextDecoder();\n\n\tfunction promiseWithResolvers<T>(): {\n\t\tpromise: Promise<T>;\n\t\tresolve: (value: T | PromiseLike<T>) => void;\n\t\treject: (err?: any) => void;\n\t} {\n\t\tlet resolve: (value: T | PromiseLike<T>) => void;\n\t\tlet reject: (reason?: any) => void;\n\t\tconst promise = new Promise<T>((res, rej) => {\n\t\t\tresolve = res;\n\t\t\treject = rej;\n\t\t});\n\t\treturn { promise, resolve: resolve!, reject: reject! };\n\t}\n\n\tlet currentOptions = ctx.options;\n\tconst isWorkspaceTrusted = ctx.isWorkspaceTrusted;\n\tlet currentRenderOptions = ctx.renderOptions;\n\tconst settingChange: EmitterLike<RenderOptions> =\n\t\tcreateEmitter<RenderOptions>();\n\n\tconst acquireVsCodeApi = globalThis.acquireVsCodeApi;\n\tconst vscode = acquireVsCodeApi();\n\tdelete (globalThis as any).acquireVsCodeApi;\n\n\tconst tokenizationStyle = new CSSStyleSheet();\n\ttokenizationStyle.replaceSync(ctx.style.tokenizationCss);\n\n\tconst runWhenIdle: (\n\t\tcallback: (idle: IdleDeadline) => void,\n\t\ttimeout?: number,\n\t) => IDisposable =\n\t\ttypeof requestIdleCallback !== \"function\" ||\n\t\ttypeof cancelIdleCallback !== \"function\"\n\t\t\t? (runner) => {\n\t\t\t\t\tsetTimeout(() => {\n\t\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tconst end = Date.now() + 15; // one frame at 64fps\n\t\t\t\t\t\trunner(\n\t\t\t\t\t\t\tObject.freeze({\n\t\t\t\t\t\t\t\tdidTimeout: true,\n\t\t\t\t\t\t\t\ttimeRemaining() {\n\t\t\t\t\t\t\t\t\treturn Math.max(0, end - Date.now());\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\tlet disposed = false;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdispose() {\n\t\t\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisposed = true;\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t}\n\t\t\t: (runner, timeout?) => {\n\t\t\t\t\tconst handle: number = requestIdleCallback(\n\t\t\t\t\t\trunner,\n\t\t\t\t\t\ttypeof timeout === \"number\" ? { timeout } : undefined,\n\t\t\t\t\t);\n\t\t\t\t\tlet disposed = false;\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdispose() {\n\t\t\t\t\t\t\tif (disposed) {\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tdisposed = true;\n\t\t\t\t\t\t\tcancelIdleCallback(handle);\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t};\n\tfunction getOutputContainer(event: FocusEvent | MouseEvent) {\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (\n\t\t\t\tnode instanceof HTMLElement &&\n\t\t\t\tnode.classList.contains(\"output\")\n\t\t\t) {\n\t\t\t\treturn {\n\t\t\t\t\tid: node.id,\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\treturn;\n\t}\n\tlet lastFocusedOutput: { id: string } | undefined;\n\tconst handleOutputFocusOut = (event: FocusEvent) => {\n\t\tconst outputFocus = event && getOutputContainer(event);\n\t\tif (!outputFocus) {\n\t\t\treturn;\n\t\t}\n\t\t// Possible we're tabbing through the elements of the same output.\n\t\t// Lets see if focus is set back to the same output.\n\t\tlastFocusedOutput = undefined;\n\t\tsetTimeout(() => {\n\t\t\tif (lastFocusedOutput?.id === outputFocus.id) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tpostNotebookMessage<webviewMessages.IOutputBlurMessage>(\n\t\t\t\t\"outputBlur\",\n\t\t\t\toutputFocus,\n\t\t\t);\n\t\t}, 0);\n\t};\n\n\t// check if an input element is focused within the output element\n\tconst checkOutputInputFocus = (e: FocusEvent) => {\n\t\tlastFocusedOutput = getOutputContainer(e);\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (!activeElement) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst id = lastFocusedOutput?.id;\n\t\tif (\n\t\t\tid &&\n\t\t\t(isEditableElement(activeElement) ||\n\t\t\t\tactiveElement.tagName === \"SELECT\")\n\t\t) {\n\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>(\n\t\t\t\t\"outputInputFocus\",\n\t\t\t\t{ inputFocused: true, id },\n\t\t\t);\n\n\t\t\tactiveElement.addEventListener(\n\t\t\t\t\"blur\",\n\t\t\t\t() => {\n\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>(\n\t\t\t\t\t\t\"outputInputFocus\",\n\t\t\t\t\t\t{ inputFocused: false, id },\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t{ once: true },\n\t\t\t);\n\t\t}\n\t};\n\n\tconst handleInnerClick = (event: MouseEvent) => {\n\t\tif (!event || !event.view || !event.view.document) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst outputFocus = (lastFocusedOutput = getOutputContainer(event));\n\t\tfor (const node of event.composedPath()) {\n\t\t\tif (node instanceof HTMLAnchorElement && node.href) {\n\t\t\t\tif (node.href.startsWith(\"blob:\")) {\n\t\t\t\t\tif (outputFocus) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>(\n\t\t\t\t\t\t\t\"outputFocus\",\n\t\t\t\t\t\t\toutputFocus,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\thandleBlobUrlClick(node.href, node.download);\n\t\t\t\t} else if (node.href.startsWith(\"data:\")) {\n\t\t\t\t\tif (outputFocus) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>(\n\t\t\t\t\t\t\t\"outputFocus\",\n\t\t\t\t\t\t\toutputFocus,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\thandleDataUrl(node.href, node.download);\n\t\t\t\t} else if (node.getAttribute(\"href\")?.trim().startsWith(\"#\")) {\n\t\t\t\t\t// Scrolling to location within current doc\n\n\t\t\t\t\tif (!node.hash) {\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>(\n\t\t\t\t\t\t\t\"scroll-to-reveal\",\n\t\t\t\t\t\t\t{ scrollTop: 0 },\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst targetId = node.hash.substring(1);\n\n\t\t\t\t\t// Check outer document first\n\t\t\t\t\tlet scrollTarget: Element | null | undefined =\n\t\t\t\t\t\tevent.view.document.getElementById(targetId);\n\n\t\t\t\t\tif (!scrollTarget) {\n\t\t\t\t\t\t// Fallback to checking preview shadow doms\n\t\t\t\t\t\tfor (const preview of event.view.document.querySelectorAll(\n\t\t\t\t\t\t\t\".preview\",\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\tscrollTarget =\n\t\t\t\t\t\t\t\tpreview.shadowRoot?.getElementById(targetId);\n\t\t\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tif (scrollTarget) {\n\t\t\t\t\t\tconst scrollTop =\n\t\t\t\t\t\t\tscrollTarget.getBoundingClientRect().top +\n\t\t\t\t\t\t\tevent.view.scrollY;\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IScrollToRevealMessage>(\n\t\t\t\t\t\t\t\"scroll-to-reveal\",\n\t\t\t\t\t\t\t{ scrollTop },\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tconst href = node.getAttribute(\"href\");\n\t\t\t\t\tif (href) {\n\t\t\t\t\t\tif (href.startsWith(\"command:\") && outputFocus) {\n\t\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>(\n\t\t\t\t\t\t\t\t\"outputFocus\",\n\t\t\t\t\t\t\t\toutputFocus,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tpostNotebookMessage<webviewMessages.IClickedLinkMessage>(\n\t\t\t\t\t\t\t\"clicked-link\",\n\t\t\t\t\t\t\t{ href },\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\tevent.stopPropagation();\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\tif (outputFocus) {\n\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>(\n\t\t\t\t\"outputFocus\",\n\t\t\t\toutputFocus,\n\t\t\t);\n\t\t}\n\t};\n\n\tconst blurOutput = () => {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection) {\n\t\t\treturn;\n\t\t}\n\t\tselection.removeAllRanges();\n\t};\n\n\tconst selectOutputContents = (cellOrOutputId: string) => {\n\t\tconst selection = window.getSelection();\n\t\tif (!selection) {\n\t\t\treturn;\n\t\t}\n\t\tconst cellOutputContainer =\n\t\t\twindow.document.getElementById(cellOrOutputId);\n\t\tif (!cellOutputContainer) {\n\t\t\treturn;\n\t\t}\n\t\tselection.removeAllRanges();\n\t\tconst range = document.createRange();\n\t\trange.selectNode(cellOutputContainer);\n\t\tselection.addRange(range);\n\t};\n\n\tconst selectInputContents = (cellOrOutputId: string) => {\n\t\tconst cellOutputContainer =\n\t\t\twindow.document.getElementById(cellOrOutputId);\n\t\tif (!cellOutputContainer) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t(activeElement as HTMLInputElement).select();\n\t\t}\n\t};\n\n\tconst onPageUpDownSelectionHandler = (e: KeyboardEvent) => {\n\t\tif (!lastFocusedOutput?.id || !e.shiftKey) {\n\t\t\treturn;\n\t\t}\n\n\t\t// If we're pressing `Shift+Up/Down` then we want to select a line at a time.\n\t\tif (e.shiftKey && (e.code === \"ArrowUp\" || e.code === \"ArrowDown\")) {\n\t\t\te.stopPropagation(); // We don't want the notebook to handle this, default behavior is what we need.\n\t\t\treturn;\n\t\t}\n\n\t\t// We want to handle just `Shift + PageUp/PageDown` & `Shift + Cmd + ArrowUp/ArrowDown` (for mac)\n\t\tif (\n\t\t\t!(e.code === \"PageUp\" || e.code === \"PageDown\") &&\n\t\t\t!(e.metaKey && (e.code === \"ArrowDown\" || e.code === \"ArrowUp\"))\n\t\t) {\n\t\t\treturn;\n\t\t}\n\t\tconst outputContainer = window.document.getElementById(\n\t\t\tlastFocusedOutput.id,\n\t\t);\n\t\tconst selection = window.getSelection();\n\t\tif (!outputContainer || !selection?.anchorNode) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t// Leave for default behavior.\n\t\t\treturn;\n\t\t}\n\n\t\t// These should change the scroll position, not adjust the selected cell in the notebook\n\t\te.stopPropagation(); // We don't want the notebook to handle this.\n\t\te.preventDefault(); // We will handle selection.\n\n\t\tconst { anchorNode, anchorOffset } = selection;\n\t\tconst range = document.createRange();\n\t\tif (e.code === \"PageDown\" || e.code === \"ArrowDown\") {\n\t\t\trange.setStart(anchorNode, anchorOffset);\n\t\t\trange.setEnd(outputContainer, 1);\n\t\t} else {\n\t\t\trange.setStart(outputContainer, 0);\n\t\t\trange.setEnd(anchorNode, anchorOffset);\n\t\t}\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(range);\n\t};\n\n\tconst disableNativeSelectAll = (e: KeyboardEvent) => {\n\t\tif (!lastFocusedOutput?.id) {\n\t\t\treturn;\n\t\t}\n\t\tconst activeElement = window.document.activeElement;\n\t\tif (activeElement && isEditableElement(activeElement)) {\n\t\t\t// The input element will handle this.\n\t\t\treturn;\n\t\t}\n\n\t\tif ((e.key === \"a\" && e.ctrlKey) || (e.metaKey && e.key === \"a\")) {\n\t\t\te.preventDefault(); // We will handle selection in editor code.\n\t\t\treturn;\n\t\t}\n\t};\n\n\tconst handleDataUrl = async (\n\t\tdata: string | ArrayBuffer | null,\n\t\tdownloadName: string,\n\t) => {\n\t\tpostNotebookMessage<webviewMessages.IClickedDataUrlMessage>(\n\t\t\t\"clicked-data-url\",\n\t\t\t{\n\t\t\t\tdata,\n\t\t\t\tdownloadName,\n\t\t\t},\n\t\t);\n\t};\n\n\tconst handleBlobUrlClick = async (url: string, downloadName: string) => {\n\t\ttry {\n\t\t\tconst response = await fetch(url);\n\t\t\tconst blob = await response.blob();\n\t\t\tconst reader = new FileReader();\n\t\t\treader.addEventListener(\"load\", () => {\n\t\t\t\thandleDataUrl(reader.result, downloadName);\n\t\t\t});\n\t\t\treader.readAsDataURL(blob);\n\t\t} catch (e) {\n\t\t\tconsole.error(e.message);\n\t\t}\n\t};\n\n\twindow.document.body.addEventListener(\"click\", handleInnerClick);\n\twindow.document.body.addEventListener(\"focusin\", checkOutputInputFocus);\n\twindow.document.body.addEventListener(\"focusout\", handleOutputFocusOut);\n\twindow.document.body.addEventListener(\n\t\t\"keydown\",\n\t\tonPageUpDownSelectionHandler,\n\t);\n\twindow.document.body.addEventListener(\"keydown\", disableNativeSelectAll);\n\n\tinterface RendererContext extends rendererApi.RendererContext<unknown> {\n\t\treadonly onDidChangeSettings: Event<RenderOptions>;\n\t\treadonly settings: RenderOptions;\n\t}\n\n\tinterface RendererModule {\n\t\treadonly activate: rendererApi.ActivationFunction;\n\t}\n\n\tinterface KernelPreloadContext {\n\t\treadonly onDidReceiveKernelMessage: Event<unknown>;\n\t\tpostKernelMessage(data: unknown): void;\n\t}\n\n\tinterface KernelPreloadModule {\n\t\tactivate(ctx: KernelPreloadContext): Promise<void> | void;\n\t}\n\n\tinterface IObservedElement {\n\t\tid: string;\n\t\toutput: boolean;\n\t\tlastKnownPadding: number;\n\t\tlastKnownHeight: number;\n\t\tcellId: string;\n\t}\n\n\tfunction createKernelContext(): KernelPreloadContext {\n\t\treturn Object.freeze({\n\t\t\tonDidReceiveKernelMessage: onDidReceiveKernelMessage.event,\n\t\t\tpostKernelMessage: (data: unknown) =>\n\t\t\t\tpostNotebookMessage(\"customKernelMessage\", { message: data }),\n\t\t});\n\t}\n\n\tasync function runKernelPreload(url: string): Promise<void> {\n\t\ttry {\n\t\t\treturn await activateModuleKernelPreload(url);\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\n\tasync function activateModuleKernelPreload(url: string) {\n\t\tconst module: KernelPreloadModule = await __import(url);\n\t\tif (!module.activate) {\n\t\t\tconsole.error(\n\t\t\t\t`Notebook preload '${url}' was expected to be a module but it does not export an 'activate' function`,\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\t\treturn module.activate(createKernelContext());\n\t}\n\n\tconst dimensionUpdater = new (class {\n\t\tprivate readonly pending = new Map<\n\t\t\tstring,\n\t\t\twebviewMessages.DimensionUpdate\n\t\t>();\n\n\t\tupdateHeight(\n\t\t\tid: string,\n\t\t\theight: number,\n\t\t\toptions: { init?: boolean; isOutput?: boolean },\n\t\t) {\n\t\t\tif (!this.pending.size) {\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tthis.updateImmediately();\n\t\t\t\t}, 0);\n\t\t\t}\n\t\t\tconst update = this.pending.get(id);\n\t\t\tif (update && update.isOutput) {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\tinit: update.init,\n\t\t\t\t\tisOutput: update.isOutput,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tthis.pending.set(id, {\n\t\t\t\t\tid,\n\t\t\t\t\theight,\n\t\t\t\t\t...options,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tupdateImmediately() {\n\t\t\tif (!this.pending.size) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tpostNotebookMessage<webviewMessages.IDimensionMessage>(\n\t\t\t\t\"dimension\",\n\t\t\t\t{\n\t\t\t\t\tupdates: Array.from(this.pending.values()),\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis.pending.clear();\n\t\t}\n\t})();\n\n\tfunction elementHasContent(height: number) {\n\t\t// we need to account for a potential 1px top and bottom border on a child within the output container\n\t\treturn height > 2.1;\n\t}\n\n\tconst resizeObserver = new (class {\n\t\tprivate readonly _observer: ResizeObserver;\n\n\t\tprivate readonly _observedElements = new WeakMap<\n\t\t\tElement,\n\t\t\tIObservedElement\n\t\t>();\n\t\tprivate _outputResizeTimer: any;\n\n\t\tconstructor() {\n\t\t\tthis._observer = new ResizeObserver((entries) => {\n\t\t\t\tfor (const entry of entries) {\n\t\t\t\t\tif (!window.document.body.contains(entry.target)) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst observedElementInfo = this._observedElements.get(\n\t\t\t\t\t\tentry.target,\n\t\t\t\t\t);\n\t\t\t\t\tif (!observedElementInfo) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.postResizeMessage(observedElementInfo.cellId);\n\n\t\t\t\t\tif (entry.target.id !== observedElementInfo.id) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!entry.contentRect) {\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!observedElementInfo.output) {\n\t\t\t\t\t\t// markup, update directly\n\t\t\t\t\t\tthis.updateHeight(\n\t\t\t\t\t\t\tobservedElementInfo,\n\t\t\t\t\t\t\tentry.target.offsetHeight,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tcontinue;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst hasContent = elementHasContent(\n\t\t\t\t\t\tentry.contentRect.height,\n\t\t\t\t\t);\n\t\t\t\t\tconst shouldUpdatePadding =\n\t\t\t\t\t\t(hasContent &&\n\t\t\t\t\t\t\tobservedElementInfo.lastKnownPadding === 0) ||\n\t\t\t\t\t\t(!hasContent &&\n\t\t\t\t\t\t\tobservedElementInfo.lastKnownPadding !== 0);\n\n\t\t\t\t\tif (shouldUpdatePadding) {\n\t\t\t\t\t\t// Do not update dimension in resize observer\n\t\t\t\t\t\twindow.requestAnimationFrame(() => {\n\t\t\t\t\t\t\tif (hasContent) {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}px`;\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tentry.target.style.padding = `0px`;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tthis.updateHeight(\n\t\t\t\t\t\t\t\tobservedElementInfo,\n\t\t\t\t\t\t\t\thasContent ? entry.target.offsetHeight : 0,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.updateHeight(\n\t\t\t\t\t\t\tobservedElementInfo,\n\t\t\t\t\t\t\thasContent ? entry.target.offsetHeight : 0,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\tprivate updateHeight(\n\t\t\tobservedElementInfo: IObservedElement,\n\t\t\toffsetHeight: number,\n\t\t) {\n\t\t\tif (observedElementInfo.lastKnownHeight !== offsetHeight) {\n\t\t\t\tobservedElementInfo.lastKnownHeight = offsetHeight;\n\t\t\t\tdimensionUpdater.updateHeight(\n\t\t\t\t\tobservedElementInfo.id,\n\t\t\t\t\toffsetHeight,\n\t\t\t\t\t{\n\t\t\t\t\t\tisOutput: observedElementInfo.output,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic observe(\n\t\t\tcontainer: Element,\n\t\t\tid: string,\n\t\t\toutput: boolean,\n\t\t\tcellId: string,\n\t\t) {\n\t\t\tif (this._observedElements.has(container)) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._observedElements.set(container, {\n\t\t\t\tid,\n\t\t\t\toutput,\n\t\t\t\tlastKnownPadding: ctx.style.outputNodePadding,\n\t\t\t\tlastKnownHeight: -1,\n\t\t\t\tcellId,\n\t\t\t});\n\t\t\tthis._observer.observe(container);\n\t\t}\n\n\t\tprivate postResizeMessage(cellId: string) {\n\t\t\t// Debounce this callback to only happen after\n\t\t\t// 250 ms. Don't need resize events that often.\n\t\t\tclearTimeout(this._outputResizeTimer);\n\t\t\tthis._outputResizeTimer = setTimeout(() => {\n\t\t\t\tpostNotebookMessage(\"outputResized\", {\n\t\t\t\t\tcellId,\n\t\t\t\t});\n\t\t\t}, 250);\n\t\t}\n\t})();\n\n\tlet previousDelta: number | undefined;\n\tlet scrollTimeout: any /* NodeJS.Timeout */ | undefined;\n\tlet scrolledElement: Element | undefined;\n\tlet lastTimeScrolled: number | undefined;\n\tfunction flagRecentlyScrolled(node: Element, deltaY?: number) {\n\t\tscrolledElement = node;\n\t\tif (deltaY === undefined) {\n\t\t\tlastTimeScrolled = Date.now();\n\t\t\tpreviousDelta = undefined;\n\t\t\tnode.setAttribute(\"recentlyScrolled\", \"true\");\n\t\t\tclearTimeout(scrollTimeout);\n\t\t\tscrollTimeout = setTimeout(() => {\n\t\t\t\tscrolledElement?.removeAttribute(\"recentlyScrolled\");\n\t\t\t}, 300);\n\t\t\treturn true;\n\t\t}\n\n\t\tif (node.hasAttribute(\"recentlyScrolled\")) {\n\t\t\tif (lastTimeScrolled && Date.now() - lastTimeScrolled > 400) {\n\t\t\t\t// it has been a while since we actually scrolled\n\t\t\t\t// if scroll velocity increases significantly, it's likely a new scroll event\n\t\t\t\tif (\n\t\t\t\t\t!!previousDelta &&\n\t\t\t\t\tdeltaY < 0 &&\n\t\t\t\t\tdeltaY < previousDelta - 8\n\t\t\t\t) {\n\t\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\t\tscrolledElement?.removeAttribute(\"recentlyScrolled\");\n\t\t\t\t\treturn false;\n\t\t\t\t} else if (\n\t\t\t\t\t!!previousDelta &&\n\t\t\t\t\tdeltaY > 0 &&\n\t\t\t\t\tdeltaY > previousDelta + 8\n\t\t\t\t) {\n\t\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\t\tscrolledElement?.removeAttribute(\"recentlyScrolled\");\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\n\t\t\t\t// the tail end of a smooth scrolling event (from a trackpad) can go on for a while\n\t\t\t\t// so keep swallowing it, but we can shorten the timeout since the events occur rapidly\n\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\tscrollTimeout = setTimeout(() => {\n\t\t\t\t\tscrolledElement?.removeAttribute(\"recentlyScrolled\");\n\t\t\t\t}, 50);\n\t\t\t} else {\n\t\t\t\tclearTimeout(scrollTimeout);\n\t\t\t\tscrollTimeout = setTimeout(() => {\n\t\t\t\t\tscrolledElement?.removeAttribute(\"recentlyScrolled\");\n\t\t\t\t}, 300);\n\t\t\t}\n\n\t\t\tpreviousDelta = deltaY;\n\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tfunction eventTargetShouldHandleScroll(event: WheelEvent) {\n\t\tfor (\n\t\t\tlet node = event.target as Node | null;\n\t\t\tnode;\n\t\t\tnode = node.parentNode\n\t\t) {\n\t\t\tif (\n\t\t\t\t!(node instanceof Element) ||\n\t\t\t\tnode.id === \"container\" ||\n\t\t\t\tnode.classList.contains(\"cell_container\") ||\n\t\t\t\tnode.classList.contains(\"markup\") ||\n\t\t\t\tnode.classList.contains(\"output_container\")\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// scroll up\n\t\t\tif (event.deltaY < 0 && node.scrollTop > 0) {\n\t\t\t\t// there is still some content to scroll\n\t\t\t\tflagRecentlyScrolled(node);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// scroll down\n\t\t\tif (\n\t\t\t\tevent.deltaY > 0 &&\n\t\t\t\tnode.scrollTop + node.clientHeight < node.scrollHeight\n\t\t\t) {\n\t\t\t\t// per https://developer.mozilla.org/en-US/docs/Web/API/Element/scrollHeight\n\t\t\t\t// scrollTop is not rounded but scrollHeight and clientHeight are\n\t\t\t\t// so we need to check if the difference is less than some threshold\n\t\t\t\tif (\n\t\t\t\t\tnode.scrollHeight - node.scrollTop - node.clientHeight <\n\t\t\t\t\t2\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\t// if the node is not scrollable, we can continue. We don't check the computed style always as it's expensive\n\t\t\t\tif (\n\t\t\t\t\twindow.getComputedStyle(node).overflowY === \"hidden\" ||\n\t\t\t\t\twindow.getComputedStyle(node).overflowY === \"visible\"\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tflagRecentlyScrolled(node);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tif (flagRecentlyScrolled(node, event.deltaY)) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t}\n\n\tconst handleWheel = (\n\t\tevent: WheelEvent & {\n\t\t\twheelDeltaX?: number;\n\t\t\twheelDeltaY?: number;\n\t\t\twheelDelta?: number;\n\t\t},\n\t) => {\n\t\tif (event.defaultPrevented || eventTargetShouldHandleScroll(event)) {\n\t\t\treturn;\n\t\t}\n\t\tpostNotebookMessage<webviewMessages.IWheelMessage>(\"did-scroll-wheel\", {\n\t\t\tpayload: {\n\t\t\t\tdeltaMode: event.deltaMode,\n\t\t\t\tdeltaX: event.deltaX,\n\t\t\t\tdeltaY: event.deltaY,\n\t\t\t\tdeltaZ: event.deltaZ,\n\t\t\t\t// Refs https://github.com/microsoft/vscode/issues/146403#issuecomment-1854538928\n\t\t\t\twheelDelta:\n\t\t\t\t\tevent.wheelDelta && isChrome\n\t\t\t\t\t\t? event.wheelDelta / window.devicePixelRatio\n\t\t\t\t\t\t: event.wheelDelta,\n\t\t\t\twheelDeltaX:\n\t\t\t\t\tevent.wheelDeltaX && isChrome\n\t\t\t\t\t\t? event.wheelDeltaX / window.devicePixelRatio\n\t\t\t\t\t\t: event.wheelDeltaX,\n\t\t\t\twheelDeltaY:\n\t\t\t\t\tevent.wheelDeltaY && isChrome\n\t\t\t\t\t\t? event.wheelDeltaY / window.devicePixelRatio\n\t\t\t\t\t\t: event.wheelDeltaY,\n\t\t\t\tdetail: event.detail,\n\t\t\t\tshiftKey: event.shiftKey,\n\t\t\t\ttype: event.type,\n\t\t\t},\n\t\t});\n\t};\n\n\tfunction focusFirstFocusableOrContainerInOutput(\n\t\tcellOrOutputId: string,\n\t\talternateId?: string,\n\t) {\n\t\tconst cellOutputContainer =\n\t\t\twindow.document.getElementById(cellOrOutputId) ??\n\t\t\t(alternateId\n\t\t\t\t? window.document.getElementById(alternateId)\n\t\t\t\t: undefined);\n\t\tif (cellOutputContainer) {\n\t\t\tif (cellOutputContainer.contains(window.document.activeElement)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst id = cellOutputContainer.id;\n\t\t\tlet focusableElement = cellOutputContainer.querySelector(\n\t\t\t\t'[tabindex=\"0\"], [href], button, input, option, select, textarea',\n\t\t\t) as HTMLElement | null;\n\t\t\tif (focusableElement) {\n\t\t\t\tconst inputFocused = isEditableElement(focusableElement);\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>(\n\t\t\t\t\t\"outputInputFocus\",\n\t\t\t\t\t{ inputFocused, id },\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tfocusableElement = cellOutputContainer;\n\t\t\t\tfocusableElement.tabIndex = -1;\n\t\t\t\tpostNotebookMessage<webviewMessages.IOutputInputFocusMessage>(\n\t\t\t\t\t\"outputInputFocus\",\n\t\t\t\t\t{ inputFocused: false, id },\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tlastFocusedOutput = cellOutputContainer;\n\t\t\tpostNotebookMessage<webviewMessages.IOutputFocusMessage>(\n\t\t\t\t\"outputFocus\",\n\t\t\t\t{ id: cellOutputContainer.id },\n\t\t\t);\n\t\t\tfocusableElement.focus();\n\t\t}\n\t}\n\n\tfunction createFocusSink(cellId: string, focusNext?: boolean) {\n\t\tconst element = document.createElement(\"div\");\n\t\telement.id = `focus-sink-${cellId}`;\n\t\telement.tabIndex = 0;\n\t\telement.addEventListener(\"focus\", () => {\n\t\t\tpostNotebookMessage<webviewMessages.IFocusEditorMessage>(\n\t\t\t\t\"focus-editor\",\n\t\t\t\t{\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t\tfocusNext,\n\t\t\t\t},\n\t\t\t);\n\t\t});\n\n\t\treturn element;\n\t}\n\n\tfunction _internalHighlightRange(\n\t\trange: Range,\n\t\ttagName = \"mark\",\n\t\tattributes = {},\n\t) {\n\t\t// derived from https://github.com/Treora/dom-highlight-range/blob/master/highlight-range.js\n\n\t\t// Return an array of the text nodes in the range. Split the start and end nodes if required.\n\t\tfunction _textNodesInRange(range: Range): Text[] {\n\t\t\tif (!range.startContainer.ownerDocument) {\n\t\t\t\treturn [];\n\t\t\t}\n\n\t\t\t// If the start or end node is a text node and only partly in the range, split it.\n\t\t\tif (\n\t\t\t\trange.startContainer.nodeType === Node.TEXT_NODE &&\n\t\t\t\trange.startOffset > 0\n\t\t\t) {\n\t\t\t\tconst startContainer = range.startContainer as Text;\n\t\t\t\tconst endOffset = range.endOffset; // (this may get lost when the splitting the node)\n\t\t\t\tconst createdNode = startContainer.splitText(range.startOffset);\n\t\t\t\tif (range.endContainer === startContainer) {\n\t\t\t\t\t// If the end was in the same container, it will now be in the newly created node.\n\t\t\t\t\trange.setEnd(createdNode, endOffset - range.startOffset);\n\t\t\t\t}\n\n\t\t\t\trange.setStart(createdNode, 0);\n\t\t\t}\n\n\t\t\tif (\n\t\t\t\trange.endContainer.nodeType === Node.TEXT_NODE &&\n\t\t\t\trange.endOffset < (range.endContainer as Text).length\n\t\t\t) {\n\t\t\t\t(range.endContainer as Text).splitText(range.endOffset);\n\t\t\t}\n\n\t\t\t// Collect the text nodes.\n\t\t\tconst walker = range.startContainer.ownerDocument.createTreeWalker(\n\t\t\t\trange.commonAncestorContainer,\n\t\t\t\tNodeFilter.SHOW_TEXT,\n\t\t\t\t(node) =>\n\t\t\t\t\trange.intersectsNode(node)\n\t\t\t\t\t\t? NodeFilter.FILTER_ACCEPT\n\t\t\t\t\t\t: NodeFilter.FILTER_REJECT,\n\t\t\t);\n\n\t\t\twalker.currentNode = range.startContainer;\n\n\t\t\t// // Optimise by skipping nodes that are explicitly outside the range.\n\t\t\t// const NodeTypesWithCharacterOffset = [\n\t\t\t//  Node.TEXT_NODE,\n\t\t\t//  Node.PROCESSING_INSTRUCTION_NODE,\n\t\t\t//  Node.COMMENT_NODE,\n\t\t\t// ];\n\t\t\t// if (!NodeTypesWithCharacterOffset.includes(range.startContainer.nodeType)) {\n\t\t\t//   if (range.startOffset < range.startContainer.childNodes.length) {\n\t\t\t//     walker.currentNode = range.startContainer.childNodes[range.startOffset];\n\t\t\t//   } else {\n\t\t\t//     walker.nextSibling(); // TODO verify this is correct.\n\t\t\t//   }\n\t\t\t// }\n\n\t\t\tconst nodes: Text[] = [];\n\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t}\n\n\t\t\twhile (\n\t\t\t\twalker.nextNode() &&\n\t\t\t\trange.comparePoint(walker.currentNode, 0) !== 1\n\t\t\t) {\n\t\t\t\tif (walker.currentNode.nodeType === Node.TEXT_NODE) {\n\t\t\t\t\tnodes.push(walker.currentNode as Text);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn nodes;\n\t\t}\n\n\t\t// Replace [node] with <tagName ...attributes>[node]</tagName>\n\t\tfunction wrapNodeInHighlight(\n\t\t\tnode: Text,\n\t\t\ttagName: string,\n\t\t\tattributes: any,\n\t\t) {\n\t\t\tconst highlightElement = node.ownerDocument.createElement(tagName);\n\t\t\tObject.keys(attributes).forEach((key) => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t\tconst tempRange = node.ownerDocument.createRange();\n\t\t\ttempRange.selectNode(node);\n\t\t\ttempRange.surroundContents(highlightElement);\n\t\t\treturn highlightElement;\n\t\t}\n\n\t\tif (range.collapsed) {\n\t\t\treturn {\n\t\t\t\tremove: () => {},\n\t\t\t\tupdate: () => {},\n\t\t\t};\n\t\t}\n\n\t\t// First put all nodes in an array (splits start and end nodes if needed)\n\t\tconst nodes = _textNodesInRange(range);\n\n\t\t// Highlight each node\n\t\tconst highlightElements: Element[] = [];\n\t\tfor (const nodeIdx in nodes) {\n\t\t\tconst highlightElement = wrapNodeInHighlight(\n\t\t\t\tnodes[nodeIdx],\n\t\t\t\ttagName,\n\t\t\t\tattributes,\n\t\t\t);\n\t\t\thighlightElements.push(highlightElement);\n\t\t}\n\n\t\t// Remove a highlight element created with wrapNodeInHighlight.\n\t\tfunction _removeHighlight(highlightElement: Element) {\n\t\t\tif (highlightElement.childNodes.length === 1) {\n\t\t\t\thighlightElement.parentNode?.replaceChild(\n\t\t\t\t\thighlightElement.firstChild!,\n\t\t\t\t\thighlightElement,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t// If the highlight somehow contains multiple nodes now, move them all.\n\t\t\t\twhile (highlightElement.firstChild) {\n\t\t\t\t\thighlightElement.parentNode?.insertBefore(\n\t\t\t\t\t\thighlightElement.firstChild,\n\t\t\t\t\t\thighlightElement,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\thighlightElement.remove();\n\t\t\t}\n\t\t}\n\n\t\t// Return a function that cleans up the highlightElements.\n\t\tfunction _removeHighlights() {\n\t\t\t// Remove each of the created highlightElements.\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_removeHighlight(highlightElements[highlightIdx]);\n\t\t\t}\n\t\t}\n\n\t\tfunction _updateHighlight(\n\t\t\thighlightElement: Element,\n\t\t\tattributes: any = {},\n\t\t) {\n\t\t\tObject.keys(attributes).forEach((key) => {\n\t\t\t\thighlightElement.setAttribute(key, attributes[key]);\n\t\t\t});\n\t\t}\n\n\t\tfunction updateHighlights(attributes: any) {\n\t\t\tfor (const highlightIdx in highlightElements) {\n\t\t\t\t_updateHighlight(highlightElements[highlightIdx], attributes);\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\tremove: _removeHighlights,\n\t\t\tupdate: updateHighlights,\n\t\t};\n\t}\n\n\tinterface ICommonRange {\n\t\tcollapsed: boolean;\n\t\tcommonAncestorContainer: Node;\n\t\tendContainer: Node;\n\t\tendOffset: number;\n\t\tstartContainer: Node;\n\t\tstartOffset: number;\n\t}\n\n\tinterface IHighlightResult {\n\t\trange: ICommonRange;\n\t\tdispose: () => void;\n\t\tupdate: (\n\t\t\tcolor: string | undefined,\n\t\t\tclassName: string | undefined,\n\t\t) => void;\n\t}\n\n\tfunction selectRange(_range: ICommonRange) {\n\t\tconst sel = window.getSelection();\n\t\tif (sel) {\n\t\t\ttry {\n\t\t\t\tsel.removeAllRanges();\n\t\t\t\tconst r = document.createRange();\n\t\t\t\tr.setStart(_range.startContainer, _range.startOffset);\n\t\t\t\tr.setEnd(_range.endContainer, _range.endOffset);\n\t\t\t\tsel.addRange(r);\n\t\t\t} catch (e) {\n\t\t\t\tconsole.log(e);\n\t\t\t}\n\t\t}\n\t}\n\n\tfunction highlightRange(\n\t\trange: Range,\n\t\tuseCustom: boolean,\n\t\ttagName = \"mark\",\n\t\tattributes = {},\n\t): IHighlightResult {\n\t\tif (useCustom) {\n\t\t\tconst ret = _internalHighlightRange(range, tagName, attributes);\n\t\t\treturn {\n\t\t\t\trange: range,\n\t\t\t\tdispose: ret.remove,\n\t\t\t\tupdate: (\n\t\t\t\t\tcolor: string | undefined,\n\t\t\t\t\tclassName: string | undefined,\n\t\t\t\t) => {\n\t\t\t\t\tif (className === undefined) {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\tstyle: `background-color: ${color}`,\n\t\t\t\t\t\t});\n\t\t\t\t\t} else {\n\t\t\t\t\t\tret.update({\n\t\t\t\t\t\t\tclass: className,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t} else {\n\t\t\twindow.document.execCommand(\"hiliteColor\", false, matchColor);\n\t\t\tconst cloneRange = window\n\t\t\t\t.getSelection()!\n\t\t\t\t.getRangeAt(0)\n\t\t\t\t.cloneRange();\n\t\t\tconst _range = {\n\t\t\t\tcollapsed: cloneRange.collapsed,\n\t\t\t\tcommonAncestorContainer: cloneRange.commonAncestorContainer,\n\t\t\t\tendContainer: cloneRange.endContainer,\n\t\t\t\tendOffset: cloneRange.endOffset,\n\t\t\t\tstartContainer: cloneRange.startContainer,\n\t\t\t\tstartOffset: cloneRange.startOffset,\n\t\t\t};\n\t\t\treturn {\n\t\t\t\trange: _range,\n\t\t\t\tdispose: () => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = \"On\";\n\t\t\t\t\t\twindow.document.execCommand(\n\t\t\t\t\t\t\t\"removeFormat\",\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdocument.designMode = \"Off\";\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tupdate: (\n\t\t\t\t\tcolor: string | undefined,\n\t\t\t\t\tclassName: string | undefined,\n\t\t\t\t) => {\n\t\t\t\t\tselectRange(_range);\n\t\t\t\t\ttry {\n\t\t\t\t\t\tdocument.designMode = \"On\";\n\t\t\t\t\t\twindow.document.execCommand(\n\t\t\t\t\t\t\t\"removeFormat\",\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t);\n\t\t\t\t\t\twindow.document.execCommand(\n\t\t\t\t\t\t\t\"hiliteColor\",\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tdocument.designMode = \"Off\";\n\t\t\t\t\t\twindow.getSelection()?.removeAllRanges();\n\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\tconsole.log(e);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\t}\n\n\tfunction createEmitter<T>(\n\t\tlistenerChange: (listeners: Set<Listener<T>>) => void = () => undefined,\n\t): EmitterLike<T> {\n\t\tconst listeners = new Set<Listener<T>>();\n\t\treturn {\n\t\t\tfire(data) {\n\t\t\t\tfor (const listener of [...listeners]) {\n\t\t\t\t\tlistener.fn.call(listener.thisArg, data);\n\t\t\t\t}\n\t\t\t},\n\t\t\tevent(fn, thisArg, disposables) {\n\t\t\t\tconst listenerObj = { fn, thisArg };\n\t\t\t\tconst disposable: IDisposable = {\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tlisteners.delete(listenerObj);\n\t\t\t\t\t\tlistenerChange(listeners);\n\t\t\t\t\t},\n\t\t\t\t};\n\n\t\t\t\tlisteners.add(listenerObj);\n\t\t\t\tlistenerChange(listeners);\n\n\t\t\t\tif (disposables instanceof Array) {\n\t\t\t\t\tdisposables.push(disposable);\n\t\t\t\t} else if (disposables) {\n\t\t\t\t\tdisposables.add(disposable);\n\t\t\t\t}\n\n\t\t\t\treturn disposable;\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction showRenderError(\n\t\terrorText: string,\n\t\toutputNode: HTMLElement,\n\t\terrors: readonly Error[],\n\t) {\n\t\toutputNode.innerText = errorText;\n\t\tconst errList = document.createElement(\"ul\");\n\t\tfor (const result of errors) {\n\t\t\tconsole.error(result);\n\t\t\tconst item = document.createElement(\"li\");\n\t\t\titem.innerText = result.message;\n\t\t\terrList.appendChild(item);\n\t\t}\n\t\toutputNode.appendChild(errList);\n\t}\n\n\tconst outputItemRequests = new (class {\n\t\tprivate _requestPool = 0;\n\t\tprivate readonly _requests = new Map<\n\t\t\t/*requestId*/ number,\n\t\t\t{\n\t\t\t\tresolve: (\n\t\t\t\t\tx: webviewMessages.OutputItemEntry | undefined,\n\t\t\t\t) => void;\n\t\t\t}\n\t\t>();\n\n\t\tgetOutputItem(outputId: string, mime: string) {\n\t\t\tconst requestId = this._requestPool++;\n\n\t\t\tconst { promise, resolve } = promiseWithResolvers<\n\t\t\t\twebviewMessages.OutputItemEntry | undefined\n\t\t\t>();\n\t\t\tthis._requests.set(requestId, { resolve });\n\n\t\t\tpostNotebookMessage<webviewMessages.IGetOutputItemMessage>(\n\t\t\t\t\"getOutputItem\",\n\t\t\t\t{ requestId, outputId, mime },\n\t\t\t);\n\t\t\treturn promise;\n\t\t}\n\n\t\tresolveOutputItem(\n\t\t\trequestId: number,\n\t\t\toutput: webviewMessages.OutputItemEntry | undefined,\n\t\t) {\n\t\t\tconst request = this._requests.get(requestId);\n\t\t\tif (!request) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis._requests.delete(requestId);\n\t\t\trequest.resolve(output);\n\t\t}\n\t})();\n\n\tinterface AdditionalOutputItemInfo {\n\t\treadonly mime: string;\n\t\tgetItem(): Promise<rendererApi.OutputItem | undefined>;\n\t}\n\n\tinterface ExtendedOutputItem extends rendererApi.OutputItem {\n\t\treadonly _allOutputItems: ReadonlyArray<AdditionalOutputItemInfo>;\n\t\tappendedText?(): string | undefined;\n\t}\n\n\tlet hasWarnedAboutAllOutputItemsProposal = false;\n\n\tfunction createOutputItem(\n\t\tid: string,\n\t\tmime: string,\n\t\tmetadata: unknown,\n\t\tvalueBytes: Uint8Array,\n\t\tallOutputItemData: ReadonlyArray<{ readonly mime: string }>,\n\t\tappended?: { valueBytes: Uint8Array; previousVersion: number },\n\t): ExtendedOutputItem {\n\t\tfunction create(\n\t\t\tid: string,\n\t\t\tmime: string,\n\t\t\tmetadata: unknown,\n\t\t\tvalueBytes: Uint8Array,\n\t\t\tappended?: { valueBytes: Uint8Array; previousVersion: number },\n\t\t): ExtendedOutputItem {\n\t\t\treturn Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\t\t\t\tmetadata,\n\n\t\t\t\tappendedText(): string | undefined {\n\t\t\t\t\tif (appended) {\n\t\t\t\t\t\treturn textDecoder.decode(appended.valueBytes);\n\t\t\t\t\t}\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata(): Uint8Array {\n\t\t\t\t\treturn valueBytes;\n\t\t\t\t},\n\n\t\t\t\ttext(): string {\n\t\t\t\t\treturn textDecoder.decode(valueBytes);\n\t\t\t\t},\n\n\t\t\t\tjson() {\n\t\t\t\t\treturn JSON.parse(this.text());\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([valueBytes], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\tget _allOutputItems() {\n\t\t\t\t\tif (!hasWarnedAboutAllOutputItemsProposal) {\n\t\t\t\t\t\thasWarnedAboutAllOutputItemsProposal = true;\n\t\t\t\t\t\tconsole.warn(\n\t\t\t\t\t\t\t`'_allOutputItems' is proposed API. DO NOT ship an extension that depends on it!`,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\treturn allOutputItemList;\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\n\t\tconst allOutputItemCache = new Map<\n\t\t\t/*mime*/ string,\n\t\t\tPromise<(rendererApi.OutputItem & ExtendedOutputItem) | undefined>\n\t\t>();\n\t\tconst allOutputItemList = Object.freeze(\n\t\t\tallOutputItemData.map((outputItem) => {\n\t\t\t\tconst mime = outputItem.mime;\n\t\t\t\treturn Object.freeze({\n\t\t\t\t\tmime,\n\t\t\t\t\tgetItem() {\n\t\t\t\t\t\tconst existingTask = allOutputItemCache.get(mime);\n\t\t\t\t\t\tif (existingTask) {\n\t\t\t\t\t\t\treturn existingTask;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst task = outputItemRequests\n\t\t\t\t\t\t\t.getOutputItem(id, mime)\n\t\t\t\t\t\t\t.then((item) => {\n\t\t\t\t\t\t\t\treturn item\n\t\t\t\t\t\t\t\t\t? create(\n\t\t\t\t\t\t\t\t\t\t\tid,\n\t\t\t\t\t\t\t\t\t\t\titem.mime,\n\t\t\t\t\t\t\t\t\t\t\tmetadata,\n\t\t\t\t\t\t\t\t\t\t\titem.valueBytes,\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: undefined;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\tallOutputItemCache.set(mime, task);\n\n\t\t\t\t\t\treturn task;\n\t\t\t\t\t},\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\n\t\tconst item = create(id, mime, metadata, valueBytes, appended);\n\t\tallOutputItemCache.set(mime, Promise.resolve(item));\n\t\treturn item;\n\t}\n\n\tconst onDidReceiveKernelMessage = createEmitter<unknown>();\n\n\tconst ttPolicy = window.trustedTypes?.createPolicy(\"notebookRenderer\", {\n\t\tcreateHTML: (value) => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t\tcreateScript: (value) => value, // CodeQL [SM03712] The rendered content is provided by renderer extensions, which are responsible for sanitizing their content themselves. The notebook webview is also sandboxed.\n\t});\n\n\twindow.addEventListener(\"wheel\", handleWheel);\n\n\tinterface IFindMatch {\n\t\ttype: \"preview\" | \"output\";\n\t\tid: string;\n\t\tcellId: string;\n\t\tcontainer: Node;\n\t\toriginalRange: Range;\n\t\tisShadow: boolean;\n\t\tsearchPreviewInfo?: ISearchPreviewInfo;\n\t\thighlightResult?: IHighlightResult;\n\t}\n\n\tinterface ISearchPreviewInfo {\n\t\tline: string;\n\t\trange: {\n\t\t\tstart: number;\n\t\t\tend: number;\n\t\t};\n\t}\n\n\tinterface IHighlighter {\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void;\n\t\tremoveHighlights(ownerID: string): void;\n\t\thighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void;\n\t\tdispose(): void;\n\t}\n\n\tinterface IHighlightInfo {\n\t\tmatches: IFindMatch[];\n\t\tcurrentMatchIndex: number;\n\t}\n\n\tconst matchColor = window.getComputedStyle(\n\t\twindow.document.getElementById(\"_defaultColorPalatte\")!,\n\t).color;\n\tconst currentMatchColor = window.getComputedStyle(\n\t\twindow.document.getElementById(\"_defaultColorPalatte\")!,\n\t).backgroundColor;\n\n\tclass JSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\n\t\tconstructor() {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t}\n\n\t\taddHighlights(matches: IFindMatch[], ownerID: string): void {\n\t\t\tfor (let i = matches.length - 1; i >= 0; i--) {\n\t\t\t\tconst match = matches[i];\n\t\t\t\tconst ret = highlightRange(\n\t\t\t\t\tmatch.originalRange,\n\t\t\t\t\ttrue,\n\t\t\t\t\t\"mark\",\n\t\t\t\t\tmatch.isShadow\n\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\tstyle: \"background-color: \" + matchColor + \";\",\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: {\n\t\t\t\t\t\t\t\tclass: \"find-match\",\n\t\t\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tmatch.highlightResult = ret;\n\t\t\t}\n\n\t\t\tconst highlightInfo: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1,\n\t\t\t};\n\t\t\tthis._activeHighlightInfo.set(ownerID, highlightInfo);\n\t\t}\n\n\t\tremoveHighlights(ownerID: string): void {\n\t\t\tthis._activeHighlightInfo.get(ownerID)?.matches.forEach((match) => {\n\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t});\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t\"Modified current highlight match before adding highlight list.\",\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch =\n\t\t\t\thighlightInfo.matches[highlightInfo.currentMatchIndex];\n\t\t\toldMatch?.highlightResult?.update(\n\t\t\t\tmatchColor,\n\t\t\t\toldMatch.isShadow ? undefined : \"find-match\",\n\t\t\t);\n\n\t\t\tconst match = highlightInfo.matches[index];\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst sel = window.getSelection();\n\t\t\tif (!!match && !!sel && match.highlightResult) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = window.document\n\t\t\t\t\t\t.getElementById(match.id)!\n\t\t\t\t\t\t.getBoundingClientRect().top;\n\t\t\t\t\tconst tempRange = document.createRange();\n\t\t\t\t\ttempRange.selectNode(\n\t\t\t\t\t\tmatch.highlightResult.range.startContainer,\n\t\t\t\t\t);\n\n\t\t\t\t\tmatch.highlightResult.range.startContainer.parentElement?.scrollIntoView(\n\t\t\t\t\t\t{ behavior: \"auto\", block: \"end\", inline: \"nearest\" },\n\t\t\t\t\t);\n\n\t\t\t\t\tconst rangeOffset = tempRange.getBoundingClientRect().top;\n\t\t\t\t\ttempRange.detach();\n\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\n\t\t\t\tmatch.highlightResult?.update(\n\t\t\t\t\tcurrentMatchColor,\n\t\t\t\t\tmatch.isShadow ? undefined : \"current-find-match\",\n\t\t\t\t);\n\n\t\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\t\tpostNotebookMessage(\"didFindHighlightCurrent\", {\n\t\t\t\t\toffset,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string) {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst oldMatch = highlightInfo.matches[index];\n\t\t\tif (oldMatch && oldMatch.highlightResult) {\n\t\t\t\toldMatch.highlightResult.update(\n\t\t\t\t\tmatchColor,\n\t\t\t\t\toldMatch.isShadow ? undefined : \"find-match\",\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tdispose() {\n\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\tthis._activeHighlightInfo.forEach((highlightInfo) => {\n\t\t\t\thighlightInfo.matches.forEach((match) => {\n\t\t\t\t\tmatch.highlightResult?.dispose();\n\t\t\t\t});\n\t\t\t});\n\t\t}\n\t}\n\n\tclass CSSHighlighter implements IHighlighter {\n\t\tprivate _activeHighlightInfo: Map<string, IHighlightInfo>;\n\t\tprivate _matchesHighlight: Highlight;\n\t\tprivate _currentMatchesHighlight: Highlight;\n\n\t\tconstructor() {\n\t\t\tthis._activeHighlightInfo = new Map();\n\t\t\tthis._matchesHighlight = new Highlight();\n\t\t\tthis._matchesHighlight.priority = 1;\n\t\t\tthis._currentMatchesHighlight = new Highlight();\n\t\t\tthis._currentMatchesHighlight.priority = 2;\n\t\t\tCSS.highlights?.set(`find-highlight`, this._matchesHighlight);\n\t\t\tCSS.highlights?.set(\n\t\t\t\t`current-find-highlight`,\n\t\t\t\tthis._currentMatchesHighlight,\n\t\t\t);\n\t\t}\n\n\t\t_refreshRegistry(updateMatchesHighlight = true) {\n\t\t\t// for performance reasons, only update the full list of highlights when we need to\n\t\t\tif (updateMatchesHighlight) {\n\t\t\t\tthis._matchesHighlight.clear();\n\t\t\t}\n\n\t\t\tthis._currentMatchesHighlight.clear();\n\n\t\t\tthis._activeHighlightInfo.forEach((highlightInfo) => {\n\t\t\t\tif (updateMatchesHighlight) {\n\t\t\t\t\tfor (let i = 0; i < highlightInfo.matches.length; i++) {\n\t\t\t\t\t\tthis._matchesHighlight.add(\n\t\t\t\t\t\t\thighlightInfo.matches[i].originalRange,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (\n\t\t\t\t\thighlightInfo.currentMatchIndex <\n\t\t\t\t\t\thighlightInfo.matches.length &&\n\t\t\t\t\thighlightInfo.currentMatchIndex >= 0\n\t\t\t\t) {\n\t\t\t\t\tthis._currentMatchesHighlight.add(\n\t\t\t\t\t\thighlightInfo.matches[highlightInfo.currentMatchIndex]\n\t\t\t\t\t\t\t.originalRange,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\taddHighlights(matches: IFindMatch[], ownerID: string) {\n\t\t\tfor (let i = 0; i < matches.length; i++) {\n\t\t\t\tthis._matchesHighlight.add(matches[i].originalRange);\n\t\t\t}\n\n\t\t\tconst newEntry: IHighlightInfo = {\n\t\t\t\tmatches,\n\t\t\t\tcurrentMatchIndex: -1,\n\t\t\t};\n\n\t\t\tthis._activeHighlightInfo.set(ownerID, newEntry);\n\t\t}\n\n\t\thighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t\"Modified current highlight match before adding highlight list.\",\n\t\t\t\t);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = index;\n\t\t\tconst match = highlightInfo.matches[index];\n\n\t\t\tif (match) {\n\t\t\t\tlet offset = 0;\n\t\t\t\ttry {\n\t\t\t\t\tconst outputOffset = window.document\n\t\t\t\t\t\t.getElementById(match.id)!\n\t\t\t\t\t\t.getBoundingClientRect().top;\n\t\t\t\t\tmatch.originalRange.startContainer.parentElement?.scrollIntoView(\n\t\t\t\t\t\t{ behavior: \"auto\", block: \"end\", inline: \"nearest\" },\n\t\t\t\t\t);\n\t\t\t\t\tconst rangeOffset =\n\t\t\t\t\t\tmatch.originalRange.getBoundingClientRect().top;\n\t\t\t\t\toffset = rangeOffset - outputOffset;\n\t\t\t\t\tpostNotebookMessage(\"didFindHighlightCurrent\", {\n\t\t\t\t\t\toffset,\n\t\t\t\t\t});\n\t\t\t\t} catch (e) {\n\t\t\t\t\tconsole.error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t\tthis._refreshRegistry(false);\n\t\t}\n\n\t\tunHighlightCurrentMatch(index: number, ownerID: string): void {\n\t\t\tconst highlightInfo = this._activeHighlightInfo.get(ownerID);\n\t\t\tif (!highlightInfo) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\thighlightInfo.currentMatchIndex = -1;\n\t\t}\n\n\t\tremoveHighlights(ownerID: string) {\n\t\t\tthis._activeHighlightInfo.delete(ownerID);\n\t\t\tthis._refreshRegistry();\n\t\t}\n\n\t\tdispose(): void {\n\t\t\twindow.document.getSelection()?.removeAllRanges();\n\t\t\tthis._currentMatchesHighlight.clear();\n\t\t\tthis._matchesHighlight.clear();\n\t\t}\n\t}\n\n\tconst _highlighter = CSS.highlights\n\t\t? new CSSHighlighter()\n\t\t: new JSHighlighter();\n\n\tfunction extractSelectionLine(selection: Selection): ISearchPreviewInfo {\n\t\tconst range = selection.getRangeAt(0);\n\n\t\t// we need to keep a reference to the old selection range to re-apply later\n\t\tconst oldRange = range.cloneRange();\n\t\tconst captureLength = selection.toString().length;\n\n\t\t// use selection API to modify selection to get entire line (the first line if multi-select)\n\n\t\t// collapse selection to start so that the cursor position is at beginning of match\n\t\tselection.collapseToStart();\n\n\t\t// extend selection in both directions to select the line\n\t\tselection.modify(\"move\", \"backward\", \"lineboundary\");\n\t\tselection.modify(\"extend\", \"forward\", \"lineboundary\");\n\n\t\tconst line = selection.toString();\n\n\t\t// using the original range and the new range, we can find the offset of the match from the line start.\n\t\tconst rangeStart = getStartOffset(selection.getRangeAt(0), oldRange);\n\n\t\t// line range for match\n\t\tconst lineRange = {\n\t\t\tstart: rangeStart,\n\t\t\tend: rangeStart + captureLength,\n\t\t};\n\n\t\t// re-add the old range so that the selection is restored\n\t\tselection.removeAllRanges();\n\t\tselection.addRange(oldRange);\n\n\t\treturn { line, range: lineRange };\n\t}\n\n\tfunction getStartOffset(lineRange: Range, originalRange: Range) {\n\t\t// sometimes, the old and new range are in different DOM elements (ie: when the match is inside of <b></b>)\n\t\t// so we need to find the first common ancestor DOM element and find the positions of the old and new range relative to that.\n\t\tconst firstCommonAncestor = findFirstCommonAncestor(\n\t\t\tlineRange.startContainer,\n\t\t\toriginalRange.startContainer,\n\t\t);\n\n\t\tconst selectionOffset =\n\t\t\tgetSelectionOffsetRelativeTo(\n\t\t\t\tfirstCommonAncestor,\n\t\t\t\tlineRange.startContainer,\n\t\t\t) + lineRange.startOffset;\n\t\tconst textOffset =\n\t\t\tgetSelectionOffsetRelativeTo(\n\t\t\t\tfirstCommonAncestor,\n\t\t\t\toriginalRange.startContainer,\n\t\t\t) + originalRange.startOffset;\n\t\treturn textOffset - selectionOffset;\n\t}\n\n\t// modified from https://stackoverflow.com/a/68583466/16253823\n\tfunction findFirstCommonAncestor(nodeA: Node, nodeB: Node) {\n\t\tconst range = new Range();\n\t\trange.setStart(nodeA, 0);\n\t\trange.setEnd(nodeB, 0);\n\t\treturn range.commonAncestorContainer;\n\t}\n\n\tfunction getTextContentLength(node: Node): number {\n\t\tlet length = 0;\n\n\t\tif (node.nodeType === Node.TEXT_NODE) {\n\t\t\tlength += node.textContent?.length || 0;\n\t\t} else {\n\t\t\tfor (const childNode of node.childNodes) {\n\t\t\t\tlength += getTextContentLength(childNode);\n\t\t\t}\n\t\t}\n\n\t\treturn length;\n\t}\n\n\t// modified from https://stackoverflow.com/a/48812529/16253823\n\tfunction getSelectionOffsetRelativeTo(\n\t\tparentElement: Node,\n\t\tcurrentNode: Node | null,\n\t): number {\n\t\tif (!currentNode) {\n\t\t\treturn 0;\n\t\t}\n\t\tlet offset = 0;\n\n\t\tif (\n\t\t\tcurrentNode === parentElement ||\n\t\t\t!parentElement.contains(currentNode)\n\t\t) {\n\t\t\treturn offset;\n\t\t}\n\n\t\t// count the number of chars before the current dom elem and the start of the dom\n\t\tlet prevSibling = currentNode.previousSibling;\n\t\twhile (prevSibling) {\n\t\t\toffset += getTextContentLength(prevSibling);\n\t\t\tprevSibling = prevSibling.previousSibling;\n\t\t}\n\n\t\treturn (\n\t\t\toffset +\n\t\t\tgetSelectionOffsetRelativeTo(parentElement, currentNode.parentNode)\n\t\t);\n\t}\n\n\tconst find = (\n\t\tquery: string,\n\t\toptions: {\n\t\t\twholeWord?: boolean;\n\t\t\tcaseSensitive?: boolean;\n\t\t\tincludeMarkup: boolean;\n\t\t\tincludeOutput: boolean;\n\t\t\tshouldGetSearchPreviewInfo: boolean;\n\t\t\townerID: string;\n\t\t\tfindIds: string[];\n\t\t},\n\t) => {\n\t\tlet find = true;\n\t\tlet matches: IFindMatch[] = [];\n\n\t\tconst range = document.createRange();\n\t\trange.selectNodeContents(window.document.getElementById(\"findStart\")!);\n\t\tconst sel = window.getSelection();\n\t\tsel?.removeAllRanges();\n\t\tsel?.addRange(range);\n\n\t\tviewModel.toggleDragDropEnabled(false);\n\n\t\ttry {\n\t\t\tdocument.designMode = \"On\";\n\n\t\t\twhile (find && matches.length < 500) {\n\t\t\t\tfind = (window as any).find(\n\t\t\t\t\tquery,\n\t\t\t\t\t/* caseSensitive*/ !!options.caseSensitive,\n\t\t\t\t\t/* backwards*/ false,\n\t\t\t\t\t/* wrapAround*/ false,\n\t\t\t\t\t/* wholeWord */ !!options.wholeWord,\n\t\t\t\t\t/* searchInFrames*/ true,\n\t\t\t\t\tfalse,\n\t\t\t\t);\n\n\t\t\t\tif (find) {\n\t\t\t\t\tconst selection = window.getSelection();\n\t\t\t\t\tif (!selection) {\n\t\t\t\t\t\tconsole.log(\"no selection\");\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\t// Markdown preview are rendered in a shadow DOM.\n\t\t\t\t\tif (\n\t\t\t\t\t\toptions.includeMarkup &&\n\t\t\t\t\t\tselection.rangeCount > 0 &&\n\t\t\t\t\t\tselection.getRangeAt(0).startContainer.nodeType === 1 &&\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tselection.getRangeAt(0).startContainer as Element\n\t\t\t\t\t\t).classList.contains(\"markup\")\n\t\t\t\t\t) {\n\t\t\t\t\t\t// markdown preview container\n\t\t\t\t\t\tconst preview = selection.anchorNode\n\t\t\t\t\t\t\t?.firstChild as Element;\n\t\t\t\t\t\tconst root = preview.shadowRoot as ShadowRoot & {\n\t\t\t\t\t\t\tgetSelection: () => Selection;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection\n\t\t\t\t\t\t\t? root?.getSelection()\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\t// find the match in the shadow dom by checking the selection inside the shadow dom\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: \"preview\",\n\t\t\t\t\t\t\t\tid: preview.id,\n\t\t\t\t\t\t\t\tcellId: preview.id,\n\t\t\t\t\t\t\t\tcontainer: preview,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo:\n\t\t\t\t\t\t\t\t\toptions.shouldGetSearchPreviewInfo\n\t\t\t\t\t\t\t\t\t\t? extractSelectionLine(shadowSelection)\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// Outputs might be rendered inside a shadow DOM.\n\t\t\t\t\tif (\n\t\t\t\t\t\toptions.includeOutput &&\n\t\t\t\t\t\tselection.rangeCount > 0 &&\n\t\t\t\t\t\tselection.getRangeAt(0).startContainer.nodeType === 1 &&\n\t\t\t\t\t\t(\n\t\t\t\t\t\t\tselection.getRangeAt(0).startContainer as Element\n\t\t\t\t\t\t).classList.contains(\"output_container\")\n\t\t\t\t\t) {\n\t\t\t\t\t\t// output container\n\t\t\t\t\t\tconst cellId =\n\t\t\t\t\t\t\tselection.getRangeAt(0).startContainer\n\t\t\t\t\t\t\t\t.parentElement!.id;\n\t\t\t\t\t\tconst outputNode = selection.anchorNode\n\t\t\t\t\t\t\t?.firstChild as Element;\n\t\t\t\t\t\tconst root = outputNode.shadowRoot as ShadowRoot & {\n\t\t\t\t\t\t\tgetSelection: () => Selection;\n\t\t\t\t\t\t};\n\t\t\t\t\t\tconst shadowSelection = root?.getSelection\n\t\t\t\t\t\t\t? root?.getSelection()\n\t\t\t\t\t\t\t: null;\n\t\t\t\t\t\tif (shadowSelection && shadowSelection.anchorNode) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: \"output\",\n\t\t\t\t\t\t\t\tid: outputNode.id,\n\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\tcontainer: outputNode,\n\t\t\t\t\t\t\t\tisShadow: true,\n\t\t\t\t\t\t\t\toriginalRange: shadowSelection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo:\n\t\t\t\t\t\t\t\t\toptions.shouldGetSearchPreviewInfo\n\t\t\t\t\t\t\t\t\t\t? extractSelectionLine(shadowSelection)\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\tconst anchorNode = selection.anchorNode?.parentElement;\n\n\t\t\t\t\tif (anchorNode) {\n\t\t\t\t\t\tconst lastEl: any = matches.length\n\t\t\t\t\t\t\t? matches[matches.length - 1]\n\t\t\t\t\t\t\t: null;\n\n\t\t\t\t\t\t// Optimization: avoid searching for the output container\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tlastEl &&\n\t\t\t\t\t\t\tlastEl.container.contains(anchorNode) &&\n\t\t\t\t\t\t\toptions.includeOutput\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\ttype: lastEl.type,\n\t\t\t\t\t\t\t\tid: lastEl.id,\n\t\t\t\t\t\t\t\tcellId: lastEl.cellId,\n\t\t\t\t\t\t\t\tcontainer: lastEl.container,\n\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\toriginalRange: selection.getRangeAt(0),\n\t\t\t\t\t\t\t\tsearchPreviewInfo:\n\t\t\t\t\t\t\t\t\toptions.shouldGetSearchPreviewInfo\n\t\t\t\t\t\t\t\t\t\t? extractSelectionLine(selection)\n\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t// Traverse up the DOM to find the container\n\t\t\t\t\t\t\tfor (\n\t\t\t\t\t\t\t\tlet node = anchorNode as Element | null;\n\t\t\t\t\t\t\t\tnode;\n\t\t\t\t\t\t\t\tnode = node.parentElement\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tif (!(node instanceof Element)) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tnode.classList.contains(\"output\") &&\n\t\t\t\t\t\t\t\t\toptions.includeOutput\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t// inside output\n\t\t\t\t\t\t\t\t\tconst cellId =\n\t\t\t\t\t\t\t\t\t\tnode.parentElement?.parentElement?.id;\n\t\t\t\t\t\t\t\t\tif (cellId) {\n\t\t\t\t\t\t\t\t\t\tmatches.push({\n\t\t\t\t\t\t\t\t\t\t\ttype: \"output\",\n\t\t\t\t\t\t\t\t\t\t\tid: node.id,\n\t\t\t\t\t\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\t\t\t\t\t\tcontainer: node,\n\t\t\t\t\t\t\t\t\t\t\tisShadow: false,\n\t\t\t\t\t\t\t\t\t\t\toriginalRange:\n\t\t\t\t\t\t\t\t\t\t\t\tselection.getRangeAt(0),\n\t\t\t\t\t\t\t\t\t\t\tsearchPreviewInfo:\n\t\t\t\t\t\t\t\t\t\t\t\toptions.shouldGetSearchPreviewInfo\n\t\t\t\t\t\t\t\t\t\t\t\t\t? extractSelectionLine(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tselection,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\tnode.id === \"container\" ||\n\t\t\t\t\t\t\t\t\tnode === window.document.body\n\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.log(e);\n\t\t}\n\n\t\tmatches = matches.filter((match) =>\n\t\t\toptions.findIds.length\n\t\t\t\t? options.findIds.includes(match.cellId)\n\t\t\t\t: true,\n\t\t);\n\t\t_highlighter.addHighlights(matches, options.ownerID);\n\t\twindow.document.getSelection()?.removeAllRanges();\n\n\t\tviewModel.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\n\t\tdocument.designMode = \"Off\";\n\n\t\tpostNotebookMessage(\"didFind\", {\n\t\t\tmatches: matches.map((match, index) => ({\n\t\t\t\ttype: match.type,\n\t\t\t\tid: match.id,\n\t\t\t\tcellId: match.cellId,\n\t\t\t\tindex,\n\t\t\t\tsearchPreviewInfo: match.searchPreviewInfo,\n\t\t\t})),\n\t\t});\n\t};\n\n\tconst copyOutputImage = async (\n\t\toutputId: string,\n\t\taltOutputId: string,\n\t\tretries = 5,\n\t) => {\n\t\tif (!window.document.hasFocus() && retries > 0) {\n\t\t\t// copyImage can be called from outside of the webview, which means this function may be running whilst the webview is gaining focus.\n\t\t\t// Since navigator.clipboard.write requires the document to be focused, we need to wait for focus.\n\t\t\t// We cannot use a listener, as there is a high chance the focus is gained during the setup of the listener resulting in us missing it.\n\t\t\tsetTimeout(() => {\n\t\t\t\tcopyOutputImage(outputId, altOutputId, retries - 1);\n\t\t\t}, 50);\n\t\t\treturn;\n\t\t}\n\n\t\ttry {\n\t\t\tconst outputElement =\n\t\t\t\twindow.document.getElementById(outputId) ??\n\t\t\t\twindow.document.getElementById(altOutputId);\n\n\t\t\tlet image = outputElement?.querySelector(\"img\");\n\n\t\t\tif (!image) {\n\t\t\t\tconst svgImage =\n\t\t\t\t\toutputElement?.querySelector(\"svg.output-image\") ??\n\t\t\t\t\toutputElement?.querySelector(\"div.svgContainerStyle > svg\");\n\n\t\t\t\tif (svgImage) {\n\t\t\t\t\timage = new Image();\n\t\t\t\t\timage.src =\n\t\t\t\t\t\t\"data:image/svg+xml,\" +\n\t\t\t\t\t\tencodeURIComponent(svgImage.outerHTML);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (image) {\n\t\t\t\tconst imageToCopy = image;\n\t\t\t\tawait navigator.clipboard.write([\n\t\t\t\t\tnew ClipboardItem({\n\t\t\t\t\t\t\"image/png\": new Promise((resolve) => {\n\t\t\t\t\t\t\tconst canvas = document.createElement(\"canvas\");\n\t\t\t\t\t\t\tcanvas.width = imageToCopy.naturalWidth;\n\t\t\t\t\t\t\tcanvas.height = imageToCopy.naturalHeight;\n\t\t\t\t\t\t\tconst context = canvas.getContext(\"2d\");\n\t\t\t\t\t\t\tcontext!.drawImage(imageToCopy, 0, 0);\n\n\t\t\t\t\t\t\tcanvas.toBlob((blob) => {\n\t\t\t\t\t\t\t\tif (blob) {\n\t\t\t\t\t\t\t\t\tresolve(blob);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tconsole.error(\n\t\t\t\t\t\t\t\t\t\t\"No blob data to write to clipboard\",\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tcanvas.remove();\n\t\t\t\t\t\t\t}, \"image/png\");\n\t\t\t\t\t\t}),\n\t\t\t\t\t}),\n\t\t\t\t]);\n\t\t\t} else {\n\t\t\t\tconsole.error(\n\t\t\t\t\t\"Could not find image element to copy for output with id\",\n\t\t\t\t\toutputId,\n\t\t\t\t);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tconsole.error(\"Could not copy image:\", e);\n\t\t}\n\t};\n\n\twindow.addEventListener(\"message\", async (rawEvent) => {\n\t\tconst event = rawEvent as { data: webviewMessages.ToWebviewMessage };\n\n\t\tswitch (event.data.type) {\n\t\t\tcase \"initializeMarkup\": {\n\t\t\t\ttry {\n\t\t\t\t\tawait Promise.all(\n\t\t\t\t\t\tevent.data.cells.map((info) =>\n\t\t\t\t\t\t\tviewModel.ensureMarkupCell(info),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t} finally {\n\t\t\t\t\tdimensionUpdater.updateImmediately();\n\t\t\t\t\tpostNotebookMessage(\"initializedMarkup\", {\n\t\t\t\t\t\trequestId: event.data.requestId,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"createMarkupCell\":\n\t\t\t\tviewModel.ensureMarkupCell(event.data.cell);\n\t\t\t\tbreak;\n\n\t\t\tcase \"showMarkupCell\":\n\t\t\t\tviewModel.showMarkupCell(\n\t\t\t\t\tevent.data.id,\n\t\t\t\t\tevent.data.top,\n\t\t\t\t\tevent.data.content,\n\t\t\t\t\tevent.data.metadata,\n\t\t\t\t);\n\t\t\t\tbreak;\n\n\t\t\tcase \"hideMarkupCells\":\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.hideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"unhideMarkupCells\":\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.unhideMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"deleteMarkupCell\":\n\t\t\t\tfor (const id of event.data.ids) {\n\t\t\t\t\tviewModel.deleteMarkupCell(id);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"updateSelectedMarkupCells\":\n\t\t\t\tviewModel.updateSelectedCells(event.data.selectedCellIds);\n\t\t\t\tbreak;\n\n\t\t\tcase \"html\": {\n\t\t\t\tconst data = event.data;\n\t\t\t\tif (data.createOnIdle) {\n\t\t\t\t\toutputRunner.enqueueIdle(data.outputId, (signal) => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t} else {\n\t\t\t\t\toutputRunner.enqueue(data.outputId, (signal) => {\n\t\t\t\t\t\t// cancel the idle callback if it exists\n\t\t\t\t\t\treturn viewModel.renderOutputCell(data, signal);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"view-scroll\": {\n\t\t\t\t// const date = new Date();\n\t\t\t\t// console.log('----- will scroll ----  ', date.getMinutes() + ':' + date.getSeconds() + ':' + date.getMilliseconds());\n\n\t\t\t\tevent.data.widgets.forEach((widget) => {\n\t\t\t\t\toutputRunner.enqueue(widget.outputId, () => {\n\t\t\t\t\t\tviewModel.updateOutputsScroll([widget]);\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\tviewModel.updateMarkupScrolls(event.data.markupCells);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"clear\":\n\t\t\t\trenderers.clearAll();\n\t\t\t\tviewModel.clearAll();\n\t\t\t\twindow.document.getElementById(\"container\")!.innerText = \"\";\n\t\t\t\tbreak;\n\n\t\t\tcase \"clearOutput\": {\n\t\t\t\tconst { cellId, rendererId, outputId } = event.data;\n\t\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\t\tviewModel.clearOutput(cellId, outputId, rendererId);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"hideOutput\": {\n\t\t\t\tconst { cellId, outputId } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.hideOutput(cellId);\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"showOutput\": {\n\t\t\t\tconst { outputId, cellTop, cellId, content } = event.data;\n\t\t\t\toutputRunner.enqueue(outputId, () => {\n\t\t\t\t\tviewModel.showOutput(cellId, outputId, cellTop);\n\t\t\t\t\tif (content) {\n\t\t\t\t\t\tviewModel.updateAndRerender(cellId, outputId, content);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"copyImage\": {\n\t\t\t\tawait copyOutputImage(\n\t\t\t\t\tevent.data.outputId,\n\t\t\t\t\tevent.data.altOutputId,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"ack-dimension\": {\n\t\t\t\tfor (const { cellId, outputId, height } of event.data.updates) {\n\t\t\t\t\tviewModel.updateOutputHeight(cellId, outputId, height);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"preload\": {\n\t\t\t\tconst resources = event.data.resources;\n\t\t\t\tfor (const { uri } of resources) {\n\t\t\t\t\tkernelPreloads.load(uri);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"updateRenderers\": {\n\t\t\t\tconst { rendererData } = event.data;\n\t\t\t\trenderers.updateRendererData(rendererData);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"focus-output\":\n\t\t\t\tfocusFirstFocusableOrContainerInOutput(\n\t\t\t\t\tevent.data.cellOrOutputId,\n\t\t\t\t\tevent.data.alternateId,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\tcase \"blur-output\":\n\t\t\t\tblurOutput();\n\t\t\t\tbreak;\n\t\t\tcase \"select-output-contents\":\n\t\t\t\tselectOutputContents(event.data.cellOrOutputId);\n\t\t\t\tbreak;\n\t\t\tcase \"select-input-contents\":\n\t\t\t\tselectInputContents(event.data.cellOrOutputId);\n\t\t\t\tbreak;\n\t\t\tcase \"decorations\": {\n\t\t\t\tlet outputContainer = window.document.getElementById(\n\t\t\t\t\tevent.data.cellId,\n\t\t\t\t);\n\t\t\t\tif (!outputContainer) {\n\t\t\t\t\tviewModel.ensureOutputCell(\n\t\t\t\t\t\tevent.data.cellId,\n\t\t\t\t\t\t-100000,\n\t\t\t\t\t\ttrue,\n\t\t\t\t\t);\n\t\t\t\t\toutputContainer = window.document.getElementById(\n\t\t\t\t\t\tevent.data.cellId,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\toutputContainer?.classList.add(...event.data.addedClassNames);\n\t\t\t\toutputContainer?.classList.remove(\n\t\t\t\t\t...event.data.removedClassNames,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"customKernelMessage\":\n\t\t\t\tonDidReceiveKernelMessage.fire(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase \"customRendererMessage\":\n\t\t\t\trenderers\n\t\t\t\t\t.getRenderer(event.data.rendererId)\n\t\t\t\t\t?.receiveMessage(event.data.message);\n\t\t\t\tbreak;\n\t\t\tcase \"notebookStyles\": {\n\t\t\t\tconst documentStyle = window.document.documentElement.style;\n\n\t\t\t\tfor (let i = documentStyle.length - 1; i >= 0; i--) {\n\t\t\t\t\tconst property = documentStyle[i];\n\n\t\t\t\t\t// Don't remove properties that the webview might have added separately\n\t\t\t\t\tif (property && property.startsWith(\"--notebook-\")) {\n\t\t\t\t\t\tdocumentStyle.removeProperty(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\t// Re-add new properties\n\t\t\t\tfor (const [name, value] of Object.entries(event.data.styles)) {\n\t\t\t\t\tdocumentStyle.setProperty(`--${name}`, value);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"notebookOptions\":\n\t\t\t\tcurrentOptions = event.data.options;\n\t\t\t\tviewModel.toggleDragDropEnabled(\n\t\t\t\t\tcurrentOptions.dragAndDropEnabled,\n\t\t\t\t);\n\t\t\t\tcurrentRenderOptions = event.data.renderOptions;\n\t\t\t\tsettingChange.fire(currentRenderOptions);\n\t\t\t\tbreak;\n\t\t\tcase \"tokenizedCodeBlock\": {\n\t\t\t\tconst { codeBlockId, html } = event.data;\n\t\t\t\tMarkdownCodeBlock.highlightCodeBlock(codeBlockId, html);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"tokenizedStylesChanged\": {\n\t\t\t\ttokenizationStyle.replaceSync(event.data.css);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"find\": {\n\t\t\t\t_highlighter.removeHighlights(event.data.options.ownerID);\n\t\t\t\tfind(event.data.query, event.data.options);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"findHighlightCurrent\": {\n\t\t\t\t_highlighter?.highlightCurrentMatch(\n\t\t\t\t\tevent.data.index,\n\t\t\t\t\tevent.data.ownerID,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"findUnHighlightCurrent\": {\n\t\t\t\t_highlighter?.unHighlightCurrentMatch(\n\t\t\t\t\tevent.data.index,\n\t\t\t\t\tevent.data.ownerID,\n\t\t\t\t);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"findStop\": {\n\t\t\t\t_highlighter.removeHighlights(event.data.ownerID);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcase \"returnOutputItem\": {\n\t\t\t\toutputItemRequests.resolveOutputItem(\n\t\t\t\t\tevent.data.requestId,\n\t\t\t\t\tevent.data.output,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t});\n\n\tconst renderFallbackErrorName = \"vscode.fallbackToNextRenderer\";\n\n\tclass Renderer {\n\t\tprivate _onMessageEvent = createEmitter();\n\t\tprivate _loadPromise?: Promise<rendererApi.RendererApi | undefined>;\n\t\tprivate _api: rendererApi.RendererApi | undefined;\n\n\t\tconstructor(public readonly data: webviewMessages.RendererMetadata) {}\n\n\t\tpublic receiveMessage(message: unknown) {\n\t\t\tthis._onMessageEvent.fire(message);\n\t\t}\n\n\t\tpublic async renderOutputItem(\n\t\t\titem: rendererApi.OutputItem,\n\t\t\telement: HTMLElement,\n\t\t\tsignal: AbortSignal,\n\t\t): Promise<void> {\n\t\t\ttry {\n\t\t\t\tawait this.load();\n\t\t\t} catch (e) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(\n\t\t\t\t\t\t`Error loading renderer '${this.data.id}'`,\n\t\t\t\t\t\telement,\n\t\t\t\t\t\te instanceof Error ? [e] : [],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!this._api) {\n\t\t\t\tif (!signal.aborted) {\n\t\t\t\t\tshowRenderError(\n\t\t\t\t\t\t`Renderer '${this.data.id}' does not implement renderOutputItem`,\n\t\t\t\t\t\telement,\n\t\t\t\t\t\t[],\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\ttry {\n\t\t\t\tconst renderStart = performance.now();\n\t\t\t\tawait this._api.renderOutputItem(item, element, signal);\n\t\t\t\tthis.postDebugMessage(\"Rendered output item\", {\n\t\t\t\t\tid: item.id,\n\t\t\t\t\tduration: `${performance.now() - renderStart}ms`,\n\t\t\t\t});\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\tthrow e;\n\t\t\t\t}\n\n\t\t\t\tshowRenderError(\n\t\t\t\t\t`Error rendering output item using '${this.data.id}'`,\n\t\t\t\t\telement,\n\t\t\t\t\te instanceof Error ? [e] : [],\n\t\t\t\t);\n\t\t\t\tthis.postDebugMessage(\"Rendering output item failed\", {\n\t\t\t\t\tid: item.id,\n\t\t\t\t\terror: e + \"\",\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tpublic disposeOutputItem(id?: string): void {\n\t\t\tthis._api?.disposeOutputItem?.(id);\n\t\t}\n\n\t\tprivate createRendererContext(): RendererContext {\n\t\t\tconst { id, messaging } = this.data;\n\t\t\tconst context: RendererContext = {\n\t\t\t\tsetState: (newState) =>\n\t\t\t\t\tvscode.setState({ ...vscode.getState(), [id]: newState }),\n\t\t\t\tgetState: <T>() => {\n\t\t\t\t\tconst state = vscode.getState();\n\t\t\t\t\treturn typeof state === \"object\" && state\n\t\t\t\t\t\t? (state[id] as T)\n\t\t\t\t\t\t: undefined;\n\t\t\t\t},\n\t\t\t\tgetRenderer: async (id: string) => {\n\t\t\t\t\tconst renderer = renderers.getRenderer(id);\n\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\tif (renderer._api) {\n\t\t\t\t\t\treturn renderer._api;\n\t\t\t\t\t}\n\t\t\t\t\treturn renderer.load();\n\t\t\t\t},\n\t\t\t\tworkspace: {\n\t\t\t\t\tget isTrusted() {\n\t\t\t\t\t\treturn isWorkspaceTrusted;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tsettings: {\n\t\t\t\t\tget lineLimit() {\n\t\t\t\t\t\treturn currentRenderOptions.lineLimit;\n\t\t\t\t\t},\n\t\t\t\t\tget outputScrolling() {\n\t\t\t\t\t\treturn currentRenderOptions.outputScrolling;\n\t\t\t\t\t},\n\t\t\t\t\tget outputWordWrap() {\n\t\t\t\t\t\treturn currentRenderOptions.outputWordWrap;\n\t\t\t\t\t},\n\t\t\t\t\tget linkifyFilePaths() {\n\t\t\t\t\t\treturn currentRenderOptions.linkifyFilePaths;\n\t\t\t\t\t},\n\t\t\t\t\tget minimalError() {\n\t\t\t\t\t\treturn currentRenderOptions.minimalError;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t\tget onDidChangeSettings() {\n\t\t\t\t\treturn settingChange.event;\n\t\t\t\t},\n\t\t\t};\n\n\t\t\tif (messaging) {\n\t\t\t\tcontext.onDidReceiveMessage = this._onMessageEvent.event;\n\t\t\t\tcontext.postMessage = (message) =>\n\t\t\t\t\tpostNotebookMessage(\"customRendererMessage\", {\n\t\t\t\t\t\trendererId: id,\n\t\t\t\t\t\tmessage,\n\t\t\t\t\t});\n\t\t\t}\n\n\t\t\treturn Object.freeze(context);\n\t\t}\n\n\t\tprivate load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis._loadPromise ??= this._load();\n\t\t\treturn this._loadPromise;\n\t\t}\n\n\t\t/** Inner function cached in the _loadPromise(). */\n\t\tprivate async _load(): Promise<rendererApi.RendererApi | undefined> {\n\t\t\tthis.postDebugMessage(\"Start loading renderer\");\n\n\t\t\ttry {\n\t\t\t\t// Preloads need to be loaded before loading renderers.\n\t\t\t\tawait kernelPreloads.waitForAllCurrent();\n\n\t\t\t\tconst importStart = performance.now();\n\t\t\t\tconst module: RendererModule = await __import(\n\t\t\t\t\tthis.data.entrypoint.path,\n\t\t\t\t);\n\t\t\t\tthis.postDebugMessage(\"Imported renderer\", {\n\t\t\t\t\tduration: `${performance.now() - importStart}ms`,\n\t\t\t\t});\n\n\t\t\t\tif (!module) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis._api = await module.activate(this.createRendererContext());\n\t\t\t\tthis.postDebugMessage(\"Activated renderer\", {\n\t\t\t\t\tduration: `${performance.now() - importStart}ms`,\n\t\t\t\t});\n\n\t\t\t\tconst dependantRenderers = ctx.rendererData.filter(\n\t\t\t\t\t(d) => d.entrypoint.extends === this.data.id,\n\t\t\t\t);\n\n\t\t\t\tif (dependantRenderers.length) {\n\t\t\t\t\tthis.postDebugMessage(\"Activating dependant renderers\", {\n\t\t\t\t\t\tdependents: dependantRenderers\n\t\t\t\t\t\t\t.map((x) => x.id)\n\t\t\t\t\t\t\t.join(\", \"),\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\t// Load all renderers that extend this renderer\n\t\t\t\tawait Promise.all(\n\t\t\t\t\tdependantRenderers.map(async (d) => {\n\t\t\t\t\t\tconst renderer = renderers.getRenderer(d.id);\n\t\t\t\t\t\tif (!renderer) {\n\t\t\t\t\t\t\tthrow new Error(\n\t\t\t\t\t\t\t\t`Could not find extending renderer: ${d.id}`,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\ttry {\n\t\t\t\t\t\t\treturn await renderer.load();\n\t\t\t\t\t\t} catch (e) {\n\t\t\t\t\t\t\t// Squash any errors extends errors. They won't prevent the renderer\n\t\t\t\t\t\t\t// itself from working, so just log them.\n\t\t\t\t\t\t\tconsole.error(e);\n\t\t\t\t\t\t\tthis.postDebugMessage(\n\t\t\t\t\t\t\t\t\"Activating dependant renderer failed\",\n\t\t\t\t\t\t\t\t{ dependent: d.id, error: e + \"\" },\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t}),\n\t\t\t\t);\n\n\t\t\t\treturn this._api;\n\t\t\t} catch (e) {\n\t\t\t\tthis.postDebugMessage(\"Loading renderer failed\");\n\t\t\t\tthrow e;\n\t\t\t}\n\t\t}\n\n\t\tprivate postDebugMessage(msg: string, data?: Record<string, string>) {\n\t\t\tpostNotebookMessage<webviewMessages.ILogRendererDebugMessage>(\n\t\t\t\t\"logRendererDebugMessage\",\n\t\t\t\t{\n\t\t\t\t\tmessage: `[renderer ${this.data.id}] - ${msg}`,\n\t\t\t\t\tdata,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\n\tconst kernelPreloads = new (class {\n\t\tprivate readonly preloads = new Map<\n\t\t\tstring /* uri */,\n\t\t\tPromise<unknown>\n\t\t>();\n\n\t\t/**\n\t\t * Returns a promise that resolves when the given preload is activated.\n\t\t */\n\t\tpublic waitFor(uri: string) {\n\t\t\treturn (\n\t\t\t\tthis.preloads.get(uri) ||\n\t\t\t\tPromise.resolve(new Error(`Preload not ready: ${uri}`))\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Loads a preload.\n\t\t * @param uri URI to load from\n\t\t * @param originalUri URI to show in an error message if the preload is invalid.\n\t\t */\n\t\tpublic load(uri: string) {\n\t\t\tconst promise = Promise.all([\n\t\t\t\trunKernelPreload(uri),\n\t\t\t\tthis.waitForAllCurrent(),\n\t\t\t]);\n\n\t\t\tthis.preloads.set(uri, promise);\n\t\t\treturn promise;\n\t\t}\n\n\t\t/**\n\t\t * Returns a promise that waits for all currently-registered preloads to\n\t\t * activate before resolving.\n\t\t */\n\t\tpublic waitForAllCurrent() {\n\t\t\treturn Promise.all(\n\t\t\t\t[...this.preloads.values()].map((p) => p.catch((err) => err)),\n\t\t\t);\n\t\t}\n\t})();\n\n\tconst outputRunner = new (class {\n\t\tprivate readonly outputs = new Map<\n\t\t\tstring,\n\t\t\t{ abort: AbortController; queue: Promise<unknown> }\n\t\t>();\n\n\t\t/**\n\t\t * Pushes the action onto the list of actions for the given output ID,\n\t\t * ensuring that it's run in-order.\n\t\t */\n\t\tpublic enqueue(\n\t\t\toutputId: string,\n\t\t\taction: (cancelSignal: AbortSignal) => unknown,\n\t\t) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst record = this.outputs.get(outputId);\n\t\t\tif (record) {\n\t\t\t\trecord.queue = record.queue.then(async (r) => {\n\t\t\t\t\tif (!record.abort.signal.aborted) {\n\t\t\t\t\t\tawait action(record.abort.signal);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.outputs.set(outputId, {\n\t\t\t\t\tabort: controller,\n\t\t\t\t\tqueue: new Promise((r) => r(action(controller.signal))),\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tprivate pendingOutputCreationRequest: Map<string, IDisposable> =\n\t\t\tnew Map();\n\n\t\tpublic enqueueIdle(\n\t\t\toutputId: string,\n\t\t\taction: (cancelSignal: AbortSignal) => unknown,\n\t\t) {\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\toutputRunner.pendingOutputCreationRequest.set(\n\t\t\t\toutputId,\n\t\t\t\trunWhenIdle(() => {\n\t\t\t\t\toutputRunner.enqueue(outputId, action);\n\t\t\t\t\toutputRunner.pendingOutputCreationRequest.delete(outputId);\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\n\t\t/**\n\t\t * Cancels the rendering of all outputs.\n\t\t */\n\t\tpublic cancelAll() {\n\t\t\t// Delete all pending idle requests\n\t\t\tthis.pendingOutputCreationRequest.forEach((r) => r.dispose());\n\t\t\tthis.pendingOutputCreationRequest.clear();\n\n\t\t\tfor (const { abort } of this.outputs.values()) {\n\t\t\t\tabort.abort();\n\t\t\t}\n\t\t\tthis.outputs.clear();\n\t\t}\n\n\t\t/**\n\t\t * Cancels any ongoing rendering out an output.\n\t\t */\n\t\tpublic cancelOutput(outputId: string) {\n\t\t\t// Delete the pending idle request if it exists\n\t\t\tthis.pendingOutputCreationRequest.get(outputId)?.dispose();\n\t\t\tthis.pendingOutputCreationRequest.delete(outputId);\n\n\t\t\tconst output = this.outputs.get(outputId);\n\t\t\tif (output) {\n\t\t\t\toutput.abort.abort();\n\t\t\t\tthis.outputs.delete(outputId);\n\t\t\t}\n\t\t}\n\t})();\n\n\tconst renderers = new (class {\n\t\tprivate readonly _renderers = new Map</* id */ string, Renderer>();\n\n\t\tconstructor() {\n\t\t\tfor (const renderer of ctx.rendererData) {\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\t\t}\n\n\t\tpublic getRenderer(id: string): Renderer | undefined {\n\t\t\treturn this._renderers.get(id);\n\t\t}\n\n\t\tprivate rendererEqual(\n\t\t\ta: webviewMessages.RendererMetadata,\n\t\t\tb: webviewMessages.RendererMetadata,\n\t\t) {\n\t\t\tif (\n\t\t\t\ta.id !== b.id ||\n\t\t\t\ta.entrypoint.path !== b.entrypoint.path ||\n\t\t\t\ta.entrypoint.extends !== b.entrypoint.extends ||\n\t\t\t\ta.messaging !== b.messaging\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tif (a.mimeTypes.length !== b.mimeTypes.length) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\tfor (let i = 0; i < a.mimeTypes.length; i++) {\n\t\t\t\tif (a.mimeTypes[i] !== b.mimeTypes[i]) {\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn true;\n\t\t}\n\n\t\tpublic updateRendererData(\n\t\t\trendererData: readonly webviewMessages.RendererMetadata[],\n\t\t) {\n\t\t\tconst oldKeys = new Set(this._renderers.keys());\n\t\t\tconst newKeys = new Set(rendererData.map((d) => d.id));\n\n\t\t\tfor (const renderer of rendererData) {\n\t\t\t\tconst existing = this._renderers.get(renderer.id);\n\t\t\t\tif (existing && this.rendererEqual(existing.data, renderer)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tthis.addRenderer(renderer);\n\t\t\t}\n\n\t\t\tfor (const key of oldKeys) {\n\t\t\t\tif (!newKeys.has(key)) {\n\t\t\t\t\tthis._renderers.delete(key);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate addRenderer(renderer: webviewMessages.RendererMetadata) {\n\t\t\tthis._renderers.set(renderer.id, new Renderer(renderer));\n\t\t}\n\n\t\tpublic clearAll() {\n\t\t\toutputRunner.cancelAll();\n\t\t\tfor (const renderer of this._renderers.values()) {\n\t\t\t\trenderer.disposeOutputItem();\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(rendererId: string, outputId: string) {\n\t\t\toutputRunner.cancelOutput(outputId);\n\t\t\tthis._renderers.get(rendererId)?.disposeOutputItem(outputId);\n\t\t}\n\n\t\tpublic async render(\n\t\t\titem: ExtendedOutputItem,\n\t\t\tpreferredRendererId: string | undefined,\n\t\t\telement: HTMLElement,\n\t\t\tsignal: AbortSignal,\n\t\t): Promise<void> {\n\t\t\tconst primaryRenderer = this.findRenderer(\n\t\t\t\tpreferredRendererId,\n\t\t\t\titem,\n\t\t\t);\n\t\t\tif (!primaryRenderer) {\n\t\t\t\tconst errorMessage = (\n\t\t\t\t\twindow.document.documentElement.style.getPropertyValue(\n\t\t\t\t\t\t\"--notebook-cell-renderer-not-found-error\",\n\t\t\t\t\t) || \"\"\n\t\t\t\t).replace(\"$0\", () => item.mime);\n\t\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Try primary renderer first\n\t\t\tif (\n\t\t\t\t!(await this._doRender(item, element, primaryRenderer, signal))\n\t\t\t\t\t.continue\n\t\t\t) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// Primary renderer failed in an expected way. Fallback to render the next mime types\n\t\t\tfor (const additionalItemData of item._allOutputItems) {\n\t\t\t\tif (additionalItemData.mime === item.mime) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst additionalItem = await additionalItemData.getItem();\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (additionalItem) {\n\t\t\t\t\tconst renderer = this.findRenderer(\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tadditionalItem,\n\t\t\t\t\t);\n\t\t\t\t\tif (renderer) {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\tawait this._doRender(\n\t\t\t\t\t\t\t\t\tadditionalItem,\n\t\t\t\t\t\t\t\t\telement,\n\t\t\t\t\t\t\t\t\trenderer,\n\t\t\t\t\t\t\t\t\tsignal,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t).continue\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\treturn; // We rendered successfully\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// All renderers have failed and there is nothing left to fallback to\n\t\t\tconst errorMessage = (\n\t\t\t\twindow.document.documentElement.style.getPropertyValue(\n\t\t\t\t\t\"--notebook-cell-renderer-fallbacks-exhausted\",\n\t\t\t\t) || \"\"\n\t\t\t).replace(\"$0\", () => item.mime);\n\t\t\tthis.showRenderError(item, element, errorMessage);\n\t\t}\n\n\t\tprivate async _doRender(\n\t\t\titem: rendererApi.OutputItem,\n\t\t\telement: HTMLElement,\n\t\t\trenderer: Renderer,\n\t\t\tsignal: AbortSignal,\n\t\t): Promise<{ continue: boolean }> {\n\t\t\ttry {\n\t\t\t\tawait renderer.renderOutputItem(item, element, signal);\n\t\t\t\treturn { continue: false }; // We rendered successfully\n\t\t\t} catch (e) {\n\t\t\t\tif (signal.aborted) {\n\t\t\t\t\treturn { continue: false };\n\t\t\t\t}\n\n\t\t\t\tif (e instanceof Error && e.name === renderFallbackErrorName) {\n\t\t\t\t\treturn { continue: true };\n\t\t\t\t} else {\n\t\t\t\t\tthrow e; // Bail and let callers handle unknown errors\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tprivate findRenderer(\n\t\t\tpreferredRendererId: string | undefined,\n\t\t\tinfo: rendererApi.OutputItem,\n\t\t) {\n\t\t\tlet renderer: Renderer | undefined;\n\n\t\t\tif (typeof preferredRendererId === \"string\") {\n\t\t\t\trenderer = Array.from(this._renderers.values()).find(\n\t\t\t\t\t(renderer) => renderer.data.id === preferredRendererId,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst renderers = Array.from(this._renderers.values()).filter(\n\t\t\t\t\t(renderer) =>\n\t\t\t\t\t\trenderer.data.mimeTypes.includes(info.mime) &&\n\t\t\t\t\t\t!renderer.data.entrypoint.extends,\n\t\t\t\t);\n\n\t\t\t\tif (renderers.length) {\n\t\t\t\t\t// De-prioritize built-in renderers\n\t\t\t\t\trenderers.sort(\n\t\t\t\t\t\t(a, b) => +a.data.isBuiltin - +b.data.isBuiltin,\n\t\t\t\t\t);\n\n\t\t\t\t\t// Use first renderer we find in sorted list\n\t\t\t\t\trenderer = renderers[0];\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn renderer;\n\t\t}\n\n\t\tprivate showRenderError(\n\t\t\tinfo: rendererApi.OutputItem,\n\t\t\telement: HTMLElement,\n\t\t\terrorMessage: string,\n\t\t) {\n\t\t\tconst errorContainer = document.createElement(\"div\");\n\n\t\t\tconst error = document.createElement(\"div\");\n\t\t\terror.className = \"no-renderer-error\";\n\t\t\terror.innerText = errorMessage;\n\n\t\t\tconst cellText = document.createElement(\"div\");\n\t\t\tcellText.innerText = info.text();\n\n\t\t\terrorContainer.appendChild(error);\n\t\t\terrorContainer.appendChild(cellText);\n\n\t\t\telement.innerText = \"\";\n\t\t\telement.appendChild(errorContainer);\n\t\t}\n\t})();\n\n\tconst viewModel = new (class ViewModel {\n\t\tprivate readonly _markupCells = new Map<string, MarkupCell>();\n\t\tprivate readonly _outputCells = new Map<string, OutputCell>();\n\n\t\tpublic clearAll() {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.dispose();\n\t\t\t}\n\t\t\tthis._markupCells.clear();\n\n\t\t\tfor (const output of this._outputCells.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis._outputCells.clear();\n\t\t}\n\n\t\tprivate async createMarkupCell(\n\t\t\tinit: webviewMessages.IMarkupCellInitialization,\n\t\t\ttop: number,\n\t\t\tvisible: boolean,\n\t\t): Promise<MarkupCell> {\n\t\t\tconst existing = this._markupCells.get(init.cellId);\n\t\t\tif (existing) {\n\t\t\t\tconsole.error(\n\t\t\t\t\t`Trying to create markup that already exists: ${init.cellId}`,\n\t\t\t\t);\n\t\t\t\treturn existing;\n\t\t\t}\n\n\t\t\tconst cell = new MarkupCell(\n\t\t\t\tinit.cellId,\n\t\t\t\tinit.mime,\n\t\t\t\tinit.content,\n\t\t\t\ttop,\n\t\t\t\tinit.metadata,\n\t\t\t);\n\t\t\tcell.element.style.visibility = visible ? \"\" : \"hidden\";\n\t\t\tthis._markupCells.set(init.cellId, cell);\n\n\t\t\tawait cell.ready;\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic async ensureMarkupCell(\n\t\t\tinfo: webviewMessages.IMarkupCellInitialization,\n\t\t): Promise<void> {\n\t\t\tlet cell = this._markupCells.get(info.cellId);\n\t\t\tif (cell) {\n\t\t\t\tcell.element.style.visibility = info.visible ? \"\" : \"hidden\";\n\t\t\t\tawait cell.updateContentAndRender(info.content, info.metadata);\n\t\t\t} else {\n\t\t\t\tcell = await this.createMarkupCell(\n\t\t\t\t\tinfo,\n\t\t\t\t\tinfo.offset,\n\t\t\t\t\tinfo.visible,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic deleteMarkupCell(id: string) {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tif (cell) {\n\t\t\t\tcell.remove();\n\t\t\t\tcell.dispose();\n\t\t\t\tthis._markupCells.delete(id);\n\t\t\t}\n\t\t}\n\n\t\tpublic async updateMarkupContent(\n\t\t\tid: string,\n\t\t\tnewContent: string,\n\t\t\tmetadata: NotebookCellMetadata,\n\t\t): Promise<void> {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tawait cell?.updateContentAndRender(newContent, metadata);\n\t\t}\n\n\t\tpublic showMarkupCell(\n\t\t\tid: string,\n\t\t\ttop: number,\n\t\t\tnewContent: string | undefined,\n\t\t\tmetadata: NotebookCellMetadata | undefined,\n\t\t): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.show(top, newContent, metadata);\n\t\t}\n\n\t\tpublic hideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic unhideMarkupCell(id: string): void {\n\t\t\tconst cell = this.getExpectedMarkupCell(id);\n\t\t\tcell?.unhide();\n\t\t}\n\n\t\tprivate getExpectedMarkupCell(id: string): MarkupCell | undefined {\n\t\t\tconst cell = this._markupCells.get(id);\n\t\t\tif (!cell) {\n\t\t\t\tconsole.log(`Could not find markup cell '${id}'`);\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic updateSelectedCells(selectedCellIds: readonly string[]) {\n\t\t\tconst selectedCellSet = new Set<string>(selectedCellIds);\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.setSelected(selectedCellSet.has(cell.id));\n\t\t\t}\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(dragAndDropEnabled: boolean) {\n\t\t\tfor (const cell of this._markupCells.values()) {\n\t\t\t\tcell.toggleDragDropEnabled(dragAndDropEnabled);\n\t\t\t}\n\t\t}\n\n\t\tpublic updateMarkupScrolls(\n\t\t\tmarkupCells: readonly webviewMessages.IMarkupCellScrollTops[],\n\t\t) {\n\t\t\tfor (const { id, top } of markupCells) {\n\t\t\t\tconst cell = this._markupCells.get(id);\n\t\t\t\tif (cell) {\n\t\t\t\t\tcell.element.style.top = `${top}px`;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic async renderOutputCell(\n\t\t\tdata: webviewMessages.ICreationRequestMessage,\n\t\t\tsignal: AbortSignal,\n\t\t): Promise<void> {\n\t\t\tconst preloadErrors = await Promise.all<undefined | Error>(\n\t\t\t\tdata.requiredPreloads.map((p) =>\n\t\t\t\t\tkernelPreloads.waitFor(p.uri).then(\n\t\t\t\t\t\t() => undefined,\n\t\t\t\t\t\t(err) => err,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (signal.aborted) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst cellOutput = this.ensureOutputCell(\n\t\t\t\tdata.cellId,\n\t\t\t\tdata.cellTop,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t\treturn cellOutput.renderOutputElement(data, preloadErrors, signal);\n\t\t}\n\n\t\tpublic ensureOutputCell(\n\t\t\tcellId: string,\n\t\t\tcellTop: number,\n\t\t\tskipCellTopUpdateIfExist: boolean,\n\t\t): OutputCell {\n\t\t\tlet cell = this._outputCells.get(cellId);\n\t\t\tconst existed = !!cell;\n\t\t\tif (!cell) {\n\t\t\t\tcell = new OutputCell(cellId);\n\t\t\t\tthis._outputCells.set(cellId, cell);\n\t\t\t}\n\n\t\t\tif (existed && skipCellTopUpdateIfExist) {\n\t\t\t\treturn cell;\n\t\t\t}\n\n\t\t\tcell.element.style.top = cellTop + \"px\";\n\t\t\treturn cell;\n\t\t}\n\n\t\tpublic clearOutput(\n\t\t\tcellId: string,\n\t\t\toutputId: string,\n\t\t\trendererId: string | undefined,\n\t\t) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.clearOutput(outputId, rendererId);\n\t\t}\n\n\t\tpublic showOutput(cellId: string, outputId: string, top: number) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.show(outputId, top);\n\t\t}\n\n\t\tpublic updateAndRerender(\n\t\t\tcellId: string,\n\t\t\toutputId: string,\n\t\t\tcontent: webviewMessages.ICreationContent,\n\t\t) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateContentAndRerender(outputId, content);\n\t\t}\n\n\t\tpublic hideOutput(cellId: string) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.hide();\n\t\t}\n\n\t\tpublic updateOutputHeight(\n\t\t\tcellId: string,\n\t\t\toutputId: string,\n\t\t\theight: number,\n\t\t) {\n\t\t\tconst cell = this._outputCells.get(cellId);\n\t\t\tcell?.updateOutputHeight(outputId, height);\n\t\t}\n\n\t\tpublic updateOutputsScroll(\n\t\t\tupdates: webviewMessages.IContentWidgetTopRequest[],\n\t\t) {\n\t\t\tfor (const request of updates) {\n\t\t\t\tconst cell = this._outputCells.get(request.cellId);\n\t\t\t\tcell?.updateScroll(request);\n\t\t\t}\n\t\t}\n\t})();\n\n\tclass MarkdownCodeBlock {\n\t\tprivate static pendingCodeBlocksToHighlight = new Map<\n\t\t\tstring,\n\t\t\tHTMLElement\n\t\t>();\n\n\t\tpublic static highlightCodeBlock(id: string, html: string) {\n\t\t\tconst el = MarkdownCodeBlock.pendingCodeBlocksToHighlight.get(id);\n\t\t\tif (!el) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst trustedHtml = ttPolicy?.createHTML(html) ?? html;\n\t\t\tel.innerHTML = trustedHtml as string; // CodeQL [SM03712] The rendered content comes from VS Code's tokenizer and is considered safe\n\t\t\tconst root = el.getRootNode();\n\t\t\tif (root instanceof ShadowRoot) {\n\t\t\t\tif (!root.adoptedStyleSheets.includes(tokenizationStyle)) {\n\t\t\t\t\troot.adoptedStyleSheets.push(tokenizationStyle);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tpublic static requestHighlightCodeBlock(\n\t\t\troot: HTMLElement | ShadowRoot,\n\t\t) {\n\t\t\tconst codeBlocks: Array<{\n\t\t\t\tvalue: string;\n\t\t\t\tlang: string;\n\t\t\t\tid: string;\n\t\t\t}> = [];\n\t\t\tlet i = 0;\n\t\t\tfor (const el of root.querySelectorAll(\".vscode-code-block\")) {\n\t\t\t\tconst lang = el.getAttribute(\"data-vscode-code-block-lang\");\n\t\t\t\tif (el.textContent && lang) {\n\t\t\t\t\tconst id = `${Date.now()}-${i++}`;\n\t\t\t\t\tcodeBlocks.push({ value: el.textContent, lang: lang, id });\n\t\t\t\t\tMarkdownCodeBlock.pendingCodeBlocksToHighlight.set(\n\t\t\t\t\t\tid,\n\t\t\t\t\t\tel as HTMLElement,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn codeBlocks;\n\t\t}\n\t}\n\n\tclass MarkupCell {\n\t\tpublic readonly ready: Promise<void>;\n\n\t\tpublic readonly id: string;\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate readonly outputItem: ExtendedOutputItem;\n\n\t\t/// Internal field that holds text content\n\t\tprivate _content: {\n\t\t\treadonly value: string;\n\t\t\treadonly version: number;\n\t\t\treadonly metadata: NotebookCellMetadata;\n\t\t};\n\n\t\tprivate _isDisposed = false;\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(\n\t\t\tid: string,\n\t\t\tmime: string,\n\t\t\tcontent: string,\n\t\t\ttop: number,\n\t\t\tmetadata: NotebookCellMetadata,\n\t\t) {\n\t\t\tconst self = this;\n\t\t\tthis.id = id;\n\t\t\tthis._content = { value: content, version: 0, metadata: metadata };\n\n\t\t\tconst { promise, resolve, reject } = promiseWithResolvers<void>();\n\t\t\tthis.ready = promise;\n\n\t\t\tlet cachedData:\n\t\t\t\t| { readonly version: number; readonly value: Uint8Array }\n\t\t\t\t| undefined;\n\t\t\tthis.outputItem = Object.freeze<ExtendedOutputItem>({\n\t\t\t\tid,\n\t\t\t\tmime,\n\n\t\t\t\tget metadata(): NotebookCellMetadata {\n\t\t\t\t\treturn self._content.metadata;\n\t\t\t\t},\n\n\t\t\t\ttext: (): string => {\n\t\t\t\t\treturn this._content.value;\n\t\t\t\t},\n\n\t\t\t\tjson: () => {\n\t\t\t\t\treturn undefined;\n\t\t\t\t},\n\n\t\t\t\tdata: (): Uint8Array => {\n\t\t\t\t\tif (cachedData?.version === this._content.version) {\n\t\t\t\t\t\treturn cachedData.value;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst data = textEncoder.encode(this._content.value);\n\t\t\t\t\tcachedData = {\n\t\t\t\t\t\tversion: this._content.version,\n\t\t\t\t\t\tvalue: data,\n\t\t\t\t\t};\n\t\t\t\t\treturn data;\n\t\t\t\t},\n\n\t\t\t\tblob(): Blob {\n\t\t\t\t\treturn new Blob([this.data()], { type: this.mime });\n\t\t\t\t},\n\n\t\t\t\t_allOutputItems: [\n\t\t\t\t\t{\n\t\t\t\t\t\tmime,\n\t\t\t\t\t\tgetItem: async () => this.outputItem,\n\t\t\t\t\t},\n\t\t\t\t],\n\t\t\t});\n\n\t\t\tconst root = window.document.getElementById(\"container\")!;\n\t\t\tconst markupCell = document.createElement(\"div\");\n\t\t\tmarkupCell.className = \"markup\";\n\t\t\tmarkupCell.style.position = \"absolute\";\n\t\t\tmarkupCell.style.width = \"100%\";\n\n\t\t\tthis.element = document.createElement(\"div\");\n\t\t\tthis.element.id = this.id;\n\t\t\tthis.element.classList.add(\"preview\");\n\t\t\tthis.element.style.position = \"absolute\";\n\t\t\tthis.element.style.top = top + \"px\";\n\t\t\tthis.toggleDragDropEnabled(currentOptions.dragAndDropEnabled);\n\t\t\tmarkupCell.appendChild(this.element);\n\t\t\troot.appendChild(markupCell);\n\n\t\t\tthis.addEventListeners();\n\n\t\t\tthis.updateContentAndRender(\n\t\t\t\tthis._content.value,\n\t\t\t\tthis._content.metadata,\n\t\t\t).then(\n\t\t\t\t() => {\n\t\t\t\t\tif (!this._isDisposed) {\n\t\t\t\t\t\tresizeObserver.observe(\n\t\t\t\t\t\t\tthis.element,\n\t\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\t\tfalse,\n\t\t\t\t\t\t\tthis.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tresolve();\n\t\t\t\t},\n\t\t\t\t() => reject(),\n\t\t\t);\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._isDisposed = true;\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tprivate addEventListeners() {\n\t\t\tthis.element.addEventListener(\"dblclick\", () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IToggleMarkupPreviewMessage>(\n\t\t\t\t\t\"toggleMarkupPreview\",\n\t\t\t\t\t{ cellId: this.id },\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"click\", (e) => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IClickMarkupCellMessage>(\n\t\t\t\t\t\"clickMarkupCell\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: this.id,\n\t\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\t\tmetaKey: e.metaKey,\n\t\t\t\t\t\tshiftKey: e.shiftKey,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"contextmenu\", (e) => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IContextMenuMarkupCellMessage>(\n\t\t\t\t\t\"contextMenuMarkupCell\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: this.id,\n\t\t\t\t\t\tclientX: e.clientX,\n\t\t\t\t\t\tclientY: e.clientY,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"mouseenter\", () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMarkupCellMessage>(\n\t\t\t\t\t\"mouseEnterMarkupCell\",\n\t\t\t\t\t{ cellId: this.id },\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"mouseleave\", () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMarkupCellMessage>(\n\t\t\t\t\t\"mouseLeaveMarkupCell\",\n\t\t\t\t\t{ cellId: this.id },\n\t\t\t\t);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"dragstart\", (e) => {\n\t\t\t\tmarkupCellDragManager.startDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"drag\", (e) => {\n\t\t\t\tmarkupCellDragManager.updateDrag(e, this.id);\n\t\t\t});\n\n\t\t\tthis.element.addEventListener(\"dragend\", (e) => {\n\t\t\t\tmarkupCellDragManager.endDrag(e, this.id);\n\t\t\t});\n\t\t}\n\n\t\tpublic async updateContentAndRender(\n\t\t\tnewContent: string,\n\t\t\tmetadata: NotebookCellMetadata,\n\t\t): Promise<void> {\n\t\t\tthis._content = {\n\t\t\t\tvalue: newContent,\n\t\t\t\tversion: this._content.version + 1,\n\t\t\t\tmetadata,\n\t\t\t};\n\n\t\t\tthis.renderTaskAbort?.abort();\n\n\t\t\tconst controller = new AbortController();\n\t\t\tthis.renderTaskAbort = controller;\n\t\t\ttry {\n\t\t\t\tawait renderers.render(\n\t\t\t\t\tthis.outputItem,\n\t\t\t\t\tundefined,\n\t\t\t\t\tthis.element,\n\t\t\t\t\tthis.renderTaskAbort.signal,\n\t\t\t\t);\n\t\t\t} finally {\n\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst root = this.element.shadowRoot ?? this.element;\n\t\t\tconst html = [];\n\t\t\tfor (const child of root.children) {\n\t\t\t\tswitch (child.tagName) {\n\t\t\t\t\tcase \"LINK\":\n\t\t\t\t\tcase \"SCRIPT\":\n\t\t\t\t\tcase \"STYLE\":\n\t\t\t\t\t\t// not worth sending over since it will be stripped before rendering\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\thtml.push(child.outerHTML);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconst codeBlocks: Array<{\n\t\t\t\tvalue: string;\n\t\t\t\tlang: string;\n\t\t\t\tid: string;\n\t\t\t}> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tpostNotebookMessage<webviewMessages.IRenderedMarkupMessage>(\n\t\t\t\t\"renderedMarkup\",\n\t\t\t\t{\n\t\t\t\t\tcellId: this.id,\n\t\t\t\t\thtml: html.join(\"\"),\n\t\t\t\t\tcodeBlocks,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false,\n\t\t\t});\n\t\t}\n\n\t\tpublic show(\n\t\t\ttop: number,\n\t\t\tnewContent: string | undefined,\n\t\t\tmetadata: NotebookCellMetadata | undefined,\n\t\t): void {\n\t\t\tthis.element.style.visibility = \"\";\n\t\t\tthis.element.style.top = `${top}px`;\n\t\t\tif (typeof newContent === \"string\" || metadata) {\n\t\t\t\tthis.updateContentAndRender(\n\t\t\t\t\tnewContent ?? this._content.value,\n\t\t\t\t\tmetadata ?? this._content.metadata,\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.updateMarkupDimensions();\n\t\t\t}\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = \"hidden\";\n\t\t}\n\n\t\tpublic unhide() {\n\t\t\tthis.element.style.visibility = \"\";\n\t\t\tthis.updateMarkupDimensions();\n\t\t}\n\n\t\tpublic remove() {\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tprivate async updateMarkupDimensions() {\n\t\t\tdimensionUpdater.updateHeight(this.id, this.element.offsetHeight, {\n\t\t\t\tisOutput: false,\n\t\t\t});\n\t\t}\n\n\t\tpublic setSelected(selected: boolean) {\n\t\t\tthis.element.classList.toggle(\"selected\", selected);\n\t\t}\n\n\t\tpublic toggleDragDropEnabled(enabled: boolean) {\n\t\t\tif (enabled) {\n\t\t\t\tthis.element.classList.add(\"draggable\");\n\t\t\t\tthis.element.setAttribute(\"draggable\", \"true\");\n\t\t\t} else {\n\t\t\t\tthis.element.classList.remove(\"draggable\");\n\t\t\t\tthis.element.removeAttribute(\"draggable\");\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputCell {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate readonly outputElements = new Map<\n\t\t\t/*outputId*/ string,\n\t\t\tOutputContainer\n\t\t>();\n\n\t\tconstructor(cellId: string) {\n\t\t\tconst container = window.document.getElementById(\"container\")!;\n\n\t\t\tconst upperWrapperElement = createFocusSink(cellId);\n\t\t\tcontainer.appendChild(upperWrapperElement);\n\n\t\t\tthis.element = document.createElement(\"div\");\n\t\t\tthis.element.style.position = \"absolute\";\n\t\t\tthis.element.style.outline = \"0\";\n\n\t\t\tthis.element.id = cellId;\n\t\t\tthis.element.classList.add(\"cell_container\");\n\n\t\t\tcontainer.appendChild(this.element);\n\t\t\tthis.element = this.element;\n\n\t\t\tconst lowerWrapperElement = createFocusSink(cellId, true);\n\t\t\tcontainer.appendChild(lowerWrapperElement);\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tfor (const output of this.outputElements.values()) {\n\t\t\t\toutput.dispose();\n\t\t\t}\n\t\t\tthis.outputElements.clear();\n\t\t}\n\n\t\tprivate createOutputElement(\n\t\t\tdata: webviewMessages.ICreationRequestMessage,\n\t\t): OutputElement {\n\t\t\tlet outputContainer = this.outputElements.get(data.outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\toutputContainer = new OutputContainer(data.outputId);\n\t\t\t\tthis.element.appendChild(outputContainer.element);\n\t\t\t\tthis.outputElements.set(data.outputId, outputContainer);\n\t\t\t}\n\n\t\t\treturn outputContainer.createOutputElement(\n\t\t\t\tdata.outputId,\n\t\t\t\tdata.outputOffset,\n\t\t\t\tdata.left,\n\t\t\t\tdata.cellId,\n\t\t\t);\n\t\t}\n\n\t\tpublic async renderOutputElement(\n\t\t\tdata: webviewMessages.ICreationRequestMessage,\n\t\t\tpreloadErrors: ReadonlyArray<Error | undefined>,\n\t\t\tsignal: AbortSignal,\n\t\t) {\n\t\t\tconst startTime = Date.now();\n\t\t\tconst outputElement /** outputNode */ =\n\t\t\t\tthis.createOutputElement(data);\n\t\t\tawait outputElement.render(\n\t\t\t\tdata.content,\n\t\t\t\tdata.rendererId,\n\t\t\t\tpreloadErrors,\n\t\t\t\tsignal,\n\t\t\t);\n\n\t\t\t// don't hide until after this step so that the height is right\n\t\t\toutputElement /** outputNode */.element.style.visibility =\n\t\t\t\tdata.initiallyHidden ? \"hidden\" : \"\";\n\n\t\t\tif (!!data.executionId && !!data.rendererId) {\n\t\t\t\tlet outputSize: number | undefined;\n\t\t\t\tlet mimeType: string | undefined;\n\t\t\t\tif (data.content.type === 1 /* extension */) {\n\t\t\t\t\toutputSize = data.content.output.valueBytes.length;\n\t\t\t\t\tmimeType = data.content.output.mime;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<webviewMessages.IPerformanceMessage>(\n\t\t\t\t\t\"notebookPerformanceMessage\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: data.cellId,\n\t\t\t\t\t\texecutionId: data.executionId,\n\t\t\t\t\t\tduration: Date.now() - startTime,\n\t\t\t\t\t\trendererId: data.rendererId,\n\t\t\t\t\t\toutputSize,\n\t\t\t\t\t\tmimeType,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic clearOutput(outputId: string, rendererId: string | undefined) {\n\t\t\tconst output = this.outputElements.get(outputId);\n\t\t\toutput?.clear(rendererId);\n\t\t\toutput?.dispose();\n\t\t\tthis.outputElements.delete(outputId);\n\t\t}\n\n\t\tpublic show(outputId: string, top: number) {\n\t\t\tconst outputContainer = this.outputElements.get(outputId);\n\t\t\tif (!outputContainer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.element.style.visibility = \"\";\n\t\t\tthis.element.style.top = `${top}px`;\n\t\t}\n\n\t\tpublic hide() {\n\t\t\tthis.element.style.visibility = \"hidden\";\n\t\t}\n\n\t\tpublic updateContentAndRerender(\n\t\t\toutputId: string,\n\t\t\tcontent: webviewMessages.ICreationContent,\n\t\t) {\n\t\t\tthis.outputElements.get(outputId)?.updateContentAndRender(content);\n\t\t}\n\n\t\tpublic updateOutputHeight(outputId: string, height: number) {\n\t\t\tthis.outputElements.get(outputId)?.updateHeight(height);\n\t\t}\n\n\t\tpublic updateScroll(request: webviewMessages.IContentWidgetTopRequest) {\n\t\t\tthis.element.style.top = `${request.cellTop}px`;\n\n\t\t\tconst outputElement = this.outputElements.get(request.outputId);\n\t\t\tif (outputElement) {\n\t\t\t\toutputElement.updateScroll(request.outputOffset);\n\n\t\t\t\tif (request.forceDisplay && outputElement.outputNode) {\n\t\t\t\t\t// TODO @rebornix @mjbvz, there is a misalignment here.\n\t\t\t\t\t// We set output visibility on cell container, other than output container or output node itself.\n\t\t\t\t\toutputElement.outputNode.element.style.visibility = \"\";\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (request.forceDisplay) {\n\t\t\t\tthis.element.style.visibility = \"\";\n\t\t\t}\n\t\t}\n\t}\n\n\tclass OutputContainer {\n\t\tpublic readonly element: HTMLElement;\n\n\t\tprivate _outputNode?: OutputElement;\n\n\t\tget outputNode() {\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tconstructor(private readonly outputId: string) {\n\t\t\tthis.element = document.createElement(\"div\");\n\t\t\tthis.element.classList.add(\"output_container\");\n\t\t\tthis.element.setAttribute(\n\t\t\t\t\"data-vscode-context\",\n\t\t\t\tJSON.stringify({ preventDefaultContextMenuItems: true }),\n\t\t\t);\n\t\t\tthis.element.style.position = \"absolute\";\n\t\t\tthis.element.style.overflow = \"hidden\";\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis._outputNode?.dispose();\n\t\t}\n\n\t\tpublic clear(rendererId: string | undefined) {\n\t\t\tif (rendererId) {\n\t\t\t\trenderers.clearOutput(rendererId, this.outputId);\n\t\t\t}\n\t\t\tthis.element.remove();\n\t\t}\n\n\t\tpublic updateHeight(height: number) {\n\t\t\tthis.element.style.maxHeight = `${height}px`;\n\t\t\tthis.element.style.height = `${height}px`;\n\t\t}\n\n\t\tpublic updateScroll(outputOffset: number) {\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\t\t}\n\n\t\tpublic createOutputElement(\n\t\t\toutputId: string,\n\t\t\toutputOffset: number,\n\t\t\tleft: number,\n\t\t\tcellId: string,\n\t\t): OutputElement {\n\t\t\tthis.element.innerText = \"\";\n\t\t\tthis.element.style.maxHeight = \"0px\";\n\t\t\tthis.element.style.top = `${outputOffset}px`;\n\n\t\t\tthis._outputNode?.dispose();\n\t\t\tthis._outputNode = new OutputElement(outputId, left, cellId);\n\t\t\tthis.element.appendChild(this._outputNode.element);\n\t\t\treturn this._outputNode;\n\t\t}\n\n\t\tpublic updateContentAndRender(\n\t\t\tcontent: webviewMessages.ICreationContent,\n\t\t) {\n\t\t\tthis._outputNode?.updateAndRerender(content);\n\t\t}\n\t}\n\n\tvscode.postMessage({\n\t\t__vscode_notebook_message: true,\n\t\ttype: \"initialized\",\n\t});\n\n\tfor (const preload of ctx.staticPreloadsData) {\n\t\tkernelPreloads.load(preload.entrypoint);\n\t}\n\n\tfunction postNotebookMessage<T extends webviewMessages.FromWebviewMessage>(\n\t\ttype: T[\"type\"],\n\t\tproperties: Omit<T, \"__vscode_notebook_message\" | \"type\">,\n\t) {\n\t\tvscode.postMessage({\n\t\t\t__vscode_notebook_message: true,\n\t\t\ttype,\n\t\t\t...properties,\n\t\t});\n\t}\n\n\tclass OutputElement {\n\t\tpublic readonly element: HTMLElement;\n\t\tprivate _content?: {\n\t\t\treadonly preferredRendererId: string | undefined;\n\t\t\treadonly preloadErrors: ReadonlyArray<Error | undefined>;\n\t\t};\n\t\tprivate hasResizeObserver = false;\n\n\t\tprivate renderTaskAbort?: AbortController;\n\n\t\tconstructor(\n\t\t\tprivate readonly outputId: string,\n\t\t\tleft: number,\n\t\t\tpublic readonly cellId: string,\n\t\t) {\n\t\t\tthis.element = document.createElement(\"div\");\n\t\t\tthis.element.id = outputId;\n\t\t\tthis.element.classList.add(\"output\");\n\t\t\tthis.element.style.position = \"absolute\";\n\t\t\tthis.element.style.top = `0px`;\n\t\t\tthis.element.style.left = left + \"px\";\n\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\n\t\t\tthis.element.addEventListener(\"mouseenter\", () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseEnterMessage>(\n\t\t\t\t\t\"mouseenter\",\n\t\t\t\t\t{ id: outputId },\n\t\t\t\t);\n\t\t\t});\n\t\t\tthis.element.addEventListener(\"mouseleave\", () => {\n\t\t\t\tpostNotebookMessage<webviewMessages.IMouseLeaveMessage>(\n\t\t\t\t\t\"mouseleave\",\n\t\t\t\t\t{ id: outputId },\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tpublic dispose() {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\t\t}\n\n\t\tpublic async render(\n\t\t\tcontent: webviewMessages.ICreationContent,\n\t\t\tpreferredRendererId: string | undefined,\n\t\t\tpreloadErrors: ReadonlyArray<Error | undefined>,\n\t\t\tsignal?: AbortSignal,\n\t\t) {\n\t\t\tthis.renderTaskAbort?.abort();\n\t\t\tthis.renderTaskAbort = undefined;\n\n\t\t\tthis._content = { preferredRendererId, preloadErrors };\n\t\t\tif (content.type === 0 /* RenderOutputType.Html */) {\n\t\t\t\tconst trustedHtml =\n\t\t\t\t\tttPolicy?.createHTML(content.htmlContent) ??\n\t\t\t\t\tcontent.htmlContent;\n\t\t\t\tthis.element.innerHTML = trustedHtml as string; // CodeQL [SM03712] The content comes from renderer extensions, not from direct user input.\n\t\t\t} else if (preloadErrors.some((e) => e instanceof Error)) {\n\t\t\t\tconst errors = preloadErrors.filter(\n\t\t\t\t\t(e): e is Error => e instanceof Error,\n\t\t\t\t);\n\t\t\t\tshowRenderError(`Error loading preloads`, this.element, errors);\n\t\t\t} else {\n\t\t\t\tconst item = createOutputItem(\n\t\t\t\t\tthis.outputId,\n\t\t\t\t\tcontent.output.mime,\n\t\t\t\t\tcontent.metadata,\n\t\t\t\t\tcontent.output.valueBytes,\n\t\t\t\t\tcontent.allOutputs,\n\t\t\t\t\tcontent.output.appended,\n\t\t\t\t);\n\n\t\t\t\tconst controller = new AbortController();\n\t\t\t\tthis.renderTaskAbort = controller;\n\n\t\t\t\t// Abort rendering if caller aborts\n\t\t\t\tsignal?.addEventListener(\"abort\", () => controller.abort());\n\n\t\t\t\ttry {\n\t\t\t\t\tawait renderers.render(\n\t\t\t\t\t\titem,\n\t\t\t\t\t\tpreferredRendererId,\n\t\t\t\t\t\tthis.element,\n\t\t\t\t\t\tcontroller.signal,\n\t\t\t\t\t);\n\t\t\t\t} finally {\n\t\t\t\t\tif (this.renderTaskAbort === controller) {\n\t\t\t\t\t\tthis.renderTaskAbort = undefined;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!this.hasResizeObserver) {\n\t\t\t\tthis.hasResizeObserver = true;\n\t\t\t\tresizeObserver.observe(\n\t\t\t\t\tthis.element,\n\t\t\t\t\tthis.outputId,\n\t\t\t\t\ttrue,\n\t\t\t\t\tthis.cellId,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tconst offsetHeight = this.element.offsetHeight;\n\t\t\tconst cps = document.defaultView!.getComputedStyle(this.element);\n\t\t\tconst verticalPadding =\n\t\t\t\tNumber.parseFloat(cps.paddingTop) +\n\t\t\t\tNumber.parseFloat(cps.paddingBottom);\n\t\t\tconst contentHeight = offsetHeight - verticalPadding;\n\t\t\tif (elementHasContent(contentHeight) && cps.padding === \"0px\") {\n\t\t\t\t// we set padding to zero if the output has no content (then we can have a zero-height output DOM node)\n\t\t\t\t// thus we need to ensure the padding is accounted when updating the init height of the output\n\t\t\t\tdimensionUpdater.updateHeight(\n\t\t\t\t\tthis.outputId,\n\t\t\t\t\toffsetHeight + ctx.style.outputNodePadding * 2,\n\t\t\t\t\t{\n\t\t\t\t\t\tisOutput: true,\n\t\t\t\t\t\tinit: true,\n\t\t\t\t\t},\n\t\t\t\t);\n\n\t\t\t\tthis.element.style.padding = `${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodePadding}px ${ctx.style.outputNodeLeftPadding}`;\n\t\t\t} else if (elementHasContent(contentHeight)) {\n\t\t\t\tdimensionUpdater.updateHeight(\n\t\t\t\t\tthis.outputId,\n\t\t\t\t\tthis.element.offsetHeight,\n\t\t\t\t\t{\n\t\t\t\t\t\tisOutput: true,\n\t\t\t\t\t\tinit: true,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\tthis.element.style.padding = `0 ${ctx.style.outputNodePadding}px 0 ${ctx.style.outputNodeLeftPadding}`;\n\t\t\t} else {\n\t\t\t\t// we have a zero-height output DOM node\n\t\t\t\tdimensionUpdater.updateHeight(this.outputId, 0, {\n\t\t\t\t\tisOutput: true,\n\t\t\t\t\tinit: true,\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tconst root = this.element.shadowRoot ?? this.element;\n\t\t\tconst codeBlocks: Array<{\n\t\t\t\tvalue: string;\n\t\t\t\tlang: string;\n\t\t\t\tid: string;\n\t\t\t}> = MarkdownCodeBlock.requestHighlightCodeBlock(root);\n\n\t\t\tif (codeBlocks.length > 0) {\n\t\t\t\tpostNotebookMessage<webviewMessages.IRenderedCellOutputMessage>(\n\t\t\t\t\t\"renderedCellOutput\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcodeBlocks,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tpublic updateAndRerender(content: webviewMessages.ICreationContent) {\n\t\t\tif (this._content) {\n\t\t\t\tthis.render(\n\t\t\t\t\tcontent,\n\t\t\t\t\tthis._content.preferredRendererId,\n\t\t\t\t\tthis._content.preloadErrors,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tconst markupCellDragManager = new (class MarkupCellDragManager {\n\t\tprivate currentDrag: { cellId: string; clientY: number } | undefined;\n\n\t\t// Transparent overlay that prevents elements from inside the webview from eating\n\t\t// drag events.\n\t\tprivate dragOverlay?: HTMLElement;\n\n\t\tconstructor() {\n\t\t\twindow.document.addEventListener(\"dragover\", (e) => {\n\t\t\t\t// Allow dropping dragged markup cells\n\t\t\t\te.preventDefault();\n\t\t\t});\n\n\t\t\twindow.document.addEventListener(\"drop\", (e) => {\n\t\t\t\te.preventDefault();\n\n\t\t\t\tconst drag = this.currentDrag;\n\t\t\t\tif (!drag) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDropMessage>(\n\t\t\t\t\t\"cell-drop\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: drag.cellId,\n\t\t\t\t\t\tctrlKey: e.ctrlKey,\n\t\t\t\t\t\taltKey: e.altKey,\n\t\t\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\n\t\tstartDrag(e: DragEvent, cellId: string) {\n\t\t\tif (!e.dataTransfer) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (!currentOptions.dragAndDropEnabled) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\n\t\t\tconst overlayZIndex = 9999;\n\t\t\tif (!this.dragOverlay) {\n\t\t\t\tthis.dragOverlay = document.createElement(\"div\");\n\t\t\t\tthis.dragOverlay.style.position = \"absolute\";\n\t\t\t\tthis.dragOverlay.style.top = \"0\";\n\t\t\t\tthis.dragOverlay.style.left = \"0\";\n\t\t\t\tthis.dragOverlay.style.zIndex = `${overlayZIndex}`;\n\t\t\t\tthis.dragOverlay.style.width = \"100%\";\n\t\t\t\tthis.dragOverlay.style.height = \"100%\";\n\t\t\t\tthis.dragOverlay.style.background = \"transparent\";\n\t\t\t\twindow.document.body.appendChild(this.dragOverlay);\n\t\t\t}\n\t\t\t(e.target as HTMLElement).style.zIndex = `${overlayZIndex + 1}`;\n\t\t\t(e.target as HTMLElement).classList.add(\"dragging\");\n\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragStartMessage>(\n\t\t\t\t\"cell-drag-start\",\n\t\t\t\t{\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t\tdragOffsetY: e.clientY,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\t// Continuously send updates while dragging instead of relying on `updateDrag`.\n\t\t\t// This lets us scroll the list based on drag position.\n\t\t\tconst trySendDragUpdate = () => {\n\t\t\t\tif (this.currentDrag?.cellId !== cellId) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tpostNotebookMessage<webviewMessages.ICellDragMessage>(\n\t\t\t\t\t\"cell-drag\",\n\t\t\t\t\t{\n\t\t\t\t\t\tcellId: cellId,\n\t\t\t\t\t\tdragOffsetY: this.currentDrag.clientY,\n\t\t\t\t\t},\n\t\t\t\t);\n\t\t\t\twindow.requestAnimationFrame(trySendDragUpdate);\n\t\t\t};\n\t\t\twindow.requestAnimationFrame(trySendDragUpdate);\n\t\t}\n\n\t\tupdateDrag(e: DragEvent, cellId: string) {\n\t\t\tif (cellId !== this.currentDrag?.cellId) {\n\t\t\t\tthis.currentDrag = undefined;\n\t\t\t} else {\n\t\t\t\tthis.currentDrag = { cellId, clientY: e.clientY };\n\t\t\t}\n\t\t}\n\n\t\tendDrag(e: DragEvent, cellId: string) {\n\t\t\tthis.currentDrag = undefined;\n\t\t\t(e.target as HTMLElement).classList.remove(\"dragging\");\n\t\t\tpostNotebookMessage<webviewMessages.ICellDragEndMessage>(\n\t\t\t\t\"cell-drag-end\",\n\t\t\t\t{\n\t\t\t\t\tcellId: cellId,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tif (this.dragOverlay) {\n\t\t\t\tthis.dragOverlay.remove();\n\t\t\t\tthis.dragOverlay = undefined;\n\t\t\t}\n\n\t\t\t(e.target as HTMLElement).style.zIndex = \"\";\n\t\t}\n\t})();\n}\n\nexport function preloadsScriptStr(\n\tstyleValues: PreloadStyles,\n\toptions: PreloadOptions,\n\trenderOptions: RenderOptions,\n\trenderers: readonly webviewMessages.RendererMetadata[],\n\tpreloads: readonly webviewMessages.StaticPreloadMetadata[],\n\tisWorkspaceTrusted: boolean,\n\tnonce: string,\n) {\n\tconst ctx: PreloadContext = {\n\t\tstyle: styleValues,\n\t\toptions,\n\t\trenderOptions,\n\t\trendererData: renderers,\n\t\tstaticPreloadsData: preloads,\n\t\tisWorkspaceTrusted,\n\t\tnonce,\n\t};\n\t// TS will try compiling `import()` in webviewPreloads, so use a helper function instead\n\t// of using `import(...)` directly\n\treturn `\n\t\tconst __import = (x) => import(x);\n\t\t(${webviewPreloads})(\n\t\t\tJSON.parse(decodeURIComponent(\"${encodeURIComponent(JSON.stringify(ctx))}\"))\n\t\t)\\n//# sourceURL=notebookWebviewPreloads.js\\n`;\n}\n\nexport function isEditableElement(element: Element): boolean {\n\treturn (\n\t\telement.tagName.toLowerCase() === \"input\" ||\n\t\telement.tagName.toLowerCase() === \"textarea\" ||\n\t\t\"editContext\" in element\n\t);\n}\n"],
  "mappings": "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",
  "names": ["range", "nodes", "tagName", "attributes", "id", "mime", "metadata", "valueBytes", "appended", "item", "find", "errorMessage", "renderer", "renderers"]
}
