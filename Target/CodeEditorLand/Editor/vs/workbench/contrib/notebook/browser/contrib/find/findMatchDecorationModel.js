import{Disposable as h}from"../../../../../../base/common/lifecycle.js";import"../../../../../../editor/common/model.js";import"../../../../../../editor/common/model/textModel.js";import{FindDecorations as s}from"../../../../../../editor/contrib/find/browser/findDecorations.js";import"../../../../../../editor/common/core/range.js";import{overviewRulerSelectionHighlightForeground as l,overviewRulerFindMatchForeground as d}from"../../../../../../platform/theme/common/colorRegistry.js";import{NotebookOverviewRulerLane as c}from"../../notebookBrowser.js";class N extends h{constructor(e,t){super();this._notebookEditor=e;this.ownerID=t}_allMatchesDecorations=[];_currentMatchCellDecorations=[];_allMatchesCellDecorations=[];_currentMatchDecorations=null;get currentMatchDecorations(){return this._currentMatchDecorations}clearDecorations(){this.clearCurrentFindMatchDecoration(),this.setAllFindMatchesDecorations([])}async highlightCurrentFindMatchDecorationInCell(e,t){return this.clearCurrentFindMatchDecoration(),this._notebookEditor.changeModelDecorations(o=>{const a=s._CURRENT_FIND_MATCH_DECORATION,n=[{range:t,options:a}],r={ownerId:e.handle,decorations:n};this._currentMatchDecorations={kind:"input",decorations:o.deltaDecorations(this._currentMatchDecorations?.kind==="input"?this._currentMatchDecorations.decorations:[],[r])}}),this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[{handle:e.handle,options:{overviewRuler:{color:l,modelRanges:[t],includeOutput:!1,position:c.Center}}}]),null}async highlightCurrentFindMatchDecorationInWebview(e,t){this.clearCurrentFindMatchDecoration();const o=await this._notebookEditor.findHighlightCurrent(t,this.ownerID);return this._currentMatchDecorations={kind:"output",index:t},this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[{handle:e.handle,options:{overviewRuler:{color:l,modelRanges:[],includeOutput:!0,position:c.Center}}}]),o}clearCurrentFindMatchDecoration(){this._currentMatchDecorations?.kind==="input"?this._notebookEditor.changeModelDecorations(e=>{e.deltaDecorations(this._currentMatchDecorations?.kind==="input"?this._currentMatchDecorations.decorations:[],[]),this._currentMatchDecorations=null}):this._currentMatchDecorations?.kind==="output"&&this._notebookEditor.findUnHighlightCurrent(this._currentMatchDecorations.index,this.ownerID),this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[])}setAllFindMatchesDecorations(e){this._notebookEditor.changeModelDecorations(t=>{const o=s._FIND_MATCH_DECORATION,a=e.map(n=>{const r=new Array(n.contentMatches.length);for(let i=0;i<n.contentMatches.length;i++)r[i]={range:n.contentMatches[i].range,options:o};return{ownerId:n.cell.handle,decorations:r}});this._allMatchesDecorations=t.deltaDecorations(this._allMatchesDecorations,a)}),this._allMatchesCellDecorations=this._notebookEditor.deltaCellDecorations(this._allMatchesCellDecorations,e.map(t=>({ownerId:t.cell.handle,handle:t.cell.handle,options:{overviewRuler:{color:d,modelRanges:t.contentMatches.map(o=>o.range),includeOutput:t.webviewMatches.length>0,position:c.Center}}})))}stopWebviewFind(){this._notebookEditor.findStop(this.ownerID)}dispose(){this.clearDecorations(),super.dispose()}}export{N as FindMatchDecorationModel};
