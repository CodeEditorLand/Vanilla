import{Disposable as h}from"../../../../../../base/common/lifecycle.js";import{FindDecorations as s}from"../../../../../../editor/contrib/find/browser/findDecorations.js";import{overviewRulerFindMatchForeground as d,overviewRulerSelectionHighlightForeground as l}from"../../../../../../platform/theme/common/colorRegistry.js";import{NotebookOverviewRulerLane as c}from"../../notebookBrowser.js";class m extends h{constructor(t,e){super();this._notebookEditor=t;this.ownerID=e}_allMatchesDecorations=[];_currentMatchCellDecorations=[];_allMatchesCellDecorations=[];_currentMatchDecorations=null;get currentMatchDecorations(){return this._currentMatchDecorations}clearDecorations(){this.clearCurrentFindMatchDecoration(),this.setAllFindMatchesDecorations([])}async highlightCurrentFindMatchDecorationInCell(t,e){return this.clearCurrentFindMatchDecoration(),this._notebookEditor.changeModelDecorations(o=>{const a=s._CURRENT_FIND_MATCH_DECORATION,n=[{range:e,options:a}],r={ownerId:t.handle,decorations:n};this._currentMatchDecorations={kind:"input",decorations:o.deltaDecorations(this._currentMatchDecorations?.kind==="input"?this._currentMatchDecorations.decorations:[],[r])}}),this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[{handle:t.handle,options:{overviewRuler:{color:l,modelRanges:[e],includeOutput:!1,position:c.Center}}}]),null}async highlightCurrentFindMatchDecorationInWebview(t,e){this.clearCurrentFindMatchDecoration();const o=await this._notebookEditor.findHighlightCurrent(e,this.ownerID);return this._currentMatchDecorations={kind:"output",index:e},this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[{handle:t.handle,options:{overviewRuler:{color:l,modelRanges:[],includeOutput:!0,position:c.Center}}}]),o}clearCurrentFindMatchDecoration(){this._currentMatchDecorations?.kind==="input"?this._notebookEditor.changeModelDecorations(t=>{t.deltaDecorations(this._currentMatchDecorations?.kind==="input"?this._currentMatchDecorations.decorations:[],[]),this._currentMatchDecorations=null}):this._currentMatchDecorations?.kind==="output"&&this._notebookEditor.findUnHighlightCurrent(this._currentMatchDecorations.index,this.ownerID),this._currentMatchCellDecorations=this._notebookEditor.deltaCellDecorations(this._currentMatchCellDecorations,[])}setAllFindMatchesDecorations(t){this._notebookEditor.changeModelDecorations(e=>{const o=s._FIND_MATCH_DECORATION,a=t.map(n=>{const r=new Array(n.contentMatches.length);for(let i=0;i<n.contentMatches.length;i++)r[i]={range:n.contentMatches[i].range,options:o};return{ownerId:n.cell.handle,decorations:r}});this._allMatchesDecorations=e.deltaDecorations(this._allMatchesDecorations,a)}),this._allMatchesCellDecorations=this._notebookEditor.deltaCellDecorations(this._allMatchesCellDecorations,t.map(e=>({ownerId:e.cell.handle,handle:e.cell.handle,options:{overviewRuler:{color:d,modelRanges:e.contentMatches.map(o=>o.range),includeOutput:e.webviewMatches.length>0,position:c.Center}}})))}stopWebviewFind(){this._notebookEditor.findStop(this.ownerID)}dispose(){this.clearDecorations(),super.dispose()}}export{m as FindMatchDecorationModel};
