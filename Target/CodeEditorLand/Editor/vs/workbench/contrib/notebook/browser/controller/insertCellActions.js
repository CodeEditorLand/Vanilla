import{Codicon as A}from"../../../../../base/common/codicons.js";import{KeyCode as T,KeyMod as E}from"../../../../../base/common/keyCodes.js";import{ILanguageService as w}from"../../../../../editor/common/languages/language.js";import{localize as o}from"../../../../../nls.js";import{MenuId as i,MenuRegistry as s,registerAction2 as a}from"../../../../../platform/actions/common/actions.js";import{ContextKeyExpr as t}from"../../../../../platform/contextkey/common/contextkey.js";import{InputFocusedContext as _}from"../../../../../platform/contextkey/common/contextkeys.js";import{KeybindingWeight as N}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{CellKind as C,NotebookSetting as O}from"../../common/notebookCommon.js";import{NOTEBOOK_CELL_LIST_FOCUSED as v,NOTEBOOK_EDITOR_EDITABLE as c}from"../../common/notebookContextKeys.js";import{insertCell as k}from"./cellOperations.js";import{CTX_NOTEBOOK_CHAT_OUTER_FOCUS_POSITION as D}from"./chat/notebookChatContext.js";import{NotebookAction as I}from"./coreActions.js";const S="notebook.cell.insertCodeCellAbove",m="notebook.cell.insertCodeCellBelow",B="notebook.cell.insertCodeCellAboveAndFocusContainer",x="notebook.cell.insertCodeCellBelowAndFocusContainer",f="notebook.cell.insertCodeCellAtTop",q="notebook.cell.insertMarkdownCellAbove",M="notebook.cell.insertMarkdownCellBelow",h="notebook.cell.insertMarkdownCellAtTop";function y(l,n,e,r,d){let b=null;n.ui&&n.notebookEditor.focus();const g=l.get(w);if(n.cell){const p=n.notebookEditor.getCellIndex(n.cell);b=k(g,n.notebookEditor,p,e,r,void 0,!0)}else{const p=n.notebookEditor.getFocus(),L=Math.max(p.end-1,0);b=k(g,n.notebookEditor,L,e,r,void 0,!0)}return b}class u extends I{constructor(e,r,d,b){super(e);this.kind=r;this.direction=d;this.focusEditor=b}async runWithContext(e,r){const d=await y(e,r,this.kind,this.direction,this.focusEditor);d&&await r.notebookEditor.focusNotebookCell(d,this.focusEditor?"editor":"container")}}a(class extends u{constructor(){super({id:S,title:o("notebookActions.insertCodeCellAbove","Insert Code Cell Above"),keybinding:{primary:E.CtrlCmd|E.Shift|T.Enter,when:t.and(v,_.toNegated()),weight:N.WorkbenchContrib},menu:{id:i.NotebookCellInsert,order:0}},C.Code,"above",!0)}}),a(class extends u{constructor(){super({id:B,title:o("notebookActions.insertCodeCellAboveAndFocusContainer","Insert Code Cell Above and Focus Container")},C.Code,"above",!1)}}),a(class extends u{constructor(){super({id:m,title:o("notebookActions.insertCodeCellBelow","Insert Code Cell Below"),keybinding:{primary:E.CtrlCmd|T.Enter,when:t.and(v,_.toNegated(),D.isEqualTo("")),weight:N.WorkbenchContrib},menu:{id:i.NotebookCellInsert,order:1}},C.Code,"below",!0)}}),a(class extends u{constructor(){super({id:x,title:o("notebookActions.insertCodeCellBelowAndFocusContainer","Insert Code Cell Below and Focus Container")},C.Code,"below",!1)}}),a(class extends u{constructor(){super({id:q,title:o("notebookActions.insertMarkdownCellAbove","Insert Markdown Cell Above"),menu:{id:i.NotebookCellInsert,order:2}},C.Markup,"above",!0)}}),a(class extends u{constructor(){super({id:M,title:o("notebookActions.insertMarkdownCellBelow","Insert Markdown Cell Below"),menu:{id:i.NotebookCellInsert,order:3}},C.Markup,"below",!0)}}),a(class extends I{constructor(){super({id:f,title:o("notebookActions.insertCodeCellAtTop","Add Code Cell At Top"),f1:!1})}async run(n,e){e=e??this.getEditorContextFromArgsOrActive(n),e&&this.runWithContext(n,e)}async runWithContext(n,e){const r=n.get(w),d=k(r,e.notebookEditor,0,C.Code,"above",void 0,!0);d&&await e.notebookEditor.focusNotebookCell(d,"editor")}}),a(class extends I{constructor(){super({id:h,title:o("notebookActions.insertMarkdownCellAtTop","Add Markdown Cell At Top"),f1:!1})}async run(n,e){e=e??this.getEditorContextFromArgsOrActive(n),e&&this.runWithContext(n,e)}async runWithContext(n,e){const r=n.get(w),d=k(r,e.notebookEditor,0,C.Markup,"above",void 0,!0);d&&await e.notebookEditor.focusNotebookCell(d,"editor")}}),s.appendMenuItem(i.NotebookCellBetween,{command:{id:m,title:"$(add) "+o("notebookActions.menu.insertCode","Code"),tooltip:o("notebookActions.menu.insertCode.tooltip","Add Code Cell")},order:0,group:"inline",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.experimental.insertToolbarAlignment","left"))}),s.appendMenuItem(i.NotebookCellBetween,{command:{id:m,title:o("notebookActions.menu.insertCode.minimalToolbar","Add Code"),icon:A.add,tooltip:o("notebookActions.menu.insertCode.tooltip","Add Code Cell")},order:0,group:"inline",when:t.and(c.isEqualTo(!0),t.equals("config.notebook.experimental.insertToolbarAlignment","left"))}),s.appendMenuItem(i.NotebookToolbar,{command:{id:m,icon:A.add,title:o("notebookActions.menu.insertCode.ontoolbar","Code"),tooltip:o("notebookActions.menu.insertCode.tooltip","Add Code Cell")},order:-5,group:"navigation/add",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.insertToolbarLocation","betweenCells"),t.notEquals("config.notebook.insertToolbarLocation","hidden"))}),s.appendMenuItem(i.NotebookCellListTop,{command:{id:f,title:"$(add) "+o("notebookActions.menu.insertCode","Code"),tooltip:o("notebookActions.menu.insertCode.tooltip","Add Code Cell")},order:0,group:"inline",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.experimental.insertToolbarAlignment","left"))}),s.appendMenuItem(i.NotebookCellListTop,{command:{id:f,title:o("notebookActions.menu.insertCode.minimaltoolbar","Add Code"),icon:A.add,tooltip:o("notebookActions.menu.insertCode.tooltip","Add Code Cell")},order:0,group:"inline",when:t.and(c.isEqualTo(!0),t.equals("config.notebook.experimental.insertToolbarAlignment","left"))}),s.appendMenuItem(i.NotebookCellBetween,{command:{id:M,title:"$(add) "+o("notebookActions.menu.insertMarkdown","Markdown"),tooltip:o("notebookActions.menu.insertMarkdown.tooltip","Add Markdown Cell")},order:1,group:"inline",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.experimental.insertToolbarAlignment","left"))}),s.appendMenuItem(i.NotebookToolbar,{command:{id:M,icon:A.add,title:o("notebookActions.menu.insertMarkdown.ontoolbar","Markdown"),tooltip:o("notebookActions.menu.insertMarkdown.tooltip","Add Markdown Cell")},order:-5,group:"navigation/add",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.insertToolbarLocation","betweenCells"),t.notEquals("config.notebook.insertToolbarLocation","hidden"),t.notEquals(`config.${O.globalToolbarShowLabel}`,!1),t.notEquals(`config.${O.globalToolbarShowLabel}`,"never"))}),s.appendMenuItem(i.NotebookCellListTop,{command:{id:h,title:"$(add) "+o("notebookActions.menu.insertMarkdown","Markdown"),tooltip:o("notebookActions.menu.insertMarkdown.tooltip","Add Markdown Cell")},order:1,group:"inline",when:t.and(c.isEqualTo(!0),t.notEquals("config.notebook.experimental.insertToolbarAlignment","left"))});export{u as InsertCellCommand,y as insertNewCell};
