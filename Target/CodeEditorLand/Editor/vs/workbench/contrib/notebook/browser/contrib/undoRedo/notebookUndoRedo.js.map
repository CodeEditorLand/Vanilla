{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/contrib/undoRedo/notebookUndoRedo.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from \"../../../../../../base/common/lifecycle.js\";\nimport {\n\tRedoCommand,\n\tUndoCommand,\n} from \"../../../../../../editor/browser/editorExtensions.js\";\nimport {\n\tWorkbenchPhase,\n\tregisterWorkbenchContribution2,\n} from \"../../../../../common/contributions.js\";\nimport { IEditorService } from \"../../../../../services/editor/common/editorService.js\";\nimport { CellKind } from \"../../../common/notebookCommon.js\";\nimport {\n\tCellEditState,\n\tgetNotebookEditorFromEditorPane,\n} from \"../../notebookBrowser.js\";\nimport type { NotebookViewModel } from \"../../viewModel/notebookViewModelImpl.js\";\n\nclass NotebookUndoRedoContribution extends Disposable {\n\tstatic readonly ID = \"workbench.contrib.notebookUndoRedo\";\n\n\tconstructor(\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t) {\n\t\tsuper();\n\n\t\tconst PRIORITY = 105;\n\t\tthis._register(\n\t\t\tUndoCommand.addImplementation(\n\t\t\t\tPRIORITY,\n\t\t\t\t\"notebook-undo-redo\",\n\t\t\t\t() => {\n\t\t\t\t\tconst editor = getNotebookEditorFromEditorPane(\n\t\t\t\t\t\tthis._editorService.activeEditorPane,\n\t\t\t\t\t);\n\t\t\t\t\tconst viewModel = editor?.getViewModel() as\n\t\t\t\t\t\t| NotebookViewModel\n\t\t\t\t\t\t| undefined;\n\t\t\t\t\tif (editor && editor.hasModel() && viewModel) {\n\t\t\t\t\t\treturn viewModel.undo().then((cellResources) => {\n\t\t\t\t\t\t\tif (cellResources?.length) {\n\t\t\t\t\t\t\t\tfor (let i = 0; i < editor.getLength(); i++) {\n\t\t\t\t\t\t\t\t\tconst cell = editor.cellAt(i);\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tcell.cellKind === CellKind.Markup &&\n\t\t\t\t\t\t\t\t\t\tcellResources.find(\n\t\t\t\t\t\t\t\t\t\t\t(resource) =>\n\t\t\t\t\t\t\t\t\t\t\t\tresource.fragment ===\n\t\t\t\t\t\t\t\t\t\t\t\tcell.model.uri.fragment,\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tcell.updateEditState(\n\t\t\t\t\t\t\t\t\t\t\tCellEditState.Editing,\n\t\t\t\t\t\t\t\t\t\t\t\"undo\",\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\teditor?.setOptions({\n\t\t\t\t\t\t\t\t\tcellOptions: { resource: cellResources[0] },\n\t\t\t\t\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tRedoCommand.addImplementation(\n\t\t\t\tPRIORITY,\n\t\t\t\t\"notebook-undo-redo\",\n\t\t\t\t() => {\n\t\t\t\t\tconst editor = getNotebookEditorFromEditorPane(\n\t\t\t\t\t\tthis._editorService.activeEditorPane,\n\t\t\t\t\t);\n\t\t\t\t\tconst viewModel = editor?.getViewModel() as\n\t\t\t\t\t\t| NotebookViewModel\n\t\t\t\t\t\t| undefined;\n\n\t\t\t\t\tif (editor && editor.hasModel() && viewModel) {\n\t\t\t\t\t\treturn viewModel.redo().then((cellResources) => {\n\t\t\t\t\t\t\tif (cellResources?.length) {\n\t\t\t\t\t\t\t\tfor (let i = 0; i < editor.getLength(); i++) {\n\t\t\t\t\t\t\t\t\tconst cell = editor.cellAt(i);\n\t\t\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t\t\tcell.cellKind === CellKind.Markup &&\n\t\t\t\t\t\t\t\t\t\tcellResources.find(\n\t\t\t\t\t\t\t\t\t\t\t(resource) =>\n\t\t\t\t\t\t\t\t\t\t\t\tresource.fragment ===\n\t\t\t\t\t\t\t\t\t\t\t\tcell.model.uri.fragment,\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t\t\tcell.updateEditState(\n\t\t\t\t\t\t\t\t\t\t\tCellEditState.Editing,\n\t\t\t\t\t\t\t\t\t\t\t\"redo\",\n\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\teditor?.setOptions({\n\t\t\t\t\t\t\t\t\tcellOptions: { resource: cellResources[0] },\n\t\t\t\t\t\t\t\t\tpreserveFocus: true,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n}\n\nregisterWorkbenchContribution2(\n\tNotebookUndoRedoContribution.ID,\n\tNotebookUndoRedoContribution,\n\tWorkbenchPhase.BlockRestore,\n);\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,kBAAkB;AAC3B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,sBAAsB;AAC/B,SAAS,gBAAgB;AACzB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAGP,IAAM,+BAAN,cAA2C,WAAW;AAAA,EAGrD,YACkC,gBAChC;AACD,UAAM;AAF2B;AAIjC,UAAM,WAAW;AACjB,SAAK;AAAA,MACJ,YAAY;AAAA,QACX;AAAA,QACA;AAAA,QACA,MAAM;AACL,gBAAM,SAAS;AAAA,YACd,KAAK,eAAe;AAAA,UACrB;AACA,gBAAM,YAAY,QAAQ,aAAa;AAGvC,cAAI,UAAU,OAAO,SAAS,KAAK,WAAW;AAC7C,mBAAO,UAAU,KAAK,EAAE,KAAK,CAAC,kBAAkB;AAC/C,kBAAI,eAAe,QAAQ;AAC1B,yBAAS,IAAI,GAAG,IAAI,OAAO,UAAU,GAAG,KAAK;AAC5C,wBAAM,OAAO,OAAO,OAAO,CAAC;AAC5B,sBACC,KAAK,aAAa,SAAS,UAC3B,cAAc;AAAA,oBACb,CAAC,aACA,SAAS,aACT,KAAK,MAAM,IAAI;AAAA,kBACjB,GACC;AACD,yBAAK;AAAA,sBACJ,cAAc;AAAA,sBACd;AAAA,oBACD;AAAA,kBACD;AAAA,gBACD;AAEA,wBAAQ,WAAW;AAAA,kBAClB,aAAa,EAAE,UAAU,cAAc,CAAC,EAAE;AAAA,kBAC1C,eAAe;AAAA,gBAChB,CAAC;AAAA,cACF;AAAA,YACD,CAAC;AAAA,UACF;AAEA,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,YAAY;AAAA,QACX;AAAA,QACA;AAAA,QACA,MAAM;AACL,gBAAM,SAAS;AAAA,YACd,KAAK,eAAe;AAAA,UACrB;AACA,gBAAM,YAAY,QAAQ,aAAa;AAIvC,cAAI,UAAU,OAAO,SAAS,KAAK,WAAW;AAC7C,mBAAO,UAAU,KAAK,EAAE,KAAK,CAAC,kBAAkB;AAC/C,kBAAI,eAAe,QAAQ;AAC1B,yBAAS,IAAI,GAAG,IAAI,OAAO,UAAU,GAAG,KAAK;AAC5C,wBAAM,OAAO,OAAO,OAAO,CAAC;AAC5B,sBACC,KAAK,aAAa,SAAS,UAC3B,cAAc;AAAA,oBACb,CAAC,aACA,SAAS,aACT,KAAK,MAAM,IAAI;AAAA,kBACjB,GACC;AACD,yBAAK;AAAA,sBACJ,cAAc;AAAA,sBACd;AAAA,oBACD;AAAA,kBACD;AAAA,gBACD;AAEA,wBAAQ,WAAW;AAAA,kBAClB,aAAa,EAAE,UAAU,cAAc,CAAC,EAAE;AAAA,kBAC1C,eAAe;AAAA,gBAChB,CAAC;AAAA,cACF;AAAA,YACD,CAAC;AAAA,UACF;AAEA,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAvHD,OAsBsD;AAAA;AAAA;AAAA,EACrD,OAAgB,KAAK;AAiGtB;AAlGM,+BAAN;AAAA,EAIG;AAAA,GAJG;AAoGN;AAAA,EACC,6BAA6B;AAAA,EAC7B;AAAA,EACA,eAAe;AAChB;",
  "names": []
}
