{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/notebook/browser/view/cellParts/codeCell.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as DOM from \"../../../../../../base/browser/dom.js\";\nimport { raceCancellation } from \"../../../../../../base/common/async.js\";\nimport { CancellationTokenSource } from \"../../../../../../base/common/cancellation.js\";\nimport { Codicon } from \"../../../../../../base/common/codicons.js\";\nimport { Event } from \"../../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../../../../../../base/common/lifecycle.js\";\nimport { clamp } from \"../../../../../../base/common/numbers.js\";\nimport * as strings from \"../../../../../../base/common/strings.js\";\nimport { ThemeIcon } from \"../../../../../../base/common/themables.js\";\nimport { EditorOption } from \"../../../../../../editor/common/config/editorOptions.js\";\nimport type { IDimension } from \"../../../../../../editor/common/core/dimension.js\";\nimport { ILanguageService } from \"../../../../../../editor/common/languages/language.js\";\nimport { tokenizeToStringSync } from \"../../../../../../editor/common/languages/textToHtmlTokenizer.js\";\nimport type {\n\tIReadonlyTextBuffer,\n\tITextModel,\n} from \"../../../../../../editor/common/model.js\";\nimport { CodeActionController } from \"../../../../../../editor/contrib/codeAction/browser/codeActionController.js\";\nimport { localize } from \"../../../../../../nls.js\";\nimport { IConfigurationService } from \"../../../../../../platform/configuration/common/configuration.js\";\nimport { IInstantiationService } from \"../../../../../../platform/instantiation/common/instantiation.js\";\nimport { IKeybindingService } from \"../../../../../../platform/keybinding/common/keybinding.js\";\nimport { IOpenerService } from \"../../../../../../platform/opener/common/opener.js\";\nimport { INotebookExecutionStateService } from \"../../../common/notebookExecutionStateService.js\";\nimport {\n\tCellFocusMode,\n\tEXPAND_CELL_INPUT_COMMAND_ID,\n\ttype IActiveNotebookEditorDelegate,\n} from \"../../notebookBrowser.js\";\nimport {\n\ttype CodeCellViewModel,\n\toutputDisplayLimit,\n} from \"../../viewModel/codeCellViewModel.js\";\nimport type { CellPartsCollection } from \"../cellPart.js\";\nimport type { NotebookCellEditorPool } from \"../notebookCellEditorPool.js\";\nimport type { CodeCellRenderTemplate } from \"../notebookRenderingCommon.js\";\nimport { CellEditorOptions } from \"./cellEditorOptions.js\";\nimport { CellOutputContainer } from \"./cellOutput.js\";\nimport { CollapsedCodeCellExecutionIcon } from \"./codeCellExecutionIcon.js\";\n\nexport class CodeCell extends Disposable {\n\tprivate _outputContainerRenderer: CellOutputContainer;\n\tprivate _inputCollapseElement: HTMLElement | undefined;\n\n\tprivate _renderedInputCollapseState: boolean | undefined;\n\tprivate _renderedOutputCollapseState: boolean | undefined;\n\tprivate _isDisposed = false;\n\tprivate readonly cellParts: CellPartsCollection;\n\n\tprivate _collapsedExecutionIcon: CollapsedCodeCellExecutionIcon;\n\tprivate _cellEditorOptions: CellEditorOptions;\n\n\tconstructor(\n\t\tprivate readonly notebookEditor: IActiveNotebookEditorDelegate,\n\t\tprivate readonly viewCell: CodeCellViewModel,\n\t\tprivate readonly templateData: CodeCellRenderTemplate,\n\t\tprivate readonly editorPool: NotebookCellEditorPool,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IKeybindingService private readonly keybindingService: IKeybindingService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IConfigurationService private configurationService: IConfigurationService,\n\t\t@INotebookExecutionStateService notebookExecutionStateService: INotebookExecutionStateService,\n\t) {\n\t\tsuper();\n\n\t\tthis._cellEditorOptions = this._register(new CellEditorOptions(this.notebookEditor.getBaseCellEditorOptions(viewCell.language), this.notebookEditor.notebookOptions, this.configurationService));\n\t\tthis._outputContainerRenderer = this.instantiationService.createInstance(CellOutputContainer, notebookEditor, viewCell, templateData, { limit: outputDisplayLimit });\n\t\tthis.cellParts = this._register(templateData.cellParts.concatContentPart([this._cellEditorOptions, this._outputContainerRenderer], DOM.getWindow(notebookEditor.getDomNode())));\n\n\t\t// this.viewCell.layoutInfo.editorHeight or estimation when this.viewCell.layoutInfo.editorHeight === 0\n\t\tconst editorHeight = this.calculateInitEditorHeight();\n\t\tthis.initializeEditor(editorHeight);\n\t\tthis._renderedInputCollapseState = false; // editor is always expanded initially\n\n\t\tthis.registerNotebookEditorListeners();\n\t\tthis.registerViewCellLayoutChange();\n\t\tthis.registerCellEditorEventListeners();\n\t\tthis.registerDecorations();\n\t\tthis.registerMouseListener();\n\n\t\tthis._register(Event.any(this.viewCell.onDidStartExecution, this.viewCell.onDidStopExecution)((e) => {\n\t\t\tthis.cellParts.updateForExecutionState(this.viewCell, e);\n\t\t}));\n\n\t\tthis._register(this.viewCell.onDidChangeState(e => {\n\t\t\tthis.cellParts.updateState(this.viewCell, e);\n\n\t\t\tif (e.outputIsHoveredChanged) {\n\t\t\t\tthis.updateForOutputHover();\n\t\t\t}\n\n\t\t\tif (e.outputIsFocusedChanged) {\n\t\t\t\tthis.updateForOutputFocus();\n\t\t\t}\n\n\t\t\tif (e.metadataChanged || e.internalMetadataChanged) {\n\t\t\t\tthis.updateEditorOptions();\n\t\t\t}\n\n\t\t\tif (e.inputCollapsedChanged || e.outputCollapsedChanged) {\n\t\t\t\tthis.viewCell.pauseLayout();\n\t\t\t\tconst updated = this.updateForCollapseState();\n\t\t\t\tthis.viewCell.resumeLayout();\n\t\t\t\tif (updated) {\n\t\t\t\t\tthis.relayoutCell();\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (e.focusModeChanged) {\n\t\t\t\tthis.updateEditorForFocusModeChange(true);\n\t\t\t}\n\t\t}));\n\n\t\tthis.cellParts.scheduleRenderCell(this.viewCell);\n\n\t\tthis._register(toDisposable(() => {\n\t\t\tthis.cellParts.unrenderCell(this.viewCell);\n\t\t}));\n\n\t\tthis.updateEditorOptions();\n\t\tthis.updateEditorForFocusModeChange(false);\n\t\tthis.updateForOutputHover();\n\t\tthis.updateForOutputFocus();\n\n\t\t// Render Outputs\n\t\tthis.viewCell.editorHeight = editorHeight;\n\t\tthis._outputContainerRenderer.render();\n\t\tthis._renderedOutputCollapseState = false; // the output is always rendered initially\n\t\t// Need to do this after the intial renderOutput\n\t\tthis.initialViewUpdateExpanded();\n\n\t\tthis._register(this.viewCell.onLayoutInfoRead(() => {\n\t\t\tthis.cellParts.prepareLayout();\n\t\t}));\n\n\t\tconst executionItemElement = DOM.append(this.templateData.cellInputCollapsedContainer, DOM.$('.collapsed-execution-icon'));\n\t\tthis._register(toDisposable(() => {\n\t\t\texecutionItemElement.remove();\n\t\t}));\n\t\tthis._collapsedExecutionIcon = this._register(this.instantiationService.createInstance(CollapsedCodeCellExecutionIcon, this.notebookEditor, this.viewCell, executionItemElement));\n\t\tthis.updateForCollapseState();\n\n\t\tthis._register(Event.runAndSubscribe(viewCell.onDidChangeOutputs, this.updateForOutputs.bind(this)));\n\t\tthis._register(Event.runAndSubscribe(viewCell.onDidChangeLayout, this.updateForLayout.bind(this)));\n\n\t\tthis._cellEditorOptions.setLineNumbers(this.viewCell.lineNumbers);\n\t\ttemplateData.editor.updateOptions(this._cellEditorOptions.getUpdatedValue(this.viewCell.internalMetadata, this.viewCell.uri));\n\t}\n\n\tprivate updateCodeCellOptions(templateData: CodeCellRenderTemplate) {\n\t\ttemplateData.editor.updateOptions(\n\t\t\tthis._cellEditorOptions.getUpdatedValue(\n\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\tthis.viewCell.uri,\n\t\t\t),\n\t\t);\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._register({\n\t\t\tdispose() {\n\t\t\t\tcts.dispose(true);\n\t\t\t},\n\t\t});\n\t\traceCancellation(this.viewCell.resolveTextModel(), cts.token).then(\n\t\t\t(model) => {\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (model) {\n\t\t\t\t\tmodel.updateOptions({\n\t\t\t\t\t\tindentSize: this._cellEditorOptions.indentSize,\n\t\t\t\t\t\ttabSize: this._cellEditorOptions.tabSize,\n\t\t\t\t\t\tinsertSpaces: this._cellEditorOptions.insertSpaces,\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate _pendingLayout: IDisposable | undefined;\n\n\tprivate updateForLayout(): void {\n\t\tthis._pendingLayout?.dispose();\n\t\tthis._pendingLayout = DOM.modify(\n\t\t\tDOM.getWindow(this.notebookEditor.getDomNode()),\n\t\t\t() => {\n\t\t\t\tthis.cellParts.updateInternalLayoutNow(this.viewCell);\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate updateForOutputHover() {\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"cell-output-hover\",\n\t\t\tthis.viewCell.outputIsHovered,\n\t\t);\n\t}\n\n\tprivate updateForOutputFocus() {\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"cell-output-focus\",\n\t\t\tthis.viewCell.outputIsFocused,\n\t\t);\n\t}\n\n\tprivate calculateInitEditorHeight() {\n\t\tconst lineNum = this.viewCell.lineCount;\n\t\tconst lineHeight = this.viewCell.layoutInfo.fontInfo?.lineHeight || 17;\n\t\tconst editorPadding =\n\t\t\tthis.notebookEditor.notebookOptions.computeEditorPadding(\n\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\tthis.viewCell.uri,\n\t\t\t);\n\t\tconst editorHeight =\n\t\t\tthis.viewCell.layoutInfo.editorHeight === 0\n\t\t\t\t? lineNum * lineHeight +\n\t\t\t\t\teditorPadding.top +\n\t\t\t\t\teditorPadding.bottom\n\t\t\t\t: this.viewCell.layoutInfo.editorHeight;\n\t\treturn editorHeight;\n\t}\n\n\tprivate initializeEditor(initEditorHeight: number) {\n\t\tconst width = this.viewCell.layoutInfo.editorWidth;\n\t\tthis.layoutEditor({\n\t\t\twidth: width,\n\t\t\theight: initEditorHeight,\n\t\t});\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tthis._register({\n\t\t\tdispose() {\n\t\t\t\tcts.dispose(true);\n\t\t\t},\n\t\t});\n\t\traceCancellation(this.viewCell.resolveTextModel(), cts.token).then(\n\t\t\t(model) => {\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tif (model && this.templateData.editor) {\n\t\t\t\t\tthis._reigsterModelListeners(model);\n\n\t\t\t\t\t// set model can trigger view update, which can lead to dispose of this cell\n\t\t\t\t\tthis.templateData.editor.setModel(model);\n\n\t\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tmodel.updateOptions({\n\t\t\t\t\t\tindentSize: this._cellEditorOptions.indentSize,\n\t\t\t\t\t\ttabSize: this._cellEditorOptions.tabSize,\n\t\t\t\t\t\tinsertSpaces: this._cellEditorOptions.insertSpaces,\n\t\t\t\t\t});\n\t\t\t\t\tthis.viewCell.attachTextEditor(\n\t\t\t\t\t\tthis.templateData.editor,\n\t\t\t\t\t\tthis.viewCell.layoutInfo\n\t\t\t\t\t\t\t.estimatedHasHorizontalScrolling,\n\t\t\t\t\t);\n\t\t\t\t\tconst focusEditorIfNeeded = () => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tthis.notebookEditor.getActiveCell() ===\n\t\t\t\t\t\t\t\tthis.viewCell &&\n\t\t\t\t\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor &&\n\t\t\t\t\t\t\t(this.notebookEditor.hasEditorFocus() ||\n\t\t\t\t\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument\n\t\t\t\t\t\t\t\t\t.activeElement ===\n\t\t\t\t\t\t\t\t\tthis.notebookEditor.getDomNode()\n\t\t\t\t\t\t\t\t\t\t.ownerDocument.body)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Don't steal focus from other workbench parts, but if body has focus, we can take it\n\t\t\t\t\t\t\tthis.templateData.editor?.focus();\n\t\t\t\t\t\t}\n\t\t\t\t\t};\n\t\t\t\t\tfocusEditorIfNeeded();\n\n\t\t\t\t\tconst realContentHeight =\n\t\t\t\t\t\tthis.templateData.editor?.getContentHeight();\n\t\t\t\t\tif (\n\t\t\t\t\t\trealContentHeight !== undefined &&\n\t\t\t\t\t\trealContentHeight !== initEditorHeight\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.onCellEditorHeightChange(realContentHeight);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tfocusEditorIfNeeded();\n\t\t\t\t}\n\n\t\t\t\tthis._register(\n\t\t\t\t\tthis._cellEditorOptions.onDidChange(() =>\n\t\t\t\t\t\tthis.updateCodeCellOptions(this.templateData),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate updateForOutputs(): void {\n\t\tDOM.setVisibility(\n\t\t\tthis.viewCell.outputsViewModels.length > 0,\n\t\t\tthis.templateData.focusSinkElement,\n\t\t);\n\t}\n\n\tprivate updateEditorOptions() {\n\t\tconst editor = this.templateData.editor;\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst isReadonly = this.notebookEditor.isReadOnly;\n\t\tconst padding =\n\t\t\tthis.notebookEditor.notebookOptions.computeEditorPadding(\n\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\tthis.viewCell.uri,\n\t\t\t);\n\t\tconst options = editor.getOptions();\n\t\tif (\n\t\t\toptions.get(EditorOption.readOnly) !== isReadonly ||\n\t\t\toptions.get(EditorOption.padding) !== padding\n\t\t) {\n\t\t\teditor.updateOptions({\n\t\t\t\treadOnly: this.notebookEditor.isReadOnly,\n\t\t\t\tpadding:\n\t\t\t\t\tthis.notebookEditor.notebookOptions.computeEditorPadding(\n\t\t\t\t\t\tthis.viewCell.internalMetadata,\n\t\t\t\t\t\tthis.viewCell.uri,\n\t\t\t\t\t),\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate registerNotebookEditorListeners() {\n\t\tthis._register(\n\t\t\tthis.notebookEditor.onDidScroll(() => {\n\t\t\t\tthis.adjustEditorPosition();\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.notebookEditor.onDidChangeLayout(() => {\n\t\t\t\tthis.adjustEditorPosition();\n\t\t\t\tthis.onCellWidthChange();\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate adjustEditorPosition() {\n\t\tconst extraOffset =\n\t\t\t-6 /** distance to the top of the cell editor, which is 6px under the focus indicator */ -\n\t\t\t1 /** border */;\n\t\tconst min = 0;\n\n\t\tconst scrollTop = this.notebookEditor.scrollTop;\n\t\tconst elementTop = this.notebookEditor.getAbsoluteTopOfElement(\n\t\t\tthis.viewCell,\n\t\t);\n\t\tconst diff = scrollTop - elementTop + extraOffset;\n\n\t\tconst notebookEditorLayout = this.notebookEditor.getLayoutInfo();\n\n\t\t// we should stop adjusting the top when users are viewing the bottom of the cell editor\n\t\tconst editorMaxHeight =\n\t\t\tnotebookEditorLayout.height -\n\t\t\tnotebookEditorLayout.stickyHeight -\n\t\t\t26 /** notebook toolbar */;\n\n\t\tconst maxTop =\n\t\t\tthis.viewCell.layoutInfo.editorHeight -\n\t\t\t// + this.viewCell.layoutInfo.statusBarHeight\n\t\t\teditorMaxHeight;\n\t\tconst top = maxTop > 20 ? clamp(min, diff, maxTop) : min;\n\t\tthis.templateData.editorPart.style.top = `${top}px`;\n\t\t// scroll the editor with top\n\t\tthis.templateData.editor?.setScrollTop(top);\n\t}\n\n\tprivate registerViewCellLayoutChange() {\n\t\tthis._register(\n\t\t\tthis.viewCell.onDidChangeLayout((e) => {\n\t\t\t\tif (e.outerWidth !== undefined) {\n\t\t\t\t\tconst layoutInfo = this.templateData.editor.getLayoutInfo();\n\t\t\t\t\tif (\n\t\t\t\t\t\tlayoutInfo.width !==\n\t\t\t\t\t\tthis.viewCell.layoutInfo.editorWidth\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.onCellWidthChange();\n\t\t\t\t\t\tthis.adjustEditorPosition();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate registerCellEditorEventListeners() {\n\t\tthis._register(\n\t\t\tthis.templateData.editor.onDidContentSizeChange((e) => {\n\t\t\t\tif (e.contentHeightChanged) {\n\t\t\t\t\tif (\n\t\t\t\t\t\tthis.viewCell.layoutInfo.editorHeight !==\n\t\t\t\t\t\te.contentHeight\n\t\t\t\t\t) {\n\t\t\t\t\t\tthis.onCellEditorHeightChange(e.contentHeight);\n\t\t\t\t\t\tthis.adjustEditorPosition();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.templateData.editor.onDidChangeCursorSelection((e) => {\n\t\t\t\tif (e.source === \"restoreState\" || e.oldModelVersionId === 0) {\n\t\t\t\t\t// do not reveal the cell into view if this selection change was caused by restoring editors...\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst selections = this.templateData.editor.getSelections();\n\n\t\t\t\tif (selections?.length) {\n\t\t\t\t\tconst contentHeight =\n\t\t\t\t\t\tthis.templateData.editor.getContentHeight();\n\t\t\t\t\tconst layoutContentHeight =\n\t\t\t\t\t\tthis.viewCell.layoutInfo.editorHeight;\n\n\t\t\t\t\tif (contentHeight !== layoutContentHeight) {\n\t\t\t\t\t\tthis.onCellEditorHeightChange(contentHeight);\n\n\t\t\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tconst lastSelection = selections[selections.length - 1];\n\t\t\t\t\tthis.notebookEditor.revealRangeInViewAsync(\n\t\t\t\t\t\tthis.viewCell,\n\t\t\t\t\t\tlastSelection,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.templateData.editor.onDidBlurEditorWidget(() => {\n\t\t\t\tCodeActionController.get(\n\t\t\t\t\tthis.templateData.editor,\n\t\t\t\t)?.hideCodeActions();\n\t\t\t\tCodeActionController.get(\n\t\t\t\t\tthis.templateData.editor,\n\t\t\t\t)?.hideLightBulbWidget();\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate _reigsterModelListeners(model: ITextModel) {\n\t\tthis._register(\n\t\t\tmodel.onDidChangeTokens(() => {\n\t\t\t\tif (\n\t\t\t\t\tthis.viewCell.isInputCollapsed &&\n\t\t\t\t\tthis._inputCollapseElement\n\t\t\t\t) {\n\t\t\t\t\t// flush the collapsed input with the latest tokens\n\t\t\t\t\tconst content = this._getRichTextFromLineTokens(model);\n\t\t\t\t\tDOM.safeInnerHtml(this._inputCollapseElement, content);\n\t\t\t\t\tthis._attachInputExpandButton(this._inputCollapseElement);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate registerDecorations() {\n\t\t// Apply decorations\n\t\tthis._register(\n\t\t\tthis.viewCell.onCellDecorationsChanged((e) => {\n\t\t\t\te.added.forEach((options) => {\n\t\t\t\t\tif (options.className) {\n\t\t\t\t\t\tthis.templateData.rootContainer.classList.add(\n\t\t\t\t\t\t\toptions.className,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (options.outputClassName) {\n\t\t\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t\t\t[options.outputClassName],\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\t\te.removed.forEach((options) => {\n\t\t\t\t\tif (options.className) {\n\t\t\t\t\t\tthis.templateData.rootContainer.classList.remove(\n\t\t\t\t\t\t\toptions.className,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (options.outputClassName) {\n\t\t\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t\t\t[],\n\t\t\t\t\t\t\t[options.outputClassName],\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}),\n\t\t);\n\n\t\tthis.viewCell.getCellDecorations().forEach((options) => {\n\t\t\tif (options.className) {\n\t\t\t\tthis.templateData.rootContainer.classList.add(\n\t\t\t\t\toptions.className,\n\t\t\t\t);\n\t\t\t}\n\n\t\t\tif (options.outputClassName) {\n\t\t\t\tthis.notebookEditor.deltaCellContainerClassNames(\n\t\t\t\t\tthis.viewCell.id,\n\t\t\t\t\t[options.outputClassName],\n\t\t\t\t\t[],\n\t\t\t\t);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registerMouseListener() {\n\t\tthis._register(\n\t\t\tthis.templateData.editor.onMouseDown((e) => {\n\t\t\t\t// prevent default on right mouse click, otherwise it will trigger unexpected focus changes\n\t\t\t\t// the catch is, it means we don't allow customization of right button mouse down handlers other than the built in ones.\n\t\t\t\tif (e.event.rightButton) {\n\t\t\t\t\te.event.preventDefault();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate shouldPreserveEditor() {\n\t\t// The DOM focus needs to be adjusted:\n\t\t// when a cell editor should be focused\n\t\t// the document active element is inside the notebook editor or the document body (cell editor being disposed previously)\n\t\treturn (\n\t\t\tthis.notebookEditor.getActiveCell() === this.viewCell &&\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor &&\n\t\t\t(this.notebookEditor.hasEditorFocus() ||\n\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.activeElement ===\n\t\t\t\t\tthis.notebookEditor.getDomNode().ownerDocument.body)\n\t\t);\n\t}\n\n\tprivate updateEditorForFocusModeChange(sync: boolean) {\n\t\tif (this.shouldPreserveEditor()) {\n\t\t\tif (sync) {\n\t\t\t\tthis.templateData.editor?.focus();\n\t\t\t} else {\n\t\t\t\tthis._register(\n\t\t\t\t\tDOM.runAtThisOrScheduleAtNextAnimationFrame(\n\t\t\t\t\t\tDOM.getWindow(this.templateData.container),\n\t\t\t\t\t\t() => {\n\t\t\t\t\t\t\tthis.templateData.editor?.focus();\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"cell-editor-focus\",\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Editor,\n\t\t);\n\t\tthis.templateData.container.classList.toggle(\n\t\t\t\"cell-output-focus\",\n\t\t\tthis.viewCell.focusMode === CellFocusMode.Output,\n\t\t);\n\t}\n\tprivate updateForCollapseState(): boolean {\n\t\tif (\n\t\t\tthis.viewCell.isOutputCollapsed ===\n\t\t\t\tthis._renderedOutputCollapseState &&\n\t\t\tthis.viewCell.isInputCollapsed === this._renderedInputCollapseState\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.viewCell.layoutChange({ editorHeight: true });\n\n\t\tif (this.viewCell.isInputCollapsed) {\n\t\t\tthis._collapseInput();\n\t\t} else {\n\t\t\tthis._showInput();\n\t\t}\n\n\t\tif (this.viewCell.isOutputCollapsed) {\n\t\t\tthis._collapseOutput();\n\t\t} else {\n\t\t\tthis._showOutput(false);\n\t\t}\n\n\t\tthis.relayoutCell();\n\n\t\tthis._renderedOutputCollapseState = this.viewCell.isOutputCollapsed;\n\t\tthis._renderedInputCollapseState = this.viewCell.isInputCollapsed;\n\n\t\treturn true;\n\t}\n\n\tprivate _collapseInput() {\n\t\t// hide the editor and execution label, keep the run button\n\t\tDOM.hide(this.templateData.editorPart);\n\t\tthis.templateData.container.classList.toggle(\"input-collapsed\", true);\n\n\t\t// remove input preview\n\t\tthis._removeInputCollapsePreview();\n\n\t\tthis._collapsedExecutionIcon.setVisibility(true);\n\n\t\t// update preview\n\t\tconst richEditorText = this.templateData.editor.hasModel()\n\t\t\t? this._getRichTextFromLineTokens(\n\t\t\t\t\tthis.templateData.editor.getModel(),\n\t\t\t\t)\n\t\t\t: this._getRichText(\n\t\t\t\t\tthis.viewCell.textBuffer,\n\t\t\t\t\tthis.viewCell.language,\n\t\t\t\t);\n\t\tconst element = DOM.$(\"div.cell-collapse-preview\");\n\t\tDOM.safeInnerHtml(element, richEditorText);\n\t\tthis._inputCollapseElement = element;\n\t\tthis.templateData.cellInputCollapsedContainer.appendChild(element);\n\t\tthis._attachInputExpandButton(element);\n\n\t\tDOM.show(this.templateData.cellInputCollapsedContainer);\n\t}\n\n\tprivate _attachInputExpandButton(element: HTMLElement) {\n\t\tconst expandIcon = DOM.$(\"span.expandInputIcon\");\n\t\tconst keybinding = this.keybindingService.lookupKeybinding(\n\t\t\tEXPAND_CELL_INPUT_COMMAND_ID,\n\t\t);\n\t\tif (keybinding) {\n\t\t\telement.title = localize(\n\t\t\t\t\"cellExpandInputButtonLabelWithDoubleClick\",\n\t\t\t\t\"Double-click to expand cell input ({0})\",\n\t\t\t\tkeybinding.getLabel(),\n\t\t\t);\n\t\t\texpandIcon.title = localize(\n\t\t\t\t\"cellExpandInputButtonLabel\",\n\t\t\t\t\"Expand Cell Input ({0})\",\n\t\t\t\tkeybinding.getLabel(),\n\t\t\t);\n\t\t}\n\n\t\texpandIcon.classList.add(...ThemeIcon.asClassNameArray(Codicon.more));\n\t\telement.appendChild(expandIcon);\n\t}\n\n\tprivate _showInput() {\n\t\tthis._collapsedExecutionIcon.setVisibility(false);\n\t\tDOM.show(this.templateData.editorPart);\n\t\tDOM.hide(this.templateData.cellInputCollapsedContainer);\n\t}\n\n\tprivate _getRichText(buffer: IReadonlyTextBuffer, language: string) {\n\t\treturn tokenizeToStringSync(\n\t\t\tthis.languageService,\n\t\t\tbuffer.getLineContent(1),\n\t\t\tlanguage,\n\t\t);\n\t}\n\n\tprivate _getRichTextFromLineTokens(model: ITextModel) {\n\t\tlet result = `<div class=\"monaco-tokenized-source\">`;\n\n\t\tconst firstLineTokens = model.tokenization.getLineTokens(1);\n\t\tconst viewLineTokens = firstLineTokens.inflate();\n\t\tconst line = model.getLineContent(1);\n\t\tlet startOffset = 0;\n\t\tfor (let j = 0, lenJ = viewLineTokens.getCount(); j < lenJ; j++) {\n\t\t\tconst type = viewLineTokens.getClassName(j);\n\t\t\tconst endIndex = viewLineTokens.getEndOffset(j);\n\t\t\tresult += `<span class=\"${type}\">${strings.escape(line.substring(startOffset, endIndex))}</span>`;\n\t\t\tstartOffset = endIndex;\n\t\t}\n\n\t\tresult += `</div>`;\n\t\treturn result;\n\t}\n\n\tprivate _removeInputCollapsePreview() {\n\t\tconst children = this.templateData.cellInputCollapsedContainer.children;\n\t\tconst elements = [];\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tif (children[i].classList.contains(\"cell-collapse-preview\")) {\n\t\t\t\telements.push(children[i]);\n\t\t\t}\n\t\t}\n\n\t\telements.forEach((element) => {\n\t\t\telement.remove();\n\t\t});\n\t}\n\n\tprivate _updateOutputInnerContainer(hide: boolean) {\n\t\tconst children = this.templateData.outputContainer.domNode.children;\n\t\tfor (let i = 0; i < children.length; i++) {\n\t\t\tif (children[i].classList.contains(\"output-inner-container\")) {\n\t\t\t\tDOM.setVisibility(!hide, children[i] as HTMLElement);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _collapseOutput() {\n\t\tthis.templateData.container.classList.toggle(\"output-collapsed\", true);\n\t\tDOM.show(this.templateData.cellOutputCollapsedContainer);\n\t\tthis._updateOutputInnerContainer(true);\n\t\tthis._outputContainerRenderer.viewUpdateHideOuputs();\n\t}\n\n\tprivate _showOutput(initRendering: boolean) {\n\t\tthis.templateData.container.classList.toggle(\"output-collapsed\", false);\n\t\tDOM.hide(this.templateData.cellOutputCollapsedContainer);\n\t\tthis._updateOutputInnerContainer(false);\n\t\tthis._outputContainerRenderer.viewUpdateShowOutputs(initRendering);\n\t}\n\n\tprivate initialViewUpdateExpanded(): void {\n\t\tthis.templateData.container.classList.toggle(\"input-collapsed\", false);\n\t\tDOM.show(this.templateData.editorPart);\n\t\tDOM.hide(this.templateData.cellInputCollapsedContainer);\n\t\tthis.templateData.container.classList.toggle(\"output-collapsed\", false);\n\t\tthis._showOutput(true);\n\t}\n\n\tprivate layoutEditor(dimension: IDimension): void {\n\t\tconst editorLayout = this.notebookEditor.getLayoutInfo();\n\t\tconst maxHeight = Math.min(\n\t\t\teditorLayout.height -\n\t\t\t\teditorLayout.stickyHeight -\n\t\t\t\t26 /** notebook toolbar */,\n\t\t\tdimension.height,\n\t\t);\n\t\tthis.templateData.editor?.layout(\n\t\t\t{\n\t\t\t\twidth: dimension.width,\n\t\t\t\theight: maxHeight,\n\t\t\t},\n\t\t\ttrue,\n\t\t);\n\t}\n\n\tprivate onCellWidthChange(): void {\n\t\tif (!this.templateData.editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst realContentHeight = this.templateData.editor.getContentHeight();\n\t\tthis.viewCell.editorHeight = realContentHeight;\n\t\tthis.relayoutCell();\n\t\tthis.layoutEditor({\n\t\t\twidth: this.viewCell.layoutInfo.editorWidth,\n\t\t\theight: realContentHeight,\n\t\t});\n\t}\n\n\tprivate onCellEditorHeightChange(newHeight: number): void {\n\t\tconst viewLayout = this.templateData.editor.getLayoutInfo();\n\t\tthis.viewCell.editorHeight = newHeight;\n\t\tthis.relayoutCell();\n\t\tthis.layoutEditor({\n\t\t\twidth: viewLayout.width,\n\t\t\theight: newHeight,\n\t\t});\n\t}\n\n\trelayoutCell() {\n\t\tthis.notebookEditor.layoutNotebookCell(\n\t\t\tthis.viewCell,\n\t\t\tthis.viewCell.layoutInfo.totalHeight,\n\t\t);\n\t}\n\n\toverride dispose() {\n\t\tthis._isDisposed = true;\n\n\t\t// move focus back to the cell list otherwise the focus goes to body\n\t\tif (this.shouldPreserveEditor()) {\n\t\t\t// now the focus is on the monaco editor for the cell but detached from the rows.\n\t\t\tthis.editorPool.preserveFocusedEditor(this.viewCell);\n\t\t}\n\n\t\tthis.viewCell.detachTextEditor();\n\t\tthis._removeInputCollapsePreview();\n\t\tthis._outputContainerRenderer.dispose();\n\t\tthis._pendingLayout?.dispose();\n\n\t\tsuper.dispose();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
