{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/configExporter/electron-sandbox/configurationExportHelper.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-sandbox/environmentService.js';\nimport { Registry } from '../../../../platform/registry/common/platform.js';\nimport { IConfigurationNode, IConfigurationRegistry, Extensions, IConfigurationPropertySchema } from '../../../../platform/configuration/common/configurationRegistry.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IProductService } from '../../../../platform/product/common/productService.js';\n\ninterface IExportedConfigurationNode {\n\tname: string;\n\tdescription: string;\n\tdefault: any;\n\ttype?: string | string[];\n\tenum?: any[];\n\tenumDescriptions?: string[];\n}\n\ninterface IConfigurationExport {\n\tsettings: IExportedConfigurationNode[];\n\tbuildTime: number;\n\tcommit?: string;\n\tbuildNumber?: number;\n}\n\nexport class DefaultConfigurationExportHelper {\n\n\tconstructor(\n\t\t@INativeWorkbenchEnvironmentService environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@ICommandService private readonly commandService: ICommandService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@IProductService private readonly productService: IProductService\n\t) {\n\t\tconst exportDefaultConfigurationPath = environmentService.args['export-default-configuration'];\n\t\tif (exportDefaultConfigurationPath) {\n\t\t\tthis.writeConfigModelAndQuit(URI.file(exportDefaultConfigurationPath));\n\t\t}\n\t}\n\n\tprivate async writeConfigModelAndQuit(target: URI): Promise<void> {\n\t\ttry {\n\t\t\tawait this.extensionService.whenInstalledExtensionsRegistered();\n\t\t\tawait this.writeConfigModel(target);\n\t\t} finally {\n\t\t\tthis.commandService.executeCommand('workbench.action.quit');\n\t\t}\n\t}\n\n\tprivate async writeConfigModel(target: URI): Promise<void> {\n\t\tconst config = this.getConfigModel();\n\n\t\tconst resultString = JSON.stringify(config, undefined, '  ');\n\t\tawait this.fileService.writeFile(target, VSBuffer.fromString(resultString));\n\t}\n\n\tprivate getConfigModel(): IConfigurationExport {\n\t\tconst configRegistry = Registry.as<IConfigurationRegistry>(Extensions.Configuration);\n\t\tconst configurations = configRegistry.getConfigurations().slice();\n\t\tconst settings: IExportedConfigurationNode[] = [];\n\t\tconst processedNames = new Set<string>();\n\n\t\tconst processProperty = (name: string, prop: IConfigurationPropertySchema) => {\n\t\t\tif (processedNames.has(name)) {\n\t\t\t\tconsole.warn('Setting is registered twice: ' + name);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tprocessedNames.add(name);\n\t\t\tconst propDetails: IExportedConfigurationNode = {\n\t\t\t\tname,\n\t\t\t\tdescription: prop.description || prop.markdownDescription || '',\n\t\t\t\tdefault: prop.default,\n\t\t\t\ttype: prop.type\n\t\t\t};\n\n\t\t\tif (prop.enum) {\n\t\t\t\tpropDetails.enum = prop.enum;\n\t\t\t}\n\n\t\t\tif (prop.enumDescriptions || prop.markdownEnumDescriptions) {\n\t\t\t\tpropDetails.enumDescriptions = prop.enumDescriptions || prop.markdownEnumDescriptions;\n\t\t\t}\n\n\t\t\tsettings.push(propDetails);\n\t\t};\n\n\t\tconst processConfig = (config: IConfigurationNode) => {\n\t\t\tif (config.properties) {\n\t\t\t\tfor (const name in config.properties) {\n\t\t\t\t\tprocessProperty(name, config.properties[name]);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tconfig.allOf?.forEach(processConfig);\n\t\t};\n\n\t\tconfigurations.forEach(processConfig);\n\n\t\tconst excludedProps = configRegistry.getExcludedConfigurationProperties();\n\t\tfor (const name in excludedProps) {\n\t\t\tprocessProperty(name, excludedProps[name]);\n\t\t}\n\n\t\tconst result: IConfigurationExport = {\n\t\t\tsettings: settings.sort((a, b) => a.name.localeCompare(b.name)),\n\t\t\tbuildTime: Date.now(),\n\t\t\tcommit: this.productService.commit,\n\t\t\tbuildNumber: this.productService.settingsSearchBuildId\n\t\t};\n\n\t\treturn result;\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,0CAA0C;AACnD,SAAS,gBAAgB;AACzB,SAAS,oBAAoB,wBAAwB,YAAY,oCAAoC;AACrG,SAAS,yBAAyB;AAClC,SAAS,uBAAuB;AAChC,SAAS,oBAAoB;AAC7B,SAAS,gBAAgB;AACzB,SAAS,WAAW;AACpB,SAAS,uBAAuB;AAkBzB,IAAM,mCAAN,MAAuC;AAAA,EAE7C,YACqC,oBACA,kBACF,gBACH,aACG,gBACjC;AAJmC;AACF;AACH;AACG;AAElC,UAAM,iCAAiC,mBAAmB,KAAK,8BAA8B;AAC7F,QAAI,gCAAgC;AACnC,WAAK,wBAAwB,IAAI,KAAK,8BAA8B,CAAC;AAAA,IACtE;AAAA,EACD;AAAA,EA5CD,OA+B8C;AAAA;AAAA;AAAA,EAe7C,MAAc,wBAAwB,QAA4B;AACjE,QAAI;AACH,YAAM,KAAK,iBAAiB,kCAAkC;AAC9D,YAAM,KAAK,iBAAiB,MAAM;AAAA,IACnC,UAAE;AACD,WAAK,eAAe,eAAe,uBAAuB;AAAA,IAC3D;AAAA,EACD;AAAA,EAEA,MAAc,iBAAiB,QAA4B;AAC1D,UAAM,SAAS,KAAK,eAAe;AAEnC,UAAM,eAAe,KAAK,UAAU,QAAQ,QAAW,IAAI;AAC3D,UAAM,KAAK,YAAY,UAAU,QAAQ,SAAS,WAAW,YAAY,CAAC;AAAA,EAC3E;AAAA,EAEQ,iBAAuC;AAC9C,UAAM,iBAAiB,SAAS,GAA2B,WAAW,aAAa;AACnF,UAAM,iBAAiB,eAAe,kBAAkB,EAAE,MAAM;AAChE,UAAM,WAAyC,CAAC;AAChD,UAAM,iBAAiB,oBAAI,IAAY;AAEvC,UAAM,kBAAkB,wBAAC,MAAc,SAAuC;AAC7E,UAAI,eAAe,IAAI,IAAI,GAAG;AAC7B,gBAAQ,KAAK,kCAAkC,IAAI;AACnD;AAAA,MACD;AAEA,qBAAe,IAAI,IAAI;AACvB,YAAM,cAA0C;AAAA,QAC/C;AAAA,QACA,aAAa,KAAK,eAAe,KAAK,uBAAuB;AAAA,QAC7D,SAAS,KAAK;AAAA,QACd,MAAM,KAAK;AAAA,MACZ;AAEA,UAAI,KAAK,MAAM;AACd,oBAAY,OAAO,KAAK;AAAA,MACzB;AAEA,UAAI,KAAK,oBAAoB,KAAK,0BAA0B;AAC3D,oBAAY,mBAAmB,KAAK,oBAAoB,KAAK;AAAA,MAC9D;AAEA,eAAS,KAAK,WAAW;AAAA,IAC1B,GAvBwB;AAyBxB,UAAM,gBAAgB,wBAAC,WAA+B;AACrD,UAAI,OAAO,YAAY;AACtB,mBAAW,QAAQ,OAAO,YAAY;AACrC,0BAAgB,MAAM,OAAO,WAAW,IAAI,CAAC;AAAA,QAC9C;AAAA,MACD;AAEA,aAAO,OAAO,QAAQ,aAAa;AAAA,IACpC,GARsB;AAUtB,mBAAe,QAAQ,aAAa;AAEpC,UAAM,gBAAgB,eAAe,mCAAmC;AACxE,eAAW,QAAQ,eAAe;AACjC,sBAAgB,MAAM,cAAc,IAAI,CAAC;AAAA,IAC1C;AAEA,UAAM,SAA+B;AAAA,MACpC,UAAU,SAAS,KAAK,CAAC,GAAG,MAAM,EAAE,KAAK,cAAc,EAAE,IAAI,CAAC;AAAA,MAC9D,WAAW,KAAK,IAAI;AAAA,MACpB,QAAQ,KAAK,eAAe;AAAA,MAC5B,aAAa,KAAK,eAAe;AAAA,IAClC;AAEA,WAAO;AAAA,EACR;AACD;AAxFa,mCAAN;AAAA,EAGJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAPU;",
  "names": []
}
