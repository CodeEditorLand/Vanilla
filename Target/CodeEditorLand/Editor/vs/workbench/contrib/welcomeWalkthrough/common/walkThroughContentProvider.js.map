{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/welcomeWalkthrough/common/walkThroughContentProvider.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as marked from \"../../../../base/common/marked/marked.js\";\nimport { Schemas } from \"../../../../base/common/network.js\";\nimport { assertIsDefined } from \"../../../../base/common/types.js\";\nimport type { URI } from \"../../../../base/common/uri.js\";\nimport { Range } from \"../../../../editor/common/core/range.js\";\nimport { ILanguageService } from \"../../../../editor/common/languages/language.js\";\nimport {\n\tDefaultEndOfLine,\n\tEndOfLinePreference,\n\ttype ITextBufferFactory,\n\ttype ITextModel,\n} from \"../../../../editor/common/model.js\";\nimport { createTextBufferFactory } from \"../../../../editor/common/model/textModel.js\";\nimport { IModelService } from \"../../../../editor/common/services/model.js\";\nimport {\n\ttype ITextModelContentProvider,\n\tITextModelService,\n} from \"../../../../editor/common/services/resolverService.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport type { IWorkbenchContribution } from \"../../../common/contributions.js\";\n\nexport async function moduleToContent(\n\tinstantiationService: IInstantiationService,\n\tresource: URI,\n): Promise<string> {\n\tif (!resource.query) {\n\t\tthrow new Error(\"Walkthrough: invalid resource\");\n\t}\n\n\tconst query = JSON.parse(resource.query);\n\tif (!query.moduleId) {\n\t\tthrow new Error(\"Walkthrough: invalid resource\");\n\t}\n\n\tlet contents = \"\";\n\ttry {\n\t\tconst module = await import(query.moduleId);\n\t\tcontents = module.default();\n\t} catch {}\n\treturn contents;\n}\n\nexport class WalkThroughSnippetContentProvider\n\timplements ITextModelContentProvider, IWorkbenchContribution\n{\n\tstatic readonly ID = \"workbench.contrib.walkThroughSnippetContentProvider\";\n\n\tprivate loads = new Map<string, Promise<ITextBufferFactory>>();\n\n\tconstructor(\n\t\t@ITextModelService private readonly textModelResolverService: ITextModelService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t\t@IModelService private readonly modelService: IModelService,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t) {\n\t\tthis.textModelResolverService.registerTextModelContentProvider(Schemas.walkThroughSnippet, this);\n\t}\n\n\tprivate async textBufferFactoryFromResource(\n\t\tresource: URI,\n\t): Promise<ITextBufferFactory> {\n\t\tlet ongoing = this.loads.get(resource.toString());\n\t\tif (!ongoing) {\n\t\t\tongoing = moduleToContent(this.instantiationService, resource)\n\t\t\t\t.then((content) => createTextBufferFactory(content))\n\t\t\t\t.finally(() => this.loads.delete(resource.toString()));\n\t\t\tthis.loads.set(resource.toString(), ongoing);\n\t\t}\n\t\treturn ongoing;\n\t}\n\n\tpublic async provideTextContent(resource: URI): Promise<ITextModel> {\n\t\tconst factory = await this.textBufferFactoryFromResource(\n\t\t\tresource.with({ fragment: \"\" }),\n\t\t);\n\t\tlet codeEditorModel = this.modelService.getModel(resource);\n\t\tif (!codeEditorModel) {\n\t\t\tconst j = Number.parseInt(resource.fragment);\n\t\t\tlet i = 0;\n\t\t\tconst renderer = new marked.marked.Renderer();\n\t\t\trenderer.code = ({ text, lang }: marked.Tokens.Code) => {\n\t\t\t\ti++;\n\t\t\t\tconst languageId =\n\t\t\t\t\ttypeof lang === \"string\"\n\t\t\t\t\t\t? this.languageService.getLanguageIdByLanguageName(\n\t\t\t\t\t\t\t\tlang,\n\t\t\t\t\t\t\t) || \"\"\n\t\t\t\t\t\t: \"\";\n\t\t\t\tconst languageSelection =\n\t\t\t\t\tthis.languageService.createById(languageId);\n\t\t\t\t// Create all models for this resource in one go... we'll need them all and we don't want to re-parse markdown each time\n\t\t\t\tconst model = this.modelService.createModel(\n\t\t\t\t\ttext,\n\t\t\t\t\tlanguageSelection,\n\t\t\t\t\tresource.with({ fragment: `${i}.${lang}` }),\n\t\t\t\t);\n\t\t\t\tif (i === j) {\n\t\t\t\t\tcodeEditorModel = model;\n\t\t\t\t}\n\t\t\t\treturn \"\";\n\t\t\t};\n\t\t\tconst textBuffer = factory.create(DefaultEndOfLine.LF).textBuffer;\n\t\t\tconst lineCount = textBuffer.getLineCount();\n\t\t\tconst range = new Range(\n\t\t\t\t1,\n\t\t\t\t1,\n\t\t\t\tlineCount,\n\t\t\t\ttextBuffer.getLineLength(lineCount) + 1,\n\t\t\t);\n\t\t\tconst markdown = textBuffer.getValueInRange(\n\t\t\t\trange,\n\t\t\t\tEndOfLinePreference.TextDefined,\n\t\t\t);\n\t\t\tmarked.marked(markdown, { renderer });\n\t\t}\n\t\treturn assertIsDefined(codeEditorModel);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,YAAY,YAAY;AACxB,SAAS,eAAe;AACxB,SAAS,uBAAuB;AAEhC,SAAS,aAAa;AACtB,SAAS,wBAAwB;AACjC;AAAA,EACC;AAAA,EACA;AAAA,OAGM;AACP,SAAS,+BAA+B;AACxC,SAAS,qBAAqB;AAC9B;AAAA,EAEC;AAAA,OACM;AACP,SAAS,6BAA6B;AAGtC,eAAsB,gBACrB,sBACA,UACkB;AAClB,MAAI,CAAC,SAAS,OAAO;AACpB,UAAM,IAAI,MAAM,+BAA+B;AAAA,EAChD;AAEA,QAAM,QAAQ,KAAK,MAAM,SAAS,KAAK;AACvC,MAAI,CAAC,MAAM,UAAU;AACpB,UAAM,IAAI,MAAM,+BAA+B;AAAA,EAChD;AAEA,MAAI,WAAW;AACf,MAAI;AACH,UAAM,SAAS,MAAM,OAAO,MAAM;AAClC,eAAW,OAAO,QAAQ;AAAA,EAC3B,QAAQ;AAAA,EAAC;AACT,SAAO;AACR;AAnBsB;AAqBf,IAAM,oCAAN,MAEP;AAAA,EAKC,YACqC,0BACD,iBACH,cACQ,sBACvC;AAJmC;AACD;AACH;AACQ;AAExC,SAAK,yBAAyB,iCAAiC,QAAQ,oBAAoB,IAAI;AAAA,EAChG;AAAA,EA7DD,OAiDA;AAAA;AAAA;AAAA,EACC,OAAgB,KAAK;AAAA,EAEb,QAAQ,oBAAI,IAAyC;AAAA,EAW7D,MAAc,8BACb,UAC8B;AAC9B,QAAI,UAAU,KAAK,MAAM,IAAI,SAAS,SAAS,CAAC;AAChD,QAAI,CAAC,SAAS;AACb,gBAAU,gBAAgB,KAAK,sBAAsB,QAAQ,EAC3D,KAAK,CAAC,YAAY,wBAAwB,OAAO,CAAC,EAClD,QAAQ,MAAM,KAAK,MAAM,OAAO,SAAS,SAAS,CAAC,CAAC;AACtD,WAAK,MAAM,IAAI,SAAS,SAAS,GAAG,OAAO;AAAA,IAC5C;AACA,WAAO;AAAA,EACR;AAAA,EAEA,MAAa,mBAAmB,UAAoC;AACnE,UAAM,UAAU,MAAM,KAAK;AAAA,MAC1B,SAAS,KAAK,EAAE,UAAU,GAAG,CAAC;AAAA,IAC/B;AACA,QAAI,kBAAkB,KAAK,aAAa,SAAS,QAAQ;AACzD,QAAI,CAAC,iBAAiB;AACrB,YAAM,IAAI,OAAO,SAAS,SAAS,QAAQ;AAC3C,UAAI,IAAI;AACR,YAAM,WAAW,IAAI,OAAO,OAAO,SAAS;AAC5C,eAAS,OAAO,CAAC,EAAE,MAAM,KAAK,MAA0B;AACvD;AACA,cAAM,aACL,OAAO,SAAS,WACb,KAAK,gBAAgB;AAAA,UACrB;AAAA,QACD,KAAK,KACJ;AACJ,cAAM,oBACL,KAAK,gBAAgB,WAAW,UAAU;AAE3C,cAAM,QAAQ,KAAK,aAAa;AAAA,UAC/B;AAAA,UACA;AAAA,UACA,SAAS,KAAK,EAAE,UAAU,GAAG,CAAC,IAAI,IAAI,GAAG,CAAC;AAAA,QAC3C;AACA,YAAI,MAAM,GAAG;AACZ,4BAAkB;AAAA,QACnB;AACA,eAAO;AAAA,MACR;AACA,YAAM,aAAa,QAAQ,OAAO,iBAAiB,EAAE,EAAE;AACvD,YAAM,YAAY,WAAW,aAAa;AAC1C,YAAM,QAAQ,IAAI;AAAA,QACjB;AAAA,QACA;AAAA,QACA;AAAA,QACA,WAAW,cAAc,SAAS,IAAI;AAAA,MACvC;AACA,YAAM,WAAW,WAAW;AAAA,QAC3B;AAAA,QACA,oBAAoB;AAAA,MACrB;AACA,aAAO,OAAO,UAAU,EAAE,SAAS,CAAC;AAAA,IACrC;AACA,WAAO,gBAAgB,eAAe;AAAA,EACvC;AACD;AA3Ea,oCAAN;AAAA,EAQJ;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAXU;",
  "names": []
}
