var u=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var m=(p,o,e,r)=>{for(var t=r>1?void 0:r?h(o,e):o,s=p.length-1,i;s>=0;s--)(i=p[s])&&(t=(r?i(o,e,t):i(t))||t);return r&&t&&u(o,e,t),t},a=(p,o)=>(e,r)=>o(e,r,p);import{EditorInput as v}from"../../../common/editor/editorInput.js";import{EditorModel as f}from"../../../common/editor/editorModel.js";import"../../../../base/common/uri.js";import"../../../../base/common/lifecycle.js";import{ITextModelService as g}from"../../../../editor/common/services/resolverService.js";import{marked as d}from"../../../../base/common/marked/marked.js";import{isEqual as y}from"../../../../base/common/resources.js";import{moduleToContent as I}from"../common/walkThroughContentProvider.js";import"../../../../base/browser/dom.js";import{EditorInputCapabilities as S}from"../../../common/editor.js";import{IInstantiationService as x}from"../../../../platform/instantiation/common/instantiation.js";import{Schemas as T}from"../../../../base/common/network.js";class c extends f{constructor(e,r){super();this.mainRef=e;this.snippetRefs=r}get main(){return this.mainRef}get snippets(){return this.snippetRefs.map(e=>e.object)}dispose(){this.snippetRefs.forEach(e=>e.dispose()),super.dispose()}}let n=class extends v{constructor(e,r,t){super();this.options=e;this.instantiationService=r;this.textModelResolverService=t}get capabilities(){return S.Singleton|super.capabilities}promise=null;maxTopScroll=0;maxBottomScroll=0;get resource(){return this.options.resource}get typeId(){return this.options.typeId}getName(){return this.options.name}getDescription(){return this.options.description||""}getTelemetryFrom(){return this.options.telemetryFrom}getTelemetryDescriptor(){const e=super.getTelemetryDescriptor();return e.target=this.getTelemetryFrom(),e}get onReady(){return this.options.onReady}get layout(){return this.options.layout}resolve(){return this.promise||(this.promise=I(this.instantiationService,this.options.resource).then(e=>{if(this.resource.path.endsWith(".html"))return new c(e,[]);const r=[];let t=0;const s=new d.Renderer;return s.code=({lang:i})=>{t++;const l=this.options.resource.with({scheme:T.walkThroughSnippet,fragment:`${t}.${i}`});return r.push(this.textModelResolverService.createModelReference(l)),`<div id="snippet-${l.fragment}" class="walkThroughEditorContainer" ></div>`},e=d(e,{async:!1,renderer:s}),Promise.all(r).then(i=>new c(e,i))})),this.promise}matches(e){return super.matches(e)?!0:e instanceof n?y(e.options.resource,this.options.resource):!1}dispose(){this.promise&&(this.promise.then(e=>e.dispose()),this.promise=null),super.dispose()}relativeScrollPosition(e,r){this.maxTopScroll=Math.max(this.maxTopScroll,e),this.maxBottomScroll=Math.max(this.maxBottomScroll,r)}};n=m([a(1,x),a(2,g)],n);export{n as WalkThroughInput};
