import{renderStringAsPlaintext as m}from"../../../../base/browser/markdownRenderer.js";import{toDisposable as p}from"../../../../base/common/lifecycle.js";import{GraphemeIterator as x,forAnsiStringParts as P,removeAnsiEscapeCodes as u}from"../../../../base/common/strings.js";import"./media/testMessageColorizer.css";import{Position as c}from"../../../../editor/common/core/position.js";import{Range as h}from"../../../../editor/common/core/range.js";const C=/^\x1b\[([0-9]+)m$/;var b=(r=>(r.Prefix="tstm-ansidec-",r.ForegroundPrefix="tstm-ansidec-fg",r.BackgroundPrefix="tstm-ansidec-bg",r.Bold="tstm-ansidec-1",r.Faint="tstm-ansidec-2",r.Italic="tstm-ansidec-3",r.Underline="tstm-ansidec-4",r))(b||{});const B=o=>typeof o=="string"?u(o):m(o),W=(o,l)=>{const a=[];return l.changeDecorations(g=>{let i=new c(1,1),e=[];for(const n of P(o))if(n.isCode){const r=C.exec(n.str)?.[1];if(!r)continue;const s=Number(r);s===0?e.length=0:s===22?e=e.filter(t=>t!=="tstm-ansidec-1"&&t!=="tstm-ansidec-3"):s===23?e=e.filter(t=>t!=="tstm-ansidec-3"):s===24?e=e.filter(t=>t!=="tstm-ansidec-4"):s>=30&&s<=39||s>=90&&s<=99?(e=e.filter(t=>!t.startsWith("tstm-ansidec-fg")),e.push("tstm-ansidec-fg"+r)):s>=40&&s<=49||s>=100&&s<=109?(e=e.filter(t=>!t.startsWith("tstm-ansidec-bg")),e.push("tstm-ansidec-bg"+r)):e.push("tstm-ansidec-"+r)}else{let r=i.lineNumber,s=i.column;const t=new x(n.str);for(let d=0;!t.eol();d+=t.nextGraphemeLength())n.str[d]===`
`?(r++,s=1):s++;const f=new c(r,s);e.length&&a.push(g.addDecoration(h.fromPositions(i,f),{inlineClassName:e.join(" "),description:"test-message-colorized"})),i=f}}),p(()=>l.removeDecorations(a))};export{W as colorizeTestMessageInEditor,B as renderTestMessageAsText};
