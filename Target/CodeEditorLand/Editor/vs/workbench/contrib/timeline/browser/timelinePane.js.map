{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/timeline/browser/timelinePane.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport './media/timelinePane.css';\nimport { localize, localize2 } from '../../../../nls.js';\nimport * as DOM from '../../../../base/browser/dom.js';\nimport { IAction, ActionRunner } from '../../../../base/common/actions.js';\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { fromNow } from '../../../../base/common/date.js';\nimport { debounce } from '../../../../base/common/decorators.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { FuzzyScore, createMatches } from '../../../../base/common/filters.js';\nimport { Iterable } from '../../../../base/common/iterator.js';\nimport { DisposableStore, IDisposable, Disposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { escapeRegExpCharacters } from '../../../../base/common/strings.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IconLabel } from '../../../../base/browser/ui/iconLabel/iconLabel.js';\nimport { IListVirtualDelegate, IIdentityProvider, IKeyboardNavigationLabelProvider } from '../../../../base/browser/ui/list/list.js';\nimport { ITreeNode, ITreeRenderer, ITreeContextMenuEvent, ITreeElement } from '../../../../base/browser/ui/tree/tree.js';\nimport { ViewPane, IViewPaneOptions } from '../../../browser/parts/views/viewPane.js';\nimport { WorkbenchObjectTree } from '../../../../platform/list/browser/listService.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { ContextKeyExpr, IContextKeyService, RawContextKey, IContextKey } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IConfigurationService, IConfigurationChangeEvent } from '../../../../platform/configuration/common/configuration.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ITimelineService, TimelineChangeEvent, TimelineItem, TimelineOptions, TimelineProvidersChangeEvent, TimelineRequest, Timeline } from '../common/timeline.js';\nimport { IEditorService } from '../../../services/editor/common/editorService.js';\nimport { SideBySideEditor, EditorResourceAccessor } from '../../../common/editor.js';\nimport { ICommandService, CommandsRegistry } from '../../../../platform/commands/common/commands.js';\nimport { IThemeService } from '../../../../platform/theme/common/themeService.js';\nimport { ThemeIcon } from '../../../../base/common/themables.js';\nimport { IViewDescriptorService } from '../../../common/views.js';\nimport { IProgressService } from '../../../../platform/progress/common/progress.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { ActionBar, IActionViewItemProvider } from '../../../../base/browser/ui/actionbar/actionbar.js';\nimport { createAndFillInContextMenuActions, createActionViewItem } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { IMenuService, MenuId, registerAction2, Action2, MenuRegistry } from '../../../../platform/actions/common/actions.js';\nimport { ITelemetryService } from '../../../../platform/telemetry/common/telemetry.js';\nimport { ActionViewItem } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { ColorScheme } from '../../../../platform/theme/common/theme.js';\nimport { Codicon } from '../../../../base/common/codicons.js';\nimport { registerIcon } from '../../../../platform/theme/common/iconRegistry.js';\nimport { API_OPEN_DIFF_EDITOR_COMMAND_ID, API_OPEN_EDITOR_COMMAND_ID } from '../../../browser/parts/editor/editorCommands.js';\nimport { MarshalledId } from '../../../../base/common/marshallingIds.js';\nimport { isString } from '../../../../base/common/types.js';\nimport { renderMarkdownAsPlaintext } from '../../../../base/browser/markdownRenderer.js';\nimport { IHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegate.js';\nimport { IUriIdentityService } from '../../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { IStorageService, StorageScope, StorageTarget } from '../../../../platform/storage/common/storage.js';\nimport { AriaRole } from '../../../../base/browser/ui/aria/aria.js';\nimport { ILocalizedString } from '../../../../platform/action/common/action.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\n\nconst ItemHeight = 22;\n\ntype TreeElement = TimelineItem | LoadMoreCommand;\n\nfunction isLoadMoreCommand(item: TreeElement | undefined): item is LoadMoreCommand {\n\treturn item instanceof LoadMoreCommand;\n}\n\nfunction isTimelineItem(item: TreeElement | undefined): item is TimelineItem {\n\treturn !!item && !item.handle.startsWith('vscode-command:');\n}\n\nfunction updateRelativeTime(item: TimelineItem, lastRelativeTime: string | undefined): string | undefined {\n\titem.relativeTime = isTimelineItem(item) ? fromNow(item.timestamp) : undefined;\n\titem.relativeTimeFullWord = isTimelineItem(item) ? fromNow(item.timestamp, false, true) : undefined;\n\tif (lastRelativeTime === undefined || item.relativeTime !== lastRelativeTime) {\n\t\tlastRelativeTime = item.relativeTime;\n\t\titem.hideRelativeTime = false;\n\t} else {\n\t\titem.hideRelativeTime = true;\n\t}\n\n\treturn lastRelativeTime;\n}\n\ninterface TimelineActionContext {\n\turi: URI | undefined;\n\titem: TreeElement;\n}\n\nclass TimelineAggregate {\n\treadonly items: TimelineItem[];\n\treadonly source: string;\n\n\tlastRenderedIndex: number;\n\n\tconstructor(timeline: Timeline) {\n\t\tthis.source = timeline.source;\n\t\tthis.items = timeline.items;\n\t\tthis._cursor = timeline.paging?.cursor;\n\t\tthis.lastRenderedIndex = -1;\n\t}\n\n\tprivate _cursor?: string;\n\tget cursor(): string | undefined {\n\t\treturn this._cursor;\n\t}\n\n\tget more(): boolean {\n\t\treturn this._cursor !== undefined;\n\t}\n\n\tget newest(): TimelineItem | undefined {\n\t\treturn this.items[0];\n\t}\n\n\tget oldest(): TimelineItem | undefined {\n\t\treturn this.items[this.items.length - 1];\n\t}\n\n\tadd(timeline: Timeline, options: TimelineOptions) {\n\t\tlet updated = false;\n\n\t\tif (timeline.items.length !== 0 && this.items.length !== 0) {\n\t\t\tupdated = true;\n\n\t\t\tconst ids = new Set();\n\t\t\tconst timestamps = new Set();\n\n\t\t\tfor (const item of timeline.items) {\n\t\t\t\tif (item.id === undefined) {\n\t\t\t\t\ttimestamps.add(item.timestamp);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tids.add(item.id);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Remove any duplicate items\n\t\t\tlet i = this.items.length;\n\t\t\tlet item;\n\t\t\twhile (i--) {\n\t\t\t\titem = this.items[i];\n\t\t\t\tif ((item.id !== undefined && ids.has(item.id)) || timestamps.has(item.timestamp)) {\n\t\t\t\t\tthis.items.splice(i, 1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif ((timeline.items[timeline.items.length - 1]?.timestamp ?? 0) >= (this.newest?.timestamp ?? 0)) {\n\t\t\t\tthis.items.splice(0, 0, ...timeline.items);\n\t\t\t} else {\n\t\t\t\tthis.items.push(...timeline.items);\n\t\t\t}\n\t\t} else if (timeline.items.length !== 0) {\n\t\t\tupdated = true;\n\n\t\t\tthis.items.push(...timeline.items);\n\t\t}\n\n\t\t// If we are not requesting more recent items than we have, then update the cursor\n\t\tif (options.cursor !== undefined || typeof options.limit !== 'object') {\n\t\t\tthis._cursor = timeline.paging?.cursor;\n\t\t}\n\n\t\tif (updated) {\n\t\t\tthis.items.sort(\n\t\t\t\t(a, b) =>\n\t\t\t\t\t(b.timestamp - a.timestamp) ||\n\t\t\t\t\t(a.source === undefined\n\t\t\t\t\t\t? b.source === undefined ? 0 : 1\n\t\t\t\t\t\t: b.source === undefined ? -1 : b.source.localeCompare(a.source, undefined, { numeric: true, sensitivity: 'base' }))\n\t\t\t);\n\t\t}\n\n\t\treturn updated;\n\t}\n\n\tprivate _stale = false;\n\tget stale() {\n\t\treturn this._stale;\n\t}\n\n\tprivate _requiresReset = false;\n\tget requiresReset(): boolean {\n\t\treturn this._requiresReset;\n\t}\n\n\tinvalidate(requiresReset: boolean) {\n\t\tthis._stale = true;\n\t\tthis._requiresReset = requiresReset;\n\t}\n}\n\nclass LoadMoreCommand {\n\treadonly handle = 'vscode-command:loadMore';\n\treadonly timestamp = 0;\n\treadonly description = undefined;\n\treadonly tooltip = undefined;\n\treadonly contextValue = undefined;\n\t// Make things easier for duck typing\n\treadonly id = undefined;\n\treadonly icon = undefined;\n\treadonly iconDark = undefined;\n\treadonly source = undefined;\n\treadonly relativeTime = undefined;\n\treadonly relativeTimeFullWord = undefined;\n\treadonly hideRelativeTime = undefined;\n\n\tconstructor(loading: boolean) {\n\t\tthis._loading = loading;\n\t}\n\tprivate _loading: boolean = false;\n\tget loading(): boolean {\n\t\treturn this._loading;\n\t}\n\tset loading(value: boolean) {\n\t\tthis._loading = value;\n\t}\n\n\tget ariaLabel() {\n\t\treturn this.label;\n\t}\n\n\tget label() {\n\t\treturn this.loading ? localize('timeline.loadingMore', \"Loading...\") : localize('timeline.loadMore', \"Load more\");\n\t}\n\n\tget themeIcon(): ThemeIcon | undefined {\n\t\treturn undefined; //this.loading ? { id: 'sync~spin' } : undefined;\n\t}\n}\n\nexport const TimelineFollowActiveEditorContext = new RawContextKey<boolean>('timelineFollowActiveEditor', true, true);\nexport const TimelineExcludeSources = new RawContextKey<string>('timelineExcludeSources', '[]', true);\n\nexport class TimelinePane extends ViewPane {\n\tstatic readonly TITLE: ILocalizedString = localize2('timeline', \"Timeline\");\n\n\tprivate $container!: HTMLElement;\n\tprivate $message!: HTMLDivElement;\n\tprivate $tree!: HTMLDivElement;\n\tprivate tree!: WorkbenchObjectTree<TreeElement, FuzzyScore>;\n\tprivate treeRenderer: TimelineTreeRenderer | undefined;\n\tprivate commands: TimelinePaneCommands;\n\tprivate visibilityDisposables: DisposableStore | undefined;\n\n\tprivate followActiveEditorContext: IContextKey<boolean>;\n\tprivate timelineExcludeSourcesContext: IContextKey<string>;\n\n\tprivate excludedSources: Set<string>;\n\tprivate pendingRequests = new Map<string, TimelineRequest>();\n\tprivate timelinesBySource = new Map<string, TimelineAggregate>();\n\n\tprivate uri: URI | undefined;\n\n\tconstructor(\n\t\toptions: IViewPaneOptions,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IViewDescriptorService viewDescriptorService: IViewDescriptorService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IEditorService protected editorService: IEditorService,\n\t\t@ICommandService protected commandService: ICommandService,\n\t\t@IProgressService private readonly progressService: IProgressService,\n\t\t@ITimelineService protected timelineService: ITimelineService,\n\t\t@IOpenerService openerService: IOpenerService,\n\t\t@IThemeService themeService: IThemeService,\n\t\t@ITelemetryService telemetryService: ITelemetryService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@IUriIdentityService private readonly uriIdentityService: IUriIdentityService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t) {\n\t\tsuper({ ...options, titleMenuId: MenuId.TimelineTitle }, keybindingService, contextMenuService, configurationService, contextKeyService, viewDescriptorService, instantiationService, openerService, themeService, telemetryService, hoverService);\n\n\t\tthis.commands = this._register(this.instantiationService.createInstance(TimelinePaneCommands, this));\n\n\t\tthis.followActiveEditorContext = TimelineFollowActiveEditorContext.bindTo(this.contextKeyService);\n\t\tthis.timelineExcludeSourcesContext = TimelineExcludeSources.bindTo(this.contextKeyService);\n\n\t\tconst excludedSourcesString = storageService.get('timeline.excludeSources', StorageScope.PROFILE, '[]');\n\t\tthis.timelineExcludeSourcesContext.set(excludedSourcesString);\n\t\tthis.excludedSources = new Set(JSON.parse(excludedSourcesString));\n\n\t\tthis._register(storageService.onDidChangeValue(StorageScope.PROFILE, 'timeline.excludeSources', this._register(new DisposableStore()))(this.onStorageServiceChanged, this));\n\t\tthis._register(configurationService.onDidChangeConfiguration(this.onConfigurationChanged, this));\n\t\tthis._register(timelineService.onDidChangeProviders(this.onProvidersChanged, this));\n\t\tthis._register(timelineService.onDidChangeTimeline(this.onTimelineChanged, this));\n\t\tthis._register(timelineService.onDidChangeUri(uri => this.setUri(uri), this));\n\t}\n\n\tprivate _followActiveEditor: boolean = true;\n\tget followActiveEditor(): boolean {\n\t\treturn this._followActiveEditor;\n\t}\n\tset followActiveEditor(value: boolean) {\n\t\tif (this._followActiveEditor === value) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._followActiveEditor = value;\n\t\tthis.followActiveEditorContext.set(value);\n\n\t\tthis.updateFilename(this._filename);\n\n\t\tif (value) {\n\t\t\tthis.onActiveEditorChanged();\n\t\t}\n\t}\n\n\tprivate _pageOnScroll: boolean | undefined;\n\tget pageOnScroll() {\n\t\tif (this._pageOnScroll === undefined) {\n\t\t\tthis._pageOnScroll = this.configurationService.getValue<boolean | null | undefined>('timeline.pageOnScroll') ?? false;\n\t\t}\n\n\t\treturn this._pageOnScroll;\n\t}\n\n\tget pageSize() {\n\t\tlet pageSize = this.configurationService.getValue<number | null | undefined>('timeline.pageSize');\n\t\tif (pageSize === undefined || pageSize === null) {\n\t\t\t// If we are paging when scrolling, then add an extra item to the end to make sure the \"Load more\" item is out of view\n\t\t\tpageSize = Math.max(20, Math.floor((this.tree?.renderHeight ?? 0 / ItemHeight) + (this.pageOnScroll ? 1 : -1)));\n\t\t}\n\t\treturn pageSize;\n\t}\n\n\treset() {\n\t\tthis.loadTimeline(true);\n\t}\n\n\tsetUri(uri: URI) {\n\t\tthis.setUriCore(uri, true);\n\t}\n\n\tprivate setUriCore(uri: URI | undefined, disableFollowing: boolean) {\n\t\tif (disableFollowing) {\n\t\t\tthis.followActiveEditor = false;\n\t\t}\n\n\t\tthis.uri = uri;\n\t\tthis.updateFilename(uri ? this.labelService.getUriBasenameLabel(uri) : undefined);\n\t\tthis.treeRenderer?.setUri(uri);\n\t\tthis.loadTimeline(true);\n\t}\n\n\tprivate onStorageServiceChanged() {\n\t\tconst excludedSourcesString = this.storageService.get('timeline.excludeSources', StorageScope.PROFILE, '[]');\n\t\tthis.timelineExcludeSourcesContext.set(excludedSourcesString);\n\t\tthis.excludedSources = new Set(JSON.parse(excludedSourcesString));\n\n\t\tconst missing = this.timelineService.getSources()\n\t\t\t.filter(({ id }) => !this.excludedSources.has(id) && !this.timelinesBySource.has(id));\n\t\tif (missing.length !== 0) {\n\t\t\tthis.loadTimeline(true, missing.map(({ id }) => id));\n\t\t} else {\n\t\t\tthis.refresh();\n\t\t}\n\t}\n\n\tprivate onConfigurationChanged(e: IConfigurationChangeEvent) {\n\t\tif (e.affectsConfiguration('timeline.pageOnScroll')) {\n\t\t\tthis._pageOnScroll = undefined;\n\t\t}\n\t}\n\n\tprivate onActiveEditorChanged() {\n\t\tif (!this.followActiveEditor || !this.isExpanded()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst uri = EditorResourceAccessor.getOriginalUri(this.editorService.activeEditor, { supportSideBySide: SideBySideEditor.PRIMARY });\n\n\t\tif ((this.uriIdentityService.extUri.isEqual(uri, this.uri) && uri !== undefined) ||\n\t\t\t// Fallback to match on fsPath if we are dealing with files or git schemes\n\t\t\t(uri?.fsPath === this.uri?.fsPath && (uri?.scheme === Schemas.file || uri?.scheme === 'git') && (this.uri?.scheme === Schemas.file || this.uri?.scheme === 'git'))) {\n\n\t\t\t// If the uri hasn't changed, make sure we have valid caches\n\t\t\tfor (const source of this.timelineService.getSources()) {\n\t\t\t\tif (this.excludedSources.has(source.id)) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tconst timeline = this.timelinesBySource.get(source.id);\n\t\t\t\tif (timeline !== undefined && !timeline.stale) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (timeline !== undefined) {\n\t\t\t\t\tthis.updateTimeline(timeline, timeline.requiresReset);\n\t\t\t\t} else {\n\t\t\t\t\tthis.loadTimelineForSource(source.id, uri, true);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tthis.setUriCore(uri, false);\n\t}\n\n\tprivate onProvidersChanged(e: TimelineProvidersChangeEvent) {\n\t\tif (e.removed) {\n\t\t\tfor (const source of e.removed) {\n\t\t\t\tthis.timelinesBySource.delete(source);\n\t\t\t}\n\n\t\t\tthis.refresh();\n\t\t}\n\n\t\tif (e.added) {\n\t\t\tthis.loadTimeline(true, e.added);\n\t\t}\n\t}\n\n\tprivate onTimelineChanged(e: TimelineChangeEvent) {\n\t\tif (e?.uri === undefined || this.uriIdentityService.extUri.isEqual(URI.revive(e.uri), this.uri)) {\n\t\t\tconst timeline = this.timelinesBySource.get(e.id);\n\t\t\tif (timeline === undefined) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this.isBodyVisible()) {\n\t\t\t\tthis.updateTimeline(timeline, e.reset);\n\t\t\t} else {\n\t\t\t\ttimeline.invalidate(e.reset);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _filename: string | undefined;\n\tupdateFilename(filename: string | undefined) {\n\t\tthis._filename = filename;\n\t\tif (this.followActiveEditor || !filename) {\n\t\t\tthis.updateTitleDescription(filename);\n\t\t} else {\n\t\t\tthis.updateTitleDescription(`${filename} (pinned)`);\n\t\t}\n\t}\n\n\tprivate _message: string | undefined;\n\tget message(): string | undefined {\n\t\treturn this._message;\n\t}\n\n\tset message(message: string | undefined) {\n\t\tthis._message = message;\n\t\tthis.updateMessage();\n\t}\n\n\tprivate updateMessage(): void {\n\t\tif (this._message !== undefined) {\n\t\t\tthis.showMessage(this._message);\n\t\t} else {\n\t\t\tthis.hideMessage();\n\t\t}\n\t}\n\n\tprivate showMessage(message: string): void {\n\t\tif (!this.$message) {\n\t\t\treturn;\n\t\t}\n\t\tthis.$message.classList.remove('hide');\n\t\tthis.resetMessageElement();\n\n\t\tthis.$message.textContent = message;\n\t}\n\n\tprivate hideMessage(): void {\n\t\tthis.resetMessageElement();\n\t\tthis.$message.classList.add('hide');\n\t}\n\n\tprivate resetMessageElement(): void {\n\t\tDOM.clearNode(this.$message);\n\t}\n\n\tprivate _isEmpty = true;\n\tprivate _maxItemCount = 0;\n\n\tprivate _visibleItemCount = 0;\n\tprivate get hasVisibleItems() {\n\t\treturn this._visibleItemCount > 0;\n\t}\n\n\tprivate clear(cancelPending: boolean) {\n\t\tthis._visibleItemCount = 0;\n\t\tthis._maxItemCount = this.pageSize;\n\t\tthis.timelinesBySource.clear();\n\n\t\tif (cancelPending) {\n\t\t\tfor (const { tokenSource } of this.pendingRequests.values()) {\n\t\t\t\ttokenSource.dispose(true);\n\t\t\t}\n\n\t\t\tthis.pendingRequests.clear();\n\n\t\t\tif (!this.isBodyVisible() && this.tree) {\n\t\t\t\tthis.tree.setChildren(null, undefined);\n\t\t\t\tthis._isEmpty = true;\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate async loadTimeline(reset: boolean, sources?: string[]) {\n\t\t// If we have no source, we are resetting all sources, so cancel everything in flight and reset caches\n\t\tif (sources === undefined) {\n\t\t\tif (reset) {\n\t\t\t\tthis.clear(true);\n\t\t\t}\n\n\t\t\t// TODO@eamodio: Are these the right the list of schemes to exclude? Is there a better way?\n\t\t\tif (this.uri?.scheme === Schemas.vscodeSettings || this.uri?.scheme === Schemas.webviewPanel || this.uri?.scheme === Schemas.walkThrough) {\n\t\t\t\tthis.uri = undefined;\n\n\t\t\t\tthis.clear(false);\n\t\t\t\tthis.refresh();\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (this._isEmpty && this.uri !== undefined) {\n\t\t\t\tthis.setLoadingUriMessage();\n\t\t\t}\n\t\t}\n\n\t\tif (this.uri === undefined) {\n\t\t\tthis.clear(false);\n\t\t\tthis.refresh();\n\n\t\t\treturn;\n\t\t}\n\n\t\tif (!this.isBodyVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tlet hasPendingRequests = false;\n\n\t\tfor (const source of sources ?? this.timelineService.getSources().map(s => s.id)) {\n\t\t\tconst requested = this.loadTimelineForSource(source, this.uri, reset);\n\t\t\tif (requested) {\n\t\t\t\thasPendingRequests = true;\n\t\t\t}\n\t\t}\n\n\t\tif (!hasPendingRequests) {\n\t\t\tthis.refresh();\n\t\t} else if (this._isEmpty) {\n\t\t\tthis.setLoadingUriMessage();\n\t\t}\n\t}\n\n\tprivate loadTimelineForSource(source: string, uri: URI, reset: boolean, options?: TimelineOptions) {\n\t\tif (this.excludedSources.has(source)) {\n\t\t\treturn false;\n\t\t}\n\n\t\tconst timeline = this.timelinesBySource.get(source);\n\n\t\t// If we are paging, and there are no more items or we have enough cached items to cover the next page,\n\t\t// don't bother querying for more\n\t\tif (\n\t\t\t!reset &&\n\t\t\toptions?.cursor !== undefined &&\n\t\t\ttimeline !== undefined &&\n\t\t\t(!timeline?.more || timeline.items.length > timeline.lastRenderedIndex + this.pageSize)\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\n\t\tif (options === undefined) {\n\t\t\tif (\n\t\t\t\t!reset &&\n\t\t\t\ttimeline !== undefined &&\n\t\t\t\ttimeline.items.length > 0 &&\n\t\t\t\t!timeline.more\n\t\t\t) {\n\t\t\t\t// If we are not resetting, have item(s), and already know there are no more to fetch, we're done here\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\toptions = { cursor: reset ? undefined : timeline?.cursor, limit: this.pageSize };\n\t\t}\n\n\t\tlet request = this.pendingRequests.get(source);\n\t\tif (request !== undefined) {\n\t\t\toptions.cursor = request.options.cursor;\n\n\t\t\t// TODO@eamodio deal with concurrent requests better\n\t\t\tif (typeof options.limit === 'number') {\n\t\t\t\tif (typeof request.options.limit === 'number') {\n\t\t\t\t\toptions.limit += request.options.limit;\n\t\t\t\t} else {\n\t\t\t\t\toptions.limit = request.options.limit;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\trequest?.tokenSource.dispose(true);\n\t\toptions.cacheResults = true;\n\t\toptions.resetCache = reset;\n\t\trequest = this.timelineService.getTimeline(\n\t\t\tsource, uri, options, new CancellationTokenSource()\n\t\t);\n\n\t\tif (request === undefined) {\n\t\t\treturn false;\n\t\t}\n\n\t\tthis.pendingRequests.set(source, request);\n\t\trequest.tokenSource.token.onCancellationRequested(() => this.pendingRequests.delete(source));\n\n\t\tthis.handleRequest(request);\n\n\t\treturn true;\n\t}\n\n\tprivate updateTimeline(timeline: TimelineAggregate, reset: boolean) {\n\t\tif (reset) {\n\t\t\tthis.timelinesBySource.delete(timeline.source);\n\t\t\t// Override the limit, to re-query for all our existing cached (possibly visible) items to keep visual continuity\n\t\t\tconst { oldest } = timeline;\n\t\t\tthis.loadTimelineForSource(timeline.source, this.uri!, true, oldest !== undefined ? { limit: { timestamp: oldest.timestamp, id: oldest.id } } : undefined);\n\t\t} else {\n\t\t\t// Override the limit, to query for any newer items\n\t\t\tconst { newest } = timeline;\n\t\t\tthis.loadTimelineForSource(timeline.source, this.uri!, false, newest !== undefined ? { limit: { timestamp: newest.timestamp, id: newest.id } } : { limit: this.pageSize });\n\t\t}\n\t}\n\n\tprivate _pendingRefresh = false;\n\n\tprivate async handleRequest(request: TimelineRequest) {\n\t\tlet response: Timeline | undefined;\n\t\ttry {\n\t\t\tresponse = await this.progressService.withProgress({ location: this.id }, () => request.result);\n\t\t}\n\t\tfinally {\n\t\t\tthis.pendingRequests.delete(request.source);\n\t\t}\n\n\t\tif (\n\t\t\tresponse === undefined ||\n\t\t\trequest.tokenSource.token.isCancellationRequested ||\n\t\t\trequest.uri !== this.uri\n\t\t) {\n\t\t\tif (this.pendingRequests.size === 0 && this._pendingRefresh) {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst source = request.source;\n\n\t\tlet updated = false;\n\t\tconst timeline = this.timelinesBySource.get(source);\n\t\tif (timeline === undefined) {\n\t\t\tthis.timelinesBySource.set(source, new TimelineAggregate(response));\n\t\t\tupdated = true;\n\t\t}\n\t\telse {\n\t\t\tupdated = timeline.add(response, request.options);\n\t\t}\n\n\t\tif (updated) {\n\t\t\tthis._pendingRefresh = true;\n\n\t\t\t// If we have visible items already and there are other pending requests, debounce for a bit to wait for other requests\n\t\t\tif (this.hasVisibleItems && this.pendingRequests.size !== 0) {\n\t\t\t\tthis.refreshDebounced();\n\t\t\t} else {\n\t\t\t\tthis.refresh();\n\t\t\t}\n\t\t} else if (this.pendingRequests.size === 0) {\n\t\t\tif (this._pendingRefresh) {\n\t\t\t\tthis.refresh();\n\t\t\t} else {\n\t\t\t\tthis.tree.rerender();\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate *getItems(): Generator<ITreeElement<TreeElement>, any, any> {\n\t\tlet more = false;\n\n\t\tif (this.uri === undefined || this.timelinesBySource.size === 0) {\n\t\t\tthis._visibleItemCount = 0;\n\n\t\t\treturn;\n\t\t}\n\n\t\tconst maxCount = this._maxItemCount;\n\t\tlet count = 0;\n\n\t\tif (this.timelinesBySource.size === 1) {\n\t\t\tconst [source, timeline] = Iterable.first(this.timelinesBySource)!;\n\n\t\t\ttimeline.lastRenderedIndex = -1;\n\n\t\t\tif (this.excludedSources.has(source)) {\n\t\t\t\tthis._visibleItemCount = 0;\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (timeline.items.length !== 0) {\n\t\t\t\t// If we have any items, just say we have one for now -- the real count will be updated below\n\t\t\t\tthis._visibleItemCount = 1;\n\t\t\t}\n\n\t\t\tmore = timeline.more;\n\n\t\t\tlet lastRelativeTime: string | undefined;\n\t\t\tfor (const item of timeline.items) {\n\t\t\t\titem.relativeTime = undefined;\n\t\t\t\titem.hideRelativeTime = undefined;\n\n\t\t\t\tcount++;\n\t\t\t\tif (count > maxCount) {\n\t\t\t\t\tmore = true;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tlastRelativeTime = updateRelativeTime(item, lastRelativeTime);\n\t\t\t\tyield { element: item };\n\t\t\t}\n\n\t\t\ttimeline.lastRenderedIndex = count - 1;\n\t\t}\n\t\telse {\n\t\t\tconst sources: { timeline: TimelineAggregate; iterator: IterableIterator<TimelineItem>; nextItem: IteratorResult<TimelineItem, undefined> }[] = [];\n\n\t\t\tlet hasAnyItems = false;\n\t\t\tlet mostRecentEnd = 0;\n\n\t\t\tfor (const [source, timeline] of this.timelinesBySource) {\n\t\t\t\ttimeline.lastRenderedIndex = -1;\n\n\t\t\t\tif (this.excludedSources.has(source) || timeline.stale) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tif (timeline.items.length !== 0) {\n\t\t\t\t\thasAnyItems = true;\n\t\t\t\t}\n\n\t\t\t\tif (timeline.more) {\n\t\t\t\t\tmore = true;\n\n\t\t\t\t\tconst last = timeline.items[Math.min(maxCount, timeline.items.length - 1)];\n\t\t\t\t\tif (last.timestamp > mostRecentEnd) {\n\t\t\t\t\t\tmostRecentEnd = last.timestamp;\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\tconst iterator = timeline.items[Symbol.iterator]();\n\t\t\t\tsources.push({ timeline, iterator, nextItem: iterator.next() });\n\t\t\t}\n\n\t\t\tthis._visibleItemCount = hasAnyItems ? 1 : 0;\n\n\t\t\tfunction getNextMostRecentSource() {\n\t\t\t\treturn sources\n\t\t\t\t\t.filter(source => !source.nextItem.done)\n\t\t\t\t\t.reduce((previous, current) => (previous === undefined || current.nextItem.value!.timestamp >= previous.nextItem.value!.timestamp) ? current : previous, undefined!);\n\t\t\t}\n\n\t\t\tlet lastRelativeTime: string | undefined;\n\t\t\tlet nextSource;\n\t\t\twhile (nextSource = getNextMostRecentSource()) {\n\t\t\t\tnextSource.timeline.lastRenderedIndex++;\n\n\t\t\t\tconst item = nextSource.nextItem.value!;\n\t\t\t\titem.relativeTime = undefined;\n\t\t\t\titem.hideRelativeTime = undefined;\n\n\t\t\t\tif (item.timestamp >= mostRecentEnd) {\n\t\t\t\t\tcount++;\n\t\t\t\t\tif (count > maxCount) {\n\t\t\t\t\t\tmore = true;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\n\t\t\t\t\tlastRelativeTime = updateRelativeTime(item, lastRelativeTime);\n\t\t\t\t\tyield { element: item };\n\t\t\t\t}\n\n\t\t\t\tnextSource.nextItem = nextSource.iterator.next();\n\t\t\t}\n\t\t}\n\n\t\tthis._visibleItemCount = count;\n\t\tif (count > 0) {\n\t\t\tif (more) {\n\t\t\t\tyield {\n\t\t\t\t\telement: new LoadMoreCommand(this.pendingRequests.size !== 0)\n\t\t\t\t};\n\t\t\t} else if (this.pendingRequests.size !== 0) {\n\t\t\t\tyield {\n\t\t\t\t\telement: new LoadMoreCommand(true)\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate refresh() {\n\t\tif (!this.isBodyVisible()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tree.setChildren(null, this.getItems() as any);\n\t\tthis._isEmpty = !this.hasVisibleItems;\n\n\t\tif (this.uri === undefined) {\n\t\t\tthis.updateFilename(undefined);\n\t\t\tthis.message = localize('timeline.editorCannotProvideTimeline', \"The active editor cannot provide timeline information.\");\n\t\t} else if (this._isEmpty) {\n\t\t\tif (this.pendingRequests.size !== 0) {\n\t\t\t\tthis.setLoadingUriMessage();\n\t\t\t} else {\n\t\t\t\tthis.updateFilename(this.labelService.getUriBasenameLabel(this.uri));\n\t\t\t\tconst scmProviderCount = this.contextKeyService.getContextKeyValue<number>('scm.providerCount');\n\t\t\t\tif (this.timelineService.getSources().filter(({ id }) => !this.excludedSources.has(id)).length === 0) {\n\t\t\t\t\tthis.message = localize('timeline.noTimelineSourcesEnabled', \"All timeline sources have been filtered out.\");\n\t\t\t\t} else {\n\t\t\t\t\tif (this.configurationService.getValue('workbench.localHistory.enabled') && !this.excludedSources.has('timeline.localHistory')) {\n\t\t\t\t\t\tthis.message = localize('timeline.noLocalHistoryYet', \"Local History will track recent changes as you save them unless the file has been excluded or is too large.\");\n\t\t\t\t\t} else if (this.excludedSources.size > 0) {\n\t\t\t\t\t\tthis.message = localize('timeline.noTimelineInfoFromEnabledSources', \"No filtered timeline information was provided.\");\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.message = localize('timeline.noTimelineInfo', \"No timeline information was provided.\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif (!scmProviderCount || scmProviderCount === 0) {\n\t\t\t\t\tthis.message += ' ' + localize('timeline.noSCM', \"Source Control has not been configured.\");\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis.updateFilename(this.labelService.getUriBasenameLabel(this.uri));\n\t\t\tthis.message = undefined;\n\t\t}\n\n\t\tthis._pendingRefresh = false;\n\t}\n\n\t@debounce(500)\n\tprivate refreshDebounced() {\n\t\tthis.refresh();\n\t}\n\n\toverride focus(): void {\n\t\tsuper.focus();\n\t\tthis.tree.domFocus();\n\t}\n\n\toverride setExpanded(expanded: boolean): boolean {\n\t\tconst changed = super.setExpanded(expanded);\n\n\t\tif (changed && this.isBodyVisible()) {\n\t\t\tif (!this.followActiveEditor) {\n\t\t\t\tthis.setUriCore(this.uri, true);\n\t\t\t} else {\n\t\t\t\tthis.onActiveEditorChanged();\n\t\t\t}\n\t\t}\n\n\t\treturn changed;\n\t}\n\n\toverride setVisible(visible: boolean): void {\n\t\tif (visible) {\n\t\t\tthis.extensionService.activateByEvent('onView:timeline');\n\t\t\tthis.visibilityDisposables = new DisposableStore();\n\n\t\t\tthis.editorService.onDidActiveEditorChange(this.onActiveEditorChanged, this, this.visibilityDisposables);\n\t\t\t// Refresh the view on focus to update the relative timestamps\n\t\t\tthis.onDidFocus(() => this.refreshDebounced(), this, this.visibilityDisposables);\n\n\t\t\tsuper.setVisible(visible);\n\n\t\t\tthis.onActiveEditorChanged();\n\t\t} else {\n\t\t\tthis.visibilityDisposables?.dispose();\n\n\t\t\tsuper.setVisible(visible);\n\t\t}\n\t}\n\n\tprotected override layoutBody(height: number, width: number): void {\n\t\tsuper.layoutBody(height, width);\n\t\tthis.tree.layout(height, width);\n\t}\n\n\tprotected override renderHeaderTitle(container: HTMLElement): void {\n\t\tsuper.renderHeaderTitle(container, this.title);\n\n\t\tcontainer.classList.add('timeline-view');\n\t}\n\n\tprotected override renderBody(container: HTMLElement): void {\n\t\tsuper.renderBody(container);\n\n\t\tthis.$container = container;\n\t\tcontainer.classList.add('tree-explorer-viewlet-tree-view', 'timeline-tree-view');\n\n\t\tthis.$message = DOM.append(this.$container, DOM.$('.message'));\n\t\tthis.$message.classList.add('timeline-subtle');\n\n\t\tthis.message = localize('timeline.editorCannotProvideTimeline', \"The active editor cannot provide timeline information.\");\n\n\t\tthis.$tree = document.createElement('div');\n\t\tthis.$tree.classList.add('customview-tree', 'file-icon-themable-tree', 'hide-arrows');\n\t\t// this.treeElement.classList.add('show-file-icons');\n\t\tcontainer.appendChild(this.$tree);\n\n\t\tthis.treeRenderer = this.instantiationService.createInstance(TimelineTreeRenderer, this.commands);\n\t\tthis.treeRenderer.onDidScrollToEnd(item => {\n\t\t\tif (this.pageOnScroll) {\n\t\t\t\tthis.loadMore(item);\n\t\t\t}\n\t\t});\n\n\t\tthis.tree = <WorkbenchObjectTree<TreeElement, FuzzyScore>>this.instantiationService.createInstance(WorkbenchObjectTree, 'TimelinePane',\n\t\t\tthis.$tree, new TimelineListVirtualDelegate(), [this.treeRenderer], {\n\t\t\tidentityProvider: new TimelineIdentityProvider(),\n\t\t\taccessibilityProvider: {\n\t\t\t\tgetAriaLabel(element: TreeElement): string {\n\t\t\t\t\tif (isLoadMoreCommand(element)) {\n\t\t\t\t\t\treturn element.ariaLabel;\n\t\t\t\t\t}\n\t\t\t\t\treturn element.accessibilityInformation ? element.accessibilityInformation.label : localize('timeline.aria.item', \"{0}: {1}\", element.relativeTimeFullWord ?? '', element.label);\n\t\t\t\t},\n\t\t\t\tgetRole(element: TreeElement): AriaRole {\n\t\t\t\t\tif (isLoadMoreCommand(element)) {\n\t\t\t\t\t\treturn 'treeitem';\n\t\t\t\t\t}\n\t\t\t\t\treturn element.accessibilityInformation && element.accessibilityInformation.role ? element.accessibilityInformation.role : 'treeitem';\n\t\t\t\t},\n\t\t\t\tgetWidgetAriaLabel(): string {\n\t\t\t\t\treturn localize('timeline', \"Timeline\");\n\t\t\t\t}\n\t\t\t},\n\t\t\tkeyboardNavigationLabelProvider: new TimelineKeyboardNavigationLabelProvider(),\n\t\t\tmultipleSelectionSupport: false,\n\t\t\toverrideStyles: this.getLocationBasedColors().listOverrideStyles,\n\t\t});\n\n\t\tthis._register(this.tree.onContextMenu(e => this.onContextMenu(this.commands, e)));\n\t\tthis._register(this.tree.onDidChangeSelection(e => this.ensureValidItems()));\n\t\tthis._register(this.tree.onDidOpen(e => {\n\t\t\tif (!e.browserEvent || !this.ensureValidItems()) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst selection = this.tree.getSelection();\n\t\t\tlet item;\n\t\t\tif (selection.length === 1) {\n\t\t\t\titem = selection[0];\n\t\t\t}\n\n\t\t\tif (item === null) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (isTimelineItem(item)) {\n\t\t\t\tif (item.command) {\n\t\t\t\t\tlet args = item.command.arguments ?? [];\n\t\t\t\t\tif (item.command.id === API_OPEN_EDITOR_COMMAND_ID || item.command.id === API_OPEN_DIFF_EDITOR_COMMAND_ID) {\n\t\t\t\t\t\t// Some commands owned by us should receive the\n\t\t\t\t\t\t// `IOpenEvent` as context to open properly\n\t\t\t\t\t\targs = [...args, e];\n\t\t\t\t\t}\n\n\t\t\t\t\tthis.commandService.executeCommand(item.command.id, ...args);\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if (isLoadMoreCommand(item)) {\n\t\t\t\tthis.loadMore(item);\n\t\t\t}\n\t\t}));\n\t}\n\n\tprivate loadMore(item: LoadMoreCommand) {\n\t\tif (item.loading) {\n\t\t\treturn;\n\t\t}\n\n\t\titem.loading = true;\n\t\tthis.tree.rerender(item);\n\n\t\tif (this.pendingRequests.size !== 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis._maxItemCount = this._visibleItemCount + this.pageSize;\n\t\tthis.loadTimeline(false);\n\t}\n\n\tensureValidItems() {\n\t\t// If we don't have any non-excluded timelines, clear the tree and show the loading message\n\t\tif (!this.hasVisibleItems || !this.timelineService.getSources().some(({ id }) => !this.excludedSources.has(id) && this.timelinesBySource.has(id))) {\n\t\t\tthis.tree.setChildren(null, undefined);\n\t\t\tthis._isEmpty = true;\n\n\t\t\tthis.setLoadingUriMessage();\n\n\t\t\treturn false;\n\t\t}\n\n\t\treturn true;\n\t}\n\n\tsetLoadingUriMessage() {\n\t\tconst file = this.uri && this.labelService.getUriBasenameLabel(this.uri);\n\t\tthis.updateFilename(file);\n\t\tthis.message = file ? localize('timeline.loading', \"Loading timeline for {0}...\", file) : '';\n\t}\n\n\tprivate onContextMenu(commands: TimelinePaneCommands, treeEvent: ITreeContextMenuEvent<TreeElement | null>): void {\n\t\tconst item = treeEvent.element;\n\t\tif (item === null) {\n\t\t\treturn;\n\t\t}\n\t\tconst event: UIEvent = treeEvent.browserEvent;\n\n\t\tevent.preventDefault();\n\t\tevent.stopPropagation();\n\n\t\tif (!this.ensureValidItems()) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.tree.setFocus([item]);\n\t\tconst actions = commands.getItemContextActions(item);\n\t\tif (!actions.length) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.contextMenuService.showContextMenu({\n\t\t\tgetAnchor: () => treeEvent.anchor,\n\t\t\tgetActions: () => actions,\n\t\t\tgetActionViewItem: (action) => {\n\t\t\t\tconst keybinding = this.keybindingService.lookupKeybinding(action.id);\n\t\t\t\tif (keybinding) {\n\t\t\t\t\treturn new ActionViewItem(action, action, { label: true, keybinding: keybinding.getLabel() });\n\t\t\t\t}\n\t\t\t\treturn undefined;\n\t\t\t},\n\t\t\tonHide: (wasCancelled?: boolean) => {\n\t\t\t\tif (wasCancelled) {\n\t\t\t\t\tthis.tree.domFocus();\n\t\t\t\t}\n\t\t\t},\n\t\t\tgetActionsContext: (): TimelineActionContext => ({ uri: this.uri, item }),\n\t\t\tactionRunner: new TimelineActionRunner()\n\t\t});\n\t}\n}\n\nclass TimelineElementTemplate implements IDisposable {\n\tstatic readonly id = 'TimelineElementTemplate';\n\n\treadonly actionBar: ActionBar;\n\treadonly icon: HTMLElement;\n\treadonly iconLabel: IconLabel;\n\treadonly timestamp: HTMLSpanElement;\n\n\tconstructor(\n\t\tcontainer: HTMLElement,\n\t\tactionViewItemProvider: IActionViewItemProvider,\n\t\thoverDelegate: IHoverDelegate,\n\t) {\n\t\tcontainer.classList.add('custom-view-tree-node-item');\n\t\tthis.icon = DOM.append(container, DOM.$('.custom-view-tree-node-item-icon'));\n\n\t\tthis.iconLabel = new IconLabel(container, { supportHighlights: true, supportIcons: true, hoverDelegate });\n\n\t\tconst timestampContainer = DOM.append(this.iconLabel.element, DOM.$('.timeline-timestamp-container'));\n\t\tthis.timestamp = DOM.append(timestampContainer, DOM.$('span.timeline-timestamp'));\n\n\t\tconst actionsContainer = DOM.append(this.iconLabel.element, DOM.$('.actions'));\n\t\tthis.actionBar = new ActionBar(actionsContainer, { actionViewItemProvider });\n\t}\n\n\tdispose() {\n\t\tthis.iconLabel.dispose();\n\t\tthis.actionBar.dispose();\n\t}\n\n\treset() {\n\t\tthis.icon.className = '';\n\t\tthis.icon.style.backgroundImage = '';\n\t\tthis.actionBar.clear();\n\t}\n}\n\nexport class TimelineIdentityProvider implements IIdentityProvider<TreeElement> {\n\tgetId(item: TreeElement): { toString(): string } {\n\t\treturn item.handle;\n\t}\n}\n\nclass TimelineActionRunner extends ActionRunner {\n\n\tprotected override async runAction(action: IAction, { uri, item }: TimelineActionContext): Promise<void> {\n\t\tif (!isTimelineItem(item)) {\n\t\t\t// TODO@eamodio do we need to do anything else?\n\t\t\tawait action.run();\n\t\t\treturn;\n\t\t}\n\n\t\tawait action.run(\n\t\t\t{\n\t\t\t\t$mid: MarshalledId.TimelineActionContext,\n\t\t\t\thandle: item.handle,\n\t\t\t\tsource: item.source,\n\t\t\t\turi\n\t\t\t},\n\t\t\turi,\n\t\t\titem.source,\n\t\t);\n\t}\n}\n\nexport class TimelineKeyboardNavigationLabelProvider implements IKeyboardNavigationLabelProvider<TreeElement> {\n\tgetKeyboardNavigationLabel(element: TreeElement): { toString(): string } {\n\t\treturn element.label;\n\t}\n}\n\nexport class TimelineListVirtualDelegate implements IListVirtualDelegate<TreeElement> {\n\tgetHeight(_element: TreeElement): number {\n\t\treturn ItemHeight;\n\t}\n\n\tgetTemplateId(element: TreeElement): string {\n\t\treturn TimelineElementTemplate.id;\n\t}\n}\n\nclass TimelineTreeRenderer implements ITreeRenderer<TreeElement, FuzzyScore, TimelineElementTemplate> {\n\tprivate readonly _onDidScrollToEnd = new Emitter<LoadMoreCommand>();\n\treadonly onDidScrollToEnd: Event<LoadMoreCommand> = this._onDidScrollToEnd.event;\n\n\treadonly templateId: string = TimelineElementTemplate.id;\n\n\tprivate _hoverDelegate: IHoverDelegate;\n\n\tprivate actionViewItemProvider: IActionViewItemProvider;\n\n\tconstructor(\n\t\tprivate readonly commands: TimelinePaneCommands,\n\t\t@IInstantiationService protected readonly instantiationService: IInstantiationService,\n\t\t@IThemeService private themeService: IThemeService,\n\t) {\n\t\tthis.actionViewItemProvider = createActionViewItem.bind(undefined, this.instantiationService);\n\t\tthis._hoverDelegate = getDefaultHoverDelegate('mouse');\n\t}\n\n\tprivate uri: URI | undefined;\n\tsetUri(uri: URI | undefined) {\n\t\tthis.uri = uri;\n\t}\n\n\trenderTemplate(container: HTMLElement): TimelineElementTemplate {\n\t\treturn new TimelineElementTemplate(container, this.actionViewItemProvider, this._hoverDelegate);\n\t}\n\n\trenderElement(\n\t\tnode: ITreeNode<TreeElement, FuzzyScore>,\n\t\tindex: number,\n\t\ttemplate: TimelineElementTemplate,\n\t\theight: number | undefined\n\t): void {\n\t\ttemplate.reset();\n\n\t\tconst { element: item } = node;\n\n\t\tconst theme = this.themeService.getColorTheme();\n\t\tconst icon = theme.type === ColorScheme.LIGHT ? item.icon : item.iconDark;\n\t\tconst iconUrl = icon ? URI.revive(icon) : null;\n\n\t\tif (iconUrl) {\n\t\t\ttemplate.icon.className = 'custom-view-tree-node-item-icon';\n\t\t\ttemplate.icon.style.backgroundImage = DOM.asCSSUrl(iconUrl);\n\t\t\ttemplate.icon.style.color = '';\n\t\t} else if (item.themeIcon) {\n\t\t\ttemplate.icon.className = `custom-view-tree-node-item-icon ${ThemeIcon.asClassName(item.themeIcon)}`;\n\t\t\tif (item.themeIcon.color) {\n\t\t\t\ttemplate.icon.style.color = theme.getColor(item.themeIcon.color.id)?.toString() ?? '';\n\t\t\t} else {\n\t\t\t\ttemplate.icon.style.color = '';\n\t\t\t}\n\t\t\ttemplate.icon.style.backgroundImage = '';\n\t\t} else {\n\t\t\ttemplate.icon.className = 'custom-view-tree-node-item-icon';\n\t\t\ttemplate.icon.style.backgroundImage = '';\n\t\t\ttemplate.icon.style.color = '';\n\t\t}\n\t\tconst tooltip = item.tooltip\n\t\t\t? isString(item.tooltip)\n\t\t\t\t? item.tooltip\n\t\t\t\t: { markdown: item.tooltip, markdownNotSupportedFallback: renderMarkdownAsPlaintext(item.tooltip) }\n\t\t\t: undefined;\n\n\t\ttemplate.iconLabel.setLabel(item.label, item.description, {\n\t\t\ttitle: tooltip,\n\t\t\tmatches: createMatches(node.filterData)\n\t\t});\n\n\t\ttemplate.timestamp.textContent = item.relativeTime ?? '';\n\t\ttemplate.timestamp.ariaLabel = item.relativeTimeFullWord ?? '';\n\t\ttemplate.timestamp.parentElement!.classList.toggle('timeline-timestamp--duplicate', isTimelineItem(item) && item.hideRelativeTime);\n\n\t\ttemplate.actionBar.context = { uri: this.uri, item } satisfies TimelineActionContext;\n\t\ttemplate.actionBar.actionRunner = new TimelineActionRunner();\n\t\ttemplate.actionBar.push(this.commands.getItemActions(item), { icon: true, label: false });\n\n\t\t// If we are rendering the load more item, we've scrolled to the end, so trigger an event\n\t\tif (isLoadMoreCommand(item)) {\n\t\t\tsetTimeout(() => this._onDidScrollToEnd.fire(item), 0);\n\t\t}\n\t}\n\n\tdisposeTemplate(template: TimelineElementTemplate): void {\n\t\ttemplate.dispose();\n\t}\n}\n\n\nconst timelineRefresh = registerIcon('timeline-refresh', Codicon.refresh, localize('timelineRefresh', 'Icon for the refresh timeline action.'));\nconst timelinePin = registerIcon('timeline-pin', Codicon.pin, localize('timelinePin', 'Icon for the pin timeline action.'));\nconst timelineUnpin = registerIcon('timeline-unpin', Codicon.pinned, localize('timelineUnpin', 'Icon for the unpin timeline action.'));\n\nclass TimelinePaneCommands extends Disposable {\n\tprivate readonly sourceDisposables: DisposableStore;\n\n\tconstructor(\n\t\tprivate readonly pane: TimelinePane,\n\t\t@ITimelineService private readonly timelineService: ITimelineService,\n\t\t@IStorageService private readonly storageService: IStorageService,\n\t\t@IContextKeyService private readonly contextKeyService: IContextKeyService,\n\t\t@IMenuService private readonly menuService: IMenuService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(this.sourceDisposables = new DisposableStore());\n\n\t\tthis._register(registerAction2(class extends Action2 {\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: 'timeline.refresh',\n\t\t\t\t\ttitle: localize2('refresh', \"Refresh\"),\n\t\t\t\t\ticon: timelineRefresh,\n\t\t\t\t\tcategory: localize2('timeline', \"Timeline\"),\n\t\t\t\t\tmenu: {\n\t\t\t\t\t\tid: MenuId.TimelineTitle,\n\t\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t\torder: 99,\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\t\tpane.reset();\n\t\t\t}\n\t\t}));\n\n\t\tthis._register(CommandsRegistry.registerCommand('timeline.toggleFollowActiveEditor',\n\t\t\t(accessor: ServicesAccessor, ...args: any[]) => pane.followActiveEditor = !pane.followActiveEditor\n\t\t));\n\n\t\tthis._register(MenuRegistry.appendMenuItem(MenuId.TimelineTitle, ({\n\t\t\tcommand: {\n\t\t\t\tid: 'timeline.toggleFollowActiveEditor',\n\t\t\t\ttitle: localize2('timeline.toggleFollowActiveEditorCommand.follow', 'Pin the Current Timeline'),\n\t\t\t\ticon: timelinePin,\n\t\t\t\tcategory: localize2('timeline', \"Timeline\"),\n\t\t\t},\n\t\t\tgroup: 'navigation',\n\t\t\torder: 98,\n\t\t\twhen: TimelineFollowActiveEditorContext\n\t\t})));\n\n\t\tthis._register(MenuRegistry.appendMenuItem(MenuId.TimelineTitle, ({\n\t\t\tcommand: {\n\t\t\t\tid: 'timeline.toggleFollowActiveEditor',\n\t\t\t\ttitle: localize2('timeline.toggleFollowActiveEditorCommand.unfollow', 'Unpin the Current Timeline'),\n\t\t\t\ticon: timelineUnpin,\n\t\t\t\tcategory: localize2('timeline', \"Timeline\"),\n\t\t\t},\n\t\t\tgroup: 'navigation',\n\t\t\torder: 98,\n\t\t\twhen: TimelineFollowActiveEditorContext.toNegated()\n\t\t})));\n\n\t\tthis._register(timelineService.onDidChangeProviders(() => this.updateTimelineSourceFilters()));\n\t\tthis.updateTimelineSourceFilters();\n\t}\n\n\tgetItemActions(element: TreeElement): IAction[] {\n\t\treturn this.getActions(MenuId.TimelineItemContext, { key: 'timelineItem', value: element.contextValue }).primary;\n\t}\n\n\tgetItemContextActions(element: TreeElement): IAction[] {\n\t\treturn this.getActions(MenuId.TimelineItemContext, { key: 'timelineItem', value: element.contextValue }).secondary;\n\t}\n\n\tprivate getActions(menuId: MenuId, context: { key: string; value?: string }): { primary: IAction[]; secondary: IAction[] } {\n\t\tconst contextKeyService = this.contextKeyService.createOverlay([\n\t\t\t['view', this.pane.id],\n\t\t\t[context.key, context.value],\n\t\t]);\n\n\t\tconst menu = this.menuService.getMenuActions(menuId, contextKeyService, { shouldForwardArgs: true });\n\t\tconst primary: IAction[] = [];\n\t\tconst secondary: IAction[] = [];\n\t\tconst result = { primary, secondary };\n\t\tcreateAndFillInContextMenuActions(menu, result, 'inline');\n\n\t\treturn result;\n\t}\n\n\tprivate updateTimelineSourceFilters() {\n\t\tthis.sourceDisposables.clear();\n\n\t\tconst excluded = new Set(JSON.parse(this.storageService.get('timeline.excludeSources', StorageScope.PROFILE, '[]')));\n\t\tfor (const source of this.timelineService.getSources()) {\n\t\t\tthis.sourceDisposables.add(registerAction2(class extends Action2 {\n\t\t\t\tconstructor() {\n\t\t\t\t\tsuper({\n\t\t\t\t\t\tid: `timeline.toggleExcludeSource:${source.id}`,\n\t\t\t\t\t\ttitle: source.label,\n\t\t\t\t\t\tmenu: {\n\t\t\t\t\t\t\tid: MenuId.TimelineFilterSubMenu,\n\t\t\t\t\t\t\tgroup: 'navigation',\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoggled: ContextKeyExpr.regex(`timelineExcludeSources`, new RegExp(`\\\\b${escapeRegExpCharacters(source.id)}\\\\b`)).negate()\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\trun(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\t\t\tif (excluded.has(source.id)) {\n\t\t\t\t\t\texcluded.delete(source.id);\n\t\t\t\t\t} else {\n\t\t\t\t\t\texcluded.add(source.id);\n\t\t\t\t\t}\n\n\t\t\t\t\tconst storageService = accessor.get(IStorageService);\n\t\t\t\t\tstorageService.store('timeline.excludeSources', JSON.stringify([...excluded.keys()]), StorageScope.PROFILE, StorageTarget.USER);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["item", "getNextMostRecentSource"]
}
