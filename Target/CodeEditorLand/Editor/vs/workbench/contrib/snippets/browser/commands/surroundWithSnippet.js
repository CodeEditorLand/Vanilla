import"../../../../../editor/browser/editorBrowser.js";import"../../../../../editor/common/core/position.js";import{EditorContextKeys as a}from"../../../../../editor/common/editorContextKeys.js";import"../../../../../editor/common/model.js";import{SnippetController2 as l}from"../../../../../editor/contrib/snippet/browser/snippetController2.js";import{localize2 as d}from"../../../../../nls.js";import{IClipboardService as S}from"../../../../../platform/clipboard/common/clipboardService.js";import{ContextKeyExpr as u}from"../../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as f}from"../../../../../platform/instantiation/common/instantiation.js";import{pickSnippet as g}from"../snippetPicker.js";import{ISnippetsService as I}from"../snippets.js";import"../snippetsFile.js";import{SnippetEditorAction as x}from"./abstractSnippetsActions.js";async function v(m,e,t,p){const{lineNumber:i,column:s}=t;e.tokenization.tokenizeIfCheap(i);const n=e.getLanguageIdAtPosition(i,s);return(await m.getSnippets(n,{includeNoPrefixSnippets:!0,includeDisabledSnippets:p})).filter(r=>r.usesSelection)}class c extends x{static options={id:"editor.action.surroundWithSnippet",title:d("label","Surround with Snippet...")};constructor(){super({...c.options,precondition:u.and(a.writable,a.hasNonEmptySelection),f1:!0})}async runEditorCommand(e,t){if(!t.hasModel())return;const p=e.get(f),i=e.get(I),s=e.get(S),n=await v(i,t.getModel(),t.getPosition(),!0);if(!n.length)return;const o=await p.invokeFunction(g,n);if(!o)return;let r;o.needsClipboard&&(r=await s.readText()),t.focus(),l.get(t)?.insert(o.codeSnippet,{clipboardText:r}),i.updateUsageTimestamp(o)}}export{c as SurroundWithSnippetEditorAction,v as getSurroundableSnippets};
