var C=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var m=(s,t,e,o)=>{for(var i=o>1?void 0:o?A(t,e):t,n=s.length-1,r;n>=0;n--)(r=s[n])&&(i=(o?r(t,e,i):r(i))||i);return o&&i&&C(t,e,i),i},c=(s,t)=>(e,o)=>t(e,o,s);import{DisposableStore as f}from"../../../../base/common/lifecycle.js";import{Selection as _}from"../../../../editor/common/core/selection.js";import{ILanguageFeaturesService as h}from"../../../../editor/common/services/languageFeatures.js";import{CodeActionKind as d}from"../../../../editor/contrib/codeAction/common/types.js";import{localize as l}from"../../../../nls.js";import{IConfigurationService as y}from"../../../../platform/configuration/common/configuration.js";import{IInstantiationService as b}from"../../../../platform/instantiation/common/instantiation.js";import{ApplyFileSnippetAction as k}from"./commands/fileTemplateSnippets.js";import{SurroundWithSnippetEditorAction as I,getSurroundableSnippets as w}from"./commands/surroundWithSnippet.js";import{ISnippetsService as g}from"./snippets.js";let a=class{constructor(t){this._snippetService=t}static _MAX_CODE_ACTIONS=4;static _overflowCommandCodeAction={kind:d.SurroundWith.value,title:l("more","More..."),command:{id:I.options.id,title:I.options.title.value}};async provideCodeActions(t,e){if(e.isEmpty())return;const o=_.isISelection(e)?e.getPosition():e.getStartPosition(),i=await w(this._snippetService,t,o,!1);if(!i.length)return;const n=[];for(const r of i){if(n.length>=a._MAX_CODE_ACTIONS){n.push(a._overflowCommandCodeAction);break}n.push({title:l("codeAction","{0}",r.name),kind:d.SurroundWith.value,edit:S(t,e,r)})}return{actions:n,dispose(){}}}};a=m([c(0,g)],a);let p=class{constructor(t){this._snippetService=t}static _MAX_CODE_ACTIONS=4;static _overflowCommandCodeAction={title:l("overflow.start.title","Start with Snippet"),kind:d.SurroundWith.value,command:{id:k.Id,title:""}};providedCodeActionKinds=[d.SurroundWith.value];async provideCodeActions(t){if(t.getValueLength()!==0)return;const e=await this._snippetService.getSnippets(t.getLanguageId(),{fileTemplateSnippets:!0,includeNoPrefixSnippets:!0}),o=[];for(const i of e){if(o.length>=p._MAX_CODE_ACTIONS){o.push(p._overflowCommandCodeAction);break}o.push({title:l("title","Start with: {0}",i.name),kind:d.SurroundWith.value,edit:S(t,t.getFullModelRange(),i)})}return{actions:o,dispose(){}}}};p=m([c(0,g)],p);function S(s,t,e){return{edits:[{versionId:s.getVersionId(),resource:s.uri,textEdit:{range:t,text:e.body,insertAsSnippet:!0}}]}}let u=class{_store=new f;constructor(t,e,o){const i="editor.snippets.codeActions.enabled",n=new f,r=()=>{n.clear(),o.getValue(i)&&(n.add(e.codeActionProvider.register("*",t.createInstance(a))),n.add(e.codeActionProvider.register("*",t.createInstance(p))))};r(),this._store.add(o.onDidChangeConfiguration(v=>v.affectsConfiguration(i)&&r())),this._store.add(n)}dispose(){this._store.dispose()}};u=m([c(0,b),c(1,h),c(2,y)],u);export{u as SnippetCodeActions};
