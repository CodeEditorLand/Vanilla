import{groupBy as g,isFalsyOrEmpty as u}from"../../../../../base/common/arrays.js";import{compare as d}from"../../../../../base/common/strings.js";import{getCodeEditor as m}from"../../../../../editor/browser/editorBrowser.js";import{ILanguageService as f}from"../../../../../editor/common/languages/language.js";import{SnippetController2 as S}from"../../../../../editor/contrib/snippet/browser/snippetController2.js";import{localize as I,localize2 as k}from"../../../../../nls.js";import"../../../../../platform/instantiation/common/instantiation.js";import{IQuickInputService as v}from"../../../../../platform/quickinput/common/quickInput.js";import{SnippetsAction as h}from"./abstractSnippetsActions.js";import{ISnippetsService as y}from"../snippets.js";import"../snippetsFile.js";import{IEditorService as L}from"../../../../services/editor/common/editorService.js";class l extends h{static Id="workbench.action.populateFileFromSnippet";constructor(){super({id:l.Id,title:k("label","Fill File with Snippet"),f1:!0})}async run(i){const a=i.get(y),c=i.get(v),o=i.get(L),p=i.get(f),t=m(o.activeTextEditorControl);if(!t||!t.hasModel())return;const s=await a.getSnippets(void 0,{fileTemplateSnippets:!0,noRecencySort:!0,includeNoPrefixSnippets:!0});if(s.length===0)return;const e=await this._pick(c,p,s);e&&t.hasModel()&&(S.get(t)?.apply([{range:t.getModel().getFullModelRange(),template:e.snippet.body}]),t.getModel().setLanguage(p.createById(e.langId),l.Id),t.focus())}async _pick(i,a,c){const o=[];for(const e of c)if(u(e.scopes))o.push({langId:"",snippet:e});else for(const n of e.scopes)o.push({langId:n,snippet:e});const p=[],t=g(o,(e,n)=>d(e.langId,n.langId));for(const e of t){let n=!0;for(const r of e)n&&(p.push({type:"separator",label:a.getLanguageName(r.langId)??r.langId}),n=!1),p.push({snippet:r,label:r.snippet.prefix||r.snippet.name,detail:r.snippet.description})}return(await i.pick(p,{placeHolder:I("placeholder","Select a snippet"),matchOnDetail:!0}))?.snippet}}export{l as ApplyFileSnippetAction};
