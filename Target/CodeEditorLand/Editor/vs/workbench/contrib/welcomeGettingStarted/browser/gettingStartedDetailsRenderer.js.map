{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/welcomeGettingStarted/browser/gettingStartedDetailsRenderer.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { generateUuid } from '../../../../base/common/uuid.js';\nimport { generateTokensCSSForColorMap } from '../../../../editor/common/languages/supports/tokenization.js';\nimport { TokenizationRegistry } from '../../../../editor/common/languages.js';\nimport { DEFAULT_MARKDOWN_STYLES, renderMarkdownDocument } from '../../markdown/browser/markdownDocumentRenderer.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { language } from '../../../../base/common/platform.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { assertIsDefined } from '../../../../base/common/types.js';\nimport { asWebviewUri } from '../../webview/common/webview.js';\nimport { ResourceMap } from '../../../../base/common/map.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { INotificationService } from '../../../../platform/notification/common/notification.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { gettingStartedContentRegistry } from '../common/gettingStartedContent.js';\n\n\nexport class GettingStartedDetailsRenderer {\n\tprivate mdCache = new ResourceMap<string>();\n\tprivate svgCache = new ResourceMap<string>();\n\n\tconstructor(\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@INotificationService private readonly notificationService: INotificationService,\n\t\t@IExtensionService private readonly extensionService: IExtensionService,\n\t\t@ILanguageService private readonly languageService: ILanguageService,\n\t) { }\n\n\tasync renderMarkdown(path: URI, base: URI): Promise<string> {\n\t\tconst content = await this.readAndCacheStepMarkdown(path, base);\n\t\tconst nonce = generateUuid();\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\n\t\tconst css = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\n\t\tconst inDev = document.location.protocol === 'http:';\n\t\tconst imgSrcCsp = inDev ? 'img-src https: data: http:' : 'img-src https: data:';\n\n\t\treturn `<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; ${imgSrcCsp}; media-src https:; script-src 'nonce-${nonce}'; style-src 'nonce-${nonce}';\">\n\t\t\t\t<style nonce=\"${nonce}\">\n\t\t\t\t\t${DEFAULT_MARKDOWN_STYLES}\n\t\t\t\t\t${css}\n\t\t\t\t\tbody > img {\n\t\t\t\t\t\talign-self: flex-start;\n\t\t\t\t\t}\n\t\t\t\t\tbody > img[centered] {\n\t\t\t\t\t\talign-self: center;\n\t\t\t\t\t}\n\t\t\t\t\tbody {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\tpadding: 0;\n\t\t\t\t\t\theight: inherit;\n\t\t\t\t\t}\n\t\t\t\t\t.theme-picker-row {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tgap: 32px;\n\t\t\t\t\t}\n\t\t\t\t\tchecklist {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tgap: 32px;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t}\n\t\t\t\t\tcheckbox {\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t\talign-items: center;\n\t\t\t\t\t\tmargin: 5px;\n\t\t\t\t\t\tcursor: pointer;\n\t\t\t\t\t}\n\t\t\t\t\tcheckbox > img {\n\t\t\t\t\t\tmargin-bottom: 8px !important;\n\t\t\t\t\t}\n\t\t\t\t\tcheckbox.checked > img {\n\t\t\t\t\t\tbox-sizing: border-box;\n\t\t\t\t\t}\n\t\t\t\t\tcheckbox.checked > img {\n\t\t\t\t\t\toutline: 2px solid var(--vscode-focusBorder);\n\t\t\t\t\t\toutline-offset: 4px;\n\t\t\t\t\t\tborder-radius: 4px;\n\t\t\t\t\t}\n\t\t\t\t\t.theme-picker-link {\n\t\t\t\t\t\tmargin-top: 16px;\n\t\t\t\t\t\tcolor: var(--vscode-textLink-foreground);\n\t\t\t\t\t}\n\t\t\t\t\tblockquote > p:first-child {\n\t\t\t\t\t\tmargin-top: 0;\n\t\t\t\t\t}\n\t\t\t\t\tbody > * {\n\t\t\t\t\t\tmargin-block-end: 0.25em;\n\t\t\t\t\t\tmargin-block-start: 0.25em;\n\t\t\t\t\t}\n\t\t\t\t\tvertically-centered {\n\t\t\t\t\t\tpadding-top: 5px;\n\t\t\t\t\t\tpadding-bottom: 5px;\n\t\t\t\t\t\tdisplay: flex;\n\t\t\t\t\t\tjustify-content: center;\n\t\t\t\t\t\tflex-direction: column;\n\t\t\t\t\t}\n\t\t\t\t\thtml {\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\tpadding-right: 32px;\n\t\t\t\t\t}\n\t\t\t\t\th1 {\n\t\t\t\t\t\tfont-size: 19.5px;\n\t\t\t\t\t}\n\t\t\t\t\th2 {\n\t\t\t\t\t\tfont-size: 18.5px;\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t<vertically-centered>\n\t\t\t\t\t${content}\n\t\t\t\t</vertically-centered>\n\t\t\t</body>\n\t\t\t<script nonce=\"${nonce}\">\n\t\t\t\tconst vscode = acquireVsCodeApi();\n\n\t\t\t\tdocument.querySelectorAll('[when-checked]').forEach(el => {\n\t\t\t\t\tel.addEventListener('click', () => {\n\t\t\t\t\t\tvscode.postMessage(el.getAttribute('when-checked'));\n\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\tlet ongoingLayout = undefined;\n\t\t\t\tconst doLayout = () => {\n\t\t\t\t\tdocument.querySelectorAll('vertically-centered').forEach(element => {\n\t\t\t\t\t\telement.style.marginTop = Math.max((document.body.clientHeight - element.scrollHeight) * 3/10, 0) + 'px';\n\t\t\t\t\t});\n\t\t\t\t\tongoingLayout = undefined;\n\t\t\t\t};\n\n\t\t\t\tconst layout = () => {\n\t\t\t\t\tif (ongoingLayout) {\n\t\t\t\t\t\tclearTimeout(ongoingLayout);\n\t\t\t\t\t}\n\t\t\t\t\tongoingLayout = setTimeout(doLayout, 0);\n\t\t\t\t};\n\n\t\t\t\tlayout();\n\n\t\t\t\tdocument.querySelectorAll('img').forEach(element => {\n\t\t\t\t\telement.onload = layout;\n\t\t\t\t})\n\n\t\t\t\twindow.addEventListener('message', event => {\n\t\t\t\t\tif (event.data.layoutMeNow) {\n\t\t\t\t\t\tlayout();\n\t\t\t\t\t}\n\t\t\t\t\tif (event.data.enabledContextKeys) {\n\t\t\t\t\t\tdocument.querySelectorAll('.checked').forEach(element => element.classList.remove('checked'))\n\t\t\t\t\t\tfor (const key of event.data.enabledContextKeys) {\n\t\t\t\t\t\t\tdocument.querySelectorAll('[checked-on=\"' + key + '\"]').forEach(element => element.classList.add('checked'))\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t</script>\n\t\t</html>`;\n\t}\n\n\tasync renderSVG(path: URI): Promise<string> {\n\t\tconst content = await this.readAndCacheSVGFile(path);\n\t\tconst nonce = generateUuid();\n\t\tconst colorMap = TokenizationRegistry.getColorMap();\n\n\t\tconst css = colorMap ? generateTokensCSSForColorMap(colorMap) : '';\n\t\treturn `<!DOCTYPE html>\n\t\t<html>\n\t\t\t<head>\n\t\t\t\t<meta http-equiv=\"Content-type\" content=\"text/html;charset=UTF-8\">\n\t\t\t\t<meta http-equiv=\"Content-Security-Policy\" content=\"default-src 'none'; img-src data:; style-src 'nonce-${nonce}';\">\n\t\t\t\t<style nonce=\"${nonce}\">\n\t\t\t\t\t${DEFAULT_MARKDOWN_STYLES}\n\t\t\t\t\t${css}\n\t\t\t\t\tsvg {\n\t\t\t\t\t\tposition: fixed;\n\t\t\t\t\t\theight: 100%;\n\t\t\t\t\t\twidth: 80%;\n\t\t\t\t\t\tleft: 50%;\n\t\t\t\t\t\ttop: 50%;\n\t\t\t\t\t\tmax-width: 530px;\n\t\t\t\t\t\tmin-width: 350px;\n\t\t\t\t\t\ttransform: translate(-50%,-50%);\n\t\t\t\t\t}\n\t\t\t\t</style>\n\t\t\t</head>\n\t\t\t<body>\n\t\t\t\t${content}\n\t\t\t</body>\n\t\t</html>`;\n\t}\n\n\tprivate async readAndCacheSVGFile(path: URI): Promise<string> {\n\t\tif (!this.svgCache.has(path)) {\n\t\t\tconst contents = await this.readContentsOfPath(path, false);\n\t\t\tthis.svgCache.set(path, contents);\n\t\t}\n\t\treturn assertIsDefined(this.svgCache.get(path));\n\t}\n\n\tprivate async readAndCacheStepMarkdown(path: URI, base: URI): Promise<string> {\n\t\tif (!this.mdCache.has(path)) {\n\t\t\tconst contents = await this.readContentsOfPath(path);\n\t\t\tconst markdownContents = await renderMarkdownDocument(transformUris(contents, base), this.extensionService, this.languageService, { allowUnknownProtocols: true });\n\t\t\tthis.mdCache.set(path, markdownContents);\n\t\t}\n\t\treturn assertIsDefined(this.mdCache.get(path));\n\t}\n\n\tprivate async readContentsOfPath(path: URI, useModuleId = true): Promise<string> {\n\t\ttry {\n\t\t\tconst moduleId = JSON.parse(path.query).moduleId;\n\t\t\tif (useModuleId && moduleId) {\n\t\t\t\tconst contents = await new Promise<string>((resolve, reject) => {\n\t\t\t\t\tconst provider = gettingStartedContentRegistry.getProvider(moduleId);\n\t\t\t\t\tif (!provider) {\n\t\t\t\t\t\t// ESM-comment-begin\n\t\t\t\t\t\t// require([moduleId], content => {\n\t\t\t\t\t\t// resolve(content.default());\n\t\t\t\t\t\t// });\n\t\t\t\t\t\t// ESM-comment-end\n\t\t\t\t\t\t// ESM-uncomment-begin\n\t\t\t\t\t\treject(`Getting started: no provider registered for ${moduleId}`);\n\t\t\t\t\t\t// ESM-uncomment-end\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(provider());\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\treturn contents;\n\t\t\t}\n\t\t} catch { }\n\n\t\ttry {\n\t\t\tconst localizedPath = path.with({ path: path.path.replace(/\\.md$/, `.nls.${language}.md`) });\n\n\t\t\tconst generalizedLocale = language?.replace(/-.*$/, '');\n\t\t\tconst generalizedLocalizedPath = path.with({ path: path.path.replace(/\\.md$/, `.nls.${generalizedLocale}.md`) });\n\n\t\t\tconst fileExists = (file: URI) => this.fileService\n\t\t\t\t.stat(file)\n\t\t\t\t.then((stat) => !!stat.size) // Double check the file actually has content for fileSystemProviders that fake `stat`. #131809\n\t\t\t\t.catch(() => false);\n\n\t\t\tconst [localizedFileExists, generalizedLocalizedFileExists] = await Promise.all([\n\t\t\t\tfileExists(localizedPath),\n\t\t\t\tfileExists(generalizedLocalizedPath),\n\t\t\t]);\n\n\t\t\tconst bytes = await this.fileService.readFile(\n\t\t\t\tlocalizedFileExists\n\t\t\t\t\t? localizedPath\n\t\t\t\t\t: generalizedLocalizedFileExists\n\t\t\t\t\t\t? generalizedLocalizedPath\n\t\t\t\t\t\t: path);\n\n\t\t\treturn bytes.value.toString();\n\t\t} catch (e) {\n\t\t\tthis.notificationService.error('Error reading markdown document at `' + path + '`: ' + e);\n\t\t\treturn '';\n\t\t}\n\t}\n}\n\nconst transformUri = (src: string, base: URI) => {\n\tconst path = joinPath(base, src);\n\treturn asWebviewUri(path).toString(true);\n};\n\nconst transformUris = (content: string, base: URI): string => content\n\t.replace(/src=\"([^\"]*)\"/g, (_, src: string) => {\n\t\tif (src.startsWith('https://')) { return `src=\"${src}\"`; }\n\t\treturn `src=\"${transformUri(src, base)}\"`;\n\t})\n\t.replace(/!\\[([^\\]]*)\\]\\(([^)]*)\\)/g, (_, title: string, src: string) => {\n\t\tif (src.startsWith('https://')) { return `![${title}](${src})`; }\n\t\treturn `![${title}](${transformUri(src, base)})`;\n\t});\n"],
  "mappings": "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",
  "names": []
}
