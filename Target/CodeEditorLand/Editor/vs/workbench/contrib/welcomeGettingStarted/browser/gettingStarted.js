var fe=Object.defineProperty;var ve=Object.getOwnPropertyDescriptor;var Z=(E,w,t,r)=>{for(var e=r>1?void 0:r?ve(w,t):w,i=E.length-1,o;i>=0;i--)(o=E[i])&&(e=(r?o(w,t,e):o(e))||e);return r&&e&&fe(w,t,e),e},u=(E,w)=>(t,r)=>w(t,r,E);import{$ as s,addDisposableListener as R,append as ee,clearNode as te,reset as C}from"../../../../base/browser/dom.js";import{renderFormattedText as be}from"../../../../base/browser/formattedTextRenderer.js";import{StandardKeyboardEvent as ie}from"../../../../base/browser/keyboardEvent.js";import{Button as ye}from"../../../../base/browser/ui/button/button.js";import{renderLabelWithIcons as G}from"../../../../base/browser/ui/iconLabel/iconLabels.js";import{DomScrollableElement as $}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{Toggle as Ce}from"../../../../base/browser/ui/toggle/toggle.js";import{coalesce as we,equals as re}from"../../../../base/common/arrays.js";import{Delayer as ke,Throttler as se}from"../../../../base/common/async.js";import"../../../../base/common/cancellation.js";import{Codicon as Ie}from"../../../../base/common/codicons.js";import{onUnexpectedError as Ee}from"../../../../base/common/errors.js";import{KeyCode as K}from"../../../../base/common/keyCodes.js";import{splitRecentLabel as xe}from"../../../../base/common/labels.js";import{DisposableStore as H,toDisposable as z}from"../../../../base/common/lifecycle.js";import"../../../../base/common/linkedText.js";import{parse as oe}from"../../../../base/common/marshalling.js";import{Schemas as P,matchesScheme as O}from"../../../../base/common/network.js";import{isMacintosh as De}from"../../../../base/common/platform.js";import{ThemeIcon as T}from"../../../../base/common/themables.js";import{assertIsDefined as M}from"../../../../base/common/types.js";import{URI as ne}from"../../../../base/common/uri.js";import{generateUuid as Le}from"../../../../base/common/uuid.js";import"./media/gettingStarted.css";import{ILanguageService as We}from"../../../../editor/common/languages/language.js";import{MarkdownRenderer as Te}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{localize as l}from"../../../../nls.js";import{IAccessibilityService as Me}from"../../../../platform/accessibility/common/accessibility.js";import{ICommandService as Ae}from"../../../../platform/commands/common/commands.js";import{ConfigurationTarget as Re,IConfigurationService as Pe}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as q,IContextKeyService as Oe,RawContextKey as ae}from"../../../../platform/contextkey/common/contextkey.js";import"../../../../platform/editor/common/editor.js";import{IFileService as Ne}from"../../../../platform/files/common/files.js";import{IInstantiationService as Fe}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as Ge}from"../../../../platform/keybinding/common/keybinding.js";import{ILabelService as He,Verbosity as ce}from"../../../../platform/label/common/label.js";import{INotificationService as qe}from"../../../../platform/notification/common/notification.js";import{Link as Ue}from"../../../../platform/opener/browser/link.js";import{IOpenerService as Ke}from"../../../../platform/opener/common/opener.js";import{IProductService as _e}from"../../../../platform/product/common/productService.js";import{IQuickInputService as Be}from"../../../../platform/quickinput/common/quickInput.js";import{IStorageService as Ve,StorageScope as N,StorageTarget as _,WillSaveStateReason as $e}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as ze,TelemetryLevel as Je,firstSessionDateStorageKey as Ye}from"../../../../platform/telemetry/common/telemetry.js";import{getTelemetryLevel as Qe}from"../../../../platform/telemetry/common/telemetryUtils.js";import{defaultButtonStyles as je,defaultToggleStyles as Xe}from"../../../../platform/theme/browser/defaultStyles.js";import"../../../../platform/window/common/window.js";import{IWorkspaceContextService as Ze,UNKNOWN_EMPTY_WINDOW_WORKSPACE as de}from"../../../../platform/workspace/common/workspace.js";import{IWorkspacesService as et,isRecentFolder as tt,isRecentWorkspace as le}from"../../../../platform/workspaces/common/workspaces.js";import{OpenRecentAction as he}from"../../../browser/actions/windowActions.js";import{OpenFileFolderAction as it,OpenFolderAction as rt,OpenFolderViaWorkspaceAction as st}from"../../../browser/actions/workspaceActions.js";import{EditorPane as ot}from"../../../browser/parts/editor/editorPane.js";import{WorkbenchStateContext as nt}from"../../../common/contextkeys.js";import"../../../common/editor.js";import{IWebviewService as at}from"../../webview/browser/webview.js";import"./gettingStartedColors.js";import{GettingStartedDetailsRenderer as ct}from"./gettingStartedDetailsRenderer.js";import{gettingStartedCheckedCodicon as J,gettingStartedUncheckedCodicon as Y}from"./gettingStartedIcons.js";import{GettingStartedInput as B}from"./gettingStartedInput.js";import{IWalkthroughsService as dt,hiddenEntriesConfigurationKey as pe,parseDescription as lt}from"./gettingStartedService.js";import{restoreWalkthroughsConfigurationKey as Q}from"./startupPage.js";import{startEntries as ge}from"../common/gettingStartedContent.js";import{GroupDirection as ht,GroupsOrder as ue,IEditorGroupsService as pt}from"../../../services/editor/common/editorGroupsService.js";import{IExtensionService as gt}from"../../../services/extensions/common/extensions.js";import{IHostService as ut}from"../../../services/host/browser/host.js";import{IWorkbenchThemeService as mt}from"../../../services/themes/common/workbenchThemeService.js";import{GettingStartedIndexList as j}from"./gettingStartedList.js";const St=250,X="workbench.startupEditor",me=new ae("allWalkthroughsHidden",!1),ft=new ae("inWelcome",!1),vt=ge.map((E,w)=>({command:E.content.command,description:E.description,icon:{type:"icon",icon:E.icon},id:E.id,order:w,title:E.title,when:q.deserialize(E.when)??q.true()})),Se="workbench.welcomePage.preferReducedMotion";let F=class extends ot{constructor(t,r,e,i,o,n,a,c,h,d,p,k,D,v,m,g,I,b,x,W,bt,yt,Ct,wt){super(F.ID,t,a,p,k);this.commandService=r;this.productService=e;this.keybindingService=i;this.gettingStartedService=o;this.configurationService=n;this.languageService=c;this.fileService=h;this.openerService=d;this.themeService=p;this.storageService=k;this.extensionService=D;this.instantiationService=v;this.notificationService=m;this.groupsService=g;this.quickInputService=b;this.workspacesService=x;this.labelService=W;this.hostService=bt;this.webviewService=yt;this.workspaceContextService=Ct;this.accessibilityService=wt;this.container=s(".gettingStartedContainer",{role:"document",tabindex:0,"aria-label":l("welcomeAriaLabel","Overview of how to get up to speed with your editor.")}),this.stepMediaComponent=s(".getting-started-media"),this.stepMediaComponent.id=Le(),this.categoriesSlideDisposables=this._register(new H),this.detailsRenderer=new ct(this.fileService,this.notificationService,this.extensionService,this.languageService),this.contextService=this._register(I.createScoped(this.container)),ft.bindTo(this.contextService).set(!0),this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this._register(this.dispatchListeners),this.buildSlideThrottle=new se;const V=()=>{if(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this.currentWalkthrough){const S=this.currentWalkthrough.steps.map(y=>y.id),f=this.gettingStartedCategories.find(y=>this.currentWalkthrough?.id===y.id);if(f){const y=f.steps.map(U=>U.id);re(y,S)||this.buildSlideThrottle.queue(()=>this.buildCategoriesSlide())}}else this.buildSlideThrottle.queue(()=>this.buildCategoriesSlide())};this._register(this.gettingStartedService.onDidAddWalkthrough(V)),this._register(this.gettingStartedService.onDidRemoveWalkthrough(V)),this.recentlyOpened=this.workspacesService.getRecentlyOpened(),this._register(x.onDidChangeRecentlyOpened(()=>{this.recentlyOpened=x.getRecentlyOpened(),V()})),this._register(this.gettingStartedService.onDidChangeWalkthrough(S=>{const f=this.gettingStartedCategories.find(y=>y.id===S.id);f&&(f.title=S.title,f.description=S.description,this.container.querySelectorAll(`[x-category-title-for="${S.id}"]`).forEach(y=>y.innerText=f.title),this.container.querySelectorAll(`[x-category-description-for="${S.id}"]`).forEach(y=>y.innerText=f.description))})),this._register(this.gettingStartedService.onDidProgressStep(S=>{const f=this.gettingStartedCategories.find(A=>A.id===S.category);if(!f)throw Error("Could not find category with ID: "+S.category);const y=f.steps.find(A=>A.id===S.id);if(!y)throw Error("Could not find step with ID: "+S.id);const U=this.getWalkthroughCompletionStats(f);!y.done&&U.stepsComplete===U.stepsTotal-1&&this.hideCategory(f.id),this._register(this.configurationService.onDidChangeConfiguration(A=>{A.affectsConfiguration(Se)&&this.container.classList.toggle("animatable",this.shouldAnimate())})),y.done=S.done,f.id===this.currentWalkthrough?.id&&M(this.window.document.querySelectorAll(`[data-done-step-id="${S.id}"]`)).forEach(L=>{S.done?(L.setAttribute("aria-checked","true"),L.parentElement?.setAttribute("aria-checked","true"),L.classList.remove(...T.asClassNameArray(Y)),L.classList.add("complete",...T.asClassNameArray(J))):(L.setAttribute("aria-checked","false"),L.parentElement?.setAttribute("aria-checked","false"),L.classList.remove("complete",...T.asClassNameArray(J)),L.classList.add(...T.asClassNameArray(Y)))}),this.updateCategoryProgress()})),this._register(this.storageService.onWillSaveState(S=>{if(S.reason!==$e.SHUTDOWN||this.workspaceContextService.getWorkspace().folders.length!==0||!this.editorInput||!this.currentWalkthrough||!this.editorInput.selectedCategory||!this.editorInput.selectedStep)return;const f={folder:de.id,category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(Q,JSON.stringify(f),N.PROFILE,_.MACHINE)}))}static ID="gettingStartedPage";editorInput;inProgressScroll=Promise.resolve();dispatchListeners=new H;stepDisposables=new H;detailsPageDisposables=new H;mediaDisposables=new H;recentlyOpened;gettingStartedCategories;currentWalkthrough;categoriesPageScrollbar;detailsPageScrollbar;detailsScrollbar;buildSlideThrottle=new se;container;contextService;hasScrolledToFirstCategory=!1;recentlyOpenedList;startList;gettingStartedList;stepsSlide;categoriesSlide;stepsContent;stepMediaComponent;webview;layoutMarkdown;detailsRenderer;categoriesSlideDisposables;showFeaturedWalkthrough=!0;shouldAnimate(){return!(this.configurationService.getValue(Se)||this.accessibilityService.isMotionReduced())}getWalkthroughCompletionStats(t){const r=t.steps.filter(e=>this.contextService.contextMatchesRules(e.when));return{stepsComplete:r.filter(e=>e.done).length,stepsTotal:r.length}}async setInput(t,r,e,i){this.container.classList.remove("animatable"),this.editorInput=t,await super.setInput(t,r,e,i),await this.buildCategoriesSlide(),this.shouldAnimate()&&setTimeout(()=>this.container.classList.add("animatable"),0)}async makeCategoryVisibleWhenAvailable(t,r){this.scrollToCategory(t,r)}registerDispatchListeners(){this.dispatchListeners.clear(),this.container.querySelectorAll("[x-dispatch]").forEach(t=>{const r=t.getAttribute("x-dispatch")??"";let e,i;r.startsWith("openLink:https")?[e,i]=["openLink",r.replace("openLink:","")]:[e,i]=r.split(":"),e&&(this.dispatchListeners.add(R(t,"click",o=>{o.stopPropagation(),this.runDispatchCommand(e,i)})),this.dispatchListeners.add(R(t,"keyup",o=>{const n=new ie(o);switch(o.stopPropagation(),n.keyCode){case K.Enter:case K.Space:this.runDispatchCommand(e,i);return}})))})}async runDispatchCommand(t,r){switch(this.commandService.executeCommand("workbench.action.keepEditor"),this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:t,argument:r,walkthroughId:this.currentWalkthrough?.id}),t){case"scrollPrev":{this.scrollPrev();break}case"skip":{this.runSkip();break}case"showMoreRecents":{this.commandService.executeCommand(he.ID);break}case"seeAllWalkthroughs":{await this.openWalkthroughSelector();break}case"openFolder":{this.contextService.contextMatchesRules(q.and(nt.isEqualTo("workspace")))?this.commandService.executeCommand(st.ID):this.commandService.executeCommand(De?"workbench.action.files.openFileFolder":"workbench.action.files.openFolder");break}case"selectCategory":{this.scrollToCategory(r),this.gettingStartedService.markWalkthroughOpened(r);break}case"selectStartEntry":{const e=ge.find(i=>i.id===r);if(e)this.runStepCommand(e.content.command);else throw Error("could not find start entry with id: "+r);break}case"hideCategory":{this.hideCategory(r);break}case"selectTask":{this.selectStep(r);break}case"toggleStepCompletion":{this.toggleStepCompletion(r);break}case"allDone":{this.markAllStepsComplete();break}case"nextSection":{const e=this.currentWalkthrough?.next;e?this.scrollToCategory(e):console.error("Error scrolling to next section of",this.currentWalkthrough);break}case"openLink":{this.openerService.open(r);break}default:{console.error("Dispatch to",t,r,"not defined");break}}}hideCategory(t){if(!this.gettingStartedCategories.find(e=>e.id===t))throw Error("Could not find category with ID "+t);this.setHiddenCategories([...this.getHiddenCategories().add(t)]),this.gettingStartedList?.rerender()}markAllStepsComplete(){if(this.currentWalkthrough)this.currentWalkthrough?.steps.forEach(t=>{t.done||this.gettingStartedService.progressStep(t.id)}),this.hideCategory(this.currentWalkthrough?.id),this.scrollPrev();else throw Error("No walkthrough opened")}toggleStepCompletion(t){M(this.currentWalkthrough?.steps.find(e=>e.id===t)).done?this.gettingStartedService.deprogressStep(t):this.gettingStartedService.progressStep(t)}async openWalkthroughSelector(){const t=await this.quickInputService.pick(this.gettingStartedCategories.filter(r=>this.contextService.contextMatchesRules(r.when)).map(r=>({id:r.id,label:r.title,detail:r.description,description:r.source})),{canPickMany:!1,matchOnDescription:!0,matchOnDetail:!0,title:l("pickWalkthroughs","Open Walkthrough...")});t&&this.runDispatchCommand("selectCategory",t.id)}getHiddenCategories(){return new Set(JSON.parse(this.storageService.get(pe,N.PROFILE,"[]")))}setHiddenCategories(t){this.storageService.store(pe,JSON.stringify(t),N.PROFILE,_.USER)}currentMediaComponent=void 0;currentMediaType=void 0;async buildMediaComponent(t,r=!1){if(!this.currentWalkthrough)throw Error("no walkthrough selected");const e=M(this.currentWalkthrough.steps.find(i=>i.id===t));if(!(!r&&this.currentMediaComponent===t)){if(this.currentMediaComponent=t,this.stepDisposables.clear(),this.stepDisposables.add({dispose:()=>{this.currentMediaComponent=void 0}}),this.currentMediaType!==e.media.type&&(this.currentMediaType=e.media.type,this.mediaDisposables.add(z(()=>{this.currentMediaType=void 0})),te(this.stepMediaComponent),e.media.type==="svg"?(this.webview=this.mediaDisposables.add(this.webviewService.createWebviewElement({title:void 0,options:{disableServiceWorker:!0},contentOptions:{},extension:void 0})),this.webview.mountTo(this.stepMediaComponent,this.window)):e.media.type==="markdown"&&(this.webview=this.mediaDisposables.add(this.webviewService.createWebviewElement({options:{},contentOptions:{localResourceRoots:[e.media.root],allowScripts:!0},title:"",extension:void 0})),this.webview.mountTo(this.stepMediaComponent,this.window))),e.media.type==="image"){this.stepsContent.classList.add("image"),this.stepsContent.classList.remove("markdown");const i=e.media,o=s("img");te(this.stepMediaComponent),this.stepMediaComponent.appendChild(o),o.setAttribute("alt",i.altText),this.updateMediaSourceForColorMode(o,i.path),this.stepDisposables.add(R(this.stepMediaComponent,"click",()=>{const n=e.description.map(a=>a.nodes.filter(c=>typeof c!="string").map(c=>c.href)).flat();if(n.length===1){const a=n[0];a.startsWith("http")&&(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:a,walkthroughId:this.currentWalkthrough?.id}),this.openerService.open(a))}})),this.stepDisposables.add(this.themeService.onDidColorThemeChange(()=>this.updateMediaSourceForColorMode(o,i.path)))}else if(e.media.type==="svg"){this.stepsContent.classList.add("image"),this.stepsContent.classList.remove("markdown");const i=e.media;this.webview.setHtml(await this.detailsRenderer.renderSVG(i.path));let o=!1;this.stepDisposables.add(z(()=>{o=!0})),this.stepDisposables.add(this.themeService.onDidColorThemeChange(async()=>{const n=await this.detailsRenderer.renderSVG(i.path);o||this.webview.setHtml(n)})),this.stepDisposables.add(R(this.stepMediaComponent,"click",()=>{const n=e.description.map(a=>a.nodes.filter(c=>typeof c!="string").map(c=>c.href)).flat();if(n.length===1){const a=n[0];a.startsWith("http")&&(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:a,walkthroughId:this.currentWalkthrough?.id}),this.openerService.open(a))}})),this.stepDisposables.add(this.webview.onDidClickLink(n=>{(O(n,P.https)||O(n,P.http)||O(n,P.command))&&this.openerService.open(n,{allowCommands:!0})}))}else if(e.media.type==="markdown"){this.stepsContent.classList.remove("image"),this.stepsContent.classList.add("markdown");const i=e.media,o=await this.detailsRenderer.renderMarkdown(i.path,i.base);this.webview.setHtml(o);const n=o.match(/checked-on=\"([^'][^"]*)\"/g)?.map(d=>d.slice(12,-1).replace(/&#39;/g,"'").replace(/&amp;/g,"&")),a=()=>{const d=n?.filter(p=>this.contextService.contextMatchesRules(q.deserialize(p)));d&&this.webview.postMessage({enabledContextKeys:d})};if(n){const d=we(n.map(k=>q.deserialize(k))),p=new Set(d.flatMap(k=>k.keys()));this.stepDisposables.add(this.contextService.onDidChangeContext(k=>{k.affectsSome(p)&&a()}))}let c=!1;this.stepDisposables.add(z(()=>{c=!0})),this.stepDisposables.add(this.webview.onDidClickLink(d=>{if(O(d,P.https)||O(d,P.http)||O(d,P.command)){const p=d.startsWith("command:toSide:");p&&(d=d.replace("command:toSide:","command:"),this.focusSideEditorGroup()),this.openerService.open(d,{allowCommands:!0,openToSide:p})}})),o.indexOf("<code>")>=0&&this.stepDisposables.add(this.themeService.onDidColorThemeChange(async()=>{const d=await this.detailsRenderer.renderMarkdown(i.path,i.base);c||(this.webview.setHtml(d),a())}));const h=new ke(50);this.layoutMarkdown=()=>{h.trigger(()=>{this.webview.postMessage({layoutMeNow:!0})})},this.stepDisposables.add(h),this.stepDisposables.add({dispose:()=>this.layoutMarkdown=void 0}),a(),this.stepDisposables.add(this.webview.onMessage(async d=>{const p=d.message;if(p.startsWith("command:"))this.openerService.open(p,{allowCommands:!0});else if(p.startsWith("setTheme:")){const k=p.slice(9),D=(await this.themeService.getColorThemes()).find(v=>v.settingsId===k);D&&this.themeService.setColorTheme(D.id,Re.USER)}else console.error("Unexpected message",p)}))}}}async selectStepLoose(t){if(t.startsWith(`${this.editorInput.selectedCategory}#`))this.selectStep(t);else{const r=this.editorInput.selectedCategory+"#"+t;this.selectStep(r)}}async selectStep(t,r=!0){if(t){let e=this.container.querySelector(`[data-step-id="${t}"]`);if(!e){if(e=this.container.querySelector("[data-step-id]"),!e)return;t=M(e.getAttribute("data-step-id"))}e.parentElement?.querySelectorAll(".expanded").forEach(i=>{i.getAttribute("data-step-id")!==t&&(i.classList.remove("expanded"),i.setAttribute("aria-expanded","false"))}),setTimeout(()=>e.focus(),r&&this.shouldAnimate()?St:0),this.editorInput.selectedStep=t,e.classList.add("expanded"),e.setAttribute("aria-expanded","true"),this.buildMediaComponent(t,!0),this.gettingStartedService.progressByEvent("stepSelected:"+t)}else this.editorInput.selectedStep=void 0;this.detailsPageScrollbar?.scanDomNode(),this.detailsScrollbar?.scanDomNode()}updateMediaSourceForColorMode(t,r){const e=this.themeService.getColorTheme().type,i=r[e].toString(!0).replace(/ /g,"%20");t.srcset=i.toLowerCase().endsWith(".svg")?i:i+" 1.5x"}createEditor(t){this.detailsPageScrollbar&&this.detailsPageScrollbar.dispose(),this.categoriesPageScrollbar&&this.categoriesPageScrollbar.dispose(),this.categoriesSlide=s(".gettingStartedSlideCategories.gettingStartedSlide");const r=s("button.prev-button.button-link",{"x-dispatch":"scrollPrev"},s("span.scroll-button.codicon.codicon-chevron-left"),s("span.moreText",{},l("welcome","Welcome")));this.stepsSlide=s(".gettingStartedSlideDetails.gettingStartedSlide",{},r),this.stepsContent=s(".gettingStartedDetailsContent",{}),this.detailsPageScrollbar=this._register(new $(this.stepsContent,{className:"full-height-scrollable"})),this.categoriesPageScrollbar=this._register(new $(this.categoriesSlide,{className:"full-height-scrollable categoriesScrollbar"})),this.stepsSlide.appendChild(this.detailsPageScrollbar.getDomNode());const e=s(".gettingStarted",{},this.categoriesPageScrollbar.getDomNode(),this.stepsSlide);this.container.appendChild(e),this.categoriesPageScrollbar.scanDomNode(),this.detailsPageScrollbar.scanDomNode(),t.appendChild(this.container)}async buildCategoriesSlide(){this.categoriesSlideDisposables.clear();const t=new Ce({icon:Ie.check,actionClassName:"getting-started-checkbox",isChecked:this.configurationService.getValue(X)==="welcomePage",title:l("checkboxTitle","When checked, this page will be shown on startup."),...Xe});t.domNode.id="showOnStartup";const r=s("label.caption",{for:"showOnStartup"},l("welcomePage.showOnStartup","Show welcome page on startup")),e=()=>{t.checked?(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"showOnStartupChecked",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.configurationService.updateValue(X,"welcomePage")):(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"showOnStartupUnchecked",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.configurationService.updateValue(X,"none"))};this.categoriesSlideDisposables.add(t),this.categoriesSlideDisposables.add(t.onChange(()=>{e()})),this.categoriesSlideDisposables.add(R(r,"click",()=>{t.checked=!t.checked,e()}));const i=s(".header",{},s("h1.product-name.caption",{},this.productService.nameLong),s("p.subtitle.description",{},l({key:"gettingStarted.editingEvolved",comment:["Shown as subtitle on the Welcome page."]},"Editing evolved"))),o=s(".categories-column.categories-column-left",{}),n=s(".categories-column.categories-column-right",{}),a=this.buildStartList(),c=this.buildRecentlyOpenedList(),h=this.buildGettingStartedWalkthroughsList(),d=s(".footer",{},s("p.showOnStartup",{},t.domNode,r)),p=()=>{h.itemCount?(this.container.classList.remove("noWalkthroughs"),C(n,h.getDomElement())):(this.container.classList.add("noWalkthroughs"),C(n)),setTimeout(()=>this.categoriesPageScrollbar?.scanDomNode(),50),k()},k=()=>{this.container.classList.contains("noWalkthroughs")?(c.setLimit(10),C(o,a.getDomElement()),C(n,c.getDomElement())):(c.setLimit(5),C(o,a.getDomElement(),c.getDomElement()))};if(h.onDidChange(p),p(),C(this.categoriesSlide,s(".gettingStartedCategoriesContainer",{},i,o,n,d)),this.categoriesPageScrollbar?.scanDomNode(),this.updateCategoryProgress(),this.registerDispatchListeners(),this.editorInput.selectedCategory){if(this.currentWalkthrough=this.gettingStartedCategories.find(v=>v.id===this.editorInput.selectedCategory),this.currentWalkthrough){this.buildCategorySlide(this.editorInput.selectedCategory,this.editorInput.selectedStep),this.setSlide("details");return}else if(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs(),this.currentWalkthrough=this.gettingStartedCategories.find(v=>v.id===this.editorInput.selectedCategory),this.currentWalkthrough){this.buildCategorySlide(this.editorInput.selectedCategory,this.editorInput.selectedStep),this.setSlide("details");return}}const D=this.gettingStartedCategories.some(v=>v.steps.find(m=>m.done));if(this.editorInput.showTelemetryNotice&&this.productService.openToWelcomeMainPage){const v=s("p.telemetry-notice");this.buildTelemetryFooter(v),d.appendChild(v)}else if(!this.productService.openToWelcomeMainPage&&!D&&!this.hasScrolledToFirstCategory&&this.showFeaturedWalkthrough){const v=this.storageService.get(Ye,N.APPLICATION)||new Date().toUTCString();if(((+new Date-+new Date(v))/1e3/60/60/24<1?"openToFirstCategory":"index")==="openToFirstCategory"){const I=this.gettingStartedCategories.filter(b=>!b.when||this.contextService.contextMatchesRules(b.when))[0];if(I){this.hasScrolledToFirstCategory=!0,this.currentWalkthrough=I,this.editorInput.selectedCategory=this.currentWalkthrough?.id,this.buildCategorySlide(this.editorInput.selectedCategory,void 0),this.setSlide("details");return}}}this.setSlide("categories")}buildRecentlyOpenedList(){const t=e=>{let i,o;tt(e)?(o={folderUri:e.folderUri},i=e.label||this.labelService.getWorkspaceLabel(e.folderUri,{verbose:ce.LONG})):(i=e.label||this.labelService.getWorkspaceLabel(e.workspace,{verbose:ce.LONG}),o={workspaceUri:e.workspace.configPath});const{name:n,parentPath:a}=xe(i),c=s("li"),h=s("button.button-link");h.innerText=n,h.title=i,h.setAttribute("aria-label",l("welcomePage.openFolderWithPath","Open folder {0} with path {1}",n,a)),h.addEventListener("click",p=>{this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"openRecent",argument:void 0,walkthroughId:this.currentWalkthrough?.id}),this.hostService.openWindow([o],{forceNewWindow:p.ctrlKey||p.metaKey,remoteAuthority:e.remoteAuthority||null}),p.preventDefault(),p.stopPropagation()}),c.appendChild(h);const d=s("span");return d.classList.add("path"),d.classList.add("detail"),d.innerText=a,d.title=i,c.appendChild(d),c};this.recentlyOpenedList&&this.recentlyOpenedList.dispose();const r=this.recentlyOpenedList=new j({title:l("recent","Recent"),klass:"recently-opened",limit:5,empty:s(".empty-recent",{},l("noRecents","You have no recent folders,"),s("button.button-link",{"x-dispatch":"openFolder"},l("openFolder","open a folder")),l("toStart","to start.")),more:s(".more",{},s("button.button-link",{"x-dispatch":"showMoreRecents",title:l("show more recents","Show All Recent Folders {0}",this.getKeybindingLabel(he.ID))},l("showAll","More..."))),renderElement:t,contextService:this.contextService});return r.onDidChange(()=>this.registerDispatchListeners()),this.recentlyOpened.then(({workspaces:e})=>{const i=e.filter(n=>!this.workspaceContextService.isCurrentWorkspace(le(n)?n.workspace:n.folderUri)).map(n=>({...n,id:le(n)?n.workspace.id:n.folderUri.toString()})),o=()=>{r.setEntries(i)};o(),r.register(this.labelService.onDidChangeFormatters(()=>o()))}).catch(Ee),r}buildStartList(){const t=e=>s("li",{},s("button.button-link",{"x-dispatch":"selectStartEntry:"+e.id,title:e.description+" "+this.getKeybindingLabel(e.command)},this.iconWidgetFor(e),s("span",{},e.title)));this.startList&&this.startList.dispose();const r=this.startList=new j({title:l("start","Start"),klass:"start-container",limit:10,renderElement:t,rankElement:e=>-e.order,contextService:this.contextService});return r.setEntries(vt),r.onDidChange(()=>this.registerDispatchListeners()),r}buildGettingStartedWalkthroughsList(){const t=i=>{const o=(i.newItems||i.newEntry)&&!i.isFeatured,n=s(".new-badge",{});i.newEntry?C(n,s(".new-category",{},l("new","New"))):i.newItems&&C(n,s(".new-items",{},l({key:"newItems",comment:["Shown when a list of items has changed based on an update from a remote source"]},"Updated")));const a=s(".featured-badge",{}),c=s(".description-content",{});i.isFeatured&&this.showFeaturedWalkthrough&&(C(a,s(".featured",{},s("span.featured-icon.codicon.codicon-star-full"))),C(c,...G(i.description)));const h=s("h3.category-title.max-lines-3",{"x-category-title-for":i.id});return C(h,...G(i.title)),s("button.getting-started-category"+(i.isFeatured&&this.showFeaturedWalkthrough?".featured":""),{"x-dispatch":"selectCategory:"+i.id,title:i.description},a,s(".main-content",{},this.iconWidgetFor(i),h,o?n:s(".no-badge"),s("a.codicon.codicon-close.hide-category-button",{tabindex:0,"x-dispatch":"hideCategory:"+i.id,title:l("close","Hide"),role:"button","aria-label":l("closeAriaLabel","Hide")})),c,s(".category-progress",{"x-data-category-id":i.id},s(".progress-bar-outer",{role:"progressbar"},s(".progress-bar-inner"))))};this.gettingStartedList&&this.gettingStartedList.dispose();const r=i=>{let o=i.order;return i.isFeatured&&(o+=7),i.newEntry&&(o+=3),i.newItems&&(o+=2),i.recencyBonus&&(o+=4*i.recencyBonus),this.getHiddenCategories().has(i.id)&&(o=null),o},e=this.gettingStartedList=new j({title:l("walkthroughs","Walkthroughs"),klass:"getting-started",limit:5,footer:s("span.button-link.see-all-walkthroughs",{"x-dispatch":"seeAllWalkthroughs",tabindex:0},l("showAll","More...")),renderElement:t,rankElement:r,contextService:this.contextService});return e.onDidChange(()=>{const o=this.getHiddenCategories().size||e.itemCount<this.gettingStartedCategories.filter(n=>this.contextService.contextMatchesRules(n.when)).length;this.container.classList.toggle("someWalkthroughsHidden",!!o),this.registerDispatchListeners(),me.bindTo(this.contextService).set(e.itemCount===0),this.updateCategoryProgress()}),e.setEntries(this.gettingStartedCategories),me.bindTo(this.contextService).set(e.itemCount===0),e}layout(t){this.detailsScrollbar?.scanDomNode(),this.categoriesPageScrollbar?.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.startList?.layout(t),this.gettingStartedList?.layout(t),this.recentlyOpenedList?.layout(t),this.editorInput?.selectedStep&&this.currentMediaType&&(this.mediaDisposables.clear(),this.stepDisposables.clear(),this.buildMediaComponent(this.editorInput.selectedStep)),this.layoutMarkdown?.(),this.container.classList.toggle("height-constrained",t.height<=600),this.container.classList.toggle("width-constrained",t.width<=400),this.container.classList.toggle("width-semi-constrained",t.width<=800),this.categoriesPageScrollbar?.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.detailsScrollbar?.scanDomNode()}updateCategoryProgress(){this.window.document.querySelectorAll(".category-progress").forEach(t=>{const r=t.getAttribute("x-data-category-id"),e=this.gettingStartedCategories.find(a=>a.id===r);if(!e)throw Error("Could not find category with ID "+r);const i=this.getWalkthroughCompletionStats(e),o=M(t.querySelector(".progress-bar-inner"));o.setAttribute("aria-valuemin","0"),o.setAttribute("aria-valuenow",""+i.stepsComplete),o.setAttribute("aria-valuemax",""+i.stepsTotal);const n=i.stepsComplete/i.stepsTotal*100;o.style.width=`${n}%`,t.parentElement.classList.toggle("no-progress",i.stepsComplete===0),i.stepsTotal===i.stepsComplete?o.title=l("gettingStarted.allStepsComplete","All {0} steps complete!",i.stepsComplete):o.title=l("gettingStarted.someStepsComplete","{0} of {1} steps complete",i.stepsComplete,i.stepsTotal)})}async scrollToCategory(t,r){this.gettingStartedCategories.some(i=>i.id===t)||(this.gettingStartedCategories=this.gettingStartedService.getWalkthroughs());const e=this.gettingStartedCategories.find(i=>i.id===t);if(!e)throw Error("Could not find category with ID: "+t);this.inProgressScroll=this.inProgressScroll.then(async()=>{C(this.stepsContent),this.editorInput.selectedCategory=t,this.editorInput.selectedStep=r,this.currentWalkthrough=e,this.buildCategorySlide(t,r),this.setSlide("details")})}iconWidgetFor(t){const r=t.icon.type==="icon"?s(T.asCSSSelector(t.icon.icon)):s("img.category-icon",{src:t.icon.path});return r.classList.add("icon-widget"),r}focusSideEditorGroup(){const t=this.groupsService.getPart(this.group).contentDimension;if(!t||t.width<=700)return;if(this.groupsService.count===1){const e=this.groupsService.addGroup(this.groupsService.groups[0],ht.RIGHT);this.groupsService.activateGroup(e);const i=Math.floor(t.width/2),o=this.groupsService.getGroups(ue.MOST_RECENTLY_ACTIVE).find(n=>n.activeEditor instanceof B);this.groupsService.setSize(M(o),{width:i,height:t.height})}const r=this.groupsService.getGroups(ue.MOST_RECENTLY_ACTIVE).find(e=>!(e.activeEditor instanceof B));r&&(this.groupsService.activateGroup(r),r.focus())}runStepCommand(t){const r=t.startsWith("command:"),e=t.startsWith("command:toSide:"),i=t.replace(/command:(toSide:)?/,"command:");if(this.telemetryService.publicLog2("gettingStarted.ActionExecuted",{command:"runStepAction",argument:t,walkthroughId:this.currentWalkthrough?.id}),e&&this.focusSideEditorGroup(),r){const o=ne.parse(i);let n=[];try{n=oe(decodeURIComponent(o.query))}catch{try{n=oe(o.query)}catch{}}if(Array.isArray(n)||(n=[n]),(o.path===it.ID.toString()||o.path===rt.ID.toString())&&this.workspaceContextService.getWorkspace().folders.length===0){const a=this.currentWalkthrough?.steps.findIndex(c=>c.id===this.editorInput.selectedStep);if(a!==void 0&&a>-1&&this.currentWalkthrough?.steps.slice(a+1).some(c=>!c.done)){const c={folder:de.id,category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(Q,JSON.stringify(c),N.PROFILE,_.MACHINE)}}this.commandService.executeCommand(o.path,...n).then(a=>{const c=a?.openFolder;if(c){if(!ne.isUri(c)){console.warn("Warn: Running walkthrough command",t,"yielded non-URI `openFolder` result",c,". It will be disregarded.");return}const h={folder:c.toString(),category:this.editorInput.selectedCategory,step:this.editorInput.selectedStep};this.storageService.store(Q,JSON.stringify(h),N.PROFILE,_.MACHINE),this.hostService.openWindow([{folderUri:c}])}})}else this.openerService.open(i,{allowCommands:!0});!r&&(t.startsWith("https://")||t.startsWith("http://"))&&this.gettingStartedService.progressByEvent("onLink:"+t)}buildMarkdownDescription(t,r){for(;t.firstChild;)t.firstChild.remove();for(const e of r)if(e.nodes.length===1&&typeof e.nodes[0]!="string"){const i=e.nodes[0],o=ee(t,s(".button-container")),n=new ye(o,{title:i.title,supportIcons:!0,...je}),a=i.href.startsWith("command:"),c=i.href.replace(/command:(toSide:)?/,"command:");if(n.label=i.label,n.onDidClick(h=>{h.stopPropagation(),h.preventDefault(),this.runStepCommand(i.href)},null,this.detailsPageDisposables),a){const h=this.getKeybindingLabel(c);h&&t.appendChild(s("span.shortcut-message",{},l("gettingStarted.keyboardTip","Tip: Use keyboard shortcut "),s("span.keybinding",{},h)))}this.detailsPageDisposables.add(n)}else{const i=ee(t,s("p"));for(const o of e.nodes)if(typeof o=="string"){const n=G(o);for(const a of n)typeof a=="string"?i.appendChild(be(a,{inline:!0,renderCodeSegments:!0})):i.appendChild(a)}else{const n=this.instantiationService.createInstance(Ue,i,o,{opener:a=>this.runStepCommand(a)});this.detailsPageDisposables.add(n)}}return t}clearInput(){this.stepDisposables.clear(),super.clearInput()}buildCategorySlide(t,r){this.detailsScrollbar&&this.detailsScrollbar.dispose(),this.extensionService.whenInstalledExtensionsRegistered().then(()=>{this.extensionService.activateByEvent(`onWalkthrough:${t.replace(/[^#]+#/,"")}`)}),this.detailsPageDisposables.clear(),this.mediaDisposables.clear();const e=this.gettingStartedCategories.find(m=>m.id===t);if(!e)throw Error("could not find category with ID "+t);const i=s(".category-description.description.max-lines-3",{"x-category-description-for":e.id});this.buildMarkdownDescription(i,lt(e.description));const o=s(".getting-started-category",{},s(".category-description-container",{},s("h2.category-title.max-lines-3",{"x-category-title-for":e.id},...G(e.title)),i)),n=s(".step-list-container");this.detailsPageDisposables.add(R(n,"keydown",m=>{const g=new ie(m),I=()=>e.steps.findIndex(b=>b.id===this.editorInput.selectedStep);if(g.keyCode===K.UpArrow){const b=e.steps.filter((x,W)=>W<I()&&this.contextService.contextMatchesRules(x.when));b.length&&this.selectStep(b[b.length-1].id,!1)}if(g.keyCode===K.DownArrow){const b=e.steps.find((x,W)=>W>I()&&this.contextService.contextMatchesRules(x.when));b&&this.selectStep(b.id,!1)}}));let a;const c=new Set(e.steps.flatMap(m=>m.when.keys())),h=()=>{e.steps.sort((g,I)=>g.order-I.order);const m=e.steps.filter(g=>this.contextService.contextMatchesRules(g.when));re(a,m,(g,I)=>g.id===I.id)||(a=m,C(n,...a.map(g=>{const I=s(".codicon"+(g.done?".complete"+T.asCSSSelector(J):T.asCSSSelector(Y)),{"data-done-step-id":g.id,"x-dispatch":"toggleStepCompletion:"+g.id,role:"checkbox",tabindex:"0","aria-checked":g.done?"true":"false"}),b=s(".step-description-container",{"x-step-description-for":g.id});this.buildMarkdownDescription(b,g.description);const x=s("h3.step-title.max-lines-3",{"x-step-title-for":g.id});C(x,...G(g.title));const W=s(".step-container",{},x,b);return g.media.type==="image"&&W.appendChild(s(".image-description",{"aria-label":l("imageShowing","Image showing {0}",g.media.altText)})),s("button.getting-started-step",{"x-dispatch":"selectTask:"+g.id,"data-step-id":g.id,"aria-expanded":"false","aria-checked":g.done?"true":"false",role:"button"},I,W)})))};h(),this.detailsPageDisposables.add(this.contextService.onDidChangeContext(m=>{m.affectsSome(c)&&(h(),this.registerDispatchListeners(),this.selectStep(this.editorInput.selectedStep,!1))}));const d=this.gettingStartedCategories.find(m=>m.id===e.next),p=s(".getting-started-detail-container",{role:"list"},n,s(".done-next-container",{},s("button.button-link.all-done",{"x-dispatch":"allDone"},s("span.codicon.codicon-check-all"),l("allDone","Mark Done")),...d?[s("button.button-link.next",{"x-dispatch":"nextSection"},l("nextOne","Next Section"),s("span.codicon.codicon-arrow-right"))]:[]));this.detailsScrollbar=this._register(new $(p,{className:"steps-container"}));const k=this.detailsScrollbar.getDomNode(),D=s(".getting-started-footer");this.editorInput.showTelemetryNotice&&Qe(this.configurationService)!==Je.NONE&&this.productService.enableTelemetry&&this.buildTelemetryFooter(D),C(this.stepsContent,o,k,this.stepMediaComponent,D);const v=e.steps.find(m=>this.contextService.contextMatchesRules(m.when)&&!m.done)??e.steps[0];this.selectStep(r??v.id,!r),this.detailsScrollbar.scanDomNode(),this.detailsPageScrollbar?.scanDomNode(),this.registerDispatchListeners()}buildTelemetryFooter(t){const r=this.instantiationService.createInstance(Te,{}),i=`[${l("privacy statement","privacy statement")}](command:workbench.action.openPrivacyStatementUrl)`,n=`[${l("optOut","opt out")}](command:settings.filterByTelemetry)`,a=l({key:"footer",comment:['fist substitution is "vs code", second is "privacy statement", third is "opt out".']},"{0} collects usage data. Read our {1} and learn how to {2}.",this.productService.nameShort,i,n);t.append(r.render({value:a,isTrusted:!0}).element),r.dispose()}getKeybindingLabel(t){t=t.replace(/^command:/,"");const r=this.keybindingService.lookupKeybinding(t)?.getLabel();return r?`(${r})`:""}async scrollPrev(){this.inProgressScroll=this.inProgressScroll.then(async()=>{this.currentWalkthrough=void 0,this.editorInput.selectedCategory=void 0,this.editorInput.selectedStep=void 0,this.editorInput.showTelemetryNotice=!1,this.gettingStartedCategories.length!==this.gettingStartedList?.itemCount&&this.buildCategoriesSlide(),this.selectStep(void 0),this.setSlide("categories"),this.container.focus()})}runSkip(){this.commandService.executeCommand("workbench.action.closeActiveEditor")}escape(){this.editorInput.selectedCategory?this.scrollPrev():this.runSkip()}setSlide(t){const r=M(this.container.querySelector(".gettingStarted"));t==="categories"?(r.classList.remove("showDetails"),r.classList.add("showCategories"),this.container.querySelector(".prev-button.button-link").style.display="none",this.container.querySelector(".gettingStartedSlideDetails").querySelectorAll("button").forEach(e=>e.disabled=!0),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("button").forEach(e=>e.disabled=!1),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("input").forEach(e=>e.disabled=!1)):(r.classList.add("showDetails"),r.classList.remove("showCategories"),this.container.querySelector(".prev-button.button-link").style.display="block",this.container.querySelector(".gettingStartedSlideDetails").querySelectorAll("button").forEach(e=>e.disabled=!1),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("button").forEach(e=>e.disabled=!0),this.container.querySelector(".gettingStartedSlideCategories").querySelectorAll("input").forEach(e=>e.disabled=!0))}focus(){super.focus();const t=this.container.ownerDocument.activeElement;let r=this.container.parentElement;for(;r&&r!==t;)r=r.parentElement;r&&this.container.focus()}};F=Z([u(1,Ae),u(2,_e),u(3,Ge),u(4,dt),u(5,Pe),u(6,ze),u(7,We),u(8,Ne),u(9,Ke),u(10,mt),u(11,Ve),u(12,gt),u(13,Fe),u(14,qe),u(15,pt),u(16,Oe),u(17,Be),u(18,et),u(19,He),u(20,ut),u(21,at),u(22,Ze),u(23,Me)],F);class Zi{canSerialize(w){return!0}serialize(w){return JSON.stringify({selectedCategory:w.selectedCategory,selectedStep:w.selectedStep})}deserialize(w,t){try{const{selectedCategory:r,selectedStep:e}=JSON.parse(t);return new B({selectedCategory:r,selectedStep:e})}catch{}return new B({})}}export{Zi as GettingStartedInputSerializer,F as GettingStartedPage,me as allWalkthroughsHiddenContext,ft as inWelcomeContext};
