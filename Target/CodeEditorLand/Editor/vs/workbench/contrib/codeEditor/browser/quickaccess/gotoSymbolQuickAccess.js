var x=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var h=(p,c,e,t)=>{for(var o=t>1?void 0:t?w(c,e):c,r=p.length-1,i;r>=0;r--)(i=p[r])&&(o=(t?i(c,e,o):i(o))||o);return t&&o&&x(c,e,o),o},d=(p,c)=>(e,t)=>c(e,t,p);import{timeout as Q}from"../../../../../base/common/async.js";import{CancellationTokenSource as D}from"../../../../../base/common/cancellation.js";import{onUnexpectedError as O}from"../../../../../base/common/errors.js";import{fuzzyScore as A}from"../../../../../base/common/filters.js";import{prepareQuery as T}from"../../../../../base/common/fuzzyScorer.js";import{matchesFuzzyIconAware as M,parseLabelWithIcons as G}from"../../../../../base/common/iconLabels.js";import{KeyCode as F,KeyMod as k}from"../../../../../base/common/keyCodes.js";import{Disposable as L,DisposableStore as R,MutableDisposable as B,toDisposable as E}from"../../../../../base/common/lifecycle.js";import{isCompositeEditor as K}from"../../../../../editor/browser/editorBrowser.js";import{SymbolKind as C}from"../../../../../editor/common/languages.js";import{ILanguageFeaturesService as W}from"../../../../../editor/common/services/languageFeatures.js";import{IOutlineModelService as j}from"../../../../../editor/contrib/documentSymbols/browser/outlineModel.js";import{AbstractGotoSymbolQuickAccessProvider as m}from"../../../../../editor/contrib/quickAccess/browser/gotoSymbolQuickAccess.js";import{localize as u,localize2 as z}from"../../../../../nls.js";import{Action2 as _,MenuId as q,registerAction2 as N}from"../../../../../platform/actions/common/actions.js";import{IConfigurationService as V}from"../../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as X}from"../../../../../platform/contextkey/common/contextkey.js";import{KeybindingWeight as Y}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{Extensions as U}from"../../../../../platform/quickinput/common/quickAccess.js";import{IQuickInputService as H,ItemActivation as J}from"../../../../../platform/quickinput/common/quickInput.js";import{Registry as Z}from"../../../../../platform/registry/common/platform.js";import{IEditorGroupsService as $}from"../../../../services/editor/common/editorGroupsService.js";import{IEditorService as ee}from"../../../../services/editor/common/editorService.js";import{IOutlineService as te,OutlineTarget as ie}from"../../../../services/outline/browser/outline.js";import{accessibilityHelpIsShown as oe,accessibleViewIsShown as re}from"../../../accessibility/browser/accessibilityConfiguration.js";let a=class extends m{constructor(e,t,o,r,i,S){super(r,S,{openSideBySideDirection:()=>this.configuration.openSideBySideDirection});this.editorService=e;this.editorGroupService=t;this.configurationService=o;this.outlineService=i}onDidActiveTextEditorControlChange=this.editorService.onDidActiveEditorChange;get configuration(){const e=this.configurationService.getValue().workbench?.editor;return{openEditorPinned:!e?.enablePreviewFromQuickOpen||!e?.enablePreview,openSideBySideDirection:e?.openSideBySideDirection}}get activeTextEditorControl(){if(!K(this.editorService.activeEditorPane?.getControl()))return this.editorService.activeTextEditorControl}gotoLocation(e,t){if((t.keyMods.alt||this.configuration.openEditorPinned&&t.keyMods.ctrlCmd||t.forceSideBySide)&&this.editorService.activeEditor){e.restoreViewState?.();const o={selection:t.range,pinned:t.keyMods.ctrlCmd||this.configuration.openEditorPinned,preserveFocus:t.preserveFocus};this.editorGroupService.sideGroup.openEditor(this.editorService.activeEditor,o)}else super.gotoLocation(e,t)}static SYMBOL_PICKS_TIMEOUT=8e3;async getSymbolPicks(e,t,o,r,i){return!await Promise.race([this.waitForLanguageSymbolRegistry(e,r),Q(a.SYMBOL_PICKS_TIMEOUT)])||i.isCancellationRequested?[]:this.doGetSymbolPicks(this.getDocumentSymbols(e,i),T(t),o,i,e)}provideWithoutTextEditor(e){return this.canPickWithOutlineService()?this.doGetOutlinePicks(e):super.provideWithoutTextEditor(e)}canPickWithOutlineService(){return this.editorService.activeEditorPane?this.outlineService.canCreateOutline(this.editorService.activeEditorPane):!1}doGetOutlinePicks(e){const t=this.editorService.activeEditorPane;if(!t)return L.None;const o=new D,r=new R;return r.add(E(()=>o.dispose(!0))),e.busy=!0,this.outlineService.createOutline(t,ie.QuickPick,o.token).then(i=>{if(!i)return;if(o.token.isCancellationRequested){i.dispose();return}r.add(i);const S=i.captureViewState();r.add(E(()=>{e.selectedItems.length===0&&S.dispose()}));const l=i.config.quickPickDataSource.getQuickPickElements(),P=l.map((n,s)=>({kind:C.File,index:s,score:0,label:n.label,description:n.description,ariaLabel:n.ariaLabel,iconClasses:n.iconClasses}));r.add(e.onDidAccept(()=>{e.hide();const[n]=e.selectedItems;n&&l[n.index]&&i.reveal(l[n.index].element,{},!1,!1)}));const I=()=>{const n=P.filter(s=>{if(e.value==="@")return s.score=0,s.highlights=void 0,!0;const g=e.value.substring(m.PREFIX.length).trim(),v=G(s.label),b=A(g,g.toLowerCase(),0,v.text,v.text.toLowerCase(),0,{firstMatchCanBeWeak:!0,boostFullMatch:!0});return b?(s.score=b[1],s.highlights={label:M(g,v)??void 0},!0):!1});if(n.length===0){const s=u("empty","No matching entries");e.items=[{label:s,index:-1,kind:C.String}],e.ariaLabel=s}else e.items=n};I(),r.add(e.onDidChangeValue(I));const f=new B;r.add(f),r.add(e.onDidChangeActive(()=>{const[n]=e.activeItems;n&&l[n.index]?f.value=i.preview(l[n.index].element):f.clear()}))}).catch(i=>{O(i),e.hide()}).finally(()=>{e.busy=!1}),r}};a=h([d(0,ee),d(1,$),d(2,V),d(3,W),d(4,te),d(5,j)],a);class y extends _{static ID="workbench.action.gotoSymbol";constructor(){super({id:y.ID,title:{...z("gotoSymbol","Go to Symbol in Editor..."),mnemonicTitle:u({key:"miGotoSymbolInEditor",comment:["&& denotes a mnemonic"]},"Go to &&Symbol in Editor...")},f1:!0,keybinding:{when:X.and(re.negate(),oe.negate()),weight:Y.WorkbenchContrib,primary:k.CtrlCmd|k.Shift|F.KeyO},menu:[{id:q.MenubarGoMenu,group:"4_symbol_nav",order:1}]})}run(c){c.get(H).quickAccess.show(a.PREFIX,{itemActivation:J.NONE})}}N(y),Z.as(U.Quickaccess).registerQuickAccessProvider({ctor:a,prefix:m.PREFIX,contextKey:"inFileSymbolsPicker",placeholder:u("gotoSymbolQuickAccessPlaceholder","Type the name of a symbol to go to."),helpEntries:[{description:u("gotoSymbolQuickAccess","Go to Symbol in Editor"),prefix:m.PREFIX,commandId:y.ID,commandCenterOrder:40},{description:u("gotoSymbolByCategoryQuickAccess","Go to Symbol in Editor by Category"),prefix:m.PREFIX_BY_CATEGORY}]});export{a as GotoSymbolQuickAccessProvider};
