{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/codeEditor/browser/inspectEditorTokens/inspectEditorTokens.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport \"./inspectEditorTokens.css\";\n// eslint-disable-next-line local/code-import-patterns\nimport type { Parser } from \"@vscode/tree-sitter-wasm\";\nimport type { IGrammar, IToken, StateStack } from \"vscode-textmate\";\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport { CancellationTokenSource } from \"../../../../../base/common/cancellation.js\";\nimport { CharCode } from \"../../../../../base/common/charCode.js\";\nimport { Color } from \"../../../../../base/common/color.js\";\nimport { KeyCode } from \"../../../../../base/common/keyCodes.js\";\nimport { Disposable } from \"../../../../../base/common/lifecycle.js\";\nimport { Schemas } from \"../../../../../base/common/network.js\";\nimport {\n\tContentWidgetPositionPreference,\n\ttype IActiveCodeEditor,\n\ttype ICodeEditor,\n\ttype IContentWidget,\n\ttype IContentWidgetPosition,\n} from \"../../../../../editor/browser/editorBrowser.js\";\nimport {\n\tEditorAction,\n\tEditorContributionInstantiation,\n\ttype ServicesAccessor,\n\tregisterEditorAction,\n\tregisterEditorContribution,\n} from \"../../../../../editor/browser/editorExtensions.js\";\nimport type { Position } from \"../../../../../editor/common/core/position.js\";\nimport { Range } from \"../../../../../editor/common/core/range.js\";\nimport type { IEditorContribution } from \"../../../../../editor/common/editorCommon.js\";\nimport {\n\tColorId,\n\tFontStyle,\n\tStandardTokenType,\n\tTokenMetadata,\n} from \"../../../../../editor/common/encodedTokenAttributes.js\";\nimport {\n\ttype SemanticTokens,\n\ttype SemanticTokensLegend,\n\tTreeSitterTokenizationRegistry,\n} from \"../../../../../editor/common/languages.js\";\nimport { ILanguageService } from \"../../../../../editor/common/languages/language.js\";\nimport type { ITextModel } from \"../../../../../editor/common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../../../editor/common/services/languageFeatures.js\";\nimport { ITreeSitterParserService } from \"../../../../../editor/common/services/treeSitterParserService.js\";\nimport {\n\ttype IEditorSemanticHighlightingOptions,\n\tSEMANTIC_HIGHLIGHTING_SETTING_ID,\n} from \"../../../../../editor/contrib/semanticTokens/common/semanticTokensConfig.js\";\nimport * as nls from \"../../../../../nls.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport { INotificationService } from \"../../../../../platform/notification/common/notification.js\";\nimport {\n\tSemanticTokenRule,\n\ttype TokenStyle,\n\ttype TokenStyleData,\n} from \"../../../../../platform/theme/common/tokenClassificationRegistry.js\";\nimport { ITextMateTokenizationService } from \"../../../../services/textMate/browser/textMateTokenizationFeature.js\";\nimport { findMatchingThemeRule } from \"../../../../services/textMate/common/TMHelper.js\";\nimport type {\n\tColorThemeData,\n\tTextMateThemingRuleDefinitions,\n\tTokenStyleDefinition,\n\tTokenStyleDefinitions,\n} from \"../../../../services/themes/common/colorThemeData.js\";\nimport { IWorkbenchThemeService } from \"../../../../services/themes/common/workbenchThemeService.js\";\n\nconst $ = dom.$;\n\nexport class InspectEditorTokensController\n\textends Disposable\n\timplements IEditorContribution\n{\n\tpublic static readonly ID = \"editor.contrib.inspectEditorTokens\";\n\n\tpublic static get(\n\t\teditor: ICodeEditor,\n\t): InspectEditorTokensController | null {\n\t\treturn editor.getContribution<InspectEditorTokensController>(\n\t\t\tInspectEditorTokensController.ID,\n\t\t);\n\t}\n\n\tprivate _editor: ICodeEditor;\n\tprivate _textMateService: ITextMateTokenizationService;\n\tprivate _treeSitterService: ITreeSitterParserService;\n\tprivate _themeService: IWorkbenchThemeService;\n\tprivate _languageService: ILanguageService;\n\tprivate _notificationService: INotificationService;\n\tprivate _configurationService: IConfigurationService;\n\tprivate _languageFeaturesService: ILanguageFeaturesService;\n\tprivate _widget: InspectEditorTokensWidget | null;\n\n\tconstructor(\n\t\teditor: ICodeEditor,\n\t\t@ITextMateTokenizationService\n\t\ttextMateService: ITextMateTokenizationService,\n\t\t@ITreeSitterParserService treeSitterService: ITreeSitterParserService,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IWorkbenchThemeService themeService: IWorkbenchThemeService,\n\t\t@INotificationService notificationService: INotificationService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper();\n\t\tthis._editor = editor;\n\t\tthis._textMateService = textMateService;\n\t\tthis._treeSitterService = treeSitterService;\n\t\tthis._themeService = themeService;\n\t\tthis._languageService = languageService;\n\t\tthis._notificationService = notificationService;\n\t\tthis._configurationService = configurationService;\n\t\tthis._languageFeaturesService = languageFeaturesService;\n\t\tthis._widget = null;\n\n\t\tthis._register(this._editor.onDidChangeModel((e) => this.stop()));\n\t\tthis._register(\n\t\t\tthis._editor.onDidChangeModelLanguage((e) => this.stop()),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._editor.onKeyUp(\n\t\t\t\t(e) => e.keyCode === KeyCode.Escape && this.stop(),\n\t\t\t),\n\t\t);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis.stop();\n\t\tsuper.dispose();\n\t}\n\n\tpublic launch(): void {\n\t\tif (this._widget) {\n\t\t\treturn;\n\t\t}\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tif (this._editor.getModel().uri.scheme === Schemas.vscodeNotebookCell) {\n\t\t\t// disable in notebooks\n\t\t\treturn;\n\t\t}\n\t\tthis._widget = new InspectEditorTokensWidget(\n\t\t\tthis._editor,\n\t\t\tthis._textMateService,\n\t\t\tthis._treeSitterService,\n\t\t\tthis._languageService,\n\t\t\tthis._themeService,\n\t\t\tthis._notificationService,\n\t\t\tthis._configurationService,\n\t\t\tthis._languageFeaturesService,\n\t\t);\n\t}\n\n\tpublic stop(): void {\n\t\tif (this._widget) {\n\t\t\tthis._widget.dispose();\n\t\t\tthis._widget = null;\n\t\t}\n\t}\n\n\tpublic toggle(): void {\n\t\tif (this._widget) {\n\t\t\tthis.stop();\n\t\t} else {\n\t\t\tthis.launch();\n\t\t}\n\t}\n}\n\nclass InspectEditorTokens extends EditorAction {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: \"editor.action.inspectTMScopes\",\n\t\t\tlabel: nls.localize(\n\t\t\t\t\"inspectEditorTokens\",\n\t\t\t\t\"Developer: Inspect Editor Tokens and Scopes\",\n\t\t\t),\n\t\t\talias: \"Developer: Inspect Editor Tokens and Scopes\",\n\t\t\tprecondition: undefined,\n\t\t});\n\t}\n\n\tpublic run(accessor: ServicesAccessor, editor: ICodeEditor): void {\n\t\tconst controller = InspectEditorTokensController.get(editor);\n\t\tcontroller?.toggle();\n\t}\n}\n\ninterface ITextMateTokenInfo {\n\ttoken: IToken;\n\tmetadata: IDecodedMetadata;\n}\n\ninterface ISemanticTokenInfo {\n\ttype: string;\n\tmodifiers: string[];\n\trange: Range;\n\tmetadata?: IDecodedMetadata;\n\tdefinitions: TokenStyleDefinitions;\n}\n\ninterface IDecodedMetadata {\n\tlanguageId: string | undefined;\n\ttokenType: StandardTokenType;\n\tbold: boolean | undefined;\n\titalic: boolean | undefined;\n\tunderline: boolean | undefined;\n\tstrikethrough: boolean | undefined;\n\tforeground: string | undefined;\n\tbackground: string | undefined;\n}\n\nfunction renderTokenText(tokenText: string): string {\n\tif (tokenText.length > 40) {\n\t\ttokenText =\n\t\t\ttokenText.substr(0, 20) +\n\t\t\t\"\u2026\" +\n\t\t\ttokenText.substr(tokenText.length - 20);\n\t}\n\tlet result = \"\";\n\tfor (\n\t\tlet charIndex = 0, len = tokenText.length;\n\t\tcharIndex < len;\n\t\tcharIndex++\n\t) {\n\t\tconst charCode = tokenText.charCodeAt(charIndex);\n\t\tswitch (charCode) {\n\t\t\tcase CharCode.Tab:\n\t\t\t\tresult += \"\\u2192\"; // &rarr;\n\t\t\t\tbreak;\n\n\t\t\tcase CharCode.Space:\n\t\t\t\tresult += \"\\u00B7\"; // &middot;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tresult += String.fromCharCode(charCode);\n\t\t}\n\t}\n\treturn result;\n}\n\ntype SemanticTokensResult = {\n\ttokens: SemanticTokens;\n\tlegend: SemanticTokensLegend;\n};\n\nclass InspectEditorTokensWidget extends Disposable implements IContentWidget {\n\tprivate static readonly _ID = \"editor.contrib.inspectEditorTokensWidget\";\n\n\t// Editor.IContentWidget.allowEditorOverflow\n\tpublic readonly allowEditorOverflow = true;\n\n\tprivate _isDisposed: boolean;\n\tprivate readonly _editor: IActiveCodeEditor;\n\tprivate readonly _languageService: ILanguageService;\n\tprivate readonly _themeService: IWorkbenchThemeService;\n\tprivate readonly _textMateService: ITextMateTokenizationService;\n\tprivate readonly _treeSitterService: ITreeSitterParserService;\n\tprivate readonly _notificationService: INotificationService;\n\tprivate readonly _configurationService: IConfigurationService;\n\tprivate readonly _languageFeaturesService: ILanguageFeaturesService;\n\tprivate readonly _model: ITextModel;\n\tprivate readonly _domNode: HTMLElement;\n\tprivate readonly _currentRequestCancellationTokenSource: CancellationTokenSource;\n\n\tconstructor(\n\t\teditor: IActiveCodeEditor,\n\t\ttextMateService: ITextMateTokenizationService,\n\t\ttreeSitterService: ITreeSitterParserService,\n\t\tlanguageService: ILanguageService,\n\t\tthemeService: IWorkbenchThemeService,\n\t\tnotificationService: INotificationService,\n\t\tconfigurationService: IConfigurationService,\n\t\tlanguageFeaturesService: ILanguageFeaturesService,\n\t) {\n\t\tsuper();\n\t\tthis._isDisposed = false;\n\t\tthis._editor = editor;\n\t\tthis._languageService = languageService;\n\t\tthis._themeService = themeService;\n\t\tthis._textMateService = textMateService;\n\t\tthis._treeSitterService = treeSitterService;\n\t\tthis._notificationService = notificationService;\n\t\tthis._configurationService = configurationService;\n\t\tthis._languageFeaturesService = languageFeaturesService;\n\t\tthis._model = this._editor.getModel();\n\t\tthis._domNode = document.createElement(\"div\");\n\t\tthis._domNode.className = \"token-inspect-widget\";\n\t\tthis._currentRequestCancellationTokenSource =\n\t\t\tnew CancellationTokenSource();\n\t\tthis._beginCompute(this._editor.getPosition());\n\t\tthis._register(\n\t\t\tthis._editor.onDidChangeCursorPosition((e) =>\n\t\t\t\tthis._beginCompute(this._editor.getPosition()),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tthemeService.onDidColorThemeChange((_) =>\n\t\t\t\tthis._beginCompute(this._editor.getPosition()),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tconfigurationService.onDidChangeConfiguration(\n\t\t\t\t(e) =>\n\t\t\t\t\te.affectsConfiguration(\n\t\t\t\t\t\t\"editor.semanticHighlighting.enabled\",\n\t\t\t\t\t) && this._beginCompute(this._editor.getPosition()),\n\t\t\t),\n\t\t);\n\t\tthis._editor.addContentWidget(this);\n\t}\n\n\tpublic override dispose(): void {\n\t\tthis._isDisposed = true;\n\t\tthis._editor.removeContentWidget(this);\n\t\tthis._currentRequestCancellationTokenSource.cancel();\n\t\tsuper.dispose();\n\t}\n\n\tpublic getId(): string {\n\t\treturn InspectEditorTokensWidget._ID;\n\t}\n\n\tprivate _beginCompute(position: Position): void {\n\t\tconst grammar = this._textMateService.createTokenizer(\n\t\t\tthis._model.getLanguageId(),\n\t\t);\n\t\tconst semanticTokens = this._computeSemanticTokens(position);\n\t\tconst tree = this._treeSitterService.getParseResult(this._model);\n\n\t\tdom.clearNode(this._domNode);\n\t\tthis._domNode.appendChild(\n\t\t\tdocument.createTextNode(\n\t\t\t\tnls.localize(\"inspectTMScopesWidget.loading\", \"Loading...\"),\n\t\t\t),\n\t\t);\n\n\t\tPromise.all([grammar, semanticTokens]).then(\n\t\t\t([grammar, semanticTokens]) => {\n\t\t\t\tif (this._isDisposed) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\tthis._compute(grammar, semanticTokens, tree?.tree, position);\n\t\t\t\tthis._domNode.style.maxWidth = `${Math.max(this._editor.getLayoutInfo().width * 0.66, 500)}px`;\n\t\t\t\tthis._editor.layoutContentWidget(this);\n\t\t\t},\n\t\t\t(err) => {\n\t\t\t\tthis._notificationService.warn(err);\n\n\t\t\t\tsetTimeout(() => {\n\t\t\t\t\tInspectEditorTokensController.get(this._editor)?.stop();\n\t\t\t\t});\n\t\t\t},\n\t\t);\n\t}\n\n\tprivate _isSemanticColoringEnabled() {\n\t\tconst setting =\n\t\t\tthis._configurationService.getValue<IEditorSemanticHighlightingOptions>(\n\t\t\t\tSEMANTIC_HIGHLIGHTING_SETTING_ID,\n\t\t\t\t{\n\t\t\t\t\toverrideIdentifier: this._model.getLanguageId(),\n\t\t\t\t\tresource: this._model.uri,\n\t\t\t\t},\n\t\t\t)?.enabled;\n\t\tif (typeof setting === \"boolean\") {\n\t\t\treturn setting;\n\t\t}\n\t\treturn this._themeService.getColorTheme().semanticHighlighting;\n\t}\n\n\tprivate _compute(\n\t\tgrammar: IGrammar | null,\n\t\tsemanticTokens: SemanticTokensResult | null,\n\t\ttree: Parser.Tree | undefined,\n\t\tposition: Position,\n\t) {\n\t\tconst textMateTokenInfo =\n\t\t\tgrammar && this._getTokensAtPosition(grammar, position);\n\t\tconst semanticTokenInfo =\n\t\t\tsemanticTokens &&\n\t\t\tthis._getSemanticTokenAtPosition(semanticTokens, position);\n\t\tconst treeSitterTokenInfo =\n\t\t\ttree && this._getTreeSitterTokenAtPosition(tree, position);\n\t\tif (!textMateTokenInfo && !semanticTokenInfo && !treeSitterTokenInfo) {\n\t\t\tdom.reset(\n\t\t\t\tthis._domNode,\n\t\t\t\t\"No grammar or semantic tokens available.\",\n\t\t\t);\n\t\t\treturn;\n\t\t}\n\n\t\tconst tmMetadata = textMateTokenInfo?.metadata;\n\t\tconst semMetadata = semanticTokenInfo?.metadata;\n\n\t\tconst semTokenText =\n\t\t\tsemanticTokenInfo &&\n\t\t\trenderTokenText(\n\t\t\t\tthis._model.getValueInRange(semanticTokenInfo.range),\n\t\t\t);\n\t\tconst tmTokenText =\n\t\t\ttextMateTokenInfo &&\n\t\t\trenderTokenText(\n\t\t\t\tthis._model\n\t\t\t\t\t.getLineContent(position.lineNumber)\n\t\t\t\t\t.substring(\n\t\t\t\t\t\ttextMateTokenInfo.token.startIndex,\n\t\t\t\t\t\ttextMateTokenInfo.token.endIndex,\n\t\t\t\t\t),\n\t\t\t);\n\n\t\tconst tokenText = semTokenText || tmTokenText || \"\";\n\n\t\tdom.reset(\n\t\t\tthis._domNode,\n\t\t\t$(\n\t\t\t\t\"h2.tiw-token\",\n\t\t\t\tundefined,\n\t\t\t\ttokenText,\n\t\t\t\t$(\n\t\t\t\t\t\"span.tiw-token-length\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t`${tokenText.length} ${tokenText.length === 1 ? \"char\" : \"chars\"}`,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t\tdom.append(\n\t\t\tthis._domNode,\n\t\t\t$(\"hr.tiw-metadata-separator\", { style: \"clear:both\" }),\n\t\t);\n\t\tdom.append(\n\t\t\tthis._domNode,\n\t\t\t$(\n\t\t\t\t\"table.tiw-metadata-table\",\n\t\t\t\tundefined,\n\t\t\t\t$(\n\t\t\t\t\t\"tbody\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"language\"),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\ttmMetadata?.languageId || \"\",\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"standard token type\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tthis._tokenTypeToString(\n\t\t\t\t\t\t\t\ttmMetadata?.tokenType ||\n\t\t\t\t\t\t\t\t\tStandardTokenType.Other,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\t...this._formatMetadata(semMetadata, tmMetadata),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\n\t\tif (semanticTokenInfo) {\n\t\t\tdom.append(this._domNode, $(\"hr.tiw-metadata-separator\"));\n\t\t\tconst table = dom.append(\n\t\t\t\tthis._domNode,\n\t\t\t\t$(\"table.tiw-metadata-table\", undefined),\n\t\t\t);\n\t\t\tconst tbody = dom.append(\n\t\t\t\ttable,\n\t\t\t\t$(\n\t\t\t\t\t\"tbody\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"semantic token type\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tsemanticTokenInfo.type,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (semanticTokenInfo.modifiers.length) {\n\t\t\t\tdom.append(\n\t\t\t\t\ttbody,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"modifiers\"),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tsemanticTokenInfo.modifiers.join(\" \"),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\tif (semanticTokenInfo.metadata) {\n\t\t\t\tconst properties: (keyof TokenStyleData)[] = [\n\t\t\t\t\t\"foreground\",\n\t\t\t\t\t\"bold\",\n\t\t\t\t\t\"italic\",\n\t\t\t\t\t\"underline\",\n\t\t\t\t\t\"strikethrough\",\n\t\t\t\t];\n\t\t\t\tconst propertiesByDefValue: { [rule: string]: string[] } = {};\n\t\t\t\tconst allDefValues = new Array<\n\t\t\t\t\t[Array<HTMLElement | string>, string]\n\t\t\t\t>(); // remember the order\n\t\t\t\t// first collect to detect when the same rule is used for multiple properties\n\t\t\t\tfor (const property of properties) {\n\t\t\t\t\tif (semanticTokenInfo.metadata[property] !== undefined) {\n\t\t\t\t\t\tconst definition =\n\t\t\t\t\t\t\tsemanticTokenInfo.definitions[property];\n\t\t\t\t\t\tconst defValue = this._renderTokenStyleDefinition(\n\t\t\t\t\t\t\tdefinition,\n\t\t\t\t\t\t\tproperty,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst defValueStr = defValue\n\t\t\t\t\t\t\t.map((el) =>\n\t\t\t\t\t\t\t\tdom.isHTMLElement(el) ? el.outerHTML : el,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.join();\n\t\t\t\t\t\tlet properties = propertiesByDefValue[defValueStr];\n\t\t\t\t\t\tif (!properties) {\n\t\t\t\t\t\t\tpropertiesByDefValue[defValueStr] = properties = [];\n\t\t\t\t\t\t\tallDefValues.push([defValue, defValueStr]);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tproperties.push(property);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfor (const [defValue, defValueStr] of allDefValues) {\n\t\t\t\t\tdom.append(\n\t\t\t\t\t\ttbody,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\tpropertiesByDefValue[defValueStr].join(\", \"),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t$(\"td.tiw-metadata-value\", undefined, ...defValue),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (textMateTokenInfo) {\n\t\t\tconst theme = this._themeService.getColorTheme();\n\t\t\tdom.append(this._domNode, $(\"hr.tiw-metadata-separator\"));\n\t\t\tconst table = dom.append(\n\t\t\t\tthis._domNode,\n\t\t\t\t$(\"table.tiw-metadata-table\"),\n\t\t\t);\n\t\t\tconst tbody = dom.append(table, $(\"tbody\"));\n\n\t\t\tif (tmTokenText && tmTokenText !== tokenText) {\n\t\t\t\tdom.append(\n\t\t\t\t\ttbody,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"textmate token\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t`${tmTokenText} (${tmTokenText.length})`,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\tconst scopes = new Array<HTMLElement | string>();\n\t\t\tfor (\n\t\t\t\tlet i = textMateTokenInfo.token.scopes.length - 1;\n\t\t\t\ti >= 0;\n\t\t\t\ti--\n\t\t\t) {\n\t\t\t\tscopes.push(textMateTokenInfo.token.scopes[i]);\n\t\t\t\tif (i > 0) {\n\t\t\t\t\tscopes.push($(\"br\"));\n\t\t\t\t}\n\t\t\t}\n\t\t\tdom.append(\n\t\t\t\ttbody,\n\t\t\t\t$(\n\t\t\t\t\t\"tr\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\"textmate scopes\" as string,\n\t\t\t\t\t),\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-value.tiw-metadata-scopes\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t...scopes,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tconst matchingRule = findMatchingThemeRule(\n\t\t\t\ttheme,\n\t\t\t\ttextMateTokenInfo.token.scopes,\n\t\t\t\tfalse,\n\t\t\t);\n\t\t\tconst semForeground = semanticTokenInfo?.metadata?.foreground;\n\t\t\tif (matchingRule) {\n\t\t\t\tif (semForeground !== textMateTokenInfo.metadata.foreground) {\n\t\t\t\t\tlet defValue = $(\n\t\t\t\t\t\t\"code.tiw-theme-selector\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tmatchingRule.rawSelector,\n\t\t\t\t\t\t$(\"br\"),\n\t\t\t\t\t\tJSON.stringify(matchingRule.settings, null, \"\\t\"),\n\t\t\t\t\t);\n\t\t\t\t\tif (semForeground) {\n\t\t\t\t\t\tdefValue = $(\"s\", undefined, defValue);\n\t\t\t\t\t}\n\t\t\t\t\tdom.append(\n\t\t\t\t\t\ttbody,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"foreground\"),\n\t\t\t\t\t\t\t$(\"td.tiw-metadata-value\", undefined, defValue),\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else if (!semForeground) {\n\t\t\t\tdom.append(\n\t\t\t\t\ttbody,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"foreground\"),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"No theme selector\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tif (treeSitterTokenInfo) {\n\t\t\tdom.append(this._domNode, $(\"hr.tiw-metadata-separator\"));\n\t\t\tconst table = dom.append(\n\t\t\t\tthis._domNode,\n\t\t\t\t$(\"table.tiw-metadata-table\"),\n\t\t\t);\n\t\t\tconst tbody = dom.append(table, $(\"tbody\"));\n\n\t\t\tdom.append(\n\t\t\t\ttbody,\n\t\t\t\t$(\n\t\t\t\t\t\"tr\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\"tree-sitter token\" as string,\n\t\t\t\t\t),\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t`${treeSitterTokenInfo.text}`,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\t\t\tconst scopes = new Array<HTMLElement | string>();\n\t\t\tlet node = treeSitterTokenInfo;\n\t\t\twhile (node.parent) {\n\t\t\t\tscopes.push(node.type);\n\t\t\t\tnode = node.parent;\n\t\t\t\tif (node) {\n\t\t\t\t\tscopes.push($(\"br\"));\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tdom.append(\n\t\t\t\ttbody,\n\t\t\t\t$(\n\t\t\t\t\t\"tr\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\"tree-sitter scopes\" as string,\n\t\t\t\t\t),\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"td.tiw-metadata-value.tiw-metadata-scopes\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t...scopes,\n\t\t\t\t\t),\n\t\t\t\t),\n\t\t\t);\n\n\t\t\tconst tokenizationSupport = TreeSitterTokenizationRegistry.get(\n\t\t\t\tthis._model.getLanguageId(),\n\t\t\t);\n\t\t\tconst captures = tokenizationSupport?.captureAtPosition(\n\t\t\t\tposition.lineNumber,\n\t\t\t\tposition.column,\n\t\t\t\tthis._model,\n\t\t\t);\n\t\t\tif (captures && captures.length > 0) {\n\t\t\t\tdom.append(\n\t\t\t\t\ttbody,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"foreground\"),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tcaptures[captures.length - 1].name,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate _formatMetadata(\n\t\tsemantic?: IDecodedMetadata,\n\t\ttm?: IDecodedMetadata,\n\t): Array<HTMLElement | string> {\n\t\tconst elements = new Array<HTMLElement | string>();\n\n\t\tfunction render(property: \"foreground\" | \"background\") {\n\t\t\tconst value = semantic?.[property] || tm?.[property];\n\t\t\tif (value !== undefined) {\n\t\t\t\tconst semanticStyle = semantic?.[property]\n\t\t\t\t\t? \"tiw-metadata-semantic\"\n\t\t\t\t\t: \"\";\n\t\t\t\telements.push(\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, property),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t`td.tiw-metadata-value.${semanticStyle}`,\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tvalue,\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t\treturn value;\n\t\t}\n\n\t\tconst foreground = render(\"foreground\");\n\t\tconst background = render(\"background\");\n\t\tif (foreground && background) {\n\t\t\tconst backgroundColor = Color.fromHex(background),\n\t\t\t\tforegroundColor = Color.fromHex(foreground);\n\t\t\tif (backgroundColor.isOpaque()) {\n\t\t\t\telements.push(\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"contrast ratio\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-value\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tbackgroundColor\n\t\t\t\t\t\t\t\t.getContrastRatio(\n\t\t\t\t\t\t\t\t\tforegroundColor.makeOpaque(backgroundColor),\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.toFixed(2),\n\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\telements.push(\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"tr\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"td.tiw-metadata-key\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\t\"Contrast ratio cannot be precise for background colors that use transparency\" as string,\n\t\t\t\t\t\t),\n\t\t\t\t\t\t$(\"td.tiw-metadata-value\"),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\tconst fontStyleLabels = new Array<HTMLElement | string>();\n\n\t\tfunction addStyle(\n\t\t\tkey: \"bold\" | \"italic\" | \"underline\" | \"strikethrough\",\n\t\t) {\n\t\t\tlet label: HTMLElement | string | undefined;\n\t\t\tif (semantic && semantic[key]) {\n\t\t\t\tlabel = $(\"span.tiw-metadata-semantic\", undefined, key);\n\t\t\t} else if (tm && tm[key]) {\n\t\t\t\tlabel = key;\n\t\t\t}\n\t\t\tif (label) {\n\t\t\t\tif (fontStyleLabels.length) {\n\t\t\t\t\tfontStyleLabels.push(\" \");\n\t\t\t\t}\n\t\t\t\tfontStyleLabels.push(label);\n\t\t\t}\n\t\t}\n\t\taddStyle(\"bold\");\n\t\taddStyle(\"italic\");\n\t\taddStyle(\"underline\");\n\t\taddStyle(\"strikethrough\");\n\t\tif (fontStyleLabels.length) {\n\t\t\telements.push(\n\t\t\t\t$(\n\t\t\t\t\t\"tr\",\n\t\t\t\t\tundefined,\n\t\t\t\t\t$(\"td.tiw-metadata-key\", undefined, \"font style\" as string),\n\t\t\t\t\t$(\"td.tiw-metadata-value\", undefined, ...fontStyleLabels),\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t\treturn elements;\n\t}\n\n\tprivate _decodeMetadata(metadata: number): IDecodedMetadata {\n\t\tconst colorMap = this._themeService.getColorTheme().tokenColorMap;\n\t\tconst languageId = TokenMetadata.getLanguageId(metadata);\n\t\tconst tokenType = TokenMetadata.getTokenType(metadata);\n\t\tconst fontStyle = TokenMetadata.getFontStyle(metadata);\n\t\tconst foreground = TokenMetadata.getForeground(metadata);\n\t\tconst background = TokenMetadata.getBackground(metadata);\n\t\treturn {\n\t\t\tlanguageId:\n\t\t\t\tthis._languageService.languageIdCodec.decodeLanguageId(\n\t\t\t\t\tlanguageId,\n\t\t\t\t),\n\t\t\ttokenType: tokenType,\n\t\t\tbold: fontStyle & FontStyle.Bold ? true : undefined,\n\t\t\titalic: fontStyle & FontStyle.Italic ? true : undefined,\n\t\t\tunderline: fontStyle & FontStyle.Underline ? true : undefined,\n\t\t\tstrikethrough:\n\t\t\t\tfontStyle & FontStyle.Strikethrough ? true : undefined,\n\t\t\tforeground: colorMap[foreground],\n\t\t\tbackground: colorMap[background],\n\t\t};\n\t}\n\n\tprivate _tokenTypeToString(tokenType: StandardTokenType): string {\n\t\tswitch (tokenType) {\n\t\t\tcase StandardTokenType.Other:\n\t\t\t\treturn \"Other\";\n\t\t\tcase StandardTokenType.Comment:\n\t\t\t\treturn \"Comment\";\n\t\t\tcase StandardTokenType.String:\n\t\t\t\treturn \"String\";\n\t\t\tcase StandardTokenType.RegEx:\n\t\t\t\treturn \"RegEx\";\n\t\t\tdefault:\n\t\t\t\treturn \"??\";\n\t\t}\n\t}\n\n\tprivate _getTokensAtPosition(\n\t\tgrammar: IGrammar,\n\t\tposition: Position,\n\t): ITextMateTokenInfo {\n\t\tconst lineNumber = position.lineNumber;\n\t\tconst stateBeforeLine = this._getStateBeforeLine(grammar, lineNumber);\n\n\t\tconst tokenizationResult1 = grammar.tokenizeLine(\n\t\t\tthis._model.getLineContent(lineNumber),\n\t\t\tstateBeforeLine,\n\t\t);\n\t\tconst tokenizationResult2 = grammar.tokenizeLine2(\n\t\t\tthis._model.getLineContent(lineNumber),\n\t\t\tstateBeforeLine,\n\t\t);\n\n\t\tlet token1Index = 0;\n\t\tfor (let i = tokenizationResult1.tokens.length - 1; i >= 0; i--) {\n\t\t\tconst t = tokenizationResult1.tokens[i];\n\t\t\tif (position.column - 1 >= t.startIndex) {\n\t\t\t\ttoken1Index = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet token2Index = 0;\n\t\tfor (let i = tokenizationResult2.tokens.length >>> 1; i >= 0; i--) {\n\t\t\tif (position.column - 1 >= tokenizationResult2.tokens[i << 1]) {\n\t\t\t\ttoken2Index = i;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\treturn {\n\t\t\ttoken: tokenizationResult1.tokens[token1Index],\n\t\t\tmetadata: this._decodeMetadata(\n\t\t\t\ttokenizationResult2.tokens[(token2Index << 1) + 1],\n\t\t\t),\n\t\t};\n\t}\n\n\tprivate _getStateBeforeLine(\n\t\tgrammar: IGrammar,\n\t\tlineNumber: number,\n\t): StateStack | null {\n\t\tlet state: StateStack | null = null;\n\n\t\tfor (let i = 1; i < lineNumber; i++) {\n\t\t\tconst tokenizationResult = grammar.tokenizeLine(\n\t\t\t\tthis._model.getLineContent(i),\n\t\t\t\tstate,\n\t\t\t);\n\t\t\tstate = tokenizationResult.ruleStack;\n\t\t}\n\n\t\treturn state;\n\t}\n\n\tprivate isSemanticTokens(token: any): token is SemanticTokens {\n\t\treturn token && token.data;\n\t}\n\n\tprivate async _computeSemanticTokens(\n\t\tposition: Position,\n\t): Promise<SemanticTokensResult | null> {\n\t\tif (!this._isSemanticColoringEnabled()) {\n\t\t\treturn null;\n\t\t}\n\n\t\tconst tokenProviders =\n\t\t\tthis._languageFeaturesService.documentSemanticTokensProvider.ordered(\n\t\t\t\tthis._model,\n\t\t\t);\n\t\tif (tokenProviders.length) {\n\t\t\tconst provider = tokenProviders[0];\n\t\t\tconst tokens = await Promise.resolve(\n\t\t\t\tprovider.provideDocumentSemanticTokens(\n\t\t\t\t\tthis._model,\n\t\t\t\t\tnull,\n\t\t\t\t\tthis._currentRequestCancellationTokenSource.token,\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (this.isSemanticTokens(tokens)) {\n\t\t\t\treturn { tokens, legend: provider.getLegend() };\n\t\t\t}\n\t\t}\n\t\tconst rangeTokenProviders =\n\t\t\tthis._languageFeaturesService.documentRangeSemanticTokensProvider.ordered(\n\t\t\t\tthis._model,\n\t\t\t);\n\t\tif (rangeTokenProviders.length) {\n\t\t\tconst provider = rangeTokenProviders[0];\n\t\t\tconst lineNumber = position.lineNumber;\n\t\t\tconst range = new Range(\n\t\t\t\tlineNumber,\n\t\t\t\t1,\n\t\t\t\tlineNumber,\n\t\t\t\tthis._model.getLineMaxColumn(lineNumber),\n\t\t\t);\n\t\t\tconst tokens = await Promise.resolve(\n\t\t\t\tprovider.provideDocumentRangeSemanticTokens(\n\t\t\t\t\tthis._model,\n\t\t\t\t\trange,\n\t\t\t\t\tthis._currentRequestCancellationTokenSource.token,\n\t\t\t\t),\n\t\t\t);\n\t\t\tif (this.isSemanticTokens(tokens)) {\n\t\t\t\treturn { tokens, legend: provider.getLegend() };\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate _getSemanticTokenAtPosition(\n\t\tsemanticTokens: SemanticTokensResult,\n\t\tpos: Position,\n\t): ISemanticTokenInfo | null {\n\t\tconst tokenData = semanticTokens.tokens.data;\n\t\tconst defaultLanguage = this._model.getLanguageId();\n\t\tlet lastLine = 0;\n\t\tlet lastCharacter = 0;\n\t\tconst posLine = pos.lineNumber - 1,\n\t\t\tposCharacter = pos.column - 1; // to 0-based position\n\t\tfor (let i = 0; i < tokenData.length; i += 5) {\n\t\t\tconst lineDelta = tokenData[i],\n\t\t\t\tcharDelta = tokenData[i + 1],\n\t\t\t\tlen = tokenData[i + 2],\n\t\t\t\ttypeIdx = tokenData[i + 3],\n\t\t\t\tmodSet = tokenData[i + 4];\n\t\t\tconst line = lastLine + lineDelta; // 0-based\n\t\t\tconst character =\n\t\t\t\tlineDelta === 0 ? lastCharacter + charDelta : charDelta; // 0-based\n\t\t\tif (\n\t\t\t\tposLine === line &&\n\t\t\t\tcharacter <= posCharacter &&\n\t\t\t\tposCharacter < character + len\n\t\t\t) {\n\t\t\t\tconst type =\n\t\t\t\t\tsemanticTokens.legend.tokenTypes[typeIdx] ||\n\t\t\t\t\t\"not in legend (ignored)\";\n\t\t\t\tconst modifiers = [];\n\t\t\t\tlet modifierSet = modSet;\n\t\t\t\tfor (\n\t\t\t\t\tlet modifierIndex = 0;\n\t\t\t\t\tmodifierSet > 0 &&\n\t\t\t\t\tmodifierIndex < semanticTokens.legend.tokenModifiers.length;\n\t\t\t\t\tmodifierIndex++\n\t\t\t\t) {\n\t\t\t\t\tif (modifierSet & 1) {\n\t\t\t\t\t\tmodifiers.push(\n\t\t\t\t\t\t\tsemanticTokens.legend.tokenModifiers[modifierIndex],\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t\tmodifierSet = modifierSet >> 1;\n\t\t\t\t}\n\t\t\t\tif (modifierSet > 0) {\n\t\t\t\t\tmodifiers.push(\"not in legend (ignored)\");\n\t\t\t\t}\n\t\t\t\tconst range = new Range(\n\t\t\t\t\tline + 1,\n\t\t\t\t\tcharacter + 1,\n\t\t\t\t\tline + 1,\n\t\t\t\t\tcharacter + 1 + len,\n\t\t\t\t);\n\t\t\t\tconst definitions = {};\n\t\t\t\tconst colorMap =\n\t\t\t\t\tthis._themeService.getColorTheme().tokenColorMap;\n\t\t\t\tconst theme =\n\t\t\t\t\tthis._themeService.getColorTheme() as ColorThemeData;\n\t\t\t\tconst tokenStyle = theme.getTokenStyleMetadata(\n\t\t\t\t\ttype,\n\t\t\t\t\tmodifiers,\n\t\t\t\t\tdefaultLanguage,\n\t\t\t\t\ttrue,\n\t\t\t\t\tdefinitions,\n\t\t\t\t);\n\n\t\t\t\tlet metadata: IDecodedMetadata | undefined;\n\t\t\t\tif (tokenStyle) {\n\t\t\t\t\tmetadata = {\n\t\t\t\t\t\tlanguageId: undefined,\n\t\t\t\t\t\ttokenType: StandardTokenType.Other,\n\t\t\t\t\t\tbold: tokenStyle?.bold,\n\t\t\t\t\t\titalic: tokenStyle?.italic,\n\t\t\t\t\t\tunderline: tokenStyle?.underline,\n\t\t\t\t\t\tstrikethrough: tokenStyle?.strikethrough,\n\t\t\t\t\t\tforeground:\n\t\t\t\t\t\t\tcolorMap[tokenStyle?.foreground || ColorId.None],\n\t\t\t\t\t\tbackground: undefined,\n\t\t\t\t\t};\n\t\t\t\t}\n\n\t\t\t\treturn { type, modifiers, range, metadata, definitions };\n\t\t\t}\n\t\t\tlastLine = line;\n\t\t\tlastCharacter = character;\n\t\t}\n\t\treturn null;\n\t}\n\n\tprivate _walkTreeforPosition(\n\t\tcursor: Parser.TreeCursor,\n\t\tpos: Position,\n\t): Parser.SyntaxNode | null {\n\t\tconst offset = this._model.getOffsetAt(pos);\n\t\tcursor.gotoFirstChild();\n\t\tlet goChild = false;\n\t\tlet lastGoodNode: Parser.SyntaxNode | null = null;\n\t\tdo {\n\t\t\tif (\n\t\t\t\tcursor.currentNode.startIndex <= offset &&\n\t\t\t\toffset < cursor.currentNode.endIndex\n\t\t\t) {\n\t\t\t\tgoChild = true;\n\t\t\t\tlastGoodNode = cursor.currentNode;\n\t\t\t} else {\n\t\t\t\tgoChild = false;\n\t\t\t}\n\t\t} while (goChild ? cursor.gotoFirstChild() : cursor.gotoNextSibling());\n\t\treturn lastGoodNode;\n\t}\n\n\tprivate _getTreeSitterTokenAtPosition(\n\t\ttree: Parser.Tree,\n\t\tpos: Position,\n\t): Parser.SyntaxNode | null {\n\t\tconst cursor = tree.walk();\n\n\t\treturn this._walkTreeforPosition(cursor, pos);\n\t}\n\n\tprivate _renderTokenStyleDefinition(\n\t\tdefinition: TokenStyleDefinition | undefined,\n\t\tproperty: keyof TokenStyleData,\n\t): Array<HTMLElement | string> {\n\t\tconst elements = new Array<HTMLElement | string>();\n\t\tif (definition === undefined) {\n\t\t\treturn elements;\n\t\t}\n\t\tconst theme = this._themeService.getColorTheme() as ColorThemeData;\n\n\t\tif (Array.isArray(definition)) {\n\t\t\tconst scopesDefinition: TextMateThemingRuleDefinitions = {};\n\t\t\ttheme.resolveScopes(definition, scopesDefinition);\n\t\t\tconst matchingRule = scopesDefinition[property];\n\t\t\tif (matchingRule && scopesDefinition.scope) {\n\t\t\t\tconst scopes = $(\"ul.tiw-metadata-values\");\n\t\t\t\tconst strScopes = Array.isArray(matchingRule.scope)\n\t\t\t\t\t? matchingRule.scope\n\t\t\t\t\t: [String(matchingRule.scope)];\n\n\t\t\t\tfor (const strScope of strScopes) {\n\t\t\t\t\tscopes.appendChild(\n\t\t\t\t\t\t$(\n\t\t\t\t\t\t\t\"li.tiw-metadata-value.tiw-metadata-scopes\",\n\t\t\t\t\t\t\tundefined,\n\t\t\t\t\t\t\tstrScope,\n\t\t\t\t\t\t),\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\telements.push(\n\t\t\t\t\tscopesDefinition.scope.join(\" \"),\n\t\t\t\t\tscopes,\n\t\t\t\t\t$(\n\t\t\t\t\t\t\"code.tiw-theme-selector\",\n\t\t\t\t\t\tundefined,\n\t\t\t\t\t\tJSON.stringify(matchingRule.settings, null, \"\\t\"),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t\treturn elements;\n\t\t\t}\n\t\t\treturn elements;\n\t\t} else if (SemanticTokenRule.is(definition)) {\n\t\t\tconst scope = theme.getTokenStylingRuleScope(definition);\n\t\t\tif (scope === \"setting\") {\n\t\t\t\telements.push(\n\t\t\t\t\t`User settings: ${definition.selector.id} - ${this._renderStyleProperty(definition.style, property)}`,\n\t\t\t\t);\n\t\t\t\treturn elements;\n\t\t\t} else if (scope === \"theme\") {\n\t\t\t\telements.push(\n\t\t\t\t\t`Color theme: ${definition.selector.id} - ${this._renderStyleProperty(definition.style, property)}`,\n\t\t\t\t);\n\t\t\t\treturn elements;\n\t\t\t}\n\t\t\treturn elements;\n\t\t} else {\n\t\t\tconst style = theme.resolveTokenStyleValue(definition);\n\t\t\telements.push(\n\t\t\t\t`Default: ${style ? this._renderStyleProperty(style, property) : \"\"}`,\n\t\t\t);\n\t\t\treturn elements;\n\t\t}\n\t}\n\n\tprivate _renderStyleProperty(\n\t\tstyle: TokenStyle,\n\t\tproperty: keyof TokenStyleData,\n\t) {\n\t\tswitch (property) {\n\t\t\tcase \"foreground\":\n\t\t\t\treturn style.foreground\n\t\t\t\t\t? Color.Format.CSS.formatHexA(style.foreground, true)\n\t\t\t\t\t: \"\";\n\t\t\tdefault:\n\t\t\t\treturn style[property] !== undefined\n\t\t\t\t\t? String(style[property])\n\t\t\t\t\t: \"\";\n\t\t}\n\t}\n\n\tpublic getDomNode(): HTMLElement {\n\t\treturn this._domNode;\n\t}\n\n\tpublic getPosition(): IContentWidgetPosition {\n\t\treturn {\n\t\t\tposition: this._editor.getPosition(),\n\t\t\tpreference: [\n\t\t\t\tContentWidgetPositionPreference.BELOW,\n\t\t\t\tContentWidgetPositionPreference.ABOVE,\n\t\t\t],\n\t\t};\n\t}\n}\n\nregisterEditorContribution(\n\tInspectEditorTokensController.ID,\n\tInspectEditorTokensController,\n\tEditorContributionInstantiation.Lazy,\n);\nregisterEditorAction(InspectEditorTokens);\n"],
  "mappings": "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",
  "names": ["grammar", "semanticTokens", "properties"]
}
