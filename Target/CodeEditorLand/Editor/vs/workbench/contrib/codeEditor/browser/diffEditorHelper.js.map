{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/codeEditor/browser/diffEditorHelper.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport {\n\tautorunWithStore,\n\tobservableFromEvent,\n} from \"../../../../base/common/observable.js\";\nimport type { IDiffEditor } from \"../../../../editor/browser/editorBrowser.js\";\nimport { registerDiffEditorContribution } from \"../../../../editor/browser/editorExtensions.js\";\nimport { EmbeddedDiffEditorWidget } from \"../../../../editor/browser/widget/diffEditor/embeddedDiffEditorWidget.js\";\nimport type { IDiffEditorContribution } from \"../../../../editor/common/editorCommon.js\";\nimport { ITextResourceConfigurationService } from \"../../../../editor/common/services/textResourceConfiguration.js\";\nimport { localize } from \"../../../../nls.js\";\nimport { AccessibleViewRegistry } from \"../../../../platform/accessibility/browser/accessibleViewRegistry.js\";\nimport { IInstantiationService } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport {\n\tINotificationService,\n\tSeverity,\n} from \"../../../../platform/notification/common/notification.js\";\nimport { Registry } from \"../../../../platform/registry/common/platform.js\";\nimport { FloatingEditorClickWidget } from \"../../../browser/codeeditor.js\";\nimport {\n\tExtensions,\n\ttype IConfigurationMigrationRegistry,\n} from \"../../../common/configuration.js\";\nimport { DiffEditorAccessibilityHelp } from \"./diffEditorAccessibilityHelp.js\";\n\nclass DiffEditorHelperContribution\n\textends Disposable\n\timplements IDiffEditorContribution\n{\n\tpublic static readonly ID = \"editor.contrib.diffEditorHelper\";\n\n\tconstructor(\n\t\tprivate readonly _diffEditor: IDiffEditor,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t\t@ITextResourceConfigurationService private readonly _textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@INotificationService private readonly _notificationService: INotificationService,\n\t) {\n\t\tsuper();\n\n\t\tconst isEmbeddedDiffEditor = this._diffEditor instanceof EmbeddedDiffEditorWidget;\n\n\t\tif (!isEmbeddedDiffEditor) {\n\t\t\tconst computationResult = observableFromEvent(this, e => this._diffEditor.onDidUpdateDiff(e), () => /** @description diffEditor.diffComputationResult */ this._diffEditor.getDiffComputationResult());\n\t\t\tconst onlyWhiteSpaceChange = computationResult.map(r => r && !r.identical && r.changes2.length === 0);\n\n\t\t\tthis._register(autorunWithStore((reader, store) => {\n\t\t\t\t/** @description update state */\n\t\t\t\tif (onlyWhiteSpaceChange.read(reader)) {\n\t\t\t\t\tconst helperWidget = store.add(this._instantiationService.createInstance(\n\t\t\t\t\t\tFloatingEditorClickWidget,\n\t\t\t\t\t\tthis._diffEditor.getModifiedEditor(),\n\t\t\t\t\t\tlocalize('hintWhitespace', \"Show Whitespace Differences\"),\n\t\t\t\t\t\tnull\n\t\t\t\t\t));\n\t\t\t\t\tstore.add(helperWidget.onClick(() => {\n\t\t\t\t\t\tthis._textResourceConfigurationService.updateValue(this._diffEditor.getModel()!.modified.uri, 'diffEditor.ignoreTrimWhitespace', false);\n\t\t\t\t\t}));\n\t\t\t\t\thelperWidget.render();\n\t\t\t\t}\n\t\t\t}));\n\n\t\t\tthis._register(this._diffEditor.onDidUpdateDiff(() => {\n\t\t\t\tconst diffComputationResult = this._diffEditor.getDiffComputationResult();\n\n\t\t\t\tif (diffComputationResult && diffComputationResult.quitEarly) {\n\t\t\t\t\tthis._notificationService.prompt(\n\t\t\t\t\t\tSeverity.Warning,\n\t\t\t\t\t\tlocalize('hintTimeout', \"The diff algorithm was stopped early (after {0} ms.)\", this._diffEditor.maxComputationTime),\n\t\t\t\t\t\t[{\n\t\t\t\t\t\t\tlabel: localize('removeTimeout', \"Remove Limit\"),\n\t\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\t\tthis._textResourceConfigurationService.updateValue(this._diffEditor.getModel()!.modified.uri, 'diffEditor.maxComputationTime', 0);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}],\n\t\t\t\t\t\t{}\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}));\n\t\t}\n\t}\n}\n\nregisterDiffEditorContribution(\n\tDiffEditorHelperContribution.ID,\n\tDiffEditorHelperContribution,\n);\n\nRegistry.as<IConfigurationMigrationRegistry>(\n\tExtensions.ConfigurationMigration,\n).registerConfigurationMigrations([\n\t{\n\t\tkey: \"diffEditor.experimental.collapseUnchangedRegions\",\n\t\tmigrateFn: (value, accessor) => {\n\t\t\treturn [\n\t\t\t\t[\"diffEditor.hideUnchangedRegions.enabled\", { value }],\n\t\t\t\t[\n\t\t\t\t\t\"diffEditor.experimental.collapseUnchangedRegions\",\n\t\t\t\t\t{ value: undefined },\n\t\t\t\t],\n\t\t\t];\n\t\t},\n\t},\n]);\nAccessibleViewRegistry.register(new DiffEditorAccessibilityHelp());\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,kBAAkB;AAC3B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAEP,SAAS,sCAAsC;AAC/C,SAAS,gCAAgC;AAEzC,SAAS,yCAAyC;AAClD,SAAS,gBAAgB;AACzB,SAAS,8BAA8B;AACvC,SAAS,6BAA6B;AACtC;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,gBAAgB;AACzB,SAAS,iCAAiC;AAC1C;AAAA,EACC;AAAA,OAEM;AACP,SAAS,mCAAmC;AAE5C,IAAM,+BAAN,cACS,WAET;AAAA,EAGC,YACkB,aACuB,uBACY,mCACb,sBACtC;AACD,UAAM;AALW;AACuB;AACY;AACb;AAIvC,UAAM,uBAAuB,KAAK,uBAAuB;AAEzD,QAAI,CAAC,sBAAsB;AAC1B,YAAM,oBAAoB,oBAAoB,MAAM,OAAK,KAAK,YAAY,gBAAgB,CAAC,GAAG;AAAA;AAAA,QAA2D,KAAK,YAAY,yBAAyB;AAAA,OAAC;AACpM,YAAM,uBAAuB,kBAAkB,IAAI,OAAK,KAAK,CAAC,EAAE,aAAa,EAAE,SAAS,WAAW,CAAC;AAEpG,WAAK,UAAU,iBAAiB,CAAC,QAAQ,UAAU;AAElD,YAAI,qBAAqB,KAAK,MAAM,GAAG;AACtC,gBAAM,eAAe,MAAM,IAAI,KAAK,sBAAsB;AAAA,YACzD;AAAA,YACA,KAAK,YAAY,kBAAkB;AAAA,YACnC,SAAS,kBAAkB,6BAA6B;AAAA,YACxD;AAAA,UACD,CAAC;AACD,gBAAM,IAAI,aAAa,QAAQ,MAAM;AACpC,iBAAK,kCAAkC,YAAY,KAAK,YAAY,SAAS,EAAG,SAAS,KAAK,mCAAmC,KAAK;AAAA,UACvI,CAAC,CAAC;AACF,uBAAa,OAAO;AAAA,QACrB;AAAA,MACD,CAAC,CAAC;AAEF,WAAK,UAAU,KAAK,YAAY,gBAAgB,MAAM;AACrD,cAAM,wBAAwB,KAAK,YAAY,yBAAyB;AAExE,YAAI,yBAAyB,sBAAsB,WAAW;AAC7D,eAAK,qBAAqB;AAAA,YACzB,SAAS;AAAA,YACT,SAAS,eAAe,wDAAwD,KAAK,YAAY,kBAAkB;AAAA,YACnH,CAAC;AAAA,cACA,OAAO,SAAS,iBAAiB,cAAc;AAAA,cAC/C,KAAK,6BAAM;AACV,qBAAK,kCAAkC,YAAY,KAAK,YAAY,SAAS,EAAG,SAAS,KAAK,iCAAiC,CAAC;AAAA,cACjI,GAFK;AAAA,YAGN,CAAC;AAAA,YACD,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD,CAAC,CAAC;AAAA,IACH;AAAA,EACD;AAAA,EApFD,OAiCA;AAAA;AAAA;AAAA,EACC,OAAuB,KAAK;AAmD7B;AAvDM,+BAAN;AAAA,EAQG;AAAA,EACA;AAAA,EACA;AAAA,GAVG;AAyDN;AAAA,EACC,6BAA6B;AAAA,EAC7B;AACD;AAEA,SAAS;AAAA,EACR,WAAW;AACZ,EAAE,gCAAgC;AAAA,EACjC;AAAA,IACC,KAAK;AAAA,IACL,WAAW,wBAAC,OAAO,aAAa;AAC/B,aAAO;AAAA,QACN,CAAC,2CAA2C,EAAE,MAAM,CAAC;AAAA,QACrD;AAAA,UACC;AAAA,UACA,EAAE,OAAO,OAAU;AAAA,QACpB;AAAA,MACD;AAAA,IACD,GARW;AAAA,EASZ;AACD,CAAC;AACD,uBAAuB,SAAS,IAAI,4BAA4B,CAAC;",
  "names": []
}
