var g=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var l=(o,t,n,r)=>{for(var e=r>1?void 0:r?h(t,n):t,a=o.length-1,d;a>=0;a--)(d=o[a])&&(e=(r?d(t,n,e):d(e))||e);return r&&e&&g(t,n,e),e},s=(o,t)=>(n,r)=>t(n,r,o);import{Disposable as E}from"../../../../base/common/lifecycle.js";import{autorunWithStore as v,observableFromEvent as _}from"../../../../base/common/observable.js";import"../../../../editor/browser/editorBrowser.js";import{registerDiffEditorContribution as R}from"../../../../editor/browser/editorExtensions.js";import{EmbeddedDiffEditorWidget as C}from"../../../../editor/browser/widget/diffEditor/embeddedDiffEditorWidget.js";import"../../../../editor/common/editorCommon.js";import{ITextResourceConfigurationService as I}from"../../../../editor/common/services/textResourceConfiguration.js";import{localize as m}from"../../../../nls.js";import{AccessibleViewRegistry as S}from"../../../../platform/accessibility/browser/accessibleViewRegistry.js";import{IInstantiationService as D}from"../../../../platform/instantiation/common/instantiation.js";import{INotificationService as y,Severity as b}from"../../../../platform/notification/common/notification.js";import{Registry as x}from"../../../../platform/registry/common/platform.js";import{FloatingEditorClickWidget as W}from"../../../browser/codeeditor.js";import{Extensions as T}from"../../../common/configuration.js";import{DiffEditorAccessibilityHelp as M}from"./diffEditorAccessibilityHelp.js";let f=class extends E{constructor(n,r,e,a){super();this._diffEditor=n;this._instantiationService=r;this._textResourceConfigurationService=e;this._notificationService=a;if(!(this._diffEditor instanceof C)){const u=_(this,i=>this._diffEditor.onDidUpdateDiff(i),()=>this._diffEditor.getDiffComputationResult()).map(i=>i&&!i.identical&&i.changes2.length===0);this._register(v((i,c)=>{if(u.read(i)){const p=c.add(this._instantiationService.createInstance(W,this._diffEditor.getModifiedEditor(),m("hintWhitespace","Show Whitespace Differences"),null));c.add(p.onClick(()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.ignoreTrimWhitespace",!1)})),p.render()}})),this._register(this._diffEditor.onDidUpdateDiff(()=>{const i=this._diffEditor.getDiffComputationResult();i&&i.quitEarly&&this._notificationService.prompt(b.Warning,m("hintTimeout","The diff algorithm was stopped early (after {0} ms.)",this._diffEditor.maxComputationTime),[{label:m("removeTimeout","Remove Limit"),run:()=>{this._textResourceConfigurationService.updateValue(this._diffEditor.getModel().modified.uri,"diffEditor.maxComputationTime",0)}}],{})}))}}static ID="editor.contrib.diffEditorHelper"};f=l([s(1,D),s(2,I),s(3,y)],f),R(f.ID,f),x.as(T.ConfigurationMigration).registerConfigurationMigrations([{key:"diffEditor.experimental.collapseUnchangedRegions",migrateFn:(o,t)=>[["diffEditor.hideUnchangedRegions.enabled",{value:o}],["diffEditor.experimental.collapseUnchangedRegions",{value:void 0}]]}]),S.register(new M);
