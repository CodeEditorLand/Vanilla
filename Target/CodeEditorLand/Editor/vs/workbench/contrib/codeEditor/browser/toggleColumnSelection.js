import{CoreNavigationCommands as g}from"../../../../../vs/editor/browser/coreCommands.js";import"../../../../../vs/editor/browser/editorBrowser.js";import{ICodeEditorService as f}from"../../../../../vs/editor/browser/services/codeEditorService.js";import{EditorOption as v}from"../../../../../vs/editor/common/config/editorOptions.js";import{Position as s}from"../../../../../vs/editor/common/core/position.js";import{Selection as p}from"../../../../../vs/editor/common/core/selection.js";import{localize as w,localize2 as V}from"../../../../../vs/nls.js";import{Action2 as P,MenuId as b,registerAction2 as E}from"../../../../../vs/platform/actions/common/actions.js";import{IConfigurationService as M}from"../../../../../vs/platform/configuration/common/configuration.js";import{ContextKeyExpr as N}from"../../../../../vs/platform/contextkey/common/contextkey.js";import"../../../../../vs/platform/instantiation/common/instantiation.js";class d extends P{static ID="editor.action.toggleColumnSelection";constructor(){super({id:d.ID,title:{...V("toggleColumnSelection","Toggle Column Selection Mode"),mnemonicTitle:w({key:"miColumnSelection",comment:["&& denotes a mnemonic"]},"Column &&Selection Mode")},f1:!0,toggled:N.equals("config.editor.columnSelection",!0),menu:{id:b.MenubarSelectionMenu,group:"4_config",order:2}})}async run(n){const t=n.get(M),C=n.get(f),u=t.getValue("editor.columnSelection"),i=this._getCodeEditor(C);await t.updateValue("editor.columnSelection",!u);const a=t.getValue("editor.columnSelection");if(!i||i!==this._getCodeEditor(C)||u===a||!i.hasModel()||typeof u!="boolean"||typeof a!="boolean")return;const o=i._getViewModel();if(i.getOption(v.columnSelection)){const e=i.getSelection(),l=new s(e.selectionStartLineNumber,e.selectionStartColumn),c=o.coordinatesConverter.convertModelPositionToViewPosition(l),m=new s(e.positionLineNumber,e.positionColumn),r=o.coordinatesConverter.convertModelPositionToViewPosition(m);g.MoveTo.runCoreEditorCommand(o,{position:l,viewPosition:c});const S=o.cursorConfig.visibleColumnFromColumn(o,r);g.ColumnSelect.runCoreEditorCommand(o,{position:m,viewPosition:r,doColumnSelect:!0,mouseColumn:S+1})}else{const e=o.getCursorColumnSelectData(),l=o.cursorConfig.columnFromVisibleColumn(o,e.fromViewLineNumber,e.fromViewVisualColumn),c=o.coordinatesConverter.convertViewPositionToModelPosition(new s(e.fromViewLineNumber,l)),m=o.cursorConfig.columnFromVisibleColumn(o,e.toViewLineNumber,e.toViewVisualColumn),r=o.coordinatesConverter.convertViewPositionToModelPosition(new s(e.toViewLineNumber,m));i.setSelection(new p(c.lineNumber,c.column,r.lineNumber,r.column))}}_getCodeEditor(n){const t=n.getFocusedCodeEditor();return t||n.getActiveCodeEditor()}}E(d);export{d as ToggleColumnSelectionAction};
