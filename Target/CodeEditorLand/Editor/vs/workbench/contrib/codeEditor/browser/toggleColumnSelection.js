import{localize as f,localize2 as v}from"../../../../nls.js";import{Action2 as p,MenuId as w,registerAction2 as V}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as P}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as b}from"../../../../platform/contextkey/common/contextkey.js";import{ICodeEditorService as E}from"../../../../editor/browser/services/codeEditorService.js";import{EditorOption as M}from"../../../../editor/common/config/editorOptions.js";import"../../../../editor/browser/editorBrowser.js";import{CoreNavigationCommands as g}from"../../../../editor/browser/coreCommands.js";import{Position as s}from"../../../../editor/common/core/position.js";import{Selection as N}from"../../../../editor/common/core/selection.js";import"../../../../platform/instantiation/common/instantiation.js";class d extends p{static ID="editor.action.toggleColumnSelection";constructor(){super({id:d.ID,title:{...v("toggleColumnSelection","Toggle Column Selection Mode"),mnemonicTitle:f({key:"miColumnSelection",comment:["&& denotes a mnemonic"]},"Column &&Selection Mode")},f1:!0,toggled:b.equals("config.editor.columnSelection",!0),menu:{id:w.MenubarSelectionMenu,group:"4_config",order:2}})}async run(n){const t=n.get(P),C=n.get(E),u=t.getValue("editor.columnSelection"),i=this._getCodeEditor(C);await t.updateValue("editor.columnSelection",!u);const a=t.getValue("editor.columnSelection");if(!i||i!==this._getCodeEditor(C)||u===a||!i.hasModel()||typeof u!="boolean"||typeof a!="boolean")return;const o=i._getViewModel();if(i.getOption(M.columnSelection)){const e=i.getSelection(),l=new s(e.selectionStartLineNumber,e.selectionStartColumn),c=o.coordinatesConverter.convertModelPositionToViewPosition(l),m=new s(e.positionLineNumber,e.positionColumn),r=o.coordinatesConverter.convertModelPositionToViewPosition(m);g.MoveTo.runCoreEditorCommand(o,{position:l,viewPosition:c});const S=o.cursorConfig.visibleColumnFromColumn(o,r);g.ColumnSelect.runCoreEditorCommand(o,{position:m,viewPosition:r,doColumnSelect:!0,mouseColumn:S+1})}else{const e=o.getCursorColumnSelectData(),l=o.cursorConfig.columnFromVisibleColumn(o,e.fromViewLineNumber,e.fromViewVisualColumn),c=o.coordinatesConverter.convertViewPositionToModelPosition(new s(e.fromViewLineNumber,l)),m=o.cursorConfig.columnFromVisibleColumn(o,e.toViewLineNumber,e.toViewVisualColumn),r=o.coordinatesConverter.convertViewPositionToModelPosition(new s(e.toViewLineNumber,m));i.setSelection(new N(c.lineNumber,c.column,r.lineNumber,r.column))}}_getCodeEditor(n){const t=n.getFocusedCodeEditor();return t||n.getActiveCodeEditor()}}V(d);export{d as ToggleColumnSelectionAction};
