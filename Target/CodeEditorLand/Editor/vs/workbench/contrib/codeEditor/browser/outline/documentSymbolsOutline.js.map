{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/codeEditor/browser/outline/documentSymbolsOutline.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { IDataSource } from \"../../../../../base/browser/ui/tree/tree.js\";\nimport {\n\tBarrier,\n\tTimeoutTimer,\n\traceCancellation,\n\ttimeout,\n} from \"../../../../../base/common/async.js\";\nimport {\n\ttype CancellationToken,\n\tCancellationTokenSource,\n} from \"../../../../../base/common/cancellation.js\";\nimport { onUnexpectedError } from \"../../../../../base/common/errors.js\";\nimport { Emitter, type Event } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n\ttype IDisposable,\n\ttoDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { isEqual } from \"../../../../../base/common/resources.js\";\nimport type { URI } from \"../../../../../base/common/uri.js\";\nimport {\n\ttype ICodeEditor,\n\tisCodeEditor,\n\tisDiffEditor,\n} from \"../../../../../editor/browser/editorBrowser.js\";\nimport { ICodeEditorService } from \"../../../../../editor/browser/services/codeEditorService.js\";\nimport type { IPosition } from \"../../../../../editor/common/core/position.js\";\nimport { Range } from \"../../../../../editor/common/core/range.js\";\nimport { ScrollType } from \"../../../../../editor/common/editorCommon.js\";\nimport type { ITextModel } from \"../../../../../editor/common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../../../editor/common/services/languageFeatures.js\";\nimport { IMarkerDecorationsService } from \"../../../../../editor/common/services/markerDecorations.js\";\nimport { ITextResourceConfigurationService } from \"../../../../../editor/common/services/textResourceConfiguration.js\";\nimport type { IModelContentChangedEvent } from \"../../../../../editor/common/textModelEvents.js\";\nimport {\n\ttype IOutlineMarker,\n\tIOutlineModelService,\n\tOutlineElement,\n\tOutlineGroup,\n\tOutlineModel,\n\tTreeElement,\n} from \"../../../../../editor/contrib/documentSymbols/browser/outlineModel.js\";\nimport { localize } from \"../../../../../nls.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport {\n\ttype IEditorOptions,\n\tTextEditorSelectionRevealType,\n} from \"../../../../../platform/editor/common/editor.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { MarkerSeverity } from \"../../../../../platform/markers/common/markers.js\";\nimport { Registry } from \"../../../../../platform/registry/common/platform.js\";\nimport {\n\ttype IWorkbenchContributionsRegistry,\n\tExtensions as WorkbenchExtensions,\n} from \"../../../../common/contributions.js\";\nimport type { IEditorPane } from \"../../../../common/editor.js\";\nimport { LifecyclePhase } from \"../../../../services/lifecycle/common/lifecycle.js\";\nimport {\n\ttype IBreadcrumbsDataSource,\n\ttype IOutline,\n\ttype IOutlineCreator,\n\ttype IOutlineListConfig,\n\tIOutlineService,\n\ttype OutlineChangeEvent,\n\tOutlineConfigCollapseItemsValues,\n\tOutlineConfigKeys,\n\tOutlineTarget,\n} from \"../../../../services/outline/browser/outline.js\";\nimport {\n\tDocumentSymbolAccessibilityProvider,\n\tDocumentSymbolComparator,\n\tDocumentSymbolFilter,\n\tDocumentSymbolGroupRenderer,\n\tDocumentSymbolIdentityProvider,\n\tDocumentSymbolNavigationLabelProvider,\n\tDocumentSymbolRenderer,\n\tDocumentSymbolVirtualDelegate,\n} from \"./documentSymbolsTree.js\";\n\ntype DocumentSymbolItem = OutlineGroup | OutlineElement;\n\nclass DocumentSymbolBreadcrumbsSource\n\timplements IBreadcrumbsDataSource<DocumentSymbolItem>\n{\n\tprivate _breadcrumbs: (OutlineGroup | OutlineElement)[] = [];\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\t@ITextResourceConfigurationService private readonly _textResourceConfigurationService: ITextResourceConfigurationService,\n\t) { }\n\n\tgetBreadcrumbElements(): readonly DocumentSymbolItem[] {\n\t\treturn this._breadcrumbs;\n\t}\n\n\tclear(): void {\n\t\tthis._breadcrumbs = [];\n\t}\n\n\tupdate(model: OutlineModel, position: IPosition): void {\n\t\tconst newElements = this._computeBreadcrumbs(model, position);\n\t\tthis._breadcrumbs = newElements;\n\t}\n\n\tprivate _computeBreadcrumbs(\n\t\tmodel: OutlineModel,\n\t\tposition: IPosition,\n\t): Array<OutlineGroup | OutlineElement> {\n\t\tlet item: OutlineGroup | OutlineElement | undefined =\n\t\t\tmodel.getItemEnclosingPosition(position);\n\t\tif (!item) {\n\t\t\treturn [];\n\t\t}\n\t\tconst chain: Array<OutlineGroup | OutlineElement> = [];\n\t\twhile (item) {\n\t\t\tchain.push(item);\n\t\t\tconst parent: any = item.parent;\n\t\t\tif (parent instanceof OutlineModel) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tif (\n\t\t\t\tparent instanceof OutlineGroup &&\n\t\t\t\tparent.parent &&\n\t\t\t\tparent.parent.children.size === 1\n\t\t\t) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\titem = parent;\n\t\t}\n\t\tconst result: Array<OutlineGroup | OutlineElement> = [];\n\t\tfor (let i = chain.length - 1; i >= 0; i--) {\n\t\t\tconst element = chain[i];\n\t\t\tif (this._isFiltered(element)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tresult.push(element);\n\t\t}\n\t\tif (result.length === 0) {\n\t\t\treturn [];\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _isFiltered(element: TreeElement): boolean {\n\t\tif (!(element instanceof OutlineElement)) {\n\t\t\treturn false;\n\t\t}\n\t\tconst key = `breadcrumbs.${DocumentSymbolFilter.kindToConfigName[element.symbol.kind]}`;\n\t\tlet uri: URI | undefined;\n\t\tif (this._editor && this._editor.getModel()) {\n\t\t\tconst model = this._editor.getModel() as ITextModel;\n\t\t\turi = model.uri;\n\t\t}\n\t\treturn !this._textResourceConfigurationService.getValue<boolean>(\n\t\t\turi,\n\t\t\tkey,\n\t\t);\n\t}\n}\n\nclass DocumentSymbolsOutline implements IOutline<DocumentSymbolItem> {\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _onDidChange = new Emitter<OutlineChangeEvent>();\n\n\treadonly onDidChange: Event<OutlineChangeEvent> = this._onDidChange.event;\n\n\tprivate _outlineModel?: OutlineModel;\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _breadcrumbsDataSource: DocumentSymbolBreadcrumbsSource;\n\n\treadonly config: IOutlineListConfig<DocumentSymbolItem>;\n\n\treadonly outlineKind = \"documentSymbols\";\n\n\tget activeElement(): DocumentSymbolItem | undefined {\n\t\tconst posistion = this._editor.getPosition();\n\t\tif (!posistion || !this._outlineModel) {\n\t\t\treturn undefined;\n\t\t} else {\n\t\t\treturn this._outlineModel.getItemEnclosingPosition(posistion);\n\t\t}\n\t}\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\ttarget: OutlineTarget,\n\t\tfirstLoadBarrier: Barrier,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@ICodeEditorService private readonly _codeEditorService: ICodeEditorService,\n\t\t@IOutlineModelService private readonly _outlineModelService: IOutlineModelService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IMarkerDecorationsService private readonly _markerDecorationsService: IMarkerDecorationsService,\n\t\t@ITextResourceConfigurationService textResourceConfigurationService: ITextResourceConfigurationService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\n\t\tthis._breadcrumbsDataSource = new DocumentSymbolBreadcrumbsSource(_editor, textResourceConfigurationService);\n\t\tconst delegate = new DocumentSymbolVirtualDelegate();\n\t\tconst renderers = [new DocumentSymbolGroupRenderer(), instantiationService.createInstance(DocumentSymbolRenderer, true, target)];\n\t\tconst treeDataSource: IDataSource<this, DocumentSymbolItem> = {\n\t\t\tgetChildren: (parent) => {\n\t\t\t\tif (parent instanceof OutlineElement || parent instanceof OutlineGroup) {\n\t\t\t\t\treturn parent.children.values();\n\t\t\t\t}\n\t\t\t\tif (parent === this && this._outlineModel) {\n\t\t\t\t\treturn this._outlineModel.children.values();\n\t\t\t\t}\n\t\t\t\treturn [];\n\t\t\t}\n\t\t};\n\t\tconst comparator = new DocumentSymbolComparator();\n\t\tconst initialState = textResourceConfigurationService.getValue<OutlineConfigCollapseItemsValues>(_editor.getModel()?.uri, OutlineConfigKeys.collapseItems);\n\t\tconst options = {\n\t\t\tcollapseByDefault: target === OutlineTarget.Breadcrumbs || (target === OutlineTarget.OutlinePane && initialState === OutlineConfigCollapseItemsValues.Collapsed),\n\t\t\texpandOnlyOnTwistieClick: true,\n\t\t\tmultipleSelectionSupport: false,\n\t\t\tidentityProvider: new DocumentSymbolIdentityProvider(),\n\t\t\tkeyboardNavigationLabelProvider: new DocumentSymbolNavigationLabelProvider(),\n\t\t\taccessibilityProvider: new DocumentSymbolAccessibilityProvider(localize('document', \"Document Symbols\")),\n\t\t\tfilter: target === OutlineTarget.OutlinePane\n\t\t\t\t? instantiationService.createInstance(DocumentSymbolFilter, 'outline')\n\t\t\t\t: target === OutlineTarget.Breadcrumbs\n\t\t\t\t\t? instantiationService.createInstance(DocumentSymbolFilter, 'breadcrumbs')\n\t\t\t\t\t: undefined\n\t\t};\n\n\t\tthis.config = {\n\t\t\tbreadcrumbsDataSource: this._breadcrumbsDataSource,\n\t\t\tdelegate,\n\t\t\trenderers,\n\t\t\ttreeDataSource,\n\t\t\tcomparator,\n\t\t\toptions,\n\t\t\tquickPickDataSource: { getQuickPickElements: () => { throw new Error('not implemented'); } }\n\t\t};\n\n\n\t\t// update as language, model, providers changes\n\t\tthis._disposables.add(_languageFeaturesService.documentSymbolProvider.onDidChange(_ => this._createOutline()));\n\t\tthis._disposables.add(this._editor.onDidChangeModel(_ => this._createOutline()));\n\t\tthis._disposables.add(this._editor.onDidChangeModelLanguage(_ => this._createOutline()));\n\n\t\t// update soon'ish as model content change\n\t\tconst updateSoon = new TimeoutTimer();\n\t\tthis._disposables.add(updateSoon);\n\t\tthis._disposables.add(this._editor.onDidChangeModelContent(event => {\n\t\t\tconst model = this._editor.getModel();\n\t\t\tif (model) {\n\t\t\t\tconst timeout = _outlineModelService.getDebounceValue(model);\n\t\t\t\tupdateSoon.cancelAndSet(() => this._createOutline(event), timeout);\n\t\t\t}\n\t\t}));\n\n\t\t// stop when editor dies\n\t\tthis._disposables.add(this._editor.onDidDispose(() => this._outlineDisposables.clear()));\n\n\t\t// initial load\n\t\tthis._createOutline().finally(() => firstLoadBarrier.open());\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t}\n\n\tget isEmpty(): boolean {\n\t\treturn !this._outlineModel || TreeElement.empty(this._outlineModel);\n\t}\n\n\tget uri() {\n\t\treturn this._outlineModel?.uri;\n\t}\n\n\tasync reveal(\n\t\tentry: DocumentSymbolItem,\n\t\toptions: IEditorOptions,\n\t\tsideBySide: boolean,\n\t\tselect: boolean,\n\t): Promise<void> {\n\t\tconst model = OutlineModel.get(entry);\n\t\tif (!model || !(entry instanceof OutlineElement)) {\n\t\t\treturn;\n\t\t}\n\t\tawait this._codeEditorService.openCodeEditor(\n\t\t\t{\n\t\t\t\tresource: model.uri,\n\t\t\t\toptions: {\n\t\t\t\t\t...options,\n\t\t\t\t\tselection: select\n\t\t\t\t\t\t? entry.symbol.range\n\t\t\t\t\t\t: Range.collapseToStart(entry.symbol.selectionRange),\n\t\t\t\t\tselectionRevealType:\n\t\t\t\t\t\tTextEditorSelectionRevealType.NearTopIfOutsideViewport,\n\t\t\t\t},\n\t\t\t},\n\t\t\tthis._editor,\n\t\t\tsideBySide,\n\t\t);\n\t}\n\n\tpreview(entry: DocumentSymbolItem): IDisposable {\n\t\tif (!(entry instanceof OutlineElement)) {\n\t\t\treturn Disposable.None;\n\t\t}\n\n\t\tconst { symbol } = entry;\n\t\tthis._editor.revealRangeInCenterIfOutsideViewport(\n\t\t\tsymbol.range,\n\t\t\tScrollType.Smooth,\n\t\t);\n\t\tconst decorationsCollection = this._editor.createDecorationsCollection([\n\t\t\t{\n\t\t\t\trange: symbol.range,\n\t\t\t\toptions: {\n\t\t\t\t\tdescription: \"document-symbols-outline-range-highlight\",\n\t\t\t\t\tclassName: \"rangeHighlight\",\n\t\t\t\t\tisWholeLine: true,\n\t\t\t\t},\n\t\t\t},\n\t\t]);\n\t\treturn toDisposable(() => decorationsCollection.clear());\n\t}\n\n\tcaptureViewState(): IDisposable {\n\t\tconst viewState = this._editor.saveViewState();\n\t\treturn toDisposable(() => {\n\t\t\tif (viewState) {\n\t\t\t\tthis._editor.restoreViewState(viewState);\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate async _createOutline(\n\t\tcontentChangeEvent?: IModelContentChangedEvent,\n\t): Promise<void> {\n\t\tthis._outlineDisposables.clear();\n\t\tif (!contentChangeEvent) {\n\t\t\tthis._setOutlineModel(undefined);\n\t\t}\n\n\t\tif (!this._editor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\t\tconst buffer = this._editor.getModel();\n\t\tif (!this._languageFeaturesService.documentSymbolProvider.has(buffer)) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cts = new CancellationTokenSource();\n\t\tconst versionIdThen = buffer.getVersionId();\n\t\tconst timeoutTimer = new TimeoutTimer();\n\n\t\tthis._outlineDisposables.add(timeoutTimer);\n\t\tthis._outlineDisposables.add(toDisposable(() => cts.dispose(true)));\n\n\t\ttry {\n\t\t\tconst model = await this._outlineModelService.getOrCreate(\n\t\t\t\tbuffer,\n\t\t\t\tcts.token,\n\t\t\t);\n\t\t\tif (cts.token.isCancellationRequested) {\n\t\t\t\t// cancelled -> do nothing\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tif (TreeElement.empty(model) || !this._editor.hasModel()) {\n\t\t\t\t// empty -> no outline elements\n\t\t\t\tthis._setOutlineModel(model);\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// heuristic: when the symbols-to-lines ratio changes by 50% between edits\n\t\t\t// wait a little (and hope that the next change isn't as drastic).\n\t\t\tif (\n\t\t\t\tcontentChangeEvent &&\n\t\t\t\tthis._outlineModel &&\n\t\t\t\tbuffer.getLineCount() >= 25\n\t\t\t) {\n\t\t\t\tconst newSize = TreeElement.size(model);\n\t\t\t\tconst newLength = buffer.getValueLength();\n\t\t\t\tconst newRatio = newSize / newLength;\n\t\t\t\tconst oldSize = TreeElement.size(this._outlineModel);\n\t\t\t\tconst oldLength =\n\t\t\t\t\tnewLength -\n\t\t\t\t\tcontentChangeEvent.changes.reduce(\n\t\t\t\t\t\t(prev, value) => prev + value.rangeLength,\n\t\t\t\t\t\t0,\n\t\t\t\t\t);\n\t\t\t\tconst oldRatio = oldSize / oldLength;\n\t\t\t\tif (newRatio <= oldRatio * 0.5 || newRatio >= oldRatio * 1.5) {\n\t\t\t\t\t// wait for a better state and ignore current model when more\n\t\t\t\t\t// typing has happened\n\t\t\t\t\tconst value = await raceCancellation(\n\t\t\t\t\t\ttimeout(2000).then(() => true),\n\t\t\t\t\t\tcts.token,\n\t\t\t\t\t\tfalse,\n\t\t\t\t\t);\n\t\t\t\t\tif (!value) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// feature: show markers with outline element\n\t\t\tthis._applyMarkersToOutline(model);\n\t\t\tthis._outlineDisposables.add(\n\t\t\t\tthis._markerDecorationsService.onDidChangeMarker(\n\t\t\t\t\t(textModel) => {\n\t\t\t\t\t\tif (isEqual(model.uri, textModel.uri)) {\n\t\t\t\t\t\t\tthis._applyMarkersToOutline(model);\n\t\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t),\n\t\t\t);\n\t\t\tthis._outlineDisposables.add(\n\t\t\t\tthis._configurationService.onDidChangeConfiguration((e) => {\n\t\t\t\t\tif (\n\t\t\t\t\t\te.affectsConfiguration(\n\t\t\t\t\t\t\tOutlineConfigKeys.problemsEnabled,\n\t\t\t\t\t\t) ||\n\t\t\t\t\t\te.affectsConfiguration(\"problems.visibility\")\n\t\t\t\t\t) {\n\t\t\t\t\t\tconst problem = this._configurationService.getValue(\n\t\t\t\t\t\t\t\"problems.visibility\",\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst config = this._configurationService.getValue(\n\t\t\t\t\t\t\tOutlineConfigKeys.problemsEnabled,\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (!problem || !config) {\n\t\t\t\t\t\t\tmodel.updateMarker([]);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthis._applyMarkersToOutline(model);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t}\n\t\t\t\t\tif (e.affectsConfiguration(\"outline\")) {\n\t\t\t\t\t\t// outline filtering, problems on/off\n\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t}\n\t\t\t\t\tif (\n\t\t\t\t\t\te.affectsConfiguration(\"breadcrumbs\") &&\n\t\t\t\t\t\tthis._editor.hasModel()\n\t\t\t\t\t) {\n\t\t\t\t\t\t// breadcrumbs filtering\n\t\t\t\t\t\tthis._breadcrumbsDataSource.update(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tthis._editor.getPosition(),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// feature: toggle icons\n\t\t\tthis._outlineDisposables.add(\n\t\t\t\tthis._configurationService.onDidChangeConfiguration((e) => {\n\t\t\t\t\tif (e.affectsConfiguration(OutlineConfigKeys.icons)) {\n\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t}\n\t\t\t\t\tif (e.affectsConfiguration(\"outline\")) {\n\t\t\t\t\t\tthis._onDidChange.fire({});\n\t\t\t\t\t}\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// feature: update active when cursor changes\n\t\t\tthis._outlineDisposables.add(\n\t\t\t\tthis._editor.onDidChangeCursorPosition((_) => {\n\t\t\t\t\ttimeoutTimer.cancelAndSet(() => {\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!buffer.isDisposed() &&\n\t\t\t\t\t\t\tversionIdThen === buffer.getVersionId() &&\n\t\t\t\t\t\t\tthis._editor.hasModel()\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\tthis._breadcrumbsDataSource.update(\n\t\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\t\tthis._editor.getPosition(),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\tthis._onDidChange.fire({\n\t\t\t\t\t\t\t\taffectOnlyActiveElement: true,\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}, 150);\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\t// update properties, send event\n\t\t\tthis._setOutlineModel(model);\n\t\t} catch (err) {\n\t\t\tthis._setOutlineModel(undefined);\n\t\t\tonUnexpectedError(err);\n\t\t}\n\t}\n\n\tprivate _applyMarkersToOutline(model: OutlineModel | undefined): void {\n\t\tconst problem = this._configurationService.getValue(\n\t\t\t\"problems.visibility\",\n\t\t);\n\t\tconst config = this._configurationService.getValue(\n\t\t\tOutlineConfigKeys.problemsEnabled,\n\t\t);\n\t\tif (!model || !problem || !config) {\n\t\t\treturn;\n\t\t}\n\t\tconst markers: IOutlineMarker[] = [];\n\t\tfor (const [\n\t\t\trange,\n\t\t\tmarker,\n\t\t] of this._markerDecorationsService.getLiveMarkers(model.uri)) {\n\t\t\tif (\n\t\t\t\tmarker.severity === MarkerSeverity.Error ||\n\t\t\t\tmarker.severity === MarkerSeverity.Warning\n\t\t\t) {\n\t\t\t\tmarkers.push({ ...range, severity: marker.severity });\n\t\t\t}\n\t\t}\n\t\tmodel.updateMarker(markers);\n\t}\n\n\tprivate _setOutlineModel(model: OutlineModel | undefined) {\n\t\tconst position = this._editor.getPosition();\n\t\tif (!position || !model) {\n\t\t\tthis._outlineModel = undefined;\n\t\t\tthis._breadcrumbsDataSource.clear();\n\t\t} else {\n\t\t\tif (!this._outlineModel?.merge(model)) {\n\t\t\t\tthis._outlineModel = model;\n\t\t\t}\n\t\t\tthis._breadcrumbsDataSource.update(model, position);\n\t\t}\n\t\tthis._onDidChange.fire({});\n\t}\n}\n\nclass DocumentSymbolsOutlineCreator\n\timplements IOutlineCreator<IEditorPane, DocumentSymbolItem>\n{\n\treadonly dispose: () => void;\n\n\tconstructor(\n\t\t@IOutlineService outlineService: IOutlineService\n\t) {\n\t\tconst reg = outlineService.registerOutlineCreator(this);\n\t\tthis.dispose = () => reg.dispose();\n\t}\n\n\tmatches(candidate: IEditorPane): candidate is IEditorPane {\n\t\tconst ctrl = candidate.getControl();\n\t\treturn isCodeEditor(ctrl) || isDiffEditor(ctrl);\n\t}\n\n\tasync createOutline(\n\t\tpane: IEditorPane,\n\t\ttarget: OutlineTarget,\n\t\t_token: CancellationToken,\n\t): Promise<IOutline<DocumentSymbolItem> | undefined> {\n\t\tconst control = pane.getControl();\n\t\tlet editor: ICodeEditor | undefined;\n\t\tif (isCodeEditor(control)) {\n\t\t\teditor = control;\n\t\t} else if (isDiffEditor(control)) {\n\t\t\teditor = control.getModifiedEditor();\n\t\t}\n\t\tif (!editor) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst firstLoadBarrier = new Barrier();\n\t\tconst result = editor.invokeWithinContext((accessor) =>\n\t\t\taccessor\n\t\t\t\t.get(IInstantiationService)\n\t\t\t\t.createInstance(\n\t\t\t\t\tDocumentSymbolsOutline,\n\t\t\t\t\teditor,\n\t\t\t\t\ttarget,\n\t\t\t\t\tfirstLoadBarrier,\n\t\t\t\t),\n\t\t);\n\t\tawait firstLoadBarrier.wait();\n\t\treturn result;\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(\n\tDocumentSymbolsOutlineCreator,\n\tLifecyclePhase.Eventually,\n);\n"],
  "mappings": "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",
  "names": ["timeout"]
}
