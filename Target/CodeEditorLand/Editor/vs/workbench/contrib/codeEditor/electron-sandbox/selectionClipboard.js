var h=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var d=(a,e,r,i)=>{for(var t=i>1?void 0:i?I(e,r):e,o=a.length-1,n;o>=0;o--)(n=a[o])&&(t=(i?n(e,r,t):n(t))||t);return i&&t&&h(e,r,t),t},p=(a,e)=>(r,i)=>e(r,i,a);import{addDisposableListener as S,onDidRegisterWindow as v}from"../../../../base/browser/dom.js";import{mainWindow as x}from"../../../../base/browser/window.js";import{RunOnceScheduler as T}from"../../../../base/common/async.js";import{Event as L}from"../../../../base/common/event.js";import{Disposable as g}from"../../../../base/common/lifecycle.js";import*as C from"../../../../base/common/platform.js";import"../../../../editor/browser/editorBrowser.js";import{EditorAction as w,EditorContributionInstantiation as D,registerEditorAction as O,registerEditorContribution as y}from"../../../../editor/browser/editorExtensions.js";import{EditorOption as m}from"../../../../editor/common/config/editorOptions.js";import{Range as _}from"../../../../editor/common/core/range.js";import"../../../../editor/common/cursorEvents.js";import{Handler as k}from"../../../../editor/common/editorCommon.js";import{EditorContextKeys as R}from"../../../../editor/common/editorContextKeys.js";import{EndOfLinePreference as A}from"../../../../editor/common/model.js";import*as W from"../../../../nls.js";import{IClipboardService as b}from"../../../../platform/clipboard/common/clipboardService.js";import{IConfigurationService as N}from"../../../../platform/configuration/common/configuration.js";import{registerWorkbenchContribution2 as M,WorkbenchPhase as P}from"../../../common/contributions.js";import{SelectionClipboardContributionID as H}from"../browser/selectionClipboard.js";let s=class extends g{static SELECTION_LENGTH_LIMIT=65536;constructor(e,r){if(super(),C.isLinux){let i=e.getOption(m.selectionClipboard);this._register(e.onDidChangeConfiguration(o=>{o.hasChanged(m.selectionClipboard)&&(i=e.getOption(m.selectionClipboard))}));const t=this._register(new T(()=>{if(!e.hasModel())return;const o=e.getModel();let n=e.getSelections();n=n.slice(0),n.sort(_.compareRangesUsingStarts);let u=0;for(const l of n){if(l.isEmpty())return;u+=o.getValueLengthInRange(l)}if(u>s.SELECTION_LENGTH_LIMIT)return;const f=[];for(const l of n)f.push(o.getValueInRange(l,A.TextDefined));const E=f.join(o.getEOL());r.writeText(E,"selection")},100));this._register(e.onDidChangeCursorSelection(o=>{i&&o.source!=="restoreState"&&t.schedule()}))}}dispose(){super.dispose()}};s=d([p(1,b)],s);let c=class extends g{static ID="workbench.contrib.linuxSelectionClipboardPastePreventer";constructor(e){super(),this._register(L.runAndSubscribe(v,({window:r,disposables:i})=>{i.add(S(r.document,"mouseup",t=>{t.button===1&&(e.getValue("editor").selectionClipboard||t.preventDefault())}))},{window:x,disposables:this._store}))}};c=d([p(0,N)],c);class V extends w{constructor(){super({id:"editor.action.selectionClipboardPaste",label:W.localize("actions.pasteSelectionClipboard","Paste Selection Clipboard"),alias:"Paste Selection Clipboard",precondition:R.writable})}async run(e,r,i){const o=await e.get(b).readText("selection");r.trigger("keyboard",k.Paste,{text:o,pasteOnNewLine:!1,multicursorText:null})}}y(H,s,D.Eager),C.isLinux&&(M(c.ID,c,P.BlockRestore),O(V));export{s as SelectionClipboard};
