var Y=Object.defineProperty;var Q=Object.getOwnPropertyDescriptor;var C=(u,c,e,t)=>{for(var i=t>1?void 0:t?Q(c,e):c,r=u.length-1,s;r>=0;r--)(s=u[r])&&(i=(t?s(c,e,i):s(i))||i);return t&&i&&Y(c,e,i),i},n=(u,c)=>(e,t)=>c(e,t,u);import"./media/markers.css";import"../../../../base/common/uri.js";import*as o from"../../../../base/browser/dom.js";import{Separator as J}from"../../../../base/common/actions.js";import{ITelemetryService as X}from"../../../../platform/telemetry/common/telemetry.js";import{IEditorService as Z,SIDE_GROUP as ee,ACTIVE_GROUP as te}from"../../../services/editor/common/editorService.js";import{Marker as d,ResourceMarkers as y,RelatedInformation as F,MarkersModel as ie,compareMarkersByUri as re,MarkerTableItem as R}from"./markersModel.js";import{IInstantiationService as L}from"../../../../platform/instantiation/common/instantiation.js";import{MarkersFilters as se}from"./markersViewActions.js";import{IConfigurationService as D}from"../../../../platform/configuration/common/configuration.js";import h from"./messages.js";import{RangeHighlightDecorations as oe}from"../../../browser/codeeditor.js";import{IThemeService as V}from"../../../../platform/theme/common/themeService.js";import"../../../../editor/browser/editorBrowser.js";import{IStorageService as ne,StorageScope as ae,StorageTarget as le}from"../../../../platform/storage/common/storage.js";import{localize as f}from"../../../../nls.js";import{IContextKeyService as P}from"../../../../platform/contextkey/common/contextkey.js";import{Iterable as p}from"../../../../base/common/iterator.js";import"../../../../base/browser/ui/tree/tree.js";import{Relay as de,Event as v}from"../../../../base/common/event.js";import{WorkbenchObjectTree as ce,IListService as he}from"../../../../platform/list/browser/listService.js";import{FilterOptions as _}from"./markersFilterOptions.js";import"../../../../base/common/glob.js";import{deepClone as ue}from"../../../../base/common/objects.js";import{IWorkspaceContextService as ge}from"../../../../platform/workspace/common/workspace.js";import{Filter as me,VirtualDelegate as fe,ResourceMarkersRenderer as pe,MarkerRenderer as ve,RelatedInformationRenderer as Me,MarkersWidgetAccessibilityProvider as ke,MarkersViewModel as be}from"./markersTreeViewer.js";import{IContextMenuService as Se}from"../../../../platform/contextview/browser/contextView.js";import{MenuId as Ie}from"../../../../platform/actions/common/actions.js";import{IKeybindingService as Ee}from"../../../../platform/keybinding/common/keybinding.js";import{StandardKeyboardEvent as we}from"../../../../base/browser/keyboardEvent.js";import{ResourceLabels as Ce}from"../../../browser/labels.js";import{IMarkerService as ye,MarkerSeverity as x}from"../../../../platform/markers/common/markers.js";import{Memento as Fe}from"../../../common/memento.js";import"../../../../base/browser/ui/list/list.js";import{KeyCode as H}from"../../../../base/common/keyCodes.js";import{FilterViewPane as Re}from"../../../browser/parts/views/viewPane.js";import{IViewDescriptorService as xe}from"../../../common/views.js";import{IOpenerService as Ae,withSelection as A}from"../../../../platform/opener/common/opener.js";import{ActionViewItem as Te}from"../../../../base/browser/ui/actionbar/actionViewItems.js";import{IUriIdentityService as Le}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{DisposableStore as B,toDisposable as M}from"../../../../base/common/lifecycle.js";import{groupBy as De}from"../../../../base/common/arrays.js";import{ResourceMap as Ve}from"../../../../base/common/map.js";import{EditorResourceAccessor as Pe,SideBySideEditor as _e}from"../../../common/editor.js";import"./markers.js";import{ResourceListDnDHandler as W}from"../../../browser/dnd.js";import"../../../../base/browser/ui/table/table.js";import{MarkersTable as He}from"./markersTable.js";import{Markers as Be,MarkersContextKeys as k,MarkersViewMode as b}from"../common/markers.js";import{registerNavigableContainer as We}from"../../../browser/actions/widgetNavigationCommands.js";import{IHoverService as Ne}from"../../../../platform/hover/browser/hover.js";import{ResultKind as N}from"../../../../platform/keybinding/common/keybindingResolver.js";function K(u){return p.map(u.markers,c=>{const e=p.from(c.relatedInformation),t=p.map(e,i=>({element:i}));return{element:c,children:t}})}let S=class extends Re{constructor(e,t,i,r,s,l,a,I,O,E,U,$,G,z,q,j){const T=new Fe(Be.MARKERS_VIEW_STORAGE_ID,G),w=T.getMemento(ae.WORKSPACE,le.MACHINE);super({...e,filterOptions:{ariaLabel:h.MARKERS_PANEL_FILTER_ARIA_LABEL,placeholder:h.MARKERS_PANEL_FILTER_PLACEHOLDER,focusContextKey:k.MarkerViewFilterFocusContextKey.key,text:w.filter||"",history:w.filterHistory||[]}},$,E,s,I,i,t,z,q,l,j);this.editorService=r;this.markerService=a;this.workspaceContextService=O;this.uriIdentityService=U;this.memento=T,this.panelState=w,this.markersModel=this._register(t.createInstance(ie)),this.markersViewModel=this._register(t.createInstance(be,this.panelState.multiline,this.panelState.viewMode??this.getDefaultViewMode())),this._register(this.onDidChangeVisibility(g=>this.onDidChangeMarkersViewVisibility(g))),this._register(this.markersViewModel.onDidChangeViewMode(g=>this.onDidChangeViewMode())),this.widgetAccessibilityProvider=t.createInstance(ke),this.widgetIdentityProvider={getId(g){return g.id}},this.setCurrentActiveEditor(),this.filter=new me(_.EMPTY(U)),this.rangeHighlightDecorations=this._register(this.instantiationService.createInstance(oe)),this.filters=this._register(new se({filterHistory:this.panelState.filterHistory||[],showErrors:this.panelState.showErrors!==!1,showWarnings:this.panelState.showWarnings!==!1,showInfos:this.panelState.showInfos!==!1,excludedFiles:!!this.panelState.useFilesExclude,activeFile:!!this.panelState.activeFile},this.contextKeyService)),this._register(this.configurationService.onDidChangeConfiguration(g=>{this.filters.excludedFiles&&g.affectsConfiguration("files.exclude")&&this.updateFilter()}))}lastSelectedRelativeTop=0;currentActiveResource=null;rangeHighlightDecorations;markersModel;filter;onVisibleDisposables=this._register(new B);widget;widgetDisposables=this._register(new B);widgetContainer;widgetIdentityProvider;widgetAccessibilityProvider;messageBoxContainer;ariaLabelElement;filters;currentHeight=0;currentWidth=0;memento;panelState;cachedFilterStats=void 0;currentResourceGotAddedToMarkersData=!1;markersViewModel;onDidChangeVisibility=this.onDidChangeBodyVisibility;render(){super.render(),this._register(We({name:"markersView",focusNotifiers:[this,this.filterWidget],focusNextWidget:()=>{this.filterWidget.hasFocus()&&this.focus()},focusPreviousWidget:()=>{this.filterWidget.hasFocus()||this.focusFilter()}}))}renderBody(e){super.renderBody(e),e.classList.add("markers-panel"),this._register(o.addDisposableListener(e,"keydown",i=>{const r=new we(i);if(!this.keybindingService.mightProducePrintableCharacter(r))return;const s=this.keybindingService.softDispatch(r,r.target);s.kind===N.MoreChordsNeeded||s.kind===N.KbFound||this.focusFilter()}));const t=o.append(e,o.$(".markers-panel-container"));this.createArialLabelElement(t),this.createMessageBox(t),this.widgetContainer=o.append(t,o.$(".widget-container")),this.createWidget(this.widgetContainer),this.updateFilter(),this.renderContent()}getTitle(){return h.MARKERS_PANEL_TITLE_PROBLEMS.value}layoutBodyContent(e=this.currentHeight,t=this.currentWidth){this.messageBoxContainer&&(this.messageBoxContainer.style.height=`${e}px`),this.widget.layout(e,t),this.currentHeight=e,this.currentWidth=t}focus(){super.focus(),!o.isActiveElement(this.widget.getHTMLElement())&&(this.hasNoProblems()?this.messageBoxContainer.focus():(this.widget.domFocus(),this.widget.setMarkerSelection()))}focusFilter(){this.filterWidget.focus()}updateBadge(e,t){this.filterWidget.updateBadge(e===t||e===0?void 0:f("showing filtered problems","Showing {0} of {1}",t,e))}checkMoreFilters(){this.filterWidget.checkMoreFilters(!this.filters.showErrors||!this.filters.showWarnings||!this.filters.showInfos||this.filters.excludedFiles||this.filters.activeFile)}clearFilterText(){this.filterWidget.setFilterText("")}showQuickFixes(e){const t=this.markersViewModel.getViewModel(e);t&&t.quickFixAction.run()}openFileAtElement(e,t,i,r){const{resource:s,selection:l}=e instanceof d?{resource:e.resource,selection:e.range}:e instanceof F?{resource:e.raw.resource,selection:e.raw}:"marker"in e?{resource:e.marker.resource,selection:e.marker.range}:{resource:null,selection:null};return s&&l?(this.editorService.openEditor({resource:s,options:{selection:l,preserveFocus:t,pinned:r,revealIfVisible:!0}},i?ee:te).then(a=>{a&&t?this.rangeHighlightDecorations.highlightRange({resource:s,range:l},a.getControl()):this.rangeHighlightDecorations.removeHighlightRange()}),!0):(this.rangeHighlightDecorations.removeHighlightRange(),!1)}refreshPanel(e){if(this.isVisible()){const t=this.widget.getSelection().length>0;e?e instanceof d?this.widget.updateMarker(e):e.added.size||e.removed.size?this.resetWidget():this.widget.update([...e.updated]):this.resetWidget(),t&&this.widget.setMarkerSelection(),this.cachedFilterStats=void 0;const{total:i,filtered:r}=this.getFilterStats();this.toggleVisibility(i===0||r===0),this.renderMessage(),this.updateBadge(i,r),this.checkMoreFilters()}}onDidChangeViewState(e){this.refreshPanel(e)}resetWidget(){this.widget.reset(this.getResourceMarkers())}updateFilter(){this.filter.options=new _(this.filterWidget.getFilterText(),this.getFilesExcludeExpressions(),this.filters.showWarnings,this.filters.showErrors,this.filters.showInfos,this.uriIdentityService),this.widget.filterMarkers(this.getResourceMarkers(),this.filter.options),this.cachedFilterStats=void 0;const{total:e,filtered:t}=this.getFilterStats();this.toggleVisibility(e===0||t===0),this.renderMessage(),this.updateBadge(e,t),this.checkMoreFilters()}getDefaultViewMode(){switch(this.configurationService.getValue("problems.defaultViewMode")){case"table":return b.Table;case"tree":return b.Tree;default:return b.Tree}}getFilesExcludeExpressions(){if(!this.filters.excludedFiles)return[];const e=this.workspaceContextService.getWorkspace().folders;return e.length?e.map(t=>({root:t.uri,expression:this.getFilesExclude(t.uri)})):this.getFilesExclude()}getFilesExclude(e){return ue(this.configurationService.getValue("files.exclude",{resource:e}))||{}}getResourceMarkers(){if(!this.filters.activeFile)return this.markersModel.resourceMarkers;let e=[];if(this.currentActiveResource){const t=this.markersModel.getResourceMarkers(this.currentActiveResource);t&&(e=[t])}return e}createMessageBox(e){this.messageBoxContainer=o.append(e,o.$(".message-box-container")),this.messageBoxContainer.setAttribute("aria-labelledby","markers-panel-arialabel")}createArialLabelElement(e){this.ariaLabelElement=o.append(e,o.$("")),this.ariaLabelElement.setAttribute("id","markers-panel-arialabel")}createWidget(e){this.widget=this.markersViewModel.viewMode===b.Table?this.createTable(e):this.createTree(e),this.widgetDisposables.add(this.widget);const t=k.MarkerFocusContextKey.bindTo(this.widget.contextKeyService),i=k.RelatedInformationFocusContextKey.bindTo(this.widget.contextKeyService);this.widgetDisposables.add(this.widget.onDidChangeFocus(r=>{t.set(r.elements.some(s=>s instanceof d)),i.set(r.elements.some(s=>s instanceof F))})),this.widgetDisposables.add(v.debounce(this.widget.onDidOpen,(r,s)=>s,75,!0)(r=>{this.openFileAtElement(r.element,!!r.editorOptions.preserveFocus,r.sideBySide,!!r.editorOptions.pinned)})),this.widgetDisposables.add(v.any(this.widget.onDidChangeSelection,this.widget.onDidChangeFocus)(()=>{const r=[...this.widget.getSelection(),...this.widget.getFocus()];for(const s of r)s instanceof d&&this.markersViewModel.getViewModel(s)?.showLightBulb()})),this.widgetDisposables.add(this.widget.onContextMenu(this.onContextMenu,this)),this.widgetDisposables.add(this.widget.onDidChangeSelection(this.onSelected,this))}createTable(e){return this.instantiationService.createInstance(He,o.append(e,o.$(".markers-table-container")),this.markersViewModel,this.getResourceMarkers(),this.filter.options,{accessibilityProvider:this.widgetAccessibilityProvider,dnd:this.instantiationService.createInstance(W,i=>i instanceof R?A(i.resource,i.range):null),horizontalScrolling:!1,identityProvider:this.widgetIdentityProvider,multipleSelectionSupport:!0,selectionNavigation:!0})}createTree(e){const t=new de,i=this.instantiationService.createInstance(Ce,this),r=new fe(this.markersViewModel),s=[this.instantiationService.createInstance(pe,i,t.event),this.instantiationService.createInstance(ve,this.markersViewModel),this.instantiationService.createInstance(Me)],l=this.instantiationService.createInstance(m,"MarkersView",o.append(e,o.$(".tree-container.show-file-icons")),r,s,{filter:this.filter,accessibilityProvider:this.widgetAccessibilityProvider,identityProvider:this.widgetIdentityProvider,dnd:this.instantiationService.createInstance(W,a=>a instanceof y?a.resource:a instanceof d?A(a.resource,a.range):a instanceof F?A(a.raw.resource,a.raw):null),expandOnlyOnTwistieClick:a=>a instanceof d&&a.relatedInformation.length>0,overrideStyles:this.getLocationBasedColors().listOverrideStyles,selectionNavigation:!0,multipleSelectionSupport:!0});return t.input=l.onDidChangeRenderNodeCount,l}collapseAll(){this.widget.collapseMarkers()}setMultiline(e){this.markersViewModel.multiline=e}setViewMode(e){this.markersViewModel.viewMode=e}onDidChangeMarkersViewVisibility(e){if(this.onVisibleDisposables.clear(),e){for(const t of this.reInitialize())this.onVisibleDisposables.add(t);this.refreshPanel()}}reInitialize(){const e=[],t=i=>this.markerService.read({resource:i,severities:x.Error|x.Warning|x.Info});return this.markersModel.setResourceMarkers(De(t(),re).map(i=>[i[0].resource,i])),e.push(v.debounce(this.markerService.onMarkerChanged,(i,r)=>(i=i||new Ve,r.forEach(s=>i.set(s,s)),i),64)(i=>{this.markersModel.setResourceMarkers([...i.values()].map(r=>[r,t(r)]))})),e.push(v.any(this.markersModel.onDidChange,this.editorService.onDidActiveEditorChange)(i=>{i?this.onDidChangeModel(i):this.onActiveEditorChanged()})),e.push(M(()=>this.markersModel.reset())),this.markersModel.resourceMarkers.forEach(i=>i.markers.forEach(r=>this.markersViewModel.add(r))),e.push(this.markersViewModel.onDidChange(i=>this.onDidChangeViewState(i))),e.push(M(()=>this.markersModel.resourceMarkers.forEach(i=>this.markersViewModel.remove(i.resource)))),e.push(this.filters.onDidChange(i=>{i.activeFile?this.refreshPanel():(i.excludedFiles||i.showWarnings||i.showErrors||i.showInfos)&&this.updateFilter()})),e.push(this.filterWidget.onDidChangeFilterText(i=>this.updateFilter())),e.push(M(()=>{this.cachedFilterStats=void 0})),e.push(M(()=>this.rangeHighlightDecorations.removeHighlightRange())),e}onDidChangeModel(e){const t=[...e.added,...e.removed,...e.updated],i=[];for(const{resource:r}of t){this.markersViewModel.remove(r);const s=this.markersModel.getResourceMarkers(r);if(s)for(const l of s.markers)this.markersViewModel.add(l);i.push(r)}this.currentResourceGotAddedToMarkersData=this.currentResourceGotAddedToMarkersData||this.isCurrentResourceGotAddedToMarkersData(i),this.refreshPanel(e),this.updateRangeHighlights(),this.currentResourceGotAddedToMarkersData&&(this.autoReveal(),this.currentResourceGotAddedToMarkersData=!1)}onDidChangeViewMode(){this.widgetContainer&&this.widget&&(this.widgetContainer.textContent="",this.widgetDisposables.clear());const e=new Set;for(const i of this.widget.getSelection())i instanceof y?i.markers.forEach(r=>e.add(r)):(i instanceof d||i instanceof R)&&e.add(i);const t=new Set;for(const i of this.widget.getFocus())(i instanceof d||i instanceof R)&&t.add(i);this.createWidget(this.widgetContainer),this.refreshPanel(),e.size>0&&(this.widget.setMarkerSelection(Array.from(e),Array.from(t)),this.widget.domFocus())}isCurrentResourceGotAddedToMarkersData(e){const t=this.currentActiveResource;return!t||this.getResourceForCurrentActiveResource()?!1:e.some(r=>r.toString()===t.toString())}onActiveEditorChanged(){this.setCurrentActiveEditor(),this.filters.activeFile&&this.refreshPanel(),this.autoReveal()}setCurrentActiveEditor(){const e=this.editorService.activeEditor;this.currentActiveResource=e?Pe.getOriginalUri(e,{supportSideBySide:_e.PRIMARY})??null:null}onSelected(){const e=this.widget.getSelection();e&&e.length>0&&(this.lastSelectedRelativeTop=this.widget.getRelativeTop(e[0])||0)}hasNoProblems(){const{total:e,filtered:t}=this.getFilterStats();return e===0||t===0}renderContent(){this.cachedFilterStats=void 0,this.resetWidget(),this.toggleVisibility(this.hasNoProblems()),this.renderMessage()}renderMessage(){if(!this.messageBoxContainer||!this.ariaLabelElement)return;o.clearNode(this.messageBoxContainer);const{total:e,filtered:t}=this.getFilterStats();t===0?(this.messageBoxContainer.style.display="block",this.messageBoxContainer.setAttribute("tabIndex","0"),this.filters.activeFile?this.renderFilterMessageForActiveFile(this.messageBoxContainer):e>0?this.renderFilteredByFilterMessage(this.messageBoxContainer):this.renderNoProblemsMessage(this.messageBoxContainer)):(this.messageBoxContainer.style.display="none",t===e?this.setAriaLabel(f("No problems filtered","Showing {0} problems",e)):this.setAriaLabel(f("problems filtered","Showing {0} of {1} problems",t,e)),this.messageBoxContainer.removeAttribute("tabIndex"))}renderFilterMessageForActiveFile(e){this.currentActiveResource&&this.markersModel.getResourceMarkers(this.currentActiveResource)?this.renderFilteredByFilterMessage(e):this.renderNoProblemsMessageForActiveFile(e)}renderFilteredByFilterMessage(e){const t=o.append(e,o.$("span"));t.textContent=h.MARKERS_PANEL_NO_PROBLEMS_FILTERS;const i=o.append(e,o.$("a.messageAction"));i.textContent=f("clearFilter","Clear Filters"),i.setAttribute("tabIndex","0");const r=o.append(e,o.$("span"));r.textContent=".",o.addStandardDisposableListener(i,o.EventType.CLICK,()=>this.clearFilters()),o.addStandardDisposableListener(i,o.EventType.KEY_DOWN,s=>{(s.equals(H.Enter)||s.equals(H.Space))&&(this.clearFilters(),s.stopPropagation())}),this.setAriaLabel(h.MARKERS_PANEL_NO_PROBLEMS_FILTERS)}renderNoProblemsMessageForActiveFile(e){const t=o.append(e,o.$("span"));t.textContent=h.MARKERS_PANEL_NO_PROBLEMS_ACTIVE_FILE_BUILT,this.setAriaLabel(h.MARKERS_PANEL_NO_PROBLEMS_ACTIVE_FILE_BUILT)}renderNoProblemsMessage(e){const t=o.append(e,o.$("span"));t.textContent=h.MARKERS_PANEL_NO_PROBLEMS_BUILT,this.setAriaLabel(h.MARKERS_PANEL_NO_PROBLEMS_BUILT)}setAriaLabel(e){this.widget.setAriaLabel(e),this.ariaLabelElement.setAttribute("aria-label",e)}clearFilters(){this.filterWidget.setFilterText(""),this.filters.excludedFiles=!1,this.filters.showErrors=!0,this.filters.showWarnings=!0,this.filters.showInfos=!0}autoReveal(e=!1){if(this.filters.activeFile)return;const t=this.configurationService.getValue("problems.autoReveal");if(typeof t=="boolean"&&t){const i=this.getResourceForCurrentActiveResource();this.widget.revealMarkers(i,e,this.lastSelectedRelativeTop)}}getResourceForCurrentActiveResource(){return this.currentActiveResource?this.markersModel.getResourceMarkers(this.currentActiveResource):null}updateRangeHighlights(){this.rangeHighlightDecorations.removeHighlightRange(),o.isActiveElement(this.widget.getHTMLElement())&&this.highlightCurrentSelectedMarkerRange()}highlightCurrentSelectedMarkerRange(){const e=this.widget.getSelection()??[];if(e.length!==1)return;const t=e[0];t instanceof d&&this.rangeHighlightDecorations.highlightRange(t)}onContextMenu(e){const t=e.element;t&&(e.browserEvent.preventDefault(),e.browserEvent.stopPropagation(),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,menuId:Ie.ProblemsPanelContext,contextKeyService:this.widget.contextKeyService,getActions:()=>this.getMenuActions(t),getActionViewItem:i=>{const r=this.keybindingService.lookupKeybinding(i.id);if(r)return new Te(i,i,{label:!0,keybinding:r.getLabel()})},onHide:i=>{i&&this.widget.domFocus()}}))}getMenuActions(e){const t=[];if(e instanceof d){const i=this.markersViewModel.getViewModel(e);if(i){const r=i.quickFixAction.quickFixes;r.length&&(t.push(...r),t.push(new J))}}return t}getFocusElement(){return this.widget.getFocus()[0]??void 0}getFocusedSelectedElements(){const e=this.getFocusElement();if(!e)return null;const t=this.widget.getSelection();if(t.includes(e)){const i=[];for(const r of t)r&&i.push(r);return i}else return[e]}getAllResourceMarkers(){return this.markersModel.resourceMarkers}getFilterStats(){return this.cachedFilterStats||(this.cachedFilterStats={total:this.markersModel.total,filtered:this.widget?.getVisibleItemCount()??0}),this.cachedFilterStats}toggleVisibility(e){this.widget.toggleVisibility(e),this.layoutBodyContent()}saveState(){this.panelState.filter=this.filterWidget.getFilterText(),this.panelState.filterHistory=this.filters.filterHistory,this.panelState.showErrors=this.filters.showErrors,this.panelState.showWarnings=this.filters.showWarnings,this.panelState.showInfos=this.filters.showInfos,this.panelState.useFilesExclude=this.filters.excludedFiles,this.panelState.activeFile=this.filters.activeFile,this.panelState.multiline=this.markersViewModel.multiline,this.panelState.viewMode=this.markersViewModel.viewMode,this.memento.saveMemento(),super.saveState()}dispose(){super.dispose()}};S=C([n(1,L),n(2,xe),n(3,Z),n(4,D),n(5,X),n(6,ye),n(7,P),n(8,ge),n(9,Se),n(10,Le),n(11,Ee),n(12,ne),n(13,Ae),n(14,V),n(15,Ne)],S);let m=class extends ce{constructor(e,t,i,r,s,l,a,I,O,E){super(e,t,i,r,s,l,a,I,E);this.container=t;this.visibilityContextKey=k.MarkersTreeVisibilityContextKey.bindTo(a)}visibilityContextKey;collapseMarkers(){this.collapseAll(),this.setSelection([]),this.setFocus([]),this.getHTMLElement().focus(),this.focusFirst()}filterMarkers(){this.refilter()}getVisibleItemCount(){let e=0;const t=this.getNode();for(const i of t.children)for(const r of i.children)i.visible&&r.visible&&e++;return e}isVisible(){return!this.container.classList.contains("hidden")}toggleVisibility(e){this.visibilityContextKey.set(!e),this.container.classList.toggle("hidden",e)}reset(e){this.setChildren(null,p.map(e,t=>({element:t,children:K(t)})))}revealMarkers(e,t,i){e?this.hasElement(e)&&(!this.isCollapsed(e)&&this.hasSelectedMarkerFor(e)?(this.reveal(this.getSelection()[0],i),t&&this.setFocus(this.getSelection())):(this.expand(e),this.reveal(e,0),t&&(this.setFocus([e]),this.setSelection([e])))):t&&(this.setSelection([]),this.focusFirst())}setAriaLabel(e){this.ariaLabel=e}setMarkerSelection(e,t){if(this.isVisible()){if(e&&e.length>0)this.setSelection(e.map(i=>this.findMarkerNode(i))),t&&t.length>0?this.setFocus(t.map(i=>this.findMarkerNode(i))):this.setFocus([this.findMarkerNode(e[0])]),this.reveal(this.findMarkerNode(e[0]));else if(this.getSelection().length===0){const i=this.firstVisibleElement,r=i?i instanceof y?i.markers[0]:i instanceof d?i:void 0:void 0;r&&(this.setSelection([r]),this.setFocus([r]),this.reveal(r))}}}update(e){for(const t of e)this.hasElement(t)&&(this.setChildren(t,K(t)),this.rerender(t))}updateMarker(e){this.rerender(e)}findMarkerNode(e){for(const t of this.getNode().children)for(const i of t.children)if(i.element instanceof d&&i.element.marker===e.marker)return i.element;return null}hasSelectedMarkerFor(e){const t=this.getSelection();return!!(t&&t.length>0&&t[0]instanceof d&&e.has(t[0].marker.resource))}dispose(){super.dispose()}layout(e,t){this.container.style.height=`${e}px`,super.layout(e,t)}};m=C([n(5,L),n(6,P),n(7,he),n(8,V),n(9,D)],m);export{S as MarkersView};
