import{disposableTimeout as s}from"../../../../base/common/async.js";import{KeyCode as a,KeyMod as C}from"../../../../base/common/keyCodes.js";import"../../../../editor/browser/editorBrowser.js";import{EditorContextKeys as h}from"../../../../editor/common/editorContextKeys.js";import{localize2 as f}from"../../../../nls.js";import"../../../../platform/actions/common/actions.js";import{ICommandService as S}from"../../../../platform/commands/common/commands.js";import{IConfigurationService as I}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as u}from"../../../../platform/contextkey/common/contextkey.js";import"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as g}from"../../../../platform/keybinding/common/keybinding.js";import{KeybindingWeight as v}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import"../../chat/browser/actions/chatExecuteActions.js";import{StartVoiceChatAction as y,StopListeningAction as b,VOICE_KEY_HOLD_THRESHOLD as x}from"../../chat/electron-sandbox/actions/voiceChatActions.js";import{HasSpeechProvider as A,ISpeechService as E}from"../../speech/common/speechService.js";import{AbstractInlineChatAction as H,setHoldForSpeech as K}from"../browser/inlineChatActions.js";import"../browser/inlineChatController.js";import{CTX_INLINE_CHAT_VISIBLE as T,InlineChatConfigKeys as _}from"../common/inlineChat.js";class $ extends H{constructor(){super({id:"inlineChat.holdForSpeech",precondition:u.and(A,T),title:f("holdForSpeech","Hold for Speech"),keybinding:{when:h.textInputFocus,weight:v.WorkbenchContrib,primary:C.CtrlCmd|a.KeyI}})}runInlineChatCommand(o,t,i,...r){d(o,t,this)}}function d(e,o,t){const i=e.get(I),r=e.get(E),l=e.get(g),n=e.get(S);if(!i.getValue(_.HoldToSpeech||!r.hasSpeechProvider))return;const c=l.enableKeybindingHoldMode(t.desc.id);if(!c)return;let m=!1;const p=s(()=>{n.executeCommand(y.ID,{voice:{disableTimeout:!0}}),m=!0},x);c.finally(()=>{m&&n.executeCommand(b.ID).finally(()=>{o.acceptInput()}),p.dispose()})}K(d);export{$ as HoldToSpeak};
