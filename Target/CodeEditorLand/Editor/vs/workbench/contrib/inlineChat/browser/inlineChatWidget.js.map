{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/inlineChat/browser/inlineChatWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Dimension, getActiveElement, getTotalHeight, h, reset, trackFocus } from '../../../../base/browser/dom.js';\nimport { IActionViewItemOptions } from '../../../../base/browser/ui/actionbar/actionViewItems.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { renderLabelWithIcons } from '../../../../base/browser/ui/iconLabel/iconLabels.js';\nimport { IAction } from '../../../../base/common/actions.js';\nimport { isNonEmptyArray, tail } from '../../../../base/common/arrays.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { IMarkdownString, MarkdownString } from '../../../../base/common/htmlContent.js';\nimport { DisposableStore, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { constObservable, derived, ISettableObservable, observableValue } from '../../../../base/common/observable.js';\nimport './media/inlineChat.css';\nimport { ICodeEditor } from '../../../../editor/browser/editorBrowser.js';\nimport { AccessibleDiffViewer, IAccessibleDiffViewerModel } from '../../../../editor/browser/widget/diffEditor/components/accessibleDiffViewer.js';\nimport { EditorOption, IComputedEditorOptions } from '../../../../editor/common/config/editorOptions.js';\nimport { LineRange } from '../../../../editor/common/core/lineRange.js';\nimport { Position } from '../../../../editor/common/core/position.js';\nimport { Range } from '../../../../editor/common/core/range.js';\nimport { Selection } from '../../../../editor/common/core/selection.js';\nimport { DetailedLineRangeMapping, RangeMapping } from '../../../../editor/common/diff/rangeMapping.js';\nimport { ICodeEditorViewState, ScrollType } from '../../../../editor/common/editorCommon.js';\nimport { ITextModel } from '../../../../editor/common/model.js';\nimport { IResolvedTextEditorModel, ITextModelService } from '../../../../editor/common/services/resolverService.js';\nimport { localize } from '../../../../nls.js';\nimport { IAccessibleViewService } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { IAccessibilityService } from '../../../../platform/accessibility/common/accessibility.js';\nimport { IWorkbenchButtonBarOptions, MenuWorkbenchButtonBar } from '../../../../platform/actions/browser/buttonbar.js';\nimport { createActionViewItem, IMenuEntryActionViewItemOptions } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { MenuWorkbenchToolBar } from '../../../../platform/actions/browser/toolbar.js';\nimport { MenuId, MenuItemAction } from '../../../../platform/actions/common/actions.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { IContextKey, IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ServiceCollection } from '../../../../platform/instantiation/common/serviceCollection.js';\nimport { IKeybindingService } from '../../../../platform/keybinding/common/keybinding.js';\nimport { asCssVariable, asCssVariableName, editorBackground, inputBackground } from '../../../../platform/theme/common/colorRegistry.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { AccessibilityCommandId } from '../../accessibility/common/accessibilityCommands.js';\nimport { MarkUnhelpfulActionId } from '../../chat/browser/actions/chatTitleActions.js';\nimport { IChatWidgetViewOptions } from '../../chat/browser/chat.js';\nimport { ChatVoteDownButton } from '../../chat/browser/chatListRenderer.js';\nimport { ChatWidget, IChatWidgetLocationOptions } from '../../chat/browser/chatWidget.js';\nimport { ChatAgentLocation } from '../../chat/common/chatAgents.js';\nimport { chatRequestBackground } from '../../chat/common/chatColors.js';\nimport { CONTEXT_CHAT_RESPONSE_SUPPORT_ISSUE_REPORTING, CONTEXT_RESPONSE, CONTEXT_RESPONSE_ERROR, CONTEXT_RESPONSE_FILTERED, CONTEXT_RESPONSE_VOTE } from '../../chat/common/chatContextKeys.js';\nimport { ChatModel, IChatModel } from '../../chat/common/chatModel.js';\nimport { ChatAgentVoteDirection, IChatService } from '../../chat/common/chatService.js';\nimport { isResponseVM, isWelcomeVM } from '../../chat/common/chatViewModel.js';\nimport { HunkInformation, Session } from './inlineChatSession.js';\nimport { CTX_INLINE_CHAT_FOCUSED, CTX_INLINE_CHAT_RESPONSE_FOCUSED, inlineChatBackground, inlineChatForeground } from '../common/inlineChat.js';\nimport { EDITOR_DRAG_AND_DROP_BACKGROUND } from '../../../common/theme.js';\n\n\nexport interface InlineChatWidgetViewState {\n\teditorViewState: ICodeEditorViewState;\n\tinput: string;\n\tplaceholder: string;\n}\n\nexport interface IInlineChatWidgetConstructionOptions {\n\n\t/**\n\t * The menu that rendered as button bar, use for accept, discard etc\n\t */\n\tstatusMenuId: MenuId | { menu: MenuId; options: IWorkbenchButtonBarOptions };\n\n\tsecondaryMenuId?: MenuId;\n\n\t/**\n\t * The options for the chat widget\n\t */\n\tchatWidgetViewOptions?: IChatWidgetViewOptions;\n}\n\nexport interface IInlineChatMessage {\n\tmessage: IMarkdownString;\n\trequestId: string;\n}\n\nexport interface IInlineChatMessageAppender {\n\tappendContent(fragment: string): void;\n\tcancel(): void;\n\tcomplete(): void;\n}\n\nexport class InlineChatWidget {\n\n\tprotected readonly _elements = h(\n\t\t'div.inline-chat@root',\n\t\t[\n\t\t\th('div.chat-widget@chatWidget'),\n\t\t\th('div.accessibleViewer@accessibleViewer'),\n\t\t\th('div.status@status', [\n\t\t\t\th('div.label.info.hidden@infoLabel'),\n\t\t\t\th('div.actions.hidden@toolbar1'),\n\t\t\t\th('div.label.status.hidden@statusLabel'),\n\t\t\t\th('div.actions.secondary.hidden@toolbar2'),\n\t\t\t]),\n\t\t]\n\t);\n\n\tprotected readonly _store = new DisposableStore();\n\n\tprivate readonly _defaultChatModel: ChatModel;\n\tprivate readonly _ctxInputEditorFocused: IContextKey<boolean>;\n\tprivate readonly _ctxResponseFocused: IContextKey<boolean>;\n\n\tprivate readonly _chatWidget: ChatWidget;\n\n\tprotected readonly _onDidChangeHeight = this._store.add(new Emitter<void>());\n\treadonly onDidChangeHeight: Event<void> = Event.filter(this._onDidChangeHeight.event, _ => !this._isLayouting);\n\n\tprivate readonly _onDidChangeInput = this._store.add(new Emitter<this>());\n\treadonly onDidChangeInput: Event<this> = this._onDidChangeInput.event;\n\n\tprivate _isLayouting: boolean = false;\n\n\treadonly scopedContextKeyService: IContextKeyService;\n\n\tconstructor(\n\t\tlocation: IChatWidgetLocationOptions,\n\t\toptions: IInlineChatWidgetConstructionOptions,\n\t\t@IInstantiationService protected readonly _instantiationService: IInstantiationService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IKeybindingService private readonly _keybindingService: IKeybindingService,\n\t\t@IAccessibilityService private readonly _accessibilityService: IAccessibilityService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService,\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService,\n\t\t@ITextModelService protected readonly _textModelResolverService: ITextModelService,\n\t\t@IChatService private readonly _chatService: IChatService,\n\t\t@IHoverService private readonly _hoverService: IHoverService,\n\t) {\n\t\tthis.scopedContextKeyService = this._store.add(_contextKeyService.createScoped(this._elements.chatWidget));\n\t\tconst scopedInstaService = _instantiationService.createChild(\n\t\t\tnew ServiceCollection([\n\t\t\t\tIContextKeyService,\n\t\t\t\tthis.scopedContextKeyService\n\t\t\t]),\n\t\t\tthis._store\n\t\t);\n\n\t\tthis._chatWidget = scopedInstaService.createInstance(\n\t\t\tChatWidget,\n\t\t\tlocation,\n\t\t\tundefined,\n\t\t\t{\n\t\t\t\tdefaultElementHeight: 32,\n\t\t\t\trenderStyle: 'minimal',\n\t\t\t\trenderInputOnTop: false,\n\t\t\t\trenderFollowups: true,\n\t\t\t\tsupportsFileReferences: _configurationService.getValue(`chat.experimental.variables.${location.location}`) === true,\n\t\t\t\tfilter: item => {\n\t\t\t\t\tif (isWelcomeVM(item)) {\n\t\t\t\t\t\t// filter welcome messages\n\t\t\t\t\t\treturn false;\n\t\t\t\t\t}\n\t\t\t\t\tif (isResponseVM(item) && item.isComplete && !item.errorDetails) {\n\t\t\t\t\t\t// filter responses that\n\t\t\t\t\t\t// - are just text edits(prevents the \"Made Edits\")\n\t\t\t\t\t\t// - are all empty\n\t\t\t\t\t\tif (item.response.value.length > 0 && item.response.value.every(item => item.kind === 'textEditGroup' && options.chatWidgetViewOptions?.rendererOptions?.renderTextEditsAsSummary?.(item.uri))) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif (item.response.value.length === 0) {\n\t\t\t\t\t\t\treturn false;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t\t...options.chatWidgetViewOptions\n\t\t\t},\n\t\t\t{\n\t\t\t\tlistForeground: inlineChatForeground,\n\t\t\t\tlistBackground: inlineChatBackground,\n\t\t\t\toverlayBackground: EDITOR_DRAG_AND_DROP_BACKGROUND,\n\t\t\t\tinputEditorBackground: inputBackground,\n\t\t\t\tresultEditorBackground: editorBackground\n\t\t\t}\n\t\t);\n\t\tthis._chatWidget.render(this._elements.chatWidget);\n\t\tthis._elements.chatWidget.style.setProperty(asCssVariableName(chatRequestBackground), asCssVariable(inlineChatBackground));\n\t\tthis._chatWidget.setVisible(true);\n\t\tthis._store.add(this._chatWidget);\n\n\t\tconst ctxResponse = CONTEXT_RESPONSE.bindTo(this.scopedContextKeyService);\n\t\tconst ctxResponseVote = CONTEXT_RESPONSE_VOTE.bindTo(this.scopedContextKeyService);\n\t\tconst ctxResponseSupportIssues = CONTEXT_CHAT_RESPONSE_SUPPORT_ISSUE_REPORTING.bindTo(this.scopedContextKeyService);\n\t\tconst ctxResponseError = CONTEXT_RESPONSE_ERROR.bindTo(this.scopedContextKeyService);\n\t\tconst ctxResponseErrorFiltered = CONTEXT_RESPONSE_FILTERED.bindTo(this.scopedContextKeyService);\n\n\t\tconst viewModelStore = this._store.add(new DisposableStore());\n\t\tthis._store.add(this._chatWidget.onDidChangeViewModel(() => {\n\t\t\tviewModelStore.clear();\n\n\t\t\tconst viewModel = this._chatWidget.viewModel;\n\t\t\tif (!viewModel) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tviewModelStore.add(toDisposable(() => {\n\t\t\t\ttoolbar2.context = undefined;\n\t\t\t\tctxResponse.reset();\n\t\t\t\tctxResponseVote.reset();\n\t\t\t\tctxResponseError.reset();\n\t\t\t\tctxResponseErrorFiltered.reset();\n\t\t\t\tctxResponseSupportIssues.reset();\n\t\t\t}));\n\n\t\t\tviewModelStore.add(viewModel.onDidChange(() => {\n\n\t\t\t\tconst last = viewModel.getItems().at(-1);\n\t\t\t\ttoolbar2.context = last;\n\n\t\t\t\tctxResponse.set(isResponseVM(last));\n\t\t\t\tctxResponseVote.set(isResponseVM(last) ? last.vote === ChatAgentVoteDirection.Down ? 'down' : last.vote === ChatAgentVoteDirection.Up ? 'up' : '' : '');\n\t\t\t\tctxResponseError.set(isResponseVM(last) && last.errorDetails !== undefined);\n\t\t\t\tctxResponseErrorFiltered.set((!!(isResponseVM(last) && last.errorDetails?.responseIsFiltered)));\n\t\t\t\tctxResponseSupportIssues.set(isResponseVM(last) && (last.agent?.metadata.supportIssueReporting ?? false));\n\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}));\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}));\n\n\t\tthis._store.add(this.chatWidget.onDidChangeContentHeight(() => {\n\t\t\tthis._onDidChangeHeight.fire();\n\t\t}));\n\n\t\t// context keys\n\t\tthis._ctxResponseFocused = CTX_INLINE_CHAT_RESPONSE_FOCUSED.bindTo(this._contextKeyService);\n\t\tconst tracker = this._store.add(trackFocus(this.domNode));\n\t\tthis._store.add(tracker.onDidBlur(() => this._ctxResponseFocused.set(false)));\n\t\tthis._store.add(tracker.onDidFocus(() => this._ctxResponseFocused.set(true)));\n\n\t\tthis._ctxInputEditorFocused = CTX_INLINE_CHAT_FOCUSED.bindTo(_contextKeyService);\n\t\tthis._store.add(this._chatWidget.inputEditor.onDidFocusEditorWidget(() => this._ctxInputEditorFocused.set(true)));\n\t\tthis._store.add(this._chatWidget.inputEditor.onDidBlurEditorWidget(() => this._ctxInputEditorFocused.set(false)));\n\n\t\tconst statusMenuId = options.statusMenuId instanceof MenuId ? options.statusMenuId : options.statusMenuId.menu;\n\n\t\t// BUTTON bar\n\t\tconst statusMenuOptions = options.statusMenuId instanceof MenuId ? undefined : options.statusMenuId.options;\n\t\tconst statusButtonBar = scopedInstaService.createInstance(MenuWorkbenchButtonBar, this._elements.toolbar1, statusMenuId, {\n\t\t\ttoolbarOptions: { primaryGroup: '0_main' },\n\t\t\ttelemetrySource: options.chatWidgetViewOptions?.menus?.telemetrySource,\n\t\t\tmenuOptions: { renderShortTitle: true },\n\t\t\t...statusMenuOptions,\n\t\t});\n\t\tthis._store.add(statusButtonBar.onDidChange(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(statusButtonBar);\n\n\t\t// secondary toolbar\n\t\tconst toolbar2 = scopedInstaService.createInstance(MenuWorkbenchToolBar, this._elements.toolbar2, options.secondaryMenuId ?? MenuId.for(''), {\n\t\t\ttelemetrySource: options.chatWidgetViewOptions?.menus?.telemetrySource,\n\t\t\tmenuOptions: { renderShortTitle: true, shouldForwardArgs: true },\n\t\t\tactionViewItemProvider: (action: IAction, options: IActionViewItemOptions) => {\n\t\t\t\tif (action instanceof MenuItemAction && action.item.id === MarkUnhelpfulActionId) {\n\t\t\t\t\treturn scopedInstaService.createInstance(ChatVoteDownButton, action, options as IMenuEntryActionViewItemOptions);\n\t\t\t\t}\n\t\t\t\treturn createActionViewItem(scopedInstaService, action, options);\n\t\t\t}\n\t\t});\n\t\tthis._store.add(toolbar2.onDidChangeMenuItems(() => this._onDidChangeHeight.fire()));\n\t\tthis._store.add(toolbar2);\n\n\n\t\tthis._store.add(this._configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(AccessibilityVerbositySettingId.InlineChat)) {\n\t\t\t\tthis._updateAriaLabel();\n\t\t\t}\n\t\t}));\n\n\t\tthis._elements.root.tabIndex = 0;\n\t\tthis._elements.statusLabel.tabIndex = 0;\n\t\tthis._updateAriaLabel();\n\n\t\t// this._elements.status\n\t\tthis._store.add(this._hoverService.setupManagedHover(getDefaultHoverDelegate('element'), this._elements.statusLabel, () => {\n\t\t\treturn this._elements.statusLabel.dataset['title'];\n\t\t}));\n\n\t\tthis._store.add(this._chatService.onDidPerformUserAction(e => {\n\t\t\tif (e.sessionId === this._chatWidget.viewModel?.model.sessionId && e.action.kind === 'vote') {\n\t\t\t\tthis.updateStatus('Thank you for your feedback!', { resetAfter: 1250 });\n\t\t\t}\n\t\t}));\n\n\t\t// LEGACY - default chat model\n\t\t// this is only here for as long as we offer updateChatMessage\n\t\tthis._defaultChatModel = this._store.add(this._instantiationService.createInstance(ChatModel, undefined, ChatAgentLocation.Editor));\n\t\tthis._defaultChatModel.startInitialize();\n\t\tthis._defaultChatModel.initialize(undefined);\n\t\tthis.setChatModel(this._defaultChatModel);\n\t}\n\n\tprivate _updateAriaLabel(): void {\n\n\t\tthis._elements.root.ariaLabel = this._accessibleViewService.getOpenAriaHint(AccessibilityVerbositySettingId.InlineChat);\n\n\t\tif (this._accessibilityService.isScreenReaderOptimized()) {\n\t\t\tlet label = defaultAriaLabel;\n\t\t\tif (this._configurationService.getValue<boolean>(AccessibilityVerbositySettingId.InlineChat)) {\n\t\t\t\tconst kbLabel = this._keybindingService.lookupKeybinding(AccessibilityCommandId.OpenAccessibilityHelp)?.getLabel();\n\t\t\t\tlabel = kbLabel\n\t\t\t\t\t? localize('inlineChat.accessibilityHelp', \"Inline Chat Input, Use {0} for Inline Chat Accessibility Help.\", kbLabel)\n\t\t\t\t\t: localize('inlineChat.accessibilityHelpNoKb', \"Inline Chat Input, Run the Inline Chat Accessibility Help command for more information.\");\n\t\t\t}\n\t\t\tthis._chatWidget.inputEditor.updateOptions({ ariaLabel: label });\n\t\t}\n\t}\n\n\tdispose(): void {\n\t\tthis._store.dispose();\n\t}\n\n\tget domNode(): HTMLElement {\n\t\treturn this._elements.root;\n\t}\n\n\tget chatWidget(): ChatWidget {\n\t\treturn this._chatWidget;\n\t}\n\n\tsaveState() {\n\t\tthis._chatWidget.saveState();\n\t}\n\n\tlayout(widgetDim: Dimension) {\n\t\tthis._isLayouting = true;\n\t\ttry {\n\t\t\tthis._doLayout(widgetDim);\n\t\t} finally {\n\t\t\tthis._isLayouting = false;\n\t\t}\n\t}\n\n\tprotected _doLayout(dimension: Dimension): void {\n\t\tconst extraHeight = this._getExtraHeight();\n\t\tconst statusHeight = getTotalHeight(this._elements.status);\n\n\t\t// console.log('ZONE#Widget#layout', { height: dimension.height, extraHeight, progressHeight, followUpsHeight, statusHeight, LIST: dimension.height - progressHeight - followUpsHeight - statusHeight - extraHeight });\n\n\t\tthis._elements.root.style.height = `${dimension.height - extraHeight}px`;\n\t\tthis._elements.root.style.width = `${dimension.width}px`;\n\n\t\tthis._chatWidget.layout(\n\t\t\tdimension.height - statusHeight - extraHeight,\n\t\t\tdimension.width\n\t\t);\n\t}\n\n\t/**\n\t * The content height of this widget is the size that would require no scrolling\n\t */\n\tget contentHeight(): number {\n\t\tconst data = {\n\t\t\tchatWidgetContentHeight: this._chatWidget.contentHeight,\n\t\t\tstatusHeight: getTotalHeight(this._elements.status),\n\t\t\textraHeight: this._getExtraHeight()\n\t\t};\n\t\tconst result = data.chatWidgetContentHeight + data.statusHeight + data.extraHeight;\n\t\treturn result;\n\t}\n\n\tget minHeight(): number {\n\t\t// The chat widget is variable height and supports scrolling. It should be\n\t\t// at least \"maxWidgetHeight\" high and at most the content height.\n\n\t\tlet maxWidgetOutputHeight = 100;\n\t\tfor (const item of this._chatWidget.viewModel?.getItems() ?? []) {\n\t\t\tif (isResponseVM(item) && item.response.value.some(r => r.kind === 'textEditGroup' && !r.state?.applied)) {\n\t\t\t\tmaxWidgetOutputHeight = 270;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tlet value = this.contentHeight;\n\t\tvalue -= this._chatWidget.contentHeight;\n\t\tvalue += Math.min(this._chatWidget.input.contentHeight + maxWidgetOutputHeight, this._chatWidget.contentHeight);\n\t\treturn value;\n\t}\n\n\tprotected _getExtraHeight(): number {\n\t\treturn 2 /*border*/ + 4 /*shadow*/;\n\t}\n\n\tget value(): string {\n\t\treturn this._chatWidget.getInput();\n\t}\n\n\tset value(value: string) {\n\t\tthis._chatWidget.setInput(value);\n\t}\n\n\n\tselectAll(includeSlashCommand: boolean = true) {\n\t\t// DEBT@jrieken\n\t\t// REMOVE when agents are adopted\n\t\tlet startColumn = 1;\n\t\tif (!includeSlashCommand) {\n\t\t\tconst match = /^(\\/\\w+)\\s*/.exec(this._chatWidget.inputEditor.getModel()!.getLineContent(1));\n\t\t\tif (match) {\n\t\t\t\tstartColumn = match[1].length + 1;\n\t\t\t}\n\t\t}\n\t\tthis._chatWidget.inputEditor.setSelection(new Selection(1, startColumn, Number.MAX_SAFE_INTEGER, 1));\n\t}\n\n\tset placeholder(value: string) {\n\t\tthis._chatWidget.setInputPlaceholder(value);\n\t}\n\n\ttoggleStatus(show: boolean) {\n\t\tthis._elements.toolbar1.classList.toggle('hidden', !show);\n\t\tthis._elements.toolbar2.classList.toggle('hidden', !show);\n\t\tthis._elements.status.classList.toggle('hidden', !show);\n\t\tthis._elements.infoLabel.classList.toggle('hidden', !show);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tupdateToolbar(show: boolean) {\n\t\tthis._elements.root.classList.toggle('toolbar', show);\n\t\tthis._elements.toolbar1.classList.toggle('hidden', !show);\n\t\tthis._elements.toolbar2.classList.toggle('hidden', !show);\n\t\tthis._elements.status.classList.toggle('actions', show);\n\t\tthis._elements.infoLabel.classList.toggle('hidden', show);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tasync getCodeBlockInfo(codeBlockIndex: number): Promise<IResolvedTextEditorModel | undefined> {\n\t\tconst { viewModel } = this._chatWidget;\n\t\tif (!viewModel) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst items = viewModel.getItems().filter(i => isResponseVM(i));\n\t\tif (!items.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst item = items[items.length - 1];\n\t\treturn viewModel.codeBlockModelCollection.get(viewModel.sessionId, item, codeBlockIndex)?.model;\n\t}\n\n\tget responseContent(): string | undefined {\n\t\tconst requests = this._chatWidget.viewModel?.model.getRequests();\n\t\tif (!isNonEmptyArray(requests)) {\n\t\t\treturn undefined;\n\t\t}\n\t\treturn tail(requests)?.response?.response.toString();\n\t}\n\n\n\tgetChatModel(): IChatModel {\n\t\treturn this._chatWidget.viewModel?.model ?? this._defaultChatModel;\n\t}\n\n\tsetChatModel(chatModel: IChatModel) {\n\t\tthis._chatWidget.setModel(chatModel, { inputValue: undefined });\n\t}\n\n\t/**\n\t * @deprecated use `setChatModel` instead\n\t */\n\tupdateChatMessage(message: IInlineChatMessage, isIncomplete: true): IInlineChatMessageAppender;\n\tupdateChatMessage(message: IInlineChatMessage | undefined): void;\n\tupdateChatMessage(message: IInlineChatMessage | undefined, isIncomplete?: boolean, isCodeBlockEditable?: boolean): IInlineChatMessageAppender | undefined;\n\tupdateChatMessage(message: IInlineChatMessage | undefined, isIncomplete?: boolean, isCodeBlockEditable?: boolean): IInlineChatMessageAppender | undefined {\n\n\t\tif (!this._chatWidget.viewModel || this._chatWidget.viewModel.model !== this._defaultChatModel) {\n\t\t\t// this can only be used with the default chat model\n\t\t\treturn;\n\t\t}\n\n\t\tconst model = this._defaultChatModel;\n\t\tif (!message?.message.value) {\n\t\t\tfor (const request of model.getRequests()) {\n\t\t\t\tmodel.removeRequest(request.id);\n\t\t\t}\n\t\t\treturn;\n\t\t}\n\n\t\tconst chatRequest = model.addRequest({ parts: [], text: '' }, { variables: [] }, 0);\n\t\tmodel.acceptResponseProgress(chatRequest, {\n\t\t\tkind: 'markdownContent',\n\t\t\tcontent: message.message\n\t\t});\n\n\t\tif (!isIncomplete) {\n\t\t\tmodel.completeResponse(chatRequest);\n\t\t\treturn;\n\t\t}\n\t\treturn {\n\t\t\tcancel: () => model.cancelRequest(chatRequest),\n\t\t\tcomplete: () => model.completeResponse(chatRequest),\n\t\t\tappendContent: (fragment: string) => {\n\t\t\t\tmodel.acceptResponseProgress(chatRequest, {\n\t\t\t\t\tkind: 'markdownContent',\n\t\t\t\t\tcontent: new MarkdownString(fragment)\n\t\t\t\t});\n\t\t\t}\n\t\t};\n\t}\n\n\tupdateInfo(message: string): void {\n\t\tthis._elements.infoLabel.classList.toggle('hidden', !message);\n\t\tconst renderedMessage = renderLabelWithIcons(message);\n\t\treset(this._elements.infoLabel, ...renderedMessage);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tupdateStatus(message: string, ops: { classes?: string[]; resetAfter?: number; keepMessage?: boolean; title?: string } = {}) {\n\t\tconst isTempMessage = typeof ops.resetAfter === 'number';\n\t\tif (isTempMessage && !this._elements.statusLabel.dataset['state']) {\n\t\t\tconst statusLabel = this._elements.statusLabel.innerText;\n\t\t\tconst title = this._elements.statusLabel.dataset['title'];\n\t\t\tconst classes = Array.from(this._elements.statusLabel.classList.values());\n\t\t\tsetTimeout(() => {\n\t\t\t\tthis.updateStatus(statusLabel, { classes, keepMessage: true, title });\n\t\t\t}, ops.resetAfter);\n\t\t}\n\t\tconst renderedMessage = renderLabelWithIcons(message);\n\t\treset(this._elements.statusLabel, ...renderedMessage);\n\t\tthis._elements.statusLabel.className = `label status ${(ops.classes ?? []).join(' ')}`;\n\t\tthis._elements.statusLabel.classList.toggle('hidden', !message);\n\t\tif (isTempMessage) {\n\t\t\tthis._elements.statusLabel.dataset['state'] = 'temp';\n\t\t} else {\n\t\t\tdelete this._elements.statusLabel.dataset['state'];\n\t\t}\n\n\t\tif (ops.title) {\n\t\t\tthis._elements.statusLabel.dataset['title'] = ops.title;\n\t\t} else {\n\t\t\tdelete this._elements.statusLabel.dataset['title'];\n\t\t}\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\treset() {\n\t\tthis._chatWidget.setContext(true);\n\t\tthis._chatWidget.saveState();\n\t\tthis.updateChatMessage(undefined);\n\n\t\treset(this._elements.statusLabel);\n\t\tthis._elements.statusLabel.classList.toggle('hidden', true);\n\t\tthis._elements.toolbar1.classList.add('hidden');\n\t\tthis._elements.toolbar2.classList.add('hidden');\n\t\tthis.updateInfo('');\n\n\t\tthis.chatWidget.setModel(this._defaultChatModel, {});\n\n\t\tthis._elements.accessibleViewer.classList.toggle('hidden', true);\n\t\tthis._onDidChangeHeight.fire();\n\t}\n\n\tfocus() {\n\t\tthis._chatWidget.focusInput();\n\t}\n\n\thasFocus() {\n\t\treturn this.domNode.contains(getActiveElement());\n\t}\n\n}\n\nconst defaultAriaLabel = localize('aria-label', \"Inline Chat Input\");\n\nexport class EditorBasedInlineChatWidget extends InlineChatWidget {\n\n\tprivate readonly _accessibleViewer = this._store.add(new MutableDisposable<HunkAccessibleDiffViewer>());\n\n\tconstructor(\n\t\tlocation: IChatWidgetLocationOptions,\n\t\tprivate readonly _parentEditor: ICodeEditor,\n\t\toptions: IInlineChatWidgetConstructionOptions,\n\t\t@IContextKeyService contextKeyService: IContextKeyService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@IAccessibilityService accessibilityService: IAccessibilityService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IAccessibleViewService accessibleViewService: IAccessibleViewService,\n\t\t@ITextModelService textModelResolverService: ITextModelService,\n\t\t@IChatService chatService: IChatService,\n\t\t@IHoverService hoverService: IHoverService,\n\t) {\n\t\tsuper(location, { ...options, chatWidgetViewOptions: { ...options.chatWidgetViewOptions, editorOverflowWidgetsDomNode: _parentEditor.getOverflowWidgetsDomNode() } }, instantiationService, contextKeyService, keybindingService, accessibilityService, configurationService, accessibleViewService, textModelResolverService, chatService, hoverService);\n\t}\n\n\t// --- layout\n\n\toverride get contentHeight(): number {\n\t\tlet result = super.contentHeight;\n\n\t\tif (this._accessibleViewer.value) {\n\t\t\tresult += this._accessibleViewer.value.height + 8 /* padding */;\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprotected override _doLayout(dimension: Dimension): void {\n\n\t\tlet newHeight = dimension.height;\n\n\t\tif (this._accessibleViewer.value) {\n\t\t\tthis._accessibleViewer.value.width = dimension.width - 12;\n\t\t\tnewHeight -= this._accessibleViewer.value.height + 8;\n\t\t}\n\n\t\tsuper._doLayout(dimension.with(undefined, newHeight));\n\n\t\t// update/fix the height of the zone which was set to newHeight in super._doLayout\n\t\tthis._elements.root.style.height = `${dimension.height - this._getExtraHeight()}px`;\n\t}\n\n\toverride reset() {\n\t\tthis._accessibleViewer.clear();\n\t\tsuper.reset();\n\t}\n\n\t// --- accessible viewer\n\n\tshowAccessibleHunk(session: Session, hunkData: HunkInformation): void {\n\n\t\tthis._elements.accessibleViewer.classList.remove('hidden');\n\t\tthis._accessibleViewer.clear();\n\n\t\tthis._accessibleViewer.value = this._instantiationService.createInstance(HunkAccessibleDiffViewer,\n\t\t\tthis._elements.accessibleViewer,\n\t\t\tsession,\n\t\t\thunkData,\n\t\t\tnew AccessibleHunk(this._parentEditor, session, hunkData)\n\t\t);\n\n\t\tthis._onDidChangeHeight.fire();\n\t}\n}\n\nclass HunkAccessibleDiffViewer extends AccessibleDiffViewer {\n\n\treadonly height: number;\n\n\tset width(value: number) {\n\t\tthis._width2.set(value, undefined);\n\t}\n\n\tprivate readonly _width2: ISettableObservable<number>;\n\n\tconstructor(\n\t\tparentNode: HTMLElement,\n\t\tsession: Session,\n\t\thunk: HunkInformation,\n\t\tmodels: IAccessibleDiffViewerModel,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t) {\n\t\tconst width = observableValue('width', 0);\n\t\tconst diff = observableValue('diff', HunkAccessibleDiffViewer._asMapping(hunk));\n\t\tconst diffs = derived(r => [diff.read(r)]);\n\t\tconst lines = Math.min(10, 8 + diff.get().changedLineCount);\n\t\tconst height = models.getModifiedOptions().get(EditorOption.lineHeight) * lines;\n\n\t\tsuper(parentNode, constObservable(true), () => { }, constObservable(false), width, constObservable(height), diffs, models, instantiationService);\n\n\t\tthis.height = height;\n\t\tthis._width2 = width;\n\n\t\tthis._store.add(session.textModelN.onDidChangeContent(() => {\n\t\t\tdiff.set(HunkAccessibleDiffViewer._asMapping(hunk), undefined);\n\t\t}));\n\t}\n\n\tprivate static _asMapping(hunk: HunkInformation): DetailedLineRangeMapping {\n\t\tconst ranges0 = hunk.getRanges0();\n\t\tconst rangesN = hunk.getRangesN();\n\t\tconst originalLineRange = LineRange.fromRangeInclusive(ranges0[0]);\n\t\tconst modifiedLineRange = LineRange.fromRangeInclusive(rangesN[0]);\n\t\tconst innerChanges: RangeMapping[] = [];\n\t\tfor (let i = 1; i < ranges0.length; i++) {\n\t\t\tinnerChanges.push(new RangeMapping(ranges0[i], rangesN[i]));\n\t\t}\n\t\treturn new DetailedLineRangeMapping(originalLineRange, modifiedLineRange, innerChanges);\n\t}\n\n}\n\nclass AccessibleHunk implements IAccessibleDiffViewerModel {\n\n\tconstructor(\n\t\tprivate readonly _editor: ICodeEditor,\n\t\tprivate readonly _session: Session,\n\t\tprivate readonly _hunk: HunkInformation\n\t) { }\n\n\tgetOriginalModel(): ITextModel {\n\t\treturn this._session.textModel0;\n\t}\n\tgetModifiedModel(): ITextModel {\n\t\treturn this._session.textModelN;\n\t}\n\tgetOriginalOptions(): IComputedEditorOptions {\n\t\treturn this._editor.getOptions();\n\t}\n\tgetModifiedOptions(): IComputedEditorOptions {\n\t\treturn this._editor.getOptions();\n\t}\n\toriginalReveal(range: Range): void {\n\t\t// throw new Error('Method not implemented.');\n\t}\n\tmodifiedReveal(range?: Range | undefined): void {\n\t\tthis._editor.revealRangeInCenterIfOutsideViewport(range || this._hunk.getRangesN()[0], ScrollType.Smooth);\n\t}\n\tmodifiedSetSelection(range: Range): void {\n\t\t// this._editor.revealRangeInCenterIfOutsideViewport(range, ScrollType.Smooth);\n\t\t// this._editor.setSelection(range);\n\t}\n\tmodifiedFocus(): void {\n\t\tthis._editor.focus();\n\t}\n\tgetModifiedPosition(): Position | undefined {\n\t\treturn this._hunk.getRangesN()[0].getStartPosition();\n\t}\n}\n"],
  "mappings": "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",
  "names": ["item", "options"]
}
