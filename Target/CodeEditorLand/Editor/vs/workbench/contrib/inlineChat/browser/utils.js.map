{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/inlineChat/browser/utils.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { EditOperation } from '../../../../editor/common/core/editOperation.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { IIdentifiedSingleEditOperation, ITextModel, IValidEditOperation, TrackedRangeStickiness } from '../../../../editor/common/model.js';\nimport { IEditObserver } from './inlineChatStrategies.js';\nimport { IProgress } from '../../../../platform/progress/common/progress.js';\nimport { IntervalTimer, AsyncIterableSource } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { getNWords } from '../../chat/common/chatWordCounter.js';\n\n\n\n// --- async edit\n\nexport interface AsyncTextEdit {\n\treadonly range: IRange;\n\treadonly newText: AsyncIterable<string>;\n}\n\nexport async function performAsyncTextEdit(model: ITextModel, edit: AsyncTextEdit, progress?: IProgress<IValidEditOperation[]>, obs?: IEditObserver) {\n\n\tconst [id] = model.deltaDecorations([], [{\n\t\trange: edit.range,\n\t\toptions: {\n\t\t\tdescription: 'asyncTextEdit',\n\t\t\tstickiness: TrackedRangeStickiness.AlwaysGrowsWhenTypingAtEdges\n\t\t}\n\t}]);\n\n\tlet first = true;\n\tfor await (const part of edit.newText) {\n\n\t\tif (model.isDisposed()) {\n\t\t\tbreak;\n\t\t}\n\n\t\tconst range = model.getDecorationRange(id);\n\t\tif (!range) {\n\t\t\tthrow new Error('FAILED to perform async replace edit because the anchor decoration was removed');\n\t\t}\n\n\t\tconst edit = first\n\t\t\t? EditOperation.replace(range, part) // first edit needs to override the \"anchor\"\n\t\t\t: EditOperation.insert(range.getEndPosition(), part);\n\t\tobs?.start();\n\t\tmodel.pushEditOperations(null, [edit], (undoEdits) => {\n\t\t\tprogress?.report(undoEdits);\n\t\t\treturn null;\n\t\t});\n\t\tobs?.stop();\n\t\tfirst = false;\n\t}\n}\n\nexport function asProgressiveEdit(interval: IntervalTimer, edit: IIdentifiedSingleEditOperation, wordsPerSec: number, token: CancellationToken): AsyncTextEdit {\n\n\twordsPerSec = Math.max(30, wordsPerSec);\n\n\tconst stream = new AsyncIterableSource<string>();\n\tlet newText = edit.text ?? '';\n\n\tinterval.cancelAndSet(() => {\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn;\n\t\t}\n\t\tconst r = getNWords(newText, 1);\n\t\tstream.emitOne(r.value);\n\t\tnewText = newText.substring(r.value.length);\n\t\tif (r.isFullString) {\n\t\t\tinterval.cancel();\n\t\t\tstream.resolve();\n\t\t\td.dispose();\n\t\t}\n\n\t}, 1000 / wordsPerSec);\n\n\t// cancel ASAP\n\tconst d = token.onCancellationRequested(() => {\n\t\tinterval.cancel();\n\t\tstream.resolve();\n\t\td.dispose();\n\t});\n\n\treturn {\n\t\trange: edit.range,\n\t\tnewText: stream.asyncIterable\n\t};\n}\n"],
  "mappings": ";;AAKA,SAAS,qBAAqB;AAC9B,SAAS,cAAc;AACvB,SAAS,gCAAgC,YAAY,qBAAqB,8BAA8B;AACxG,SAAS,qBAAqB;AAC9B,SAAS,iBAAiB;AAC1B,SAAS,eAAe,2BAA2B;AACnD,SAAS,yBAAyB;AAClC,SAAS,iBAAiB;AAW1B,eAAsB,qBAAqB,OAAmB,MAAqB,UAA6C,KAAqB;AAEpJ,QAAM,CAAC,EAAE,IAAI,MAAM,iBAAiB,CAAC,GAAG,CAAC;AAAA,IACxC,OAAO,KAAK;AAAA,IACZ,SAAS;AAAA,MACR,aAAa;AAAA,MACb,YAAY,uBAAuB;AAAA,IACpC;AAAA,EACD,CAAC,CAAC;AAEF,MAAI,QAAQ;AACZ,mBAAiB,QAAQ,KAAK,SAAS;AAEtC,QAAI,MAAM,WAAW,GAAG;AACvB;AAAA,IACD;AAEA,UAAM,QAAQ,MAAM,mBAAmB,EAAE;AACzC,QAAI,CAAC,OAAO;AACX,YAAM,IAAI,MAAM,gFAAgF;AAAA,IACjG;AAEA,UAAMA,QAAO,QACV,cAAc,QAAQ,OAAO,IAAI,IACjC,cAAc,OAAO,MAAM,eAAe,GAAG,IAAI;AACpD,SAAK,MAAM;AACX,UAAM,mBAAmB,MAAM,CAACA,KAAI,GAAG,CAAC,cAAc;AACrD,gBAAU,OAAO,SAAS;AAC1B,aAAO;AAAA,IACR,CAAC;AACD,SAAK,KAAK;AACV,YAAQ;AAAA,EACT;AACD;AAjCsB;AAmCf,SAAS,kBAAkB,UAAyB,MAAsC,aAAqB,OAAyC;AAE9J,gBAAc,KAAK,IAAI,IAAI,WAAW;AAEtC,QAAM,SAAS,IAAI,oBAA4B;AAC/C,MAAI,UAAU,KAAK,QAAQ;AAE3B,WAAS,aAAa,MAAM;AAC3B,QAAI,MAAM,yBAAyB;AAClC;AAAA,IACD;AACA,UAAM,IAAI,UAAU,SAAS,CAAC;AAC9B,WAAO,QAAQ,EAAE,KAAK;AACtB,cAAU,QAAQ,UAAU,EAAE,MAAM,MAAM;AAC1C,QAAI,EAAE,cAAc;AACnB,eAAS,OAAO;AAChB,aAAO,QAAQ;AACf,QAAE,QAAQ;AAAA,IACX;AAAA,EAED,GAAG,MAAO,WAAW;AAGrB,QAAM,IAAI,MAAM,wBAAwB,MAAM;AAC7C,aAAS,OAAO;AAChB,WAAO,QAAQ;AACf,MAAE,QAAQ;AAAA,EACX,CAAC;AAED,SAAO;AAAA,IACN,OAAO,KAAK;AAAA,IACZ,SAAS,OAAO;AAAA,EACjB;AACD;AAjCgB;",
  "names": ["edit"]
}
