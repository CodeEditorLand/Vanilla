var l=Object.defineProperty;var D=Object.getOwnPropertyDescriptor;var c=(t,r,i,o)=>{for(var e=o>1?void 0:o?D(r,i):r,f=t.length-1,n;f>=0;f--)(n=t[f])&&(e=(o?n(r,i,e):n(e))||e);return o&&e&&l(r,i,e),e},u=(t,r)=>(i,o)=>r(i,o,t);import{Emitter as m}from"../../../../base/common/event.js";import{Disposable as P}from"../../../../base/common/lifecycle.js";import{isEqualOrParent as d}from"../../../../base/common/resources.js";import{score as k}from"../../../../editor/common/languageSelector.js";import{IUriIdentityService as v}from"../../../../platform/uriIdentity/common/uriIdentity.js";function p(t){return(r,i)=>{if(r.rootUri&&!i.rootUri)return-1;if(!r.rootUri&&i.rootUri)return 1;if(!r.rootUri&&!i.rootUri)return 0;const o=d(t,r.rootUri),e=d(t,i.rootUri);return o&&e?r.rootUri.fsPath.length-i.rootUri.fsPath.length:o?-1:e?1:0}}let a=class extends P{constructor(i){super();this.uriIdentityService=i}quickDiffProviders=new Set;_onDidChangeQuickDiffProviders=this._register(new m);onDidChangeQuickDiffProviders=this._onDidChangeQuickDiffProviders.event;addQuickDiffProvider(i){return this.quickDiffProviders.add(i),this._onDidChangeQuickDiffProviders.fire(),{dispose:()=>{this.quickDiffProviders.delete(i),this._onDidChangeQuickDiffProviders.fire()}}}isQuickDiff(i){return!!i.originalResource&&typeof i.label=="string"&&typeof i.isSCM=="boolean"}async getQuickDiffs(i,o="",e=!1){const f=Array.from(this.quickDiffProviders).filter(s=>!s.rootUri||this.uriIdentityService.extUri.isEqualOrParent(i,s.rootUri)).sort(p(i));return(await Promise.all(f.map(async s=>({originalResource:(s.selector?k(s.selector,i,o,e,void 0,void 0):10)>0?await s.getOriginalResource(i)??void 0:void 0,label:s.label,isSCM:s.isSCM})))).filter(this.isQuickDiff)}};a=c([u(0,v)],a);export{a as QuickDiffService};
