var y=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var h=(a,l,e,t)=>{for(var o=t>1?void 0:t?b(l,e):l,r=a.length-1,n;r>=0;r--)(n=a[r])&&(o=(t?n(l,e,o):n(o))||o);return t&&o&&y(l,e,o),o},c=(a,l)=>(e,t)=>l(e,t,a);import"./media/scm.css";import{localize as M}from"../../../../nls.js";import{Event as L}from"../../../../base/common/event.js";import{ViewPane as w}from"../../../browser/parts/views/viewPane.js";import{append as R,$ as V}from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/list/list.js";import{ISCMViewService as x}from"../common/scm.js";import{IInstantiationService as T}from"../../../../platform/instantiation/common/instantiation.js";import{IContextMenuService as D}from"../../../../platform/contextview/browser/contextView.js";import{IContextKeyService as E}from"../../../../platform/contextkey/common/contextkey.js";import{IKeybindingService as A}from"../../../../platform/keybinding/common/keybinding.js";import{IThemeService as B}from"../../../../platform/theme/common/themeService.js";import{WorkbenchList as O}from"../../../../platform/list/browser/listService.js";import{IConfigurationService as _}from"../../../../platform/configuration/common/configuration.js";import{IViewDescriptorService as z}from"../../../common/views.js";import{IOpenerService as N}from"../../../../platform/opener/common/opener.js";import{ITelemetryService as P}from"../../../../platform/telemetry/common/telemetry.js";import{RepositoryActionRunner as F,RepositoryRenderer as d}from"./scmRepositoryRenderer.js";import{collectContextMenuActions as H,getActionViewItemProvider as W}from"./util.js";import{Orientation as v}from"../../../../base/browser/ui/sash/sash.js";import{Iterable as p}from"../../../../base/common/iterator.js";import{DisposableStore as K}from"../../../../base/common/lifecycle.js";import{MenuId as u}from"../../../../platform/actions/common/actions.js";import{IHoverService as k}from"../../../../platform/hover/browser/hover.js";class Y{getHeight(){return 22}getTemplateId(){return d.TEMPLATE_ID}}let m=class extends w{constructor(e,t,o,r,n,s,i,S,g,I,f,C){super({...e,titleMenuId:u.SCMSourceControlTitle},o,r,S,i,s,n,g,I,f,C);this.scmViewService=t}list;disposables=new K;renderBody(e){super.renderBody(e);const t=R(e,V(".scm-view.scm-repositories-view")),o=()=>{const i=this.configurationService.getValue("scm.providerCountBadge");t.classList.toggle("hide-provider-counts",i==="hidden"),t.classList.toggle("auto-provider-counts",i==="auto")};this._register(L.filter(this.configurationService.onDidChangeConfiguration,i=>i.affectsConfiguration("scm.providerCountBadge"),this.disposables)(o)),o();const r=new Y,n=this.instantiationService.createInstance(d,u.SCMSourceControlInline,W(this.instantiationService)),s={getId:i=>i.provider.id};this.list=this.instantiationService.createInstance(O,"SCM Main",t,r,[n],{identityProvider:s,horizontalScrolling:!1,overrideStyles:this.getLocationBasedColors().listOverrideStyles,accessibilityProvider:{getAriaLabel(i){return i.provider.label},getWidgetAriaLabel(){return M("scm","Source Control Repositories")}}}),this._register(this.list),this._register(this.list.onDidChangeSelection(this.onListSelectionChange,this)),this._register(this.list.onContextMenu(this.onListContextMenu,this)),this._register(this.scmViewService.onDidChangeRepositories(this.onDidChangeRepositories,this)),this._register(this.scmViewService.onDidChangeVisibleRepositories(this.updateListSelection,this)),this.orientation===v.VERTICAL&&this._register(this.configurationService.onDidChangeConfiguration(i=>{i.affectsConfiguration("scm.repositories.visible")&&this.updateBodySize()})),this.onDidChangeRepositories(),this.updateListSelection()}onDidChangeRepositories(){this.list.splice(0,this.list.length,this.scmViewService.repositories),this.updateBodySize()}focus(){super.focus(),this.list.domFocus()}layoutBody(e,t){super.layoutBody(e,t),this.list.layout(e,t)}updateBodySize(){if(this.orientation===v.HORIZONTAL)return;const e=this.configurationService.getValue("scm.repositories.visible"),t=this.list.length===0,o=Math.min(this.list.length,e)*22;this.minimumBodySize=e===0?22:o,this.maximumBodySize=e===0||t?Number.POSITIVE_INFINITY:o}onListContextMenu(e){if(!e.element)return;const t=e.element.provider,r=this.scmViewService.menus.getRepositoryMenus(t).repositoryContextMenu,n=H(r),s=this._register(new F(()=>this.list.getSelectedElements()));s.onWillRun(()=>this.list.domFocus()),this.contextMenuService.showContextMenu({actionRunner:s,getAnchor:()=>e.anchor,getActions:()=>n,getActionsContext:()=>t})}onListSelectionChange(e){if(e.browserEvent&&e.elements.length>0){const t=this.list.scrollTop;this.scmViewService.visibleRepositories=e.elements,this.list.scrollTop=t}}updateListSelection(){const e=this.list.getSelection(),t=new Set(p.map(e,i=>this.list.element(i))),o=new Set(this.scmViewService.visibleRepositories),r=new Set(p.filter(o,i=>!t.has(i))),n=new Set(p.filter(t,i=>!o.has(i)));if(r.size===0&&n.size===0)return;const s=e.filter(i=>!n.has(this.list.element(i)));for(let i=0;i<this.list.length;i++)r.has(this.list.element(i))&&s.push(i);this.list.setSelection(s),s.length>0&&s.indexOf(this.list.getFocus()[0])===-1&&(this.list.setAnchor(s[0]),this.list.setFocus([s[0]]))}dispose(){this.disposables.dispose(),super.dispose()}};m=h([c(1,x),c(2,A),c(3,D),c(4,T),c(5,z),c(6,E),c(7,_),c(8,N),c(9,B),c(10,P),c(11,k)],m);export{m as SCMRepositoriesViewPane};
