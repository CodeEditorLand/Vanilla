var f=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var b=(u,o,t,e)=>{for(var i=e>1?void 0:e?T(o,t):o,r=u.length-1,n;r>=0;r--)(n=u[r])&&(i=(e?n(o,t,i):n(i))||i);return e&&i&&f(o,t,i),i},s=(u,o)=>(t,e)=>o(t,e,u);import"./media/scm.css";import{DisposableStore as h,combinedDisposable as g}from"../../../../base/common/lifecycle.js";import{autorun as M}from"../../../../base/common/observable.js";import{append as l,$ as d}from"../../../../base/browser/dom.js";import{ISCMViewService as A}from"../common/scm.js";import{CountBadge as R}from"../../../../base/browser/ui/countBadge/countBadge.js";import{IContextMenuService as w}from"../../../../platform/contextview/browser/contextView.js";import{ICommandService as x}from"../../../../platform/commands/common/commands.js";import{ActionRunner as E}from"../../../../base/common/actions.js";import{connectPrimaryMenu as H,getRepositoryResourceCount as P,isSCMRepository as L,StatusBarAction as B}from"./util.js";import"../../../../base/browser/ui/tree/tree.js";import"../../../../base/browser/ui/tree/objectTree.js";import"../../../../base/common/filters.js";import"../../../../base/browser/ui/list/list.js";import"../../../../base/browser/ui/actionbar/actionbar.js";import{defaultCountBadgeStyles as D}from"../../../../platform/theme/browser/defaultStyles.js";import{WorkbenchToolBar as V}from"../../../../platform/actions/browser/toolbar.js";import{IMenuService as z,MenuId as K,MenuItemAction as k}from"../../../../platform/actions/common/actions.js";import{IContextKeyService as F}from"../../../../platform/contextkey/common/contextkey.js";import{IKeybindingService as N}from"../../../../platform/keybinding/common/keybinding.js";import{ITelemetryService as $}from"../../../../platform/telemetry/common/telemetry.js";import"../../../../base/browser/ui/hover/hover.js";import{IHoverService as U}from"../../../../platform/hover/browser/hover.js";import{getDefaultHoverDelegate as W}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";class Ae extends E{constructor(t){super();this.getSelectedRepositories=t}async runAction(t,e){if(!(t instanceof k))return super.runAction(t,e);const i=this.getSelectedRepositories().map(n=>n.provider),r=i.some(n=>n===e)?i:[e];await t.run(...r)}}let v=class{constructor(o,t,e,i,r,n,S,c,a,I){this.toolbarMenuId=o;this.actionViewItemProvider=t;this.commandService=e;this.contextKeyService=i;this.contextMenuService=r;this.hoverService=n;this.keybindingService=S;this.menuService=c;this.scmViewService=a;this.telemetryService=I}static TEMPLATE_ID="repository";get templateId(){return v.TEMPLATE_ID}renderTemplate(o){o.classList.contains("monaco-tl-contents")&&o.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const t=l(o,d(".scm-provider")),e=l(t,d(".label")),i=this.hoverService.setupManagedHover(W("mouse"),e,"",{}),r=l(e,d("span.name")),n=l(e,d("span.description")),S=l(t,d(".actions")),c=new V(S,{actionViewItemProvider:this.actionViewItemProvider,resetMenu:this.toolbarMenuId},this.menuService,this.contextKeyService,this.contextMenuService,this.keybindingService,this.commandService,this.telemetryService),a=l(t,d(".count")),I=new R(a,{},D),y=c.onDidChangeDropdownVisibility(p=>t.classList.toggle("active",p)),m=g(i,y,c);return{label:e,labelCustomHover:i,name:r,description:n,countContainer:a,count:I,toolBar:c,elementDisposables:new h,templateDisposable:m}}renderElement(o,t,e,i){const r=L(o)?o:o.element;e.name.textContent=r.provider.name,r.provider.rootUri?(e.labelCustomHover.update(`${r.provider.label}: ${r.provider.rootUri.fsPath}`),e.description.textContent=r.provider.label):(e.labelCustomHover.update(r.provider.label),e.description.textContent="");let n=[],S=[],c=[];const a=()=>{e.toolBar.setActions([...n,...S],c)};e.elementDisposables.add(M(m=>{n=(r.provider.statusBarCommands.read(m)??[]).map(C=>new B(C,this.commandService)),a()})),e.elementDisposables.add(M(m=>{const p=r.provider.count.read(m)??P(r.provider);e.countContainer.setAttribute("data-count",String(p)),e.count.setCount(p)}));const I=this.scmViewService.menus.getRepositoryMenus(r.provider),y=this.toolbarMenuId===K.SCMTitle?I.titleMenu.menu:I.repositoryMenu;e.elementDisposables.add(H(y,(m,p)=>{S=m,c=p,a()})),e.toolBar.context=r.provider}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}disposeElement(o,t,e){e.elementDisposables.clear()}disposeTemplate(o){o.elementDisposables.dispose(),o.templateDisposable.dispose()}};v=b([s(2,x),s(3,F),s(4,w),s(5,U),s(6,N),s(7,z),s(8,A),s(9,$)],v);export{Ae as RepositoryActionRunner,v as RepositoryRenderer};
