import{svgElem as A}from"../../../../base/browser/dom.js";import{rot as L}from"../../../../base/common/numbers.js";import{deepClone as w}from"../../../../base/common/objects.js";import{ThemeIcon as F}from"../../../../base/common/themables.js";import{localize as h}from"../../../../nls.js";import{buttonForeground as E,foreground as x}from"../../../../platform/theme/common/colorRegistry.js";import{chartsBlue as D,chartsGreen as V,chartsOrange as R,chartsPurple as N,chartsRed as P,chartsYellow as B}from"../../../../platform/theme/common/colors/chartsColors.js";import{asCssVariable as v,registerColor as g,transparent as k}from"../../../../platform/theme/common/colorUtils.js";import"../common/history.js";const d=22,s=11,y=4,f=5,T=g("scmGraph.historyItemGroupLocal",D,h("scmGraphHistoryItemGroupLocal","Local history item group color.")),te=g("scmGraph.historyItemGroupRemote",N,h("scmGraphHistoryItemGroupRemote","Remote history item group color.")),oe=g("scmGraph.historyItemGroupBase",R,h("scmGraphHistoryItemGroupBase","Base history item group color.")),re=g("scmGraph.historyItemHoverDefaultLabelForeground",x,h("scmGraphHistoryItemHoverDefaultLabelForeground","History item hover default label foreground color.")),ne=g("scmGraph.historyItemHoverDefaultLabelBackground",k(x,.2),h("scmGraphHistoryItemHoverDefaultLabelBackground","History item hover default label background color.")),se=g("scmGraph.historyItemHoverLabelForeground",E,h("scmGraphHistoryItemHoverLabelForeground","History item hover label foreground color.")),ie=g("scmGraph.historyItemHoverAdditionsForeground","gitDecoration.addedResourceForeground",h("scmGraph.HistoryItemHoverAdditionsForeground","History item hover additions foreground color.")),ce=g("scmGraph.historyItemHoverDeletionsForeground","gitDecoration.deletedResourceForeground",h("scmGraph.HistoryItemHoverDeletionsForeground","History item hover deletions foreground color.")),C=[g("scmGraph.foreground1",V,h("scmGraphForeground1","Source control graph foreground color (1).")),g("scmGraph.foreground2",P,h("scmGraphForeground2","Source control graph foreground color (2).")),g("scmGraph.foreground3",B,h("scmGraphForeground3","Source control graph foreground color (3)."))];function b(i,e){for(const r of i.labels??[]){const n=e.get(r.title);if(n!==void 0)return n}}function H(i){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","none"),e.setAttribute("stroke-width","1px"),e.setAttribute("stroke-linecap","round"),e.style.stroke=v(i),e}function G(i,e,r){const n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("cx",`${s*(i+1)}`),n.setAttribute("cy",`${s}`),n.setAttribute("r",`${e}`),n.style.fill=v(r),n}function S(i,e,r,n){const a=H(n);return a.setAttribute("d",`M ${i} ${e} V ${r}`),a}function _(i,e){for(let r=i.length-1;r>=0;r--)if(i[r].id===e)return r;return-1}function le(i){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("graph");const r=i.historyItem,n=i.inputSwimlanes,a=i.outputSwimlanes,l=n.findIndex(o=>o.id===r.id),p=l!==-1?l:n.length,I=p<a.length?a[p].color:p<n.length?n[p].color:T;let m=0;for(let o=0;o<n.length;o++){const c=n[o].color;if(n[o].id===r.id)if(o!==p){const t=[],u=H(c);t.push(`M ${s*(o+1)} 0`),t.push(`A ${s} ${s} 0 0 1 ${s*o} ${s}`),t.push(`H ${s*(p+1)}`),u.setAttribute("d",t.join(" ")),e.append(u)}else m++;else if(m<a.length&&n[o].id===a[m].id){if(o===m){const t=S(s*(o+1),0,d,c);e.append(t)}else{const t=[],u=H(c);t.push(`M ${s*(o+1)} 0`),t.push("V 6"),t.push(`A ${f} ${f} 0 0 1 ${s*(o+1)-f} ${d/2}`),t.push(`H ${s*(m+1)+f}`),t.push(`A ${f} ${f} 0 0 0 ${s*(m+1)} ${d/2+f}`),t.push(`V ${d}`),u.setAttribute("d",t.join(" ")),e.append(u)}m++}}for(let o=1;o<r.parentIds.length;o++){const c=_(a,r.parentIds[o]);if(c===-1)continue;const t=[],u=H(a[c].color);t.push(`M ${s*c} ${d/2}`),t.push(`A ${s} ${s} 0 0 1 ${s*(c+1)} ${d}`),t.push(`M ${s*c} ${d/2}`),t.push(`H ${s*(p+1)} `),u.setAttribute("d",t.join(" ")),e.append(u)}if(l!==-1){const o=S(s*(p+1),0,d/2,n[l].color);e.append(o)}if(r.parentIds.length>0){const o=S(s*(p+1),d/2,d,I);e.append(o)}if(r.parentIds.length>1){const o=G(p,y+1,I);e.append(o);const c=G(p,y-1,I);e.append(c)}else{if(r.labels?.some(c=>F.isThemeIcon(c.icon)&&c.icon.id==="target")){const c=G(p,y+2,I);e.append(c)}const o=G(p,y,I);e.append(o)}return e.style.height=`${d}px`,e.style.width=`${s*(Math.max(n.length,a.length,1)+1)}px`,e}function ae(i){const e=A("svg",{style:{height:`${d}px`,width:`${s*(i.length+1)}px`}});for(let r=0;r<i.length;r++){const n=S(s*(r+1),0,d,i[r].color);e.root.append(n)}return e.root}function pe(i,e=new Map){let r=-1;const n=[];for(let a=0;a<i.length;a++){const l=i[a],I=(n.at(-1)?.outputSwimlanes??[]).map(t=>w(t)),m=[];let o=!1;if(l.parentIds.length>0)for(const t of I){if(t.id===l.id){o||(m.push({id:l.parentIds[0],color:b(l,e)??t.color}),o=!0);continue}m.push(w(t))}for(let t=o?1:0;t<l.parentIds.length;t++){let u;if(!o)u=b(l,e);else{const $=i.find(M=>M.id===l.parentIds[t]);u=$?b($,e):void 0}u||(r=L(r+1,C.length),u=C[r]),m.push({id:l.parentIds[t],color:u})}const c=(l.labels??[]).map(t=>({...t,color:e.get(t.title)}));n.push({historyItem:{...l,labels:c},inputSwimlanes:I,outputSwimlanes:m})}return n}export{d as SWIMLANE_HEIGHT,s as SWIMLANE_WIDTH,C as colorRegistry,oe as historyItemGroupBase,T as historyItemGroupLocal,te as historyItemGroupRemote,ie as historyItemHoverAdditionsForeground,ne as historyItemHoverDefaultLabelBackground,re as historyItemHoverDefaultLabelForeground,ce as historyItemHoverDeletionsForeground,se as historyItemHoverLabelForeground,ae as renderSCMHistoryGraphPlaceholder,le as renderSCMHistoryItemGraph,pe as toISCMHistoryItemViewModelArray};
