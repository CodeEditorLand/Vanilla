import{localize as p}from"../../../../nls.js";import{deepClone as F}from"../../../../base/common/objects.js";import{buttonForeground as D,chartsBlue as V,chartsPurple as B,foreground as M}from"../../../../platform/theme/common/colorRegistry.js";import{asCssVariable as A,registerColor as a,transparent as N}from"../../../../platform/theme/common/colorUtils.js";import"../common/history.js";import{rot as P}from"../../../../base/common/numbers.js";import{svgElem as k}from"../../../../base/browser/dom.js";const m=22,i=11,H=5,G=4,$=2,R=a("scmGraph.historyItemRefColor",V,p("scmGraphHistoryItemRefColor","History item reference color.")),Z=a("scmGraph.historyItemRemoteRefColor",B,p("scmGraphHistoryItemRemoteRefColor","History item remote reference color.")),ee=a("scmGraph.historyItemBaseRefColor","#EA5C00",p("scmGraphHistoryItemBaseRefColor","History item base reference color.")),te=a("scmGraph.historyItemHoverDefaultLabelForeground",M,p("scmGraphHistoryItemHoverDefaultLabelForeground","History item hover default label foreground color.")),re=a("scmGraph.historyItemHoverDefaultLabelBackground",N(M,.2),p("scmGraphHistoryItemHoverDefaultLabelBackground","History item hover default label background color.")),oe=a("scmGraph.historyItemHoverLabelForeground",D,p("scmGraphHistoryItemHoverLabelForeground","History item hover label foreground color.")),ne=a("scmGraph.historyItemHoverAdditionsForeground","gitDecoration.addedResourceForeground",p("scmGraph.HistoryItemHoverAdditionsForeground","History item hover additions foreground color.")),se=a("scmGraph.historyItemHoverDeletionsForeground","gitDecoration.deletedResourceForeground",p("scmGraph.HistoryItemHoverDeletionsForeground","History item hover deletions foreground color.")),L=[a("scmGraph.foreground1","#FFB000",p("scmGraphForeground1","Source control graph foreground color (1).")),a("scmGraph.foreground2","#DC267F",p("scmGraphForeground2","Source control graph foreground color (2).")),a("scmGraph.foreground3","#994F00",p("scmGraphForeground3","Source control graph foreground color (3).")),a("scmGraph.foreground4","#40B0A6",p("scmGraphForeground4","Source control graph foreground color (4).")),a("scmGraph.foreground5","#B66DFF",p("scmGraphForeground5","Source control graph foreground color (5)."))];function w(c,e){for(const n of c.references??[]){const s=e.get(n.id);if(s!==void 0)return s}}function b(c){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","none"),e.setAttribute("stroke-width","1px"),e.setAttribute("stroke-linecap","round"),e.style.stroke=A(c),e}function x(c,e,n,s){const l=document.createElementNS("http://www.w3.org/2000/svg","circle");return l.setAttribute("cx",`${i*(c+1)}`),l.setAttribute("cy",`${i}`),l.setAttribute("r",`${e}`),l.style.strokeWidth=`${n}px`,s&&(l.style.fill=A(s)),l}function v(c,e,n,s){const l=b(s);return l.setAttribute("d",`M ${c} ${e} V ${n}`),l}function _(c,e){for(let n=c.length-1;n>=0;n--)if(c[n].id===e)return n;return-1}function ie(c){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("graph");const n=c.historyItem,s=c.inputSwimlanes,l=c.outputSwimlanes,g=s.findIndex(t=>t.id===n.id),r=g!==-1?g:s.length,y=r<l.length?l[r].color:r<s.length?s[r].color:R;let I=0;for(let t=0;t<s.length;t++){const d=s[t].color;if(s[t].id===n.id)if(t!==r){const o=[],h=b(d);o.push(`M ${i*(t+1)} 0`),o.push(`A ${i} ${i} 0 0 1 ${i*t} ${i}`),o.push(`H ${i*(r+1)}`),h.setAttribute("d",o.join(" ")),e.append(h)}else I++;else if(I<l.length&&s[t].id===l[I].id){if(t===I){const o=v(i*(t+1),0,m,d);e.append(o)}else{const o=[],h=b(d);o.push(`M ${i*(t+1)} 0`),o.push("V 6"),o.push(`A ${H} ${H} 0 0 1 ${i*(t+1)-H} ${m/2}`),o.push(`H ${i*(I+1)+H}`),o.push(`A ${H} ${H} 0 0 0 ${i*(I+1)} ${m/2+H}`),o.push(`V ${m}`),h.setAttribute("d",o.join(" ")),e.append(h)}I++}}for(let t=1;t<n.parentIds.length;t++){const d=_(l,n.parentIds[t]);if(d===-1)continue;const o=[],h=b(l[d].color);o.push(`M ${i*d} ${m/2}`),o.push(`A ${i} ${i} 0 0 1 ${i*(d+1)} ${m}`),o.push(`M ${i*d} ${m/2}`),o.push(`H ${i*(r+1)} `),h.setAttribute("d",o.join(" ")),e.append(h)}if(g!==-1){const t=v(i*(r+1),0,m/2,s[g].color);e.append(t)}if(n.parentIds.length>0){const t=v(i*(r+1),m/2,m,y);e.append(t)}if(c.isCurrent){const t=x(r,G+3,$,y);e.append(t);const d=x(r,$,G);e.append(d)}else if(n.parentIds.length>1){const t=x(r,G+2,$,y);e.append(t);const d=x(r,G-1,$,y);e.append(d)}else{const t=x(r,G+1,$,y);e.append(t)}return e.style.height=`${m}px`,e.style.width=`${i*(Math.max(s.length,l.length,1)+1)}px`,e}function ce(c){const e=k("svg",{style:{height:`${m}px`,width:`${i*(c.length+1)}px`}});for(let n=0;n<c.length;n++){const s=v(i*(n+1),0,m,c[n].color);e.root.append(s)}return e.root}function le(c,e=new Map,n){let s=-1;const l=[];for(let g=0;g<c.length;g++){const r=c[g],y=r.id===n?.revision,t=(l.at(-1)?.outputSwimlanes??[]).map(u=>F(u)),d=[];let o=!1;if(r.parentIds.length>0)for(const u of t){if(u.id===r.id){o||(d.push({id:r.parentIds[0],color:w(r,e)??u.color}),o=!0);continue}d.push(F(u))}for(let u=o?1:0;u<r.parentIds.length;u++){let f;if(!o)f=w(r,e);else{const S=c.find(C=>C.id===r.parentIds[u]);f=S?w(S,e):void 0}f||(s=P(s+1,L.length),f=L[s]),d.push({id:r.parentIds[u],color:f})}const h=(r.references??[]).map(u=>{let f=e.get(u.id);if(e.has(u.id)&&f===void 0){const S=t.findIndex(E=>E.id===r.id),C=S!==-1?S:t.length;f=C<d.length?d[C].color:C<t.length?t[C].color:R}return{...u,color:f}});l.push({historyItem:{...r,references:h},isCurrent:y,inputSwimlanes:t,outputSwimlanes:d})}return l}export{m as SWIMLANE_HEIGHT,i as SWIMLANE_WIDTH,L as colorRegistry,ee as historyItemBaseRefColor,ne as historyItemHoverAdditionsForeground,re as historyItemHoverDefaultLabelBackground,te as historyItemHoverDefaultLabelForeground,se as historyItemHoverDeletionsForeground,oe as historyItemHoverLabelForeground,R as historyItemRefColor,Z as historyItemRemoteRefColor,ce as renderSCMHistoryGraphPlaceholder,ie as renderSCMHistoryItemGraph,le as toISCMHistoryItemViewModelArray};
