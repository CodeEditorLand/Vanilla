import{localize as g}from"../../../../nls.js";import{deepClone as w}from"../../../../base/common/objects.js";import{ThemeIcon as F}from"../../../../base/common/themables.js";import{buttonForeground as E,foreground as v}from"../../../../platform/theme/common/colorRegistry.js";import{chartsBlue as D,chartsGreen as V,chartsOrange as R,chartsPurple as N,chartsRed as P,chartsYellow as B}from"../../../../platform/theme/common/colors/chartsColors.js";import{asCssVariable as C,registerColor as I,transparent as k}from"../../../../platform/theme/common/colorUtils.js";import"../common/history.js";import{rot as T}from"../../../../base/common/numbers.js";import{svgElem as _}from"../../../../base/browser/dom.js";const h=22,s=11,G=4,f=5,M=I("scmGraph.historyItemGroupLocal",D,g("scmGraphHistoryItemGroupLocal","Local history item group color.")),oe=I("scmGraph.historyItemGroupRemote",N,g("scmGraphHistoryItemGroupRemote","Remote history item group color.")),re=I("scmGraph.historyItemGroupBase",R,g("scmGraphHistoryItemGroupBase","Base history item group color.")),ne=I("scmGraph.historyItemHoverDefaultLabelForeground",v,g("scmGraphHistoryItemHoverDefaultLabelForeground","History item hover default label foreground color.")),se=I("scmGraph.historyItemHoverDefaultLabelBackground",k(v,.2),g("scmGraphHistoryItemHoverDefaultLabelBackground","History item hover default label background color.")),ie=I("scmGraph.historyItemHoverLabelForeground",E,g("scmGraphHistoryItemHoverLabelForeground","History item hover label foreground color.")),le=I("scmGraph.historyItemHoverAdditionsForeground","gitDecoration.addedResourceForeground",g("scmGraph.HistoryItemHoverAdditionsForeground","History item hover additions foreground color.")),ce=I("scmGraph.historyItemHoverDeletionsForeground","gitDecoration.deletedResourceForeground",g("scmGraph.HistoryItemHoverDeletionsForeground","History item hover deletions foreground color.")),A=[I("scmGraph.foreground1",V,g("scmGraphForeground1","Source control graph foreground color (1).")),I("scmGraph.foreground2",P,g("scmGraphForeground2","Source control graph foreground color (2).")),I("scmGraph.foreground3",B,g("scmGraphForeground3","Source control graph foreground color (3)."))];function x(i,e){for(const r of i.labels??[]){const n=e.get(r.title);if(n!==void 0)return n}}function S(i){const e=document.createElementNS("http://www.w3.org/2000/svg","path");return e.setAttribute("fill","none"),e.setAttribute("stroke-width","1px"),e.setAttribute("stroke-linecap","round"),e.style.stroke=C(i),e}function b(i,e,r){const n=document.createElementNS("http://www.w3.org/2000/svg","circle");return n.setAttribute("cx",`${s*(i+1)}`),n.setAttribute("cy",`${s}`),n.setAttribute("r",`${e}`),n.style.fill=C(r),n}function $(i,e,r,n){const a=S(n);return a.setAttribute("d",`M ${i} ${e} V ${r}`),a}function W(i,e){for(let r=i.length-1;r>=0;r--)if(i[r].id===e)return r;return-1}function de(i){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("graph");const r=i.historyItem,n=i.inputSwimlanes,a=i.outputSwimlanes,d=n.findIndex(o=>o.id===r.id),p=d!==-1?d:n.length,m=p<a.length?a[p].color:p<n.length?n[p].color:M;let u=0;for(let o=0;o<n.length;o++){const l=n[o].color;if(n[o].id===r.id)if(o!==p){const t=[],c=S(l);t.push(`M ${s*(o+1)} 0`),t.push(`A ${s} ${s} 0 0 1 ${s*o} ${s}`),t.push(`H ${s*(p+1)}`),c.setAttribute("d",t.join(" ")),e.append(c)}else u++;else if(u<a.length&&n[o].id===a[u].id){if(o===u){const t=$(s*(o+1),0,h,l);e.append(t)}else{const t=[],c=S(l);t.push(`M ${s*(o+1)} 0`),t.push("V 6"),t.push(`A ${f} ${f} 0 0 1 ${s*(o+1)-f} ${h/2}`),t.push(`H ${s*(u+1)+f}`),t.push(`A ${f} ${f} 0 0 0 ${s*(u+1)} ${h/2+f}`),t.push(`V ${h}`),c.setAttribute("d",t.join(" ")),e.append(c)}u++}}for(let o=1;o<r.parentIds.length;o++){const l=W(a,r.parentIds[o]);if(l===-1)continue;const t=[],c=S(a[l].color);t.push(`M ${s*l} ${h/2}`),t.push(`A ${s} ${s} 0 0 1 ${s*(l+1)} ${h}`),t.push(`M ${s*l} ${h/2}`),t.push(`H ${s*(p+1)} `),c.setAttribute("d",t.join(" ")),e.append(c)}if(d!==-1){const o=$(s*(p+1),0,h/2,n[d].color);e.append(o)}if(r.parentIds.length>0){const o=$(s*(p+1),h/2,h,m);e.append(o)}if(r.parentIds.length>1){const o=b(p,G+1,m);e.append(o);const l=b(p,G-1,m);e.append(l)}else{if(r.labels?.some(l=>F.isThemeIcon(l.icon)&&l.icon.id==="target")){const l=b(p,G+2,m);e.append(l)}const o=b(p,G,m);e.append(o)}return e.style.height=`${h}px`,e.style.width=`${s*(Math.max(n.length,a.length,1)+1)}px`,e}function ae(i){const e=_("svg",{style:{height:`${h}px`,width:`${s*(i.length+1)}px`}});for(let r=0;r<i.length;r++){const n=$(s*(r+1),0,h,i[r].color);e.root.append(n)}return e.root}function pe(i,e=new Map){let r=-1;const n=[];for(let a=0;a<i.length;a++){const d=i[a],m=(n.at(-1)?.outputSwimlanes??[]).map(t=>w(t)),u=[];let o=!1;if(d.parentIds.length>0)for(const t of m){if(t.id===d.id){o||(u.push({id:d.parentIds[0],color:x(d,e)??t.color}),o=!0);continue}u.push(w(t))}for(let t=o?1:0;t<d.parentIds.length;t++){let c;if(!o)c=x(d,e);else{const H=i.find(y=>y.id===d.parentIds[t]);c=H?x(H,e):void 0}c||(r=T(r+1,A.length),c=A[r]),u.push({id:d.parentIds[t],color:c})}const l=(d.labels??[]).map(t=>{let c=e.get(t.title);if(!c&&e.has("*")){const H=m.findIndex(L=>L.id===d.id),y=H!==-1?H:m.length;c=y<u.length?u[y].color:y<m.length?m[y].color:M}return{...t,color:c}});n.push({historyItem:{...d,labels:l},inputSwimlanes:m,outputSwimlanes:u})}return n}export{h as SWIMLANE_HEIGHT,s as SWIMLANE_WIDTH,A as colorRegistry,re as historyItemGroupBase,M as historyItemGroupLocal,oe as historyItemGroupRemote,le as historyItemHoverAdditionsForeground,se as historyItemHoverDefaultLabelBackground,ne as historyItemHoverDefaultLabelForeground,ce as historyItemHoverDeletionsForeground,ie as historyItemHoverLabelForeground,ae as renderSCMHistoryGraphPlaceholder,de as renderSCMHistoryItemGraph,pe as toISCMHistoryItemViewModelArray};
