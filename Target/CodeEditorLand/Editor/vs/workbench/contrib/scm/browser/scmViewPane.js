var nt=Object.defineProperty;var at=Object.getOwnPropertyDescriptor;var M=(c,t,e,i)=>{for(var o=i>1?void 0:i?at(t,e):t,s=c.length-1,a;s>=0;s--)(a=c[s])&&(o=(i?a(t,e,o):a(o))||o);return i&&o&&nt(t,e,o),o},d=(c,t)=>(e,i)=>t(e,i,c);import"./media/scm.css";import{Event as E,Emitter as Q}from"../../../../base/common/event.js";import{basename as N,dirname as ct}from"../../../../base/common/resources.js";import{Disposable as he,DisposableStore as S,combinedDisposable as Pe,dispose as dt,toDisposable as Be,MutableDisposable as me,DisposableMap as _e}from"../../../../base/common/lifecycle.js";import{ViewPane as lt,ViewAction as J}from"../../../browser/parts/views/viewPane.js";import{append as m,$ as v,Dimension as ut,asCSSUrl as pt,trackFocus as ht,clearNode as mt,isPointerEvent as vt,isActiveElement as gt}from"../../../../base/browser/dom.js";import"../../../../base/browser/ui/list/list.js";import{InputValidationType as H,ISCMViewService as U,ISCMService as Ne,SCMInputChangeReason as St,VIEW_PANE_ID as A,ISCMRepositorySortKey as ve}from"../common/scm.js";import{ResourceLabels as ft}from"../../../browser/labels.js";import{CountBadge as yt}from"../../../../base/browser/ui/countBadge/countBadge.js";import{IEditorService as Ct}from"../../../services/editor/common/editorService.js";import{IInstantiationService as ge}from"../../../../platform/instantiation/common/instantiation.js";import{IContextViewService as It,IContextMenuService as Se}from"../../../../platform/contextview/browser/contextView.js";import{IContextKeyService as X,ContextKeyExpr as D,RawContextKey as x}from"../../../../platform/contextkey/common/contextkey.js";import{ICommandService as fe}from"../../../../platform/commands/common/commands.js";import{IKeybindingService as ye}from"../../../../platform/keybinding/common/keybinding.js";import{MenuItemAction as Ce,IMenuService as He,registerAction2 as R,MenuId as T,MenuRegistry as We,Action2 as wt}from"../../../../platform/actions/common/actions.js";import{ActionRunner as ze,Action as Ie,Separator as bt}from"../../../../base/common/actions.js";import{ActionBar as we}from"../../../../base/browser/ui/actionbar/actionbar.js";import{IThemeService as Oe}from"../../../../platform/theme/common/themeService.js";import{isSCMResource as L,isSCMResourceGroup as C,connectPrimaryMenuToInlineActionBar as Ue,isSCMRepository as I,isSCMInput as K,collectContextMenuActions as Z,getActionViewItemProvider as be,isSCMActionButton as B,isSCMViewService as Me,isSCMResourceNode as q}from"./util.js";import{WorkbenchCompressibleAsyncDataTree as Mt}from"../../../../platform/list/browser/listService.js";import{IConfigurationService as Re,ConfigurationTarget as Rt}from"../../../../platform/configuration/common/configuration.js";import{disposableTimeout as Tt,Sequencer as Vt,ThrottledDelayer as Dt,Throttler as ke}from"../../../../base/common/async.js";import"../../../../base/browser/ui/tree/tree.js";import{ResourceTree as w}from"../../../../base/common/resourceTree.js";import"../../../../base/browser/ui/tree/objectTree.js";import{Iterable as $}from"../../../../base/common/iterator.js";import"../../../../base/browser/ui/tree/compressedObjectTreeModel.js";import"../../../../base/common/uri.js";import{FileKind as Te}from"../../../../platform/files/common/files.js";import{compareFileNames as Ge,comparePaths as Et}from"../../../../base/common/comparers.js";import{createMatches as de}from"../../../../base/common/filters.js";import{IViewDescriptorService as At}from"../../../common/views.js";import{localize as f}from"../../../../nls.js";import{IStorageService as Ve,StorageScope as _,StorageTarget as le}from"../../../../platform/storage/common/storage.js";import{EditorResourceAccessor as xt,SideBySideEditor as Lt}from"../../../common/editor.js";import{CodeEditorWidget as Kt}from"../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import"../../../../editor/browser/config/editorConfiguration.js";import{getSimpleEditorOptions as Ft,setupSimpleEditorSelectionStyling as Pt}from"../../codeEditor/browser/simpleEditorOptions.js";import{IModelService as Bt}from"../../../../editor/common/services/model.js";import{EditorExtensionsRegistry as _t}from"../../../../editor/browser/editorExtensions.js";import{MenuPreventer as Nt}from"../../codeEditor/browser/menuPreventer.js";import{SelectionClipboardContributionID as Ht}from"../../codeEditor/browser/selectionClipboard.js";import{EditorDictation as Wt}from"../../codeEditor/browser/dictation/editorDictation.js";import{ContextMenuController as zt}from"../../../../editor/contrib/contextmenu/browser/contextmenu.js";import*as Ot from"../../../../base/common/platform.js";import{compare as Ut,format as kt}from"../../../../base/common/strings.js";import{SuggestController as Gt}from"../../../../editor/contrib/suggest/browser/suggestController.js";import{SnippetController2 as qt}from"../../../../editor/contrib/snippet/browser/snippetController2.js";import{ServiceCollection as $t}from"../../../../platform/instantiation/common/serviceCollection.js";import{ColorDetector as jt}from"../../../../editor/contrib/colorPicker/browser/colorDetector.js";import{LinkDetector as Jt}from"../../../../editor/contrib/links/browser/links.js";import{IOpenerService as qe}from"../../../../platform/opener/common/opener.js";import{ITelemetryService as $e}from"../../../../platform/telemetry/common/telemetry.js";import"../../../../base/browser/ui/list/listWidget.js";import{ILabelService as De}from"../../../../platform/label/common/label.js";import{KeyCode as Yt}from"../../../../base/common/keyCodes.js";import{DEFAULT_FONT_FAMILY as Qt}from"../../../../base/browser/fonts.js";import{Codicon as Y}from"../../../../base/common/codicons.js";import{ThemeIcon as Ee}from"../../../../base/common/themables.js";import{AnchorAlignment as Xt}from"../../../../base/browser/ui/contextview/contextview.js";import{RepositoryActionRunner as Zt,RepositoryRenderer as je}from"./scmRepositoryRenderer.js";import{ColorScheme as ei}from"../../../../platform/theme/common/theme.js";import"../../../../base/browser/ui/tree/abstractTree.js";import"../../../../editor/common/core/selection.js";import{API_OPEN_DIFF_EDITOR_COMMAND_ID as ti,API_OPEN_EDITOR_COMMAND_ID as ii}from"../../../browser/parts/editor/editorCommands.js";import{createActionViewItem as oi,createAndFillInActionBarActions as si,createAndFillInContextMenuActions as ri}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{MarkdownRenderer as ni,openLinkFromMarkdown as ai}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{Button as Je,ButtonWithDropdown as ci}from"../../../../base/browser/ui/button/button.js";import{INotificationService as di}from"../../../../platform/notification/common/notification.js";import{RepositoryContextKeys as li}from"./scmViewService.js";import{DragAndDropController as ui}from"../../../../editor/contrib/dnd/browser/dnd.js";import{CopyPasteController as Ye}from"../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js";import{DropIntoEditorController as Qe}from"../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js";import{MessageController as pi}from"../../../../editor/contrib/message/browser/messageController.js";import{defaultButtonStyles as Xe,defaultCountBadgeStyles as hi}from"../../../../platform/theme/browser/defaultStyles.js";import{InlineCompletionsController as mi}from"../../../../editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js";import{CodeActionController as vi}from"../../../../editor/contrib/codeAction/browser/codeActionController.js";import{Schemas as gi}from"../../../../base/common/network.js";import"../../../../base/browser/dnd.js";import{fillEditorsDragData as Si}from"../../../browser/dnd.js";import"../../../../base/browser/ui/list/listView.js";import{CodeDataTransfers as fi}from"../../../../platform/dnd/browser/dnd.js";import{FormatOnType as yi}from"../../../../editor/contrib/format/browser/formatActions.js";import{EditorOption as Ze,EditorOptions as et}from"../../../../editor/common/config/editorOptions.js";import"../../../../base/browser/ui/tree/asyncDataTree.js";import{IUriIdentityService as Ci}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{EditOperation as Ii}from"../../../../editor/common/core/editOperation.js";import{WorkbenchToolBar as wi}from"../../../../platform/actions/browser/toolbar.js";import{CancellationTokenSource as bi}from"../../../../base/common/cancellation.js";import{DropdownWithPrimaryActionViewItem as Mi}from"../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js";import{clamp as Ae,rot as xe}from"../../../../base/common/numbers.js";import{IHoverService as Ri}from"../../../../platform/hover/browser/hover.js";import{OpenScmGroupAction as Ti}from"../../multiDiffEditor/browser/scmMultiDiffSourceResolver.js";import{ContentHoverController as Vi}from"../../../../editor/contrib/hover/browser/contentHoverController.js";import{GlyphHoverController as Di}from"../../../../editor/contrib/hover/browser/glyphHoverController.js";import"../../../../editor/common/model.js";import{autorun as tt}from"../../../../base/common/observable.js";import{PlaceholderTextContribution as Ei}from"../../../../editor/contrib/placeholderText/browser/placeholderTextContribution.js";import{observableConfigValue as Ai}from"../../../../platform/observable/common/platformObservableUtils.js";function xi(c,t){if(!t)return[void 0,void 0];if(!t.label)return[de(t),void 0];const e=N(c),i=t.label,o=i.length-e.length,s=de(t.score);if(i===e)return[s,void 0];const a=[],r=[];for(const n of s)n.start>o?a.push({start:n.start-o,end:n.end-o}):n.end<o?r.push(n):(a.push({start:0,end:n.end-o}),r.push({start:n.start,end:o}));return[a,r]}let z=class{constructor(t,e,i){this.commandService=t;this.contextMenuService=e;this.notificationService=i}static DEFAULT_HEIGHT=30;static TEMPLATE_ID="actionButton";get templateId(){return z.TEMPLATE_ID}actionButtons=new Map;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("cursor-default","force-no-hover");const e=m(t,v(".button-container")),i=new Zi(e,this.contextMenuService,this.commandService,this.notificationService);return{actionButton:i,disposable:he.None,templateDisposable:i}}renderElement(t,e,i,o){i.disposable.dispose();const s=new S,a=t.element;i.actionButton.setButton(t.element.button),this.actionButtons.set(a,i.actionButton),s.add({dispose:()=>this.actionButtons.delete(a)}),i.disposable=s}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}focusActionButton(t){this.actionButtons.get(t)?.focus()}disposeElement(t,e,i){i.disposable.dispose()}disposeTemplate(t){t.disposable.dispose(),t.templateDisposable.dispose()}};z=M([d(0,fe),d(1,Se),d(2,di)],z);class Fe{constructor(t){this.instantiationService=t}getDragURI(t){return L(t)?t.sourceUri.toString():null}onDragStart(t,e){const i=Fe.getResourcesFromDragAndDropData(t);if(e.dataTransfer&&i?.length){this.instantiationService.invokeFunction(s=>Si(s,i,e));const o=i.filter(s=>s.scheme===gi.file).map(s=>s.fsPath);o.length&&e.dataTransfer.setData(fi.FILES,JSON.stringify(o))}}getDragLabel(t,e){if(t.length===1){const i=t[0];if(L(i))return N(i.sourceUri)}return String(t.length)}onDragOver(t,e,i,o,s){return!0}drop(t,e,i,o,s){}static getResourcesFromDragAndDropData(t){const e=[];for(const i of[...t.context??[],...t.elements])L(i)&&e.push(i.sourceUri);return e}dispose(){}}let F=class{constructor(t,e,i,o){this.outerLayout=t;this.overflowWidgetsDomNode=e;this.updateHeight=i;this.instantiationService=o}static DEFAULT_HEIGHT=26;static TEMPLATE_ID="input";get templateId(){return F.TEMPLATE_ID}inputWidgets=new Map;contentHeights=new WeakMap;editorSelections=new WeakMap;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("force-no-hover");const e=new S,i=m(t,v(".scm-input")),o=this.instantiationService.createInstance(j,i,this.overflowWidgetsDomNode);return e.add(o),{inputWidget:o,inputWidgetHeight:F.DEFAULT_HEIGHT,elementDisposables:new S,templateDisposable:e}}renderElement(t,e,i){const o=t.element;i.inputWidget.input=o,this.inputWidgets.set(o,i.inputWidget),i.elementDisposables.add({dispose:()=>this.inputWidgets.delete(o)});const s=this.editorSelections.get(o);s&&(i.inputWidget.selections=s),i.elementDisposables.add(Be(()=>{const l=i.inputWidget.selections;l&&this.editorSelections.set(o,l)})),i.inputWidgetHeight=F.DEFAULT_HEIGHT;const a=()=>{const l=i.inputWidget.getContentHeight();this.contentHeights.set(o,l),i.inputWidgetHeight!==l&&(this.updateHeight(o,l+10),i.inputWidgetHeight=l,i.inputWidget.layout())};Tt(()=>{i.elementDisposables.add(i.inputWidget.onDidChangeContentHeight(a)),a()},0,i.elementDisposables);const n=()=>i.inputWidget.layout();i.elementDisposables.add(this.outerLayout.onDidChange(n)),n()}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.templateDisposable.dispose()}getHeight(t){return(this.contentHeights.get(t)??F.DEFAULT_HEIGHT)+10}getRenderedInputWidget(t){return this.inputWidgets.get(t)}getFocusedInput(){for(const[t,e]of this.inputWidgets)if(e.hasFocus())return t}clearValidation(){for(const[,t]of this.inputWidgets)t.clearValidation()}};F=M([d(3,ge)],F);let k=class{constructor(t,e){this.actionViewItemProvider=t;this.scmViewService=e}static TEMPLATE_ID="resource group";get templateId(){return k.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const e=m(t,v(".resource-group")),i=m(e,v(".name")),o=m(e,v(".actions")),s=new we(o,{actionViewItemProvider:this.actionViewItemProvider}),a=m(e,v(".count")),r=new yt(a,{},hi),n=Pe(s);return{name:i,count:r,actionBar:s,elementDisposables:new S,disposables:n}}renderElement(t,e,i){const o=t.element;i.name.textContent=o.label,i.actionBar.clear(),i.actionBar.context=o,i.count.setCount(o.resources.length);const s=this.scmViewService.menus.getRepositoryMenus(o.provider);i.elementDisposables.add(Ue(s.getResourceGroupMenu(o),i.actionBar))}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}};k=M([d(1,U)],k);class it extends ze{constructor(e){super();this.getSelectedResources=e}async runAction(e,i){if(!(e instanceof Ce))return super.runAction(e,i);const o=this.getSelectedResources(),r=(o.some(n=>n===i)?o:[i]).map(n=>w.isResourceNode(n)?w.collect(n):[n]).flat();await e.run(...r)}}let G=class{constructor(t,e,i,o,s,a,r){this.viewMode=t;this.labels=e;this.actionViewItemProvider=i;this.actionRunner=o;this.labelService=s;this.scmViewService=a;this.themeService=r;r.onDidColorThemeChange(this.onDidColorThemeChange,this,this.disposables)}static TEMPLATE_ID="resource";get templateId(){return G.TEMPLATE_ID}disposables=new S;renderedResources=new Map;renderTemplate(t){const e=m(t,v(".resource")),i=m(e,v(".name")),o=this.labels.create(i,{supportDescriptionHighlights:!0,supportHighlights:!0}),s=m(o.element,v(".actions")),a=new we(s,{actionViewItemProvider:this.actionViewItemProvider,actionRunner:this.actionRunner}),r=m(e,v(".decoration-icon")),n=new me,l=Pe(a,o,n);return{element:e,name:i,fileLabel:o,decorationIcon:r,actionBar:a,actionBarMenu:void 0,actionBarMenuListener:n,elementDisposables:new S,disposables:l}}renderElement(t,e,i){const o=t.element,s=w.isResourceNode(o)?o.element:o,a=w.isResourceNode(o)?o.uri:o.sourceUri,r=w.isResourceNode(o)?Te.FOLDER:Te.FILE,n=!w.isResourceNode(o)&&o.decorations.tooltip||"",l=this.viewMode()==="tree";let h,u,g;if(w.isResourceNode(o))if(o.element){const V=this.scmViewService.menus.getRepositoryMenus(o.element.resourceGroup.provider);this._renderActionBar(i,o,V.getResourceMenu(o.element)),i.element.classList.toggle("faded",o.element.decorations.faded),g=o.element.decorations.strikeThrough}else{const V=this.scmViewService.menus.getRepositoryMenus(o.context.provider);this._renderActionBar(i,o,V.getResourceFolderMenu(o.context)),h=de(t.filterData),i.element.classList.remove("faded")}else{const V=this.scmViewService.menus.getRepositoryMenus(o.resourceGroup.provider);this._renderActionBar(i,o,V.getResourceMenu(o)),[h,u]=xi(a,t.filterData),i.element.classList.toggle("faded",o.decorations.faded),g=o.decorations.strikeThrough}const y={tooltip:n,uri:a,fileLabelOptions:{hidePath:l,fileKind:r,matches:h,descriptionMatches:u,strikethrough:g},iconResource:s};this.renderIcon(i,y),this.renderedResources.set(i,y),i.elementDisposables.add(Be(()=>this.renderedResources.delete(i))),i.element.setAttribute("data-tooltip",n)}disposeElement(t,e,i){i.elementDisposables.clear()}renderCompressedElements(t,e,i,o){const s=t.element,a=s.elements[s.elements.length-1],r=s.elements.map(u=>u.name),n=Te.FOLDER,l=de(t.filterData);i.fileLabel.setResource({resource:a.uri,name:r},{fileDecorations:{colors:!1,badges:!0},fileKind:n,matches:l,separator:this.labelService.getSeparator(a.uri.scheme)});const h=this.scmViewService.menus.getRepositoryMenus(a.context.provider);this._renderActionBar(i,a,h.getResourceFolderMenu(a.context)),i.name.classList.remove("strike-through"),i.element.classList.remove("faded"),i.decorationIcon.style.display="none",i.decorationIcon.style.backgroundImage="",i.element.setAttribute("data-tooltip","")}disposeCompressedElements(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}_renderActionBar(t,e,i){(!t.actionBarMenu||t.actionBarMenu!==i)&&(t.actionBar.clear(),t.actionBarMenu=i,t.actionBarMenuListener.value=Ue(i,t.actionBar)),t.actionBar.context=e}onDidColorThemeChange(){for(const[t,e]of this.renderedResources)this.renderIcon(t,e)}renderIcon(t,e){const i=this.themeService.getColorTheme(),o=i.type===ei.LIGHT?e.iconResource?.decorations.icon:e.iconResource?.decorations.iconDark;t.fileLabel.setFile(e.uri,{...e.fileLabelOptions,fileDecorations:{colors:!1,badges:!o}}),o?(Ee.isThemeIcon(o)?(t.decorationIcon.className=`decoration-icon ${Ee.asClassName(o)}`,o.color&&(t.decorationIcon.style.color=i.getColor(o.color.id)?.toString()??""),t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=""):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=pt(o)),t.decorationIcon.title=e.tooltip):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="none",t.decorationIcon.style.backgroundImage="",t.decorationIcon.title="")}dispose(){this.disposables.dispose()}};G=M([d(4,De),d(5,U),d(6,Oe)],G);class Li{constructor(t){this.inputRenderer=t}getHeight(t){return K(t)?this.inputRenderer.getHeight(t):B(t)?z.DEFAULT_HEIGHT+10:22}getTemplateId(t){if(I(t))return je.TEMPLATE_ID;if(K(t))return F.TEMPLATE_ID;if(B(t))return z.TEMPLATE_ID;if(C(t))return k.TEMPLATE_ID;if(L(t)||q(t))return G.TEMPLATE_ID;throw new Error("Unknown element")}}class Ki{isIncompressible(t){return w.isResourceNode(t)?t.childrenCount===0||!t.parent||!t.parent.parent:!0}}class Fi{filter(t){return C(t)?t.resources.length>0||!t.hideWhenEmpty:!0}}class Pi{constructor(t,e){this.viewMode=t;this.viewSortKey=e}compare(t,e){if(I(t)){if(!I(e))throw new Error("Invalid comparison");return 0}if(K(t))return-1;if(K(e))return 1;if(B(t))return-1;if(B(e))return 1;if(C(t))return C(e)?0:-1;if(this.viewMode()==="list"){if(this.viewSortKey()==="name"){const l=N(t.sourceUri),h=N(e.sourceUri);return Ge(l,h)}if(this.viewSortKey()==="status"){const l=t.decorations.tooltip??"",h=e.decorations.tooltip??"";if(l!==h)return Ut(l,h)}const r=t.sourceUri.fsPath,n=e.sourceUri.fsPath;return Et(r,n)}const i=w.isResourceNode(t),o=w.isResourceNode(e);if(i!==o)return i?-1:1;const s=w.isResourceNode(t)?t.name:N(t.sourceUri),a=w.isResourceNode(e)?e.name:N(e.sourceUri);return Ge(s,a)}}let ee=class{constructor(t,e){this.viewMode=t;this.labelService=e}getKeyboardNavigationLabel(t){if(w.isResourceNode(t))return t.name;if(I(t)||K(t)||B(t))return;if(C(t))return t.label;if(this.viewMode()==="list"){const e=N(t.sourceUri),i=this.labelService.getUriLabel(t.sourceUri,{relative:!0});return[e,i]}else return N(t.sourceUri)}getCompressedNodeKeyboardNavigationLabel(t){return t.map(i=>i.name).join("/")}};ee=M([d(1,De)],ee);function ot(c){if(I(c))return`repo:${c.provider.id}`;if(K(c))return`input:${c.repository.provider.id}`;if(B(c))return`actionButton:${c.repository.provider.id}`;if(C(c))return`resourceGroup:${c.provider.id}/${c.id}`;if(L(c)){const t=c.resourceGroup;return`resource:${t.provider.id}/${t.id}/${c.sourceUri.toString()}`}else if(q(c)){const t=c.context;return`folder:${t.provider.id}/${t.id}/$FOLDER/${c.uri.toString()}`}else throw new Error("Invalid tree element")}class Bi{getId(t){return ot(t)}}let te=class{constructor(t){this.labelService=t}getWidgetAriaLabel(){return f("scm","Source Control Management")}getAriaLabel(t){if(w.isResourceNode(t))return this.labelService.getUriLabel(t.uri,{relative:!0,noPrefix:!0})||t.name;if(I(t))return`${t.provider.name} ${t.provider.label}`;if(K(t))return f("input","Source Control Input");if(B(t))return t.button?.command.title??"";if(C(t))return t.label;{const e=[];e.push(N(t.sourceUri)),t.decorations.tooltip&&e.push(t.decorations.tooltip);const i=this.labelService.getUriLabel(ct(t.sourceUri),{relative:!0,noPrefix:!0});return i&&e.push(i),e.join(", ")}}};te=M([d(0,De)],te);var _i=(e=>(e.List="list",e.Tree="tree",e))(_i||{}),Ni=(i=>(i.Path="path",i.Name="name",i.Status="status",i))(Ni||{});const W={ViewSort:new T("SCMViewSort"),Repositories:new T("SCMRepositories"),ChangesSettings:new T("SCMChangesSettings")},p={SCMViewMode:new x("scmViewMode","list"),SCMViewSortKey:new x("scmViewSortKey","path"),SCMViewAreAllRepositoriesCollapsed:new x("scmViewAreAllRepositoriesCollapsed",!1),SCMViewIsAnyRepositoryCollapsible:new x("scmViewIsAnyRepositoryCollapsible",!1),SCMProvider:new x("scmProvider",void 0),SCMProviderRootUri:new x("scmProviderRootUri",void 0),SCMProviderHasRootUri:new x("scmProviderHasRootUri",void 0),SCMHistoryItemCount:new x("scmHistoryItemCount",0),RepositoryCount:new x("scmRepositoryCount",0),RepositoryVisibilityCount:new x("scmRepositoryVisibleCount",0),RepositoryVisibility(c){return new x(`scmRepositoryVisible:${c.provider.id}`,!1)}};We.appendMenuItem(T.SCMTitle,{title:f("sortAction","View & Sort"),submenu:W.ViewSort,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0)),group:"0_view&sort",order:1}),We.appendMenuItem(W.ViewSort,{title:f("repositories","Repositories"),submenu:W.Repositories,when:D.greater(p.RepositoryCount.key,1),group:"0_repositories"});class Hi extends wt{repository;constructor(t){super({id:`workbench.scm.action.toggleRepositoryVisibility.${t.provider.id}`,title:t.provider.name,f1:!1,precondition:D.or(p.RepositoryVisibilityCount.notEqualsTo(1),p.RepositoryVisibility(t).isEqualTo(!1)),toggled:p.RepositoryVisibility(t).isEqualTo(!0),menu:{id:W.Repositories,group:"0_repositories"}}),this.repository=t}run(t){t.get(U).toggleVisibility(this.repository)}}let ie=class{constructor(t,e,i){this.contextKeyService=t;this.scmViewService=e;this.repositoryCountContextKey=p.RepositoryCount.bindTo(t),this.repositoryVisibilityCountContextKey=p.RepositoryVisibilityCount.bindTo(t),e.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.disposables),i.onDidAddRepository(this.onDidAddRepository,this,this.disposables),i.onDidRemoveRepository(this.onDidRemoveRepository,this,this.disposables);for(const o of i.repositories)this.onDidAddRepository(o)}items=new Map;repositoryCountContextKey;repositoryVisibilityCountContextKey;disposables=new S;onDidAddRepository(t){const e=R(class extends Hi{constructor(){super(t)}}),i=p.RepositoryVisibility(t).bindTo(this.contextKeyService);i.set(this.scmViewService.isVisible(t)),this.items.set(t,{contextKey:i,dispose(){i.reset(),e.dispose()}}),this.updateRepositoryContextKeys()}onDidRemoveRepository(t){this.items.get(t)?.dispose(),this.items.delete(t),this.updateRepositoryContextKeys()}onDidChangeVisibleRepositories(){let t=0;for(const[e,i]of this.items){const o=this.scmViewService.isVisible(e);i.contextKey.set(o),o&&t++}this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set(t)}updateRepositoryContextKeys(){this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set($.reduce(this.items.keys(),(t,e)=>t+(this.scmViewService.isVisible(e)?1:0),0))}dispose(){this.disposables.dispose(),dt(this.items.values()),this.items.clear()}};ie=M([d(0,X),d(1,U),d(2,Ne)],ie);class st extends J{constructor(t="workbench.scm.action.setListViewMode",e={}){super({id:t,title:f("setListViewMode","View as List"),viewId:A,f1:!1,icon:Y.listTree,toggled:p.SCMViewMode.isEqualTo("list"),menu:{id:W.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="list"}}class Wi extends st{constructor(){super("workbench.scm.action.setListViewModeNavigation",{id:T.SCMTitle,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0),p.SCMViewMode.isEqualTo("tree")),group:"navigation",order:-1e3})}}class rt extends J{constructor(t="workbench.scm.action.setTreeViewMode",e={}){super({id:t,title:f("setTreeViewMode","View as Tree"),viewId:A,f1:!1,icon:Y.listFlat,toggled:p.SCMViewMode.isEqualTo("tree"),menu:{id:W.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="tree"}}class zi extends rt{constructor(){super("workbench.scm.action.setTreeViewModeNavigation",{id:T.SCMTitle,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0),p.SCMViewMode.isEqualTo("list")),group:"navigation",order:-1e3})}}R(st),R(rt),R(Wi),R(zi);class Le extends J{constructor(e,i){super({id:`workbench.scm.action.repositories.setSortKey.${e}`,title:i,viewId:A,f1:!1,toggled:li.RepositorySortKey.isEqualTo(e),menu:[{id:W.Repositories,group:"1_sort"},{id:T.SCMSourceControlTitle,group:"1_sort"}]});this.sortKey=e}runInView(e){e.get(U).toggleSortKey(this.sortKey)}}class Oi extends Le{constructor(){super(ve.DiscoveryTime,f("repositorySortByDiscoveryTime","Sort by Discovery Time"))}}class Ui extends Le{constructor(){super(ve.Name,f("repositorySortByName","Sort by Name"))}}class ki extends Le{constructor(){super(ve.Path,f("repositorySortByPath","Sort by Path"))}}R(Oi),R(Ui),R(ki);class Ke extends J{constructor(e,i){super({id:`workbench.scm.action.setSortKey.${e}`,title:i,viewId:A,f1:!1,toggled:p.SCMViewSortKey.isEqualTo(e),precondition:p.SCMViewMode.isEqualTo("list"),menu:{id:W.ViewSort,group:"2_sort"}});this.sortKey=e}async runInView(e,i){i.viewSortKey=this.sortKey}}class Gi extends Ke{constructor(){super("name",f("sortChangesByName","Sort Changes by Name"))}}class qi extends Ke{constructor(){super("path",f("sortChangesByPath","Sort Changes by Path"))}}class $i extends Ke{constructor(){super("status",f("sortChangesByStatus","Sort Changes by Status"))}}R(Gi),R(qi),R($i);class ji extends J{constructor(){super({id:"workbench.scm.action.collapseAllRepositories",title:f("collapse all","Collapse All Repositories"),viewId:A,f1:!1,icon:Y.collapseAll,menu:{id:T.SCMTitle,group:"navigation",when:D.and(D.equals("view",A),p.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),p.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!1))}})}async runInView(t,e){e.collapseAllRepositories()}}class Ji extends J{constructor(){super({id:"workbench.scm.action.expandAllRepositories",title:f("expand all","Expand All Repositories"),viewId:A,f1:!1,icon:Y.expandAll,menu:{id:T.SCMTitle,group:"navigation",when:D.and(D.equals("view",A),p.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),p.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!0))}})}async runInView(t,e){e.expandAllRepositories()}}R(ji),R(Ji);var Yi=(t=>(t.CancelAction="scm.input.cancelAction",t))(Yi||{}),Qi=(t=>(t.LastActionId="scm.input.lastActionId",t))(Qi||{});let oe=class extends ze{constructor(e,i){super();this.input=e;this.storageService=i}_runningActions=new Set;get runningActions(){return this._runningActions}_cts;async runAction(e){try{if(this.runningActions.size!==0&&(this._cts?.cancel(),e.id==="scm.input.cancelAction"))return;const i=[];for(const o of this.input.repository.provider.groups)i.push({resourceGroupId:o.id,resources:[...o.resources.map(s=>s.sourceUri)]});this._runningActions.add(e),this._cts=new bi,await e.run(this.input.repository.provider.rootUri,i,this._cts.token)}finally{this._runningActions.delete(e),this._runningActions.size===0&&this.storageService.store("scm.input.lastActionId",e.id,_.PROFILE,le.USER)}}};oe=M([d(1,Ve)],oe);let se=class extends wi{constructor(e,i,o,s,a,r,n,l,h){super(e,{resetMenu:T.SCMInputBox,...i},o,s,a,n,r,h);this.menuService=o;this.contextKeyService=s;this.storageService=l;this._dropdownAction=new Ie("scmInputMoreActions",f("scmInputMoreActions","More Actions..."),"codicon-chevron-down"),this._cancelAction=new Ce({id:"scm.input.cancelAction",title:f("scmInputCancelAction","Cancel"),icon:Y.debugStop},void 0,void 0,void 0,void 0,s,r)}_dropdownActions=[];get dropdownActions(){return this._dropdownActions}_dropdownAction;get dropdownAction(){return this._dropdownAction}_cancelAction;_onDidChange=new Q;onDidChange=this._onDidChange.event;_disposables=this._register(new me);setInput(e){this._disposables.value=new S;const i=this.contextKeyService.createOverlay([["scmProvider",e.repository.provider.contextValue],["scmProviderRootUri",e.repository.provider.rootUri?.toString()],["scmProviderHasRootUri",!!e.repository.provider.rootUri]]),o=this._disposables.value.add(this.menuService.createMenu(T.SCMInputBox,i,{emitEventsForSubmenuChanges:!0})),s=()=>e.repository.provider.groups.some(r=>r.resources.length>0),a=()=>{const r=[];si(o,{shouldForwardArgs:!0},r);for(const l of r)l.enabled=s();this._dropdownAction.enabled=s();let n;if(r.length===1)n=r[0];else if(r.length>1){const l=this.storageService.get("scm.input.lastActionId",_.PROFILE,"");n=r.find(h=>h.id===l)??r[0]}this._dropdownActions=r.length===1?[]:r,super.setActions(n?[n]:[],[]),this._onDidChange.fire()};this._disposables.value.add(o.onDidChange(()=>a())),this._disposables.value.add(e.repository.provider.onDidChangeResources(()=>a())),this._disposables.value.add(this.storageService.onDidChangeValue(_.PROFILE,"scm.input.lastActionId",this._disposables.value)(()=>a())),this.actionRunner=new oe(e,this.storageService),this._disposables.value.add(this.actionRunner.onWillRun(r=>{this.actionRunner.runningActions.size===0&&(super.setActions([this._cancelAction],[]),this._onDidChange.fire())})),this._disposables.value.add(this.actionRunner.onDidRun(r=>{this.actionRunner.runningActions.size===0&&a()})),a()}};se=M([d(2,He),d(3,X),d(4,Se),d(5,fe),d(6,ye),d(7,Ve),d(8,$e)],se);class Xi{constructor(t,e){this.overflowWidgetsDomNode=t;this.configurationService=e;const i=E.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration("editor.accessibilitySupport")||o.affectsConfiguration("editor.cursorBlinking")||o.affectsConfiguration("editor.fontFamily")||o.affectsConfiguration("editor.rulers")||o.affectsConfiguration("editor.wordWrap")||o.affectsConfiguration("scm.inputFontFamily")||o.affectsConfiguration("scm.inputFontSize"),this._disposables);this._disposables.add(i(()=>this._onDidChange.fire()))}_onDidChange=new Q;onDidChange=this._onDidChange.event;defaultInputFontFamily=Qt;_disposables=new S;getEditorConstructionOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e);return{...Ft(this.configurationService),...this._getEditorLanguageConfiguration(),cursorWidth:1,dragAndDrop:!0,dropIntoEditor:{enabled:!0},fontFamily:t,fontSize:e,formatOnType:!0,lineDecorationsWidth:6,lineHeight:i,overflowWidgetsDomNode:this.overflowWidgetsDomNode,padding:{top:2,bottom:2},quickSuggestions:!1,renderWhitespace:"none",scrollbar:{alwaysConsumeMouseWheel:!1,vertical:"hidden"},wrappingIndent:"none",wrappingStrategy:"advanced"}}getEditorOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e),o=this.configurationService.getValue("editor.accessibilitySupport"),s=this.configurationService.getValue("editor.cursorBlinking");return{...this._getEditorLanguageConfiguration(),accessibilitySupport:o,cursorBlinking:s,fontFamily:t,fontSize:e,lineHeight:i}}_getEditorFontFamily(){const t=this.configurationService.getValue("scm.inputFontFamily").trim();return t.toLowerCase()==="editor"?this.configurationService.getValue("editor.fontFamily").trim():t.length!==0&&t.toLowerCase()!=="default"?t:this.defaultInputFontFamily}_getEditorFontSize(){return this.configurationService.getValue("scm.inputFontSize")}_getEditorLanguageConfiguration(){const t=this.configurationService.inspect("editor.rulers",{overrideIdentifier:"scminput"}),e=t.overrideIdentifiers?.includes("scminput")?et.rulers.validate(t.value):[],i=this.configurationService.inspect("editor.wordWrap",{overrideIdentifier:"scminput"}),o=i.overrideIdentifiers?.includes("scminput")?et.wordWrap.validate(i.value):"on";return{rulers:e,wordWrap:o}}_getEditorLineHeight(t){return Math.round(t*1.5)}dispose(){this._disposables.dispose()}}let j=class{constructor(t,e,i,o,s,a,r,n,l,h){this.modelService=o;this.keybindingService=s;this.configurationService=a;this.instantiationService=r;this.scmViewService=n;this.contextViewService=l;this.openerService=h;this.element=m(t,v(".scm-editor")),this.editorContainer=m(this.element,v(".scm-editor-container")),this.toolbarContainer=m(this.element,v(".scm-editor-toolbar")),this.contextKeyService=i.createScoped(this.element),this.repositoryIdContextKey=this.contextKeyService.createKey("scmRepository",void 0),this.inputEditorOptions=new Xi(e,this.configurationService),this.disposables.add(this.inputEditorOptions.onDidChange(this.onDidChangeEditorOptions,this)),this.disposables.add(this.inputEditorOptions);const u={contributions:_t.getSomeEditorContributions([vi.ID,jt.ID,zt.ID,Ye.ID,ui.ID,Qe.ID,Wt.ID,yi.ID,Vi.ID,Di.ID,mi.ID,Jt.ID,Nt.ID,pi.ID,Ei.ID,Ht,qt.ID,Gt.ID]),isSimpleWidget:!0},g=new $t([X,this.contextKeyService]),y=r.createChild(g,this.disposables),V=this.inputEditorOptions.getEditorConstructionOptions();this.inputEditor=y.createInstance(Kt,this.editorContainer,V,u),this.disposables.add(this.inputEditor),this.disposables.add(this.inputEditor.onDidFocusEditorText(()=>{this.input?.repository&&this.scmViewService.focus(this.input.repository),this.element.classList.add("synthetic-focus"),this.renderValidation()})),this.disposables.add(this.inputEditor.onDidBlurEditorText(()=>{this.element.classList.remove("synthetic-focus"),setTimeout(()=>{(!this.validation||!this.validationHasFocus)&&this.clearValidation()},0)})),this.disposables.add(this.inputEditor.onDidBlurEditorWidget(()=>{Ye.get(this.inputEditor)?.clearWidgets(),Qe.get(this.inputEditor)?.clearWidgets()}));const pe=this.contextKeyService.createKey("scmInputIsInFirstPosition",!1),P=this.contextKeyService.createKey("scmInputIsInLastPosition",!1);this.disposables.add(this.inputEditor.onDidChangeCursorPosition(({position:b})=>{const O=this.inputEditor._getViewModel(),ne=O.getLineCount(),ae=O.getLineLength(ne)+1,ce=O.coordinatesConverter.convertModelPositionToViewPosition(b);pe.set(ce.lineNumber===1&&ce.column===1),P.set(ce.lineNumber===ne&&ce.column===ae)})),this.disposables.add(this.inputEditor.onDidScrollChange(b=>{this.toolbarContainer.classList.toggle("scroll-decoration",b.scrollTop>0)})),E.filter(this.configurationService.onDidChangeConfiguration,b=>b.affectsConfiguration("scm.showInputActionButton"))(()=>this.layout(),this,this.disposables),this.onDidChangeContentHeight=E.signal(E.filter(this.inputEditor.onDidContentSizeChange,b=>b.contentHeightChanged,this.disposables)),this.toolbar=y.createInstance(se,this.toolbarContainer,{actionViewItemProvider:(b,O)=>b instanceof Ce&&this.toolbar.dropdownActions.length>1?r.createInstance(Mi,b,this.toolbar.dropdownAction,this.toolbar.dropdownActions,"",{actionRunner:this.toolbar.actionRunner,hoverDelegate:O.hoverDelegate}):oi(r,b,O),menuOptions:{shouldForwardArgs:!0}}),this.disposables.add(this.toolbar.onDidChange(()=>this.layout())),this.disposables.add(this.toolbar)}static ValidationTimeouts={[H.Information]:5e3,[H.Warning]:8e3,[H.Error]:1e4};contextKeyService;element;editorContainer;inputEditor;inputEditorOptions;toolbarContainer;toolbar;disposables=new S;model;repositoryIdContextKey;repositoryDisposables=new S;validation;validationContextView;validationHasFocus=!1;_validationTimer;lastLayoutWasTrash=!1;shouldFocusAfterLayout=!1;onDidChangeContentHeight;get input(){return this.model?.input}set input(t){if(t===this.input)return;if(this.clearValidation(),this.element.classList.remove("synthetic-focus"),this.repositoryDisposables.clear(),this.repositoryIdContextKey.set(t?.repository.id),!t){this.inputEditor.setModel(void 0),this.model=void 0;return}const e=t.repository.provider.inputBoxTextModel;this.inputEditor.setModel(e),this.configurationService.getValue("editor.wordBasedSuggestions",{resource:e.uri})!=="off"&&this.configurationService.updateValue("editor.wordBasedSuggestions","off",{resource:e.uri},Rt.MEMORY);const i=new Dt(200),o=async()=>{const u=this.inputEditor.getSelection()?.getStartPosition(),g=u&&e.getOffsetAt(u),y=e.getValue();this.setValidation(await t.validateInput(y,g||0))},s=()=>i.trigger(o);this.repositoryDisposables.add(i),this.repositoryDisposables.add(this.inputEditor.onDidChangeCursorPosition(s));const a=this.modelService.getCreationOptions(e.getLanguageId(),e.uri,e.isForSimpleWidget),r=E.filter(this.inputEditor.onKeyDown,u=>u.keyCode===Yt.Enter,this.repositoryDisposables);this.repositoryDisposables.add(r(()=>e.detectIndentation(a.insertSpaces,a.tabSize))),e.setValue(t.value),this.repositoryDisposables.add(t.onDidChange(({value:u,reason:g})=>{const y=e.getValue();if(u===y)return;e.pushStackElement(),e.pushEditOperations(null,[Ii.replaceMove(e.getFullModelRange(),u)],()=>[]);const V=g===St.HistoryPrevious?e.getFullModelRange().getStartPosition():e.getFullModelRange().getEndPosition();this.inputEditor.setPosition(V),this.inputEditor.revealPositionInCenterIfOutsideViewport(V)})),this.repositoryDisposables.add(t.onDidChangeFocus(()=>this.focus())),this.repositoryDisposables.add(t.onDidChangeValidationMessage(u=>this.setValidation(u,{focus:!0,timeout:!0}))),this.repositoryDisposables.add(t.onDidChangeValidateInput(u=>s())),this.repositoryDisposables.add(e.onDidChangeContent(()=>{t.setValue(e.getValue(),!0),s()}));const n=()=>{const u=this.keybindingService.lookupKeybinding("scm.acceptInput"),g=u?u.getLabel():Ot.isMacintosh?"Cmd+Enter":"Ctrl+Enter",y=kt(t.placeholder,g);this.inputEditor.updateOptions({placeholder:y})};this.repositoryDisposables.add(t.onDidChangePlaceholder(n)),this.repositoryDisposables.add(this.keybindingService.onDidUpdateKeybindings(n)),n();let l="";this.repositoryDisposables.add(tt(u=>{if(!t.visible)return;const g=l;l=t.repository.provider.commitTemplate.read(u);const y=e.getValue();y&&y!==g||e.setValue(l)}));const h=u=>{this.inputEditor.updateOptions({readOnly:!u})};this.repositoryDisposables.add(t.onDidChangeEnablement(u=>h(u))),h(t.enabled),this.toolbar.setInput(t),this.model={input:t,textModel:e}}get selections(){return this.inputEditor.getSelections()}set selections(t){t&&this.inputEditor.setSelections(t)}setValidation(t,e){this._validationTimer&&(clearTimeout(this._validationTimer),this._validationTimer=0),this.validation=t,this.renderValidation(),e?.focus&&!this.hasFocus()&&this.focus(),t&&e?.timeout&&(this._validationTimer=setTimeout(()=>this.setValidation(void 0),j.ValidationTimeouts[t.type]))}getContentHeight(){const t=this.inputEditor.getOption(Ze.lineHeight),{top:e,bottom:i}=this.inputEditor.getOption(Ze.padding),o=this.configurationService.getValue("scm.inputMinLineCount"),a=(typeof o=="number"?Ae(o,1,50):1)*t+e+i,r=this.configurationService.getValue("scm.inputMaxLineCount"),l=(typeof r=="number"?Ae(r,1,50):10)*t+e+i;return Ae(this.inputEditor.getContentHeight(),a,l)}layout(){const t=this.getContentHeight(),e=this.getToolbarWidth(),i=new ut(this.element.clientWidth-e,t);if(i.width<0){this.lastLayoutWasTrash=!0;return}this.lastLayoutWasTrash=!1,this.inputEditor.layout(i),this.renderValidation();const o=this.configurationService.getValue("scm.showInputActionButton")===!0;this.toolbarContainer.classList.toggle("hidden",!o||this.toolbar?.isEmpty()===!0),this.shouldFocusAfterLayout&&(this.shouldFocusAfterLayout=!1,this.focus())}focus(){if(this.lastLayoutWasTrash){this.lastLayoutWasTrash=!1,this.shouldFocusAfterLayout=!0;return}this.inputEditor.focus(),this.element.classList.add("synthetic-focus")}hasFocus(){return this.inputEditor.hasTextFocus()}onDidChangeEditorOptions(){this.inputEditor.updateOptions(this.inputEditorOptions.getEditorOptions())}renderValidation(){if(this.clearValidation(),this.element.classList.toggle("validation-info",this.validation?.type===H.Information),this.element.classList.toggle("validation-warning",this.validation?.type===H.Warning),this.element.classList.toggle("validation-error",this.validation?.type===H.Error),!this.validation||!this.inputEditor.hasTextFocus())return;const t=new S;this.validationContextView=this.contextViewService.showContextView({getAnchor:()=>this.element,render:e=>{this.element.style.borderBottomLeftRadius="0",this.element.style.borderBottomRightRadius="0";const i=m(e,v(".scm-editor-validation-container"));i.classList.toggle("validation-info",this.validation.type===H.Information),i.classList.toggle("validation-warning",this.validation.type===H.Warning),i.classList.toggle("validation-error",this.validation.type===H.Error),i.style.width=`${this.element.clientWidth+2}px`;const o=m(i,v(".scm-editor-validation")),s=this.validation.message;if(typeof s=="string")o.textContent=s;else{const l=ht(o);t.add(l),t.add(l.onDidFocus(()=>this.validationHasFocus=!0)),t.add(l.onDidBlur(()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()}));const u=t.add(this.instantiationService.createInstance(ni,{})).render(s,{actionHandler:{callback:g=>{ai(this.openerService,g,s.isTrusted),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()},disposables:t}});t.add(u),o.appendChild(u.element)}const a=m(i,v(".scm-editor-validation-actions")),r=new we(a),n=new Ie("scmInputWidget.validationMessage.close",f("label.close","Close"),Ee.asClassName(Y.close),!0,()=>{this.contextViewService.hideContextView(),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px"});return t.add(r),r.push(n,{icon:!0,label:!1}),he.None},onHide:()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",t.dispose()},anchorAlignment:Xt.LEFT})}getToolbarWidth(){const t=this.configurationService.getValue("scm.showInputActionButton");return!this.toolbar||!t||this.toolbar?.isEmpty()===!0?0:this.toolbar.dropdownActions.length===0?26:39}clearValidation(){this.validationContextView?.close(),this.validationContextView=void 0,this.validationHasFocus=!1}dispose(){this.input=void 0,this.repositoryDisposables.dispose(),this.clearValidation(),this.disposables.dispose()}};j=M([d(2,X),d(3,Bt),d(4,ye),d(5,Re),d(6,ge),d(7,U),d(8,It),d(9,qe)],j);let ue=class extends lt{constructor(e,i,o,s,a,r,n,l,h,u,g,y,V,pe,P,b,O,ne){super({...e,titleMenuId:T.SCMTitle},h,g,pe,P,V,y,b,u,O,ne);this.commandService=i;this.editorService=o;this.menuService=s;this.scmService=a;this.scmViewService=r;this.storageService=n;this.uriIdentityService=l;this._viewMode=this.getViewMode(),this._viewSortKey=this.getViewSortKey(),this.viewModeContextKey=p.SCMViewMode.bindTo(P),this.viewModeContextKey.set(this._viewMode),this.viewSortKeyContextKey=p.SCMViewSortKey.bindTo(P),this.viewSortKeyContextKey.set(this.viewSortKey),this.areAllRepositoriesCollapsedContextKey=p.SCMViewAreAllRepositoriesCollapsed.bindTo(P),this.isAnyRepositoryCollapsibleContextKey=p.SCMViewIsAnyRepositoryCollapsible.bindTo(P),this.scmProviderContextKey=p.SCMProvider.bindTo(P),this.scmProviderRootUriContextKey=p.SCMProviderRootUri.bindTo(P),this.scmProviderHasRootUriContextKey=p.SCMProviderHasRootUri.bindTo(P),this._onDidLayout=new Q,this.layoutCache={height:void 0,width:void 0,onDidChange:this._onDidLayout.event},this.storageService.onDidChangeValue(_.WORKSPACE,void 0,this.disposables)(ae=>{switch(ae.key){case"scm.viewMode":this.viewMode=this.getViewMode();break;case"scm.viewSortKey":this.viewSortKey=this.getViewSortKey();break}},this,this.disposables),this.storageService.onWillSaveState(ae=>{this.viewMode=this.getViewMode(),this.viewSortKey=this.getViewSortKey(),this.storeTreeViewState()},this,this.disposables),E.any(this.scmService.onDidAddRepository,this.scmService.onDidRemoveRepository)(()=>this._onDidChangeViewWelcomeState.fire(),this,this.disposables),this.disposables.add(this.revealResourceThrottler),this.disposables.add(this.updateChildrenThrottler)}_onDidLayout;layoutCache;treeScrollTop;treeContainer;tree;listLabels;inputRenderer;actionButtonRenderer;_viewMode;get viewMode(){return this._viewMode}set viewMode(e){this._viewMode!==e&&(this._viewMode=e,this.viewSortKey=this.getViewSortKey(),this.updateChildren(),this.onDidActiveEditorChange(),this._onDidChangeViewMode.fire(e),this.viewModeContextKey.set(e),this.updateIndentStyles(this.themeService.getFileIconTheme()),this.storageService.store("scm.viewMode",e,_.WORKSPACE,le.USER))}_onDidChangeViewMode=new Q;onDidChangeViewMode=this._onDidChangeViewMode.event;_viewSortKey;get viewSortKey(){return this._viewSortKey}set viewSortKey(e){this._viewSortKey!==e&&(this._viewSortKey=e,this.updateChildren(),this.viewSortKeyContextKey.set(e),this._onDidChangeViewSortKey.fire(e),this._viewMode==="list"&&this.storageService.store("scm.viewSortKey",e,_.WORKSPACE,le.USER))}_onDidChangeViewSortKey=new Q;onDidChangeViewSortKey=this._onDidChangeViewSortKey.event;items=new _e;visibilityDisposables=new S;treeOperationSequencer=new Vt;revealResourceThrottler=new ke;updateChildrenThrottler=new ke;viewModeContextKey;viewSortKeyContextKey;areAllRepositoriesCollapsedContextKey;isAnyRepositoryCollapsibleContextKey;scmProviderContextKey;scmProviderRootUriContextKey;scmProviderHasRootUriContextKey;disposables=new S;layoutBody(e=this.layoutCache.height,i=this.layoutCache.width){e!==void 0&&(i!==void 0&&super.layoutBody(e,i),this.layoutCache.height=e,this.layoutCache.width=i,this._onDidLayout.fire(),this.treeContainer.style.height=`${e}px`,this.tree.layout(e,i))}renderBody(e){super.renderBody(e),this.treeContainer=m(e,v(".scm-view.show-file-icons")),this.treeContainer.classList.add("file-icon-themable-tree"),this.treeContainer.classList.add("show-file-icons");const i=()=>this.treeContainer.classList.toggle("show-actions",this.configurationService.getValue("scm.alwaysShowActions"));E.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("scm.alwaysShowActions"),this.disposables)(i,this,this.disposables),i();const o=()=>{const a=this.configurationService.getValue("scm.providerCountBadge");this.treeContainer.classList.toggle("hide-provider-counts",a==="hidden"),this.treeContainer.classList.toggle("auto-provider-counts",a==="auto")};E.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("scm.providerCountBadge"),this.disposables)(o,this,this.disposables),o();const s=this.loadTreeViewState();this.createTree(this.treeContainer,s),this.onDidChangeBodyVisibility(async a=>{a?this.treeOperationSequencer.queue(async()=>{await this.tree.setInput(this.scmViewService,s),E.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration("scm.alwaysShowRepositories"),this.visibilityDisposables)(()=>{this.updateActions(),this.updateChildren()},this,this.visibilityDisposables),E.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration("scm.inputMinLineCount")||r.affectsConfiguration("scm.inputMaxLineCount")||r.affectsConfiguration("scm.showActionButton"),this.visibilityDisposables)(()=>this.updateChildren(),this,this.visibilityDisposables),this.editorService.onDidActiveEditorChange(this.onDidActiveEditorChange,this,this.visibilityDisposables),this.scmViewService.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.visibilityDisposables),this.onDidChangeVisibleRepositories({added:this.scmViewService.visibleRepositories,removed:$.empty()}),typeof this.treeScrollTop=="number"&&(this.tree.scrollTop=this.treeScrollTop,this.treeScrollTop=void 0),this.updateRepositoryCollapseAllContextKeys()}):(this.visibilityDisposables.clear(),this.onDidChangeVisibleRepositories({added:$.empty(),removed:[...this.items.keys()]}),this.treeScrollTop=this.tree.scrollTop,this.updateRepositoryCollapseAllContextKeys())},this,this.disposables),this.disposables.add(this.instantiationService.createInstance(ie)),this.themeService.onDidFileIconThemeChange(this.updateIndentStyles,this,this.disposables),this.updateIndentStyles(this.themeService.getFileIconTheme())}createTree(e,i){const o=v(".scm-overflow-widgets-container.monaco-editor");this.inputRenderer=this.instantiationService.createInstance(F,this.layoutCache,o,(n,l)=>{try{this.tree.updateElementHeight(n,l)}catch{}}),this.actionButtonRenderer=this.instantiationService.createInstance(z),this.listLabels=this.instantiationService.createInstance(ft,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.disposables.add(this.listLabels);const s=new it(()=>this.getSelectedResources());s.onWillRun(()=>this.tree.domFocus(),this,this.disposables),this.disposables.add(s);const a=this.instantiationService.createInstance(re,()=>this.viewMode);this.disposables.add(a);const r=Ai("scm.compactFolders",!0,this.configurationService);this.tree=this.instantiationService.createInstance(Mt,"SCM Tree Repo",e,new Li(this.inputRenderer),new Ki,[this.inputRenderer,this.actionButtonRenderer,this.instantiationService.createInstance(je,T.SCMTitle,be(this.instantiationService)),this.instantiationService.createInstance(k,be(this.instantiationService)),this.instantiationService.createInstance(G,()=>this.viewMode,this.listLabels,be(this.instantiationService),s)],a,{horizontalScrolling:!1,setRowLineHeight:!1,transformOptimization:!1,filter:new Fi,dnd:new Fe(this.instantiationService),identityProvider:new Bi,sorter:new Pi(()=>this.viewMode,()=>this.viewSortKey),keyboardNavigationLabelProvider:this.instantiationService.createInstance(ee,()=>this.viewMode),overrideStyles:this.getLocationBasedColors().listOverrideStyles,compressionEnabled:r.get(),collapseByDefault:n=>I(n)||C(n)||q(n)?!1:(i?.expanded??[]).indexOf(ot(n))===-1,accessibilityProvider:this.instantiationService.createInstance(te)}),this.disposables.add(this.tree),this.tree.onDidOpen(this.open,this,this.disposables),this.tree.onContextMenu(this.onListContextMenu,this,this.disposables),this.tree.onDidScroll(this.inputRenderer.clearValidation,this.inputRenderer,this.disposables),E.filter(this.tree.onDidChangeCollapseState,n=>I(n.node.element?.element),this.disposables)(this.updateRepositoryCollapseAllContextKeys,this,this.disposables),this.disposables.add(tt(n=>{this.tree.updateOptions({compressionEnabled:r.read(n)})})),m(e,o)}async open(e){if(e.element){if(I(e.element)){this.scmViewService.focus(e.element);return}else if(K(e.element)){this.scmViewService.focus(e.element.repository);const i=this.inputRenderer.getRenderedInputWidget(e.element);if(i){i.focus(),this.tree.setFocus([],e.browserEvent);const o=this.tree.getSelection();o.length===1&&o[0]===e.element&&setTimeout(()=>this.tree.setSelection([]))}return}else if(B(e.element)){this.scmViewService.focus(e.element.repository),this.actionButtonRenderer.focusActionButton(e.element),this.tree.setFocus([],e.browserEvent);return}else if(C(e.element)){const i=e.element.provider,o=$.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o);return}else if(L(e.element)){if(e.element.command?.id===ii||e.element.command?.id===ti)if(vt(e.browserEvent)&&e.browserEvent.button===1){const s=e.element.resourceGroup,a=`${s.provider.label}: ${s.label}`;await Ti.openMultiFileDiffEditor(this.editorService,a,s.provider.rootUri,s.id,{...e.editorOptions,viewState:{revealData:{resource:{original:e.element.multiDiffEditorOriginalUri,modified:e.element.multiDiffEditorModifiedUri}}},preserveFocus:!0})}else await this.commandService.executeCommand(e.element.command.id,...e.element.command.arguments||[],e);else if(await e.element.open(!!e.editorOptions.preserveFocus),e.editorOptions.pinned){const s=this.editorService.activeEditorPane;s?.group.pinEditor(s.input)}const i=e.element.resourceGroup.provider,o=$.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o)}else if(q(e.element)){const i=e.element.context.provider,o=$.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o);return}}else return}onDidActiveEditorChange(){if(!this.configurationService.getValue("scm.autoReveal"))return;const e=xt.getOriginalUri(this.editorService.activeEditor,{supportSideBySide:Lt.PRIMARY});e&&(this.tree.getFocus().some(i=>L(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))&&this.tree.getSelection().some(i=>L(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))||this.revealResourceThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{for(const i of this.scmViewService.visibleRepositories)if(this.items.get(i))for(let s=i.provider.groups.length-1;s>=0;s--){const a=i.provider.groups[s],r=this.viewMode==="tree"?a.resourceTree.getNode(e)?.element:a.resources.find(n=>this.uriIdentityService.extUri.isEqual(n.sourceUri,e));if(r){await this.tree.expandTo(r),this.tree.reveal(r),this.tree.setSelection([r]),this.tree.setFocus([r]);return}}})))}onDidChangeVisibleRepositories({added:e,removed:i}){for(const o of e){const s=new S;s.add(o.provider.onDidChange(()=>this.updateChildren(o))),s.add(o.input.onDidChangeVisibility(()=>this.updateChildren(o))),s.add(o.provider.onDidChangeResourceGroups(()=>this.updateChildren(o)));const a=s.add(new _e),r=()=>{for(const[n]of a)o.provider.groups.includes(n)||a.deleteAndDispose(n);for(const n of o.provider.groups)if(!a.has(n)){const l=new S;l.add(n.onDidChange(()=>this.updateChildren(o))),l.add(n.onDidChangeResources(()=>this.updateChildren(o))),a.set(n,l)}};s.add(o.provider.onDidChangeResourceGroups(r)),r(),this.items.set(o,s)}for(const o of i)this.items.deleteAndDispose(o);this.updateChildren(),this.onDidActiveEditorChange()}onListContextMenu(e){if(!e.element){const r=this.menuService.getMenuActions(W.ViewSort,this.contextKeyService),n=[];return ri(r,n),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>n,onHide:()=>{}})}const i=e.element;let o=i,s=[],a=new it(()=>this.getSelectedResources());if(I(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.provider).repositoryContextMenu;o=i.provider,a=new Zt(()=>this.getSelectedRepositories()),s=Z(n)}else if(!(K(i)||B(i))){if(C(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.provider).getResourceGroupMenu(i);s=Z(n)}else if(L(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.resourceGroup.provider).getResourceMenu(i);s=Z(n)}else if(q(i))if(i.element){const n=this.scmViewService.menus.getRepositoryMenus(i.element.resourceGroup.provider).getResourceMenu(i.element);s=Z(n)}else{const n=this.scmViewService.menus.getRepositoryMenus(i.context.provider).getResourceFolderMenu(i.context);s=Z(n)}}a.onWillRun(()=>this.tree.domFocus()),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>s,getActionsContext:()=>o,actionRunner:a})}getSelectedRepositories(){const e=this.tree.getFocus().filter(o=>!!o&&I(o)),i=this.tree.getSelection().filter(o=>!!o&&I(o));return Array.from(new Set([...e,...i]))}getSelectedResources(){return this.tree.getSelection().filter(e=>!!e&&!C(e))}getViewMode(){let e=this.configurationService.getValue("scm.defaultViewMode")==="list"?"list":"tree";const i=this.storageService.get("scm.viewMode",_.WORKSPACE);return typeof i=="string"&&(e=i),e}getViewSortKey(){if(this._viewMode==="tree")return"path";let e;switch(this.configurationService.getValue("scm.defaultViewSortKey")){case"name":e="name";break;case"status":e="status";break;default:e="path";break}const o=this.storageService.get("scm.viewSortKey",_.WORKSPACE);return typeof o=="string"&&(e=o),e}loadTreeViewState(){const e=this.storageService.get("scm.viewState2",_.WORKSPACE);if(e)try{return JSON.parse(e)}catch{return}}storeTreeViewState(){this.tree&&this.storageService.store("scm.viewState2",JSON.stringify(this.tree.getViewState()),_.WORKSPACE,le.MACHINE)}updateChildren(e){this.updateChildrenThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{const i=this.inputRenderer.getFocusedInput();e&&this.tree.hasNode(e)?await this.tree.updateChildren(e):await this.tree.updateChildren(void 0),i&&this.inputRenderer.getRenderedInputWidget(i)?.focus(),this.updateScmProviderContextKeys(),this.updateRepositoryCollapseAllContextKeys()}))}updateIndentStyles(e){this.treeContainer.classList.toggle("list-view-mode",this.viewMode==="list"),this.treeContainer.classList.toggle("tree-view-mode",this.viewMode==="tree"),this.treeContainer.classList.toggle("align-icons-and-twisties",this.viewMode==="list"&&e.hasFileIcons||e.hasFileIcons&&!e.hasFolderIcons),this.treeContainer.classList.toggle("hide-arrows",this.viewMode==="tree"&&e.hidesExplorerArrows===!0)}updateScmProviderContextKeys(){if(!this.configurationService.getValue("scm.alwaysShowRepositories")&&this.items.size===1){const i=$.first(this.items.keys()).provider;this.scmProviderContextKey.set(i.contextValue),this.scmProviderRootUriContextKey.set(i.rootUri?.toString()),this.scmProviderHasRootUriContextKey.set(!!i.rootUri)}else this.scmProviderContextKey.set(void 0),this.scmProviderRootUriContextKey.set(void 0),this.scmProviderHasRootUriContextKey.set(!1)}updateRepositoryCollapseAllContextKeys(){if(!this.isBodyVisible()||this.items.size===1){this.isAnyRepositoryCollapsibleContextKey.set(!1),this.areAllRepositoriesCollapsedContextKey.set(!1);return}this.isAnyRepositoryCollapsibleContextKey.set(this.scmViewService.visibleRepositories.some(e=>this.tree.hasNode(e)&&this.tree.isCollapsible(e))),this.areAllRepositoriesCollapsedContextKey.set(this.scmViewService.visibleRepositories.every(e=>this.tree.hasNode(e)&&(!this.tree.isCollapsible(e)||this.tree.isCollapsed(e))))}collapseAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.collapse(e)}expandAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.expand(e)}focusPreviousInput(){this.treeOperationSequencer.queue(()=>this.focusInput(-1))}focusNextInput(){this.treeOperationSequencer.queue(()=>this.focusInput(1))}async focusInput(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;let i=this.scmViewService.focusedRepository.input;const o=this.scmViewService.visibleRepositories;if(!(o.length===1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0)){if(o.length>1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0){const s=o.indexOf(this.scmViewService.focusedRepository),a=xe(s+e,o.length);i=o[a].input}await this.tree.expandTo(i),this.tree.reveal(i),this.inputRenderer.getRenderedInputWidget(i)?.focus()}}focusPreviousResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(-1))}focusNextResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(1))}async focusResourceGroup(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;const i=gt(this.tree.getHTMLElement()),o=this.scmViewService.focusedRepository.provider.groups,s=this.tree.getFocus().find(n=>C(n)),a=i&&s?o.indexOf(s):-1;let r;if(a===-1){for(const n of o)if(this.tree.hasNode(n)){r=n;break}}else{let n=xe(a+e,o.length);for(;n!==a;){if(this.tree.hasNode(o[n])){r=o[n];break}n=xe(n+e,o.length)}}r&&(await this.tree.expandTo(r),this.tree.reveal(r),this.tree.setSelection([r]),this.tree.setFocus([r]),this.tree.domFocus())}shouldShowWelcome(){return this.scmService.repositoryCount===0}getActionsContext(){return this.scmViewService.visibleRepositories.length===1?this.scmViewService.visibleRepositories[0].provider:void 0}focus(){super.focus(),this.treeOperationSequencer.queue(()=>new Promise(e=>{if(this.isExpanded()){if(this.tree.getFocus().length===0)for(const i of this.scmViewService.visibleRepositories){const o=this.inputRenderer.getRenderedInputWidget(i.input);if(o){o.focus(),e();return}}this.tree.domFocus(),e()}}))}dispose(){this.visibilityDisposables.dispose(),this.disposables.dispose(),this.items.dispose(),super.dispose()}};ue=M([d(1,fe),d(2,Ct),d(3,He),d(4,Ne),d(5,U),d(6,Ve),d(7,Ci),d(8,ye),d(9,Oe),d(10,Se),d(11,ge),d(12,At),d(13,Re),d(14,X),d(15,qe),d(16,$e),d(17,Ri)],ue);let re=class extends he{constructor(e,i,o){super();this.viewMode=e;this.configurationService=i;this.scmViewService=o}async getChildren(e){const i=this.scmViewService.visibleRepositories.length,o=this.configurationService.getValue("scm.showActionButton")===!0,s=this.configurationService.getValue("scm.alwaysShowRepositories")===!0;if(Me(e)&&(i>1||s))return this.scmViewService.visibleRepositories;if(Me(e)&&i===1&&!s||I(e)){const a=[];e=I(e)?e:this.scmViewService.visibleRepositories[0];const r=e.provider.actionButton,n=e.provider.groups;return e.input.visible&&a.push(e.input),o&&r&&a.push({type:"actionButton",repository:e,button:r}),(n.some(h=>h.resources.length>0)||i===1&&(!o||!r))&&a.push(...n),a}else if(C(e)){if(this.viewMode()==="list")return e.resources;if(this.viewMode()==="tree"){const a=[];for(const r of e.resourceTree.root.children)a.push(r.element&&r.childrenCount===0?r.element:r);return a}}else if(q(e)){const a=[];for(const r of e.children)a.push(r.element&&r.childrenCount===0?r.element:r);return a}return[]}getParent(e){if(q(e)){if(e.parent===e.context.resourceTree.root)return e.context;if(e.parent)return e.parent;throw new Error("Invalid element passed to getParent")}else if(L(e)){if(this.viewMode()==="list")return e.resourceGroup;const o=e.resourceGroup.resourceTree.getNode(e.sourceUri)?.parent;if(!o)throw new Error("Invalid element passed to getParent");return o===e.resourceGroup.resourceTree.root?e.resourceGroup:o}else{if(K(e))return e.repository;if(C(e)){const i=this.scmViewService.visibleRepositories.find(o=>o.provider===e.provider);if(!i)throw new Error("Invalid element passed to getParent");return i}else throw new Error("Unexpected call to getParent")}}hasChildren(e){if(Me(e))return this.scmViewService.visibleRepositories.length!==0;if(I(e))return!0;if(K(e))return!1;if(B(e))return!1;if(C(e))return!0;if(L(e))return!1;if(w.isResourceNode(e))return e.childrenCount>0;throw new Error("hasChildren not implemented.")}};re=M([d(1,Re),d(2,U)],re);class Zi{constructor(t,e,i,o){this.container=t;this.contextMenuService=e;this.commandService=i;this.notificationService=o}button;disposables=new me;dispose(){this.disposables?.dispose()}setButton(t){if(this.clear(),!!t){if(t.secondaryCommands?.length){const e=[];for(let i=0;i<t.secondaryCommands.length;i++){const o=t.secondaryCommands[i];for(const s of o)e.push(new Ie(s.id,s.title,void 0,!0,async()=>await this.executeCommand(s.id,...s.arguments||[])));o.length&&e.push(new bt)}e.pop(),this.button=new ci(this.container,{actions:e,addPrimaryActionToDropdown:!1,contextMenuProvider:this.contextMenuService,title:t.command.tooltip,supportIcons:!0,...Xe})}else this.button=new Je(this.container,{supportIcons:!0,supportShortLabel:!!t.description,title:t.command.tooltip,...Xe});this.button.enabled=t.enabled,this.button.label=t.command.title,this.button instanceof Je&&t.description&&(this.button.labelShort=t.description),this.button.onDidClick(async()=>await this.executeCommand(t.command.id,...t.command.arguments||[]),null,this.disposables.value),this.disposables.value.add(this.button)}}focus(){this.button?.focus()}clear(){this.disposables.value=new S,this.button=void 0,mt(this.container)}async executeCommand(t,...e){try{await this.commandService.executeCommand(t,...e)}catch(i){this.notificationService.error(i)}}}Pt(".scm-view .scm-editor-container");export{z as ActionButtonRenderer,p as ContextKeys,te as SCMAccessibilityProvider,Zi as SCMActionButton,ee as SCMTreeKeyboardNavigationLabelProvider,Pi as SCMTreeSorter,ue as SCMViewPane};
