var Ot=Object.defineProperty;var Ut=Object.getOwnPropertyDescriptor;var I=(d,t,e,i)=>{for(var o=i>1?void 0:i?Ut(t,e):t,r=d.length-1,n;r>=0;r--)(n=d[r])&&(o=(i?n(t,e,o):n(o))||o);return i&&o&&Ot(t,e,o),o},c=(d,t)=>(e,i)=>t(e,i,d);import"vs/css!./media/scm";import"../../../../../vs/base/browser/dnd.js";import{$ as m,append as h,asCSSUrl as $t,clearNode as qt,Dimension as jt,isActiveElement as Jt,isPointerEvent as Yt,prepend as nt,trackFocus as Qt}from"../../../../../vs/base/browser/dom.js";import{DEFAULT_FONT_FAMILY as Xt}from"../../../../../vs/base/browser/fonts.js";import{ActionBar as Le}from"../../../../../vs/base/browser/ui/actionbar/actionbar.js";import{Button as at,ButtonWithDropdown as Zt}from"../../../../../vs/base/browser/ui/button/button.js";import{AnchorAlignment as ei}from"../../../../../vs/base/browser/ui/contextview/contextview.js";import{CountBadge as dt}from"../../../../../vs/base/browser/ui/countBadge/countBadge.js";import"../../../../../vs/base/browser/ui/hover/hoverDelegate.js";import{createInstantHoverDelegate as ti,getDefaultHoverDelegate as ii}from"../../../../../vs/base/browser/ui/hover/hoverDelegateFactory.js";import{HoverPosition as ye}from"../../../../../vs/base/browser/ui/hover/hoverWidget.js";import{IconLabel as Ae}from"../../../../../vs/base/browser/ui/iconLabel/iconLabel.js";import"../../../../../vs/base/browser/ui/list/list.js";import"../../../../../vs/base/browser/ui/list/listView.js";import"../../../../../vs/base/browser/ui/list/listWidget.js";import"../../../../../vs/base/browser/ui/tree/abstractTree.js";import"../../../../../vs/base/browser/ui/tree/asyncDataTree.js";import"../../../../../vs/base/browser/ui/tree/compressedObjectTreeModel.js";import"../../../../../vs/base/browser/ui/tree/objectTree.js";import"../../../../../vs/base/browser/ui/tree/tree.js";import{Action as We,ActionRunner as ge,Separator as ct}from"../../../../../vs/base/common/actions.js";import{disposableTimeout as oi,Sequencer as ri,ThrottledDelayer as si,Throttler as lt}from"../../../../../vs/base/common/async.js";import{CancellationTokenSource as ni}from"../../../../../vs/base/common/cancellation.js";import{Codicon as ce}from"../../../../../vs/base/common/codicons.js";import{compareFileNames as ke,comparePaths as ut}from"../../../../../vs/base/common/comparers.js";import{fromNow as ai}from"../../../../../vs/base/common/date.js";import{Emitter as Se,Event as A}from"../../../../../vs/base/common/event.js";import{createMatches as K}from"../../../../../vs/base/common/filters.js";import{MarkdownString as pt}from"../../../../../vs/base/common/htmlContent.js";import{stripIcons as mt}from"../../../../../vs/base/common/iconLabels.js";import{Iterable as Z}from"../../../../../vs/base/common/iterator.js";import{KeyCode as di}from"../../../../../vs/base/common/keyCodes.js";import{combinedDisposable as ht,Disposable as Oe,DisposableMap as vt,DisposableStore as S,dispose as ci,MutableDisposable as Ue,toDisposable as yt}from"../../../../../vs/base/common/lifecycle.js";import{Schemas as li}from"../../../../../vs/base/common/network.js";import{clamp as $e,rot as qe}from"../../../../../vs/base/common/numbers.js";import{autorun as gt}from"../../../../../vs/base/common/observable.js";import*as je from"../../../../../vs/base/common/platform.js";import{basename as L,dirname as St}from"../../../../../vs/base/common/resources.js";import{ResourceTree as C}from"../../../../../vs/base/common/resourceTree.js";import{compare as ui,format as pi}from"../../../../../vs/base/common/strings.js";import{ThemeIcon as B}from"../../../../../vs/base/common/themables.js";import{URI as ft}from"../../../../../vs/base/common/uri.js";import"../../../../../vs/editor/browser/config/editorConfiguration.js";import{EditorExtensionsRegistry as mi}from"../../../../../vs/editor/browser/editorExtensions.js";import{CodeEditorWidget as hi}from"../../../../../vs/editor/browser/widget/codeEditor/codeEditorWidget.js";import{MarkdownRenderer as vi,openLinkFromMarkdown as yi}from"../../../../../vs/editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{EditorOption as It,EditorOptions as Ct}from"../../../../../vs/editor/common/config/editorOptions.js";import{EditOperation as gi}from"../../../../../vs/editor/common/core/editOperation.js";import"../../../../../vs/editor/common/core/selection.js";import"../../../../../vs/editor/common/model.js";import{IModelService as Si}from"../../../../../vs/editor/common/services/model.js";import{CodeActionController as fi}from"../../../../../vs/editor/contrib/codeAction/browser/codeActionController.js";import{ColorDetector as Ii}from"../../../../../vs/editor/contrib/colorPicker/browser/colorDetector.js";import{ContextMenuController as Ci}from"../../../../../vs/editor/contrib/contextmenu/browser/contextmenu.js";import{DragAndDropController as bi}from"../../../../../vs/editor/contrib/dnd/browser/dnd.js";import{CopyPasteController as bt}from"../../../../../vs/editor/contrib/dropOrPasteInto/browser/copyPasteController.js";import{DropIntoEditorController as wt}from"../../../../../vs/editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js";import{FormatOnType as wi}from"../../../../../vs/editor/contrib/format/browser/formatActions.js";import{ContentHoverController as Mi}from"../../../../../vs/editor/contrib/hover/browser/contentHoverController2.js";import{MarginHoverController as Ti}from"../../../../../vs/editor/contrib/hover/browser/marginHoverController.js";import{InlineCompletionsController as Ei}from"../../../../../vs/editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js";import{LinkDetector as Ri}from"../../../../../vs/editor/contrib/links/browser/links.js";import{MessageController as Vi}from"../../../../../vs/editor/contrib/message/browser/messageController.js";import{PlaceholderTextContribution as Di}from"../../../../../vs/editor/contrib/placeholderText/browser/placeholderTextContribution.js";import{SnippetController2 as Li}from"../../../../../vs/editor/contrib/snippet/browser/snippetController2.js";import{SuggestController as Ai}from"../../../../../vs/editor/contrib/suggest/browser/suggestController.js";import{localize as v}from"../../../../../vs/nls.js";import{DropdownWithPrimaryActionViewItem as xi}from"../../../../../vs/platform/actions/browser/dropdownWithPrimaryActionViewItem.js";import{createActionViewItem as Hi,createAndFillInActionBarActions as Fi,createAndFillInContextMenuActions as Mt}from"../../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as Je}from"../../../../../vs/platform/actions/browser/toolbar.js";import{Action2 as Tt,IMenuService as xe,MenuId as b,MenuItemAction as le,MenuRegistry as Et,registerAction2 as T}from"../../../../../vs/platform/actions/common/actions.js";import{ICommandService as ue}from"../../../../../vs/platform/commands/common/commands.js";import{ConfigurationTarget as Pi,IConfigurationService as He}from"../../../../../vs/platform/configuration/common/configuration.js";import{ContextKeyExpr as V,IContextKeyService as ee,RawContextKey as N}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as pe,IContextViewService as Ki}from"../../../../../vs/platform/contextview/browser/contextView.js";import{CodeDataTransfers as Bi}from"../../../../../vs/platform/dnd/browser/dnd.js";import{FileKind as me}from"../../../../../vs/platform/files/common/files.js";import{IHoverService as Fe,WorkbenchHoverDelegate as Ni}from"../../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as Ye}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{ServiceCollection as _i}from"../../../../../vs/platform/instantiation/common/serviceCollection.js";import{IKeybindingService as fe}from"../../../../../vs/platform/keybinding/common/keybinding.js";import{ILabelService as Pe}from"../../../../../vs/platform/label/common/label.js";import{WorkbenchCompressibleAsyncDataTree as zi}from"../../../../../vs/platform/list/browser/listService.js";import{INotificationService as Gi}from"../../../../../vs/platform/notification/common/notification.js";import{observableConfigValue as Wi}from"../../../../../vs/platform/observable/common/platformObservableUtils.js";import{IOpenerService as Rt}from"../../../../../vs/platform/opener/common/opener.js";import{IStorageService as Qe,StorageScope as _,StorageTarget as Ke}from"../../../../../vs/platform/storage/common/storage.js";import{ITelemetryService as Be}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{defaultButtonStyles as Vt,defaultCountBadgeStyles as Dt}from"../../../../../vs/platform/theme/browser/defaultStyles.js";import{foreground as ki,listActiveSelectionForeground as Oi,registerColor as Ne,transparent as Lt}from"../../../../../vs/platform/theme/common/colorRegistry.js";import{ColorScheme as Ui}from"../../../../../vs/platform/theme/common/theme.js";import{IThemeService as Xe}from"../../../../../vs/platform/theme/common/themeService.js";import{IUriIdentityService as $i}from"../../../../../vs/platform/uriIdentity/common/uriIdentity.js";import{fillEditorsDragData as qi}from"../../../../../vs/workbench/browser/dnd.js";import{ResourceLabels as ji}from"../../../../../vs/workbench/browser/labels.js";import{API_OPEN_DIFF_EDITOR_COMMAND_ID as At,API_OPEN_EDITOR_COMMAND_ID as Ji}from"../../../../../vs/workbench/browser/parts/editor/editorCommands.js";import{ViewAction as he,ViewPane as Yi}from"../../../../../vs/workbench/browser/parts/views/viewPane.js";import{EditorResourceAccessor as Qi,SideBySideEditor as Xi}from"../../../../../vs/workbench/common/editor.js";import{IViewDescriptorService as Zi,ViewContainerLocation as xt}from"../../../../../vs/workbench/common/views.js";import{EditorDictation as eo}from"../../../../../vs/workbench/contrib/codeEditor/browser/dictation/editorDictation.js";import{MenuPreventer as to}from"../../../../../vs/workbench/contrib/codeEditor/browser/menuPreventer.js";import{SelectionClipboardContributionID as io}from"../../../../../vs/workbench/contrib/codeEditor/browser/selectionClipboard.js";import{getSimpleEditorOptions as oo,setupSimpleEditorSelectionStyling as ro}from"../../../../../vs/workbench/contrib/codeEditor/browser/simpleEditorOptions.js";import{OpenScmGroupAction as so}from"../../../../../vs/workbench/contrib/multiDiffEditor/browser/scmMultiDiffSourceResolver.js";import{historyItemGroupBase as no,historyItemGroupHoverLabelForeground as ao,historyItemGroupLocal as co,historyItemGroupRemote as lo,renderSCMHistoryItemGraph as uo}from"../../../../../vs/workbench/contrib/scm/browser/scmHistory.js";import{RepositoryActionRunner as po,RepositoryRenderer as Ht}from"../../../../../vs/workbench/contrib/scm/browser/scmRepositoryRenderer.js";import{RepositoryContextKeys as mo}from"../../../../../vs/workbench/contrib/scm/browser/scmViewService.js";import"../../../../../vs/workbench/contrib/scm/common/history.js";import{InputValidationType as k,ISCMRepositorySortKey as Ze,ISCMService as Ft,ISCMViewService as z,SCMInputChangeReason as ho,VIEW_PANE_ID as x}from"../../../../../vs/workbench/contrib/scm/common/scm.js";import{IEditorService as vo}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchLayoutService as yo,Position as Pt}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";import{collectContextMenuActions as te,connectPrimaryMenu as Kt,connectPrimaryMenuToInlineActionBar as et,getActionViewItemProvider as tt,isSCMActionButton as G,isSCMHistoryItemChangeNode as O,isSCMHistoryItemChangeTreeElement as Y,isSCMHistoryItemGroupTreeElement as U,isSCMHistoryItemTreeElement as $,isSCMHistoryItemViewModelTreeElement as W,isSCMInput as H,isSCMRepository as M,isSCMResource as D,isSCMResourceGroup as w,isSCMResourceNode as ie,isSCMViewSeparator as ve,isSCMViewService as it,toDiffEditorArguments as go}from"./util.js";const So=Ne("scm.historyItemAdditionsForeground","gitDecoration.addedResourceForeground",v("scm.historyItemAdditionsForeground","History item additions foreground color.")),fo=Ne("scm.historyItemDeletionsForeground","gitDecoration.deletedResourceForeground",v("scm.historyItemDeletionsForeground","History item deletions foreground color."));Ne("scm.historyItemStatisticsBorder",Lt(ki,.2),v("scm.historyItemStatisticsBorder","History item statistics border color.")),Ne("scm.historyItemSelectedStatisticsBorder",Lt(Oi,.2),v("scm.historyItemSelectedStatisticsBorder","History item selected statistics border color."));function Bt(d,t){if(!t)return[void 0,void 0];if(!t.label)return[K(t),void 0];const e=L(d),i=t.label,o=i.length-e.length,r=K(t.score);if(i===e)return[r,void 0];const n=[],s=[];for(const a of r)a.start>o?n.push({start:a.start-o,end:a.end-o}):a.end<o?s.push(a):(n.push({start:0,end:a.end-o}),s.push({start:a.start,end:o}));return[n,s]}let j=class{constructor(t,e,i){this.commandService=t;this.contextMenuService=e;this.notificationService=i}static DEFAULT_HEIGHT=30;static TEMPLATE_ID="actionButton";get templateId(){return j.TEMPLATE_ID}actionButtons=new Map;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("cursor-default","force-no-hover");const e=h(t,m(".button-container")),i=new Wo(e,this.contextMenuService,this.commandService,this.notificationService);return{actionButton:i,disposable:Oe.None,templateDisposable:i}}renderElement(t,e,i,o){i.disposable.dispose();const r=new S,n=t.element;i.actionButton.setButton(t.element.button),this.actionButtons.set(n,i.actionButton),r.add({dispose:()=>this.actionButtons.delete(n)}),i.disposable=r}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}focusActionButton(t){this.actionButtons.get(t)?.focus()}disposeElement(t,e,i){i.disposable.dispose()}disposeTemplate(t){t.disposable.dispose(),t.templateDisposable.dispose()}};j=I([c(0,ue),c(1,pe),c(2,Gi)],j);class st{constructor(t){this.instantiationService=t}getDragURI(t){return D(t)?t.sourceUri.toString():null}onDragStart(t,e){const i=st.getResourcesFromDragAndDropData(t);if(e.dataTransfer&&i?.length){this.instantiationService.invokeFunction(r=>qi(r,i,e));const o=i.filter(r=>r.scheme===li.file).map(r=>r.fsPath);o.length&&e.dataTransfer.setData(Bi.FILES,JSON.stringify(o))}}getDragLabel(t,e){if(t.length===1){const i=t[0];if(D(i))return L(i.sourceUri)}return String(t.length)}onDragOver(t,e,i,o,r){return!0}drop(t,e,i,o,r){}static getResourcesFromDragAndDropData(t){const e=[];for(const i of[...t.context??[],...t.elements])D(i)&&e.push(i.sourceUri);return e}dispose(){}}let F=class{constructor(t,e,i,o){this.outerLayout=t;this.overflowWidgetsDomNode=e;this.updateHeight=i;this.instantiationService=o}static DEFAULT_HEIGHT=26;static TEMPLATE_ID="input";get templateId(){return F.TEMPLATE_ID}inputWidgets=new Map;contentHeights=new WeakMap;editorSelections=new WeakMap;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("force-no-hover");const e=new S,i=h(t,m(".scm-input")),o=this.instantiationService.createInstance(de,i,this.overflowWidgetsDomNode);return e.add(o),{inputWidget:o,inputWidgetHeight:F.DEFAULT_HEIGHT,elementDisposables:new S,templateDisposable:e}}renderElement(t,e,i){const o=t.element;i.inputWidget.input=o,this.inputWidgets.set(o,i.inputWidget),i.elementDisposables.add({dispose:()=>this.inputWidgets.delete(o)});const r=this.editorSelections.get(o);r&&(i.inputWidget.selections=r),i.elementDisposables.add(yt(()=>{const l=i.inputWidget.selections;l&&this.editorSelections.set(o,l)})),i.inputWidgetHeight=F.DEFAULT_HEIGHT;const n=()=>{const l=i.inputWidget.getContentHeight();this.contentHeights.set(o,l),i.inputWidgetHeight!==l&&(this.updateHeight(o,l+10),i.inputWidgetHeight=l,i.inputWidget.layout())};oi(()=>{i.elementDisposables.add(i.inputWidget.onDidChangeContentHeight(n)),n()},0,i.elementDisposables);const a=()=>i.inputWidget.layout();i.elementDisposables.add(this.outerLayout.onDidChange(a)),a()}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.templateDisposable.dispose()}getHeight(t){return(this.contentHeights.get(t)??F.DEFAULT_HEIGHT)+10}getRenderedInputWidget(t){return this.inputWidgets.get(t)}getFocusedInput(){for(const[t,e]of this.inputWidgets)if(e.hasFocus())return t}clearValidation(){for(const[,t]of this.inputWidgets)t.clearValidation()}};F=I([c(3,Ye)],F);let Q=class{constructor(t,e){this.actionViewItemProvider=t;this.scmViewService=e}static TEMPLATE_ID="resource group";get templateId(){return Q.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const e=h(t,m(".resource-group")),i=h(e,m(".name")),o=h(e,m(".actions")),r=new Le(o,{actionViewItemProvider:this.actionViewItemProvider}),n=h(e,m(".count")),s=new dt(n,{},Dt),a=ht(r);return{name:i,count:s,actionBar:r,elementDisposables:new S,disposables:a}}renderElement(t,e,i){const o=t.element;i.name.textContent=o.label,i.actionBar.clear(),i.actionBar.context=o,i.count.setCount(o.resources.length);const r=this.scmViewService.menus.getRepositoryMenus(o.provider);i.elementDisposables.add(et(r.getResourceGroupMenu(o),i.actionBar))}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}};Q=I([c(1,z)],Q);class Nt extends ge{constructor(e){super();this.getSelectedResources=e}async runAction(e,i){if(!(e instanceof le))return super.runAction(e,i);const o=this.getSelectedResources(),s=(o.some(a=>a===i)?o:[i]).map(a=>C.isResourceNode(a)?C.collect(a):[a]).flat();await e.run(...s)}}let X=class{constructor(t,e,i,o,r,n,s){this.viewMode=t;this.labels=e;this.actionViewItemProvider=i;this.actionRunner=o;this.labelService=r;this.scmViewService=n;this.themeService=s;s.onDidColorThemeChange(this.onDidColorThemeChange,this,this.disposables)}static TEMPLATE_ID="resource";get templateId(){return X.TEMPLATE_ID}disposables=new S;renderedResources=new Map;renderTemplate(t){const e=h(t,m(".resource")),i=h(e,m(".name")),o=this.labels.create(i,{supportDescriptionHighlights:!0,supportHighlights:!0}),r=h(o.element,m(".actions")),n=new Le(r,{actionViewItemProvider:this.actionViewItemProvider,actionRunner:this.actionRunner}),s=h(e,m(".decoration-icon")),a=new Ue,l=ht(n,o,a);return{element:e,name:i,fileLabel:o,decorationIcon:s,actionBar:n,actionBarMenu:void 0,actionBarMenuListener:a,elementDisposables:new S,disposables:l}}renderElement(t,e,i){const o=t.element,r=C.isResourceNode(o)?o.element:o,n=C.isResourceNode(o)?o.uri:o.sourceUri,s=C.isResourceNode(o)?me.FOLDER:me.FILE,a=!C.isResourceNode(o)&&o.decorations.tooltip||"",l=this.viewMode()==="tree";let p,u,y;if(C.isResourceNode(o))if(o.element){const E=this.scmViewService.menus.getRepositoryMenus(o.element.resourceGroup.provider);this._renderActionBar(i,o,E.getResourceMenu(o.element)),i.element.classList.toggle("faded",o.element.decorations.faded),y=o.element.decorations.strikeThrough}else{const E=this.scmViewService.menus.getRepositoryMenus(o.context.provider);this._renderActionBar(i,o,E.getResourceFolderMenu(o.context)),p=K(t.filterData),i.element.classList.remove("faded")}else{const E=this.scmViewService.menus.getRepositoryMenus(o.resourceGroup.provider);this._renderActionBar(i,o,E.getResourceMenu(o)),[p,u]=Bt(n,t.filterData),i.element.classList.toggle("faded",o.decorations.faded),y=o.decorations.strikeThrough}const f={tooltip:a,uri:n,fileLabelOptions:{hidePath:l,fileKind:s,matches:p,descriptionMatches:u,strikethrough:y},iconResource:r};this.renderIcon(i,f),this.renderedResources.set(i,f),i.elementDisposables.add(yt(()=>this.renderedResources.delete(i))),i.element.setAttribute("data-tooltip",a)}disposeElement(t,e,i){i.elementDisposables.clear()}renderCompressedElements(t,e,i,o){const r=t.element,n=r.elements[r.elements.length-1],s=r.elements.map(u=>u.name),a=me.FOLDER,l=K(t.filterData);i.fileLabel.setResource({resource:n.uri,name:s},{fileDecorations:{colors:!1,badges:!0},fileKind:a,matches:l,separator:this.labelService.getSeparator(n.uri.scheme)});const p=this.scmViewService.menus.getRepositoryMenus(n.context.provider);this._renderActionBar(i,n,p.getResourceFolderMenu(n.context)),i.name.classList.remove("strike-through"),i.element.classList.remove("faded"),i.decorationIcon.style.display="none",i.decorationIcon.style.backgroundImage="",i.element.setAttribute("data-tooltip","")}disposeCompressedElements(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}_renderActionBar(t,e,i){(!t.actionBarMenu||t.actionBarMenu!==i)&&(t.actionBar.clear(),t.actionBarMenu=i,t.actionBarMenuListener.value=et(i,t.actionBar)),t.actionBar.context=e}onDidColorThemeChange(){for(const[t,e]of this.renderedResources)this.renderIcon(t,e)}renderIcon(t,e){const i=this.themeService.getColorTheme(),o=i.type===Ui.LIGHT?e.iconResource?.decorations.icon:e.iconResource?.decorations.iconDark;t.fileLabel.setFile(e.uri,{...e.fileLabelOptions,fileDecorations:{colors:!1,badges:!o}}),o?(B.isThemeIcon(o)?(t.decorationIcon.className=`decoration-icon ${B.asClassName(o)}`,o.color&&(t.decorationIcon.style.color=i.getColor(o.color.id)?.toString()??""),t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=""):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=$t(o)),t.decorationIcon.title=e.tooltip):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="none",t.decorationIcon.style.backgroundImage="",t.decorationIcon.title="")}dispose(){this.disposables.dispose()}};X=I([c(4,Pe),c(5,z),c(6,Xe)],X);class _t extends ge{runAction(t,e){return t instanceof le?t.run(e.repository.provider,e.id):super.runAction(t,e)}}let oe=class{constructor(t,e,i,o,r,n,s,a){this.actionRunner=t;this.contextKeyService=e;this.contextMenuService=i;this.keybindingService=o;this.commandService=r;this.menuService=n;this.scmViewService=s;this.telemetryService=a}static TEMPLATE_ID="history-item-group";get templateId(){return oe.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const e=h(t,m(".history-item-group")),i=new Ae(e,{supportIcons:!0}),o=nt(i.element,m(".icon-container")),r=new S,n=new Je(h(e,m(".actions")),{actionRunner:this.actionRunner,menuOptions:{shouldForwardArgs:!0}},this.menuService,this.contextKeyService,this.contextMenuService,this.keybindingService,this.commandService,this.telemetryService);r.add(n);const s=h(e,m(".count")),a=new dt(s,{},Dt);return{iconContainer:o,label:i,toolBar:n,count:a,elementDisposables:new S,templateDisposables:r}}renderElement(t,e,i,o){const r=t.element;i.iconContainer.className="icon-container",r.icon&&B.isThemeIcon(r.icon)&&i.iconContainer.classList.add(...B.asClassNameArray(r.icon)),i.label.setLabel(r.label,r.description,{title:r.ariaLabel}),i.count.setCount(r.count??0);const s=this.scmViewService.menus.getRepositoryMenus(r.repository.provider).historyProviderMenu;if(s){const a=s.getHistoryItemGroupMenu(r),l=r.direction==="incoming"?b.SCMIncomingChanges:b.SCMOutgoingChanges;i.elementDisposables.add(Kt(a,(p,u)=>{i.toolBar.setActions(p,u,[l])})),i.toolBar.context=r}else i.toolBar.setActions([],[]),i.toolBar.context=void 0}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.templateDisposables.dispose()}};oe=I([c(1,ee),c(2,pe),c(3,fe),c(4,ue),c(5,xe),c(6,z),c(7,Be)],oe);class zt extends ge{async runAction(t,e){if(!(t instanceof le))return super.runAction(t,e);const i=[];i.push(e.historyItemGroup.repository.provider),i.push({id:e.id,parentIds:e.parentIds,message:e.message,author:e.author,icon:e.icon,timestamp:e.timestamp,statistics:e.statistics}),await t.run(...i)}}class Io extends ge{constructor(e){super();this.getSelectedHistoryItems=e}async runAction(e,i){if(!(e instanceof le))return super.runAction(e,i);const o=[];o.push(i.repository.provider);const r=this.getSelectedHistoryItems();r.some(s=>s===i)&&r.length>1?o.push(...r.map(s=>({id:s.historyItemViewModel.historyItem.id,parentIds:s.historyItemViewModel.historyItem.parentIds,message:s.historyItemViewModel.historyItem.message,author:s.historyItemViewModel.historyItem.author,icon:s.historyItemViewModel.historyItem.icon,timestamp:s.historyItemViewModel.historyItem.timestamp,statistics:s.historyItemViewModel.historyItem.statistics}))):o.push({id:i.historyItemViewModel.historyItem.id,parentIds:i.historyItemViewModel.historyItem.parentIds,message:i.historyItemViewModel.historyItem.message,author:i.historyItemViewModel.historyItem.author,icon:i.historyItemViewModel.historyItem.icon,timestamp:i.historyItemViewModel.historyItem.timestamp,statistics:i.historyItemViewModel.historyItem.statistics}),await e.run(...o)}}let Ie=class extends Ni{constructor(e,i,o,r){super("element",!0,()=>this.getHoverOptions(),o,r);this.viewContainerLocation=e;this.sideBarPosition=i}getHoverOptions(){let e;return this.viewContainerLocation===xt.Sidebar?e=this.sideBarPosition===Pt.LEFT?ye.RIGHT:ye.LEFT:this.viewContainerLocation===xt.AuxiliaryBar?e=this.sideBarPosition===Pt.LEFT?ye.LEFT:ye.RIGHT:e=ye.RIGHT,{additionalClasses:["history-item-hover"],position:{hoverPosition:e,forcePosition:!0}}}};Ie=I([c(2,He),c(3,Fe)],Ie);let re=class{constructor(t,e,i,o){this.actionRunner=t;this.actionViewItemProvider=e;this.hoverService=i;this.scmViewService=o}static TEMPLATE_ID="history-item";get templateId(){return re.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const e=h(t,m(".history-item")),i=new Ae(e,{supportIcons:!0,supportHighlights:!0,supportDescriptionHighlights:!0}),o=nt(i.element,m(".icon-container")),r=new S,n=h(e,m(".actions")),s=new Le(n,{actionRunner:this.actionRunner,actionViewItemProvider:this.actionViewItemProvider});r.add(s);const a=h(e,m(".stats-container")),l=h(a,m(".files-label")),p=h(a,m(".insertions-label")),u=h(a,m(".deletions-label")),y=this.hoverService.setupManagedHover(ii("element"),a,"");return r.add(y),{iconContainer:o,label:i,actionBar:s,statsContainer:a,statsCustomHover:y,filesLabel:l,insertionsLabel:p,deletionsLabel:u,elementDisposables:new S,disposables:r}}renderElement(t,e,i,o){const r=t.element;i.iconContainer.className="icon-container",r.icon&&B.isThemeIcon(r.icon)&&i.iconContainer.classList.add(...B.asClassNameArray(r.icon));const n=this.getTooltip(r),[s,a]=this.processMatches(r,t.filterData);i.label.setLabel(r.message,r.author,{matches:s,descriptionMatches:a,title:n}),i.actionBar.clear(),i.actionBar.context=r;const l=this.scmViewService.menus.getRepositoryMenus(r.historyItemGroup.repository.provider);if(l.historyProviderMenu){const p=l.historyProviderMenu.getHistoryItemMenu(r);i.elementDisposables.add(et(p,i.actionBar))}this.renderStatistics(t,e,i,o)}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}getTooltip(t){const e=new pt("",{isTrusted:!0,supportThemeIcons:!0});if(t.author&&e.appendMarkdown(`$(account) **${t.author}**

`),t.timestamp){const i=new Intl.DateTimeFormat(je.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"});e.appendMarkdown(`$(history) ${i.format(t.timestamp)}

`)}return e.appendMarkdown(t.message),{markdown:e,markdownNotSupportedFallback:t.message}}processMatches(t,e){return e?[t.message===e.label?K(e.score):void 0,t.author===e.label?K(e.score):void 0]:[void 0,void 0]}renderStatistics(t,e,i,o){const r=t.element;if(r.statistics){const s=[r.statistics.files===1?v("fileChanged","{0} file changed",r.statistics.files):v("filesChanged","{0} files changed",r.statistics.files),r.statistics.insertions===1?v("insertion","{0} insertion{1}",r.statistics.insertions,"(+)"):r.statistics.insertions>1?v("insertions","{0} insertions{1}",r.statistics.insertions,"(+)"):"",r.statistics.deletions===1?v("deletion","{0} deletion{1}",r.statistics.deletions,"(-)"):r.statistics.deletions>1?v("deletions","{0} deletions{1}",r.statistics.deletions,"(-)"):""].filter(a=>a!=="").join(", ");i.statsContainer.setAttribute("aria-label",s),i.statsCustomHover.update(s),i.filesLabel.textContent=r.statistics.files.toString(),i.insertionsLabel.textContent=r.statistics.insertions>0?`+${r.statistics.insertions}`:"",i.insertionsLabel.classList.toggle("hidden",r.statistics.insertions===0),i.deletionsLabel.textContent=r.statistics.deletions>0?`-${r.statistics.deletions}`:"",i.deletionsLabel.classList.toggle("hidden",r.statistics.deletions===0)}i.statsContainer.classList.toggle("hidden",r.statistics===void 0)}disposeElement(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.disposables.dispose()}};re=I([c(2,Fe),c(3,z)],re);let se=class{constructor(t,e,i){this.hoverDelegate=t;this.hoverService=e;this.themeService=i}static TEMPLATE_ID="history-item-2";get templateId(){return se.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie");const e=h(t,m(".history-item")),i=h(e,m(".graph-container")),o=new Ae(e,{supportIcons:!0,supportHighlights:!0,supportDescriptionHighlights:!0}),r=h(e,m(".label-container"));return e.appendChild(r),{element:e,graphContainer:i,label:o,labelContainer:r,elementDisposables:new S,disposables:new S}}renderElement(t,e,i,o){const r=t.element.historyItemViewModel,n=r.historyItem,s=this.hoverService.setupManagedHover(this.hoverDelegate,i.element,this.getTooltip(t.element));i.elementDisposables.add(s),i.graphContainer.textContent="",i.graphContainer.appendChild(uo(r));const[a,l]=this.processMatches(r,t.filterData);if(i.label.setLabel(n.message,n.author,{matches:a,descriptionMatches:l}),i.labelContainer.textContent="",n.labels){const p=ti();i.elementDisposables.add(p);for(const u of n.labels)if(u.icon&&B.isThemeIcon(u.icon)){const y=h(i.labelContainer,m("div.label"));y.classList.add(...B.asClassNameArray(u.icon));const f=this.hoverService.setupManagedHover(p,y,u.title);i.elementDisposables.add(f)}}}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}getTooltip(t){const e=this.themeService.getColorTheme(),i=t.historyItemViewModel.historyItem,o=t.repository.provider.historyProvider.get()?.currentHistoryItemGroup?.get(),r=new pt("",{isTrusted:!0,supportThemeIcons:!0});if(i.author){if(r.appendMarkdown(`$(account) **${i.author}**`),i.timestamp){const n=new Intl.DateTimeFormat(je.language,{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"});r.appendMarkdown(`, $(history) ${ai(i.timestamp,!0,!0)} (${n.format(i.timestamp)})`)}r.appendMarkdown(`

`)}if(r.appendMarkdown(`${i.message}

`),i.statistics){if(r.appendMarkdown(`---

`),r.appendMarkdown(`<span>${i.statistics.files===1?v("fileChanged","{0} file changed",i.statistics.files):v("filesChanged","{0} files changed",i.statistics.files)}</span>`),i.statistics.insertions){const n=e.getColor(So);r.appendMarkdown(`,&nbsp;<span style="color:${n};">${i.statistics.insertions===1?v("insertion","{0} insertion{1}",i.statistics.insertions,"(+)"):v("insertions","{0} insertions{1}",i.statistics.insertions,"(+)")}</span>`)}if(i.statistics.deletions){const n=e.getColor(fo);r.appendMarkdown(`,&nbsp;<span style="color:${n};">${i.statistics.deletions===1?v("deletion","{0} deletion{1}",i.statistics.deletions,"(-)"):v("deletions","{0} deletions{1}",i.statistics.deletions,"(-)")}</span>`)}}if(i.labels){const n=e.getColor(co),s=e.getColor(lo),a=e.getColor(no),l=e.getColor(ao);r.appendMarkdown(`

---

`),r.appendMarkdown(i.labels.map(p=>{const u=p.title===o?.name?n:p.title===o?.remote?.name?s:p.title===o?.base?.name?a:void 0,y=B.isThemeIcon(p.icon)?p.icon.id:"";return`<span style="color:${l};background-color:${u};border-radius:2px;">&nbsp;$(${y})&nbsp;${p.title}&nbsp;</span>`}).join("&nbsp;&nbsp;"))}return{markdown:r,markdownNotSupportedFallback:i.message}}processMatches(t,e){return e?[t.historyItem.message===e.label?K(e.score):void 0,t.historyItem.author===e.label?K(e.score):void 0]:[void 0,void 0]}disposeElement(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.disposables.dispose()}};se=I([c(1,Fe),c(2,Xe)],se);let ne=class{constructor(t,e,i){this.viewMode=t;this.labels=e;this.labelService=i}static TEMPLATE_ID="historyItemChange";get templateId(){return ne.TEMPLATE_ID}renderTemplate(t){const e=h(t,m(".change")),i=h(e,m(".name")),o=this.labels.create(i,{supportDescriptionHighlights:!0,supportHighlights:!0}),r=h(e,m(".decoration-icon"));return{element:e,name:i,fileLabel:o,decorationIcon:r,disposables:new S}}renderElement(t,e,i,o){const r=t.element,n=C.isResourceNode(r)?r.element?.uri??r.uri:r.uri,s=C.isResourceNode(r)?me.FOLDER:me.FILE,a=this.viewMode()==="tree";let l,p;C.isResourceNode(r)?r.element||(l=K(t.filterData)):[l,p]=Bt(n,t.filterData),i.fileLabel.setFile(n,{fileDecorations:{colors:!1,badges:!0},fileKind:s,hidePath:a,matches:l,descriptionMatches:p})}renderCompressedElements(t,e,i,o){const r=t.element,n=r.elements[r.elements.length-1],s=r.elements.map(l=>l.name),a=K(t.filterData);i.fileLabel.setResource({resource:n.uri,name:s},{fileDecorations:{colors:!1,badges:!0},fileKind:me.FOLDER,matches:a,separator:this.labelService.getSeparator(n.uri.scheme)})}disposeTemplate(t){t.disposables.dispose()}};ne=I([c(2,Pe)],ne);let ae=class{constructor(t,e,i,o,r,n,s){this.getFilterActions=t;this.contextKeyService=e;this.contextMenuService=i;this.keybindingService=o;this.commandService=r;this.menuService=n;this.telemetryService=s}static TEMPLATE_ID="separator";get templateId(){return ae.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("cursor-default","force-no-hover");const e=new S,i=h(t,m(".separator-container")),o=new Ae(i,{supportIcons:!0});h(i,m(".separator")),e.add(o);const r=new Je(h(i,m(".actions")),void 0,this.menuService,this.contextKeyService,this.contextMenuService,this.keybindingService,this.commandService,this.telemetryService);return e.add(r),{label:o,toolBar:r,elementDisposables:new S,templateDisposables:e}}renderElement(t,e,i,o){const r=t.element.repository.provider,s=r.historyProvider.get()?.currentHistoryItemGroup.get();i.label.setLabel(t.element.label,void 0,{title:t.element.ariaLabel});const a=this.contextKeyService.createOverlay([["scmHistoryItemGroupHasRemote",!!s?.remote]]),l=this.menuService.createMenu(b.SCMChangesSeparator,a);i.elementDisposables.add(Kt(l,(p,u)=>{u.splice(0,0,...this.getFilterActions(t.element.repository),new ct),i.toolBar.setActions(p,u,[b.SCMChangesSeparator])})),i.toolBar.context=r}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.templateDisposables.dispose()}};ae=I([c(1,ee),c(2,pe),c(3,fe),c(4,ue),c(5,xe),c(6,Be)],ae);class Co{constructor(t){this.inputRenderer=t}getHeight(t){return H(t)?this.inputRenderer.getHeight(t):G(t)?j.DEFAULT_HEIGHT+10:22}getTemplateId(t){if(M(t))return Ht.TEMPLATE_ID;if(H(t))return F.TEMPLATE_ID;if(G(t))return j.TEMPLATE_ID;if(w(t))return Q.TEMPLATE_ID;if(D(t)||ie(t))return X.TEMPLATE_ID;if(U(t))return oe.TEMPLATE_ID;if($(t))return re.TEMPLATE_ID;if(W(t))return se.TEMPLATE_ID;if(Y(t)||O(t))return ne.TEMPLATE_ID;if(ve(t))return ae.TEMPLATE_ID;throw new Error("Unknown element")}}class bo{isIncompressible(t){return C.isResourceNode(t)?t.childrenCount===0||!t.parent||!t.parent.parent:!0}}class wo{filter(t){return w(t)?t.resources.length>0||!t.hideWhenEmpty:!0}}class Mo{constructor(t,e){this.viewMode=t;this.viewSortKey=e}compare(t,e){if(M(t)){if(!M(e))throw new Error("Invalid comparison");return 0}if(H(t))return-1;if(H(e))return 1;if(G(t))return-1;if(G(e))return 1;if(w(t))return w(e)?0:-1;if(ve(t))return w(e)?1:-1;if(U(t))return U(e)?0:1;if($(t)){if(!$(e))throw new Error("Invalid comparison");return 0}if(W(t))return W(e)?0:1;if(Y(t)||O(t)){if(this.viewMode()==="list"){if(!Y(e))throw new Error("Invalid comparison");return ut(t.uri.fsPath,e.uri.fsPath)}if(!Y(e)&&!O(e))throw new Error("Invalid comparison");const s=O(t)?t.name:L(t.uri),a=O(e)?e.name:L(e.uri);return ke(s,a)}if(this.viewMode()==="list"){if(this.viewSortKey()==="name"){const l=L(t.sourceUri),p=L(e.sourceUri);return ke(l,p)}if(this.viewSortKey()==="status"){const l=t.decorations.tooltip??"",p=e.decorations.tooltip??"";if(l!==p)return ui(l,p)}const s=t.sourceUri.fsPath,a=e.sourceUri.fsPath;return ut(s,a)}const i=C.isResourceNode(t),o=C.isResourceNode(e);if(i!==o)return i?-1:1;const r=C.isResourceNode(t)?t.name:L(t.sourceUri),n=C.isResourceNode(e)?e.name:L(e.sourceUri);return ke(r,n)}}let Ce=class{constructor(t,e){this.viewMode=t;this.labelService=e}getKeyboardNavigationLabel(t){if(C.isResourceNode(t))return t.name;if(M(t)||H(t)||G(t))return;if(w(t))return t.label;if(U(t))return t.label;if($(t))return[t.message,t.author];if(W(t))return[t.historyItemViewModel.historyItem.message,t.historyItemViewModel.historyItem.author];if(ve(t))return t.label;if(this.viewMode()==="list"){const e=D(t)?t.sourceUri:t.uri;return[L(e),this.labelService.getUriLabel(e,{relative:!0})]}else return L(D(t)?t.sourceUri:t.uri)}getCompressedNodeKeyboardNavigationLabel(t){return t.map(i=>i.name).join("/")}};Ce=I([c(1,Pe)],Ce);function Gt(d){if(M(d))return`repo:${d.provider.id}`;if(H(d))return`input:${d.repository.provider.id}`;if(G(d))return`actionButton:${d.repository.provider.id}`;if(w(d))return`resourceGroup:${d.provider.id}/${d.id}`;if(D(d)){const t=d.resourceGroup;return`resource:${t.provider.id}/${t.id}/${d.sourceUri.toString()}`}else if(ie(d)){const t=d.context;return`folder:${t.provider.id}/${t.id}/$FOLDER/${d.uri.toString()}`}else{if(U(d))return`historyItemGroup:${d.repository.provider.id}/${d.id}`;if($(d)){const t=d.historyItemGroup;return`historyItem:${t.repository.provider.id}/${t.id}/${d.id}/${d.parentIds.join(",")}`}else if(W(d)){const t=d.repository.provider,e=d.historyItemViewModel.historyItem;return`historyItem2:${t.id}/${e.id}/${e.parentIds.join(",")}`}else if(Y(d)){const t=d.historyItem,e=t.historyItemGroup;return`historyItemChange:${e.repository.provider.id}/${e.id}/${t.id}/${d.uri.toString()}`}else if(O(d)){const t=d.context,e=t.historyItemGroup;return`folder:${e.repository.provider.id}/${e.id}/${t.id}/$FOLDER/${d.uri.toString()}`}else{if(ve(d))return`separator:${d.repository.provider.id}`;throw new Error("Invalid tree element")}}}class To{getId(t){return Gt(t)}}let be=class{constructor(t){this.labelService=t}getWidgetAriaLabel(){return v("scm","Source Control Management")}getAriaLabel(t){if(C.isResourceNode(t))return this.labelService.getUriLabel(t.uri,{relative:!0,noPrefix:!0})||t.name;if(M(t))return`${t.provider.name} ${t.provider.label}`;if(H(t))return v("input","Source Control Input");if(G(t))return t.button?.command.title??"";if(w(t))return t.label;if(U(t))return t.ariaLabel??`${t.label.trim()}${t.description?`, ${t.description}`:""}`;if($(t))return`${mt(t.message).trim()}${t.author?`, ${t.author}`:""}`;if(W(t)){const e=t.historyItemViewModel.historyItem;return`${mt(e.message).trim()}${e.author?`, ${e.author}`:""}`}else if(Y(t)){const e=[L(t.uri)],i=this.labelService.getUriLabel(St(t.uri),{relative:!0,noPrefix:!0});return i&&e.push(i),e.join(", ")}else{if(ve(t))return t.ariaLabel??t.label;{const e=[];e.push(L(t.sourceUri)),t.decorations.tooltip&&e.push(t.decorations.tooltip);const i=this.labelService.getUriLabel(St(t.sourceUri),{relative:!0,noPrefix:!0});return i&&e.push(i),e.join(", ")}}}};be=I([c(0,Pe)],be);var Eo=(e=>(e.List="list",e.Tree="tree",e))(Eo||{}),Ro=(i=>(i.Path="path",i.Name="name",i.Status="status",i))(Ro||{});const q={ViewSort:new b("SCMViewSort"),Repositories:new b("SCMRepositories"),ChangesSettings:new b("SCMChangesSettings")},g={SCMViewMode:new N("scmViewMode","list"),SCMViewSortKey:new N("scmViewSortKey","path"),SCMViewAreAllRepositoriesCollapsed:new N("scmViewAreAllRepositoriesCollapsed",!1),SCMViewIsAnyRepositoryCollapsible:new N("scmViewIsAnyRepositoryCollapsible",!1),SCMProvider:new N("scmProvider",void 0),SCMProviderRootUri:new N("scmProviderRootUri",void 0),SCMProviderHasRootUri:new N("scmProviderHasRootUri",void 0),RepositoryCount:new N("scmRepositoryCount",0),RepositoryVisibilityCount:new N("scmRepositoryVisibleCount",0),RepositoryVisibility(d){return new N(`scmRepositoryVisible:${d.provider.id}`,!1)}};Et.appendMenuItem(b.SCMTitle,{title:v("sortAction","View & Sort"),submenu:q.ViewSort,when:V.and(V.equals("view",x),g.RepositoryCount.notEqualsTo(0)),group:"0_view&sort",order:1}),Et.appendMenuItem(q.ViewSort,{title:v("repositories","Repositories"),submenu:q.Repositories,when:V.greater(g.RepositoryCount.key,1),group:"0_repositories"}),T(class extends Tt{constructor(){super({id:"workbench.scm.action.scm.viewChanges",title:v("viewChanges","View Changes"),f1:!1,menu:[{id:b.SCMChangesContext,group:"0_view",when:V.equals("config.multiDiffEditor.experimental.enabled",!0)}]})}async run(d,t,...e){const i=d.get(ue);if(!t||e.length===0)return;const o=e[0],r=e[e.length-1],n=t.historyProvider.get();if(e.length>1){const f=await n?.resolveHistoryItemGroupCommonAncestor2([o.id,r.id]);if(!f||f!==o.id&&f!==r.id)return}const s=r.parentIds.length>0?r.parentIds[0]:void 0,a=await n?.provideHistoryItemChanges(o.id,s);if(!a?.length)return;const l=e.length===1?`${e[0].id.substring(0,8)} - ${e[0].message}`:v("historyItemChangesEditorTitle","All Changes ({0} \u2194 {1})",r.id.substring(0,8),o.id.substring(0,8)),p=t.rootUri,u=p?p.path:t.label,y=ft.from({scheme:"scm-history-item",path:`${u}/${s}..${o.id}`},!0);i.executeCommand("_workbench.openMultiDiffEditor",{title:l,multiDiffSourceUri:y,resources:a})}});class Vo extends Tt{repository;constructor(t){super({id:`workbench.scm.action.toggleRepositoryVisibility.${t.provider.id}`,title:t.provider.name,f1:!1,precondition:V.or(g.RepositoryVisibilityCount.notEqualsTo(1),g.RepositoryVisibility(t).isEqualTo(!1)),toggled:g.RepositoryVisibility(t).isEqualTo(!0),menu:{id:q.Repositories,group:"0_repositories"}}),this.repository=t}run(t){t.get(z).toggleVisibility(this.repository)}}let we=class{constructor(t,e,i){this.contextKeyService=t;this.scmViewService=e;this.repositoryCountContextKey=g.RepositoryCount.bindTo(t),this.repositoryVisibilityCountContextKey=g.RepositoryVisibilityCount.bindTo(t),e.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.disposables),i.onDidAddRepository(this.onDidAddRepository,this,this.disposables),i.onDidRemoveRepository(this.onDidRemoveRepository,this,this.disposables);for(const o of i.repositories)this.onDidAddRepository(o)}items=new Map;repositoryCountContextKey;repositoryVisibilityCountContextKey;disposables=new S;onDidAddRepository(t){const e=T(class extends Vo{constructor(){super(t)}}),i=g.RepositoryVisibility(t).bindTo(this.contextKeyService);i.set(this.scmViewService.isVisible(t)),this.items.set(t,{contextKey:i,dispose(){i.reset(),e.dispose()}}),this.updateRepositoryContextKeys()}onDidRemoveRepository(t){this.items.get(t)?.dispose(),this.items.delete(t),this.updateRepositoryContextKeys()}onDidChangeVisibleRepositories(){let t=0;for(const[e,i]of this.items){const o=this.scmViewService.isVisible(e);i.contextKey.set(o),o&&t++}this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set(t)}updateRepositoryContextKeys(){this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set(Z.reduce(this.items.keys(),(t,e)=>t+(this.scmViewService.isVisible(e)?1:0),0))}dispose(){this.disposables.dispose(),ci(this.items.values()),this.items.clear()}};we=I([c(0,ee),c(1,z),c(2,Ft)],we);class Wt extends he{constructor(t="workbench.scm.action.setListViewMode",e={}){super({id:t,title:v("setListViewMode","View as List"),viewId:x,f1:!1,icon:ce.listTree,toggled:g.SCMViewMode.isEqualTo("list"),menu:{id:q.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="list"}}class Do extends Wt{constructor(){super("workbench.scm.action.setListViewModeNavigation",{id:b.SCMTitle,when:V.and(V.equals("view",x),g.RepositoryCount.notEqualsTo(0),g.SCMViewMode.isEqualTo("tree")),group:"navigation",order:-1e3})}}class kt extends he{constructor(t="workbench.scm.action.setTreeViewMode",e={}){super({id:t,title:v("setTreeViewMode","View as Tree"),viewId:x,f1:!1,icon:ce.listFlat,toggled:g.SCMViewMode.isEqualTo("tree"),menu:{id:q.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="tree"}}class Lo extends kt{constructor(){super("workbench.scm.action.setTreeViewModeNavigation",{id:b.SCMTitle,when:V.and(V.equals("view",x),g.RepositoryCount.notEqualsTo(0),g.SCMViewMode.isEqualTo("list")),group:"navigation",order:-1e3})}}T(Wt),T(kt),T(Do),T(Lo);class ot extends he{constructor(e,i){super({id:`workbench.scm.action.repositories.setSortKey.${e}`,title:i,viewId:x,f1:!1,toggled:mo.RepositorySortKey.isEqualTo(e),menu:[{id:q.Repositories,group:"1_sort"},{id:b.SCMSourceControlTitle,group:"1_sort"}]});this.sortKey=e}runInView(e){e.get(z).toggleSortKey(this.sortKey)}}class Ao extends ot{constructor(){super(Ze.DiscoveryTime,v("repositorySortByDiscoveryTime","Sort by Discovery Time"))}}class xo extends ot{constructor(){super(Ze.Name,v("repositorySortByName","Sort by Name"))}}class Ho extends ot{constructor(){super(Ze.Path,v("repositorySortByPath","Sort by Path"))}}T(Ao),T(xo),T(Ho);class rt extends he{constructor(e,i){super({id:`workbench.scm.action.setSortKey.${e}`,title:i,viewId:x,f1:!1,toggled:g.SCMViewSortKey.isEqualTo(e),precondition:g.SCMViewMode.isEqualTo("list"),menu:{id:q.ViewSort,group:"2_sort"}});this.sortKey=e}async runInView(e,i){i.viewSortKey=this.sortKey}}class Fo extends rt{constructor(){super("name",v("sortChangesByName","Sort Changes by Name"))}}class Po extends rt{constructor(){super("path",v("sortChangesByPath","Sort Changes by Path"))}}class Ko extends rt{constructor(){super("status",v("sortChangesByStatus","Sort Changes by Status"))}}T(Fo),T(Po),T(Ko);class Bo extends he{constructor(){super({id:"workbench.scm.action.collapseAllRepositories",title:v("collapse all","Collapse All Repositories"),viewId:x,f1:!1,icon:ce.collapseAll,menu:{id:b.SCMTitle,group:"navigation",when:V.and(V.equals("view",x),g.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),g.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!1))}})}async runInView(t,e){e.collapseAllRepositories()}}class No extends he{constructor(){super({id:"workbench.scm.action.expandAllRepositories",title:v("expand all","Expand All Repositories"),viewId:x,f1:!1,icon:ce.expandAll,menu:{id:b.SCMTitle,group:"navigation",when:V.and(V.equals("view",x),g.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),g.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!0))}})}async runInView(t,e){e.expandAllRepositories()}}T(Bo),T(No);var _o=(t=>(t.CancelAction="scm.input.cancelAction",t))(_o||{}),zo=(t=>(t.LastActionId="scm.input.lastActionId",t))(zo||{});let Me=class extends ge{constructor(e,i){super();this.input=e;this.storageService=i}_runningActions=new Set;get runningActions(){return this._runningActions}_cts;async runAction(e){try{if(this.runningActions.size!==0&&(this._cts?.cancel(),e.id==="scm.input.cancelAction"))return;const i=[];for(const o of this.input.repository.provider.groups)i.push({resourceGroupId:o.id,resources:[...o.resources.map(r=>r.sourceUri)]});this._runningActions.add(e),this._cts=new ni,await e.run(this.input.repository.provider.rootUri,i,this._cts.token)}finally{this._runningActions.delete(e),this._runningActions.size===0&&this.storageService.store("scm.input.lastActionId",e.id,_.PROFILE,Ke.USER)}}};Me=I([c(1,Qe)],Me);let Te=class extends Je{constructor(e,i,o,r,n,s,a,l,p){super(e,{resetMenu:b.SCMInputBox,...i},o,r,n,a,s,p);this.menuService=o;this.contextKeyService=r;this.storageService=l;this._dropdownAction=new We("scmInputMoreActions",v("scmInputMoreActions","More Actions..."),"codicon-chevron-down"),this._cancelAction=new le({id:"scm.input.cancelAction",title:v("scmInputCancelAction","Cancel"),icon:ce.debugStop},void 0,void 0,void 0,void 0,r,s)}_dropdownActions=[];get dropdownActions(){return this._dropdownActions}_dropdownAction;get dropdownAction(){return this._dropdownAction}_cancelAction;_onDidChange=new Se;onDidChange=this._onDidChange.event;_disposables=this._register(new Ue);setInput(e){this._disposables.value=new S;const i=this.contextKeyService.createOverlay([["scmProvider",e.repository.provider.contextValue],["scmProviderRootUri",e.repository.provider.rootUri?.toString()],["scmProviderHasRootUri",!!e.repository.provider.rootUri]]),o=this._disposables.value.add(this.menuService.createMenu(b.SCMInputBox,i,{emitEventsForSubmenuChanges:!0})),r=()=>e.repository.provider.groups.some(s=>s.resources.length>0),n=()=>{const s=[];Fi(o,{shouldForwardArgs:!0},s);for(const l of s)l.enabled=r();this._dropdownAction.enabled=r();let a;if(s.length===1)a=s[0];else if(s.length>1){const l=this.storageService.get("scm.input.lastActionId",_.PROFILE,"");a=s.find(p=>p.id===l)??s[0]}this._dropdownActions=s.length===1?[]:s,super.setActions(a?[a]:[],[]),this._onDidChange.fire()};this._disposables.value.add(o.onDidChange(()=>n())),this._disposables.value.add(e.repository.provider.onDidChangeResources(()=>n())),this._disposables.value.add(this.storageService.onDidChangeValue(_.PROFILE,"scm.input.lastActionId",this._disposables.value)(()=>n())),this.actionRunner=new Me(e,this.storageService),this._disposables.value.add(this.actionRunner.onWillRun(s=>{this.actionRunner.runningActions.size===0&&(super.setActions([this._cancelAction],[]),this._onDidChange.fire())})),this._disposables.value.add(this.actionRunner.onDidRun(s=>{this.actionRunner.runningActions.size===0&&n()})),n()}};Te=I([c(2,xe),c(3,ee),c(4,pe),c(5,ue),c(6,fe),c(7,Qe),c(8,Be)],Te);class Go{constructor(t,e){this.overflowWidgetsDomNode=t;this.configurationService=e;const i=A.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration("editor.accessibilitySupport")||o.affectsConfiguration("editor.cursorBlinking")||o.affectsConfiguration("editor.fontFamily")||o.affectsConfiguration("editor.rulers")||o.affectsConfiguration("editor.wordWrap")||o.affectsConfiguration("scm.inputFontFamily")||o.affectsConfiguration("scm.inputFontSize"),this._disposables);this._disposables.add(i(()=>this._onDidChange.fire()))}_onDidChange=new Se;onDidChange=this._onDidChange.event;defaultInputFontFamily=Xt;_disposables=new S;getEditorConstructionOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e);return{...oo(this.configurationService),...this._getEditorLanguageConfiguration(),cursorWidth:1,dragAndDrop:!0,dropIntoEditor:{enabled:!0},fontFamily:t,fontSize:e,formatOnType:!0,lineDecorationsWidth:6,lineHeight:i,overflowWidgetsDomNode:this.overflowWidgetsDomNode,padding:{top:2,bottom:2},quickSuggestions:!1,renderWhitespace:"none",scrollbar:{alwaysConsumeMouseWheel:!1,vertical:"hidden"},wrappingIndent:"none",wrappingStrategy:"advanced"}}getEditorOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e),o=this.configurationService.getValue("editor.accessibilitySupport"),r=this.configurationService.getValue("editor.cursorBlinking");return{...this._getEditorLanguageConfiguration(),accessibilitySupport:o,cursorBlinking:r,fontFamily:t,fontSize:e,lineHeight:i}}_getEditorFontFamily(){const t=this.configurationService.getValue("scm.inputFontFamily").trim();return t.toLowerCase()==="editor"?this.configurationService.getValue("editor.fontFamily").trim():t.length!==0&&t.toLowerCase()!=="default"?t:this.defaultInputFontFamily}_getEditorFontSize(){return this.configurationService.getValue("scm.inputFontSize")}_getEditorLanguageConfiguration(){const t=this.configurationService.inspect("editor.rulers",{overrideIdentifier:"scminput"}),e=t.overrideIdentifiers?.includes("scminput")?Ct.rulers.validate(t.value):[],i=this.configurationService.inspect("editor.wordWrap",{overrideIdentifier:"scminput"}),o=i.overrideIdentifiers?.includes("scminput")?Ct.wordWrap.validate(i.value):"on";return{rulers:e,wordWrap:o}}_getEditorLineHeight(t){return Math.round(t*1.5)}dispose(){this._disposables.dispose()}}let de=class{constructor(t,e,i,o,r,n,s,a,l,p,u){this.modelService=o;this.keybindingService=r;this.configurationService=n;this.instantiationService=s;this.scmViewService=a;this.contextViewService=l;this.openerService=p;this.contextMenuService=u;this.element=h(t,m(".scm-editor")),this.editorContainer=h(this.element,m(".scm-editor-container")),this.toolbarContainer=h(this.element,m(".scm-editor-toolbar")),this.contextKeyService=i.createScoped(this.element),this.repositoryIdContextKey=this.contextKeyService.createKey("scmRepository",void 0),this.inputEditorOptions=new Go(e,this.configurationService),this.disposables.add(this.inputEditorOptions.onDidChange(this.onDidChangeEditorOptions,this)),this.disposables.add(this.inputEditorOptions);const y={contributions:mi.getSomeEditorContributions([fi.ID,Ii.ID,Ci.ID,bt.ID,bi.ID,wt.ID,eo.ID,wi.ID,Mi.ID,Ti.ID,Ei.ID,Ri.ID,to.ID,Vi.ID,Di.ID,io,Li.ID,Ai.ID]),isSimpleWidget:!0},f=new _i([ee,this.contextKeyService]),E=s.createChild(f,this.disposables),ze=this.inputEditorOptions.getEditorConstructionOptions();this.inputEditor=E.createInstance(hi,this.editorContainer,ze,y),this.disposables.add(this.inputEditor),this.disposables.add(this.inputEditor.onDidFocusEditorText(()=>{this.input?.repository&&this.scmViewService.focus(this.input.repository),this.element.classList.add("synthetic-focus"),this.renderValidation()})),this.disposables.add(this.inputEditor.onDidBlurEditorText(()=>{this.element.classList.remove("synthetic-focus"),setTimeout(()=>{(!this.validation||!this.validationHasFocus)&&this.clearValidation()},0)})),this.disposables.add(this.inputEditor.onDidBlurEditorWidget(()=>{bt.get(this.inputEditor)?.clearWidgets(),wt.get(this.inputEditor)?.clearWidgets()}));const Ge=this.contextKeyService.createKey("scmInputIsInFirstPosition",!1),P=this.contextKeyService.createKey("scmInputIsInLastPosition",!1);this.disposables.add(this.inputEditor.onDidChangeCursorPosition(({position:R})=>{const J=this.inputEditor._getViewModel(),Re=J.getLineCount(),Ve=J.getLineLength(Re)+1,De=J.coordinatesConverter.convertModelPositionToViewPosition(R);Ge.set(De.lineNumber===1&&De.column===1),P.set(De.lineNumber===Re&&De.column===Ve)})),this.disposables.add(this.inputEditor.onDidScrollChange(R=>{this.toolbarContainer.classList.toggle("scroll-decoration",R.scrollTop>0)})),A.filter(this.configurationService.onDidChangeConfiguration,R=>R.affectsConfiguration("scm.showInputActionButton"))(()=>this.layout(),this,this.disposables),this.onDidChangeContentHeight=A.signal(A.filter(this.inputEditor.onDidContentSizeChange,R=>R.contentHeightChanged,this.disposables)),this.toolbar=E.createInstance(Te,this.toolbarContainer,{actionViewItemProvider:(R,J)=>R instanceof le&&this.toolbar.dropdownActions.length>1?s.createInstance(xi,R,this.toolbar.dropdownAction,this.toolbar.dropdownActions,"",this.contextMenuService,{actionRunner:this.toolbar.actionRunner,hoverDelegate:J.hoverDelegate}):Hi(s,R,J),menuOptions:{shouldForwardArgs:!0}}),this.disposables.add(this.toolbar.onDidChange(()=>this.layout())),this.disposables.add(this.toolbar)}static ValidationTimeouts={[k.Information]:5e3,[k.Warning]:8e3,[k.Error]:1e4};contextKeyService;element;editorContainer;inputEditor;inputEditorOptions;toolbarContainer;toolbar;disposables=new S;model;repositoryIdContextKey;repositoryDisposables=new S;validation;validationContextView;validationHasFocus=!1;_validationTimer;lastLayoutWasTrash=!1;shouldFocusAfterLayout=!1;onDidChangeContentHeight;get input(){return this.model?.input}set input(t){if(t===this.input)return;if(this.clearValidation(),this.element.classList.remove("synthetic-focus"),this.repositoryDisposables.clear(),this.repositoryIdContextKey.set(t?.repository.id),!t){this.inputEditor.setModel(void 0),this.model=void 0;return}const e=t.repository.provider.inputBoxTextModel;this.inputEditor.setModel(e),this.configurationService.getValue("editor.wordBasedSuggestions",{resource:e.uri})!=="off"&&this.configurationService.updateValue("editor.wordBasedSuggestions","off",{resource:e.uri},Pi.MEMORY);const i=new si(200),o=async()=>{const u=this.inputEditor.getSelection()?.getStartPosition(),y=u&&e.getOffsetAt(u),f=e.getValue();this.setValidation(await t.validateInput(f,y||0))},r=()=>i.trigger(o);this.repositoryDisposables.add(i),this.repositoryDisposables.add(this.inputEditor.onDidChangeCursorPosition(r));const n=this.modelService.getCreationOptions(e.getLanguageId(),e.uri,e.isForSimpleWidget),s=A.filter(this.inputEditor.onKeyDown,u=>u.keyCode===di.Enter,this.repositoryDisposables);this.repositoryDisposables.add(s(()=>e.detectIndentation(n.insertSpaces,n.tabSize))),e.setValue(t.value),this.repositoryDisposables.add(t.onDidChange(({value:u,reason:y})=>{const f=e.getValue();if(u===f)return;e.pushStackElement(),e.pushEditOperations(null,[gi.replaceMove(e.getFullModelRange(),u)],()=>[]);const E=y===ho.HistoryPrevious?e.getFullModelRange().getStartPosition():e.getFullModelRange().getEndPosition();this.inputEditor.setPosition(E),this.inputEditor.revealPositionInCenterIfOutsideViewport(E)})),this.repositoryDisposables.add(t.onDidChangeFocus(()=>this.focus())),this.repositoryDisposables.add(t.onDidChangeValidationMessage(u=>this.setValidation(u,{focus:!0,timeout:!0}))),this.repositoryDisposables.add(t.onDidChangeValidateInput(u=>r())),this.repositoryDisposables.add(e.onDidChangeContent(()=>{t.setValue(e.getValue(),!0),r()}));const a=()=>{const u=this.keybindingService.lookupKeybinding("scm.acceptInput"),y=u?u.getLabel():je.isMacintosh?"Cmd+Enter":"Ctrl+Enter",f=pi(t.placeholder,y);this.inputEditor.updateOptions({placeholder:f})};this.repositoryDisposables.add(t.onDidChangePlaceholder(a)),this.repositoryDisposables.add(this.keybindingService.onDidUpdateKeybindings(a)),a();let l="";this.repositoryDisposables.add(gt(u=>{if(!t.visible)return;const y=l;l=t.repository.provider.commitTemplate.read(u);const f=e.getValue();f&&f!==y||e.setValue(l)}));const p=u=>{this.inputEditor.updateOptions({readOnly:!u})};this.repositoryDisposables.add(t.onDidChangeEnablement(u=>p(u))),p(t.enabled),this.toolbar.setInput(t),this.model={input:t,textModel:e}}get selections(){return this.inputEditor.getSelections()}set selections(t){t&&this.inputEditor.setSelections(t)}setValidation(t,e){this._validationTimer&&(clearTimeout(this._validationTimer),this._validationTimer=0),this.validation=t,this.renderValidation(),e?.focus&&!this.hasFocus()&&this.focus(),t&&e?.timeout&&(this._validationTimer=setTimeout(()=>this.setValidation(void 0),de.ValidationTimeouts[t.type]))}getContentHeight(){const t=this.inputEditor.getOption(It.lineHeight),{top:e,bottom:i}=this.inputEditor.getOption(It.padding),o=this.configurationService.getValue("scm.inputMinLineCount"),n=(typeof o=="number"?$e(o,1,50):1)*t+e+i,s=this.configurationService.getValue("scm.inputMaxLineCount"),l=(typeof s=="number"?$e(s,1,50):10)*t+e+i;return $e(this.inputEditor.getContentHeight(),n,l)}layout(){const t=this.getContentHeight(),e=this.getToolbarWidth(),i=new jt(this.element.clientWidth-e,t);if(i.width<0){this.lastLayoutWasTrash=!0;return}this.lastLayoutWasTrash=!1,this.inputEditor.layout(i),this.renderValidation();const o=this.configurationService.getValue("scm.showInputActionButton")===!0;this.toolbarContainer.classList.toggle("hidden",!o||this.toolbar?.isEmpty()===!0),this.shouldFocusAfterLayout&&(this.shouldFocusAfterLayout=!1,this.focus())}focus(){if(this.lastLayoutWasTrash){this.lastLayoutWasTrash=!1,this.shouldFocusAfterLayout=!0;return}this.inputEditor.focus(),this.element.classList.add("synthetic-focus")}hasFocus(){return this.inputEditor.hasTextFocus()}onDidChangeEditorOptions(){this.inputEditor.updateOptions(this.inputEditorOptions.getEditorOptions())}renderValidation(){if(this.clearValidation(),this.element.classList.toggle("validation-info",this.validation?.type===k.Information),this.element.classList.toggle("validation-warning",this.validation?.type===k.Warning),this.element.classList.toggle("validation-error",this.validation?.type===k.Error),!this.validation||!this.inputEditor.hasTextFocus())return;const t=new S;this.validationContextView=this.contextViewService.showContextView({getAnchor:()=>this.element,render:e=>{this.element.style.borderBottomLeftRadius="0",this.element.style.borderBottomRightRadius="0";const i=h(e,m(".scm-editor-validation-container"));i.classList.toggle("validation-info",this.validation.type===k.Information),i.classList.toggle("validation-warning",this.validation.type===k.Warning),i.classList.toggle("validation-error",this.validation.type===k.Error),i.style.width=`${this.element.clientWidth+2}px`;const o=h(i,m(".scm-editor-validation")),r=this.validation.message;if(typeof r=="string")o.textContent=r;else{const l=Qt(o);t.add(l),t.add(l.onDidFocus(()=>this.validationHasFocus=!0)),t.add(l.onDidBlur(()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()}));const u=t.add(this.instantiationService.createInstance(vi,{})).render(r,{actionHandler:{callback:y=>{yi(this.openerService,y,r.isTrusted),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()},disposables:t}});t.add(u),o.appendChild(u.element)}const n=h(i,m(".scm-editor-validation-actions")),s=new Le(n),a=new We("scmInputWidget.validationMessage.close",v("label.close","Close"),B.asClassName(ce.close),!0,()=>{this.contextViewService.hideContextView(),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px"});return t.add(s),s.push(a,{icon:!0,label:!1}),Oe.None},onHide:()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",t.dispose()},anchorAlignment:ei.LEFT})}getToolbarWidth(){const t=this.configurationService.getValue("scm.showInputActionButton");return!this.toolbar||!t||this.toolbar?.isEmpty()===!0?0:this.toolbar.dropdownActions.length===0?26:39}clearValidation(){this.validationContextView?.close(),this.validationContextView=void 0,this.validationHasFocus=!1}dispose(){this.input=void 0,this.repositoryDisposables.dispose(),this.clearValidation(),this.disposables.dispose()}};de=I([c(2,ee),c(3,Si),c(4,fe),c(5,He),c(6,Ye),c(7,z),c(8,Ki),c(9,Rt),c(10,pe)],de);let _e=class extends Yi{constructor(e,i,o,r,n,s,a,l,p,u,y,f,E,ze,Ge,P,R,J,Re){super({...e,titleMenuId:b.SCMTitle},u,f,Ge,P,ze,E,R,y,J,Re);this.commandService=i;this.editorService=o;this.menuService=r;this.scmService=n;this.scmViewService=s;this.storageService=a;this.uriIdentityService=l;this.layoutService=p;this._viewMode=this.getViewMode(),this._viewSortKey=this.getViewSortKey(),this.viewModeContextKey=g.SCMViewMode.bindTo(P),this.viewModeContextKey.set(this._viewMode),this.viewSortKeyContextKey=g.SCMViewSortKey.bindTo(P),this.viewSortKeyContextKey.set(this.viewSortKey),this.areAllRepositoriesCollapsedContextKey=g.SCMViewAreAllRepositoriesCollapsed.bindTo(P),this.isAnyRepositoryCollapsibleContextKey=g.SCMViewIsAnyRepositoryCollapsible.bindTo(P),this.scmProviderContextKey=g.SCMProvider.bindTo(P),this.scmProviderRootUriContextKey=g.SCMProviderRootUri.bindTo(P),this.scmProviderHasRootUriContextKey=g.SCMProviderHasRootUri.bindTo(P),this._onDidLayout=new Se,this.layoutCache={height:void 0,width:void 0,onDidChange:this._onDidLayout.event},this.storageService.onDidChangeValue(_.WORKSPACE,void 0,this.disposables)(Ve=>{switch(Ve.key){case"scm.viewMode":this.viewMode=this.getViewMode();break;case"scm.viewSortKey":this.viewSortKey=this.getViewSortKey();break}},this,this.disposables),this.storageService.onWillSaveState(Ve=>{this.viewMode=this.getViewMode(),this.viewSortKey=this.getViewSortKey(),this.storeTreeViewState()},this,this.disposables),A.any(this.scmService.onDidAddRepository,this.scmService.onDidRemoveRepository)(()=>this._onDidChangeViewWelcomeState.fire(),this,this.disposables),this.disposables.add(this.revealResourceThrottler),this.disposables.add(this.updateChildrenThrottler)}_onDidLayout;layoutCache;treeScrollTop;treeContainer;tree;listLabels;inputRenderer;actionButtonRenderer;_viewMode;get viewMode(){return this._viewMode}set viewMode(e){this._viewMode!==e&&(this._viewMode=e,this.viewSortKey=this.getViewSortKey(),this.updateChildren(),this.onDidActiveEditorChange(),this._onDidChangeViewMode.fire(e),this.viewModeContextKey.set(e),this.updateIndentStyles(this.themeService.getFileIconTheme()),this.storageService.store("scm.viewMode",e,_.WORKSPACE,Ke.USER))}_onDidChangeViewMode=new Se;onDidChangeViewMode=this._onDidChangeViewMode.event;_viewSortKey;get viewSortKey(){return this._viewSortKey}set viewSortKey(e){this._viewSortKey!==e&&(this._viewSortKey=e,this.updateChildren(),this.viewSortKeyContextKey.set(e),this._onDidChangeViewSortKey.fire(e),this._viewMode==="list"&&this.storageService.store("scm.viewSortKey",e,_.WORKSPACE,Ke.USER))}_onDidChangeViewSortKey=new Se;onDidChangeViewSortKey=this._onDidChangeViewSortKey.event;items=new vt;visibilityDisposables=new S;treeOperationSequencer=new ri;revealResourceThrottler=new lt;updateChildrenThrottler=new lt;viewModeContextKey;viewSortKeyContextKey;areAllRepositoriesCollapsedContextKey;isAnyRepositoryCollapsibleContextKey;scmProviderContextKey;scmProviderRootUriContextKey;scmProviderHasRootUriContextKey;disposables=new S;layoutBody(e=this.layoutCache.height,i=this.layoutCache.width){e!==void 0&&(i!==void 0&&super.layoutBody(e,i),this.layoutCache.height=e,this.layoutCache.width=i,this._onDidLayout.fire(),this.treeContainer.style.height=`${e}px`,this.tree.layout(e,i))}renderBody(e){super.renderBody(e),this.treeContainer=h(e,m(".scm-view.show-file-icons")),this.treeContainer.classList.add("file-icon-themable-tree"),this.treeContainer.classList.add("show-file-icons");const i=()=>this.treeContainer.classList.toggle("show-actions",this.configurationService.getValue("scm.alwaysShowActions"));A.filter(this.configurationService.onDidChangeConfiguration,n=>n.affectsConfiguration("scm.alwaysShowActions"),this.disposables)(i,this,this.disposables),i();const o=()=>{const n=this.configurationService.getValue("scm.providerCountBadge");this.treeContainer.classList.toggle("hide-provider-counts",n==="hidden"),this.treeContainer.classList.toggle("auto-provider-counts",n==="auto")};A.filter(this.configurationService.onDidChangeConfiguration,n=>n.affectsConfiguration("scm.providerCountBadge"),this.disposables)(o,this,this.disposables),o();const r=this.loadTreeViewState();this.createTree(this.treeContainer,r),this.onDidChangeBodyVisibility(async n=>{n?this.treeOperationSequencer.queue(async()=>{await this.tree.setInput(this.scmViewService,r),A.filter(this.configurationService.onDidChangeConfiguration,s=>s.affectsConfiguration("scm.alwaysShowRepositories"),this.visibilityDisposables)(()=>{this.updateActions(),this.updateChildren()},this,this.visibilityDisposables),A.filter(this.configurationService.onDidChangeConfiguration,s=>s.affectsConfiguration("scm.inputMinLineCount")||s.affectsConfiguration("scm.inputMaxLineCount")||s.affectsConfiguration("scm.showActionButton"),this.visibilityDisposables)(()=>this.updateChildren(),this,this.visibilityDisposables),this.editorService.onDidActiveEditorChange(this.onDidActiveEditorChange,this,this.visibilityDisposables),this.scmViewService.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.visibilityDisposables),this.onDidChangeVisibleRepositories({added:this.scmViewService.visibleRepositories,removed:Z.empty()}),typeof this.treeScrollTop=="number"&&(this.tree.scrollTop=this.treeScrollTop,this.treeScrollTop=void 0),this.updateRepositoryCollapseAllContextKeys()}):(this.visibilityDisposables.clear(),this.onDidChangeVisibleRepositories({added:Z.empty(),removed:[...this.items.keys()]}),this.treeScrollTop=this.tree.scrollTop,this.updateRepositoryCollapseAllContextKeys())},this,this.disposables),this.disposables.add(this.instantiationService.createInstance(we)),this.themeService.onDidFileIconThemeChange(this.updateIndentStyles,this,this.disposables),this.updateIndentStyles(this.themeService.getFileIconTheme())}createTree(e,i){const o=m(".scm-overflow-widgets-container.monaco-editor");this.inputRenderer=this.instantiationService.createInstance(F,this.layoutCache,o,(u,y)=>{try{this.tree.updateElementHeight(u,y)}catch{}}),this.actionButtonRenderer=this.instantiationService.createInstance(j),this.listLabels=this.instantiationService.createInstance(ji,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.disposables.add(this.listLabels);const r=new Nt(()=>this.getSelectedResources());r.onWillRun(()=>this.tree.domFocus(),this,this.disposables),this.disposables.add(r);const n=new _t;n.onWillRun(()=>this.tree.domFocus(),this,this.disposables),this.disposables.add(n);const s=new zt;s.onWillRun(()=>this.tree.domFocus(),this,this.disposables),this.disposables.add(s);const a=this.instantiationService.createInstance(Ie,this.viewDescriptorService.getViewLocationById(this.id),this.layoutService.getSideBarPosition());this.disposables.add(a);const l=this.instantiationService.createInstance(Ee,()=>this.viewMode);this.disposables.add(l);const p=Wi("scm.compactFolders",!0,this.configurationService);this.tree=this.instantiationService.createInstance(zi,"SCM Tree Repo",e,new Co(this.inputRenderer),new bo,[this.inputRenderer,this.actionButtonRenderer,this.instantiationService.createInstance(Ht,b.SCMTitle,tt(this.instantiationService)),this.instantiationService.createInstance(Q,tt(this.instantiationService)),this.instantiationService.createInstance(X,()=>this.viewMode,this.listLabels,tt(this.instantiationService),r)],l,{horizontalScrolling:!1,setRowLineHeight:!1,transformOptimization:!1,filter:new wo,dnd:new st(this.instantiationService),identityProvider:new To,sorter:new Mo(()=>this.viewMode,()=>this.viewSortKey),keyboardNavigationLabelProvider:this.instantiationService.createInstance(Ce,()=>this.viewMode),overrideStyles:this.getLocationBasedColors().listOverrideStyles,compressionEnabled:p.get(),collapseByDefault:u=>M(u)||w(u)||ie(u)||O(u)?!1:(i?.expanded??[]).indexOf(Gt(u))===-1,accessibilityProvider:this.instantiationService.createInstance(be)}),this.disposables.add(this.tree),this.tree.onDidOpen(this.open,this,this.disposables),this.tree.onContextMenu(this.onListContextMenu,this,this.disposables),this.tree.onDidScroll(this.inputRenderer.clearValidation,this.inputRenderer,this.disposables),A.filter(this.tree.onDidChangeCollapseState,u=>M(u.node.element?.element),this.disposables)(this.updateRepositoryCollapseAllContextKeys,this,this.disposables),this.disposables.add(gt(u=>{this.tree.updateOptions({compressionEnabled:p.read(u)})})),h(e,o)}async open(e){if(e.element){if(M(e.element)){this.scmViewService.focus(e.element);return}else if(H(e.element)){this.scmViewService.focus(e.element.repository);const i=this.inputRenderer.getRenderedInputWidget(e.element);if(i){i.focus(),this.tree.setFocus([],e.browserEvent);const o=this.tree.getSelection();o.length===1&&o[0]===e.element&&setTimeout(()=>this.tree.setSelection([]))}return}else if(G(e.element)){this.scmViewService.focus(e.element.repository),this.actionButtonRenderer.focusActionButton(e.element),this.tree.setFocus([],e.browserEvent);return}else if(w(e.element)){const i=e.element.provider,o=Z.find(this.scmService.repositories,r=>r.provider===i);o&&this.scmViewService.focus(o);return}else if(D(e.element)){if(e.element.command?.id===Ji||e.element.command?.id===At)if(Yt(e.browserEvent)&&e.browserEvent.button===1){const r=e.element.resourceGroup,n=`${r.provider.label}: ${r.label}`;await so.openMultiFileDiffEditor(this.editorService,n,r.provider.rootUri,r.id,{...e.editorOptions,viewState:{revealData:{resource:{original:e.element.multiDiffEditorOriginalUri,modified:e.element.multiDiffEditorModifiedUri}}},preserveFocus:!0})}else await this.commandService.executeCommand(e.element.command.id,...e.element.command.arguments||[],e);else if(await e.element.open(!!e.editorOptions.preserveFocus),e.editorOptions.pinned){const r=this.editorService.activeEditorPane;r?.group.pinEditor(r.input)}const i=e.element.resourceGroup.provider,o=Z.find(this.scmService.repositories,r=>r.provider===i);o&&this.scmViewService.focus(o)}else if(ie(e.element)){const i=e.element.context.provider,o=Z.find(this.scmService.repositories,r=>r.provider===i);o&&this.scmViewService.focus(o);return}else if(U(e.element)){this.scmViewService.focus(e.element.repository);return}else if($(e.element)){this.scmViewService.focus(e.element.historyItemGroup.repository);return}else if(W(e.element)){const i=e.element.historyItemViewModel.historyItem,o=i.parentIds.length>0?i.parentIds[0]:void 0,n=await e.element.repository.provider.historyProvider.get()?.provideHistoryItemChanges(i.id,o);if(n){const s=`${i.id.substring(0,8)} - ${i.message}`,a=e.element.repository.provider.rootUri,l=a?a.path:e.element.repository.provider.label,p=ft.from({scheme:"scm-history-item",path:`${l}/${o}..${i.id}`},!0);await this.commandService.executeCommand("_workbench.openMultiDiffEditor",{title:s,multiDiffSourceUri:p,resources:n})}this.scmViewService.focus(e.element.repository);return}else if(Y(e.element)){e.element.originalUri&&e.element.modifiedUri&&await this.commandService.executeCommand(At,...go(e.element.uri,e.element.originalUri,e.element.modifiedUri),e),this.scmViewService.focus(e.element.historyItem.historyItemGroup.repository);return}else if(O(e.element)){this.scmViewService.focus(e.element.context.historyItemGroup.repository);return}}else return}onDidActiveEditorChange(){if(!this.configurationService.getValue("scm.autoReveal"))return;const e=Qi.getOriginalUri(this.editorService.activeEditor,{supportSideBySide:Xi.PRIMARY});e&&(this.tree.getFocus().some(i=>D(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))&&this.tree.getSelection().some(i=>D(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))||this.revealResourceThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{for(const i of this.scmViewService.visibleRepositories)if(this.items.get(i))for(let r=i.provider.groups.length-1;r>=0;r--){const n=i.provider.groups[r],s=this.viewMode==="tree"?n.resourceTree.getNode(e)?.element:n.resources.find(a=>this.uriIdentityService.extUri.isEqual(a.sourceUri,e));if(s){await this.tree.expandTo(s),this.tree.reveal(s),this.tree.setSelection([s]),this.tree.setFocus([s]);return}}})))}onDidChangeVisibleRepositories({added:e,removed:i}){for(const o of e){const r=new S;r.add(o.provider.onDidChange(()=>this.updateChildren(o))),r.add(o.input.onDidChangeVisibility(()=>this.updateChildren(o))),r.add(o.provider.onDidChangeResourceGroups(()=>this.updateChildren(o)));const n=r.add(new vt),s=()=>{for(const[a]of n)o.provider.groups.includes(a)||n.deleteAndDispose(a);for(const a of o.provider.groups)if(!n.has(a)){const l=new S;l.add(a.onDidChange(()=>this.updateChildren(o))),l.add(a.onDidChangeResources(()=>this.updateChildren(o))),n.set(a,l)}};r.add(o.provider.onDidChangeResourceGroups(s)),s(),this.items.set(o,r)}for(const o of i)this.items.deleteAndDispose(o);this.updateChildren(),this.onDidActiveEditorChange()}onListContextMenu(e){if(!e.element){const s=this.menuService.getMenuActions(q.ViewSort,this.contextKeyService),a=[];return Mt(s,a),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>a,onHide:()=>{}})}const i=e.element;let o=i,r=[],n=new Nt(()=>this.getSelectedResources());if(M(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.provider).repositoryContextMenu;o=i.provider,n=new po(()=>this.getSelectedRepositories()),r=te(a)}else if(!(H(i)||G(i))){if(w(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.provider).getResourceGroupMenu(i);r=te(a)}else if(D(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.resourceGroup.provider).getResourceMenu(i);r=te(a)}else if(ie(i))if(i.element){const a=this.scmViewService.menus.getRepositoryMenus(i.element.resourceGroup.provider).getResourceMenu(i.element);r=te(a)}else{const a=this.scmViewService.menus.getRepositoryMenus(i.context.provider).getResourceFolderMenu(i.context);r=te(a)}else if(U(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.repository.provider).historyProviderMenu?.getHistoryItemGroupContextMenu(i);a&&(n=new _t,Mt(a,{shouldForwardArgs:!0},r))}else if($(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.historyItemGroup.repository.provider).historyProviderMenu?.getHistoryItemMenu(i);a&&(n=new zt,r=te(a))}else if(W(i)){const a=this.scmViewService.menus.getRepositoryMenus(i.repository.provider).historyProviderMenu?.getHistoryItemMenu2(i);a&&(n=new Io(()=>this.getSelectedHistoryItems()),r=te(a))}}n.onWillRun(()=>this.tree.domFocus()),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>r,getActionsContext:()=>o,actionRunner:n})}getSelectedRepositories(){const e=this.tree.getFocus().filter(o=>!!o&&M(o)),i=this.tree.getSelection().filter(o=>!!o&&M(o));return Array.from(new Set([...e,...i]))}getSelectedResources(){return this.tree.getSelection().filter(e=>!!e&&!w(e))}getSelectedHistoryItems(){return this.tree.getSelection().filter(e=>!!e&&W(e))}getViewMode(){let e=this.configurationService.getValue("scm.defaultViewMode")==="list"?"list":"tree";const i=this.storageService.get("scm.viewMode",_.WORKSPACE);return typeof i=="string"&&(e=i),e}getViewSortKey(){if(this._viewMode==="tree")return"path";let e;switch(this.configurationService.getValue("scm.defaultViewSortKey")){case"name":e="name";break;case"status":e="status";break;default:e="path";break}const o=this.storageService.get("scm.viewSortKey",_.WORKSPACE);return typeof o=="string"&&(e=o),e}loadTreeViewState(){const e=this.storageService.get("scm.viewState2",_.WORKSPACE);if(e)try{return JSON.parse(e)}catch{return}}storeTreeViewState(){this.tree&&this.storageService.store("scm.viewState2",JSON.stringify(this.tree.getViewState()),_.WORKSPACE,Ke.MACHINE)}updateChildren(e){this.updateChildrenThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{const i=this.inputRenderer.getFocusedInput();e&&this.tree.hasNode(e)?await this.tree.updateChildren(e):await this.tree.updateChildren(void 0),i&&this.inputRenderer.getRenderedInputWidget(i)?.focus(),this.updateScmProviderContextKeys(),this.updateRepositoryCollapseAllContextKeys()}))}updateIndentStyles(e){this.treeContainer.classList.toggle("list-view-mode",this.viewMode==="list"),this.treeContainer.classList.toggle("tree-view-mode",this.viewMode==="tree"),this.treeContainer.classList.toggle("align-icons-and-twisties",this.viewMode==="list"&&e.hasFileIcons||e.hasFileIcons&&!e.hasFolderIcons),this.treeContainer.classList.toggle("hide-arrows",this.viewMode==="tree"&&e.hidesExplorerArrows===!0)}updateScmProviderContextKeys(){if(!this.configurationService.getValue("scm.alwaysShowRepositories")&&this.items.size===1){const i=Z.first(this.items.keys()).provider;this.scmProviderContextKey.set(i.contextValue),this.scmProviderRootUriContextKey.set(i.rootUri?.toString()),this.scmProviderHasRootUriContextKey.set(!!i.rootUri)}else this.scmProviderContextKey.set(void 0),this.scmProviderRootUriContextKey.set(void 0),this.scmProviderHasRootUriContextKey.set(!1)}updateRepositoryCollapseAllContextKeys(){if(!this.isBodyVisible()||this.items.size===1){this.isAnyRepositoryCollapsibleContextKey.set(!1),this.areAllRepositoriesCollapsedContextKey.set(!1);return}this.isAnyRepositoryCollapsibleContextKey.set(this.scmViewService.visibleRepositories.some(e=>this.tree.hasNode(e)&&this.tree.isCollapsible(e))),this.areAllRepositoriesCollapsedContextKey.set(this.scmViewService.visibleRepositories.every(e=>this.tree.hasNode(e)&&(!this.tree.isCollapsible(e)||this.tree.isCollapsed(e))))}collapseAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.collapse(e)}expandAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.expand(e)}focusPreviousInput(){this.treeOperationSequencer.queue(()=>this.focusInput(-1))}focusNextInput(){this.treeOperationSequencer.queue(()=>this.focusInput(1))}async focusInput(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;let i=this.scmViewService.focusedRepository.input;const o=this.scmViewService.visibleRepositories;if(!(o.length===1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0)){if(o.length>1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0){const r=o.indexOf(this.scmViewService.focusedRepository),n=qe(r+e,o.length);i=o[n].input}await this.tree.expandTo(i),this.tree.reveal(i),this.inputRenderer.getRenderedInputWidget(i)?.focus()}}focusPreviousResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(-1))}focusNextResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(1))}async focusResourceGroup(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;const i=Jt(this.tree.getHTMLElement()),o=this.scmViewService.focusedRepository.provider.groups,r=this.tree.getFocus().find(a=>w(a)),n=i&&r?o.indexOf(r):-1;let s;if(n===-1){for(const a of o)if(this.tree.hasNode(a)){s=a;break}}else{let a=qe(n+e,o.length);for(;a!==n;){if(this.tree.hasNode(o[a])){s=o[a];break}a=qe(a+e,o.length)}}s&&(await this.tree.expandTo(s),this.tree.reveal(s),this.tree.setSelection([s]),this.tree.setFocus([s]),this.tree.domFocus())}shouldShowWelcome(){return this.scmService.repositoryCount===0}getActionsContext(){return this.scmViewService.visibleRepositories.length===1?this.scmViewService.visibleRepositories[0].provider:void 0}focus(){super.focus(),this.treeOperationSequencer.queue(()=>new Promise(e=>{if(this.isExpanded()){if(this.tree.getFocus().length===0)for(const i of this.scmViewService.visibleRepositories){const o=this.inputRenderer.getRenderedInputWidget(i.input);if(o){o.focus(),e();return}}this.tree.domFocus(),e()}}))}dispose(){this.visibilityDisposables.dispose(),this.disposables.dispose(),this.items.dispose(),super.dispose()}};_e=I([c(1,ue),c(2,vo),c(3,xe),c(4,Ft),c(5,z),c(6,Qe),c(7,$i),c(8,yo),c(9,fe),c(10,Xe),c(11,pe),c(12,Ye),c(13,Zi),c(14,He),c(15,ee),c(16,Rt),c(17,Be),c(18,Fe)],_e);let Ee=class extends Oe{constructor(e,i,o){super();this.viewMode=e;this.configurationService=i;this.scmViewService=o}async getChildren(e){const i=this.scmViewService.visibleRepositories.length,o=this.configurationService.getValue("scm.showActionButton")===!0,r=this.configurationService.getValue("scm.alwaysShowRepositories")===!0;if(it(e)&&(i>1||r))return this.scmViewService.visibleRepositories;if(it(e)&&i===1&&!r||M(e)){const n=[];e=M(e)?e:this.scmViewService.visibleRepositories[0];const s=e.provider.actionButton,a=e.provider.groups;return e.input.visible&&n.push(e.input),o&&s&&n.push({type:"actionButton",repository:e,button:s}),(a.some(p=>p.resources.length>0)||i===1&&(!o||!s))&&n.push(...a),n}else if(w(e)){if(this.viewMode()==="list")return e.resources;if(this.viewMode()==="tree"){const n=[];for(const s of e.resourceTree.root.children)n.push(s.element&&s.childrenCount===0?s.element:s);return n}}else if(ie(e)||O(e)){const n=[];for(const s of e.children)n.push(s.element&&s.childrenCount===0?s.element:s);return n}return[]}getParent(e){if(ie(e)){if(e.parent===e.context.resourceTree.root)return e.context;if(e.parent)return e.parent;throw new Error("Invalid element passed to getParent")}else if(D(e)){if(this.viewMode()==="list")return e.resourceGroup;const o=e.resourceGroup.resourceTree.getNode(e.sourceUri)?.parent;if(!o)throw new Error("Invalid element passed to getParent");return o===e.resourceGroup.resourceTree.root?e.resourceGroup:o}else{if(H(e))return e.repository;if(w(e)){const i=this.scmViewService.visibleRepositories.find(o=>o.provider===e.provider);if(!i)throw new Error("Invalid element passed to getParent");return i}else throw new Error("Unexpected call to getParent")}}hasChildren(e){if(it(e))return this.scmViewService.visibleRepositories.length!==0;if(M(e))return!0;if(H(e))return!1;if(G(e))return!1;if(w(e))return!0;if(D(e))return!1;if(C.isResourceNode(e))return e.childrenCount>0;if(U(e))return!0;if($(e))return!0;if(W(e))return!1;if(Y(e))return!1;if(ve(e))return!1;throw new Error("hasChildren not implemented.")}};Ee=I([c(1,He),c(2,z)],Ee);class Wo{constructor(t,e,i,o){this.container=t;this.contextMenuService=e;this.commandService=i;this.notificationService=o}button;disposables=new Ue;dispose(){this.disposables?.dispose()}setButton(t){if(this.clear(),!!t){if(t.secondaryCommands?.length){const e=[];for(let i=0;i<t.secondaryCommands.length;i++){const o=t.secondaryCommands[i];for(const r of o)e.push(new We(r.id,r.title,void 0,!0,async()=>await this.executeCommand(r.id,...r.arguments||[])));o.length&&e.push(new ct)}e.pop(),this.button=new Zt(this.container,{actions:e,addPrimaryActionToDropdown:!1,contextMenuProvider:this.contextMenuService,title:t.command.tooltip,supportIcons:!0,...Vt})}else this.button=new at(this.container,{supportIcons:!0,supportShortLabel:!!t.description,title:t.command.tooltip,...Vt});this.button.enabled=t.enabled,this.button.label=t.command.title,this.button instanceof at&&t.description&&(this.button.labelShort=t.description),this.button.onDidClick(async()=>await this.executeCommand(t.command.id,...t.command.arguments||[]),null,this.disposables.value),this.disposables.value.add(this.button)}}focus(){this.button?.focus()}clear(){this.disposables.value=new S,this.button=void 0,qt(this.container)}async executeCommand(t,...e){try{await this.commandService.executeCommand(t,...e)}catch(i){this.notificationService.error(i)}}}ro(".scm-view .scm-editor-container");export{j as ActionButtonRenderer,g as ContextKeys,be as SCMAccessibilityProvider,Wo as SCMActionButton,Ce as SCMTreeKeyboardNavigationLabelProvider,Mo as SCMTreeSorter,_e as SCMViewPane};
