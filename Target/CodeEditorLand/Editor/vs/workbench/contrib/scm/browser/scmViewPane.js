var at=Object.defineProperty;var ct=Object.getOwnPropertyDescriptor;var R=(c,t,e,i)=>{for(var o=i>1?void 0:i?ct(t,e):t,s=c.length-1,a;s>=0;s--)(a=c[s])&&(o=(i?a(t,e,o):a(o))||o);return i&&o&&at(t,e,o),o},d=(c,t)=>(e,i)=>t(e,i,c);import"./media/scm.css";import"../../../../base/browser/dnd.js";import{$ as m,append as v,asCSSUrl as dt,clearNode as lt,Dimension as ut,isActiveElement as pt,isPointerEvent as ht,trackFocus as mt}from"../../../../base/browser/dom.js";import{DEFAULT_FONT_FAMILY as vt}from"../../../../base/browser/fonts.js";import{ActionBar as me}from"../../../../base/browser/ui/actionbar/actionbar.js";import{Button as Pe,ButtonWithDropdown as gt}from"../../../../base/browser/ui/button/button.js";import{AnchorAlignment as St}from"../../../../base/browser/ui/contextview/contextview.js";import{CountBadge as ft}from"../../../../base/browser/ui/countBadge/countBadge.js";import"../../../../base/browser/ui/list/list.js";import"../../../../base/browser/ui/list/listView.js";import"../../../../base/browser/ui/list/listWidget.js";import"../../../../base/browser/ui/tree/abstractTree.js";import"../../../../base/browser/ui/tree/asyncDataTree.js";import"../../../../base/browser/ui/tree/compressedObjectTreeModel.js";import"../../../../base/browser/ui/tree/objectTree.js";import"../../../../base/browser/ui/tree/tree.js";import{Action as ve,ActionRunner as Be,Separator as yt}from"../../../../base/common/actions.js";import{disposableTimeout as Ct,Sequencer as It,ThrottledDelayer as wt,Throttler as _e}from"../../../../base/common/async.js";import{CancellationTokenSource as bt}from"../../../../base/common/cancellation.js";import{Codicon as J}from"../../../../base/common/codicons.js";import{compareFileNames as Ne,comparePaths as Mt}from"../../../../base/common/comparers.js";import{Emitter as X,Event as E}from"../../../../base/common/event.js";import{createMatches as ce}from"../../../../base/common/filters.js";import{Iterable as q}from"../../../../base/common/iterator.js";import{KeyCode as Rt}from"../../../../base/common/keyCodes.js";import{combinedDisposable as He,Disposable as ge,DisposableMap as We,DisposableStore as S,dispose as Tt,MutableDisposable as Se,toDisposable as ze}from"../../../../base/common/lifecycle.js";import{Schemas as Vt}from"../../../../base/common/network.js";import{clamp as fe,rot as ye}from"../../../../base/common/numbers.js";import{autorun as Oe}from"../../../../base/common/observable.js";import*as Dt from"../../../../base/common/platform.js";import{basename as N,dirname as Et}from"../../../../base/common/resources.js";import{ResourceTree as C}from"../../../../base/common/resourceTree.js";import{compare as At,format as xt}from"../../../../base/common/strings.js";import{ThemeIcon as Ce}from"../../../../base/common/themables.js";import"../../../../base/common/uri.js";import"../../../../editor/browser/config/editorConfiguration.js";import{EditorExtensionsRegistry as Lt}from"../../../../editor/browser/editorExtensions.js";import{CodeEditorWidget as Kt}from"../../../../editor/browser/widget/codeEditor/codeEditorWidget.js";import{MarkdownRenderer as Ft,openLinkFromMarkdown as Pt}from"../../../../editor/browser/widget/markdownRenderer/browser/markdownRenderer.js";import{EditorOption as Ue,EditorOptions as ke}from"../../../../editor/common/config/editorOptions.js";import{EditOperation as Bt}from"../../../../editor/common/core/editOperation.js";import"../../../../editor/common/core/selection.js";import"../../../../editor/common/model.js";import{IModelService as _t}from"../../../../editor/common/services/model.js";import{CodeActionController as Nt}from"../../../../editor/contrib/codeAction/browser/codeActionController.js";import{ColorDetector as Ht}from"../../../../editor/contrib/colorPicker/browser/colorDetector.js";import{ContextMenuController as Wt}from"../../../../editor/contrib/contextmenu/browser/contextmenu.js";import{DragAndDropController as zt}from"../../../../editor/contrib/dnd/browser/dnd.js";import{CopyPasteController as Ge}from"../../../../editor/contrib/dropOrPasteInto/browser/copyPasteController.js";import{DropIntoEditorController as qe}from"../../../../editor/contrib/dropOrPasteInto/browser/dropIntoEditorController.js";import{FormatOnType as Ot}from"../../../../editor/contrib/format/browser/formatActions.js";import{ContentHoverController as Ut}from"../../../../editor/contrib/hover/browser/contentHoverController.js";import{GlyphHoverController as kt}from"../../../../editor/contrib/hover/browser/glyphHoverController.js";import{InlineCompletionsController as Gt}from"../../../../editor/contrib/inlineCompletions/browser/controller/inlineCompletionsController.js";import{LinkDetector as qt}from"../../../../editor/contrib/links/browser/links.js";import{MessageController as $t}from"../../../../editor/contrib/message/browser/messageController.js";import{PlaceholderTextContribution as jt}from"../../../../editor/contrib/placeholderText/browser/placeholderTextContribution.js";import{SnippetController2 as Jt}from"../../../../editor/contrib/snippet/browser/snippetController2.js";import{SuggestController as Yt}from"../../../../editor/contrib/suggest/browser/suggestController.js";import{localize as f}from"../../../../nls.js";import{DropdownWithPrimaryActionViewItem as Qt}from"../../../../platform/actions/browser/dropdownWithPrimaryActionViewItem.js";import{createActionViewItem as Xt,createAndFillInActionBarActions as Zt,createAndFillInContextMenuActions as ei}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as ti}from"../../../../platform/actions/browser/toolbar.js";import{Action2 as ii,IMenuService as $e,MenuId as T,MenuItemAction as Ie,MenuRegistry as je,registerAction2 as V}from"../../../../platform/actions/common/actions.js";import{ICommandService as we}from"../../../../platform/commands/common/commands.js";import{ConfigurationTarget as oi,IConfigurationService as be}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as D,IContextKeyService as Z,RawContextKey as P}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as de,IContextViewService as si}from"../../../../platform/contextview/browser/contextView.js";import{CodeDataTransfers as ri}from"../../../../platform/dnd/browser/dnd.js";import{FileKind as Me}from"../../../../platform/files/common/files.js";import{IHoverService as ni}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as Re}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as ai}from"../../../../platform/instantiation/common/serviceCollection.js";import{IKeybindingService as Te}from"../../../../platform/keybinding/common/keybinding.js";import{ILabelService as Ve}from"../../../../platform/label/common/label.js";import{WorkbenchCompressibleAsyncDataTree as ci}from"../../../../platform/list/browser/listService.js";import{INotificationService as di}from"../../../../platform/notification/common/notification.js";import{observableConfigValue as li}from"../../../../platform/observable/common/platformObservableUtils.js";import{IOpenerService as Je}from"../../../../platform/opener/common/opener.js";import{IStorageService as De,StorageScope as B,StorageTarget as le}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as Ye}from"../../../../platform/telemetry/common/telemetry.js";import{defaultButtonStyles as Qe,defaultCountBadgeStyles as ui}from"../../../../platform/theme/browser/defaultStyles.js";import{ColorScheme as pi}from"../../../../platform/theme/common/theme.js";import{IThemeService as Xe}from"../../../../platform/theme/common/themeService.js";import{IUriIdentityService as hi}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{fillEditorsDragData as mi}from"../../../browser/dnd.js";import{ResourceLabels as vi}from"../../../browser/labels.js";import{API_OPEN_DIFF_EDITOR_COMMAND_ID as gi,API_OPEN_EDITOR_COMMAND_ID as Si}from"../../../browser/parts/editor/editorCommands.js";import{ViewAction as Y,ViewPane as fi}from"../../../browser/parts/views/viewPane.js";import{EditorResourceAccessor as yi,SideBySideEditor as Ci}from"../../../common/editor.js";import{IViewDescriptorService as Ii}from"../../../common/views.js";import{IEditorService as wi}from"../../../services/editor/common/editorService.js";import{EditorDictation as bi}from"../../codeEditor/browser/dictation/editorDictation.js";import{MenuPreventer as Mi}from"../../codeEditor/browser/menuPreventer.js";import{SelectionClipboardContributionID as Ri}from"../../codeEditor/browser/selectionClipboard.js";import{getSimpleEditorOptions as Ti,setupSimpleEditorSelectionStyling as Vi}from"../../codeEditor/browser/simpleEditorOptions.js";import{OpenScmGroupAction as Di}from"../../multiDiffEditor/browser/scmMultiDiffSourceResolver.js";import{InputValidationType as H,ISCMRepositorySortKey as Ee,ISCMService as Ze,ISCMViewService as U,SCMInputChangeReason as Ei,VIEW_PANE_ID as A}from"../common/scm.js";import{RepositoryActionRunner as Ai,RepositoryRenderer as et}from"./scmRepositoryRenderer.js";import{RepositoryContextKeys as xi}from"./scmViewService.js";import{collectContextMenuActions as ee,connectPrimaryMenuToInlineActionBar as tt,getActionViewItemProvider as Ae,isSCMActionButton as _,isSCMInput as x,isSCMRepository as I,isSCMResource as L,isSCMResourceGroup as w,isSCMResourceNode as $,isSCMViewService as xe}from"./util.js";function Li(c,t){if(!t)return[void 0,void 0];if(!t.label)return[ce(t),void 0];const e=N(c),i=t.label,o=i.length-e.length,s=ce(t.score);if(i===e)return[s,void 0];const a=[],r=[];for(const n of s)n.start>o?a.push({start:n.start-o,end:n.end-o}):n.end<o?r.push(n):(a.push({start:0,end:n.end-o}),r.push({start:n.start,end:o}));return[a,r]}let z=class{constructor(t,e,i){this.commandService=t;this.contextMenuService=e;this.notificationService=i}static DEFAULT_HEIGHT=30;static TEMPLATE_ID="actionButton";get templateId(){return z.TEMPLATE_ID}actionButtons=new Map;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("cursor-default","force-no-hover");const e=v(t,m(".button-container")),i=new eo(e,this.contextMenuService,this.commandService,this.notificationService);return{actionButton:i,disposable:ge.None,templateDisposable:i}}renderElement(t,e,i,o){i.disposable.dispose();const s=new S,a=t.element;i.actionButton.setButton(t.element.button),this.actionButtons.set(a,i.actionButton),s.add({dispose:()=>this.actionButtons.delete(a)}),i.disposable=s}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}focusActionButton(t){this.actionButtons.get(t)?.focus()}disposeElement(t,e,i){i.disposable.dispose()}disposeTemplate(t){t.disposable.dispose(),t.templateDisposable.dispose()}};z=R([d(0,we),d(1,de),d(2,di)],z);class Fe{constructor(t){this.instantiationService=t}getDragURI(t){return L(t)?t.sourceUri.toString():null}onDragStart(t,e){const i=Fe.getResourcesFromDragAndDropData(t);if(e.dataTransfer&&i?.length){this.instantiationService.invokeFunction(s=>mi(s,i,e));const o=i.filter(s=>s.scheme===Vt.file).map(s=>s.fsPath);o.length&&e.dataTransfer.setData(ri.FILES,JSON.stringify(o))}}getDragLabel(t,e){if(t.length===1){const i=t[0];if(L(i))return N(i.sourceUri)}return String(t.length)}onDragOver(t,e,i,o,s){return!0}drop(t,e,i,o,s){}static getResourcesFromDragAndDropData(t){const e=[];for(const i of[...t.context??[],...t.elements])L(i)&&e.push(i.sourceUri);return e}dispose(){}}let K=class{constructor(t,e,i,o){this.outerLayout=t;this.overflowWidgetsDomNode=e;this.updateHeight=i;this.instantiationService=o}static DEFAULT_HEIGHT=26;static TEMPLATE_ID="input";get templateId(){return K.TEMPLATE_ID}inputWidgets=new Map;contentHeights=new WeakMap;editorSelections=new WeakMap;renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-no-twistie"),t.parentElement.parentElement.classList.add("force-no-hover");const e=new S,i=v(t,m(".scm-input")),o=this.instantiationService.createInstance(j,i,this.overflowWidgetsDomNode);return e.add(o),{inputWidget:o,inputWidgetHeight:K.DEFAULT_HEIGHT,elementDisposables:new S,templateDisposable:e}}renderElement(t,e,i){const o=t.element;i.inputWidget.input=o,this.inputWidgets.set(o,i.inputWidget),i.elementDisposables.add({dispose:()=>this.inputWidgets.delete(o)});const s=this.editorSelections.get(o);s&&(i.inputWidget.selections=s),i.elementDisposables.add(ze(()=>{const l=i.inputWidget.selections;l&&this.editorSelections.set(o,l)})),i.inputWidgetHeight=K.DEFAULT_HEIGHT;const a=()=>{const l=i.inputWidget.getContentHeight();this.contentHeights.set(o,l),i.inputWidgetHeight!==l&&(this.updateHeight(o,l+10),i.inputWidgetHeight=l,i.inputWidget.layout())};Ct(()=>{i.elementDisposables.add(i.inputWidget.onDidChangeContentHeight(a)),a()},0,i.elementDisposables);const n=()=>i.inputWidget.layout();i.elementDisposables.add(this.outerLayout.onDidChange(n)),n()}renderCompressedElements(){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.templateDisposable.dispose()}getHeight(t){return(this.contentHeights.get(t)??K.DEFAULT_HEIGHT)+10}getRenderedInputWidget(t){return this.inputWidgets.get(t)}getFocusedInput(){for(const[t,e]of this.inputWidgets)if(e.hasFocus())return t}clearValidation(){for(const[,t]of this.inputWidgets)t.clearValidation()}};K=R([d(3,Re)],K);let k=class{constructor(t,e){this.actionViewItemProvider=t;this.scmViewService=e}static TEMPLATE_ID="resource group";get templateId(){return k.TEMPLATE_ID}renderTemplate(t){t.parentElement.parentElement.querySelector(".monaco-tl-twistie").classList.add("force-twistie");const e=v(t,m(".resource-group")),i=v(e,m(".name")),o=v(e,m(".actions")),s=new me(o,{actionViewItemProvider:this.actionViewItemProvider}),a=v(e,m(".count")),r=new ft(a,{},ui),n=He(s);return{name:i,count:r,actionBar:s,elementDisposables:new S,disposables:n}}renderElement(t,e,i){const o=t.element;i.name.textContent=o.label,i.actionBar.clear(),i.actionBar.context=o,i.count.setCount(o.resources.length);const s=this.scmViewService.menus.getRepositoryMenus(o.provider);i.elementDisposables.add(tt(s.getResourceGroupMenu(o),i.actionBar))}renderCompressedElements(t,e,i,o){throw new Error("Should never happen since node is incompressible")}disposeElement(t,e,i){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}};k=R([d(1,U)],k);class it extends Be{constructor(e){super();this.getSelectedResources=e}async runAction(e,i){if(!(e instanceof Ie))return super.runAction(e,i);const o=this.getSelectedResources(),r=(o.some(n=>n===i)?o:[i]).map(n=>C.isResourceNode(n)?C.collect(n):[n]).flat();await e.run(...r)}}let G=class{constructor(t,e,i,o,s,a,r){this.viewMode=t;this.labels=e;this.actionViewItemProvider=i;this.actionRunner=o;this.labelService=s;this.scmViewService=a;this.themeService=r;r.onDidColorThemeChange(this.onDidColorThemeChange,this,this.disposables)}static TEMPLATE_ID="resource";get templateId(){return G.TEMPLATE_ID}disposables=new S;renderedResources=new Map;renderTemplate(t){const e=v(t,m(".resource")),i=v(e,m(".name")),o=this.labels.create(i,{supportDescriptionHighlights:!0,supportHighlights:!0}),s=v(o.element,m(".actions")),a=new me(s,{actionViewItemProvider:this.actionViewItemProvider,actionRunner:this.actionRunner}),r=v(e,m(".decoration-icon")),n=new Se,l=He(a,o,n);return{element:e,name:i,fileLabel:o,decorationIcon:r,actionBar:a,actionBarMenu:void 0,actionBarMenuListener:n,elementDisposables:new S,disposables:l}}renderElement(t,e,i){const o=t.element,s=C.isResourceNode(o)?o.element:o,a=C.isResourceNode(o)?o.uri:o.sourceUri,r=C.isResourceNode(o)?Me.FOLDER:Me.FILE,n=!C.isResourceNode(o)&&o.decorations.tooltip||"",l=this.viewMode()==="tree";let h,u,g;if(C.isResourceNode(o))if(o.element){const b=this.scmViewService.menus.getRepositoryMenus(o.element.resourceGroup.provider);this._renderActionBar(i,o,b.getResourceMenu(o.element)),i.element.classList.toggle("faded",o.element.decorations.faded),g=o.element.decorations.strikeThrough}else{const b=this.scmViewService.menus.getRepositoryMenus(o.context.provider);this._renderActionBar(i,o,b.getResourceFolderMenu(o.context)),h=ce(t.filterData),i.element.classList.remove("faded")}else{const b=this.scmViewService.menus.getRepositoryMenus(o.resourceGroup.provider);this._renderActionBar(i,o,b.getResourceMenu(o)),[h,u]=Li(a,t.filterData),i.element.classList.toggle("faded",o.decorations.faded),g=o.decorations.strikeThrough}const y={tooltip:n,uri:a,fileLabelOptions:{hidePath:l,fileKind:r,matches:h,descriptionMatches:u,strikethrough:g},iconResource:s};this.renderIcon(i,y),this.renderedResources.set(i,y),i.elementDisposables.add(ze(()=>this.renderedResources.delete(i))),i.element.setAttribute("data-tooltip",n)}disposeElement(t,e,i){i.elementDisposables.clear()}renderCompressedElements(t,e,i,o){const s=t.element,a=s.elements[s.elements.length-1],r=s.elements.map(u=>u.name),n=Me.FOLDER,l=ce(t.filterData);i.fileLabel.setResource({resource:a.uri,name:r},{fileDecorations:{colors:!1,badges:!0},fileKind:n,matches:l,separator:this.labelService.getSeparator(a.uri.scheme)});const h=this.scmViewService.menus.getRepositoryMenus(a.context.provider);this._renderActionBar(i,a,h.getResourceFolderMenu(a.context)),i.name.classList.remove("strike-through"),i.element.classList.remove("faded"),i.decorationIcon.style.display="none",i.decorationIcon.style.backgroundImage="",i.element.setAttribute("data-tooltip","")}disposeCompressedElements(t,e,i,o){i.elementDisposables.clear()}disposeTemplate(t){t.elementDisposables.dispose(),t.disposables.dispose()}_renderActionBar(t,e,i){(!t.actionBarMenu||t.actionBarMenu!==i)&&(t.actionBar.clear(),t.actionBarMenu=i,t.actionBarMenuListener.value=tt(i,t.actionBar)),t.actionBar.context=e}onDidColorThemeChange(){for(const[t,e]of this.renderedResources)this.renderIcon(t,e)}renderIcon(t,e){const i=this.themeService.getColorTheme(),o=i.type===pi.LIGHT?e.iconResource?.decorations.icon:e.iconResource?.decorations.iconDark;t.fileLabel.setFile(e.uri,{...e.fileLabelOptions,fileDecorations:{colors:!1,badges:!o}}),o?(Ce.isThemeIcon(o)?(t.decorationIcon.className=`decoration-icon ${Ce.asClassName(o)}`,o.color&&(t.decorationIcon.style.color=i.getColor(o.color.id)?.toString()??""),t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=""):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="",t.decorationIcon.style.backgroundImage=dt(o)),t.decorationIcon.title=e.tooltip):(t.decorationIcon.className="decoration-icon",t.decorationIcon.style.color="",t.decorationIcon.style.display="none",t.decorationIcon.style.backgroundImage="",t.decorationIcon.title="")}dispose(){this.disposables.dispose()}};G=R([d(4,Ve),d(5,U),d(6,Xe)],G);class Ki{constructor(t){this.inputRenderer=t}getHeight(t){return x(t)?this.inputRenderer.getHeight(t):_(t)?z.DEFAULT_HEIGHT+10:22}getTemplateId(t){if(I(t))return et.TEMPLATE_ID;if(x(t))return K.TEMPLATE_ID;if(_(t))return z.TEMPLATE_ID;if(w(t))return k.TEMPLATE_ID;if(L(t)||$(t))return G.TEMPLATE_ID;throw new Error("Unknown element")}}class Fi{isIncompressible(t){return C.isResourceNode(t)?t.childrenCount===0||!t.parent||!t.parent.parent:!0}}class Pi{filter(t){return w(t)?t.resources.length>0||!t.hideWhenEmpty:!0}}class Bi{constructor(t,e){this.viewMode=t;this.viewSortKey=e}compare(t,e){if(I(t)){if(!I(e))throw new Error("Invalid comparison");return 0}if(x(t))return-1;if(x(e))return 1;if(_(t))return-1;if(_(e))return 1;if(w(t))return w(e)?0:-1;if(this.viewMode()==="list"){if(this.viewSortKey()==="name"){const l=N(t.sourceUri),h=N(e.sourceUri);return Ne(l,h)}if(this.viewSortKey()==="status"){const l=t.decorations.tooltip??"",h=e.decorations.tooltip??"";if(l!==h)return At(l,h)}const r=t.sourceUri.fsPath,n=e.sourceUri.fsPath;return Mt(r,n)}const i=C.isResourceNode(t),o=C.isResourceNode(e);if(i!==o)return i?-1:1;const s=C.isResourceNode(t)?t.name:N(t.sourceUri),a=C.isResourceNode(e)?e.name:N(e.sourceUri);return Ne(s,a)}}let te=class{constructor(t,e){this.viewMode=t;this.labelService=e}getKeyboardNavigationLabel(t){if(C.isResourceNode(t))return t.name;if(I(t)||x(t)||_(t))return;if(w(t))return t.label;if(this.viewMode()==="list"){const e=N(t.sourceUri),i=this.labelService.getUriLabel(t.sourceUri,{relative:!0});return[e,i]}else return N(t.sourceUri)}getCompressedNodeKeyboardNavigationLabel(t){return t.map(i=>i.name).join("/")}};te=R([d(1,Ve)],te);function ot(c){if(I(c))return`repo:${c.provider.id}`;if(x(c))return`input:${c.repository.provider.id}`;if(_(c))return`actionButton:${c.repository.provider.id}`;if(w(c))return`resourceGroup:${c.provider.id}/${c.id}`;if(L(c)){const t=c.resourceGroup;return`resource:${t.provider.id}/${t.id}/${c.sourceUri.toString()}`}else if($(c)){const t=c.context;return`folder:${t.provider.id}/${t.id}/$FOLDER/${c.uri.toString()}`}else throw new Error("Invalid tree element")}class _i{getId(t){return ot(t)}}let ie=class{constructor(t){this.labelService=t}getWidgetAriaLabel(){return f("scm","Source Control Management")}getAriaLabel(t){if(C.isResourceNode(t))return this.labelService.getUriLabel(t.uri,{relative:!0,noPrefix:!0})||t.name;if(I(t))return`${t.provider.name} ${t.provider.label}`;if(x(t))return f("input","Source Control Input");if(_(t))return t.button?.command.title??"";if(w(t))return t.label;{const e=[];e.push(N(t.sourceUri)),t.decorations.tooltip&&e.push(t.decorations.tooltip);const i=this.labelService.getUriLabel(Et(t.sourceUri),{relative:!0,noPrefix:!0});return i&&e.push(i),e.join(", ")}}};ie=R([d(0,Ve)],ie);var Ni=(e=>(e.List="list",e.Tree="tree",e))(Ni||{}),Hi=(i=>(i.Path="path",i.Name="name",i.Status="status",i))(Hi||{});const W={ViewSort:new T("SCMViewSort"),Repositories:new T("SCMRepositories"),ChangesSettings:new T("SCMChangesSettings")},p={SCMViewMode:new P("scmViewMode","list"),SCMViewSortKey:new P("scmViewSortKey","path"),SCMViewAreAllRepositoriesCollapsed:new P("scmViewAreAllRepositoriesCollapsed",!1),SCMViewIsAnyRepositoryCollapsible:new P("scmViewIsAnyRepositoryCollapsible",!1),SCMProvider:new P("scmProvider",void 0),SCMProviderRootUri:new P("scmProviderRootUri",void 0),SCMProviderHasRootUri:new P("scmProviderHasRootUri",void 0),RepositoryCount:new P("scmRepositoryCount",0),RepositoryVisibilityCount:new P("scmRepositoryVisibleCount",0),RepositoryVisibility(c){return new P(`scmRepositoryVisible:${c.provider.id}`,!1)}};je.appendMenuItem(T.SCMTitle,{title:f("sortAction","View & Sort"),submenu:W.ViewSort,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0)),group:"0_view&sort",order:1}),je.appendMenuItem(W.ViewSort,{title:f("repositories","Repositories"),submenu:W.Repositories,when:D.greater(p.RepositoryCount.key,1),group:"0_repositories"});class Wi extends ii{repository;constructor(t){super({id:`workbench.scm.action.toggleRepositoryVisibility.${t.provider.id}`,title:t.provider.name,f1:!1,precondition:D.or(p.RepositoryVisibilityCount.notEqualsTo(1),p.RepositoryVisibility(t).isEqualTo(!1)),toggled:p.RepositoryVisibility(t).isEqualTo(!0),menu:{id:W.Repositories,group:"0_repositories"}}),this.repository=t}run(t){t.get(U).toggleVisibility(this.repository)}}let oe=class{constructor(t,e,i){this.contextKeyService=t;this.scmViewService=e;this.repositoryCountContextKey=p.RepositoryCount.bindTo(t),this.repositoryVisibilityCountContextKey=p.RepositoryVisibilityCount.bindTo(t),e.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.disposables),i.onDidAddRepository(this.onDidAddRepository,this,this.disposables),i.onDidRemoveRepository(this.onDidRemoveRepository,this,this.disposables);for(const o of i.repositories)this.onDidAddRepository(o)}items=new Map;repositoryCountContextKey;repositoryVisibilityCountContextKey;disposables=new S;onDidAddRepository(t){const e=V(class extends Wi{constructor(){super(t)}}),i=p.RepositoryVisibility(t).bindTo(this.contextKeyService);i.set(this.scmViewService.isVisible(t)),this.items.set(t,{contextKey:i,dispose(){i.reset(),e.dispose()}}),this.updateRepositoryContextKeys()}onDidRemoveRepository(t){this.items.get(t)?.dispose(),this.items.delete(t),this.updateRepositoryContextKeys()}onDidChangeVisibleRepositories(){let t=0;for(const[e,i]of this.items){const o=this.scmViewService.isVisible(e);i.contextKey.set(o),o&&t++}this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set(t)}updateRepositoryContextKeys(){this.repositoryCountContextKey.set(this.items.size),this.repositoryVisibilityCountContextKey.set(q.reduce(this.items.keys(),(t,e)=>t+(this.scmViewService.isVisible(e)?1:0),0))}dispose(){this.disposables.dispose(),Tt(this.items.values()),this.items.clear()}};oe=R([d(0,Z),d(1,U),d(2,Ze)],oe);class st extends Y{constructor(t="workbench.scm.action.setListViewMode",e={}){super({id:t,title:f("setListViewMode","View as List"),viewId:A,f1:!1,icon:J.listTree,toggled:p.SCMViewMode.isEqualTo("list"),menu:{id:W.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="list"}}class zi extends st{constructor(){super("workbench.scm.action.setListViewModeNavigation",{id:T.SCMTitle,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0),p.SCMViewMode.isEqualTo("tree")),group:"navigation",order:-1e3})}}class rt extends Y{constructor(t="workbench.scm.action.setTreeViewMode",e={}){super({id:t,title:f("setTreeViewMode","View as Tree"),viewId:A,f1:!1,icon:J.listFlat,toggled:p.SCMViewMode.isEqualTo("tree"),menu:{id:W.ViewSort,group:"1_viewmode",...e}})}async runInView(t,e){e.viewMode="tree"}}class Oi extends rt{constructor(){super("workbench.scm.action.setTreeViewModeNavigation",{id:T.SCMTitle,when:D.and(D.equals("view",A),p.RepositoryCount.notEqualsTo(0),p.SCMViewMode.isEqualTo("list")),group:"navigation",order:-1e3})}}V(st),V(rt),V(zi),V(Oi);class Le extends Y{constructor(e,i){super({id:`workbench.scm.action.repositories.setSortKey.${e}`,title:i,viewId:A,f1:!1,toggled:xi.RepositorySortKey.isEqualTo(e),menu:[{id:W.Repositories,group:"1_sort"},{id:T.SCMSourceControlTitle,group:"1_sort"}]});this.sortKey=e}runInView(e){e.get(U).toggleSortKey(this.sortKey)}}class Ui extends Le{constructor(){super(Ee.DiscoveryTime,f("repositorySortByDiscoveryTime","Sort by Discovery Time"))}}class ki extends Le{constructor(){super(Ee.Name,f("repositorySortByName","Sort by Name"))}}class Gi extends Le{constructor(){super(Ee.Path,f("repositorySortByPath","Sort by Path"))}}V(Ui),V(ki),V(Gi);class Ke extends Y{constructor(e,i){super({id:`workbench.scm.action.setSortKey.${e}`,title:i,viewId:A,f1:!1,toggled:p.SCMViewSortKey.isEqualTo(e),precondition:p.SCMViewMode.isEqualTo("list"),menu:{id:W.ViewSort,group:"2_sort"}});this.sortKey=e}async runInView(e,i){i.viewSortKey=this.sortKey}}class qi extends Ke{constructor(){super("name",f("sortChangesByName","Sort Changes by Name"))}}class $i extends Ke{constructor(){super("path",f("sortChangesByPath","Sort Changes by Path"))}}class ji extends Ke{constructor(){super("status",f("sortChangesByStatus","Sort Changes by Status"))}}V(qi),V($i),V(ji);class Ji extends Y{constructor(){super({id:"workbench.scm.action.collapseAllRepositories",title:f("collapse all","Collapse All Repositories"),viewId:A,f1:!1,icon:J.collapseAll,menu:{id:T.SCMTitle,group:"navigation",when:D.and(D.equals("view",A),p.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),p.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!1))}})}async runInView(t,e){e.collapseAllRepositories()}}class Yi extends Y{constructor(){super({id:"workbench.scm.action.expandAllRepositories",title:f("expand all","Expand All Repositories"),viewId:A,f1:!1,icon:J.expandAll,menu:{id:T.SCMTitle,group:"navigation",when:D.and(D.equals("view",A),p.SCMViewIsAnyRepositoryCollapsible.isEqualTo(!0),p.SCMViewAreAllRepositoriesCollapsed.isEqualTo(!0))}})}async runInView(t,e){e.expandAllRepositories()}}V(Ji),V(Yi);var Qi=(t=>(t.CancelAction="scm.input.cancelAction",t))(Qi||{}),Xi=(t=>(t.LastActionId="scm.input.lastActionId",t))(Xi||{});let se=class extends Be{constructor(e,i){super();this.input=e;this.storageService=i}_runningActions=new Set;get runningActions(){return this._runningActions}_cts;async runAction(e){try{if(this.runningActions.size!==0&&(this._cts?.cancel(),e.id==="scm.input.cancelAction"))return;const i=[];for(const o of this.input.repository.provider.groups)i.push({resourceGroupId:o.id,resources:[...o.resources.map(s=>s.sourceUri)]});this._runningActions.add(e),this._cts=new bt,await e.run(this.input.repository.provider.rootUri,i,this._cts.token)}finally{this._runningActions.delete(e),this._runningActions.size===0&&this.storageService.store("scm.input.lastActionId",e.id,B.PROFILE,le.USER)}}};se=R([d(1,De)],se);let re=class extends ti{constructor(e,i,o,s,a,r,n,l,h){super(e,{resetMenu:T.SCMInputBox,...i},o,s,a,n,r,h);this.menuService=o;this.contextKeyService=s;this.storageService=l;this._dropdownAction=new ve("scmInputMoreActions",f("scmInputMoreActions","More Actions..."),"codicon-chevron-down"),this._cancelAction=new Ie({id:"scm.input.cancelAction",title:f("scmInputCancelAction","Cancel"),icon:J.debugStop},void 0,void 0,void 0,void 0,s,r)}_dropdownActions=[];get dropdownActions(){return this._dropdownActions}_dropdownAction;get dropdownAction(){return this._dropdownAction}_cancelAction;_onDidChange=new X;onDidChange=this._onDidChange.event;_disposables=this._register(new Se);setInput(e){this._disposables.value=new S;const i=this.contextKeyService.createOverlay([["scmProvider",e.repository.provider.contextValue],["scmProviderRootUri",e.repository.provider.rootUri?.toString()],["scmProviderHasRootUri",!!e.repository.provider.rootUri]]),o=this._disposables.value.add(this.menuService.createMenu(T.SCMInputBox,i,{emitEventsForSubmenuChanges:!0})),s=()=>e.repository.provider.groups.some(r=>r.resources.length>0),a=()=>{const r=[];Zt(o,{shouldForwardArgs:!0},r);for(const l of r)l.enabled=s();this._dropdownAction.enabled=s();let n;if(r.length===1)n=r[0];else if(r.length>1){const l=this.storageService.get("scm.input.lastActionId",B.PROFILE,"");n=r.find(h=>h.id===l)??r[0]}this._dropdownActions=r.length===1?[]:r,super.setActions(n?[n]:[],[]),this._onDidChange.fire()};this._disposables.value.add(o.onDidChange(()=>a())),this._disposables.value.add(e.repository.provider.onDidChangeResources(()=>a())),this._disposables.value.add(this.storageService.onDidChangeValue(B.PROFILE,"scm.input.lastActionId",this._disposables.value)(()=>a())),this.actionRunner=new se(e,this.storageService),this._disposables.value.add(this.actionRunner.onWillRun(r=>{this.actionRunner.runningActions.size===0&&(super.setActions([this._cancelAction],[]),this._onDidChange.fire())})),this._disposables.value.add(this.actionRunner.onDidRun(r=>{this.actionRunner.runningActions.size===0&&a()})),a()}};re=R([d(2,$e),d(3,Z),d(4,de),d(5,we),d(6,Te),d(7,De),d(8,Ye)],re);class Zi{constructor(t,e){this.overflowWidgetsDomNode=t;this.configurationService=e;const i=E.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration("editor.accessibilitySupport")||o.affectsConfiguration("editor.cursorBlinking")||o.affectsConfiguration("editor.fontFamily")||o.affectsConfiguration("editor.rulers")||o.affectsConfiguration("editor.wordWrap")||o.affectsConfiguration("scm.inputFontFamily")||o.affectsConfiguration("scm.inputFontSize"),this._disposables);this._disposables.add(i(()=>this._onDidChange.fire()))}_onDidChange=new X;onDidChange=this._onDidChange.event;defaultInputFontFamily=vt;_disposables=new S;getEditorConstructionOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e);return{...Ti(this.configurationService),...this._getEditorLanguageConfiguration(),cursorWidth:1,dragAndDrop:!0,dropIntoEditor:{enabled:!0},fontFamily:t,fontSize:e,formatOnType:!0,lineDecorationsWidth:6,lineHeight:i,overflowWidgetsDomNode:this.overflowWidgetsDomNode,padding:{top:2,bottom:2},quickSuggestions:!1,renderWhitespace:"none",scrollbar:{alwaysConsumeMouseWheel:!1,vertical:"hidden"},wrappingIndent:"none",wrappingStrategy:"advanced"}}getEditorOptions(){const t=this._getEditorFontFamily(),e=this._getEditorFontSize(),i=this._getEditorLineHeight(e),o=this.configurationService.getValue("editor.accessibilitySupport"),s=this.configurationService.getValue("editor.cursorBlinking");return{...this._getEditorLanguageConfiguration(),accessibilitySupport:o,cursorBlinking:s,fontFamily:t,fontSize:e,lineHeight:i}}_getEditorFontFamily(){const t=this.configurationService.getValue("scm.inputFontFamily").trim();return t.toLowerCase()==="editor"?this.configurationService.getValue("editor.fontFamily").trim():t.length!==0&&t.toLowerCase()!=="default"?t:this.defaultInputFontFamily}_getEditorFontSize(){return this.configurationService.getValue("scm.inputFontSize")}_getEditorLanguageConfiguration(){const t=this.configurationService.inspect("editor.rulers",{overrideIdentifier:"scminput"}),e=t.overrideIdentifiers?.includes("scminput")?ke.rulers.validate(t.value):[],i=this.configurationService.inspect("editor.wordWrap",{overrideIdentifier:"scminput"}),o=i.overrideIdentifiers?.includes("scminput")?ke.wordWrap.validate(i.value):"on";return{rulers:e,wordWrap:o}}_getEditorLineHeight(t){return Math.round(t*1.5)}dispose(){this._disposables.dispose()}}let j=class{constructor(t,e,i,o,s,a,r,n,l,h,u){this.modelService=o;this.keybindingService=s;this.configurationService=a;this.instantiationService=r;this.scmViewService=n;this.contextViewService=l;this.openerService=h;this.contextMenuService=u;this.element=v(t,m(".scm-editor")),this.editorContainer=v(this.element,m(".scm-editor-container")),this.toolbarContainer=v(this.element,m(".scm-editor-toolbar")),this.contextKeyService=i.createScoped(this.element),this.repositoryIdContextKey=this.contextKeyService.createKey("scmRepository",void 0),this.inputEditorOptions=new Zi(e,this.configurationService),this.disposables.add(this.inputEditorOptions.onDidChange(this.onDidChangeEditorOptions,this)),this.disposables.add(this.inputEditorOptions);const g={contributions:Lt.getSomeEditorContributions([Nt.ID,Ht.ID,Wt.ID,Ge.ID,zt.ID,qe.ID,bi.ID,Ot.ID,Ut.ID,kt.ID,Gt.ID,qt.ID,Mi.ID,$t.ID,jt.ID,Ri,Jt.ID,Yt.ID]),isSimpleWidget:!0},y=new ai([Z,this.contextKeyService]),b=r.createChild(y,this.disposables),pe=this.inputEditorOptions.getEditorConstructionOptions();this.inputEditor=b.createInstance(Kt,this.editorContainer,pe,g),this.disposables.add(this.inputEditor),this.disposables.add(this.inputEditor.onDidFocusEditorText(()=>{this.input?.repository&&this.scmViewService.focus(this.input.repository),this.element.classList.add("synthetic-focus"),this.renderValidation()})),this.disposables.add(this.inputEditor.onDidBlurEditorText(()=>{this.element.classList.remove("synthetic-focus"),setTimeout(()=>{(!this.validation||!this.validationHasFocus)&&this.clearValidation()},0)})),this.disposables.add(this.inputEditor.onDidBlurEditorWidget(()=>{Ge.get(this.inputEditor)?.clearWidgets(),qe.get(this.inputEditor)?.clearWidgets()}));const F=this.contextKeyService.createKey("scmInputIsInFirstPosition",!1),he=this.contextKeyService.createKey("scmInputIsInLastPosition",!1);this.disposables.add(this.inputEditor.onDidChangeCursorPosition(({position:M})=>{const O=this.inputEditor._getViewModel(),Q=O.getLineCount(),nt=O.getLineLength(Q)+1,ae=O.coordinatesConverter.convertModelPositionToViewPosition(M);F.set(ae.lineNumber===1&&ae.column===1),he.set(ae.lineNumber===Q&&ae.column===nt)})),this.disposables.add(this.inputEditor.onDidScrollChange(M=>{this.toolbarContainer.classList.toggle("scroll-decoration",M.scrollTop>0)})),E.filter(this.configurationService.onDidChangeConfiguration,M=>M.affectsConfiguration("scm.showInputActionButton"))(()=>this.layout(),this,this.disposables),this.onDidChangeContentHeight=E.signal(E.filter(this.inputEditor.onDidContentSizeChange,M=>M.contentHeightChanged,this.disposables)),this.toolbar=b.createInstance(re,this.toolbarContainer,{actionViewItemProvider:(M,O)=>M instanceof Ie&&this.toolbar.dropdownActions.length>1?r.createInstance(Qt,M,this.toolbar.dropdownAction,this.toolbar.dropdownActions,"",this.contextMenuService,{actionRunner:this.toolbar.actionRunner,hoverDelegate:O.hoverDelegate}):Xt(r,M,O),menuOptions:{shouldForwardArgs:!0}}),this.disposables.add(this.toolbar.onDidChange(()=>this.layout())),this.disposables.add(this.toolbar)}static ValidationTimeouts={[H.Information]:5e3,[H.Warning]:8e3,[H.Error]:1e4};contextKeyService;element;editorContainer;inputEditor;inputEditorOptions;toolbarContainer;toolbar;disposables=new S;model;repositoryIdContextKey;repositoryDisposables=new S;validation;validationContextView;validationHasFocus=!1;_validationTimer;lastLayoutWasTrash=!1;shouldFocusAfterLayout=!1;onDidChangeContentHeight;get input(){return this.model?.input}set input(t){if(t===this.input)return;if(this.clearValidation(),this.element.classList.remove("synthetic-focus"),this.repositoryDisposables.clear(),this.repositoryIdContextKey.set(t?.repository.id),!t){this.inputEditor.setModel(void 0),this.model=void 0;return}const e=t.repository.provider.inputBoxTextModel;this.inputEditor.setModel(e),this.configurationService.getValue("editor.wordBasedSuggestions",{resource:e.uri})!=="off"&&this.configurationService.updateValue("editor.wordBasedSuggestions","off",{resource:e.uri},oi.MEMORY);const i=new wt(200),o=async()=>{const u=this.inputEditor.getSelection()?.getStartPosition(),g=u&&e.getOffsetAt(u),y=e.getValue();this.setValidation(await t.validateInput(y,g||0))},s=()=>i.trigger(o);this.repositoryDisposables.add(i),this.repositoryDisposables.add(this.inputEditor.onDidChangeCursorPosition(s));const a=this.modelService.getCreationOptions(e.getLanguageId(),e.uri,e.isForSimpleWidget),r=E.filter(this.inputEditor.onKeyDown,u=>u.keyCode===Rt.Enter,this.repositoryDisposables);this.repositoryDisposables.add(r(()=>e.detectIndentation(a.insertSpaces,a.tabSize))),e.setValue(t.value),this.repositoryDisposables.add(t.onDidChange(({value:u,reason:g})=>{const y=e.getValue();if(u===y)return;e.pushStackElement(),e.pushEditOperations(null,[Bt.replaceMove(e.getFullModelRange(),u)],()=>[]);const b=g===Ei.HistoryPrevious?e.getFullModelRange().getStartPosition():e.getFullModelRange().getEndPosition();this.inputEditor.setPosition(b),this.inputEditor.revealPositionInCenterIfOutsideViewport(b)})),this.repositoryDisposables.add(t.onDidChangeFocus(()=>this.focus())),this.repositoryDisposables.add(t.onDidChangeValidationMessage(u=>this.setValidation(u,{focus:!0,timeout:!0}))),this.repositoryDisposables.add(t.onDidChangeValidateInput(u=>s())),this.repositoryDisposables.add(e.onDidChangeContent(()=>{t.setValue(e.getValue(),!0),s()}));const n=()=>{const u=this.keybindingService.lookupKeybinding("scm.acceptInput"),g=u?u.getLabel():Dt.isMacintosh?"Cmd+Enter":"Ctrl+Enter",y=xt(t.placeholder,g);this.inputEditor.updateOptions({placeholder:y})};this.repositoryDisposables.add(t.onDidChangePlaceholder(n)),this.repositoryDisposables.add(this.keybindingService.onDidUpdateKeybindings(n)),n();let l="";this.repositoryDisposables.add(Oe(u=>{if(!t.visible)return;const g=l;l=t.repository.provider.commitTemplate.read(u);const y=e.getValue();y&&y!==g||e.setValue(l)}));const h=u=>{this.inputEditor.updateOptions({readOnly:!u})};this.repositoryDisposables.add(t.onDidChangeEnablement(u=>h(u))),h(t.enabled),this.toolbar.setInput(t),this.model={input:t,textModel:e}}get selections(){return this.inputEditor.getSelections()}set selections(t){t&&this.inputEditor.setSelections(t)}setValidation(t,e){this._validationTimer&&(clearTimeout(this._validationTimer),this._validationTimer=0),this.validation=t,this.renderValidation(),e?.focus&&!this.hasFocus()&&this.focus(),t&&e?.timeout&&(this._validationTimer=setTimeout(()=>this.setValidation(void 0),j.ValidationTimeouts[t.type]))}getContentHeight(){const t=this.inputEditor.getOption(Ue.lineHeight),{top:e,bottom:i}=this.inputEditor.getOption(Ue.padding),o=this.configurationService.getValue("scm.inputMinLineCount"),a=(typeof o=="number"?fe(o,1,50):1)*t+e+i,r=this.configurationService.getValue("scm.inputMaxLineCount"),l=(typeof r=="number"?fe(r,1,50):10)*t+e+i;return fe(this.inputEditor.getContentHeight(),a,l)}layout(){const t=this.getContentHeight(),e=this.getToolbarWidth(),i=new ut(this.element.clientWidth-e,t);if(i.width<0){this.lastLayoutWasTrash=!0;return}this.lastLayoutWasTrash=!1,this.inputEditor.layout(i),this.renderValidation();const o=this.configurationService.getValue("scm.showInputActionButton")===!0;this.toolbarContainer.classList.toggle("hidden",!o||this.toolbar?.isEmpty()===!0),this.shouldFocusAfterLayout&&(this.shouldFocusAfterLayout=!1,this.focus())}focus(){if(this.lastLayoutWasTrash){this.lastLayoutWasTrash=!1,this.shouldFocusAfterLayout=!0;return}this.inputEditor.focus(),this.element.classList.add("synthetic-focus")}hasFocus(){return this.inputEditor.hasTextFocus()}onDidChangeEditorOptions(){this.inputEditor.updateOptions(this.inputEditorOptions.getEditorOptions())}renderValidation(){if(this.clearValidation(),this.element.classList.toggle("validation-info",this.validation?.type===H.Information),this.element.classList.toggle("validation-warning",this.validation?.type===H.Warning),this.element.classList.toggle("validation-error",this.validation?.type===H.Error),!this.validation||!this.inputEditor.hasTextFocus())return;const t=new S;this.validationContextView=this.contextViewService.showContextView({getAnchor:()=>this.element,render:e=>{this.element.style.borderBottomLeftRadius="0",this.element.style.borderBottomRightRadius="0";const i=v(e,m(".scm-editor-validation-container"));i.classList.toggle("validation-info",this.validation.type===H.Information),i.classList.toggle("validation-warning",this.validation.type===H.Warning),i.classList.toggle("validation-error",this.validation.type===H.Error),i.style.width=`${this.element.clientWidth+2}px`;const o=v(i,m(".scm-editor-validation")),s=this.validation.message;if(typeof s=="string")o.textContent=s;else{const l=mt(o);t.add(l),t.add(l.onDidFocus(()=>this.validationHasFocus=!0)),t.add(l.onDidBlur(()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()}));const u=t.add(this.instantiationService.createInstance(Ft,{})).render(s,{actionHandler:{callback:g=>{Pt(this.openerService,g,s.isTrusted),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",this.contextViewService.hideContextView()},disposables:t}});t.add(u),o.appendChild(u.element)}const a=v(i,m(".scm-editor-validation-actions")),r=new me(a),n=new ve("scmInputWidget.validationMessage.close",f("label.close","Close"),Ce.asClassName(J.close),!0,()=>{this.contextViewService.hideContextView(),this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px"});return t.add(r),r.push(n,{icon:!0,label:!1}),ge.None},onHide:()=>{this.validationHasFocus=!1,this.element.style.borderBottomLeftRadius="2px",this.element.style.borderBottomRightRadius="2px",t.dispose()},anchorAlignment:St.LEFT})}getToolbarWidth(){const t=this.configurationService.getValue("scm.showInputActionButton");return!this.toolbar||!t||this.toolbar?.isEmpty()===!0?0:this.toolbar.dropdownActions.length===0?26:39}clearValidation(){this.validationContextView?.close(),this.validationContextView=void 0,this.validationHasFocus=!1}dispose(){this.input=void 0,this.repositoryDisposables.dispose(),this.clearValidation(),this.disposables.dispose()}};j=R([d(2,Z),d(3,_t),d(4,Te),d(5,be),d(6,Re),d(7,U),d(8,si),d(9,Je),d(10,de)],j);let ue=class extends fi{constructor(e,i,o,s,a,r,n,l,h,u,g,y,b,pe,F,he,M,O){super({...e,titleMenuId:T.SCMTitle},h,g,pe,F,b,y,he,u,M,O);this.commandService=i;this.editorService=o;this.menuService=s;this.scmService=a;this.scmViewService=r;this.storageService=n;this.uriIdentityService=l;this._viewMode=this.getViewMode(),this._viewSortKey=this.getViewSortKey(),this.viewModeContextKey=p.SCMViewMode.bindTo(F),this.viewModeContextKey.set(this._viewMode),this.viewSortKeyContextKey=p.SCMViewSortKey.bindTo(F),this.viewSortKeyContextKey.set(this.viewSortKey),this.areAllRepositoriesCollapsedContextKey=p.SCMViewAreAllRepositoriesCollapsed.bindTo(F),this.isAnyRepositoryCollapsibleContextKey=p.SCMViewIsAnyRepositoryCollapsible.bindTo(F),this.scmProviderContextKey=p.SCMProvider.bindTo(F),this.scmProviderRootUriContextKey=p.SCMProviderRootUri.bindTo(F),this.scmProviderHasRootUriContextKey=p.SCMProviderHasRootUri.bindTo(F),this._onDidLayout=new X,this.layoutCache={height:void 0,width:void 0,onDidChange:this._onDidLayout.event},this.storageService.onDidChangeValue(B.WORKSPACE,void 0,this.disposables)(Q=>{switch(Q.key){case"scm.viewMode":this.viewMode=this.getViewMode();break;case"scm.viewSortKey":this.viewSortKey=this.getViewSortKey();break}},this,this.disposables),this.storageService.onWillSaveState(Q=>{this.viewMode=this.getViewMode(),this.viewSortKey=this.getViewSortKey(),this.storeTreeViewState()},this,this.disposables),E.any(this.scmService.onDidAddRepository,this.scmService.onDidRemoveRepository)(()=>this._onDidChangeViewWelcomeState.fire(),this,this.disposables),this.disposables.add(this.revealResourceThrottler),this.disposables.add(this.updateChildrenThrottler)}_onDidLayout;layoutCache;treeScrollTop;treeContainer;tree;listLabels;inputRenderer;actionButtonRenderer;_viewMode;get viewMode(){return this._viewMode}set viewMode(e){this._viewMode!==e&&(this._viewMode=e,this.viewSortKey=this.getViewSortKey(),this.updateChildren(),this.onDidActiveEditorChange(),this._onDidChangeViewMode.fire(e),this.viewModeContextKey.set(e),this.updateIndentStyles(this.themeService.getFileIconTheme()),this.storageService.store("scm.viewMode",e,B.WORKSPACE,le.USER))}_onDidChangeViewMode=new X;onDidChangeViewMode=this._onDidChangeViewMode.event;_viewSortKey;get viewSortKey(){return this._viewSortKey}set viewSortKey(e){this._viewSortKey!==e&&(this._viewSortKey=e,this.updateChildren(),this.viewSortKeyContextKey.set(e),this._onDidChangeViewSortKey.fire(e),this._viewMode==="list"&&this.storageService.store("scm.viewSortKey",e,B.WORKSPACE,le.USER))}_onDidChangeViewSortKey=new X;onDidChangeViewSortKey=this._onDidChangeViewSortKey.event;items=new We;visibilityDisposables=new S;treeOperationSequencer=new It;revealResourceThrottler=new _e;updateChildrenThrottler=new _e;viewModeContextKey;viewSortKeyContextKey;areAllRepositoriesCollapsedContextKey;isAnyRepositoryCollapsibleContextKey;scmProviderContextKey;scmProviderRootUriContextKey;scmProviderHasRootUriContextKey;disposables=new S;layoutBody(e=this.layoutCache.height,i=this.layoutCache.width){e!==void 0&&(i!==void 0&&super.layoutBody(e,i),this.layoutCache.height=e,this.layoutCache.width=i,this._onDidLayout.fire(),this.treeContainer.style.height=`${e}px`,this.tree.layout(e,i))}renderBody(e){super.renderBody(e),this.treeContainer=v(e,m(".scm-view.show-file-icons")),this.treeContainer.classList.add("file-icon-themable-tree"),this.treeContainer.classList.add("show-file-icons");const i=()=>this.treeContainer.classList.toggle("show-actions",this.configurationService.getValue("scm.alwaysShowActions"));E.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("scm.alwaysShowActions"),this.disposables)(i,this,this.disposables),i();const o=()=>{const a=this.configurationService.getValue("scm.providerCountBadge");this.treeContainer.classList.toggle("hide-provider-counts",a==="hidden"),this.treeContainer.classList.toggle("auto-provider-counts",a==="auto")};E.filter(this.configurationService.onDidChangeConfiguration,a=>a.affectsConfiguration("scm.providerCountBadge"),this.disposables)(o,this,this.disposables),o();const s=this.loadTreeViewState();this.createTree(this.treeContainer,s),this.onDidChangeBodyVisibility(async a=>{a?this.treeOperationSequencer.queue(async()=>{await this.tree.setInput(this.scmViewService,s),E.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration("scm.alwaysShowRepositories"),this.visibilityDisposables)(()=>{this.updateActions(),this.updateChildren()},this,this.visibilityDisposables),E.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration("scm.inputMinLineCount")||r.affectsConfiguration("scm.inputMaxLineCount")||r.affectsConfiguration("scm.showActionButton"),this.visibilityDisposables)(()=>this.updateChildren(),this,this.visibilityDisposables),this.editorService.onDidActiveEditorChange(this.onDidActiveEditorChange,this,this.visibilityDisposables),this.scmViewService.onDidChangeVisibleRepositories(this.onDidChangeVisibleRepositories,this,this.visibilityDisposables),this.onDidChangeVisibleRepositories({added:this.scmViewService.visibleRepositories,removed:q.empty()}),typeof this.treeScrollTop=="number"&&(this.tree.scrollTop=this.treeScrollTop,this.treeScrollTop=void 0),this.updateRepositoryCollapseAllContextKeys()}):(this.visibilityDisposables.clear(),this.onDidChangeVisibleRepositories({added:q.empty(),removed:[...this.items.keys()]}),this.treeScrollTop=this.tree.scrollTop,this.updateRepositoryCollapseAllContextKeys())},this,this.disposables),this.disposables.add(this.instantiationService.createInstance(oe)),this.themeService.onDidFileIconThemeChange(this.updateIndentStyles,this,this.disposables),this.updateIndentStyles(this.themeService.getFileIconTheme())}createTree(e,i){const o=m(".scm-overflow-widgets-container.monaco-editor");this.inputRenderer=this.instantiationService.createInstance(K,this.layoutCache,o,(n,l)=>{try{this.tree.updateElementHeight(n,l)}catch{}}),this.actionButtonRenderer=this.instantiationService.createInstance(z),this.listLabels=this.instantiationService.createInstance(vi,{onDidChangeVisibility:this.onDidChangeBodyVisibility}),this.disposables.add(this.listLabels);const s=new it(()=>this.getSelectedResources());s.onWillRun(()=>this.tree.domFocus(),this,this.disposables),this.disposables.add(s);const a=this.instantiationService.createInstance(ne,()=>this.viewMode);this.disposables.add(a);const r=li("scm.compactFolders",!0,this.configurationService);this.tree=this.instantiationService.createInstance(ci,"SCM Tree Repo",e,new Ki(this.inputRenderer),new Fi,[this.inputRenderer,this.actionButtonRenderer,this.instantiationService.createInstance(et,T.SCMTitle,Ae(this.instantiationService)),this.instantiationService.createInstance(k,Ae(this.instantiationService)),this.instantiationService.createInstance(G,()=>this.viewMode,this.listLabels,Ae(this.instantiationService),s)],a,{horizontalScrolling:!1,setRowLineHeight:!1,transformOptimization:!1,filter:new Pi,dnd:new Fe(this.instantiationService),identityProvider:new _i,sorter:new Bi(()=>this.viewMode,()=>this.viewSortKey),keyboardNavigationLabelProvider:this.instantiationService.createInstance(te,()=>this.viewMode),overrideStyles:this.getLocationBasedColors().listOverrideStyles,compressionEnabled:r.get(),collapseByDefault:n=>I(n)||w(n)||$(n)?!1:(i?.expanded??[]).indexOf(ot(n))===-1,accessibilityProvider:this.instantiationService.createInstance(ie)}),this.disposables.add(this.tree),this.tree.onDidOpen(this.open,this,this.disposables),this.tree.onContextMenu(this.onListContextMenu,this,this.disposables),this.tree.onDidScroll(this.inputRenderer.clearValidation,this.inputRenderer,this.disposables),E.filter(this.tree.onDidChangeCollapseState,n=>I(n.node.element?.element),this.disposables)(this.updateRepositoryCollapseAllContextKeys,this,this.disposables),this.disposables.add(Oe(n=>{this.tree.updateOptions({compressionEnabled:r.read(n)})})),v(e,o)}async open(e){if(e.element){if(I(e.element)){this.scmViewService.focus(e.element);return}else if(x(e.element)){this.scmViewService.focus(e.element.repository);const i=this.inputRenderer.getRenderedInputWidget(e.element);if(i){i.focus(),this.tree.setFocus([],e.browserEvent);const o=this.tree.getSelection();o.length===1&&o[0]===e.element&&setTimeout(()=>this.tree.setSelection([]))}return}else if(_(e.element)){this.scmViewService.focus(e.element.repository),this.actionButtonRenderer.focusActionButton(e.element),this.tree.setFocus([],e.browserEvent);return}else if(w(e.element)){const i=e.element.provider,o=q.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o);return}else if(L(e.element)){if(e.element.command?.id===Si||e.element.command?.id===gi)if(ht(e.browserEvent)&&e.browserEvent.button===1){const s=e.element.resourceGroup,a=`${s.provider.label}: ${s.label}`;await Di.openMultiFileDiffEditor(this.editorService,a,s.provider.rootUri,s.id,{...e.editorOptions,viewState:{revealData:{resource:{original:e.element.multiDiffEditorOriginalUri,modified:e.element.multiDiffEditorModifiedUri}}},preserveFocus:!0})}else await this.commandService.executeCommand(e.element.command.id,...e.element.command.arguments||[],e);else if(await e.element.open(!!e.editorOptions.preserveFocus),e.editorOptions.pinned){const s=this.editorService.activeEditorPane;s?.group.pinEditor(s.input)}const i=e.element.resourceGroup.provider,o=q.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o)}else if($(e.element)){const i=e.element.context.provider,o=q.find(this.scmService.repositories,s=>s.provider===i);o&&this.scmViewService.focus(o);return}}else return}onDidActiveEditorChange(){if(!this.configurationService.getValue("scm.autoReveal"))return;const e=yi.getOriginalUri(this.editorService.activeEditor,{supportSideBySide:Ci.PRIMARY});e&&(this.tree.getFocus().some(i=>L(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))&&this.tree.getSelection().some(i=>L(i)&&this.uriIdentityService.extUri.isEqual(i.sourceUri,e))||this.revealResourceThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{for(const i of this.scmViewService.visibleRepositories)if(this.items.get(i))for(let s=i.provider.groups.length-1;s>=0;s--){const a=i.provider.groups[s],r=this.viewMode==="tree"?a.resourceTree.getNode(e)?.element:a.resources.find(n=>this.uriIdentityService.extUri.isEqual(n.sourceUri,e));if(r){await this.tree.expandTo(r),this.tree.reveal(r),this.tree.setSelection([r]),this.tree.setFocus([r]);return}}})))}onDidChangeVisibleRepositories({added:e,removed:i}){for(const o of e){const s=new S;s.add(o.provider.onDidChange(()=>this.updateChildren(o))),s.add(o.input.onDidChangeVisibility(()=>this.updateChildren(o))),s.add(o.provider.onDidChangeResourceGroups(()=>this.updateChildren(o)));const a=s.add(new We),r=()=>{for(const[n]of a)o.provider.groups.includes(n)||a.deleteAndDispose(n);for(const n of o.provider.groups)if(!a.has(n)){const l=new S;l.add(n.onDidChange(()=>this.updateChildren(o))),l.add(n.onDidChangeResources(()=>this.updateChildren(o))),a.set(n,l)}};s.add(o.provider.onDidChangeResourceGroups(r)),r(),this.items.set(o,s)}for(const o of i)this.items.deleteAndDispose(o);this.updateChildren(),this.onDidActiveEditorChange()}onListContextMenu(e){if(!e.element){const r=this.menuService.getMenuActions(W.ViewSort,this.contextKeyService),n=[];return ei(r,n),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>n,onHide:()=>{}})}const i=e.element;let o=i,s=[],a=new it(()=>this.getSelectedResources());if(I(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.provider).repositoryContextMenu;o=i.provider,a=new Ai(()=>this.getSelectedRepositories()),s=ee(n)}else if(!(x(i)||_(i))){if(w(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.provider).getResourceGroupMenu(i);s=ee(n)}else if(L(i)){const n=this.scmViewService.menus.getRepositoryMenus(i.resourceGroup.provider).getResourceMenu(i);s=ee(n)}else if($(i))if(i.element){const n=this.scmViewService.menus.getRepositoryMenus(i.element.resourceGroup.provider).getResourceMenu(i.element);s=ee(n)}else{const n=this.scmViewService.menus.getRepositoryMenus(i.context.provider).getResourceFolderMenu(i.context);s=ee(n)}}a.onWillRun(()=>this.tree.domFocus()),this.contextMenuService.showContextMenu({getAnchor:()=>e.anchor,getActions:()=>s,getActionsContext:()=>o,actionRunner:a})}getSelectedRepositories(){const e=this.tree.getFocus().filter(o=>!!o&&I(o)),i=this.tree.getSelection().filter(o=>!!o&&I(o));return Array.from(new Set([...e,...i]))}getSelectedResources(){return this.tree.getSelection().filter(e=>!!e&&!w(e))}getViewMode(){let e=this.configurationService.getValue("scm.defaultViewMode")==="list"?"list":"tree";const i=this.storageService.get("scm.viewMode",B.WORKSPACE);return typeof i=="string"&&(e=i),e}getViewSortKey(){if(this._viewMode==="tree")return"path";let e;switch(this.configurationService.getValue("scm.defaultViewSortKey")){case"name":e="name";break;case"status":e="status";break;default:e="path";break}const o=this.storageService.get("scm.viewSortKey",B.WORKSPACE);return typeof o=="string"&&(e=o),e}loadTreeViewState(){const e=this.storageService.get("scm.viewState2",B.WORKSPACE);if(e)try{return JSON.parse(e)}catch{return}}storeTreeViewState(){this.tree&&this.storageService.store("scm.viewState2",JSON.stringify(this.tree.getViewState()),B.WORKSPACE,le.MACHINE)}updateChildren(e){this.updateChildrenThrottler.queue(()=>this.treeOperationSequencer.queue(async()=>{const i=this.inputRenderer.getFocusedInput();e&&this.tree.hasNode(e)?await this.tree.updateChildren(e):await this.tree.updateChildren(void 0),i&&this.inputRenderer.getRenderedInputWidget(i)?.focus(),this.updateScmProviderContextKeys(),this.updateRepositoryCollapseAllContextKeys()}))}updateIndentStyles(e){this.treeContainer.classList.toggle("list-view-mode",this.viewMode==="list"),this.treeContainer.classList.toggle("tree-view-mode",this.viewMode==="tree"),this.treeContainer.classList.toggle("align-icons-and-twisties",this.viewMode==="list"&&e.hasFileIcons||e.hasFileIcons&&!e.hasFolderIcons),this.treeContainer.classList.toggle("hide-arrows",this.viewMode==="tree"&&e.hidesExplorerArrows===!0)}updateScmProviderContextKeys(){if(!this.configurationService.getValue("scm.alwaysShowRepositories")&&this.items.size===1){const i=q.first(this.items.keys()).provider;this.scmProviderContextKey.set(i.contextValue),this.scmProviderRootUriContextKey.set(i.rootUri?.toString()),this.scmProviderHasRootUriContextKey.set(!!i.rootUri)}else this.scmProviderContextKey.set(void 0),this.scmProviderRootUriContextKey.set(void 0),this.scmProviderHasRootUriContextKey.set(!1)}updateRepositoryCollapseAllContextKeys(){if(!this.isBodyVisible()||this.items.size===1){this.isAnyRepositoryCollapsibleContextKey.set(!1),this.areAllRepositoriesCollapsedContextKey.set(!1);return}this.isAnyRepositoryCollapsibleContextKey.set(this.scmViewService.visibleRepositories.some(e=>this.tree.hasNode(e)&&this.tree.isCollapsible(e))),this.areAllRepositoriesCollapsedContextKey.set(this.scmViewService.visibleRepositories.every(e=>this.tree.hasNode(e)&&(!this.tree.isCollapsible(e)||this.tree.isCollapsed(e))))}collapseAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.collapse(e)}expandAllRepositories(){for(const e of this.scmViewService.visibleRepositories)this.tree.isCollapsible(e)&&this.tree.expand(e)}focusPreviousInput(){this.treeOperationSequencer.queue(()=>this.focusInput(-1))}focusNextInput(){this.treeOperationSequencer.queue(()=>this.focusInput(1))}async focusInput(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;let i=this.scmViewService.focusedRepository.input;const o=this.scmViewService.visibleRepositories;if(!(o.length===1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0)){if(o.length>1&&this.inputRenderer.getRenderedInputWidget(i)?.hasFocus()===!0){const s=o.indexOf(this.scmViewService.focusedRepository),a=ye(s+e,o.length);i=o[a].input}await this.tree.expandTo(i),this.tree.reveal(i),this.inputRenderer.getRenderedInputWidget(i)?.focus()}}focusPreviousResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(-1))}focusNextResourceGroup(){this.treeOperationSequencer.queue(()=>this.focusResourceGroup(1))}async focusResourceGroup(e){if(!this.scmViewService.focusedRepository||this.scmViewService.visibleRepositories.length===0)return;const i=pt(this.tree.getHTMLElement()),o=this.scmViewService.focusedRepository.provider.groups,s=this.tree.getFocus().find(n=>w(n)),a=i&&s?o.indexOf(s):-1;let r;if(a===-1){for(const n of o)if(this.tree.hasNode(n)){r=n;break}}else{let n=ye(a+e,o.length);for(;n!==a;){if(this.tree.hasNode(o[n])){r=o[n];break}n=ye(n+e,o.length)}}r&&(await this.tree.expandTo(r),this.tree.reveal(r),this.tree.setSelection([r]),this.tree.setFocus([r]),this.tree.domFocus())}shouldShowWelcome(){return this.scmService.repositoryCount===0}getActionsContext(){return this.scmViewService.visibleRepositories.length===1?this.scmViewService.visibleRepositories[0].provider:void 0}focus(){super.focus(),this.treeOperationSequencer.queue(()=>new Promise(e=>{if(this.isExpanded()){if(this.tree.getFocus().length===0)for(const i of this.scmViewService.visibleRepositories){const o=this.inputRenderer.getRenderedInputWidget(i.input);if(o){o.focus(),e();return}}this.tree.domFocus(),e()}}))}dispose(){this.visibilityDisposables.dispose(),this.disposables.dispose(),this.items.dispose(),super.dispose()}};ue=R([d(1,we),d(2,wi),d(3,$e),d(4,Ze),d(5,U),d(6,De),d(7,hi),d(8,Te),d(9,Xe),d(10,de),d(11,Re),d(12,Ii),d(13,be),d(14,Z),d(15,Je),d(16,Ye),d(17,ni)],ue);let ne=class extends ge{constructor(e,i,o){super();this.viewMode=e;this.configurationService=i;this.scmViewService=o}async getChildren(e){const i=this.scmViewService.visibleRepositories.length,o=this.configurationService.getValue("scm.showActionButton")===!0,s=this.configurationService.getValue("scm.alwaysShowRepositories")===!0;if(xe(e)&&(i>1||s))return this.scmViewService.visibleRepositories;if(xe(e)&&i===1&&!s||I(e)){const a=[];e=I(e)?e:this.scmViewService.visibleRepositories[0];const r=e.provider.actionButton,n=e.provider.groups;return e.input.visible&&a.push(e.input),o&&r&&a.push({type:"actionButton",repository:e,button:r}),(n.some(h=>h.resources.length>0)||i===1&&(!o||!r))&&a.push(...n),a}else if(w(e)){if(this.viewMode()==="list")return e.resources;if(this.viewMode()==="tree"){const a=[];for(const r of e.resourceTree.root.children)a.push(r.element&&r.childrenCount===0?r.element:r);return a}}else if($(e)){const a=[];for(const r of e.children)a.push(r.element&&r.childrenCount===0?r.element:r);return a}return[]}getParent(e){if($(e)){if(e.parent===e.context.resourceTree.root)return e.context;if(e.parent)return e.parent;throw new Error("Invalid element passed to getParent")}else if(L(e)){if(this.viewMode()==="list")return e.resourceGroup;const o=e.resourceGroup.resourceTree.getNode(e.sourceUri)?.parent;if(!o)throw new Error("Invalid element passed to getParent");return o===e.resourceGroup.resourceTree.root?e.resourceGroup:o}else{if(x(e))return e.repository;if(w(e)){const i=this.scmViewService.visibleRepositories.find(o=>o.provider===e.provider);if(!i)throw new Error("Invalid element passed to getParent");return i}else throw new Error("Unexpected call to getParent")}}hasChildren(e){if(xe(e))return this.scmViewService.visibleRepositories.length!==0;if(I(e))return!0;if(x(e))return!1;if(_(e))return!1;if(w(e))return!0;if(L(e))return!1;if(C.isResourceNode(e))return e.childrenCount>0;throw new Error("hasChildren not implemented.")}};ne=R([d(1,be),d(2,U)],ne);class eo{constructor(t,e,i,o){this.container=t;this.contextMenuService=e;this.commandService=i;this.notificationService=o}button;disposables=new Se;dispose(){this.disposables?.dispose()}setButton(t){if(this.clear(),!!t){if(t.secondaryCommands?.length){const e=[];for(let i=0;i<t.secondaryCommands.length;i++){const o=t.secondaryCommands[i];for(const s of o)e.push(new ve(s.id,s.title,void 0,!0,async()=>await this.executeCommand(s.id,...s.arguments||[])));o.length&&e.push(new yt)}e.pop(),this.button=new gt(this.container,{actions:e,addPrimaryActionToDropdown:!1,contextMenuProvider:this.contextMenuService,title:t.command.tooltip,supportIcons:!0,...Qe})}else this.button=new Pe(this.container,{supportIcons:!0,supportShortLabel:!!t.description,title:t.command.tooltip,...Qe});this.button.enabled=t.enabled,this.button.label=t.command.title,this.button instanceof Pe&&t.description&&(this.button.labelShort=t.description),this.button.onDidClick(async()=>await this.executeCommand(t.command.id,...t.command.arguments||[]),null,this.disposables.value),this.disposables.value.add(this.button)}}focus(){this.button?.focus()}clear(){this.disposables.value=new S,this.button=void 0,lt(this.container)}async executeCommand(t,...e){try{await this.commandService.executeCommand(t,...e)}catch(i){this.notificationService.error(i)}}}Vi(".scm-view .scm-editor-container");export{z as ActionButtonRenderer,p as ContextKeys,ie as SCMAccessibilityProvider,eo as SCMActionButton,te as SCMTreeKeyboardNavigationLabelProvider,Bi as SCMTreeSorter,ue as SCMViewPane};
