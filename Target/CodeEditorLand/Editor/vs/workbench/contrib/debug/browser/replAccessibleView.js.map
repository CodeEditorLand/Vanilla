{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/debug/browser/replAccessibleView.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { AccessibleViewProviderId, AccessibleViewType, IAccessibleViewContentProvider, IAccessibleViewService } from '../../../../platform/accessibility/browser/accessibleView.js';\nimport { AccessibilityVerbositySettingId } from '../../accessibility/browser/accessibilityConfiguration.js';\nimport { IReplElement } from '../common/debug.js';\nimport { IAccessibleViewImplentation } from '../../../../platform/accessibility/browser/accessibleViewRegistry.js';\nimport { ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { getReplView, Repl } from './repl.js';\nimport { IViewsService } from '../../../services/views/common/viewsService.js';\nimport { ContextKeyExpr } from '../../../../platform/contextkey/common/contextkey.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { Position } from '../../../../editor/common/core/position.js';\n\nexport class ReplAccessibleView implements IAccessibleViewImplentation {\n\tpriority = 70;\n\tname = 'debugConsole';\n\twhen = ContextKeyExpr.equals('focusedView', 'workbench.panel.repl.view');\n\ttype: AccessibleViewType = AccessibleViewType.View;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst viewsService = accessor.get(IViewsService);\n\t\tconst accessibleViewService = accessor.get(IAccessibleViewService);\n\t\tconst replView = getReplView(viewsService);\n\t\tif (!replView) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst focusedElement = replView.getFocusedElement();\n\t\treturn new ReplOutputAccessibleViewProvider(replView, focusedElement, accessibleViewService);\n\t}\n}\n\nclass ReplOutputAccessibleViewProvider extends Disposable implements IAccessibleViewContentProvider {\n\tpublic readonly id = AccessibleViewProviderId.Repl;\n\tprivate _content: string | undefined;\n\tprivate readonly _onDidChangeContent: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeContent: Event<void> = this._onDidChangeContent.event;\n\tprivate readonly _onDidResolveChildren: Emitter<void> = this._register(new Emitter<void>());\n\tpublic readonly onDidResolveChildren: Event<void> = this._onDidResolveChildren.event;\n\n\tpublic readonly verbositySettingKey = AccessibilityVerbositySettingId.Debug;\n\tpublic readonly options = {\n\t\ttype: AccessibleViewType.View\n\t};\n\n\tprivate _elementPositionMap: Map<string, Position> = new Map<string, Position>();\n\tprivate _treeHadFocus = false;\n\n\tconstructor(\n\t\tprivate readonly _replView: Repl,\n\t\tprivate readonly _focusedElement: IReplElement | undefined,\n\t\t@IAccessibleViewService private readonly _accessibleViewService: IAccessibleViewService) {\n\t\tsuper();\n\t\tthis._treeHadFocus = !!_focusedElement;\n\t}\n\tpublic provideContent(): string {\n\t\tconst debugSession = this._replView.getDebugSession();\n\t\tif (!debugSession) {\n\t\t\treturn 'No debug session available.';\n\t\t}\n\t\tconst elements = debugSession.getReplElements();\n\t\tif (!elements.length) {\n\t\t\treturn 'No output in the debug console.';\n\t\t}\n\t\tif (!this._content) {\n\t\t\tthis._updateContent(elements);\n\t\t}\n\t\t// Content is loaded asynchronously, so we need to check if it's available or fallback to the elements that are already available.\n\t\treturn this._content ?? elements.map(e => e.toString(true)).join('\\n');\n\t}\n\n\tpublic onClose(): void {\n\t\tthis._content = undefined;\n\t\tthis._elementPositionMap.clear();\n\t\tif (this._treeHadFocus) {\n\t\t\treturn this._replView.focusTree();\n\t\t}\n\t\tthis._replView.getReplInput().focus();\n\t}\n\n\tpublic onOpen(): void {\n\t\t// Children are resolved async, so we need to update the content when they are resolved.\n\t\tthis._register(this.onDidResolveChildren(() => {\n\t\t\tthis._onDidChangeContent.fire();\n\t\t\tqueueMicrotask(() => {\n\t\t\t\tif (this._focusedElement) {\n\t\t\t\t\tconst position = this._elementPositionMap.get(this._focusedElement.getId());\n\t\t\t\t\tif (position) {\n\t\t\t\t\t\tthis._accessibleViewService.setPosition(position, true);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\t\t}));\n\t}\n\n\tprivate async _updateContent(elements: IReplElement[]) {\n\t\tconst dataSource = this._replView.getReplDataSource();\n\t\tif (!dataSource) {\n\t\t\treturn;\n\t\t}\n\t\tlet line = 1;\n\t\tconst content: string[] = [];\n\t\tfor (const e of elements) {\n\t\t\tcontent.push(e.toString().replace(/\\n/g, ''));\n\t\t\tthis._elementPositionMap.set(e.getId(), new Position(line, 1));\n\t\t\tline++;\n\t\t\tif (dataSource.hasChildren(e)) {\n\t\t\t\tconst childContent: string[] = [];\n\t\t\t\tconst children = await dataSource.getChildren(e);\n\t\t\t\tfor (const child of children) {\n\t\t\t\t\tconst id = child.getId();\n\t\t\t\t\tif (!this._elementPositionMap.has(id)) {\n\t\t\t\t\t\t// don't overwrite parent position\n\t\t\t\t\t\tthis._elementPositionMap.set(id, new Position(line, 1));\n\t\t\t\t\t}\n\t\t\t\t\tchildContent.push('  ' + child.toString());\n\t\t\t\t\tline++;\n\t\t\t\t}\n\t\t\t\tcontent.push(childContent.join('\\n'));\n\t\t\t}\n\t\t}\n\n\t\tthis._content = content.join('\\n');\n\t\tthis._onDidResolveChildren.fire();\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
