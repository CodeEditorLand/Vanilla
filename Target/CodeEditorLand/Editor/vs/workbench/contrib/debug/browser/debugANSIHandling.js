import{Color as p,RGBA as A}from"../../../../base/common/color.js";import{isDefined as w}from"../../../../base/common/types.js";import{editorHoverBackground as F}from"../../../../platform/theme/common/colorRegistry.js";import{registerThemingParticipant as L}from"../../../../platform/theme/common/themeService.js";import"../../../../platform/workspace/common/workspace.js";import{PANEL_BACKGROUND as D,SIDE_BAR_BACKGROUND as M}from"../../../common/theme.js";import{ansiColorIdentifiers as v}from"../../terminal/common/terminalColorRegistry.js";import"./linkDetector.js";function x(i,a,s){const f=document.createElement("span"),u=i.length;let r=[],d,c,b,m=!1,l=0,h="";for(;l<u;){let n=!1;if(i.charCodeAt(l)===27&&i.charAt(l+1)==="["){const o=l;l+=2;let e="";for(;l<u;){const t=i.charAt(l);if(e+=t,l++,t.match(/^[ABCDHIJKfhmpsu]$/)){n=!0;break}}if(n){if(G(f,h,r,a,s,d,c,b),h="",e.match(/^(?:[34][0-8]|9[0-7]|10[0-7]|[0-9]|2[1-5,7-9]|[34]9|5[8,9]|1[0-9])(?:;[349][0-7]|10[0-7]|[013]|[245]|[34]9)?(?:;[012]?[0-9]?[0-9])*;?m$/)){const t=e.slice(0,-1).split(";").filter(k=>k!=="").map(k=>parseInt(k,10));if(t[0]===38||t[0]===48||t[0]===58){const k=t[0]===38?"foreground":t[0]===48?"background":"underline";t[1]===5?$(t,k):t[1]===2&&S(t,k)}else I(t)}}else l=o}n===!1&&(h+=i.charAt(l),l++)}return h&&G(f,h,r,a,s,d,c,b),f;function g(n,o){n==="foreground"?d=o:n==="background"?c=o:n==="underline"&&(b=o),r=r.filter(e=>e!==`code-${n}-colored`),o!==void 0&&r.push(`code-${n}-colored`)}function B(){const n=d;g("foreground",c),g("background",n)}function I(n){for(const o of n)switch(o){case 0:{r=[],d=void 0,c=void 0;break}case 1:{r=r.filter(e=>e!=="code-bold"),r.push("code-bold");break}case 2:{r=r.filter(e=>e!=="code-dim"),r.push("code-dim");break}case 3:{r=r.filter(e=>e!=="code-italic"),r.push("code-italic");break}case 4:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline"),r.push("code-underline");break}case 5:{r=r.filter(e=>e!=="code-blink"),r.push("code-blink");break}case 6:{r=r.filter(e=>e!=="code-rapid-blink"),r.push("code-rapid-blink");break}case 7:{m||(m=!0,B());break}case 8:{r=r.filter(e=>e!=="code-hidden"),r.push("code-hidden");break}case 9:{r=r.filter(e=>e!=="code-strike-through"),r.push("code-strike-through");break}case 10:{r=r.filter(e=>!e.startsWith("code-font"));break}case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:{r=r.filter(e=>!e.startsWith("code-font")),r.push(`code-font-${o-10}`);break}case 21:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline"),r.push("code-double-underline");break}case 22:{r=r.filter(e=>e!=="code-bold"&&e!=="code-dim");break}case 23:{r=r.filter(e=>e!=="code-italic"&&e!=="code-font-10");break}case 24:{r=r.filter(e=>e!=="code-underline"&&e!=="code-double-underline");break}case 25:{r=r.filter(e=>e!=="code-blink"&&e!=="code-rapid-blink");break}case 27:{m&&(m=!1,B());break}case 28:{r=r.filter(e=>e!=="code-hidden");break}case 29:{r=r.filter(e=>e!=="code-strike-through");break}case 53:{r=r.filter(e=>e!=="code-overline"),r.push("code-overline");break}case 55:{r=r.filter(e=>e!=="code-overline");break}case 39:{g("foreground",void 0);break}case 49:{g("background",void 0);break}case 59:{g("underline",void 0);break}case 73:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript"),r.push("code-superscript");break}case 74:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript"),r.push("code-subscript");break}case 75:{r=r.filter(e=>e!=="code-superscript"&&e!=="code-subscript");break}default:{R(o);break}}}function S(n,o){if(n.length>=5&&n[2]>=0&&n[2]<=255&&n[3]>=0&&n[3]<=255&&n[4]>=0&&n[4]<=255){const e=new A(n[2],n[3],n[4]);g(o,e)}}function $(n,o){let e=n[2];const t=E(e);if(t)g(o,t);else if(e>=0&&e<=15){if(o==="underline"){const k=v[e];g(o,`--vscode-debug-ansi-${k}`);return}e+=30,e>=38&&(e+=52),o==="background"&&(e+=10),R(e)}}function R(n){let o,e;if(n>=30&&n<=37?(e=n-30,o="foreground"):n>=90&&n<=97?(e=n-90+8,o="foreground"):n>=40&&n<=47?(e=n-40,o="background"):n>=100&&n<=107&&(e=n-100+8,o="background"),e!==void 0&&o){const t=v[e];g(o,`--vscode-debug-ansi-${t.replaceAll(".","-")}`)}}}function G(i,a,s,f,u,r,d,c){if(!i||!a)return;const b=f.linkify(a,!0,u);b.className=s.join(" "),r&&(b.style.color=typeof r=="string"?`var(${r})`:p.Format.CSS.formatRGB(new p(r))),d&&(b.style.backgroundColor=typeof d=="string"?`var(${d})`:p.Format.CSS.formatRGB(new p(d))),c&&(b.style.textDecorationColor=typeof c=="string"?`var(${c})`:p.Format.CSS.formatRGB(new p(c))),i.appendChild(b)}function E(i){if(i%1===0)if(i>=16&&i<=231){i-=16;let a=i%6;i=(i-a)/6;let s=i%6;i=(i-s)/6;let f=i;const u=255/5;return a=Math.round(a*u),s=Math.round(s*u),f=Math.round(f*u),new A(f,s,a)}else if(i>=232&&i<=255){i-=232;const a=Math.round(i/23*255);return new A(a,a,a)}else return}L((i,a)=>{const s=[{selector:".monaco-workbench .sidebar, .monaco-workbench .auxiliarybar",bg:i.getColor(M)},{selector:".monaco-workbench .panel",bg:i.getColor(D)},{selector:".debug-hover-widget",bg:i.getColor(F)}];for(const{selector:f,bg:u}of s){const r=v.map(d=>{const c=i.getColor(d);if(c)return`--vscode-debug-ansi-${d.replaceAll(".","-")}:${u?u.ensureConstrast(c,4):c}`}).filter(w);a.addRule(`${f} { ${r.join(";")} }`)}});export{G as appendStylizedStringToContainer,E as calcANSI8bitColor,x as handleANSIOutput};
