var I=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var f=(a,r,e,o)=>{for(var t=o>1?void 0:o?C(r,e):r,i=a.length-1,n;i>=0;i--)(n=a[i])&&(t=(o?n(r,e,t):n(t))||t);return o&&t&&I(r,e,t),t},u=(a,r)=>(e,o)=>r(e,o,a);import"./media/exceptionWidget.css";import*as s from"../../../../base/browser/dom.js";import{ActionBar as x}from"../../../../base/browser/ui/actionbar/actionbar.js";import{Action as y}from"../../../../base/common/actions.js";import{RunOnceScheduler as k}from"../../../../base/common/async.js";import{ThemeIcon as v}from"../../../../base/common/themables.js";import{EditorOption as m}from"../../../../editor/common/config/editorOptions.js";import{ZoneWidget as T}from"../../../../editor/contrib/zoneWidget/browser/zoneWidget.js";import*as l from"../../../../nls.js";import{IInstantiationService as E}from"../../../../platform/instantiation/common/instantiation.js";import{registerColor as g}from"../../../../platform/theme/common/colorRegistry.js";import{widgetClose as w}from"../../../../platform/theme/common/iconRegistry.js";import{IThemeService as S}from"../../../../platform/theme/common/themeService.js";import{EDITOR_CONTRIBUTION_ID as D}from"../common/debug.js";import{DebugLinkHoverBehavior as _,LinkDetector as B}from"./linkDetector.js";const p=s.$,L=g("debugExceptionWidget.border","#a31515",l.localize("debugExceptionWidgetBorder","Exception widget border color.")),H=g("debugExceptionWidget.background",{dark:"#420b0d",light:"#f1dfde",hcDark:"#420b0d",hcLight:"#f1dfde"},l.localize("debugExceptionWidgetBackground","Exception widget background color."));let h=class extends T{constructor(e,o,t,i,n){super(e,{showFrame:!0,showArrow:!0,isAccessible:!0,frameWidth:1,className:"exception-widget-container"});this.exceptionInfo=o;this.debugSession=t;this.instantiationService=n;this.applyTheme(i.getColorTheme()),this._disposables.add(i.onDidColorThemeChange(this.applyTheme.bind(this))),this.create();const c=new k(()=>this._doLayout(void 0,void 0),50);this._disposables.add(this.editor.onDidLayoutChange(()=>c.schedule())),this._disposables.add(c)}backgroundColor;applyTheme(e){this.backgroundColor=e.getColor(H);const o=e.getColor(L);this.style({arrowColor:o,frameColor:o})}_applyStyles(){this.container&&(this.container.style.backgroundColor=this.backgroundColor?this.backgroundColor.toString():""),super._applyStyles()}_fillContainer(e){this.setCssClass("exception-widget");const o=this.editor.getOption(m.fontInfo);e.style.fontSize=`${o.fontSize}px`,e.style.lineHeight=`${o.lineHeight}px`,e.tabIndex=0;const t=p(".title"),i=p(".label");s.append(t,i);const n=p(".actions");s.append(t,n),i.textContent=this.exceptionInfo.id?l.localize("exceptionThrownWithId","Exception has occurred: {0}",this.exceptionInfo.id):l.localize("exceptionThrown","Exception has occurred.");let c=i.textContent;if(new x(n).push(new y("editor.closeExceptionWidget",l.localize("close","Close"),v.asClassName(w),!0,async()=>{this.editor.getContribution(D)?.closeExceptionWidget()}),{label:!1,icon:!0}),s.append(e,t),this.exceptionInfo.description){const d=p(".description");d.textContent=this.exceptionInfo.description,c+=", "+this.exceptionInfo.description,s.append(e,d)}if(this.exceptionInfo.details&&this.exceptionInfo.details.stackTrace){const d=p(".stack-trace"),b=this.instantiationService.createInstance(B).linkify(this.exceptionInfo.details.stackTrace,!0,this.debugSession?this.debugSession.root:void 0,void 0,{type:_.Rich,store:this._disposables});d.appendChild(b),s.append(e,d),c+=", "+this.exceptionInfo.details.stackTrace}e.setAttribute("aria-label",c)}_doLayout(e,o){this.container.style.height="initial";const t=this.editor.getOption(m.lineHeight),i=Math.round(t/3),n=Math.ceil((this.container.offsetHeight+i)/t);this._relayout(n)}focus(){this.container?.focus()}hasFocus(){return this.container?s.isAncestorOfActiveElement(this.container):!1}};h=f([u(3,S),u(4,E)],h);export{h as ExceptionWidget};
