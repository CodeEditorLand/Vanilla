var V=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var v=(i,e,t,r)=>{for(var n=r>1?void 0:r?j(e,t):e,o=i.length-1,l;o>=0;o--)(l=i[o])&&(n=(r?l(e,t,n):l(n))||n);return r&&n&&V(e,t,n),n},p=(i,e)=>(t,r)=>e(t,r,i);import*as s from"../../../../base/browser/dom.js";import{CountBadge as F}from"../../../../base/browser/ui/countBadge/countBadge.js";import{HighlightedLabel as L}from"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as A}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{CachedListVirtualDelegate as P}from"../../../../base/browser/ui/list/list.js";import{createMatches as C}from"../../../../base/common/filters.js";import{Disposable as $,DisposableStore as f}from"../../../../base/common/lifecycle.js";import{basename as G}from"../../../../base/common/path.js";import R from"../../../../base/common/severity.js";import{ThemeIcon as B}from"../../../../base/common/themables.js";import{localize as b}from"../../../../nls.js";import{IContextViewService as W}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as H}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as w}from"../../../../platform/instantiation/common/instantiation.js";import{ILabelService as k}from"../../../../platform/label/common/label.js";import{defaultCountBadgeStyles as U}from"../../../../platform/theme/browser/defaultStyles.js";import{IEditorService as q}from"../../../services/editor/common/editorService.js";import{IDebugService as J}from"../common/debug.js";import{Variable as g}from"../common/debugModel.js";import{RawObjectReplElement as K,ReplEvaluationInput as z,ReplEvaluationResult as h,ReplGroup as O,ReplOutputElement as E,ReplVariableElement as S}from"../common/replModel.js";import{AbstractExpressionsRenderer as Q}from"./baseDebugView.js";import{debugConsoleEvaluationInput as X}from"./debugIcons.js";const a=s.$;class T{static ID="replEvaluationInput";get templateId(){return T.ID}renderTemplate(e){s.append(e,a("span.arrow"+B.asCSSSelector(X)));const t=s.append(e,a(".expression"));return{label:new L(t)}}renderElement(e,t,r){const n=e.element;r.label.set(n.value,C(e.filterData))}disposeTemplate(e){e.label.dispose()}}let u=class{constructor(e,t){this.expressionRenderer=e;this.instaService=t}static ID="replGroup";get templateId(){return u.ID}renderTemplate(e){e.classList.add("group");const t=s.append(e,a(".output.expression.value-and-source")),r=s.append(t,a("span.label")),n=this.instaService.createInstance(I,t);return{label:r,source:n}}renderElement(e,t,r){r.elementDisposable?.dispose();const n=e.element;s.clearNode(r.label),r.elementDisposable=this.expressionRenderer.renderValue(r.label,n.name,{wasANSI:!0,session:e.element.session}),r.source.setSource(n.sourceData)}disposeTemplate(e){e.elementDisposable?.dispose(),e.source.dispose()}};u=v([p(1,w)],u);class x{constructor(e){this.expressionRenderer=e}static ID="replEvaluationResult";get templateId(){return x.ID}renderTemplate(e){const t=s.append(e,a(".evaluation-result.expression"));return{value:s.append(t,a("span.value")),elementStore:new f}}renderElement(e,t,r){r.elementStore.clear();const n=e.element;r.elementStore.add(this.expressionRenderer.renderValue(r.value,n,{colorize:!0,hover:!1,session:e.element.getSession()}))}disposeTemplate(e){e.elementStore.dispose()}}let c=class{constructor(e,t){this.expressionRenderer=e;this.instaService=t}static ID="outputReplElement";get templateId(){return c.ID}renderTemplate(e){const t=Object.create(null);e.classList.add("output");const r=s.append(e,a(".output.expression.value-and-source"));return t.container=e,t.countContainer=s.append(r,a(".count-badge-wrapper")),t.count=new F(t.countContainer,{},U),t.value=s.append(r,a("span.value.label")),t.source=this.instaService.createInstance(I,r),t.elementDisposable=new f,t}renderElement({element:e},t,r){r.elementDisposable.clear(),this.setElementCount(e,r),r.elementDisposable.add(e.onDidChangeCount(()=>this.setElementCount(e,r))),s.clearNode(r.value),r.value.className="value";const n=e.expression?.valueLocationReference;r.elementDisposable.add(this.expressionRenderer.renderValue(r.value,e.value,{wasANSI:!0,session:e.session,locationReference:n})),r.value.classList.add(e.severity===R.Warning?"warn":e.severity===R.Error?"error":e.severity===R.Ignore?"ignore":"info"),r.source.setSource(e.sourceData),r.getReplElementSource=()=>e.sourceData}setElementCount(e,t){e.count>=2?(t.count.setCount(e.count),t.countContainer.hidden=!1):t.countContainer.hidden=!0}disposeTemplate(e){e.source.dispose(),e.elementDisposable.dispose()}disposeElement(e,t,r){r.elementDisposable.clear()}};c=v([p(1,w)],c);let m=class extends Q{constructor(t,r,n,o){super(r,n,o);this.expressionRenderer=t}static ID="replVariable";get templateId(){return m.ID}renderElement(t,r,n){const o=t.element;n.elementDisposable.clear(),super.renderExpressionElement(o instanceof S?o.expression:o,t,n)}renderExpression(t,r,n){const o=t instanceof S;if(o||!t.name){r.label.set("");const l=o?t.expression:t;r.elementDisposable.add(this.expressionRenderer.renderValue(r.value,l,{colorize:!0,hover:!1,session:t.getSession()})),r.expression.classList.remove("nested-variable")}else r.elementDisposable.add(this.expressionRenderer.renderVariable(r,t,{showChanged:!0,highlights:n})),r.expression.classList.toggle("nested-variable",D(t))}getInputBoxOptions(t){}};m=v([p(1,J),p(2,W),p(3,H)],m);class y{constructor(e){this.expressionRenderer=e}static ID="rawObject";get templateId(){return y.ID}renderTemplate(e){e.classList.add("output");const t=s.append(e,a(".output.expression")),r=s.append(t,a("span.name")),n=new L(r),o=s.append(t,a("span.value"));return{container:e,expression:t,name:r,label:n,value:o,elementStore:new f}}renderElement(e,t,r){r.elementStore.clear();const n=e.element;r.label.set(n.name?`${n.name}:`:"",C(e.filterData)),n.name?r.name.textContent=`${n.name}:`:r.name.textContent="",r.elementStore.add(this.expressionRenderer.renderValue(r.value,n.value,{hover:!1,session:e.element.getSession()}))}disposeTemplate(e){e.elementStore.dispose(),e.label.dispose()}}function D(i){return i instanceof g&&(i.parent instanceof h||i.parent instanceof g)}class fe extends P{constructor(t,r){super();this.configurationService=t;this.replOptions=r}getHeight(t){return this.configurationService.getValue("debug").console.wordWrap?super.getHeight(t):this.estimateHeight(t,!0)}estimateHeight(t,r=!1){const n=this.replOptions.replConfiguration.lineHeight,o=d=>d.match(/\n/g)?.length??0;if((d=>typeof d.value=="string")(t)&&!D(t)){const d=t.value,M=o(d)+(r?0:Math.floor(d.length/70))+(t instanceof E?0:1);return Math.max(M,1)*n}return n}getTemplateId(t){return t instanceof g||t instanceof S?m.ID:t instanceof h?x.ID:t instanceof z?T.ID:t instanceof E?c.ID:t instanceof O?u.ID:y.ID}hasDynamicHeight(t){return D(t)?!1:t.toString().length>0}}function N(i){return typeof i.getReplElements=="function"}class Re{hasChildren(e){return N(e)?!0:!!e.hasChildren}getChildren(e){return N(e)?Promise.resolve(e.getReplElements()):Promise.resolve(e.getChildren())}}class he{getWidgetAriaLabel(){return b("debugConsole","Debug Console")}getAriaLabel(e){return e instanceof g?b("replVariableAriaLabel","Variable {0}, value {1}",e.name,e.value):e instanceof E||e instanceof z||e instanceof h?e.value+(e instanceof E&&e.count>1?b({key:"occurred",comment:["Front will the value of the debug console element. Placeholder will be replaced by a number which represents occurrance count."]},", occurred {0} times",e.count):""):e instanceof K?b("replRawObjectAriaLabel","Debug console variable {0}, value {1}",e.name,e.value):e instanceof O?b("replGroup","Debug console group {0}",e.name):""}}let I=class extends ${constructor(t,r,n,o){super();this.hoverService=n;this.labelService=o;this.el=s.append(t,a(".source")),this._register(s.addDisposableListener(this.el,"click",l=>{l.preventDefault(),l.stopPropagation(),this.source&&this.source.source.openInEditor(r,{startLineNumber:this.source.lineNumber,startColumn:this.source.column,endLineNumber:this.source.lineNumber,endColumn:this.source.column})}))}el;source;hover;setSource(t){this.source=t,this.el.textContent=t?`${G(t.source.name)}:${t.lineNumber}`:"",this.hover??=this._register(this.hoverService.setupManagedHover(A("mouse"),this.el,"")),this.hover.update(t?`${this.labelService.getUriLabel(t.source.uri)}:${t.lineNumber}`:"")}};I=v([p(1,q),p(2,H),p(3,k)],I);export{he as ReplAccessibilityProvider,Re as ReplDataSource,fe as ReplDelegate,T as ReplEvaluationInputsRenderer,x as ReplEvaluationResultsRenderer,u as ReplGroupRenderer,c as ReplOutputElementRenderer,y as ReplRawObjectsRenderer,m as ReplVariablesRenderer};
