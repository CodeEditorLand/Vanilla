var j=Object.defineProperty;var A=Object.getOwnPropertyDescriptor;var I=(a,e,t,r)=>{for(var n=r>1?void 0:r?A(e,t):e,o=a.length-1,p;o>=0;o--)(p=a[o])&&(n=(r?p(e,t,n):p(n))||n);return r&&n&&j(e,t,n),n},s=(a,e)=>(t,r)=>e(t,r,a);import*as i from"../../../../base/browser/dom.js";import{CountBadge as P}from"../../../../base/browser/ui/countBadge/countBadge.js";import{HighlightedLabel as L}from"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as $}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{CachedListVirtualDelegate as G}from"../../../../base/browser/ui/list/list.js";import{createMatches as C}from"../../../../base/common/filters.js";import{Disposable as B,DisposableStore as H}from"../../../../base/common/lifecycle.js";import{basename as W}from"../../../../base/common/path.js";import g from"../../../../base/common/severity.js";import{ThemeIcon as U}from"../../../../base/common/themables.js";import{localize as b}from"../../../../nls.js";import{ICommandService as q}from"../../../../platform/commands/common/commands.js";import{IContextViewService as J}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as z}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as O}from"../../../../platform/instantiation/common/instantiation.js";import{ILabelService as K}from"../../../../platform/label/common/label.js";import{defaultCountBadgeStyles as Q}from"../../../../platform/theme/browser/defaultStyles.js";import{IThemeService as k}from"../../../../platform/theme/common/themeService.js";import{AbstractExpressionsRenderer as X,renderExpressionValue as h,renderVariable as Y}from"./baseDebugView.js";import{handleANSIOutput as w}from"./debugANSIHandling.js";import{debugConsoleEvaluationInput as Z}from"./debugIcons.js";import{IDebugService as _}from"../common/debug.js";import{Variable as f}from"../common/debugModel.js";import{RawObjectReplElement as ee,ReplEvaluationInput as N,ReplEvaluationResult as S,ReplGroup as M,ReplOutputElement as E,ReplVariableElement as D}from"../common/replModel.js";import{IEditorService as te}from"../../../services/editor/common/editorService.js";const l=i.$;class T{static ID="replEvaluationInput";get templateId(){return T.ID}renderTemplate(e){i.append(e,l("span.arrow"+U.asCSSSelector(Z)));const t=i.append(e,l(".expression"));return{label:new L(t)}}renderElement(e,t,r){const n=e.element;r.label.set(n.value,C(e.filterData))}disposeTemplate(e){e.label.dispose()}}let u=class{constructor(e,t,r){this.linkDetector=e;this.themeService=t;this.instaService=r}static ID="replGroup";get templateId(){return u.ID}renderTemplate(e){e.classList.add("group");const t=i.append(e,l(".output.expression.value-and-source")),r=i.append(t,l("span.label")),n=this.instaService.createInstance(d,t);return{label:r,source:n}}renderElement(e,t,r){const n=e.element;i.clearNode(r.label);const o=w(n.name,this.linkDetector,this.themeService,void 0);r.label.appendChild(o),r.source.setSource(n.sourceData)}disposeTemplate(e){e.source.dispose()}};u=I([s(1,k),s(2,O)],u);class x{constructor(e,t){this.linkDetector=e;this.hoverService=t}static ID="replEvaluationResult";get templateId(){return x.ID}renderTemplate(e){const t=i.append(e,l(".evaluation-result.expression"));return{value:i.append(t,l("span.value")),elementStore:new H}}renderElement(e,t,r){r.elementStore.clear();const n=e.element;h(r.elementStore,n,r.value,{colorize:!0,hover:!1,linkDetector:this.linkDetector},this.hoverService)}disposeTemplate(e){e.elementStore.dispose()}}let c=class{constructor(e,t,r){this.linkDetector=e;this.themeService=t;this.instaService=r}static ID="outputReplElement";get templateId(){return c.ID}renderTemplate(e){const t=Object.create(null);e.classList.add("output");const r=i.append(e,l(".output.expression.value-and-source"));return t.container=e,t.countContainer=i.append(r,l(".count-badge-wrapper")),t.count=new P(t.countContainer,{},Q),t.value=i.append(r,l("span.value.label")),t.source=this.instaService.createInstance(d,r),t}renderElement({element:e},t,r){this.setElementCount(e,r),r.elementListener=e.onDidChangeCount(()=>this.setElementCount(e,r)),i.clearNode(r.value),r.value.className="value";const n=e.expression?.valueLocationReference,o=n!==void 0?this.linkDetector.makeReferencedLinkDetector(n,e.session):this.linkDetector;r.value.appendChild(w(e.value,o,this.themeService,e.session.root)),r.value.classList.add(e.severity===g.Warning?"warn":e.severity===g.Error?"error":e.severity===g.Ignore?"ignore":"info"),r.source.setSource(e.sourceData),r.getReplElementSource=()=>e.sourceData}setElementCount(e,t){e.count>=2?(t.count.setCount(e.count),t.countContainer.hidden=!1):t.countContainer.hidden=!0}disposeTemplate(e){e.source.dispose()}disposeElement(e,t,r){r.elementListener.dispose()}};c=I([s(1,k),s(2,O)],c);let m=class extends X{constructor(t,r,n,o,p){super(r,n,p);this.linkDetector=t;this.commandService=o}static ID="replVariable";get templateId(){return m.ID}renderElement(t,r,n){const o=t.element;n.elementDisposable.clear(),super.renderExpressionElement(o instanceof D?o.expression:o,t,n)}renderExpression(t,r,n){const o=t instanceof D;o||!t.name?(r.label.set(""),h(r.elementDisposable,o?t.expression:t,r.value,{colorize:!0,linkDetector:this.linkDetector,hover:!1},this.hoverService),r.expression.classList.remove("nested-variable")):(Y(r.elementDisposable,this.commandService,this.hoverService,t,r,!0,n,this.linkDetector),r.expression.classList.toggle("nested-variable",R(t)))}getInputBoxOptions(t){}};m=I([s(1,_),s(2,J),s(3,q),s(4,z)],m);class y{constructor(e,t){this.linkDetector=e;this.hoverService=t}static ID="rawObject";get templateId(){return y.ID}renderTemplate(e){e.classList.add("output");const t=i.append(e,l(".output.expression")),r=i.append(t,l("span.name")),n=new L(r),o=i.append(t,l("span.value"));return{container:e,expression:t,name:r,label:n,value:o,elementStore:new H}}renderElement(e,t,r){r.elementStore.clear();const n=e.element;r.label.set(n.name?`${n.name}:`:"",C(e.filterData)),n.name?r.name.textContent=`${n.name}:`:r.name.textContent="",h(r.elementStore,n.value,r.value,{linkDetector:this.linkDetector,hover:!1},this.hoverService)}disposeTemplate(e){e.elementStore.dispose(),e.label.dispose()}}function R(a){return a instanceof f&&(a.parent instanceof S||a.parent instanceof f)}class _e extends G{constructor(t,r){super();this.configurationService=t;this.replOptions=r}getHeight(t){return this.configurationService.getValue("debug").console.wordWrap?super.getHeight(t):this.estimateHeight(t,!0)}estimateHeight(t,r=!1){const n=this.replOptions.replConfiguration.lineHeight,o=v=>v.match(/\n/g)?.length??0;if((v=>typeof v.value=="string")(t)&&!R(t)){const v=t.value,F=o(v)+(r?0:Math.floor(v.length/70))+(t instanceof E?0:1);return Math.max(F,1)*n}return n}getTemplateId(t){return t instanceof f||t instanceof D?m.ID:t instanceof S?x.ID:t instanceof N?T.ID:t instanceof E?c.ID:t instanceof M?u.ID:y.ID}hasDynamicHeight(t){return R(t)?!1:t.toString().length>0}}function V(a){return typeof a.getReplElements=="function"}class et{hasChildren(e){return V(e)?!0:!!e.hasChildren}getChildren(e){return V(e)?Promise.resolve(e.getReplElements()):Promise.resolve(e.getChildren())}}class tt{getWidgetAriaLabel(){return b("debugConsole","Debug Console")}getAriaLabel(e){return e instanceof f?b("replVariableAriaLabel","Variable {0}, value {1}",e.name,e.value):e instanceof E||e instanceof N||e instanceof S?e.value+(e instanceof E&&e.count>1?b({key:"occurred",comment:["Front will the value of the debug console element. Placeholder will be replaced by a number which represents occurrance count."]},", occurred {0} times",e.count):""):e instanceof ee?b("replRawObjectAriaLabel","Debug console variable {0}, value {1}",e.name,e.value):e instanceof M?b("replGroup","Debug console group {0}",e.name):""}}let d=class extends B{constructor(t,r,n,o){super();this.hoverService=n;this.labelService=o;this.el=i.append(t,l(".source")),this._register(i.addDisposableListener(this.el,"click",p=>{p.preventDefault(),p.stopPropagation(),this.source&&this.source.source.openInEditor(r,{startLineNumber:this.source.lineNumber,startColumn:this.source.column,endLineNumber:this.source.lineNumber,endColumn:this.source.column})}))}el;source;hover;setSource(t){this.source=t,this.el.textContent=t?`${W(t.source.name)}:${t.lineNumber}`:"",this.hover??=this._register(this.hoverService.setupManagedHover($("mouse"),this.el,"")),this.hover.update(t?`${this.labelService.getUriLabel(t.source.uri)}:${t.lineNumber}`:"")}};d=I([s(1,te),s(2,z),s(3,K)],d);export{tt as ReplAccessibilityProvider,et as ReplDataSource,_e as ReplDelegate,T as ReplEvaluationInputsRenderer,x as ReplEvaluationResultsRenderer,u as ReplGroupRenderer,c as ReplOutputElementRenderer,y as ReplRawObjectsRenderer,m as ReplVariablesRenderer};
