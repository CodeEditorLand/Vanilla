var ve=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var N=(n,e,r,t)=>{for(var a=t>1?void 0:t?Te(e,r):e,s=n.length-1,i;s>=0;s--)(i=n[s])&&(a=(t?i(e,r,a):i(a))||a);return t&&a&&ve(e,r,a),a},d=(n,e)=>(r,t)=>e(r,t,n);import*as p from"../../../../base/browser/dom.js";import{ActionBar as q}from"../../../../base/browser/ui/actionbar/actionbar.js";import{HighlightedLabel as X}from"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import{getDefaultHoverDelegate as O}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{Action as De}from"../../../../base/common/actions.js";import{RunOnceScheduler as ye}from"../../../../base/common/async.js";import{Codicon as Ce}from"../../../../base/common/codicons.js";import{Event as Le}from"../../../../base/common/event.js";import{createMatches as R}from"../../../../base/common/filters.js";import{DisposableStore as k,dispose as Ee}from"../../../../base/common/lifecycle.js";import{posix as ke}from"../../../../base/common/path.js";import{commonSuffixLength as Ae}from"../../../../base/common/strings.js";import{ThemeIcon as ae}from"../../../../base/common/themables.js";import{localize as S}from"../../../../nls.js";import{MenuEntryActionViewItem as Me,SubmenuEntryActionViewItem as we,createAndFillInActionBarActions as se,createAndFillInContextMenuActions as xe}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{IMenuService as G,MenuId as H,MenuItemAction as ne,MenuRegistry as Fe,SubmenuItemAction as Ne,registerAction2 as _e}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as Oe}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as A,IContextKeyService as Y}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as He}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as z}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as ie}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as ze}from"../../../../platform/keybinding/common/keybinding.js";import{ILabelService as Be}from"../../../../platform/label/common/label.js";import{WorkbenchCompressibleAsyncDataTree as Pe}from"../../../../platform/list/browser/listService.js";import{INotificationService as Re}from"../../../../platform/notification/common/notification.js";import{IOpenerService as Ve}from"../../../../platform/opener/common/opener.js";import{ITelemetryService as Ke}from"../../../../platform/telemetry/common/telemetry.js";import{asCssVariable as oe,textLinkForeground as le}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as Ue}from"../../../../platform/theme/common/themeService.js";import{ViewAction as je,ViewPane as $e}from"../../../browser/parts/views/viewPane.js";import{IViewDescriptorService as We}from"../../../common/views.js";import{CALLSTACK_VIEW_ID as ce,CONTEXT_CALLSTACK_ITEM_STOPPED as M,CONTEXT_CALLSTACK_ITEM_TYPE as v,CONTEXT_CALLSTACK_SESSION_HAS_ONE_THREAD as de,CONTEXT_CALLSTACK_SESSION_IS_ATTACH as J,CONTEXT_DEBUG_STATE as qe,CONTEXT_FOCUSED_SESSION_IS_NO_DEBUG as Xe,CONTEXT_STACK_FRAME_SUPPORTS_RESTART as Ge,IDebugService as Ye,State as V,getStateLabel as Je,isFrameDeemphasized as Q}from"../common/debug.js";import{StackFrame as b,Thread as T,ThreadAndSessionIds as B}from"../common/debugModel.js";import{isSessionAttach as Qe}from"../common/debugUtils.js";import{renderViewTree as Ze}from"./baseDebugView.js";import{CONTINUE_ID as et,CONTINUE_LABEL as tt,DISCONNECT_ID as pe,DISCONNECT_LABEL as rt,PAUSE_ID as at,PAUSE_LABEL as st,RESTART_LABEL as nt,RESTART_SESSION_ID as it,STEP_INTO_ID as ot,STEP_INTO_LABEL as lt,STEP_OUT_ID as ct,STEP_OUT_LABEL as dt,STEP_OVER_ID as pt,STEP_OVER_LABEL as ut,STOP_ID as ue,STOP_LABEL as mt}from"./debugCommands.js";import*as f from"./debugIcons.js";import{createDisconnectMenuItemAction as St}from"./debugToolBar.js";const m=p.$;function me(n,e){return e.sessionId=n.getId(),e}function Se(n,e){return e.threadId=n.getId(),me(n.session,e),e}function ht(n,e){return e.frameId=n.getId(),e.frameName=n.name,e.frameLocation={range:n.range,source:n.source.raw},Se(n.thread,e),e}function Z(n){return n instanceof b?ht(n,{}):n instanceof T?Se(n,{}):h(n)?me(n,{}):void 0}function ee(n){return n instanceof b?n.source.inMemory?n.source.raw.path||n.source.reference||n.source.name:n.source.uri.toString():n instanceof T?n.threadId:h(n)?n.getId():""}function he(n){let e=n.thread.getStaleCallStack();e=e.length>0?e:n.thread.getCallStack();const r=e.map(s=>s.source).filter(s=>s!==n.source);let t=0;if(r.forEach(s=>{s.name===n.source.name&&(t=Math.max(t,Ae(n.source.uri.path,s.uri.path)))}),t===0)return n.source.name;const a=Math.max(0,n.source.uri.path.lastIndexOf(ke.sep,n.source.uri.path.length-t-1));return(a>0?"...":"")+n.source.uri.path.substring(a)}async function te(n,e){n.parentSession&&await te(n.parentSession,e),await e.expand(n)}let K=class extends $e{constructor(r,t,a,s,i,o,l,u,c,g,x,$,Tt){super(r,s,t,l,u,o,i,c,g,x,$);this.options=r;this.debugService=a;this.menuService=Tt;this.onCallStackChangeScheduler=this._register(new ye(async()=>{const I=this.debugService.getModel().getSessions();I.length===0&&this.autoExpandedSessions.clear();const fe=I.length===1&&I[0].getAllThreads().length===1?I[0].getAllThreads()[0]:void 0,_=I.length===1?I[0].getStoppedDetails():void 0;_&&(fe||typeof _.threadId!="number")?(this.stateMessageLabel.textContent=U(_),this.stateMessageLabelHover.update(re(_)),this.stateMessageLabel.classList.toggle("exception",_.reason==="exception"),this.stateMessage.hidden=!1):I.length===1&&I[0].state===V.Running?(this.stateMessageLabel.textContent=S({key:"running",comment:["indicates state"]},"Running"),this.stateMessageLabelHover.update(I[0].getLabel()),this.stateMessageLabel.classList.remove("exception"),this.stateMessage.hidden=!1):this.stateMessage.hidden=!0,this.updateActions(),this.needsRefresh=!1,this.dataSource.deemphasizedStackFramesToShow=[],await this.tree.updateChildren();try{const W=new Set;I.forEach(F=>{F.parentSession&&!this.autoExpandedSessions.has(F.parentSession)&&W.add(F.parentSession)});for(const F of W)await te(F,this.tree),this.autoExpandedSessions.add(F)}catch{}this.selectionNeedsUpdate&&(this.selectionNeedsUpdate=!1,await this.updateTreeSelection())},50))}stateMessage;stateMessageLabel;stateMessageLabelHover;onCallStackChangeScheduler;needsRefresh=!1;ignoreSelectionChangedEvent=!1;ignoreFocusStackFrameEvent=!1;dataSource;tree;autoExpandedSessions=new Set;selectionNeedsUpdate=!1;renderHeaderTitle(r){super.renderHeaderTitle(r,this.options.title),this.stateMessage=p.append(r,m("span.call-stack-state-message")),this.stateMessage.hidden=!0,this.stateMessageLabel=p.append(this.stateMessage,m("span.label")),this.stateMessageLabelHover=this._register(this.hoverService.setupManagedHover(O("mouse"),this.stateMessage,""))}renderBody(r){super.renderBody(r),this.element.classList.add("debug-pane"),r.classList.add("debug-call-stack");const t=Ze(r);this.dataSource=new bt(this.debugService),this.tree=this.instantiationService.createInstance(Pe,"CallStackView",t,new It,new vt(this.debugService),[this.instantiationService.createInstance(y),this.instantiationService.createInstance(C),this.instantiationService.createInstance(L),this.instantiationService.createInstance(E),new w,new j],this.dataSource,{accessibilityProvider:new ft,compressionEnabled:!0,autoExpandSingleChildren:!0,identityProvider:{getId:s=>typeof s=="string"?s:s instanceof Array?`showMore ${s[0].getId()}`:s.getId()},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:s=>h(s)?s.getLabel():s instanceof T?`${s.name} ${s.stateLabel}`:s instanceof b||typeof s=="string"?s:s instanceof B?w.LABEL:S("showMoreStackFrames2","Show More Stack Frames"),getCompressedNodeKeyboardNavigationLabel:s=>{const i=s[0];return h(i)?i.getLabel():""}},expandOnlyOnTwistieClick:!0,overrideStyles:this.getLocationBasedColors().listOverrideStyles}),this.tree.setInput(this.debugService.getModel()),this._register(this.tree),this._register(this.tree.onDidOpen(async s=>{if(this.ignoreSelectionChangedEvent)return;const i=(l,u,c,g={})=>{this.ignoreFocusStackFrameEvent=!0;try{this.debugService.focusStackFrame(l,u,c,{...g,explicit:!0})}finally{this.ignoreFocusStackFrameEvent=!1}},o=s.element;if(o instanceof b){const l={preserveFocus:s.editorOptions.preserveFocus,sideBySide:s.sideBySide,pinned:s.editorOptions.pinned};i(o,o.thread,o.thread.session,l)}if(o instanceof T&&i(void 0,o,o.session),h(o)&&i(void 0,void 0,o),o instanceof B){const l=this.debugService.getModel().getSession(o.sessionId),u=l&&l.getThread(o.threadId);if(u){const c=u.stoppedDetails?.totalFrames,g=typeof c=="number"?c-u.getCallStack().length:void 0;await u.fetchCallStack(g),await this.tree.updateChildren()}}o instanceof Array&&(this.dataSource.deemphasizedStackFramesToShow.push(...o),this.tree.updateChildren())})),this._register(this.debugService.getModel().onDidChangeCallStack(()=>{if(!this.isBodyVisible()){this.needsRefresh=!0;return}this.onCallStackChangeScheduler.isScheduled()||this.onCallStackChangeScheduler.schedule()}));const a=Le.any(this.debugService.getViewModel().onDidFocusStackFrame,this.debugService.getViewModel().onDidFocusSession);this._register(a(async()=>{if(!this.ignoreFocusStackFrameEvent){if(!this.isBodyVisible()){this.needsRefresh=!0,this.selectionNeedsUpdate=!0;return}if(this.onCallStackChangeScheduler.isScheduled()){this.selectionNeedsUpdate=!0;return}await this.updateTreeSelection()}})),this._register(this.tree.onContextMenu(s=>this.onContextMenu(s))),this.debugService.state===V.Stopped&&this.onCallStackChangeScheduler.schedule(0),this._register(this.onDidChangeBodyVisibility(s=>{s&&this.needsRefresh&&this.onCallStackChangeScheduler.schedule()})),this._register(this.debugService.onDidNewSession(s=>{const i=[];i.push(s.onDidChangeName(()=>{this.tree.hasNode(s)&&this.tree.rerender(s)})),i.push(s.onDidEndAdapter(()=>Ee(i))),s.parentSession&&this.autoExpandedSessions.delete(s.parentSession)}))}layoutBody(r,t){super.layoutBody(r,t),this.tree.layout(r,t)}focus(){super.focus(),this.tree.domFocus()}collapseAll(){this.tree.collapseAll()}async updateTreeSelection(){if(!this.tree||!this.tree.getInput())return;const r=i=>{this.ignoreSelectionChangedEvent=!0;try{this.tree.setSelection([i]),this.tree.getRelativeTop(i)===null?this.tree.reveal(i,.5):this.tree.reveal(i)}catch{}finally{this.ignoreSelectionChangedEvent=!1}},t=this.debugService.getViewModel().focusedThread,a=this.debugService.getViewModel().focusedSession,s=this.debugService.getViewModel().focusedStackFrame;if(t){try{await te(t.session,this.tree)}catch{}try{await this.tree.expand(t)}catch{}const i=s||a;i&&r(i)}else a?r(a):this.tree.setSelection([])}onContextMenu(r){const t=r.element;let a=[];h(t)?a=ge(t):t instanceof T?a=Ie(t):t instanceof b&&(a=gt(t));const o={primary:[],secondary:[]},l=this.contextKeyService.createOverlay(a),u=this.menuService.getMenuActions(H.DebugCallStackContext,l,{arg:ee(t),shouldForwardArgs:!0});xe(u,o,"inline"),this.contextMenuService.showContextMenu({getAnchor:()=>r.anchor,getActions:()=>o.secondary,getActionsContext:()=>Z(t)})}};K=N([d(1,He),d(2,Ye),d(3,ze),d(4,ie),d(5,We),d(6,Oe),d(7,Y),d(8,Ve),d(9,Ue),d(10,Ke),d(11,z),d(12,G)],K);function ge(n){return[[v.key,"session"],[J.key,Qe(n)],[M.key,n.state===V.Stopped],[de.key,n.getAllThreads().length===1]]}let y=class{constructor(e,r,t,a){this.instantiationService=e;this.contextKeyService=r;this.hoverService=t;this.menuService=a}static ID="session";get templateId(){return y.ID}renderTemplate(e){const r=p.append(e,m(".session"));p.append(r,m(ae.asCSSSelector(f.callstackViewSession)));const t=p.append(r,m(".name")),a=p.append(r,m("span.state.label.monaco-count-badge.long")),s=new k,i=s.add(new X(t)),o=s.add(new k),l=s.add(new q(r,{actionViewItemProvider:(c,g)=>{if((c.id===ue||c.id===pe)&&c instanceof ne){o.clear();const x=this.instantiationService.invokeFunction($=>St(c,o,$,{...g,menuAsChild:!1}));if(x)return x}if(c instanceof ne)return this.instantiationService.createInstance(Me,c,{hoverDelegate:g.hoverDelegate});if(c instanceof Ne)return this.instantiationService.createInstance(we,c,{hoverDelegate:g.hoverDelegate})}})),u=s.add(new k);return{session:r,name:t,stateLabel:a,label:i,actionBar:l,elementDisposable:u,templateDisposable:s}}renderElement(e,r,t){this.doRenderElement(e.element,R(e.filterData),t)}renderCompressedElements(e,r,t){const a=e.element.elements[e.element.elements.length-1],s=R(e.filterData);this.doRenderElement(a,s,t)}doRenderElement(e,r,t){const a=t.elementDisposable.add(this.hoverService.setupManagedHover(O("mouse"),t.session,S({key:"session",comment:["Session is a noun"]},"Session")));t.label.set(e.getLabel(),r);const s=e.getStoppedDetails(),i=e.getAllThreads().find(c=>c.stopped),o=this.contextKeyService.createOverlay(ge(e)),l=t.elementDisposable.add(this.menuService.createMenu(H.DebugCallStackContext,o)),u=()=>{t.actionBar.clear();const c=[],x={primary:c,secondary:[]};se(l,{arg:ee(e),shouldForwardArgs:!0},x,"inline"),t.actionBar.push(c,{icon:!0,label:!1}),t.actionBar.context=Z(e)};t.elementDisposable.add(l.onDidChange(()=>u())),u(),t.stateLabel.style.display="",s?(t.stateLabel.textContent=U(s),a.update(`${e.getLabel()}: ${re(s)}`),t.stateLabel.classList.toggle("exception",s.reason==="exception")):i&&i.stoppedDetails?(t.stateLabel.textContent=U(i.stoppedDetails),a.update(`${e.getLabel()}: ${re(i.stoppedDetails)}`),t.stateLabel.classList.toggle("exception",i.stoppedDetails.reason==="exception")):(t.stateLabel.textContent=S({key:"running",comment:["indicates state"]},"Running"),t.stateLabel.classList.remove("exception"))}disposeTemplate(e){e.templateDisposable.dispose()}disposeElement(e,r,t){t.elementDisposable.clear()}disposeCompressedElements(e,r,t,a){t.elementDisposable.clear()}};y=N([d(0,ie),d(1,Y),d(2,z),d(3,G)],y);function Ie(n){return[[v.key,"thread"],[M.key,n.stopped]]}let C=class{constructor(e,r,t){this.contextKeyService=e;this.hoverService=r;this.menuService=t}static ID="thread";get templateId(){return C.ID}renderTemplate(e){const r=p.append(e,m(".thread")),t=p.append(r,m(".name")),a=p.append(r,m("span.state.label.monaco-count-badge.long")),s=new k,i=s.add(new X(t)),o=s.add(new q(r)),l=s.add(new k);return{thread:r,name:t,stateLabel:a,label:i,actionBar:o,elementDisposable:l,templateDisposable:s}}renderElement(e,r,t){const a=e.element;t.elementDisposable.add(this.hoverService.setupManagedHover(O("mouse"),t.thread,a.name)),t.label.set(a.name,R(e.filterData)),t.stateLabel.textContent=a.stateLabel,t.stateLabel.classList.toggle("exception",a.stoppedDetails?.reason==="exception");const s=this.contextKeyService.createOverlay(Ie(a)),i=t.elementDisposable.add(this.menuService.createMenu(H.DebugCallStackContext,s)),o=()=>{t.actionBar.clear();const l=[],c={primary:l,secondary:[]};se(i,{arg:ee(a),shouldForwardArgs:!0},c,"inline"),t.actionBar.push(l,{icon:!0,label:!1}),t.actionBar.context=Z(a)};t.elementDisposable.add(i.onDidChange(()=>o())),o()}renderCompressedElements(e,r,t,a){throw new Error("Method not implemented.")}disposeElement(e,r,t){t.elementDisposable.clear()}disposeTemplate(e){e.templateDisposable.dispose()}};C=N([d(0,Y),d(1,z),d(2,G)],C);function gt(n){return[[v.key,"stackFrame"],[Ge.key,n.canRestart]]}let L=class{constructor(e,r,t){this.hoverService=e;this.labelService=r;this.notificationService=t}static ID="stackFrame";get templateId(){return L.ID}renderTemplate(e){const r=p.append(e,m(".stack-frame")),t=p.append(r,m("span.label.expression")),a=p.append(r,m(".file")),s=p.append(a,m("span.file-name")),i=p.append(a,m("span.line-number-wrapper")),o=p.append(i,m("span.line-number.monaco-count-badge")),l=new k,u=l.add(new X(t)),c=l.add(new q(r));return{file:a,fileName:s,label:u,lineNumber:o,stackFrame:r,actionBar:c,templateDisposable:l}}renderElement(e,r,t){const a=e.element;t.stackFrame.classList.toggle("disabled",!a.source||!a.source.available||Q(a)),t.stackFrame.classList.toggle("label",a.presentationHint==="label");const s=!!a.thread.session.capabilities.supportsRestartFrame&&a.presentationHint!=="label"&&a.presentationHint!=="subtle"&&a.canRestart;t.stackFrame.classList.toggle("has-actions",s);let i=a.source.inMemory?a.source.uri.path:this.labelService.getUriLabel(a.source.uri);if(a.source.raw.origin&&(i+=`
${a.source.raw.origin}`),t.templateDisposable.add(this.hoverService.setupManagedHover(O("mouse"),t.file,i)),t.label.set(a.name,R(e.filterData),a.name),t.fileName.textContent=he(a),a.range.startLineNumber!==void 0?(t.lineNumber.textContent=`${a.range.startLineNumber}`,a.range.startColumn&&(t.lineNumber.textContent+=`:${a.range.startColumn}`),t.lineNumber.classList.remove("unavailable")):t.lineNumber.classList.add("unavailable"),t.actionBar.clear(),s){const o=new De("debug.callStack.restartFrame",S("restartFrame","Restart Frame"),ae.asClassName(f.debugRestartFrame),!0,async()=>{try{await a.restart()}catch(l){this.notificationService.error(l)}});t.actionBar.push(o,{icon:!0,label:!1})}}renderCompressedElements(e,r,t,a){throw new Error("Method not implemented.")}disposeTemplate(e){e.actionBar.dispose()}};L=N([d(0,z),d(1,Be),d(2,Re)],L);let E=class{constructor(e){this.hoverService=e}static ID="error";get templateId(){return E.ID}renderTemplate(e){return{label:p.append(e,m(".error")),templateDisposable:new k}}renderElement(e,r,t){const a=e.element;t.label.textContent=a,t.templateDisposable.add(this.hoverService.setupManagedHover(O("mouse"),t.label,a))}renderCompressedElements(e,r,t,a){throw new Error("Method not implemented.")}disposeTemplate(e){}};E=N([d(0,z)],E);class w{static ID="loadMore";static LABEL=S("loadAllStackFrames","Load More Stack Frames");constructor(){}get templateId(){return w.ID}renderTemplate(e){const r=p.append(e,m(".load-all"));return r.style.color=oe(le),{label:r}}renderElement(e,r,t){t.label.textContent=w.LABEL}renderCompressedElements(e,r,t,a){throw new Error("Method not implemented.")}disposeTemplate(e){}}class j{static ID="showMore";constructor(){}get templateId(){return j.ID}renderTemplate(e){const r=p.append(e,m(".show-more"));return r.style.color=oe(le),{label:r}}renderElement(e,r,t){const a=e.element;a.every(s=>!!(s.source&&s.source.origin&&s.source.origin===a[0].source.origin))?t.label.textContent=S("showMoreAndOrigin","Show {0} More: {1}",a.length,a[0].source.origin):t.label.textContent=S("showMoreStackFrames","Show {0} More Stack Frames",a.length)}renderCompressedElements(e,r,t,a){throw new Error("Method not implemented.")}disposeTemplate(e){}}class It{getHeight(e){return e instanceof b&&e.presentationHint==="label"||e instanceof B||e instanceof Array?16:22}getTemplateId(e){return h(e)?y.ID:e instanceof T?C.ID:e instanceof b?L.ID:typeof e=="string"?E.ID:e instanceof B?w.ID:j.ID}}function re(n){return n.text??U(n)}function U(n){return n.description||(n.reason?S({key:"pausedOn",comment:["indicates reason for program being paused"]},"Paused on {0}",n.reason):S("paused","Paused"))}function be(n){return typeof n.getSessions=="function"}function h(n){return n&&typeof n.getAllThreads=="function"}class bt{constructor(e){this.debugService=e}deemphasizedStackFramesToShow=[];hasChildren(e){if(h(e)){const r=e.getAllThreads();return r.length>1||r.length===1&&r[0].stopped||!!this.debugService.getModel().getSessions().find(t=>t.parentSession===e)}return be(e)||e instanceof T&&e.stopped}async getChildren(e){if(be(e)){const r=e.getSessions();if(r.length===0)return Promise.resolve([]);if(r.length>1||this.debugService.getViewModel().isMultiSessionView())return Promise.resolve(r.filter(a=>!a.parentSession));const t=r[0].getAllThreads();return t.length===1?this.getThreadChildren(t[0]):Promise.resolve(t)}else if(h(e)){const r=this.debugService.getModel().getSessions().filter(a=>a.parentSession===e),t=e.getAllThreads();return t.length===1?(await this.getThreadChildren(t[0])).concat(r):Promise.resolve(t.concat(r))}else return this.getThreadChildren(e)}getThreadChildren(e){return this.getThreadCallstack(e).then(r=>{const t=[];return r.forEach((a,s)=>{if(a instanceof b&&a.source&&Q(a)&&this.deemphasizedStackFramesToShow.indexOf(a)===-1){if(t.length){const o=t[t.length-1];if(o instanceof Array){o.push(a);return}}const i=s<r.length-1?r[s+1]:void 0;if(i instanceof b&&i.source&&Q(i)){t.push([a]);return}}t.push(a)}),t})}async getThreadCallstack(e){let r=e.getCallStack();return(!r||!r.length)&&(await e.fetchCallStack(),r=e.getCallStack()),r.length===1&&e.session.capabilities.supportsDelayedStackTraceLoading&&e.stoppedDetails&&e.stoppedDetails.totalFrames&&e.stoppedDetails.totalFrames>1&&(r=r.concat(e.getStaleCallStack().slice(1))),e.stoppedDetails&&e.stoppedDetails.framesErrorMessage&&(r=r.concat([e.stoppedDetails.framesErrorMessage])),!e.reachedEndOfCallStack&&e.stoppedDetails&&(r=r.concat([new B(e.session.getId(),e.threadId)])),r}}class ft{getWidgetAriaLabel(){return S({comment:["Debug is a noun in this context, not a verb."],key:"callStackAriaLabel"},"Debug Call Stack")}getWidgetRole(){return"treegrid"}getRole(e){return"row"}getAriaLabel(e){if(e instanceof T)return S({key:"threadAriaLabel",comment:['Placeholders stand for the thread name and the thread state.For example "Thread 1" and "Stopped']},"Thread {0} {1}",e.name,e.stateLabel);if(e instanceof b)return S("stackFrameAriaLabel","Stack Frame {0}, line {1}, {2}",e.name,e.range.startLineNumber,he(e));if(h(e)){const r=e.getAllThreads().find(a=>a.stopped),t=r?r.stateLabel:S({key:"running",comment:["indicates state"]},"Running");return S({key:"sessionLabel",comment:['Placeholders stand for the session name and the session state. For example "Launch Program" and "Running"']},"Session {0} {1}",e.getLabel(),t)}return typeof e=="string"?e:e instanceof Array?S("showMoreStackFrames","Show {0} More Stack Frames",e.length):w.LABEL}}class vt{constructor(e){this.debugService=e}isIncompressible(e){return h(e)?!(e.compact||this.debugService.getModel().getSessions().some(t=>t.parentSession===e&&t.compact)):!0}}_e(class extends je{constructor(){super({id:"callStack.collapse",viewId:ce,title:S("collapse","Collapse All"),f1:!1,icon:Ce.collapseAll,precondition:qe.isEqualTo(Je(V.Stopped)),menu:{id:H.ViewTitle,order:10,group:"navigation",when:A.equals("view",ce)}})}runInView(e,r){r.collapseAll()}});function D(n,e,r,t,a,s){Fe.appendMenuItem(H.DebugCallStackContext,{group:"inline",order:a,when:t,command:{id:n,title:e,icon:r,precondition:s}})}const P=A.or(v.isEqualTo("thread"),A.and(v.isEqualTo("session"),de));D(at,st,f.debugPause,A.and(P,M.toNegated()),10,Xe.toNegated()),D(et,tt,f.debugContinue,A.and(P,M),10),D(pt,ut,f.debugStepOver,P,20,M),D(ot,lt,f.debugStepInto,P,30,M),D(ct,dt,f.debugStepOut,P,40,M),D(it,nt,f.debugRestart,v.isEqualTo("session"),50),D(ue,mt,f.debugStop,A.and(J.toNegated(),v.isEqualTo("session")),60),D(pe,rt,f.debugDisconnect,A.and(J,v.isEqualTo("session")),60);export{K as CallStackView,Z as getContext,ee as getContextForContributedActions,he as getSpecificSourceName};
