var ve=Object.defineProperty;var Te=Object.getOwnPropertyDescriptor;var N=(n,e,a,t)=>{for(var r=t>1?void 0:t?Te(e,a):e,s=n.length-1,i;s>=0;s--)(i=n[s])&&(r=(t?i(e,a,r):i(r))||r);return t&&r&&ve(e,a,r),r},d=(n,e)=>(a,t)=>e(a,t,n);import*as p from"../../../../base/browser/dom.js";import{ActionBar as X}from"../../../../base/browser/ui/actionbar/actionbar.js";import"../../../../base/browser/ui/aria/aria.js";import{HighlightedLabel as j}from"../../../../base/browser/ui/highlightedlabel/highlightedLabel.js";import"../../../../base/browser/ui/list/list.js";import"../../../../base/browser/ui/list/listWidget.js";import"../../../../base/browser/ui/tree/asyncDataTree.js";import"../../../../base/browser/ui/tree/compressedObjectTreeModel.js";import"../../../../base/browser/ui/tree/objectTree.js";import"../../../../base/browser/ui/tree/tree.js";import{Action as De}from"../../../../base/common/actions.js";import{RunOnceScheduler as Ce}from"../../../../base/common/async.js";import{Codicon as ye}from"../../../../base/common/codicons.js";import{Event as Le}from"../../../../base/common/event.js";import{createMatches as R}from"../../../../base/common/filters.js";import{DisposableStore as k,dispose as Ee}from"../../../../base/common/lifecycle.js";import{posix as ke}from"../../../../base/common/path.js";import{commonSuffixLength as Ae}from"../../../../base/common/strings.js";import{localize as S}from"../../../../nls.js";import"../../../../platform/action/common/action.js";import{createAndFillInActionBarActions as re,createAndFillInContextMenuActions as Me,MenuEntryActionViewItem as xe,SubmenuEntryActionViewItem as we}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{IMenuService as G,MenuId as H,MenuItemAction as se,MenuRegistry as Fe,registerAction2 as Ne,SubmenuItemAction as _e}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as He}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as A,IContextKeyService as Y}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as Oe}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as ne}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as ze}from"../../../../platform/keybinding/common/keybinding.js";import{ILabelService as Be}from"../../../../platform/label/common/label.js";import{WorkbenchCompressibleAsyncDataTree as Pe}from"../../../../platform/list/browser/listService.js";import{INotificationService as Re}from"../../../../platform/notification/common/notification.js";import{IOpenerService as Ve}from"../../../../platform/opener/common/opener.js";import{ITelemetryService as Ke}from"../../../../platform/telemetry/common/telemetry.js";import{asCssVariable as ie,textLinkForeground as oe}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as Ue}from"../../../../platform/theme/common/themeService.js";import{ThemeIcon as le}from"../../../../base/common/themables.js";import{ViewAction as $e,ViewPane as We}from"../../../browser/parts/views/viewPane.js";import"../../../browser/parts/views/viewsViewlet.js";import{IViewDescriptorService as qe}from"../../../common/views.js";import{renderViewTree as Xe}from"./baseDebugView.js";import{CONTINUE_ID as je,CONTINUE_LABEL as Ge,DISCONNECT_ID as ce,DISCONNECT_LABEL as Ye,PAUSE_ID as Je,PAUSE_LABEL as Qe,RESTART_LABEL as Ze,RESTART_SESSION_ID as et,STEP_INTO_ID as tt,STEP_INTO_LABEL as at,STEP_OUT_ID as rt,STEP_OUT_LABEL as st,STEP_OVER_ID as nt,STEP_OVER_LABEL as it,STOP_ID as de,STOP_LABEL as ot}from"./debugCommands.js";import*as f from"./debugIcons.js";import{createDisconnectMenuItemAction as lt}from"./debugToolBar.js";import{CALLSTACK_VIEW_ID as pe,CONTEXT_CALLSTACK_ITEM_STOPPED as M,CONTEXT_CALLSTACK_ITEM_TYPE as v,CONTEXT_CALLSTACK_SESSION_HAS_ONE_THREAD as ue,CONTEXT_CALLSTACK_SESSION_IS_ATTACH as J,CONTEXT_DEBUG_STATE as ct,CONTEXT_FOCUSED_SESSION_IS_NO_DEBUG as dt,CONTEXT_STACK_FRAME_SUPPORTS_RESTART as pt,getStateLabel as ut,IDebugService as mt,isFrameDeemphasized as Q,State as V}from"../common/debug.js";import{StackFrame as b,Thread as T,ThreadAndSessionIds as O}from"../common/debugModel.js";import{isSessionAttach as St}from"../common/debugUtils.js";import{getDefaultHoverDelegate as z}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{IHoverService as B}from"../../../../platform/hover/browser/hover.js";const m=p.$;function me(n,e){return e.sessionId=n.getId(),e}function Se(n,e){return e.threadId=n.getId(),me(n.session,e),e}function ht(n,e){return e.frameId=n.getId(),e.frameName=n.name,e.frameLocation={range:n.range,source:n.source.raw},Se(n.thread,e),e}function Z(n){return n instanceof b?ht(n,{}):n instanceof T?Se(n,{}):h(n)?me(n,{}):void 0}function ee(n){return n instanceof b?n.source.inMemory?n.source.raw.path||n.source.reference||n.source.name:n.source.uri.toString():n instanceof T?n.threadId:h(n)?n.getId():""}function he(n){let e=n.thread.getStaleCallStack();e=e.length>0?e:n.thread.getCallStack();const a=e.map(s=>s.source).filter(s=>s!==n.source);let t=0;if(a.forEach(s=>{s.name===n.source.name&&(t=Math.max(t,Ae(n.source.uri.path,s.uri.path)))}),t===0)return n.source.name;const r=Math.max(0,n.source.uri.path.lastIndexOf(ke.sep,n.source.uri.path.length-t-1));return(r>0?"...":"")+n.source.uri.path.substring(r)}async function te(n,e){n.parentSession&&await te(n.parentSession,e),await e.expand(n)}let K=class extends We{constructor(a,t,r,s,i,o,l,u,c,g,w,W,Tt){super(a,s,t,l,u,o,i,c,g,w,W);this.options=a;this.debugService=r;this.menuService=Tt;this.onCallStackChangeScheduler=this._register(new Ce(async()=>{const I=this.debugService.getModel().getSessions();I.length===0&&this.autoExpandedSessions.clear();const be=I.length===1&&I[0].getAllThreads().length===1?I[0].getAllThreads()[0]:void 0,_=I.length===1?I[0].getStoppedDetails():void 0;_&&(be||typeof _.threadId!="number")?(this.stateMessageLabel.textContent=U(_),this.stateMessageLabelHover.update(ae(_)),this.stateMessageLabel.classList.toggle("exception",_.reason==="exception"),this.stateMessage.hidden=!1):I.length===1&&I[0].state===V.Running?(this.stateMessageLabel.textContent=S({key:"running",comment:["indicates state"]},"Running"),this.stateMessageLabelHover.update(I[0].getLabel()),this.stateMessageLabel.classList.remove("exception"),this.stateMessage.hidden=!1):this.stateMessage.hidden=!0,this.updateActions(),this.needsRefresh=!1,this.dataSource.deemphasizedStackFramesToShow=[],await this.tree.updateChildren();try{const q=new Set;I.forEach(F=>{F.parentSession&&!this.autoExpandedSessions.has(F.parentSession)&&q.add(F.parentSession)});for(const F of q)await te(F,this.tree),this.autoExpandedSessions.add(F)}catch{}this.selectionNeedsUpdate&&(this.selectionNeedsUpdate=!1,await this.updateTreeSelection())},50))}stateMessage;stateMessageLabel;stateMessageLabelHover;onCallStackChangeScheduler;needsRefresh=!1;ignoreSelectionChangedEvent=!1;ignoreFocusStackFrameEvent=!1;dataSource;tree;autoExpandedSessions=new Set;selectionNeedsUpdate=!1;renderHeaderTitle(a){super.renderHeaderTitle(a,this.options.title),this.stateMessage=p.append(a,m("span.call-stack-state-message")),this.stateMessage.hidden=!0,this.stateMessageLabel=p.append(this.stateMessage,m("span.label")),this.stateMessageLabelHover=this._register(this.hoverService.setupManagedHover(z("mouse"),this.stateMessage,""))}renderBody(a){super.renderBody(a),this.element.classList.add("debug-pane"),a.classList.add("debug-call-stack");const t=Xe(a);this.dataSource=new ft(this.debugService),this.tree=this.instantiationService.createInstance(Pe,"CallStackView",t,new It,new vt(this.debugService),[this.instantiationService.createInstance(C),this.instantiationService.createInstance(y),this.instantiationService.createInstance(L),this.instantiationService.createInstance(E),new x,new $],this.dataSource,{accessibilityProvider:new bt,compressionEnabled:!0,autoExpandSingleChildren:!0,identityProvider:{getId:s=>typeof s=="string"?s:s instanceof Array?`showMore ${s[0].getId()}`:s.getId()},keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:s=>h(s)?s.getLabel():s instanceof T?`${s.name} ${s.stateLabel}`:s instanceof b||typeof s=="string"?s:s instanceof O?x.LABEL:S("showMoreStackFrames2","Show More Stack Frames"),getCompressedNodeKeyboardNavigationLabel:s=>{const i=s[0];return h(i)?i.getLabel():""}},expandOnlyOnTwistieClick:!0,overrideStyles:this.getLocationBasedColors().listOverrideStyles}),this.tree.setInput(this.debugService.getModel()),this._register(this.tree),this._register(this.tree.onDidOpen(async s=>{if(this.ignoreSelectionChangedEvent)return;const i=(l,u,c,g={})=>{this.ignoreFocusStackFrameEvent=!0;try{this.debugService.focusStackFrame(l,u,c,{...g,explicit:!0})}finally{this.ignoreFocusStackFrameEvent=!1}},o=s.element;if(o instanceof b){const l={preserveFocus:s.editorOptions.preserveFocus,sideBySide:s.sideBySide,pinned:s.editorOptions.pinned};i(o,o.thread,o.thread.session,l)}if(o instanceof T&&i(void 0,o,o.session),h(o)&&i(void 0,void 0,o),o instanceof O){const l=this.debugService.getModel().getSession(o.sessionId),u=l&&l.getThread(o.threadId);if(u){const c=u.stoppedDetails?.totalFrames,g=typeof c=="number"?c-u.getCallStack().length:void 0;await u.fetchCallStack(g),await this.tree.updateChildren()}}o instanceof Array&&(this.dataSource.deemphasizedStackFramesToShow.push(...o),this.tree.updateChildren())})),this._register(this.debugService.getModel().onDidChangeCallStack(()=>{if(!this.isBodyVisible()){this.needsRefresh=!0;return}this.onCallStackChangeScheduler.isScheduled()||this.onCallStackChangeScheduler.schedule()}));const r=Le.any(this.debugService.getViewModel().onDidFocusStackFrame,this.debugService.getViewModel().onDidFocusSession);this._register(r(async()=>{if(!this.ignoreFocusStackFrameEvent){if(!this.isBodyVisible()){this.needsRefresh=!0,this.selectionNeedsUpdate=!0;return}if(this.onCallStackChangeScheduler.isScheduled()){this.selectionNeedsUpdate=!0;return}await this.updateTreeSelection()}})),this._register(this.tree.onContextMenu(s=>this.onContextMenu(s))),this.debugService.state===V.Stopped&&this.onCallStackChangeScheduler.schedule(0),this._register(this.onDidChangeBodyVisibility(s=>{s&&this.needsRefresh&&this.onCallStackChangeScheduler.schedule()})),this._register(this.debugService.onDidNewSession(s=>{const i=[];i.push(s.onDidChangeName(()=>{this.tree.hasNode(s)&&this.tree.rerender(s)})),i.push(s.onDidEndAdapter(()=>Ee(i))),s.parentSession&&this.autoExpandedSessions.delete(s.parentSession)}))}layoutBody(a,t){super.layoutBody(a,t),this.tree.layout(a,t)}focus(){super.focus(),this.tree.domFocus()}collapseAll(){this.tree.collapseAll()}async updateTreeSelection(){if(!this.tree||!this.tree.getInput())return;const a=i=>{this.ignoreSelectionChangedEvent=!0;try{this.tree.setSelection([i]),this.tree.getRelativeTop(i)===null?this.tree.reveal(i,.5):this.tree.reveal(i)}catch{}finally{this.ignoreSelectionChangedEvent=!1}},t=this.debugService.getViewModel().focusedThread,r=this.debugService.getViewModel().focusedSession,s=this.debugService.getViewModel().focusedStackFrame;if(!t)r?a(r):this.tree.setSelection([]);else{try{await te(t.session,this.tree)}catch{}try{await this.tree.expand(t)}catch{}const i=s||r;i&&a(i)}}onContextMenu(a){const t=a.element;let r=[];h(t)?r=ge(t):t instanceof T?r=Ie(t):t instanceof b&&(r=gt(t));const o={primary:[],secondary:[]},l=this.contextKeyService.createOverlay(r),u=this.menuService.getMenuActions(H.DebugCallStackContext,l,{arg:ee(t),shouldForwardArgs:!0});Me(u,o,"inline"),this.contextMenuService.showContextMenu({getAnchor:()=>a.anchor,getActions:()=>o.secondary,getActionsContext:()=>Z(t)})}};K=N([d(1,Oe),d(2,mt),d(3,ze),d(4,ne),d(5,qe),d(6,He),d(7,Y),d(8,Ve),d(9,Ue),d(10,Ke),d(11,B),d(12,G)],K);function ge(n){return[[v.key,"session"],[J.key,St(n)],[M.key,n.state===V.Stopped],[ue.key,n.getAllThreads().length===1]]}let C=class{constructor(e,a,t,r){this.instantiationService=e;this.contextKeyService=a;this.hoverService=t;this.menuService=r}static ID="session";get templateId(){return C.ID}renderTemplate(e){const a=p.append(e,m(".session"));p.append(a,m(le.asCSSSelector(f.callstackViewSession)));const t=p.append(a,m(".name")),r=p.append(a,m("span.state.label.monaco-count-badge.long")),s=new k,i=s.add(new j(t)),o=s.add(new k),l=s.add(new X(a,{actionViewItemProvider:(c,g)=>{if((c.id===de||c.id===ce)&&c instanceof se){o.clear();const w=this.instantiationService.invokeFunction(W=>lt(c,o,W,{...g,menuAsChild:!1}));if(w)return w}if(c instanceof se)return this.instantiationService.createInstance(xe,c,{hoverDelegate:g.hoverDelegate});if(c instanceof _e)return this.instantiationService.createInstance(we,c,{hoverDelegate:g.hoverDelegate})}})),u=s.add(new k);return{session:a,name:t,stateLabel:r,label:i,actionBar:l,elementDisposable:u,templateDisposable:s}}renderElement(e,a,t){this.doRenderElement(e.element,R(e.filterData),t)}renderCompressedElements(e,a,t){const r=e.element.elements[e.element.elements.length-1],s=R(e.filterData);this.doRenderElement(r,s,t)}doRenderElement(e,a,t){const r=t.elementDisposable.add(this.hoverService.setupManagedHover(z("mouse"),t.session,S({key:"session",comment:["Session is a noun"]},"Session")));t.label.set(e.getLabel(),a);const s=e.getStoppedDetails(),i=e.getAllThreads().find(c=>c.stopped),o=this.contextKeyService.createOverlay(ge(e)),l=t.elementDisposable.add(this.menuService.createMenu(H.DebugCallStackContext,o)),u=()=>{t.actionBar.clear();const c=[],w={primary:c,secondary:[]};re(l,{arg:ee(e),shouldForwardArgs:!0},w,"inline"),t.actionBar.push(c,{icon:!0,label:!1}),t.actionBar.context=Z(e)};t.elementDisposable.add(l.onDidChange(()=>u())),u(),t.stateLabel.style.display="",s?(t.stateLabel.textContent=U(s),r.update(`${e.getLabel()}: ${ae(s)}`),t.stateLabel.classList.toggle("exception",s.reason==="exception")):i&&i.stoppedDetails?(t.stateLabel.textContent=U(i.stoppedDetails),r.update(`${e.getLabel()}: ${ae(i.stoppedDetails)}`),t.stateLabel.classList.toggle("exception",i.stoppedDetails.reason==="exception")):(t.stateLabel.textContent=S({key:"running",comment:["indicates state"]},"Running"),t.stateLabel.classList.remove("exception"))}disposeTemplate(e){e.templateDisposable.dispose()}disposeElement(e,a,t){t.elementDisposable.clear()}disposeCompressedElements(e,a,t,r){t.elementDisposable.clear()}};C=N([d(0,ne),d(1,Y),d(2,B),d(3,G)],C);function Ie(n){return[[v.key,"thread"],[M.key,n.stopped]]}let y=class{constructor(e,a,t){this.contextKeyService=e;this.hoverService=a;this.menuService=t}static ID="thread";get templateId(){return y.ID}renderTemplate(e){const a=p.append(e,m(".thread")),t=p.append(a,m(".name")),r=p.append(a,m("span.state.label.monaco-count-badge.long")),s=new k,i=s.add(new j(t)),o=s.add(new X(a)),l=s.add(new k);return{thread:a,name:t,stateLabel:r,label:i,actionBar:o,elementDisposable:l,templateDisposable:s}}renderElement(e,a,t){const r=e.element;t.elementDisposable.add(this.hoverService.setupManagedHover(z("mouse"),t.thread,r.name)),t.label.set(r.name,R(e.filterData)),t.stateLabel.textContent=r.stateLabel,t.stateLabel.classList.toggle("exception",r.stoppedDetails?.reason==="exception");const s=this.contextKeyService.createOverlay(Ie(r)),i=t.elementDisposable.add(this.menuService.createMenu(H.DebugCallStackContext,s)),o=()=>{t.actionBar.clear();const l=[],c={primary:l,secondary:[]};re(i,{arg:ee(r),shouldForwardArgs:!0},c,"inline"),t.actionBar.push(l,{icon:!0,label:!1}),t.actionBar.context=Z(r)};t.elementDisposable.add(i.onDidChange(()=>o())),o()}renderCompressedElements(e,a,t,r){throw new Error("Method not implemented.")}disposeElement(e,a,t){t.elementDisposable.clear()}disposeTemplate(e){e.templateDisposable.dispose()}};y=N([d(0,Y),d(1,B),d(2,G)],y);function gt(n){return[[v.key,"stackFrame"],[pt.key,n.canRestart]]}let L=class{constructor(e,a,t){this.hoverService=e;this.labelService=a;this.notificationService=t}static ID="stackFrame";get templateId(){return L.ID}renderTemplate(e){const a=p.append(e,m(".stack-frame")),t=p.append(a,m("span.label.expression")),r=p.append(a,m(".file")),s=p.append(r,m("span.file-name")),i=p.append(r,m("span.line-number-wrapper")),o=p.append(i,m("span.line-number.monaco-count-badge")),l=new k,u=l.add(new j(t)),c=l.add(new X(a));return{file:r,fileName:s,label:u,lineNumber:o,stackFrame:a,actionBar:c,templateDisposable:l}}renderElement(e,a,t){const r=e.element;t.stackFrame.classList.toggle("disabled",!r.source||!r.source.available||Q(r)),t.stackFrame.classList.toggle("label",r.presentationHint==="label");const s=!!r.thread.session.capabilities.supportsRestartFrame&&r.presentationHint!=="label"&&r.presentationHint!=="subtle"&&r.canRestart;t.stackFrame.classList.toggle("has-actions",s);let i=r.source.inMemory?r.source.uri.path:this.labelService.getUriLabel(r.source.uri);if(r.source.raw.origin&&(i+=`
${r.source.raw.origin}`),t.templateDisposable.add(this.hoverService.setupManagedHover(z("mouse"),t.file,i)),t.label.set(r.name,R(e.filterData),r.name),t.fileName.textContent=he(r),r.range.startLineNumber!==void 0?(t.lineNumber.textContent=`${r.range.startLineNumber}`,r.range.startColumn&&(t.lineNumber.textContent+=`:${r.range.startColumn}`),t.lineNumber.classList.remove("unavailable")):t.lineNumber.classList.add("unavailable"),t.actionBar.clear(),s){const o=new De("debug.callStack.restartFrame",S("restartFrame","Restart Frame"),le.asClassName(f.debugRestartFrame),!0,async()=>{try{await r.restart()}catch(l){this.notificationService.error(l)}});t.actionBar.push(o,{icon:!0,label:!1})}}renderCompressedElements(e,a,t,r){throw new Error("Method not implemented.")}disposeTemplate(e){e.actionBar.dispose()}};L=N([d(0,B),d(1,Be),d(2,Re)],L);let E=class{constructor(e){this.hoverService=e}static ID="error";get templateId(){return E.ID}renderTemplate(e){return{label:p.append(e,m(".error")),templateDisposable:new k}}renderElement(e,a,t){const r=e.element;t.label.textContent=r,t.templateDisposable.add(this.hoverService.setupManagedHover(z("mouse"),t.label,r))}renderCompressedElements(e,a,t,r){throw new Error("Method not implemented.")}disposeTemplate(e){}};E=N([d(0,B)],E);class x{static ID="loadMore";static LABEL=S("loadAllStackFrames","Load More Stack Frames");constructor(){}get templateId(){return x.ID}renderTemplate(e){const a=p.append(e,m(".load-all"));return a.style.color=ie(oe),{label:a}}renderElement(e,a,t){t.label.textContent=x.LABEL}renderCompressedElements(e,a,t,r){throw new Error("Method not implemented.")}disposeTemplate(e){}}class ${static ID="showMore";constructor(){}get templateId(){return $.ID}renderTemplate(e){const a=p.append(e,m(".show-more"));return a.style.color=ie(oe),{label:a}}renderElement(e,a,t){const r=e.element;r.every(s=>!!(s.source&&s.source.origin&&s.source.origin===r[0].source.origin))?t.label.textContent=S("showMoreAndOrigin","Show {0} More: {1}",r.length,r[0].source.origin):t.label.textContent=S("showMoreStackFrames","Show {0} More Stack Frames",r.length)}renderCompressedElements(e,a,t,r){throw new Error("Method not implemented.")}disposeTemplate(e){}}class It{getHeight(e){return e instanceof b&&e.presentationHint==="label"||e instanceof O||e instanceof Array?16:22}getTemplateId(e){return h(e)?C.ID:e instanceof T?y.ID:e instanceof b?L.ID:typeof e=="string"?E.ID:e instanceof O?x.ID:$.ID}}function ae(n){return n.text??U(n)}function U(n){return n.description||(n.reason?S({key:"pausedOn",comment:["indicates reason for program being paused"]},"Paused on {0}",n.reason):S("paused","Paused"))}function fe(n){return typeof n.getSessions=="function"}function h(n){return n&&typeof n.getAllThreads=="function"}class ft{constructor(e){this.debugService=e}deemphasizedStackFramesToShow=[];hasChildren(e){if(h(e)){const a=e.getAllThreads();return a.length>1||a.length===1&&a[0].stopped||!!this.debugService.getModel().getSessions().find(t=>t.parentSession===e)}return fe(e)||e instanceof T&&e.stopped}async getChildren(e){if(fe(e)){const a=e.getSessions();if(a.length===0)return Promise.resolve([]);if(a.length>1||this.debugService.getViewModel().isMultiSessionView())return Promise.resolve(a.filter(r=>!r.parentSession));const t=a[0].getAllThreads();return t.length===1?this.getThreadChildren(t[0]):Promise.resolve(t)}else if(h(e)){const a=this.debugService.getModel().getSessions().filter(r=>r.parentSession===e),t=e.getAllThreads();return t.length===1?(await this.getThreadChildren(t[0])).concat(a):Promise.resolve(t.concat(a))}else return this.getThreadChildren(e)}getThreadChildren(e){return this.getThreadCallstack(e).then(a=>{const t=[];return a.forEach((r,s)=>{if(r instanceof b&&r.source&&Q(r)&&this.deemphasizedStackFramesToShow.indexOf(r)===-1){if(t.length){const o=t[t.length-1];if(o instanceof Array){o.push(r);return}}const i=s<a.length-1?a[s+1]:void 0;if(i instanceof b&&i.source&&Q(i)){t.push([r]);return}}t.push(r)}),t})}async getThreadCallstack(e){let a=e.getCallStack();return(!a||!a.length)&&(await e.fetchCallStack(),a=e.getCallStack()),a.length===1&&e.session.capabilities.supportsDelayedStackTraceLoading&&e.stoppedDetails&&e.stoppedDetails.totalFrames&&e.stoppedDetails.totalFrames>1&&(a=a.concat(e.getStaleCallStack().slice(1))),e.stoppedDetails&&e.stoppedDetails.framesErrorMessage&&(a=a.concat([e.stoppedDetails.framesErrorMessage])),!e.reachedEndOfCallStack&&e.stoppedDetails&&(a=a.concat([new O(e.session.getId(),e.threadId)])),a}}class bt{getWidgetAriaLabel(){return S({comment:["Debug is a noun in this context, not a verb."],key:"callStackAriaLabel"},"Debug Call Stack")}getWidgetRole(){return"treegrid"}getRole(e){return"row"}getAriaLabel(e){if(e instanceof T)return S({key:"threadAriaLabel",comment:['Placeholders stand for the thread name and the thread state.For example "Thread 1" and "Stopped']},"Thread {0} {1}",e.name,e.stateLabel);if(e instanceof b)return S("stackFrameAriaLabel","Stack Frame {0}, line {1}, {2}",e.name,e.range.startLineNumber,he(e));if(h(e)){const a=e.getAllThreads().find(r=>r.stopped),t=a?a.stateLabel:S({key:"running",comment:["indicates state"]},"Running");return S({key:"sessionLabel",comment:['Placeholders stand for the session name and the session state. For example "Launch Program" and "Running"']},"Session {0} {1}",e.getLabel(),t)}return typeof e=="string"?e:e instanceof Array?S("showMoreStackFrames","Show {0} More Stack Frames",e.length):x.LABEL}}class vt{constructor(e){this.debugService=e}isIncompressible(e){return h(e)?!(e.compact||this.debugService.getModel().getSessions().some(t=>t.parentSession===e&&t.compact)):!0}}Ne(class extends $e{constructor(){super({id:"callStack.collapse",viewId:pe,title:S("collapse","Collapse All"),f1:!1,icon:ye.collapseAll,precondition:ct.isEqualTo(ut(V.Stopped)),menu:{id:H.ViewTitle,order:10,group:"navigation",when:A.equals("view",pe)}})}runInView(e,a){a.collapseAll()}});function D(n,e,a,t,r,s){Fe.appendMenuItem(H.DebugCallStackContext,{group:"inline",order:r,when:t,command:{id:n,title:e,icon:a,precondition:s}})}const P=A.or(v.isEqualTo("thread"),A.and(v.isEqualTo("session"),ue));D(Je,Qe,f.debugPause,A.and(P,M.toNegated()),10,dt.toNegated()),D(je,Ge,f.debugContinue,A.and(P,M),10),D(nt,it,f.debugStepOver,P,20,M),D(tt,at,f.debugStepInto,P,30,M),D(rt,st,f.debugStepOut,P,40,M),D(et,Ze,f.debugRestart,v.isEqualTo("session"),50),D(de,ot,f.debugStop,A.and(J.toNegated(),v.isEqualTo("session")),60),D(ce,Ye,f.debugDisconnect,A.and(J,v.isEqualTo("session")),60);export{K as CallStackView,Z as getContext,ee as getContextForContributedActions,he as getSpecificSourceName};
