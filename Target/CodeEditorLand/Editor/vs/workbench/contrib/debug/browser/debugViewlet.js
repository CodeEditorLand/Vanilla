var x=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var S=(s,r,e,i)=>{for(var o=i>1?void 0:i?M(r,e):r,a=s.length-1,c;a>=0;a--)(c=s[a])&&(o=(i?c(r,e,o):c(o))||o);return i&&o&&x(r,e,o),o},n=(s,r)=>(e,i)=>r(e,i,s);import{DisposableStore as B,dispose as O}from"../../../../base/common/lifecycle.js";import"./media/debugViewlet.css";import*as p from"../../../../nls.js";import{createActionViewItem as q}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{Action2 as w,MenuId as l,MenuRegistry as b,registerAction2 as D}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as P}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as t,IContextKeyService as W}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as N,IContextViewService as R}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as U}from"../../../../platform/instantiation/common/instantiation.js";import{IProgressService as z}from"../../../../platform/progress/common/progress.js";import{IQuickInputService as G}from"../../../../platform/quickinput/common/quickInput.js";import{IStorageService as F}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as j}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as K}from"../../../../platform/theme/common/themeService.js";import{IWorkspaceContextService as X}from"../../../../platform/workspace/common/workspace.js";import{ViewPaneContainer as H,ViewsSubMenu as Y}from"../../../browser/parts/views/viewPaneContainer.js";import{WorkbenchStateContext as C}from"../../../common/contextkeys.js";import{IViewDescriptorService as Q}from"../../../common/views.js";import{IExtensionService as $}from"../../../services/extensions/common/extensions.js";import{IWorkbenchLayoutService as J}from"../../../services/layout/browser/layoutService.js";import{IViewsService as Z}from"../../../services/views/common/viewsService.js";import{BREAKPOINTS_VIEW_ID as ee,CONTEXT_DEBUGGERS_AVAILABLE as ie,CONTEXT_DEBUG_STATE as m,CONTEXT_DEBUG_UX as I,CONTEXT_DEBUG_UX_KEY as te,IDebugService as V,REPL_VIEW_ID as f,State as E,VIEWLET_ID as u,getStateLabel as oe}from"../common/debug.js";import{FocusSessionActionViewItem as ne,StartDebugActionViewItem as re}from"./debugActionViewItems.js";import{DEBUG_CONFIGURE_COMMAND_ID as se,DEBUG_CONFIGURE_LABEL as ae,DEBUG_START_COMMAND_ID as T,DEBUG_START_LABEL as ce,DISCONNECT_ID as ue,FOCUS_SESSION_ID as de,SELECT_AND_START_ID as pe,STOP_ID as le}from"./debugCommands.js";import{debugConfigure as me}from"./debugIcons.js";import{createDisconnectMenuItemAction as ge}from"./debugToolBar.js";import{WelcomeView as ve}from"./welcomeView.js";let h=class extends H{constructor(e,i,o,a,c,g,v,A,_,k,y,fe,he,L){super(u,{mergeViewWithContainerWhenSingleView:!0},c,y,e,_,i,k,A,v,g,L);this.progressService=o;this.debugService=a;this.contextViewService=fe;this.contextKeyService=he;this._register(this.debugService.onDidChangeState(d=>this.onDebugServiceStateChange(d))),this._register(this.contextKeyService.onDidChangeContext(d=>{d.affectsSome(new Set([te,"inDebugMode"]))&&this.updateTitleArea()})),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateTitleArea())),this._register(this.configurationService.onDidChangeConfiguration(d=>{(d.affectsConfiguration("debug.toolBarLocation")||d.affectsConfiguration("debug.hideLauncherWhileDebugging"))&&this.updateTitleArea()}))}startDebugActionViewItem;progressResolve;breakpointView;paneListeners=new Map;stopActionViewItemDisposables=this._register(new B);create(e){super.create(e),e.classList.add("debug-viewlet")}focus(){super.focus(),this.startDebugActionViewItem?this.startDebugActionViewItem.focus():this.focusView(ve.ID)}getActionViewItem(e,i){if(e.id===T)return this.startDebugActionViewItem=this.instantiationService.createInstance(re,null,e,i),this.startDebugActionViewItem;if(e.id===de)return new ne(e,void 0,this.debugService,this.contextViewService,this.configurationService);if(e.id===le||e.id===ue){this.stopActionViewItemDisposables.clear();const o=this.instantiationService.invokeFunction(a=>ge(e,this.stopActionViewItemDisposables,a,{hoverDelegate:i.hoverDelegate}));if(o)return o}return q(this.instantiationService,e,i)}focusView(e){const i=this.getView(e);i&&i.focus()}onDebugServiceStateChange(e){this.progressResolve&&(this.progressResolve(),this.progressResolve=void 0),e===E.Initializing&&this.progressService.withProgress({location:u},i=>new Promise(o=>this.progressResolve=o))}addPanes(e){super.addPanes(e);for(const{pane:i}of e)i.id===ee?(this.breakpointView=i,this.updateBreakpointsMaxSize()):this.paneListeners.set(i.id,i.onDidChange(()=>this.updateBreakpointsMaxSize()))}removePanes(e){super.removePanes(e);for(const i of e)O(this.paneListeners.get(i.id)),this.paneListeners.delete(i.id)}updateBreakpointsMaxSize(){if(this.breakpointView){const e=this.panes.every(i=>!i.isExpanded()||i===this.breakpointView);this.breakpointView.maximumBodySize=e?Number.POSITIVE_INFINITY:this.breakpointView.minimumBodySize}}};h=S([n(0,J),n(1,j),n(2,z),n(3,V),n(4,U),n(5,X),n(6,F),n(7,K),n(8,N),n(9,$),n(10,P),n(11,R),n(12,W),n(13,Q)],h),b.appendMenuItem(l.ViewContainerTitle,{when:t.and(t.equals("viewContainer",u),I.notEqualsTo("simple"),C.notEqualsTo("empty"),t.or(m.isEqualTo("inactive"),t.notEquals("config.debug.toolBarLocation","docked")),t.or(t.not("config.debug.hideLauncherWhileDebugging"),t.not("inDebugMode"))),order:10,group:"navigation",command:{precondition:m.notEqualsTo(oe(E.Initializing)),id:T,title:ce}}),D(class extends w{constructor(){super({id:se,title:{value:ae,original:"Open 'launch.json'",mnemonicTitle:p.localize({key:"miOpenConfigurations",comment:["&& denotes a mnemonic"]},"Open &&Configurations")},metadata:{description:p.localize2("openLaunchConfigDescription","Opens the file used to configure how your program is debugged")},f1:!0,icon:me,precondition:I.notEqualsTo("simple"),menu:[{id:l.ViewContainerTitle,group:"navigation",order:20,when:t.and(t.equals("viewContainer",u),I.notEqualsTo("simple"),C.notEqualsTo("empty"),t.or(m.isEqualTo("inactive"),t.notEquals("config.debug.toolBarLocation","docked")))},{id:l.ViewContainerTitle,order:20,when:t.and(t.equals("viewContainer",u),m.notEqualsTo("inactive"),t.equals("config.debug.toolBarLocation","docked"))},{id:l.MenubarDebugMenu,group:"2_configuration",order:1,when:ie}]})}async run(s){const r=s.get(V),e=s.get(G),i=r.getConfigurationManager();let o;if(i.selectedConfiguration.name)o=i.selectedConfiguration.launch;else{const a=i.getLaunches().filter(c=>!c.hidden);if(a.length===1)o=a[0];else{const c=a.map(v=>({label:v.name,launch:v})),g=await e.pick(c,{activeItem:c[0],placeHolder:p.localize({key:"selectWorkspaceFolder",comment:["User picks a workspace folder or a workspace configuration file here. Workspace configuration files can contain settings and thus a launch.json configuration can be written into one."]},"Select a workspace folder to create a launch.json file in or add it to the workspace config file")});g&&(o=g.launch)}}o&&await o.openConfigFile({preserveFocus:!1})}}),D(class extends w{constructor(){super({id:"debug.toggleReplIgnoreFocus",title:p.localize("debugPanel","Debug Console"),toggled:t.has(`view.${f}.visible`),menu:[{id:Y,group:"3_toggleRepl",order:30,when:t.and(t.equals("viewContainer",u))}]})}async run(s){const r=s.get(Z);r.isViewVisible(f)?r.closeView(f):await r.openView(f)}}),b.appendMenuItem(l.ViewContainerTitle,{when:t.and(t.equals("viewContainer",u),m.notEqualsTo("inactive"),t.or(t.equals("config.debug.toolBarLocation","docked"),t.has("config.debug.hideLauncherWhileDebugging"))),order:10,command:{id:pe,title:p.localize("startAdditionalSession","Start Additional Session")}});export{h as DebugViewPaneContainer};
