import{matchesFuzzy as m}from"../../../../../vs/base/common/filters.js";import{DisposableStore as l}from"../../../../../vs/base/common/lifecycle.js";import{dirname as I}from"../../../../../vs/base/common/resources.js";import{ILanguageService as g}from"../../../../../vs/editor/common/languages/language.js";import{getIconClasses as p}from"../../../../../vs/editor/common/services/getIconClasses.js";import{IModelService as S}from"../../../../../vs/editor/common/services/model.js";import*as k from"../../../../../vs/nls.js";import"../../../../../vs/platform/instantiation/common/instantiation.js";import{ILabelService as f}from"../../../../../vs/platform/label/common/label.js";import{IQuickInputService as b}from"../../../../../vs/platform/quickinput/common/quickInput.js";import{IDebugService as v}from"../../../../../vs/workbench/contrib/debug/common/debug.js";import"../../../../../vs/workbench/contrib/debug/common/debugSource.js";import{IEditorService as P}from"../../../../../vs/workbench/services/editor/common/editorService.js";async function U(i){const a=i.get(b),u=i.get(v),s=i.get(P),n=u.getModel().getSessions(!1),c=i.get(S),t=i.get(g),o=i.get(f),r=new l,e=a.createQuickPick({useSeparators:!0});r.add(e),e.matchOnLabel=e.matchOnDescription=e.matchOnDetail=e.sortByLabel=!1,e.placeholder=k.localize("moveFocusedView.selectView","Search loaded scripts by name"),e.items=await d(e.value,n,s,c,t,o),r.add(e.onDidChangeValue(async()=>{e.items=await d(e.value,n,s,c,t,o)})),r.add(e.onDidAccept(()=>{e.selectedItems[0].accept(),e.hide(),r.dispose()})),e.show()}async function h(i,a,u,s,n,c){const t=[];return t.push({type:"separator",label:i.name}),(await i.getLoadedSources()).forEach(r=>{const e=D(r,a,u,s,n,c);e&&t.push(e)}),t}async function d(i,a,u,s,n,c){const t=[],o=await Promise.all(a.map(r=>h(r,i,u,s,n,c)));for(const r of o)for(const e of r)t.push(e);return t}function D(i,a,u,s,n,c){const t=c.getUriBasenameLabel(i.uri),o=c.getUriLabel(I(i.uri)),r=m(a,t,!0),e=m(a,o,!0);if(r||e)return{label:t,description:o==="."?void 0:o,highlights:{label:r??void 0,description:e??void 0},iconClasses:p(s,n,i.uri),accept:()=>{i.available&&i.openInEditor(u,{startLineNumber:0,startColumn:0,endLineNumber:0,endColumn:0})}}}export{U as showLoadedScriptMenu};
