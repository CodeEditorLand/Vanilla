import t from"assert";import{isWindows as i}from"../../../../../base/common/platform.js";import{URI as r}from"../../../../../base/common/uri.js";import{ensureNoDisposablesAreLeakedInTestSuite as y}from"../../../../../base/test/common/utils.js";import{NullLogService as n}from"../../../../../platform/log/common/log.js";import{Source as s}from"../../common/debugSource.js";import{mockUriIdentityService as a}from"./mockDebugModel.js";suite("Debug - Source",()=>{y(),test("from raw source",()=>{const e=new s({name:"zz",path:"/xx/yy/zz",sourceReference:0,presentationHint:"emphasize"},"aDebugSessionId",a,new n);t.strictEqual(e.presentationHint,"emphasize"),t.strictEqual(e.name,"zz"),t.strictEqual(e.inMemory,!1),t.strictEqual(e.reference,0),t.strictEqual(e.uri.toString(),r.file("/xx/yy/zz").toString())}),test("from raw internal source",()=>{const e=new s({name:"internalModule.js",sourceReference:11,presentationHint:"deemphasize"},"aDebugSessionId",a,new n);t.strictEqual(e.presentationHint,"deemphasize"),t.strictEqual(e.name,"internalModule.js"),t.strictEqual(e.inMemory,!0),t.strictEqual(e.reference,11),t.strictEqual(e.uri.toString(),"debug:internalModule.js?session%3DaDebugSessionId%26ref%3D11")}),test("get encoded debug data",()=>{const e=(o,u,c,m,d)=>{const{name:f,path:p,sourceReference:l,sessionId:h}=s.getEncodedDebugData(o);t.strictEqual(f,u),t.strictEqual(p,c),t.strictEqual(l,m),t.strictEqual(h,d)};e(r.file("a/b/c/d"),"d",i?"\\a\\b\\c\\d":"/a/b/c/d",void 0,void 0),e(r.from({scheme:"file",path:"/my/path/test.js",query:"ref=1&session=2"}),"test.js",i?"\\my\\path\\test.js":"/my/path/test.js",void 0,void 0),e(r.from({scheme:"http",authority:"www.example.com",path:"/my/path"}),"path","http://www.example.com/my/path",void 0,void 0),e(r.from({scheme:"debug",authority:"www.example.com",path:"/my/path",query:"ref=100"}),"path","/my/path",100,void 0),e(r.from({scheme:"debug",path:"a/b/c/d.js",query:"session=100"}),"d.js","a/b/c/d.js",void 0,"100"),e(r.from({scheme:"debug",path:"a/b/c/d/foo.txt",query:"session=100&ref=10"}),"foo.txt","a/b/c/d/foo.txt",10,"100")})});
