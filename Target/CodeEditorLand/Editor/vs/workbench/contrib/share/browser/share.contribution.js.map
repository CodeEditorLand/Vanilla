{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/share/browser/share.contribution.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport \"./share.css\";\nimport { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { Codicon } from \"../../../../base/common/codicons.js\";\nimport { MarkdownString } from \"../../../../base/common/htmlContent.js\";\nimport { KeyCode, KeyMod } from \"../../../../base/common/keyCodes.js\";\nimport { DisposableStore } from \"../../../../base/common/lifecycle.js\";\nimport { ICodeEditorService } from \"../../../../editor/browser/services/codeEditorService.js\";\nimport { localize, localize2 } from \"../../../../nls.js\";\nimport {\n\tAction2,\n\tMenuId,\n\tMenuRegistry,\n\tregisterAction2,\n} from \"../../../../platform/actions/common/actions.js\";\nimport { IClipboardService } from \"../../../../platform/clipboard/common/clipboardService.js\";\nimport { IConfigurationService } from \"../../../../platform/configuration/common/configuration.js\";\nimport {\n\tExtensions as ConfigurationExtensions,\n\ttype IConfigurationRegistry,\n} from \"../../../../platform/configuration/common/configurationRegistry.js\";\nimport { ContextKeyExpr } from \"../../../../platform/contextkey/common/contextkey.js\";\nimport { IDialogService } from \"../../../../platform/dialogs/common/dialogs.js\";\nimport {\n\tInstantiationType,\n\tregisterSingleton,\n} from \"../../../../platform/instantiation/common/extensions.js\";\nimport type { ServicesAccessor } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { KeybindingWeight } from \"../../../../platform/keybinding/common/keybindingsRegistry.js\";\nimport { Severity } from \"../../../../platform/notification/common/notification.js\";\nimport { IOpenerService } from \"../../../../platform/opener/common/opener.js\";\nimport {\n\tIProgressService,\n\tProgressLocation,\n} from \"../../../../platform/progress/common/progress.js\";\nimport { Registry } from \"../../../../platform/registry/common/platform.js\";\nimport { IWorkspaceContextService } from \"../../../../platform/workspace/common/workspace.js\";\nimport { workbenchConfigurationNodeBase } from \"../../../common/configuration.js\";\nimport { WorkspaceFolderCountContext } from \"../../../common/contextkeys.js\";\nimport {\n\tExtensions,\n\ttype IWorkbenchContributionsRegistry,\n} from \"../../../common/contributions.js\";\nimport {\n\tEditorResourceAccessor,\n\tSideBySideEditor,\n} from \"../../../common/editor.js\";\nimport { IEditorService } from \"../../../services/editor/common/editorService.js\";\nimport { LifecyclePhase } from \"../../../services/lifecycle/common/lifecycle.js\";\nimport { IShareService } from \"../common/share.js\";\nimport { ShareProviderCountContext, ShareService } from \"./shareService.js\";\n\nconst targetMenus = [\n\tMenuId.EditorContextShare,\n\tMenuId.SCMResourceContextShare,\n\tMenuId.OpenEditorsContextShare,\n\tMenuId.EditorTitleContextShare,\n\tMenuId.MenubarShare,\n\t// MenuId.EditorLineNumberContext, // todo@joyceerhl add share\n\tMenuId.ExplorerContextShare,\n];\n\nclass ShareWorkbenchContribution {\n\tprivate static SHARE_ENABLED_SETTING =\n\t\t\"workbench.experimental.share.enabled\";\n\n\tprivate _disposables: DisposableStore | undefined;\n\n\tconstructor(\n\t\t@IShareService private readonly shareService: IShareService,\n\t\t@IConfigurationService\n\t\tprivate readonly configurationService: IConfigurationService,\n\t) {\n\t\tif (\n\t\t\tthis.configurationService.getValue<boolean>(\n\t\t\t\tShareWorkbenchContribution.SHARE_ENABLED_SETTING,\n\t\t\t)\n\t\t) {\n\t\t\tthis.registerActions();\n\t\t}\n\t\tthis.configurationService.onDidChangeConfiguration((e) => {\n\t\t\tif (\n\t\t\t\te.affectsConfiguration(\n\t\t\t\t\tShareWorkbenchContribution.SHARE_ENABLED_SETTING,\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\tconst settingValue =\n\t\t\t\t\tthis.configurationService.getValue<boolean>(\n\t\t\t\t\t\tShareWorkbenchContribution.SHARE_ENABLED_SETTING,\n\t\t\t\t\t);\n\t\t\t\tif (settingValue === true && this._disposables === undefined) {\n\t\t\t\t\tthis.registerActions();\n\t\t\t\t} else if (\n\t\t\t\t\tsettingValue === false &&\n\t\t\t\t\tthis._disposables !== undefined\n\t\t\t\t) {\n\t\t\t\t\tthis._disposables?.clear();\n\t\t\t\t\tthis._disposables = undefined;\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n\n\tprivate registerActions() {\n\t\tif (!this._disposables) {\n\t\t\tthis._disposables = new DisposableStore();\n\t\t}\n\n\t\tthis._disposables.add(\n\t\t\tregisterAction2(\n\t\t\t\tclass ShareAction extends Action2 {\n\t\t\t\t\tstatic readonly ID = \"workbench.action.share\";\n\t\t\t\t\tstatic readonly LABEL = localize2(\"share\", \"Share...\");\n\n\t\t\t\t\tconstructor() {\n\t\t\t\t\t\tsuper({\n\t\t\t\t\t\t\tid: ShareAction.ID,\n\t\t\t\t\t\t\ttitle: ShareAction.LABEL,\n\t\t\t\t\t\t\tf1: true,\n\t\t\t\t\t\t\ticon: Codicon.linkExternal,\n\t\t\t\t\t\t\tprecondition: ContextKeyExpr.and(\n\t\t\t\t\t\t\t\tShareProviderCountContext.notEqualsTo(0),\n\t\t\t\t\t\t\t\tWorkspaceFolderCountContext.notEqualsTo(0),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tkeybinding: {\n\t\t\t\t\t\t\t\tweight: KeybindingWeight.WorkbenchContrib,\n\t\t\t\t\t\t\t\tprimary:\n\t\t\t\t\t\t\t\t\tKeyMod.Alt | KeyMod.CtrlCmd | KeyCode.KeyS,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tmenu: [{ id: MenuId.CommandCenter, order: 1000 }],\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\toverride async run(\n\t\t\t\t\t\taccessor: ServicesAccessor,\n\t\t\t\t\t\t...args: any[]\n\t\t\t\t\t): Promise<void> {\n\t\t\t\t\t\tconst shareService = accessor.get(IShareService);\n\t\t\t\t\t\tconst activeEditor =\n\t\t\t\t\t\t\taccessor.get(IEditorService)?.activeEditor;\n\t\t\t\t\t\tconst resourceUri =\n\t\t\t\t\t\t\t(activeEditor &&\n\t\t\t\t\t\t\t\tEditorResourceAccessor.getOriginalUri(\n\t\t\t\t\t\t\t\t\tactiveEditor,\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tsupportSideBySide:\n\t\t\t\t\t\t\t\t\t\t\tSideBySideEditor.PRIMARY,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t)) ??\n\t\t\t\t\t\t\taccessor\n\t\t\t\t\t\t\t\t.get(IWorkspaceContextService)\n\t\t\t\t\t\t\t\t.getWorkspace().folders[0].uri;\n\t\t\t\t\t\tconst clipboardService =\n\t\t\t\t\t\t\taccessor.get(IClipboardService);\n\t\t\t\t\t\tconst dialogService = accessor.get(IDialogService);\n\t\t\t\t\t\tconst urlService = accessor.get(IOpenerService);\n\t\t\t\t\t\tconst progressService = accessor.get(IProgressService);\n\t\t\t\t\t\tconst selection =\n\t\t\t\t\t\t\taccessor\n\t\t\t\t\t\t\t\t.get(ICodeEditorService)\n\t\t\t\t\t\t\t\t.getActiveCodeEditor()\n\t\t\t\t\t\t\t\t?.getSelection() ?? undefined;\n\n\t\t\t\t\t\tconst result = await progressService.withProgress(\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tlocation: ProgressLocation.Window,\n\t\t\t\t\t\t\t\tdetail: localize(\n\t\t\t\t\t\t\t\t\t\"generating link\",\n\t\t\t\t\t\t\t\t\t\"Generating link...\",\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tasync () =>\n\t\t\t\t\t\t\t\tshareService.provideShare(\n\t\t\t\t\t\t\t\t\t{ resourceUri, selection },\n\t\t\t\t\t\t\t\t\tCancellationToken.None,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t);\n\n\t\t\t\t\t\tif (result) {\n\t\t\t\t\t\t\tconst uriText = result.toString();\n\t\t\t\t\t\t\tconst isResultText = typeof result === \"string\";\n\t\t\t\t\t\t\tawait clipboardService.writeText(uriText);\n\n\t\t\t\t\t\t\tdialogService.prompt({\n\t\t\t\t\t\t\t\ttype: Severity.Info,\n\t\t\t\t\t\t\t\tmessage: isResultText\n\t\t\t\t\t\t\t\t\t? localize(\n\t\t\t\t\t\t\t\t\t\t\t\"shareTextSuccess\",\n\t\t\t\t\t\t\t\t\t\t\t\"Copied text to clipboard!\",\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: localize(\n\t\t\t\t\t\t\t\t\t\t\t\"shareSuccess\",\n\t\t\t\t\t\t\t\t\t\t\t\"Copied link to clipboard!\",\n\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\tcustom: {\n\t\t\t\t\t\t\t\t\ticon: Codicon.check,\n\t\t\t\t\t\t\t\t\tmarkdownDetails: [\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tmarkdown: new MarkdownString(\n\t\t\t\t\t\t\t\t\t\t\t\t`<div aria-label='${uriText}'>${uriText}</div>`,\n\t\t\t\t\t\t\t\t\t\t\t\t{ supportHtml: true },\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tclasses: [\n\t\t\t\t\t\t\t\t\t\t\t\tisResultText\n\t\t\t\t\t\t\t\t\t\t\t\t\t? \"share-dialog-input-text\"\n\t\t\t\t\t\t\t\t\t\t\t\t\t: \"share-dialog-input-link\",\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\tcancelButton: localize(\"close\", \"Close\"),\n\t\t\t\t\t\t\t\tbuttons: isResultText\n\t\t\t\t\t\t\t\t\t? []\n\t\t\t\t\t\t\t\t\t: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: localize(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"open link\",\n\t\t\t\t\t\t\t\t\t\t\t\t\t\"Open Link\",\n\t\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\t\trun: () => {\n\t\t\t\t\t\t\t\t\t\t\t\t\turlService.open(result, {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\topenExternal: true,\n\t\t\t\t\t\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tconst actions = this.shareService.getShareActions();\n\t\tfor (const menuId of targetMenus) {\n\t\t\tfor (const action of actions) {\n\t\t\t\t// todo@joyceerhl avoid duplicates\n\t\t\t\tthis._disposables.add(\n\t\t\t\t\tMenuRegistry.appendMenuItem(menuId, action),\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n\nregisterSingleton(IShareService, ShareService, InstantiationType.Delayed);\nconst workbenchContributionsRegistry =\n\tRegistry.as<IWorkbenchContributionsRegistry>(Extensions.Workbench);\nworkbenchContributionsRegistry.registerWorkbenchContribution(\n\tShareWorkbenchContribution,\n\tLifecyclePhase.Eventually,\n);\n\nRegistry.as<IConfigurationRegistry>(\n\tConfigurationExtensions.Configuration,\n).registerConfiguration({\n\t...workbenchConfigurationNodeBase,\n\tproperties: {\n\t\t\"workbench.experimental.share.enabled\": {\n\t\t\ttype: \"boolean\",\n\t\t\tdefault: false,\n\t\t\ttags: [\"experimental\"],\n\t\t\tmarkdownDescription: localize(\n\t\t\t\t\"experimental.share.enabled\",\n\t\t\t\t\"Controls whether to render the Share action next to the command center when {0} is {1}.\",\n\t\t\t\t\"`#window.commandCenter#`\",\n\t\t\t\t\"`true`\",\n\t\t\t),\n\t\t\trestricted: false,\n\t\t},\n\t},\n});\n"],
  "mappings": "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",
  "names": []
}
