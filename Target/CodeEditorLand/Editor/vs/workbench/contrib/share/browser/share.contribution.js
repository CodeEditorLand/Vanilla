var k=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var S=(d,o,r,e)=>{for(var t=e>1?void 0:e?w(o,r):o,c=d.length-1,s;c>=0;c--)(s=d[c])&&(t=(e?s(o,r,t):s(t))||t);return e&&t&&k(o,r,t),t},f=(d,o)=>(r,e)=>o(r,e,d);import"vs/css!./share";import{CancellationToken as T}from"../../../../../vs/base/common/cancellation.js";import{Codicon as h}from"../../../../../vs/base/common/codicons.js";import{MarkdownString as R}from"../../../../../vs/base/common/htmlContent.js";import{KeyCode as D,KeyMod as v}from"../../../../../vs/base/common/keyCodes.js";import{DisposableStore as _}from"../../../../../vs/base/common/lifecycle.js";import{ICodeEditorService as L}from"../../../../../vs/editor/browser/services/codeEditorService.js";import{localize as a,localize2 as B}from"../../../../../vs/nls.js";import{Action2 as N,MenuId as n,MenuRegistry as M,registerAction2 as P}from"../../../../../vs/platform/actions/common/actions.js";import{IClipboardService as G}from"../../../../../vs/platform/clipboard/common/clipboardService.js";import{IConfigurationService as H}from"../../../../../vs/platform/configuration/common/configuration.js";import{Extensions as K}from"../../../../../vs/platform/configuration/common/configurationRegistry.js";import{ContextKeyExpr as O}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IDialogService as W}from"../../../../../vs/platform/dialogs/common/dialogs.js";import{InstantiationType as V,registerSingleton as q}from"../../../../../vs/platform/instantiation/common/extensions.js";import"../../../../../vs/platform/instantiation/common/instantiation.js";import{KeybindingWeight as z}from"../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import{Severity as U}from"../../../../../vs/platform/notification/common/notification.js";import{IOpenerService as $}from"../../../../../vs/platform/opener/common/opener.js";import{IProgressService as F,ProgressLocation as Y}from"../../../../../vs/platform/progress/common/progress.js";import{Registry as E}from"../../../../../vs/platform/registry/common/platform.js";import{IWorkspaceContextService as j}from"../../../../../vs/platform/workspace/common/workspace.js";import{workbenchConfigurationNodeBase as J}from"../../../../../vs/workbench/common/configuration.js";import{WorkspaceFolderCountContext as Q}from"../../../../../vs/workbench/common/contextkeys.js";import{Extensions as X}from"../../../../../vs/workbench/common/contributions.js";import{EditorResourceAccessor as Z,SideBySideEditor as ee}from"../../../../../vs/workbench/common/editor.js";import{ShareProviderCountContext as te,ShareService as oe}from"../../../../../vs/workbench/contrib/share/browser/shareService.js";import{IShareService as g}from"../../../../../vs/workbench/contrib/share/common/share.js";import{IEditorService as ie}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{LifecyclePhase as re}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";const ne=[n.EditorContextShare,n.SCMResourceContextShare,n.OpenEditorsContextShare,n.EditorTitleContextShare,n.MenubarShare,n.ExplorerContextShare];let i=class{constructor(o,r){this.shareService=o;this.configurationService=r;this.configurationService.getValue(i.SHARE_ENABLED_SETTING)&&this.registerActions(),this.configurationService.onDidChangeConfiguration(e=>{if(e.affectsConfiguration(i.SHARE_ENABLED_SETTING)){const t=this.configurationService.getValue(i.SHARE_ENABLED_SETTING);t===!0&&this._disposables===void 0?this.registerActions():t===!1&&this._disposables!==void 0&&(this._disposables?.clear(),this._disposables=void 0)}})}static SHARE_ENABLED_SETTING="workbench.experimental.share.enabled";_disposables;registerActions(){this._disposables||(this._disposables=new _),this._disposables.add(P(class u extends N{static ID="workbench.action.share";static LABEL=B("share","Share...");constructor(){super({id:u.ID,title:u.LABEL,f1:!0,icon:h.linkExternal,precondition:O.and(te.notEqualsTo(0),Q.notEqualsTo(0)),keybinding:{weight:z.WorkbenchContrib,primary:v.Alt|v.CtrlCmd|D.KeyS},menu:[{id:n.CommandCenter,order:1e3}]})}async run(e,...t){const c=e.get(g),s=e.get(ie)?.activeEditor,C=(s&&Z.getOriginalUri(s,{supportSideBySide:ee.PRIMARY}))??e.get(j).getWorkspace().folders[0].uri,y=e.get(G),b=e.get(W),x=e.get($),I=e.get(F),A=e.get(L).getActiveCodeEditor()?.getSelection()??void 0,l=await I.withProgress({location:Y.Window,detail:a("generating link","Generating link...")},async()=>c.provideShare({resourceUri:C,selection:A},T.None));if(l){const p=l.toString(),m=typeof l=="string";await y.writeText(p),b.prompt({type:U.Info,message:m?a("shareTextSuccess","Copied text to clipboard!"):a("shareSuccess","Copied link to clipboard!"),custom:{icon:h.check,markdownDetails:[{markdown:new R(`<div aria-label='${p}'>${p}</div>`,{supportHtml:!0}),classes:[m?"share-dialog-input-text":"share-dialog-input-link"]}]},cancelButton:a("close","Close"),buttons:m?[]:[{label:a("open link","Open Link"),run:()=>{x.open(l,{openExternal:!0})}}]})}}}));const o=this.shareService.getShareActions();for(const r of ne)for(const e of o)this._disposables.add(M.appendMenuItem(r,e))}};i=S([f(0,g),f(1,H)],i),q(g,oe,V.Delayed);const se=E.as(X.Workbench);se.registerWorkbenchContribution(i,re.Eventually),E.as(K.Configuration).registerConfiguration({...J,properties:{"workbench.experimental.share.enabled":{type:"boolean",default:!1,tags:["experimental"],markdownDescription:a("experimental.share.enabled","Controls whether to render the Share action next to the command center when {0} is {1}.","`#window.commandCenter#`","`true`"),restricted:!1}}});
