{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/logs/common/logsDataCleaner.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { basename, dirname } from '../../../../base/common/resources.js';\nimport { IWorkbenchEnvironmentService } from '../../../services/environment/common/environmentService.js';\nimport { ILifecycleService } from '../../../services/lifecycle/common/lifecycle.js';\nimport { Promises } from '../../../../base/common/async.js';\n\nexport class LogsDataCleaner extends Disposable {\n\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t) {\n\t\tsuper();\n\t\tthis.cleanUpOldLogsSoon();\n\t}\n\n\tprivate cleanUpOldLogsSoon(): void {\n\t\tlet handle: any = setTimeout(async () => {\n\t\t\thandle = undefined;\n\t\t\tconst stat = await this.fileService.resolve(dirname(this.environmentService.logsHome));\n\t\t\tif (stat.children) {\n\t\t\t\tconst currentLog = basename(this.environmentService.logsHome);\n\t\t\t\tconst allSessions = stat.children.filter(stat => stat.isDirectory && /^\\d{8}T\\d{6}$/.test(stat.name));\n\t\t\t\tconst oldSessions = allSessions.sort().filter((d, i) => d.name !== currentLog);\n\t\t\t\tconst toDelete = oldSessions.slice(0, Math.max(0, oldSessions.length - 49));\n\t\t\t\tPromises.settled(toDelete.map(stat => this.fileService.del(stat.resource, { recursive: true })));\n\t\t\t}\n\t\t}, 10 * 1000);\n\t\tthis.lifecycleService.onWillShutdown(() => {\n\t\t\tif (handle) {\n\t\t\t\tclearTimeout(handle);\n\t\t\t\thandle = undefined;\n\t\t\t}\n\t\t});\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,kBAAkB;AAC3B,SAAS,oBAAoB;AAC7B,SAAS,UAAU,eAAe;AAClC,SAAS,oCAAoC;AAC7C,SAAS,yBAAyB;AAClC,SAAS,gBAAgB;AAElB,IAAM,kBAAN,cAA8B,WAAW;AAAA,EAE/C,YACgD,oBAChB,aACK,kBACnC;AACD,UAAM;AAJyC;AAChB;AACK;AAGpC,SAAK,mBAAmB;AAAA,EACzB;AAAA,EArBD,OAYgD;AAAA;AAAA;AAAA,EAWvC,qBAA2B;AAClC,QAAI,SAAc,WAAW,YAAY;AACxC,eAAS;AACT,YAAM,OAAO,MAAM,KAAK,YAAY,QAAQ,QAAQ,KAAK,mBAAmB,QAAQ,CAAC;AACrF,UAAI,KAAK,UAAU;AAClB,cAAM,aAAa,SAAS,KAAK,mBAAmB,QAAQ;AAC5D,cAAM,cAAc,KAAK,SAAS,OAAO,CAAAA,UAAQA,MAAK,eAAe,gBAAgB,KAAKA,MAAK,IAAI,CAAC;AACpG,cAAM,cAAc,YAAY,KAAK,EAAE,OAAO,CAAC,GAAG,MAAM,EAAE,SAAS,UAAU;AAC7E,cAAM,WAAW,YAAY,MAAM,GAAG,KAAK,IAAI,GAAG,YAAY,SAAS,EAAE,CAAC;AAC1E,iBAAS,QAAQ,SAAS,IAAI,CAAAA,UAAQ,KAAK,YAAY,IAAIA,MAAK,UAAU,EAAE,WAAW,KAAK,CAAC,CAAC,CAAC;AAAA,MAChG;AAAA,IACD,GAAG,KAAK,GAAI;AACZ,SAAK,iBAAiB,eAAe,MAAM;AAC1C,UAAI,QAAQ;AACX,qBAAa,MAAM;AACnB,iBAAS;AAAA,MACV;AAAA,IACD,CAAC;AAAA,EACF;AACD;AA9Ba,kBAAN;AAAA,EAGJ;AAAA,EACA;AAAA,EACA;AAAA,GALU;",
  "names": ["stat"]
}
