{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/logs/common/logsDataCleaner.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Promises } from \"../../../../base/common/async.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport { basename, dirname } from \"../../../../base/common/resources.js\";\nimport { IFileService } from \"../../../../platform/files/common/files.js\";\nimport { IWorkbenchEnvironmentService } from \"../../../services/environment/common/environmentService.js\";\nimport { ILifecycleService } from \"../../../services/lifecycle/common/lifecycle.js\";\n\nexport class LogsDataCleaner extends Disposable {\n\tconstructor(\n\t\t@IWorkbenchEnvironmentService\n\t\tprivate readonly environmentService: IWorkbenchEnvironmentService,\n\t\t@IFileService private readonly fileService: IFileService,\n\t\t@ILifecycleService private readonly lifecycleService: ILifecycleService,\n\t) {\n\t\tsuper();\n\t\tthis.cleanUpOldLogsSoon();\n\t}\n\n\tprivate cleanUpOldLogsSoon(): void {\n\t\tlet handle: any = setTimeout(async () => {\n\t\t\thandle = undefined;\n\t\t\tconst stat = await this.fileService.resolve(\n\t\t\t\tdirname(this.environmentService.logsHome),\n\t\t\t);\n\t\t\tif (stat.children) {\n\t\t\t\tconst currentLog = basename(this.environmentService.logsHome);\n\t\t\t\tconst allSessions = stat.children.filter(\n\t\t\t\t\t(stat) =>\n\t\t\t\t\t\tstat.isDirectory && /^\\d{8}T\\d{6}$/.test(stat.name),\n\t\t\t\t);\n\t\t\t\tconst oldSessions = allSessions\n\t\t\t\t\t.sort()\n\t\t\t\t\t.filter((d, i) => d.name !== currentLog);\n\t\t\t\tconst toDelete = oldSessions.slice(\n\t\t\t\t\t0,\n\t\t\t\t\tMath.max(0, oldSessions.length - 49),\n\t\t\t\t);\n\t\t\t\tPromises.settled(\n\t\t\t\t\ttoDelete.map((stat) =>\n\t\t\t\t\t\tthis.fileService.del(stat.resource, {\n\t\t\t\t\t\t\trecursive: true,\n\t\t\t\t\t\t}),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t}\n\t\t}, 10 * 1000);\n\t\tthis.lifecycleService.onWillShutdown(() => {\n\t\t\tif (handle) {\n\t\t\t\tclearTimeout(handle);\n\t\t\t\thandle = undefined;\n\t\t\t}\n\t\t});\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,gBAAgB;AACzB,SAAS,kBAAkB;AAC3B,SAAS,UAAU,eAAe;AAClC,SAAS,oBAAoB;AAC7B,SAAS,oCAAoC;AAC7C,SAAS,yBAAyB;AAE3B,IAAM,kBAAN,cAA8B,WAAW;AAAA,EAC/C,YAEkB,oBACc,aACK,kBACnC;AACD,UAAM;AAJW;AACc;AACK;AAGpC,SAAK,mBAAmB;AAAA,EACzB;AAAA,EArBD,OAYgD;AAAA;AAAA;AAAA,EAWvC,qBAA2B;AAClC,QAAI,SAAc,WAAW,YAAY;AACxC,eAAS;AACT,YAAM,OAAO,MAAM,KAAK,YAAY;AAAA,QACnC,QAAQ,KAAK,mBAAmB,QAAQ;AAAA,MACzC;AACA,UAAI,KAAK,UAAU;AAClB,cAAM,aAAa,SAAS,KAAK,mBAAmB,QAAQ;AAC5D,cAAM,cAAc,KAAK,SAAS;AAAA,UACjC,CAACA,UACAA,MAAK,eAAe,gBAAgB,KAAKA,MAAK,IAAI;AAAA,QACpD;AACA,cAAM,cAAc,YAClB,KAAK,EACL,OAAO,CAAC,GAAG,MAAM,EAAE,SAAS,UAAU;AACxC,cAAM,WAAW,YAAY;AAAA,UAC5B;AAAA,UACA,KAAK,IAAI,GAAG,YAAY,SAAS,EAAE;AAAA,QACpC;AACA,iBAAS;AAAA,UACR,SAAS;AAAA,YAAI,CAACA,UACb,KAAK,YAAY,IAAIA,MAAK,UAAU;AAAA,cACnC,WAAW;AAAA,YACZ,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AAAA,IACD,GAAG,KAAK,GAAI;AACZ,SAAK,iBAAiB,eAAe,MAAM;AAC1C,UAAI,QAAQ;AACX,qBAAa,MAAM;AACnB,iBAAS;AAAA,MACV;AAAA,IACD,CAAC;AAAA,EACF;AACD;AA9Ca,kBAAN;AAAA,EAEJ;AAAA,EAEA;AAAA,EACA;AAAA,GALU;",
  "names": ["stat"]
}
