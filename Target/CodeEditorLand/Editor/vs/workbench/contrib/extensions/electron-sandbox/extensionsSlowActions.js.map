{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/extensions/electron-sandbox/extensionsSlowActions.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Action } from \"../../../../base/common/actions.js\";\nimport { VSBuffer } from \"../../../../base/common/buffer.js\";\nimport { CancellationToken } from \"../../../../base/common/cancellation.js\";\nimport { joinPath } from \"../../../../base/common/resources.js\";\nimport { URI } from \"../../../../base/common/uri.js\";\nimport type { IRequestContext } from \"../../../../base/parts/request/common/request.js\";\nimport { localize } from \"../../../../nls.js\";\nimport { IDialogService } from \"../../../../platform/dialogs/common/dialogs.js\";\nimport type { IExtensionDescription } from \"../../../../platform/extensions/common/extensions.js\";\nimport { IFileService } from \"../../../../platform/files/common/files.js\";\nimport {\n\tIInstantiationService,\n\ttype ServicesAccessor,\n} from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { INativeHostService } from \"../../../../platform/native/common/native.js\";\nimport { IOpenerService } from \"../../../../platform/opener/common/opener.js\";\nimport { IProductService } from \"../../../../platform/product/common/productService.js\";\nimport { Utils } from \"../../../../platform/profiling/common/profiling.js\";\nimport {\n\tIRequestService,\n\tasText,\n} from \"../../../../platform/request/common/request.js\";\nimport { INativeWorkbenchEnvironmentService } from \"../../../services/environment/electron-sandbox/environmentService.js\";\nimport type { IExtensionHostProfile } from \"../../../services/extensions/common/extensions.js\";\n\nabstract class RepoInfo {\n\tabstract get base(): string;\n\tabstract get owner(): string;\n\tabstract get repo(): string;\n\n\tstatic fromExtension(desc: IExtensionDescription): RepoInfo | undefined {\n\t\tlet result: RepoInfo | undefined;\n\n\t\t// scheme:auth/OWNER/REPO/issues/\n\t\tif (desc.bugs && typeof desc.bugs.url === \"string\") {\n\t\t\tconst base = URI.parse(desc.bugs.url);\n\t\t\tconst match = /\\/([^/]+)\\/([^/]+)\\/issues\\/?$/.exec(desc.bugs.url);\n\t\t\tif (match) {\n\t\t\t\tresult = {\n\t\t\t\t\tbase: base\n\t\t\t\t\t\t.with({ path: null, fragment: null, query: null })\n\t\t\t\t\t\t.toString(true),\n\t\t\t\t\towner: match[1],\n\t\t\t\t\trepo: match[2],\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\t// scheme:auth/OWNER/REPO.git\n\t\tif (\n\t\t\t!result &&\n\t\t\tdesc.repository &&\n\t\t\ttypeof desc.repository.url === \"string\"\n\t\t) {\n\t\t\tconst base = URI.parse(desc.repository.url);\n\t\t\tconst match = /\\/([^/]+)\\/([^/]+)(\\.git)?$/.exec(\n\t\t\t\tdesc.repository.url,\n\t\t\t);\n\t\t\tif (match) {\n\t\t\t\tresult = {\n\t\t\t\t\tbase: base\n\t\t\t\t\t\t.with({ path: null, fragment: null, query: null })\n\t\t\t\t\t\t.toString(true),\n\t\t\t\t\towner: match[1],\n\t\t\t\t\trepo: match[2],\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// for now only GH is supported\n\t\tif (result && result.base.indexOf(\"github\") === -1) {\n\t\t\tresult = undefined;\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nexport class SlowExtensionAction extends Action {\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IInstantiationService\n\t\tprivate readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper(\n\t\t\t\"report.slow\",\n\t\t\tlocalize(\"cmd.reportOrShow\", \"Performance Issue\"),\n\t\t\t\"extension-action report-issue\",\n\t\t);\n\t\tthis.enabled = Boolean(RepoInfo.fromExtension(extension));\n\t}\n\n\toverride async run(): Promise<void> {\n\t\tconst action = await this._instantiationService.invokeFunction(\n\t\t\tcreateSlowExtensionAction,\n\t\t\tthis.extension,\n\t\t\tthis.profile,\n\t\t);\n\t\tif (action) {\n\t\t\tawait action.run();\n\t\t}\n\t}\n}\n\nexport async function createSlowExtensionAction(\n\taccessor: ServicesAccessor,\n\textension: IExtensionDescription,\n\tprofile: IExtensionHostProfile,\n): Promise<Action | undefined> {\n\tconst info = RepoInfo.fromExtension(extension);\n\tif (!info) {\n\t\treturn undefined;\n\t}\n\n\tconst requestService = accessor.get(IRequestService);\n\tconst instaService = accessor.get(IInstantiationService);\n\tconst url = `https://api.github.com/search/issues?q=is:issue+state:open+in:title+repo:${info.owner}/${info.repo}+%22Extension+causes+high+cpu+load%22`;\n\tlet res: IRequestContext;\n\ttry {\n\t\tres = await requestService.request({ url }, CancellationToken.None);\n\t} catch {\n\t\treturn undefined;\n\t}\n\tconst rawText = await asText(res);\n\tif (!rawText) {\n\t\treturn undefined;\n\t}\n\n\tconst data = <{ total_count: number }>JSON.parse(rawText);\n\tif (!data || typeof data.total_count !== \"number\") {\n\t\treturn undefined;\n\t} else if (data.total_count === 0) {\n\t\treturn instaService.createInstance(\n\t\t\tReportExtensionSlowAction,\n\t\t\textension,\n\t\t\tinfo,\n\t\t\tprofile,\n\t\t);\n\t} else {\n\t\treturn instaService.createInstance(\n\t\t\tShowExtensionSlowAction,\n\t\t\textension,\n\t\t\tinfo,\n\t\t\tprofile,\n\t\t);\n\t}\n}\n\nclass ReportExtensionSlowAction extends Action {\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly repoInfo: RepoInfo,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@INativeHostService\n\t\tprivate readonly _nativeHostService: INativeHostService,\n\t\t@INativeWorkbenchEnvironmentService\n\t\tprivate readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t) {\n\t\tsuper(\"report.slow\", localize(\"cmd.report\", \"Report Issue\"));\n\t}\n\n\toverride async run(): Promise<void> {\n\t\t// rewrite pii (paths) and store on disk\n\t\tconst data = Utils.rewriteAbsolutePaths(\n\t\t\tthis.profile.data,\n\t\t\t\"pii_removed\",\n\t\t);\n\t\tconst path = joinPath(\n\t\t\tthis._environmentService.tmpDir,\n\t\t\t`${this.extension.identifier.value}-unresponsive.cpuprofile.txt`,\n\t\t);\n\t\tawait this._fileService.writeFile(\n\t\t\tpath,\n\t\t\tVSBuffer.fromString(JSON.stringify(data, undefined, 4)),\n\t\t);\n\n\t\t// build issue\n\t\tconst os = await this._nativeHostService.getOSProperties();\n\t\tconst title = encodeURIComponent(\"Extension causes high cpu load\");\n\t\tconst osVersion = `${os.type} ${os.arch} ${os.release}`;\n\t\tconst message = `:warning: Make sure to **attach** this file from your *home*-directory:\\n:warning:\\`${path}\\`\\n\\nFind more details here: https://github.com/microsoft/vscode/wiki/Explain-extension-causes-high-cpu-load`;\n\t\tconst body = encodeURIComponent(`- Issue Type: \\`Performance\\`\n- Extension Name: \\`${this.extension.name}\\`\n- Extension Version: \\`${this.extension.version}\\`\n- OS Version: \\`${osVersion}\\`\n- VS Code version: \\`${this._productService.version}\\`\\n\\n${message}`);\n\n\t\tconst url = `${this.repoInfo.base}/${this.repoInfo.owner}/${this.repoInfo.repo}/issues/new/?body=${body}&title=${title}`;\n\t\tthis._openerService.open(URI.parse(url));\n\n\t\tthis._dialogService.info(\n\t\t\tlocalize(\"attach.title\", \"Did you attach the CPU-Profile?\"),\n\t\t\tlocalize(\n\t\t\t\t\"attach.msg\",\n\t\t\t\t\"This is a reminder to make sure that you have not forgotten to attach '{0}' to the issue you have just created.\",\n\t\t\t\tpath.fsPath,\n\t\t\t),\n\t\t);\n\t}\n}\n\nclass ShowExtensionSlowAction extends Action {\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly repoInfo: RepoInfo,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@INativeWorkbenchEnvironmentService\n\t\tprivate readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t) {\n\t\tsuper(\"show.slow\", localize(\"cmd.show\", \"Show Issues\"));\n\t}\n\n\toverride async run(): Promise<void> {\n\t\t// rewrite pii (paths) and store on disk\n\t\tconst data = Utils.rewriteAbsolutePaths(\n\t\t\tthis.profile.data,\n\t\t\t\"pii_removed\",\n\t\t);\n\t\tconst path = joinPath(\n\t\t\tthis._environmentService.tmpDir,\n\t\t\t`${this.extension.identifier.value}-unresponsive.cpuprofile.txt`,\n\t\t);\n\t\tawait this._fileService.writeFile(\n\t\t\tpath,\n\t\t\tVSBuffer.fromString(JSON.stringify(data, undefined, 4)),\n\t\t);\n\n\t\t// show issues\n\t\tconst url = `${this.repoInfo.base}/${this.repoInfo.owner}/${this.repoInfo.repo}/issues?utf8=\u2713&q=is%3Aissue+state%3Aopen+%22Extension+causes+high+cpu+load%22`;\n\t\tthis._openerService.open(URI.parse(url));\n\n\t\tthis._dialogService.info(\n\t\t\tlocalize(\"attach.title\", \"Did you attach the CPU-Profile?\"),\n\t\t\tlocalize(\n\t\t\t\t\"attach.msg2\",\n\t\t\t\t\"This is a reminder to make sure that you have not forgotten to attach '{0}' to an existing performance issue.\",\n\t\t\t\tpath.fsPath,\n\t\t\t),\n\t\t);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,cAAc;AACvB,SAAS,gBAAgB;AACzB,SAAS,yBAAyB;AAClC,SAAS,gBAAgB;AACzB,SAAS,WAAW;AAEpB,SAAS,gBAAgB;AACzB,SAAS,sBAAsB;AAE/B,SAAS,oBAAoB;AAC7B;AAAA,EACC;AAAA,OAEM;AACP,SAAS,0BAA0B;AACnC,SAAS,sBAAsB;AAC/B,SAAS,uBAAuB;AAChC,SAAS,aAAa;AACtB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,0CAA0C;AAGnD,MAAe,SAAS;AAAA,EA9BxB,OA8BwB;AAAA;AAAA;AAAA,EAKvB,OAAO,cAAc,MAAmD;AACvE,QAAI;AAGJ,QAAI,KAAK,QAAQ,OAAO,KAAK,KAAK,QAAQ,UAAU;AACnD,YAAM,OAAO,IAAI,MAAM,KAAK,KAAK,GAAG;AACpC,YAAM,QAAQ,iCAAiC,KAAK,KAAK,KAAK,GAAG;AACjE,UAAI,OAAO;AACV,iBAAS;AAAA,UACR,MAAM,KACJ,KAAK,EAAE,MAAM,MAAM,UAAU,MAAM,OAAO,KAAK,CAAC,EAChD,SAAS,IAAI;AAAA,UACf,OAAO,MAAM,CAAC;AAAA,UACd,MAAM,MAAM,CAAC;AAAA,QACd;AAAA,MACD;AAAA,IACD;AAEA,QACC,CAAC,UACD,KAAK,cACL,OAAO,KAAK,WAAW,QAAQ,UAC9B;AACD,YAAM,OAAO,IAAI,MAAM,KAAK,WAAW,GAAG;AAC1C,YAAM,QAAQ,8BAA8B;AAAA,QAC3C,KAAK,WAAW;AAAA,MACjB;AACA,UAAI,OAAO;AACV,iBAAS;AAAA,UACR,MAAM,KACJ,KAAK,EAAE,MAAM,MAAM,UAAU,MAAM,OAAO,KAAK,CAAC,EAChD,SAAS,IAAI;AAAA,UACf,OAAO,MAAM,CAAC;AAAA,UACd,MAAM,MAAM,CAAC;AAAA,QACd;AAAA,MACD;AAAA,IACD;AAGA,QAAI,UAAU,OAAO,KAAK,QAAQ,QAAQ,MAAM,IAAI;AACnD,eAAS;AAAA,IACV;AAEA,WAAO;AAAA,EACR;AACD;AAEO,IAAM,sBAAN,cAAkC,OAAO;AAAA,EAC/C,YACU,WACA,SAEQ,uBAChB;AACD;AAAA,MACC;AAAA,MACA,SAAS,oBAAoB,mBAAmB;AAAA,MAChD;AAAA,IACD;AATS;AACA;AAEQ;AAOjB,SAAK,UAAU,QAAQ,SAAS,cAAc,SAAS,CAAC;AAAA,EACzD;AAAA,EA/FD,OAkFgD;AAAA;AAAA;AAAA,EAe/C,MAAe,MAAqB;AACnC,UAAM,SAAS,MAAM,KAAK,sBAAsB;AAAA,MAC/C;AAAA,MACA,KAAK;AAAA,MACL,KAAK;AAAA,IACN;AACA,QAAI,QAAQ;AACX,YAAM,OAAO,IAAI;AAAA,IAClB;AAAA,EACD;AACD;AAzBa,sBAAN;AAAA,EAIJ;AAAA,GAJU;AA2Bb,eAAsB,0BACrB,UACA,WACA,SAC8B;AAC9B,QAAM,OAAO,SAAS,cAAc,SAAS;AAC7C,MAAI,CAAC,MAAM;AACV,WAAO;AAAA,EACR;AAEA,QAAM,iBAAiB,SAAS,IAAI,eAAe;AACnD,QAAM,eAAe,SAAS,IAAI,qBAAqB;AACvD,QAAM,MAAM,4EAA4E,KAAK,KAAK,IAAI,KAAK,IAAI;AAC/G,MAAI;AACJ,MAAI;AACH,UAAM,MAAM,eAAe,QAAQ,EAAE,IAAI,GAAG,kBAAkB,IAAI;AAAA,EACnE,QAAQ;AACP,WAAO;AAAA,EACR;AACA,QAAM,UAAU,MAAM,OAAO,GAAG;AAChC,MAAI,CAAC,SAAS;AACb,WAAO;AAAA,EACR;AAEA,QAAM,OAAgC,KAAK,MAAM,OAAO;AACxD,MAAI,CAAC,QAAQ,OAAO,KAAK,gBAAgB,UAAU;AAClD,WAAO;AAAA,EACR,WAAW,KAAK,gBAAgB,GAAG;AAClC,WAAO,aAAa;AAAA,MACnB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD,OAAO;AACN,WAAO,aAAa;AAAA,MACnB;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD;AACD;AA1CsB;AA4CtB,IAAM,4BAAN,cAAwC,OAAO;AAAA,EAC9C,YACU,WACA,UACA,SACwB,gBACA,gBACC,iBAEjB,oBAEA,qBACc,cAC9B;AACD,UAAM,eAAe,SAAS,cAAc,cAAc,CAAC;AAZlD;AACA;AACA;AACwB;AACA;AACC;AAEjB;AAEA;AACc;AAAA,EAGhC;AAAA,EAxKD,OAyJ+C;AAAA;AAAA;AAAA,EAiB9C,MAAe,MAAqB;AAEnC,UAAM,OAAO,MAAM;AAAA,MAClB,KAAK,QAAQ;AAAA,MACb;AAAA,IACD;AACA,UAAM,OAAO;AAAA,MACZ,KAAK,oBAAoB;AAAA,MACzB,GAAG,KAAK,UAAU,WAAW,KAAK;AAAA,IACnC;AACA,UAAM,KAAK,aAAa;AAAA,MACvB;AAAA,MACA,SAAS,WAAW,KAAK,UAAU,MAAM,QAAW,CAAC,CAAC;AAAA,IACvD;AAGA,UAAM,KAAK,MAAM,KAAK,mBAAmB,gBAAgB;AACzD,UAAM,QAAQ,mBAAmB,gCAAgC;AACjE,UAAM,YAAY,GAAG,GAAG,IAAI,IAAI,GAAG,IAAI,IAAI,GAAG,OAAO;AACrD,UAAM,UAAU;AAAA,aAAuF,IAAI;AAAA;AAAA;AAC3G,UAAM,OAAO,mBAAmB;AAAA,sBACZ,KAAK,UAAU,IAAI;AAAA,yBAChB,KAAK,UAAU,OAAO;AAAA,kBAC7B,SAAS;AAAA,uBACJ,KAAK,gBAAgB,OAAO;AAAA;AAAA,EAAS,OAAO,EAAE;AAEnE,UAAM,MAAM,GAAG,KAAK,SAAS,IAAI,IAAI,KAAK,SAAS,KAAK,IAAI,KAAK,SAAS,IAAI,qBAAqB,IAAI,UAAU,KAAK;AACtH,SAAK,eAAe,KAAK,IAAI,MAAM,GAAG,CAAC;AAEvC,SAAK,eAAe;AAAA,MACnB,SAAS,gBAAgB,iCAAiC;AAAA,MAC1D;AAAA,QACC;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AAvDM,4BAAN;AAAA,EAKG;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EAEA;AAAA,GAZG;AAyDN,IAAM,0BAAN,cAAsC,OAAO;AAAA,EAC5C,YACU,WACA,UACA,SACwB,gBACA,gBAEhB,qBACc,cAC9B;AACD,UAAM,aAAa,SAAS,YAAY,aAAa,CAAC;AAT7C;AACA;AACA;AACwB;AACA;AAEhB;AACc;AAAA,EAGhC;AAAA,EA9ND,OAkN6C;AAAA;AAAA;AAAA,EAc5C,MAAe,MAAqB;AAEnC,UAAM,OAAO,MAAM;AAAA,MAClB,KAAK,QAAQ;AAAA,MACb;AAAA,IACD;AACA,UAAM,OAAO;AAAA,MACZ,KAAK,oBAAoB;AAAA,MACzB,GAAG,KAAK,UAAU,WAAW,KAAK;AAAA,IACnC;AACA,UAAM,KAAK,aAAa;AAAA,MACvB;AAAA,MACA,SAAS,WAAW,KAAK,UAAU,MAAM,QAAW,CAAC,CAAC;AAAA,IACvD;AAGA,UAAM,MAAM,GAAG,KAAK,SAAS,IAAI,IAAI,KAAK,SAAS,KAAK,IAAI,KAAK,SAAS,IAAI;AAC9E,SAAK,eAAe,KAAK,IAAI,MAAM,GAAG,CAAC;AAEvC,SAAK,eAAe;AAAA,MACnB,SAAS,gBAAgB,iCAAiC;AAAA,MAC1D;AAAA,QACC;AAAA,QACA;AAAA,QACA,KAAK;AAAA,MACN;AAAA,IACD;AAAA,EACD;AACD;AA1CM,0BAAN;AAAA,EAKG;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,GATG;",
  "names": []
}
