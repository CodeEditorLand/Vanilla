{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/extensions/electron-sandbox/extensionsSlowActions.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IProductService } from '../../../../platform/product/common/productService.js';\nimport { Action } from '../../../../base/common/actions.js';\nimport { IExtensionDescription } from '../../../../platform/extensions/common/extensions.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IExtensionHostProfile } from '../../../services/extensions/common/extensions.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { localize } from '../../../../nls.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { IRequestService, asText } from '../../../../platform/request/common/request.js';\nimport { joinPath } from '../../../../base/common/resources.js';\nimport { IDialogService } from '../../../../platform/dialogs/common/dialogs.js';\nimport { IOpenerService } from '../../../../platform/opener/common/opener.js';\nimport { INativeHostService } from '../../../../platform/native/common/native.js';\nimport { INativeWorkbenchEnvironmentService } from '../../../services/environment/electron-sandbox/environmentService.js';\nimport { Utils } from '../../../../platform/profiling/common/profiling.js';\nimport { IFileService } from '../../../../platform/files/common/files.js';\nimport { VSBuffer } from '../../../../base/common/buffer.js';\nimport { IRequestContext } from '../../../../base/parts/request/common/request.js';\n\nabstract class RepoInfo {\n\tabstract get base(): string;\n\tabstract get owner(): string;\n\tabstract get repo(): string;\n\n\tstatic fromExtension(desc: IExtensionDescription): RepoInfo | undefined {\n\n\t\tlet result: RepoInfo | undefined;\n\n\t\t// scheme:auth/OWNER/REPO/issues/\n\t\tif (desc.bugs && typeof desc.bugs.url === 'string') {\n\t\t\tconst base = URI.parse(desc.bugs.url);\n\t\t\tconst match = /\\/([^/]+)\\/([^/]+)\\/issues\\/?$/.exec(desc.bugs.url);\n\t\t\tif (match) {\n\t\t\t\tresult = {\n\t\t\t\t\tbase: base.with({ path: null, fragment: null, query: null }).toString(true),\n\t\t\t\t\towner: match[1],\n\t\t\t\t\trepo: match[2]\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t\t// scheme:auth/OWNER/REPO.git\n\t\tif (!result && desc.repository && typeof desc.repository.url === 'string') {\n\t\t\tconst base = URI.parse(desc.repository.url);\n\t\t\tconst match = /\\/([^/]+)\\/([^/]+)(\\.git)?$/.exec(desc.repository.url);\n\t\t\tif (match) {\n\t\t\t\tresult = {\n\t\t\t\t\tbase: base.with({ path: null, fragment: null, query: null }).toString(true),\n\t\t\t\t\towner: match[1],\n\t\t\t\t\trepo: match[2]\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\n\t\t// for now only GH is supported\n\t\tif (result && result.base.indexOf('github') === -1) {\n\t\t\tresult = undefined;\n\t\t}\n\n\t\treturn result;\n\t}\n}\n\nexport class SlowExtensionAction extends Action {\n\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService,\n\t) {\n\t\tsuper('report.slow', localize('cmd.reportOrShow', \"Performance Issue\"), 'extension-action report-issue');\n\t\tthis.enabled = Boolean(RepoInfo.fromExtension(extension));\n\t}\n\n\toverride async run(): Promise<void> {\n\t\tconst action = await this._instantiationService.invokeFunction(createSlowExtensionAction, this.extension, this.profile);\n\t\tif (action) {\n\t\t\tawait action.run();\n\t\t}\n\t}\n}\n\nexport async function createSlowExtensionAction(\n\taccessor: ServicesAccessor,\n\textension: IExtensionDescription,\n\tprofile: IExtensionHostProfile\n): Promise<Action | undefined> {\n\n\tconst info = RepoInfo.fromExtension(extension);\n\tif (!info) {\n\t\treturn undefined;\n\t}\n\n\tconst requestService = accessor.get(IRequestService);\n\tconst instaService = accessor.get(IInstantiationService);\n\tconst url = `https://api.github.com/search/issues?q=is:issue+state:open+in:title+repo:${info.owner}/${info.repo}+%22Extension+causes+high+cpu+load%22`;\n\tlet res: IRequestContext;\n\ttry {\n\t\tres = await requestService.request({ url }, CancellationToken.None);\n\t} catch {\n\t\treturn undefined;\n\t}\n\tconst rawText = await asText(res);\n\tif (!rawText) {\n\t\treturn undefined;\n\t}\n\n\tconst data = <{ total_count: number }>JSON.parse(rawText);\n\tif (!data || typeof data.total_count !== 'number') {\n\t\treturn undefined;\n\t} else if (data.total_count === 0) {\n\t\treturn instaService.createInstance(ReportExtensionSlowAction, extension, info, profile);\n\t} else {\n\t\treturn instaService.createInstance(ShowExtensionSlowAction, extension, info, profile);\n\t}\n}\n\nclass ReportExtensionSlowAction extends Action {\n\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly repoInfo: RepoInfo,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@IProductService private readonly _productService: IProductService,\n\t\t@INativeHostService private readonly _nativeHostService: INativeHostService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\t) {\n\t\tsuper('report.slow', localize('cmd.report', \"Report Issue\"));\n\t}\n\n\toverride async run(): Promise<void> {\n\n\t\t// rewrite pii (paths) and store on disk\n\t\tconst data = Utils.rewriteAbsolutePaths(this.profile.data, 'pii_removed');\n\t\tconst path = joinPath(this._environmentService.tmpDir, `${this.extension.identifier.value}-unresponsive.cpuprofile.txt`);\n\t\tawait this._fileService.writeFile(path, VSBuffer.fromString(JSON.stringify(data, undefined, 4)));\n\n\t\t// build issue\n\t\tconst os = await this._nativeHostService.getOSProperties();\n\t\tconst title = encodeURIComponent('Extension causes high cpu load');\n\t\tconst osVersion = `${os.type} ${os.arch} ${os.release}`;\n\t\tconst message = `:warning: Make sure to **attach** this file from your *home*-directory:\\n:warning:\\`${path}\\`\\n\\nFind more details here: https://github.com/microsoft/vscode/wiki/Explain-extension-causes-high-cpu-load`;\n\t\tconst body = encodeURIComponent(`- Issue Type: \\`Performance\\`\n- Extension Name: \\`${this.extension.name}\\`\n- Extension Version: \\`${this.extension.version}\\`\n- OS Version: \\`${osVersion}\\`\n- VS Code version: \\`${this._productService.version}\\`\\n\\n${message}`);\n\n\t\tconst url = `${this.repoInfo.base}/${this.repoInfo.owner}/${this.repoInfo.repo}/issues/new/?body=${body}&title=${title}`;\n\t\tthis._openerService.open(URI.parse(url));\n\n\t\tthis._dialogService.info(\n\t\t\tlocalize('attach.title', \"Did you attach the CPU-Profile?\"),\n\t\t\tlocalize('attach.msg', \"This is a reminder to make sure that you have not forgotten to attach '{0}' to the issue you have just created.\", path.fsPath)\n\t\t);\n\t}\n}\n\nclass ShowExtensionSlowAction extends Action {\n\n\tconstructor(\n\t\treadonly extension: IExtensionDescription,\n\t\treadonly repoInfo: RepoInfo,\n\t\treadonly profile: IExtensionHostProfile,\n\t\t@IDialogService private readonly _dialogService: IDialogService,\n\t\t@IOpenerService private readonly _openerService: IOpenerService,\n\t\t@INativeWorkbenchEnvironmentService private readonly _environmentService: INativeWorkbenchEnvironmentService,\n\t\t@IFileService private readonly _fileService: IFileService,\n\n\t) {\n\t\tsuper('show.slow', localize('cmd.show', \"Show Issues\"));\n\t}\n\n\toverride async run(): Promise<void> {\n\n\t\t// rewrite pii (paths) and store on disk\n\t\tconst data = Utils.rewriteAbsolutePaths(this.profile.data, 'pii_removed');\n\t\tconst path = joinPath(this._environmentService.tmpDir, `${this.extension.identifier.value}-unresponsive.cpuprofile.txt`);\n\t\tawait this._fileService.writeFile(path, VSBuffer.fromString(JSON.stringify(data, undefined, 4)));\n\n\t\t// show issues\n\t\tconst url = `${this.repoInfo.base}/${this.repoInfo.owner}/${this.repoInfo.repo}/issues?utf8=\u2713&q=is%3Aissue+state%3Aopen+%22Extension+causes+high+cpu+load%22`;\n\t\tthis._openerService.open(URI.parse(url));\n\n\t\tthis._dialogService.info(\n\t\t\tlocalize('attach.title', \"Did you attach the CPU-Profile?\"),\n\t\t\tlocalize('attach.msg2', \"This is a reminder to make sure that you have not forgotten to attach '{0}' to an existing performance issue.\", path.fsPath)\n\t\t);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
