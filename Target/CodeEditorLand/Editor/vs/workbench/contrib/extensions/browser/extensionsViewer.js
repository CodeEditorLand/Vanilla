var w=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var I=(a,e,t,n)=>{for(var i=n>1?void 0:n?M(e,t):e,s=a.length-1,r;s>=0;s--)(r=a[s])&&(i=(n?r(e,t,i):r(i))||i);return n&&i&&w(e,t,i),i},c=(a,e)=>(t,n)=>e(t,n,a);import*as o from"../../../../base/browser/dom.js";import{localize as v}from"../../../../nls.js";import{dispose as P,Disposable as $,DisposableStore as W,toDisposable as A}from"../../../../base/common/lifecycle.js";import{Action as K}from"../../../../base/common/actions.js";import{IExtensionsWorkbenchService as S}from"../common/extensions.js";import{Event as C}from"../../../../base/common/event.js";import{IInstantiationService as f}from"../../../../platform/instantiation/common/instantiation.js";import{IListService as H,WorkbenchAsyncDataTree as N}from"../../../../platform/list/browser/listService.js";import{IConfigurationService as _}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as F}from"../../../../platform/contextkey/common/contextkey.js";import{registerThemingParticipant as U}from"../../../../platform/theme/common/themeService.js";import"../../../../base/browser/ui/tree/tree.js";import"../../../../base/browser/ui/list/list.js";import{CancellationToken as B}from"../../../../base/common/cancellation.js";import{isNonEmptyArray as R}from"../../../../base/common/arrays.js";import{Renderer as O}from"./extensionsList.js";import{listFocusForeground as q,listFocusBackground as Y,foreground as z,editorBackground as Q}from"../../../../platform/theme/common/colorRegistry.js";import{StandardKeyboardEvent as y}from"../../../../base/browser/keyboardEvent.js";import{StandardMouseEvent as j}from"../../../../base/browser/mouseEvent.js";import{KeyCode as J}from"../../../../base/common/keyCodes.js";import"../../../../base/browser/ui/list/listWidget.js";import{HoverPosition as V}from"../../../../base/browser/ui/hover/hoverWidget.js";import"../../../../platform/theme/browser/defaultStyles.js";import{getAriaLabelForExtension as X}from"./extensionsViews.js";let E=class extends ${constructor(t,n,i){super();this.instantiationService=i;this.element=o.append(t,o.$(".extensions-grid-view")),this.renderer=this.instantiationService.createInstance(O,{onFocus:C.None,onBlur:C.None},{hoverOptions:{position(){return V.BELOW}}}),this.delegate=n,this.disposableStore=this._register(new W)}element;renderer;delegate;disposableStore;setExtensions(t){this.disposableStore.clear(),t.forEach((n,i)=>this.renderExtension(n,i))}renderExtension(t,n){const i=o.append(this.element,o.$(".extension-container"));i.style.height=`${this.delegate.getHeight()}px`,i.setAttribute("tabindex","0");const s=this.renderer.renderTemplate(i);this.disposableStore.add(A(()=>this.renderer.disposeTemplate(s)));const r=this.instantiationService.createInstance(u);r.extension=t,s.name.setAttribute("tabindex","0");const d=l=>{l instanceof y&&l.keyCode!==J.Enter||(r.run(l.ctrlKey||l.metaKey),l.stopPropagation(),l.preventDefault())};this.disposableStore.add(o.addDisposableListener(s.name,o.EventType.CLICK,l=>d(new j(o.getWindow(s.name),l)))),this.disposableStore.add(o.addDisposableListener(s.name,o.EventType.KEY_DOWN,l=>d(new y(l)))),this.disposableStore.add(o.addDisposableListener(i,o.EventType.KEY_DOWN,l=>d(new y(l)))),this.renderer.renderElement(t,n,s)}};E=I([c(2,f)],E);class Z{hasChildren({hasChildren:e}){return e}getChildren(e){return e.getChildren()}}class G{getHeight(e){return 62}getTemplateId({extension:e}){return e?m.TEMPLATE_ID:g.TEMPLATE_ID}}let m=class{constructor(e){this.instantiationService=e}static TEMPLATE_ID="extension-template";get templateId(){return m.TEMPLATE_ID}renderTemplate(e){e.classList.add("extension");const t=o.append(e,o.$("img.icon")),n=o.append(e,o.$(".details")),i=o.append(n,o.$(".header")),s=o.append(i,o.$("span.name")),r=this.instantiationService.createInstance(u),d=[o.addDisposableListener(s,"click",p=>{r.run(p.ctrlKey||p.metaKey),p.stopPropagation(),p.preventDefault()})],l=o.append(i,o.$("span.identifier")),b=o.append(n,o.$(".footer")),D=o.append(b,o.$(".author"));return{icon:t,name:s,identifier:l,author:D,extensionDisposables:d,set extensionData(p){r.extension=p.extension}}}renderElement(e,t,n){const i=e.element.extension;n.extensionDisposables.push(o.addDisposableListener(n.icon,"error",()=>n.icon.src=i.iconUrlFallback,{once:!0})),n.icon.src=i.iconUrl,n.icon.complete?n.icon.style.visibility="inherit":(n.icon.style.visibility="hidden",n.icon.onload=()=>n.icon.style.visibility="inherit"),n.name.textContent=i.displayName,n.identifier.textContent=i.identifier.id,n.author.textContent=i.publisherDisplayName,n.extensionData=e.element}disposeTemplate(e){e.extensionDisposables=P(e.extensionDisposables)}};m=I([c(0,f)],m);class g{static TEMPLATE_ID="unknown-extension-template";get templateId(){return g.TEMPLATE_ID}renderTemplate(e){const t=o.append(e,o.$("div.unknown-extension"));return o.append(t,o.$("span.error-marker")).textContent=v("error","Error"),o.append(t,o.$("span.message")).textContent=v("Unknown Extension","Unknown Extension:"),{identifier:o.append(t,o.$("span.message"))}}renderElement(e,t,n){n.identifier.textContent=e.element.extension.identifier.id}disposeTemplate(e){}}let u=class extends K{constructor(t){super("extensions.action.openExtension","");this.extensionsWorkdbenchService=t}_extension;set extension(t){this._extension=t}run(t){return this._extension?this.extensionsWorkdbenchService.open(this._extension,{sideByside:t}):Promise.resolve()}};u=I([c(0,S)],u);let h=class extends N{constructor(e,t,n,i,s,r,d,l){const b=new G,D=new Z,p=[r.createInstance(m),r.createInstance(g)],k={getId({extension:x,parent:T}){return T?this.getId(T)+"/"+x.identifier.id:x.identifier.id}};super("ExtensionsTree",t,b,p,D,{indent:40,identityProvider:k,multipleSelectionSupport:!1,overrideStyles:n,accessibilityProvider:{getAriaLabel(x){return X(x.extension)},getWidgetAriaLabel(){return v("extensions","Extensions")}}},r,i,s,d),this.setInput(e),this.disposables.add(this.onDidChangeSelection(x=>{o.isKeyboardEvent(x.browserEvent)&&l.open(x.elements[0].extension,{sideByside:!1})}))}};h=I([c(3,F),c(4,H),c(5,f),c(6,_),c(7,S)],h);class L{extension;parent;getChildrenExtensionIds;childrenExtensionIds;extensionsWorkbenchService;constructor(e,t,n,i){this.extension=e,this.parent=t,this.getChildrenExtensionIds=n,this.extensionsWorkbenchService=i,this.childrenExtensionIds=this.getChildrenExtensionIds(e)}get hasChildren(){return R(this.childrenExtensionIds)}async getChildren(){return this.hasChildren?(await ee(this.childrenExtensionIds,this.extensionsWorkbenchService)).map(t=>new L(t,this,this.getChildrenExtensionIds,this.extensionsWorkbenchService)):null}}async function ee(a,e){const t=e.local.reduce((s,r)=>(s.set(r.identifier.id.toLowerCase(),r),s),new Map),n=[],i=[];for(const s of a){const r=s.toLowerCase(),d=t.get(r);d?n.push(d):i.push(r)}if(i.length){const s=await e.getExtensions(i.map(r=>({id:r})),B.None);n.push(...s)}return n}U((a,e)=>{const t=a.getColor(Y);t&&e.addRule(`.extensions-grid-view .extension-container:focus { background-color: ${t}; outline: none; }`);const n=a.getColor(q);n&&e.addRule(`.extensions-grid-view .extension-container:focus { color: ${n}; }`);const i=a.getColor(z),s=a.getColor(Q);if(i&&s){const r=i.transparent(.9).makeOpaque(s);e.addRule(`.extensions-grid-view .extension-container:not(.disabled) .author { color: ${r}; }`);const d=i.transparent(.5).makeOpaque(s);e.addRule(`.extensions-grid-view .extension-container.disabled { color: ${d}; }`)}});export{L as ExtensionData,E as ExtensionsGridView,h as ExtensionsTree,ee as getExtensions};
