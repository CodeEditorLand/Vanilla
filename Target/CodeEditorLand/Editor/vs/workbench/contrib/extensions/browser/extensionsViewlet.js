var re=Object.defineProperty;var oe=Object.getOwnPropertyDescriptor;var b=(g,u,e,t)=>{for(var n=t>1?void 0:t?oe(u,e):u,i=g.length-1,h;i>=0;i--)(h=g[i])&&(n=(t?h(u,e,n):h(n))||n);return t&&n&&re(u,e,n),n},r=(g,u)=>(e,t)=>u(e,t,g);import"./media/extensionsViewlet.css";import{$ as I,append as C,Dimension as _,DragAndDropObserver as ae,hide as L,show as ce,trackFocus as le}from"../../../../base/browser/dom.js";import{alert as K}from"../../../../base/browser/ui/aria/aria.js";import{Action as he}from"../../../../base/common/actions.js";import{coalesce as de}from"../../../../base/common/arrays.js";import{Delayer as pe,Promises as xe,timeout as ue}from"../../../../base/common/async.js";import{createErrorWithActions as me}from"../../../../base/common/errorMessage.js";import{isCancellationError as ve}from"../../../../base/common/errors.js";import{Event as D}from"../../../../base/common/event.js";import{Disposable as N,MutableDisposable as Ee}from"../../../../base/common/lifecycle.js";import{extname as ge}from"../../../../base/common/resources.js";import we from"../../../../base/common/severity.js";import{localize as m,localize2 as o}from"../../../../nls.js";import"../../../../platform/action/common/action.js";import{createActionViewItem as Se}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{MenuWorkbenchToolBar as fe}from"../../../../platform/actions/browser/toolbar.js";import{Action2 as F,MenuId as ye,registerAction2 as Q}from"../../../../platform/actions/common/actions.js";import{ICommandService as be}from"../../../../platform/commands/common/commands.js";import{IConfigurationService as H}from"../../../../platform/configuration/common/configuration.js";import{ContextKeyExpr as s,IContextKeyService as q,RawContextKey as p}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as Ie}from"../../../../platform/contextview/browser/contextView.js";import{extractEditorsAndFilesDropData as Ce}from"../../../../platform/dnd/browser/dnd.js";import{IExtensionManagementService as De}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{areSameExtensions as Ve}from"../../../../platform/extensionManagement/common/extensionManagementUtil.js";import{EXTENSION_CATEGORIES as ke,ExtensionType as Me}from"../../../../platform/extensions/common/extensions.js";import{SyncDescriptor as l}from"../../../../platform/instantiation/common/descriptors.js";import{IInstantiationService as U}from"../../../../platform/instantiation/common/instantiation.js";import{ILabelService as Ke}from"../../../../platform/label/common/label.js";import{ILogService as Re}from"../../../../platform/log/common/log.js";import{INotificationService as G,NotificationPriority as Te}from"../../../../platform/notification/common/notification.js";import{IProgressService as We,ProgressLocation as Be}from"../../../../platform/progress/common/progress.js";import{Registry as Le}from"../../../../platform/registry/common/platform.js";import{IStorageService as Ue,StorageScope as Pe,StorageTarget as Oe}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as Ae}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as _e}from"../../../../platform/theme/common/themeService.js";import{IWorkspaceContextService as Ne}from"../../../../platform/workspace/common/workspace.js";import{registerNavigableContainer as Fe}from"../../../browser/actions/widgetNavigationCommands.js";import"../../../browser/parts/views/viewPane.js";import{ViewPaneContainer as Qe}from"../../../browser/parts/views/viewPaneContainer.js";import{VirtualWorkspaceContext as $,WorkbenchStateContext as He}from"../../../common/contextkeys.js";import"../../../common/contributions.js";import"../../../common/memento.js";import"../../../common/panecomposite.js";import{SIDE_BAR_DRAG_AND_DROP_BACKGROUND as qe}from"../../../common/theme.js";import{Extensions as Ge,IViewDescriptorService as z,ViewContainerLocation as $e}from"../../../common/views.js";import{IActivityService as ze,NumberBadge as Xe}from"../../../services/activity/common/activity.js";import{IEditorGroupsService as je}from"../../../services/editor/common/editorGroupsService.js";import{IWorkbenchEnvironmentService as Ye}from"../../../services/environment/common/environmentService.js";import{IExtensionManagementServerService as X,IWorkbenchExtensionEnablementService as Je}from"../../../services/extensionManagement/common/extensionManagement.js";import{IExtensionService as Ze}from"../../../services/extensions/common/extensions.js";import{IHostService as et}from"../../../services/host/browser/host.js";import{IWorkbenchLayoutService as tt}from"../../../services/layout/browser/layoutService.js";import{IPaneCompositePartService as nt}from"../../../services/panecomposite/browser/panecomposite.js";import{IPreferencesService as st}from"../../../services/preferences/common/preferences.js";import{SuggestEnabledInput as it}from"../../codeEditor/browser/suggestEnabledInput/suggestEnabledInput.js";import{Query as j}from"../common/extensionQuery.js";import{AutoCheckUpdatesConfigurationKey as rt,AutoRestartConfigurationKey as ot,CloseExtensionDetailsOnViewChangeKey as at,CONTEXT_HAS_GALLERY as Y,extensionsSearchActionsMenu as ct,IExtensionsWorkbenchService as J,INSTALL_EXTENSION_FROM_VSIX_COMMAND_ID as lt,OUTDATED_EXTENSIONS_VIEW_ID as ht,VIEWLET_ID as V,WORKSPACE_RECOMMENDATIONS_VIEW_ID as dt}from"../common/extensions.js";import{ExtensionsInput as pt}from"../common/extensionsInput.js";import{InstallLocalExtensionsInRemoteAction as xt,InstallRemoteExtensionsInLocalAction as ut}from"./extensionsActions.js";import{installLocalInRemoteIcon as mt}from"./extensionsIcons.js";import{DefaultPopularExtensionsView as vt,DefaultRecommendedExtensionsView as Et,DeprecatedExtensionsView as gt,DisabledExtensionsView as wt,EnabledExtensionsView as St,ExtensionsListView as a,NONE_CATEGORY as ft,OutdatedExtensionsView as yt,RecentlyUpdatedExtensionsView as bt,RecommendedExtensionsView as It,SearchMarketplaceExtensionsView as Ct,ServerInstalledExtensionsView as Dt,StaticQueryExtensionsView as P,UntrustedWorkspacePartiallySupportedExtensionsView as Vt,UntrustedWorkspaceUnsupportedExtensionsView as kt,VirtualWorkspacePartiallySupportedExtensionsView as Mt,VirtualWorkspaceUnsupportedExtensionsView as Kt,WorkspaceRecommendedExtensionsView as Rt}from"./extensionsViews.js";const S=new p("defaultExtensionViews",!0),Tt=new p("extensionsSortByValue",""),Wt=new p("searchMarketplaceExtensions",!1),Bt=new p("extensionSearchHasText",!1),Lt=new p("installedExtensions",!1),Ut=new p("searchInstalledExtensions",!1),Pt=new p("searchRecentlyUpdatedExtensions",!1),O=new p("searchExtensionUpdates",!1),Ot=new p("searchOutdatedExtensions",!1),At=new p("searchEnabledExtensions",!1),_t=new p("searchDisabledExtensions",!1),Nt=new p("hasInstalledExtensions",!0),Ft=new p("builtInExtensions",!1),Qt=new p("searchBuiltInExtensions",!1),k=new p("searchUnsupportedWorkspaceExtensions",!1),Z=new p("searchDeprecatedExtensions",!1),Ht=new p("recommendedExtensions",!1),ee=new p("sortByUpdateDate",!1),te=o({key:"remote",comment:["Remote as in remote machine"]},"Remote");let R=class extends N{constructor(e,t,n,i){super();this.extensionManagementServerService=e;this.labelService=t;this.contextKeyService=i;this.container=n.getViewContainerById(V),this.registerViews()}container;registerViews(){const e=[];e.push(...this.createDefaultExtensionsViewDescriptors()),e.push(...this.createSearchExtensionsViewDescriptors()),e.push(...this.createRecommendedExtensionsViewDescriptors()),e.push(...this.createBuiltinExtensionsViewDescriptors()),e.push(...this.createUnsupportedWorkspaceExtensionsViewDescriptors()),e.push(...this.createOtherLocalFilteredExtensionsViewDescriptors()),Le.as(Ge.ViewsRegistry).registerViews(e,this.container)}createDefaultExtensionsViewDescriptors(){const e=[],t=[];this.extensionManagementServerService.localExtensionManagementServer&&t.push(this.extensionManagementServerService.localExtensionManagementServer),this.extensionManagementServerService.remoteExtensionManagementServer&&t.push(this.extensionManagementServerService.remoteExtensionManagementServer),this.extensionManagementServerService.webExtensionManagementServer&&t.push(this.extensionManagementServerService.webExtensionManagementServer);const n=(x,v)=>t.length>1?`${v.label} - ${x}`:x;let i=D.None;if(this.extensionManagementServerService.webExtensionManagementServer&&this.extensionManagementServerService.remoteExtensionManagementServer){const x=new Set;x.add("hasInstalledWebExtensions"),i=D.filter(this.contextKeyService.onDidChangeContext,v=>v.affectsSome(x))}const h=D.any(this.labelService.onDidChangeFormatters,i);for(const x of t){const v=()=>n(m("installed","Installed"),x),M=D.map(h,()=>v()),f=t.length>1?`workbench.views.extensions.${x.id}.installed`:"workbench.views.extensions.installed";e.push({id:f,get name(){return{value:v(),original:n("Installed",x)}},weight:100,order:1,when:s.and(S),ctorDescriptor:new l(Dt,[{server:x,flexibleHeight:!0,onDidChangeTitle:M}]),canToggleVisibility:t.length===1}),x===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManagementServerService.localExtensionManagementServer&&this._register(Q(class extends F{constructor(){super({id:"workbench.extensions.installLocalExtensions",get title(){return o("select and install local extensions","Install Local Extensions in '{0}'...",x.label)},category:te,icon:mt,f1:!0,menu:{id:ye.ViewTitle,when:s.equals("view",f),group:"navigation"}})}run(c){return c.get(U).createInstance(xt).run()}}))}return this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManagementServerService.remoteExtensionManagementServer&&this._register(Q(class extends F{constructor(){super({id:"workbench.extensions.actions.installLocalExtensionsInRemote",title:o("install remote in local","Install Remote Extensions Locally..."),category:te,f1:!0})}run(v){return v.get(U).createInstance(ut,"workbench.extensions.actions.installLocalExtensionsInRemote").run()}})),e.push({id:"workbench.views.extensions.popular",name:o("popularExtensions","Popular"),ctorDescriptor:new l(vt,[{hideBadge:!0}]),when:s.and(S,s.not("hasInstalledExtensions"),Y),weight:60,order:2,canToggleVisibility:!1}),e.push({id:"extensions.recommendedList",name:o("recommendedExtensions","Recommended"),ctorDescriptor:new l(Et,[{flexibleHeight:!0}]),when:s.and(S,ee.negate(),s.not("config.extensions.showRecommendationsOnlyOnDemand"),Y),weight:40,order:3,canToggleVisibility:!0}),t.length===1&&(e.push({id:"workbench.views.extensions.enabled",name:o("enabledExtensions","Enabled"),ctorDescriptor:new l(St,[{}]),when:s.and(S,s.has("hasInstalledExtensions")),hideByDefault:!0,weight:40,order:4,canToggleVisibility:!0}),e.push({id:"workbench.views.extensions.disabled",name:o("disabledExtensions","Disabled"),ctorDescriptor:new l(wt,[{}]),when:s.and(S,s.has("hasInstalledExtensions")),hideByDefault:!0,weight:10,order:5,canToggleVisibility:!0})),e}createSearchExtensionsViewDescriptors(){const e=[];return e.push({id:"workbench.views.extensions.marketplace",name:o("marketPlace","Marketplace"),ctorDescriptor:new l(Ct,[{}]),when:s.and(s.has("searchMarketplaceExtensions"))}),e.push({id:"workbench.views.extensions.searchInstalled",name:o("installed","Installed"),ctorDescriptor:new l(a,[{}]),when:s.or(s.has("searchInstalledExtensions"),s.has("installedExtensions"))}),e.push({id:"workbench.views.extensions.searchRecentlyUpdated",name:o("recently updated","Recently Updated"),ctorDescriptor:new l(bt,[{}]),when:s.or(O,s.has("searchRecentlyUpdatedExtensions")),order:2}),e.push({id:"workbench.views.extensions.searchEnabled",name:o("enabled","Enabled"),ctorDescriptor:new l(a,[{}]),when:s.and(s.has("searchEnabledExtensions"))}),e.push({id:"workbench.views.extensions.searchDisabled",name:o("disabled","Disabled"),ctorDescriptor:new l(a,[{}]),when:s.and(s.has("searchDisabledExtensions"))}),e.push({id:ht,name:o("availableUpdates","Available Updates"),ctorDescriptor:new l(yt,[{}]),when:s.or(O,s.has("searchOutdatedExtensions")),order:1}),e.push({id:"workbench.views.extensions.searchBuiltin",name:o("builtin","Builtin"),ctorDescriptor:new l(a,[{}]),when:s.and(s.has("searchBuiltInExtensions"))}),e.push({id:"workbench.views.extensions.searchWorkspaceUnsupported",name:o("workspaceUnsupported","Workspace Unsupported"),ctorDescriptor:new l(a,[{}]),when:s.and(s.has("searchWorkspaceUnsupportedExtensions"))}),e}createRecommendedExtensionsViewDescriptors(){const e=[];return e.push({id:dt,name:o("workspaceRecommendedExtensions","Workspace Recommendations"),ctorDescriptor:new l(Rt,[{}]),when:s.and(s.has("recommendedExtensions"),He.notEqualsTo("empty")),order:1}),e.push({id:"workbench.views.extensions.otherRecommendations",name:o("otherRecommendedExtensions","Other Recommendations"),ctorDescriptor:new l(It,[{}]),when:s.has("recommendedExtensions"),order:2}),e}createBuiltinExtensionsViewDescriptors(){const e=[],t=["themes","programming languages"],n=ke.filter(h=>!t.includes(h.toLowerCase()));n.push(ft);const i=`${n.map(h=>`category:"${h}"`).join(" ")} ${t.map(h=>`category:"-${h}"`).join(" ")}`;return e.push({id:"workbench.views.extensions.builtinFeatureExtensions",name:o("builtinFeatureExtensions","Features"),ctorDescriptor:new l(P,[{query:`@builtin ${i}`}]),when:s.has("builtInExtensions")}),e.push({id:"workbench.views.extensions.builtinThemeExtensions",name:o("builtInThemesExtensions","Themes"),ctorDescriptor:new l(P,[{query:"@builtin category:themes"}]),when:s.has("builtInExtensions")}),e.push({id:"workbench.views.extensions.builtinProgrammingLanguageExtensions",name:o("builtinProgrammingLanguageExtensions","Programming Languages"),ctorDescriptor:new l(P,[{query:'@builtin category:"programming languages"'}]),when:s.has("builtInExtensions")}),e}createUnsupportedWorkspaceExtensionsViewDescriptors(){const e=[];return e.push({id:"workbench.views.extensions.untrustedUnsupportedExtensions",name:o("untrustedUnsupportedExtensions","Disabled in Restricted Mode"),ctorDescriptor:new l(kt,[{}]),when:s.and(k)}),e.push({id:"workbench.views.extensions.untrustedPartiallySupportedExtensions",name:o("untrustedPartiallySupportedExtensions","Limited in Restricted Mode"),ctorDescriptor:new l(Vt,[{}]),when:s.and(k)}),e.push({id:"workbench.views.extensions.virtualUnsupportedExtensions",name:o("virtualUnsupportedExtensions","Disabled in Virtual Workspaces"),ctorDescriptor:new l(Kt,[{}]),when:s.and($,k)}),e.push({id:"workbench.views.extensions.virtualPartiallySupportedExtensions",name:o("virtualPartiallySupportedExtensions","Limited in Virtual Workspaces"),ctorDescriptor:new l(Mt,[{}]),when:s.and($,k)}),e}createOtherLocalFilteredExtensionsViewDescriptors(){const e=[];return e.push({id:"workbench.views.extensions.deprecatedExtensions",name:o("deprecated","Deprecated"),ctorDescriptor:new l(gt,[{}]),when:s.and(Z)}),e}};R=b([r(0,X),r(1,Ke),r(2,z),r(3,q)],R);let T=class extends Qe{constructor(e,t,n,i,h,x,v,M,f,y,c,w,E,d,ne,se,ie,qt,Gt){super(V,{mergeViewWithContainerWhenSingleView:!0},i,c,e,ne,t,se,y,w,E,ie);this.progressService=n;this.editorGroupService=h;this.extensionsWorkbenchService=x;this.extensionManagementServerService=v;this.notificationService=M;this.paneCompositeService=f;this.contextKeyService=d;this.preferencesService=qt;this.commandService=Gt;this.searchDelayer=new pe(500),this.defaultViewsContextKey=S.bindTo(d),this.sortByContextKey=Tt.bindTo(d),this.searchMarketplaceExtensionsContextKey=Wt.bindTo(d),this.searchHasTextContextKey=Bt.bindTo(d),this.sortByUpdateDateContextKey=ee.bindTo(d),this.installedExtensionsContextKey=Lt.bindTo(d),this.searchInstalledExtensionsContextKey=Ut.bindTo(d),this.searchRecentlyUpdatedExtensionsContextKey=Pt.bindTo(d),this.searchExtensionUpdatesContextKey=O.bindTo(d),this.searchWorkspaceUnsupportedExtensionsContextKey=k.bindTo(d),this.searchDeprecatedExtensionsContextKey=Z.bindTo(d),this.searchOutdatedExtensionsContextKey=Ot.bindTo(d),this.searchEnabledExtensionsContextKey=At.bindTo(d),this.searchDisabledExtensionsContextKey=_t.bindTo(d),this.hasInstalledExtensionsContextKey=Nt.bindTo(d),this.builtInExtensionsContextKey=Ft.bindTo(d),this.searchBuiltInExtensionsContextKey=Qt.bindTo(d),this.recommendedExtensionsContextKey=Ht.bindTo(d),this._register(this.paneCompositeService.onDidPaneCompositeOpen(A=>{A.viewContainerLocation===$e.Sidebar&&this.onViewletOpen(A.composite)},this)),this._register(x.onReset(()=>this.refresh())),this.searchViewletState=this.getMemento(Pe.WORKSPACE,Oe.MACHINE)}defaultViewsContextKey;sortByContextKey;searchMarketplaceExtensionsContextKey;searchHasTextContextKey;sortByUpdateDateContextKey;installedExtensionsContextKey;searchInstalledExtensionsContextKey;searchRecentlyUpdatedExtensionsContextKey;searchExtensionUpdatesContextKey;searchOutdatedExtensionsContextKey;searchEnabledExtensionsContextKey;searchDisabledExtensionsContextKey;hasInstalledExtensionsContextKey;builtInExtensionsContextKey;searchBuiltInExtensionsContextKey;searchWorkspaceUnsupportedExtensionsContextKey;searchDeprecatedExtensionsContextKey;recommendedExtensionsContextKey;searchDelayer;root;searchBox;searchViewletState;get searchValue(){return this.searchBox?.getValue()}create(e){e.classList.add("extensions-viewlet"),this.root=e;const t=C(this.root,I(".overlay")),n=this.getColor(qe)??"";t.style.backgroundColor=n,L(t);const i=C(this.root,I(".header")),h=m("searchExtensions","Search Extensions in Marketplace"),x=this.searchViewletState["query.value"]?this.searchViewletState["query.value"]:"",v=C(i,I(".extensions-search-container"));this.searchBox=this._register(this.instantiationService.createInstance(it,`${V}.searchbox`,v,{triggerCharacters:["@"],sortKey:c=>c.indexOf(":")===-1?"a":/ext:/.test(c)||/id:/.test(c)||/tag:/.test(c)?"b":/sort:/.test(c)?"c":"d",provideResults:c=>j.suggestions(c)},h,"extensions:searchinput",{placeholderText:h,value:x})),this.updateInstalledExtensionsContexts(),this.searchBox.getValue()&&this.triggerSearch(),this._register(this.searchBox.onInputDidChange(()=>{this.sortByContextKey.set(j.parse(this.searchBox?.getValue()??"").sortBy),this.triggerSearch()},this)),this._register(this.searchBox.onShouldFocusResults(()=>this.focusListView(),this));const M=C(v,I(".extensions-search-actions-container"));this._register(this.instantiationService.createInstance(fe,M,ct,{toolbarOptions:{primaryGroup:()=>!0},actionViewItemProvider:(c,w)=>Se(this.instantiationService,c,w)})),this._register(new ae(this.root,{onDragEnter:c=>{this.isSupportedDragElement(c)&&ce(t)},onDragLeave:c=>{this.isSupportedDragElement(c)&&L(t)},onDragOver:c=>{this.isSupportedDragElement(c)&&(c.dataTransfer.dropEffect="copy")},onDrop:async c=>{if(this.isSupportedDragElement(c)){L(t);const w=de((await this.instantiationService.invokeFunction(E=>Ce(E,c))).map(E=>E.resource&&ge(E.resource)===".vsix"?E.resource:void 0));if(w.length>0)try{await this.commandService.executeCommand(lt,w)}catch(E){this.notificationService.error(E)}}}})),super.create(C(this.root,I(".extensions")));const f=this._register(le(this.root)),y=()=>this.searchBox?.inputWidget.hasWidgetFocus();this._register(Fe({name:"extensionsView",focusNotifiers:[f],focusNextWidget:()=>{y()&&this.focusListView()},focusPreviousWidget:()=>{y()||this.searchBox?.focus()}}))}focus(){super.focus(),this.searchBox?.focus()}layout(e){this.root&&(this.root.classList.toggle("narrow",e.width<=250),this.root.classList.toggle("mini",e.width<=200)),this.searchBox?.layout(new _(e.width-34-8-24*2,20)),super.layout(new _(e.width,e.height-41))}getOptimalWidth(){return 400}search(e){this.searchBox&&this.searchBox.getValue()!==e&&this.searchBox.setValue(e)}async refresh(){await this.updateInstalledExtensionsContexts(),this.doSearch(!0),this.configurationService.getValue(rt)&&this.extensionsWorkbenchService.checkForUpdates()}async updateInstalledExtensionsContexts(){const e=await this.extensionsWorkbenchService.queryLocal();this.hasInstalledExtensionsContextKey.set(e.some(t=>!t.isBuiltin))}triggerSearch(){this.searchDelayer.trigger(()=>this.doSearch(),this.searchBox&&this.searchBox.getValue()?500:0).then(void 0,e=>this.onError(e))}normalizedQuery(){return this.searchBox?this.searchBox.getValue().trim().replace(/@category/g,"category").replace(/@tag:/g,"tag:").replace(/@ext:/g,"ext:").replace(/@featured/g,"featured").replace(/@popular/g,this.extensionManagementServerService.webExtensionManagementServer&&!this.extensionManagementServerService.localExtensionManagementServer&&!this.extensionManagementServerService.remoteExtensionManagementServer?"@web":"@popular"):""}saveState(){const e=this.searchBox?this.searchBox.getValue():"";a.isLocalExtensionsQuery(e)?this.searchViewletState["query.value"]=e:this.searchViewletState["query.value"]="",super.saveState()}doSearch(e){const t=this.normalizedQuery();return this.contextKeyService.bufferChangeEvents(()=>{const n=a.isRecommendedExtensionsQuery(t);this.searchHasTextContextKey.set(t.trim()!==""),this.installedExtensionsContextKey.set(a.isInstalledExtensionsQuery(t)),this.searchInstalledExtensionsContextKey.set(a.isSearchInstalledExtensionsQuery(t)),this.searchRecentlyUpdatedExtensionsContextKey.set(a.isSearchRecentlyUpdatedQuery(t)&&!a.isSearchExtensionUpdatesQuery(t)),this.searchOutdatedExtensionsContextKey.set(a.isOutdatedExtensionsQuery(t)&&!a.isSearchExtensionUpdatesQuery(t)),this.searchExtensionUpdatesContextKey.set(a.isSearchExtensionUpdatesQuery(t)),this.searchEnabledExtensionsContextKey.set(a.isEnabledExtensionsQuery(t)),this.searchDisabledExtensionsContextKey.set(a.isDisabledExtensionsQuery(t)),this.searchBuiltInExtensionsContextKey.set(a.isSearchBuiltInExtensionsQuery(t)),this.searchWorkspaceUnsupportedExtensionsContextKey.set(a.isSearchWorkspaceUnsupportedExtensionsQuery(t)),this.searchDeprecatedExtensionsContextKey.set(a.isSearchDeprecatedExtensionsQuery(t)),this.builtInExtensionsContextKey.set(a.isBuiltInExtensionsQuery(t)),this.recommendedExtensionsContextKey.set(n),this.searchMarketplaceExtensionsContextKey.set(!!t&&!a.isLocalExtensionsQuery(t)&&!n),this.sortByUpdateDateContextKey.set(a.isSortUpdateDateQuery(t)),this.defaultViewsContextKey.set(!t||a.isSortInstalledExtensionsQuery(t))}),this.progress(Promise.all(this.panes.map(n=>n.show(this.normalizedQuery(),e).then(i=>this.alertSearchResult(i.length,n.id))))).then(()=>{})}onDidAddViewDescriptors(e){const t=super.onDidAddViewDescriptors(e);return this.progress(Promise.all(t.map(n=>n.show(this.normalizedQuery()).then(i=>this.alertSearchResult(i.length,n.id))))),t}alertSearchResult(e,t){const n=this.viewContainerModel.visibleViewDescriptors.find(i=>i.id===t);switch(e){case 0:break;case 1:n?K(m("extensionFoundInSection","1 extension found in the {0} section.",n.name.value)):K(m("extensionFound","1 extension found."));break;default:n?K(m("extensionsFoundInSection","{0} extensions found in the {1} section.",e,n.name.value)):K(m("extensionsFound","{0} extensions found.",e));break}}getFirstExpandedPane(){for(const e of this.panes)if(e.isExpanded()&&e instanceof a)return e}focusListView(){const e=this.getFirstExpandedPane();e&&e.count()>0&&e.focus()}onViewletOpen(e){if(!(!e||e.getId()===V)&&this.configurationService.getValue(at)){const t=this.editorGroupService.groups.map(n=>{const i=n.editors.filter(h=>h instanceof pt);return n.closeEditors(i)});Promise.all(t)}}progress(e){return this.progressService.withProgress({location:Be.Extensions},()=>e)}onError(e){if(ve(e))return;const t=e&&e.message||"";if(/ECONNREFUSED/.test(t)){const n=me(m("suggestProxyError","Marketplace returned 'ECONNREFUSED'. Please check the 'http.proxy' setting."),[new he("open user settings",m("open user settings","Open User Settings"),void 0,!0,()=>this.preferencesService.openUserSettings())]);this.notificationService.error(n);return}this.notificationService.error(e)}isSupportedDragElement(e){return e.dataTransfer?e.dataTransfer.types.map(n=>n.toLocaleLowerCase()).indexOf("files")!==-1:!1}};T=b([r(0,tt),r(1,Ae),r(2,We),r(3,U),r(4,je),r(5,J),r(6,X),r(7,G),r(8,nt),r(9,_e),r(10,H),r(11,Ue),r(12,Ne),r(13,q),r(14,Ie),r(15,Ze),r(16,z),r(17,st),r(18,be)],T);let W=class extends N{constructor(e,t,n,i){super();this.activityService=e;this.extensionsWorkbenchService=t;this.extensionEnablementService=n;this.configurationService=i;this.onServiceChange(),this._register(D.debounce(t.onChange,()=>{},100,void 0,void 0,void 0,this._store)(this.onServiceChange,this))}badgeHandle=this._register(new Ee);onServiceChange(){this.badgeHandle.clear();const e=this.configurationService.getValue(ot)===!0?[]:this.extensionsWorkbenchService.installed.filter(i=>i.runtimeState!==void 0),t=this.extensionsWorkbenchService.outdated.reduce((i,h)=>i+(this.extensionEnablementService.isEnabled(h.local)&&!e.includes(h)?1:0),0),n=t+e.length;if(n>0){let i="";t&&(i+=t===1?m("extensionToUpdate","{0} requires update",t):m("extensionsToUpdate","{0} require update",t)),t>0&&e.length>0&&(i+=", "),e.length&&(i+=e.length===1?m("extensionToReload","{0} requires restart",e.length):m("extensionsToReload","{0} require restart",e.length));const h=new Xe(n,()=>i);this.badgeHandle.value=this.activityService.showViewContainerActivity(V,{badge:h})}}};W=b([r(0,ze),r(1,J),r(2,Je),r(3,H)],W);let B=class{constructor(u,e,t,n,i){this.extensionsManagementService=u;this.hostService=e;this.logService=t;this.notificationService=n;this.environmentService=i;this.environmentService.disableExtensions||this.loopCheckForMaliciousExtensions()}loopCheckForMaliciousExtensions(){this.checkForMaliciousExtensions().then(()=>ue(1e3*60*5)).then(()=>this.loopCheckForMaliciousExtensions())}checkForMaliciousExtensions(){return this.extensionsManagementService.getExtensionsControlManifest().then(u=>this.extensionsManagementService.getInstalled(Me.User).then(e=>{const t=e.filter(n=>u.malicious.some(i=>Ve(n.identifier,i)));return t.length?xe.settled(t.map(n=>this.extensionsManagementService.uninstall(n).then(()=>{this.notificationService.prompt(we.Warning,m("malicious warning","We have uninstalled '{0}' which was reported to be problematic.",n.identifier.id),[{label:m("reloadNow","Reload Now"),run:()=>this.hostService.reload()}],{sticky:!0,priority:Te.URGENT})}))):Promise.resolve(void 0)}).then(()=>{}),u=>this.logService.error(u))}};B=b([r(0,De),r(1,et),r(2,Re),r(3,G),r(4,Ye)],B);export{Ft as BuiltInExtensionsContext,S as DefaultViewsContext,Tt as ExtensionsSortByContext,T as ExtensionsViewPaneContainer,R as ExtensionsViewletViewsContribution,B as MaliciousExtensionChecker,Ht as RecommendedExtensionsContext,Bt as SearchHasTextContext,Wt as SearchMarketplaceExtensionsContext,W as StatusUpdater};
