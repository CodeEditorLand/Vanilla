var we=Object.defineProperty;var De=Object.getOwnPropertyDescriptor;var se=(m,a,e,t)=>{for(var n=t>1?void 0:t?De(a,e):a,i=m.length-1,s;i>=0;i--)(s=m[i])&&(n=(t?s(a,e,n):s(n))||n);return t&&n&&we(a,e,n),n},p=(m,a)=>(e,t)=>a(e,t,m);import{$ as o,addDisposableListener as Pe,append as r,setParentFlowTo as ke}from"../../../../base/browser/dom.js";import{ActionBar as re}from"../../../../base/browser/ui/actionbar/actionbar.js";import{getDefaultHoverDelegate as f}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{DomScrollableElement as K}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{CheckboxActionViewItem as Me}from"../../../../base/browser/ui/toggle/toggle.js";import{Action as Re}from"../../../../base/common/actions.js";import*as C from"../../../../base/common/arrays.js";import{Cache as O}from"../../../../base/common/cache.js";import{CancellationToken as Le,CancellationTokenSource as ae}from"../../../../base/common/cancellation.js";import{isCancellationError as Ae}from"../../../../base/common/errors.js";import{Emitter as Te,Event as H}from"../../../../base/common/event.js";import{KeyCode as _,KeyMod as ce}from"../../../../base/common/keyCodes.js";import{Disposable as He,DisposableStore as le,dispose as We,MutableDisposable as Ne,toDisposable as y}from"../../../../base/common/lifecycle.js";import{matchesScheme as W,Schemas as N}from"../../../../base/common/network.js";import{language as Ge}from"../../../../base/common/platform.js";import*as Ve from"../../../../base/common/semver/semver.js";import{isUndefined as de}from"../../../../base/common/types.js";import{URI as k}from"../../../../base/common/uri.js";import{generateUuid as ue}from"../../../../base/common/uuid.js";import"./media/extensionEditor.css";import{EditorContextKeys as Fe}from"../../../../editor/common/editorContextKeys.js";import{TokenizationRegistry as Ze}from"../../../../editor/common/languages.js";import{ILanguageService as Ke}from"../../../../editor/common/languages/language.js";import{generateTokensCSSForColorMap as Oe}from"../../../../editor/common/languages/supports/tokenization.js";import{localize as l}from"../../../../nls.js";import{Action2 as B,registerAction2 as U}from"../../../../platform/actions/common/actions.js";import{ContextKeyExpr as G,IContextKeyService as _e,RawContextKey as Be}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as Ue}from"../../../../platform/contextview/browser/contextView.js";import{IExtensionGalleryService as ze}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{areSameExtensions as je}from"../../../../platform/extensionManagement/common/extensionManagementUtil.js";import{ExtensionType as he}from"../../../../platform/extensions/common/extensions.js";import{IHoverService as Ye}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as $e}from"../../../../platform/instantiation/common/instantiation.js";import{KeybindingWeight as z}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{INotificationService as Je}from"../../../../platform/notification/common/notification.js";import{IOpenerService as Xe}from"../../../../platform/opener/common/opener.js";import{IStorageService as Qe}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as qe}from"../../../../platform/telemetry/common/telemetry.js";import{defaultCheckboxStyles as et}from"../../../../platform/theme/browser/defaultStyles.js";import{buttonForeground as tt,buttonHoverBackground as nt,editorBackground as it,textLinkActiveForeground as ot,textLinkForeground as st}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as rt,registerThemingParticipant as at}from"../../../../platform/theme/common/themeService.js";import{IUriIdentityService as ct}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{IWorkspaceContextService as lt}from"../../../../platform/workspace/common/workspace.js";import{EditorPane as dt}from"../../../browser/parts/editor/editorPane.js";import"../../../common/editor.js";import{ViewContainerLocation as pe}from"../../../common/views.js";import"../../../services/editor/common/editorGroupsService.js";import{IEditorService as ut}from"../../../services/editor/common/editorService.js";import{IExtensionRecommendationsService as ht}from"../../../services/extensionRecommendations/common/extensionRecommendations.js";import{IExtensionService as pt}from"../../../services/extensions/common/extensions.js";import{IPaneCompositePartService as vt}from"../../../services/panecomposite/browser/panecomposite.js";import{IViewsService as mt}from"../../../services/views/common/viewsService.js";import{IExplorerService as gt}from"../../files/browser/files.js";import{VIEW_ID as bt}from"../../files/common/files.js";import{DEFAULT_MARKDOWN_STYLES as It,renderMarkdownDocument as Et}from"../../markdown/browser/markdownDocumentRenderer.js";import{IWebviewService as ft,KEYBINDING_CONTEXT_WEBVIEW_FIND_WIDGET_FOCUSED as ve}from"../../webview/browser/webview.js";import{ExtensionContainers as xt,ExtensionEditorTab as I,ExtensionState as yt,IExtensionsWorkbenchService as St,VIEWLET_ID as me}from"../common/extensions.js";import"../common/extensionsInput.js";import{ExtensionFeaturesTab as Ct}from"./extensionFeaturesTab.js";import{ButtonWithDropDownExtensionAction as ge,ButtonWithDropdownExtensionActionViewItem as wt,ClearLanguageAction as Dt,DisableDropDownAction as Pt,DropDownExtensionAction as kt,EnableDropDownAction as Mt,ExtensionEditorManageExtensionAction as Rt,ExtensionRuntimeStateAction as Lt,ExtensionStatusAction as At,ExtensionStatusLabelAction as Tt,InstallAnotherVersionAction as Ht,InstallDropdownAction as Wt,InstallingLabelAction as Nt,LocalInstallAction as Gt,MigrateDeprecatedExtensionAction as Vt,RemoteInstallAction as Ft,SetColorThemeAction as Zt,SetFileIconThemeAction as Kt,SetLanguageAction as Ot,SetProductIconThemeAction as _t,ToggleAutoUpdateForExtensionAction as be,TogglePreReleaseExtensionAction as Bt,UninstallAction as Ie,UpdateAction as Ut,WebInstallAction as zt}from"./extensionsActions.js";import{Delegate as jt}from"./extensionsList.js";import{ExtensionData as Yt,ExtensionsGridView as $t,ExtensionsTree as Jt,getExtensions as Xt}from"./extensionsViewer.js";import{ExtensionRecommendationWidget as Qt,ExtensionStatusWidget as qt,ExtensionWidget as Ee,InstallCountWidget as en,onClick as M,RatingsWidget as tn,RemoteBadgeWidget as nn,SponsorWidget as on,VerifiedPublisherWidget as sn}from"./extensionsWidgets.js";class rn extends He{_onChange=this._register(new Te);get onChange(){return this._onChange.event}_currentId=null;get currentId(){return this._currentId}actions;actionbar;constructor(a){super();const e=r(a,o(".navbar"));this.actions=[],this.actionbar=this._register(new re(e))}push(a,e,t){const n=new Re(a,e,void 0,!0,()=>this.update(a,!0));n.tooltip=t,this.actions.push(n),this.actionbar.push(n),this.actions.length===1&&this.update(a)}clear(){this.actions=We(this.actions),this.actionbar.clear()}switch(a){const e=this.actions.find(t=>t.id===a);return e?(e.run(),!0):!1}update(a,e){this._currentId=a,this._onChange.fire({id:a,focus:!!e}),this.actions.forEach(t=>t.checked=t.id===a)}}var an=(e=>(e[e.Readme=0]="Readme",e[e.Changelog=1]="Changelog",e))(an||{});const cn=new Be("showPreReleaseVersion",!1);class ln extends Ee{_gallery=null;get gallery(){return this._gallery}set gallery(a){this.extension&&a&&!je(this.extension.identifier,a.identifier)||(this._gallery=a,this.update())}}class dn extends ln{element;constructor(a,e){super(),this.element=r(a,o("code.version")),this._register(e.setupManagedHover(f("mouse"),this.element,l("extension version","Extension Version"))),this.render()}render(){!this.extension||!Ve.valid(this.extension.version)||(this.element.textContent=`v${this.gallery?.version??this.extension.version}${this.extension.isPreReleaseVersion?" (pre-release)":""}`)}}let S=class extends dt{constructor(e,t,n,i,s,c,u,h,d,b,x,g,w,D,$,J,V,L,X,R,Q){super(S.ID,e,t,u,x);this.instantiationService=n;this.paneCompositeService=i;this.extensionsWorkbenchService=s;this.extensionGalleryService=c;this.notificationService=h;this.openerService=d;this.extensionRecommendationsService=b;this.extensionService=g;this.webviewService=w;this.languageService=D;this.contextMenuService=$;this.contextKeyService=J;this.contextService=V;this.explorerService=L;this.viewsService=X;this.uriIdentityService=R;this.hoverService=Q;this.extensionReadme=null,this.extensionChangelog=null,this.extensionManifest=null}static ID="workbench.editor.extension";_scopedContextKeyService=this._register(new Ne);template;extensionReadme;extensionChangelog;extensionManifest;initialScrollProgress=new Map;currentIdentifier="";layoutParticipants=[];contentDisposables=this._register(new le);transientDisposables=this._register(new le);activeElement=null;dimension;showPreReleaseVersionContextKey;get scopedContextKeyService(){return this._scopedContextKeyService.value}createEditor(e){const t=r(e,o(".extension-editor"));this._scopedContextKeyService.value=this.contextKeyService.createScoped(t),this._scopedContextKeyService.value.createKey("inExtensionEditor",!0),this.showPreReleaseVersionContextKey=cn.bindTo(this._scopedContextKeyService.value),t.tabIndex=0,t.style.outline="none",t.setAttribute("role","document");const n=r(t,o(".header")),i=r(n,o(".icon-container")),s=r(i,o("img.icon",{draggable:!1,alt:""})),c=this.instantiationService.createInstance(nn,i,!0),u=r(n,o(".details")),h=r(u,o(".title")),d=r(h,o("span.name.clickable",{role:"heading",tabIndex:0}));this._register(this.hoverService.setupManagedHover(f("mouse"),d,l("name","Extension name")));const b=new dn(h,this.hoverService),x=r(h,o("span.preview"));this._register(this.hoverService.setupManagedHover(f("mouse"),x,l("preview","Preview"))),x.textContent=l("preview","Preview");const g=r(h,o("span.builtin"));g.textContent=l("builtin","Built-in");const w=r(u,o(".subtitle")),D=r(r(w,o(".subtitle-entry")),o(".publisher.clickable",{tabIndex:0}));this._register(this.hoverService.setupManagedHover(f("mouse"),D,l("publisher","Publisher"))),D.setAttribute("role","button");const $=r(D,o(".publisher-name")),J=this.instantiationService.createInstance(sn,r(D,o(".verified-publisher")),!1),V=r(r(w,o(".subtitle-entry.resource")),o("",{tabIndex:0}));V.setAttribute("role","button");const L=r(r(w,o(".subtitle-entry")),o("span.install",{tabIndex:0}));this._register(this.hoverService.setupManagedHover(f("mouse"),L,l("install count","Install count")));const X=this.instantiationService.createInstance(en,L,!1),R=r(r(w,o(".subtitle-entry")),o("span.rating.clickable",{tabIndex:0}));this._register(this.hoverService.setupManagedHover(f("mouse"),R,l("rating","Rating"))),R.setAttribute("role","link");const Q=this.instantiationService.createInstance(tn,R,!1),fe=this.instantiationService.createInstance(on,r(w,o(".subtitle-entry"))),F=[c,b,J,X,Q,fe],xe=r(u,o(".description")),q=this.instantiationService.createInstance(Wt),A=[this.instantiationService.createInstance(Lt),this.instantiationService.createInstance(Tt),this.instantiationService.createInstance(Ut,!0),this.instantiationService.createInstance(Zt),this.instantiationService.createInstance(Kt),this.instantiationService.createInstance(_t),this.instantiationService.createInstance(Ot),this.instantiationService.createInstance(Dt),this.instantiationService.createInstance(Mt),this.instantiationService.createInstance(Pt),this.instantiationService.createInstance(Ft,!1),this.instantiationService.createInstance(Gt),this.instantiationService.createInstance(zt),q,this.instantiationService.createInstance(Nt),this.instantiationService.createInstance(ge,"extensions.uninstall",Ie.UninstallClass,[[this.instantiationService.createInstance(Vt,!1),this.instantiationService.createInstance(Ie),this.instantiationService.createInstance(Ht,null,!0)]]),this.instantiationService.createInstance(Bt),this.instantiationService.createInstance(be),new Rt(this.scopedContextKeyService||this.contextKeyService,this.instantiationService)],T=r(u,o(".actions-status-container")),P=this._register(new re(T,{actionViewItemProvider:(v,E)=>{if(v instanceof kt)return v.createActionViewItem(E);if(v instanceof ge)return new wt(v,{...E,icon:!0,label:!0,menuActionsOrProvider:{getActions:()=>v.menuActions},menuActionClassNames:v.menuActionClassNames},this.contextMenuService);if(v instanceof be)return new Me(void 0,v,{...E,icon:!0,label:!0,checkboxStyles:et})},focusOnlyEnabledItems:!0}));P.push(A,{icon:!0,label:!0}),P.setFocusable(!0),this._register(H.any(...A.map(v=>H.filter(v.onDidChange,E=>E.enabled!==void 0)))(()=>{P.setFocusable(!1),P.setFocusable(!0)}));const Z=[],ee=this.instantiationService.createInstance(At),ye=this._register(this.instantiationService.createInstance(qt,r(T,o(".status")),ee));Z.push(ee,new class extends Ee{render(){T.classList.toggle("list-layout",this.extension?.state===yt.Installed)}});const te=this.instantiationService.createInstance(Qt,r(u,o(".recommendation")));F.push(te),this._register(H.any(ye.onDidRender,te.onDidRender)(()=>{this.dimension&&this.layout(this.dimension)}));const ne=this.instantiationService.createInstance(xt,[...A,...F,...Z]);for(const v of[...A,...F,...Z,ne])this._register(v);const Se=H.chain(P.onDidRun,v=>v.map(({error:E})=>E).filter(E=>!!E));this._register(Se(this.onError,this));const ie=r(t,o(".body")),Ce=new rn(ie),oe=r(ie,o(".content"));oe.id=ue(),this.template={builtin:g,content:oe,description:xe,header:n,icon:s,iconContainer:i,installCount:L,name:d,navbar:Ce,preview:x,publisher:D,publisherDisplayName:$,resource:V,rating:R,actionsAndStatusContainer:T,extensionActionBar:P,set extension(v){ne.extension=v},set gallery(v){b.gallery=v},set manifest(v){q.manifest=v}}}async setInput(e,t,n,i){await super.setInput(e,t,n,i),this.updatePreReleaseVersionContext(),this.template&&await this.render(e.extension,this.template,!!t?.preserveFocus)}setOptions(e){const t=this.options;if(super.setOptions(e),this.updatePreReleaseVersionContext(),this.input&&this.template&&t?.showPreReleaseVersion!==e?.showPreReleaseVersion){this.render(this.input.extension,this.template,!!e?.preserveFocus);return}e?.tab&&this.template?.navbar.switch(e.tab)}updatePreReleaseVersionContext(){let e=this.options?.showPreReleaseVersion;de(e)&&(e=!!this.input.extension.gallery?.properties.isPreReleaseVersion),this.showPreReleaseVersionContextKey?.set(e)}async openTab(e){!this.input||!this.template||this.template.navbar.switch(e)||e===I.ExtensionPack&&this.template.navbar.switch(I.Readme)}async getGalleryVersionToShow(e,t){return e.resourceExtension||e.local?.source==="resource"||de(t)||t===e.gallery?.properties.isPreReleaseVersion||t&&!e.hasPreReleaseVersion||!t&&!e.hasReleaseVersion?null:(await this.extensionGalleryService.getExtensions([{...e.identifier,preRelease:t,hasPreRelease:e.hasPreReleaseVersion}],Le.None))[0]||null}async render(e,t,n){this.activeElement=null,this.transientDisposables.clear();const i=this.transientDisposables.add(new ae).token,s=await this.getGalleryVersionToShow(e,this.options?.showPreReleaseVersion);if(i.isCancellationRequested)return;this.extensionReadme=new O(()=>s?this.extensionGalleryService.getReadme(s,i):e.getReadme(i)),this.extensionChangelog=new O(()=>s?this.extensionGalleryService.getChangelog(s,i):e.getChangelog(i)),this.extensionManifest=new O(()=>s?this.extensionGalleryService.getManifest(s,i):e.getManifest(i)),t.extension=e,t.gallery=s,t.manifest=null,this.transientDisposables.add(Pe(t.icon,"error",()=>t.icon.src=e.iconUrlFallback,{once:!0})),t.icon.src=e.iconUrl,t.name.textContent=e.displayName,t.name.classList.toggle("clickable",!!e.url),t.name.classList.toggle("deprecated",!!e.deprecationInfo),t.preview.style.display=e.preview?"inherit":"none",t.builtin.style.display=e.isBuiltin?"inherit":"none",t.description.textContent=e.description,t.publisher.classList.toggle("clickable",!!e.url),t.publisherDisplayName.textContent=e.publisherDisplayName,t.publisher.parentElement?.classList.toggle("hide",!!e.resourceExtension||e.local?.source==="resource");const c=e.resourceExtension?.location??(e.local?.source==="resource"?e.local?.location:void 0);if(t.resource.parentElement?.classList.toggle("hide",!c),c){const b=this.contextService.getWorkspaceFolder(c);b&&e.isWorkspaceScoped?(t.resource.parentElement?.classList.add("clickable"),this.transientDisposables.add(this.hoverService.setupManagedHover(f("mouse"),t.resource,this.uriIdentityService.extUri.relativePath(b.uri,c))),t.resource.textContent=l("workspace extension","Workspace Extension"),this.transientDisposables.add(M(t.resource,()=>{this.viewsService.openView(bt,!0).then(()=>this.explorerService.select(c,!0))}))):(t.resource.parentElement?.classList.remove("clickable"),this.transientDisposables.add(this.hoverService.setupManagedHover(f("mouse"),t.resource,c.path)),t.resource.textContent=l("local extension","Local Extension"))}t.installCount.parentElement?.classList.toggle("hide",!e.url),t.rating.parentElement?.classList.toggle("hide",!e.url),t.rating.classList.toggle("clickable",!!e.url),e.url&&(this.transientDisposables.add(M(t.name,()=>this.openerService.open(k.parse(e.url)))),this.transientDisposables.add(M(t.rating,()=>this.openerService.open(k.parse(`${e.url}&ssr=false#review-details`)))),this.transientDisposables.add(M(t.publisher,()=>{this.paneCompositeService.openPaneComposite(me,pe.Sidebar,!0).then(b=>b?.getViewPaneContainer()).then(b=>b.search(`publisher:"${e.publisherDisplayName}"`))})));const u=await this.extensionManifest.get().promise;if(i.isCancellationRequested)return;u&&(t.manifest=u),this.renderNavbar(e,u,t,n);const h=this.extensionRecommendationsService.getAllRecommendationsWithReason();let d={};h[e.identifier.id.toLowerCase()]&&(d={recommendationReason:h[e.identifier.id.toLowerCase()].reasonId}),this.telemetryService.publicLog("extensionGallery:openExtension",{...e.telemetryData,...d})}renderNavbar(e,t,n,i){n.content.innerText="",n.navbar.clear(),this.currentIdentifier!==e.identifier.id&&(this.initialScrollProgress.clear(),this.currentIdentifier=e.identifier.id),n.navbar.push(I.Readme,l("details","Details"),l("detailstooltip","Extension details, rendered from the extension's 'README.md' file")),t&&n.navbar.push(I.Features,l("features","Features"),l("featurestooltip","Lists features contributed by this extension")),e.hasChangelog()&&n.navbar.push(I.Changelog,l("changelog","Changelog"),l("changelogtooltip","Extension update history, rendered from the extension's 'CHANGELOG.md' file")),e.dependencies.length&&n.navbar.push(I.Dependencies,l("dependencies","Dependencies"),l("dependenciestooltip","Lists extensions this extension depends on")),t&&t.extensionPack?.length&&!this.shallRenderAsExtensionPack(t)&&n.navbar.push(I.ExtensionPack,l("extensionpack","Extension Pack"),l("extensionpacktooltip","Lists extensions those will be installed together with this extension")),this.options?.tab&&n.navbar.switch(this.options.tab),n.navbar.currentId&&this.onNavbarChange(e,{id:n.navbar.currentId,focus:!i},n),n.navbar.onChange(s=>this.onNavbarChange(e,s,n),this,this.transientDisposables)}clearInput(){this.contentDisposables.clear(),this.transientDisposables.clear(),super.clearInput()}focus(){super.focus(),this.activeElement?.focus()}showFind(){this.activeWebview?.showFind()}runFindAction(e){this.activeWebview?.runFindAction(e)}get activeWebview(){if(!(!this.activeElement||!this.activeElement.runFindAction))return this.activeElement}onNavbarChange(e,{id:t,focus:n},i){if(this.contentDisposables.clear(),i.content.innerText="",this.activeElement=null,t){const s=new ae;this.contentDisposables.add(y(()=>s.dispose(!0))),this.open(t,e,i,s.token).then(c=>{s.token.isCancellationRequested||(this.activeElement=c,n&&this.focus())})}}open(e,t,n,i){switch(e){case I.Readme:return this.openDetails(t,n,i);case I.Features:return this.openFeatures(n,i);case I.Changelog:return this.openChangelog(t,n,i);case I.Dependencies:return this.openExtensionDependencies(t,n,i);case I.ExtensionPack:return this.openExtensionPack(t,n,i)}return Promise.resolve(null)}async openMarkdown(e,t,n,i,s,c,u){try{const h=await this.renderMarkdown(e,t,i,u);if(u.isCancellationRequested)return Promise.resolve(null);const d=this.contentDisposables.add(this.webviewService.createWebviewOverlay({title:c,options:{enableFindWidget:!0,tryRestoreScrollPosition:!0,disableServiceWorker:!0},contentOptions:{},extension:void 0}));d.initialScrollProgress=this.initialScrollProgress.get(s)||0,d.claim(this,this.window,this.scopedContextKeyService),ke(d.container,i),d.layoutWebviewOverElement(i),d.setHtml(h),d.claim(this,this.window,void 0),this.contentDisposables.add(d.onDidFocus(()=>this._onDidFocus?.fire())),this.contentDisposables.add(d.onDidScroll(()=>this.initialScrollProgress.set(s,d.initialScrollProgress)));const b=C.insert(this.layoutParticipants,{layout:()=>{d.layoutWebviewOverElement(i)}});this.contentDisposables.add(y(b));let x=!1;return this.contentDisposables.add(y(()=>{x=!0})),this.contentDisposables.add(this.themeService.onDidColorThemeChange(async()=>{const g=await this.renderMarkdown(e,t,i);x||d.setHtml(g)})),this.contentDisposables.add(d.onDidClickLink(g=>{g&&((W(g,N.http)||W(g,N.https)||W(g,N.mailto))&&this.openerService.open(g),W(g,N.command)&&e.type===he.System&&this.openerService.open(g,{allowCommands:!0}))})),d}catch{const d=r(i,o("p.nocontent"));return d.textContent=n,d}}async renderMarkdown(e,t,n,i){const s=await this.loadContents(()=>t,n);if(i?.isCancellationRequested)return"";const c=await Et(s,this.extensionService,this.languageService,{shouldSanitize:e.type!==he.System,token:i});return i?.isCancellationRequested?"":this.renderBody(c)}renderBody(e){const t=ue(),n=Ze.getColorMap(),i=n?Oe(n):"";return`<!DOCTYPE html>
		<html>
			<head>
				<meta http-equiv="Content-type" content="text/html;charset=UTF-8">
				<meta http-equiv="Content-Security-Policy" content="default-src 'none'; img-src https: data:; media-src https:; script-src 'none'; style-src 'nonce-${t}';">
				<style nonce="${t}">
					${It}

					/* prevent scroll-to-top button from blocking the body text */
					body {
						padding-bottom: 75px;
					}

					#scroll-to-top {
						position: fixed;
						width: 32px;
						height: 32px;
						right: 25px;
						bottom: 25px;
						background-color: var(--vscode-button-secondaryBackground);
						border-color: var(--vscode-button-border);
						border-radius: 50%;
						cursor: pointer;
						box-shadow: 1px 1px 1px rgba(0,0,0,.25);
						outline: none;
						display: flex;
						justify-content: center;
						align-items: center;
					}

					#scroll-to-top:hover {
						background-color: var(--vscode-button-secondaryHoverBackground);
						box-shadow: 2px 2px 2px rgba(0,0,0,.25);
					}

					body.vscode-high-contrast #scroll-to-top {
						border-width: 2px;
						border-style: solid;
						box-shadow: none;
					}

					#scroll-to-top span.icon::before {
						content: "";
						display: block;
						background: var(--vscode-button-secondaryForeground);
						/* Chevron up icon */
						webkit-mask-image: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxNiAxNiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTYgMTY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRkZGRkZGO30KCS5zdDF7ZmlsbDpub25lO30KPC9zdHlsZT4KPHRpdGxlPnVwY2hldnJvbjwvdGl0bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik04LDUuMWwtNy4zLDcuM0wwLDExLjZsOC04bDgsOGwtMC43LDAuN0w4LDUuMXoiLz4KPHJlY3QgY2xhc3M9InN0MSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+Cjwvc3ZnPgo=');
						-webkit-mask-image: url('data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4KPCEtLSBHZW5lcmF0b3I6IEFkb2JlIElsbHVzdHJhdG9yIDE5LjIuMCwgU1ZHIEV4cG9ydCBQbHVnLUluIC4gU1ZHIFZlcnNpb246IDYuMDAgQnVpbGQgMCkgIC0tPgo8c3ZnIHZlcnNpb249IjEuMSIgaWQ9IkxheWVyXzEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgeG1sbnM6eGxpbms9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkveGxpbmsiIHg9IjBweCIgeT0iMHB4IgoJIHZpZXdCb3g9IjAgMCAxNiAxNiIgc3R5bGU9ImVuYWJsZS1iYWNrZ3JvdW5kOm5ldyAwIDAgMTYgMTY7IiB4bWw6c3BhY2U9InByZXNlcnZlIj4KPHN0eWxlIHR5cGU9InRleHQvY3NzIj4KCS5zdDB7ZmlsbDojRkZGRkZGO30KCS5zdDF7ZmlsbDpub25lO30KPC9zdHlsZT4KPHRpdGxlPnVwY2hldnJvbjwvdGl0bGU+CjxwYXRoIGNsYXNzPSJzdDAiIGQ9Ik04LDUuMWwtNy4zLDcuM0wwLDExLjZsOC04bDgsOGwtMC43LDAuN0w4LDUuMXoiLz4KPHJlY3QgY2xhc3M9InN0MSIgd2lkdGg9IjE2IiBoZWlnaHQ9IjE2Ii8+Cjwvc3ZnPgo=');
						width: 16px;
						height: 16px;
					}
					${i}
				</style>
			</head>
			<body>
				<a id="scroll-to-top" role="button" aria-label="scroll to top" href="#"><span class="icon"></span></a>
				${e}
			</body>
		</html>`}async openDetails(e,t,n){const i=r(t.content,o(".details")),s=r(i,o(".readme-container")),c=r(i,o(".additional-details-container")),u=()=>i.classList.toggle("narrow",this.dimension&&this.dimension.width<500);u(),this.contentDisposables.add(y(C.insert(this.layoutParticipants,{layout:u})));let h=null;const d=await this.extensionManifest.get().promise;return d&&d.extensionPack?.length&&this.shallRenderAsExtensionPack(d)?h=await this.openExtensionPackReadme(e,d,s,n):h=await this.openMarkdown(e,this.extensionReadme.get(),l("noReadme","No README available."),s,0,l("Readme title","Readme"),n),this.renderAdditionalDetails(c,e),h}shallRenderAsExtensionPack(e){return!!e.categories?.some(t=>t.toLowerCase()==="extension packs")}async openExtensionPackReadme(e,t,n,i){if(i.isCancellationRequested)return Promise.resolve(null);const s=r(n,o("div",{class:"extension-pack-readme"}));s.style.margin="0 auto",s.style.maxWidth="882px";const c=r(s,o("div",{class:"extension-pack"}));t.extensionPack.length<=3?s.classList.add("one-row"):t.extensionPack.length<=6?s.classList.add("two-rows"):t.extensionPack.length<=9?s.classList.add("three-rows"):s.classList.add("more-rows");const u=r(c,o("div.header"));u.textContent=l("extension pack","Extension Pack ({0})",t.extensionPack.length);const h=r(c,o("div",{class:"extension-pack-content"}));h.setAttribute("tabindex","0"),r(c,o("div.footer"));const d=r(s,o("div.readme-content"));return await Promise.all([this.renderExtensionPack(t,h,i),this.openMarkdown(e,this.extensionReadme.get(),l("noReadme","No README available."),d,0,l("Readme title","Readme"),i)]),{focus:()=>h.focus()}}renderAdditionalDetails(e,t){const n=o("div",{class:"additional-details-content",tabindex:"0"}),i=new K(n,{}),s=()=>i.scanDomNode(),c=C.insert(this.layoutParticipants,{layout:s});this.contentDisposables.add(y(c)),this.contentDisposables.add(i),this.renderCategories(n,t),this.renderExtensionResources(n,t),this.renderMoreInfo(n,t),r(e,i.getDomNode()),i.scanDomNode()}renderCategories(e,t){if(t.categories.length){const n=r(e,o(".categories-container.additional-details-element"));r(n,o(".additional-details-title",void 0,l("categories","Categories")));const i=r(n,o(".categories"));for(const s of t.categories)this.transientDisposables.add(M(r(i,o("span.category",{tabindex:"0"},s)),()=>{this.paneCompositeService.openPaneComposite(me,pe.Sidebar,!0).then(c=>c?.getViewPaneContainer()).then(c=>c.search(`@category:"${s}"`))}))}}renderExtensionResources(e,t){const n=[];if(t.url&&n.push([l("Marketplace","Marketplace"),k.parse(t.url)]),t.url&&t.supportUrl)try{n.push([l("issues","Issues"),k.parse(t.supportUrl)])}catch{}if(t.repository)try{n.push([l("repository","Repository"),k.parse(t.repository)])}catch{}if(t.url&&t.licenseUrl)try{n.push([l("license","License"),k.parse(t.licenseUrl)])}catch{}if(t.publisherUrl&&n.push([t.publisherDisplayName,t.publisherUrl]),n.length||t.publisherSponsorLink){const i=r(e,o(".resources-container.additional-details-element"));r(i,o(".additional-details-title",void 0,l("resources","Resources")));const s=r(i,o(".resources"));for(const[c,u]of n){const h=r(s,o("a.resource",{tabindex:"0"},c));this.transientDisposables.add(M(h,()=>this.openerService.open(u))),this.transientDisposables.add(this.hoverService.setupManagedHover(f("mouse"),h,u.toString()))}}}renderMoreInfo(e,t){const n=t.gallery,i=r(e,o(".more-info-container.additional-details-element"));r(i,o(".additional-details-title",void 0,l("Marketplace Info","More Info")));const s=r(i,o(".more-info")),c=u=>`${u.getFullYear()}-${String(u.getMonth()+1).padStart(2,"0")}-${String(u.getDate()).padStart(2,"0")}, ${u.toLocaleTimeString(Ge,{hourCycle:"h23"})}`;n&&r(s,o(".more-info-entry",void 0,o("div",void 0,l("published","Published")),o("div",void 0,c(new Date(n.releaseDate)))),o(".more-info-entry",void 0,o("div",void 0,l("last released","Last released")),o("div",void 0,c(new Date(n.lastUpdated))))),t.local&&t.local.installedTimestamp&&r(s,o(".more-info-entry",void 0,o("div",void 0,l("last updated","Last updated")),o("div",void 0,c(new Date(t.local.installedTimestamp))))),r(s,o(".more-info-entry",void 0,o("div",void 0,l("id","Identifier")),o("code",void 0,t.identifier.id)))}openChangelog(e,t,n){return this.openMarkdown(e,this.extensionChangelog.get(),l("noChangelog","No Changelog available."),t.content,1,l("Changelog title","Changelog"),n)}async openFeatures(e,t){const n=await this.loadContents(()=>this.extensionManifest.get(),e.content);if(t.isCancellationRequested||!n)return null;const i=this.contentDisposables.add(this.instantiationService.createInstance(Ct,n,this.options?.feature)),s=()=>i.layout(e.content.clientHeight,e.content.clientWidth),c=C.insert(this.layoutParticipants,{layout:s});return this.contentDisposables.add(y(c)),r(e.content,i.domNode),s(),i.domNode}openExtensionDependencies(e,t,n){if(n.isCancellationRequested)return Promise.resolve(null);if(C.isFalsyOrEmpty(e.dependencies))return r(t.content,o("p.nocontent")).textContent=l("noDependencies","No Dependencies"),Promise.resolve(t.content);const i=o("div",{class:"subcontent"}),s=new K(i,{});r(t.content,s.getDomNode()),this.contentDisposables.add(s);const c=this.instantiationService.createInstance(Jt,new Yt(e,null,d=>d.dependencies||[],this.extensionsWorkbenchService),i,{listBackground:it}),u=()=>{s.scanDomNode();const d=s.getScrollDimensions();c.layout(d.height)},h=C.insert(this.layoutParticipants,{layout:u});return this.contentDisposables.add(y(h)),this.contentDisposables.add(c),s.scanDomNode(),Promise.resolve({focus(){c.domFocus()}})}async openExtensionPack(e,t,n){if(n.isCancellationRequested)return Promise.resolve(null);const i=await this.loadContents(()=>this.extensionManifest.get(),t.content);return n.isCancellationRequested||!i?null:this.renderExtensionPack(i,t.content,n)}async renderExtensionPack(e,t,n){if(n.isCancellationRequested)return null;const i=o("div",{class:"subcontent"}),s=new K(i,{useShadows:!1});r(t,s.getDomNode());const c=this.instantiationService.createInstance($t,i,new jt),u=await Xt(e.extensionPack,this.extensionsWorkbenchService);return c.setExtensions(u),s.scanDomNode(),this.contentDisposables.add(s),this.contentDisposables.add(c),this.contentDisposables.add(y(C.insert(this.layoutParticipants,{layout:()=>s.scanDomNode()}))),i}loadContents(e,t){t.classList.add("loading");const n=this.contentDisposables.add(e()),i=()=>t.classList.remove("loading");return n.promise.then(i,i),n.promise}layout(e){this.dimension=e,this.layoutParticipants.forEach(t=>t.layout())}onError(e){Ae(e)||this.notificationService.error(e)}};S=se([p(1,qe),p(2,$e),p(3,vt),p(4,St),p(5,ze),p(6,rt),p(7,Je),p(8,Xe),p(9,ht),p(10,Qe),p(11,pt),p(12,ft),p(13,Ke),p(14,Ue),p(15,_e),p(16,lt),p(17,gt),p(18,mt),p(19,ct),p(20,Ye)],S);const j=G.and(G.equals("activeEditor",S.ID),Fe.focus.toNegated());U(class extends B{constructor(){super({id:"editor.action.extensioneditor.showfind",title:l("find","Find"),keybinding:{when:j,weight:z.EditorContrib,primary:ce.CtrlCmd|_.KeyF}})}run(a){Y(a)?.showFind()}}),U(class extends B{constructor(){super({id:"editor.action.extensioneditor.findNext",title:l("find next","Find Next"),keybinding:{when:G.and(j,ve),primary:_.Enter,weight:z.EditorContrib}})}run(a){Y(a)?.runFindAction(!1)}}),U(class extends B{constructor(){super({id:"editor.action.extensioneditor.findPrevious",title:l("find previous","Find Previous"),keybinding:{when:G.and(j,ve),primary:ce.Shift|_.Enter,weight:z.EditorContrib}})}run(a){Y(a)?.runFindAction(!0)}}),at((m,a)=>{const e=m.getColor(st);e&&(a.addRule(`.monaco-workbench .extension-editor .content .details .additional-details-container .resources-container a.resource { color: ${e}; }`),a.addRule(`.monaco-workbench .extension-editor .content .feature-contributions a { color: ${e}; }`));const t=m.getColor(ot);t&&(a.addRule(`.monaco-workbench .extension-editor .content .details .additional-details-container .resources-container a.resource:hover,
			.monaco-workbench .extension-editor .content .details .additional-details-container .resources-container a.resource:active { color: ${t}; }`),a.addRule(`.monaco-workbench .extension-editor .content .feature-contributions a:hover,
			.monaco-workbench .extension-editor .content .feature-contributions a:active { color: ${t}; }`));const n=m.getColor(nt);n&&(a.addRule(`.monaco-workbench .extension-editor .content > .details > .additional-details-container .categories-container > .categories > .category:hover { background-color: ${n}; border-color: ${n}; }`),a.addRule(`.monaco-workbench .extension-editor .content > .details > .additional-details-container .tags-container > .tags > .tag:hover { background-color: ${n}; border-color: ${n}; }`));const i=m.getColor(tt);i&&(a.addRule(`.monaco-workbench .extension-editor .content > .details > .additional-details-container .categories-container > .categories > .category:hover { color: ${i}; }`),a.addRule(`.monaco-workbench .extension-editor .content > .details > .additional-details-container .tags-container > .tags > .tag:hover { color: ${i}; }`))});function Y(m){const a=m.get(ut).activeEditorPane;return a instanceof S?a:null}export{S as ExtensionEditor};
