var v=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var f=(a,r,i,t)=>{for(var e=t>1?void 0:t?b(r,i):r,o=a.length-1,s;o>=0;o--)(s=a[o])&&(e=(t?s(r,i,e):s(e))||e);return t&&e&&v(r,i,e),e},d=(a,r)=>(i,t)=>r(i,t,a);import{getLocation as h,parse as k}from"../../../../base/common/json.js";import{Disposable as I}from"../../../../base/common/lifecycle.js";import{Range as x}from"../../../../editor/common/core/range.js";import{CompletionItemKind as y}from"../../../../editor/common/languages.js";import{ILanguageFeaturesService as P}from"../../../../editor/common/services/languageFeatures.js";import{localize as T}from"../../../../nls.js";import{IExtensionManagementService as S}from"../../../../platform/extensionManagement/common/extensionManagement.js";let c=class extends I{constructor(i,t){super();this.extensionManagementService=i;this._register(t.completionProvider.register({language:"jsonc",pattern:"**/settings.json"},{_debugDisplayName:"extensionsCompletionProvider",provideCompletionItems:async(e,o,s,n)=>{const p=(l,m)=>{const g=l.getWordAtPosition(m);return g?new x(m.lineNumber,g.startColumn,m.lineNumber,g.endColumn):null},u=h(e.getValue(),e.getOffsetAt(o)),C=p(e,o)??x.fromPositions(o,o);if(u.path[0]==="extensions.supportUntrustedWorkspaces"&&u.path.length===2&&u.isAtPropertyKey){let l=[];try{l=Object.keys(k(e.getValue())["extensions.supportUntrustedWorkspaces"])}catch{}return{suggestions:await this.provideSupportUntrustedWorkspacesExtensionProposals(l,C)}}return{suggestions:[]}}}))}async provideSupportUntrustedWorkspacesExtensionProposals(i,t){const e=[],s=(await this.extensionManagementService.getInstalled()).filter(n=>n.manifest.main).filter(n=>i.indexOf(n.identifier.id)===-1);if(s.length)e.push(...s.map(n=>{const p=`"${n.identifier.id}": {
	"supported": true,
	"version": "${n.manifest.version}"
},`;return{label:n.identifier.id,kind:y.Value,insertText:p,filterText:p,range:t}}));else{const n=`"vscode.csharp": {
	"supported": true,
	"version": "0.0.0"
},`;e.push({label:T("exampleExtension","Example"),kind:y.Value,insertText:n,filterText:n,range:t})}return e}};c=f([d(0,S),d(1,P)],c);export{c as ExtensionsCompletionItemsProvider};
