var h=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var f=(a,r,i,t)=>{for(var e=t>1?void 0:t?k(r,i):r,o=a.length-1,s;o>=0;o--)(s=a[o])&&(e=(t?s(r,i,e):s(e))||e);return t&&e&&h(r,i,e),e},d=(a,r)=>(i,t)=>r(i,t,a);import{localize as I}from"../../../../nls.js";import"../../../../base/common/cancellation.js";import{getLocation as b,parse as P}from"../../../../base/common/json.js";import{Disposable as y}from"../../../../base/common/lifecycle.js";import"../../../../editor/common/core/position.js";import"../../../../editor/common/model.js";import{CompletionItemKind as x}from"../../../../editor/common/languages.js";import{IExtensionManagementService as T}from"../../../../platform/extensionManagement/common/extensionManagement.js";import"../../../common/contributions.js";import{Range as C}from"../../../../editor/common/core/range.js";import{ILanguageFeaturesService as S}from"../../../../editor/common/services/languageFeatures.js";let u=class extends y{constructor(i,t){super();this.extensionManagementService=i;this._register(t.completionProvider.register({language:"jsonc",pattern:"**/settings.json"},{_debugDisplayName:"extensionsCompletionProvider",provideCompletionItems:async(e,o,s,n)=>{const l=(p,m)=>{const g=p.getWordAtPosition(m);return g?new C(m.lineNumber,g.startColumn,m.lineNumber,g.endColumn):null},c=b(e.getValue(),e.getOffsetAt(o)),v=l(e,o)??C.fromPositions(o,o);if(c.path[0]==="extensions.supportUntrustedWorkspaces"&&c.path.length===2&&c.isAtPropertyKey){let p=[];try{p=Object.keys(P(e.getValue())["extensions.supportUntrustedWorkspaces"])}catch{}return{suggestions:await this.provideSupportUntrustedWorkspacesExtensionProposals(p,v)}}return{suggestions:[]}}}))}async provideSupportUntrustedWorkspacesExtensionProposals(i,t){const e=[],s=(await this.extensionManagementService.getInstalled()).filter(n=>n.manifest.main).filter(n=>i.indexOf(n.identifier.id)===-1);if(s.length)e.push(...s.map(n=>{const l=`"${n.identifier.id}": {
	"supported": true,
	"version": "${n.manifest.version}"
},`;return{label:n.identifier.id,kind:x.Value,insertText:l,filterText:l,range:t}}));else{const n=`"vscode.csharp": {
	"supported": true,
	"version": "0.0.0"
},`;e.push({label:I("exampleExtension","Example"),kind:x.Value,insertText:n,filterText:n,range:t})}return e}};u=f([d(0,T),d(1,S)],u);export{u as ExtensionsCompletionItemsProvider};
