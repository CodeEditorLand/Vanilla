var Vt=Object.defineProperty;var _t=Object.getOwnPropertyDescriptor;var u=(c,a,e,t)=>{for(var n=t>1?void 0:t?_t(a,e):a,o=c.length-1,r;o>=0;o--)(r=c[o])&&(n=(t?r(a,e,n):r(n))||n);return t&&n&&Vt(a,e,n),n},i=(c,a)=>(e,t)=>a(e,t,c);import"./media/extensionActions.css";import{localize as s,localize2 as be}from"../../../../nls.js";import{Action as w,Separator as It,SubmenuAction as Ft}from"../../../../base/common/actions.js";import{Delayer as it,Promises as fe,Throttler as st}from"../../../../base/common/async.js";import*as Gt from"../../../../base/browser/dom.js";import{Emitter as Et,Event as ke}from"../../../../base/common/event.js";import*as rt from"../../../../base/common/json.js";import{IContextMenuService as Ht}from"../../../../platform/contextview/browser/contextView.js";import{disposeIfDisposable as qt}from"../../../../base/common/lifecycle.js";import{ExtensionState as x,IExtensionsWorkbenchService as v,TOGGLE_IGNORE_EXTENSION_ACTION_ID as Qt,SELECT_INSTALL_VSIX_EXTENSION_COMMAND_ID as Kt,THEME_ACTIONS_GROUP as Xt,INSTALL_ACTIONS_GROUP as jt,UPDATE_ACTIONS_GROUP as Jt,ExtensionEditorTab as Ae,ExtensionRuntimeActionType as B,AutoUpdateConfigurationKey as Yt}from"../common/extensions.js";import{ExtensionsConfigurationInitialContent as yt}from"../common/extensionsFileTemplate.js";import{IExtensionGalleryService as $e,InstallOperation as Ce,TargetPlatformToString as zt,ExtensionManagementErrorCode as ee}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{IWorkbenchExtensionEnablementService as L,EnablementState as b,IExtensionManagementServerService as O,IWorkbenchExtensionManagementService as Zt}from"../../../services/extensionManagement/common/extensionManagement.js";import{ExtensionRecommendationReason as en,IExtensionIgnoredRecommendationsService as ot,IExtensionRecommendationsService as tn}from"../../../services/extensionRecommendations/common/extensionRecommendations.js";import{areSameExtensions as T,getExtensionId as kt}from"../../../../platform/extensionManagement/common/extensionManagementUtil.js";import{ExtensionType as Ct,ExtensionIdentifier as wt,isLanguagePackExtension as Lt,getWorkspaceSupportTypeMessage as Re,TargetPlatform as Be,isApplicationScopedExtension as nn}from"../../../../platform/extensions/common/extensions.js";import{IInstantiationService as y}from"../../../../platform/instantiation/common/instantiation.js";import{IFileService as we}from"../../../../platform/files/common/files.js";import{IWorkspaceContextService as ge,WorkbenchState as Oe}from"../../../../platform/workspace/common/workspace.js";import{IHostService as Tt}from"../../../services/host/browser/host.js";import{IExtensionService as P,toExtension as Wt,toExtensionDescription as Ue}from"../../../services/extensions/common/extensions.js";import{URI as H}from"../../../../base/common/uri.js";import{CommandsRegistry as Mt,ICommandService as at}from"../../../../platform/commands/common/commands.js";import{IConfigurationService as Pt}from"../../../../platform/configuration/common/configuration.js";import{registerThemingParticipant as sn}from"../../../../platform/theme/common/themeService.js";import{ThemeIcon as I}from"../../../../base/common/themables.js";import{buttonBackground as Ve,buttonForeground as _e,buttonHoverBackground as Fe,registerColor as le,editorWarningForeground as rn,editorInfoForeground as on,editorErrorForeground as an,buttonSeparator as ln}from"../../../../platform/theme/common/colorRegistry.js";import{IJSONEditingService as lt}from"../../../services/configuration/common/jsonEditing.js";import"../../../../platform/editor/common/editor.js";import{ITextModelService as ct}from"../../../../editor/common/services/resolverService.js";import{IContextKeyService as cn}from"../../../../platform/contextkey/common/contextkey.js";import{MenuId as dn,IMenuService as hn}from"../../../../platform/actions/common/actions.js";import{PICK_WORKSPACE_FOLDER_COMMAND_ID as un}from"../../../browser/actions/workspaceCommands.js";import{INotificationService as Le,Severity as q}from"../../../../platform/notification/common/notification.js";import{IOpenerService as Dt}from"../../../../platform/opener/common/opener.js";import{IEditorService as dt}from"../../../services/editor/common/editorService.js";import{IQuickInputService as Q}from"../../../../platform/quickinput/common/quickInput.js";import{CancellationToken as ce}from"../../../../base/common/cancellation.js";import{alert as W}from"../../../../base/browser/ui/aria/aria.js";import{IWorkbenchThemeService as Te}from"../../../services/themes/common/workbenchThemeService.js";import{ILabelService as Nt}from"../../../../platform/label/common/label.js";import{ITextFileService as ht}from"../../../services/textfile/common/textfiles.js";import{IProductService as ut}from"../../../../platform/product/common/productService.js";import{IDialogService as We}from"../../../../platform/dialogs/common/dialogs.js";import{IProgressService as pt,ProgressLocation as pn}from"../../../../platform/progress/common/progress.js";import{ActionViewItem as xn}from"../../../../base/browser/ui/actionbar/actionViewItems.js";import{EXTENSIONS_CONFIG as At}from"../../../services/extensionRecommendations/common/workspaceExtensionsConfig.js";import{getErrorMessage as Ge,isCancellationError as $t}from"../../../../base/common/errors.js";import{IUserDataSyncEnablementService as vn}from"../../../../platform/userDataSync/common/userDataSync.js";import"../../../../base/browser/contextmenu.js";import{ILogService as xt}from"../../../../platform/log/common/log.js";import{errorIcon as te,infoIcon as M,manageExtensionIcon as Rt,syncEnabledIcon as mn,syncIgnoredIcon as Sn,trustIcon as de,warningIcon as f}from"./extensionsIcons.js";import{isIOS as bn,isWeb as vt,language as mt}from"../../../../base/common/platform.js";import{IExtensionManifestPropertiesService as Ie}from"../../../services/extensions/common/extensionManifestPropertiesService.js";import{IWorkspaceTrustEnablementService as fn,IWorkspaceTrustManagementService as gn}from"../../../../platform/workspace/common/workspaceTrust.js";import{isVirtualWorkspace as In}from"../../../../platform/workspace/common/virtualWorkspace.js";import{escapeMarkdownSyntaxTokens as He,MarkdownString as S}from"../../../../base/common/htmlContent.js";import{fromNow as En}from"../../../../base/common/date.js";import{IPreferencesService as yn}from"../../../services/preferences/common/preferences.js";import{getLocale as St}from"../../../../platform/languagePacks/common/languagePacks.js";import{ILocaleService as kn}from"../../../services/localization/common/locale.js";import{isString as Bt}from"../../../../base/common/types.js";import{showWindowLogActionId as Cn}from"../../../services/log/common/logConstants.js";import{ITelemetryService as Ot}from"../../../../platform/telemetry/common/telemetry.js";import{Extensions as wn,IExtensionFeaturesManagementService as Ln}from"../../../services/extensionManagement/common/extensionFeatures.js";import{Registry as Tn}from"../../../../platform/registry/common/platform.js";import{IUpdateService as Wn}from"../../../../platform/update/common/update.js";import{ActionWithDropdownActionViewItem as Mn}from"../../../../base/browser/ui/dropdown/dropdownActionViewItem.js";let ne=class extends w{constructor(e,t,n,o,r,l,d,m,p,g,tt,nt,gt,Z,Nn){super("extension.promptExtensionInstallFailure");this.extension=e;this.options=t;this.version=n;this.installOperation=o;this.error=r;this.productService=l;this.openerService=d;this.notificationService=m;this.dialogService=p;this.commandService=g;this.logService=tt;this.extensionManagementServerService=nt;this.instantiationService=gt;this.galleryService=Z;this.extensionManifestPropertiesService=Nn}async run(){if($t(this.error))return;if(this.logService.error(this.error),this.error.name===ee.Unsupported){const l=vt?s("VS Code for Web","{0} for the Web",this.productService.nameLong):this.productService.nameLong,d=s("cannot be installed","The '{0}' extension is not available in {1}. Click 'More Information' to learn more.",this.extension.displayName||this.extension.identifier.id,l),{confirmed:m}=await this.dialogService.confirm({type:q.Info,message:d,primaryButton:s({key:"more information",comment:["&& denotes a mnemonic"]},"&&More Information"),cancelButton:s("close","Close")});m&&this.openerService.open(vt?H.parse("https://aka.ms/vscode-web-extensions-guide"):H.parse("https://aka.ms/vscode-remote"));return}if(ee.ReleaseVersionNotFound===this.error.name){await this.dialogService.prompt({type:"error",message:Ge(this.error),buttons:[{label:s("install prerelease","Install Pre-Release"),run:()=>{const l=this.instantiationService.createInstance(k,{installPreReleaseVersion:!0});return l.extension=this.extension,l.run()}}],cancelButton:s("cancel","Cancel")});return}if([ee.Incompatible,ee.IncompatibleApi,ee.IncompatibleTargetPlatform,ee.Malicious,ee.Deprecated].includes(this.error.name)){await this.dialogService.info(Ge(this.error));return}if(ee.Signature===this.error.name){await this.dialogService.prompt({type:"error",message:s("signature verification failed","Signature of '{0}' extension could not be verified. Are you sure you want to install?",this.extension.displayName),detail:Ge(this.error),buttons:[{label:s("install anyway","Install Anyway"),run:()=>{const l=this.instantiationService.createInstance(k,{...this.options,donotVerifySignature:!0});return l.extension=this.extension,l.run()}}],cancelButton:!0});return}const e=this.installOperation===Ce.Update?s("update operation","Error while updating '{0}' extension.",this.extension.displayName||this.extension.identifier.id):s("install operation","Error while installing '{0}' extension.",this.extension.displayName||this.extension.identifier.id);let t;const n=[],o=await this.getDownloadUrl();o&&(t=s("check logs","Please check the [log]({0}) for more details.",`command:${Cn}`),n.push({label:s("download","Try Downloading Manually..."),run:()=>this.openerService.open(o).then(()=>{this.notificationService.prompt(q.Info,s("install vsix","Once downloaded, please manually install the downloaded VSIX of '{0}'.",this.extension.identifier.id),[{label:s("installVSIX","Install from VSIX..."),run:()=>this.commandService.executeCommand(Kt)}])})}));const r=`${e}${t?` ${t}`:""}`;this.notificationService.prompt(q.Error,r,n)}async getDownloadUrl(){if(bn||!this.extension.gallery||!this.productService.extensionsGallery||!this.extensionManagementServerService.localExtensionManagementServer&&!this.extensionManagementServerService.remoteExtensionManagementServer)return;let e=this.extension.gallery.properties.targetPlatform;if(e!==Be.UNIVERSAL&&e!==Be.UNDEFINED&&this.extensionManagementServerService.remoteExtensionManagementServer)try{const t=await this.galleryService.getManifest(this.extension.gallery,ce.None);t&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(t)&&(e=await this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform())}catch(t){this.logService.error(t);return}if(e!==Be.UNKNOWN)return H.parse(`${this.productService.extensionsGallery.serviceUrl}/publishers/${this.extension.publisher}/vsextensions/${this.extension.name}/${this.version}/vspackage${e!==Be.UNDEFINED?`?targetPlatform=${e}`:""}`)}};ne=u([i(5,ut),i(6,Dt),i(7,Le),i(8,We),i(9,at),i(10,xt),i(11,O),i(12,y),i(13,$e),i(14,Ie)],ne);class h extends w{_onDidChange=this._register(new Et);onDidChange=this._onDidChange.event;static EXTENSION_ACTION_CLASS="extension-action";static TEXT_ACTION_CLASS=`${h.EXTENSION_ACTION_CLASS} text`;static LABEL_ACTION_CLASS=`${h.EXTENSION_ACTION_CLASS} label`;static PROMINENT_LABEL_ACTION_CLASS=`${h.LABEL_ACTION_CLASS} prominent`;static ICON_ACTION_CLASS=`${h.EXTENSION_ACTION_CLASS} icon`;_extension=null;get extension(){return this._extension}set extension(a){this._extension=a,this.update()}_hidden=!1;get hidden(){return this._hidden}set hidden(a){this._hidden!==a&&(this._hidden=a,this._onDidChange.fire({hidden:a}))}_setEnabled(a){super._setEnabled(a),this.hideOnDisabled&&(this.hidden=!a)}hideOnDisabled=!0}class bt extends h{constructor(e,t,n){t=`${t} action-dropdown`;super(e,void 0,t);this.actionsGroups=n;this.menuActionClassNames=t.split(" "),this.hideOnDisabled=!1,this.extensionActions=n.flat(),this.update(),this._register(ke.any(...this.extensionActions.map(o=>o.onDidChange))(()=>this.update(!0))),this.extensionActions.forEach(o=>this._register(o))}primaryAction;menuActionClassNames=[];_menuActions=[];get menuActions(){return[...this._menuActions]}get extension(){return super.extension}set extension(e){this.extensionActions.forEach(t=>t.extension=e),super.extension=e}extensionActions;update(e){e||this.extensionActions.forEach(o=>o.update());const t=this.actionsGroups.map(o=>o.filter(r=>!r.hidden));let n=[];for(const o of t)o.length&&(n=[...n,...o,new It]);n=n.length?n.slice(0,n.length-1):n,this.primaryAction=n[0],this._menuActions=n.length>1?n:[],this._onDidChange.fire({menuActions:this._menuActions}),this.primaryAction?(this.hidden=!1,this.enabled=this.primaryAction.enabled,this.label=this.getLabel(this.primaryAction),this.tooltip=this.primaryAction.tooltip):(this.hidden=!0,this.enabled=!1)}async run(){this.enabled&&await this.primaryAction?.run()}getLabel(e){return e.label}}class ws extends Mn{constructor(a,e,t){super(null,a,e,t),this._register(a.onDidChange(n=>{(n.hidden!==void 0||n.menuActions!==void 0)&&this.updateClass()}))}render(a){super.render(a),this.updateClass()}updateClass(){if(super.updateClass(),this.element&&this.dropdownMenuActionViewItem?.element){this.element.classList.toggle("hide",this._action.hidden);const a=this._action.menuActions.length===0;this.element.classList.toggle("empty",a),this.dropdownMenuActionViewItem.element.classList.toggle("hide",a)}}}let k=class extends h{constructor(e,t,n,o,r,l,d,m,p,g){super("extensions.install",s("install","Install"),k.CLASS,!1);this.extensionsWorkbenchService=t;this.instantiationService=n;this.runtimeExtensionService=o;this.workbenchThemeService=r;this.labelService=l;this.dialogService=d;this.preferencesService=m;this.telemetryService=p;this.contextService=g;this.hideOnDisabled=!1,this.options={isMachineScoped:!1,...e},this.update(),this._register(this.labelService.onDidChangeFormatters(()=>this.updateLabel(),this))}static CLASS=`${this.LABEL_ACTION_CLASS} prominent install`;static HIDE=`${this.CLASS} hide`;_manifest=null;set manifest(e){this._manifest=e,this.updateLabel()}updateThrottler=new st;options;update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement())}async computeAndUpdateEnablement(){this.enabled=!1,this.class=k.HIDE,this.hidden=!0,this.extension&&(this.extension.isBuiltin||this.extensionsWorkbenchService.canSetLanguage(this.extension)||this.extension.state===x.Uninstalled&&(this.options.installPreReleaseVersion&&!this.extension.hasPreReleaseVersion||!this.options.installPreReleaseVersion&&!this.extension.hasReleaseVersion||(this.hidden=!1,this.class=k.CLASS,await this.extensionsWorkbenchService.canInstall(this.extension)&&(this.enabled=!0,this.updateLabel()))))}async run(){if(!this.extension)return;if(this.extension.deprecationInfo){let t=s("deprecated message","This extension is deprecated as it is no longer being maintained."),n;(g=>(g[g.InstallAnyway=0]="InstallAnyway",g[g.ShowAlternateExtension=1]="ShowAlternateExtension",g[g.ConfigureSettings=2]="ConfigureSettings",g[g.Cancel=3]="Cancel"))(n||={});const o=[{label:s("install anyway","Install Anyway"),run:()=>0}];if(this.extension.deprecationInfo.extension){t=s("deprecated with alternate extension message","This extension is deprecated. Use the {0} extension instead.",this.extension.deprecationInfo.extension.displayName);const l=this.extension.deprecationInfo.extension;o.push({label:s({key:"Show alternate extension",comment:["&& denotes a mnemonic"]},"&&Open {0}",this.extension.deprecationInfo.extension.displayName),run:async()=>{const[d]=await this.extensionsWorkbenchService.getExtensions([{id:l.id,preRelease:l.preRelease}],ce.None);return await this.extensionsWorkbenchService.open(d),1}})}else if(this.extension.deprecationInfo.settings){t=s("deprecated with alternate settings message","This extension is deprecated as this functionality is now built-in to VS Code.");const l=this.extension.deprecationInfo.settings;o.push({label:s({key:"configure in settings",comment:["&& denotes a mnemonic"]},"&&Configure Settings"),run:async()=>(await this.preferencesService.openSettings({query:l.map(d=>`@id:${d}`).join(" ")}),2)})}else this.extension.deprecationInfo.additionalInfo&&(t=new S(`${t} ${this.extension.deprecationInfo.additionalInfo}`));const{result:r}=await this.dialogService.prompt({type:q.Warning,message:s("install confirmation","Are you sure you want to install '{0}'?",this.extension.displayName),detail:Bt(t)?t:void 0,custom:Bt(t)?void 0:{markdownDetails:[{markdown:t}]},buttons:o,cancelButton:{run:()=>3}});if(r!==0)return}this.extensionsWorkbenchService.open(this.extension,{showPreReleaseVersion:this.options.installPreReleaseVersion}),W(s("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.telemetryService.publicLog("extensions:action:install",{...this.extension.telemetryData,actionId:this.id});const e=await this.install(this.extension);if(e?.local){W(s("installExtensionComplete","Installing extension {0} is completed.",this.extension.displayName));const t=await this.getRunningExtension(e.local);if(t&&!(t.activationEvents&&t.activationEvents.some(n=>n.startsWith("onLanguage")))){const n=await this.getThemeAction(e);if(n){n.extension=e;try{return n.run({showCurrentTheme:!0,ignoreFocusLost:!0})}finally{n.dispose()}}}}}async getThemeAction(e){if((await this.workbenchThemeService.getColorThemes()).some(r=>U(r,e)))return this.instantiationService.createInstance(A);if((await this.workbenchThemeService.getFileIconThemes()).some(r=>U(r,e)))return this.instantiationService.createInstance($);if((await this.workbenchThemeService.getProductIconThemes()).some(r=>U(r,e)))return this.instantiationService.createInstance(R)}async install(e){try{return await this.extensionsWorkbenchService.install(e,this.options)}catch(t){await this.instantiationService.createInstance(ne,e,this.options,e.latestVersion,Ce.Install,t).run();return}}async getRunningExtension(e){const t=await this.runtimeExtensionService.getExtension(e.identifier.id);return t||(this.runtimeExtensionService.canAddExtension(Ue(e))?new Promise((n,o)=>{const r=this.runtimeExtensionService.onDidChangeExtensions(async()=>{const l=await this.runtimeExtensionService.getExtension(e.identifier.id);l&&(r.dispose(),n(l))})}):null)}updateLabel(){this.label=this.getLabel()}getLabel(e){return this.extension?.isWorkspaceScoped&&this.extension.resourceExtension&&this.contextService.isInsideWorkspace(this.extension.resourceExtension.location)?s("install workspace version","Install Workspace Extension"):this.options.installPreReleaseVersion&&this.extension?.hasPreReleaseVersion?e?s("install pre-release","Install Pre-Release"):s("install pre-release version","Install Pre-Release Version"):this.extension?.hasPreReleaseVersion?e?s("install","Install"):s("install release version","Install Release Version"):s("install","Install")}};k=u([i(1,v),i(2,y),i(3,P),i(4,Te),i(5,Nt),i(6,We),i(7,yn),i(8,Ot),i(9,ge)],k);let qe=class extends bt{set manifest(a){this.extensionActions.forEach(e=>e.manifest=a),this.update()}constructor(a,e){super("extensions.installActions",k.CLASS,[[a.createInstance(k,{installPreReleaseVersion:e.preferPreReleases}),a.createInstance(k,{installPreReleaseVersion:!e.preferPreReleases})]])}getLabel(a){return a.getLabel(!0)}};qe=u([i(0,y),i(1,v)],qe);class et extends h{static LABEL=s("installing","Installing");static CLASS=`${h.LABEL_ACTION_CLASS} install installing`;constructor(){super("extension.installing",et.LABEL,et.CLASS,!1)}update(){this.class=`${et.CLASS}${this.extension&&this.extension.state===x.Installing?"":" hide"}`}}let E=class extends h{constructor(e,t,n,o,r,l){super(e,E.INSTALL_LABEL,E.Class,!1);this.server=t;this.canInstallAnyWhere=n;this.extensionsWorkbenchService=o;this.extensionManagementServerService=r;this.extensionManifestPropertiesService=l;this.update()}static INSTALL_LABEL=s("install","Install");static INSTALLING_LABEL=s("installing","Installing");static Class=`${h.LABEL_ACTION_CLASS} prominent install-other-server`;static InstallingClass=`${h.LABEL_ACTION_CLASS} install-other-server installing`;updateWhenCounterExtensionChanges=!0;update(){if(this.enabled=!1,this.class=E.Class,this.canInstall()){const e=this.extensionsWorkbenchService.installed.filter(t=>T(t.identifier,this.extension.identifier)&&t.server===this.server)[0];e?e.state===x.Installing&&!e.local&&(this.enabled=!0,this.label=E.INSTALLING_LABEL,this.class=E.InstallingClass):(this.enabled=!0,this.label=this.getInstallLabel())}}canInstall(){return!this.extension||!this.server||!this.extension.local||this.extension.state!==x.Installed||this.extension.type!==Ct.User||this.extension.enablementState===b.DisabledByEnvironment||this.extension.enablementState===b.DisabledByTrustRequirement||this.extension.enablementState===b.DisabledByVirtualWorkspace?!1:!!(Lt(this.extension.local.manifest)||this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)||this.server===this.extensionManagementServerService.webExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWeb(this.extension.local.manifest)||this.canInstallAnyWhere&&(this.server===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnUI(this.extension.local.manifest)||this.server===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.canExecuteOnWorkspace(this.extension.local.manifest)))}async run(){if(this.extension?.local&&this.extension?.server&&this.server)return this.extensionsWorkbenchService.open(this.extension),W(s("installExtensionStart","Installing extension {0} started. An editor is now open with more details on this extension",this.extension.displayName)),this.extensionsWorkbenchService.installInServer(this.extension,this.server)}};E=u([i(3,v),i(4,O),i(5,Ie)],E);let Me=class extends E{constructor(a,e,t,n){super("extensions.remoteinstall",t.remoteExtensionManagementServer,a,e,t,n)}getInstallLabel(){return this.extensionManagementServerService.remoteExtensionManagementServer?s({key:"install in remote",comment:["This is the name of the action to install an extension in remote server. Placeholder is for the name of remote server."]},"Install in {0}",this.extensionManagementServerService.remoteExtensionManagementServer.label):E.INSTALL_LABEL}};Me=u([i(1,v),i(2,O),i(3,Ie)],Me);let Qe=class extends E{constructor(a,e,t){super("extensions.localinstall",e.localExtensionManagementServer,!1,a,e,t)}getInstallLabel(){return s("install locally","Install Locally")}};Qe=u([i(0,v),i(1,O),i(2,Ie)],Qe);let Ke=class extends E{constructor(a,e,t){super("extensions.webInstall",e.webExtensionManagementServer,!1,a,e,t)}getInstallLabel(){return s("install browser","Install in Browser")}};Ke=u([i(0,v),i(1,O),i(2,Ie)],Ke);let C=class extends h{constructor(e,t){super("extensions.uninstall",C.UninstallLabel,C.UninstallClass,!1);this.extensionsWorkbenchService=e;this.dialogService=t;this.update()}static UninstallLabel=s("uninstallAction","Uninstall");static UninstallingLabel=s("Uninstalling","Uninstalling");static UninstallClass=`${h.LABEL_ACTION_CLASS} uninstall`;static UnInstallingClass=`${h.LABEL_ACTION_CLASS} uninstall uninstalling`;update(){if(!this.extension){this.enabled=!1;return}const e=this.extension.state;if(e===x.Uninstalling){this.label=C.UninstallingLabel,this.class=C.UnInstallingClass,this.enabled=!1;return}if(this.label=C.UninstallLabel,this.class=C.UninstallClass,this.tooltip=C.UninstallLabel,e!==x.Installed){this.enabled=!1;return}if(this.extension.isBuiltin){this.enabled=!1;return}this.enabled=!0}async run(){if(this.extension){W(s("uninstallExtensionStart","Uninstalling extension {0} started.",this.extension.displayName));try{await this.extensionsWorkbenchService.uninstall(this.extension),W(s("uninstallExtensionComplete","Please reload Visual Studio Code to complete the uninstallation of the extension {0}.",this.extension.displayName))}catch(e){$t(e)||this.dialogService.error(Ge(e))}}}};C=u([i(0,v),i(1,We)],C);let Y=class extends h{constructor(e,t,n,o,r){super("extensions.update",s("update","Update"),Y.DisabledClass,!1);this.verbose=e;this.extensionsWorkbenchService=t;this.dialogService=n;this.openerService=o;this.instantiationService=r;this.update()}static EnabledClass=`${this.LABEL_ACTION_CLASS} prominent update`;static DisabledClass=`${this.EnabledClass} disabled`;updateThrottler=new st;update(){this.updateThrottler.queue(()=>this.computeAndUpdateEnablement()),this.extension&&(this.label=this.verbose?s("update to","Update to v{0}",this.extension.latestVersion):s("update","Update"))}async computeAndUpdateEnablement(){if(this.enabled=!1,this.class=Y.DisabledClass,!this.extension||this.extension.deprecationInfo)return;const e=await this.extensionsWorkbenchService.canInstall(this.extension),t=this.extension.state===x.Installed;this.enabled=e&&t&&this.extension.outdated,this.class=this.enabled?Y.EnabledClass:Y.DisabledClass}async run(){if(!this.extension)return;const e=await this.extensionsWorkbenchService.shouldRequireConsentToUpdate(this.extension);if(e){const{result:t}=await this.dialogService.prompt({type:"warning",title:s("updateExtensionConsentTitle","Update {0} Extension",this.extension.displayName),message:s("updateExtensionConsent",`{0}

Would you like to update the extension?`,e),buttons:[{label:s("update","Update"),run:()=>"update"},{label:s("review","Review"),run:()=>"review"},{label:s("cancel","Cancel"),run:()=>"cancel"}]});if(t==="cancel")return;if(t==="review")return this.extension.hasChangelog()?this.extensionsWorkbenchService.open(this.extension,{tab:Ae.Changelog}):this.extension.repository?this.openerService.open(this.extension.repository):this.extensionsWorkbenchService.open(this.extension)}return W(s("updateExtensionStart","Updating extension {0} to version {1} started.",this.extension.displayName,this.extension.latestVersion)),this.install(this.extension)}async install(e){const t=e.local?.preRelease?{installPreReleaseVersion:!0}:void 0;try{await this.extensionsWorkbenchService.install(e,t),W(s("updateExtensionComplete","Updating extension {0} to version {1} completed.",e.displayName,e.latestVersion))}catch(n){this.instantiationService.createInstance(ne,e,t,e.latestVersion,Ce.Update,n).run()}}};Y=u([i(1,v),i(2,We),i(3,Dt),i(4,y)],Y);let N=class extends h{constructor(e,t,n){super(N.ID,N.LABEL.value,N.DisabledClass);this.extensionsWorkbenchService=e;this.extensionEnablementService=t;this._register(n.onDidChangeConfiguration(o=>{o.affectsConfiguration(Yt)&&this.update()})),this.update()}static ID="workbench.extensions.action.toggleAutoUpdateForExtension";static LABEL=be("enableAutoUpdateLabel","Auto Update");static EnabledClass=`${h.EXTENSION_ACTION_CLASS} auto-update`;static DisabledClass=`${this.EnabledClass} hide`;update(){this.enabled=!1,this.class=N.DisabledClass,this.extension&&(this.extension.isBuiltin||this.extension.deprecationInfo?.disallowInstall||this.extensionsWorkbenchService.getAutoUpdateValue()==="onlyEnabledExtensions"&&!this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)||(this.enabled=!0,this.class=N.EnabledClass,this.checked=this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension)))}async run(){if(!this.extension)return;const e=!this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension);await this.extensionsWorkbenchService.updateAutoUpdateEnablementFor(this.extension,e),e?W(s("enableAutoUpdate","Enabled auto updates for",this.extension.displayName)):W(s("disableAutoUpdate","Disabled auto updates for",this.extension.displayName))}};N=u([i(0,v),i(1,L),i(2,Pt)],N);let ie=class extends h{constructor(e){super(ie.ID,ie.LABEL);this.extensionsWorkbenchService=e}static ID="workbench.extensions.action.toggleAutoUpdatesForPublisher";static LABEL=s("toggleAutoUpdatesForPublisherLabel","Auto Update All (From Publisher)");update(){}async run(){if(!this.extension)return;W(s("ignoreExtensionUpdatePublisher","Ignoring updates published by {0}.",this.extension.publisherDisplayName));const e=!this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension.publisher);await this.extensionsWorkbenchService.updateAutoUpdateEnablementFor(this.extension.publisher,e),e?W(s("enableAutoUpdate","Enabled auto updates for",this.extension.displayName)):W(s("disableAutoUpdate","Disabled auto updates for",this.extension.displayName))}};ie=u([i(0,v)],ie);let se=class extends h{constructor(e,t){super("extensionsAction.migrateDeprecatedExtension",s("migrateExtension","Migrate"),se.DisabledClass,!1);this.small=e;this.extensionsWorkbenchService=t;this.update()}static EnabledClass=`${h.LABEL_ACTION_CLASS} migrate`;static DisabledClass=`${this.EnabledClass} disabled`;update(){if(this.enabled=!1,this.class=se.DisabledClass,!this.extension?.local||this.extension.state!==x.Installed||!this.extension.deprecationInfo?.extension)return;const e=this.extension.deprecationInfo.extension.id;this.extensionsWorkbenchService.local.some(t=>T(t.identifier,{id:e}))||(this.enabled=!0,this.class=se.EnabledClass,this.tooltip=s("migrate to","Migrate to {0}",this.extension.deprecationInfo.extension.displayName),this.label=this.small?s("migrate","Migrate"):this.tooltip)}async run(){if(!this.extension?.deprecationInfo?.extension)return;const e=this.extension.local;await this.extensionsWorkbenchService.uninstall(this.extension);const[t]=await this.extensionsWorkbenchService.getExtensions([{id:this.extension.deprecationInfo.extension.id,preRelease:this.extension.deprecationInfo?.extension?.preRelease}],ce.None);await this.extensionsWorkbenchService.install(t,{isMachineScoped:e?.isMachineScoped})}};se=u([i(1,v)],se);let he=class extends h{constructor(e,t,n,o,r){super(e,t,n,o);this.instantiationService=r}_actionViewItem=null;createActionViewItem(e){return this._actionViewItem=this.instantiationService.createInstance(Pe,this,e),this._actionViewItem}run({actionGroups:e,disposeActionsOnHide:t}){return this._actionViewItem?.showMenu(e,t),Promise.resolve()}};he=u([i(4,y)],he);let Pe=class extends xn{constructor(e,t,n){super(null,e,{...t,icon:!0,label:!0});this.contextMenuService=n}showMenu(e,t){if(this.element){const n=this.getActions(e),o=Gt.getDomNodePagePosition(this.element),r={x:o.left,y:o.top+o.height+10};this.contextMenuService.showContextMenu({getAnchor:()=>r,getActions:()=>n,actionRunner:this.actionRunner,onHide:()=>{t&&qt(n)}})}}getActions(e){let t=[];for(const n of e)t=[...t,...n,new It];return t.length?t.slice(0,t.length-1):t}};Pe=u([i(2,Ht)],Pe);async function Ut(c,a,e){return e.invokeFunction(async t=>{const n=t.get(v),o=t.get(L),r=t.get(hn),l=t.get(tn),d=t.get(ot),m=t.get(Te),p=[];if(c){switch(p.push(["extension",c.identifier.id]),p.push(["isBuiltinExtension",c.isBuiltin]),p.push(["isDefaultApplicationScopedExtension",c.local&&nn(c.local.manifest)]),p.push(["isApplicationScopedExtension",c.local&&c.local.isApplicationScoped]),p.push(["isWorkspaceScopedExtension",c.isWorkspaceScoped]),p.push(["isGalleryExtension",!!c.identifier.uuid]),c.local&&p.push(["extensionSource",c.local.source]),p.push(["extensionHasConfiguration",c.local&&!!c.local.manifest.contributes&&!!c.local.manifest.contributes.configuration]),p.push(["extensionHasKeybindings",c.local&&!!c.local.manifest.contributes&&!!c.local.manifest.contributes.keybindings]),p.push(["extensionHasCommands",c.local&&!!c.local.manifest.contributes&&!!c.local.manifest.contributes?.commands]),p.push(["isExtensionRecommended",!!l.getAllRecommendationsWithReason()[c.identifier.id.toLowerCase()]]),p.push(["isExtensionWorkspaceRecommended",l.getAllRecommendationsWithReason()[c.identifier.id.toLowerCase()]?.reasonId===en.Workspace]),p.push(["isUserIgnoredRecommendation",d.globalIgnoredRecommendations.some(Z=>Z===c.identifier.id.toLowerCase())]),p.push(["isExtensionPinned",c.pinned]),p.push(["isExtensionEnabled",o.isEnabledEnablementState(c.enablementState)]),c.state){case x.Installing:p.push(["extensionStatus","installing"]);break;case x.Installed:p.push(["extensionStatus","installed"]);break;case x.Uninstalling:p.push(["extensionStatus","uninstalling"]);break;case x.Uninstalled:p.push(["extensionStatus","uninstalled"]);break}p.push(["installedExtensionIsPreReleaseVersion",!!c.local?.isPreReleaseVersion]),p.push(["installedExtensionIsOptedToPreRelease",!!c.local?.preRelease]),p.push(["galleryExtensionIsPreReleaseVersion",!!c.gallery?.properties.isPreReleaseVersion]),p.push(["galleryExtensionHasPreReleaseVersion",c.gallery?.hasPreReleaseVersion]),p.push(["extensionHasPreReleaseVersion",c.hasPreReleaseVersion]),p.push(["extensionHasReleaseVersion",c.hasReleaseVersion]),p.push(["extensionDisallowInstall",!!c.deprecationInfo?.disallowInstall]);const[tt,nt,gt]=await Promise.all([m.getColorThemes(),m.getFileIconThemes(),m.getProductIconThemes()]);p.push(["extensionHasColorThemes",tt.some(Z=>U(Z,c))]),p.push(["extensionHasFileIconThemes",nt.some(Z=>U(Z,c))]),p.push(["extensionHasProductIconThemes",gt.some(Z=>U(Z,c))]),p.push(["canSetLanguage",n.canSetLanguage(c)]),p.push(["isActiveLanguagePackExtension",c.gallery&&mt===St(c.gallery)])}return r.getMenuActions(dn.ExtensionContext,a.createOverlay(p),{shouldForwardArgs:!0})})}function De(c,a){const e=[];for(const[,t]of c)e.push(t.map(n=>n instanceof Ft?n:a.createInstance(Ne,n)));return e}async function Pn(c,a,e){const t=await Ut(c,a,e);return De(t,e)}let z=class extends he{constructor(e,t,n){super(z.ID,"","",!0,e);this.extensionService=t;this.contextKeyService=n;this.tooltip=s("manage","Manage"),this.update()}static ID="extensions.manage";static Class=`${h.ICON_ACTION_CLASS} manage `+I.asClassName(Rt);static HideManageExtensionClass=`${this.Class} hide`;async getActionGroups(){const e=[],t=await Ut(this.extension,this.contextKeyService,this.instantiationService),n=[],o=[],r=[],l=[];for(const[d,m]of t)d===jt?o.push(...De([[d,m]],this.instantiationService)[0]):d===Jt?r.push(...De([[d,m]],this.instantiationService)[0]):d===Xt?n.push(...De([[d,m]],this.instantiationService)[0]):l.push(...De([[d,m]],this.instantiationService));return n.length&&e.push(n),e.push([this.instantiationService.createInstance(X),this.instantiationService.createInstance(K)]),e.push([this.instantiationService.createInstance(J),this.instantiationService.createInstance(j)]),r.length&&e.push(r),e.push([...o.length?o:[],this.instantiationService.createInstance(V,this.extension,!1),this.instantiationService.createInstance(C)]),l.forEach(d=>e.push(d)),e.forEach(d=>d.forEach(m=>{m instanceof h&&(m.extension=this.extension)})),e}async run(){return await this.extensionService.whenInstalledExtensionsRegistered(),super.run({actionGroups:await this.getActionGroups(),disposeActionsOnHide:!0})}update(){if(this.class=z.HideManageExtensionClass,this.enabled=!1,this.extension){const e=this.extension.state;this.enabled=e===x.Installed,this.class=this.enabled||e===x.Uninstalling?z.Class:z.HideManageExtensionClass}}};z=u([i(0,y),i(1,P),i(2,cn)],z);class Ls extends he{constructor(e,t){super("extensionEditor.manageExtension","",`${h.ICON_ACTION_CLASS} manage ${I.asClassName(Rt)}`,!0,t);this.contextKeyService=e;this.tooltip=s("manage","Manage")}update(){}async run(){const e=[];return(await Pn(this.extension,this.contextKeyService,this.instantiationService)).forEach(t=>e.push(t)),e.forEach(t=>t.forEach(n=>{n instanceof h&&(n.extension=this.extension)})),super.run({actionGroups:e,disposeActionsOnHide:!0})}}let Ne=class extends h{constructor(e,t){super(e.id,e.label);this.action=e;this.extensionsWorkbenchService=t}get enabled(){return this.action.enabled}set enabled(e){this.action.enabled=e}update(){this.extension&&(this.action.id===Qt?this.checked=!this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension):this.action.id===N.ID?this.checked=this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension):this.action.id===ie.ID?this.checked=this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension.publisher):this.checked=this.action.checked)}async run(){if(this.extension){const e=this.extension.local?kt(this.extension.local.manifest.publisher,this.extension.local.manifest.name):this.extension.gallery?kt(this.extension.gallery.publisher,this.extension.gallery.name):this.extension.identifier.id,t={id:this.extension.identifier.id,version:this.extension.version,location:this.extension.local?.location};await this.action.run(e,t)}}};Ne=u([i(1,v)],Ne);let _=class extends h{constructor(e){super(_.ID,_.LABEL,_.DisabledClass);this.extensionsWorkbenchService=e;this.update()}static ID="workbench.extensions.action.togglePreRlease";static LABEL=s("togglePreRleaseLabel","Pre-Release");static EnabledClass=`${h.LABEL_ACTION_CLASS} pre-release`;static DisabledClass=`${this.EnabledClass} hide`;update(){this.enabled=!1,this.class=_.DisabledClass,this.extension&&(this.extension.isBuiltin||this.extension.state===x.Installed&&this.extension.hasPreReleaseVersion&&this.extension.gallery&&(this.extension.preRelease&&!this.extension.isPreReleaseVersion||!this.extension.preRelease&&!this.extension.gallery.hasPreReleaseVersion||(this.enabled=!0,this.class=_.EnabledClass,this.extension.preRelease?(this.label=s("togglePreRleaseDisableLabel","Switch to Release Version"),this.tooltip=s("togglePreRleaseDisableTooltip","This will switch and enable updates to release versions")):(this.label=s("switchToPreReleaseLabel","Switch to Pre-Release Version"),this.tooltip=s("switchToPreReleaseTooltip","This will switch to pre-release version and enable updates to latest version always")))))}async run(){this.extension&&(this.extensionsWorkbenchService.open(this.extension,{showPreReleaseVersion:!this.extension.preRelease}),await this.extensionsWorkbenchService.togglePreRelease(this.extension))}};_=u([i(0,v)],_);let V=class extends h{constructor(e,t,n,o,r,l,d,m){super(V.ID,V.LABEL,h.LABEL_ACTION_CLASS);this.whenInstalled=t;this.extensionsWorkbenchService=n;this.extensionManagementService=o;this.extensionGalleryService=r;this.quickInputService=l;this.instantiationService=d;this.dialogService=m;this.extension=e,this.update()}static ID="workbench.extensions.action.install.anotherVersion";static LABEL=s("install another version","Install Specific Version...");update(){this.enabled=!!this.extension&&!this.extension.isBuiltin&&!!this.extension.identifier.uuid&&!this.extension.deprecationInfo,this.enabled&&this.whenInstalled&&(this.enabled=!!this.extension?.local&&!!this.extension.server&&this.extension.state===x.Installed)}async run(){if(!this.enabled||!this.extension)return;const e=this.extension.server?await this.extension.server.extensionManagementService.getTargetPlatform():await this.extensionManagementService.getTargetPlatform(),t=await this.extensionGalleryService.getAllCompatibleVersions(this.extension.identifier,this.extension.local?.preRelease??this.extension.gallery?.properties.isPreReleaseVersion??!1,e);if(!t.length){await this.dialogService.info(s("no versions","This extension has no other versions."));return}const n=t.map((r,l)=>({id:r.version,label:r.version,description:`${En(new Date(Date.parse(r.date)),!0)}${r.isPreReleaseVersion?` (${s("pre-release","pre-release")})`:""}${r.version===this.extension?.local?.manifest.version?` (${s("current","current")})`:""}`,ariaLabel:`${r.isPreReleaseVersion?"Pre-Release version":"Release version"} ${r.version}`,isPreReleaseVersion:r.isPreReleaseVersion})),o=await this.quickInputService.pick(n,{placeHolder:s("selectVersion","Select Version to Install"),matchOnDetail:!0});if(o){if(this.extension.local?.manifest.version===o.id)return;const r={installPreReleaseVersion:o.isPreReleaseVersion,version:o.id};try{await this.extensionsWorkbenchService.install(this.extension,r)}catch(l){this.instantiationService.createInstance(ne,this.extension,r,o.id,Ce.Install,l).run()}}return null}};V=u([i(2,v),i(3,Zt),i(4,$e),i(5,Q),i(6,y),i(7,We)],V);let K=class extends h{constructor(e,t){super(K.ID,K.LABEL,h.LABEL_ACTION_CLASS);this.extensionsWorkbenchService=e;this.extensionEnablementService=t;this.tooltip=s("enableForWorkspaceActionToolTip","Enable this extension only in this workspace"),this.update()}static ID="extensions.enableForWorkspace";static LABEL=s("enableForWorkspaceAction","Enable (Workspace)");update(){this.enabled=!1,this.extension&&this.extension.local&&!this.extension.isWorkspaceScoped&&(this.enabled=this.extension.state===x.Installed&&!this.extensionEnablementService.isEnabled(this.extension.local)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,b.EnabledWorkspace)}};K=u([i(0,v),i(1,L)],K);let X=class extends h{constructor(e,t){super(X.ID,X.LABEL,h.LABEL_ACTION_CLASS);this.extensionsWorkbenchService=e;this.extensionEnablementService=t;this.tooltip=s("enableGloballyActionToolTip","Enable this extension"),this.update()}static ID="extensions.enableGlobally";static LABEL=s("enableGloballyAction","Enable");update(){this.enabled=!1,this.extension&&this.extension.local&&!this.extension.isWorkspaceScoped&&(this.enabled=this.extension.state===x.Installed&&this.extensionEnablementService.isDisabledGlobally(this.extension.local)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,b.EnabledGlobally)}};X=u([i(0,v),i(1,L)],X);let j=class extends h{constructor(e,t,n,o){super(j.ID,j.LABEL,h.LABEL_ACTION_CLASS);this.workspaceContextService=e;this.extensionsWorkbenchService=t;this.extensionEnablementService=n;this.extensionService=o;this.tooltip=s("disableForWorkspaceActionToolTip","Disable this extension only in this workspace"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}static ID="extensions.disableForWorkspace";static LABEL=s("disableForWorkspaceAction","Disable (Workspace)");update(){this.enabled=!1,this.extension&&this.extension.local&&!this.extension.isWorkspaceScoped&&this.extensionService.extensions.some(e=>T({id:e.identifier.value,uuid:e.uuid},this.extension.identifier)&&this.workspaceContextService.getWorkbenchState()!==Oe.EMPTY)&&(this.enabled=this.extension.state===x.Installed&&(this.extension.enablementState===b.EnabledGlobally||this.extension.enablementState===b.EnabledWorkspace)&&this.extensionEnablementService.canChangeWorkspaceEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,b.DisabledWorkspace)}};j=u([i(0,ge),i(1,v),i(2,L),i(3,P)],j);let J=class extends h{constructor(e,t,n){super(J.ID,J.LABEL,h.LABEL_ACTION_CLASS);this.extensionsWorkbenchService=e;this.extensionEnablementService=t;this.extensionService=n;this.tooltip=s("disableGloballyActionToolTip","Disable this extension"),this.update(),this._register(this.extensionService.onDidChangeExtensions(()=>this.update()))}static ID="extensions.disableGlobally";static LABEL=s("disableGloballyAction","Disable");update(){this.enabled=!1,this.extension&&this.extension.local&&!this.extension.isWorkspaceScoped&&this.extensionService.extensions.some(e=>T({id:e.identifier.value,uuid:e.uuid},this.extension.identifier))&&(this.enabled=this.extension.state===x.Installed&&(this.extension.enablementState===b.EnabledGlobally||this.extension.enablementState===b.EnabledWorkspace)&&this.extensionEnablementService.canChangeEnablement(this.extension.local))}async run(){if(this.extension)return this.extensionsWorkbenchService.setEnablement(this.extension,b.DisabledGlobally)}};J=u([i(0,v),i(1,L),i(2,P)],J);let Xe=class extends bt{constructor(a){super("extensions.enable",h.LABEL_ACTION_CLASS,[[a.createInstance(X),a.createInstance(K)]])}};Xe=u([i(0,y)],Xe);let je=class extends bt{constructor(a){super("extensions.disable",h.LABEL_ACTION_CLASS,[[a.createInstance(J),a.createInstance(j)]])}};je=u([i(0,y)],je);let re=class extends h{constructor(e,t,n,o,r,l){super("extensions.runtimeState","",re.DisabledClass,!1);this.hostService=e;this.extensionsWorkbenchService=t;this.updateService=n;this.extensionService=o;this.productService=r;this.telemetryService=l;this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this.update()}static EnabledClass=`${h.LABEL_ACTION_CLASS} reload`;static DisabledClass=`${this.EnabledClass} disabled`;updateWhenCounterExtensionChanges=!0;update(){if(this.enabled=!1,this.tooltip="",this.class=re.DisabledClass,!this.extension)return;const e=this.extension.state;if(e===x.Installing||e===x.Uninstalling||this.extension.local&&this.extension.local.manifest&&this.extension.local.manifest.contributes&&this.extension.local.manifest.contributes.localizations&&this.extension.local.manifest.contributes.localizations.length>0)return;const t=this.extension.runtimeState;t&&(this.enabled=!0,this.class=re.EnabledClass,this.tooltip=t.reason,this.label=t.action===B.ReloadWindow?s("reload window","Reload Window"):t.action===B.RestartExtensions?s("restart extensions","Restart Extensions"):t.action===B.QuitAndInstall?s("restart product","Restart to Update"):t.action===B.ApplyUpdate||t.action===B.DownloadUpdate?s("update product","Update {0}",this.productService.nameShort):"")}async run(){const e=this.extension?.runtimeState;if(e?.action){if(this.telemetryService.publicLog2("extensions:runtimestate:action",{action:e.action}),e?.action===B.ReloadWindow)return this.hostService.reload();if(e?.action===B.RestartExtensions)return this.extensionsWorkbenchService.updateRunningExtensions();if(e?.action===B.DownloadUpdate)return this.updateService.downloadUpdate();if(e?.action===B.ApplyUpdate)return this.updateService.applyUpdate();if(e?.action===B.QuitAndInstall)return this.updateService.quitAndInstall()}}};re=u([i(0,Tt),i(1,v),i(2,Wn),i(3,P),i(4,ut),i(5,Ot)],re);function U(c,a){return!!(a&&c.extensionData&&wt.equals(c.extensionData.extensionId,a.identifier.id))}function ft(c,a,e,t){const n=[];for(const o of c)U(o,e)&&!(t&&o===a)&&n.push({label:o.label,id:o.id});return t&&(n.push({type:"separator",label:s("current","current")}),n.push({label:a.label,id:a.id})),n}let A=class extends h{constructor(e,t,n,o){super(A.ID,A.TITLE.value,A.DisabledClass,!1);this.workbenchThemeService=t;this.quickInputService=n;this.extensionEnablementService=o;this._register(ke.any(e.onDidChangeExtensions,t.onDidColorThemeChange)(()=>this.update(),this)),this.update()}static ID="workbench.extensions.action.setColorTheme";static TITLE=be("workbench.extensions.action.setColorTheme","Set Color Theme");static EnabledClass=`${h.LABEL_ACTION_CLASS} theme`;static DisabledClass=`${this.EnabledClass} disabled`;update(){this.workbenchThemeService.getColorThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?A.EnabledClass:A.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===x.Installed&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>U(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const n=await this.workbenchThemeService.getColorThemes();if(!this.computeEnablement(n))return;const o=this.workbenchThemeService.getColorTheme(),r=new it(100),l=ft(n,o,this.extension,e),d=await this.quickInputService.pick(l,{placeHolder:s("select color theme","Select Color Theme"),onDidFocus:m=>r.trigger(()=>this.workbenchThemeService.setColorTheme(m.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setColorTheme(d?d.id:o.id,"auto")}};A=u([i(0,P),i(1,Te),i(2,Q),i(3,L)],A);let $=class extends h{constructor(e,t,n,o){super($.ID,$.TITLE.value,$.DisabledClass,!1);this.workbenchThemeService=t;this.quickInputService=n;this.extensionEnablementService=o;this._register(ke.any(e.onDidChangeExtensions,t.onDidFileIconThemeChange)(()=>this.update(),this)),this.update()}static ID="workbench.extensions.action.setFileIconTheme";static TITLE=be("workbench.extensions.action.setFileIconTheme","Set File Icon Theme");static EnabledClass=`${h.LABEL_ACTION_CLASS} theme`;static DisabledClass=`${this.EnabledClass} disabled`;update(){this.workbenchThemeService.getFileIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?$.EnabledClass:$.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===x.Installed&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>U(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const n=await this.workbenchThemeService.getFileIconThemes();if(!this.computeEnablement(n))return;const o=this.workbenchThemeService.getFileIconTheme(),r=new it(100),l=ft(n,o,this.extension,e),d=await this.quickInputService.pick(l,{placeHolder:s("select file icon theme","Select File Icon Theme"),onDidFocus:m=>r.trigger(()=>this.workbenchThemeService.setFileIconTheme(m.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setFileIconTheme(d?d.id:o.id,"auto")}};$=u([i(0,P),i(1,Te),i(2,Q),i(3,L)],$);let R=class extends h{constructor(e,t,n,o){super(R.ID,R.TITLE.value,R.DisabledClass,!1);this.workbenchThemeService=t;this.quickInputService=n;this.extensionEnablementService=o;this._register(ke.any(e.onDidChangeExtensions,t.onDidProductIconThemeChange)(()=>this.update(),this)),this.update()}static ID="workbench.extensions.action.setProductIconTheme";static TITLE=be("workbench.extensions.action.setProductIconTheme","Set Product Icon Theme");static EnabledClass=`${h.LABEL_ACTION_CLASS} theme`;static DisabledClass=`${this.EnabledClass} disabled`;update(){this.workbenchThemeService.getProductIconThemes().then(e=>{this.enabled=this.computeEnablement(e),this.class=this.enabled?R.EnabledClass:R.DisabledClass})}computeEnablement(e){return!!this.extension&&this.extension.state===x.Installed&&this.extensionEnablementService.isEnabledEnablementState(this.extension.enablementState)&&e.some(t=>U(t,this.extension))}async run({showCurrentTheme:e,ignoreFocusLost:t}={showCurrentTheme:!1,ignoreFocusLost:!1}){const n=await this.workbenchThemeService.getProductIconThemes();if(!this.computeEnablement(n))return;const o=this.workbenchThemeService.getProductIconTheme(),r=new it(100),l=ft(n,o,this.extension,e),d=await this.quickInputService.pick(l,{placeHolder:s("select product icon theme","Select Product Icon Theme"),onDidFocus:m=>r.trigger(()=>this.workbenchThemeService.setProductIconTheme(m.id,void 0)),ignoreFocusLost:t});return this.workbenchThemeService.setProductIconTheme(d?d.id:o.id,"auto")}};R=u([i(0,P),i(1,Te),i(2,Q),i(3,L)],R);let F=class extends h{constructor(e){super(F.ID,F.TITLE.value,F.DisabledClass,!1);this.extensionsWorkbenchService=e;this.update()}static ID="workbench.extensions.action.setDisplayLanguage";static TITLE=be("workbench.extensions.action.setDisplayLanguage","Set Display Language");static EnabledClass=`${h.LABEL_ACTION_CLASS} language`;static DisabledClass=`${this.EnabledClass} disabled`;update(){this.enabled=!1,this.class=F.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&mt===St(this.extension.gallery)||(this.enabled=!0,this.class=F.EnabledClass))}async run(){return this.extension&&this.extensionsWorkbenchService.setLanguage(this.extension)}};F=u([i(0,v)],F);let G=class extends h{constructor(e,t){super(G.ID,G.TITLE.value,G.DisabledClass,!1);this.extensionsWorkbenchService=e;this.localeService=t;this.update()}static ID="workbench.extensions.action.clearLanguage";static TITLE=be("workbench.extensions.action.clearLanguage","Clear Display Language");static EnabledClass=`${h.LABEL_ACTION_CLASS} language`;static DisabledClass=`${this.EnabledClass} disabled`;update(){this.enabled=!1,this.class=G.DisabledClass,this.extension&&this.extensionsWorkbenchService.canSetLanguage(this.extension)&&(this.extension.gallery&&mt!==St(this.extension.gallery)||(this.enabled=!0,this.class=G.EnabledClass))}async run(){return this.extension&&this.localeService.clearLocalePreference()}};G=u([i(0,v),i(1,kn)],G);let ue=class extends w{constructor(e,t){super(ue.ID,ue.LABEL,void 0,!1);this.extensionWorkbenchService=t;this.extensionId=e}static ID="workbench.extensions.action.showRecommendedExtension";static LABEL=s("showRecommendedExtension","Show Recommended Extension");extensionId;async run(){await this.extensionWorkbenchService.openSearch(`@id:${this.extensionId}`);const[e]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},ce.None);return e?this.extensionWorkbenchService.open(e):null}};ue=u([i(1,v)],ue);let pe=class extends w{constructor(e,t,n){super(pe.ID,pe.LABEL,void 0,!1);this.instantiationService=t;this.extensionWorkbenchService=n;this.extensionId=e}static ID="workbench.extensions.action.installRecommendedExtension";static LABEL=s("installRecommendedExtension","Install Recommended Extension");extensionId;async run(){await this.extensionWorkbenchService.openSearch(`@id:${this.extensionId}`);const[e]=await this.extensionWorkbenchService.getExtensions([{id:this.extensionId}],{source:"install-recommendation"},ce.None);if(e){await this.extensionWorkbenchService.open(e);try{await this.extensionWorkbenchService.install(e)}catch(t){this.instantiationService.createInstance(ne,e,void 0,e.latestVersion,Ce.Install,t).run()}}}};pe=u([i(1,y),i(2,v)],pe);let xe=class extends w{constructor(e,t){super(xe.ID,"Ignore Recommendation");this.extension=e;this.extensionRecommendationsManagementService=t;this.class=xe.Class,this.tooltip=s("ignoreExtensionRecommendation","Do not recommend this extension again"),this.enabled=!0}static ID="extensions.ignore";static Class=`${h.LABEL_ACTION_CLASS} ignore`;run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!0),Promise.resolve()}};xe=u([i(1,ot)],xe);let ve=class extends w{constructor(e,t){super(ve.ID,"Undo");this.extension=e;this.extensionRecommendationsManagementService=t;this.class=ve.Class,this.tooltip=s("undo","Undo"),this.enabled=!0}static ID="extensions.ignore";static Class=`${h.LABEL_ACTION_CLASS} undo-ignore`;run(){return this.extensionRecommendationsManagementService.toggleGlobalIgnoredRecommendation(this.extension.identifier.id,!1),Promise.resolve()}};ve=u([i(1,ot)],ve);let Ee=class extends w{constructor(e,t,n,o,r,l,d,m){super(e,t);this.contextService=n;this.fileService=o;this.textFileService=r;this.editorService=l;this.jsonEditingService=d;this.textModelResolverService=m}openExtensionsFile(e){return this.getOrCreateExtensionsFile(e).then(({created:t,content:n})=>this.getSelectionPosition(n,e,["recommendations"]).then(o=>this.editorService.openEditor({resource:e,options:{pinned:t,selection:o}})),t=>Promise.reject(new Error(s("OpenExtensionsFile.failed","Unable to create 'extensions.json' file inside the '.vscode' folder ({0}).",t))))}openWorkspaceConfigurationFile(e){return this.getOrUpdateWorkspaceConfigurationFile(e).then(t=>this.getSelectionPosition(t.value.toString(),t.resource,["extensions","recommendations"])).then(t=>this.editorService.openEditor({resource:e,options:{selection:t,forceReload:!0}}))}getOrUpdateWorkspaceConfigurationFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>{const n=rt.parse(t.value.toString()).extensions;return!n||!n.recommendations?this.jsonEditingService.write(e,[{path:["extensions"],value:{recommendations:[]}}],!0).then(()=>this.fileService.readFile(e)):t})}getSelectionPosition(e,t,n){const o=rt.parseTree(e),r=rt.findNodeAtLocation(o,n);if(r&&r.parent&&r.parent.children){const l=r.parent.children[1],d=l.children&&l.children.length?l.children[l.children.length-1]:null,m=d?d.offset+d.length:l.offset+1;return Promise.resolve(this.textModelResolverService.createModelReference(t)).then(p=>{const g=p.object.textEditorModel.getPositionAt(m);return p.dispose(),{startLineNumber:g.lineNumber,startColumn:g.column,endLineNumber:g.lineNumber,endColumn:g.column}})}return Promise.resolve(void 0)}getOrCreateExtensionsFile(e){return Promise.resolve(this.fileService.readFile(e)).then(t=>({created:!1,extensionsFileResource:e,content:t.value.toString()}),t=>this.textFileService.write(e,yt).then(()=>({created:!0,extensionsFileResource:e,content:yt})))}};Ee=u([i(2,ge),i(3,we),i(4,ht),i(5,dt),i(6,lt),i(7,ct)],Ee);let Je=class extends Ee{static ID="workbench.extensions.action.configureWorkspaceRecommendedExtensions";static LABEL=s("configureWorkspaceRecommendedExtensions","Configure Recommended Extensions (Workspace)");constructor(a,e,t,n,o,r,l,d){super(a,e,o,t,n,r,l,d),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.update(),this)),this.update()}update(){this.enabled=this.contextService.getWorkbenchState()!==Oe.EMPTY}run(){switch(this.contextService.getWorkbenchState()){case Oe.FOLDER:return this.openExtensionsFile(this.contextService.getWorkspace().folders[0].toResource(At));case Oe.WORKSPACE:return this.openWorkspaceConfigurationFile(this.contextService.getWorkspace().configuration)}return Promise.resolve()}};Je=u([i(2,we),i(3,ht),i(4,ge),i(5,dt),i(6,lt),i(7,ct)],Je);let Ye=class extends Ee{constructor(e,t,n,o,r,l,d,m,p){super(e,t,r,n,o,l,d,m);this.commandService=p}static ID="workbench.extensions.action.configureWorkspaceFolderRecommendedExtensions";static LABEL=s("configureWorkspaceFolderRecommendedExtensions","Configure Recommended Extensions (Workspace Folder)");run(){const t=this.contextService.getWorkspace().folders.length===1?Promise.resolve(this.contextService.getWorkspace().folders[0]):this.commandService.executeCommand(un);return Promise.resolve(t).then(n=>n?this.openExtensionsFile(n.toResource(At)):null)}};Ye=u([i(2,we),i(3,ht),i(4,ge),i(5,dt),i(6,lt),i(7,ct),i(8,at)],Ye);let oe=class extends w{constructor(e,t,n){super("extensions.action.statusLabel","",oe.DISABLED_CLASS,!1);this.extensionService=e;this.extensionManagementServerService=t;this.extensionEnablementService=n}static ENABLED_CLASS=`${h.TEXT_ACTION_CLASS} extension-status-label`;static DISABLED_CLASS=`${this.ENABLED_CLASS} hide`;initialStatus=null;status=null;version=null;enablementState=null;_extension=null;get extension(){return this._extension}set extension(e){this._extension&&e&&T(this._extension.identifier,e.identifier)||(this.initialStatus=null,this.status=null,this.enablementState=null),this._extension=e,this.update()}update(){const e=this.computeLabel();this.label=e||"",this.class=e?oe.ENABLED_CLASS:oe.DISABLED_CLASS}computeLabel(){if(!this.extension)return null;const e=this.status,t=this.version,n=this.enablementState;this.status=this.extension.state,this.version=this.extension.version,this.initialStatus===null&&(this.initialStatus=this.status),this.enablementState=this.extension.enablementState;const o=()=>{const l=this.extensionService.extensions.filter(d=>T({id:d.identifier.value,uuid:d.uuid},this.extension.identifier))[0];return this.extension.local?l&&this.extension.version===l.version?!0:this.extensionService.canAddExtension(Ue(this.extension.local)):!1},r=()=>this.extension.local?this.extensionService.extensions.every(l=>!(T({id:l.identifier.value,uuid:l.uuid},this.extension.identifier)&&this.extension.server===this.extensionManagementServerService.getExtensionManagementServer(Wt(l))))?!0:this.extensionService.canRemoveExtension(Ue(this.extension.local)):!1;if(e!==null){if(e===x.Installing&&this.status===x.Installed)return this.initialStatus===x.Uninstalled&&o()?s("installed","Installed"):this.initialStatus===x.Installed&&this.version!==t&&o()?s("updated","Updated"):null;if(e===x.Uninstalling&&this.status===x.Uninstalled)return this.initialStatus=this.status,r()?s("uninstalled","Uninstalled"):null}if(n!==null){const l=this.extensionEnablementService.isEnabledEnablementState(n),d=this.extensionEnablementService.isEnabledEnablementState(this.enablementState);if(!l&&d)return o()?s("enabled","Enabled"):null;if(l&&!d)return r()?s("disabled","Disabled"):null}return null}run(){return Promise.resolve()}};oe=u([i(0,P),i(1,O),i(2,L)],oe);let ae=class extends he{constructor(e,t,n,o){super("extensions.sync","",ae.SYNC_CLASS,!1,o);this.configurationService=e;this.extensionsWorkbenchService=t;this.userDataSyncEnablementService=n;this._register(ke.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration("settingsSync.ignoredExtensions"))(()=>this.update())),this._register(n.onDidChangeEnablement(()=>this.update())),this.update()}static IGNORED_SYNC_CLASS=`${h.ICON_ACTION_CLASS} extension-sync ${I.asClassName(Sn)}`;static SYNC_CLASS=`${this.ICON_ACTION_CLASS} extension-sync ${I.asClassName(mn)}`;update(){if(this.enabled=!!this.extension&&this.userDataSyncEnablementService.isEnabled()&&this.extension.state===x.Installed,this.extension){const e=this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension);this.class=e?ae.IGNORED_SYNC_CLASS:ae.SYNC_CLASS,this.tooltip=e?s("ignored","This extension is ignored during sync"):s("synced","This extension is synced")}}async run(){return super.run({actionGroups:[[new w("extensions.syncignore",this.extensionsWorkbenchService.isExtensionIgnoredToSync(this.extension)?s("sync","Sync this extension"):s("do not sync","Do not sync this extension"),void 0,!0,()=>this.extensionsWorkbenchService.toggleExtensionIgnoredToSync(this.extension))]],disposeActionsOnHide:!0})}};ae=u([i(0,Pt),i(1,v),i(2,vn),i(3,y)],ae);let D=class extends h{constructor(e,t,n,o,r,l,d,m,p,g,tt,nt){super("extensions.status","",`${D.CLASS} hide`,!1);this.extensionManagementServerService=e;this.labelService=t;this.commandService=n;this.workspaceTrustEnablementService=o;this.workspaceTrustService=r;this.extensionsWorkbenchService=l;this.extensionService=d;this.extensionManifestPropertiesService=m;this.contextService=p;this.productService=g;this.workbenchExtensionEnablementService=tt;this.extensionFeaturesManagementService=nt;this._register(this.labelService.onDidChangeFormatters(()=>this.update(),this)),this._register(this.extensionService.onDidChangeExtensions(()=>this.update())),this._register(this.extensionFeaturesManagementService.onDidChangeAccessData(()=>this.update())),this.update()}static CLASS=`${h.ICON_ACTION_CLASS} extension-status`;updateWhenCounterExtensionChanges=!0;_status=[];get status(){return this._status}_onDidChangeStatus=this._register(new Et);onDidChangeStatus=this._onDidChangeStatus.event;updateThrottler=new st;update(){this.updateThrottler.queue(()=>this.computeAndUpdateStatus())}async computeAndUpdateStatus(){if(this.updateStatus(void 0,!0),this.enabled=!1,!this.extension)return;if(this.extension.isMalicious){this.updateStatus({icon:f,message:new S(s("malicious tooltip","This extension was reported to be problematic."))},!0);return}if(this.extension.deprecationInfo){if(this.extension.deprecationInfo.extension){const r=`[${this.extension.deprecationInfo.extension.displayName}](${H.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.extension.id]))}`)})`;this.updateStatus({icon:f,message:new S(s("deprecated with alternate extension tooltip","This extension is deprecated. Use the {0} extension instead.",r))},!0)}else if(this.extension.deprecationInfo.settings){const r=`[${s("settings","settings")}](${H.parse(`command:workbench.action.openSettings?${encodeURIComponent(JSON.stringify([this.extension.deprecationInfo.settings.map(l=>`@id:${l}`).join(" ")]))}`)})`;this.updateStatus({icon:f,message:new S(s("deprecated with alternate settings tooltip","This extension is deprecated as this functionality is now built-in to VS Code. Configure these {0} to use this functionality.",r))},!0)}else{const r=new S(s("deprecated tooltip","This extension is deprecated as it is no longer being maintained."));this.extension.deprecationInfo.additionalInfo&&r.appendMarkdown(` ${this.extension.deprecationInfo.additionalInfo}`),this.updateStatus({icon:f,message:r},!0)}return}if(this.extensionsWorkbenchService.canSetLanguage(this.extension))return;if(this.extension.outdated&&this.extensionsWorkbenchService.isAutoUpdateEnabledFor(this.extension)){const r=await this.extensionsWorkbenchService.shouldRequireConsentToUpdate(this.extension);if(r){const l=new S;l.appendMarkdown(`${r} `),l.appendMarkdown(s("auto update message","Please [review the extension]({0}) and update it manually.",this.extension.hasChangelog()?H.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.identifier.id,Ae.Changelog]))}`).toString():this.extension.repository?this.extension.repository:H.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.identifier.id]))}`).toString())),this.updateStatus({icon:f,message:l},!0)}}if(this.extension.gallery&&this.extension.state===x.Uninstalled&&!await this.extensionsWorkbenchService.canInstall(this.extension)){if(this.extensionManagementServerService.localExtensionManagementServer||this.extensionManagementServerService.remoteExtensionManagementServer){const r=await(this.extensionManagementServerService.localExtensionManagementServer?this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.getTargetPlatform():this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform()),l=new S(`${s("incompatible platform","The '{0}' extension is not available in {1} for {2}.",this.extension.displayName||this.extension.identifier.id,this.productService.nameLong,zt(r))} [${s("learn more","Learn More")}](https://aka.ms/vscode-platform-specific-extensions)`);this.updateStatus({icon:f,message:l},!0);return}if(this.extensionManagementServerService.webExtensionManagementServer){const r=s("VS Code for Web","{0} for the Web",this.productService.nameLong),l=new S(`${s("not web tooltip","The '{0}' extension is not available in {1}.",this.extension.displayName||this.extension.identifier.id,r)} [${s("learn why","Learn Why")}](https://aka.ms/vscode-web-extensions-guide)`);this.updateStatus({icon:f,message:l},!0);return}}if(!this.extension.local||!this.extension.server||this.extension.state!==x.Installed)return;if(this.extension.enablementState===b.DisabledByEnvironment){this.updateStatus({message:new S(s("disabled by environment","This extension is disabled by the environment."))},!0);return}if(this.extension.enablementState===b.EnabledByEnvironment){this.updateStatus({message:new S(s("enabled by environment","This extension is enabled because it is required in the current environment."))},!0);return}if(this.extension.enablementState===b.DisabledByVirtualWorkspace){const r=Re(this.extension.local.manifest.capabilities?.virtualWorkspaces);this.updateStatus({icon:M,message:new S(r?He(r):s("disabled because of virtual workspace","This extension has been disabled because it does not support virtual workspaces."))},!0);return}if(In(this.contextService.getWorkspace())){const r=this.extensionManifestPropertiesService.getExtensionVirtualWorkspaceSupportType(this.extension.local.manifest),l=Re(this.extension.local.manifest.capabilities?.virtualWorkspaces);if(r==="limited"||l){this.updateStatus({icon:f,message:new S(l?He(l):s("extension limited because of virtual workspace","This extension has limited features because the current workspace is virtual."))},!0);return}}if(!this.workspaceTrustService.isWorkspaceTrusted()&&(this.extension.enablementState===b.DisabledByTrustRequirement||this.extension.enablementState===b.DisabledByExtensionDependency&&this.workbenchExtensionEnablementService.getDependenciesEnablementStates(this.extension.local).every(([,r])=>this.workbenchExtensionEnablementService.isEnabledEnablementState(r)||r===b.DisabledByTrustRequirement))){this.enabled=!0;const r=Re(this.extension.local.manifest.capabilities?.untrustedWorkspaces);this.updateStatus({icon:de,message:new S(r?He(r):s("extension disabled because of trust requirement","This extension has been disabled because the current workspace is not trusted."))},!0);return}if(this.workspaceTrustEnablementService.isWorkspaceTrustEnabled()&&!this.workspaceTrustService.isWorkspaceTrusted()){const r=this.extensionManifestPropertiesService.getExtensionUntrustedWorkspaceSupportType(this.extension.local.manifest),l=Re(this.extension.local.manifest.capabilities?.untrustedWorkspaces);if(r==="limited"||l){this.enabled=!0,this.updateStatus({icon:de,message:new S(l?He(l):s("extension limited because of trust requirement","This extension has limited features because the current workspace is not trusted."))},!0);return}}if(this.extension.enablementState===b.DisabledByExtensionKind&&!this.extensionsWorkbenchService.installed.some(r=>T(r.identifier,this.extension.identifier)&&r.server!==this.extension.server)){let r;this.extensionManagementServerService.localExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.extensionManagementServerService.remoteExtensionManagementServer&&(r=new S(`${s("Install in remote server to enable","This extension is disabled in this workspace because it is defined to run in the Remote Extension Host. Please install the extension in '{0}' to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`)):this.extensionManagementServerService.remoteExtensionManagementServer===this.extension.server?this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&(this.extensionManagementServerService.localExtensionManagementServer?r=new S(`${s("Install in local server to enable","This extension is disabled in this workspace because it is defined to run in the Local Extension Host. Please install the extension locally to enable.",this.extensionManagementServerService.remoteExtensionManagementServer.label)} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`):vt&&(r=new S(`${s("Defined to run in desktop","This extension is disabled because it is defined to run only in {0} for the Desktop.",this.productService.nameLong)} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`))):this.extensionManagementServerService.webExtensionManagementServer===this.extension.server&&(r=new S(`${s("Cannot be enabled","This extension is disabled because it is not supported in {0} for the Web.",this.productService.nameLong)} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`)),r&&this.updateStatus({icon:f,message:r},!0);return}const e=new wt(this.extension.identifier.id),t=Tn.as(wn.ExtensionFeaturesRegistry).getExtensionFeatures();for(const r of t){const l=this.extensionFeaturesManagementService.getAccessData(e,r.id)?.current?.status,d=`[${s("manage access","Manage Access")}](${H.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.identifier.id,Ae.Features,!1,r.id]))}`)})`;if(l?.severity===q.Error){this.updateStatus({icon:te,message:new S().appendText(l.message).appendMarkdown(` ${d}`)},!0);return}if(l?.severity===q.Warning){this.updateStatus({icon:f,message:new S().appendText(l.message).appendMarkdown(` ${d}`)},!0);return}}if(this.extensionManagementServerService.remoteExtensionManagementServer){if(Lt(this.extension.local.manifest)){if(!this.extensionsWorkbenchService.installed.some(d=>T(d.identifier,this.extension.identifier)&&d.server!==this.extension.server)){const d=this.extension.server===this.extensionManagementServerService.localExtensionManagementServer?new S(s("Install language pack also in remote server","Install the language pack extension on '{0}' to enable it there also.",this.extensionManagementServerService.remoteExtensionManagementServer.label)):new S(s("Install language pack also locally","Install the language pack extension locally to enable it there also."));this.updateStatus({icon:M,message:d},!0)}return}const r=this.extensionService.extensions.filter(d=>T({id:d.identifier.value,uuid:d.uuid},this.extension.identifier))[0],l=r?this.extensionManagementServerService.getExtensionManagementServer(Wt(r)):null;if(this.extension.server===this.extensionManagementServerService.localExtensionManagementServer&&l===this.extensionManagementServerService.remoteExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(this.extension.local.manifest)&&this.updateStatus({icon:M,message:new S(`${s("enabled remotely","This extension is enabled in the Remote Extension Host because it prefers to run there.")} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&l===this.extensionManagementServerService.localExtensionManagementServer){this.extensionManifestPropertiesService.prefersExecuteOnUI(this.extension.local.manifest)&&this.updateStatus({icon:M,message:new S(`${s("enabled locally","This extension is enabled in the Local Extension Host because it prefers to run there.")} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`)},!0);return}if(this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer&&l===this.extensionManagementServerService.webExtensionManagementServer){this.extensionManifestPropertiesService.canExecuteOnWeb(this.extension.local.manifest)&&this.updateStatus({icon:M,message:new S(`${s("enabled in web worker","This extension is enabled in the Web Worker Extension Host because it prefers to run there.")} [${s("learn more","Learn More")}](https://code.visualstudio.com/api/advanced-topics/remote-extensions#architecture-and-extension-kinds)`)},!0);return}}if(this.extension.enablementState===b.DisabledByExtensionDependency){this.updateStatus({icon:f,message:new S(s("extension disabled because of dependency","This extension depends on an extension that is disabled.")).appendMarkdown(`&nbsp;[${s("dependencies","Show Dependencies")}](${H.parse(`command:extension.open?${encodeURIComponent(JSON.stringify([this.extension.identifier.id,Ae.Dependencies]))}`)})`)},!0);return}if(!this.extension.local.isValid){const r=this.extension.local.validations.filter(([l])=>l===q.Error).map(([,l])=>l);this.updateStatus({icon:f,message:new S(r.join(" ").trim())},!0);return}const n=this.workbenchExtensionEnablementService.isEnabled(this.extension.local),o=this.extensionService.extensions.some(r=>T({id:r.identifier.value,uuid:r.uuid},this.extension.identifier));if(!this.extension.isWorkspaceScoped&&n&&o){if(this.extension.enablementState===b.EnabledWorkspace){this.updateStatus({message:new S(s("workspace enabled","This extension is enabled for this workspace by the user."))},!0);return}if(this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManagementServerService.remoteExtensionManagementServer&&this.extension.server===this.extensionManagementServerService.remoteExtensionManagementServer){this.updateStatus({message:new S(s("extension enabled on remote","Extension is enabled on '{0}'",this.extension.server.label))},!0);return}if(this.extension.enablementState===b.EnabledGlobally)return}if(!n&&!o){if(this.extension.enablementState===b.DisabledGlobally){this.updateStatus({message:new S(s("globally disabled","This extension is disabled globally by the user."))},!0);return}if(this.extension.enablementState===b.DisabledWorkspace){this.updateStatus({message:new S(s("workspace disabled","This extension is disabled for this workspace by the user."))},!0);return}}}updateStatus(e,t){if(e){if(this._status.some(n=>n.message.value===e.message.value&&n.icon?.id===e.icon?.id))return}else{if(this._status.length===0)return;this._status=[]}e&&(this._status.push(e),this._status.sort((n,o)=>o.icon===de?-1:n.icon===de?1:o.icon===te?-1:n.icon===te?1:o.icon===f?-1:n.icon===f?1:o.icon===M?-1:n.icon===M?1:0)),t&&(e?.icon===te?this.class=`${D.CLASS} extension-status-error ${I.asClassName(te)}`:e?.icon===f?this.class=`${D.CLASS} extension-status-warning ${I.asClassName(f)}`:e?.icon===M?this.class=`${D.CLASS} extension-status-info ${I.asClassName(M)}`:e?.icon===de?this.class=`${D.CLASS} ${I.asClassName(de)}`:this.class=`${D.CLASS} hide`),this._onDidChangeStatus.fire()}async run(){if(this._status[0]?.icon===de)return this.commandService.executeCommand("workbench.trust.manage")}};D=u([i(0,O),i(1,Nt),i(2,at),i(3,fn),i(4,gn),i(5,v),i(6,P),i(7,Ie),i(8,ge),i(9,ut),i(10,L),i(11,Ln)],D);let me=class extends w{constructor(e=me.ID,t=me.LABEL,n,o,r,l,d,m){super(e,t);this.extensionsWorkbenchService=n;this.extensionManagementServerService=o;this.quickInputService=r;this.notificationService=l;this.hostService=d;this.extensionService=m}static ID="workbench.extensions.action.reinstall";static LABEL=s("reinstall","Reinstall Extension...");get enabled(){return this.extensionsWorkbenchService.local.filter(e=>!e.isBuiltin&&e.local).length>0}run(){return this.quickInputService.pick(this.getEntries(),{placeHolder:s("selectExtensionToReinstall","Select Extension to Reinstall")}).then(e=>e&&this.reinstallExtension(e.extension))}getEntries(){return this.extensionsWorkbenchService.queryLocal().then(e=>e.filter(n=>!n.isBuiltin&&n.server!==this.extensionManagementServerService.webExtensionManagementServer).map(n=>({id:n.identifier.id,label:n.displayName,description:n.identifier.id,extension:n})))}reinstallExtension(e){return this.extensionsWorkbenchService.openSearch("@installed ").then(()=>this.extensionsWorkbenchService.reinstall(e).then(t=>{const n=!(t.local&&this.extensionService.canAddExtension(Ue(t.local))),o=n?s("ReinstallAction.successReload","Please reload Visual Studio Code to complete reinstalling the extension {0}.",t.identifier.id):s("ReinstallAction.success","Reinstalling the extension {0} is completed.",t.identifier.id),r=n?[{label:s("InstallVSIXAction.reloadNow","Reload Now"),run:()=>this.hostService.reload()}]:[];this.notificationService.prompt(q.Info,o,r,{sticky:!0})},t=>this.notificationService.error(t)))}};me=u([i(2,v),i(3,O),i(4,Q),i(5,Le),i(6,Tt),i(7,P)],me);let Se=class extends w{constructor(e=Se.ID,t=Se.LABEL,n,o,r,l){super(e,t);this.extensionsWorkbenchService=n;this.quickInputService=o;this.instantiationService=r;this.extensionEnablementService=l}static ID="workbench.extensions.action.install.specificVersion";static LABEL=s("install previous version","Install Specific Version of Extension...");get enabled(){return this.extensionsWorkbenchService.local.some(e=>this.isEnabled(e))}async run(){const e=await this.quickInputService.pick(this.getExtensionEntries(),{placeHolder:s("selectExtension","Select Extension"),matchOnDetail:!0});e&&e.extension&&(await this.instantiationService.createInstance(V,e.extension,!0).run(),await this.extensionsWorkbenchService.openSearch(e.extension.identifier.id))}isEnabled(e){return this.instantiationService.createInstance(V,e,!0).enabled&&!!e.local&&this.extensionEnablementService.isEnabled(e.local)}async getExtensionEntries(){const e=await this.extensionsWorkbenchService.queryLocal(),t=[];for(const n of e)this.isEnabled(n)&&t.push({id:n.identifier.id,label:n.displayName||n.identifier.id,description:n.identifier.id,extension:n});return t.sort((n,o)=>n.extension.displayName.localeCompare(o.extension.displayName))}};Se=u([i(2,v),i(3,Q),i(4,y),i(5,L)],Se);let ye=class extends w{constructor(e,t,n,o,r){super(e);this.extensionsWorkbenchService=t;this.quickInputService=n;this.notificationService=o;this.progressService=r;this.update(),this.extensionsWorkbenchService.queryLocal().then(()=>this.updateExtensions()),this._register(this.extensionsWorkbenchService.onChange(()=>{this.extensions&&this.updateExtensions()}))}extensions=void 0;updateExtensions(){this.extensions=this.extensionsWorkbenchService.local,this.update()}update(){this.enabled=!!this.extensions&&this.getExtensionsToInstall(this.extensions).length>0,this.tooltip=this.label}async run(){return this.selectAndInstallExtensions()}async queryExtensionsToInstall(){const e=await this.extensionsWorkbenchService.queryLocal();return this.getExtensionsToInstall(e)}async selectAndInstallExtensions(){const e=this.quickInputService.createQuickPick();e.busy=!0;const t=e.onDidAccept(()=>{t.dispose(),e.hide(),e.dispose(),this.onDidAccept(e.selectedItems)});e.show();const n=await this.queryExtensionsToInstall();e.busy=!1,n.length?(e.title=this.getQuickPickTitle(),e.placeholder=s("select extensions to install","Select extensions to install"),e.canSelectMany=!0,n.sort((o,r)=>o.displayName.localeCompare(r.displayName)),e.items=n.map(o=>({extension:o,label:o.displayName,description:o.version}))):(e.hide(),e.dispose(),this.notificationService.notify({severity:q.Info,message:s("no local extensions","There are no extensions to install.")}))}async onDidAccept(e){if(e.length){const t=e.filter(n=>!!n.extension).map(n=>n.extension);t.length&&(await this.progressService.withProgress({location:pn.Notification,title:s("installing extensions","Installing Extensions...")},()=>this.installExtensions(t)),this.notificationService.info(s("finished installing","Successfully installed extensions.")))}}};ye=u([i(1,v),i(2,Q),i(3,Le),i(4,pt)],ye);let ze=class extends ye{constructor(e,t,n,o,r,l,d,m,p){super("workbench.extensions.actions.installLocalExtensionsInRemote",e,t,o,n);this.extensionManagementServerService=r;this.extensionGalleryService=l;this.instantiationService=d;this.fileService=m;this.logService=p}get label(){return this.extensionManagementServerService&&this.extensionManagementServerService.remoteExtensionManagementServer?s("select and install local extensions","Install Local Extensions in '{0}'...",this.extensionManagementServerService.remoteExtensionManagementServer.label):""}getQuickPickTitle(){return s("install local extensions title","Install Local Extensions in '{0}'",this.extensionManagementServerService.remoteExtensionManagementServer.label)}getExtensionsToInstall(e){return e.filter(t=>{const n=this.instantiationService.createInstance(Me,!0);return n.extension=t,n.enabled})}async installExtensions(e){const t=[],n=[],o=await this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.getTargetPlatform();await fe.settled(e.map(async r=>{if(this.extensionGalleryService.isEnabled()){const d=(await this.extensionGalleryService.getExtensions([{...r.identifier,preRelease:!!r.local?.preRelease}],{targetPlatform:o,compatible:!0},ce.None))[0];if(d){t.push(d);return}}const l=await this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.zip(r.local);n.push(l)})),await fe.settled(t.map(r=>this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.installFromGallery(r)));try{await fe.settled(n.map(r=>this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.install(r)))}finally{try{await Promise.allSettled(n.map(r=>this.fileService.del(r)))}catch(r){this.logService.error(r)}}}};ze=u([i(0,v),i(1,Q),i(2,pt),i(3,Le),i(4,O),i(5,$e),i(6,y),i(7,we),i(8,xt)],ze);let Ze=class extends ye{constructor(e,t,n,o,r,l,d,m,p){super(e,t,n,r,o);this.extensionManagementServerService=l;this.extensionGalleryService=d;this.fileService=m;this.logService=p}get label(){return s("select and install remote extensions","Install Remote Extensions Locally...")}getQuickPickTitle(){return s("install remote extensions","Install Remote Extensions Locally")}getExtensionsToInstall(e){return e.filter(t=>t.type===Ct.User&&t.server!==this.extensionManagementServerService.localExtensionManagementServer&&!this.extensionsWorkbenchService.installed.some(n=>n.server===this.extensionManagementServerService.localExtensionManagementServer&&T(n.identifier,t.identifier)))}async installExtensions(e){const t=[],n=[],o=await this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.getTargetPlatform();await fe.settled(e.map(async r=>{if(this.extensionGalleryService.isEnabled()){const d=(await this.extensionGalleryService.getExtensions([{...r.identifier,preRelease:!!r.local?.preRelease}],{targetPlatform:o,compatible:!0},ce.None))[0];if(d){t.push(d);return}}const l=await this.extensionManagementServerService.remoteExtensionManagementServer.extensionManagementService.zip(r.local);n.push(l)})),await fe.settled(t.map(r=>this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.installFromGallery(r)));try{await fe.settled(n.map(r=>this.extensionManagementServerService.localExtensionManagementServer.extensionManagementService.install(r)))}finally{try{await Promise.allSettled(n.map(r=>this.fileService.del(r)))}catch(r){this.logService.error(r)}}}};Ze=u([i(1,v),i(2,Q),i(3,pt),i(4,Le),i(5,O),i(6,$e),i(7,we),i(8,xt)],Ze),Mt.registerCommand("workbench.extensions.action.showExtensionsForLanguage",function(c,a){return c.get(v).openSearch(`ext:${a.replace(/^\./,"")}`)});const Dn="workbench.extensions.action.showExtensionsWithIds";Mt.registerCommand(Dn,function(c,a){return c.get(v).openSearch(a.map(t=>`@id:${t}`).join(" "))}),le("extensionButton.background",{dark:Ve,light:Ve,hcDark:null,hcLight:null},s("extensionButtonBackground","Button background color for extension actions.")),le("extensionButton.foreground",{dark:_e,light:_e,hcDark:null,hcLight:null},s("extensionButtonForeground","Button foreground color for extension actions.")),le("extensionButton.hoverBackground",{dark:Fe,light:Fe,hcDark:null,hcLight:null},s("extensionButtonHoverBackground","Button background hover color for extension actions.")),le("extensionButton.separator",ln,s("extensionButtonSeparator","Button separator color for extension actions"));const Ts=le("extensionButton.prominentBackground",{dark:Ve,light:Ve,hcDark:null,hcLight:null},s("extensionButtonProminentBackground","Button background color for extension actions that stand out (e.g. install button)."));le("extensionButton.prominentForeground",{dark:_e,light:_e,hcDark:null,hcLight:null},s("extensionButtonProminentForeground","Button foreground color for extension actions that stand out (e.g. install button).")),le("extensionButton.prominentHoverBackground",{dark:Fe,light:Fe,hcDark:null,hcLight:null},s("extensionButtonProminentHoverBackground","Button background hover color for extension actions that stand out (e.g. install button).")),sn((c,a)=>{const e=c.getColor(an);e&&(a.addRule(`.extension-editor .header .actions-status-container > .status ${I.asCSSSelector(te)} { color: ${e}; }`),a.addRule(`.extension-editor .body .subcontent .runtime-status ${I.asCSSSelector(te)} { color: ${e}; }`),a.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${I.asCSSSelector(te)} { color: ${e}; }`));const t=c.getColor(rn);t&&(a.addRule(`.extension-editor .header .actions-status-container > .status ${I.asCSSSelector(f)} { color: ${t}; }`),a.addRule(`.extension-editor .body .subcontent .runtime-status ${I.asCSSSelector(f)} { color: ${t}; }`),a.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${I.asCSSSelector(f)} { color: ${t}; }`));const n=c.getColor(on);n&&(a.addRule(`.extension-editor .header .actions-status-container > .status ${I.asCSSSelector(M)} { color: ${n}; }`),a.addRule(`.extension-editor .body .subcontent .runtime-status ${I.asCSSSelector(M)} { color: ${n}; }`),a.addRule(`.monaco-hover.extension-hover .markdown-hover .hover-contents ${I.asCSSSelector(M)} { color: ${n}; }`))});export{Ee as AbstractConfigureRecommendedExtensionsAction,ye as AbstractInstallExtensionsInServerAction,bt as ButtonWithDropDownExtensionAction,ws as ButtonWithDropdownExtensionActionViewItem,G as ClearLanguageAction,Ye as ConfigureWorkspaceFolderRecommendedExtensionsAction,Je as ConfigureWorkspaceRecommendedExtensionsAction,je as DisableDropDownAction,j as DisableForWorkspaceAction,J as DisableGloballyAction,he as DropDownExtensionAction,Pe as DropDownExtensionActionViewItem,Xe as EnableDropDownAction,K as EnableForWorkspaceAction,X as EnableGloballyAction,h as ExtensionAction,Ls as ExtensionEditorManageExtensionAction,re as ExtensionRuntimeStateAction,D as ExtensionStatusAction,oe as ExtensionStatusLabelAction,xe as IgnoreExtensionRecommendationAction,k as InstallAction,V as InstallAnotherVersionAction,qe as InstallDropdownAction,E as InstallInOtherServerAction,ze as InstallLocalExtensionsInRemoteAction,pe as InstallRecommendedExtensionAction,Ze as InstallRemoteExtensionsInLocalAction,Se as InstallSpecificVersionOfExtensionAction,et as InstallingLabelAction,Qe as LocalInstallAction,z as ManageExtensionAction,Ne as MenuItemExtensionAction,se as MigrateDeprecatedExtensionAction,ne as PromptExtensionInstallFailureAction,me as ReinstallAction,Me as RemoteInstallAction,A as SetColorThemeAction,$ as SetFileIconThemeAction,F as SetLanguageAction,R as SetProductIconThemeAction,ue as ShowRecommendedExtensionAction,N as ToggleAutoUpdateForExtensionAction,ie as ToggleAutoUpdatesForPublisherAction,_ as TogglePreReleaseExtensionAction,ae as ToggleSyncExtensionAction,ve as UndoIgnoreExtensionRecommendationAction,C as UninstallAction,Y as UpdateAction,Ke as WebInstallAction,Ts as extensionButtonProminentBackground,Pn as getContextMenuActions,Dn as showExtensionsWithIdsCommandId};
