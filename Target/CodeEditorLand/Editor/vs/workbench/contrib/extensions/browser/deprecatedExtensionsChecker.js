var g=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var m=(a,r,i,n)=>{for(var t=n>1?void 0:n?x(r,i):r,e=a.length-1,o;e>=0;e--)(o=a[e])&&(t=(n?o(r,i,t):o(t))||t);return n&&t&&g(r,i,t),t},s=(a,r)=>(i,n)=>r(i,n,a);import{distinct as E}from"../../../../base/common/arrays.js";import{Disposable as I}from"../../../../base/common/lifecycle.js";import{localize as f}from"../../../../nls.js";import{IExtensionManagementService as b}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{areSameExtensions as u}from"../../../../platform/extensionManagement/common/extensionManagementUtil.js";import{IInstantiationService as y}from"../../../../platform/instantiation/common/instantiation.js";import{INotificationService as N,Severity as D}from"../../../../platform/notification/common/notification.js";import{IStorageService as w,StorageScope as c,StorageTarget as v}from"../../../../platform/storage/common/storage.js";import"../../../common/contributions.js";import{IWorkbenchExtensionEnablementService as W}from"../../../services/extensionManagement/common/extensionManagement.js";import{IExtensionsWorkbenchService as k}from"../common/extensions.js";import{SearchExtensionsAction as L}from"./extensionsActions.js";let d=class extends I{constructor(i,n,t,e,o,A){super();this.extensionsWorkbenchService=i;this.extensionEnablementService=t;this.storageService=e;this.notificationService=o;this.instantiationService=A;this.checkForDeprecatedExtensions(),this._register(n.onDidInstallExtensions(S=>{const p=[];for(const{local:l}of S)l&&i.local.find(h=>u(h.identifier,l.identifier))?.deprecationInfo&&p.push(l.identifier.id.toLowerCase());p.length&&this.setNotifiedDeprecatedExtensions(p)}))}async checkForDeprecatedExtensions(){if(this.storageService.getBoolean("extensionsAssistant/doNotCheckDeprecated",c.PROFILE,!1))return;const i=await this.extensionsWorkbenchService.queryLocal(),n=this.getNotifiedDeprecatedExtensions(),t=i.filter(e=>!!e.deprecationInfo&&e.local&&this.extensionEnablementService.isEnabled(e.local)).filter(e=>!n.includes(e.identifier.id.toLowerCase()));t.length&&this.notificationService.prompt(D.Warning,f("deprecated extensions","You have deprecated extensions installed. We recommend to review them and migrate to alternatives."),[{label:f("showDeprecated","Show Deprecated Extensions"),run:async()=>{this.setNotifiedDeprecatedExtensions(t.map(o=>o.identifier.id.toLowerCase()));const e=this.instantiationService.createInstance(L,t.map(o=>`@id:${o.identifier.id}`).join(" "));try{await e.run()}finally{e.dispose()}}},{label:f("neverShowAgain","Don't Show Again"),isSecondary:!0,run:()=>this.storageService.store("extensionsAssistant/doNotCheckDeprecated",!0,c.PROFILE,v.USER)}])}getNotifiedDeprecatedExtensions(){return JSON.parse(this.storageService.get("extensionsAssistant/deprecated",c.PROFILE,"[]"))}setNotifiedDeprecatedExtensions(i){this.storageService.store("extensionsAssistant/deprecated",JSON.stringify(E([...this.getNotifiedDeprecatedExtensions(),...i])),c.PROFILE,v.USER)}};d=m([s(0,k),s(1,b),s(2,W),s(3,w),s(4,N),s(5,y)],d);export{d as DeprecatedExtensionsChecker};
