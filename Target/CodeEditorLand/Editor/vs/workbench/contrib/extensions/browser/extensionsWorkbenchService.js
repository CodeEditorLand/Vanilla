var Ee=Object.defineProperty;var xe=Object.getOwnPropertyDescriptor;var _=(A,d,e,t)=>{for(var i=t>1?void 0:t?xe(d,e):d,n=A.length-1,s;n>=0;n--)(s=A[n])&&(i=(t?s(d,e,i):s(i))||i);return t&&i&&Ee(d,e,i),i},u=(A,d)=>(e,t)=>d(e,t,A);import{mainWindow as me}from"../../../../base/browser/window.js";import{index as ve}from"../../../../base/common/arrays.js";import{Promises as ee,ThrottledDelayer as te,createCancelablePromise as ye}from"../../../../base/common/async.js";import{CancellationToken as m}from"../../../../base/common/cancellation.js";import{CancellationError as V,isCancellationError as Se}from"../../../../base/common/errors.js";import{Emitter as D,Event as k}from"../../../../base/common/event.js";import{Disposable as ie,MutableDisposable as Ie,toDisposable as be}from"../../../../base/common/lifecycle.js";import{FileAccess as L}from"../../../../base/common/network.js";import{singlePagePager as we}from"../../../../base/common/paging.js";import{isWeb as ne,language as Ue}from"../../../../base/common/platform.js";import*as G from"../../../../base/common/resources.js";import*as F from"../../../../base/common/semver/semver.js";import{isBoolean as Pe,isDefined as Ce,isString as I,isUndefined as W}from"../../../../base/common/types.js";import{URI as w}from"../../../../base/common/uri.js";import{ILanguageService as Ae}from"../../../../editor/common/languages/language.js";import*as l from"../../../../nls.js";import{IConfigurationService as Me}from"../../../../platform/configuration/common/configuration.js";import{Extensions as Re}from"../../../../platform/configuration/common/configurationRegistry.js";import{IContextKeyService as De}from"../../../../platform/contextkey/common/contextkey.js";import{IDialogService as ke}from"../../../../platform/dialogs/common/dialogs.js";import{EXTENSION_IDENTIFIER_REGEX as z,IExtensionGalleryService as B,InstallOperation as _e,WEB_EXTENSION_TAG as Ve,isTargetPlatformCompatible as Le}from"../../../../platform/extensionManagement/common/extensionManagement.js";import{areSameExtensions as c,getGalleryExtensionId as Ne,getGalleryExtensionTelemetryData as Te,getLocalExtensionTelemetryData as Ge,groupByExtension as se}from"../../../../platform/extensionManagement/common/extensionManagementUtil.js";import{areApiProposalsCompatible as Fe,isEngineValid as q}from"../../../../platform/extensions/common/extensionValidator.js";import{ExtensionIdentifier as O,ExtensionType as b,TargetPlatform as $,isApplicationScopedExtension as We}from"../../../../platform/extensions/common/extensions.js";import{IFileService as oe}from"../../../../platform/files/common/files.js";import{IInstantiationService as re}from"../../../../platform/instantiation/common/instantiation.js";import{getLocale as ae}from"../../../../platform/languagePacks/common/languagePacks.js";import{ILogService as le}from"../../../../platform/log/common/log.js";import{INotificationService as ze,NotificationPriority as Be,Severity as M}from"../../../../platform/notification/common/notification.js";import{IProductService as ce}from"../../../../platform/product/common/productService.js";import{IProgressService as qe,ProgressLocation as N}from"../../../../platform/progress/common/progress.js";import{Registry as Oe}from"../../../../platform/registry/common/platform.js";import{IStorageService as $e,StorageScope as R,StorageTarget as de}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as K}from"../../../../platform/telemetry/common/telemetry.js";import{TelemetryTrustedValue as Ke}from"../../../../platform/telemetry/common/telemetryUtils.js";import{IUpdateService as je,StateType as S}from"../../../../platform/update/common/update.js";import{IUriIdentityService as He}from"../../../../platform/uriIdentity/common/uriIdentity.js";import{IURLService as Xe}from"../../../../platform/url/common/url.js";import{IIgnoredExtensionsManagementService as Qe}from"../../../../platform/userDataSync/common/ignoredExtensions.js";import{IUserDataAutoSyncService as Je,IUserDataSyncEnablementService as Ye,SyncResource as Ze}from"../../../../platform/userDataSync/common/userDataSync.js";import{IWorkspaceContextService as et}from"../../../../platform/workspace/common/workspace.js";import{ACTIVE_GROUP as tt,IEditorService as it,SIDE_GROUP as nt}from"../../../services/editor/common/editorService.js";import{DefaultIconPath as st,EnablementState as x,IExtensionManagementServerService as ot,IWorkbenchExtensionEnablementService as ue,IWorkbenchExtensionManagementService as he,extensionsConfigurationNodeBase as rt}from"../../../services/extensionManagement/common/extensionManagement.js";import{IExtensionManifestPropertiesService as at}from"../../../services/extensions/common/extensionManifestPropertiesService.js";import{IExtensionService as lt,toExtension as j,toExtensionDescription as H}from"../../../services/extensions/common/extensions.js";import{IHostService as ct}from"../../../services/host/browser/host.js";import{ILifecycleService as dt,LifecyclePhase as ut}from"../../../services/lifecycle/common/lifecycle.js";import{ILocaleService as ht}from"../../../services/localization/common/locale.js";import{IUserDataProfileService as fe}from"../../../services/userDataProfile/common/userDataProfile.js";import{IViewsService as ft}from"../../../services/views/common/viewsService.js";import{ShowCurrentReleaseNotesActionId as pt}from"../../update/common/update.js";import{AutoCheckUpdatesConfigurationKey as pe,AutoRestartConfigurationKey as T,AutoUpdateConfigurationKey as X,ExtensionRuntimeActionType as U,ExtensionState as v,HasOutdatedExtensionsContext as gt,VIEWLET_ID as Et}from"../common/extensions.js";import{ExtensionsInput as xt}from"../common/extensionsInput.js";let y=class{constructor(d,e,t,i,n,s,o,r,a,h,p){this.stateProvider=d;this.runtimeStateProvider=e;this.server=t;this.local=i;this._gallery=n;this.resourceExtensionInfo=s;this.galleryService=o;this.telemetryService=r;this.logService=a;this.fileService=h;this.productService=p}enablementState=x.EnabledGlobally;galleryResourcesCache=new Map;get resourceExtension(){if(this.resourceExtensionInfo)return this.resourceExtensionInfo.resourceExtension;if(this.local?.isWorkspaceScoped)return{type:"resource",identifier:this.local.identifier,location:this.local.location,manifest:this.local.manifest,changelogUri:this.local.changelogUrl,readmeUri:this.local.readmeUrl}}get gallery(){return this._gallery}set gallery(d){this._gallery=d,this.galleryResourcesCache.clear()}get type(){return this.local?this.local.type:b.User}get isBuiltin(){return this.local?this.local.isBuiltin:!1}get isWorkspaceScoped(){return this.local?this.local.isWorkspaceScoped:this.resourceExtensionInfo?this.resourceExtensionInfo.isWorkspaceScoped:!1}get name(){return this.gallery?this.gallery.name:this.getManifestFromLocalOrResource()?.name??""}get displayName(){return this.gallery?this.gallery.displayName||this.gallery.name:this.getManifestFromLocalOrResource()?.displayName??this.name}get identifier(){return this.gallery?this.gallery.identifier:this.resourceExtension?this.resourceExtension.identifier:this.local.identifier}get uuid(){return this.gallery?this.gallery.identifier.uuid:this.local?.identifier.uuid}get publisher(){return this.gallery?this.gallery.publisher:this.getManifestFromLocalOrResource()?.publisher??""}get publisherDisplayName(){return this.gallery?this.gallery.publisherDisplayName||this.gallery.publisher:this.local?.publisherDisplayName?this.local.publisherDisplayName:this.publisher}get publisherUrl(){if(!(!this.productService.extensionsGallery||!this.gallery))return G.joinPath(w.parse(this.productService.extensionsGallery.publisherUrl),this.publisher)}get publisherDomain(){return this.gallery?.publisherDomain}get publisherSponsorLink(){return this.gallery?.publisherSponsorLink?w.parse(this.gallery.publisherSponsorLink):void 0}get version(){return this.local?this.local.manifest.version:this.latestVersion}get pinned(){return!!this.local?.pinned}get latestVersion(){return this.gallery?this.gallery.version:this.getManifestFromLocalOrResource()?.version??""}get description(){return this.gallery?this.gallery.description:this.getManifestFromLocalOrResource()?.description??""}get url(){if(!(!this.productService.extensionsGallery||!this.gallery))return`${this.productService.extensionsGallery.itemUrl}?itemName=${this.publisher}.${this.name}`}get iconUrl(){return this.galleryIconUrl||this.resourceExtensionIconUrl||this.localIconUrl||this.defaultIconUrl}get iconUrlFallback(){return this.galleryIconUrlFallback||this.resourceExtensionIconUrl||this.localIconUrl||this.defaultIconUrl}get localIconUrl(){return this.local&&this.local.manifest.icon?L.uriToBrowserUri(G.joinPath(this.local.location,this.local.manifest.icon)).toString(!0):null}get resourceExtensionIconUrl(){return this.resourceExtension?.manifest.icon?L.uriToBrowserUri(G.joinPath(this.resourceExtension.location,this.resourceExtension.manifest.icon)).toString(!0):null}get galleryIconUrl(){return this.gallery?.assets.icon?this.gallery.assets.icon.uri:null}get galleryIconUrlFallback(){return this.gallery?.assets.icon?this.gallery.assets.icon.fallbackUri:null}get defaultIconUrl(){if(this.type===b.System&&this.local&&this.local.manifest&&this.local.manifest.contributes){if(Array.isArray(this.local.manifest.contributes.themes)&&this.local.manifest.contributes.themes.length)return L.asBrowserUri("vs/workbench/contrib/extensions/browser/media/theme-icon.png").toString(!0);if(Array.isArray(this.local.manifest.contributes.grammars)&&this.local.manifest.contributes.grammars.length)return L.asBrowserUri("vs/workbench/contrib/extensions/browser/media/language-icon.svg").toString(!0)}return st}get repository(){return this.gallery&&this.gallery.assets.repository?this.gallery.assets.repository.uri:void 0}get licenseUrl(){return this.gallery&&this.gallery.assets.license?this.gallery.assets.license.uri:void 0}get supportUrl(){return this.gallery&&this.gallery.supportLink?this.gallery.supportLink:void 0}get state(){return this.stateProvider(this)}isMalicious=!1;deprecationInfo;get installCount(){return this.gallery?this.gallery.installCount:void 0}get rating(){return this.gallery?this.gallery.rating:void 0}get ratingCount(){return this.gallery?this.gallery.ratingCount:void 0}get outdated(){try{if(!this.gallery||!this.local||this.type===b.System&&this.productService.quality==="stable"||!this.local.preRelease&&this.gallery.properties.isPreReleaseVersion)return!1;if(F.gt(this.latestVersion,this.version)||this.outdatedTargetPlatform)return!0}catch{}return!1}get outdatedTargetPlatform(){return!!this.local&&!!this.gallery&&![$.UNDEFINED,$.WEB].includes(this.local.targetPlatform)&&this.gallery.properties.targetPlatform!==$.WEB&&this.local.targetPlatform!==this.gallery.properties.targetPlatform&&F.eq(this.latestVersion,this.version)}get runtimeState(){return this.runtimeStateProvider(this)}get telemetryData(){const{local:d,gallery:e}=this;return e?Te(e):d?Ge(d):{}}get preview(){return this.local?.manifest.preview??this.gallery?.preview??!1}get preRelease(){return!!this.local?.preRelease}get isPreReleaseVersion(){return this.local?this.local.isPreReleaseVersion:!!this.gallery?.properties.isPreReleaseVersion}_extensionEnabledWithPreRelease;get hasPreReleaseVersion(){return!!this.gallery?.hasPreReleaseVersion||!!this.local?.hasPreReleaseVersion||!!this._extensionEnabledWithPreRelease}get hasReleaseVersion(){return!!this.resourceExtension||!!this.gallery?.hasReleaseVersion}getLocal(){return this.local&&!this.outdated?this.local:void 0}async getManifest(d){const e=this.getLocal();return e?e.manifest:this.gallery?this.getGalleryManifest(d):this.resourceExtension?this.resourceExtension.manifest:null}async getGalleryManifest(d=m.None){if(this.gallery){let e=this.galleryResourcesCache.get("manifest");return e||(this.gallery.assets.manifest?this.galleryResourcesCache.set("manifest",e=this.galleryService.getManifest(this.gallery,d).catch(t=>{throw this.galleryResourcesCache.delete("manifest"),t})):this.logService.error(l.localize("Manifest is not found","Manifest is not found"),this.identifier.id)),e}return null}hasReadme(){return this.local&&this.local.readmeUrl||this.gallery&&this.gallery.assets.readme||this.resourceExtension?.readmeUri?!0:this.type===b.System}async getReadme(d){const e=this.getLocal();if(e?.readmeUrl)return(await this.fileService.readFile(e.readmeUrl)).value.toString();if(this.gallery){if(this.gallery.assets.readme)return this.galleryService.getReadme(this.gallery,d);this.telemetryService.publicLog("extensions:NotFoundReadMe",this.telemetryData)}return this.type===b.System?Promise.resolve(`# ${this.displayName||this.name}
**Notice:** This extension is bundled with Visual Studio Code. It can be disabled but not uninstalled.
## Features
${this.description}
`):this.resourceExtension?.readmeUri?(await this.fileService.readFile(this.resourceExtension?.readmeUri)).value.toString():Promise.reject(new Error("not available"))}hasChangelog(){return this.local&&this.local.changelogUrl||this.gallery&&this.gallery.assets.changelog?!0:this.type===b.System}async getChangelog(d){const e=this.getLocal();return e?.changelogUrl?(await this.fileService.readFile(e.changelogUrl)).value.toString():this.gallery?.assets.changelog?this.galleryService.getChangelog(this.gallery,d):this.type===b.System?Promise.resolve(`Please check the [VS Code Release Notes](command:${pt}) for changes to the built-in extensions.`):Promise.reject(new Error("not available"))}get categories(){const{local:d,gallery:e,resourceExtension:t}=this;return d&&d.manifest.categories&&!this.outdated?d.manifest.categories:e?e.categories:t?t.manifest.categories??[]:[]}get tags(){const{gallery:d}=this;return d?d.tags.filter(e=>!e.startsWith("_")):[]}get dependencies(){const{local:d,gallery:e,resourceExtension:t}=this;return d&&d.manifest.extensionDependencies&&!this.outdated?d.manifest.extensionDependencies:e?e.properties.dependencies||[]:t?t.manifest.extensionDependencies||[]:[]}get extensionPack(){const{local:d,gallery:e,resourceExtension:t}=this;return d&&d.manifest.extensionPack&&!this.outdated?d.manifest.extensionPack:e?e.properties.extensionPack||[]:t?t.manifest.extensionPack||[]:[]}setExtensionsControlManifest(d){this.isMalicious=d.malicious.some(e=>c(this.identifier,e)),this.deprecationInfo=d.deprecated?d.deprecated[this.identifier.id.toLowerCase()]:void 0,this._extensionEnabledWithPreRelease=d?.extensionsEnabledWithPreRelease?.includes(this.identifier.id.toLowerCase())}getManifestFromLocalOrResource(){return this.local?this.local.manifest:this.resourceExtension?this.resourceExtension.manifest:null}};y=_([u(6,B),u(7,K),u(8,le),u(9,oe),u(10,ce)],y);const Q="extensions.autoUpdate",J="extensions.donotAutoUpdate";let P=class extends ie{constructor(e,t,i,n,s,o,r,a,h,p){super();this.server=e;this.stateProvider=t;this.runtimeStateProvider=i;this.isWorkspaceServer=n;this.galleryService=s;this.extensionEnablementService=o;this.workbenchExtensionManagementService=r;this.userDataProfileService=a;this.telemetryService=h;this.instantiationService=p;this._register(e.extensionManagementService.onInstallExtension(f=>this.onInstallExtension(f))),this._register(e.extensionManagementService.onDidInstallExtensions(f=>this.onDidInstallExtensions(f))),this._register(e.extensionManagementService.onUninstallExtension(f=>this.onUninstallExtension(f.identifier))),this._register(e.extensionManagementService.onDidUninstallExtension(f=>this.onDidUninstallExtension(f))),this._register(e.extensionManagementService.onDidUpdateExtensionMetadata(f=>this.onDidUpdateExtensionMetadata(f.local))),this._register(e.extensionManagementService.onDidChangeProfile(()=>this.reset())),this._register(o.onEnablementChanged(f=>this.onEnablementChanged(f))),this._register(k.any(this.onChange,this.onReset)(()=>this._local=void 0)),this.isWorkspaceServer&&(this._register(this.workbenchExtensionManagementService.onInstallExtension(f=>{f.workspaceScoped&&this.onInstallExtension(f)})),this._register(this.workbenchExtensionManagementService.onDidInstallExtensions(f=>{const g=f.filter(Y=>Y.workspaceScoped);g.length&&this.onDidInstallExtensions(g)})),this._register(this.workbenchExtensionManagementService.onUninstallExtension(f=>{f.workspaceScoped&&this.onUninstallExtension(f.identifier)})),this._register(this.workbenchExtensionManagementService.onDidUninstallExtension(f=>{f.workspaceScoped&&this.onDidUninstallExtension(f)})))}_onChange=this._register(new D);get onChange(){return this._onChange.event}_onReset=this._register(new D);get onReset(){return this._onReset.event}installing=[];uninstalling=[];installed=[];_local;get local(){if(!this._local){this._local=[];for(const e of this.installed)this._local.push(e);for(const e of this.installing)this.installed.some(t=>c(t.identifier,e.identifier))||this._local.push(e)}return this._local}async queryInstalled(e){return await this.fetchInstalledExtensions(e),this._onChange.fire(void 0),this.local}async syncInstalledExtensionsWithGallery(e,t){const i=await this.mapInstalledExtensionWithCompatibleGalleryExtension(e,t);for(const[n,s]of i)n.local&&!n.local.identifier.uuid&&(n.local=await this.updateMetadata(n.local,s)),(!n.gallery||n.gallery.version!==s.version||n.gallery.properties.targetPlatform!==s.properties.targetPlatform)&&(n.gallery=s,this._onChange.fire({extension:n}))}async mapInstalledExtensionWithCompatibleGalleryExtension(e,t){const i=this.mapInstalledExtensionWithGalleryExtension(e),n=await this.server.extensionManagementService.getTargetPlatform(),s=[],o=[];if(await Promise.allSettled(i.map(async([r,a])=>{r.local&&(await this.galleryService.isExtensionCompatible(a,r.local.preRelease,n,t)?s.push(a):o.push({...r.local.identifier,preRelease:r.local.preRelease}))})),o.length){const r=await this.galleryService.getExtensions(o,{targetPlatform:n,compatible:!0,queryAllVersions:!0,productVersion:t},m.None);s.push(...r)}return this.mapInstalledExtensionWithGalleryExtension(s)}mapInstalledExtensionWithGalleryExtension(e){const t=[],i=new Map,n=new Map;for(const s of e)i.set(s.identifier.uuid,s),n.set(s.identifier.id.toLowerCase(),s);for(const s of this.installed){if(s.uuid){const o=i.get(s.uuid);if(o){t.push([s,o]);continue}}if(s.local?.source!=="resource"){const o=n.get(s.identifier.id.toLowerCase());o&&t.push([s,o])}}return t}async updateMetadata(e,t){let i=!1;return e.manifest.version!==t.version&&(this.telemetryService.publicLog2("galleryService:updateMetadata"),i=!!(await this.galleryService.getExtensions([{...e.identifier,version:e.manifest.version}],m.None))[0]?.properties?.isPreReleaseVersion),this.server.extensionManagementService.updateMetadata(e,{id:t.identifier.uuid,publisherDisplayName:t.publisherDisplayName,publisherId:t.publisherId,isPreReleaseVersion:i},this.userDataProfileService.currentProfile.extensionsResource)}canInstall(e){return this.server.extensionManagementService.canInstall(e)}onInstallExtension(e){const{source:t}=e;if(t&&!w.isUri(t)){const i=this.installed.find(n=>c(n.identifier,t.identifier))??this.instantiationService.createInstance(y,this.stateProvider,this.runtimeStateProvider,this.server,void 0,t,void 0);this.installing.push(i),this._onChange.fire({extension:i})}}async fetchInstalledExtensions(e){const t=await this.server.extensionManagementService.getExtensionsControlManifest(),i=await this.server.extensionManagementService.getInstalled(void 0,void 0,e);this.isWorkspaceServer&&i.push(...await this.workbenchExtensionManagementService.getInstalledWorkspaceExtensions(!0));const n=se(i,o=>o.identifier).reduce((o,r)=>{if(r.length===1)o.push(r[0]);else{let a,h,p;for(const g of r)g.isWorkspaceScoped?a=g:g.type===b.User?h=g:p=g;const f=a??h??p;f&&o.push(f)}return o},[]),s=ve(this.installed,o=>o.local?o.local.identifier.id:o.identifier.id);this.installed=n.map(o=>{const r=s[o.identifier.id]||this.instantiationService.createInstance(y,this.stateProvider,this.runtimeStateProvider,this.server,o,void 0,void 0);return r.local=o,r.enablementState=this.extensionEnablementService.getEnablementState(o),r.setExtensionsControlManifest(t),r})}async reset(){this.installed=[],this.installing=[],this.uninstalling=[],await this.fetchInstalledExtensions(),this._onReset.fire()}async onDidInstallExtensions(e){for(const t of e){const{local:i,source:n}=t,s=n&&!w.isUri(n)?n:void 0,o=n&&w.isUri(n)?n:void 0,r=s?this.installing.filter(h=>c(h.identifier,s.identifier))[0]:null;this.installing=r?this.installing.filter(h=>h!==r):this.installing;let a=r||(o||i?this.instantiationService.createInstance(y,this.stateProvider,this.runtimeStateProvider,this.server,i,void 0,void 0):void 0);if(a&&i){const h=this.installed.filter(p=>c(p.identifier,a.identifier))[0];h?a=h:this.installed.push(a),a.local=i,a.gallery||(a.gallery=s),a.setExtensionsControlManifest(await this.server.extensionManagementService.getExtensionsControlManifest()),a.enablementState=this.extensionEnablementService.getEnablementState(i)}this._onChange.fire(!i||!a?void 0:{extension:a,operation:t.operation}),a&&a.local&&!a.gallery&&a.local.source!=="resource"&&await this.syncInstalledExtensionWithGallery(a)}}async onDidUpdateExtensionMetadata(e){const t=this.installed.find(i=>c(i.identifier,e.identifier));if(t?.local){const i=t.local.pinned!==e.pinned||t.local.preRelease!==e.preRelease;t.local=e,i&&this._onChange.fire({extension:t})}}async syncInstalledExtensionWithGallery(e){if(!this.galleryService.isEnabled())return;this.telemetryService.publicLog2("galleryService:matchInstalledExtension");const[t]=await this.galleryService.getExtensions([{...e.identifier,preRelease:e.local?.preRelease}],{compatible:!0,targetPlatform:await this.server.extensionManagementService.getTargetPlatform()},m.None);t&&(e.gallery=t,this._onChange.fire({extension:e}))}onUninstallExtension(e){const t=this.installed.filter(i=>c(i.identifier,e))[0];if(t){const i=this.uninstalling.filter(n=>c(n.identifier,e))[0]||t;this.uninstalling=[i,...this.uninstalling.filter(n=>!c(n.identifier,e))],this._onChange.fire(i?{extension:i}:void 0)}}onDidUninstallExtension({identifier:e,error:t}){const i=this.uninstalling.find(n=>c(n.identifier,e))||this.installed.find(n=>c(n.identifier,e));this.uninstalling=this.uninstalling.filter(n=>!c(n.identifier,e)),t||(this.installed=this.installed.filter(n=>!c(n.identifier,e))),i&&this._onChange.fire({extension:i})}onEnablementChanged(e){const t=this.local.filter(i=>e.some(n=>c(i.identifier,n.identifier)));for(const i of t)if(i.local){const n=this.extensionEnablementService.getEnablementState(i.local);n!==i.enablementState&&(i.enablementState=n,this._onChange.fire({extension:i}))}}getExtensionState(e){return e.gallery&&this.installing.some(i=>!!i.gallery&&c(i.gallery.identifier,e.gallery.identifier))?v.Installing:this.uninstalling.some(i=>c(i.identifier,e.identifier))?v.Uninstalling:this.installed.filter(i=>i===e||i.gallery&&e.gallery&&c(i.gallery.identifier,e.gallery.identifier))[0]?v.Installed:v.Uninstalled}};P=_([u(4,B),u(5,ue),u(6,he),u(7,fe),u(8,K),u(9,re)],P);let C=class extends ie{constructor(e,t,i,n,s,o,r,a,h,p,f,g,Y,mt,vt,yt,ge,St,It,bt,wt,Ut,Pt,Ct,At,Mt,Rt,Dt,kt,_t,Vt){super();this.instantiationService=e;this.editorService=t;this.extensionManagementService=i;this.galleryService=n;this.configurationService=s;this.telemetryService=o;this.notificationService=r;this.extensionEnablementService=h;this.hostService=p;this.progressService=f;this.extensionManagementServerService=g;this.languageService=Y;this.extensionsSyncManagementService=mt;this.userDataAutoSyncService=vt;this.productService=yt;this.extensionManifestPropertiesService=St;this.logService=It;this.extensionService=bt;this.localeService=wt;this.lifecycleService=Ut;this.fileService=Pt;this.userDataProfileService=Ct;this.storageService=At;this.dialogService=Mt;this.userDataSyncEnablementService=Rt;this.updateService=Dt;this.uriIdentityService=kt;this.workspaceContextService=_t;this.viewsService=Vt;const Z=s.getValue("_extensions.preferPreReleases");W(Z)||(this.preferPreReleases=!!Z),this.hasOutdatedExtensionsContextKey=gt.bindTo(ge),g.localExtensionManagementServer&&(this.localExtensions=this._register(e.createInstance(P,g.localExtensionManagementServer,E=>this.getExtensionState(E),E=>this.getRuntimeState(E),!g.remoteExtensionManagementServer)),this._register(this.localExtensions.onChange(E=>this.onDidChangeExtensions(E?.extension))),this._register(this.localExtensions.onReset(E=>this.reset())),this.extensionsServers.push(this.localExtensions)),g.remoteExtensionManagementServer&&(this.remoteExtensions=this._register(e.createInstance(P,g.remoteExtensionManagementServer,E=>this.getExtensionState(E),E=>this.getRuntimeState(E),!0)),this._register(this.remoteExtensions.onChange(E=>this.onDidChangeExtensions(E?.extension))),this._register(this.remoteExtensions.onReset(E=>this.reset())),this.extensionsServers.push(this.remoteExtensions)),g.webExtensionManagementServer&&(this.webExtensions=this._register(e.createInstance(P,g.webExtensionManagementServer,E=>this.getExtensionState(E),E=>this.getRuntimeState(E),!(g.remoteExtensionManagementServer||g.localExtensionManagementServer))),this._register(this.webExtensions.onChange(E=>this.onDidChangeExtensions(E?.extension))),this._register(this.webExtensions.onReset(E=>this.reset())),this.extensionsServers.push(this.webExtensions)),this.updatesCheckDelayer=new te(C.UpdatesCheckInterval),this.autoUpdateDelayer=new te(1e3),this._register(be(()=>{this.updatesCheckDelayer.cancel(),this.autoUpdateDelayer.cancel()})),a.registerHandler(this),this.productService.quality!=="stable"&&this.registerAutoRestartConfig(),this.whenInitialized=this.initialize()}static UpdatesCheckInterval=1e3*60*60*12;hasOutdatedExtensionsContextKey;localExtensions=null;remoteExtensions=null;webExtensions=null;extensionsServers=[];updatesCheckDelayer;autoUpdateDelayer;_onChange=this._register(new D);get onChange(){return this._onChange.event}extensionsNotification;dismissedNotifications=[];_onDidChangeExtensionsNotification=new D;onDidChangeExtensionsNotification=this._onDidChangeExtensionsNotification.event;_onReset=new D;get onReset(){return this._onReset.event}preferPreReleases=this.productService.quality!=="stable";installing=[];tasksInProgress=[];whenInitialized;registerAutoRestartConfig(){Oe.as(Re.Configuration).registerConfiguration({...rt,properties:{[T]:{type:"boolean",description:l.localize("autoRestart","If activated, extensions will automatically restart following an update if the window is not in focus. There can be a data loss if you have open Notebooks or Custom Editors."),default:!1}}})}async initialize(){await Promise.all([this.queryLocal(),this.extensionService.whenInstalledExtensionsRegistered()]),!this._store.isDisposed&&(this.onDidChangeRunningExtensions(this.extensionService.extensions,[]),this._register(this.extensionService.onDidChangeExtensions(({added:e,removed:t})=>this.onDidChangeRunningExtensions(e,t))),await this.lifecycleService.when(ut.Eventually),!this._store.isDisposed&&(this.initializeAutoUpdate(),this.updateExtensionsNotificaiton(),this.reportInstalledExtensionsTelemetry(),this._register(this.storageService.onDidChangeValue(R.APPLICATION,Q,this._store)(e=>this.onDidSelectedExtensionToAutoUpdateValueChange())),this._register(this.storageService.onDidChangeValue(R.APPLICATION,J,this._store)(e=>this.onDidSelectedExtensionToAutoUpdateValueChange())),this._register(k.debounce(this.onChange,()=>{},100)(()=>{this.updateExtensionsNotificaiton(),this.reportProgressFromOtherSources()}))))}initializeAutoUpdate(){this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(X)&&this.isAutoUpdateEnabled()&&this.eventuallyAutoUpdateExtensions(),e.affectsConfiguration(pe)&&this.isAutoCheckUpdatesEnabled()&&this.checkForUpdates()})),this._register(this.extensionEnablementService.onEnablementChanged(e=>{this.getAutoUpdateValue()==="onlyEnabledExtensions"&&e.some(t=>this.extensionEnablementService.isEnabled(t))&&this.checkForUpdates()})),this._register(k.debounce(this.onChange,()=>{},100)(()=>this.hasOutdatedExtensionsContextKey.set(this.outdated.length>0))),this._register(this.updateService.onStateChange(e=>{(e.type===S.CheckingForUpdates&&e.explicit||e.type===S.AvailableForDownload||e.type===S.Downloaded)&&(this.telemetryService.publicLog2("extensions:updatecheckonproductupdate"),this.isAutoCheckUpdatesEnabled()&&this.checkForUpdates())})),this.hasOutdatedExtensionsContextKey.set(this.outdated.length>0),this.eventuallyCheckForUpdates(!0),ne&&(this.syncPinnedBuiltinExtensions(),this.isAutoUpdateEnabled()||this.autoUpdateBuiltinExtensions()),this.registerAutoRestartListener(),this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(T)&&this.registerAutoRestartListener()}))}isAutoUpdateEnabled(){return this.getAutoUpdateValue()!==!1}getAutoUpdateValue(){const e=this.configurationService.getValue(X);return e==="onlySelectedExtensions"?!1:Pe(e)||e==="onlyEnabledExtensions"?e:!0}async updateAutoUpdateForAllExtensions(e){this.isAutoUpdateEnabled()===e||!(await this.dialogService.confirm({title:l.localize("confirmEnableDisableAutoUpdate","Auto Update Extensions"),message:e?l.localize("confirmEnableAutoUpdate","Do you want to enable auto update for all extensions?"):l.localize("confirmDisableAutoUpdate","Do you want to disable auto update for all extensions?"),detail:l.localize("confirmEnableDisableAutoUpdateDetail","This will reset any auto update settings you have set for individual extensions.")})).confirmed||(this.setEnabledAutoUpdateExtensions([]),await this.configurationService.updateValue(X,e),this.setDisabledAutoUpdateExtensions([]),await this.updateExtensionsPinnedState(!e),this._onChange.fire(void 0))}autoRestartListenerDisposable=this._register(new Ie);registerAutoRestartListener(){this.autoRestartListenerDisposable.value=void 0,this.configurationService.getValue(T)===!0&&(this.autoRestartListenerDisposable.value=this.hostService.onDidChangeFocus(e=>{!e&&this.configurationService.getValue(T)===!0&&this.updateRunningExtensions(!0)}))}reportInstalledExtensionsTelemetry(){const e=this.installed.filter(t=>!t.isBuiltin&&(t.enablementState===x.EnabledWorkspace||t.enablementState===x.EnabledGlobally)).map(t=>O.toKey(t.identifier.id));this.telemetryService.publicLog2("installedExtensions",{extensionIds:new Ke(e.join(";")),count:e.length})}async onDidChangeRunningExtensions(e,t){const i=[],n=[];for(const o of e){const r=this.installed.find(a=>c({id:o.identifier.value,uuid:o.uuid},a.identifier));r?i.push(r):n.push(o)}const s=[];for(const o of t)this.workspaceContextService.isInsideWorkspace(o.extensionLocation)?s.push(o):n.push(o);if(n.length){const o=await this.getExtensions(n.map(r=>({id:r.identifier.value,uuid:r.uuid})),m.None);i.push(...o)}if(s.length){const o=await this.getResourceExtensions(s.map(r=>r.extensionLocation),!0);i.push(...o)}for(const o of i)this._onChange.fire(o)}updateExtensionsPinnedState(e){return this.progressService.withProgress({location:N.Extensions,title:l.localize("updatingExtensions","Updating Extensions Auto Update State")},()=>this.extensionManagementService.resetPinnedStateForAllUserExtensions(e))}reset(){for(const e of this.tasksInProgress)e.cancel();this.tasksInProgress=[],this.installing=[],this.onDidChangeExtensions(),this._onReset.fire()}onDidChangeExtensions(e){this._installed=void 0,this._local=void 0,this._onChange.fire(e)}_local;get local(){if(!this._local)if(this.extensionsServers.length===1)this._local=this.installed;else{this._local=[];const e=se(this.installed,t=>t.identifier);for(const t of e)this._local.push(this.getPrimaryExtension(t))}return this._local}_installed;get installed(){if(!this._installed){this._installed=[];for(const e of this.extensionsServers)for(const t of e.local)this._installed.push(t)}return this._installed}get outdated(){return this.installed.filter(e=>e.outdated&&e.local&&e.state===v.Installed)}async queryLocal(e){if(e){if(this.localExtensions&&this.extensionManagementServerService.localExtensionManagementServer===e)return this.localExtensions.queryInstalled(this.getProductVersion());if(this.remoteExtensions&&this.extensionManagementServerService.remoteExtensionManagementServer===e)return this.remoteExtensions.queryInstalled(this.getProductVersion());if(this.webExtensions&&this.extensionManagementServerService.webExtensionManagementServer===e)return this.webExtensions.queryInstalled(this.getProductVersion())}if(this.localExtensions)try{await this.localExtensions.queryInstalled(this.getProductVersion())}catch(t){this.logService.error(t)}if(this.remoteExtensions)try{await this.remoteExtensions.queryInstalled(this.getProductVersion())}catch(t){this.logService.error(t)}if(this.webExtensions)try{await this.webExtensions.queryInstalled(this.getProductVersion())}catch(t){this.logService.error(t)}return this.local}async queryGallery(e,t){if(!this.galleryService.isEnabled())return we([]);const i=m.isCancellationToken(e)?{}:e,n=m.isCancellationToken(e)?e:t;i.text=i.text?this.resolveQueryText(i.text):i.text,i.includePreRelease=W(i.includePreRelease)?this.preferPreReleases:i.includePreRelease;const s=await this.extensionManagementService.getExtensionsControlManifest(),o=await this.galleryService.query(i,n);return this.syncInstalledExtensionsWithGallery(o.firstPage),{firstPage:o.firstPage.map(r=>this.fromGallery(r,s)),total:o.total,pageSize:o.pageSize,getPage:async(r,a)=>{const h=await o.getPage(r,a);return this.syncInstalledExtensionsWithGallery(h),h.map(p=>this.fromGallery(p,s))}}}async getExtensions(e,t,i){if(!this.galleryService.isEnabled())return[];e.forEach(o=>o.preRelease=o.preRelease??this.preferPreReleases);const n=await this.extensionManagementService.getExtensionsControlManifest(),s=await this.galleryService.getExtensions(e,t,i);return this.syncInstalledExtensionsWithGallery(s),s.map(o=>this.fromGallery(o,n))}async getResourceExtensions(e,t){return(await this.extensionManagementService.getExtensions(e)).map(n=>this.getInstalledExtensionMatchingLocation(n.location)??this.instantiationService.createInstance(y,s=>this.getExtensionState(s),s=>this.getRuntimeState(s),void 0,void 0,void 0,{resourceExtension:n,isWorkspaceScoped:t}))}updateExtensionsNotificaiton(){const e=this.computeExtensionsNotification(),t=e&&!this.dismissedNotifications.includes(e.message)?{...e,dismiss:()=>{this.dismissedNotifications.push(e.message),this.updateExtensionsNotificaiton()}}:void 0;this.extensionsNotification?.message!==t?.message&&(this.extensionsNotification=t,this._onDidChangeExtensionsNotification.fire(this.extensionsNotification))}computeExtensionsNotification(){const e=this.local.filter(i=>i.enablementState===x.DisabledByInvalidExtension);if(e.length)return e.some(i=>i.local&&(!q(i.local.manifest.engines.vscode,this.productService.version,this.productService.date)||Fe([...i.local.manifest.enabledApiProposals??[]])))?{message:l.localize("incompatibleExtensions","Some extensions are disabled due to version incompatibility. Review and update them."),severity:M.Warning,extensions:e}:{message:l.localize("invalidExtensions","Invalid extensions detected. Review them."),severity:M.Warning,extensions:e};const t=this.local.filter(i=>!!i.deprecationInfo);if(t.length)return{message:l.localize("deprecated extensions","Deprecated extensions detected. Review them and migrate to alternatives."),severity:M.Warning,extensions:t}}getExtensionsNotification(){return this.extensionsNotification}resolveQueryText(e){e=e.replace(/@web/g,`tag:"${Ve}"`);const t=/\bext:([^\s]+)\b/g;return t.test(e)&&(e=e.replace(t,(i,n)=>{const o=(this.productService.extensionKeywords||{})[n]||[],r=this.languageService.guessLanguageIdByFilepathOrFirstLine(w.file(`.${n}`)),a=r&&this.languageService.getLanguageName(r),h=a?` tag:"${a}"`:"";return`tag:"__ext_${n}" tag:"__ext_.${n}" ${o.map(p=>`tag:"${p}"`).join(" ")}${h} tag:"${n}"`})),e.substr(0,350)}fromGallery(e,t){let i=this.getInstalledExtensionMatchingGallery(e);return i||(i=this.instantiationService.createInstance(y,n=>this.getExtensionState(n),n=>this.getRuntimeState(n),void 0,void 0,e,void 0),i.setExtensionsControlManifest(t)),i}getInstalledExtensionMatchingGallery(e){for(const t of this.local)if(t.identifier.uuid){if(t.identifier.uuid===e.identifier.uuid)return t}else if(t.local?.source!=="resource"&&c(t.identifier,e.identifier))return t;return null}getInstalledExtensionMatchingLocation(e){return this.local.find(t=>t.local&&this.uriIdentityService.extUri.isEqualOrParent(e,t.local?.location))??null}async open(e,t){if(typeof e=="string"){const i=e;e=this.installed.find(n=>c(n.identifier,{id:i}))??(await this.getExtensions([{id:e}],m.None))[0]}if(!e)throw new Error(`Extension not found. ${e}`);await this.editorService.openEditor(this.instantiationService.createInstance(xt,e),t,t?.sideByside?nt:tt)}async openSearch(e,t){const i=(await this.viewsService.openViewContainer(Et,!0))?.getViewPaneContainer();i.search(e),t||i.focus()}getExtensionRuntimeStatus(e){const t=this.extensionService.getExtensionsStatus();for(const i of Object.keys(t))if(c({id:i},e.identifier))return t[i]}async updateRunningExtensions(e=!1){const t=[],i=[],n=[...this.local];for(const s of n){const o=s.runtimeState;if(!o||o.action!==U.RestartExtensions)continue;if(s.state===v.Uninstalled){i.push(s.identifier.id);continue}if(!s.local)continue;if(this.extensionEnablementService.isEnabled(s.local)){const a=this.extensionService.extensions.find(h=>c({id:h.identifier.value,uuid:h.uuid},s.identifier));a&&i.push(a.identifier.value),t.push(s.local)}else i.push(s.identifier.id)}for(const s of this.extensionService.extensions)s.isUnderDevelopment||n.some(o=>c({id:s.identifier.value,uuid:s.uuid},o.local?.identifier??o.identifier))||i.push(s.identifier.value);(t.length||i.length)&&await this.extensionService.stopExtensionHosts(l.localize("restart","Enable or Disable extensions"),e)&&(await this.extensionService.startExtensionHosts({toAdd:t,toRemove:i}),e&&this.notificationService.notify({severity:M.Info,message:l.localize("extensionsAutoRestart","Extensions were auto restarted to enable updates."),priority:Be.SILENT}),this.telemetryService.publicLog2("extensions:autorestart",{count:t.length+i.length,auto:e}))}getRuntimeState(e){const t=e.state===v.Uninstalled,i=this.extensionService.extensions.find(o=>c({id:o.identifier.value},e.identifier)),n=this.extensionManagementServerService.remoteExtensionManagementServer?U.ReloadWindow:U.RestartExtensions,s=n===U.ReloadWindow?l.localize("reload","reload window"):l.localize("restart extensions","restart extensions");if(t){const o=i&&this.extensionService.canRemoveExtension(i),r=i&&(!e.server||e.server===this.extensionManagementServerService.getExtensionManagementServer(j(i)))&&(!e.resourceExtension||this.uriIdentityService.extUri.isEqual(e.resourceExtension.location,i.extensionLocation));return!o&&r&&!i.isUnderDevelopment?{action:n,reason:l.localize("postUninstallTooltip","Please {0} to complete the uninstallation of this extension.",s)}:void 0}if(e.local){const o=i&&e.server===this.extensionManagementServerService.getExtensionManagementServer(j(i)),r=this.extensionEnablementService.isEnabled(e.local);if(i){if(r){if(this.extensionService.canAddExtension(H(e.local)))return;const a=this.extensionManagementServerService.getExtensionManagementServer(j(i));if(o){if(!i.isUnderDevelopment&&(e.version!==i.version||e.local.targetPlatform!==i.targetPlatform)){const h=this.getProductCurrentVersion(),p=this.getProductUpdateVersion();if(p&&!q(e.local.manifest.engines.vscode,h.version,h.date)&&q(e.local.manifest.engines.vscode,p.version,p.date)){const f=this.updateService.state;return f.type===S.AvailableForDownload?{action:U.DownloadUpdate,reason:l.localize("postUpdateDownloadTooltip","Please update {0} to enable the updated extension.",this.productService.nameLong)}:f.type===S.Downloaded?{action:U.ApplyUpdate,reason:l.localize("postUpdateUpdateTooltip","Please update {0} to enable the updated extension.",this.productService.nameLong)}:f.type===S.Ready?{action:U.QuitAndInstall,reason:l.localize("postUpdateRestartTooltip","Please restart {0} to enable the updated extension.",this.productService.nameLong)}:void 0}return{action:n,reason:l.localize("postUpdateTooltip","Please {0} to enable the updated extension.",s)}}if(this.extensionsServers.length>1){const h=this.installed.filter(p=>c(p.identifier,e.identifier)&&p.server!==e.server)[0];if(h){if(a===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnUI(e.local.manifest)&&h.server===this.extensionManagementServerService.localExtensionManagementServer)return{action:n,reason:l.localize("enable locally","Please {0} to enable this extension locally.",s)};if(a===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(e.local.manifest)&&h.server===this.extensionManagementServerService.remoteExtensionManagementServer)return{action:n,reason:l.localize("enable remote","Please {0} to enable this extension in {1}.",s,this.extensionManagementServerService.remoteExtensionManagementServer?.label)}}}}else{if(e.server===this.extensionManagementServerService.localExtensionManagementServer&&a===this.extensionManagementServerService.remoteExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnUI(e.local.manifest))return{action:n,reason:l.localize("postEnableTooltip","Please {0} to enable this extension.",s)};if(e.server===this.extensionManagementServerService.remoteExtensionManagementServer&&a===this.extensionManagementServerService.localExtensionManagementServer&&this.extensionManifestPropertiesService.prefersExecuteOnWorkspace(e.local.manifest))return{action:n,reason:l.localize("postEnableTooltip","Please {0} to enable this extension.",s)}}return}else if(o)return{action:n,reason:l.localize("postDisableTooltip","Please {0} to disable this extension.",s)};return}else{if(r&&!this.extensionService.canAddExtension(H(e.local)))return{action:n,reason:l.localize("postEnableTooltip","Please {0} to enable this extension.",s)};const a=e.server?e.server===this.extensionManagementServerService.localExtensionManagementServer?this.extensionManagementServerService.remoteExtensionManagementServer:this.extensionManagementServerService.localExtensionManagementServer:null;if(a&&e.enablementState===x.DisabledByExtensionKind){const h=this.local.filter(p=>c(p.identifier,e.identifier)&&p.server===a)[0];if(h&&h.local&&this.extensionEnablementService.isEnabled(h.local))return{action:n,reason:l.localize("postEnableTooltip","Please {0} to enable this extension.",s)}}}}}getPrimaryExtension(e){if(e.length===1)return e[0];const t=e.filter(r=>r.local&&this.extensionEnablementService.isEnabled(r.local));if(t.length===1)return t[0];const i=t.length?t:e,n=i.find(r=>r.local&&r.local.manifest)?.local?.manifest;if(!n)return i[0];const s=this.extensionManifestPropertiesService.getExtensionKind(n);let o=i.find(r=>{for(const a of s)switch(a){case"ui":return r.server===this.extensionManagementServerService.localExtensionManagementServer;case"workspace":return r.server===this.extensionManagementServerService.remoteExtensionManagementServer;case"web":return r.server===this.extensionManagementServerService.webExtensionManagementServer}return!1});return!o&&this.extensionManagementServerService.localExtensionManagementServer&&(o=i.find(r=>{for(const a of s)switch(a){case"workspace":return r.server===this.extensionManagementServerService.localExtensionManagementServer;case"web":return r.server===this.extensionManagementServerService.localExtensionManagementServer}return!1})),!o&&this.extensionManagementServerService.webExtensionManagementServer&&(o=i.find(r=>{for(const a of s)switch(a){case"web":return r.server===this.extensionManagementServerService.webExtensionManagementServer}return!1})),!o&&this.extensionManagementServerService.remoteExtensionManagementServer&&(o=i.find(r=>{for(const a of s)switch(a){case"web":return r.server===this.extensionManagementServerService.remoteExtensionManagementServer}return!1})),o||e[0]}getExtensionState(e){if(this.installing.some(t=>c(t.identifier,e.identifier)&&(!e.server||t.server===e.server)))return v.Installing;if(this.remoteExtensions){const t=this.remoteExtensions.getExtensionState(e);if(t!==v.Uninstalled)return t}if(this.webExtensions){const t=this.webExtensions.getExtensionState(e);if(t!==v.Uninstalled)return t}return this.localExtensions?this.localExtensions.getExtensionState(e):v.Uninstalled}async checkForUpdates(e){if(!this.galleryService.isEnabled())return;const t=[];if(this.localExtensions&&t.push(this.localExtensions),this.remoteExtensions&&t.push(this.remoteExtensions),this.webExtensions&&t.push(this.webExtensions),!t.length)return;const i=[];for(const n of this.local)e&&!n.isBuiltin||n.isBuiltin&&!n.local?.pinned&&(n.type===b.System||!n.local?.identifier.uuid)||n.local?.source!=="resource"&&i.push({...n.identifier,preRelease:!!n.local?.preRelease});if(i.length){const n=await t[0].server.extensionManagementService.getTargetPlatform();this.telemetryService.publicLog2("galleryService:checkingForUpdates",{count:i.length});const s=await this.galleryService.getExtensions(i,{targetPlatform:n,compatible:!0,productVersion:this.getProductVersion()},m.None);s.length&&await this.syncInstalledExtensionsWithGallery(s)}}async updateAll(){const e=[];return this.outdated.forEach(t=>{t.gallery&&e.push({extension:t.gallery,options:{operation:_e.Update,installPreReleaseVersion:t.local?.isPreReleaseVersion,profileLocation:this.userDataProfileService.currentProfile.extensionsResource,isApplicationScoped:t.local?.isApplicationScoped}})}),this.extensionManagementService.installGalleryExtensions(e)}async syncInstalledExtensionsWithGallery(e){const t=[];this.localExtensions&&t.push(this.localExtensions),this.remoteExtensions&&t.push(this.remoteExtensions),this.webExtensions&&t.push(this.webExtensions),t.length&&(await Promise.allSettled(t.map(i=>i.syncInstalledExtensionsWithGallery(e,this.getProductVersion()))),this.outdated.length&&this.eventuallyAutoUpdateExtensions())}isAutoCheckUpdatesEnabled(){return this.configurationService.getValue(pe)}eventuallyCheckForUpdates(e=!1){this.updatesCheckDelayer.cancel(),this.updatesCheckDelayer.trigger(async()=>{this.isAutoCheckUpdatesEnabled()&&await this.checkForUpdates(),this.eventuallyCheckForUpdates()},e?0:this.getUpdatesCheckInterval()).then(void 0,t=>null)}getUpdatesCheckInterval(){return this.productService.quality==="insider"&&this.getProductUpdateVersion()?1e3*60*60*1:C.UpdatesCheckInterval}eventuallyAutoUpdateExtensions(){this.autoUpdateDelayer.trigger(()=>this.autoUpdateExtensions()).then(void 0,e=>null)}async autoUpdateBuiltinExtensions(){await this.checkForUpdates(!0);const e=this.outdated.filter(t=>t.isBuiltin);await ee.settled(e.map(t=>this.install(t,t.local?.preRelease?{installPreReleaseVersion:!0}:void 0)))}async syncPinnedBuiltinExtensions(){const e=[];for(const t of this.local)t.isBuiltin&&t.local?.pinned&&t.local?.identifier.uuid&&e.push({...t.identifier,version:t.version});if(e.length){const t=await this.galleryService.getExtensions(e,m.None);t.length&&await this.syncInstalledExtensionsWithGallery(t)}}async autoUpdateExtensions(){const e=[];for(const i of this.outdated)this.shouldAutoUpdateExtension(i)&&(await this.shouldRequireConsentToUpdate(i)||e.push(i));if(!e.length)return;const t=this.getProductVersion();await ee.settled(e.map(i=>this.install(i,i.local?.preRelease?{installPreReleaseVersion:!0,productVersion:t}:{productVersion:t})))}getProductVersion(){return this.getProductUpdateVersion()??this.getProductCurrentVersion()}getProductCurrentVersion(){return{version:this.productService.version,date:this.productService.date}}getProductUpdateVersion(){switch(this.updateService.state.type){case S.AvailableForDownload:case S.Downloaded:case S.Updating:case S.Ready:{const e=this.updateService.state.update.productVersion;if(e&&F.valid(e))return{version:e,date:this.updateService.state.update.timestamp?new Date(this.updateService.state.update.timestamp).toISOString():void 0}}}}shouldAutoUpdateExtension(e){if(e.deprecationInfo?.disallowInstall)return!1;const t=this.getAutoUpdateValue();if(t===!1){const n=this.getEnabledAutoUpdateExtensions(),s=e.identifier.id.toLowerCase();return!!(n.includes(s)||this.isAutoUpdateEnabledForPublisher(e.publisher)&&!n.includes(`-${s}`))}return e.pinned||this.getDisabledAutoUpdateExtensions().includes(e.identifier.id.toLowerCase())?!1:t===!0?!0:t==="onlyEnabledExtensions"?this.extensionEnablementService.isEnabledEnablementState(e.enablementState):!1}async shouldRequireConsentToUpdate(e){if(e.outdated&&!(e.local?.manifest.main||e.local?.manifest.browser)&&e.gallery){if(Ce(e.gallery.properties?.executesCode)){if(!e.gallery.properties.executesCode)return}else{const t=e instanceof y?await e.getGalleryManifest():await this.galleryService.getManifest(e.gallery,m.None);if(!t?.main&&!t?.browser)return}return l.localize("consentRequiredToUpdate","The update for {0} extension introduces executable code, which is not present in the currently installed version.",e.displayName)}}isAutoUpdateEnabledFor(e){if(I(e)){if(z.test(e))throw new Error("Expected publisher string, found extension identifier");return this.isAutoUpdateEnabled()?!0:this.isAutoUpdateEnabledForPublisher(e)}return this.shouldAutoUpdateExtension(e)}isAutoUpdateEnabledForPublisher(e){return this.getPublishersToAutoUpdate().includes(e.toLowerCase())}async updateAutoUpdateEnablementFor(e,t){if(this.isAutoUpdateEnabled()){if(I(e))throw new Error("Expected extension, found publisher string");const i=this.getDisabledAutoUpdateExtensions(),n=e.identifier.id.toLowerCase(),s=i.indexOf(n);t?s!==-1&&i.splice(s,1):s===-1&&i.push(n),this.setDisabledAutoUpdateExtensions(i),t&&e.local&&e.pinned&&await this.extensionManagementService.updateMetadata(e.local,{pinned:!1}),this._onChange.fire(e)}else{const i=this.getEnabledAutoUpdateExtensions();if(I(e)){if(z.test(e))throw new Error("Expected publisher string, found extension identifier");e=e.toLowerCase(),this.isAutoUpdateEnabledFor(e)!==t&&(t?i.push(e):i.includes(e)&&i.splice(i.indexOf(e),1)),this.setEnabledAutoUpdateExtensions(i);for(const n of this.installed)n.publisher.toLowerCase()===e&&this._onChange.fire(n)}else{const n=e.identifier.id.toLowerCase(),s=this.isAutoUpdateEnabledFor(e.publisher.toLowerCase()),o=i.includes(n),r=i.includes(`-${n}`);t?(r&&i.splice(i.indexOf(`-${n}`),1),s?o&&i.splice(i.indexOf(n),1):o||i.push(n)):(o&&i.splice(i.indexOf(n),1),s?r||i.push(`-${n}`):r&&i.splice(i.indexOf(`-${n}`),1)),this.setEnabledAutoUpdateExtensions(i),this._onChange.fire(e)}}t&&this.autoUpdateExtensions()}onDidSelectedExtensionToAutoUpdateValueChange(){if(this.enabledAuotUpdateExtensionsValue!==this.getEnabledAutoUpdateExtensionsValue()||this.disabledAutoUpdateExtensionsValue!==this.getDisabledAutoUpdateExtensionsValue()){const e=this.installed.filter(r=>!r.isBuiltin),t=r=>{const a=[],h=[];for(const p of r)this.shouldAutoUpdateExtension(p)?a.push(p):h.push(p);return[a,h]},[i,n]=t(e);this._enabledAutoUpdateExtensionsValue=void 0,this._disabledAutoUpdateExtensionsValue=void 0;const[s,o]=t(e);for(const r of i??[])o?.includes(r)&&this._onChange.fire(r);for(const r of n??[])s?.includes(r)&&this._onChange.fire(r)}}async canInstall(e){return!(e instanceof y)||e.isMalicious||e.deprecationInfo?.disallowInstall?!1:e.gallery?!!(this.localExtensions&&await this.localExtensions.canInstall(e.gallery)||this.remoteExtensions&&await this.remoteExtensions.canInstall(e.gallery)||this.webExtensions&&await this.webExtensions.canInstall(e.gallery)):!!(e.resourceExtension&&await this.extensionManagementService.canInstall(e.resourceExtension))}async install(e,t={},i){let n,s;if(e instanceof w)n=e;else{let o,r;if(I(e)?(s=this.local.find(a=>c(a.identifier,{id:e})),s?.isBuiltin||(o={id:e,version:t.version,preRelease:t.installPreReleaseVersion??this.preferPreReleases})):e.gallery?(s=e,r=e.gallery,t.version&&t.version!==r?.version&&(o={id:s.identifier.id,version:t.version})):e.resourceExtension&&(s=e,n=e.resourceExtension),o){const a=s?.server?await s.server.extensionManagementService.getTargetPlatform():void 0;r=(await this.galleryService.getExtensions([o],{targetPlatform:a},m.None)).at(0)}if(!s&&r&&(s=this.instantiationService.createInstance(y,a=>this.getExtensionState(a),a=>this.getRuntimeState(a),void 0,void 0,r,void 0),s.setExtensionsControlManifest(await this.extensionManagementService.getExtensionsControlManifest())),s?.isMalicious)throw new Error(l.localize("malicious","This extension is reported to be problematic."));if(!(t.enable&&s?.local)){if(!n){if(!r){const a=I(e)?e:e.identifier.id;throw t.version?new Error(l.localize("not found version","Unable to install extension '{0}' because the requested version '{1}' is not found.",a,t.version)):new Error(l.localize("not found","Unable to install extension '{0}' because it is not found.",a))}n=r}t.version&&(t.installGivenVersion=!0),s?.isWorkspaceScoped&&(t.isWorkspaceScoped=!0)}}if(n){if(t.justification){const o=W(t.isMachineScoped)&&this.userDataSyncEnablementService.isEnabled()&&this.userDataSyncEnablementService.isResourceEnabled(Ze.Extensions),r=[];r.push({label:I(t.justification)||!t.justification.action?l.localize({key:"installButtonLabel",comment:["&& denotes a mnemonic"]},"&&Install Extension"):l.localize({key:"installButtonLabelWithAction",comment:["&& denotes a mnemonic"]},"&&Install Extension and {0}",t.justification.action),run:()=>!0}),s||r.push({label:l.localize("open","Open Extension"),run:()=>(this.open(s),!1)});const a=await this.dialogService.prompt({title:l.localize("installExtensionTitle","Install Extension"),message:s?l.localize("installExtensionMessage","Would you like to install '{0}' extension from '{1}'?",s.displayName,s.publisherDisplayName):l.localize("installVSIXMessage","Would you like to install the extension?"),detail:I(t.justification)?t.justification:t.justification.reason,cancelButton:!0,buttons:r,checkbox:o?{label:l.localize("sync extension","Sync this extension"),checked:!0}:void 0});if(!a.result)throw new V;o&&(t.isMachineScoped=!a.checkboxChecked)}n instanceof w?s=await this.doInstall(void 0,()=>this.installFromVSIX(n,t),i):s&&(s.resourceExtension?s=await this.doInstall(s,()=>this.extensionManagementService.installResourceExtension(n,t),i):s=await this.doInstall(s,()=>this.installFromGallery(s,n,t),i))}if(!s)throw new Error(l.localize("unknown","Unable to install extension"));if(t.enable){if(s.enablementState===x.DisabledWorkspace||s.enablementState===x.DisabledGlobally){if(t.justification&&!(await this.dialogService.confirm({title:l.localize("enableExtensionTitle","Enable Extension"),message:l.localize("enableExtensionMessage","Would you like to enable '{0}' extension?",s.displayName),detail:I(t.justification)?t.justification:t.justification.reason,primaryButton:I(t.justification)?l.localize({key:"enableButtonLabel",comment:["&& denotes a mnemonic"]},"&&Enable Extension"):l.localize({key:"enableButtonLabelWithAction",comment:["&& denotes a mnemonic"]},"&&Enable Extension and {0}",t.justification.action)})).confirmed)throw new V;await this.setEnablement(s,s.enablementState===x.DisabledWorkspace?x.EnabledWorkspace:x.EnabledGlobally)}await this.waitUntilExtensionIsEnabled(s)}return s}async installInServer(e,t){await this.doInstall(e,async()=>{const i=e.local;if(!i)throw new Error("Extension not found");if(e.gallery||(e=(await this.getExtensions([{...e.identifier,preRelease:i.preRelease}],m.None))[0]??e),e.gallery)return t.extensionManagementService.installFromGallery(e.gallery,{installPreReleaseVersion:i.preRelease});const n=await t.extensionManagementService.getTargetPlatform();if(!Le(i.targetPlatform,[i.targetPlatform],n))throw new Error(l.localize("incompatible","Can't install '{0}' extension because it is not compatible.",e.identifier.id));const s=await this.extensionManagementService.zip(i);try{return await t.extensionManagementService.install(s)}finally{try{await this.fileService.del(s)}catch(o){this.logService.error(o)}}})}canSetLanguage(e){return!(!ne||!e.gallery||!ae(e.gallery))}async setLanguage(e){if(!this.canSetLanguage(e))throw new Error("Can not set language");const t=ae(e.gallery);if(t===Ue)return;const i=e.gallery?.properties?.localizedLanguages?.[0];return this.localeService.setLocale({id:t,galleryExtension:e.gallery,extensionId:e.identifier.id,label:i??e.displayName})}setEnablement(e,t){return e=Array.isArray(e)?e:[e],this.promptAndSetEnablement(e,t)}async uninstall(e){const t=e.local?e:this.local.find(s=>c(s.identifier,e.identifier));if(!t?.local)throw new Error("Missing local");const i=[{extension:t.local}];for(const s of this.getAllPackExtensionsToUninstall(t.local,this.local))i.some(o=>c(o.extension.identifier,s.identifier))||i.push({extension:s});const n=[];for(const{extension:s}of i)for(const o of this.local)o.local&&(c(o.identifier,s.identifier)||o.dependencies.length!==0&&(s.manifest.extensionPack?.some(r=>c({id:r},o.identifier))||n.some(r=>r.extensionPack.some(a=>c({id:a},o.identifier)))||o.dependencies.some(r=>c(s.identifier,{id:r}))&&(n.push(o),i.push({extension:o.local}))));if(n.length){const{result:s}=await this.dialogService.prompt({title:l.localize("uninstallDependents","Uninstall Extension with Dependents"),type:M.Warning,message:this.getErrorMessageForUninstallingAnExtensionWithDependents(t,n),buttons:[{label:l.localize("uninstallAll","Uninstall All"),run:()=>!0}],cancelButton:{run:()=>!1}});if(!s)throw new V}return this.withProgress({location:N.Extensions,title:l.localize("uninstallingExtension","Uninstalling extension...."),source:`${t.identifier.id}`},()=>this.extensionManagementService.uninstallExtensions(i).then(()=>{}))}getAllPackExtensionsToUninstall(e,t,i=[]){if(i.some(s=>c(s.identifier,e.identifier)))return[];i.push(e);const n=e.manifest.extensionPack??[];if(n.length){const s=[];for(const r of t)r.local&&!r.isBuiltin&&n.some(a=>c({id:a},r.identifier))&&s.push(r.local);const o=[];for(const r of s)o.push(...this.getAllPackExtensionsToUninstall(r,t,i));return[...s,...o]}return[]}getErrorMessageForUninstallingAnExtensionWithDependents(e,t){return t.length===1?l.localize("singleDependentUninstallError","Cannot uninstall '{0}' extension alone. '{1}' extension depends on this. Do you want to uninstall all these extensions?",e.displayName,t[0].displayName):t.length===2?l.localize("twoDependentsUninstallError","Cannot uninstall '{0}' extension alone. '{1}' and '{2}' extensions depend on this. Do you want to uninstall all these extensions?",e.displayName,t[0].displayName,t[1].displayName):l.localize("multipleDependentsUninstallError","Cannot uninstall '{0}' extension alone. '{1}', '{2}' and other extensions depend on this. Do you want to uninstall all these extensions?",e.displayName,t[0].displayName,t[1].displayName)}reinstall(e){return this.doInstall(e,()=>{const t=e.local?e:this.local.filter(n=>c(n.identifier,e.identifier))[0],i=t&&t.local?t.local:null;if(!i)throw new Error("Missing local");return this.extensionManagementService.reinstallFromGallery(i)})}isExtensionIgnoredToSync(e){return e.local?!this.isInstalledExtensionSynced(e.local):this.extensionsSyncManagementService.hasToNeverSyncExtension(e.identifier.id)}async togglePreRelease(e){if(e.local){if(e.preRelease!==e.isPreReleaseVersion){await this.extensionManagementService.updateMetadata(e.local,{preRelease:!e.preRelease});return}await this.install(e,{installPreReleaseVersion:!e.preRelease,preRelease:!e.preRelease})}}async toggleExtensionIgnoredToSync(e){const t=this.isExtensionIgnoredToSync(e);e.local&&t?(e.local=await this.updateSynchronizingInstalledExtension(e.local,!0),this._onChange.fire(e)):this.extensionsSyncManagementService.updateIgnoredExtensions(e.identifier.id,!t),await this.userDataAutoSyncService.triggerSync(["IgnoredExtensionsUpdated"],!1,!1)}async toggleApplyExtensionToAllProfiles(e){if(!e.local||We(e.local.manifest)||e.isBuiltin)return;const t=e.local.isApplicationScoped;await Promise.all(this.getAllExtensions().map(async i=>{const n=i.local.find(s=>c(s.identifier,e.identifier))?.local;n&&n.isApplicationScoped===t&&await this.extensionManagementService.toggleAppliationScope(n,this.userDataProfileService.currentProfile.extensionsResource)}))}getAllExtensions(){const e=[];return this.localExtensions&&e.push(this.localExtensions),this.remoteExtensions&&e.push(this.remoteExtensions),this.webExtensions&&e.push(this.webExtensions),e}isInstalledExtensionSynced(e){return e.isMachineScoped?!1:this.extensionsSyncManagementService.hasToAlwaysSyncExtension(e.identifier.id)?!0:!this.extensionsSyncManagementService.hasToNeverSyncExtension(e.identifier.id)}async updateSynchronizingInstalledExtension(e,t){const i=!t;return e.isMachineScoped!==i&&(e=await this.extensionManagementService.updateMetadata(e,{isMachineScoped:i})),t&&this.extensionsSyncManagementService.updateIgnoredExtensions(e.identifier.id,!1),e}doInstall(e,t,i){const n=e?l.localize("installing named extension","Installing '{0}' extension....",e.displayName):l.localize("installing extension","Installing extension....");return this.withProgress({location:i??N.Extensions,title:n},async()=>{try{e&&(this.installing.push(e),this._onChange.fire(e));const s=await t();return await this.waitAndGetInstalledExtension(s.identifier)}finally{e&&(this.installing=this.installing.filter(s=>s!==e),this._onChange.fire(void 0))}})}async installFromVSIX(e,t){const i=await this.extensionManagementService.getManifest(e),n=this.local.find(s=>c(s.identifier,{id:Ne(i.publisher,i.name)}));return n&&(t=t||{},n.latestVersion===i.version?t.pinned=n.local?.pinned||!this.shouldAutoUpdateExtension(n):t.installGivenVersion=!0),this.extensionManagementService.installVSIX(e,i,t)}installFromGallery(e,t,i){return i=i??{},i.pinned=e.local?.pinned||!this.shouldAutoUpdateExtension(e),e.local?(i.productVersion=this.getProductVersion(),this.extensionManagementService.updateFromGallery(t,e.local,i)):this.extensionManagementService.installFromGallery(t,i)}async waitAndGetInstalledExtension(e){let t=this.local.find(i=>c(i.identifier,e));if(t||await k.toPromise(k.filter(this.onChange,i=>!!i&&this.local.some(n=>c(n.identifier,e)))),t=this.local.find(i=>c(i.identifier,e)),!t)throw new Error("Extension should have been installed");return t}async waitUntilExtensionIsEnabled(e){this.extensionService.extensions.find(t=>O.equals(t.identifier,e.identifier.id))||!e.local||!this.extensionService.canAddExtension(H(e.local))||await new Promise((t,i)=>{const n=this.extensionService.onDidChangeExtensions(()=>{try{this.extensionService.extensions.find(s=>O.equals(s.identifier,e.identifier.id))&&(n.dispose(),t())}catch(s){i(s)}})})}promptAndSetEnablement(e,t){if(t===x.EnabledGlobally||t===x.EnabledWorkspace){const n=this.getExtensionsRecursively(e,this.local,t,{dependencies:!0,pack:!0});return this.checkAndSetEnablement(e,n,t)}else{const n=this.getExtensionsRecursively(e,this.local,t,{dependencies:!1,pack:!0});return n.length?this.checkAndSetEnablement(e,n,t):this.checkAndSetEnablement(e,[],t)}}async checkAndSetEnablement(e,t,i){const n=[...e,...t];if(!(i===x.EnabledGlobally||i===x.EnabledWorkspace))for(const o of e){const r=this.getDependentsAfterDisablement(o,n,this.local);if(r.length){const{result:a}=await this.dialogService.prompt({title:l.localize("disableDependents","Disable Extension with Dependents"),type:M.Warning,message:this.getDependentsErrorMessageForDisablement(o,n,r),buttons:[{label:l.localize("disable all","Disable All"),run:()=>!0}],cancelButton:{run:()=>!1}});if(!a)throw new V;await this.checkAndSetEnablement(r,[o],i)}}return this.doSetEnablement(n,i)}getExtensionsRecursively(e,t,i,n,s=[]){const o=e.filter(r=>s.indexOf(r)===-1);if(o.length){for(const a of o)s.push(a);const r=t.filter(a=>{if(s.indexOf(a)!==-1)return!1;const h=i===x.EnabledGlobally||i===x.EnabledWorkspace,p=a.enablementState===x.EnabledGlobally||a.enablementState===x.EnabledWorkspace;return h===p?!1:(h||!a.isBuiltin)&&(n.dependencies||n.pack)&&e.some(f=>n.dependencies&&f.dependencies.some(g=>c({id:g},a.identifier))||n.pack&&f.extensionPack.some(g=>c({id:g},a.identifier)))});return r.length&&r.push(...this.getExtensionsRecursively(r,t,i,n,s)),r}return[]}getDependentsAfterDisablement(e,t,i){return i.filter(n=>n.dependencies.length===0||n===e||!this.extensionEnablementService.isEnabledEnablementState(n.enablementState)||t.indexOf(n)!==-1?!1:n.dependencies.some(s=>[e,...t].some(o=>c(o.identifier,{id:s}))))}getDependentsErrorMessageForDisablement(e,t,i){for(const n of[e,...t]){const s=i.filter(o=>o.dependencies.some(r=>c({id:r},n.identifier)));if(s.length)return this.getErrorMessageForDisablingAnExtensionWithDependents(n,s)}return""}getErrorMessageForDisablingAnExtensionWithDependents(e,t){return t.length===1?l.localize("singleDependentError","Cannot disable '{0}' extension alone. '{1}' extension depends on this. Do you want to disable all these extensions?",e.displayName,t[0].displayName):t.length===2?l.localize("twoDependentsError","Cannot disable '{0}' extension alone. '{1}' and '{2}' extensions depend on this. Do you want to disable all these extensions?",e.displayName,t[0].displayName,t[1].displayName):l.localize("multipleDependentsError","Cannot disable '{0}' extension alone. '{1}', '{2}' and other extensions depend on this. Do you want to disable all these extensions?",e.displayName,t[0].displayName,t[1].displayName)}async doSetEnablement(e,t){const i=await this.extensionEnablementService.setEnablement(e.map(n=>n.local),t);for(let n=0;n<i.length;n++)i[n]&&this.telemetryService.publicLog(t===x.EnabledGlobally||t===x.EnabledWorkspace?"extension:enable":"extension:disable",e[n].telemetryData);return i}_activityCallBack;reportProgressFromOtherSources(){this.installed.some(e=>e.state===v.Installing||e.state===v.Uninstalling)?this._activityCallBack||this.withProgress({location:N.Extensions},()=>new Promise(e=>this._activityCallBack=e)):(this._activityCallBack?.(),this._activityCallBack=void 0)}withProgress(e,t){return this.progressService.withProgress(e,async()=>{const i=ye(()=>t());this.tasksInProgress.push(i);try{return await i}finally{const n=this.tasksInProgress.indexOf(i);n!==-1&&this.tasksInProgress.splice(n,1)}})}onError(e){if(Se(e))return;const t=e&&e.message||"";/getaddrinfo ENOTFOUND|getaddrinfo ENOENT|connect EACCES|connect ECONNREFUSED/.test(t)||this.notificationService.error(e)}handleURL(e,t){return/^extension/.test(e.path)?(this.onOpenExtensionUrl(e),Promise.resolve(!0)):Promise.resolve(!1)}onOpenExtensionUrl(e){const t=/^extension\/([^/]+)$/.exec(e.path);if(!t)return;const i=t[1];this.queryLocal().then(async n=>{let s=n.find(o=>c(o.identifier,{id:i}));s||([s]=await this.getExtensions([{id:i}],{source:"uri"},m.None)),s&&(await this.hostService.focus(me),await this.open(s))}).then(void 0,n=>this.onError(n))}getPublishersToAutoUpdate(){return this.getEnabledAutoUpdateExtensions().filter(e=>!z.test(e))}getEnabledAutoUpdateExtensions(){try{const e=JSON.parse(this.enabledAuotUpdateExtensionsValue);if(Array.isArray(e))return e}catch{}return[]}setEnabledAutoUpdateExtensions(e){this.enabledAuotUpdateExtensionsValue=JSON.stringify(e)}_enabledAutoUpdateExtensionsValue;get enabledAuotUpdateExtensionsValue(){return this._enabledAutoUpdateExtensionsValue||(this._enabledAutoUpdateExtensionsValue=this.getEnabledAutoUpdateExtensionsValue()),this._enabledAutoUpdateExtensionsValue}set enabledAuotUpdateExtensionsValue(e){this.enabledAuotUpdateExtensionsValue!==e&&(this._enabledAutoUpdateExtensionsValue=e,this.setEnabledAutoUpdateExtensionsValue(e))}getEnabledAutoUpdateExtensionsValue(){return this.storageService.get(Q,R.APPLICATION,"[]")}setEnabledAutoUpdateExtensionsValue(e){this.storageService.store(Q,e,R.APPLICATION,de.USER)}getDisabledAutoUpdateExtensions(){try{const e=JSON.parse(this.disabledAutoUpdateExtensionsValue);if(Array.isArray(e))return e}catch{}return[]}setDisabledAutoUpdateExtensions(e){this.disabledAutoUpdateExtensionsValue=JSON.stringify(e)}_disabledAutoUpdateExtensionsValue;get disabledAutoUpdateExtensionsValue(){return this._disabledAutoUpdateExtensionsValue||(this._disabledAutoUpdateExtensionsValue=this.getDisabledAutoUpdateExtensionsValue()),this._disabledAutoUpdateExtensionsValue}set disabledAutoUpdateExtensionsValue(e){this.disabledAutoUpdateExtensionsValue!==e&&(this._disabledAutoUpdateExtensionsValue=e,this.setDisabledAutoUpdateExtensionsValue(e))}getDisabledAutoUpdateExtensionsValue(){return this.storageService.get(J,R.APPLICATION,"[]")}setDisabledAutoUpdateExtensionsValue(e){this.storageService.store(J,e,R.APPLICATION,de.USER)}};C=_([u(0,re),u(1,it),u(2,he),u(3,B),u(4,Me),u(5,K),u(6,ze),u(7,Xe),u(8,ue),u(9,ct),u(10,qe),u(11,ot),u(12,Ae),u(13,Qe),u(14,Je),u(15,ce),u(16,De),u(17,at),u(18,le),u(19,lt),u(20,ht),u(21,dt),u(22,oe),u(23,fe),u(24,$e),u(25,ke),u(26,Ye),u(27,je),u(28,He),u(29,et),u(30,ft)],C);export{y as Extension,C as ExtensionsWorkbenchService};
