var w=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var W=(d,s,i,a)=>{for(var n=a>1?void 0:a?b(s,i):s,h=d.length-1,f;h>=0;h--)(f=d[h])&&(n=(a?f(s,i,n):f(n))||n);return a&&n&&w(s,i,n),n},u=(d,s)=>(i,a)=>s(i,a,d);import{KeyCode as o,KeyMod as r}from"../../../../../base/common/keyCodes.js";import{Lazy as F}from"../../../../../base/common/lazy.js";import{Disposable as I}from"../../../../../base/common/lifecycle.js";import{localize2 as l}from"../../../../../nls.js";import{ContextKeyExpr as c}from"../../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as C}from"../../../../../platform/instantiation/common/instantiation.js";import{KeybindingWeight as m}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{findInFilesCommand as v}from"../../../search/browser/searchActionsFind.js";import{ITerminalService as T,isDetachedTerminalInstance as k}from"../../../terminal/browser/terminal.js";import{registerActiveInstanceAction as _,registerActiveXtermAction as p}from"../../../terminal/browser/terminalActions.js";import{registerTerminalContribution as S}from"../../../terminal/browser/terminalExtensions.js";import{TerminalContextKeys as e}from"../../../terminal/common/terminalContextKey.js";import{TerminalFindCommandId as g}from"../common/terminal.find.js";import{TerminalFindWidget as x}from"./terminalFindWidget.js";import"./media/terminalFind.css";let t=class extends I{constructor(i,a,n,h,f){super();this._instance=i;this._findWidget=new F(()=>{const y=h.createInstance(x,this._instance);if(y.focusTracker.onDidFocus(()=>{t.activeFindWidget=this,this._instance.forceScrollbarVisibility(),k(this._instance)||f.setActiveInstance(this._instance)}),y.focusTracker.onDidBlur(()=>{t.activeFindWidget=void 0,this._instance.resetScrollbarVisibility()}),!this._instance.domElement)throw new Error("FindWidget expected terminal DOM to be initialized");return this._instance.domElement?.appendChild(y.getDomNode()),this._lastLayoutDimensions&&y.layout(this._lastLayoutDimensions.width),y})}static ID="terminal.find";static activeFindWidget;static get(i){return i.getContribution(t.ID)}_findWidget;_lastLayoutDimensions;get findWidget(){return this._findWidget.value}layout(i,a){this._lastLayoutDimensions=a,this._findWidget.rawValue?.layout(a.width)}xtermReady(i){this._register(i.onDidChangeFindResults(()=>this._findWidget.rawValue?.updateResultCount()))}dispose(){t.activeFindWidget===this&&(t.activeFindWidget=void 0),super.dispose(),this._findWidget.rawValue?.dispose()}};t=W([u(3,C),u(4,T)],t),S(t.ID,t,!0),p({id:g.FindFocus,title:l("workbench.action.terminal.focusFind","Focus Find"),keybinding:{primary:r.CtrlCmd|o.KeyF,when:c.or(e.findFocus,e.focusInAny),weight:m.WorkbenchContrib},precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{(t.activeFindWidget||t.get(i))?.findWidget.reveal()}}),p({id:g.FindHide,title:l("workbench.action.terminal.hideFind","Hide Find"),keybinding:{primary:o.Escape,secondary:[r.Shift|o.Escape],when:c.and(e.focusInAny,e.findVisible),weight:m.WorkbenchContrib},precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{(t.activeFindWidget||t.get(i))?.findWidget.hide()}}),p({id:g.ToggleFindRegex,title:l("workbench.action.terminal.toggleFindRegex","Toggle Find Using Regex"),keybinding:{primary:r.Alt|o.KeyR,mac:{primary:r.CtrlCmd|r.Alt|o.KeyR},when:e.findVisible,weight:m.WorkbenchContrib},precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{const n=(t.activeFindWidget||t.get(i))?.findWidget.state;n?.change({isRegex:!n.isRegex},!1)}}),p({id:g.ToggleFindWholeWord,title:l("workbench.action.terminal.toggleFindWholeWord","Toggle Find Using Whole Word"),keybinding:{primary:r.Alt|o.KeyW,mac:{primary:r.CtrlCmd|r.Alt|o.KeyW},when:e.findVisible,weight:m.WorkbenchContrib},precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{const n=(t.activeFindWidget||t.get(i))?.findWidget.state;n?.change({wholeWord:!n.wholeWord},!1)}}),p({id:g.ToggleFindCaseSensitive,title:l("workbench.action.terminal.toggleFindCaseSensitive","Toggle Find Using Case Sensitive"),keybinding:{primary:r.Alt|o.KeyC,mac:{primary:r.CtrlCmd|r.Alt|o.KeyC},when:e.findVisible,weight:m.WorkbenchContrib},precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{const n=(t.activeFindWidget||t.get(i))?.findWidget.state;n?.change({matchCase:!n.matchCase},!1)}}),p({id:g.FindNext,title:l("workbench.action.terminal.findNext","Find Next"),keybinding:[{primary:o.F3,mac:{primary:r.CtrlCmd|o.KeyG,secondary:[o.F3]},when:c.or(e.focusInAny,e.findFocus),weight:m.WorkbenchContrib},{primary:r.Shift|o.Enter,when:e.findInputFocus,weight:m.WorkbenchContrib}],precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{const n=(t.activeFindWidget||t.get(i))?.findWidget;n&&(n.show(),n.find(!1))}}),p({id:g.FindPrevious,title:l("workbench.action.terminal.findPrevious","Find Previous"),keybinding:[{primary:r.Shift|o.F3,mac:{primary:r.CtrlCmd|r.Shift|o.KeyG,secondary:[r.Shift|o.F3]},when:c.or(e.focusInAny,e.findFocus),weight:m.WorkbenchContrib},{primary:o.Enter,when:e.findInputFocus,weight:m.WorkbenchContrib}],precondition:c.or(e.processSupported,e.terminalHasBeenCreated),run:(d,s,i)=>{const n=(t.activeFindWidget||t.get(i))?.findWidget;n&&(n.show(),n.find(!0))}}),_({id:g.SearchWorkspace,title:l("workbench.action.terminal.searchWorkspace","Search Workspace"),keybinding:[{primary:r.CtrlCmd|r.Shift|o.KeyF,when:c.and(e.processSupported,e.focus,e.textSelected),weight:m.WorkbenchContrib+50}],run:(d,s,i)=>v(i,{query:d.selection})});
