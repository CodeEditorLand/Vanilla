{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/find/browser/terminalFindWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { SimpleFindWidget } from '../../../codeEditor/browser/find/simpleFindWidget.js';\nimport { IContextMenuService, IContextViewService } from '../../../../../platform/contextview/browser/contextView.js';\nimport { IContextKeyService, IContextKey } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { IDetachedTerminalInstance, ITerminalInstance, IXtermTerminal, XtermTerminalConstants } from '../../../terminal/browser/terminal.js';\nimport { TerminalContextKeys } from '../../../terminal/common/terminalContextKey.js';\nimport { IThemeService } from '../../../../../platform/theme/common/themeService.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IKeybindingService } from '../../../../../platform/keybinding/common/keybinding.js';\nimport { Event } from '../../../../../base/common/event.js';\nimport type { ISearchOptions } from '@xterm/addon-search';\nimport { IClipboardService } from '../../../../../platform/clipboard/common/clipboardService.js';\nimport { openContextMenu } from './textInputContextMenu.js';\nimport { IDisposable } from '../../../../../base/common/lifecycle.js';\nimport { IHoverService } from '../../../../../platform/hover/browser/hover.js';\nimport { TerminalFindCommandId } from '../common/terminal.find.js';\n\nconst TERMINAL_FIND_WIDGET_INITIAL_WIDTH = 419;\n\nexport class TerminalFindWidget extends SimpleFindWidget {\n\tprivate _findInputFocused: IContextKey<boolean>;\n\tprivate _findWidgetFocused: IContextKey<boolean>;\n\tprivate _findWidgetVisible: IContextKey<boolean>;\n\n\tprivate _overrideCopyOnSelectionDisposable: IDisposable | undefined;\n\n\tconstructor(\n\t\tprivate _instance: ITerminalInstance | IDetachedTerminalInstance,\n\t\t@IContextViewService _contextViewService: IContextViewService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IContextMenuService _contextMenuService: IContextMenuService,\n\t\t@IClipboardService _clipboardService: IClipboardService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper({\n\t\t\tshowCommonFindToggles: true,\n\t\t\tcheckImeCompletionState: true,\n\t\t\tshowResultCount: true,\n\t\t\tinitialWidth: TERMINAL_FIND_WIDGET_INITIAL_WIDTH,\n\t\t\tenableSash: true,\n\t\t\tappendCaseSensitiveActionId: TerminalFindCommandId.ToggleFindCaseSensitive,\n\t\t\tappendRegexActionId: TerminalFindCommandId.ToggleFindRegex,\n\t\t\tappendWholeWordsActionId: TerminalFindCommandId.ToggleFindWholeWord,\n\t\t\tpreviousMatchActionId: TerminalFindCommandId.FindPrevious,\n\t\t\tnextMatchActionId: TerminalFindCommandId.FindNext,\n\t\t\tcloseWidgetActionId: TerminalFindCommandId.FindHide,\n\t\t\ttype: 'Terminal',\n\t\t\tmatchesLimit: XtermTerminalConstants.SearchHighlightLimit\n\t\t}, _contextViewService, _contextKeyService, hoverService, keybindingService);\n\n\t\tthis._register(this.state.onFindReplaceStateChange(() => {\n\t\t\tthis.show();\n\t\t}));\n\t\tthis._findInputFocused = TerminalContextKeys.findInputFocus.bindTo(this._contextKeyService);\n\t\tthis._findWidgetFocused = TerminalContextKeys.findFocus.bindTo(this._contextKeyService);\n\t\tthis._findWidgetVisible = TerminalContextKeys.findVisible.bindTo(this._contextKeyService);\n\t\tconst innerDom = this.getDomNode().firstChild;\n\t\tif (innerDom) {\n\t\t\tthis._register(dom.addDisposableListener(innerDom, 'mousedown', (event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}));\n\t\t\tthis._register(dom.addDisposableListener(innerDom, 'contextmenu', (event) => {\n\t\t\t\tevent.stopPropagation();\n\t\t\t}));\n\t\t}\n\t\tconst findInputDomNode = this.getFindInputDomNode();\n\t\tthis._register(dom.addDisposableListener(findInputDomNode, 'contextmenu', (event) => {\n\t\t\topenContextMenu(dom.getWindow(findInputDomNode), event, _clipboardService, _contextMenuService);\n\t\t\tevent.stopPropagation();\n\t\t}));\n\t\tthis._register(this._themeService.onDidColorThemeChange(() => {\n\t\t\tif (this.isVisible()) {\n\t\t\t\tthis.find(true, true);\n\t\t\t}\n\t\t}));\n\t\tthis._register(this._configurationService.onDidChangeConfiguration((e) => {\n\t\t\tif (e.affectsConfiguration('workbench.colorCustomizations') && this.isVisible()) {\n\t\t\t\tthis.find(true, true);\n\t\t\t}\n\t\t}));\n\n\t\tthis.updateResultCount();\n\t}\n\n\tfind(previous: boolean, update?: boolean) {\n\t\tconst xterm = this._instance.xterm;\n\t\tif (!xterm) {\n\t\t\treturn;\n\t\t}\n\t\tif (previous) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, { regex: this._getRegexValue(), wholeWord: this._getWholeWordValue(), caseSensitive: this._getCaseSensitiveValue(), incremental: update });\n\t\t} else {\n\t\t\tthis._findNextWithEvent(xterm, this.inputValue, { regex: this._getRegexValue(), wholeWord: this._getWholeWordValue(), caseSensitive: this._getCaseSensitiveValue() });\n\t\t}\n\t}\n\n\toverride reveal(): void {\n\t\tconst initialInput = this._instance.hasSelection() && !this._instance.selection!.includes('\\n') ? this._instance.selection : undefined;\n\t\tconst inputValue = initialInput ?? this.inputValue;\n\t\tconst xterm = this._instance.xterm;\n\t\tif (xterm && inputValue && inputValue !== '') {\n\t\t\t// trigger highlight all matches\n\t\t\tthis._findPreviousWithEvent(xterm, inputValue, { incremental: true, regex: this._getRegexValue(), wholeWord: this._getWholeWordValue(), caseSensitive: this._getCaseSensitiveValue() }).then(foundMatch => {\n\t\t\t\tthis.updateButtons(foundMatch);\n\t\t\t\tthis._register(Event.once(xterm.onDidChangeSelection)(() => xterm.clearActiveSearchDecoration()));\n\t\t\t});\n\t\t}\n\t\tthis.updateButtons(false);\n\n\t\tsuper.reveal(inputValue);\n\t\tthis._findWidgetVisible.set(true);\n\t}\n\n\toverride show() {\n\t\tconst initialInput = this._instance.hasSelection() && !this._instance.selection!.includes('\\n') ? this._instance.selection : undefined;\n\t\tsuper.show(initialInput);\n\t\tthis._findWidgetVisible.set(true);\n\t}\n\n\toverride hide() {\n\t\tsuper.hide();\n\t\tthis._findWidgetVisible.reset();\n\t\tthis._instance.focus(true);\n\t\tthis._instance.xterm?.clearSearchDecorations();\n\t}\n\n\tprotected async _getResultCount(): Promise<{ resultIndex: number; resultCount: number } | undefined> {\n\t\treturn this._instance.xterm?.findResult;\n\t}\n\n\tprotected _onInputChanged() {\n\t\t// Ignore input changes for now\n\t\tconst xterm = this._instance.xterm;\n\t\tif (xterm) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, { regex: this._getRegexValue(), wholeWord: this._getWholeWordValue(), caseSensitive: this._getCaseSensitiveValue(), incremental: true }).then(foundMatch => {\n\t\t\t\tthis.updateButtons(foundMatch);\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected _onFocusTrackerFocus() {\n\t\tif ('overrideCopyOnSelection' in this._instance) {\n\t\t\tthis._overrideCopyOnSelectionDisposable = this._instance.overrideCopyOnSelection(false);\n\t\t}\n\t\tthis._findWidgetFocused.set(true);\n\t}\n\n\tprotected _onFocusTrackerBlur() {\n\t\tthis._overrideCopyOnSelectionDisposable?.dispose();\n\t\tthis._instance.xterm?.clearActiveSearchDecoration();\n\t\tthis._findWidgetFocused.reset();\n\t}\n\n\tprotected _onFindInputFocusTrackerFocus() {\n\t\tthis._findInputFocused.set(true);\n\t}\n\n\tprotected _onFindInputFocusTrackerBlur() {\n\t\tthis._findInputFocused.reset();\n\t}\n\n\tfindFirst() {\n\t\tconst instance = this._instance;\n\t\tif (instance.hasSelection()) {\n\t\t\tinstance.clearSelection();\n\t\t}\n\t\tconst xterm = instance.xterm;\n\t\tif (xterm) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, { regex: this._getRegexValue(), wholeWord: this._getWholeWordValue(), caseSensitive: this._getCaseSensitiveValue() });\n\t\t}\n\t}\n\n\tprivate async _findNextWithEvent(xterm: IXtermTerminal, term: string, options: ISearchOptions): Promise<boolean> {\n\t\treturn xterm.findNext(term, options).then(foundMatch => {\n\t\t\tthis._register(Event.once(xterm.onDidChangeSelection)(() => xterm.clearActiveSearchDecoration()));\n\t\t\treturn foundMatch;\n\t\t});\n\t}\n\n\tprivate async _findPreviousWithEvent(xterm: IXtermTerminal, term: string, options: ISearchOptions): Promise<boolean> {\n\t\treturn xterm.findPrevious(term, options).then(foundMatch => {\n\t\t\tthis._register(Event.once(xterm.onDidChangeSelection)(() => xterm.clearActiveSearchDecoration()));\n\t\t\treturn foundMatch;\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
