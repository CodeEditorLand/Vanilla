{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/find/browser/terminalFindWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { ISearchOptions } from \"@xterm/addon-search\";\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport { Event } from \"../../../../../base/common/event.js\";\nimport type { IDisposable } from \"../../../../../base/common/lifecycle.js\";\nimport { IClipboardService } from \"../../../../../platform/clipboard/common/clipboardService.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport {\n\ttype IContextKey,\n\tIContextKeyService,\n} from \"../../../../../platform/contextkey/common/contextkey.js\";\nimport {\n\tIContextMenuService,\n\tIContextViewService,\n} from \"../../../../../platform/contextview/browser/contextView.js\";\nimport { IHoverService } from \"../../../../../platform/hover/browser/hover.js\";\nimport { IKeybindingService } from \"../../../../../platform/keybinding/common/keybinding.js\";\nimport { IThemeService } from \"../../../../../platform/theme/common/themeService.js\";\nimport { SimpleFindWidget } from \"../../../codeEditor/browser/find/simpleFindWidget.js\";\nimport {\n\ttype IDetachedTerminalInstance,\n\ttype ITerminalInstance,\n\ttype IXtermTerminal,\n\tXtermTerminalConstants,\n} from \"../../../terminal/browser/terminal.js\";\nimport { TerminalContextKeys } from \"../../../terminal/common/terminalContextKey.js\";\nimport { TerminalFindCommandId } from \"../common/terminal.find.js\";\nimport { openContextMenu } from \"./textInputContextMenu.js\";\n\nconst TERMINAL_FIND_WIDGET_INITIAL_WIDTH = 419;\n\nexport class TerminalFindWidget extends SimpleFindWidget {\n\tprivate _findInputFocused: IContextKey<boolean>;\n\tprivate _findWidgetFocused: IContextKey<boolean>;\n\tprivate _findWidgetVisible: IContextKey<boolean>;\n\n\tprivate _overrideCopyOnSelectionDisposable: IDisposable | undefined;\n\n\tconstructor(\n\t\tprivate _instance: ITerminalInstance | IDetachedTerminalInstance,\n\t\t@IContextViewService _contextViewService: IContextViewService,\n\t\t@IKeybindingService keybindingService: IKeybindingService,\n\t\t@IContextKeyService\n\t\tprivate readonly _contextKeyService: IContextKeyService,\n\t\t@IContextMenuService _contextMenuService: IContextMenuService,\n\t\t@IClipboardService _clipboardService: IClipboardService,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IThemeService private readonly _themeService: IThemeService,\n\t\t@IConfigurationService\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t) {\n\t\tsuper(\n\t\t\t{\n\t\t\t\tshowCommonFindToggles: true,\n\t\t\t\tcheckImeCompletionState: true,\n\t\t\t\tshowResultCount: true,\n\t\t\t\tinitialWidth: TERMINAL_FIND_WIDGET_INITIAL_WIDTH,\n\t\t\t\tenableSash: true,\n\t\t\t\tappendCaseSensitiveActionId:\n\t\t\t\t\tTerminalFindCommandId.ToggleFindCaseSensitive,\n\t\t\t\tappendRegexActionId: TerminalFindCommandId.ToggleFindRegex,\n\t\t\t\tappendWholeWordsActionId:\n\t\t\t\t\tTerminalFindCommandId.ToggleFindWholeWord,\n\t\t\t\tpreviousMatchActionId: TerminalFindCommandId.FindPrevious,\n\t\t\t\tnextMatchActionId: TerminalFindCommandId.FindNext,\n\t\t\t\tcloseWidgetActionId: TerminalFindCommandId.FindHide,\n\t\t\t\ttype: \"Terminal\",\n\t\t\t\tmatchesLimit: XtermTerminalConstants.SearchHighlightLimit,\n\t\t\t},\n\t\t\t_contextViewService,\n\t\t\t_contextKeyService,\n\t\t\thoverService,\n\t\t\tkeybindingService,\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.state.onFindReplaceStateChange(() => {\n\t\t\t\tthis.show();\n\t\t\t}),\n\t\t);\n\t\tthis._findInputFocused = TerminalContextKeys.findInputFocus.bindTo(\n\t\t\tthis._contextKeyService,\n\t\t);\n\t\tthis._findWidgetFocused = TerminalContextKeys.findFocus.bindTo(\n\t\t\tthis._contextKeyService,\n\t\t);\n\t\tthis._findWidgetVisible = TerminalContextKeys.findVisible.bindTo(\n\t\t\tthis._contextKeyService,\n\t\t);\n\t\tconst innerDom = this.getDomNode().firstChild;\n\t\tif (innerDom) {\n\t\t\tthis._register(\n\t\t\t\tdom.addDisposableListener(innerDom, \"mousedown\", (event) => {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t}),\n\t\t\t);\n\t\t\tthis._register(\n\t\t\t\tdom.addDisposableListener(innerDom, \"contextmenu\", (event) => {\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t}),\n\t\t\t);\n\t\t}\n\t\tconst findInputDomNode = this.getFindInputDomNode();\n\t\tthis._register(\n\t\t\tdom.addDisposableListener(\n\t\t\t\tfindInputDomNode,\n\t\t\t\t\"contextmenu\",\n\t\t\t\t(event) => {\n\t\t\t\t\topenContextMenu(\n\t\t\t\t\t\tdom.getWindow(findInputDomNode),\n\t\t\t\t\t\tevent,\n\t\t\t\t\t\t_clipboardService,\n\t\t\t\t\t\t_contextMenuService,\n\t\t\t\t\t);\n\t\t\t\t\tevent.stopPropagation();\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._themeService.onDidColorThemeChange(() => {\n\t\t\t\tif (this.isVisible()) {\n\t\t\t\t\tthis.find(true, true);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthis._configurationService.onDidChangeConfiguration((e) => {\n\t\t\t\tif (\n\t\t\t\t\te.affectsConfiguration(\"workbench.colorCustomizations\") &&\n\t\t\t\t\tthis.isVisible()\n\t\t\t\t) {\n\t\t\t\t\tthis.find(true, true);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\tthis.updateResultCount();\n\t}\n\n\tfind(previous: boolean, update?: boolean) {\n\t\tconst xterm = this._instance.xterm;\n\t\tif (!xterm) {\n\t\t\treturn;\n\t\t}\n\t\tif (previous) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, {\n\t\t\t\tregex: this._getRegexValue(),\n\t\t\t\twholeWord: this._getWholeWordValue(),\n\t\t\t\tcaseSensitive: this._getCaseSensitiveValue(),\n\t\t\t\tincremental: update,\n\t\t\t});\n\t\t} else {\n\t\t\tthis._findNextWithEvent(xterm, this.inputValue, {\n\t\t\t\tregex: this._getRegexValue(),\n\t\t\t\twholeWord: this._getWholeWordValue(),\n\t\t\t\tcaseSensitive: this._getCaseSensitiveValue(),\n\t\t\t});\n\t\t}\n\t}\n\n\toverride reveal(): void {\n\t\tconst initialInput =\n\t\t\tthis._instance.hasSelection() &&\n\t\t\t!this._instance.selection!.includes(\"\\n\")\n\t\t\t\t? this._instance.selection\n\t\t\t\t: undefined;\n\t\tconst inputValue = initialInput ?? this.inputValue;\n\t\tconst xterm = this._instance.xterm;\n\t\tif (xterm && inputValue && inputValue !== \"\") {\n\t\t\t// trigger highlight all matches\n\t\t\tthis._findPreviousWithEvent(xterm, inputValue, {\n\t\t\t\tincremental: true,\n\t\t\t\tregex: this._getRegexValue(),\n\t\t\t\twholeWord: this._getWholeWordValue(),\n\t\t\t\tcaseSensitive: this._getCaseSensitiveValue(),\n\t\t\t}).then((foundMatch) => {\n\t\t\t\tthis.updateButtons(foundMatch);\n\t\t\t\tthis._register(\n\t\t\t\t\tEvent.once(xterm.onDidChangeSelection)(() =>\n\t\t\t\t\t\txterm.clearActiveSearchDecoration(),\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t});\n\t\t}\n\t\tthis.updateButtons(false);\n\n\t\tsuper.reveal(inputValue);\n\t\tthis._findWidgetVisible.set(true);\n\t}\n\n\toverride show() {\n\t\tconst initialInput =\n\t\t\tthis._instance.hasSelection() &&\n\t\t\t!this._instance.selection!.includes(\"\\n\")\n\t\t\t\t? this._instance.selection\n\t\t\t\t: undefined;\n\t\tsuper.show(initialInput);\n\t\tthis._findWidgetVisible.set(true);\n\t}\n\n\toverride hide() {\n\t\tsuper.hide();\n\t\tthis._findWidgetVisible.reset();\n\t\tthis._instance.focus(true);\n\t\tthis._instance.xterm?.clearSearchDecorations();\n\t}\n\n\tprotected async _getResultCount(): Promise<\n\t\t{ resultIndex: number; resultCount: number } | undefined\n\t> {\n\t\treturn this._instance.xterm?.findResult;\n\t}\n\n\tprotected _onInputChanged() {\n\t\t// Ignore input changes for now\n\t\tconst xterm = this._instance.xterm;\n\t\tif (xterm) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, {\n\t\t\t\tregex: this._getRegexValue(),\n\t\t\t\twholeWord: this._getWholeWordValue(),\n\t\t\t\tcaseSensitive: this._getCaseSensitiveValue(),\n\t\t\t\tincremental: true,\n\t\t\t}).then((foundMatch) => {\n\t\t\t\tthis.updateButtons(foundMatch);\n\t\t\t});\n\t\t}\n\t\treturn false;\n\t}\n\n\tprotected _onFocusTrackerFocus() {\n\t\tif (\"overrideCopyOnSelection\" in this._instance) {\n\t\t\tthis._overrideCopyOnSelectionDisposable =\n\t\t\t\tthis._instance.overrideCopyOnSelection(false);\n\t\t}\n\t\tthis._findWidgetFocused.set(true);\n\t}\n\n\tprotected _onFocusTrackerBlur() {\n\t\tthis._overrideCopyOnSelectionDisposable?.dispose();\n\t\tthis._instance.xterm?.clearActiveSearchDecoration();\n\t\tthis._findWidgetFocused.reset();\n\t}\n\n\tprotected _onFindInputFocusTrackerFocus() {\n\t\tthis._findInputFocused.set(true);\n\t}\n\n\tprotected _onFindInputFocusTrackerBlur() {\n\t\tthis._findInputFocused.reset();\n\t}\n\n\tfindFirst() {\n\t\tconst instance = this._instance;\n\t\tif (instance.hasSelection()) {\n\t\t\tinstance.clearSelection();\n\t\t}\n\t\tconst xterm = instance.xterm;\n\t\tif (xterm) {\n\t\t\tthis._findPreviousWithEvent(xterm, this.inputValue, {\n\t\t\t\tregex: this._getRegexValue(),\n\t\t\t\twholeWord: this._getWholeWordValue(),\n\t\t\t\tcaseSensitive: this._getCaseSensitiveValue(),\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async _findNextWithEvent(\n\t\txterm: IXtermTerminal,\n\t\tterm: string,\n\t\toptions: ISearchOptions,\n\t): Promise<boolean> {\n\t\treturn xterm.findNext(term, options).then((foundMatch) => {\n\t\t\tthis._register(\n\t\t\t\tEvent.once(xterm.onDidChangeSelection)(() =>\n\t\t\t\t\txterm.clearActiveSearchDecoration(),\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn foundMatch;\n\t\t});\n\t}\n\n\tprivate async _findPreviousWithEvent(\n\t\txterm: IXtermTerminal,\n\t\tterm: string,\n\t\toptions: ISearchOptions,\n\t): Promise<boolean> {\n\t\treturn xterm.findPrevious(term, options).then((foundMatch) => {\n\t\t\tthis._register(\n\t\t\t\tEvent.once(xterm.onDidChangeSelection)(() =>\n\t\t\t\t\txterm.clearActiveSearchDecoration(),\n\t\t\t\t),\n\t\t\t);\n\t\t\treturn foundMatch;\n\t\t});\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAMA,YAAY,SAAS;AACrB,SAAS,aAAa;AAEtB,SAAS,yBAAyB;AAClC,SAAS,6BAA6B;AACtC;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,qBAAqB;AAC9B,SAAS,0BAA0B;AACnC,SAAS,qBAAqB;AAC9B,SAAS,wBAAwB;AACjC;AAAA,EAIC;AAAA,OACM;AACP,SAAS,2BAA2B;AACpC,SAAS,6BAA6B;AACtC,SAAS,uBAAuB;AAEhC,MAAM,qCAAqC;AAEpC,IAAM,qBAAN,cAAiC,iBAAiB;AAAA,EAOxD,YACS,WACa,qBACD,mBAEH,oBACI,qBACF,mBACJ,cACiB,eAEf,uBAChB;AACD;AAAA,MACC;AAAA,QACC,uBAAuB;AAAA,QACvB,yBAAyB;AAAA,QACzB,iBAAiB;AAAA,QACjB,cAAc;AAAA,QACd,YAAY;AAAA,QACZ,6BACC,sBAAsB;AAAA,QACvB,qBAAqB,sBAAsB;AAAA,QAC3C,0BACC,sBAAsB;AAAA,QACvB,uBAAuB,sBAAsB;AAAA,QAC7C,mBAAmB,sBAAsB;AAAA,QACzC,qBAAqB,sBAAsB;AAAA,QAC3C,MAAM;AAAA,QACN,cAAc,uBAAuB;AAAA,MACtC;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAlCQ;AAIS;AAIe;AAEf;AA0BjB,SAAK;AAAA,MACJ,KAAK,MAAM,yBAAyB,MAAM;AACzC,aAAK,KAAK;AAAA,MACX,CAAC;AAAA,IACF;AACA,SAAK,oBAAoB,oBAAoB,eAAe;AAAA,MAC3D,KAAK;AAAA,IACN;AACA,SAAK,qBAAqB,oBAAoB,UAAU;AAAA,MACvD,KAAK;AAAA,IACN;AACA,SAAK,qBAAqB,oBAAoB,YAAY;AAAA,MACzD,KAAK;AAAA,IACN;AACA,UAAM,WAAW,KAAK,WAAW,EAAE;AACnC,QAAI,UAAU;AACb,WAAK;AAAA,QACJ,IAAI,sBAAsB,UAAU,aAAa,CAAC,UAAU;AAC3D,gBAAM,gBAAgB;AAAA,QACvB,CAAC;AAAA,MACF;AACA,WAAK;AAAA,QACJ,IAAI,sBAAsB,UAAU,eAAe,CAAC,UAAU;AAC7D,gBAAM,gBAAgB;AAAA,QACvB,CAAC;AAAA,MACF;AAAA,IACD;AACA,UAAM,mBAAmB,KAAK,oBAAoB;AAClD,SAAK;AAAA,MACJ,IAAI;AAAA,QACH;AAAA,QACA;AAAA,QACA,CAAC,UAAU;AACV;AAAA,YACC,IAAI,UAAU,gBAAgB;AAAA,YAC9B;AAAA,YACA;AAAA,YACA;AAAA,UACD;AACA,gBAAM,gBAAgB;AAAA,QACvB;AAAA,MACD;AAAA,IACD;AACA,SAAK;AAAA,MACJ,KAAK,cAAc,sBAAsB,MAAM;AAC9C,YAAI,KAAK,UAAU,GAAG;AACrB,eAAK,KAAK,MAAM,IAAI;AAAA,QACrB;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK;AAAA,MACJ,KAAK,sBAAsB,yBAAyB,CAAC,MAAM;AAC1D,YACC,EAAE,qBAAqB,+BAA+B,KACtD,KAAK,UAAU,GACd;AACD,eAAK,KAAK,MAAM,IAAI;AAAA,QACrB;AAAA,MACD,CAAC;AAAA,IACF;AAEA,SAAK,kBAAkB;AAAA,EACxB;AAAA,EA7ID,OAmCyD;AAAA;AAAA;AAAA,EAChD;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EAuGR,KAAK,UAAmB,QAAkB;AACzC,UAAM,QAAQ,KAAK,UAAU;AAC7B,QAAI,CAAC,OAAO;AACX;AAAA,IACD;AACA,QAAI,UAAU;AACb,WAAK,uBAAuB,OAAO,KAAK,YAAY;AAAA,QACnD,OAAO,KAAK,eAAe;AAAA,QAC3B,WAAW,KAAK,mBAAmB;AAAA,QACnC,eAAe,KAAK,uBAAuB;AAAA,QAC3C,aAAa;AAAA,MACd,CAAC;AAAA,IACF,OAAO;AACN,WAAK,mBAAmB,OAAO,KAAK,YAAY;AAAA,QAC/C,OAAO,KAAK,eAAe;AAAA,QAC3B,WAAW,KAAK,mBAAmB;AAAA,QACnC,eAAe,KAAK,uBAAuB;AAAA,MAC5C,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAES,SAAe;AACvB,UAAM,eACL,KAAK,UAAU,aAAa,KAC5B,CAAC,KAAK,UAAU,UAAW,SAAS,IAAI,IACrC,KAAK,UAAU,YACf;AACJ,UAAM,aAAa,gBAAgB,KAAK;AACxC,UAAM,QAAQ,KAAK,UAAU;AAC7B,QAAI,SAAS,cAAc,eAAe,IAAI;AAE7C,WAAK,uBAAuB,OAAO,YAAY;AAAA,QAC9C,aAAa;AAAA,QACb,OAAO,KAAK,eAAe;AAAA,QAC3B,WAAW,KAAK,mBAAmB;AAAA,QACnC,eAAe,KAAK,uBAAuB;AAAA,MAC5C,CAAC,EAAE,KAAK,CAAC,eAAe;AACvB,aAAK,cAAc,UAAU;AAC7B,aAAK;AAAA,UACJ,MAAM,KAAK,MAAM,oBAAoB;AAAA,YAAE,MACtC,MAAM,4BAA4B;AAAA,UACnC;AAAA,QACD;AAAA,MACD,CAAC;AAAA,IACF;AACA,SAAK,cAAc,KAAK;AAExB,UAAM,OAAO,UAAU;AACvB,SAAK,mBAAmB,IAAI,IAAI;AAAA,EACjC;AAAA,EAES,OAAO;AACf,UAAM,eACL,KAAK,UAAU,aAAa,KAC5B,CAAC,KAAK,UAAU,UAAW,SAAS,IAAI,IACrC,KAAK,UAAU,YACf;AACJ,UAAM,KAAK,YAAY;AACvB,SAAK,mBAAmB,IAAI,IAAI;AAAA,EACjC;AAAA,EAES,OAAO;AACf,UAAM,KAAK;AACX,SAAK,mBAAmB,MAAM;AAC9B,SAAK,UAAU,MAAM,IAAI;AACzB,SAAK,UAAU,OAAO,uBAAuB;AAAA,EAC9C;AAAA,EAEA,MAAgB,kBAEd;AACD,WAAO,KAAK,UAAU,OAAO;AAAA,EAC9B;AAAA,EAEU,kBAAkB;AAE3B,UAAM,QAAQ,KAAK,UAAU;AAC7B,QAAI,OAAO;AACV,WAAK,uBAAuB,OAAO,KAAK,YAAY;AAAA,QACnD,OAAO,KAAK,eAAe;AAAA,QAC3B,WAAW,KAAK,mBAAmB;AAAA,QACnC,eAAe,KAAK,uBAAuB;AAAA,QAC3C,aAAa;AAAA,MACd,CAAC,EAAE,KAAK,CAAC,eAAe;AACvB,aAAK,cAAc,UAAU;AAAA,MAC9B,CAAC;AAAA,IACF;AACA,WAAO;AAAA,EACR;AAAA,EAEU,uBAAuB;AAChC,QAAI,6BAA6B,KAAK,WAAW;AAChD,WAAK,qCACJ,KAAK,UAAU,wBAAwB,KAAK;AAAA,IAC9C;AACA,SAAK,mBAAmB,IAAI,IAAI;AAAA,EACjC;AAAA,EAEU,sBAAsB;AAC/B,SAAK,oCAAoC,QAAQ;AACjD,SAAK,UAAU,OAAO,4BAA4B;AAClD,SAAK,mBAAmB,MAAM;AAAA,EAC/B;AAAA,EAEU,gCAAgC;AACzC,SAAK,kBAAkB,IAAI,IAAI;AAAA,EAChC;AAAA,EAEU,+BAA+B;AACxC,SAAK,kBAAkB,MAAM;AAAA,EAC9B;AAAA,EAEA,YAAY;AACX,UAAM,WAAW,KAAK;AACtB,QAAI,SAAS,aAAa,GAAG;AAC5B,eAAS,eAAe;AAAA,IACzB;AACA,UAAM,QAAQ,SAAS;AACvB,QAAI,OAAO;AACV,WAAK,uBAAuB,OAAO,KAAK,YAAY;AAAA,QACnD,OAAO,KAAK,eAAe;AAAA,QAC3B,WAAW,KAAK,mBAAmB;AAAA,QACnC,eAAe,KAAK,uBAAuB;AAAA,MAC5C,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EAEA,MAAc,mBACb,OACA,MACA,SACmB;AACnB,WAAO,MAAM,SAAS,MAAM,OAAO,EAAE,KAAK,CAAC,eAAe;AACzD,WAAK;AAAA,QACJ,MAAM,KAAK,MAAM,oBAAoB;AAAA,UAAE,MACtC,MAAM,4BAA4B;AAAA,QACnC;AAAA,MACD;AACA,aAAO;AAAA,IACR,CAAC;AAAA,EACF;AAAA,EAEA,MAAc,uBACb,OACA,MACA,SACmB;AACnB,WAAO,MAAM,aAAa,MAAM,OAAO,EAAE,KAAK,CAAC,eAAe;AAC7D,WAAK;AAAA,QACJ,MAAM,KAAK,MAAM,oBAAoB;AAAA,UAAE,MACtC,MAAM,4BAA4B;AAAA,QACnC;AAAA,MACD;AACA,aAAO;AAAA,IACR,CAAC;AAAA,EACF;AACD;AAxQa,qBAAN;AAAA,EASJ;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAjBU;",
  "names": []
}
