import{Codicon as g}from"../../../../../base/common/codicons.js";import{KeyCode as s,KeyMod as m}from"../../../../../base/common/keyCodes.js";import{localize2 as i}from"../../../../../nls.js";import{ContextKeyExpr as r}from"../../../../../platform/contextkey/common/contextkey.js";import{KeybindingWeight as p}from"../../../../../platform/keybinding/common/keybindingsRegistry.js";import{AbstractInlineChatAction as y}from"../../../inlineChat/browser/inlineChatActions.js";import{CTX_INLINE_CHAT_EMPTY as _,CTX_INLINE_CHAT_FOCUSED as k}from"../../../inlineChat/common/inlineChat.js";import{isDetachedTerminalInstance as c}from"../../../terminal/browser/terminal.js";import{registerActiveXtermAction as d}from"../../../terminal/browser/terminalActions.js";import{TerminalContextKeys as a}from"../../../terminal/common/terminalContextKey.js";import{MENU_TERMINAL_CHAT_INPUT as w,MENU_TERMINAL_CHAT_WIDGET as A,MENU_TERMINAL_CHAT_WIDGET_STATUS as h,TerminalChatCommandId as u,TerminalChatContextKeys as e}from"./terminalChat.js";import{TerminalChatController as n}from"./terminalChatController.js";d({id:u.Start,title:i("startChat","Start in Terminal"),keybinding:{primary:m.CtrlCmd|s.KeyI,when:r.and(a.focusInAny),weight:p.ExternalExtension+1},f1:!0,category:y.category,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.hasChatAgent),run:(C,l,t,o)=>{if(c(t))return;const f=n.activeChatController||n.get(t);o&&(o=typeof o=="string"?{query:o}:o,typeof o=="object"&&o!==null&&"query"in o&&typeof o.query=="string"&&(f?.updateInput(o.query,!1),"isPartialQuery"in o&&o.isPartialQuery||f?.acceptInput())),f?.reveal()}}),d({id:u.Close,title:i("closeChat","Close Chat"),keybinding:{primary:s.Escape,secondary:[m.Shift|s.Escape],when:r.and(e.focused,e.visible),weight:p.WorkbenchContrib},icon:g.close,menu:{id:A,group:"navigation",order:2},f1:!0,precondition:r.and(r.and(e.focused,e.visible)),run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.clear()}}),d({id:u.FocusResponse,title:i("focusTerminalResponse","Focus Terminal Response"),keybinding:{primary:m.CtrlCmd|s.DownArrow,when:e.focused,weight:p.WorkbenchContrib},f1:!0,category:y.category,precondition:r.and(e.focused),run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.chatWidget?.focusLastMessage()}}),d({id:u.FocusInput,title:i("focusTerminalInput","Focus Terminal Input"),keybinding:{primary:m.CtrlCmd|s.UpArrow,secondary:[m.CtrlCmd|s.KeyI],when:r.and(e.focused,k.toNegated()),weight:p.WorkbenchContrib},f1:!0,category:y.category,precondition:r.and(e.focused),run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.terminalChatWidget?.focus()}}),d({id:u.Discard,title:i("discard","Discard"),metadata:{description:i("discardDescription","Discards the terminal current chat response, hide the chat widget, and clear the chat input.")},icon:g.discard,menu:{id:h,group:"0_main",order:2,when:r.and(e.focused,e.responseContainsCodeBlock)},f1:!0,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.focused,e.responseContainsCodeBlock),run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.clear()}}),d({id:u.RunCommand,title:i("runCommand","Run Chat Command"),shortTitle:i("run","Run"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),icon:g.play,keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.CtrlCmd|s.Enter},menu:{id:h,group:"0_main",order:0,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!0)}}),d({id:u.RunFirstCommand,title:i("runFirstCommand","Run First Chat Command"),shortTitle:i("runFirst","Run First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),icon:g.play,keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.CtrlCmd|s.Enter},menu:{id:h,group:"0_main",order:0,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!0)}}),d({id:u.InsertCommand,title:i("insertCommand","Insert Chat Command"),shortTitle:i("insert","Insert"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.Alt|s.Enter,secondary:[m.CtrlCmd|s.Enter|m.Alt]},menu:{id:h,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!1)}}),d({id:u.InsertFirstCommand,title:i("insertFirstCommand","Insert First Chat Command"),shortTitle:i("insertFirst","Insert First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),keybinding:{when:e.requestActive.negate(),weight:p.WorkbenchContrib,primary:m.Alt|s.Enter,secondary:[m.CtrlCmd|s.Enter|m.Alt]},menu:{id:h,group:"0_main",order:1,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptCommand(!1)}}),d({id:u.ViewInChat,title:i("viewInChat","View in Chat"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate()),icon:g.commentDiscussion,menu:[{id:h,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.requestActive.negate())},{id:A,group:"navigation",order:1,when:r.and(_.negate(),e.responseContainsCodeBlock,e.requestActive.negate())}],run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.viewInChat()}}),d({id:u.MakeRequest,title:i("makeChatRequest","Make Chat Request"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),_.negate()),icon:g.send,keybinding:{when:r.and(e.focused,e.requestActive.negate()),weight:p.WorkbenchContrib,primary:s.Enter},menu:{id:w,group:"navigation",order:1,when:e.requestActive.negate()},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.acceptInput()}}),d({id:u.Cancel,title:i("cancelChat","Cancel Chat"),precondition:r.and(e.requestActive),icon:g.debugStop,menu:{id:w,group:"navigation",when:e.requestActive},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.cancel()}}),d({id:u.PreviousFromHistory,title:i("previousFromHitory","Previous From History"),precondition:e.focused,keybinding:{when:e.focused,weight:p.WorkbenchContrib,primary:s.UpArrow},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.populateHistory(!0)}}),d({id:u.NextFromHistory,title:i("nextFromHitory","Next From History"),precondition:e.focused,keybinding:{when:e.focused,weight:p.WorkbenchContrib,primary:s.DownArrow},run:(C,l,t)=>{if(c(t))return;(n.activeChatController||n.get(t))?.populateHistory(!1)}});
