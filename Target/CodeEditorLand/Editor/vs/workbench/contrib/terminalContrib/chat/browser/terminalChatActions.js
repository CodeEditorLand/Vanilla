import{Codicon as g}from"../../../../../../vs/base/common/codicons.js";import{KeyCode as s,KeyMod as p}from"../../../../../../vs/base/common/keyCodes.js";import{localize2 as i}from"../../../../../../vs/nls.js";import{ContextKeyExpr as r}from"../../../../../../vs/platform/contextkey/common/contextkey.js";import{KeybindingWeight as l}from"../../../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import{AbstractInlineChatAction as y}from"../../../../../../vs/workbench/contrib/inlineChat/browser/inlineChatActions.js";import{CTX_INLINE_CHAT_EMPTY as _,CTX_INLINE_CHAT_FOCUSED as k}from"../../../../../../vs/workbench/contrib/inlineChat/common/inlineChat.js";import{isDetachedTerminalInstance as c}from"../../../../../../vs/workbench/contrib/terminal/browser/terminal.js";import{registerActiveXtermAction as d}from"../../../../../../vs/workbench/contrib/terminal/browser/terminalActions.js";import{TerminalContextKeys as a}from"../../../../../../vs/workbench/contrib/terminal/common/terminalContextKey.js";import{MENU_TERMINAL_CHAT_INPUT as w,MENU_TERMINAL_CHAT_WIDGET as A,MENU_TERMINAL_CHAT_WIDGET_STATUS as h,TerminalChatCommandId as u,TerminalChatContextKeys as e}from"../../../../../../vs/workbench/contrib/terminalContrib/chat/browser/terminalChat.js";import{TerminalChatController as n}from"../../../../../../vs/workbench/contrib/terminalContrib/chat/browser/terminalChatController.js";d({id:u.Start,title:i("startChat","Start in Terminal"),keybinding:{primary:p.CtrlCmd|s.KeyI,when:r.and(a.focusInAny),weight:l.ExternalExtension+1},f1:!0,category:y.category,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.hasChatAgent),run:(m,C,t,o)=>{if(c(t))return;const f=n.activeChatWidget||n.get(t);o&&(o=typeof o=="string"?{query:o}:o,typeof o=="object"&&o!==null&&"query"in o&&typeof o.query=="string"&&(f?.updateInput(o.query,!1),"isPartialQuery"in o&&o.isPartialQuery||f?.acceptInput())),f?.reveal()}}),d({id:u.Close,title:i("closeChat","Close Chat"),keybinding:{primary:s.Escape,secondary:[p.Shift|s.Escape],when:r.and(e.focused,e.visible),weight:l.WorkbenchContrib},icon:g.close,menu:{id:A,group:"navigation",order:2},f1:!0,precondition:r.and(r.and(e.focused,e.visible)),run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.clear()}}),d({id:u.FocusResponse,title:i("focusTerminalResponse","Focus Terminal Response"),keybinding:{primary:p.CtrlCmd|s.DownArrow,when:e.focused,weight:l.WorkbenchContrib},f1:!0,category:y.category,precondition:r.and(e.focused),run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.chatWidget?.inlineChatWidget.chatWidget.focusLastMessage()}}),d({id:u.FocusInput,title:i("focusTerminalInput","Focus Terminal Input"),keybinding:{primary:p.CtrlCmd|s.UpArrow,secondary:[p.CtrlCmd|s.KeyI],when:r.and(e.focused,k.toNegated()),weight:l.WorkbenchContrib},f1:!0,category:y.category,precondition:r.and(e.focused),run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.chatWidget?.focus()}}),d({id:u.Discard,title:i("discard","Discard"),metadata:{description:i("discardDescription","Discards the terminal current chat response, hide the chat widget, and clear the chat input.")},icon:g.discard,menu:{id:h,group:"0_main",order:2,when:r.and(e.focused,e.responseContainsCodeBlock)},f1:!0,precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.focused,e.responseContainsCodeBlock),run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.clear()}}),d({id:u.RunCommand,title:i("runCommand","Run Chat Command"),shortTitle:i("run","Run"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),icon:g.play,keybinding:{when:e.requestActive.negate(),weight:l.WorkbenchContrib,primary:p.CtrlCmd|s.Enter},menu:{id:h,group:"0_main",order:0,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.acceptCommand(!0)}}),d({id:u.RunFirstCommand,title:i("runFirstCommand","Run First Chat Command"),shortTitle:i("runFirst","Run First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),icon:g.play,keybinding:{when:e.requestActive.negate(),weight:l.WorkbenchContrib,primary:p.CtrlCmd|s.Enter},menu:{id:h,group:"0_main",order:0,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.acceptCommand(!0)}}),d({id:u.InsertCommand,title:i("insertCommand","Insert Chat Command"),shortTitle:i("insert","Insert"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate()),keybinding:{when:e.requestActive.negate(),weight:l.WorkbenchContrib,primary:p.Alt|s.Enter,secondary:[p.CtrlCmd|s.Enter|p.Alt]},menu:{id:h,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.responseContainsMultipleCodeBlocks.negate(),e.requestActive.negate())},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.acceptCommand(!1)}}),d({id:u.InsertFirstCommand,title:i("insertFirstCommand","Insert First Chat Command"),shortTitle:i("insertFirst","Insert First"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),e.responseContainsMultipleCodeBlocks),keybinding:{when:e.requestActive.negate(),weight:l.WorkbenchContrib,primary:p.Alt|s.Enter,secondary:[p.CtrlCmd|s.Enter|p.Alt]},menu:{id:h,group:"0_main",order:1,when:r.and(e.responseContainsMultipleCodeBlocks,e.requestActive.negate())},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.acceptCommand(!1)}}),d({id:u.ViewInChat,title:i("viewInChat","View in Chat"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate()),icon:g.commentDiscussion,menu:[{id:h,group:"0_main",order:1,when:r.and(e.responseContainsCodeBlock,e.requestActive.negate())},{id:A,group:"navigation",order:1,when:r.and(_.negate(),e.responseContainsCodeBlock,e.requestActive.negate())}],run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.viewInChat()}}),d({id:u.MakeRequest,title:i("makeChatRequest","Make Chat Request"),precondition:r.and(r.or(a.processSupported,a.terminalHasBeenCreated),e.requestActive.negate(),_.negate()),icon:g.send,keybinding:{when:r.and(e.focused,e.requestActive.negate()),weight:l.WorkbenchContrib,primary:s.Enter},menu:{id:w,group:"navigation",order:1,when:e.requestActive.negate()},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.acceptInput()}}),d({id:u.Cancel,title:i("cancelChat","Cancel Chat"),precondition:r.and(e.requestActive),icon:g.debugStop,menu:{id:w,group:"navigation",when:e.requestActive},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.cancel()}}),d({id:u.PreviousFromHistory,title:i("previousFromHitory","Previous From History"),precondition:e.focused,keybinding:{when:e.focused,weight:l.WorkbenchContrib,primary:s.UpArrow},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.populateHistory(!0)}}),d({id:u.NextFromHistory,title:i("nextFromHitory","Next From History"),precondition:e.focused,keybinding:{when:e.focused,weight:l.WorkbenchContrib,primary:s.DownArrow},run:(m,C,t)=>{if(c(t))return;(n.activeChatWidget||n.get(t))?.populateHistory(!1)}});
