var I=Object.defineProperty;var E=Object.getOwnPropertyDescriptor;var u=(t,n,e,i)=>{for(var o=i>1?void 0:i?E(n,e):n,r=t.length-1,a;r>=0;r--)(a=t[r])&&(o=(i?a(n,e,o):a(o))||o);return i&&o&&I(n,e,o),o},l=(t,n)=>(e,i)=>n(e,i,t);import{Event as S}from"../../../../../base/common/event.js";import{URI as M}from"../../../../../base/common/uri.js";import{IModelService as $}from"../../../../../editor/common/services/model.js";import{ITextModelService as w}from"../../../../../editor/common/services/resolverService.js";import{localize as d,localize2 as b}from"../../../../../nls.js";import{IInstantiationService as h}from"../../../../../platform/instantiation/common/instantiation.js";import{EnvironmentVariableMutatorType as v}from"../../../../../platform/terminal/common/environmentVariable.js";import{IEditorService as x}from"../../../../services/editor/common/editorService.js";import{registerActiveInstanceAction as C}from"../../../terminal/browser/terminalActions.js";import{TerminalCommandId as T}from"../../../terminal/common/terminal.js";C({id:T.ShowEnvironmentContributions,title:b("workbench.action.terminal.showEnvironmentContributions","Show Environment Contributions"),run:async(t,n,e,i)=>{const o=t.extEnvironmentVariableCollection;if(o){const r=i,m=e.get(h).createInstance(c),p=e.get(x),s=new Date().getTime(),g=r?.workspaceFolder?` - ${r.workspaceFolder.name}`:"",f=await m.provideTextContent(M.from({scheme:c.scheme,path:`Environment changes${g}`,fragment:y(o,r),query:`environment-collection-${s}`}));f&&await p.openEditor({resource:f.uri})}}});function y(t,n){let e=`# ${d("envChanges","Terminal Environment Changes")}`;const i=t.getDescriptionMap(void 0),o=t.getDescriptionMap(n);for(const[r,a]of t.collections){e+=`

## ${d("extension","Extension: {0}",r)}`,e+=`
`;const m=i.get(r);m&&(e+=`
${m}
`);const p=o.get(r);if(p){const s=m?` (${d("ScopedEnvironmentContributionInfo","workspace")})`:"";e+=`
${p}${s}
`}for(const s of a.map.values())k(s,n)!==!1&&(e+=`
- \`${V(s.type,s.value,s.variable)}\``)}return e}function k(t,n){return!!(!t.scope||t.scope.workspaceFolder&&n?.workspaceFolder&&t.scope.workspaceFolder.index===n.workspaceFolder.index)}function V(t,n,e){switch(t){case v.Prepend:return`${e}=${n}\${env:${e}}`;case v.Append:return`${e}=\${env:${e}}${n}`;default:return`${e}=${n}`}}let c=class{constructor(n,e){this._modelService=e;n.registerTextModelContentProvider(c.scheme,this)}static scheme="ENVIRONMENT_CHANGES_COLLECTION";async provideTextContent(n){const e=this._modelService.getModel(n);return e&&!e.isDisposed()?e:this._modelService.createModel(n.fragment,{languageId:"markdown",onDidChange:S.None},n,!1)}};c=u([l(0,w),l(1,$)],c);
