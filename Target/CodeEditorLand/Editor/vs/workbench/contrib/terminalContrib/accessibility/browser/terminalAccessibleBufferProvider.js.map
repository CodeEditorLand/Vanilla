{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/accessibility/browser/terminalAccessibleBufferProvider.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { Disposable } from '../../../../../base/common/lifecycle.js';\nimport { IModelService } from '../../../../../editor/common/services/model.js';\nimport { IAccessibleViewContentProvider, AccessibleViewProviderId, IAccessibleViewOptions, AccessibleViewType, IAccessibleViewSymbol } from '../../../../../platform/accessibility/browser/accessibleView.js';\nimport { IConfigurationService } from '../../../../../platform/configuration/common/configuration.js';\nimport { IContextKeyService } from '../../../../../platform/contextkey/common/contextkey.js';\nimport { TerminalCapability, ITerminalCommand } from '../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ICurrentPartialCommand } from '../../../../../platform/terminal/common/capabilities/commandDetection/terminalCommand.js';\nimport { AccessibilityVerbositySettingId } from '../../../accessibility/browser/accessibilityConfiguration.js';\nimport { ITerminalInstance, ITerminalService } from '../../../terminal/browser/terminal.js';\nimport { BufferContentTracker } from './bufferContentTracker.js';\nimport { TerminalAccessibilitySettingId } from '../common/terminalAccessibilityConfiguration.js';\n\nexport class TerminalAccessibleBufferProvider extends Disposable implements IAccessibleViewContentProvider {\n\tid = AccessibleViewProviderId.Terminal;\n\toptions: IAccessibleViewOptions = { type: AccessibleViewType.View, language: 'terminal', id: AccessibleViewProviderId.Terminal };\n\tverbositySettingKey = AccessibilityVerbositySettingId.Terminal;\n\tprivate readonly _onDidRequestClearProvider = new Emitter<AccessibleViewProviderId>();\n\treadonly onDidRequestClearLastProvider = this._onDidRequestClearProvider.event;\n\tprivate _focusedInstance: ITerminalInstance | undefined;\n\tconstructor(\n\t\tprivate readonly _instance: Pick<ITerminalInstance, 'onDidExecuteText' | 'focus' | 'shellType' | 'capabilities' | 'onDidRequestFocus' | 'resource' | 'onDisposed'>,\n\t\tprivate _bufferTracker: BufferContentTracker,\n\t\tcustomHelp: () => string,\n\t\t@IModelService _modelService: IModelService,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IContextKeyService _contextKeyService: IContextKeyService,\n\t\t@ITerminalService _terminalService: ITerminalService\n\t) {\n\t\tsuper();\n\t\tthis.options.customHelp = customHelp;\n\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\tthis._register(this._instance.onDisposed(() => this._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal)));\n\t\tthis._register(configurationService.onDidChangeConfiguration(e => {\n\t\t\tif (e.affectsConfiguration(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition)) {\n\t\t\t\tthis.options.position = configurationService.getValue(TerminalAccessibilitySettingId.AccessibleViewPreserveCursorPosition) ? 'initial-bottom' : 'bottom';\n\t\t\t}\n\t\t}));\n\t\tthis._focusedInstance = _terminalService.activeInstance;\n\t\tthis._register(_terminalService.onDidChangeActiveInstance(() => {\n\t\t\tif (_terminalService.activeInstance && this._focusedInstance?.instanceId !== _terminalService.activeInstance?.instanceId) {\n\t\t\t\tthis._onDidRequestClearProvider.fire(AccessibleViewProviderId.Terminal);\n\t\t\t\tthis._focusedInstance = _terminalService.activeInstance;\n\t\t\t}\n\t\t}));\n\t}\n\n\tonClose() {\n\t\tthis._instance.focus();\n\t}\n\n\tprovideContent(): string {\n\t\tthis._bufferTracker.update();\n\t\treturn this._bufferTracker.lines.join('\\n');\n\t}\n\n\tgetSymbols(): IAccessibleViewSymbol[] {\n\t\tconst commands = this._getCommandsWithEditorLine() ?? [];\n\t\tconst symbols: IAccessibleViewSymbol[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst label = command.command.command;\n\t\t\tif (label) {\n\t\t\t\tsymbols.push({\n\t\t\t\t\tlabel,\n\t\t\t\t\tlineNumber: command.lineNumber\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t\treturn symbols;\n\t}\n\n\tprivate _getCommandsWithEditorLine(): ICommandWithEditorLine[] | undefined {\n\t\tconst capability = this._instance.capabilities.get(TerminalCapability.CommandDetection);\n\t\tconst commands = capability?.commands;\n\t\tconst currentCommand = capability?.currentCommand;\n\t\tif (!commands?.length) {\n\t\t\treturn;\n\t\t}\n\t\tconst result: ICommandWithEditorLine[] = [];\n\t\tfor (const command of commands) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(command);\n\t\t\tif (lineNumber === undefined) {\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\tresult.push({ command, lineNumber, exitCode: command.exitCode });\n\t\t}\n\t\tif (currentCommand) {\n\t\t\tconst lineNumber = this._getEditorLineForCommand(currentCommand);\n\t\t\tif (lineNumber !== undefined) {\n\t\t\t\tresult.push({ command: currentCommand, lineNumber });\n\t\t\t}\n\t\t}\n\t\treturn result;\n\t}\n\tprivate _getEditorLineForCommand(command: ITerminalCommand | ICurrentPartialCommand): number | undefined {\n\t\tlet line: number | undefined;\n\t\tif ('marker' in command) {\n\t\t\tline = command.marker?.line;\n\t\t} else if ('commandStartMarker' in command) {\n\t\t\tline = command.commandStartMarker?.line;\n\t\t}\n\t\tif (line === undefined || line < 0) {\n\t\t\treturn;\n\t\t}\n\t\tline = this._bufferTracker.bufferToEditorLineMapping.get(line);\n\t\tif (line === undefined) {\n\t\t\treturn;\n\t\t}\n\t\treturn line + 1;\n\t}\n}\nexport interface ICommandWithEditorLine { command: ITerminalCommand | ICurrentPartialCommand; lineNumber: number; exitCode?: number }\n\n"],
  "mappings": "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",
  "names": []
}
