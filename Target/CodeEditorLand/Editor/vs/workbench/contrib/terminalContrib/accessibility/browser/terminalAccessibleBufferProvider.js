var C=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var f=(s,r,i,e)=>{for(var t=e>1?void 0:e?b(r,i):r,o=s.length-1,n;o>=0;o--)(n=s[o])&&(t=(e?n(r,i,t):n(t))||t);return e&&t&&C(r,i,t),t},m=(s,r)=>(i,e)=>r(i,e,s);import{Emitter as I}from"../../../../../base/common/event.js";import{Disposable as h}from"../../../../../base/common/lifecycle.js";import{IModelService as y}from"../../../../../editor/common/services/model.js";import{AccessibleViewProviderId as c,AccessibleViewType as v}from"../../../../../platform/accessibility/browser/accessibleView.js";import{IConfigurationService as g}from"../../../../../platform/configuration/common/configuration.js";import{IContextKeyService as T}from"../../../../../platform/contextkey/common/contextkey.js";import{TerminalCapability as _}from"../../../../../platform/terminal/common/capabilities/capabilities.js";import{AccessibilityVerbositySettingId as V}from"../../../accessibility/browser/accessibilityConfiguration.js";import{ITerminalService as P}from"../../../terminal/browser/terminal.js";import{TerminalAccessibilitySettingId as u}from"../common/terminalAccessibilityConfiguration.js";let d=class extends h{constructor(i,e,t,o,n,l,a){super();this._instance=i;this._bufferTracker=e;this.options.customHelp=t,this.options.position=n.getValue(u.AccessibleViewPreserveCursorPosition)?"initial-bottom":"bottom",this._register(this._instance.onDisposed(()=>this._onDidRequestClearProvider.fire(c.Terminal))),this._register(n.onDidChangeConfiguration(p=>{p.affectsConfiguration(u.AccessibleViewPreserveCursorPosition)&&(this.options.position=n.getValue(u.AccessibleViewPreserveCursorPosition)?"initial-bottom":"bottom")})),this._focusedInstance=a.activeInstance,this._register(a.onDidChangeActiveInstance(()=>{a.activeInstance&&this._focusedInstance?.instanceId!==a.activeInstance?.instanceId&&(this._onDidRequestClearProvider.fire(c.Terminal),this._focusedInstance=a.activeInstance)}))}id=c.Terminal;options={type:v.View,language:"terminal",id:c.Terminal};verbositySettingKey=V.Terminal;_onDidRequestClearProvider=new I;onDidRequestClearLastProvider=this._onDidRequestClearProvider.event;_focusedInstance;onClose(){this._instance.focus()}provideContent(){return this._bufferTracker.update(),this._bufferTracker.lines.join(`
`)}getSymbols(){const i=this._getCommandsWithEditorLine()??[],e=[];for(const t of i){const o=t.command.command;o&&e.push({label:o,lineNumber:t.lineNumber})}return e}_getCommandsWithEditorLine(){const i=this._instance.capabilities.get(_.CommandDetection),e=i?.commands,t=i?.currentCommand;if(!e?.length)return;const o=[];for(const n of e){const l=this._getEditorLineForCommand(n);l!==void 0&&o.push({command:n,lineNumber:l,exitCode:n.exitCode})}if(t){const n=this._getEditorLineForCommand(t);n!==void 0&&o.push({command:t,lineNumber:n})}return o}_getEditorLineForCommand(i){let e;if("marker"in i?e=i.marker?.line:"commandStartMarker"in i&&(e=i.commandStartMarker?.line),!(e===void 0||e<0)&&(e=this._bufferTracker.bufferToEditorLineMapping.get(e),e!==void 0))return e+1}};d=f([m(3,y),m(4,g),m(5,T),m(6,P)],d);export{d as TerminalAccessibleBufferProvider};
