var C=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var f=(s,o,i,e)=>{for(var t=e>1?void 0:e?I(o,i):o,r=s.length-1,n;r>=0;r--)(n=s[r])&&(t=(e?n(o,i,t):n(t))||t);return e&&t&&C(o,i,t),t},m=(s,o)=>(i,e)=>o(i,e,s);import{Emitter as b}from"../../../../../../vs/base/common/event.js";import{Disposable as h}from"../../../../../../vs/base/common/lifecycle.js";import{IModelService as v}from"../../../../../../vs/editor/common/services/model.js";import{AccessibleViewProviderId as c,AccessibleViewType as g}from"../../../../../../vs/platform/accessibility/browser/accessibleView.js";import{IConfigurationService as T}from"../../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as _}from"../../../../../../vs/platform/contextkey/common/contextkey.js";import{TerminalCapability as y}from"../../../../../../vs/platform/terminal/common/capabilities/capabilities.js";import"../../../../../../vs/platform/terminal/common/capabilities/commandDetection/terminalCommand.js";import{AccessibilityVerbositySettingId as V}from"../../../../../../vs/workbench/contrib/accessibility/browser/accessibilityConfiguration.js";import{ITerminalService as P}from"../../../../../../vs/workbench/contrib/terminal/browser/terminal.js";import"../../../../../../vs/workbench/contrib/terminalContrib/accessibility/browser/bufferContentTracker.js";import{TerminalAccessibilitySettingId as u}from"../../../../../../vs/workbench/contrib/terminalContrib/accessibility/common/terminalAccessibilityConfiguration.js";let d=class extends h{constructor(i,e,t,r,n,l,a){super();this._instance=i;this._bufferTracker=e;this.options.customHelp=t,this.options.position=n.getValue(u.AccessibleViewPreserveCursorPosition)?"initial-bottom":"bottom",this._register(this._instance.onDisposed(()=>this._onDidRequestClearProvider.fire(c.Terminal))),this._register(n.onDidChangeConfiguration(p=>{p.affectsConfiguration(u.AccessibleViewPreserveCursorPosition)&&(this.options.position=n.getValue(u.AccessibleViewPreserveCursorPosition)?"initial-bottom":"bottom")})),this._focusedInstance=a.activeInstance,this._register(a.onDidChangeActiveInstance(()=>{a.activeInstance&&this._focusedInstance?.instanceId!==a.activeInstance?.instanceId&&(this._onDidRequestClearProvider.fire(c.Terminal),this._focusedInstance=a.activeInstance)}))}id=c.Terminal;options={type:g.View,language:"terminal",id:c.Terminal};verbositySettingKey=V.Terminal;_onDidRequestClearProvider=new b;onDidRequestClearLastProvider=this._onDidRequestClearProvider.event;_focusedInstance;onClose(){this._instance.focus()}provideContent(){return this._bufferTracker.update(),this._bufferTracker.lines.join(`
`)}getSymbols(){const i=this._getCommandsWithEditorLine()??[],e=[];for(const t of i){const r=t.command.command;r&&e.push({label:r,lineNumber:t.lineNumber})}return e}_getCommandsWithEditorLine(){const i=this._instance.capabilities.get(y.CommandDetection),e=i?.commands,t=i?.currentCommand;if(!e?.length)return;const r=[];for(const n of e){const l=this._getEditorLineForCommand(n);l!==void 0&&r.push({command:n,lineNumber:l,exitCode:n.exitCode})}if(t){const n=this._getEditorLineForCommand(t);n!==void 0&&r.push({command:t,lineNumber:n})}return r}_getEditorLineForCommand(i){let e;if("marker"in i?e=i.marker?.line:"commandStartMarker"in i&&(e=i.commandStartMarker?.line),!(e===void 0||e<0)&&(e=this._bufferTracker.bufferToEditorLineMapping.get(e),e!==void 0))return e+1}};d=f([m(3,v),m(4,T),m(5,_),m(6,P)],d);export{d as TerminalAccessibleBufferProvider};
