var d=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var c=(a,r,e,i)=>{for(var t=i>1?void 0:i?v(r,e):r,s=a.length-1,l;s>=0;s--)(l=a[s])&&(t=(i?l(r,e,t):l(t))||t);return i&&t&&d(r,e,t),t},o=(a,r)=>(e,i)=>r(e,i,a);import{debounce as u}from"../../../../../base/common/decorators.js";import{Event as m}from"../../../../../base/common/event.js";import{Disposable as _,MutableDisposable as h}from"../../../../../base/common/lifecycle.js";import{IAccessibilityService as b}from"../../../../../platform/accessibility/common/accessibility.js";import{IConfigurationService as f}from"../../../../../platform/configuration/common/configuration.js";import{TerminalCapability as p}from"../../../../../platform/terminal/common/capabilities/capabilities.js";import{ITerminalLogService as g,TerminalSettingId as y}from"../../../../../platform/terminal/common/terminal.js";let n=class extends _{constructor(e,i,t,s){super();this._capabilities=e;this._accessibilityService=i;this._configurationService=t;this._logService=s;this._register(m.runAndSubscribe(m.any(this._capabilities.onDidAddCapability,this._capabilities.onDidRemoveCapability,this._accessibilityService.onDidChangeScreenReaderOptimized),()=>{this._refreshListeners()}))}_terminal;_listeners=this._register(new h);activate(e){this._terminal=e,this._refreshListeners()}_refreshListeners(){const e=this._capabilities.get(p.CommandDetection);if(this._shouldBeActive()&&e){if(!this._listeners.value){const i=this._terminal?.textarea;i&&(this._listeners.value=m.runAndSubscribe(e.promptInputModel.onDidChangeInput,()=>this._sync(i)))}}else this._listeners.clear()}_shouldBeActive(){return this._accessibilityService.isScreenReaderOptimized()||this._configurationService.getValue(y.DevMode)}_sync(e){const i=this._capabilities.get(p.CommandDetection);i&&(e.value=i.promptInputModel.value,e.selectionStart=i.promptInputModel.cursorIndex,e.selectionEnd=i.promptInputModel.cursorIndex,this._logService.debug(`TextAreaSyncAddon#sync: text changed to "${e.value}"`))}};c([u(50)],n.prototype,"_sync",1),n=c([o(1,b),o(2,f),o(3,g)],n);export{n as TextAreaSyncAddon};
