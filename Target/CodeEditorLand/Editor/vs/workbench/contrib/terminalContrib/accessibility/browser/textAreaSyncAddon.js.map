{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/accessibility/browser/textAreaSyncAddon.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { ITerminalAddon, Terminal } from \"@xterm/xterm\";\nimport { debounce } from \"../../../../../base/common/decorators.js\";\nimport { Event } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tMutableDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { IAccessibilityService } from \"../../../../../platform/accessibility/common/accessibility.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport {\n\ttype ITerminalCapabilityStore,\n\tTerminalCapability,\n} from \"../../../../../platform/terminal/common/capabilities/capabilities.js\";\nimport {\n\tITerminalLogService,\n\tTerminalSettingId,\n} from \"../../../../../platform/terminal/common/terminal.js\";\n\nexport class TextAreaSyncAddon extends Disposable implements ITerminalAddon {\n\tprivate _terminal: Terminal | undefined;\n\tprivate readonly _listeners = this._register(new MutableDisposable());\n\n\tactivate(terminal: Terminal): void {\n\t\tthis._terminal = terminal;\n\t\tthis._refreshListeners();\n\t}\n\n\tconstructor(\n\t\tprivate readonly _capabilities: ITerminalCapabilityStore,\n\t\t@IAccessibilityService\n\t\tprivate readonly _accessibilityService: IAccessibilityService,\n\t\t@IConfigurationService\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t\t@ITerminalLogService private readonly _logService: ITerminalLogService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tEvent.runAndSubscribe(\n\t\t\t\tEvent.any(\n\t\t\t\t\tthis._capabilities.onDidAddCapability,\n\t\t\t\t\tthis._capabilities.onDidRemoveCapability,\n\t\t\t\t\tthis._accessibilityService.onDidChangeScreenReaderOptimized,\n\t\t\t\t),\n\t\t\t\t() => {\n\t\t\t\t\tthis._refreshListeners();\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate _refreshListeners(): void {\n\t\tconst commandDetection = this._capabilities.get(\n\t\t\tTerminalCapability.CommandDetection,\n\t\t);\n\t\tif (this._shouldBeActive() && commandDetection) {\n\t\t\tif (!this._listeners.value) {\n\t\t\t\tconst textarea = this._terminal?.textarea;\n\t\t\t\tif (textarea) {\n\t\t\t\t\tthis._listeners.value = Event.runAndSubscribe(\n\t\t\t\t\t\tcommandDetection.promptInputModel.onDidChangeInput,\n\t\t\t\t\t\t() => this._sync(textarea),\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tthis._listeners.clear();\n\t\t}\n\t}\n\n\tprivate _shouldBeActive(): boolean {\n\t\treturn (\n\t\t\tthis._accessibilityService.isScreenReaderOptimized() ||\n\t\t\tthis._configurationService.getValue(TerminalSettingId.DevMode)\n\t\t);\n\t}\n\n\t@debounce(50)\n\tprivate _sync(textArea: HTMLTextAreaElement): void {\n\t\tconst commandCapability = this._capabilities.get(\n\t\t\tTerminalCapability.CommandDetection,\n\t\t);\n\t\tif (!commandCapability) {\n\t\t\treturn;\n\t\t}\n\n\t\ttextArea.value = commandCapability.promptInputModel.value;\n\t\ttextArea.selectionStart =\n\t\t\tcommandCapability.promptInputModel.cursorIndex;\n\t\ttextArea.selectionEnd = commandCapability.promptInputModel.cursorIndex;\n\n\t\tthis._logService.debug(\n\t\t\t`TextAreaSyncAddon#sync: text changed to \"${textArea.value}\"`,\n\t\t);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAMA,SAAS,gBAAgB;AACzB,SAAS,aAAa;AACtB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,6BAA6B;AACtC,SAAS,6BAA6B;AACtC;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAEA,IAAM,oBAAN,cAAgC,WAAqC;AAAA,EAS3E,YACkB,eAEA,uBAEA,uBACqB,aACrC;AACD,UAAM;AAPW;AAEA;AAEA;AACqB;AAItC,SAAK;AAAA,MACJ,MAAM;AAAA,QACL,MAAM;AAAA,UACL,KAAK,cAAc;AAAA,UACnB,KAAK,cAAc;AAAA,UACnB,KAAK,sBAAsB;AAAA,QAC5B;AAAA,QACA,MAAM;AACL,eAAK,kBAAkB;AAAA,QACxB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAtDD,OAuB4E;AAAA;AAAA;AAAA,EACnE;AAAA,EACS,aAAa,KAAK,UAAU,IAAI,kBAAkB,CAAC;AAAA,EAEpE,SAAS,UAA0B;AAClC,SAAK,YAAY;AACjB,SAAK,kBAAkB;AAAA,EACxB;AAAA,EA0BQ,oBAA0B;AACjC,UAAM,mBAAmB,KAAK,cAAc;AAAA,MAC3C,mBAAmB;AAAA,IACpB;AACA,QAAI,KAAK,gBAAgB,KAAK,kBAAkB;AAC/C,UAAI,CAAC,KAAK,WAAW,OAAO;AAC3B,cAAM,WAAW,KAAK,WAAW;AACjC,YAAI,UAAU;AACb,eAAK,WAAW,QAAQ,MAAM;AAAA,YAC7B,iBAAiB,iBAAiB;AAAA,YAClC,MAAM,KAAK,MAAM,QAAQ;AAAA,UAC1B;AAAA,QACD;AAAA,MACD;AAAA,IACD,OAAO;AACN,WAAK,WAAW,MAAM;AAAA,IACvB;AAAA,EACD;AAAA,EAEQ,kBAA2B;AAClC,WACC,KAAK,sBAAsB,wBAAwB,KACnD,KAAK,sBAAsB,SAAS,kBAAkB,OAAO;AAAA,EAE/D;AAAA,EAGQ,MAAM,UAAqC;AAClD,UAAM,oBAAoB,KAAK,cAAc;AAAA,MAC5C,mBAAmB;AAAA,IACpB;AACA,QAAI,CAAC,mBAAmB;AACvB;AAAA,IACD;AAEA,aAAS,QAAQ,kBAAkB,iBAAiB;AACpD,aAAS,iBACR,kBAAkB,iBAAiB;AACpC,aAAS,eAAe,kBAAkB,iBAAiB;AAE3D,SAAK,YAAY;AAAA,MAChB,4CAA4C,SAAS,KAAK;AAAA,IAC3D;AAAA,EACD;AACD;AAjBS;AAAA,EADP,SAAS,EAAE;AAAA,GA3DA,kBA4DJ;AA5DI,oBAAN;AAAA,EAWJ;AAAA,EAEA;AAAA,EAEA;AAAA,GAfU;",
  "names": []
}
