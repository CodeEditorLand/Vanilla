var v=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var p=(d,s,e,o)=>{for(var t=o>1?void 0:o?f(s,e):s,n=d.length-1,r;n>=0;n--)(r=d[n])&&(t=(o?r(s,e,t):r(t))||t);return o&&t&&v(s,e,t),t},c=(d,s)=>(e,o)=>s(e,o,d);import{DisposableStore as u}from"../../../../../base/common/lifecycle.js";import*as a from"../../../../../base/browser/dom.js";import{RunOnceScheduler as _}from"../../../../../base/common/async.js";import{convertBufferRangeToViewport as m}from"./terminalLinkHelpers.js";import{isMacintosh as g}from"../../../../../base/common/platform.js";import{Emitter as y}from"../../../../../base/common/event.js";import{IConfigurationService as b}from"../../../../../platform/configuration/common/configuration.js";let l=class extends u{constructor(e,o,t,n,r,i,h,L,k,C,w,S,D){super();this._xterm=e;this.range=o;this.text=t;this.uri=n;this.parsedLink=r;this.actions=i;this._viewportY=h;this._activateCallback=L;this._tooltipCallback=k;this._isHighConfidenceLink=C;this.label=w;this._type=S;this._configurationService=D;this.decorations={pointerCursor:!1,underline:this._isHighConfidenceLink}}decorations;asyncActivate;_tooltipScheduler;_hoverListeners;_onInvalidated=new y;get onInvalidated(){return this._onInvalidated.event}get type(){return this._type}dispose(){super.dispose(),this._hoverListeners?.dispose(),this._hoverListeners=void 0,this._tooltipScheduler?.dispose(),this._tooltipScheduler=void 0}activate(e,o){this.asyncActivate=this._activateCallback(e,o)}hover(e,o){const t=a.getWindow(e),n=t.document;this._hoverListeners=new u,this._hoverListeners.add(a.addDisposableListener(n,"keydown",i=>{!i.repeat&&this._isModifierDown(i)&&this._enableDecorations()})),this._hoverListeners.add(a.addDisposableListener(n,"keyup",i=>{!i.repeat&&!this._isModifierDown(i)&&this._disableDecorations()})),this._hoverListeners.add(this._xterm.onRender(i=>{const h=this.range.start.y-this._viewportY;h>=i.start&&h<=i.end&&this._onInvalidated.fire()})),this._isHighConfidenceLink&&(this._tooltipScheduler=new _(()=>{this._tooltipCallback(this,m(this.range,this._viewportY),this._isHighConfidenceLink?()=>this._enableDecorations():void 0,this._isHighConfidenceLink?()=>this._disableDecorations():void 0),this._tooltipScheduler?.dispose(),this._tooltipScheduler=void 0},this._configurationService.getValue("workbench.hover.delay")),this.add(this._tooltipScheduler),this._tooltipScheduler.schedule());const r={x:e.pageX,y:e.pageY};this._hoverListeners.add(a.addDisposableListener(n,a.EventType.MOUSE_MOVE,i=>{this._isModifierDown(i)?this._enableDecorations():this._disableDecorations(),(Math.abs(i.pageX-r.x)>t.devicePixelRatio*2||Math.abs(i.pageY-r.y)>t.devicePixelRatio*2)&&(r.x=i.pageX,r.y=i.pageY,this._tooltipScheduler?.schedule())}))}leave(){this._hoverListeners?.dispose(),this._hoverListeners=void 0,this._tooltipScheduler?.dispose(),this._tooltipScheduler=void 0}_enableDecorations(){this.decorations.pointerCursor||(this.decorations.pointerCursor=!0),this.decorations.underline||(this.decorations.underline=!0)}_disableDecorations(){this.decorations.pointerCursor&&(this.decorations.pointerCursor=!1),this.decorations.underline!==this._isHighConfidenceLink&&(this.decorations.underline=this._isHighConfidenceLink)}_isModifierDown(e){return this._configurationService.getValue("editor.multiCursorModifier")==="ctrlCmd"?!!e.altKey:g?e.metaKey:e.ctrlKey}};l=p([c(12,b)],l);export{l as TerminalLink};
