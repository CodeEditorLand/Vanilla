import{posix as x,win32 as C}from"../../../../../base/common/path.js";import{OperatingSystem as y}from"../../../../../base/common/platform.js";import{TerminalCapability as B}from"../../../../../platform/terminal/common/capabilities/capabilities.js";function k(s,e,t,c){const i={start:{x:t.startColumn,y:t.startLineNumber+c},end:{x:t.endColumn-1,y:t.endLineNumber+c}};let n=0;const l=Math.ceil(t.startColumn/e);for(let r=0;r<Math.min(l);r++){const m=Math.min(e,t.startColumn-1-r*e);let o=0;const u=s[r];if(!u)break;for(let p=0;p<Math.min(e,m+o);p++){const g=u.getCell(p);if(!g)break;g.getWidth()===2&&o++;const d=g.getChars();d.length>1&&(o-=d.length-1)}n+=o}let a=0;const f=Math.ceil(t.endColumn/e);for(let r=Math.max(0,l-1);r<f;r++){const m=r===l-1?(t.startColumn-1+n)%e:0,o=Math.min(e,t.endColumn+n-r*e);let u=0;const p=s[r];if(!p)break;for(let g=m;g<Math.min(e,o+u);g++){const h=p.getCell(g);if(!h)break;const d=h.getWidth(),I=h.getChars();d===2&&u++,g===e-1&&I===""&&u++,I.length>1&&(u-=I.length-1)}a+=u}for(i.start.x+=n,i.end.x+=n+a;i.start.x>e;)i.start.x-=e,i.start.y++;for(;i.end.x>e;)i.end.x-=e,i.end.y++;return i}function M(s,e){return{start:{x:s.start.x-1,y:s.start.y-e-1},end:{x:s.end.x-1,y:s.end.y-e-1}}}function v(s,e,t,c){const i=Math.max(2048,c*2);t=Math.min(t,e+i);let n="";for(let l=e;l<=t;l++){const a=s.getLine(l);a&&(n+=a.translateToString(!0,0,c))}return n}function b(s,e,t,c){let i,n=-1,l=-1;const a=[];for(let f=e;f<=t;f++){const r=s.getLine(f);if(r)for(let m=0;m<c;m++){const o=r.getCell(m);if(!o)break;const u=o.isBold()|o.isInverse()|o.isStrikethrough()|o.isUnderline(),p=o.isDim()|o.isItalic();if(n===-1||l===-1)i={x:m,y:f};else if(n!==u||l!==p){const g={x:m,y:f};a.push({start:i,end:g}),i={x:m,y:f}}n=u,l=p}}return a}function S(s,e,t,c,i){const n=s.get(B.CommandDetection)?.getCwdForLine(e);if(i.trace("terminalLinkHelpers#updateLinkWithRelativeCwd cwd",n),!n)return;const l=[],a=c.sep;if(t.includes(a)){let f=0,r=0;const m=n.split(a).reverse(),o=t.split(a);for(;r<m.length&&(l.push(c.resolve(n+a+o.slice(f).join(a))),m[r]===o[r]);){f++;r++}}else l.push(c.resolve(n+a+t));return l}function T(s){return s===y.Windows?C:x}export{M as convertBufferRangeToViewport,k as convertLinkRangeToBuffer,v as getXtermLineContent,b as getXtermRangesByAttr,T as osPathModule,S as updateLinkWithRelativeCwd};
