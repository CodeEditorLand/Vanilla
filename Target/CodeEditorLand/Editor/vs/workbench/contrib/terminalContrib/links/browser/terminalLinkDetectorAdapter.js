var x=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var p=(s,a,e,i)=>{for(var t=i>1?void 0:i?w(a,e):a,n=s.length-1,r;n>=0;n--)(r=s[n])&&(t=(i?r(a,e,t):r(t))||t);return i&&t&&x(a,e,t),t},L=(s,a)=>(e,i)=>a(e,i,s);import{Emitter as h}from"../../../../../base/common/event.js";import{Disposable as I}from"../../../../../base/common/lifecycle.js";import{localize as c}from"../../../../../nls.js";import{IInstantiationService as g}from"../../../../../platform/instantiation/common/instantiation.js";import{TerminalBuiltinLinkType as o}from"./links.js";import{TerminalLink as y}from"./terminalLink.js";let d=class extends I{constructor(e,i){super();this._detector=e;this._instantiationService=i}_activeLinks;_onDidActivateLink=this._register(new h);onDidActivateLink=this._onDidActivateLink.event;_onDidShowHover=this._register(new h);onDidShowHover=this._onDidShowHover.event;_activeProvideLinkRequests=new Map;async provideLinks(e,i){let t=this._activeProvideLinkRequests.get(e);if(t){await t,i(this._activeLinks);return}if(this._activeLinks)for(const n of this._activeLinks)n.dispose();t=this._provideLinks(e),this._activeProvideLinkRequests.set(e,t),this._activeLinks=await t,this._activeProvideLinkRequests.delete(e),i(this._activeLinks)}async _provideLinks(e){const i=[];let t=e-1,n=t;const r=[this._detector.xterm.buffer.active.getLine(t)],l=Math.max(this._detector.maxLinkLength,this._detector.xterm.cols),v=Math.ceil(l/this._detector.xterm.cols),k=Math.max(t-v,0),f=Math.min(n+v,this._detector.xterm.buffer.active.length);for(;t>=k&&this._detector.xterm.buffer.active.getLine(t)?.isWrapped;)r.unshift(this._detector.xterm.buffer.active.getLine(t-1)),t--;for(;n<f&&this._detector.xterm.buffer.active.getLine(n+1)?.isWrapped;)r.push(this._detector.xterm.buffer.active.getLine(n+1)),n++;const _=await this._detector.detect(r,t,n);for(const m of _)i.push(this._createTerminalLink(m,async u=>this._onDidActivateLink.fire({link:m,event:u})));return i}_createTerminalLink(e,i){return!e.disableTrimColon&&e.text.length>0&&e.text.charAt(e.text.length-1)===":"&&(e.text=e.text.slice(0,-1),e.bufferRange.end.x--),this._instantiationService.createInstance(y,this._detector.xterm,e.bufferRange,e.text,e.uri,e.parsedLink,e.actions,this._detector.xterm.buffer.active.viewportY,i,(t,n,r,l)=>this._onDidShowHover.fire({link:t,viewportRange:n,modifierDownCallback:r,modifierUpCallback:l}),e.type!==o.Search,e.label||this._getLabel(e.type),e.type)}_getLabel(e){switch(e){case o.Search:return c("searchWorkspace","Search workspace");case o.LocalFile:return c("openFile","Open file in editor");case o.LocalFolderInWorkspace:return c("focusFolder","Focus folder in explorer");case o.LocalFolderOutsideWorkspace:return c("openFolder","Open folder in new window");case o.Url:default:return c("followLink","Follow link")}}};d=p([L(1,g)],d);export{d as TerminalLinkDetectorAdapter};
