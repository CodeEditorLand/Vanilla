{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/links/browser/terminalLink.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type {\n\tIBufferRange,\n\tILink,\n\tILinkDecorations,\n\tIViewportRange,\n\tTerminal,\n} from \"@xterm/xterm\";\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport type { IHoverAction } from \"../../../../../base/browser/ui/hover/hover.js\";\nimport { RunOnceScheduler } from \"../../../../../base/common/async.js\";\nimport { Emitter, type Event } from \"../../../../../base/common/event.js\";\nimport { DisposableStore } from \"../../../../../base/common/lifecycle.js\";\nimport { isMacintosh } from \"../../../../../base/common/platform.js\";\nimport type { URI } from \"../../../../../base/common/uri.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport type { TerminalLinkType } from \"./links.js\";\nimport { convertBufferRangeToViewport } from \"./terminalLinkHelpers.js\";\nimport type { IParsedLink } from \"./terminalLinkParsing.js\";\n\nexport class TerminalLink extends DisposableStore implements ILink {\n\tdecorations: ILinkDecorations;\n\tasyncActivate: Promise<void> | undefined;\n\n\tprivate _tooltipScheduler: RunOnceScheduler | undefined;\n\tprivate _hoverListeners: DisposableStore | undefined;\n\n\tprivate readonly _onInvalidated = new Emitter<void>();\n\tget onInvalidated(): Event<void> {\n\t\treturn this._onInvalidated.event;\n\t}\n\n\tget type(): TerminalLinkType {\n\t\treturn this._type;\n\t}\n\n\tconstructor(\n\t\tprivate readonly _xterm: Terminal,\n\t\treadonly range: IBufferRange,\n\t\treadonly text: string,\n\t\treadonly uri: URI | undefined,\n\t\treadonly parsedLink: IParsedLink | undefined,\n\t\treadonly actions: IHoverAction[] | undefined,\n\t\tprivate readonly _viewportY: number,\n\t\tprivate readonly _activateCallback: (event: MouseEvent | undefined, uri: string) => Promise<void>,\n\t\tprivate readonly _tooltipCallback: (link: TerminalLink, viewportRange: IViewportRange, modifierDownCallback?: () => void, modifierUpCallback?: () => void) => void,\n\t\tprivate readonly _isHighConfidenceLink: boolean,\n\t\treadonly label: string | undefined,\n\t\tprivate readonly _type: TerminalLinkType,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tsuper();\n\t\tthis.decorations = {\n\t\t\tpointerCursor: false,\n\t\t\tunderline: this._isHighConfidenceLink\n\t\t};\n\t}\n\n\toverride dispose(): void {\n\t\tsuper.dispose();\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tactivate(event: MouseEvent | undefined, text: string): void {\n\t\t// Trigger the xterm.js callback synchronously but track the promise resolution so we can\n\t\t// use it in tests\n\t\tthis.asyncActivate = this._activateCallback(event, text);\n\t}\n\n\thover(event: MouseEvent, text: string): void {\n\t\tconst w = dom.getWindow(event);\n\t\tconst d = w.document;\n\t\t// Listen for modifier before handing it off to the hover to handle so it gets disposed correctly\n\t\tthis._hoverListeners = new DisposableStore();\n\t\tthis._hoverListeners.add(\n\t\t\tdom.addDisposableListener(d, \"keydown\", (e) => {\n\t\t\t\tif (!e.repeat && this._isModifierDown(e)) {\n\t\t\t\t\tthis._enableDecorations();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._hoverListeners.add(\n\t\t\tdom.addDisposableListener(d, \"keyup\", (e) => {\n\t\t\t\tif (!e.repeat && !this._isModifierDown(e)) {\n\t\t\t\t\tthis._disableDecorations();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\t// Listen for when the terminal renders on the same line as the link\n\t\tthis._hoverListeners.add(\n\t\t\tthis._xterm.onRender((e) => {\n\t\t\t\tconst viewportRangeY = this.range.start.y - this._viewportY;\n\t\t\t\tif (viewportRangeY >= e.start && viewportRangeY <= e.end) {\n\t\t\t\t\tthis._onInvalidated.fire();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\n\t\t// Only show the tooltip and highlight for high confidence links (not word/search workspace\n\t\t// links). Feedback was that this makes using the terminal overly noisy.\n\t\tif (this._isHighConfidenceLink) {\n\t\t\tthis._tooltipScheduler = new RunOnceScheduler(() => {\n\t\t\t\tthis._tooltipCallback(\n\t\t\t\t\tthis,\n\t\t\t\t\tconvertBufferRangeToViewport(this.range, this._viewportY),\n\t\t\t\t\tthis._isHighConfidenceLink\n\t\t\t\t\t\t? () => this._enableDecorations()\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\tthis._isHighConfidenceLink\n\t\t\t\t\t\t? () => this._disableDecorations()\n\t\t\t\t\t\t: undefined,\n\t\t\t\t);\n\t\t\t\t// Clear out scheduler until next hover event\n\t\t\t\tthis._tooltipScheduler?.dispose();\n\t\t\t\tthis._tooltipScheduler = undefined;\n\t\t\t}, this._configurationService.getValue(\"workbench.hover.delay\"));\n\t\t\tthis.add(this._tooltipScheduler);\n\t\t\tthis._tooltipScheduler.schedule();\n\t\t}\n\n\t\tconst origin = { x: event.pageX, y: event.pageY };\n\t\tthis._hoverListeners.add(\n\t\t\tdom.addDisposableListener(d, dom.EventType.MOUSE_MOVE, (e) => {\n\t\t\t\t// Update decorations\n\t\t\t\tif (this._isModifierDown(e)) {\n\t\t\t\t\tthis._enableDecorations();\n\t\t\t\t} else {\n\t\t\t\t\tthis._disableDecorations();\n\t\t\t\t}\n\n\t\t\t\t// Reset the scheduler if the mouse moves too much\n\t\t\t\tif (\n\t\t\t\t\tMath.abs(e.pageX - origin.x) > w.devicePixelRatio * 2 ||\n\t\t\t\t\tMath.abs(e.pageY - origin.y) > w.devicePixelRatio * 2\n\t\t\t\t) {\n\t\t\t\t\torigin.x = e.pageX;\n\t\t\t\t\torigin.y = e.pageY;\n\t\t\t\t\tthis._tooltipScheduler?.schedule();\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tleave(): void {\n\t\tthis._hoverListeners?.dispose();\n\t\tthis._hoverListeners = undefined;\n\t\tthis._tooltipScheduler?.dispose();\n\t\tthis._tooltipScheduler = undefined;\n\t}\n\n\tprivate _enableDecorations(): void {\n\t\tif (!this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = true;\n\t\t}\n\t\tif (!this.decorations.underline) {\n\t\t\tthis.decorations.underline = true;\n\t\t}\n\t}\n\n\tprivate _disableDecorations(): void {\n\t\tif (this.decorations.pointerCursor) {\n\t\t\tthis.decorations.pointerCursor = false;\n\t\t}\n\t\tif (this.decorations.underline !== this._isHighConfidenceLink) {\n\t\t\tthis.decorations.underline = this._isHighConfidenceLink;\n\t\t}\n\t}\n\n\tprivate _isModifierDown(event: MouseEvent | KeyboardEvent): boolean {\n\t\tconst multiCursorModifier = this._configurationService.getValue<\n\t\t\t\"ctrlCmd\" | \"alt\"\n\t\t>(\"editor.multiCursorModifier\");\n\t\tif (multiCursorModifier === \"ctrlCmd\") {\n\t\t\treturn !!event.altKey;\n\t\t}\n\t\treturn isMacintosh ? event.metaKey : event.ctrlKey;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
