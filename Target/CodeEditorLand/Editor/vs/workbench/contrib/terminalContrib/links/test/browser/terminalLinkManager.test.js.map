{
  "version": 3,
  "sources": ["../../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/terminalContrib/links/test/browser/terminalLinkManager.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { deepStrictEqual, strictEqual } from 'assert';\nimport { equals } from '../../../../../../base/common/arrays.js';\nimport { IEditorOptions } from '../../../../../../editor/common/config/editorOptions.js';\nimport { IConfigurationService } from '../../../../../../platform/configuration/common/configuration.js';\nimport { TestConfigurationService } from '../../../../../../platform/configuration/test/common/testConfigurationService.js';\nimport { ContextMenuService } from '../../../../../../platform/contextview/browser/contextMenuService.js';\nimport { IContextMenuService } from '../../../../../../platform/contextview/browser/contextView.js';\nimport { TestInstantiationService } from '../../../../../../platform/instantiation/test/common/instantiationServiceMock.js';\nimport { ILogService, NullLogService } from '../../../../../../platform/log/common/log.js';\nimport { IStorageService } from '../../../../../../platform/storage/common/storage.js';\nimport { IThemeService } from '../../../../../../platform/theme/common/themeService.js';\nimport { TestThemeService } from '../../../../../../platform/theme/test/common/testThemeService.js';\nimport { IViewDescriptorService } from '../../../../../common/views.js';\nimport { IDetectedLinks, TerminalLinkManager } from '../../browser/terminalLinkManager.js';\nimport { ITerminalCapabilityImplMap, ITerminalCapabilityStore, TerminalCapability } from '../../../../../../platform/terminal/common/capabilities/capabilities.js';\nimport { ITerminalConfiguration, ITerminalProcessManager } from '../../../../terminal/common/terminal.js';\nimport { TestViewDescriptorService } from '../../../../terminal/test/browser/xterm/xtermTerminal.test.js';\nimport { TestStorageService } from '../../../../../test/common/workbenchTestServices.js';\nimport type { ILink, Terminal } from '@xterm/xterm';\nimport { TerminalLinkResolver } from '../../browser/terminalLinkResolver.js';\nimport { importAMDNodeModule } from '../../../../../../amdX.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../../../base/test/common/utils.js';\n\nconst defaultTerminalConfig: Partial<ITerminalConfiguration> = {\n\tfontFamily: 'monospace',\n\tfontWeight: 'normal',\n\tfontWeightBold: 'normal',\n\tgpuAcceleration: 'off',\n\tscrollback: 1000,\n\tfastScrollSensitivity: 2,\n\tmouseWheelScrollSensitivity: 1,\n\tunicodeVersion: '11',\n\twordSeparators: ' ()[]{}\\',\"`\u2500\u2018\u2019\u201C\u201D'\n};\n\nclass TestLinkManager extends TerminalLinkManager {\n\tprivate _links: IDetectedLinks | undefined;\n\tprotected override async _getLinksForType(y: number, type: 'word' | 'url' | 'localFile'): Promise<ILink[] | undefined> {\n\t\tswitch (type) {\n\t\t\tcase 'word':\n\t\t\t\treturn this._links?.wordLinks?.[y] ? [this._links?.wordLinks?.[y]] : undefined;\n\t\t\tcase 'url':\n\t\t\t\treturn this._links?.webLinks?.[y] ? [this._links?.webLinks?.[y]] : undefined;\n\t\t\tcase 'localFile':\n\t\t\t\treturn this._links?.fileLinks?.[y] ? [this._links?.fileLinks?.[y]] : undefined;\n\t\t}\n\t}\n\tsetLinks(links: IDetectedLinks): void {\n\t\tthis._links = links;\n\t}\n}\n\nsuite('TerminalLinkManager', () => {\n\tconst store = ensureNoDisposablesAreLeakedInTestSuite();\n\n\tlet instantiationService: TestInstantiationService;\n\tlet configurationService: TestConfigurationService;\n\tlet themeService: TestThemeService;\n\tlet viewDescriptorService: TestViewDescriptorService;\n\tlet xterm: Terminal;\n\tlet linkManager: TestLinkManager;\n\n\tsetup(async () => {\n\t\tconfigurationService = new TestConfigurationService({\n\t\t\teditor: {\n\t\t\t\tfastScrollSensitivity: 2,\n\t\t\t\tmouseWheelScrollSensitivity: 1\n\t\t\t} as Partial<IEditorOptions>,\n\t\t\tterminal: {\n\t\t\t\tintegrated: defaultTerminalConfig\n\t\t\t}\n\t\t});\n\t\tthemeService = new TestThemeService();\n\t\tviewDescriptorService = new TestViewDescriptorService();\n\n\t\tinstantiationService = store.add(new TestInstantiationService());\n\t\tinstantiationService.stub(IContextMenuService, store.add(instantiationService.createInstance(ContextMenuService)));\n\t\tinstantiationService.stub(IConfigurationService, configurationService);\n\t\tinstantiationService.stub(ILogService, new NullLogService());\n\t\tinstantiationService.stub(IStorageService, store.add(new TestStorageService()));\n\t\tinstantiationService.stub(IThemeService, themeService);\n\t\tinstantiationService.stub(IViewDescriptorService, viewDescriptorService);\n\n\t\tconst TerminalCtor = (await importAMDNodeModule<typeof import('@xterm/xterm')>('@xterm/xterm', 'lib/xterm.js')).Terminal;\n\t\txterm = store.add(new TerminalCtor({ allowProposedApi: true, cols: 80, rows: 30 }));\n\t\tlinkManager = store.add(instantiationService.createInstance(TestLinkManager, xterm, upcastPartial<ITerminalProcessManager>({\n\t\t\tget initialCwd() {\n\t\t\t\treturn '';\n\t\t\t}\n\t\t}), {\n\t\t\tget<T extends TerminalCapability>(capability: T): ITerminalCapabilityImplMap[T] | undefined {\n\t\t\t\treturn undefined;\n\t\t\t}\n\t\t} as Partial<ITerminalCapabilityStore> as any, instantiationService.createInstance(TerminalLinkResolver)));\n\t});\n\n\tsuite('registerExternalLinkProvider', () => {\n\t\ttest('should not leak disposables if the link manager is already disposed', () => {\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t\tlinkManager.dispose();\n\t\t\tlinkManager.externalProvideLinksCb = async () => undefined;\n\t\t});\n\t});\n\n\tsuite('getLinks and open recent link', () => {\n\t\ttest('should return no links', async () => {\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tequals(links.viewport.webLinks, []);\n\t\t\tequals(links.viewport.wordLinks, []);\n\t\t\tequals(links.viewport.fileLinks, []);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return word links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '1_\u6211\u662F\u5B66\u751F.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: {\n\t\t\t\t\tstart: { x: 1, y: 1 }, end: { x: 14, y: 1 }\n\t\t\t\t},\n\t\t\t\ttext: '2_\u6211\u662F\u5B66\u751F.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ wordLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.wordLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return web links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 5, y: 1 }, end: { x: 40, y: 1 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 1]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 5, y: 2 }, end: { x: 40, y: 2 } },\n\t\t\t\ttext: 'https://foo.bar/[this is foo site 2]',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ webLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.webLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, link2);\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, undefined);\n\t\t});\n\t\ttest('should return file links in order', async () => {\n\t\t\tconst link1 = {\n\t\t\t\trange: { start: { x: 1, y: 1 }, end: { x: 32, y: 1 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_1.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tconst link2 = {\n\t\t\t\trange: { start: { x: 1, y: 2 }, end: { x: 32, y: 2 } },\n\t\t\t\ttext: 'file:///C:/users/test/file_2.txt',\n\t\t\t\tactivate: () => Promise.resolve('')\n\t\t\t};\n\t\t\tlinkManager.setLinks({ fileLinks: [link1, link2] });\n\t\t\tconst links = await linkManager.getLinks();\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[0].text, link2.text);\n\t\t\tdeepStrictEqual(links.viewport.fileLinks?.[1].text, link1.text);\n\t\t\tconst webLink = await linkManager.openRecentLink('url');\n\t\t\tstrictEqual(webLink, undefined);\n\t\t\tlinkManager.setLinks({ fileLinks: [link2] });\n\t\t\tconst fileLink = await linkManager.openRecentLink('localFile');\n\t\t\tstrictEqual(fileLink, link2);\n\t\t});\n\t});\n});\nfunction upcastPartial<T>(v: Partial<T>): T {\n\treturn v as T;\n}\n"],
  "mappings": "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",
  "names": []
}
