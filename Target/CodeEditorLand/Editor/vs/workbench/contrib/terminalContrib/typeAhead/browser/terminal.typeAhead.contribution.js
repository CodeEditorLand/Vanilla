var l=Object.defineProperty;var c=Object.getOwnPropertyDescriptor;var m=(t,r,i,e)=>{for(var a=e>1?void 0:e?c(r,i):r,o=t.length-1,d;o>=0;o--)(d=t[o])&&(a=(e?d(r,i,a):d(a))||a);return e&&a&&l(r,i,a),a},s=(t,r)=>(i,e)=>r(i,e,t);import{DisposableStore as p,toDisposable as f}from"../../../../../../vs/base/common/lifecycle.js";import{IConfigurationService as h}from"../../../../../../vs/platform/configuration/common/configuration.js";import{IInstantiationService as I}from"../../../../../../vs/platform/instantiation/common/instantiation.js";import"../../../../../../vs/workbench/contrib/terminal/browser/terminal.js";import{registerTerminalContribution as g}from"../../../../../../vs/workbench/contrib/terminal/browser/terminalExtensions.js";import"../../../../../../vs/workbench/contrib/terminal/browser/widgets/widgetManager.js";import{TERMINAL_CONFIG_SECTION as T}from"../../../../../../vs/workbench/contrib/terminal/common/terminal.js";import{TypeAheadAddon as u}from"../../../../../../vs/workbench/contrib/terminalContrib/typeAhead/browser/terminalTypeAheadAddon.js";import{TerminalTypeAheadSettingId as _}from"../../../../../../vs/workbench/contrib/terminalContrib/typeAhead/common/terminalTypeAheadConfiguration.js";let n=class extends p{constructor(i,e,a,o,d){super();this._processManager=e;this._configurationService=o;this._instantiationService=d;this.add(f(()=>this._addon?.dispose()))}static ID="terminal.typeAhead";static get(i){return i.getContribution(n.ID)}_addon;xtermReady(i){this._loadTypeAheadAddon(i.raw),this.add(this._configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration(_.LocalEchoEnabled)&&this._loadTypeAheadAddon(i.raw)})),this.add(this._processManager.onProcessReady(()=>{this._addon?.reset()}))}_loadTypeAheadAddon(i){const e=this._configurationService.getValue(T).localEchoEnabled,a=!!this._processManager.remoteAuthority;if(e==="off"||e==="auto"&&!a){this._addon?.dispose(),this._addon=void 0;return}this._addon||(e==="on"||e==="auto"&&a)&&(this._addon=this._instantiationService.createInstance(u,this._processManager),i.loadAddon(this._addon))}};n=m([s(3,h),s(4,I)],n),g(n.ID,n);
