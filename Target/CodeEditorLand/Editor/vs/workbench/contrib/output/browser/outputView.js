var T=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var f=(d,t,i,e)=>{for(var r=e>1?void 0:e?L(t,i):t,s=d.length-1,n;s>=0;s--)(n=d[s])&&(r=(e?n(t,i,r):n(r))||r);return e&&r&&T(t,i,r),r},o=(d,t)=>(i,e)=>t(i,e,d);import"./output.css";import{Dimension as E}from"../../../../base/browser/dom.js";import{createCancelablePromise as O}from"../../../../base/common/async.js";import{CursorChangeReason as K}from"../../../../editor/common/cursorEvents.js";import{ITextResourceConfigurationService as w}from"../../../../editor/common/services/textResourceConfiguration.js";import*as p from"../../../../nls.js";import{IConfigurationService as I}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as v}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as P}from"../../../../platform/contextview/browser/contextView.js";import{IFileService as _}from"../../../../platform/files/common/files.js";import{IHoverService as A}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as C}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as D}from"../../../../platform/instantiation/common/serviceCollection.js";import{IKeybindingService as V}from"../../../../platform/keybinding/common/keybinding.js";import{IOpenerService as R}from"../../../../platform/opener/common/opener.js";import{IStorageService as k}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as g}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as y}from"../../../../platform/theme/common/themeService.js";import{computeEditorAriaLabel as B}from"../../../browser/editor.js";import{AbstractTextResourceEditor as j}from"../../../browser/parts/editor/textResourceEditor.js";import{ViewPane as M}from"../../../browser/parts/views/viewPane.js";import{ResourceContextKey as U}from"../../../common/contextkeys.js";import{TextResourceEditorInput as H}from"../../../common/editor/textResourceEditorInput.js";import{IViewDescriptorService as W}from"../../../common/views.js";import{IEditorGroupsService as N}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as z}from"../../../services/editor/common/editorService.js";import{CONTEXT_IN_OUTPUT as F,CONTEXT_OUTPUT_SCROLL_LOCK as G,OUTPUT_VIEW_ID as S}from"../../../services/output/common/output.js";let l=class extends M{editor;channelId;editorPromise=null;scrollLockContextKey;get scrollLock(){return!!this.scrollLockContextKey.get()}set scrollLock(t){this.scrollLockContextKey.set(t)}constructor(t,i,e,r,s,n,a,u,m,h,b){super(t,i,e,r,s,n,a,u,m,h,b),this.scrollLockContextKey=G.bindTo(this.contextKeyService);const x=this._register(a.createChild(new D([v,this.scopedContextKeyService])));this.editor=this._register(x.createInstance(c)),this._register(this.editor.onTitleAreaUpdate(()=>{this.updateTitle(this.editor.getTitle()),this.updateActions()})),this._register(this.onDidChangeBodyVisibility(()=>this.onDidChangeVisibility(this.isBodyVisible())))}showChannel(t,i){this.channelId!==t.id&&this.setInput(t),i||this.focus()}focus(){super.focus(),this.editorPromise?.then(()=>this.editor.focus())}renderBody(t){super.renderBody(t),this.editor.create(t),t.classList.add("output-view");const i=this.editor.getControl();i.setAriaOptions({role:"document",activeDescendant:void 0}),this._register(i.onDidChangeModelContent(()=>{this.scrollLock||this.editor.revealLastLine()})),this._register(i.onDidChangeCursorPosition(e=>{if(e.reason!==K.Explicit||!this.configurationService.getValue("output.smartScroll.enabled"))return;const r=i.getModel();if(r){const s=e.position.lineNumber,n=r.getLineCount();this.scrollLock=n!==s}}))}layoutBody(t,i){super.layoutBody(t,i),this.editor.layout(new E(i,t))}onDidChangeVisibility(t){this.editor.setVisible(t),t||this.clearInput()}setInput(t){this.channelId=t.id;const i=this.createInput(t);(!this.editor.input||!i.matches(this.editor.input))&&(this.editorPromise?.cancel(),this.editorPromise=O(e=>this.editor.setInput(this.createInput(t),{preserveFocus:!0},Object.create(null),e).then(()=>this.editor)))}clearInput(){this.channelId=void 0,this.editor.clearInput(),this.editorPromise=null}createInput(t){return this.instantiationService.createInstance(H,t.uri,p.localize("output model title","{0} - Output",t.label),p.localize("channel","Output channel for '{0}'",t.label),void 0,void 0)}};l=f([o(1,V),o(2,P),o(3,I),o(4,v),o(5,W),o(6,C),o(7,R),o(8,y),o(9,g),o(10,A)],l);let c=class extends j{constructor(i,e,r,s,n,a,u,m,h){super(S,u.activeGroup,i,e,r,n,a,u,m,h);this.configurationService=s;this.resourceContext=this._register(e.createInstance(U))}resourceContext;getId(){return S}getTitle(){return p.localize("output","Output")}getConfigurationOverrides(i){const e=super.getConfigurationOverrides(i);e.wordWrap="on",e.lineNumbers="off",e.glyphMargin=!1,e.lineDecorationsWidth=20,e.rulers=[],e.folding=!1,e.scrollBeyondLastLine=!1,e.renderLineHighlight="none",e.minimap={enabled:!1},e.renderValidationDecorations="editable",e.padding=void 0,e.readOnly=!0,e.domReadOnly=!0,e.unicodeHighlight={nonBasicASCII:!1,invisibleCharacters:!1,ambiguousCharacters:!1};const r=this.configurationService.getValue("[Log]");return r&&(r["editor.minimap.enabled"]&&(e.minimap={enabled:!0}),"editor.wordWrap"in r&&(e.wordWrap=r["editor.wordWrap"])),e}getAriaLabel(){return this.input?this.input.getAriaLabel():p.localize("outputViewAriaLabel","Output panel")}computeAriaLabel(){return this.input?B(this.input,void 0,void 0,this.editorGroupService.count):this.getAriaLabel()}async setInput(i,e,r,s){const n=!(e&&e.preserveFocus);this.input&&i.matches(this.input)||(this.input&&this.input.dispose(),await super.setInput(i,e,r,s),this.resourceContext.set(i.resource),n&&this.focus(),this.revealLastLine())}clearInput(){this.input&&this.input.dispose(),super.clearInput(),this.resourceContext.reset()}createEditor(i){i.setAttribute("role","document"),super.createEditor(i);const e=this.scopedContextKeyService;e&&F.bindTo(e).set(!0)}};c=f([o(0,g),o(1,C),o(2,k),o(3,I),o(4,w),o(5,y),o(6,N),o(7,z),o(8,_)],c);export{l as OutputViewPane};
