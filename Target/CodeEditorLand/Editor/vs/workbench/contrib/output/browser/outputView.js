var T=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var f=(a,t,i,e)=>{for(var r=e>1?void 0:e?L(t,i):t,s=a.length-1,n;s>=0;s--)(n=a[s])&&(r=(e?n(t,i,r):n(r))||r);return e&&r&&T(t,i,r),r},o=(a,t)=>(i,e)=>t(i,e,a);import"./output.css";import*as l from"../../../../nls.js";import{ITelemetryService as I}from"../../../../platform/telemetry/common/telemetry.js";import{IStorageService as E}from"../../../../platform/storage/common/storage.js";import{ITextResourceConfigurationService as O}from"../../../../editor/common/services/textResourceConfiguration.js";import{IInstantiationService as v}from"../../../../platform/instantiation/common/instantiation.js";import{IContextKeyService as C}from"../../../../platform/contextkey/common/contextkey.js";import{AbstractTextResourceEditor as K}from"../../../browser/parts/editor/textResourceEditor.js";import{OUTPUT_VIEW_ID as g,CONTEXT_IN_OUTPUT as P,CONTEXT_OUTPUT_SCROLL_LOCK as _}from"../../../services/output/common/output.js";import{IThemeService as S}from"../../../../platform/theme/common/themeService.js";import{IConfigurationService as y}from"../../../../platform/configuration/common/configuration.js";import{IEditorGroupsService as w}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as A}from"../../../services/editor/common/editorService.js";import{CursorChangeReason as D}from"../../../../editor/common/cursorEvents.js";import{ViewPane as V}from"../../../browser/parts/views/viewPane.js";import{IKeybindingService as R}from"../../../../platform/keybinding/common/keybinding.js";import{IContextMenuService as k}from"../../../../platform/contextview/browser/contextView.js";import{IViewDescriptorService as B}from"../../../common/views.js";import{TextResourceEditorInput as M}from"../../../common/editor/textResourceEditorInput.js";import{IOpenerService as U}from"../../../../platform/opener/common/opener.js";import{Dimension as H}from"../../../../base/browser/dom.js";import{createCancelablePromise as W}from"../../../../base/common/async.js";import{IFileService as N}from"../../../../platform/files/common/files.js";import{ResourceContextKey as z}from"../../../common/contextkeys.js";import{ServiceCollection as F}from"../../../../platform/instantiation/common/serviceCollection.js";import{computeEditorAriaLabel as G}from"../../../browser/editor.js";import{IHoverService as X}from"../../../../platform/hover/browser/hover.js";let p=class extends V{editor;channelId;editorPromise=null;scrollLockContextKey;get scrollLock(){return!!this.scrollLockContextKey.get()}set scrollLock(t){this.scrollLockContextKey.set(t)}constructor(t,i,e,r,s,n,d,u,m,h,b){super(t,i,e,r,s,n,d,u,m,h,b),this.scrollLockContextKey=_.bindTo(this.contextKeyService);const x=this._register(d.createChild(new F([C,this.scopedContextKeyService])));this.editor=this._register(x.createInstance(c)),this._register(this.editor.onTitleAreaUpdate(()=>{this.updateTitle(this.editor.getTitle()),this.updateActions()})),this._register(this.onDidChangeBodyVisibility(()=>this.onDidChangeVisibility(this.isBodyVisible())))}showChannel(t,i){this.channelId!==t.id&&this.setInput(t),i||this.focus()}focus(){super.focus(),this.editorPromise?.then(()=>this.editor.focus())}renderBody(t){super.renderBody(t),this.editor.create(t),t.classList.add("output-view");const i=this.editor.getControl();i.setAriaOptions({role:"document",activeDescendant:void 0}),this._register(i.onDidChangeModelContent(()=>{this.scrollLock||this.editor.revealLastLine()})),this._register(i.onDidChangeCursorPosition(e=>{if(e.reason!==D.Explicit||!this.configurationService.getValue("output.smartScroll.enabled"))return;const r=i.getModel();if(r){const s=e.position.lineNumber,n=r.getLineCount();this.scrollLock=n!==s}}))}layoutBody(t,i){super.layoutBody(t,i),this.editor.layout(new H(i,t))}onDidChangeVisibility(t){this.editor.setVisible(t),t||this.clearInput()}setInput(t){this.channelId=t.id;const i=this.createInput(t);(!this.editor.input||!i.matches(this.editor.input))&&(this.editorPromise?.cancel(),this.editorPromise=W(e=>this.editor.setInput(this.createInput(t),{preserveFocus:!0},Object.create(null),e).then(()=>this.editor)))}clearInput(){this.channelId=void 0,this.editor.clearInput(),this.editorPromise=null}createInput(t){return this.instantiationService.createInstance(M,t.uri,l.localize("output model title","{0} - Output",t.label),l.localize("channel","Output channel for '{0}'",t.label),void 0,void 0)}};p=f([o(1,R),o(2,k),o(3,y),o(4,C),o(5,B),o(6,v),o(7,U),o(8,S),o(9,I),o(10,X)],p);let c=class extends K{constructor(i,e,r,s,n,d,u,m,h){super(g,u.activeGroup,i,e,r,n,d,u,m,h);this.configurationService=s;this.resourceContext=this._register(e.createInstance(z))}resourceContext;getId(){return g}getTitle(){return l.localize("output","Output")}getConfigurationOverrides(i){const e=super.getConfigurationOverrides(i);e.wordWrap="on",e.lineNumbers="off",e.glyphMargin=!1,e.lineDecorationsWidth=20,e.rulers=[],e.folding=!1,e.scrollBeyondLastLine=!1,e.renderLineHighlight="none",e.minimap={enabled:!1},e.renderValidationDecorations="editable",e.padding=void 0,e.readOnly=!0,e.domReadOnly=!0,e.unicodeHighlight={nonBasicASCII:!1,invisibleCharacters:!1,ambiguousCharacters:!1};const r=this.configurationService.getValue("[Log]");return r&&(r["editor.minimap.enabled"]&&(e.minimap={enabled:!0}),"editor.wordWrap"in r&&(e.wordWrap=r["editor.wordWrap"])),e}getAriaLabel(){return this.input?this.input.getAriaLabel():l.localize("outputViewAriaLabel","Output panel")}computeAriaLabel(){return this.input?G(this.input,void 0,void 0,this.editorGroupService.count):this.getAriaLabel()}async setInput(i,e,r,s){const n=!(e&&e.preserveFocus);this.input&&i.matches(this.input)||(this.input&&this.input.dispose(),await super.setInput(i,e,r,s),this.resourceContext.set(i.resource),n&&this.focus(),this.revealLastLine())}clearInput(){this.input&&this.input.dispose(),super.clearInput(),this.resourceContext.reset()}createEditor(i){i.setAttribute("role","document"),super.createEditor(i);const e=this.scopedContextKeyService;e&&P.bindTo(e).set(!0)}};c=f([o(0,I),o(1,v),o(2,E),o(3,y),o(4,O),o(5,S),o(6,w),o(7,A),o(8,N)],c);export{p as OutputViewPane};
