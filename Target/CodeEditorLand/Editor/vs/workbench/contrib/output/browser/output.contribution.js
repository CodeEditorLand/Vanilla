var J=Object.defineProperty;var Z=Object.getOwnPropertyDescriptor;var M=(C,a,e,t)=>{for(var o=t>1?void 0:t?Z(a,e):a,i=C.length-1,r;i>=0;i--)(r=C[i])&&(o=(t?r(a,e,o):r(o))||o);return t&&o&&J(a,e,o),o},T=(C,a)=>(e,t)=>a(e,t,C);import*as c from"../../../../nls.js";import{KeyMod as v,KeyChord as ee,KeyCode as y}from"../../../../base/common/keyCodes.js";import{ModesRegistry as z}from"../../../../editor/common/languages/modesRegistry.js";import{Registry as b}from"../../../../platform/registry/common/platform.js";import{MenuId as h,registerAction2 as m,Action2 as f,MenuRegistry as q}from"../../../../platform/actions/common/actions.js";import{InstantiationType as te,registerSingleton as ie}from"../../../../platform/instantiation/common/extensions.js";import{OutputService as oe}from"./outputServices.js";import{OUTPUT_MODE_ID as re,OUTPUT_MIME as ne,OUTPUT_VIEW_ID as p,IOutputService as O,CONTEXT_IN_OUTPUT as se,LOG_MODE_ID as ce,LOG_MIME as le,CONTEXT_ACTIVE_FILE_OUTPUT as Q,CONTEXT_OUTPUT_SCROLL_LOCK as ue,ACTIVE_OUTPUT_CHANNEL_CONTEXT as ae,CONTEXT_ACTIVE_OUTPUT_LEVEL_SETTABLE as pe,Extensions as de,CONTEXT_ACTIVE_OUTPUT_LEVEL as ge,CONTEXT_ACTIVE_OUTPUT_LEVEL_IS_DEFAULT as he}from"../../../services/output/common/output.js";import{OutputViewPane as me}from"./outputView.js";import{SyncDescriptor as K}from"../../../../platform/instantiation/common/descriptors.js";import{Extensions as fe}from"../../../common/contributions.js";import{LifecyclePhase as ve}from"../../../services/lifecycle/common/lifecycle.js";import"../../../../platform/instantiation/common/instantiation.js";import{ViewContainerLocation as Ce,Extensions as X}from"../../../common/views.js";import{IViewsService as we}from"../../../services/views/common/viewsService.js";import{ViewPaneContainer as Oe}from"../../../browser/parts/views/viewPaneContainer.js";import{Extensions as ye,ConfigurationScope as Se}from"../../../../platform/configuration/common/configurationRegistry.js";import{IQuickInputService as N}from"../../../../platform/quickinput/common/quickInput.js";import{AUX_WINDOW_GROUP as Ie,IEditorService as B}from"../../../services/editor/common/editorService.js";import{assertIsDefined as be}from"../../../../base/common/types.js";import{ContextKeyExpr as u}from"../../../../platform/contextkey/common/contextkey.js";import{Codicon as S}from"../../../../base/common/codicons.js";import{registerIcon as Ae}from"../../../../platform/theme/common/iconRegistry.js";import{Categories as U}from"../../../../platform/action/common/actionCommonCategories.js";import{Disposable as Te,dispose as Le,toDisposable as ke}from"../../../../base/common/lifecycle.js";import{IFilesConfigurationService as H}from"../../../services/filesConfiguration/common/filesConfigurationService.js";import{AccessibilitySignal as _e,IAccessibilitySignalService as Ee}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{ILoggerService as G,LogLevel as I,LogLevelToLocalizedString as xe,LogLevelToString as Pe}from"../../../../platform/log/common/log.js";import{IDefaultLogLevelsService as De}from"../../logs/common/defaultLogLevels.js";import{EditorOptions as L}from"../../../../editor/common/config/editorOptions.js";import{getMapForWordSeparators as k}from"../../../../editor/common/core/wordCharacterClassifier.js";import{WordNavigationType as _}from"../../../../editor/common/cursor/cursorWordOperations.js";import{EditorContextKeys as E}from"../../../../editor/common/editorContextKeys.js";import"../../../../editor/common/model.js";import{WordLeftCommand as Y,WordRightCommand as $}from"../../../../editor/contrib/wordOperations/browser/wordOperations.js";import{CONTEXT_ACCESSIBILITY_MODE_ENABLED as x}from"../../../../platform/accessibility/common/accessibility.js";import{IsWindowsContext as P}from"../../../../platform/contextkey/common/contextkeys.js";import{KeybindingWeight as D}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import"../../../../editor/common/core/position.js";import{registerEditorCommand as W}from"../../../../editor/browser/editorExtensions.js";import{FocusedViewContext as V}from"../../../common/contextkeys.js";ie(O,oe,te.Delayed),z.registerLanguage({id:re,extensions:[],mimetypes:[ne]}),z.registerLanguage({id:ce,extensions:[],mimetypes:[le]});const j=Ae("output-view-icon",S.output,c.localize("outputViewIcon","View icon of the output view.")),We=b.as(X.ViewContainersRegistry).registerViewContainer({id:p,title:c.localize2("output","Output"),icon:j,order:1,ctorDescriptor:new K(Oe,[p,{mergeViewWithContainerWhenSingleView:!0}]),storageId:p,hideIfEmpty:!0},Ce.Panel,{doNotRegisterOpenCommand:!0});b.as(X.ViewsRegistry).registerViews([{id:p,name:c.localize2("output","Output"),containerIcon:j,canMoveView:!0,canToggleVisibility:!1,ctorDescriptor:new K(me),openCommandActionDescriptor:{id:"workbench.action.output.toggleOutput",mnemonicTitle:c.localize({key:"miToggleOutput",comment:["&& denotes a mnemonic"]},"&&Output"),keybindings:{primary:v.CtrlCmd|v.Shift|y.KeyU,linux:{primary:ee(v.CtrlCmd|y.KeyK,v.CtrlCmd|y.KeyH)}},order:1}}],We);let A=class extends Te{constructor(e,t,o){super();this.outputService=e;this.editorService=t;this.fileConfigurationService=o;this.registerActions()}registerActions(){this.registerSwitchOutputAction(),this.registerShowOutputChannelsAction(),this.registerClearOutputAction(),this.registerToggleAutoScrollAction(),this.registerOpenActiveOutputFileAction(),this.registerOpenActiveOutputFileInAuxWindowAction(),this.registerShowLogsAction(),this.registerOpenLogFileAction(),this.registerConfigureActiveOutputLogLevelAction()}registerSwitchOutputAction(){this._register(m(class extends f{constructor(){super({id:"workbench.output.action.switchBetweenOutputs",title:c.localize("switchBetweenOutputs.label","Switch Output")})}async run(r,n){n&&r.get(O).showChannel(n,!0)}}));const e=new h("workbench.output.menu.switchOutput");this._register(q.appendMenuItem(h.ViewTitle,{submenu:e,title:c.localize("switchToOutput.label","Switch Output"),group:"navigation",when:u.equals("view",p),order:1,isSelection:!0}));const t=new Map;this._register(ke(()=>Le(t.values())));const o=r=>{for(const n of r){const l=n.label,s=n.extensionId?"0_ext_outputchannels":"1_core_outputchannels";t.set(n.id,m(class extends f{constructor(){super({id:`workbench.action.output.show.${n.id}`,title:l,toggled:ae.isEqualTo(n.id),menu:{id:e,group:s}})}async run(g){return g.get(O).showChannel(n.id,!0)}}))}};o(this.outputService.getChannelDescriptors());const i=b.as(de.OutputChannels);this._register(i.onDidRegisterChannel(r=>{const n=this.outputService.getChannelDescriptor(r);n&&o([n])})),this._register(i.onDidRemoveChannel(r=>{t.get(r)?.dispose(),t.delete(r)}))}registerShowOutputChannelsAction(){this._register(m(class extends f{constructor(){super({id:"workbench.action.showOutputChannels",title:c.localize2("showOutputChannels","Show Output Channels..."),category:c.localize2("output","Output"),f1:!0})}async run(e){const t=e.get(O),o=e.get(N),i=[],r=[];for(const s of t.getChannelDescriptors())s.extensionId?i.push(s):r.push(s);const n=[];for(const{id:s,label:g}of i)n.push({id:s,label:g});i.length&&r.length&&n.push({type:"separator"});for(const{id:s,label:g}of r)n.push({id:s,label:g});const l=await o.pick(n,{placeHolder:c.localize("selectOutput","Select Output Channel")});if(l)return t.showChannel(l.id)}}))}registerClearOutputAction(){this._register(m(class extends f{constructor(){super({id:"workbench.output.action.clearOutput",title:c.localize2("clearOutput.label","Clear Output"),category:U.View,menu:[{id:h.ViewTitle,when:u.equals("view",p),group:"navigation",order:2},{id:h.CommandPalette},{id:h.EditorContext,when:se}],icon:S.clearAll})}async run(e){const t=e.get(O),o=e.get(Ee),i=t.getActiveChannel();i&&(i.clear(),o.playSignal(_e.clear))}}))}registerToggleAutoScrollAction(){this._register(m(class extends f{constructor(){super({id:"workbench.output.action.toggleAutoScroll",title:c.localize2("toggleAutoScroll","Toggle Auto Scrolling"),tooltip:c.localize("outputScrollOff","Turn Auto Scrolling Off"),menu:{id:h.ViewTitle,when:u.and(u.equals("view",p)),group:"navigation",order:3},icon:S.lock,toggled:{condition:ue,icon:S.unlock,tooltip:c.localize("outputScrollOn","Turn Auto Scrolling On")}})}async run(e){const t=e.get(we).getActiveViewWithId(p);t.scrollLock=!t.scrollLock}}))}registerOpenActiveOutputFileAction(){const e=this;this._register(m(class extends f{constructor(){super({id:"workbench.action.openActiveLogOutputFile",title:c.localize2("openActiveOutputFile","Open Output in Editor"),menu:[{id:h.ViewTitle,when:u.equals("view",p),group:"navigation",order:4,isHiddenByDefault:!0}],icon:S.goToFile,precondition:Q})}async run(){e.openActiveOutoutFile()}}))}registerOpenActiveOutputFileInAuxWindowAction(){const e=this;this._register(m(class extends f{constructor(){super({id:"workbench.action.openActiveLogOutputFileInNewWindow",title:c.localize2("openActiveOutputFileInNewWindow","Open Output in New Window"),menu:[{id:h.ViewTitle,when:u.equals("view",p),group:"navigation",order:5,isHiddenByDefault:!0}],icon:S.emptyWindow,precondition:Q})}async run(){e.openActiveOutoutFile(Ie)}}))}async openActiveOutoutFile(e){const t=this.getFileOutputChannelDescriptor();t&&(await this.fileConfigurationService.updateReadonly(t.file,!0),await this.editorService.openEditor({resource:t.file,options:{pinned:!0}},e))}getFileOutputChannelDescriptor(){const e=this.outputService.getActiveChannel();if(e){const t=this.outputService.getChannelDescriptors().filter(o=>o.id===e.id)[0];if(t?.file)return t}return null}registerConfigureActiveOutputLogLevelAction(){const e=this,t=new h("workbench.output.menu.logLevel");this._register(q.appendMenuItem(h.ViewTitle,{submenu:t,title:c.localize("logLevel.label","Set Log Level..."),group:"navigation",when:u.and(u.equals("view",p),pe),icon:S.gear,order:6}));let o=0;const i=r=>{this._register(m(class extends f{constructor(){super({id:`workbench.action.output.activeOutputLogLevel.${r}`,title:xe(r).value,toggled:ge.isEqualTo(Pe(r)),menu:{id:t,order:o++,group:"0_level"}})}async run(n){const l=e.outputService.getActiveChannel();if(l){const s=e.outputService.getChannelDescriptor(l.id);if(s?.log&&s.file)return n.get(G).setLogLevel(s.file,r)}}}))};i(I.Trace),i(I.Debug),i(I.Info),i(I.Warning),i(I.Error),i(I.Off),this._register(m(class extends f{constructor(){super({id:"workbench.action.output.activeOutputLogLevelDefault",title:c.localize("logLevelDefault.label","Set As Default"),menu:{id:t,order:o,group:"1_default"},precondition:he.negate()})}async run(r){const n=e.outputService.getActiveChannel();if(n){const l=e.outputService.getChannelDescriptor(n.id);if(l?.log&&l.file){const s=r.get(G).getLogLevel(l.file);return await r.get(De).setDefaultLogLevel(s,l.extensionId)}}}}))}registerShowLogsAction(){this._register(m(class extends f{constructor(){super({id:"workbench.action.showLogs",title:c.localize2("showLogs","Show Logs..."),category:U.Developer,menu:{id:h.CommandPalette}})}async run(e){const t=e.get(O),o=e.get(N),i=[],r=[];for(const s of t.getChannelDescriptors())s.log&&(s.extensionId?i.push(s):r.push(s));const n=[];for(const{id:s,label:g}of r)n.push({id:s,label:g});i.length&&r.length&&n.push({type:"separator",label:c.localize("extensionLogs","Extension Logs")});for(const{id:s,label:g}of i)n.push({id:s,label:g});const l=await o.pick(n,{placeHolder:c.localize("selectlog","Select Log")});if(l)return t.showChannel(l.id)}}))}registerOpenLogFileAction(){this._register(m(class extends f{constructor(){super({id:"workbench.action.openLogFile",title:c.localize2("openLogFile","Open Log File..."),category:U.Developer,menu:{id:h.CommandPalette},metadata:{description:"workbench.action.openLogFile",args:[{name:"logFile",schema:{markdownDescription:c.localize("logFile",'The id of the log file to open, for example `"window"`. Currently the best way to get this is to get the ID by checking the `workbench.action.output.show.<id>` commands'),type:"string"}}]}})}async run(e,t){const o=e.get(O),i=e.get(N),r=e.get(B),n=e.get(H);let l;const s=t&&typeof t=="string"?t:void 0,g=[],F=[];for(const d of o.getChannelDescriptors())if(d.file&&d.log){const w={id:d.id,label:d.label,channel:d};d.extensionId?g.push(w):F.push(w),w.id===s&&(l=w)}if(!l){const d=[...g.sort((w,R)=>w.label.localeCompare(R.label))];d.length&&F.length&&(d.push({type:"separator"}),d.push(...F.sort((w,R)=>w.label.localeCompare(R.label)))),l=await i.pick(d,{placeHolder:c.localize("selectlogFile","Select Log File")})}if(l){const d=be(l.channel.file);await n.updateReadonly(d,!0),await r.openEditor({resource:d,options:{pinned:!0}})}}}))}};A=M([T(0,O),T(1,B),T(2,H)],A),b.as(fe.Workbench).registerWorkbenchContribution(A,ve.Restored),b.as(ye.Configuration).registerConfiguration({id:"output",order:30,title:c.localize("output","Output"),type:"object",properties:{"output.smartScroll.enabled":{type:"boolean",description:c.localize("output.smartScroll.enabled","Enable/disable the ability of smart scrolling in the output view. Smart scrolling allows you to lock scrolling automatically when you click in the output view and unlocks when you click in the last line."),default:!0,scope:Se.WINDOW,tags:["output"]}}});class Ve extends Y{constructor(){super({inSelectionMode:!1,wordNavigationType:_.WordAccessibility,id:"cursorWordAccessibilityLeft",precondition:void 0,kbOpts:{kbExpr:u.and(E.textInputFocus,x,P,u.equals(V.key,p)),primary:v.CtrlCmd|y.LeftArrow,weight:D.EditorContrib}})}_move(a,e,t,o,i){return super._move(k(L.wordSeparators.defaultValue,a.intlSegmenterLocales),e,t,o,i)}}class Fe extends Y{constructor(){super({inSelectionMode:!0,wordNavigationType:_.WordAccessibility,id:"cursorWordAccessibilityLeftSelect",precondition:void 0,kbOpts:{kbExpr:u.and(E.textInputFocus,x,P,u.equals(V.key,p)),primary:v.CtrlCmd|v.Shift|y.LeftArrow,weight:D.EditorContrib}})}_move(a,e,t,o,i){return super._move(k(L.wordSeparators.defaultValue,a.intlSegmenterLocales),e,t,o,i)}}class Re extends ${constructor(){super({inSelectionMode:!1,wordNavigationType:_.WordAccessibility,id:"cursorWordAccessibilityRight",precondition:void 0,kbOpts:{kbExpr:u.and(E.textInputFocus,x,P,u.equals(V.key,p)),primary:v.CtrlCmd|y.RightArrow,weight:D.EditorContrib}})}_move(a,e,t,o,i){return super._move(k(L.wordSeparators.defaultValue,a.intlSegmenterLocales),e,t,o,i)}}class Ne extends ${constructor(){super({inSelectionMode:!0,wordNavigationType:_.WordAccessibility,id:"cursorWordAccessibilityRightSelect",precondition:void 0,kbOpts:{kbExpr:u.and(E.textInputFocus,x,P,u.equals(V.key,p)),primary:v.CtrlCmd|v.Shift|y.RightArrow,weight:D.EditorContrib}})}_move(a,e,t,o,i){return super._move(k(L.wordSeparators.defaultValue,a.intlSegmenterLocales),e,t,o,i)}}W(new Ve),W(new Fe),W(new Re),W(new Ne);export{Ve as CursorWordAccessibilityLeft,Fe as CursorWordAccessibilityLeftSelect,Re as CursorWordAccessibilityRight,Ne as CursorWordAccessibilityRightSelect};
