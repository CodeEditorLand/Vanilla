{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/markdown/browser/markdownDocumentRenderer.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { basicMarkupHtmlTags, hookDomPurifyHrefAndSrcSanitizer } from '../../../../base/browser/dom.js';\nimport * as dompurify from '../../../../base/browser/dompurify/dompurify.js';\nimport { allowedMarkdownAttr } from '../../../../base/browser/markdownRenderer.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport * as marked from '../../../../base/common/marked/marked.js';\nimport { Schemas } from '../../../../base/common/network.js';\nimport { escape } from '../../../../base/common/strings.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { tokenizeToString } from '../../../../editor/common/languages/textToHtmlTokenizer.js';\nimport { IExtensionService } from '../../../services/extensions/common/extensions.js';\nimport { markedGfmHeadingIdPlugin } from './markedGfmHeadingIdPlugin.js';\n\nexport const DEFAULT_MARKDOWN_STYLES = `\nbody {\n\tpadding: 10px 20px;\n\tline-height: 22px;\n\tmax-width: 882px;\n\tmargin: 0 auto;\n}\n\nbody *:last-child {\n\tmargin-bottom: 0;\n}\n\nimg {\n\tmax-width: 100%;\n\tmax-height: 100%;\n}\n\na {\n\ttext-decoration: var(--text-link-decoration);\n}\n\na:hover {\n\ttext-decoration: underline;\n}\n\na:focus,\ninput:focus,\nselect:focus,\ntextarea:focus {\n\toutline: 1px solid -webkit-focus-ring-color;\n\toutline-offset: -1px;\n}\n\nhr {\n\tborder: 0;\n\theight: 2px;\n\tborder-bottom: 2px solid;\n}\n\nh1 {\n\tpadding-bottom: 0.3em;\n\tline-height: 1.2;\n\tborder-bottom-width: 1px;\n\tborder-bottom-style: solid;\n}\n\nh1, h2, h3 {\n\tfont-weight: normal;\n}\n\ntable {\n\tborder-collapse: collapse;\n}\n\nth {\n\ttext-align: left;\n\tborder-bottom: 1px solid;\n}\n\nth,\ntd {\n\tpadding: 5px 10px;\n}\n\ntable > tbody > tr + tr > td {\n\tborder-top-width: 1px;\n\tborder-top-style: solid;\n}\n\nblockquote {\n\tmargin: 0 7px 0 5px;\n\tpadding: 0 16px 0 10px;\n\tborder-left-width: 5px;\n\tborder-left-style: solid;\n}\n\ncode {\n\tfont-family: \"SF Mono\", Monaco, Menlo, Consolas, \"Ubuntu Mono\", \"Liberation Mono\", \"DejaVu Sans Mono\", \"Courier New\", monospace;\n}\n\npre {\n\tpadding: 16px;\n\tborder-radius: 3px;\n\toverflow: auto;\n}\n\npre code {\n\tfont-family: var(--vscode-editor-font-family);\n\tfont-weight: var(--vscode-editor-font-weight);\n\tfont-size: var(--vscode-editor-font-size);\n\tline-height: 1.5;\n\tcolor: var(--vscode-editor-foreground);\n\ttab-size: 4;\n}\n\n.monaco-tokenized-source {\n\twhite-space: pre;\n}\n\n/** Theming */\n\n.pre {\n\tbackground-color: var(--vscode-textCodeBlock-background);\n}\n\n.vscode-high-contrast h1 {\n\tborder-color: rgb(0, 0, 0);\n}\n\n.vscode-light th {\n\tborder-color: rgba(0, 0, 0, 0.69);\n}\n\n.vscode-dark th {\n\tborder-color: rgba(255, 255, 255, 0.69);\n}\n\n.vscode-light h1,\n.vscode-light hr,\n.vscode-light td {\n\tborder-color: rgba(0, 0, 0, 0.18);\n}\n\n.vscode-dark h1,\n.vscode-dark hr,\n.vscode-dark td {\n\tborder-color: rgba(255, 255, 255, 0.18);\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: light){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n\n@media (forced-colors: active) and (prefers-color-scheme: dark){\n\tbody {\n\t\tforced-color-adjust: none;\n\t}\n}\n`;\n\nconst allowedProtocols = [Schemas.http, Schemas.https, Schemas.command];\nfunction sanitize(documentContent: string, allowUnknownProtocols: boolean): string {\n\n\tconst hook = hookDomPurifyHrefAndSrcSanitizer(allowedProtocols, true);\n\n\ttry {\n\t\treturn dompurify.sanitize(documentContent, {\n\t\t\t...{\n\t\t\t\tALLOWED_TAGS: [\n\t\t\t\t\t...basicMarkupHtmlTags,\n\t\t\t\t\t'checkbox',\n\t\t\t\t\t'checklist',\n\t\t\t\t],\n\t\t\t\tALLOWED_ATTR: [\n\t\t\t\t\t...allowedMarkdownAttr,\n\t\t\t\t\t'data-command', 'name', 'id', 'role', 'tabindex',\n\t\t\t\t\t'x-dispatch',\n\t\t\t\t\t'required', 'checked', 'placeholder', 'when-checked', 'checked-on',\n\t\t\t\t],\n\t\t\t},\n\t\t\t...(allowUnknownProtocols ? { ALLOW_UNKNOWN_PROTOCOLS: true } : {}),\n\t\t});\n\t} finally {\n\t\thook.dispose();\n\t}\n}\n\ninterface IRenderMarkdownDocumentOptions {\n\treadonly shouldSanitize?: boolean;\n\treadonly allowUnknownProtocols?: boolean;\n\treadonly markedExtensions?: marked.MarkedExtension[];\n\treadonly token?: CancellationToken;\n}\n\n/**\n * Renders a string of markdown as a document.\n *\n * Uses VS Code's syntax highlighting code blocks.\n */\nexport async function renderMarkdownDocument(\n\ttext: string,\n\textensionService: IExtensionService,\n\tlanguageService: ILanguageService,\n\toptions?: IRenderMarkdownDocumentOptions\n): Promise<string> {\n\tconst m = new marked.Marked(\n\t\tMarkedHighlight.markedHighlight({\n\t\t\tasync: true,\n\t\t\tasync highlight(code: string, lang: string): Promise<string> {\n\t\t\t\tif (typeof lang !== 'string') {\n\t\t\t\t\treturn escape(code);\n\t\t\t\t}\n\n\t\t\t\tawait extensionService.whenInstalledExtensionsRegistered();\n\t\t\t\tif (options?.token?.isCancellationRequested) {\n\t\t\t\t\treturn '';\n\t\t\t\t}\n\n\t\t\t\tconst languageId = languageService.getLanguageIdByLanguageName(lang) ?? languageService.getLanguageIdByLanguageName(lang.split(/\\s+|:|,|(?!^)\\{|\\?]/, 1)[0]);\n\t\t\t\treturn tokenizeToString(languageService, code, languageId);\n\t\t\t}\n\t\t}),\n\t\tmarkedGfmHeadingIdPlugin(),\n\t\t...(options?.markedExtensions ?? []),\n\t);\n\n\tconst raw = await m.parse(text, { async: true });\n\tif (options?.shouldSanitize ?? true) {\n\t\treturn sanitize(raw, options?.allowUnknownProtocols ?? false);\n\t} else {\n\t\treturn raw;\n\t}\n}\n\nnamespace MarkedHighlight {\n\t// Copied from https://github.com/markedjs/marked-highlight/blob/main/src/index.js\n\n\texport function markedHighlight(options: marked.MarkedOptions & { highlight: (code: string, lang: string, info: string) => string | Promise<string> }): marked.MarkedExtension {\n\t\tif (typeof options === 'function') {\n\t\t\toptions = {\n\t\t\t\thighlight: options,\n\t\t\t};\n\t\t}\n\n\t\tif (!options || typeof options.highlight !== 'function') {\n\t\t\tthrow new Error('Must provide highlight function');\n\t\t}\n\n\t\treturn {\n\t\t\tasync: !!options.async,\n\t\t\twalkTokens(token: marked.Token): Promise<void> | void {\n\t\t\t\tif (token.type !== 'code') {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst lang = getLang(token.lang);\n\n\t\t\t\tif (options.async) {\n\t\t\t\t\treturn Promise.resolve(options.highlight(token.text, lang, token.lang || '')).then(updateToken(token));\n\t\t\t\t}\n\n\t\t\t\tconst code = options.highlight(token.text, lang, token.lang || '');\n\t\t\t\tif (code instanceof Promise) {\n\t\t\t\t\tthrow new Error('markedHighlight is not set to async but the highlight function is async. Set the async option to true on markedHighlight to await the async highlight function.');\n\t\t\t\t}\n\t\t\t\tupdateToken(token)(code);\n\t\t\t},\n\t\t\trenderer: {\n\t\t\t\tcode({ text, lang, escaped }: marked.Tokens.Code) {\n\t\t\t\t\tconst classAttr = lang\n\t\t\t\t\t\t? ` class=\"language-${escape(lang)}\"`\n\t\t\t\t\t\t: '';\n\t\t\t\t\ttext = text.replace(/\\n$/, '');\n\t\t\t\t\treturn `<pre><code${classAttr}>${escaped ? text : escape(text, true)}\\n</code></pre>`;\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\t}\n\n\tfunction getLang(lang: string) {\n\t\treturn (lang || '').match(/\\S*/)![0];\n\t}\n\n\tfunction updateToken(token: any) {\n\t\treturn (code: string) => {\n\t\t\tif (typeof code === 'string' && code !== token.text) {\n\t\t\t\ttoken.escaped = true;\n\t\t\t\ttoken.text = code;\n\t\t\t}\n\t\t};\n\t}\n\n\t// copied from marked helpers\n\tconst escapeTest = /[&<>\"']/;\n\tconst escapeReplace = new RegExp(escapeTest.source, 'g');\n\tconst escapeTestNoEncode = /[<>\"']|&(?!(#\\d{1,7}|#[Xx][a-fA-F0-9]{1,6}|\\w+);)/;\n\tconst escapeReplaceNoEncode = new RegExp(escapeTestNoEncode.source, 'g');\n\tconst escapeReplacement: Record<string, string> = {\n\t\t'&': '&amp;',\n\t\t'<': '&lt;',\n\t\t'>': '&gt;',\n\t\t'\"': '&quot;',\n\t\t[`'`]: '&#39;',\n\t};\n\tconst getEscapeReplacement = (ch: string) => escapeReplacement[ch];\n\tfunction escape(html: string, encode?: boolean) {\n\t\tif (encode) {\n\t\t\tif (escapeTest.test(html)) {\n\t\t\t\treturn html.replace(escapeReplace, getEscapeReplacement);\n\t\t\t}\n\t\t} else {\n\t\t\tif (escapeTestNoEncode.test(html)) {\n\t\t\t\treturn html.replace(escapeReplaceNoEncode, getEscapeReplacement);\n\t\t\t}\n\t\t}\n\n\t\treturn html;\n\t}\n}\n"],
  "mappings": "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",
  "names": ["MarkedHighlight", "escape"]
}
