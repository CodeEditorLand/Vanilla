import{revive as C}from"../../../../base/common/marshalling.js";import"../../../../base/common/themables.js";import{OffsetRange as r}from"../../../../editor/common/core/offsetRange.js";import"../../../../editor/common/core/range.js";import{reviveSerializedAgent as x}from"./chatAgents.js";import"./chatSlashCommands.js";import"./chatVariables.js";import"./languageModelToolsService.js";function Q(a){const e=a.parts.map(n=>n.promptText).join("").trimStart(),t=a.text.length-e.length;return{message:e,diff:t}}class m{constructor(e,t,n){this.range=e;this.editorRange=t;this.text=n}static Kind="text";kind=m.Kind;get promptText(){return this.text}}const y="#",f="@",g="/";class u{constructor(e,t,n,i,s){this.range=e;this.editorRange=t;this.variableName=n;this.variableArg=i;this.variableId=s}static Kind="var";kind=u.Kind;get text(){const e=this.variableArg?`:${this.variableArg}`:"";return`${y}${this.variableName}${e}`}get promptText(){return this.text}}class c{constructor(e,t,n,i,s,l){this.range=e;this.editorRange=t;this.toolName=n;this.toolId=i;this.displayName=s;this.icon=l}static Kind="tool";kind=c.Kind;get text(){return`${y}${this.toolName}`}get promptText(){return this.text}}class o{constructor(e,t,n){this.range=e;this.editorRange=t;this.agent=n}static Kind="agent";kind=o.Kind;get text(){return`${f}${this.agent.name}`}get promptText(){return""}}class d{constructor(e,t,n){this.range=e;this.editorRange=t;this.command=n}static Kind="subcommand";kind=d.Kind;get text(){return`${g}${this.command.name}`}get promptText(){return""}}class h{constructor(e,t,n){this.range=e;this.editorRange=t;this.slashCommand=n}static Kind="slash";kind=h.Kind;get text(){return`${g}${this.slashCommand.command}`}get promptText(){return`${g}${this.slashCommand.command}`}}class R{constructor(e,t,n,i,s,l,P,I){this.range=e;this.editorRange=t;this.text=n;this.id=i;this.modelDescription=s;this.data=l;this.fullName=P;this.icon=I}static Kind="dynamic";kind=R.Kind;get referenceText(){return this.text.replace(y,"")}get promptText(){return this.text}}function U(a){return{text:a.text,parts:a.parts.map(e=>{if(e.kind===m.Kind)return new m(new r(e.range.start,e.range.endExclusive),e.editorRange,e.text);if(e.kind===u.Kind)return new u(new r(e.range.start,e.range.endExclusive),e.editorRange,e.variableName,e.variableArg,e.variableId||"");if(e.kind===c.Kind)return new c(new r(e.range.start,e.range.endExclusive),e.editorRange,e.toolName,e.toolId,e.displayName,e.icon);if(e.kind===o.Kind){let t=e.agent;return t=x(t),new o(new r(e.range.start,e.range.endExclusive),e.editorRange,t)}else{if(e.kind===d.Kind)return new d(new r(e.range.start,e.range.endExclusive),e.editorRange,e.command);if(e.kind===h.Kind)return new h(new r(e.range.start,e.range.endExclusive),e.editorRange,e.slashCommand);if(e.kind===R.Kind)return new R(new r(e.range.start,e.range.endExclusive),e.editorRange,e.text,e.id,e.modelDescription,C(e.data),e.fullName,e.icon);throw new Error(`Unknown chat request part: ${e.kind}`)}})}}function z(a){const e=a.parts.find(n=>n instanceof o),t=a.parts.find(n=>n instanceof d);return{agentPart:e,commandPart:t}}function B(a,e,t,n=null,i=null){let s="";if(n&&n!==a.getDefaultAgent(e)?.id){const l=a.getAgent(n);if(!l)return;s+=`${f}${l.name} `,i&&(s+=`${g}${i} `)}return s+t}export{o as ChatRequestAgentPart,d as ChatRequestAgentSubcommandPart,R as ChatRequestDynamicVariablePart,h as ChatRequestSlashCommandPart,m as ChatRequestTextPart,c as ChatRequestToolPart,u as ChatRequestVariablePart,f as chatAgentLeader,g as chatSubcommandLeader,y as chatVariableLeader,z as extractAgentAndCommand,B as formatChatQuestion,Q as getPromptText,U as reviveParsedChatRequest};
