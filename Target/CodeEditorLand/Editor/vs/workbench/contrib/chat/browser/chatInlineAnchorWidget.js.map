{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/chatInlineAnchorWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../base/browser/dom.js';\nimport { StandardMouseEvent } from '../../../../base/browser/mouseEvent.js';\nimport { getDefaultHoverDelegate } from '../../../../base/browser/ui/hover/hoverDelegateFactory.js';\nimport { IconLabel } from '../../../../base/browser/ui/iconLabel/iconLabel.js';\nimport { IAction } from '../../../../base/common/actions.js';\nimport { Disposable } from '../../../../base/common/lifecycle.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ICodeEditorService } from '../../../../editor/browser/services/codeEditorService.js';\nimport { IRange } from '../../../../editor/common/core/range.js';\nimport { EditorContextKeys } from '../../../../editor/common/editorContextKeys.js';\nimport { Location, SymbolKinds } from '../../../../editor/common/languages.js';\nimport { ILanguageService } from '../../../../editor/common/languages/language.js';\nimport { getIconClasses } from '../../../../editor/common/services/getIconClasses.js';\nimport { ILanguageFeaturesService } from '../../../../editor/common/services/languageFeatures.js';\nimport { IModelService } from '../../../../editor/common/services/model.js';\nimport { DefinitionAction } from '../../../../editor/contrib/gotoSymbol/browser/goToCommands.js';\nimport * as nls from '../../../../nls.js';\nimport { createAndFillInContextMenuActions } from '../../../../platform/actions/browser/menuEntryActionViewItem.js';\nimport { Action2, IMenuService, MenuId, registerAction2 } from '../../../../platform/actions/common/actions.js';\nimport { ICommandService } from '../../../../platform/commands/common/commands.js';\nimport { IContextKeyService } from '../../../../platform/contextkey/common/contextkey.js';\nimport { IContextMenuService } from '../../../../platform/contextview/browser/contextView.js';\nimport { IHoverService } from '../../../../platform/hover/browser/hover.js';\nimport { IInstantiationService, ServicesAccessor } from '../../../../platform/instantiation/common/instantiation.js';\nimport { ILabelService } from '../../../../platform/label/common/label.js';\nimport { fillEditorsDragData } from '../../../browser/dnd.js';\nimport { ContentRefData } from '../common/annotations.js';\n\nexport class InlineAnchorWidget extends Disposable {\n\n\tconstructor(\n\t\telement: HTMLAnchorElement,\n\t\tdata: ContentRefData,\n\t\t@IHoverService hoverService: IHoverService,\n\t\t@IInstantiationService instantiationService: IInstantiationService,\n\t\t@ILabelService labelService: ILabelService,\n\t\t@ILanguageService languageService: ILanguageService,\n\t\t@IModelService modelService: IModelService,\n\t\t@IContextMenuService contextMenuService: IContextMenuService,\n\t\t@IContextKeyService originalContextKeyService: IContextKeyService,\n\t\t@ILanguageFeaturesService languageFeaturesService: ILanguageFeaturesService,\n\t\t@IMenuService menuService: IMenuService,\n\t) {\n\t\tsuper();\n\n\t\tconst contextKeyService = this._register(originalContextKeyService.createScoped(element));\n\n\t\telement.classList.add('chat-inline-anchor-widget', 'show-file-icons');\n\t\telement.replaceChildren();\n\n\t\tconst resourceLabel = this._register(new IconLabel(element, { supportHighlights: false, supportIcons: true }));\n\n\t\tlet location: { readonly uri: URI; readonly range?: IRange };\n\t\tlet contextMenuId: MenuId;\n\t\tlet contextMenuArg: URI | { readonly uri: URI; readonly range?: IRange };\n\t\tif (data.kind === 'symbol') {\n\t\t\tlocation = data.symbol.location;\n\t\t\tcontextMenuId = MenuId.ChatInlineSymbolAnchorContext;\n\t\t\tcontextMenuArg = location;\n\n\t\t\tconst icon = SymbolKinds.toIcon(data.symbol.kind);\n\t\t\tresourceLabel.setLabel(`$(${icon.id}) ${data.symbol.name}`, undefined, {});\n\n\t\t\tconst model = modelService.getModel(location.uri);\n\t\t\tif (model) {\n\t\t\t\tconst hasDefinitionProvider = EditorContextKeys.hasDefinitionProvider.bindTo(contextKeyService);\n\t\t\t\tconst hasReferenceProvider = EditorContextKeys.hasReferenceProvider.bindTo(contextKeyService);\n\t\t\t\tconst updateContents = () => {\n\t\t\t\t\tif (model.isDisposed()) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\thasDefinitionProvider.set(languageFeaturesService.definitionProvider.has(model));\n\t\t\t\t\thasReferenceProvider.set(languageFeaturesService.definitionProvider.has(model));\n\t\t\t\t};\n\t\t\t\tupdateContents();\n\t\t\t\tthis._register(languageFeaturesService.definitionProvider.onDidChange(updateContents));\n\t\t\t\tthis._register(languageFeaturesService.referenceProvider.onDidChange(updateContents));\n\t\t\t}\n\t\t} else {\n\t\t\tlocation = data;\n\t\t\tcontextMenuId = MenuId.ChatInlineResourceAnchorContext;\n\t\t\tcontextMenuArg = location.uri;\n\n\t\t\tconst label = labelService.getUriBasenameLabel(location.uri);\n\t\t\tconst title = location.range && data.kind !== 'symbol' ?\n\t\t\t\t`${label}#${location.range.startLineNumber}-${location.range.endLineNumber}` :\n\t\t\t\tlabel;\n\n\t\t\tresourceLabel.setLabel(title, undefined, {\n\t\t\t\textraClasses: getIconClasses(modelService, languageService, location.uri)\n\t\t\t});\n\t\t}\n\n\t\tconst fragment = location.range ? `${location.range.startLineNumber}-${location.range.endLineNumber}` : '';\n\t\telement.setAttribute('data-href', location.uri.with({ fragment }).toString());\n\n\t\t// Context menu\n\t\tthis._register(dom.addDisposableListener(element, dom.EventType.CONTEXT_MENU, domEvent => {\n\t\t\tconst event = new StandardMouseEvent(dom.getWindow(domEvent), domEvent);\n\t\t\tdom.EventHelper.stop(domEvent, true);\n\n\t\t\tcontextMenuService.showContextMenu({\n\t\t\t\tcontextKeyService,\n\t\t\t\tgetAnchor: () => event,\n\t\t\t\tgetActions: () => {\n\t\t\t\t\tconst menu = menuService.getMenuActions(contextMenuId, contextKeyService, { arg: contextMenuArg });\n\t\t\t\t\tconst primary: IAction[] = [];\n\t\t\t\t\tcreateAndFillInContextMenuActions(menu, primary);\n\t\t\t\t\treturn primary;\n\t\t\t\t},\n\t\t\t});\n\t\t}));\n\n\t\t// Hover\n\t\tconst relativeLabel = labelService.getUriLabel(location.uri, { relative: true });\n\t\tthis._register(hoverService.setupManagedHover(getDefaultHoverDelegate('element'), element, relativeLabel));\n\n\t\t// Drag and drop\n\t\telement.draggable = true;\n\t\tthis._register(dom.addDisposableListener(element, 'dragstart', e => {\n\t\t\tinstantiationService.invokeFunction(accessor => fillEditorsDragData(accessor, [location.uri], e));\n\n\t\t\te.dataTransfer?.setDragImage(element, 0, 0);\n\t\t}));\n\t}\n}\n\nregisterAction2(class GoToDefinitionAction extends Action2 {\n\n\tstatic readonly id = 'chat.inlineSymbolAnchor.goToDefinition';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: GoToDefinitionAction.id,\n\t\t\ttitle: {\n\t\t\t\t...nls.localize2('actions.goToDecl.label', \"Go to Definition\"),\n\t\t\t\tmnemonicTitle: nls.localize({ key: 'miGotoDefinition', comment: ['&& denotes a mnemonic'] }, \"Go to &&Definition\"),\n\t\t\t},\n\t\t\tprecondition: EditorContextKeys.hasDefinitionProvider,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatInlineSymbolAnchorContext,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1.1,\n\t\t\t},]\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, location: Location): Promise<void> {\n\t\tconst editorService = accessor.get(ICodeEditorService);\n\n\t\tawait editorService.openCodeEditor({\n\t\t\tresource: location.uri, options: {\n\t\t\t\tselection: {\n\t\t\t\t\tstartColumn: location.range.startColumn,\n\t\t\t\t\tstartLineNumber: location.range.startLineNumber,\n\t\t\t\t}\n\t\t\t}\n\t\t}, null);\n\n\t\tconst action = new DefinitionAction({ openToSide: false, openInPeek: false, muteMessage: true }, { title: { value: '', original: '' }, id: '', precondition: undefined });\n\t\treturn action.run(accessor);\n\t}\n});\n\nregisterAction2(class GoToReferencesAction extends Action2 {\n\n\tstatic readonly id = 'chat.inlineSymbolAnchor.goToReferences';\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: GoToReferencesAction.id,\n\t\t\ttitle: {\n\t\t\t\t...nls.localize2('goToReferences.label', \"Go to References\"),\n\t\t\t\tmnemonicTitle: nls.localize({ key: 'miGotoReference', comment: ['&& denotes a mnemonic'] }, \"Go to &&References\"),\n\t\t\t},\n\t\t\tprecondition: EditorContextKeys.hasReferenceProvider,\n\t\t\tmenu: [{\n\t\t\t\tid: MenuId.ChatInlineSymbolAnchorContext,\n\t\t\t\tgroup: 'navigation',\n\t\t\t\torder: 1.1,\n\t\t\t},]\n\t\t});\n\t}\n\n\toverride async run(accessor: ServicesAccessor, location: Location): Promise<void> {\n\t\tconst editorService = accessor.get(ICodeEditorService);\n\t\tconst commandService = accessor.get(ICommandService);\n\n\t\tawait editorService.openCodeEditor({\n\t\t\tresource: location.uri, options: {\n\t\t\t\tselection: {\n\t\t\t\t\tstartColumn: location.range.startColumn,\n\t\t\t\t\tstartLineNumber: location.range.startLineNumber,\n\t\t\t\t}\n\t\t\t}\n\t\t}, null);\n\n\t\tawait commandService.executeCommand('editor.action.goToReferences');\n\t}\n});\n"],
  "mappings": "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",
  "names": []
}
