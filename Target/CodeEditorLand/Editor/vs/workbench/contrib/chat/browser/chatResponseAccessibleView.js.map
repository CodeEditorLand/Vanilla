{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/chatResponseAccessibleView.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { renderMarkdownAsPlaintext } from \"../../../../base/browser/markdownRenderer.js\";\nimport {\n\ttype IMarkdownString,\n\tMarkdownString,\n} from \"../../../../base/common/htmlContent.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport {\n\tAccessibleViewProviderId,\n\tAccessibleViewType,\n\ttype IAccessibleViewContentProvider,\n} from \"../../../../platform/accessibility/browser/accessibleView.js\";\nimport type { IAccessibleViewImplentation } from \"../../../../platform/accessibility/browser/accessibleViewRegistry.js\";\nimport type { ServicesAccessor } from \"../../../../platform/instantiation/common/instantiation.js\";\nimport { AccessibilityVerbositySettingId } from \"../../accessibility/browser/accessibilityConfiguration.js\";\nimport { CONTEXT_IN_CHAT_SESSION } from \"../common/chatContextKeys.js\";\nimport { ChatWelcomeMessageModel } from \"../common/chatModel.js\";\nimport { isResponseVM } from \"../common/chatViewModel.js\";\nimport {\n\ttype ChatTreeItem,\n\ttype IChatWidget,\n\tIChatWidgetService,\n} from \"./chat.js\";\n\nexport class ChatResponseAccessibleView implements IAccessibleViewImplentation {\n\treadonly priority = 100;\n\treadonly name = \"panelChat\";\n\treadonly type = AccessibleViewType.View;\n\treadonly when = CONTEXT_IN_CHAT_SESSION;\n\tgetProvider(accessor: ServicesAccessor) {\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst widget = widgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\t\tconst chatInputFocused = widget.hasInputFocus();\n\t\tif (chatInputFocused) {\n\t\t\twidget.focusLastMessage();\n\t\t}\n\n\t\tconst verifiedWidget: IChatWidget = widget;\n\t\tconst focusedItem = verifiedWidget.getFocus();\n\n\t\tif (!focusedItem) {\n\t\t\treturn;\n\t\t}\n\n\t\treturn new ChatResponseAccessibleProvider(\n\t\t\tverifiedWidget,\n\t\t\tfocusedItem,\n\t\t\tchatInputFocused,\n\t\t);\n\t}\n}\n\nclass ChatResponseAccessibleProvider\n\textends Disposable\n\timplements IAccessibleViewContentProvider\n{\n\tprivate _focusedItem: ChatTreeItem;\n\tconstructor(\n\t\tprivate readonly _widget: IChatWidget,\n\t\titem: ChatTreeItem,\n\t\tprivate readonly _chatInputFocused: boolean,\n\t) {\n\t\tsuper();\n\t\tthis._focusedItem = item;\n\t}\n\n\treadonly id = AccessibleViewProviderId.Chat;\n\treadonly verbositySettingKey = AccessibilityVerbositySettingId.Chat;\n\treadonly options = { type: AccessibleViewType.View };\n\n\tprovideContent(): string {\n\t\treturn this._getContent(this._focusedItem);\n\t}\n\n\tprivate _getContent(item: ChatTreeItem): string {\n\t\tconst isWelcome = item instanceof ChatWelcomeMessageModel;\n\t\tlet responseContent = isResponseVM(item)\n\t\t\t? item.response.toString()\n\t\t\t: \"\";\n\t\tif (isWelcome) {\n\t\t\tconst welcomeReplyContents = [];\n\t\t\tfor (const content of item.content) {\n\t\t\t\tif (Array.isArray(content)) {\n\t\t\t\t\twelcomeReplyContents.push(...content.map((m) => m.message));\n\t\t\t\t} else {\n\t\t\t\t\twelcomeReplyContents.push(\n\t\t\t\t\t\t(content as IMarkdownString).value,\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t}\n\t\t\tresponseContent = welcomeReplyContents.join(\"\\n\");\n\t\t}\n\t\tif (!responseContent && \"errorDetails\" in item && item.errorDetails) {\n\t\t\tresponseContent = item.errorDetails.message;\n\t\t}\n\t\treturn renderMarkdownAsPlaintext(\n\t\t\tnew MarkdownString(responseContent),\n\t\t\ttrue,\n\t\t);\n\t}\n\n\tonClose(): void {\n\t\tthis._widget.reveal(this._focusedItem);\n\t\tif (this._chatInputFocused) {\n\t\t\tthis._widget.focusInput();\n\t\t} else {\n\t\t\tthis._widget.focus(this._focusedItem);\n\t\t}\n\t}\n\n\tprovideNextContent(): string | undefined {\n\t\tconst next = this._widget.getSibling(this._focusedItem, \"next\");\n\t\tif (next) {\n\t\t\tthis._focusedItem = next;\n\t\t\treturn this._getContent(next);\n\t\t}\n\t\treturn;\n\t}\n\n\tprovidePreviousContent(): string | undefined {\n\t\tconst previous = this._widget.getSibling(this._focusedItem, \"previous\");\n\t\tif (previous) {\n\t\t\tthis._focusedItem = previous;\n\t\t\treturn this._getContent(previous);\n\t\t}\n\t\treturn;\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,iCAAiC;AAC1C;AAAA,EAEC;AAAA,OACM;AACP,SAAS,kBAAkB;AAC3B;AAAA,EACC;AAAA,EACA;AAAA,OAEM;AAGP,SAAS,uCAAuC;AAChD,SAAS,+BAA+B;AACxC,SAAS,+BAA+B;AACxC,SAAS,oBAAoB;AAC7B;AAAA,EAGC;AAAA,OACM;AAEA,MAAM,2BAAkE;AAAA,EA5B/E,OA4B+E;AAAA;AAAA;AAAA,EACrE,WAAW;AAAA,EACX,OAAO;AAAA,EACP,OAAO,mBAAmB;AAAA,EAC1B,OAAO;AAAA,EAChB,YAAY,UAA4B;AACvC,UAAM,gBAAgB,SAAS,IAAI,kBAAkB;AACrD,UAAM,SAAS,cAAc;AAC7B,QAAI,CAAC,QAAQ;AACZ;AAAA,IACD;AACA,UAAM,mBAAmB,OAAO,cAAc;AAC9C,QAAI,kBAAkB;AACrB,aAAO,iBAAiB;AAAA,IACzB;AAEA,UAAM,iBAA8B;AACpC,UAAM,cAAc,eAAe,SAAS;AAE5C,QAAI,CAAC,aAAa;AACjB;AAAA,IACD;AAEA,WAAO,IAAI;AAAA,MACV;AAAA,MACA;AAAA,MACA;AAAA,IACD;AAAA,EACD;AACD;AAEA,MAAM,uCACG,WAET;AAAA,EAEC,YACkB,SACjB,MACiB,mBAChB;AACD,UAAM;AAJW;AAEA;AAGjB,SAAK,eAAe;AAAA,EACrB;AAAA,EAvED,OA8DA;AAAA;AAAA;AAAA,EACS;AAAA,EAUC,KAAK,yBAAyB;AAAA,EAC9B,sBAAsB,gCAAgC;AAAA,EACtD,UAAU,EAAE,MAAM,mBAAmB,KAAK;AAAA,EAEnD,iBAAyB;AACxB,WAAO,KAAK,YAAY,KAAK,YAAY;AAAA,EAC1C;AAAA,EAEQ,YAAY,MAA4B;AAC/C,UAAM,YAAY,gBAAgB;AAClC,QAAI,kBAAkB,aAAa,IAAI,IACpC,KAAK,SAAS,SAAS,IACvB;AACH,QAAI,WAAW;AACd,YAAM,uBAAuB,CAAC;AAC9B,iBAAW,WAAW,KAAK,SAAS;AACnC,YAAI,MAAM,QAAQ,OAAO,GAAG;AAC3B,+BAAqB,KAAK,GAAG,QAAQ,IAAI,CAAC,MAAM,EAAE,OAAO,CAAC;AAAA,QAC3D,OAAO;AACN,+BAAqB;AAAA,YACnB,QAA4B;AAAA,UAC9B;AAAA,QACD;AAAA,MACD;AACA,wBAAkB,qBAAqB,KAAK,IAAI;AAAA,IACjD;AACA,QAAI,CAAC,mBAAmB,kBAAkB,QAAQ,KAAK,cAAc;AACpE,wBAAkB,KAAK,aAAa;AAAA,IACrC;AACA,WAAO;AAAA,MACN,IAAI,eAAe,eAAe;AAAA,MAClC;AAAA,IACD;AAAA,EACD;AAAA,EAEA,UAAgB;AACf,SAAK,QAAQ,OAAO,KAAK,YAAY;AACrC,QAAI,KAAK,mBAAmB;AAC3B,WAAK,QAAQ,WAAW;AAAA,IACzB,OAAO;AACN,WAAK,QAAQ,MAAM,KAAK,YAAY;AAAA,IACrC;AAAA,EACD;AAAA,EAEA,qBAAyC;AACxC,UAAM,OAAO,KAAK,QAAQ,WAAW,KAAK,cAAc,MAAM;AAC9D,QAAI,MAAM;AACT,WAAK,eAAe;AACpB,aAAO,KAAK,YAAY,IAAI;AAAA,IAC7B;AACA;AAAA,EACD;AAAA,EAEA,yBAA6C;AAC5C,UAAM,WAAW,KAAK,QAAQ,WAAW,KAAK,cAAc,UAAU;AACtE,QAAI,UAAU;AACb,WAAK,eAAe;AACpB,aAAO,KAAK,YAAY,QAAQ;AAAA,IACjC;AACA;AAAA,EACD;AACD;",
  "names": []
}
