var A=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var C=(p,e,n,t)=>{for(var s=t>1?void 0:t?M(e,n):e,i=p.length-1,o;i>=0;i--)(o=p[i])&&(s=(t?o(e,n,s):o(s))||s);return t&&s&&A(e,n,s),s},u=(p,e)=>(n,t)=>e(n,t,p);import*as P from"../../../../../../vs/base/browser/dom.js";import{Button as H}from"../../../../../../vs/base/browser/ui/button/button.js";import"../../../../../../vs/base/browser/ui/list/list.js";import{Codicon as f}from"../../../../../../vs/base/common/codicons.js";import{Emitter as U}from"../../../../../../vs/base/common/event.js";import{Disposable as w,DisposableStore as V}from"../../../../../../vs/base/common/lifecycle.js";import{matchesSomeScheme as O,Schemas as T}from"../../../../../../vs/base/common/network.js";import{basename as D}from"../../../../../../vs/base/common/path.js";import{basenameOrAuthority as W,isEqualAuthority as _}from"../../../../../../vs/base/common/resources.js";import{ThemeIcon as L}from"../../../../../../vs/base/common/themables.js";import{URI as I}from"../../../../../../vs/base/common/uri.js";import{localize as b}from"../../../../../../vs/nls.js";import{FileKind as $}from"../../../../../../vs/platform/files/common/files.js";import{IInstantiationService as F}from"../../../../../../vs/platform/instantiation/common/instantiation.js";import{WorkbenchList as B}from"../../../../../../vs/platform/list/browser/listService.js";import{IOpenerService as j}from"../../../../../../vs/platform/opener/common/opener.js";import{IProductService as K}from"../../../../../../vs/platform/product/common/productService.js";import{IThemeService as k}from"../../../../../../vs/platform/theme/common/themeService.js";import{ResourceLabels as G}from"../../../../../../vs/workbench/browser/labels.js";import{ColorScheme as q}from"../../../../../../vs/workbench/browser/web.api.js";import"../../../../../../vs/workbench/contrib/chat/browser/chat.js";import{ResourcePool as z}from"../../../../../../vs/workbench/contrib/chat/browser/chatContentParts/chatCollections.js";import"../../../../../../vs/workbench/contrib/chat/browser/chatContentParts/chatContentParts.js";import{ChatResponseReferencePartStatusKind as N}from"../../../../../../vs/workbench/contrib/chat/common/chatService.js";import{IChatVariablesService as Y}from"../../../../../../vs/workbench/contrib/chat/common/chatVariables.js";import"../../../../../../vs/workbench/contrib/chat/common/chatViewModel.js";import{createFileIconThemableTreeContainerScope as J}from"../../../../../../vs/workbench/contrib/files/browser/views/explorerView.js";import{SETTINGS_AUTHORITY as Q}from"../../../../../../vs/workbench/services/preferences/common/preferences.js";const S=P.$;let R=class extends w{constructor(n,t,s,i,o){super();this.data=n;const r=t??(n.length>1?b("usedReferencesPlural","Used {0} references",n.length):b("usedReferencesSingular","Used {0} reference",1)),a=S(".chat-used-context-icon"),c=l=>l.usedReferencesExpanded?f.chevronDown:f.chevronRight;a.classList.add(...L.asClassNameArray(c(s)));const v=S(".chat-used-context-label",void 0),g=this._register(new H(v,{buttonBackground:void 0,buttonBorder:void 0,buttonForeground:void 0,buttonHoverBackground:void 0,buttonSecondaryBackground:void 0,buttonSecondaryForeground:void 0,buttonSecondaryHoverBackground:void 0,buttonSeparator:void 0}));this.domNode=S(".chat-used-context",void 0,v),g.label=r,g.element.prepend(a),this.updateAriaLabel(g.element,r,s.usedReferencesExpanded),this.domNode.classList.toggle("chat-used-context-collapsed",!s.usedReferencesExpanded),this._register(g.onDidClick(()=>{a.classList.remove(...L.asClassNameArray(c(s))),s.usedReferencesExpanded=!s.usedReferencesExpanded,a.classList.add(...L.asClassNameArray(c(s))),this.domNode.classList.toggle("chat-used-context-collapsed",!s.usedReferencesExpanded),this._onDidChangeHeight.fire(),this.updateAriaLabel(g.element,r,s.usedReferencesExpanded)}));const m=this._register(i.get()).object;this.domNode.appendChild(m.getHTMLElement().parentElement),this._register(m.onDidOpen(l=>{if(l.element&&"reference"in l.element&&typeof l.element.reference=="object"){const h="variableName"in l.element.reference?l.element.reference.value:l.element.reference,x=I.isUri(h)?h:h?.uri;x&&o.open(x,{fromUserGesture:!0,editorOptions:{...l.editorOptions,selection:h&&"range"in h?h.range:void 0}})}})),this._register(m.onContextMenu(l=>{l.browserEvent.preventDefault(),l.browserEvent.stopPropagation()}));const E=Math.min(n.length,6)*22;m.layout(E),m.getHTMLElement().style.height=`${E}px`,m.splice(0,m.length,n)}domNode;_onDidChangeHeight=this._register(new U);onDidChangeHeight=this._onDidChangeHeight.event;hasSameContent(n,t,s){return n.kind==="references"&&n.references.length===this.data.length||n.kind==="codeCitations"&&n.citations.length===this.data.length}updateAriaLabel(n,t,s){n.ariaLabel=s?b("usedReferencesExpanded","{0}, expanded",t):b("usedReferencesCollapsed","{0}, collapsed",t)}addDisposable(n){this._register(n)}};R=C([u(4,j)],R);let y=class extends w{constructor(n,t,s){super();this._onDidChangeVisibility=n;this.instantiationService=t;this.themeService=s;this._pool=this._register(new z(()=>this.listFactory()))}_pool;get inUse(){return this._pool.inUse}listFactory(){const n=this._register(this.instantiationService.createInstance(G,{onDidChangeVisibility:this._onDidChangeVisibility})),t=S(".chat-used-context-list");return this._register(J(t,this.themeService)),this.instantiationService.createInstance(B,"ChatListRenderer",t,new X,[this.instantiationService.createInstance(d,n)],{alwaysConsumeMouseWheel:!1,accessibilityProvider:{getAriaLabel:i=>{if(i.kind==="warning")return i.content.value;const o=i.reference;return typeof o=="string"?o:"variableName"in o?o.variableName:I.isUri(o)?D(o.path):D(o.uri.path)},getWidgetAriaLabel:()=>b("chatCollapsibleList","Collapsible Chat List")},dnd:{getDragURI:i=>{if(i.kind==="warning")return null;const{reference:o}=i;return typeof o=="string"||"variableName"in o?null:I.isUri(o)?o.toString():o.uri.toString()},dispose:()=>{},onDragOver:()=>!1,drop:()=>{}}})}get(){const n=this._pool.get();let t=!1;return{object:n,isStale:()=>t,dispose:()=>{t=!0,this._pool.release(n)}}}};y=C([u(1,F),u(2,k)],y);class X{getHeight(e){return 22}getTemplateId(e){return d.TEMPLATE_ID}}let d=class{constructor(e,n,t,s){this.labels=e;this.themeService=n;this.chatVariablesService=t;this.productService=s}static TEMPLATE_ID="chatCollapsibleListRenderer";templateId=d.TEMPLATE_ID;renderTemplate(e){const n=new V,t=n.add(this.labels.create(e,{supportHighlights:!0,supportIcons:!0}));return{templateDisposables:n,label:t}}getReferenceIcon(e){return L.isThemeIcon(e.iconPath)?e.iconPath:this.themeService.getColorTheme().type===q.DARK&&e.iconPath?.dark?e.iconPath?.dark:e.iconPath?.light}renderElement(e,n,t,s){if(e.kind==="warning"){t.label.setResource({name:e.content.value},{icon:f.warning});return}const i=e.reference,o=this.getReferenceIcon(e);if(t.label.element.style.display="flex",typeof i=="object"&&"variableName"in i)if(i.value){const r=I.isUri(i.value)?i.value:i.value.uri;t.label.setResource({resource:r,name:W(r),description:`#${i.variableName}`,range:"range"in i.value?i.value.range:void 0},{icon:o,title:e.options?.status?.description??e.title})}else{const r=this.chatVariablesService.getVariable(i.variableName),a=r?.icon?`$(${r.icon.id}) `:"",c=`#${i.variableName}`,v=`${a}${r?.fullName??c}`;t.label.setLabel(v,c,{title:e.options?.status?.description??r?.description})}else if(typeof i=="string")t.label.setLabel(i,void 0,{iconPath:I.isUri(o)?o:void 0,title:e.options?.status?.description??e.title});else{const r="uri"in i?i.uri:i;if(r.scheme==="https"&&_(r.authority,"github.com")&&r.path.includes("/tree/")){const a=r.path.split("/").slice(1,3).join("/"),c=r.path.split("/").slice(5).join("/");t.label.setResource({resource:r,name:a,description:c},{icon:f.github,title:e.title})}else if(r.scheme===this.productService.urlProtocol&&_(r.authority,Q)){const a=r.path.substring(1);t.label.setResource({resource:r,name:a},{icon:f.settingsGear,title:b("setting.hover","Open setting '{0}'",a)})}else O(r,T.mailto,T.http,T.https)?t.label.setResource({resource:r,name:r.toString()},{icon:o??f.globe,title:e.options?.status?.description??e.title??r.toString()}):t.label.setFile(r,{fileKind:$.FILE,fileDecorations:{badges:!1,colors:!1},range:"range"in i?i.range:void 0,title:e.options?.status?.description??e.title})}for(const r of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const a=t.label.element.querySelector(r);a&&(e.options?.status?.kind===N.Omitted||e.options?.status?.kind===N.Partial?a.classList.add("warning"):a.classList.remove("warning"))}}disposeTemplate(e){e.templateDisposables.dispose()}};d=C([u(1,k),u(2,Y),u(3,K)],d);export{R as ChatCollapsibleListContentPart,y as CollapsibleListPool};
