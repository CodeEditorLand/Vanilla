var W=Object.defineProperty;var k=Object.getOwnPropertyDescriptor;var H=(d,a,e,i)=>{for(var t=i>1?void 0:i?k(a,e):a,n=d.length-1,s;n>=0;n--)(s=d[n])&&(t=(i?s(a,e,t):s(t))||t);return i&&t&&W(a,e,t),t},c=(d,a)=>(e,i)=>a(e,i,d);import*as u from"../../../../base/browser/dom.js";import{disposableTimeout as B,timeout as V}from"../../../../base/common/async.js";import{toErrorMessage as q}from"../../../../base/common/errorMessage.js";import{Emitter as h,Event as N}from"../../../../base/common/event.js";import{Disposable as $,DisposableStore as U,MutableDisposable as j,combinedDisposable as K,toDisposable as Q}from"../../../../base/common/lifecycle.js";import{Schemas as X}from"../../../../base/common/network.js";import{extUri as G,isEqual as z}from"../../../../base/common/resources.js";import{isDefined as J}from"../../../../base/common/types.js";import"./media/chat.css";import"./media/chatAgentHover.css";import{ICodeEditorService as Y}from"../../../../editor/browser/services/codeEditorService.js";import{MenuId as R}from"../../../../platform/actions/common/actions.js";import{IContextKeyService as L}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as Z}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as ee}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as te}from"../../../../platform/instantiation/common/serviceCollection.js";import{WorkbenchObjectTree as ie}from"../../../../platform/list/browser/listService.js";import{ILogService as ne}from"../../../../platform/log/common/log.js";import{IThemeService as se}from"../../../../platform/theme/common/themeService.js";import{IChatAgentService as oe}from"../common/chatAgents.js";import{CONTEXT_CHAT_INPUT_HAS_AGENT as re,CONTEXT_CHAT_LOCATION as ae,CONTEXT_CHAT_REQUEST_IN_PROGRESS as de,CONTEXT_IN_CHAT_SESSION as he,CONTEXT_IN_QUICK_CHAT as le,CONTEXT_RESPONSE_FILTERED as ce}from"../common/chatContextKeys.js";import{ChatModelInitState as ue}from"../common/chatModel.js";import{ChatRequestAgentPart as pe,chatAgentLeader as ge,chatSubcommandLeader as O,formatChatQuestion as Ce}from"../common/chatParserTypes.js";import{ChatRequestParser as me}from"../common/chatRequestParser.js";import{IChatService as Ie}from"../common/chatService.js";import{IChatSlashCommandService as ve}from"../common/chatSlashCommands.js";import{ChatViewModel as fe,isRequestVM as D,isResponseVM as C,isWelcomeVM as F}from"../common/chatViewModel.js";import{CodeBlockModelCollection as ye}from"../common/codeBlockModelCollection.js";import{IChatAccessibilityService as be,IChatWidgetService as De}from"./chat.js";import{ChatAccessibilityProvider as _e}from"./chatAccessibilityProvider.js";import{ChatInputPart as Se}from"./chatInputPart.js";import{ChatListDelegate as we,ChatListItemRenderer as Me}from"./chatListRenderer.js";import{ChatEditorOptions as Te}from"./chatOptions.js";const A=u.$;function m(d){d.scrollTop=d.scrollHeight-d.renderHeight}function Fe(d){return"viewContext"in d&&"isQuickChat"in d.viewContext&&!!d.viewContext.isQuickChat}let I=class extends ${constructor(e,i,t,n,s,r,o,l,p,v,E,P,_,Ae,Ee){super();this.viewOptions=t;this.styles=n;this.contextKeyService=r;this.instantiationService=o;this.chatService=l;this.chatAgentService=p;this.contextMenuService=E;this.chatAccessibilityService=P;this.logService=_;this.themeService=Ae;this.chatSlashCommandService=Ee;this.viewContext=i??{},typeof e=="object"?this._location=e:this._location={location:e},he.bindTo(r).set(!0),ae.bindTo(r).set(this._location.location),le.bindTo(r).set(Fe(this)),this.agentInInput=re.bindTo(r),this.requestInProgress=de.bindTo(r),this._register(v.register(this)),this._codeBlockModelCollection=this._register(o.createInstance(ye)),this._register(s.registerCodeEditorOpenHandler(async(g,Pe,xe)=>{const S=g.resource;if(S.scheme!==X.vscodeChatCodeBlock)return null;const x=S.path.split("/").at(1);if(!x)return null;const w=this.viewModel?.getItems().find(y=>y.id===x);if(!w)return null;this.reveal(w),await V(0);for(const y of this.renderer.editorsInUse())if(G.isEqual(y.uri,S,!0)){const f=y.editor;let M=0;const T=f.getDomNode();if(T){const b=u.findParentWithClass(T,"monaco-list-row");b&&(M=u.getTopLeftOffset(T).top-u.getTopLeftOffset(b).top)}if(g.options?.selection){const b=f.getTopForPosition(g.options.selection.startLineNumber,g.options.selection.startColumn);M+=b,f.focus(),f.setSelection({startLineNumber:g.options.selection.startLineNumber,startColumn:g.options.selection.startColumn,endLineNumber:g.options.selection.endLineNumber??g.options.selection.startLineNumber,endColumn:g.options.selection.endColumn??g.options.selection.startColumn})}return this.reveal(w,M),f}return null}))}static CONTRIBS=[];_onDidSubmitAgent=this._register(new h);onDidSubmitAgent=this._onDidSubmitAgent.event;_onDidChangeAgent=this._register(new h);onDidChangeAgent=this._onDidChangeAgent.event;_onDidFocus=this._register(new h);onDidFocus=this._onDidFocus.event;_onDidChangeViewModel=this._register(new h);onDidChangeViewModel=this._onDidChangeViewModel.event;_onDidScroll=this._register(new h);onDidScroll=this._onDidScroll.event;_onDidClear=this._register(new h);onDidClear=this._onDidClear.event;_onDidAcceptInput=this._register(new h);onDidAcceptInput=this._onDidAcceptInput.event;_onDidChangeContext=this._register(new h);onDidChangeContext=this._onDidChangeContext.event;_onDidHide=this._register(new h);onDidHide=this._onDidHide.event;_onDidChangeParsedInput=this._register(new h);onDidChangeParsedInput=this._onDidChangeParsedInput.event;_onWillMaybeChangeHeight=new h;onWillMaybeChangeHeight=this._onWillMaybeChangeHeight.event;_onDidChangeHeight=this._register(new h);onDidChangeHeight=this._onDidChangeHeight.event;_onDidChangeContentHeight=new h;onDidChangeContentHeight=this._onDidChangeContentHeight.event;contribs=[];tree;renderer;_codeBlockModelCollection;inputPart;editorOptions;listContainer;container;bodyDimension;visibleChangeCount=0;requestInProgress;agentInInput;_visible=!1;get visible(){return this._visible}previousTreeScrollHeight=0;viewModelDisposables=this._register(new U);_viewModel;set viewModel(e){this._viewModel!==e&&(this.viewModelDisposables.clear(),this._viewModel=e,e&&this.viewModelDisposables.add(e),this._onDidChangeViewModel.fire())}get viewModel(){return this._viewModel}parsedChatRequest;get parsedInput(){return this.parsedChatRequest===void 0&&(this.parsedChatRequest=this.instantiationService.createInstance(me).parseChatRequest(this.viewModel.sessionId,this.getInput(),this.location,{selectedAgent:this._lastSelectedAgent}),this.agentInInput.set(!!this.parsedChatRequest.parts.find(e=>e instanceof pe))),this.parsedChatRequest}get scopedContextKeyService(){return this.contextKeyService}_location;get location(){return this._location.location}viewContext;_lastSelectedAgent;set lastSelectedAgent(e){this.parsedChatRequest=void 0,this._lastSelectedAgent=e,this._onDidChangeParsedInput.fire()}get lastSelectedAgent(){return this._lastSelectedAgent}get supportsFileReferences(){return!!this.viewOptions.supportsFileReferences}get input(){return this.inputPart}get inputEditor(){return this.inputPart.inputEditor}get inputUri(){return this.inputPart.inputUri}get contentHeight(){return this.inputPart.contentHeight+this.tree.contentHeight}render(e){const i="viewId"in this.viewContext?this.viewContext.viewId:void 0;this.editorOptions=this._register(this.instantiationService.createInstance(Te,i,this.styles.listForeground,this.styles.inputEditorBackground,this.styles.resultEditorBackground));const t=this.viewOptions.renderInputOnTop??!1,n=this.viewOptions.renderFollowups??!t,s=this.viewOptions.renderStyle;this.container=u.append(e,A(".interactive-session")),t?(this.createInput(this.container,{renderFollowups:n,renderStyle:s}),this.listContainer=u.append(this.container,A(".interactive-list"))):(this.listContainer=u.append(this.container,A(".interactive-list")),this.createInput(this.container,{renderFollowups:n,renderStyle:s})),this.createList(this.listContainer,{...this.viewOptions.rendererOptions,renderStyle:s}),this._register(this.editorOptions.onDidChange(()=>this.onDidStyleChange())),this.onDidStyleChange(),this.viewModel&&(this.onDidChangeItems(),m(this.tree)),this.contribs=I.CONTRIBS.map(r=>{try{return this._register(this.instantiationService.createInstance(r,this))}catch(o){this.logService.error("Failed to instantiate chat widget contrib",q(o));return}}).filter(J)}getContrib(e){return this.contribs.find(i=>i.id===e)}focusInput(){this.inputPart.focus()}hasInputFocus(){return this.inputPart.hasFocus()}getSibling(e,i){if(!C(e))return;const t=this.viewModel?.getItems();if(!t)return;const n=t.filter(o=>C(o)),s=n.indexOf(e);if(s===void 0)return;const r=i==="next"?s+1:s-1;if(!(r<0||r>n.length-1))return n[r]}clear(){this._dynamicMessageLayoutData&&(this._dynamicMessageLayoutData.enabled=!0),this._onDidClear.fire()}onDidChangeItems(e){if(this.tree&&this._visible){const i=(this.viewModel?.getItems()??[]).map(n=>({element:n,collapsed:!1,collapsible:!1}));this._onWillMaybeChangeHeight.fire(),this.tree.setChildren(null,i,{diffIdentityProvider:{getId:n=>(C(n)||D(n)?n.dataId:n.id)+(F(n)&&this.viewModel?`_${ue[this.viewModel.initState]}`:"")+`${D(n)||F(n)}${C(n)&&n.renderData?`_${this.visibleChangeCount}`:""}`+(C(n)?`_${n.contentReferences.length}`:"")+(D(n)&&n.contentReferences?`_${n.contentReferences?.length}`:"")}}),!e&&this._dynamicMessageLayoutData&&this.layoutDynamicChatTreeItemMode();const t=i[i.length-1]?.element;t&&C(t)&&t.isComplete?this.renderFollowups(t.replyFollowups,t):t&&F(t)?this.renderFollowups(t.sampleQuestions):this.renderFollowups(void 0)}}async renderFollowups(e,i){this.inputPart.renderFollowups(e,i),this.bodyDimension&&this.layout(this.bodyDimension.height,this.bodyDimension.width)}setVisible(e){const i=this._visible;this._visible=e,this.visibleChangeCount++,this.renderer.setVisible(e),this.input.setVisible(e),e?this._register(B(()=>{this._visible&&this.onDidChangeItems(!0)},0)):i&&this._onDidHide.fire()}createList(e,i){const t=this._register(this._register(this.instantiationService.createChild(new te([L,this.contextKeyService])))),n=t.createInstance(we,this.viewOptions.defaultElementHeight??200),s={getListLength:()=>this.tree.getNode(null).visibleChildrenCount,onDidScroll:this.onDidScroll},r=document.createElement("div");r.classList.add("chat-overflow-widget-container","monaco-editor"),e.append(r),this.renderer=this._register(t.createInstance(Me,this.editorOptions,this.location,i,s,this._codeBlockModelCollection,r)),this._register(this.renderer.onDidClickFollowup(o=>{this.acceptInput(o.message)})),this._register(this.renderer.onDidClickRerunWithAgentOrCommandDetection(o=>{const l=this.chatService.getSession(o.sessionId)?.getRequests().find(p=>p.id===o.requestId);l&&this.chatService.resendRequest(l,{noCommandDetection:!0,attempt:l.attempt+1,location:this.location}).catch(p=>this.logService.error("FAILED to rerun request",p))})),this.tree=this._register(t.createInstance(ie,"Chat",e,n,[this.renderer],{identityProvider:{getId:o=>o.id},horizontalScrolling:!1,alwaysConsumeMouseWheel:!1,supportDynamicHeights:!0,hideTwistiesOfChildlessElements:!0,accessibilityProvider:this.instantiationService.createInstance(_e),keyboardNavigationLabelProvider:{getKeyboardNavigationLabel:o=>D(o)?o.message:C(o)?o.response.value:""},setRowLineHeight:!1,filter:this.viewOptions.filter?{filter:this.viewOptions.filter.bind(this.viewOptions)}:void 0,overrideStyles:{listFocusBackground:this.styles.listBackground,listInactiveFocusBackground:this.styles.listBackground,listActiveSelectionBackground:this.styles.listBackground,listFocusAndSelectionBackground:this.styles.listBackground,listInactiveSelectionBackground:this.styles.listBackground,listHoverBackground:this.styles.listBackground,listBackground:this.styles.listBackground,listFocusForeground:this.styles.listForeground,listHoverForeground:this.styles.listForeground,listInactiveFocusForeground:this.styles.listForeground,listInactiveSelectionForeground:this.styles.listForeground,listActiveSelectionForeground:this.styles.listForeground,listFocusAndSelectionForeground:this.styles.listForeground}})),this._register(this.tree.onContextMenu(o=>this.onContextMenu(o))),this._register(this.tree.onDidChangeContentHeight(()=>{this.onDidChangeTreeContentHeight()})),this._register(this.renderer.onDidChangeItemHeight(o=>{this.tree.updateElementHeight(o.element,o.height)})),this._register(this.tree.onDidFocus(()=>{this._onDidFocus.fire()})),this._register(this.tree.onDidScroll(()=>{this._onDidScroll.fire()}))}onContextMenu(e){e.browserEvent.preventDefault(),e.browserEvent.stopPropagation();const i=e.element,t=this.contextKeyService.createOverlay([[ce.key,C(i)&&!!i.errorDetails?.responseIsFiltered]]);this.contextMenuService.showContextMenu({menuId:R.ChatContext,menuActionOptions:{shouldForwardArgs:!0},contextKeyService:t,getAnchor:()=>e.anchor,getActionsContext:()=>i})}onDidChangeTreeContentHeight(){this.tree.scrollHeight!==this.previousTreeScrollHeight&&this.tree.scrollTop+this.tree.renderHeight>=this.previousTreeScrollHeight-2&&u.scheduleAtNextAnimationFrame(u.getWindow(this.listContainer),()=>{m(this.tree)},0),this.previousTreeScrollHeight=this.tree.scrollHeight,this._onDidChangeContentHeight.fire()}createInput(e,i){this.inputPart=this._register(this.instantiationService.createInstance(Se,this.location,{renderFollowups:i?.renderFollowups??!0,renderStyle:i?.renderStyle==="minimal"?"compact":i?.renderStyle,menus:{executeToolbar:R.ChatExecute,...this.viewOptions.menus},editorOverflowWidgetsDomNode:this.viewOptions.editorOverflowWidgetsDomNode},()=>this.collectInputState())),this.inputPart.render(e,"",this),this._register(this.inputPart.onDidLoadInputState(t=>{this.contribs.forEach(n=>{if(n.setInputState){const s=(typeof t=="object"&&t?.[n.id])??{};n.setInputState(s)}})})),this._register(this.inputPart.onDidFocus(()=>this._onDidFocus.fire())),this._register(this.inputPart.onDidChangeContext(t=>this._onDidChangeContext.fire(t))),this._register(this.inputPart.onDidAcceptFollowup(t=>{if(!this.viewModel)return;let n="";if(t.followup.agentId&&t.followup.agentId!==this.chatAgentService.getDefaultAgent(this.location)?.id){const s=this.chatAgentService.getAgent(t.followup.agentId);if(!s)return;this.lastSelectedAgent=s,n=`${ge}${s.name} `,t.followup.subCommand&&(n+=`${O}${t.followup.subCommand} `)}else!t.followup.agentId&&t.followup.subCommand&&this.chatSlashCommandService.hasCommand(t.followup.subCommand)&&(n=`${O}${t.followup.subCommand} `);n+=t.followup.message,this.acceptInput(n),t.response&&this.chatService.notifyUserAction({sessionId:this.viewModel.sessionId,requestId:t.response.requestId,agentId:t.response.agent?.id,command:t.response.slashCommand?.name,result:t.response.result,action:{kind:"followUp",followup:t.followup}})})),this._register(this.inputPart.onDidChangeHeight(()=>{this.bodyDimension&&this.layout(this.bodyDimension.height,this.bodyDimension.width),this._onDidChangeContentHeight.fire()})),this._register(this.inputEditor.onDidChangeModelContent(()=>this.parsedChatRequest=void 0)),this._register(this.chatAgentService.onDidChangeAgents(()=>this.parsedChatRequest=void 0))}onDidStyleChange(){this.container.style.setProperty("--vscode-interactive-result-editor-background-color",this.editorOptions.configuration.resultEditor.backgroundColor?.toString()??""),this.container.style.setProperty("--vscode-interactive-session-foreground",this.editorOptions.configuration.foreground?.toString()??""),this.container.style.setProperty("--vscode-chat-list-background",this.themeService.getColorTheme().getColor(this.styles.listBackground)?.toString()??"")}setModel(e,i){if(!this.container)throw new Error("Call render() before setModel()");e.sessionId!==this.viewModel?.sessionId&&(this._codeBlockModelCollection.clear(),this.container.setAttribute("data-session-id",e.sessionId),this.viewModel=this.instantiationService.createInstance(fe,e,this._codeBlockModelCollection),this.viewModelDisposables.add(N.accumulate(this.viewModel.onDidChange,0)(t=>{this.viewModel&&(this.requestInProgress.set(this.viewModel.requestInProgress),this.onDidChangeItems(),t.some(n=>n?.kind==="addRequest")&&this.visible&&(m(this.tree),this.focusInput()))})),this.viewModelDisposables.add(this.viewModel.onDidDisposeModel(()=>{this.inputPart.saveState(),this.viewModel=void 0,this.onDidChangeItems()})),this.inputPart.initForNewChatModel(i.inputValue,i.inputState??this.collectInputState()),this.contribs.forEach(t=>{t.setInputState&&i.inputState?.[t.id]&&t.setInputState(i.inputState?.[t.id])}),this.viewModelDisposables.add(e.onDidChange(t=>{t.kind==="setAgent"&&this._onDidChangeAgent.fire({agent:t.agent,slashCommand:t.command})})),this.tree&&(this.onDidChangeItems(),m(this.tree)))}getFocus(){return this.tree.getFocus()[0]??void 0}reveal(e,i){this.tree.reveal(e,i)}focus(e){const t=this.tree.getNode(null).children.find(n=>n.element?.id===e.id);t&&(this.tree.setFocus([t.element]),this.tree.domFocus())}refilter(){this.tree.refilter()}setInputPlaceholder(e){this.viewModel?.setInputPlaceholder(e)}resetInputPlaceholder(){this.viewModel?.resetInputPlaceholder()}setInput(e=""){this.inputPart.setValue(e,!1)}getInput(){return this.inputPart.inputEditor.getValue()}logInputHistory(){this.inputPart.logInputHistory()}async acceptInput(e,i){return this._acceptInput(e?{query:e}:void 0,i)}async acceptInputWithPrefix(e){this._acceptInput({prefix:e})}collectInputState(){const e={};return this.contribs.forEach(i=>{i.getInputState&&(e[i.id]=i.getInputState())}),e}async _acceptInput(e,i){if(this.viewModel){this._onDidAcceptInput.fire();const t=this.getInput(),n=this.chatAccessibilityService.acceptRequest(),s=e?"query"in e?e.query:`${e.prefix} ${t}`:t,r=!e||"prefix"in e,o=await this.chatService.sendRequest(this.viewModel.sessionId,s,{location:this.location,locationData:this._location.resolveData?.(),parserContext:{selectedAgent:this._lastSelectedAgent},attachedContext:[...this.inputPart.attachedContext.values()]});if(o)return this.inputPart.acceptInput(r),this._onDidSubmitAgent.fire({agent:o.agent,slashCommand:o.slashCommand}),o.responseCompletePromise.then(()=>{const l=this.viewModel?.getItems().filter(C),p=l?.[l.length-1];if(this.chatAccessibilityService.acceptResponse(p,n,i),p?.result?.nextQuestion){const{prompt:v,participant:E,command:P}=p.result.nextQuestion,_=Ce(this.chatAgentService,this.location,v,E,P);_&&this.input.setValue(_,!1)}}),o.responseCreatedPromise}}setContext(e,...i){this.inputPart.attachContext(e,...i)}getCodeBlockInfosForResponse(e){return this.renderer.getCodeBlockInfosForResponse(e)}getCodeBlockInfoForEditor(e){return this.renderer.getCodeBlockInfoForEditor(e)}getFileTreeInfosForResponse(e){return this.renderer.getFileTreeInfosForResponse(e)}getLastFocusedFileTreeForResponse(e){return this.renderer.getLastFocusedFileTreeForResponse(e)}focusLastMessage(){if(!this.viewModel)return;const e=this.tree.getNode(null).children,i=e[e.length-1];i&&(this.tree.setFocus([i.element]),this.tree.domFocus())}layout(e,i){i=Math.min(i,850),this.bodyDimension=new u.Dimension(i,e),this.inputPart.layout(e,i);const t=this.inputPart.inputPartHeight,n=this.tree.scrollTop+this.tree.renderHeight>=this.tree.scrollHeight,s=e-t;this.tree.layout(s,i),this.tree.getHTMLElement().style.height=`${s}px`,this.renderer.layout(i),n&&m(this.tree),this.listContainer.style.height=`${e-t}px`,this._onDidChangeHeight.fire(e)}_dynamicMessageLayoutData;setDynamicChatTreeItemLayout(e,i){this._dynamicMessageLayoutData={numOfMessages:e,maxHeight:i,enabled:!0},this._register(this.renderer.onDidChangeItemHeight(()=>this.layoutDynamicChatTreeItemMode()));const t=this._register(new j);this._register(this.tree.onDidScroll(n=>{this._dynamicMessageLayoutData?.enabled&&(t.value=u.scheduleAtNextAnimationFrame(u.getWindow(this.listContainer),()=>{if(!n.scrollTopChanged||n.heightChanged||n.scrollHeightChanged)return;const s=n.height,r=n.scrollHeight-s-n.scrollTop;if(r===0)return;const o=this._dynamicMessageLayoutData?.maxHeight??i,l=this.bodyDimension?.width??this.container.offsetWidth;this.inputPart.layout(o,l);const p=this.inputPart.inputPartHeight,v=Math.min(s+r,o-p);this.layout(v+p,l)}))}))}updateDynamicChatTreeItemLayout(e,i){this._dynamicMessageLayoutData={numOfMessages:e,maxHeight:i,enabled:!0};let t=!1,n=this.bodyDimension.height,s=this.bodyDimension.width;i<this.bodyDimension.height&&(n=i,t=!0);const r=this.container.offsetWidth;this.bodyDimension?.width!==r&&(s=r,t=!0),t&&this.layout(n,s)}get isDynamicChatTreeItemLayoutEnabled(){return this._dynamicMessageLayoutData?.enabled??!1}set isDynamicChatTreeItemLayoutEnabled(e){this._dynamicMessageLayoutData&&(this._dynamicMessageLayoutData.enabled=e)}layoutDynamicChatTreeItemMode(){if(!this.viewModel||!this._dynamicMessageLayoutData?.enabled)return;const e=this.bodyDimension?.width??this.container.offsetWidth;this.inputPart.layout(this._dynamicMessageLayoutData.maxHeight,e);const i=this.inputPart.inputPartHeight,t=this.viewModel.getItems(),n=t.slice(-this._dynamicMessageLayoutData.numOfMessages),s=n.some(o=>o.currentRenderedHeight===void 0),r=s?this._dynamicMessageLayoutData.maxHeight:n.reduce((o,l)=>o+l.currentRenderedHeight,0);this.layout(Math.min(i+r+(t.length>2?18:0),this._dynamicMessageLayoutData.maxHeight),e),(s||!r)&&m(this.tree)}saveState(){this.inputPart.saveState()}getViewState(){return{inputValue:this.getInput(),inputState:this.collectInputState()}}};I=H([c(4,Y),c(5,L),c(6,ee),c(7,Ie),c(8,oe),c(9,De),c(10,Z),c(11,be),c(12,ne),c(13,se),c(14,ve)],I);class ut{_widgets=[];_lastFocusedWidget=void 0;get lastFocusedWidget(){return this._lastFocusedWidget}constructor(){}getWidgetByInputUri(a){return this._widgets.find(e=>z(e.inputUri,a))}getWidgetBySessionId(a){return this._widgets.find(e=>e.viewModel?.sessionId===a)}setLastFocusedWidget(a){a!==this._lastFocusedWidget&&(this._lastFocusedWidget=a)}register(a){if(this._widgets.some(e=>e===a))throw new Error("Cannot register the same widget multiple times");return this._widgets.push(a),K(a.onDidFocus(()=>this.setLastFocusedWidget(a)),Q(()=>this._widgets.splice(this._widgets.indexOf(a),1)))}}export{I as ChatWidget,ut as ChatWidgetService,Fe as isQuickChat};
