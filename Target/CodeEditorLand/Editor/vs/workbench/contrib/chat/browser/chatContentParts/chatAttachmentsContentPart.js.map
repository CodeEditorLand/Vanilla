{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/chatContentParts/chatAttachmentsContentPart.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from '../../../../../base/browser/dom.js';\nimport { Disposable, DisposableStore } from '../../../../../base/common/lifecycle.js';\nimport { IChatRequestVariableEntry } from '../../common/chatModel.js';\nimport { Emitter } from '../../../../../base/common/event.js';\nimport { IInstantiationService } from '../../../../../platform/instantiation/common/instantiation.js';\nimport { ResourceLabels } from '../../../../browser/labels.js';\nimport { URI } from '../../../../../base/common/uri.js';\nimport { FileKind } from '../../../../../platform/files/common/files.js';\nimport { Range } from '../../../../../editor/common/core/range.js';\nimport { basename, dirname } from '../../../../../base/common/path.js';\nimport { localize } from '../../../../../nls.js';\nimport { ChatResponseReferencePartStatusKind, IChatContentReference } from '../../common/chatService.js';\nimport { IOpenerService } from '../../../../../platform/opener/common/opener.js';\n\nexport class ChatAttachmentsContentPart extends Disposable {\n\tprivate readonly attachedContextDisposables = this._register(new DisposableStore());\n\n\tprivate readonly _onDidChangeVisibility = this._register(new Emitter<boolean>());\n\tprivate readonly _contextResourceLabels = this.instantiationService.createInstance(ResourceLabels, { onDidChangeVisibility: this._onDidChangeVisibility.event });\n\n\tconstructor(\n\t\tprivate readonly variables: IChatRequestVariableEntry[],\n\t\tprivate readonly contentReferences: ReadonlyArray<IChatContentReference> = [],\n\t\tpublic readonly domNode: HTMLElement = dom.$('.chat-attached-context'),\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.initAttachedContext(domNode);\n\t}\n\n\tprivate initAttachedContext(container: HTMLElement) {\n\t\tdom.clearNode(container);\n\t\tthis.attachedContextDisposables.clear();\n\t\tdom.setVisibility(Boolean(this.variables.length), this.domNode);\n\n\t\tthis.variables.forEach((attachment) => {\n\t\t\tconst widget = dom.append(container, dom.$('.chat-attached-context-attachment.show-file-icons'));\n\t\t\tconst label = this._contextResourceLabels.create(widget, { supportIcons: true });\n\t\t\tconst file = URI.isUri(attachment.value) ? attachment.value : attachment.value && typeof attachment.value === 'object' && 'uri' in attachment.value && URI.isUri(attachment.value.uri) ? attachment.value.uri : undefined;\n\t\t\tconst range = attachment.value && typeof attachment.value === 'object' && 'range' in attachment.value && Range.isIRange(attachment.value.range) ? attachment.value.range : undefined;\n\n\t\t\tconst correspondingContentReference = this.contentReferences.find((ref) => typeof ref.reference === 'object' && 'variableName' in ref.reference && ref.reference.variableName === attachment.name);\n\t\t\tconst isAttachmentOmitted = correspondingContentReference?.options?.status?.kind === ChatResponseReferencePartStatusKind.Omitted;\n\t\t\tconst isAttachmentPartialOrOmitted = isAttachmentOmitted || correspondingContentReference?.options?.status?.kind === ChatResponseReferencePartStatusKind.Partial;\n\n\t\t\tif (file) {\n\t\t\t\tconst fileBasename = basename(file.path);\n\t\t\t\tconst fileDirname = dirname(file.path);\n\t\t\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\t\t\t\tlet ariaLabel;\n\t\t\t\tif (isAttachmentOmitted) {\n\t\t\t\t\tariaLabel = range ? localize('chat.omittedFileAttachmentWithRange', \"Omitted: {0}, line {1} to line {2}.\", friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.omittedFileAttachment', \"Omitted: {0}.\", friendlyName);\n\t\t\t\t} else if (isAttachmentPartialOrOmitted) {\n\t\t\t\t\tariaLabel = range ? localize('chat.partialFileAttachmentWithRange', \"Partially attached: {0}, line {1} to line {2}.\", friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.partialFileAttachment', \"Partially attached: {0}.\", friendlyName);\n\t\t\t\t} else {\n\t\t\t\t\tariaLabel = range ? localize('chat.fileAttachmentWithRange3', \"Attached: {0}, line {1} to line {2}.\", friendlyName, range.startLineNumber, range.endLineNumber) : localize('chat.fileAttachment3', \"Attached: {0}.\", friendlyName);\n\t\t\t\t}\n\n\t\t\t\tlabel.setFile(file, {\n\t\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\t\thidePath: true,\n\t\t\t\t\trange,\n\t\t\t\t\ttitle: correspondingContentReference?.options?.status?.description\n\t\t\t\t});\n\t\t\t\twidget.ariaLabel = ariaLabel;\n\t\t\t\twidget.tabIndex = 0;\n\t\t\t\twidget.style.cursor = 'pointer';\n\n\t\t\t\tthis.attachedContextDisposables.add(dom.addDisposableListener(widget, dom.EventType.CLICK, async (e: MouseEvent) => {\n\t\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\t\tif (file) {\n\t\t\t\t\t\tthis.openerService.open(\n\t\t\t\t\t\t\tfile,\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\t\t\t\teditorOptions: {\n\t\t\t\t\t\t\t\t\tselection: range\n\t\t\t\t\t\t\t\t} as any\n\t\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}));\n\t\t\t} else {\n\t\t\t\tconst attachmentLabel = attachment.fullName ?? attachment.name;\n\t\t\t\tconst withIcon = attachment.icon?.id ? `$(${attachment.icon.id}) ${attachmentLabel}` : attachmentLabel;\n\t\t\t\tlabel.setLabel(withIcon, correspondingContentReference?.options?.status?.description);\n\n\t\t\t\twidget.ariaLabel = localize('chat.attachment3', \"Attached context: {0}.\", attachment.name);\n\t\t\t\twidget.tabIndex = 0;\n\t\t\t}\n\n\t\t\tif (isAttachmentPartialOrOmitted) {\n\t\t\t\twidget.classList.add('warning');\n\t\t\t}\n\t\t\tconst description = correspondingContentReference?.options?.status?.description;\n\t\t\tif (isAttachmentPartialOrOmitted) {\n\t\t\t\twidget.ariaLabel = `${widget.ariaLabel}${description ? ` ${description}` : ''}`;\n\t\t\t\tfor (const selector of ['.monaco-icon-suffix-container', '.monaco-icon-name-container']) {\n\t\t\t\t\tconst element = label.element.querySelector(selector);\n\t\t\t\t\tif (element) {\n\t\t\t\t\t\telement.classList.add('warning');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n\n"],
  "mappings": "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",
  "names": []
}
