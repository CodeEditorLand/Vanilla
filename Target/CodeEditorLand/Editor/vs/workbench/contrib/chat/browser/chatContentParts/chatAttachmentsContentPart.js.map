{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/chatContentParts/chatAttachmentsContentPart.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport { Emitter } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { basename, dirname } from \"../../../../../base/common/path.js\";\nimport { URI } from \"../../../../../base/common/uri.js\";\nimport { Range } from \"../../../../../editor/common/core/range.js\";\nimport { localize } from \"../../../../../nls.js\";\nimport { FileKind } from \"../../../../../platform/files/common/files.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { IOpenerService } from \"../../../../../platform/opener/common/opener.js\";\nimport { ResourceLabels } from \"../../../../browser/labels.js\";\nimport type { IChatRequestVariableEntry } from \"../../common/chatModel.js\";\nimport {\n\tChatResponseReferencePartStatusKind,\n\ttype IChatContentReference,\n} from \"../../common/chatService.js\";\n\nexport class ChatAttachmentsContentPart extends Disposable {\n\tprivate readonly attachedContextDisposables = this._register(\n\t\tnew DisposableStore(),\n\t);\n\n\tprivate readonly _onDidChangeVisibility = this._register(\n\t\tnew Emitter<boolean>(),\n\t);\n\tprivate readonly _contextResourceLabels =\n\t\tthis.instantiationService.createInstance(ResourceLabels, {\n\t\t\tonDidChangeVisibility: this._onDidChangeVisibility.event,\n\t\t});\n\n\tconstructor(\n\t\tprivate readonly variables: IChatRequestVariableEntry[],\n\t\tprivate readonly contentReferences: ReadonlyArray<IChatContentReference> = [],\n\t\tpublic readonly domNode: HTMLElement = dom.$(\".chat-attached-context\"),\n\t\t@IInstantiationService\n\t\tprivate readonly instantiationService: IInstantiationService,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t) {\n\t\tsuper();\n\n\t\tthis.initAttachedContext(domNode);\n\t}\n\n\tprivate initAttachedContext(container: HTMLElement) {\n\t\tdom.clearNode(container);\n\t\tthis.attachedContextDisposables.clear();\n\t\tdom.setVisibility(Boolean(this.variables.length), this.domNode);\n\n\t\tthis.variables.forEach((attachment) => {\n\t\t\tconst widget = dom.append(\n\t\t\t\tcontainer,\n\t\t\t\tdom.$(\".chat-attached-context-attachment.show-file-icons\"),\n\t\t\t);\n\t\t\tconst label = this._contextResourceLabels.create(widget, {\n\t\t\t\tsupportIcons: true,\n\t\t\t});\n\t\t\tconst file = URI.isUri(attachment.value)\n\t\t\t\t? attachment.value\n\t\t\t\t: attachment.value &&\n\t\t\t\t\t\ttypeof attachment.value === \"object\" &&\n\t\t\t\t\t\t\"uri\" in attachment.value &&\n\t\t\t\t\t\tURI.isUri(attachment.value.uri)\n\t\t\t\t\t? attachment.value.uri\n\t\t\t\t\t: undefined;\n\t\t\tconst range =\n\t\t\t\tattachment.value &&\n\t\t\t\ttypeof attachment.value === \"object\" &&\n\t\t\t\t\"range\" in attachment.value &&\n\t\t\t\tRange.isIRange(attachment.value.range)\n\t\t\t\t\t? attachment.value.range\n\t\t\t\t\t: undefined;\n\n\t\t\tconst correspondingContentReference = this.contentReferences.find(\n\t\t\t\t(ref) =>\n\t\t\t\t\ttypeof ref.reference === \"object\" &&\n\t\t\t\t\t\"variableName\" in ref.reference &&\n\t\t\t\t\tref.reference.variableName === attachment.name,\n\t\t\t);\n\t\t\tconst isAttachmentOmitted =\n\t\t\t\tcorrespondingContentReference?.options?.status?.kind ===\n\t\t\t\tChatResponseReferencePartStatusKind.Omitted;\n\t\t\tconst isAttachmentPartialOrOmitted =\n\t\t\t\tisAttachmentOmitted ||\n\t\t\t\tcorrespondingContentReference?.options?.status?.kind ===\n\t\t\t\t\tChatResponseReferencePartStatusKind.Partial;\n\n\t\t\tif (file) {\n\t\t\t\tconst fileBasename = basename(file.path);\n\t\t\t\tconst fileDirname = dirname(file.path);\n\t\t\t\tconst friendlyName = `${fileBasename} ${fileDirname}`;\n\t\t\t\tlet ariaLabel;\n\t\t\t\tif (isAttachmentOmitted) {\n\t\t\t\t\tariaLabel = range\n\t\t\t\t\t\t? localize(\n\t\t\t\t\t\t\t\t\"chat.omittedFileAttachmentWithRange\",\n\t\t\t\t\t\t\t\t\"Omitted: {0}, line {1} to line {2}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t\trange.startLineNumber,\n\t\t\t\t\t\t\t\trange.endLineNumber,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: localize(\n\t\t\t\t\t\t\t\t\"chat.omittedFileAttachment\",\n\t\t\t\t\t\t\t\t\"Omitted: {0}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t);\n\t\t\t\t} else if (isAttachmentPartialOrOmitted) {\n\t\t\t\t\tariaLabel = range\n\t\t\t\t\t\t? localize(\n\t\t\t\t\t\t\t\t\"chat.partialFileAttachmentWithRange\",\n\t\t\t\t\t\t\t\t\"Partially attached: {0}, line {1} to line {2}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t\trange.startLineNumber,\n\t\t\t\t\t\t\t\trange.endLineNumber,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: localize(\n\t\t\t\t\t\t\t\t\"chat.partialFileAttachment\",\n\t\t\t\t\t\t\t\t\"Partially attached: {0}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t);\n\t\t\t\t} else {\n\t\t\t\t\tariaLabel = range\n\t\t\t\t\t\t? localize(\n\t\t\t\t\t\t\t\t\"chat.fileAttachmentWithRange3\",\n\t\t\t\t\t\t\t\t\"Attached: {0}, line {1} to line {2}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t\trange.startLineNumber,\n\t\t\t\t\t\t\t\trange.endLineNumber,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t: localize(\n\t\t\t\t\t\t\t\t\"chat.fileAttachment3\",\n\t\t\t\t\t\t\t\t\"Attached: {0}.\",\n\t\t\t\t\t\t\t\tfriendlyName,\n\t\t\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tlabel.setFile(file, {\n\t\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\t\thidePath: true,\n\t\t\t\t\trange,\n\t\t\t\t\ttitle: correspondingContentReference?.options?.status\n\t\t\t\t\t\t?.description,\n\t\t\t\t});\n\t\t\t\twidget.ariaLabel = ariaLabel;\n\t\t\t\twidget.tabIndex = 0;\n\t\t\t\twidget.style.cursor = \"pointer\";\n\n\t\t\t\tthis.attachedContextDisposables.add(\n\t\t\t\t\tdom.addDisposableListener(\n\t\t\t\t\t\twidget,\n\t\t\t\t\t\tdom.EventType.CLICK,\n\t\t\t\t\t\tasync (e: MouseEvent) => {\n\t\t\t\t\t\t\tdom.EventHelper.stop(e, true);\n\t\t\t\t\t\t\tif (file) {\n\t\t\t\t\t\t\t\tthis.openerService.open(file, {\n\t\t\t\t\t\t\t\t\tfromUserGesture: true,\n\t\t\t\t\t\t\t\t\teditorOptions: {\n\t\t\t\t\t\t\t\t\t\tselection: range,\n\t\t\t\t\t\t\t\t\t} as any,\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t),\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tconst attachmentLabel = attachment.fullName ?? attachment.name;\n\t\t\t\tconst withIcon = attachment.icon?.id\n\t\t\t\t\t? `$(${attachment.icon.id}) ${attachmentLabel}`\n\t\t\t\t\t: attachmentLabel;\n\t\t\t\tlabel.setLabel(\n\t\t\t\t\twithIcon,\n\t\t\t\t\tcorrespondingContentReference?.options?.status?.description,\n\t\t\t\t);\n\n\t\t\t\twidget.ariaLabel = localize(\n\t\t\t\t\t\"chat.attachment3\",\n\t\t\t\t\t\"Attached context: {0}.\",\n\t\t\t\t\tattachment.name,\n\t\t\t\t);\n\t\t\t\twidget.tabIndex = 0;\n\t\t\t}\n\n\t\t\tif (isAttachmentPartialOrOmitted) {\n\t\t\t\twidget.classList.add(\"warning\");\n\t\t\t}\n\t\t\tconst description =\n\t\t\t\tcorrespondingContentReference?.options?.status?.description;\n\t\t\tif (isAttachmentPartialOrOmitted) {\n\t\t\t\twidget.ariaLabel = `${widget.ariaLabel}${description ? ` ${description}` : \"\"}`;\n\t\t\t\tfor (const selector of [\n\t\t\t\t\t\".monaco-icon-suffix-container\",\n\t\t\t\t\t\".monaco-icon-name-container\",\n\t\t\t\t]) {\n\t\t\t\t\tconst element = label.element.querySelector(selector);\n\t\t\t\t\tif (element) {\n\t\t\t\t\t\telement.classList.add(\"warning\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
