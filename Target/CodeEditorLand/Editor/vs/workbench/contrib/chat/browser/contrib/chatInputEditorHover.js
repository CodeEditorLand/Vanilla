var h=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var p=(n,e,o,t)=>{for(var r=t>1?void 0:t?C(e,o):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(r=(t?a(e,o,r):a(r))||r);return t&&r&&h(e,o,r),r},s=(n,e)=>(o,t)=>e(o,t,n);import{DisposableStore as I}from"../../../../../../vs/base/common/lifecycle.js";import"../../../../../../vs/editor/browser/editorBrowser.js";import{Range as v}from"../../../../../../vs/editor/common/core/range.js";import"../../../../../../vs/editor/common/model.js";import{HoverAnchorType as u,HoverParticipantRegistry as H,RenderedHoverParts as m}from"../../../../../../vs/editor/contrib/hover/browser/hoverTypes.js";import*as P from"../../../../../../vs/nls.js";import{ICommandService as f}from"../../../../../../vs/platform/commands/common/commands.js";import{IInstantiationService as A}from"../../../../../../vs/platform/instantiation/common/instantiation.js";import{IChatWidgetService as S}from"../../../../../../vs/workbench/contrib/chat/browser/chat.js";import{ChatAgentHover as b,getChatAgentHoverOptions as y}from"../../../../../../vs/workbench/contrib/chat/browser/chatAgentHover.js";import{ChatEditorHoverWrapper as R}from"../../../../../../vs/workbench/contrib/chat/browser/contrib/editorHoverWrapper.js";import"../../../../../../vs/workbench/contrib/chat/common/chatAgents.js";import{extractAgentAndCommand as w}from"../../../../../../vs/workbench/contrib/chat/common/chatParserTypes.js";let d=class{constructor(e,o,t,r){this.editor=e;this.instantiationService=o;this.chatWidgetService=t;this.commandService=r}hoverOrdinal=1;computeSync(e,o){if(!this.editor.hasModel())return[];const t=this.chatWidgetService.getWidgetByInputUri(this.editor.getModel().uri);if(!t)return[];const{agentPart:r}=w(t.parsedInput);return r?v.containsPosition(r.editorRange,e.range.getStartPosition())?[new E(this,v.lift(r.editorRange),r.agent)]:[]:[]}renderHoverParts(e,o){if(!o.length)return new m([]);const t=new I,r=t.add(this.instantiationService.createInstance(b));t.add(r.onDidChangeContents(()=>e.onContentsChanged()));const i=o[0],a=i.agent;r.setAgent(a.id);const g=y(()=>a,this.commandService).actions,c=this.instantiationService.createInstance(R,r.domNode,g).domNode;e.fragment.appendChild(c);const l={hoverPart:i,hoverElement:c,dispose(){t.dispose()}};return new m([l])}getAccessibleContent(e){return P.localize("hoverAccessibilityChatAgent","There is a chat agent hover part here.")}};d=p([s(1,A),s(2,S),s(3,f)],d);class E{constructor(e,o,t){this.owner=e;this.range=o;this.agent=t}isValidForHoverAnchor(e){return e.type===u.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}H.register(d);export{E as ChatAgentHoverPart,d as ChatAgentHoverParticipant};
