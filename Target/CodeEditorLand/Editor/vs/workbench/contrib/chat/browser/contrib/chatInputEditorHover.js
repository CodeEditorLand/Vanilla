var h=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var p=(n,e,o,r)=>{for(var t=r>1?void 0:r?C(e,o):e,i=n.length-1,a;i>=0;i--)(a=n[i])&&(t=(r?a(e,o,t):a(t))||t);return r&&t&&h(e,o,t),t},s=(n,e)=>(o,r)=>e(o,r,n);import{DisposableStore as I}from"../../../../../base/common/lifecycle.js";import{Range as m}from"../../../../../editor/common/core/range.js";import{HoverAnchorType as u,HoverParticipantRegistry as H,RenderedHoverParts as v}from"../../../../../editor/contrib/hover/browser/hoverTypes.js";import*as y from"../../../../../nls.js";import{ICommandService as P}from"../../../../../platform/commands/common/commands.js";import{IInstantiationService as A}from"../../../../../platform/instantiation/common/instantiation.js";import{extractAgentAndCommand as f}from"../../common/chatParserTypes.js";import{IChatWidgetService as S}from"../chat.js";import{ChatAgentHover as b,getChatAgentHoverOptions as R}from"../chatAgentHover.js";import{ChatEditorHoverWrapper as w}from"./editorHoverWrapper.js";let d=class{constructor(e,o,r,t){this.editor=e;this.instantiationService=o;this.chatWidgetService=r;this.commandService=t}hoverOrdinal=1;computeSync(e,o){if(!this.editor.hasModel())return[];const r=this.chatWidgetService.getWidgetByInputUri(this.editor.getModel().uri);if(!r)return[];const{agentPart:t}=f(r.parsedInput);return t?m.containsPosition(t.editorRange,e.range.getStartPosition())?[new E(this,m.lift(t.editorRange),t.agent)]:[]:[]}renderHoverParts(e,o){if(!o.length)return new v([]);const r=new I,t=r.add(this.instantiationService.createInstance(b));r.add(t.onDidChangeContents(()=>e.onContentsChanged()));const i=o[0],a=i.agent;t.setAgent(a.id);const g=R(()=>a,this.commandService).actions,c=this.instantiationService.createInstance(w,t.domNode,g).domNode;e.fragment.appendChild(c);const l={hoverPart:i,hoverElement:c,dispose(){r.dispose()}};return new v([l])}getAccessibleContent(e){return y.localize("hoverAccessibilityChatAgent","There is a chat agent hover part here.")}};d=p([s(1,A),s(2,S),s(3,P)],d);class E{constructor(e,o,r){this.owner=e;this.range=o;this.agent=r}isValidForHoverAnchor(e){return e.type===u.Range&&this.range.startColumn<=e.range.startColumn&&this.range.endColumn>=e.range.endColumn}}H.register(d);export{E as ChatAgentHoverPart,d as ChatAgentHoverParticipant};
