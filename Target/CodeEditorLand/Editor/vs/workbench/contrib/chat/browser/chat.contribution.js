var j=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var w=(p,n,l,o)=>{for(var a=o>1?void 0:o?O(n,l):n,f=p.length-1,y;f>=0;f--)(y=p[f])&&(a=(o?y(n,l,a):y(a))||a);return o&&a&&j(n,l,a),a},m=(p,n)=>(l,o)=>n(l,o,p);import{MarkdownString as d,isMarkdownString as E}from"../../../../base/common/htmlContent.js";import{Disposable as P}from"../../../../base/common/lifecycle.js";import{Schemas as T}from"../../../../base/common/network.js";import{isMacintosh as Q}from"../../../../base/common/platform.js";import*as e from"../../../../nls.js";import{AccessibleViewRegistry as A}from"../../../../platform/accessibility/browser/accessibleViewRegistry.js";import{ICommandService as U}from"../../../../platform/commands/common/commands.js";import{Extensions as q}from"../../../../platform/configuration/common/configurationRegistry.js";import{SyncDescriptor as G}from"../../../../platform/instantiation/common/descriptors.js";import{InstantiationType as t,registerSingleton as i}from"../../../../platform/instantiation/common/extensions.js";import{IInstantiationService as D}from"../../../../platform/instantiation/common/instantiation.js";import{Registry as v}from"../../../../platform/registry/common/platform.js";import{EditorPaneDescriptor as J}from"../../../browser/editor.js";import{Extensions as K,WorkbenchPhase as x,registerWorkbenchContribution2 as k}from"../../../common/contributions.js";import{EditorExtensions as z}from"../../../common/editor.js";import{ChatAccessibilityHelp as X}from"./actions/chatAccessibilityHelp.js";import{registerChatActions as Y}from"./actions/chatActions.js";import{ACTION_ID_NEW_CHAT as Z,registerNewChatActions as ee}from"./actions/chatClearActions.js";import{registerChatCodeBlockActions as te,registerChatCodeCompareBlockActions as ie}from"./actions/chatCodeblockActions.js";import{registerChatContextActions as oe}from"./actions/chatContextActions.js";import{registerChatCopyActions as re}from"./actions/chatCopyActions.js";import{registerChatDeveloperActions as ae}from"./actions/chatDeveloperActions.js";import{SubmitAction as ne,registerChatExecuteActions as ce}from"./actions/chatExecuteActions.js";import{registerChatFileTreeActions as se}from"./actions/chatFileTreeActions.js";import{registerChatExportActions as le}from"./actions/chatImportExport.js";import{registerMoveActions as me}from"./actions/chatMoveActions.js";import{registerQuickChatActions as de}from"./actions/chatQuickInputActions.js";import{registerChatTitleActions as pe}from"./actions/chatTitleActions.js";import{IChatAccessibilityService as he,IChatCodeBlockContextProviderService as fe,IChatWidgetService as Ce,IQuickChatService as ge}from"./chat.js";import{ChatAccessibilityService as ue}from"./chatAccessibilityService.js";import{ChatEditor as be}from"./chatEditor.js";import{ChatEditorInput as g,ChatEditorInputSerializer as ye}from"./chatEditorInput.js";import{agentSlashCommandToMarkdown as ve,agentToMarkdown as xe}from"./chatMarkdownDecorationsRenderer.js";import{ChatCompatibilityNotifier as R,ChatExtensionPointHandler as W}from"./chatParticipantContributions.js";import{QuickChatService as ke}from"./chatQuick.js";import{ChatResponseAccessibleView as Se}from"./chatResponseAccessibleView.js";import{ChatVariablesService as Ie}from"./chatVariables.js";import{ChatWidgetService as we}from"./chatWidget.js";import{ChatCodeBlockContextProviderService as Ee}from"./codeBlockContextProviderService.js";import"./contrib/chatContextAttachments.js";import"./contrib/chatInputCompletions.js";import"./contrib/chatInputEditorContrib.js";import"./contrib/chatInputEditorHover.js";import{ChatAgentLocation as u,ChatAgentNameService as Pe,ChatAgentService as Te,IChatAgentNameService as Ae,IChatAgentService as M}from"../common/chatAgents.js";import{chatVariableLeader as De}from"../common/chatParserTypes.js";import{IChatService as ze}from"../common/chatService.js";import{ChatService as Re}from"../common/chatServiceImpl.js";import{ChatSlashCommandService as We,IChatSlashCommandService as V}from"../common/chatSlashCommands.js";import{IChatVariablesService as L}from"../common/chatVariables.js";import{ChatWidgetHistoryService as Me,IChatWidgetHistoryService as Ve}from"../common/chatWidgetHistoryService.js";import{ILanguageModelsService as Le,LanguageModelsService as $e}from"../common/languageModels.js";import{ILanguageModelStatsService as He,LanguageModelStatsService as _e}from"../common/languageModelStats.js";import{ILanguageModelToolsService as Be,LanguageModelToolsService as Fe}from"../common/languageModelToolsService.js";import{LanguageModelToolsExtensionPointHandler as $}from"../common/tools/languageModelToolsContribution.js";import{IVoiceChatService as Ne,VoiceChatService as je}from"../common/voiceChatService.js";import{IEditorResolverService as Oe,RegisteredEditorPriority as Qe}from"../../../services/editor/common/editorResolverService.js";import{LifecyclePhase as Ue}from"../../../services/lifecycle/common/lifecycle.js";import"../common/chatColors.js";const qe=v.as(q.Configuration);qe.registerConfiguration({id:"chatSidebar",title:e.localize("interactiveSessionConfigurationTitle","Chat"),type:"object",properties:{"chat.editor.fontSize":{type:"number",description:e.localize("interactiveSession.editor.fontSize","Controls the font size in pixels in chat codeblocks."),default:Q?12:14},"chat.editor.fontFamily":{type:"string",description:e.localize("interactiveSession.editor.fontFamily","Controls the font family in chat codeblocks."),default:"default"},"chat.editor.fontWeight":{type:"string",description:e.localize("interactiveSession.editor.fontWeight","Controls the font weight in chat codeblocks."),default:"default"},"chat.editor.wordWrap":{type:"string",description:e.localize("interactiveSession.editor.wordWrap","Controls whether lines should wrap in chat codeblocks."),default:"off",enum:["on","off"]},"chat.editor.lineHeight":{type:"number",description:e.localize("interactiveSession.editor.lineHeight","Controls the line height in pixels in chat codeblocks. Use 0 to compute the line height from the font size."),default:0},"chat.experimental.implicitContext":{type:"boolean",description:e.localize("chat.experimental.implicitContext","Controls whether a checkbox is shown to allow the user to determine which implicit context is included with a chat participant's prompt."),deprecated:!0,default:!1},"chat.experimental.variables.editor":{type:"boolean",description:e.localize("chat.experimental.variables.editor","Enables variables for editor chat."),default:!0},"chat.experimental.variables.notebook":{type:"boolean",description:e.localize("chat.experimental.variables.notebook","Enables variables for notebook chat."),default:!1},"chat.experimental.variables.terminal":{type:"boolean",description:e.localize("chat.experimental.variables.terminal","Enables variables for terminal chat."),default:!1},"chat.experimental.detectParticipant.enabled":{type:"boolean",description:e.localize("chat.experimental.detectParticipant.enabled","Enables chat participant autodetection for panel chat."),default:null}}}),v.as(z.EditorPane).registerEditorPane(J.create(be,g.EditorID,e.localize("chat","Chat")),[new G(g)]);let h=class extends P{static ID="workbench.contrib.chatResolver";constructor(n,l){super(),this._register(n.registerEditor(`${T.vscodeChatSesssion}:**/**`,{id:g.EditorID,label:e.localize("chat","Chat"),priority:Qe.builtin},{singlePerResource:!0,canSupportResource:o=>o.scheme===T.vscodeChatSesssion},{createEditorInput:({resource:o,options:a})=>({editor:l.createInstance(g,o,a),options:a})}))}};h=w([m(0,Oe),m(1,D)],h),A.register(new Se),A.register(new X);let b=class extends P{constructor(n,l,o,a,f){super(),this._store.add(n.registerSlashCommand({command:"clear",detail:e.localize("clear","Start a new chat"),sortText:"z2_clear",executeImmediately:!0,locations:[u.Panel]},async()=>{l.executeCommand(Z)})),this._store.add(n.registerSlashCommand({command:"help",detail:"",sortText:"z1_help",executeImmediately:!0,locations:[u.Panel]},async(y,c)=>{const r=o.getDefaultAgent(u.Panel),H=o.getAgents();r?.metadata.helpTextPrefix&&(E(r.metadata.helpTextPrefix)?c.report({content:r.metadata.helpTextPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPrefix),kind:"markdownContent"}),c.report({content:new d(`

`),kind:"markdownContent"}));const _=(await Promise.all(H.filter(s=>s.id!==r?.id).filter(s=>s.locations.includes(u.Panel)).map(async s=>{const S=s.description?`- ${s.description}`:"",B=`- ${f.invokeFunction(C=>xe(s,!0,C))} ${S}`,F=s.slashCommands.map(C=>{const N=C.description?`- ${C.description}`:"";return`	* ${ve(s,C)} ${N}`}).join(`
`);return(B+`
`+F).trim()}))).join(`
`);if(c.report({content:new d(_,{isTrusted:{enabledCommands:[ne.ID]}}),kind:"markdownContent"}),r?.metadata.helpTextVariablesPrefix){c.report({content:new d(`

`),kind:"markdownContent"}),E(r.metadata.helpTextVariablesPrefix)?c.report({content:r.metadata.helpTextVariablesPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextVariablesPrefix),kind:"markdownContent"});const S=[...a.getVariables(u.Panel),{name:"file",description:e.localize("file","Choose a file in the workspace")}].map(I=>`* \`${De}${I.name}\` - ${I.description}`).join(`
`);c.report({content:new d(`
`+S),kind:"markdownContent"})}r?.metadata.helpTextPostfix&&(c.report({content:new d(`

`),kind:"markdownContent"}),E(r.metadata.helpTextPostfix)?c.report({content:r.metadata.helpTextPostfix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPostfix),kind:"markdownContent"}))}))}};b=w([m(0,V),m(1,U),m(2,M),m(3,L),m(4,D)],b);const Ge=v.as(K.Workbench);k(h.ID,h,x.BlockStartup),Ge.registerWorkbenchContribution(b,Ue.Eventually),v.as(z.EditorFactory).registerEditorSerializer(g.TypeID,ye),k(W.ID,W,x.BlockStartup),k($.ID,$,x.BlockRestore),k(R.ID,R,x.Eventually),Y(),re(),te(),ie(),se(),pe(),ce(),de(),le(),me(),ee(),oe(),ae(),i(ze,Re,t.Delayed),i(Ce,we,t.Delayed),i(ge,ke,t.Delayed),i(he,ue,t.Delayed),i(Ve,Me,t.Delayed),i(Le,$e,t.Delayed),i(He,_e,t.Delayed),i(V,We,t.Delayed),i(M,Te,t.Delayed),i(Ae,Pe,t.Delayed),i(L,Ie,t.Delayed),i(Be,Fe,t.Delayed),i(Ne,je,t.Delayed),i(fe,Ee,t.Delayed);
