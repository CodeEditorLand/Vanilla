var N=Object.defineProperty;var j=Object.getOwnPropertyDescriptor;var S=(p,n,l,o)=>{for(var a=o>1?void 0:o?j(n,l):n,f=p.length-1,x;f>=0;f--)(x=p[f])&&(a=(o?x(n,l,a):x(a))||a);return o&&a&&N(n,l,a),a},m=(p,n)=>(l,o)=>n(l,o,p);import{isMarkdownString as I,MarkdownString as d}from"../../../../../vs/base/common/htmlContent.js";import{Disposable as P}from"../../../../../vs/base/common/lifecycle.js";import{Schemas as T}from"../../../../../vs/base/common/network.js";import{isMacintosh as O}from"../../../../../vs/base/common/platform.js";import*as e from"../../../../../vs/nls.js";import{AccessibleViewRegistry as A}from"../../../../../vs/platform/accessibility/browser/accessibleViewRegistry.js";import{ICommandService as Q}from"../../../../../vs/platform/commands/common/commands.js";import{Extensions as U}from"../../../../../vs/platform/configuration/common/configurationRegistry.js";import{SyncDescriptor as q}from"../../../../../vs/platform/instantiation/common/descriptors.js";import{InstantiationType as t,registerSingleton as i}from"../../../../../vs/platform/instantiation/common/extensions.js";import{IInstantiationService as D}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{Registry as y}from"../../../../../vs/platform/registry/common/platform.js";import{EditorPaneDescriptor as G}from"../../../../../vs/workbench/browser/editor.js";import{registerWorkbenchContribution2 as w,Extensions as J,WorkbenchPhase as E}from"../../../../../vs/workbench/common/contributions.js";import{EditorExtensions as z}from"../../../../../vs/workbench/common/editor.js";import{ChatAccessibilityHelp as K}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatAccessibilityHelp.js";import{registerChatActions as X}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatActions.js";import{ACTION_ID_NEW_CHAT as Y,registerNewChatActions as Z}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatClearActions.js";import{registerChatCodeBlockActions as ee,registerChatCodeCompareBlockActions as te}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatCodeblockActions.js";import{registerChatContextActions as ie}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatContextActions.js";import{registerChatCopyActions as oe}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatCopyActions.js";import{registerChatDeveloperActions as re}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatDeveloperActions.js";import{registerChatExecuteActions as ae,SubmitAction as ne}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatExecuteActions.js";import{registerChatFileTreeActions as ce}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatFileTreeActions.js";import{registerChatExportActions as se}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatImportExport.js";import{registerMoveActions as le}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatMoveActions.js";import{registerQuickChatActions as me}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatQuickInputActions.js";import{registerChatTitleActions as de}from"../../../../../vs/workbench/contrib/chat/browser/actions/chatTitleActions.js";import{IChatAccessibilityService as pe,IChatCodeBlockContextProviderService as he,IChatWidgetService as fe,IQuickChatService as Ce}from"../../../../../vs/workbench/contrib/chat/browser/chat.js";import{ChatAccessibilityService as ge}from"../../../../../vs/workbench/contrib/chat/browser/chatAccessibilityService.js";import{ChatEditor as ue}from"../../../../../vs/workbench/contrib/chat/browser/chatEditor.js";import{ChatEditorInput as g,ChatEditorInputSerializer as be}from"../../../../../vs/workbench/contrib/chat/browser/chatEditorInput.js";import{agentSlashCommandToMarkdown as xe,agentToMarkdown as ye}from"../../../../../vs/workbench/contrib/chat/browser/chatMarkdownDecorationsRenderer.js";import{ChatExtensionPointHandler as R}from"../../../../../vs/workbench/contrib/chat/browser/chatParticipantContributions.js";import{QuickChatService as ve}from"../../../../../vs/workbench/contrib/chat/browser/chatQuick.js";import{ChatResponseAccessibleView as ke}from"../../../../../vs/workbench/contrib/chat/browser/chatResponseAccessibleView.js";import{ChatVariablesService as Se}from"../../../../../vs/workbench/contrib/chat/browser/chatVariables.js";import{ChatWidgetService as Ie}from"../../../../../vs/workbench/contrib/chat/browser/chatWidget.js";import{ChatCodeBlockContextProviderService as we}from"../../../../../vs/workbench/contrib/chat/browser/codeBlockContextProviderService.js";import"../../../../../vs/workbench/contrib/chat/browser/contrib/chatContextAttachments.js";import"../../../../../vs/workbench/contrib/chat/browser/contrib/chatInputCompletions.js";import"../../../../../vs/workbench/contrib/chat/browser/contrib/chatInputEditorContrib.js";import"../../../../../vs/workbench/contrib/chat/browser/contrib/chatInputEditorHover.js";import{ChatAgentLocation as u,ChatAgentNameService as Ee,ChatAgentService as Pe,IChatAgentNameService as Te,IChatAgentService as W}from"../../../../../vs/workbench/contrib/chat/common/chatAgents.js";import{chatVariableLeader as Ae}from"../../../../../vs/workbench/contrib/chat/common/chatParserTypes.js";import{IChatService as De}from"../../../../../vs/workbench/contrib/chat/common/chatService.js";import{ChatService as ze}from"../../../../../vs/workbench/contrib/chat/common/chatServiceImpl.js";import{ChatSlashCommandService as Re,IChatSlashCommandService as M}from"../../../../../vs/workbench/contrib/chat/common/chatSlashCommands.js";import{IChatVariablesService as V}from"../../../../../vs/workbench/contrib/chat/common/chatVariables.js";import{ChatWidgetHistoryService as We,IChatWidgetHistoryService as Me}from"../../../../../vs/workbench/contrib/chat/common/chatWidgetHistoryService.js";import{ILanguageModelsService as Ve,LanguageModelsService as Le}from"../../../../../vs/workbench/contrib/chat/common/languageModels.js";import{ILanguageModelStatsService as $e,LanguageModelStatsService as He}from"../../../../../vs/workbench/contrib/chat/common/languageModelStats.js";import{ILanguageModelToolsService as _e,LanguageModelToolsService as Be}from"../../../../../vs/workbench/contrib/chat/common/languageModelToolsService.js";import{LanguageModelToolsExtensionPointHandler as L}from"../../../../../vs/workbench/contrib/chat/common/tools/languageModelToolsContribution.js";import{IVoiceChatService as Fe,VoiceChatService as Ne}from"../../../../../vs/workbench/contrib/chat/common/voiceChatService.js";import{IEditorResolverService as je,RegisteredEditorPriority as Oe}from"../../../../../vs/workbench/services/editor/common/editorResolverService.js";import{LifecyclePhase as Qe}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";import"../common/chatColors.js";const Ue=y.as(U.Configuration);Ue.registerConfiguration({id:"chatSidebar",title:e.localize("interactiveSessionConfigurationTitle","Chat"),type:"object",properties:{"chat.editor.fontSize":{type:"number",description:e.localize("interactiveSession.editor.fontSize","Controls the font size in pixels in chat codeblocks."),default:O?12:14},"chat.editor.fontFamily":{type:"string",description:e.localize("interactiveSession.editor.fontFamily","Controls the font family in chat codeblocks."),default:"default"},"chat.editor.fontWeight":{type:"string",description:e.localize("interactiveSession.editor.fontWeight","Controls the font weight in chat codeblocks."),default:"default"},"chat.editor.wordWrap":{type:"string",description:e.localize("interactiveSession.editor.wordWrap","Controls whether lines should wrap in chat codeblocks."),default:"off",enum:["on","off"]},"chat.editor.lineHeight":{type:"number",description:e.localize("interactiveSession.editor.lineHeight","Controls the line height in pixels in chat codeblocks. Use 0 to compute the line height from the font size."),default:0},"chat.experimental.implicitContext":{type:"boolean",description:e.localize("chat.experimental.implicitContext","Controls whether a checkbox is shown to allow the user to determine which implicit context is included with a chat participant's prompt."),deprecated:!0,default:!1},"chat.experimental.variables.editor":{type:"boolean",description:e.localize("chat.experimental.variables.editor","Enables variables for editor chat."),default:!0},"chat.experimental.variables.notebook":{type:"boolean",description:e.localize("chat.experimental.variables.notebook","Enables variables for notebook chat."),default:!1},"chat.experimental.variables.terminal":{type:"boolean",description:e.localize("chat.experimental.variables.terminal","Enables variables for terminal chat."),default:!1},"chat.experimental.detectParticipant.enabled":{type:"boolean",description:e.localize("chat.experimental.detectParticipant.enabled","Enables chat participant autodetection for panel chat."),default:null}}}),y.as(z.EditorPane).registerEditorPane(G.create(ue,g.EditorID,e.localize("chat","Chat")),[new q(g)]);let h=class extends P{static ID="workbench.contrib.chatResolver";constructor(n,l){super(),this._register(n.registerEditor(`${T.vscodeChatSesssion}:**/**`,{id:g.EditorID,label:e.localize("chat","Chat"),priority:Oe.builtin},{singlePerResource:!0,canSupportResource:o=>o.scheme===T.vscodeChatSesssion},{createEditorInput:({resource:o,options:a})=>({editor:l.createInstance(g,o,a),options:a})}))}};h=S([m(0,je),m(1,D)],h),A.register(new ke),A.register(new K);let b=class extends P{constructor(n,l,o,a,f){super(),this._store.add(n.registerSlashCommand({command:"clear",detail:e.localize("clear","Start a new chat"),sortText:"z2_clear",executeImmediately:!0,locations:[u.Panel]},async()=>{l.executeCommand(Y)})),this._store.add(n.registerSlashCommand({command:"help",detail:"",sortText:"z1_help",executeImmediately:!0,locations:[u.Panel]},async(x,c)=>{const r=o.getDefaultAgent(u.Panel),$=o.getAgents();r?.metadata.helpTextPrefix&&(I(r.metadata.helpTextPrefix)?c.report({content:r.metadata.helpTextPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPrefix),kind:"markdownContent"}),c.report({content:new d(`

`),kind:"markdownContent"}));const H=(await Promise.all($.filter(s=>s.id!==r?.id).filter(s=>s.locations.includes(u.Panel)).map(async s=>{const v=s.description?`- ${s.description}`:"",_=`- ${f.invokeFunction(C=>ye(s,!0,C))} ${v}`,B=s.slashCommands.map(C=>{const F=C.description?`- ${C.description}`:"";return`	* ${xe(s,C)} ${F}`}).join(`
`);return(_+`
`+B).trim()}))).join(`
`);if(c.report({content:new d(H,{isTrusted:{enabledCommands:[ne.ID]}}),kind:"markdownContent"}),r?.metadata.helpTextVariablesPrefix){c.report({content:new d(`

`),kind:"markdownContent"}),I(r.metadata.helpTextVariablesPrefix)?c.report({content:r.metadata.helpTextVariablesPrefix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextVariablesPrefix),kind:"markdownContent"});const v=[...a.getVariables(u.Panel),{name:"file",description:e.localize("file","Choose a file in the workspace")}].map(k=>`* \`${Ae}${k.name}\` - ${k.description}`).join(`
`);c.report({content:new d(`
`+v),kind:"markdownContent"})}r?.metadata.helpTextPostfix&&(c.report({content:new d(`

`),kind:"markdownContent"}),I(r.metadata.helpTextPostfix)?c.report({content:r.metadata.helpTextPostfix,kind:"markdownContent"}):c.report({content:new d(r.metadata.helpTextPostfix),kind:"markdownContent"}))}))}};b=S([m(0,M),m(1,Q),m(2,W),m(3,V),m(4,D)],b);const qe=y.as(J.Workbench);w(h.ID,h,E.BlockStartup),qe.registerWorkbenchContribution(b,Qe.Eventually),y.as(z.EditorFactory).registerEditorSerializer(g.TypeID,be),w(R.ID,R,E.BlockStartup),w(L.ID,L,E.BlockRestore),X(),oe(),ee(),te(),ce(),de(),ae(),me(),se(),le(),Z(),ie(),re(),i(De,ze,t.Delayed),i(fe,Ie,t.Delayed),i(Ce,ve,t.Delayed),i(pe,ge,t.Delayed),i(Me,We,t.Delayed),i(Ve,Le,t.Delayed),i($e,He,t.Delayed),i(M,Re,t.Delayed),i(W,Pe,t.Delayed),i(Te,Ee,t.Delayed),i(V,Se,t.Delayed),i(_e,Be,t.Delayed),i(Fe,Ne,t.Delayed),i(he,we,t.Delayed);
