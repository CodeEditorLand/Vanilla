{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/actions/chatContextActions.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from \"../../../../../base/common/cancellation.js\";\nimport { Codicon } from \"../../../../../base/common/codicons.js\";\nimport { KeyCode, KeyMod } from \"../../../../../base/common/keyCodes.js\";\nimport { Schemas } from \"../../../../../base/common/network.js\";\nimport { compare } from \"../../../../../base/common/strings.js\";\nimport { ThemeIcon } from \"../../../../../base/common/themables.js\";\nimport { URI } from \"../../../../../base/common/uri.js\";\nimport type { ServicesAccessor } from \"../../../../../editor/browser/editorExtensions.js\";\nimport type { IRange } from \"../../../../../editor/common/core/range.js\";\nimport { EditorType } from \"../../../../../editor/common/editorCommon.js\";\nimport type { Command } from \"../../../../../editor/common/languages.js\";\nimport {\n\tAbstractGotoSymbolQuickAccessProvider,\n\ttype IGotoSymbolQuickPickItem,\n} from \"../../../../../editor/contrib/quickAccess/browser/gotoSymbolQuickAccess.js\";\nimport { localize, localize2 } from \"../../../../../nls.js\";\nimport {\n\tAction2,\n\tMenuId,\n\tregisterAction2,\n} from \"../../../../../platform/actions/common/actions.js\";\nimport { ICommandService } from \"../../../../../platform/commands/common/commands.js\";\nimport { ContextKeyExpr } from \"../../../../../platform/contextkey/common/contextkey.js\";\nimport { KeybindingWeight } from \"../../../../../platform/keybinding/common/keybindingsRegistry.js\";\nimport type { AnythingQuickAccessProviderRunOptions } from \"../../../../../platform/quickinput/common/quickAccess.js\";\nimport {\n\tIQuickInputService,\n\ttype IQuickPickItem,\n\ttype QuickPickItem,\n} from \"../../../../../platform/quickinput/common/quickInput.js\";\nimport { IEditorService } from \"../../../../services/editor/common/editorService.js\";\nimport { AnythingQuickAccessProvider } from \"../../../search/browser/anythingQuickAccess.js\";\nimport {\n\ttype ISymbolQuickPickItem,\n\tSymbolsQuickAccessProvider,\n} from \"../../../search/browser/symbolsQuickAccess.js\";\nimport {\n\tChatAgentLocation,\n\tIChatAgentService,\n} from \"../../common/chatAgents.js\";\nimport {\n\tCONTEXT_CHAT_LOCATION,\n\tCONTEXT_IN_CHAT_INPUT,\n} from \"../../common/chatContextKeys.js\";\nimport type { IChatRequestVariableEntry } from \"../../common/chatModel.js\";\nimport { ChatRequestAgentPart } from \"../../common/chatParserTypes.js\";\nimport { IChatVariablesService } from \"../../common/chatVariables.js\";\nimport { ILanguageModelToolsService } from \"../../common/languageModelToolsService.js\";\nimport {\n\ttype IChatWidget,\n\tIChatWidgetService,\n\tIQuickChatService,\n} from \"../chat.js\";\nimport { isQuickChat } from \"../chatWidget.js\";\nimport { ChatContextAttachments } from \"../contrib/chatContextAttachments.js\";\nimport { CHAT_CATEGORY } from \"./chatActions.js\";\n\nexport function registerChatContextActions() {\n\tregisterAction2(AttachContextAction);\n\tregisterAction2(AttachFileAction);\n\tregisterAction2(AttachSelectionAction);\n}\n\nexport type IChatContextQuickPickItem =\n\t| IFileQuickPickItem\n\t| IDynamicVariableQuickPickItem\n\t| IStaticVariableQuickPickItem\n\t| IGotoSymbolQuickPickItem\n\t| ISymbolQuickPickItem\n\t| IQuickAccessQuickPickItem\n\t| IToolQuickPickItem;\n\nexport interface IFileQuickPickItem extends IQuickPickItem {\n\tkind: \"file\";\n\tid: string;\n\tname: string;\n\tvalue: URI;\n\tisDynamic: true;\n\n\tresource: URI;\n}\n\nexport interface IDynamicVariableQuickPickItem extends IQuickPickItem {\n\tkind: \"dynamic\";\n\tid: string;\n\tname?: string;\n\tvalue: unknown;\n\tisDynamic: true;\n\n\ticon?: ThemeIcon;\n\tcommand?: Command;\n}\n\nexport interface IToolQuickPickItem extends IQuickPickItem {\n\tkind: \"tool\";\n\tid: string;\n\tname?: string;\n\ticon?: ThemeIcon;\n}\n\nexport interface IStaticVariableQuickPickItem extends IQuickPickItem {\n\tkind: \"static\";\n\tid: string;\n\tname: string;\n\tvalue: unknown;\n\tisDynamic?: false;\n\n\ticon?: ThemeIcon;\n}\n\nexport interface IQuickAccessQuickPickItem extends IQuickPickItem {\n\tkind: \"quickaccess\";\n\tid: string;\n\tname: string;\n\tvalue: string;\n\n\tprefix: string;\n}\n\nclass AttachFileAction extends Action2 {\n\tstatic readonly ID = \"workbench.action.chat.attachFile\";\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachFileAction.ID,\n\t\t\ttitle: localize2(\n\t\t\t\t\"workbench.action.chat.attachFile.label\",\n\t\t\t\t\"Attach File\",\n\t\t\t),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: false,\n\t\t});\n\t}\n\n\toverride async run(\n\t\taccessor: ServicesAccessor,\n\t\t...args: any[]\n\t): Promise<void> {\n\t\tconst variablesService = accessor.get(IChatVariablesService);\n\t\tconst textEditorService = accessor.get(IEditorService);\n\n\t\tconst activeUri = textEditorService.activeEditor?.resource;\n\t\tif (\n\t\t\ttextEditorService.activeTextEditorControl?.getEditorType() ===\n\t\t\t\tEditorType.ICodeEditor &&\n\t\t\tactiveUri &&\n\t\t\t[Schemas.file, Schemas.vscodeRemote, Schemas.untitled].includes(\n\t\t\t\tactiveUri.scheme,\n\t\t\t)\n\t\t) {\n\t\t\tvariablesService.attachContext(\n\t\t\t\t\"file\",\n\t\t\t\tactiveUri,\n\t\t\t\tChatAgentLocation.Panel,\n\t\t\t);\n\t\t}\n\t}\n}\n\nclass AttachSelectionAction extends Action2 {\n\tstatic readonly ID = \"workbench.action.chat.attachSelection\";\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachSelectionAction.ID,\n\t\t\ttitle: localize2(\n\t\t\t\t\"workbench.action.chat.attachSelection.label\",\n\t\t\t\t\"Add Selection to Chat\",\n\t\t\t),\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tf1: false,\n\t\t});\n\t}\n\n\toverride async run(\n\t\taccessor: ServicesAccessor,\n\t\t...args: any[]\n\t): Promise<void> {\n\t\tconst variablesService = accessor.get(IChatVariablesService);\n\t\tconst textEditorService = accessor.get(IEditorService);\n\n\t\tconst activeEditor = textEditorService.activeTextEditorControl;\n\t\tconst activeUri = textEditorService.activeEditor?.resource;\n\t\tif (\n\t\t\ttextEditorService.activeTextEditorControl?.getEditorType() ===\n\t\t\t\tEditorType.ICodeEditor &&\n\t\t\tactiveUri &&\n\t\t\t[Schemas.file, Schemas.vscodeRemote, Schemas.untitled].includes(\n\t\t\t\tactiveUri.scheme,\n\t\t\t)\n\t\t) {\n\t\t\tconst selection = activeEditor?.getSelection();\n\t\t\tif (selection) {\n\t\t\t\tvariablesService.attachContext(\n\t\t\t\t\t\"file\",\n\t\t\t\t\t{ uri: activeUri, range: selection },\n\t\t\t\t\tChatAgentLocation.Panel,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t}\n}\n\nclass AttachContextAction extends Action2 {\n\tstatic readonly ID = \"workbench.action.chat.attachContext\";\n\n\t// used to enable/disable the keybinding and defined menu containment\n\tprivate static _cdt = ContextKeyExpr.or(\n\t\tContextKeyExpr.and(\n\t\t\tCONTEXT_CHAT_LOCATION.isEqualTo(ChatAgentLocation.Panel),\n\t\t),\n\t\tContextKeyExpr.and(\n\t\t\tCONTEXT_CHAT_LOCATION.isEqualTo(ChatAgentLocation.Editor),\n\t\t\tContextKeyExpr.equals(\n\t\t\t\t\"config.chat.experimental.variables.editor\",\n\t\t\t\ttrue,\n\t\t\t),\n\t\t),\n\t\tContextKeyExpr.and(\n\t\t\tCONTEXT_CHAT_LOCATION.isEqualTo(ChatAgentLocation.Notebook),\n\t\t\tContextKeyExpr.equals(\n\t\t\t\t\"config.chat.experimental.variables.notebook\",\n\t\t\t\ttrue,\n\t\t\t),\n\t\t),\n\t\tContextKeyExpr.and(\n\t\t\tCONTEXT_CHAT_LOCATION.isEqualTo(ChatAgentLocation.Terminal),\n\t\t\tContextKeyExpr.equals(\n\t\t\t\t\"config.chat.experimental.variables.terminal\",\n\t\t\t\ttrue,\n\t\t\t),\n\t\t),\n\t);\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AttachContextAction.ID,\n\t\t\ttitle: localize2(\n\t\t\t\t\"workbench.action.chat.attachContext.label\",\n\t\t\t\t\"Attach Context\",\n\t\t\t),\n\t\t\ticon: Codicon.attach,\n\t\t\tcategory: CHAT_CATEGORY,\n\t\t\tprecondition: AttachContextAction._cdt,\n\t\t\tkeybinding: {\n\t\t\t\twhen: CONTEXT_IN_CHAT_INPUT,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Slash,\n\t\t\t\tweight: KeybindingWeight.EditorContrib,\n\t\t\t},\n\t\t\tmenu: [\n\t\t\t\t{\n\t\t\t\t\twhen: AttachContextAction._cdt,\n\t\t\t\t\tid: MenuId.ChatExecute,\n\t\t\t\t\tgroup: \"navigation\",\n\t\t\t\t},\n\t\t\t],\n\t\t});\n\t}\n\n\tprivate _getFileContextId(\n\t\titem: { resource: URI } | { uri: URI; range: IRange },\n\t) {\n\t\tif (\"resource\" in item) {\n\t\t\treturn item.resource.toString();\n\t\t}\n\n\t\treturn (\n\t\t\titem.uri.toString() +\n\t\t\t(item.range.startLineNumber !== item.range.endLineNumber\n\t\t\t\t? `:${item.range.startLineNumber}-${item.range.endLineNumber}`\n\t\t\t\t: `:${item.range.startLineNumber}`)\n\t\t);\n\t}\n\n\tprivate async _attachContext(\n\t\twidget: IChatWidget,\n\t\tcommandService: ICommandService,\n\t\t...picks: IChatContextQuickPickItem[]\n\t) {\n\t\tconst toAttach: IChatRequestVariableEntry[] = [];\n\t\tfor (const pick of picks) {\n\t\t\tif (\n\t\t\t\tpick &&\n\t\t\t\ttypeof pick === \"object\" &&\n\t\t\t\t\"command\" in pick &&\n\t\t\t\tpick.command\n\t\t\t) {\n\t\t\t\t// Dynamic variable with a followup command\n\t\t\t\tconst selection = await commandService.executeCommand(\n\t\t\t\t\tpick.command.id,\n\t\t\t\t\t...(pick.command.arguments ?? []),\n\t\t\t\t);\n\t\t\t\tif (!selection) {\n\t\t\t\t\t// User made no selection, skip this variable\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\ttoAttach.push({\n\t\t\t\t\t...pick,\n\t\t\t\t\tisDynamic: pick.isDynamic,\n\t\t\t\t\tvalue: pick.value,\n\t\t\t\t\tname: `${typeof pick.value === \"string\" && pick.value.startsWith(\"#\") ? pick.value.slice(1) : \"\"}${selection}`,\n\t\t\t\t\t// Apply the original icon with the new name\n\t\t\t\t\tfullName: selection,\n\t\t\t\t});\n\t\t\t} else if (\"symbol\" in pick && pick.symbol) {\n\t\t\t\t// Symbol\n\t\t\t\ttoAttach.push({\n\t\t\t\t\t...pick,\n\t\t\t\t\tid: this._getFileContextId(pick.symbol.location),\n\t\t\t\t\tvalue: pick.symbol.location,\n\t\t\t\t\tfullName: pick.label,\n\t\t\t\t\tname: pick.symbol.name,\n\t\t\t\t\tisDynamic: true,\n\t\t\t\t});\n\t\t\t} else if (\n\t\t\t\tpick &&\n\t\t\t\ttypeof pick === \"object\" &&\n\t\t\t\t\"resource\" in pick &&\n\t\t\t\tpick.resource\n\t\t\t) {\n\t\t\t\t// #file variable\n\t\t\t\ttoAttach.push({\n\t\t\t\t\t...pick,\n\t\t\t\t\tid: this._getFileContextId({ resource: pick.resource }),\n\t\t\t\t\tvalue: pick.resource,\n\t\t\t\t\tname: pick.label,\n\t\t\t\t\tisFile: true,\n\t\t\t\t\tisDynamic: true,\n\t\t\t\t});\n\t\t\t} else if (\"symbolName\" in pick && pick.uri && pick.range) {\n\t\t\t\t// Symbol\n\t\t\t\ttoAttach.push({\n\t\t\t\t\t...pick,\n\t\t\t\t\trange: undefined,\n\t\t\t\t\tid: this._getFileContextId({\n\t\t\t\t\t\turi: pick.uri,\n\t\t\t\t\t\trange: pick.range.decoration,\n\t\t\t\t\t}),\n\t\t\t\t\tvalue: { uri: pick.uri, range: pick.range.decoration },\n\t\t\t\t\tfullName: pick.label,\n\t\t\t\t\tname: pick.symbolName!,\n\t\t\t\t\tisDynamic: true,\n\t\t\t\t});\n\t\t\t} else if (\"kind\" in pick && pick.kind === \"tool\") {\n\t\t\t\ttoAttach.push({\n\t\t\t\t\tid: pick.id,\n\t\t\t\t\tname: pick.label,\n\t\t\t\t\tfullName: pick.label,\n\t\t\t\t\tvalue: undefined,\n\t\t\t\t\ticon: pick.icon,\n\t\t\t\t\tisTool: true,\n\t\t\t\t});\n\t\t\t} else {\n\t\t\t\t// All other dynamic variables and static variables\n\t\t\t\ttoAttach.push({\n\t\t\t\t\t...pick,\n\t\t\t\t\trange: undefined,\n\t\t\t\t\tid: pick.id ?? \"\",\n\t\t\t\t\tvalue: \"value\" in pick ? pick.value : undefined,\n\t\t\t\t\tfullName: pick.label,\n\t\t\t\t\tname:\n\t\t\t\t\t\t\"name\" in pick && typeof pick.name === \"string\"\n\t\t\t\t\t\t\t? pick.name\n\t\t\t\t\t\t\t: pick.label,\n\t\t\t\t\ticon:\n\t\t\t\t\t\t\"icon\" in pick && ThemeIcon.isThemeIcon(pick.icon)\n\t\t\t\t\t\t\t? pick.icon\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\twidget\n\t\t\t.getContrib<ChatContextAttachments>(ChatContextAttachments.ID)\n\t\t\t?.setContext(false, ...toAttach);\n\t}\n\n\toverride async run(\n\t\taccessor: ServicesAccessor,\n\t\t...args: any[]\n\t): Promise<void> {\n\t\tconst quickInputService = accessor.get(IQuickInputService);\n\t\tconst chatAgentService = accessor.get(IChatAgentService);\n\t\tconst chatVariablesService = accessor.get(IChatVariablesService);\n\t\tconst commandService = accessor.get(ICommandService);\n\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\tconst languageModelToolsService = accessor.get(\n\t\t\tILanguageModelToolsService,\n\t\t);\n\t\tconst quickChatService = accessor.get(IQuickChatService);\n\t\tconst context: { widget?: IChatWidget } | undefined = args[0];\n\t\tconst widget = context?.widget ?? widgetService.lastFocusedWidget;\n\t\tif (!widget) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst usedAgent = widget.parsedInput.parts.find(\n\t\t\t(p) => p instanceof ChatRequestAgentPart,\n\t\t);\n\t\tconst slowSupported = usedAgent\n\t\t\t? usedAgent.agent.metadata.supportsSlowVariables\n\t\t\t: true;\n\t\tconst quickPickItems: (IChatContextQuickPickItem | QuickPickItem)[] =\n\t\t\t[];\n\t\tfor (const variable of chatVariablesService.getVariables(\n\t\t\twidget.location,\n\t\t)) {\n\t\t\tif (variable.fullName && (!variable.isSlow || slowSupported)) {\n\t\t\t\tquickPickItems.push({\n\t\t\t\t\tlabel: variable.fullName,\n\t\t\t\t\tname: variable.name,\n\t\t\t\t\tid: variable.id,\n\t\t\t\t\ticonClass: variable.icon\n\t\t\t\t\t\t? ThemeIcon.asClassName(variable.icon)\n\t\t\t\t\t\t: undefined,\n\t\t\t\t\ticon: variable.icon,\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\n\t\tif (widget.viewModel?.sessionId) {\n\t\t\tconst agentPart = widget.parsedInput.parts.find(\n\t\t\t\t(part): part is ChatRequestAgentPart =>\n\t\t\t\t\tpart instanceof ChatRequestAgentPart,\n\t\t\t);\n\t\t\tif (agentPart) {\n\t\t\t\tconst completions =\n\t\t\t\t\tawait chatAgentService.getAgentCompletionItems(\n\t\t\t\t\t\tagentPart.agent.id,\n\t\t\t\t\t\t\"\",\n\t\t\t\t\t\tCancellationToken.None,\n\t\t\t\t\t);\n\t\t\t\tfor (const variable of completions) {\n\t\t\t\t\tif (variable.fullName) {\n\t\t\t\t\t\tquickPickItems.push({\n\t\t\t\t\t\t\tlabel: variable.fullName,\n\t\t\t\t\t\t\tid: variable.id,\n\t\t\t\t\t\t\tcommand: variable.command,\n\t\t\t\t\t\t\ticon: variable.icon,\n\t\t\t\t\t\t\ticonClass: variable.icon\n\t\t\t\t\t\t\t\t? ThemeIcon.asClassName(variable.icon)\n\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\tvalue: variable.value,\n\t\t\t\t\t\t\tisDynamic: true,\n\t\t\t\t\t\t\tname: variable.name,\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tif (!usedAgent || usedAgent.agent.supportsToolReferences) {\n\t\t\tfor (const tool of languageModelToolsService.getTools()) {\n\t\t\t\tif (tool.canBeInvokedManually) {\n\t\t\t\t\tconst item: IToolQuickPickItem = {\n\t\t\t\t\t\tkind: \"tool\",\n\t\t\t\t\t\tlabel: tool.displayName ?? tool.name ?? \"\",\n\t\t\t\t\t\tid: tool.id,\n\t\t\t\t\t\ticon: ThemeIcon.isThemeIcon(tool.icon)\n\t\t\t\t\t\t\t? tool.icon\n\t\t\t\t\t\t\t: undefined, // TODO need to support icon path?\n\t\t\t\t\t};\n\t\t\t\t\tif (ThemeIcon.isThemeIcon(tool.icon)) {\n\t\t\t\t\t\titem.iconClass = ThemeIcon.asClassName(tool.icon);\n\t\t\t\t\t} else if (tool.icon) {\n\t\t\t\t\t\titem.iconPath = tool.icon;\n\t\t\t\t\t}\n\n\t\t\t\t\tquickPickItems.push(item);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tquickPickItems.push({\n\t\t\tlabel: localize(\"chatContext.symbol\", \"Symbol...\"),\n\t\t\ticon: ThemeIcon.fromId(Codicon.symbolField.id),\n\t\t\ticonClass: ThemeIcon.asClassName(Codicon.symbolField),\n\t\t\tprefix: SymbolsQuickAccessProvider.PREFIX,\n\t\t});\n\n\t\tfunction extractTextFromIconLabel(label: string | undefined): string {\n\t\t\tif (!label) {\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t\tconst match = label.match(/\\$\\([^)]+\\)\\s*(.+)/);\n\t\t\treturn match ? match[1] : label;\n\t\t}\n\n\t\tthis._show(\n\t\t\tquickInputService,\n\t\t\tcommandService,\n\t\t\twidget,\n\t\t\tquickChatService,\n\t\t\tquickPickItems.sort((a, b) => {\n\t\t\t\tconst first = extractTextFromIconLabel(a.label).toUpperCase();\n\t\t\t\tconst second = extractTextFromIconLabel(b.label).toUpperCase();\n\n\t\t\t\treturn compare(first, second);\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate _show(\n\t\tquickInputService: IQuickInputService,\n\t\tcommandService: ICommandService,\n\t\twidget: IChatWidget,\n\t\tquickChatService: IQuickChatService,\n\t\tquickPickItems: (IChatContextQuickPickItem | QuickPickItem)[],\n\t\tquery = \"\",\n\t) {\n\t\tquickInputService.quickAccess.show(query, {\n\t\t\tenabledProviderPrefixes: [\n\t\t\t\tAnythingQuickAccessProvider.PREFIX,\n\t\t\t\tSymbolsQuickAccessProvider.PREFIX,\n\t\t\t\tAbstractGotoSymbolQuickAccessProvider.PREFIX,\n\t\t\t],\n\t\t\tplaceholder: localize(\n\t\t\t\t\"chatContext.attach.placeholder\",\n\t\t\t\t\"Search attachments\",\n\t\t\t),\n\t\t\tproviderOptions: <AnythingQuickAccessProviderRunOptions>{\n\t\t\t\thandleAccept: (item: IChatContextQuickPickItem) => {\n\t\t\t\t\tif (\"prefix\" in item) {\n\t\t\t\t\t\tthis._show(\n\t\t\t\t\t\t\tquickInputService,\n\t\t\t\t\t\t\tcommandService,\n\t\t\t\t\t\t\twidget,\n\t\t\t\t\t\t\tquickChatService,\n\t\t\t\t\t\t\tquickPickItems,\n\t\t\t\t\t\t\titem.prefix,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis._attachContext(widget, commandService, item);\n\t\t\t\t\t\tif (isQuickChat(widget)) {\n\t\t\t\t\t\t\tquickChatService.open();\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tadditionPicks: quickPickItems,\n\t\t\t\tfilter: (item: IChatContextQuickPickItem) => {\n\t\t\t\t\t// Avoid attaching the same context twice\n\t\t\t\t\tconst attachedContext =\n\t\t\t\t\t\twidget\n\t\t\t\t\t\t\t.getContrib<ChatContextAttachments>(\n\t\t\t\t\t\t\t\tChatContextAttachments.ID,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t?.getContext() ?? new Set();\n\n\t\t\t\t\tif (\"symbol\" in item && item.symbol) {\n\t\t\t\t\t\treturn !attachedContext.has(\n\t\t\t\t\t\t\tthis._getFileContextId(item.symbol.location),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\titem &&\n\t\t\t\t\t\ttypeof item === \"object\" &&\n\t\t\t\t\t\t\"resource\" in item &&\n\t\t\t\t\t\tURI.isUri(item.resource)\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t[Schemas.file, Schemas.vscodeRemote].includes(\n\t\t\t\t\t\t\t\titem.resource.scheme,\n\t\t\t\t\t\t\t) &&\n\t\t\t\t\t\t\t!attachedContext.has(\n\t\t\t\t\t\t\t\tthis._getFileContextId({\n\t\t\t\t\t\t\t\t\tresource: item.resource,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t); // Hack because Typescript doesn't narrow this type correctly\n\t\t\t\t\t}\n\n\t\t\t\t\tif (\n\t\t\t\t\t\titem &&\n\t\t\t\t\t\ttypeof item === \"object\" &&\n\t\t\t\t\t\t\"uri\" in item &&\n\t\t\t\t\t\titem.uri &&\n\t\t\t\t\t\titem.range\n\t\t\t\t\t) {\n\t\t\t\t\t\treturn !attachedContext.has(\n\t\t\t\t\t\t\tthis._getFileContextId({\n\t\t\t\t\t\t\t\turi: item.uri,\n\t\t\t\t\t\t\t\trange: item.range.decoration,\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\n\t\t\t\t\tif (!(\"command\" in item) && item.id) {\n\t\t\t\t\t\treturn !attachedContext.has(item.id);\n\t\t\t\t\t}\n\n\t\t\t\t\t// Don't filter out dynamic variables which show secondary data (temporary)\n\t\t\t\t\treturn true;\n\t\t\t\t},\n\t\t\t},\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
