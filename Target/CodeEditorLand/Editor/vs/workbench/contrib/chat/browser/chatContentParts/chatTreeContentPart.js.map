{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/chatContentParts/chatTreeContentPart.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport * as dom from \"../../../../../base/browser/dom.js\";\nimport type { IListVirtualDelegate } from \"../../../../../base/browser/ui/list/list.js\";\nimport type { ITreeCompressionDelegate } from \"../../../../../base/browser/ui/tree/asyncDataTree.js\";\nimport type { ICompressedTreeNode } from \"../../../../../base/browser/ui/tree/compressedObjectTreeModel.js\";\nimport type { ICompressibleTreeRenderer } from \"../../../../../base/browser/ui/tree/objectTree.js\";\nimport type {\n\tIAsyncDataSource,\n\tITreeNode,\n} from \"../../../../../base/browser/ui/tree/tree.js\";\nimport { Emitter, type Event } from \"../../../../../base/common/event.js\";\nimport {\n\tDisposable,\n\tDisposableStore,\n\ttype IDisposable,\n} from \"../../../../../base/common/lifecycle.js\";\nimport { localize } from \"../../../../../nls.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport {\n\tFileKind,\n\tFileType,\n} from \"../../../../../platform/files/common/files.js\";\nimport { IInstantiationService } from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { WorkbenchCompressibleAsyncDataTree } from \"../../../../../platform/list/browser/listService.js\";\nimport { IOpenerService } from \"../../../../../platform/opener/common/opener.js\";\nimport { IThemeService } from \"../../../../../platform/theme/common/themeService.js\";\nimport {\n\ttype IResourceLabel,\n\tResourceLabels,\n} from \"../../../../browser/labels.js\";\nimport { createFileIconThemableTreeContainerScope } from \"../../../files/browser/views/explorerView.js\";\nimport type { IFilesConfiguration } from \"../../../files/common/files.js\";\nimport type { IChatProgressRenderableResponseContent } from \"../../common/chatModel.js\";\nimport type { IChatResponseProgressFileTreeData } from \"../../common/chatService.js\";\nimport type { ChatTreeItem } from \"../chat.js\";\nimport { type IDisposableReference, ResourcePool } from \"./chatCollections.js\";\nimport type { IChatContentPart } from \"./chatContentParts.js\";\n\nconst $ = dom.$;\n\nexport class ChatTreeContentPart\n\textends Disposable\n\timplements IChatContentPart\n{\n\tpublic readonly domNode: HTMLElement;\n\n\tprivate readonly _onDidChangeHeight = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeHeight = this._onDidChangeHeight.event;\n\n\tpublic readonly onDidFocus: Event<void>;\n\n\tprivate tree: WorkbenchCompressibleAsyncDataTree<\n\t\tIChatResponseProgressFileTreeData,\n\t\tIChatResponseProgressFileTreeData,\n\t\tvoid\n\t>;\n\n\tconstructor(\n\t\tdata: IChatResponseProgressFileTreeData,\n\t\telement: ChatTreeItem,\n\t\ttreePool: TreePool,\n\t\ttreeDataIndex: number,\n\t\t@IOpenerService private readonly openerService: IOpenerService,\n\t) {\n\t\tsuper();\n\n\t\tconst ref = this._register(treePool.get());\n\t\tthis.tree = ref.object;\n\t\tthis.onDidFocus = this.tree.onDidFocus;\n\n\t\tthis._register(\n\t\t\tthis.tree.onDidOpen((e) => {\n\t\t\t\tif (e.element && !(\"children\" in e.element)) {\n\t\t\t\t\tthis.openerService.open(e.element.uri);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthis.tree.onDidChangeCollapseState(() => {\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}),\n\t\t);\n\t\tthis._register(\n\t\t\tthis.tree.onContextMenu((e) => {\n\t\t\t\te.browserEvent.preventDefault();\n\t\t\t\te.browserEvent.stopPropagation();\n\t\t\t}),\n\t\t);\n\n\t\tthis.tree.setInput(data).then(() => {\n\t\t\tif (!ref.isStale()) {\n\t\t\t\tthis.tree.layout();\n\t\t\t\tthis._onDidChangeHeight.fire();\n\t\t\t}\n\t\t});\n\n\t\tthis.domNode = this.tree.getHTMLElement().parentElement!;\n\t}\n\n\tdomFocus() {\n\t\tthis.tree.domFocus();\n\t}\n\n\thasSameContent(other: IChatProgressRenderableResponseContent): boolean {\n\t\t// No other change allowed for this content type\n\t\treturn other.kind === \"treeData\";\n\t}\n\n\taddDisposable(disposable: IDisposable): void {\n\t\tthis._register(disposable);\n\t}\n}\n\nexport class TreePool extends Disposable {\n\tprivate _pool: ResourcePool<\n\t\tWorkbenchCompressibleAsyncDataTree<\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tvoid\n\t\t>\n\t>;\n\n\tpublic get inUse(): ReadonlySet<\n\t\tWorkbenchCompressibleAsyncDataTree<\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tvoid\n\t\t>\n\t> {\n\t\treturn this._pool.inUse;\n\t}\n\n\tconstructor(\n\t\tprivate _onDidChangeVisibility: Event<boolean>,\n\t\t@IInstantiationService\n\t\tprivate readonly instantiationService: IInstantiationService,\n\t\t@IConfigurationService\n\t\tprivate readonly configService: IConfigurationService,\n\t\t@IThemeService private readonly themeService: IThemeService,\n\t) {\n\t\tsuper();\n\t\tthis._pool = this._register(new ResourcePool(() => this.treeFactory()));\n\t}\n\n\tprivate treeFactory(): WorkbenchCompressibleAsyncDataTree<\n\t\tIChatResponseProgressFileTreeData,\n\t\tIChatResponseProgressFileTreeData,\n\t\tvoid\n\t> {\n\t\tconst resourceLabels = this._register(\n\t\t\tthis.instantiationService.createInstance(ResourceLabels, {\n\t\t\t\tonDidChangeVisibility: this._onDidChangeVisibility,\n\t\t\t}),\n\t\t);\n\n\t\tconst container = $(\".interactive-response-progress-tree\");\n\t\tthis._register(\n\t\t\tcreateFileIconThemableTreeContainerScope(\n\t\t\t\tcontainer,\n\t\t\t\tthis.themeService,\n\t\t\t),\n\t\t);\n\n\t\tconst tree = this.instantiationService.createInstance(\n\t\t\tWorkbenchCompressibleAsyncDataTree<\n\t\t\t\tIChatResponseProgressFileTreeData,\n\t\t\t\tIChatResponseProgressFileTreeData\n\t\t\t>,\n\t\t\t\"ChatListRenderer\",\n\t\t\tcontainer,\n\t\t\tnew ChatListTreeDelegate(),\n\t\t\tnew ChatListTreeCompressionDelegate(),\n\t\t\t[\n\t\t\t\tnew ChatListTreeRenderer(\n\t\t\t\t\tresourceLabels,\n\t\t\t\t\tthis.configService.getValue(\"explorer.decorations\"),\n\t\t\t\t),\n\t\t\t],\n\t\t\tnew ChatListTreeDataSource(),\n\t\t\t{\n\t\t\t\tcollapseByDefault: () => false,\n\t\t\t\texpandOnlyOnTwistieClick: () => false,\n\t\t\t\tidentityProvider: {\n\t\t\t\t\tgetId: (e: IChatResponseProgressFileTreeData) =>\n\t\t\t\t\t\te.uri.toString(),\n\t\t\t\t},\n\t\t\t\taccessibilityProvider: {\n\t\t\t\t\tgetAriaLabel: (\n\t\t\t\t\t\telement: IChatResponseProgressFileTreeData,\n\t\t\t\t\t) => element.label,\n\t\t\t\t\tgetWidgetAriaLabel: () =>\n\t\t\t\t\t\tlocalize(\"treeAriaLabel\", \"File Tree\"),\n\t\t\t\t},\n\t\t\t\talwaysConsumeMouseWheel: false,\n\t\t\t},\n\t\t);\n\n\t\treturn tree;\n\t}\n\n\tget(): IDisposableReference<\n\t\tWorkbenchCompressibleAsyncDataTree<\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tvoid\n\t\t>\n\t> {\n\t\tconst object = this._pool.get();\n\t\tlet stale = false;\n\t\treturn {\n\t\t\tobject,\n\t\t\tisStale: () => stale,\n\t\t\tdispose: () => {\n\t\t\t\tstale = true;\n\t\t\t\tthis._pool.release(object);\n\t\t\t},\n\t\t};\n\t}\n}\n\nclass ChatListTreeDelegate\n\timplements IListVirtualDelegate<IChatResponseProgressFileTreeData>\n{\n\tstatic readonly ITEM_HEIGHT = 22;\n\n\tgetHeight(element: IChatResponseProgressFileTreeData): number {\n\t\treturn ChatListTreeDelegate.ITEM_HEIGHT;\n\t}\n\n\tgetTemplateId(element: IChatResponseProgressFileTreeData): string {\n\t\treturn \"chatListTreeTemplate\";\n\t}\n}\n\nclass ChatListTreeCompressionDelegate\n\timplements ITreeCompressionDelegate<IChatResponseProgressFileTreeData>\n{\n\tisIncompressible(element: IChatResponseProgressFileTreeData): boolean {\n\t\treturn !element.children;\n\t}\n}\n\ninterface IChatListTreeRendererTemplate {\n\ttemplateDisposables: DisposableStore;\n\tlabel: IResourceLabel;\n}\n\nclass ChatListTreeRenderer\n\timplements\n\t\tICompressibleTreeRenderer<\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tvoid,\n\t\t\tIChatListTreeRendererTemplate\n\t\t>\n{\n\ttemplateId = \"chatListTreeTemplate\";\n\n\tconstructor(\n\t\tprivate labels: ResourceLabels,\n\t\tprivate decorations: IFilesConfiguration[\"explorer\"][\"decorations\"],\n\t) {}\n\n\trenderCompressedElements(\n\t\telement: ITreeNode<\n\t\t\tICompressedTreeNode<IChatResponseProgressFileTreeData>,\n\t\t\tvoid\n\t\t>,\n\t\tindex: number,\n\t\ttemplateData: IChatListTreeRendererTemplate,\n\t\theight: number | undefined,\n\t): void {\n\t\ttemplateData.label.element.style.display = \"flex\";\n\t\tconst label = element.element.elements.map((e) => e.label);\n\t\ttemplateData.label.setResource(\n\t\t\t{ resource: element.element.elements[0].uri, name: label },\n\t\t\t{\n\t\t\t\ttitle: element.element.elements[0].label,\n\t\t\t\tfileKind: element.children ? FileKind.FOLDER : FileKind.FILE,\n\t\t\t\textraClasses: [\"explorer-item\"],\n\t\t\t\tfileDecorations: this.decorations,\n\t\t\t},\n\t\t);\n\t}\n\trenderTemplate(container: HTMLElement): IChatListTreeRendererTemplate {\n\t\tconst templateDisposables = new DisposableStore();\n\t\tconst label = templateDisposables.add(\n\t\t\tthis.labels.create(container, { supportHighlights: true }),\n\t\t);\n\t\treturn { templateDisposables, label };\n\t}\n\trenderElement(\n\t\telement: ITreeNode<IChatResponseProgressFileTreeData, void>,\n\t\tindex: number,\n\t\ttemplateData: IChatListTreeRendererTemplate,\n\t\theight: number | undefined,\n\t): void {\n\t\ttemplateData.label.element.style.display = \"flex\";\n\t\tif (\n\t\t\t!element.children.length &&\n\t\t\telement.element.type !== FileType.Directory\n\t\t) {\n\t\t\ttemplateData.label.setFile(element.element.uri, {\n\t\t\t\tfileKind: FileKind.FILE,\n\t\t\t\thidePath: true,\n\t\t\t\tfileDecorations: this.decorations,\n\t\t\t});\n\t\t} else {\n\t\t\ttemplateData.label.setResource(\n\t\t\t\t{ resource: element.element.uri, name: element.element.label },\n\t\t\t\t{\n\t\t\t\t\ttitle: element.element.label,\n\t\t\t\t\tfileKind: FileKind.FOLDER,\n\t\t\t\t\tfileDecorations: this.decorations,\n\t\t\t\t},\n\t\t\t);\n\t\t}\n\t}\n\tdisposeTemplate(templateData: IChatListTreeRendererTemplate): void {\n\t\ttemplateData.templateDisposables.dispose();\n\t}\n}\n\nclass ChatListTreeDataSource\n\timplements\n\t\tIAsyncDataSource<\n\t\t\tIChatResponseProgressFileTreeData,\n\t\t\tIChatResponseProgressFileTreeData\n\t\t>\n{\n\thasChildren(element: IChatResponseProgressFileTreeData): boolean {\n\t\treturn !!element.children;\n\t}\n\n\tasync getChildren(\n\t\telement: IChatResponseProgressFileTreeData,\n\t): Promise<Iterable<IChatResponseProgressFileTreeData>> {\n\t\treturn element.children ?? [];\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
