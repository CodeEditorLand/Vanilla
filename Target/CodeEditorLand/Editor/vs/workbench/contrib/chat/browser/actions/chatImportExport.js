import{VSBuffer as x}from"../../../../../base/common/buffer.js";import{joinPath as l}from"../../../../../base/common/resources.js";import{localize as A,localize2 as p}from"../../../../../nls.js";import{Action2 as f,registerAction2 as m}from"../../../../../platform/actions/common/actions.js";import{IFileDialogService as d}from"../../../../../platform/dialogs/common/dialogs.js";import{IFileService as h}from"../../../../../platform/files/common/files.js";import{IEditorService as I}from"../../../../services/editor/common/editorService.js";import{CONTEXT_CHAT_ENABLED as g}from"../../common/chatContextKeys.js";import{isExportableSessionData as y}from"../../common/chatModel.js";import{IChatService as F}from"../../common/chatService.js";import{IChatWidgetService as b}from"../chat.js";import{ChatEditorInput as D}from"../chatEditorInput.js";import{CHAT_CATEGORY as u}from"./chatActions.js";const S="chat.json",w=[{name:A("chat.file.label","Chat Session"),extensions:["json"]}];function L(){m(class extends f{constructor(){super({id:"workbench.action.chat.export",category:u,title:p("chat.export.label","Export Chat..."),precondition:g,f1:!0})}async run(t,...E){const r=t.get(b),i=t.get(d),a=t.get(h),c=t.get(F),o=r.lastFocusedWidget;if(!o||!o.viewModel)return;const s=l(await i.defaultFilePath(),S),e=await i.showSaveDialog({defaultUri:s,filters:w});if(!e)return;const n=c.getSession(o.viewModel.sessionId);if(!n)return;const C=x.fromString(JSON.stringify(n.toExport(),void 0,2));await a.writeFile(e,C)}}),m(class extends f{constructor(){super({id:"workbench.action.chat.import",title:p("chat.import.label","Import Chat..."),category:u,precondition:g,f1:!0})}async run(t,...E){const r=t.get(d),i=t.get(h),a=t.get(I),c=l(await r.defaultFilePath(),S),o=await r.showOpenDialog({defaultUri:c,canSelectFiles:!0,filters:w});if(!o)return;const s=await i.readFile(o[0]);try{const e=JSON.parse(s.value.toString());if(!y(e))throw new Error("Invalid chat session data");const n={target:{data:e},pinned:!0};await a.openEditor({resource:D.getNewEditorUri(),options:n})}catch(e){throw e}}})}export{L as registerChatExportActions};
