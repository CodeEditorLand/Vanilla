import{VSBuffer as A}from"../../../../../base/common/buffer.js";import{joinPath as l}from"../../../../../base/common/resources.js";import"../../../../../editor/browser/editorExtensions.js";import{localize as I,localize2 as f}from"../../../../../nls.js";import{Action2 as p,registerAction2 as m}from"../../../../../platform/actions/common/actions.js";import{IFileDialogService as d}from"../../../../../platform/dialogs/common/dialogs.js";import{IFileService as h}from"../../../../../platform/files/common/files.js";import{IEditorService as x}from"../../../../services/editor/common/editorService.js";import{CONTEXT_CHAT_ENABLED as g}from"../../common/chatContextKeys.js";import{isExportableSessionData as F}from"../../common/chatModel.js";import{IChatService as y}from"../../common/chatService.js";import{IChatWidgetService as D}from"../chat.js";import"../chatEditor.js";import{ChatEditorInput as O}from"../chatEditorInput.js";import{CHAT_CATEGORY as u}from"./chatActions.js";const S="chat.json",v=[{name:I("chat.file.label","Chat Session"),extensions:["json"]}];function Y(){m(class extends p{constructor(){super({id:"workbench.action.chat.export",category:u,title:f("chat.export.label","Export Chat..."),precondition:g,f1:!0})}async run(t,...E){const r=t.get(D),i=t.get(d),a=t.get(h),c=t.get(y),o=r.lastFocusedWidget;if(!o||!o.viewModel)return;const s=l(await i.defaultFilePath(),S),e=await i.showSaveDialog({defaultUri:s,filters:v});if(!e)return;const n=c.getSession(o.viewModel.sessionId);if(!n)return;const C=A.fromString(JSON.stringify(n.toExport(),void 0,2));await a.writeFile(e,C)}}),m(class extends p{constructor(){super({id:"workbench.action.chat.import",title:f("chat.import.label","Import Chat..."),category:u,precondition:g,f1:!0})}async run(t,...E){const r=t.get(d),i=t.get(h),a=t.get(x),c=l(await r.defaultFilePath(),S),o=await r.showOpenDialog({defaultUri:c,canSelectFiles:!0,filters:v});if(!o)return;const s=await i.readFile(o[0]);try{const e=JSON.parse(s.value.toString());if(!F(e))throw new Error("Invalid chat session data");const n={target:{data:e},pinned:!0};await a.openEditor({resource:O.getNewEditorUri(),options:n})}catch(e){throw e}}})}export{Y as registerChatExportActions};
