{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/actions/chatImportExport.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer } from \"../../../../../base/common/buffer.js\";\nimport { joinPath } from \"../../../../../base/common/resources.js\";\nimport type { ServicesAccessor } from \"../../../../../editor/browser/editorExtensions.js\";\nimport { localize, localize2 } from \"../../../../../nls.js\";\nimport {\n\tAction2,\n\tregisterAction2,\n} from \"../../../../../platform/actions/common/actions.js\";\nimport { IFileDialogService } from \"../../../../../platform/dialogs/common/dialogs.js\";\nimport { IFileService } from \"../../../../../platform/files/common/files.js\";\nimport { IEditorService } from \"../../../../services/editor/common/editorService.js\";\nimport { CONTEXT_CHAT_ENABLED } from \"../../common/chatContextKeys.js\";\nimport { isExportableSessionData } from \"../../common/chatModel.js\";\nimport { IChatService } from \"../../common/chatService.js\";\nimport { IChatWidgetService } from \"../chat.js\";\nimport type { IChatEditorOptions } from \"../chatEditor.js\";\nimport { ChatEditorInput } from \"../chatEditorInput.js\";\nimport { CHAT_CATEGORY } from \"./chatActions.js\";\n\nconst defaultFileName = \"chat.json\";\nconst filters = [\n\t{ name: localize(\"chat.file.label\", \"Chat Session\"), extensions: [\"json\"] },\n];\n\nexport function registerChatExportActions() {\n\tregisterAction2(\n\t\tclass ExportChatAction extends Action2 {\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: \"workbench.action.chat.export\",\n\t\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\t\ttitle: localize2(\"chat.export.label\", \"Export Chat...\"),\n\t\t\t\t\tprecondition: CONTEXT_CHAT_ENABLED,\n\t\t\t\t\tf1: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tasync run(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\t\tconst widgetService = accessor.get(IChatWidgetService);\n\t\t\t\tconst fileDialogService = accessor.get(IFileDialogService);\n\t\t\t\tconst fileService = accessor.get(IFileService);\n\t\t\t\tconst chatService = accessor.get(IChatService);\n\n\t\t\t\tconst widget = widgetService.lastFocusedWidget;\n\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst defaultUri = joinPath(\n\t\t\t\t\tawait fileDialogService.defaultFilePath(),\n\t\t\t\t\tdefaultFileName,\n\t\t\t\t);\n\t\t\t\tconst result = await fileDialogService.showSaveDialog({\n\t\t\t\t\tdefaultUri,\n\t\t\t\t\tfilters,\n\t\t\t\t});\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst model = chatService.getSession(\n\t\t\t\t\twidget.viewModel.sessionId,\n\t\t\t\t);\n\t\t\t\tif (!model) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\t// Using toJSON on the model\n\t\t\t\tconst content = VSBuffer.fromString(\n\t\t\t\t\tJSON.stringify(model.toExport(), undefined, 2),\n\t\t\t\t);\n\t\t\t\tawait fileService.writeFile(result, content);\n\t\t\t}\n\t\t},\n\t);\n\n\tregisterAction2(\n\t\tclass ImportChatAction extends Action2 {\n\t\t\tconstructor() {\n\t\t\t\tsuper({\n\t\t\t\t\tid: \"workbench.action.chat.import\",\n\t\t\t\t\ttitle: localize2(\"chat.import.label\", \"Import Chat...\"),\n\t\t\t\t\tcategory: CHAT_CATEGORY,\n\t\t\t\t\tprecondition: CONTEXT_CHAT_ENABLED,\n\t\t\t\t\tf1: true,\n\t\t\t\t});\n\t\t\t}\n\t\t\tasync run(accessor: ServicesAccessor, ...args: any[]) {\n\t\t\t\tconst fileDialogService = accessor.get(IFileDialogService);\n\t\t\t\tconst fileService = accessor.get(IFileService);\n\t\t\t\tconst editorService = accessor.get(IEditorService);\n\n\t\t\t\tconst defaultUri = joinPath(\n\t\t\t\t\tawait fileDialogService.defaultFilePath(),\n\t\t\t\t\tdefaultFileName,\n\t\t\t\t);\n\t\t\t\tconst result = await fileDialogService.showOpenDialog({\n\t\t\t\t\tdefaultUri,\n\t\t\t\t\tcanSelectFiles: true,\n\t\t\t\t\tfilters,\n\t\t\t\t});\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\n\t\t\t\tconst content = await fileService.readFile(result[0]);\n\t\t\t\ttry {\n\t\t\t\t\tconst data = JSON.parse(content.value.toString());\n\t\t\t\t\tif (!isExportableSessionData(data)) {\n\t\t\t\t\t\tthrow new Error(\"Invalid chat session data\");\n\t\t\t\t\t}\n\n\t\t\t\t\tconst options: IChatEditorOptions = {\n\t\t\t\t\t\ttarget: { data },\n\t\t\t\t\t\tpinned: true,\n\t\t\t\t\t};\n\t\t\t\t\tawait editorService.openEditor({\n\t\t\t\t\t\tresource: ChatEditorInput.getNewEditorUri(),\n\t\t\t\t\t\toptions,\n\t\t\t\t\t});\n\t\t\t\t} catch (err) {\n\t\t\t\t\tthrow err;\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t);\n}\n"],
  "mappings": "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",
  "names": []
}
