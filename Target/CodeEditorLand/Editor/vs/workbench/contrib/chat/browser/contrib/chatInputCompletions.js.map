{
  "version": 3,
  "sources": ["../../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/contrib/chat/browser/contrib/chatInputCompletions.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { CancellationToken } from \"../../../../../base/common/cancellation.js\";\nimport { isPatternInWord } from \"../../../../../base/common/filters.js\";\nimport { Disposable } from \"../../../../../base/common/lifecycle.js\";\nimport { ResourceSet } from \"../../../../../base/common/map.js\";\nimport type { URI } from \"../../../../../base/common/uri.js\";\nimport { generateUuid } from \"../../../../../base/common/uuid.js\";\nimport type { Position } from \"../../../../../editor/common/core/position.js\";\nimport { Range } from \"../../../../../editor/common/core/range.js\";\nimport {\n\ttype IWordAtPosition,\n\tgetWordAtText,\n} from \"../../../../../editor/common/core/wordHelper.js\";\nimport {\n\ttype CompletionContext,\n\ttype CompletionItem,\n\tCompletionItemKind,\n\ttype CompletionList,\n} from \"../../../../../editor/common/languages.js\";\nimport type { ITextModel } from \"../../../../../editor/common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../../../editor/common/services/languageFeatures.js\";\nimport { localize } from \"../../../../../nls.js\";\nimport {\n\tAction2,\n\tregisterAction2,\n} from \"../../../../../platform/actions/common/actions.js\";\nimport { CommandsRegistry } from \"../../../../../platform/commands/common/commands.js\";\nimport { IConfigurationService } from \"../../../../../platform/configuration/common/configuration.js\";\nimport {\n\tIInstantiationService,\n\ttype ServicesAccessor,\n} from \"../../../../../platform/instantiation/common/instantiation.js\";\nimport { ILabelService } from \"../../../../../platform/label/common/label.js\";\nimport { Registry } from \"../../../../../platform/registry/common/platform.js\";\nimport { IWorkspaceContextService } from \"../../../../../platform/workspace/common/workspace.js\";\nimport {\n\ttype IWorkbenchContributionsRegistry,\n\tExtensions as WorkbenchExtensions,\n} from \"../../../../common/contributions.js\";\nimport { IHistoryService } from \"../../../../services/history/common/history.js\";\nimport { LifecyclePhase } from \"../../../../services/lifecycle/common/lifecycle.js\";\nimport { QueryBuilder } from \"../../../../services/search/common/queryBuilder.js\";\nimport { ISearchService } from \"../../../../services/search/common/search.js\";\nimport {\n\tChatAgentLocation,\n\ttype IChatAgentData,\n\tIChatAgentNameService,\n\tIChatAgentService,\n\tgetFullyQualifiedId,\n} from \"../../common/chatAgents.js\";\nimport {\n\tChatRequestAgentPart,\n\tChatRequestAgentSubcommandPart,\n\tChatRequestTextPart,\n\tChatRequestToolPart,\n\tChatRequestVariablePart,\n\tchatAgentLeader,\n\tchatSubcommandLeader,\n\tchatVariableLeader,\n} from \"../../common/chatParserTypes.js\";\nimport { IChatSlashCommandService } from \"../../common/chatSlashCommands.js\";\nimport {\n\tIChatVariablesService,\n\ttype IDynamicVariable,\n} from \"../../common/chatVariables.js\";\nimport { ILanguageModelToolsService } from \"../../common/languageModelToolsService.js\";\nimport { SubmitAction } from \"../actions/chatExecuteActions.js\";\nimport { type IChatWidget, IChatWidgetService } from \"../chat.js\";\nimport { ChatInputPart } from \"../chatInputPart.js\";\nimport {\n\tChatDynamicVariableModel,\n\tSelectAndInsertFileAction,\n} from \"./chatDynamicVariables.js\";\n\nclass SlashCommandCompletions extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatSlashCommandService\n\t\tprivate readonly chatSlashCommandService: IChatSlashCommandService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"globalSlashCommands\",\n\t\t\t\t\ttriggerCharacters: [\"/\"],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\t_token: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t/\\/\\w*/g,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\t\t\t\t\tconst usedAgent = parsedRequest.find(\n\t\t\t\t\t\t\t(p) => p instanceof ChatRequestAgentPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (usedAgent) {\n\t\t\t\t\t\t\t// No (classic) global slash commands when an agent is used\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst slashCommands =\n\t\t\t\t\t\t\tthis.chatSlashCommandService.getCommands(\n\t\t\t\t\t\t\t\twidget.location,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!slashCommands) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuggestions: slashCommands.map(\n\t\t\t\t\t\t\t\t(c, i): CompletionItem => {\n\t\t\t\t\t\t\t\t\tconst withSlash = `/${c.command}`;\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\t\t\t\tinsertText: c.executeImmediately\n\t\t\t\t\t\t\t\t\t\t\t? \"\"\n\t\t\t\t\t\t\t\t\t\t\t: `${withSlash} `,\n\t\t\t\t\t\t\t\t\t\tdetail: c.detail,\n\t\t\t\t\t\t\t\t\t\trange: new Range(1, 1, 1, 1),\n\t\t\t\t\t\t\t\t\t\tsortText:\n\t\t\t\t\t\t\t\t\t\t\tc.sortText ?? \"a\".repeat(i + 1),\n\t\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway,\n\t\t\t\t\t\t\t\t\t\tcommand: c.executeImmediately\n\t\t\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\t\tid: SubmitAction.ID,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttitle: withSlash,\n\t\t\t\t\t\t\t\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tinputValue: `${withSlash} `,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(\n\tSlashCommandCompletions,\n\tLifecyclePhase.Eventually,\n);\n\nclass AgentCompletions extends Disposable {\n\tconstructor(\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatAgentService private readonly chatAgentService: IChatAgentService,\n\t\t@IChatAgentNameService\n\t\tprivate readonly chatAgentNameService: IChatAgentNameService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"chatAgent\",\n\t\t\t\t\ttriggerCharacters: [\"@\"],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\t_token: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\t\t\t\t\tconst usedAgent = parsedRequest.find(\n\t\t\t\t\t\t\t(p) => p instanceof ChatRequestAgentPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\tusedAgent &&\n\t\t\t\t\t\t\t!Range.containsPosition(\n\t\t\t\t\t\t\t\tusedAgent.editorRange,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t// Only one agent allowed\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t/@\\w*/g,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst agents = this.chatAgentService\n\t\t\t\t\t\t\t.getAgents()\n\t\t\t\t\t\t\t.filter((a) => !a.isDefault)\n\t\t\t\t\t\t\t.filter((a) =>\n\t\t\t\t\t\t\t\ta.locations.includes(widget.location),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuggestions: agents.map(\n\t\t\t\t\t\t\t\t(agent, i): CompletionItem => {\n\t\t\t\t\t\t\t\t\tconst { label: agentLabel, isDupe } =\n\t\t\t\t\t\t\t\t\t\tthis.getAgentCompletionDetails(agent);\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t// Leading space is important because detail has no space at the start by design\n\t\t\t\t\t\t\t\t\t\tlabel: isDupe\n\t\t\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\t\tlabel: agentLabel,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdescription:\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tagent.description,\n\t\t\t\t\t\t\t\t\t\t\t\t\tdetail: ` (${agent.publisherDisplayName})`,\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t: agentLabel,\n\t\t\t\t\t\t\t\t\t\tinsertText: `${agentLabel} `,\n\t\t\t\t\t\t\t\t\t\tdetail: agent.description,\n\t\t\t\t\t\t\t\t\t\trange: new Range(1, 1, 1, 1),\n\t\t\t\t\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\t\t\t\t\tid: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\t\ttitle: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\tagent: agent,\n\t\t\t\t\t\t\t\t\t\t\t\t\twidget,\n\t\t\t\t\t\t\t\t\t\t\t\t} satisfies AssignSelectedAgentActionArgs,\n\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"chatAgentSubcommand\",\n\t\t\t\t\ttriggerCharacters: [\"/\"],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!widget || !widget.viewModel) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t/\\/\\w*/g,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst parsedRequest = widget.parsedInput.parts;\n\t\t\t\t\t\tconst usedAgentIdx = parsedRequest.findIndex(\n\t\t\t\t\t\t\t(p): p is ChatRequestAgentPart =>\n\t\t\t\t\t\t\t\tp instanceof ChatRequestAgentPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (usedAgentIdx < 0) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst usedSubcommand = parsedRequest.find(\n\t\t\t\t\t\t\t(p) => p instanceof ChatRequestAgentSubcommandPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (usedSubcommand) {\n\t\t\t\t\t\t\t// Only one allowed\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tfor (const partAfterAgent of parsedRequest.slice(\n\t\t\t\t\t\t\tusedAgentIdx + 1,\n\t\t\t\t\t\t)) {\n\t\t\t\t\t\t\t// Could allow text after 'position'\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\t!(\n\t\t\t\t\t\t\t\t\tpartAfterAgent instanceof\n\t\t\t\t\t\t\t\t\tChatRequestTextPart\n\t\t\t\t\t\t\t\t) ||\n\t\t\t\t\t\t\t\t!partAfterAgent.text.trim().match(/^(\\/\\w*)?$/)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\t// No text allowed between agent and subcommand\n\t\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst usedAgent = parsedRequest[\n\t\t\t\t\t\t\tusedAgentIdx\n\t\t\t\t\t\t] as ChatRequestAgentPart;\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuggestions: usedAgent.agent.slashCommands.map(\n\t\t\t\t\t\t\t\t(c, i): CompletionItem => {\n\t\t\t\t\t\t\t\t\tconst withSlash = `/${c.name}`;\n\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\t\t\t\tinsertText: `${withSlash} `,\n\t\t\t\t\t\t\t\t\t\tdetail: c.description,\n\t\t\t\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\t// list subcommands when the query is empty, insert agent+subcommand\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"chatAgentAndSubcommand\",\n\t\t\t\t\ttriggerCharacters: [\"/\"],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tconst viewModel = widget?.viewModel;\n\t\t\t\t\t\tif (!widget || !viewModel) {\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t/\\/\\w*/g,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst agents = this.chatAgentService\n\t\t\t\t\t\t\t.getAgents()\n\t\t\t\t\t\t\t.filter((a) =>\n\t\t\t\t\t\t\t\ta.locations.includes(widget.location),\n\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t// When the input is only `/`, items are sorted by sortText.\n\t\t\t\t\t\t// When typing, filterText is used to score and sort.\n\t\t\t\t\t\t// The same list is refiltered/ranked while typing.\n\t\t\t\t\t\tconst getFilterText = (\n\t\t\t\t\t\t\tagent: IChatAgentData,\n\t\t\t\t\t\t\tcommand: string,\n\t\t\t\t\t\t) => {\n\t\t\t\t\t\t\t// This is hacking the filter algorithm to make @terminal /explain match worse than @workspace /explain by making its match index later in the string.\n\t\t\t\t\t\t\t// When I type `/exp`, the workspace one should be sorted over the terminal one.\n\t\t\t\t\t\t\tconst dummyPrefix =\n\t\t\t\t\t\t\t\tagent.id === \"github.copilot.terminalPanel\"\n\t\t\t\t\t\t\t\t\t? `0000`\n\t\t\t\t\t\t\t\t\t: ``;\n\t\t\t\t\t\t\treturn `${chatSubcommandLeader}${dummyPrefix}${agent.name}.${command}`;\n\t\t\t\t\t\t};\n\n\t\t\t\t\t\tconst justAgents: CompletionItem[] = agents\n\t\t\t\t\t\t\t.filter((a) => !a.isDefault)\n\t\t\t\t\t\t\t.map((agent) => {\n\t\t\t\t\t\t\t\tconst { label: agentLabel, isDupe } =\n\t\t\t\t\t\t\t\t\tthis.getAgentCompletionDetails(agent);\n\t\t\t\t\t\t\t\tconst detail = agent.description;\n\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tlabel: isDupe\n\t\t\t\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: agentLabel,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: agent.description,\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: ` (${agent.publisherDisplayName})`,\n\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t: agentLabel,\n\t\t\t\t\t\t\t\t\tdetail,\n\t\t\t\t\t\t\t\t\tfilterText: `${chatSubcommandLeader}${agent.name}`,\n\t\t\t\t\t\t\t\t\tinsertText: `${agentLabel} `,\n\t\t\t\t\t\t\t\t\trange: new Range(1, 1, 1, 1),\n\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\t\t\t\tsortText: `${chatSubcommandLeader}${agent.name}`,\n\t\t\t\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\t\t\t\tid: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\ttitle: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\tagent,\n\t\t\t\t\t\t\t\t\t\t\t\twidget,\n\t\t\t\t\t\t\t\t\t\t\t} satisfies AssignSelectedAgentActionArgs,\n\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuggestions: justAgents.concat(\n\t\t\t\t\t\t\t\tagents.flatMap((agent) =>\n\t\t\t\t\t\t\t\t\tagent.slashCommands.map((c, i) => {\n\t\t\t\t\t\t\t\t\t\tconst { label: agentLabel, isDupe } =\n\t\t\t\t\t\t\t\t\t\t\tthis.getAgentCompletionDetails(\n\t\t\t\t\t\t\t\t\t\t\t\tagent,\n\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\tconst withSlash = `${chatSubcommandLeader}${c.name}`;\n\t\t\t\t\t\t\t\t\t\tconst item: CompletionItem = {\n\t\t\t\t\t\t\t\t\t\t\tlabel: {\n\t\t\t\t\t\t\t\t\t\t\t\tlabel: withSlash,\n\t\t\t\t\t\t\t\t\t\t\t\tdescription: agentLabel,\n\t\t\t\t\t\t\t\t\t\t\t\tdetail: isDupe\n\t\t\t\t\t\t\t\t\t\t\t\t\t? ` (${agent.publisherDisplayName})`\n\t\t\t\t\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\tfilterText: getFilterText(\n\t\t\t\t\t\t\t\t\t\t\t\tagent,\n\t\t\t\t\t\t\t\t\t\t\t\tc.name,\n\t\t\t\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t\t\t\t\tcommitCharacters: [\" \"],\n\t\t\t\t\t\t\t\t\t\t\tinsertText: `${agentLabel} ${withSlash} `,\n\t\t\t\t\t\t\t\t\t\t\tdetail: `(${agentLabel}) ${c.description ?? \"\"}`,\n\t\t\t\t\t\t\t\t\t\t\trange: new Range(1, 1, 1, 1),\n\t\t\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\t\t\t\t\tsortText: `${chatSubcommandLeader}${agent.name}${c.name}`,\n\t\t\t\t\t\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\t\t\t\t\t\tid: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\t\t\ttitle: AssignSelectedAgentAction.ID,\n\t\t\t\t\t\t\t\t\t\t\t\targuments: [\n\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tagent,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\twidget,\n\t\t\t\t\t\t\t\t\t\t\t\t\t} satisfies AssignSelectedAgentActionArgs,\n\t\t\t\t\t\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\t\t\tif (agent.isDefault) {\n\t\t\t\t\t\t\t\t\t\t\t// default agent isn't mentioned nor inserted\n\t\t\t\t\t\t\t\t\t\t\titem.label = withSlash;\n\t\t\t\t\t\t\t\t\t\t\titem.insertText = `${withSlash} `;\n\t\t\t\t\t\t\t\t\t\t\titem.detail = c.description;\n\t\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t\treturn item;\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate getAgentCompletionDetails(agent: IChatAgentData): {\n\t\tlabel: string;\n\t\tisDupe: boolean;\n\t} {\n\t\tconst isAllowed =\n\t\t\tthis.chatAgentNameService.getAgentNameRestriction(agent);\n\t\tconst agentLabel = `${chatAgentLeader}${isAllowed ? agent.name : getFullyQualifiedId(agent)}`;\n\t\tconst isDupe =\n\t\t\tisAllowed && this.chatAgentService.agentHasDupeName(agent.id);\n\t\treturn { label: agentLabel, isDupe };\n\t}\n}\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(AgentCompletions, LifecyclePhase.Eventually);\n\ninterface AssignSelectedAgentActionArgs {\n\tagent: IChatAgentData;\n\twidget: IChatWidget;\n}\n\nclass AssignSelectedAgentAction extends Action2 {\n\tstatic readonly ID = \"workbench.action.chat.assignSelectedAgent\";\n\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: AssignSelectedAgentAction.ID,\n\t\t\ttitle: \"\", // not displayed\n\t\t});\n\t}\n\n\tasync run(accessor: ServicesAccessor, ...args: any[]) {\n\t\tconst arg: AssignSelectedAgentActionArgs = args[0];\n\t\tif (!arg || !arg.widget || !arg.agent) {\n\t\t\treturn;\n\t\t}\n\n\t\targ.widget.lastSelectedAgent = arg.agent;\n\t}\n}\nregisterAction2(AssignSelectedAgentAction);\n\nclass ReferenceArgument {\n\tconstructor(\n\t\treadonly widget: IChatWidget,\n\t\treadonly variable: IDynamicVariable,\n\t) {}\n}\n\nclass BuiltinDynamicCompletions extends Disposable {\n\tprivate static readonly addReferenceCommand = \"_addReferenceCmd\";\n\tprivate static readonly VariableNameDef = new RegExp(\n\t\t`${chatVariableLeader}\\\\w*`,\n\t\t\"g\",\n\t); // MUST be using `g`-flag\n\n\tprivate readonly queryBuilder: QueryBuilder;\n\n\tconstructor(\n\t\t@IHistoryService private readonly historyService: IHistoryService,\n\t\t@IWorkspaceContextService\n\t\tprivate readonly workspaceContextService: IWorkspaceContextService,\n\t\t@ISearchService private readonly searchService: ISearchService,\n\t\t@ILabelService private readonly labelService: ILabelService,\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\t@IInstantiationService\n\t\tprivate readonly instantiationService: IInstantiationService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"chatDynamicCompletions\",\n\t\t\t\t\ttriggerCharacters: [chatVariableLeader],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!widget || !widget.supportsFileReferences) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tBuiltinDynamicCompletions.VariableNameDef,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst result: CompletionList = { suggestions: [] };\n\n\t\t\t\t\t\tconst afterRange = new Range(\n\t\t\t\t\t\t\tposition.lineNumber,\n\t\t\t\t\t\t\trange.replace.startColumn,\n\t\t\t\t\t\t\tposition.lineNumber,\n\t\t\t\t\t\t\trange.replace.startColumn + \"#file:\".length,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tresult.suggestions.push({\n\t\t\t\t\t\t\tlabel: `${chatVariableLeader}file`,\n\t\t\t\t\t\t\tinsertText: `${chatVariableLeader}file:`,\n\t\t\t\t\t\t\tdetail: localize(\"pickFileLabel\", \"Pick a file\"),\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\t\tcommand: {\n\t\t\t\t\t\t\t\tid: SelectAndInsertFileAction.ID,\n\t\t\t\t\t\t\t\ttitle: SelectAndInsertFileAction.ID,\n\t\t\t\t\t\t\t\targuments: [{ widget, range: afterRange }],\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tsortText: \"z\",\n\t\t\t\t\t\t});\n\n\t\t\t\t\t\tawait this.addFileEntries(widget, result, range, token);\n\n\t\t\t\t\t\treturn result;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\n\t\tthis._register(\n\t\t\tCommandsRegistry.registerCommand(\n\t\t\t\tBuiltinDynamicCompletions.addReferenceCommand,\n\t\t\t\t(_services, arg) => this.cmdAddReference(arg),\n\t\t\t),\n\t\t);\n\n\t\tthis.queryBuilder =\n\t\t\tthis.instantiationService.createInstance(QueryBuilder);\n\t}\n\n\tprivate cacheKey?: { key: string; time: number };\n\n\tprivate async addFileEntries(\n\t\twidget: IChatWidget,\n\t\tresult: CompletionList,\n\t\tinfo: {\n\t\t\tinsert: Range;\n\t\t\treplace: Range;\n\t\t\tvarWord: IWordAtPosition | null;\n\t\t},\n\t\ttoken: CancellationToken,\n\t) {\n\t\tconst makeFileCompletionItem = (resource: URI): CompletionItem => {\n\t\t\tconst basename = this.labelService.getUriBasenameLabel(resource);\n\t\t\tconst insertText = `${chatVariableLeader}file:${basename} `;\n\n\t\t\treturn {\n\t\t\t\tlabel: {\n\t\t\t\t\tlabel: basename,\n\t\t\t\t\tdescription: this.labelService.getUriLabel(resource, {\n\t\t\t\t\t\trelative: true,\n\t\t\t\t\t}),\n\t\t\t\t},\n\t\t\t\tfilterText: `${chatVariableLeader}${basename}`,\n\t\t\t\tinsertText,\n\t\t\t\trange: info,\n\t\t\t\tkind: CompletionItemKind.File,\n\t\t\t\tsortText: \"{\", // after `z`\n\t\t\t\tcommand: {\n\t\t\t\t\tid: BuiltinDynamicCompletions.addReferenceCommand,\n\t\t\t\t\ttitle: \"\",\n\t\t\t\t\targuments: [\n\t\t\t\t\t\tnew ReferenceArgument(widget, {\n\t\t\t\t\t\t\tid: \"vscode.file\",\n\t\t\t\t\t\t\trange: {\n\t\t\t\t\t\t\t\tstartLineNumber: info.replace.startLineNumber,\n\t\t\t\t\t\t\t\tstartColumn: info.replace.startColumn,\n\t\t\t\t\t\t\t\tendLineNumber: info.replace.endLineNumber,\n\t\t\t\t\t\t\t\tendColumn:\n\t\t\t\t\t\t\t\t\tinfo.replace.startColumn +\n\t\t\t\t\t\t\t\t\tinsertText.length,\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tdata: resource,\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t},\n\t\t\t};\n\t\t};\n\n\t\tlet pattern: string | undefined;\n\t\tif (\n\t\t\tinfo.varWord?.word &&\n\t\t\tinfo.varWord.word.startsWith(chatVariableLeader)\n\t\t) {\n\t\t\tpattern = info.varWord.word.toLowerCase().slice(1); // remove leading #\n\t\t}\n\n\t\tconst seen = new ResourceSet();\n\t\tconst len = result.suggestions.length;\n\n\t\t// HISTORY\n\t\t// always take the last N items\n\t\tfor (const item of this.historyService.getHistory()) {\n\t\t\tif (\n\t\t\t\t!item.resource ||\n\t\t\t\t!this.workspaceContextService.getWorkspaceFolder(item.resource)\n\t\t\t) {\n\t\t\t\t// ignore \"forgein\" editors\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tif (pattern) {\n\t\t\t\t// use pattern if available\n\t\t\t\tconst basename = this.labelService\n\t\t\t\t\t.getUriBasenameLabel(item.resource)\n\t\t\t\t\t.toLowerCase();\n\t\t\t\tif (\n\t\t\t\t\t!isPatternInWord(\n\t\t\t\t\t\tpattern,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tpattern.length,\n\t\t\t\t\t\tbasename,\n\t\t\t\t\t\t0,\n\t\t\t\t\t\tbasename.length,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tseen.add(item.resource);\n\t\t\tconst newLen = result.suggestions.push(\n\t\t\t\tmakeFileCompletionItem(item.resource),\n\t\t\t);\n\t\t\tif (newLen - len >= 5) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\t// SEARCH\n\t\t// use file search when having a pattern\n\t\tif (pattern) {\n\t\t\tif (this.cacheKey && Date.now() - this.cacheKey.time > 60000) {\n\t\t\t\tthis.searchService.clearCache(this.cacheKey.key);\n\t\t\t\tthis.cacheKey = undefined;\n\t\t\t}\n\n\t\t\tif (!this.cacheKey) {\n\t\t\t\tthis.cacheKey = {\n\t\t\t\t\tkey: generateUuid(),\n\t\t\t\t\ttime: Date.now(),\n\t\t\t\t};\n\t\t\t}\n\n\t\t\tthis.cacheKey.time = Date.now();\n\n\t\t\tconst query = this.queryBuilder.file(\n\t\t\t\tthis.workspaceContextService.getWorkspace().folders,\n\t\t\t\t{\n\t\t\t\t\tfilePattern: pattern,\n\t\t\t\t\tsortByScore: true,\n\t\t\t\t\tmaxResults: 250,\n\t\t\t\t\tcacheKey: this.cacheKey.key,\n\t\t\t\t},\n\t\t\t);\n\n\t\t\tconst data = await this.searchService.fileSearch(query, token);\n\t\t\tfor (const match of data.results) {\n\t\t\t\tif (seen.has(match.resource)) {\n\t\t\t\t\t// already included via history\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t\tresult.suggestions.push(makeFileCompletionItem(match.resource));\n\t\t\t}\n\t\t}\n\n\t\t// mark results as incomplete because further typing might yield\n\t\t// in more search results\n\t\tresult.incomplete = true;\n\t}\n\n\tprivate cmdAddReference(arg: ReferenceArgument) {\n\t\t// invoked via the completion command\n\t\targ.widget\n\t\t\t.getContrib<ChatDynamicVariableModel>(ChatDynamicVariableModel.ID)\n\t\t\t?.addReference(arg.variable);\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(\n\tBuiltinDynamicCompletions,\n\tLifecyclePhase.Eventually,\n);\n\nfunction computeCompletionRanges(\n\tmodel: ITextModel,\n\tposition: Position,\n\treg: RegExp,\n\tonlyOnWordStart = false,\n):\n\t| { insert: Range; replace: Range; varWord: IWordAtPosition | null }\n\t| undefined {\n\tconst varWord = getWordAtText(\n\t\tposition.column,\n\t\treg,\n\t\tmodel.getLineContent(position.lineNumber),\n\t\t0,\n\t);\n\tif (!varWord && model.getWordUntilPosition(position).word) {\n\t\t// inside a \"normal\" word\n\t\treturn;\n\t}\n\tif (varWord && onlyOnWordStart) {\n\t\tconst wordBefore = model.getWordUntilPosition({\n\t\t\tlineNumber: position.lineNumber,\n\t\t\tcolumn: varWord.startColumn,\n\t\t});\n\t\tif (wordBefore.word) {\n\t\t\t// inside a word\n\t\t\treturn;\n\t\t}\n\t}\n\n\tlet insert: Range;\n\tlet replace: Range;\n\tif (varWord) {\n\t\tinsert = new Range(\n\t\t\tposition.lineNumber,\n\t\t\tvarWord.startColumn,\n\t\t\tposition.lineNumber,\n\t\t\tposition.column,\n\t\t);\n\t\treplace = new Range(\n\t\t\tposition.lineNumber,\n\t\t\tvarWord.startColumn,\n\t\t\tposition.lineNumber,\n\t\t\tvarWord.endColumn,\n\t\t);\n\t} else {\n\t\tinsert = replace = Range.fromPositions(position);\n\t}\n\n\treturn { insert, replace, varWord };\n}\n\nclass VariableCompletions extends Disposable {\n\tprivate static readonly VariableNameDef = new RegExp(\n\t\t`${chatVariableLeader}\\\\w*`,\n\t\t\"g\",\n\t); // MUST be using `g`-flag\n\n\tconstructor(\n\t\t@ILanguageFeaturesService\n\t\tprivate readonly languageFeaturesService: ILanguageFeaturesService,\n\t\t@IChatWidgetService\n\t\tprivate readonly chatWidgetService: IChatWidgetService,\n\t\t@IChatVariablesService\n\t\tprivate readonly chatVariablesService: IChatVariablesService,\n\t\t@IConfigurationService configService: IConfigurationService,\n\t\t@ILanguageModelToolsService toolsService: ILanguageModelToolsService,\n\t) {\n\t\tsuper();\n\n\t\tthis._register(\n\t\t\tthis.languageFeaturesService.completionProvider.register(\n\t\t\t\t{\n\t\t\t\t\tscheme: ChatInputPart.INPUT_SCHEME,\n\t\t\t\t\thasAccessToAllModels: true,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\t_debugDisplayName: \"chatVariables\",\n\t\t\t\t\ttriggerCharacters: [chatVariableLeader],\n\t\t\t\t\tprovideCompletionItems: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: Position,\n\t\t\t\t\t\t_context: CompletionContext,\n\t\t\t\t\t\t_token: CancellationToken,\n\t\t\t\t\t) => {\n\t\t\t\t\t\tconst locations = new Set<ChatAgentLocation>();\n\t\t\t\t\t\tlocations.add(ChatAgentLocation.Panel);\n\n\t\t\t\t\t\tfor (const value of Object.values(ChatAgentLocation)) {\n\t\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t\ttypeof value === \"string\" &&\n\t\t\t\t\t\t\t\tconfigService.getValue<boolean>(\n\t\t\t\t\t\t\t\t\t`chat.experimental.variables.${value}`,\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t) {\n\t\t\t\t\t\t\t\tlocations.add(value);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst widget =\n\t\t\t\t\t\t\tthis.chatWidgetService.getWidgetByInputUri(\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!widget || !locations.has(widget.location)) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst range = computeCompletionRanges(\n\t\t\t\t\t\t\tmodel,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tVariableCompletions.VariableNameDef,\n\t\t\t\t\t\t\ttrue,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!range) {\n\t\t\t\t\t\t\treturn null;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst usedAgent = widget.parsedInput.parts.find(\n\t\t\t\t\t\t\t(p) => p instanceof ChatRequestAgentPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst slowSupported = usedAgent\n\t\t\t\t\t\t\t? usedAgent.agent.metadata.supportsSlowVariables\n\t\t\t\t\t\t\t: true;\n\n\t\t\t\t\t\tconst usedVariables = widget.parsedInput.parts.filter(\n\t\t\t\t\t\t\t(p): p is ChatRequestVariablePart =>\n\t\t\t\t\t\t\t\tp instanceof ChatRequestVariablePart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst usedVariableNames = new Set(\n\t\t\t\t\t\t\tusedVariables.map((v) => v.variableName),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst variableItems = Array.from(\n\t\t\t\t\t\t\tthis.chatVariablesService.getVariables(\n\t\t\t\t\t\t\t\twidget.location,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t)\n\t\t\t\t\t\t\t// This doesn't look at dynamic variables like `file`, where multiple makes sense.\n\t\t\t\t\t\t\t.filter((v) => !usedVariableNames.has(v.name))\n\t\t\t\t\t\t\t.filter((v) => !v.isSlow || slowSupported)\n\t\t\t\t\t\t\t.map((v): CompletionItem => {\n\t\t\t\t\t\t\t\tconst withLeader = `${chatVariableLeader}${v.name}`;\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tlabel: withLeader,\n\t\t\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\t\t\tinsertText: withLeader + \" \",\n\t\t\t\t\t\t\t\t\tdetail: v.description,\n\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text, // The icons are disabled here anyway\n\t\t\t\t\t\t\t\t\tsortText: \"z\",\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\n\t\t\t\t\t\tconst usedTools = widget.parsedInput.parts.filter(\n\t\t\t\t\t\t\t(p): p is ChatRequestToolPart =>\n\t\t\t\t\t\t\t\tp instanceof ChatRequestToolPart,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst usedToolNames = new Set(\n\t\t\t\t\t\t\tusedTools.map((v) => v.toolName),\n\t\t\t\t\t\t);\n\t\t\t\t\t\tconst toolItems: CompletionItem[] = [];\n\t\t\t\t\t\tif (\n\t\t\t\t\t\t\t!usedAgent ||\n\t\t\t\t\t\t\tusedAgent.agent.supportsToolReferences\n\t\t\t\t\t\t) {\n\t\t\t\t\t\t\ttoolItems.push(\n\t\t\t\t\t\t\t\t...Array.from(toolsService.getTools())\n\t\t\t\t\t\t\t\t\t.filter((t) => t.canBeInvokedManually)\n\t\t\t\t\t\t\t\t\t.filter(\n\t\t\t\t\t\t\t\t\t\t(t) => !usedToolNames.has(t.name ?? \"\"),\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t.map((t): CompletionItem => {\n\t\t\t\t\t\t\t\t\t\tconst withLeader = `${chatVariableLeader}${t.name}`;\n\t\t\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\t\t\tlabel: withLeader,\n\t\t\t\t\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\t\t\t\t\tinsertText: withLeader + \" \",\n\t\t\t\t\t\t\t\t\t\t\tdetail: t.userDescription,\n\t\t\t\t\t\t\t\t\t\t\tkind: CompletionItemKind.Text,\n\t\t\t\t\t\t\t\t\t\t\tsortText: \"z\",\n\t\t\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tsuggestions: [...variableItems, ...toolItems],\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n}\n\nRegistry.as<IWorkbenchContributionsRegistry>(\n\tWorkbenchExtensions.Workbench,\n).registerWorkbenchContribution(VariableCompletions, LifecyclePhase.Eventually);\n"],
  "mappings": ";;;;;;;;;;;;AAMA,SAAS,uBAAuB;AAChC,SAAS,kBAAkB;AAC3B,SAAS,mBAAmB;AAE5B,SAAS,oBAAoB;AAE7B,SAAS,aAAa;AACtB;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EAGC;AAAA,OAEM;AAEP,SAAS,gCAAgC;AACzC,SAAS,gBAAgB;AACzB;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,wBAAwB;AACjC,SAAS,6BAA6B;AACtC;AAAA,EACC;AAAA,OAEM;AACP,SAAS,qBAAqB;AAC9B,SAAS,gBAAgB;AACzB,SAAS,gCAAgC;AACzC;AAAA,EAEC,cAAc;AAAA,OACR;AACP,SAAS,uBAAuB;AAChC,SAAS,sBAAsB;AAC/B,SAAS,oBAAoB;AAC7B,SAAS,sBAAsB;AAC/B;AAAA,EACC;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,OACM;AACP,SAAS,gCAAgC;AACzC;AAAA,EACC;AAAA,OAEM;AACP,SAAS,kCAAkC;AAC3C,SAAS,oBAAoB;AAC7B,SAA2B,0BAA0B;AACrD,SAAS,qBAAqB;AAC9B;AAAA,EACC;AAAA,EACA;AAAA,OACM;AAEP,IAAM,0BAAN,cAAsC,WAAW;AAAA,EAChD,YAEkB,yBAEA,mBAEA,yBAChB;AACD,UAAM;AANW;AAEA;AAEA;AAIjB,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,GAAG;AAAA,UACvB,wBAAwB,8BACvB,OACA,UACA,UACA,WACI;AACJ,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,gBAAI,CAAC,UAAU,CAAC,OAAO,WAAW;AACjC,qBAAO;AAAA,YACR;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,gBAAgB,OAAO,YAAY;AACzC,kBAAM,YAAY,cAAc;AAAA,cAC/B,CAAC,MAAM,aAAa;AAAA,YACrB;AACA,gBAAI,WAAW;AAEd;AAAA,YACD;AAEA,kBAAM,gBACL,KAAK,wBAAwB;AAAA,cAC5B,OAAO;AAAA,YACR;AACD,gBAAI,CAAC,eAAe;AACnB,qBAAO;AAAA,YACR;AAEA,mBAAO;AAAA,cACN,aAAa,cAAc;AAAA,gBAC1B,CAAC,GAAG,MAAsB;AACzB,wBAAM,YAAY,IAAI,EAAE,OAAO;AAC/B,yBAAO;AAAA,oBACN,OAAO;AAAA,oBACP,YAAY,EAAE,qBACX,KACA,GAAG,SAAS;AAAA,oBACf,QAAQ,EAAE;AAAA,oBACV,OAAO,IAAI,MAAM,GAAG,GAAG,GAAG,CAAC;AAAA,oBAC3B,UACC,EAAE,YAAY,IAAI,OAAO,IAAI,CAAC;AAAA,oBAC/B,MAAM,mBAAmB;AAAA;AAAA,oBACzB,SAAS,EAAE,qBACR;AAAA,sBACA,IAAI,aAAa;AAAA,sBACjB,OAAO;AAAA,sBACP,WAAW;AAAA,wBACV;AAAA,0BACC;AAAA,0BACA,YAAY,GAAG,SAAS;AAAA,wBACzB;AAAA,sBACD;AAAA,oBACD,IACC;AAAA,kBACJ;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AAAA,UACD,GAtEwB;AAAA,QAuEzB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EA5KD,OA8EiD;AAAA;AAAA;AA+FjD;AA/FM,0BAAN;AAAA,EAEG;AAAA,EAEA;AAAA,EAEA;AAAA,GANG;AAiGN,SAAS;AAAA,EACR,oBAAoB;AACrB,EAAE;AAAA,EACD;AAAA,EACA,eAAe;AAChB;AAEA,IAAM,mBAAN,cAA+B,WAAW;AAAA,EACzC,YAEkB,yBAEA,mBACmB,kBAEnB,sBAChB;AACD,UAAM;AAPW;AAEA;AACmB;AAEnB;AAIjB,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,GAAG;AAAA,UACvB,wBAAwB,8BACvB,OACA,UACA,UACA,WACI;AACJ,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,gBAAI,CAAC,UAAU,CAAC,OAAO,WAAW;AACjC,qBAAO;AAAA,YACR;AAEA,kBAAM,gBAAgB,OAAO,YAAY;AACzC,kBAAM,YAAY,cAAc;AAAA,cAC/B,CAAC,MAAM,aAAa;AAAA,YACrB;AACA,gBACC,aACA,CAAC,MAAM;AAAA,cACN,UAAU;AAAA,cACV;AAAA,YACD,GACC;AAED;AAAA,YACD;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,SAAS,KAAK,iBAClB,UAAU,EACV,OAAO,CAAC,MAAM,CAAC,EAAE,SAAS,EAC1B;AAAA,cAAO,CAAC,MACR,EAAE,UAAU,SAAS,OAAO,QAAQ;AAAA,YACrC;AAED,mBAAO;AAAA,cACN,aAAa,OAAO;AAAA,gBACnB,CAAC,OAAO,MAAsB;AAC7B,wBAAM,EAAE,OAAO,YAAY,OAAO,IACjC,KAAK,0BAA0B,KAAK;AACrC,yBAAO;AAAA;AAAA,oBAEN,OAAO,SACJ;AAAA,sBACA,OAAO;AAAA,sBACP,aACC,MAAM;AAAA,sBACP,QAAQ,KAAK,MAAM,oBAAoB;AAAA,oBACxC,IACC;AAAA,oBACH,YAAY,GAAG,UAAU;AAAA,oBACzB,QAAQ,MAAM;AAAA,oBACd,OAAO,IAAI,MAAM,GAAG,GAAG,GAAG,CAAC;AAAA,oBAC3B,SAAS;AAAA,sBACR,IAAI,0BAA0B;AAAA,sBAC9B,OAAO,0BAA0B;AAAA,sBACjC,WAAW;AAAA,wBACV;AAAA,0BACC;AAAA,0BACA;AAAA,wBACD;AAAA,sBACD;AAAA,oBACD;AAAA,oBACA,MAAM,mBAAmB;AAAA;AAAA,kBAC1B;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AAAA,UACD,GA9EwB;AAAA,QA+EzB;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,GAAG;AAAA,UACvB,wBAAwB,8BACvB,OACA,UACA,UACA,UACI;AACJ,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,gBAAI,CAAC,UAAU,CAAC,OAAO,WAAW;AACjC;AAAA,YACD;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,gBAAgB,OAAO,YAAY;AACzC,kBAAM,eAAe,cAAc;AAAA,cAClC,CAAC,MACA,aAAa;AAAA,YACf;AACA,gBAAI,eAAe,GAAG;AACrB;AAAA,YACD;AAEA,kBAAM,iBAAiB,cAAc;AAAA,cACpC,CAAC,MAAM,aAAa;AAAA,YACrB;AACA,gBAAI,gBAAgB;AAEnB;AAAA,YACD;AAEA,uBAAW,kBAAkB,cAAc;AAAA,cAC1C,eAAe;AAAA,YAChB,GAAG;AAEF,kBACC,EACC,0BACA,wBAED,CAAC,eAAe,KAAK,KAAK,EAAE,MAAM,YAAY,GAC7C;AAED;AAAA,cACD;AAAA,YACD;AAEA,kBAAM,YAAY,cACjB,YACD;AACA,mBAAO;AAAA,cACN,aAAa,UAAU,MAAM,cAAc;AAAA,gBAC1C,CAAC,GAAG,MAAsB;AACzB,wBAAM,YAAY,IAAI,EAAE,IAAI;AAC5B,yBAAO;AAAA,oBACN,OAAO;AAAA,oBACP,YAAY,GAAG,SAAS;AAAA,oBACxB,QAAQ,EAAE;AAAA,oBACV;AAAA,oBACA,MAAM,mBAAmB;AAAA;AAAA,kBAC1B;AAAA,gBACD;AAAA,cACD;AAAA,YACD;AAAA,UACD,GAzEwB;AAAA,QA0EzB;AAAA,MACD;AAAA,IACD;AAGA,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,GAAG;AAAA,UACvB,wBAAwB,8BACvB,OACA,UACA,UACA,UACI;AACJ,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,kBAAM,YAAY,QAAQ;AAC1B,gBAAI,CAAC,UAAU,CAAC,WAAW;AAC1B;AAAA,YACD;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,SAAS,KAAK,iBAClB,UAAU,EACV;AAAA,cAAO,CAAC,MACR,EAAE,UAAU,SAAS,OAAO,QAAQ;AAAA,YACrC;AAKD,kBAAM,gBAAgB,wBACrB,OACA,YACI;AAGJ,oBAAM,cACL,MAAM,OAAO,iCACV,SACA;AACJ,qBAAO,GAAG,oBAAoB,GAAG,WAAW,GAAG,MAAM,IAAI,IAAI,OAAO;AAAA,YACrE,GAXsB;AAatB,kBAAM,aAA+B,OACnC,OAAO,CAAC,MAAM,CAAC,EAAE,SAAS,EAC1B,IAAI,CAAC,UAAU;AACf,oBAAM,EAAE,OAAO,YAAY,OAAO,IACjC,KAAK,0BAA0B,KAAK;AACrC,oBAAM,SAAS,MAAM;AAErB,qBAAO;AAAA,gBACN,OAAO,SACJ;AAAA,kBACA,OAAO;AAAA,kBACP,aAAa,MAAM;AAAA,kBACnB,QAAQ,KAAK,MAAM,oBAAoB;AAAA,gBACxC,IACC;AAAA,gBACH;AAAA,gBACA,YAAY,GAAG,oBAAoB,GAAG,MAAM,IAAI;AAAA,gBAChD,YAAY,GAAG,UAAU;AAAA,gBACzB,OAAO,IAAI,MAAM,GAAG,GAAG,GAAG,CAAC;AAAA,gBAC3B,MAAM,mBAAmB;AAAA,gBACzB,UAAU,GAAG,oBAAoB,GAAG,MAAM,IAAI;AAAA,gBAC9C,SAAS;AAAA,kBACR,IAAI,0BAA0B;AAAA,kBAC9B,OAAO,0BAA0B;AAAA,kBACjC,WAAW;AAAA,oBACV;AAAA,sBACC;AAAA,sBACA;AAAA,oBACD;AAAA,kBACD;AAAA,gBACD;AAAA,cACD;AAAA,YACD,CAAC;AAEF,mBAAO;AAAA,cACN,aAAa,WAAW;AAAA,gBACvB,OAAO;AAAA,kBAAQ,CAAC,UACf,MAAM,cAAc,IAAI,CAAC,GAAG,MAAM;AACjC,0BAAM,EAAE,OAAO,YAAY,OAAO,IACjC,KAAK;AAAA,sBACJ;AAAA,oBACD;AACD,0BAAM,YAAY,GAAG,oBAAoB,GAAG,EAAE,IAAI;AAClD,0BAAM,OAAuB;AAAA,sBAC5B,OAAO;AAAA,wBACN,OAAO;AAAA,wBACP,aAAa;AAAA,wBACb,QAAQ,SACL,KAAK,MAAM,oBAAoB,MAC/B;AAAA,sBACJ;AAAA,sBACA,YAAY;AAAA,wBACX;AAAA,wBACA,EAAE;AAAA,sBACH;AAAA,sBACA,kBAAkB,CAAC,GAAG;AAAA,sBACtB,YAAY,GAAG,UAAU,IAAI,SAAS;AAAA,sBACtC,QAAQ,IAAI,UAAU,KAAK,EAAE,eAAe,EAAE;AAAA,sBAC9C,OAAO,IAAI,MAAM,GAAG,GAAG,GAAG,CAAC;AAAA,sBAC3B,MAAM,mBAAmB;AAAA;AAAA,sBACzB,UAAU,GAAG,oBAAoB,GAAG,MAAM,IAAI,GAAG,EAAE,IAAI;AAAA,sBACvD,SAAS;AAAA,wBACR,IAAI,0BAA0B;AAAA,wBAC9B,OAAO,0BAA0B;AAAA,wBACjC,WAAW;AAAA,0BACV;AAAA,4BACC;AAAA,4BACA;AAAA,0BACD;AAAA,wBACD;AAAA,sBACD;AAAA,oBACD;AAEA,wBAAI,MAAM,WAAW;AAEpB,2BAAK,QAAQ;AACb,2BAAK,aAAa,GAAG,SAAS;AAC9B,2BAAK,SAAS,EAAE;AAAA,oBACjB;AAEA,2BAAO;AAAA,kBACR,CAAC;AAAA,gBACF;AAAA,cACD;AAAA,YACD;AAAA,UACD,GAnIwB;AAAA,QAoIzB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAtgBD,OAsL0C;AAAA;AAAA;AAAA,EAkVjC,0BAA0B,OAGhC;AACD,UAAM,YACL,KAAK,qBAAqB,wBAAwB,KAAK;AACxD,UAAM,aAAa,GAAG,eAAe,GAAG,YAAY,MAAM,OAAO,oBAAoB,KAAK,CAAC;AAC3F,UAAM,SACL,aAAa,KAAK,iBAAiB,iBAAiB,MAAM,EAAE;AAC7D,WAAO,EAAE,OAAO,YAAY,OAAO;AAAA,EACpC;AACD;AA7VM,mBAAN;AAAA,EAEG;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,GAPG;AA8VN,SAAS;AAAA,EACR,oBAAoB;AACrB,EAAE,8BAA8B,kBAAkB,eAAe,UAAU;AAO3E,MAAM,kCAAkC,QAAQ;AAAA,EA7hBhD,OA6hBgD;AAAA;AAAA;AAAA,EAC/C,OAAgB,KAAK;AAAA,EAErB,cAAc;AACb,UAAM;AAAA,MACL,IAAI,0BAA0B;AAAA,MAC9B,OAAO;AAAA;AAAA,IACR,CAAC;AAAA,EACF;AAAA,EAEA,MAAM,IAAI,aAA+B,MAAa;AACrD,UAAM,MAAqC,KAAK,CAAC;AACjD,QAAI,CAAC,OAAO,CAAC,IAAI,UAAU,CAAC,IAAI,OAAO;AACtC;AAAA,IACD;AAEA,QAAI,OAAO,oBAAoB,IAAI;AAAA,EACpC;AACD;AACA,gBAAgB,yBAAyB;AAEzC,MAAM,kBAAkB;AAAA,EACvB,YACU,QACA,UACR;AAFQ;AACA;AAAA,EACP;AAAA,EAtjBJ,OAkjBwB;AAAA;AAAA;AAKxB;AAEA,IAAM,4BAAN,cAAwC,WAAW;AAAA,EASlD,YACmC,gBAEjB,yBACgB,eACD,cAEf,yBAEA,mBAEA,sBAChB;AACD,UAAM;AAZ4B;AAEjB;AACgB;AACD;AAEf;AAEA;AAEA;AAIjB,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,kBAAkB;AAAA,UACtC,wBAAwB,8BACvB,OACA,UACA,UACA,UACI;AACJ,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,gBAAI,CAAC,UAAU,CAAC,OAAO,wBAAwB;AAC9C,qBAAO;AAAA,YACR;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA,0BAA0B;AAAA,cAC1B;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,SAAyB,EAAE,aAAa,CAAC,EAAE;AAEjD,kBAAM,aAAa,IAAI;AAAA,cACtB,SAAS;AAAA,cACT,MAAM,QAAQ;AAAA,cACd,SAAS;AAAA,cACT,MAAM,QAAQ,cAAc,SAAS;AAAA,YACtC;AACA,mBAAO,YAAY,KAAK;AAAA,cACvB,OAAO,GAAG,kBAAkB;AAAA,cAC5B,YAAY,GAAG,kBAAkB;AAAA,cACjC,QAAQ,SAAS,iBAAiB,aAAa;AAAA,cAC/C;AAAA,cACA,MAAM,mBAAmB;AAAA,cACzB,SAAS;AAAA,gBACR,IAAI,0BAA0B;AAAA,gBAC9B,OAAO,0BAA0B;AAAA,gBACjC,WAAW,CAAC,EAAE,QAAQ,OAAO,WAAW,CAAC;AAAA,cAC1C;AAAA,cACA,UAAU;AAAA,YACX,CAAC;AAED,kBAAM,KAAK,eAAe,QAAQ,QAAQ,OAAO,KAAK;AAEtD,mBAAO;AAAA,UACR,GAjDwB;AAAA,QAkDzB;AAAA,MACD;AAAA,IACD;AAEA,SAAK;AAAA,MACJ,iBAAiB;AAAA,QAChB,0BAA0B;AAAA,QAC1B,CAAC,WAAW,QAAQ,KAAK,gBAAgB,GAAG;AAAA,MAC7C;AAAA,IACD;AAEA,SAAK,eACJ,KAAK,qBAAqB,eAAe,YAAY;AAAA,EACvD;AAAA,EAzpBD,OAyjBmD;AAAA;AAAA;AAAA,EAClD,OAAwB,sBAAsB;AAAA,EAC9C,OAAwB,kBAAkB,IAAI;AAAA,IAC7C,GAAG,kBAAkB;AAAA,IACrB;AAAA,EACD;AAAA;AAAA,EAEiB;AAAA,EA2FT;AAAA,EAER,MAAc,eACb,QACA,QACA,MAKA,OACC;AACD,UAAM,yBAAyB,wBAAC,aAAkC;AACjE,YAAM,WAAW,KAAK,aAAa,oBAAoB,QAAQ;AAC/D,YAAM,aAAa,GAAG,kBAAkB,QAAQ,QAAQ;AAExD,aAAO;AAAA,QACN,OAAO;AAAA,UACN,OAAO;AAAA,UACP,aAAa,KAAK,aAAa,YAAY,UAAU;AAAA,YACpD,UAAU;AAAA,UACX,CAAC;AAAA,QACF;AAAA,QACA,YAAY,GAAG,kBAAkB,GAAG,QAAQ;AAAA,QAC5C;AAAA,QACA,OAAO;AAAA,QACP,MAAM,mBAAmB;AAAA,QACzB,UAAU;AAAA;AAAA,QACV,SAAS;AAAA,UACR,IAAI,0BAA0B;AAAA,UAC9B,OAAO;AAAA,UACP,WAAW;AAAA,YACV,IAAI,kBAAkB,QAAQ;AAAA,cAC7B,IAAI;AAAA,cACJ,OAAO;AAAA,gBACN,iBAAiB,KAAK,QAAQ;AAAA,gBAC9B,aAAa,KAAK,QAAQ;AAAA,gBAC1B,eAAe,KAAK,QAAQ;AAAA,gBAC5B,WACC,KAAK,QAAQ,cACb,WAAW;AAAA,cACb;AAAA,cACA,MAAM;AAAA,YACP,CAAC;AAAA,UACF;AAAA,QACD;AAAA,MACD;AAAA,IACD,GAnC+B;AAqC/B,QAAI;AACJ,QACC,KAAK,SAAS,QACd,KAAK,QAAQ,KAAK,WAAW,kBAAkB,GAC9C;AACD,gBAAU,KAAK,QAAQ,KAAK,YAAY,EAAE,MAAM,CAAC;AAAA,IAClD;AAEA,UAAM,OAAO,IAAI,YAAY;AAC7B,UAAM,MAAM,OAAO,YAAY;AAI/B,eAAW,QAAQ,KAAK,eAAe,WAAW,GAAG;AACpD,UACC,CAAC,KAAK,YACN,CAAC,KAAK,wBAAwB,mBAAmB,KAAK,QAAQ,GAC7D;AAED;AAAA,MACD;AAEA,UAAI,SAAS;AAEZ,cAAM,WAAW,KAAK,aACpB,oBAAoB,KAAK,QAAQ,EACjC,YAAY;AACd,YACC,CAAC;AAAA,UACA;AAAA,UACA;AAAA,UACA,QAAQ;AAAA,UACR;AAAA,UACA;AAAA,UACA,SAAS;AAAA,QACV,GACC;AACD;AAAA,QACD;AAAA,MACD;AAEA,WAAK,IAAI,KAAK,QAAQ;AACtB,YAAM,SAAS,OAAO,YAAY;AAAA,QACjC,uBAAuB,KAAK,QAAQ;AAAA,MACrC;AACA,UAAI,SAAS,OAAO,GAAG;AACtB;AAAA,MACD;AAAA,IACD;AAIA,QAAI,SAAS;AACZ,UAAI,KAAK,YAAY,KAAK,IAAI,IAAI,KAAK,SAAS,OAAO,KAAO;AAC7D,aAAK,cAAc,WAAW,KAAK,SAAS,GAAG;AAC/C,aAAK,WAAW;AAAA,MACjB;AAEA,UAAI,CAAC,KAAK,UAAU;AACnB,aAAK,WAAW;AAAA,UACf,KAAK,aAAa;AAAA,UAClB,MAAM,KAAK,IAAI;AAAA,QAChB;AAAA,MACD;AAEA,WAAK,SAAS,OAAO,KAAK,IAAI;AAE9B,YAAM,QAAQ,KAAK,aAAa;AAAA,QAC/B,KAAK,wBAAwB,aAAa,EAAE;AAAA,QAC5C;AAAA,UACC,aAAa;AAAA,UACb,aAAa;AAAA,UACb,YAAY;AAAA,UACZ,UAAU,KAAK,SAAS;AAAA,QACzB;AAAA,MACD;AAEA,YAAM,OAAO,MAAM,KAAK,cAAc,WAAW,OAAO,KAAK;AAC7D,iBAAW,SAAS,KAAK,SAAS;AACjC,YAAI,KAAK,IAAI,MAAM,QAAQ,GAAG;AAE7B;AAAA,QACD;AACA,eAAO,YAAY,KAAK,uBAAuB,MAAM,QAAQ,CAAC;AAAA,MAC/D;AAAA,IACD;AAIA,WAAO,aAAa;AAAA,EACrB;AAAA,EAEQ,gBAAgB,KAAwB;AAE/C,QAAI,OACF,WAAqC,yBAAyB,EAAE,GAC/D,aAAa,IAAI,QAAQ;AAAA,EAC7B;AACD;AArPM,4BAAN;AAAA,EAUG;AAAA,EACA;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EAEA;AAAA,EAEA;AAAA,GAnBG;AAuPN,SAAS;AAAA,EACR,oBAAoB;AACrB,EAAE;AAAA,EACD;AAAA,EACA,eAAe;AAChB;AAEA,SAAS,wBACR,OACA,UACA,KACA,kBAAkB,OAGN;AACZ,QAAM,UAAU;AAAA,IACf,SAAS;AAAA,IACT;AAAA,IACA,MAAM,eAAe,SAAS,UAAU;AAAA,IACxC;AAAA,EACD;AACA,MAAI,CAAC,WAAW,MAAM,qBAAqB,QAAQ,EAAE,MAAM;AAE1D;AAAA,EACD;AACA,MAAI,WAAW,iBAAiB;AAC/B,UAAM,aAAa,MAAM,qBAAqB;AAAA,MAC7C,YAAY,SAAS;AAAA,MACrB,QAAQ,QAAQ;AAAA,IACjB,CAAC;AACD,QAAI,WAAW,MAAM;AAEpB;AAAA,IACD;AAAA,EACD;AAEA,MAAI;AACJ,MAAI;AACJ,MAAI,SAAS;AACZ,aAAS,IAAI;AAAA,MACZ,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,SAAS;AAAA,IACV;AACA,cAAU,IAAI;AAAA,MACb,SAAS;AAAA,MACT,QAAQ;AAAA,MACR,SAAS;AAAA,MACT,QAAQ;AAAA,IACT;AAAA,EACD,OAAO;AACN,aAAS,UAAU,MAAM,cAAc,QAAQ;AAAA,EAChD;AAEA,SAAO,EAAE,QAAQ,SAAS,QAAQ;AACnC;AAjDS;AAmDT,IAAM,sBAAN,cAAkC,WAAW;AAAA;AAAA,EAM5C,YAEkB,yBAEA,mBAEA,sBACM,eACK,cAC3B;AACD,UAAM;AARW;AAEA;AAEA;AAMjB,SAAK;AAAA,MACJ,KAAK,wBAAwB,mBAAmB;AAAA,QAC/C;AAAA,UACC,QAAQ,cAAc;AAAA,UACtB,sBAAsB;AAAA,QACvB;AAAA,QACA;AAAA,UACC,mBAAmB;AAAA,UACnB,mBAAmB,CAAC,kBAAkB;AAAA,UACtC,wBAAwB,8BACvB,OACA,UACA,UACA,WACI;AACJ,kBAAM,YAAY,oBAAI,IAAuB;AAC7C,sBAAU,IAAI,kBAAkB,KAAK;AAErC,uBAAW,SAAS,OAAO,OAAO,iBAAiB,GAAG;AACrD,kBACC,OAAO,UAAU,YACjB,cAAc;AAAA,gBACb,+BAA+B,KAAK;AAAA,cACrC,GACC;AACD,0BAAU,IAAI,KAAK;AAAA,cACpB;AAAA,YACD;AAEA,kBAAM,SACL,KAAK,kBAAkB;AAAA,cACtB,MAAM;AAAA,YACP;AACD,gBAAI,CAAC,UAAU,CAAC,UAAU,IAAI,OAAO,QAAQ,GAAG;AAC/C,qBAAO;AAAA,YACR;AAEA,kBAAM,QAAQ;AAAA,cACb;AAAA,cACA;AAAA,cACA,oBAAoB;AAAA,cACpB;AAAA,YACD;AACA,gBAAI,CAAC,OAAO;AACX,qBAAO;AAAA,YACR;AAEA,kBAAM,YAAY,OAAO,YAAY,MAAM;AAAA,cAC1C,CAAC,MAAM,aAAa;AAAA,YACrB;AACA,kBAAM,gBAAgB,YACnB,UAAU,MAAM,SAAS,wBACzB;AAEH,kBAAM,gBAAgB,OAAO,YAAY,MAAM;AAAA,cAC9C,CAAC,MACA,aAAa;AAAA,YACf;AACA,kBAAM,oBAAoB,IAAI;AAAA,cAC7B,cAAc,IAAI,CAAC,MAAM,EAAE,YAAY;AAAA,YACxC;AACA,kBAAM,gBAAgB,MAAM;AAAA,cAC3B,KAAK,qBAAqB;AAAA,gBACzB,OAAO;AAAA,cACR;AAAA,YACD,EAEE,OAAO,CAAC,MAAM,CAAC,kBAAkB,IAAI,EAAE,IAAI,CAAC,EAC5C,OAAO,CAAC,MAAM,CAAC,EAAE,UAAU,aAAa,EACxC,IAAI,CAAC,MAAsB;AAC3B,oBAAM,aAAa,GAAG,kBAAkB,GAAG,EAAE,IAAI;AACjD,qBAAO;AAAA,gBACN,OAAO;AAAA,gBACP;AAAA,gBACA,YAAY,aAAa;AAAA,gBACzB,QAAQ,EAAE;AAAA,gBACV,MAAM,mBAAmB;AAAA;AAAA,gBACzB,UAAU;AAAA,cACX;AAAA,YACD,CAAC;AAEF,kBAAM,YAAY,OAAO,YAAY,MAAM;AAAA,cAC1C,CAAC,MACA,aAAa;AAAA,YACf;AACA,kBAAM,gBAAgB,IAAI;AAAA,cACzB,UAAU,IAAI,CAAC,MAAM,EAAE,QAAQ;AAAA,YAChC;AACA,kBAAM,YAA8B,CAAC;AACrC,gBACC,CAAC,aACD,UAAU,MAAM,wBACf;AACD,wBAAU;AAAA,gBACT,GAAG,MAAM,KAAK,aAAa,SAAS,CAAC,EACnC,OAAO,CAAC,MAAM,EAAE,oBAAoB,EACpC;AAAA,kBACA,CAAC,MAAM,CAAC,cAAc,IAAI,EAAE,QAAQ,EAAE;AAAA,gBACvC,EACC,IAAI,CAAC,MAAsB;AAC3B,wBAAM,aAAa,GAAG,kBAAkB,GAAG,EAAE,IAAI;AACjD,yBAAO;AAAA,oBACN,OAAO;AAAA,oBACP;AAAA,oBACA,YAAY,aAAa;AAAA,oBACzB,QAAQ,EAAE;AAAA,oBACV,MAAM,mBAAmB;AAAA,oBACzB,UAAU;AAAA,kBACX;AAAA,gBACD,CAAC;AAAA,cACH;AAAA,YACD;AAEA,mBAAO;AAAA,cACN,aAAa,CAAC,GAAG,eAAe,GAAG,SAAS;AAAA,YAC7C;AAAA,UACD,GA3GwB;AAAA,QA4GzB;AAAA,MACD;AAAA,IACD;AAAA,EACD;AAAA,EAp/BD,OA02B6C;AAAA;AAAA;AAAA,EAC5C,OAAwB,kBAAkB,IAAI;AAAA,IAC7C,GAAG,kBAAkB;AAAA,IACrB;AAAA,EACD;AAuID;AA3IM,sBAAN;AAAA,EAOG;AAAA,EAEA;AAAA,EAEA;AAAA,EAEA;AAAA,EACA;AAAA,GAdG;AA6IN,SAAS;AAAA,EACR,oBAAoB;AACrB,EAAE,8BAA8B,qBAAqB,eAAe,UAAU;",
  "names": []
}
