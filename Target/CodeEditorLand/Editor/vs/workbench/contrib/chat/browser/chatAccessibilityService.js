var d=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var c=(s,r,e,t)=>{for(var i=t>1?void 0:t?m(r,e):r,a=s.length-1,n;a>=0;a--)(n=s[a])&&(i=(t?n(r,e,i):n(i))||i);return t&&i&&d(r,e,i),i},o=(s,r)=>(e,t)=>r(e,t,s);import{status as u}from"../../../../base/browser/ui/aria/aria.js";import{Disposable as f,DisposableMap as I}from"../../../../base/common/lifecycle.js";import{AccessibilitySignal as p,IAccessibilitySignalService as v}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{IInstantiationService as _}from"../../../../platform/instantiation/common/instantiation.js";import{AccessibilityProgressSignalScheduler as y}from"../../../../platform/accessibilitySignal/browser/progressAccessibilitySignalScheduler.js";import"./chat.js";import"../common/chatViewModel.js";import{renderStringAsPlaintext as h}from"../../../../base/browser/markdownRenderer.js";import{MarkdownString as b}from"../../../../base/common/htmlContent.js";import{IConfigurationService as A}from"../../../../platform/configuration/common/configuration.js";import{AccessibilityVoiceSettingId as M}from"../../accessibility/browser/accessibilityConfiguration.js";const R=4e3;let l=class extends f{constructor(e,t,i){super();this._accessibilitySignalService=e;this._instantiationService=t;this._configurationService=i}_pendingSignalMap=this._register(new I);_requestId=0;acceptRequest(){return this._requestId++,this._accessibilitySignalService.playSignal(p.chatRequestSent,{allowManyInParallel:!0}),this._pendingSignalMap.set(this._requestId,this._instantiationService.createInstance(y,R,void 0)),this._requestId}acceptResponse(e,t,i){this._pendingSignalMap.deleteAndDispose(t);const a=typeof e!="string",n=typeof e=="string"?e:e?.response.toString();if(this._accessibilitySignalService.playSignal(p.chatResponseReceived,{allowManyInParallel:!0}),!e||!n)return;const S=a&&e.errorDetails?` ${e.errorDetails.message}`:"",g=h(new b(n));(!i||this._configurationService.getValue(M.AutoSynthesize)!=="on")&&u(g+S)}};l=c([o(0,v),o(1,_),o(2,A)],l);export{l as ChatAccessibilityService};
