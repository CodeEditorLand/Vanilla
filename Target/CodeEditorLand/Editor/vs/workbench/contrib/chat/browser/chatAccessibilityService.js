var g=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var c=(s,r,e,t)=>{for(var i=t>1?void 0:t?d(r,e):r,n=s.length-1,a;n>=0;n--)(a=s[n])&&(i=(t?a(r,e,i):a(i))||i);return t&&i&&g(r,e,i),i},o=(s,r)=>(e,t)=>r(e,t,s);import{status as m}from"../../../../base/browser/ui/aria/aria.js";import{Disposable as u,DisposableMap as f}from"../../../../base/common/lifecycle.js";import{AccessibilitySignal as p,IAccessibilitySignalService as I}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{IInstantiationService as v}from"../../../../platform/instantiation/common/instantiation.js";import{AccessibilityProgressSignalScheduler as _}from"../../../../platform/accessibilitySignal/browser/progressAccessibilitySignalScheduler.js";import{renderStringAsPlaintext as y}from"../../../../base/browser/markdownRenderer.js";import{MarkdownString as h}from"../../../../base/common/htmlContent.js";import{IConfigurationService as b}from"../../../../platform/configuration/common/configuration.js";import{AccessibilityVoiceSettingId as A}from"../../accessibility/browser/accessibilityConfiguration.js";const M=4e3;let l=class extends u{constructor(e,t,i){super();this._accessibilitySignalService=e;this._instantiationService=t;this._configurationService=i}_pendingSignalMap=this._register(new f);_requestId=0;acceptRequest(){return this._requestId++,this._accessibilitySignalService.playSignal(p.chatRequestSent,{allowManyInParallel:!0}),this._pendingSignalMap.set(this._requestId,this._instantiationService.createInstance(_,M,void 0)),this._requestId}acceptResponse(e,t){this._pendingSignalMap.deleteAndDispose(t);const i=typeof e!="string",n=typeof e=="string"?e:e?.response.toString();if(this._accessibilitySignalService.playSignal(p.chatResponseReceived,{allowManyInParallel:!0}),!e||!n)return;const a=i&&e.errorDetails?` ${e.errorDetails.message}`:"",S=y(new h(n));this._configurationService.getValue(A.AutoSynthesize)!=="on"&&m(S+a)}};l=c([o(0,I),o(1,v),o(2,b)],l);export{l as ChatAccessibilityService};
