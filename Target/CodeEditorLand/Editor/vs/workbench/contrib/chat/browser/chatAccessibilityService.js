var g=Object.defineProperty;var m=Object.getOwnPropertyDescriptor;var c=(s,n,e,t)=>{for(var i=t>1?void 0:t?m(n,e):n,a=s.length-1,r;a>=0;a--)(r=s[a])&&(i=(t?r(n,e,i):r(i))||i);return t&&i&&g(n,e,i),i},o=(s,n)=>(e,t)=>n(e,t,s);import{renderStringAsPlaintext as u}from"../../../../base/browser/markdownRenderer.js";import{status as f}from"../../../../base/browser/ui/aria/aria.js";import{MarkdownString as y}from"../../../../base/common/htmlContent.js";import{Disposable as I,DisposableMap as v}from"../../../../base/common/lifecycle.js";import{AccessibilitySignal as p,IAccessibilitySignalService as _}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{AccessibilityProgressSignalScheduler as h}from"../../../../platform/accessibilitySignal/browser/progressAccessibilitySignalScheduler.js";import{IConfigurationService as b}from"../../../../platform/configuration/common/configuration.js";import{IInstantiationService as M}from"../../../../platform/instantiation/common/instantiation.js";import{AccessibilityVoiceSettingId as A}from"../../accessibility/browser/accessibilityConfiguration.js";const R=4e3;let l=class extends I{constructor(e,t,i){super();this._accessibilitySignalService=e;this._instantiationService=t;this._configurationService=i}_pendingSignalMap=this._register(new v);_requestId=0;acceptRequest(){return this._requestId++,this._accessibilitySignalService.playSignal(p.chatRequestSent,{allowManyInParallel:!0}),this._pendingSignalMap.set(this._requestId,this._instantiationService.createInstance(h,R,void 0)),this._requestId}acceptResponse(e,t,i){this._pendingSignalMap.deleteAndDispose(t);const a=typeof e!="string",r=typeof e=="string"?e:e?.response.toString();if(this._accessibilitySignalService.playSignal(p.chatResponseReceived,{allowManyInParallel:!0}),!e||!r)return;const S=a&&e.errorDetails?` ${e.errorDetails.message}`:"",d=u(new y(r));(!i||this._configurationService.getValue(A.AutoSynthesize)!=="on")&&f(d+S)}};l=c([o(0,_),o(1,M),o(2,b)],l);export{l as ChatAccessibilityService};
