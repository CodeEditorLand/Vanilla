var C=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var g=(m,l,o,e)=>{for(var t=e>1?void 0:e?N(l,o):l,r=m.length-1,i;r>=0;r--)(i=m[r])&&(t=(e?i(l,o,t):i(t))||t);return e&&t&&C(l,o,t),t},v=(m,l)=>(o,e)=>l(o,e,m);import*as s from"../../../../../base/browser/dom.js";import{Emitter as A}from"../../../../../base/common/event.js";import{Disposable as S,DisposableStore as D}from"../../../../../base/common/lifecycle.js";import{basename as E,dirname as $}from"../../../../../base/common/path.js";import{URI as I}from"../../../../../base/common/uri.js";import{Range as O}from"../../../../../editor/common/core/range.js";import{localize as c}from"../../../../../nls.js";import{FileKind as w}from"../../../../../platform/files/common/files.js";import{IInstantiationService as F}from"../../../../../platform/instantiation/common/instantiation.js";import{IOpenerService as V}from"../../../../../platform/opener/common/opener.js";import{ResourceLabels as _}from"../../../../browser/labels.js";import{ChatResponseReferencePartStatusKind as R}from"../../common/chatService.js";let b=class extends S{constructor(o,e=[],t=s.$(".chat-attached-context"),r,i){super();this.variables=o;this.contentReferences=e;this.domNode=t;this.instantiationService=r;this.openerService=i;this.initAttachedContext(t)}attachedContextDisposables=this._register(new D);_onDidChangeVisibility=this._register(new A);_contextResourceLabels=this.instantiationService.createInstance(_,{onDidChangeVisibility:this._onDidChangeVisibility.event});initAttachedContext(o){s.clearNode(o),this.attachedContextDisposables.clear(),s.setVisibility(!!this.variables.length,this.domNode),this.variables.forEach(e=>{const t=s.append(o,s.$(".chat-attached-context-attachment.show-file-icons")),r=this._contextResourceLabels.create(t,{supportIcons:!0}),i=I.isUri(e.value)?e.value:e.value&&typeof e.value=="object"&&"uri"in e.value&&I.isUri(e.value.uri)?e.value.uri:void 0,n=e.value&&typeof e.value=="object"&&"range"in e.value&&O.isIRange(e.value.range)?e.value.range:void 0,f=this.contentReferences.find(a=>typeof a.reference=="object"&&"variableName"in a.reference&&a.reference.variableName===e.name),y=f?.options?.status?.kind===R.Omitted,h=y||f?.options?.status?.kind===R.Partial;if(i){const a=E(i.path),d=$(i.path),p=`${a} ${d}`;let u;y?u=n?c("chat.omittedFileAttachmentWithRange","Omitted: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.omittedFileAttachment","Omitted: {0}.",p):h?u=n?c("chat.partialFileAttachmentWithRange","Partially attached: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.partialFileAttachment","Partially attached: {0}.",p):u=n?c("chat.fileAttachmentWithRange3","Attached: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.fileAttachment3","Attached: {0}.",p),r.setFile(i,{fileKind:w.FILE,hidePath:!0,range:n,title:f?.options?.status?.description}),t.ariaLabel=u,t.tabIndex=0,t.style.cursor="pointer",this.attachedContextDisposables.add(s.addDisposableListener(t,s.EventType.CLICK,async x=>{s.EventHelper.stop(x,!0),i&&this.openerService.open(i,{fromUserGesture:!0,editorOptions:{selection:n}})}))}else{const a=e.fullName??e.name,d=e.icon?.id?`$(${e.icon.id}) ${a}`:a;r.setLabel(d,f?.options?.status?.description),t.ariaLabel=c("chat.attachment3","Attached context: {0}.",e.name),t.tabIndex=0}h&&t.classList.add("warning");const L=f?.options?.status?.description;if(h){t.ariaLabel=`${t.ariaLabel}${L?` ${L}`:""}`;for(const a of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const d=r.element.querySelector(a);d&&d.classList.add("warning")}}})}};b=g([v(3,F),v(4,V)],b);export{b as ChatAttachmentsContentPart};
