var C=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var g=(m,l,r,e)=>{for(var t=e>1?void 0:e?N(l,r):l,o=m.length-1,i;o>=0;o--)(i=m[o])&&(t=(e?i(l,r,t):i(t))||t);return e&&t&&C(l,r,t),t},v=(m,l)=>(r,e)=>l(r,e,m);import*as s from"../../../../../base/browser/dom.js";import{Disposable as A,DisposableStore as S}from"../../../../../base/common/lifecycle.js";import"../../common/chatModel.js";import{Emitter as D}from"../../../../../base/common/event.js";import{IInstantiationService as E}from"../../../../../platform/instantiation/common/instantiation.js";import{ResourceLabels as $}from"../../../../browser/labels.js";import{URI as I}from"../../../../../base/common/uri.js";import{FileKind as O}from"../../../../../platform/files/common/files.js";import{Range as w}from"../../../../../editor/common/core/range.js";import{basename as F,dirname as V}from"../../../../../base/common/path.js";import{localize as c}from"../../../../../nls.js";import{ChatResponseReferencePartStatusKind as R}from"../../common/chatService.js";import{IOpenerService as _}from"../../../../../platform/opener/common/opener.js";let b=class extends A{constructor(r,e=[],t=s.$(".chat-attached-context"),o,i){super();this.variables=r;this.contentReferences=e;this.domNode=t;this.instantiationService=o;this.openerService=i;this.initAttachedContext(t)}attachedContextDisposables=this._register(new S);_onDidChangeVisibility=this._register(new D);_contextResourceLabels=this.instantiationService.createInstance($,{onDidChangeVisibility:this._onDidChangeVisibility.event});initAttachedContext(r){s.clearNode(r),this.attachedContextDisposables.clear(),s.setVisibility(!!this.variables.length,this.domNode),this.variables.forEach(e=>{const t=s.append(r,s.$(".chat-attached-context-attachment.show-file-icons")),o=this._contextResourceLabels.create(t,{supportIcons:!0}),i=I.isUri(e.value)?e.value:e.value&&typeof e.value=="object"&&"uri"in e.value&&I.isUri(e.value.uri)?e.value.uri:void 0,n=e.value&&typeof e.value=="object"&&"range"in e.value&&w.isIRange(e.value.range)?e.value.range:void 0,f=this.contentReferences.find(a=>typeof a.reference=="object"&&"variableName"in a.reference&&a.reference.variableName===e.name),y=f?.options?.status?.kind===R.Omitted,h=y||f?.options?.status?.kind===R.Partial;if(i){const a=F(i.path),d=V(i.path),p=`${a} ${d}`;let u;y?u=n?c("chat.omittedFileAttachmentWithRange","Omitted: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.omittedFileAttachment","Omitted: {0}.",p):h?u=n?c("chat.partialFileAttachmentWithRange","Partially attached: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.partialFileAttachment","Partially attached: {0}.",p):u=n?c("chat.fileAttachmentWithRange3","Attached: {0}, line {1} to line {2}.",p,n.startLineNumber,n.endLineNumber):c("chat.fileAttachment3","Attached: {0}.",p),o.setFile(i,{fileKind:O.FILE,hidePath:!0,range:n,title:f?.options?.status?.description}),t.ariaLabel=u,t.tabIndex=0,t.style.cursor="pointer",this.attachedContextDisposables.add(s.addDisposableListener(t,s.EventType.CLICK,async x=>{s.EventHelper.stop(x,!0),i&&this.openerService.open(i,{fromUserGesture:!0,editorOptions:{selection:n}})}))}else{const a=e.fullName??e.name,d=e.icon?.id?`$(${e.icon.id}) ${a}`:a;o.setLabel(d,f?.options?.status?.description),t.ariaLabel=c("chat.attachment3","Attached context: {0}.",e.name),t.tabIndex=0}h&&t.classList.add("warning");const L=f?.options?.status?.description;if(h){t.ariaLabel=`${t.ariaLabel}${L?` ${L}`:""}`;for(const a of[".monaco-icon-suffix-container",".monaco-icon-name-container"]){const d=o.element.querySelector(a);d&&d.classList.add("warning")}}})}};b=g([v(3,E),v(4,_)],b);export{b as ChatAttachmentsContentPart};
