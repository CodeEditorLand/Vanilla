var I=Object.defineProperty;var R=Object.getOwnPropertyDescriptor;var B=(h,e,r,s)=>{for(var i=s>1?void 0:s?R(e,r):e,c=h.length-1,d;c>=0;c--)(d=h[c])&&(i=(s?d(e,r,i):d(i))||i);return s&&i&&I(e,r,i),i},a=(h,e)=>(r,s)=>e(r,s,h);import{isFullscreen as C,onDidChangeFullscreen as f}from"../../../../base/browser/browser.js";import*as S from"../../../../base/browser/dom.js";import{mainWindow as o}from"../../../../base/browser/window.js";import{Color as A}from"../../../../base/common/color.js";import{Event as g}from"../../../../base/common/event.js";import{DisposableStore as y,MutableDisposable as E}from"../../../../base/common/lifecycle.js";import*as D from"../../../../base/common/performance.js";import{assertIsDefined as m}from"../../../../base/common/types.js";import{IConfigurationService as b}from"../../../../platform/configuration/common/configuration.js";import{editorBackground as p,foreground as W}from"../../../../platform/theme/common/colorRegistry.js";import{getThemeTypeSelector as w,IThemeService as L}from"../../../../platform/theme/common/themeService.js";import{TitleBarSetting as O}from"../../../../platform/window/common/window.js";import{DEFAULT_EDITOR_MIN_DIMENSIONS as P}from"../../../browser/parts/editor/editor.js";import*as t from"../../../common/theme.js";import{IEditorGroupsService as N}from"../../../services/editor/common/editorGroupsService.js";import{IWorkbenchEnvironmentService as k}from"../../../services/environment/common/environmentService.js";import{IWorkbenchLayoutService as U,Parts as n,Position as V}from"../../../services/layout/browser/layoutService.js";import{ILifecycleService as G,LifecyclePhase as H}from"../../../services/lifecycle/common/lifecycle.js";import{ISplashStorageService as K}from"./splash.js";let l=class{constructor(e,r,s,i,c,d,u){this._themeService=e;this._layoutService=r;this._environmentService=s;this._configService=i;this._partSplashService=c;g.once(r.onDidLayoutMainContainer)(()=>{this._removePartsSplash(),D.mark("code/didRemovePartsSplash")},void 0,this._disposables);const T=this._disposables.add(new E),v=()=>{T.value=S.runWhenWindowIdle(o,()=>this._savePartsSplash(),2500)};u.when(H.Restored).then(()=>{g.any(g.filter(f,_=>_===o.vscodeWindowId),d.mainPart.onDidLayout,e.onDidColorThemeChange)(v,void 0,this._disposables),v()}),i.onDidChangeConfiguration(_=>{_.affectsConfiguration(O.TITLE_BAR_STYLE)&&(this._didChangeTitleBarStyle=!0,this._savePartsSplash())},this,this._disposables)}static ID="workbench.contrib.partsSplash";static _splashElementId="monaco-parts-splash";_disposables=new y;_didChangeTitleBarStyle;dispose(){this._disposables.dispose()}_savePartsSplash(){const e=this._themeService.getColorTheme();this._partSplashService.saveWindowSplash({zoomLevel:this._configService.getValue("window.zoomLevel"),baseTheme:w(e.type),colorInfo:{foreground:e.getColor(W)?.toString(),background:A.Format.CSS.formatHex(e.getColor(p)||t.WORKBENCH_BACKGROUND(e)),editorBackground:e.getColor(p)?.toString(),titleBarBackground:e.getColor(t.TITLE_BAR_ACTIVE_BACKGROUND)?.toString(),titleBarBorder:e.getColor(t.TITLE_BAR_BORDER)?.toString(),activityBarBackground:e.getColor(t.ACTIVITY_BAR_BACKGROUND)?.toString(),activityBarBorder:e.getColor(t.ACTIVITY_BAR_BORDER)?.toString(),sideBarBackground:e.getColor(t.SIDE_BAR_BACKGROUND)?.toString(),sideBarBorder:e.getColor(t.SIDE_BAR_BORDER)?.toString(),statusBarBackground:e.getColor(t.STATUS_BAR_BACKGROUND)?.toString(),statusBarBorder:e.getColor(t.STATUS_BAR_BORDER)?.toString(),statusBarNoFolderBackground:e.getColor(t.STATUS_BAR_NO_FOLDER_BACKGROUND)?.toString(),windowBorder:e.getColor(t.WINDOW_ACTIVE_BORDER)?.toString()??e.getColor(t.WINDOW_INACTIVE_BORDER)?.toString()},layoutInfo:this._shouldSaveLayoutInfo()?{sideBarSide:this._layoutService.getSideBarPosition()===V.RIGHT?"right":"left",editorPartMinWidth:P.width,titleBarHeight:this._layoutService.isVisible(n.TITLEBAR_PART,o)?S.getTotalHeight(m(this._layoutService.getContainer(o,n.TITLEBAR_PART))):0,activityBarWidth:this._layoutService.isVisible(n.ACTIVITYBAR_PART)?S.getTotalWidth(m(this._layoutService.getContainer(o,n.ACTIVITYBAR_PART))):0,sideBarWidth:this._layoutService.isVisible(n.SIDEBAR_PART)?S.getTotalWidth(m(this._layoutService.getContainer(o,n.SIDEBAR_PART))):0,statusBarHeight:this._layoutService.isVisible(n.STATUSBAR_PART,o)?S.getTotalHeight(m(this._layoutService.getContainer(o,n.STATUSBAR_PART))):0,windowBorder:this._layoutService.hasMainWindowBorder(),windowBorderRadius:this._layoutService.getMainWindowBorderRadius()}:void 0})}_shouldSaveLayoutInfo(){return!C(o)&&!this._environmentService.isExtensionDevelopment&&!this._didChangeTitleBarStyle}_removePartsSplash(){const e=o.document.getElementById(l._splashElementId);e&&(e.style.display="none"),o.document.head.getElementsByClassName("initialShellColors")[0]?.remove()}};l=B([a(0,L),a(1,U),a(2,k),a(3,b),a(4,K),a(5,N),a(6,G)],l);export{l as PartsSplash};
