var I=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var g=(h,e,i,s)=>{for(var o=s>1?void 0:s?f(e,i):e,c=h.length-1,d;c>=0;c--)(d=h[c])&&(o=(s?d(e,i,o):d(o))||o);return s&&o&&I(e,i,o),o},r=(h,e)=>(i,s)=>e(i,s,h);import{isFullscreen as C,onDidChangeFullscreen as y}from"../../../../../vs/base/browser/browser.js";import*as S from"../../../../../vs/base/browser/dom.js";import{mainWindow as t}from"../../../../../vs/base/browser/window.js";import{Color as R}from"../../../../../vs/base/common/color.js";import{Event as _}from"../../../../../vs/base/common/event.js";import{DisposableStore as A,MutableDisposable as E}from"../../../../../vs/base/common/lifecycle.js";import*as D from"vs/base/common/performance";import{assertIsDefined as m}from"../../../../../vs/base/common/types.js";import{IConfigurationService as b}from"../../../../../vs/platform/configuration/common/configuration.js";import{editorBackground as u,foreground as W}from"../../../../../vs/platform/theme/common/colorRegistry.js";import{getThemeTypeSelector as w,IThemeService as L}from"../../../../../vs/platform/theme/common/themeService.js";import{TitleBarSetting as P}from"../../../../../vs/platform/window/common/window.js";import{DEFAULT_EDITOR_MIN_DIMENSIONS as N}from"../../../../../vs/workbench/browser/parts/editor/editor.js";import*as a from"../../../../../vs/workbench/common/theme.js";import{ISplashStorageService as O}from"../../../../../vs/workbench/contrib/splash/browser/splash.js";import{IEditorGroupsService as k}from"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import{IWorkbenchEnvironmentService as U}from"../../../../../vs/workbench/services/environment/common/environmentService.js";import{IWorkbenchLayoutService as V,Parts as n,Position as G}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";import{ILifecycleService as H,LifecyclePhase as K}from"../../../../../vs/workbench/services/lifecycle/common/lifecycle.js";let l=class{constructor(e,i,s,o,c,d,B){this._themeService=e;this._layoutService=i;this._environmentService=s;this._configService=o;this._partSplashService=c;_.once(i.onDidLayoutMainContainer)(()=>{this._removePartsSplash(),D.mark("code/didRemovePartsSplash")},void 0,this._disposables);const T=this._disposables.add(new E),p=()=>{T.value=S.runWhenWindowIdle(t,()=>this._savePartsSplash(),2500)};B.when(K.Restored).then(()=>{_.any(_.filter(y,v=>v===t.vscodeWindowId),d.mainPart.onDidLayout,e.onDidColorThemeChange)(p,void 0,this._disposables),p()}),o.onDidChangeConfiguration(v=>{v.affectsConfiguration(P.TITLE_BAR_STYLE)&&(this._didChangeTitleBarStyle=!0,this._savePartsSplash())},this,this._disposables)}static ID="workbench.contrib.partsSplash";static _splashElementId="monaco-parts-splash";_disposables=new A;_didChangeTitleBarStyle;dispose(){this._disposables.dispose()}_savePartsSplash(){const e=this._themeService.getColorTheme();this._partSplashService.saveWindowSplash({zoomLevel:this._configService.getValue("window.zoomLevel"),baseTheme:w(e.type),colorInfo:{foreground:e.getColor(W)?.toString(),background:R.Format.CSS.formatHex(e.getColor(u)||a.WORKBENCH_BACKGROUND(e)),editorBackground:e.getColor(u)?.toString(),titleBarBackground:e.getColor(a.TITLE_BAR_ACTIVE_BACKGROUND)?.toString(),activityBarBackground:e.getColor(a.ACTIVITY_BAR_BACKGROUND)?.toString(),sideBarBackground:e.getColor(a.SIDE_BAR_BACKGROUND)?.toString(),statusBarBackground:e.getColor(a.STATUS_BAR_BACKGROUND)?.toString(),statusBarNoFolderBackground:e.getColor(a.STATUS_BAR_NO_FOLDER_BACKGROUND)?.toString(),windowBorder:e.getColor(a.WINDOW_ACTIVE_BORDER)?.toString()??e.getColor(a.WINDOW_INACTIVE_BORDER)?.toString()},layoutInfo:this._shouldSaveLayoutInfo()?{sideBarSide:this._layoutService.getSideBarPosition()===G.RIGHT?"right":"left",editorPartMinWidth:N.width,titleBarHeight:this._layoutService.isVisible(n.TITLEBAR_PART,t)?S.getTotalHeight(m(this._layoutService.getContainer(t,n.TITLEBAR_PART))):0,activityBarWidth:this._layoutService.isVisible(n.ACTIVITYBAR_PART)?S.getTotalWidth(m(this._layoutService.getContainer(t,n.ACTIVITYBAR_PART))):0,sideBarWidth:this._layoutService.isVisible(n.SIDEBAR_PART)?S.getTotalWidth(m(this._layoutService.getContainer(t,n.SIDEBAR_PART))):0,statusBarHeight:this._layoutService.isVisible(n.STATUSBAR_PART,t)?S.getTotalHeight(m(this._layoutService.getContainer(t,n.STATUSBAR_PART))):0,windowBorder:this._layoutService.hasMainWindowBorder(),windowBorderRadius:this._layoutService.getMainWindowBorderRadius()}:void 0})}_shouldSaveLayoutInfo(){return!C(t)&&!this._environmentService.isExtensionDevelopment&&!this._didChangeTitleBarStyle}_removePartsSplash(){const e=t.document.getElementById(l._splashElementId);e&&(e.style.display="none"),t.document.head.getElementsByClassName("initialShellColors")[0]?.remove()}};l=g([r(0,L),r(1,V),r(2,U),r(3,b),r(4,O),r(5,k),r(6,H)],l);export{l as PartsSplash};
