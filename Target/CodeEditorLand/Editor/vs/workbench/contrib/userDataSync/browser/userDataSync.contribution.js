var l=Object.defineProperty;var b=Object.getOwnPropertyDescriptor;var S=(s,i,e,t)=>{for(var r=t>1?void 0:t?b(i,e):i,a=s.length-1,m;a>=0;a--)(m=s[a])&&(r=(t?m(i,e,r):m(r))||r);return t&&r&&l(i,e,r),r},n=(s,i)=>(e,t)=>i(e,t,s);import{Action as d}from"../../../../base/common/actions.js";import{Disposable as I}from"../../../../base/common/lifecycle.js";import{isWeb as p}from"../../../../base/common/platform.js";import{localize as o}from"../../../../nls.js";import{ICommandService as k}from"../../../../platform/commands/common/commands.js";import{INotificationService as w,Severity as h}from"../../../../platform/notification/common/notification.js";import{IProductService as C}from"../../../../platform/product/common/productService.js";import{Registry as E}from"../../../../platform/registry/common/platform.js";import{IUserDataAutoSyncService as W,UserDataSyncErrorCode as v}from"../../../../platform/userDataSync/common/userDataSync.js";import{Extensions as L}from"../../../common/contributions.js";import{IHostService as q}from"../../../services/host/browser/host.js";import{LifecyclePhase as y}from"../../../services/lifecycle/common/lifecycle.js";import{SHOW_SYNC_LOG_COMMAND_ID as f}from"../../../services/userDataSync/common/userDataSync.js";import{UserDataSyncWorkbenchContribution as D}from"./userDataSync.js";import{UserDataSyncTrigger as R}from"./userDataSyncTrigger.js";let c=class extends I{constructor(e,t,r,a,m){super();this.notificationService=t;this.productService=r;this.commandService=a;this.hostService=m;this._register(e.onError(g=>this.onAutoSyncError(g)))}onAutoSyncError(e){switch(e.code){case v.LocalTooManyRequests:{const t=p?o({key:"local too many requests - reload",comment:["Settings Sync is the name of the feature"]},"Settings sync is suspended temporarily because the current device is making too many requests. Please reload {0} to resume.",this.productService.nameLong):o({key:"local too many requests - restart",comment:["Settings Sync is the name of the feature"]},"Settings sync is suspended temporarily because the current device is making too many requests. Please restart {0} to resume.",this.productService.nameLong);this.notificationService.notify({severity:h.Error,message:t,actions:{primary:[new d("Show Sync Logs",o("show sync logs","Show Log"),void 0,!0,()=>this.commandService.executeCommand(f)),new d("Restart",p?o("reload","Reload"):o("restart","Restart"),void 0,!0,()=>this.hostService.restart())]}});return}case v.TooManyRequests:{const t=e.operationId?o("operationId","Operation Id: {0}",e.operationId):void 0,r=o({key:"server too many requests",comment:["Settings Sync is the name of the feature"]},"Settings sync is disabled because the current device is making too many requests. Please wait for 10 minutes and turn on sync.");this.notificationService.notify({severity:h.Error,message:t?`${r} ${t}`:r,source:e.operationId?o("settings sync","Settings Sync. Operation Id: {0}",e.operationId):void 0,actions:{primary:[new d("Show Sync Logs",o("show sync logs","Show Log"),void 0,!0,()=>this.commandService.executeCommand(f))]}});return}}}};c=S([n(0,W),n(1,w),n(2,C),n(3,k),n(4,q)],c);const u=E.as(L.Workbench);u.registerWorkbenchContribution(D,y.Restored),u.registerWorkbenchContribution(R,y.Eventually),u.registerWorkbenchContribution(c,y.Eventually);
