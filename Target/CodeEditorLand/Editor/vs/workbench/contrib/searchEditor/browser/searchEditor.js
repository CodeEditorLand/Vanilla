var q=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var x=(g,p,e,t)=>{for(var i=t>1?void 0:t?O(p,e):p,o=g.length-1,u;o>=0;o--)(u=g[o])&&(i=(t?u(p,e,i):u(i))||i);return t&&i&&q(p,e,i),i},c=(g,p)=>(e,t)=>p(e,t,g);import*as s from"../../../../../vs/base/browser/dom.js";import{StandardKeyboardEvent as C}from"../../../../../vs/base/browser/keyboardEvent.js";import{alert as F}from"../../../../../vs/base/browser/ui/aria/aria.js";import{Delayer as R}from"../../../../../vs/base/common/async.js";import"../../../../../vs/base/common/cancellation.js";import{KeyCode as v,KeyMod as B}from"../../../../../vs/base/common/keyCodes.js";import{DisposableStore as k}from"../../../../../vs/base/common/lifecycle.js";import{assertIsDefined as V}from"../../../../../vs/base/common/types.js";import"../../../../../vs/base/common/uri.js";import"vs/css!./media/searchEditor";import{getDefaultHoverDelegate as _}from"../../../../../vs/base/browser/ui/hover/hoverDelegateFactory.js";import{ThemeIcon as H}from"../../../../../vs/base/common/themables.js";import{EditorExtensionsRegistry as N}from"../../../../../vs/editor/browser/editorExtensions.js";import"../../../../../vs/editor/browser/widget/codeEditor/codeEditorWidget.js";import{Position as E}from"../../../../../vs/editor/common/core/position.js";import{Range as I}from"../../../../../vs/editor/common/core/range.js";import{Selection as b}from"../../../../../vs/editor/common/core/selection.js";import"../../../../../vs/editor/common/editorCommon.js";import{IModelService as A}from"../../../../../vs/editor/common/services/model.js";import{ITextResourceConfigurationService as Q}from"../../../../../vs/editor/common/services/textResourceConfiguration.js";import{ReferencesController as K}from"../../../../../vs/editor/contrib/gotoSymbol/browser/peek/referencesController.js";import{UnusualLineTerminatorsDetector as U}from"../../../../../vs/editor/contrib/unusualLineTerminators/browser/unusualLineTerminators.js";import{localize as m}from"../../../../../vs/nls.js";import{ICommandService as $}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as G}from"../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as Y}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextViewService as z}from"../../../../../vs/platform/contextview/browser/contextView.js";import"../../../../../vs/platform/editor/common/editor.js";import{IFileService as J}from"../../../../../vs/platform/files/common/files.js";import{IHoverService as X}from"../../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as j}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{ServiceCollection as Z}from"../../../../../vs/platform/instantiation/common/serviceCollection.js";import{ILabelService as ee}from"../../../../../vs/platform/label/common/label.js";import{ILogService as te}from"../../../../../vs/platform/log/common/log.js";import{INotificationService as ie}from"../../../../../vs/platform/notification/common/notification.js";import{IOpenerService as re}from"../../../../../vs/platform/opener/common/opener.js";import{IEditorProgressService as se,LongRunningOperation as oe}from"../../../../../vs/platform/progress/common/progress.js";import{IStorageService as ne}from"../../../../../vs/platform/storage/common/storage.js";import{ITelemetryService as ae}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{defaultToggleStyles as ue,getInputBoxStyle as ce}from"../../../../../vs/platform/theme/browser/defaultStyles.js";import{inputBorder as de,registerColor as le}from"../../../../../vs/platform/theme/common/colorRegistry.js";import{IThemeService as he}from"../../../../../vs/platform/theme/common/themeService.js";import{IWorkspaceContextService as ge}from"../../../../../vs/platform/workspace/common/workspace.js";import{AbstractTextCodeEditor as pe}from"../../../../../vs/workbench/browser/parts/editor/textCodeEditor.js";import{EditorInputCapabilities as fe}from"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/common/editor/editorInput.js";import{ExcludePatternInputWidget as me,IncludePatternInputWidget as Se}from"../../../../../vs/workbench/contrib/search/browser/patternInputWidget.js";import{searchDetailsIcon as Ee}from"../../../../../vs/workbench/contrib/search/browser/searchIcons.js";import{renderSearchMessage as Ie}from"../../../../../vs/workbench/contrib/search/browser/searchMessage.js";import{SearchModel as ve}from"../../../../../vs/workbench/contrib/search/browser/searchModel.js";import{SearchWidget as ye}from"../../../../../vs/workbench/contrib/search/browser/searchWidget.js";import{SearchContext as xe}from"../../../../../vs/workbench/contrib/search/common/constants.js";import{getOutOfWorkspaceEditorResources as Ce}from"../../../../../vs/workbench/contrib/search/common/search.js";import{InSearchEditor as Re,SearchEditorID as be,SearchEditorInputTypeId as W}from"../../../../../vs/workbench/contrib/searchEditor/browser/constants.js";import{serializeSearchResultForEditor as We}from"../../../../../vs/workbench/contrib/searchEditor/browser/searchEditorSerialization.js";import{IEditorGroupsService as Le}from"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import{IEditorService as Te}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{QueryBuilder as Pe}from"../../../../../vs/workbench/services/search/common/queryBuilder.js";import{SearchSortOrder as we}from"../../../../../vs/workbench/services/search/common/search.js";import"../../../../../vs/workbench/services/search/common/searchExtTypes.js";const L=/^(\s+)(\d+)(: |  )(\s*)(.*)$/,T=/^(\S.*):$/;let S=class extends pe{constructor(e,t,i,o,u,h,d,a,f,r,n,l,y,P,w,D,Oe,M,Fe,Be){super(S.ID,e,t,a,o,P,i,D,w,M);this.modelService=u;this.contextService=h;this.labelService=d;this.contextViewService=f;this.commandService=r;this.openerService=n;this.notificationService=l;this.configurationService=Oe;this.logService=Fe;this.hoverService=Be;this.container=s.$(".search-editor"),this.searchOperation=this._register(new oe(y)),this._register(this.messageDisposables=new k),this.searchHistoryDelayer=new R(2e3),this.searchModel=this._register(this.instantiationService.createInstance(ve))}static ID=be;static SEARCH_EDITOR_VIEW_STATE_PREFERENCE_KEY="searchEditorViewState";queryEditorWidget;get searchResultEditor(){return this.editorControl}queryEditorContainer;dimension;inputPatternIncludes;inputPatternExcludes;includesExcludesContainer;toggleQueryDetailsButton;messageBox;runSearchDelayer=new R(0);pauseSearching=!1;showingIncludesExcludes=!1;searchOperation;searchHistoryDelayer;messageDisposables;container;searchModel;ongoingOperations=0;updatingModelForSearch=!1;createEditor(e){s.append(e,this.container),this.queryEditorContainer=s.append(this.container,s.$(".query-container"));const t=s.append(this.container,s.$(".search-results"));super.createEditor(t),this.registerEditorListeners();const i=V(this.scopedContextKeyService);Re.bindTo(i).set(!0),this.createQueryEditor(this.queryEditorContainer,this._register(this.instantiationService.createChild(new Z([Y,i]))),xe.InputBoxFocusedKey.bindTo(i))}createQueryEditor(e,t,i){const o=ce({inputBorder:De});this.queryEditorWidget=this._register(t.createInstance(ye,e,{_hideReplaceToggle:!0,showContextToggle:!0,inputBoxStyles:o,toggleStyles:ue})),this._register(this.queryEditorWidget.onReplaceToggled(()=>this.reLayout())),this._register(this.queryEditorWidget.onDidHeightChange(()=>this.reLayout())),this._register(this.queryEditorWidget.onSearchSubmit(({delay:r})=>this.triggerSearch({delay:r}))),this.queryEditorWidget.searchInput?this._register(this.queryEditorWidget.searchInput.onDidOptionChange(()=>this.triggerSearch({resetCursor:!1}))):this.logService.warn("SearchEditor: SearchWidget.searchInput is undefined, cannot register onDidOptionChange listener"),this._register(this.queryEditorWidget.onDidToggleContext(()=>this.triggerSearch({resetCursor:!1}))),this.includesExcludesContainer=s.append(e,s.$(".includes-excludes"));const u=m("moreSearch","Toggle Search Details");this.toggleQueryDetailsButton=s.append(this.includesExcludesContainer,s.$(".expand"+H.asCSSSelector(Ee),{tabindex:0,role:"button","aria-label":u})),this._register(this.hoverService.setupManagedHover(_("element"),this.toggleQueryDetailsButton,u)),this._register(s.addDisposableListener(this.toggleQueryDetailsButton,s.EventType.CLICK,r=>{s.EventHelper.stop(r),this.toggleIncludesExcludes()})),this._register(s.addDisposableListener(this.toggleQueryDetailsButton,s.EventType.KEY_UP,r=>{const n=new C(r);(n.equals(v.Enter)||n.equals(v.Space))&&(s.EventHelper.stop(r),this.toggleIncludesExcludes())})),this._register(s.addDisposableListener(this.toggleQueryDetailsButton,s.EventType.KEY_DOWN,r=>{new C(r).equals(B.Shift|v.Tab)&&(this.queryEditorWidget.isReplaceActive()?this.queryEditorWidget.focusReplaceAllAction():this.queryEditorWidget.isReplaceShown()?this.queryEditorWidget.replaceInput?.focusOnPreserve():this.queryEditorWidget.focusRegexAction(),s.EventHelper.stop(r))}));const h=s.append(this.includesExcludesContainer,s.$(".file-types.includes")),d=m("searchScope.includes","files to include");s.append(h,s.$("h4",void 0,d)),this.inputPatternIncludes=this._register(t.createInstance(Se,h,this.contextViewService,{ariaLabel:m("label.includes","Search Include Patterns"),inputBoxStyles:o})),this.inputPatternIncludes.onSubmit(r=>this.triggerSearch({resetCursor:!1,delay:r?this.searchConfig.searchOnTypeDebouncePeriod:0})),this._register(this.inputPatternIncludes.onChangeSearchInEditorsBox(()=>this.triggerSearch()));const a=s.append(this.includesExcludesContainer,s.$(".file-types.excludes")),f=m("searchScope.excludes","files to exclude");s.append(a,s.$("h4",void 0,f)),this.inputPatternExcludes=this._register(t.createInstance(me,a,this.contextViewService,{ariaLabel:m("label.excludes","Search Exclude Patterns"),inputBoxStyles:o})),this.inputPatternExcludes.onSubmit(r=>this.triggerSearch({resetCursor:!1,delay:r?this.searchConfig.searchOnTypeDebouncePeriod:0})),this._register(this.inputPatternExcludes.onChangeIgnoreBox(()=>this.triggerSearch())),this.messageBox=s.append(e,s.$(".messages.text-search-provider-messages")),[this.queryEditorWidget.searchInputFocusTracker,this.queryEditorWidget.replaceInputFocusTracker,this.inputPatternExcludes.inputFocusTracker,this.inputPatternIncludes.inputFocusTracker].forEach(r=>{r&&(this._register(r.onDidFocus(()=>setTimeout(()=>i.set(!0),0))),this._register(r.onDidBlur(()=>i.set(!1))))})}toggleRunAgainMessage(e){if(s.clearNode(this.messageBox),this.messageDisposables.clear(),e){const t=s.append(this.messageBox,s.$("a.pointer.prominent.message",{},m("runSearch","Run Search")));this.messageDisposables.add(s.addDisposableListener(t,s.EventType.CLICK,async()=>{await this.triggerSearch(),this.searchResultEditor.focus()}))}}_getContributions(){const e=[U.ID];return N.getEditorContributions().filter(t=>e.indexOf(t.id)===-1)}getCodeEditorWidgetOptions(){return{contributions:this._getContributions()}}registerEditorListeners(){this.searchResultEditor.onMouseUp(e=>{if(e.event.detail===1){const t=this.searchConfig.searchEditor.singleClickBehaviour,i=e.target.position;if(i&&t==="peekDefinition"){const o=this.searchResultEditor.getModel()?.getLineContent(i.lineNumber)??"";(o.match(T)||o.match(L))&&(this.searchResultEditor.setSelection(I.fromPositions(i)),this.commandService.executeCommand("editor.action.peekDefinition"))}}else if(e.event.detail===2){const t=this.searchConfig.searchEditor.doubleClickBehaviour,i=e.target.position;if(i&&t!=="selectWord"){const o=this.searchResultEditor.getModel()?.getLineContent(i.lineNumber)??"";o.match(L)?(this.searchResultEditor.setSelection(I.fromPositions(i)),this.commandService.executeCommand(t==="goToLocation"?"editor.action.goToDeclaration":"editor.action.openDeclarationToTheSide")):o.match(T)&&(this.searchResultEditor.setSelection(I.fromPositions(i)),this.commandService.executeCommand("editor.action.peekDefinition"))}}}),this._register(this.searchResultEditor.onDidChangeModelContent(()=>{this.updatingModelForSearch||this.getInput()?.setDirty(!0)}))}getControl(){return this.searchResultEditor}focus(){super.focus();const e=this.loadEditorViewState(this.getInput());e&&e.focused==="editor"?this.searchResultEditor.focus():this.queryEditorWidget.focus()}focusSearchInput(){this.queryEditorWidget.searchInput?.focus()}focusFilesToIncludeInput(){this.showingIncludesExcludes||this.toggleIncludesExcludes(!0),this.inputPatternIncludes.focus()}focusFilesToExcludeInput(){this.showingIncludesExcludes||this.toggleIncludesExcludes(!0),this.inputPatternExcludes.focus()}focusNextInput(){this.queryEditorWidget.searchInputHasFocus()?this.showingIncludesExcludes?this.inputPatternIncludes.focus():this.searchResultEditor.focus():this.inputPatternIncludes.inputHasFocus()?this.inputPatternExcludes.focus():this.inputPatternExcludes.inputHasFocus()?this.searchResultEditor.focus():this.searchResultEditor.hasWidgetFocus()}focusPrevInput(){this.queryEditorWidget.searchInputHasFocus()?this.searchResultEditor.focus():this.inputPatternIncludes.inputHasFocus()?this.queryEditorWidget.searchInput?.focus():this.inputPatternExcludes.inputHasFocus()?this.inputPatternIncludes.focus():this.searchResultEditor.hasWidgetFocus()}setQuery(e){this.queryEditorWidget.searchInput?.setValue(e)}selectQuery(){this.queryEditorWidget.searchInput?.select()}toggleWholeWords(){this.queryEditorWidget.searchInput?.setWholeWords(!this.queryEditorWidget.searchInput.getWholeWords()),this.triggerSearch({resetCursor:!1})}toggleRegex(){this.queryEditorWidget.searchInput?.setRegex(!this.queryEditorWidget.searchInput.getRegex()),this.triggerSearch({resetCursor:!1})}toggleCaseSensitive(){this.queryEditorWidget.searchInput?.setCaseSensitive(!this.queryEditorWidget.searchInput.getCaseSensitive()),this.triggerSearch({resetCursor:!1})}toggleContextLines(){this.queryEditorWidget.toggleContextLines()}modifyContextLines(e){this.queryEditorWidget.modifyContextLines(e)}toggleQueryDetails(e){this.toggleIncludesExcludes(e)}deleteResultBlock(){const e=new Set,t=this.searchResultEditor.getSelections(),i=this.searchResultEditor.getModel();if(!(t&&i))return;const o=i.getLineCount(),u=1,h=r=>{for(let n=r;n>=u;n--){const l=i.getLineContent(n);if(e.add(n),l[0]!==void 0&&l[0]!==" ")break}},d=r=>{e.add(r);for(let n=r+1;n<=o;n++){const l=i.getLineContent(n);if(l[0]!==void 0&&l[0]!==" ")return n;e.add(n)}},a=[];for(const r of t){const n=r.startLineNumber;a.push(d(n)),h(n);for(let l=r.startLineNumber;l<=r.endLineNumber;l++)e.add(l)}a.length===0&&a.push(1);const f=r=>r!==void 0;i.pushEditOperations(this.searchResultEditor.getSelections(),[...e].map(r=>({range:new I(r,1,r+1,1),text:""})),()=>a.filter(f).map(r=>new b(r,1,r,1)))}cleanState(){this.getInput()?.setDirty(!1)}get searchConfig(){return this.configurationService.getValue("search")}iterateThroughMatches(e){const t=this.searchResultEditor.getModel();if(!t)return;const i=t.getLineCount()??1,o=t.getLineLength(i),u=e?new E(i,o):new E(1,1),h=this.searchResultEditor.getSelection()?.getStartPosition()??u,d=this.getInput()?.getMatchRanges();if(!d)return;const a=(e?qe:Me)(d,h);this.searchResultEditor.setSelection(a),this.searchResultEditor.revealLineInCenterIfOutsideViewport(a.startLineNumber),this.searchResultEditor.focus();const f=t.getLineContent(a.startLineNumber),r=t.getValueInRange(a);let n="";for(let l=a.startLineNumber;l>=1;l--)if(t.getValueInRange(new I(l,1,l,2))!==" "){n=t.getLineContent(l);break}F(m("searchResultItem","Matched {0} at {1} in file {2}",r,f,n.slice(0,n.length-1)))}focusNextResult(){this.iterateThroughMatches(!1)}focusPreviousResult(){this.iterateThroughMatches(!0)}focusAllResults(){this.searchResultEditor.setSelections((this.getInput()?.getMatchRanges()??[]).map(e=>new b(e.startLineNumber,e.startColumn,e.endLineNumber,e.endColumn))),this.searchResultEditor.focus()}async triggerSearch(e){const t=this.searchConfig.searchEditor.focusResultsOnSearch;e===void 0?e={focusResults:t}:e.focusResults===void 0&&(e.focusResults=t);const i={resetCursor:!0,delay:0,...e};this.queryEditorWidget.searchInput?.inputBox.isInputValid()&&(this.pauseSearching||await this.runSearchDelayer.trigger(async()=>{this.toggleRunAgainMessage(!1),await this.doRunSearch(),i.resetCursor&&(this.searchResultEditor.setPosition(new E(1,1)),this.searchResultEditor.setScrollPosition({scrollTop:0,scrollLeft:0})),i.focusResults&&this.searchResultEditor.focus()},i.delay))}readConfigFromWidget(){return{isCaseSensitive:this.queryEditorWidget.searchInput?.getCaseSensitive()??!1,contextLines:this.queryEditorWidget.getContextLines(),filesToExclude:this.inputPatternExcludes.getValue(),filesToInclude:this.inputPatternIncludes.getValue(),query:this.queryEditorWidget.searchInput?.getValue()??"",isRegexp:this.queryEditorWidget.searchInput?.getRegex()??!1,matchWholeWord:this.queryEditorWidget.searchInput?.getWholeWords()??!1,useExcludeSettingsAndIgnoreFiles:this.inputPatternExcludes.useExcludesAndIgnoreFiles(),onlyOpenEditors:this.inputPatternIncludes.onlySearchInOpenEditors(),showIncludesExcludes:this.showingIncludesExcludes,notebookSearchConfig:{includeMarkupInput:this.queryEditorWidget.getNotebookFilters().markupInput,includeMarkupPreview:this.queryEditorWidget.getNotebookFilters().markupPreview,includeCodeInput:this.queryEditorWidget.getNotebookFilters().codeInput,includeOutput:this.queryEditorWidget.getNotebookFilters().codeOutput}}}async doRunSearch(){this.searchModel.cancelSearch(!0);const e=this.getInput();if(!e)return;this.searchHistoryDelayer.trigger(()=>{this.queryEditorWidget.searchInput?.onSearchSubmit(),this.inputPatternExcludes.onSearchSubmit(),this.inputPatternIncludes.onSearchSubmit()});const t=this.readConfigFromWidget();if(!t.query)return;const i={pattern:t.query,isRegExp:t.isRegexp,isCaseSensitive:t.isCaseSensitive,isWordMatch:t.matchWholeWord},o={_reason:"searchEditor",extraFileResources:this.instantiationService.invokeFunction(Ce),maxResults:this.searchConfig.maxResults??void 0,disregardIgnoreFiles:!t.useExcludeSettingsAndIgnoreFiles||void 0,disregardExcludeSettings:!t.useExcludeSettingsAndIgnoreFiles||void 0,excludePattern:[{pattern:t.filesToExclude}],includePattern:t.filesToInclude,onlyOpenEditors:t.onlyOpenEditors,previewOptions:{matchLines:1,charsPerLine:1e3},surroundingContext:t.contextLines,isSmartCase:this.searchConfig.smartCase,expandPatterns:!0,notebookSearchConfig:{includeMarkupInput:t.notebookSearchConfig.includeMarkupInput,includeMarkupPreview:t.notebookSearchConfig.includeMarkupPreview,includeCodeInput:t.notebookSearchConfig.includeCodeInput,includeOutput:t.notebookSearchConfig.includeOutput}},u=this.contextService.getWorkspace().folders;let h;try{h=this.instantiationService.createInstance(Pe).text(i,u.map(n=>n.uri),o)}catch{return}this.searchOperation.start(500),this.ongoingOperations++;const{configurationModel:d}=await e.resolveModels();d.updateConfig(t);const a=this.searchModel.search(h);e.ongoingSearchOperation=a.asyncResults.finally(()=>{this.ongoingOperations--,this.ongoingOperations===0&&this.searchOperation.stop()});const f=await e.ongoingSearchOperation;await this.onSearchComplete(f,t,e)}async onSearchComplete(e,t,i){const o=this.getInput();if(!o||o!==i||JSON.stringify(t)!==JSON.stringify(this.readConfigFromWidget()))return;o.ongoingSearchOperation=void 0;const u=this.searchConfig.sortOrder;u===we.Modified&&await this.retrieveFileStats(this.searchModel.searchResult),K.get(this.searchResultEditor)?.closeWidget(!1);const d=r=>this.labelService.getUriLabel(r,{relative:!0}),a=We(this.searchModel.searchResult,t.filesToInclude,t.filesToExclude,t.contextLines,d,u,e?.limitHit),{resultsModel:f}=await o.resolveModels();if(this.updatingModelForSearch=!0,this.modelService.updateModel(f,a.text),this.updatingModelForSearch=!1,e&&e.messages)for(const r of e.messages)this.addMessage(r);this.reLayout(),o.setDirty(!o.hasCapability(fe.Untitled)),o.setMatchRanges(a.matchRanges)}addMessage(e){let t;this.messageBox.firstChild?t=this.messageBox.firstChild:t=s.append(this.messageBox,s.$(".message")),s.append(t,Ie(e,this.instantiationService,this.notificationService,this.openerService,this.commandService,this.messageDisposables,()=>this.triggerSearch()))}async retrieveFileStats(e){const t=e.matches().filter(i=>!i.fileStat).map(i=>i.resolveFileStat(this.fileService));await Promise.all(t)}layout(e){this.dimension=e,this.reLayout()}getSelected(){const e=this.searchResultEditor.getSelection();return e?this.searchResultEditor.getModel()?.getValueInRange(e)??"":""}reLayout(){this.dimension&&(this.queryEditorWidget.setWidth(this.dimension.width-28),this.searchResultEditor.layout({height:this.dimension.height-s.getTotalHeight(this.queryEditorContainer),width:this.dimension.width}),this.inputPatternExcludes.setWidth(this.dimension.width-28),this.inputPatternIncludes.setWidth(this.dimension.width-28))}getInput(){return this.input}priorConfig;setSearchConfig(e){this.priorConfig=e,e.query!==void 0&&this.queryEditorWidget.setValue(e.query),e.isCaseSensitive!==void 0&&this.queryEditorWidget.searchInput?.setCaseSensitive(e.isCaseSensitive),e.isRegexp!==void 0&&this.queryEditorWidget.searchInput?.setRegex(e.isRegexp),e.matchWholeWord!==void 0&&this.queryEditorWidget.searchInput?.setWholeWords(e.matchWholeWord),e.contextLines!==void 0&&this.queryEditorWidget.setContextLines(e.contextLines),e.filesToExclude!==void 0&&this.inputPatternExcludes.setValue(e.filesToExclude),e.filesToInclude!==void 0&&this.inputPatternIncludes.setValue(e.filesToInclude),e.onlyOpenEditors!==void 0&&this.inputPatternIncludes.setOnlySearchInOpenEditors(e.onlyOpenEditors),e.useExcludeSettingsAndIgnoreFiles!==void 0&&this.inputPatternExcludes.setUseExcludesAndIgnoreFiles(e.useExcludeSettingsAndIgnoreFiles),e.showIncludesExcludes!==void 0&&this.toggleIncludesExcludes(e.showIncludesExcludes)}async setInput(e,t,i,o){if(await super.setInput(e,t,i,o),o.isCancellationRequested)return;const{configurationModel:u,resultsModel:h}=await e.resolveModels();if(!o.isCancellationRequested&&(this.searchResultEditor.setModel(h),this.pauseSearching=!0,this.toggleRunAgainMessage(!e.ongoingSearchOperation&&h.getLineCount()===1&&h.getValueLength()===0&&u.config.query!==""),this.setSearchConfig(u.config),this._register(u.onConfigDidUpdate(d=>{d!==this.priorConfig&&(this.pauseSearching=!0,this.setSearchConfig(d),this.pauseSearching=!1)})),this.restoreViewState(i),t?.preserveFocus||this.focus(),this.pauseSearching=!1,e.ongoingSearchOperation)){const d=this.readConfigFromWidget();e.ongoingSearchOperation.then(a=>{this.onSearchComplete(a,d,e)})}}toggleIncludesExcludes(e){const t="expanded";e??!this.includesExcludesContainer.classList.contains(t)?(this.toggleQueryDetailsButton.setAttribute("aria-expanded","true"),this.includesExcludesContainer.classList.add(t)):(this.toggleQueryDetailsButton.setAttribute("aria-expanded","false"),this.includesExcludesContainer.classList.remove(t)),this.showingIncludesExcludes=this.includesExcludesContainer.classList.contains(t),this.reLayout()}toEditorViewStateResource(e){if(e.typeId===W)return e.modelUri}computeEditorViewState(e){const i=this.getControl().saveViewState();if(i&&e.toString()===this.getInput()?.modelUri.toString())return{...i,focused:this.searchResultEditor.hasWidgetFocus()?"editor":"input"}}tracksEditorViewState(e){return e.typeId===W}restoreViewState(e){const t=this.loadEditorViewState(this.getInput(),e);t&&this.searchResultEditor.restoreViewState(t)}getAriaLabel(){return this.getInput()?.getName()??m("searchEditor","Search")}};S=x([c(1,ae),c(2,he),c(3,ne),c(4,A),c(5,ge),c(6,ee),c(7,j),c(8,z),c(9,$),c(10,re),c(11,ie),c(12,se),c(13,Q),c(14,Le),c(15,Te),c(16,G),c(17,J),c(18,te),c(19,X)],S);const De=le("searchEditor.textInputBorder",de,m("textInputBoxBorder","Search editor text input box border."));function Me(g,p){for(const e of g)if(E.isBefore(p,e.getStartPosition()))return e;return g[0]}function qe(g,p){for(let e=g.length-1;e>=0;e--){const t=g[e];if(E.isBefore(t.getStartPosition(),p))return t}return g[g.length-1]}export{S as SearchEditor};
