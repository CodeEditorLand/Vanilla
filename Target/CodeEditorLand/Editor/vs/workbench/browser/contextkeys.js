var y=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var l=(c,r,e,t)=>{for(var i=t>1?void 0:t?S(r,e):r,n=c.length-1,p;n>=0;n--)(p=c[n])&&(i=(t?p(r,e,i):p(i))||i);return t&&i&&y(r,e,i),i},o=(c,r)=>(e,t)=>r(e,t,c);import{isFullscreen as b,onDidChangeFullscreen as m}from"../../../vs/base/browser/browser.js";import{addDisposableListener as K,EventType as g,getActiveWindow as E,onDidRegisterWindow as I,trackFocus as k}from"../../../vs/base/browser/dom.js";import{mainWindow as a}from"../../../vs/base/browser/window.js";import{Event as v}from"../../../vs/base/common/event.js";import{Disposable as T}from"../../../vs/base/common/lifecycle.js";import{isNative as x}from"../../../vs/base/common/platform.js";import{IConfigurationService as W}from"../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as A,setConstant as G}from"../../../vs/platform/contextkey/common/contextkey.js";import{InputFocusedContext as V,IsDevelopmentContext as u,IsIOSContext as f,IsLinuxContext as P,IsMacContext as D,IsMacNativeContext as F,IsMobileContext as M,IsWebContext as _,IsWindowsContext as B,ProductQualityContext as L}from"../../../vs/platform/contextkey/common/contextkeys.js";import{WebFileSystemAccess as R}from"../../../vs/platform/files/browser/webFileSystemAccess.js";import{IProductService as w}from"../../../vs/platform/product/common/productService.js";import{getRemoteName as N}from"../../../vs/platform/remote/common/remoteHosts.js";import{getTitleBarStyle as O}from"../../../vs/platform/window/common/window.js";import{getVirtualWorkspaceScheme as z}from"../../../vs/platform/workspace/common/virtualWorkspace.js";import{isTemporaryWorkspace as Z,IWorkspaceContextService as U,WorkbenchState as h}from"../../../vs/platform/workspace/common/workspace.js";import{ActiveEditorGroupEmptyContext as X,ActiveEditorGroupIndexContext as Y,ActiveEditorGroupLastContext as q,ActiveEditorGroupLockedContext as Q,AuxiliaryBarVisibleContext as j,DirtyWorkingCopiesContext as J,EditorsVisibleContext as $,EditorTabsVisibleContext as H,EmbedderIdentifierContext as ee,EmptyWorkspaceSupportContext as te,EnterMultiRootWorkspaceSupportContext as ie,HasWebFileSystemAccess as oe,InEditorZenModeContext as re,IsAuxiliaryWindowFocusedContext as ne,IsMainEditorCenteredLayoutContext as se,IsMainWindowFullscreenContext as ae,MainEditorAreaVisibleContext as ce,MultipleEditorGroupsContext as pe,OpenFolderWorkspaceSupportContext as de,PanelAlignmentContext as xe,PanelMaximizedContext as he,PanelPositionContext as Ce,PanelVisibleContext as le,RemoteNameContext as ve,SideBarVisibleContext as ue,SplitEditorsVertically as ye,TemporaryWorkspaceContext as Se,TitleBarStyleContext as be,TitleBarVisibleContext as me,VirtualWorkspaceContext as Ke,WorkbenchStateContext as ge,WorkspaceFolderCountContext as Ee}from"../../../vs/workbench/common/contextkeys.js";import{GroupDirection as Ie,IEditorGroupsService as ke,preferredSideBySideGroupDirection as Te}from"../../../vs/workbench/services/editor/common/editorGroupsService.js";import{IEditorService as We}from"../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as Ae}from"../../../vs/workbench/services/environment/common/environmentService.js";import{IWorkbenchLayoutService as Ge,Parts as s,positionToString as Ve}from"../../../vs/workbench/services/layout/browser/layoutService.js";import{IPaneCompositePartService as fe}from"../../../vs/workbench/services/panecomposite/browser/panecomposite.js";import{IWorkingCopyService as Pe}from"../../../vs/workbench/services/workingCopy/common/workingCopyService.js";let d=class extends T{constructor(e,t,i,n,p,De,Fe,Me,_e,Be){super();this.contextKeyService=e;this.contextService=t;this.configurationService=i;this.environmentService=n;this.productService=p;this.editorGroupService=De;this.editorService=Fe;this.layoutService=Me;this.paneCompositeService=_e;this.workingCopyService=Be;D.bindTo(this.contextKeyService),P.bindTo(this.contextKeyService),B.bindTo(this.contextKeyService),_.bindTo(this.contextKeyService),F.bindTo(this.contextKeyService),f.bindTo(this.contextKeyService),M.bindTo(this.contextKeyService),ve.bindTo(this.contextKeyService).set(N(this.environmentService.remoteAuthority)||""),this.virtualWorkspaceContext=Ke.bindTo(this.contextKeyService),this.temporaryWorkspaceContext=Se.bindTo(this.contextKeyService),this.updateWorkspaceContextKeys(),oe.bindTo(this.contextKeyService).set(R.supported(a));const C=!this.environmentService.isBuilt||this.environmentService.isExtensionDevelopment;u.bindTo(this.contextKeyService).set(C),G(u.key,C),L.bindTo(this.contextKeyService).set(this.productService.quality||""),ee.bindTo(this.contextKeyService).set(p.embedderIdentifier),this.activeEditorGroupEmpty=X.bindTo(this.contextKeyService),this.activeEditorGroupIndex=Y.bindTo(this.contextKeyService),this.activeEditorGroupLast=q.bindTo(this.contextKeyService),this.activeEditorGroupLocked=Q.bindTo(this.contextKeyService),this.multipleEditorGroupsContext=pe.bindTo(this.contextKeyService),this.editorsVisibleContext=$.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext=J.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext.set(this.workingCopyService.hasDirty),this.inputFocusedContext=V.bindTo(this.contextKeyService),this.workbenchStateContext=ge.bindTo(this.contextKeyService),this.updateWorkbenchStateContextKey(),this.workspaceFolderCountContext=Ee.bindTo(this.contextKeyService),this.updateWorkspaceFolderCountContextKey(),this.openFolderWorkspaceSupportContext=de.bindTo(this.contextKeyService),this.openFolderWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.emptyWorkspaceSupportContext=te.bindTo(this.contextKeyService),this.emptyWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.enterMultiRootWorkspaceSupportContext=ie.bindTo(this.contextKeyService),this.enterMultiRootWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.splitEditorsVerticallyContext=ye.bindTo(this.contextKeyService),this.updateSplitEditorsVerticallyContext(),this.isMainWindowFullscreenContext=ae.bindTo(this.contextKeyService),this.isAuxiliaryWindowFocusedContext=ne.bindTo(this.contextKeyService),this.inZenModeContext=re.bindTo(this.contextKeyService),this.isMainEditorCenteredLayoutContext=se.bindTo(this.contextKeyService),this.mainEditorAreaVisibleContext=ce.bindTo(this.contextKeyService),this.editorTabsVisibleContext=H.bindTo(this.contextKeyService),this.sideBarVisibleContext=ue.bindTo(this.contextKeyService),this.titleAreaVisibleContext=me.bindTo(this.contextKeyService),this.titleBarStyleContext=be.bindTo(this.contextKeyService),this.updateTitleBarContextKeys(),this.panelPositionContext=Ce.bindTo(this.contextKeyService),this.panelPositionContext.set(Ve(this.layoutService.getPanelPosition())),this.panelVisibleContext=le.bindTo(this.contextKeyService),this.panelVisibleContext.set(this.layoutService.isVisible(s.PANEL_PART)),this.panelMaximizedContext=he.bindTo(this.contextKeyService),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.panelAlignmentContext=xe.bindTo(this.contextKeyService),this.panelAlignmentContext.set(this.layoutService.getPanelAlignment()),this.auxiliaryBarVisibleContext=j.bindTo(this.contextKeyService),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(s.AUXILIARYBAR_PART)),this.registerListeners()}inputFocusedContext;dirtyWorkingCopiesContext;activeEditorGroupEmpty;activeEditorGroupIndex;activeEditorGroupLast;activeEditorGroupLocked;multipleEditorGroupsContext;editorsVisibleContext;splitEditorsVerticallyContext;workbenchStateContext;workspaceFolderCountContext;openFolderWorkspaceSupportContext;enterMultiRootWorkspaceSupportContext;emptyWorkspaceSupportContext;virtualWorkspaceContext;temporaryWorkspaceContext;inZenModeContext;isMainWindowFullscreenContext;isAuxiliaryWindowFocusedContext;isMainEditorCenteredLayoutContext;sideBarVisibleContext;mainEditorAreaVisibleContext;panelPositionContext;panelVisibleContext;panelAlignmentContext;panelMaximizedContext;auxiliaryBarVisibleContext;editorTabsVisibleContext;titleAreaVisibleContext;titleBarStyleContext;registerListeners(){this.editorGroupService.whenReady.then(()=>{this.updateEditorAreaContextKeys(),this.updateActiveEditorGroupContextKeys(),this.updateVisiblePanesContextKeys()}),this._register(this.editorService.onDidActiveEditorChange(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorService.onDidVisibleEditorsChange(()=>this.updateVisiblePanesContextKeys())),this._register(this.editorGroupService.onDidAddGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidRemoveGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidChangeGroupIndex(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeGroupLocked(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeEditorPartOptions(()=>this.updateEditorAreaContextKeys())),this._register(v.runAndSubscribe(I,({window:e,disposables:t})=>t.add(K(e,g.FOCUS_IN,()=>this.updateInputContextKeys(e.document),!0)),{window:a,disposables:this._store})),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateWorkbenchStateContextKey())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>{this.updateWorkspaceFolderCountContextKey(),this.updateWorkspaceContextKeys()})),this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("workbench.editor.openSideBySideDirection")&&this.updateSplitEditorsVerticallyContext()})),this._register(this.layoutService.onDidChangeZenMode(e=>this.inZenModeContext.set(e))),this._register(this.layoutService.onDidChangeActiveContainer(()=>this.isAuxiliaryWindowFocusedContext.set(this.layoutService.activeContainer!==this.layoutService.mainContainer))),this._register(m(e=>{e===a.vscodeWindowId&&this.isMainWindowFullscreenContext.set(b(a))})),this._register(this.layoutService.onDidChangeMainEditorCenteredLayout(e=>this.isMainEditorCenteredLayoutContext.set(e))),this._register(this.layoutService.onDidChangePanelPosition(e=>this.panelPositionContext.set(e))),this._register(this.layoutService.onDidChangePanelAlignment(e=>this.panelAlignmentContext.set(e))),this._register(this.paneCompositeService.onDidPaneCompositeClose(()=>this.updateSideBarContextKeys())),this._register(this.paneCompositeService.onDidPaneCompositeOpen(()=>this.updateSideBarContextKeys())),this._register(this.layoutService.onDidChangePartVisibility(()=>{this.mainEditorAreaVisibleContext.set(this.layoutService.isVisible(s.EDITOR_PART,a)),this.panelVisibleContext.set(this.layoutService.isVisible(s.PANEL_PART)),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(s.AUXILIARYBAR_PART)),this.updateTitleBarContextKeys()})),this._register(this.workingCopyService.onDidChangeDirty(e=>this.dirtyWorkingCopiesContext.set(e.isDirty()||this.workingCopyService.hasDirty)))}updateVisiblePanesContextKeys(){this.editorService.visibleEditorPanes.length>0?this.editorsVisibleContext.set(!0):this.editorsVisibleContext.reset()}updateActiveEditorGroupContextKeys(){this.editorService.activeEditor?this.activeEditorGroupEmpty.reset():this.activeEditorGroupEmpty.set(!0);const e=this.editorGroupService.activeGroup;this.activeEditorGroupIndex.set(e.index+1),this.activeEditorGroupLocked.set(e.isLocked),this.updateEditorGroupsContextKeys()}updateEditorGroupsContextKeys(){const e=this.editorGroupService.count;e>1?this.multipleEditorGroupsContext.set(!0):this.multipleEditorGroupsContext.reset();const t=this.editorGroupService.activeGroup;this.activeEditorGroupLast.set(t.index===e-1)}updateEditorAreaContextKeys(){this.editorTabsVisibleContext.set(this.editorGroupService.partOptions.showTabs==="multiple")}updateInputContextKeys(e){function t(){return!!e.activeElement&&(e.activeElement.tagName==="INPUT"||e.activeElement.tagName==="TEXTAREA")}const i=t();if(this.inputFocusedContext.set(i),i){const n=k(e.activeElement);v.once(n.onDidBlur)(()=>{E().document===e&&this.inputFocusedContext.set(t()),n.dispose()})}}updateWorkbenchStateContextKey(){this.workbenchStateContext.set(this.getWorkbenchStateString())}updateWorkspaceFolderCountContextKey(){this.workspaceFolderCountContext.set(this.contextService.getWorkspace().folders.length)}updateSplitEditorsVerticallyContext(){const e=Te(this.configurationService);this.splitEditorsVerticallyContext.set(e===Ie.DOWN)}getWorkbenchStateString(){switch(this.contextService.getWorkbenchState()){case h.EMPTY:return"empty";case h.FOLDER:return"folder";case h.WORKSPACE:return"workspace"}}updateSideBarContextKeys(){this.sideBarVisibleContext.set(this.layoutService.isVisible(s.SIDEBAR_PART))}updateTitleBarContextKeys(){this.titleAreaVisibleContext.set(this.layoutService.isVisible(s.TITLEBAR_PART,a)),this.titleBarStyleContext.set(O(this.configurationService))}updateWorkspaceContextKeys(){this.virtualWorkspaceContext.set(z(this.contextService.getWorkspace())||""),this.temporaryWorkspaceContext.set(Z(this.contextService.getWorkspace()))}};d=l([o(0,A),o(1,U),o(2,W),o(3,Ae),o(4,w),o(5,ke),o(6,We),o(7,Ge),o(8,fe),o(9,Pe)],d);export{d as WorkbenchContextKeysHandler};
