var y=Object.defineProperty;var S=Object.getOwnPropertyDescriptor;var l=(c,r,e,t)=>{for(var i=t>1?void 0:t?S(r,e):r,n=c.length-1,p;n>=0;n--)(p=c[n])&&(i=(t?p(r,e,i):p(i))||i);return t&&i&&y(r,e,i),i},o=(c,r)=>(e,t)=>r(e,t,c);import{isFullscreen as b,onDidChangeFullscreen as m}from"../../base/browser/browser.js";import{EventType as K,addDisposableListener as g,getActiveWindow as E,isEditableElement as I,onDidRegisterWindow as k,trackFocus as W}from"../../base/browser/dom.js";import{mainWindow as a}from"../../base/browser/window.js";import{Event as v}from"../../base/common/event.js";import{Disposable as T}from"../../base/common/lifecycle.js";import{isNative as x}from"../../base/common/platform.js";import{IConfigurationService as A}from"../../platform/configuration/common/configuration.js";import{IContextKeyService as G,setConstant as V}from"../../platform/contextkey/common/contextkey.js";import{InputFocusedContext as f,IsDevelopmentContext as u,IsIOSContext as P,IsLinuxContext as D,IsMacContext as F,IsMacNativeContext as M,IsMobileContext as _,IsWebContext as B,IsWindowsContext as L,ProductQualityContext as w}from"../../platform/contextkey/common/contextkeys.js";import{WebFileSystemAccess as R}from"../../platform/files/browser/webFileSystemAccess.js";import{IProductService as O}from"../../platform/product/common/productService.js";import{getRemoteName as N}from"../../platform/remote/common/remoteHosts.js";import{getTitleBarStyle as z}from"../../platform/window/common/window.js";import{getVirtualWorkspaceScheme as Z}from"../../platform/workspace/common/virtualWorkspace.js";import{IWorkspaceContextService as U,WorkbenchState as h,isTemporaryWorkspace as Y}from"../../platform/workspace/common/workspace.js";import{ActiveEditorGroupEmptyContext as X,ActiveEditorGroupIndexContext as q,ActiveEditorGroupLastContext as Q,ActiveEditorGroupLockedContext as j,AuxiliaryBarVisibleContext as J,DirtyWorkingCopiesContext as $,EditorTabsVisibleContext as H,EditorsVisibleContext as ee,EmbedderIdentifierContext as te,EmptyWorkspaceSupportContext as ie,EnterMultiRootWorkspaceSupportContext as oe,HasWebFileSystemAccess as re,InEditorZenModeContext as ne,IsAuxiliaryWindowFocusedContext as se,IsMainEditorCenteredLayoutContext as ae,IsMainWindowFullscreenContext as ce,MainEditorAreaVisibleContext as pe,MultipleEditorGroupsContext as de,OpenFolderWorkspaceSupportContext as xe,PanelAlignmentContext as he,PanelMaximizedContext as Ce,PanelPositionContext as le,PanelVisibleContext as ve,RemoteNameContext as ue,SideBarVisibleContext as ye,SplitEditorsVertically as Se,TemporaryWorkspaceContext as be,TitleBarStyleContext as me,TitleBarVisibleContext as Ke,VirtualWorkspaceContext as ge,WorkbenchStateContext as Ee,WorkspaceFolderCountContext as Ie}from"../common/contextkeys.js";import{GroupDirection as ke,IEditorGroupsService as We,preferredSideBySideGroupDirection as Te}from"../services/editor/common/editorGroupsService.js";import{IEditorService as Ae}from"../services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as Ge}from"../services/environment/common/environmentService.js";import{IWorkbenchLayoutService as Ve,Parts as s,positionToString as fe}from"../services/layout/browser/layoutService.js";import{IPaneCompositePartService as Pe}from"../services/panecomposite/browser/panecomposite.js";import{IWorkingCopyService as De}from"../services/workingCopy/common/workingCopyService.js";let d=class extends T{constructor(e,t,i,n,p,Fe,Me,_e,Be,Le){super();this.contextKeyService=e;this.contextService=t;this.configurationService=i;this.environmentService=n;this.productService=p;this.editorGroupService=Fe;this.editorService=Me;this.layoutService=_e;this.paneCompositeService=Be;this.workingCopyService=Le;F.bindTo(this.contextKeyService),D.bindTo(this.contextKeyService),L.bindTo(this.contextKeyService),B.bindTo(this.contextKeyService),M.bindTo(this.contextKeyService),P.bindTo(this.contextKeyService),_.bindTo(this.contextKeyService),ue.bindTo(this.contextKeyService).set(N(this.environmentService.remoteAuthority)||""),this.virtualWorkspaceContext=ge.bindTo(this.contextKeyService),this.temporaryWorkspaceContext=be.bindTo(this.contextKeyService),this.updateWorkspaceContextKeys(),re.bindTo(this.contextKeyService).set(R.supported(a));const C=!this.environmentService.isBuilt||this.environmentService.isExtensionDevelopment;u.bindTo(this.contextKeyService).set(C),V(u.key,C),w.bindTo(this.contextKeyService).set(this.productService.quality||""),te.bindTo(this.contextKeyService).set(p.embedderIdentifier),this.activeEditorGroupEmpty=X.bindTo(this.contextKeyService),this.activeEditorGroupIndex=q.bindTo(this.contextKeyService),this.activeEditorGroupLast=Q.bindTo(this.contextKeyService),this.activeEditorGroupLocked=j.bindTo(this.contextKeyService),this.multipleEditorGroupsContext=de.bindTo(this.contextKeyService),this.editorsVisibleContext=ee.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext=$.bindTo(this.contextKeyService),this.dirtyWorkingCopiesContext.set(this.workingCopyService.hasDirty),this.inputFocusedContext=f.bindTo(this.contextKeyService),this.workbenchStateContext=Ee.bindTo(this.contextKeyService),this.updateWorkbenchStateContextKey(),this.workspaceFolderCountContext=Ie.bindTo(this.contextKeyService),this.updateWorkspaceFolderCountContextKey(),this.openFolderWorkspaceSupportContext=xe.bindTo(this.contextKeyService),this.openFolderWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.emptyWorkspaceSupportContext=ie.bindTo(this.contextKeyService),this.emptyWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.enterMultiRootWorkspaceSupportContext=oe.bindTo(this.contextKeyService),this.enterMultiRootWorkspaceSupportContext.set(x||typeof this.environmentService.remoteAuthority=="string"),this.splitEditorsVerticallyContext=Se.bindTo(this.contextKeyService),this.updateSplitEditorsVerticallyContext(),this.isMainWindowFullscreenContext=ce.bindTo(this.contextKeyService),this.isAuxiliaryWindowFocusedContext=se.bindTo(this.contextKeyService),this.inZenModeContext=ne.bindTo(this.contextKeyService),this.isMainEditorCenteredLayoutContext=ae.bindTo(this.contextKeyService),this.mainEditorAreaVisibleContext=pe.bindTo(this.contextKeyService),this.editorTabsVisibleContext=H.bindTo(this.contextKeyService),this.sideBarVisibleContext=ye.bindTo(this.contextKeyService),this.titleAreaVisibleContext=Ke.bindTo(this.contextKeyService),this.titleBarStyleContext=me.bindTo(this.contextKeyService),this.updateTitleBarContextKeys(),this.panelPositionContext=le.bindTo(this.contextKeyService),this.panelPositionContext.set(fe(this.layoutService.getPanelPosition())),this.panelVisibleContext=ve.bindTo(this.contextKeyService),this.panelVisibleContext.set(this.layoutService.isVisible(s.PANEL_PART)),this.panelMaximizedContext=Ce.bindTo(this.contextKeyService),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.panelAlignmentContext=he.bindTo(this.contextKeyService),this.panelAlignmentContext.set(this.layoutService.getPanelAlignment()),this.auxiliaryBarVisibleContext=J.bindTo(this.contextKeyService),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(s.AUXILIARYBAR_PART)),this.registerListeners()}inputFocusedContext;dirtyWorkingCopiesContext;activeEditorGroupEmpty;activeEditorGroupIndex;activeEditorGroupLast;activeEditorGroupLocked;multipleEditorGroupsContext;editorsVisibleContext;splitEditorsVerticallyContext;workbenchStateContext;workspaceFolderCountContext;openFolderWorkspaceSupportContext;enterMultiRootWorkspaceSupportContext;emptyWorkspaceSupportContext;virtualWorkspaceContext;temporaryWorkspaceContext;inZenModeContext;isMainWindowFullscreenContext;isAuxiliaryWindowFocusedContext;isMainEditorCenteredLayoutContext;sideBarVisibleContext;mainEditorAreaVisibleContext;panelPositionContext;panelVisibleContext;panelAlignmentContext;panelMaximizedContext;auxiliaryBarVisibleContext;editorTabsVisibleContext;titleAreaVisibleContext;titleBarStyleContext;registerListeners(){this.editorGroupService.whenReady.then(()=>{this.updateEditorAreaContextKeys(),this.updateActiveEditorGroupContextKeys(),this.updateVisiblePanesContextKeys()}),this._register(this.editorService.onDidActiveEditorChange(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorService.onDidVisibleEditorsChange(()=>this.updateVisiblePanesContextKeys())),this._register(this.editorGroupService.onDidAddGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidRemoveGroup(()=>this.updateEditorGroupsContextKeys())),this._register(this.editorGroupService.onDidChangeGroupIndex(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeGroupLocked(()=>this.updateActiveEditorGroupContextKeys())),this._register(this.editorGroupService.onDidChangeEditorPartOptions(()=>this.updateEditorAreaContextKeys())),this._register(v.runAndSubscribe(k,({window:e,disposables:t})=>t.add(g(e,K.FOCUS_IN,()=>this.updateInputContextKeys(e.document),!0)),{window:a,disposables:this._store})),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateWorkbenchStateContextKey())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>{this.updateWorkspaceFolderCountContextKey(),this.updateWorkspaceContextKeys()})),this._register(this.configurationService.onDidChangeConfiguration(e=>{e.affectsConfiguration("workbench.editor.openSideBySideDirection")&&this.updateSplitEditorsVerticallyContext()})),this._register(this.layoutService.onDidChangeZenMode(e=>this.inZenModeContext.set(e))),this._register(this.layoutService.onDidChangeActiveContainer(()=>this.isAuxiliaryWindowFocusedContext.set(this.layoutService.activeContainer!==this.layoutService.mainContainer))),this._register(m(e=>{e===a.vscodeWindowId&&this.isMainWindowFullscreenContext.set(b(a))})),this._register(this.layoutService.onDidChangeMainEditorCenteredLayout(e=>this.isMainEditorCenteredLayoutContext.set(e))),this._register(this.layoutService.onDidChangePanelPosition(e=>this.panelPositionContext.set(e))),this._register(this.layoutService.onDidChangePanelAlignment(e=>this.panelAlignmentContext.set(e))),this._register(this.paneCompositeService.onDidPaneCompositeClose(()=>this.updateSideBarContextKeys())),this._register(this.paneCompositeService.onDidPaneCompositeOpen(()=>this.updateSideBarContextKeys())),this._register(this.layoutService.onDidChangePartVisibility(()=>{this.mainEditorAreaVisibleContext.set(this.layoutService.isVisible(s.EDITOR_PART,a)),this.panelVisibleContext.set(this.layoutService.isVisible(s.PANEL_PART)),this.panelMaximizedContext.set(this.layoutService.isPanelMaximized()),this.auxiliaryBarVisibleContext.set(this.layoutService.isVisible(s.AUXILIARYBAR_PART)),this.updateTitleBarContextKeys()})),this._register(this.workingCopyService.onDidChangeDirty(e=>this.dirtyWorkingCopiesContext.set(e.isDirty()||this.workingCopyService.hasDirty)))}updateVisiblePanesContextKeys(){this.editorService.visibleEditorPanes.length>0?this.editorsVisibleContext.set(!0):this.editorsVisibleContext.reset()}updateActiveEditorGroupContextKeys(){this.editorService.activeEditor?this.activeEditorGroupEmpty.reset():this.activeEditorGroupEmpty.set(!0);const e=this.editorGroupService.activeGroup;this.activeEditorGroupIndex.set(e.index+1),this.activeEditorGroupLocked.set(e.isLocked),this.updateEditorGroupsContextKeys()}updateEditorGroupsContextKeys(){const e=this.editorGroupService.count;e>1?this.multipleEditorGroupsContext.set(!0):this.multipleEditorGroupsContext.reset();const t=this.editorGroupService.activeGroup;this.activeEditorGroupLast.set(t.index===e-1)}updateEditorAreaContextKeys(){this.editorTabsVisibleContext.set(this.editorGroupService.partOptions.showTabs==="multiple")}updateInputContextKeys(e){function t(){return!!e.activeElement&&I(e.activeElement)}const i=t();if(this.inputFocusedContext.set(i),i){const n=W(e.activeElement);v.once(n.onDidBlur)(()=>{E().document===e&&this.inputFocusedContext.set(t()),n.dispose()})}}updateWorkbenchStateContextKey(){this.workbenchStateContext.set(this.getWorkbenchStateString())}updateWorkspaceFolderCountContextKey(){this.workspaceFolderCountContext.set(this.contextService.getWorkspace().folders.length)}updateSplitEditorsVerticallyContext(){const e=Te(this.configurationService);this.splitEditorsVerticallyContext.set(e===ke.DOWN)}getWorkbenchStateString(){switch(this.contextService.getWorkbenchState()){case h.EMPTY:return"empty";case h.FOLDER:return"folder";case h.WORKSPACE:return"workspace"}}updateSideBarContextKeys(){this.sideBarVisibleContext.set(this.layoutService.isVisible(s.SIDEBAR_PART))}updateTitleBarContextKeys(){this.titleAreaVisibleContext.set(this.layoutService.isVisible(s.TITLEBAR_PART,a)),this.titleBarStyleContext.set(z(this.configurationService))}updateWorkspaceContextKeys(){this.virtualWorkspaceContext.set(Z(this.contextService.getWorkspace())||""),this.temporaryWorkspaceContext.set(Y(this.contextService.getWorkspace()))}};d=l([o(0,G),o(1,U),o(2,A),o(3,Ge),o(4,O),o(5,We),o(6,Ae),o(7,Ve),o(8,Pe),o(9,De)],d);export{d as WorkbenchContextKeysHandler};
