import{asArray as d}from"../../base/common/arrays.js";import{DeferredPromise as u}from"../../base/common/async.js";import{toDisposable as w}from"../../base/common/lifecycle.js";import{mark as l}from"../../base/common/performance.js";import{MenuId as c,MenuRegistry as f}from"../../platform/actions/common/actions.js";import{CommandsRegistry as h}from"../../platform/commands/common/commands.js";import{Menu as a}from"./web.api.js";import{BrowserMain as g}from"./web.main.js";let m=!1;const r=new u;function U(t,s){if(l("code/didLoadWorkbenchMain"),m)throw new Error("Unable to create the VSCode workbench more than once.");if(m=!0,Array.isArray(s.commands)){for(const e of s.commands)if(h.registerCommand(e.id,(o,...i)=>e.handler(...i)),e.label)for(const o of d(e.menu??a.CommandPalette))f.appendMenuItem(b(o),{command:{id:e.id,title:e.label}})}let n;return new g(t,s).open().then(e=>{n=e,r.complete(e)}),w(()=>{n?n.shutdown():r.p.then(e=>e.shutdown())})}function b(t){switch(t){case a.CommandPalette:return c.CommandPalette;case a.StatusBarWindowIndicatorMenu:return c.StatusBarWindowIndicatorMenu}}var I;(s=>{async function t(n,...e){return(await r.p).commands.executeCommand(n,...e)}s.executeCommand=t})(I||={});var k;(s=>{function t(n,e){r.p.then(o=>o.logger.log(n,e))}s.log=t})(k||={});var P;(e=>{async function t(){return(await r.p).env.retrievePerformanceMarks()}e.retrievePerformanceMarks=t;async function s(){return(await r.p).env.getUriScheme()}e.getUriScheme=s;async function n(o){return(await r.p).env.openUri(o)}e.openUri=n})(P||={});var y;(e=>{async function t(o,i){return(await r.p).window.withProgress(o,i)}e.withProgress=t;async function s(o){(await r.p).window.createTerminal(o)}e.createTerminal=s;async function n(o,...i){return await(await r.p).window.showInformationMessage(o,...i)}e.showInformationMessage=n})(y||={});var x;(n=>{async function t(){await(await r.p).workspace.didResolveRemoteAuthority()}n.didResolveRemoteAuthority=t;async function s(e){return(await r.p).workspace.openTunnel(e)}n.openTunnel=s})(x||={});export{I as commands,U as create,P as env,k as logger,y as window,x as workspace};
