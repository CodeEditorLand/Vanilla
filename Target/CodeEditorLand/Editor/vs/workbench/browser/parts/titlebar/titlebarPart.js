var de=Object.defineProperty;var he=Object.getOwnPropertyDescriptor;var y=(d,a,e,i)=>{for(var t=i>1?void 0:i?he(a,e):a,r=d.length-1,n;r>=0;r--)(n=d[r])&&(t=(i?n(a,e,t):n(t))||t);return i&&t&&de(a,e,t),t},o=(d,a)=>(e,i)=>a(e,i,d);import"vs/css!./media/titlebarpart";import{getWCOBoundingRect as ue,getZoomFactor as B,isWCOEnabled as me}from"../../../../../vs/base/browser/browser.js";import{$ as s,addDisposableListener as $,append as c,Dimension as q,EventHelper as j,EventType as J,getActiveDocument as pe,getWindow as p,getWindowId as ve,isAncestor as be,isHTMLElement as ge,prepend as X,reset as fe}from"../../../../../vs/base/browser/dom.js";import{StandardMouseEvent as Ie}from"../../../../../vs/base/browser/mouseEvent.js";import{ActionsOrientation as Te,prepareActions as Q}from"../../../../../vs/base/browser/ui/actionbar/actionbar.js";import"../../../../../vs/base/browser/ui/actionbar/actionViewItems.js";import{AnchorAlignment as ye}from"../../../../../vs/base/browser/ui/contextview/contextview.js";import"../../../../../vs/base/browser/ui/grid/grid.js";import"../../../../../vs/base/browser/ui/hover/hoverDelegate.js";import{createInstantHoverDelegate as Ce}from"../../../../../vs/base/browser/ui/hover/hoverDelegateFactory.js";import{HoverPosition as ee}from"../../../../../vs/base/browser/ui/hover/hoverWidget.js";import{mainWindow as Ae}from"../../../../../vs/base/browser/window.js";import{ActionRunner as Se}from"../../../../../vs/base/common/actions.js";import{Codicon as Ee}from"../../../../../vs/base/common/codicons.js";import{Color as Me}from"../../../../../vs/base/common/color.js";import{Emitter as te,Event as ie}from"../../../../../vs/base/common/event.js";import"../../../../../vs/base/common/keybindings.js";import{DisposableStore as h}from"../../../../../vs/base/common/lifecycle.js";import{isLinux as Be,isMacintosh as l,isNative as oe,isWeb as u,isWindows as Le,platformLocale as _e}from"../../../../../vs/base/common/platform.js";import{ThemeIcon as De}from"../../../../../vs/base/common/themables.js";import{localize as xe,localize2 as we}from"../../../../../vs/nls.js";import{Categories as Ve}from"../../../../../vs/platform/action/common/actionCommonCategories.js";import{createActionViewItem as Oe,createAndFillInActionBarActions as Pe}from"../../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as Re}from"../../../../../vs/platform/actions/browser/toolbar.js";import{Action2 as Ne,IMenuService as R,MenuId as C,registerAction2 as He}from"../../../../../vs/platform/actions/common/actions.js";import{CommandsRegistry as We}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as N}from"../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as H}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as W}from"../../../../../vs/platform/contextview/browser/contextView.js";import{IInstantiationService as L}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as G}from"../../../../../vs/platform/keybinding/common/keybinding.js";import{IStorageService as _,StorageScope as Ge}from"../../../../../vs/platform/storage/common/storage.js";import{getIconRegistry as Ke}from"../../../../../vs/platform/theme/common/iconRegistry.js";import{IThemeService as D}from"../../../../../vs/platform/theme/common/themeService.js";import{DEFAULT_CUSTOM_TITLEBAR_HEIGHT as ke,getMenuBarVisibility as Fe,getTitleBarStyle as Ue,hasCustomTitlebar as x,hasNativeTitlebar as w}from"../../../../../vs/platform/window/common/window.js";import{MultiWindowParts as Ye,Part as Ze}from"../../../../../vs/workbench/browser/part.js";import{EDITOR_CORE_NAVIGATION_COMMANDS as ze}from"../../../../../vs/workbench/browser/parts/editor/editorCommands.js";import{EditorPane as $e}from"../../../../../vs/workbench/browser/parts/editor/editorPane.js";import{EditorCommandsContextActionRunner as qe}from"../../../../../vs/workbench/browser/parts/editor/editorTabsControl.js";import{AccountsActivityActionViewItem as je,isAccountsActionVisible as Je,SimpleAccountActivityActionViewItem as Xe,SimpleGlobalActivityActionViewItem as Qe}from"../../../../../vs/workbench/browser/parts/globalCompositeBar.js";import{CommandCenterControl as et}from"../../../../../vs/workbench/browser/parts/titlebar/commandCenterControl.js";import{CustomMenubarControl as tt}from"../../../../../vs/workbench/browser/parts/titlebar/menubarControl.js";import{ACCOUNTS_ACTIVITY_TILE_ACTION as it,GLOBAL_ACTIVITY_TITLE_ACTION as ot}from"../../../../../vs/workbench/browser/parts/titlebar/titlebarActions.js";import{WindowTitle as rt}from"../../../../../vs/workbench/browser/parts/titlebar/windowTitle.js";import{ACCOUNTS_ACTIVITY_ID as re,GLOBAL_ACTIVITY_ID as ne}from"../../../../../vs/workbench/common/activity.js";import"../../../../../vs/workbench/common/editor.js";import{TITLE_BAR_ACTIVE_BACKGROUND as nt,TITLE_BAR_ACTIVE_FOREGROUND as at,TITLE_BAR_BORDER as st,TITLE_BAR_INACTIVE_BACKGROUND as ct,TITLE_BAR_INACTIVE_FOREGROUND as lt,WORKBENCH_BACKGROUND as dt}from"../../../../../vs/workbench/common/theme.js";import{IEditorGroupsService as K}from"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import{IEditorService as k}from"../../../../../vs/workbench/services/editor/common/editorService.js";import{IBrowserWorkbenchEnvironmentService as F}from"../../../../../vs/workbench/services/environment/browser/environmentService.js";import{IHostService as U}from"../../../../../vs/workbench/services/host/browser/host.js";import{ActivityBarPosition as ae,EditorActionsLocation as se,EditorTabsMode as ht,IWorkbenchLayoutService as Y,LayoutSettings as v,Parts as ce}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";import"../../../../../vs/workbench/services/title/browser/titleService.js";let V=class extends Ye{constructor(e,i,t){super("workbench.titleService",t,i);this.instantiationService=e;this._register(this.registerPart(this.mainPart)),this.registerActions(),this.registerAPICommands()}mainPart=this._register(this.createMainTitlebarPart());createMainTitlebarPart(){return this.instantiationService.createInstance(A)}registerActions(){const e=this;this._register(He(class extends Ne{constructor(){super({id:"workbench.action.focusTitleBar",title:we("focusTitleBar","Focus Title Bar"),category:Ve.View,f1:!0})}run(){e.getPartByDocument(pe()).focus()}}))}registerAPICommands(){this._register(We.registerCommand({id:"registerWindowTitleVariable",handler:(e,i,t)=>{this.registerVariables([{name:i,contextKey:t}])},metadata:{description:"Registers a new title variable",args:[{name:"name",schema:{type:"string"},description:"The name of the variable to register"},{name:"contextKey",schema:{type:"string"},description:"The context key to use for the value of the variable"}]}}))}createAuxiliaryTitlebarPart(e,i){const t=document.createElement("div");t.classList.add("part","titlebar"),t.setAttribute("role","none"),t.style.position="relative",e.insertBefore(t,e.firstChild);const r=new h,n=this.doCreateAuxiliaryTitlebarPart(t,i);return r.add(this.registerPart(n)),r.add(ie.runAndSubscribe(n.onDidChange,()=>t.style.height=`${n.height}px`)),n.create(t),this.properties&&n.updateProperties(this.properties),this.variables.size&&n.registerVariables(Array.from(this.variables.values())),ie.once(n.onWillDispose)(()=>r.dispose()),n}doCreateAuxiliaryTitlebarPart(e,i){return this.instantiationService.createInstance(m,e,i,this.mainPart)}onMenubarVisibilityChange=this.mainPart.onMenubarVisibilityChange;properties=void 0;updateProperties(e){this.properties=e;for(const i of this.parts)i.updateProperties(e)}variables=new Map;registerVariables(e){const i=[];for(const t of e)this.variables.has(t.name)||(this.variables.set(t.name,t),i.push(t));for(const t of this.parts)t.registerVariables(i)}};V=y([o(0,L),o(1,_),o(2,D)],V);let b=class extends Ze{constructor(e,i,t,r,n,S,g,f,I,T,E,M,O,P,Z,z){super(e,{hasTitle:!1},f,I,T);this.contextMenuService=r;this.configurationService=n;this.environmentService=S;this.instantiationService=g;this.storageService=I;this.contextKeyService=E;this.hostService=M;this.editorGroupService=O;this.menuService=Z;this.keybindingService=z;this.isAuxiliary=t!=="main",this.editorService=P.createScoped(t,this._store),this.editorGroupsContainer=t==="main"?O.mainPart:t,this.windowTitle=this._register(g.createInstance(rt,i,t)),this.hoverDelegate=this._register(Ce()),this.registerListeners(ve(i))}minimumWidth=0;maximumWidth=Number.POSITIVE_INFINITY;get minimumHeight(){const e=u&&me();let i=this.isCommandCenterVisible||e?ke:30;return e&&(i=Math.max(i,ue()?.height??0)),i/(this.preventZoom?B(p(this.element)):1)}get maximumHeight(){return this.minimumHeight}_onMenubarVisibilityChange=this._register(new te);onMenubarVisibilityChange=this._onMenubarVisibilityChange.event;_onWillDispose=this._register(new te);onWillDispose=this._onWillDispose.event;rootContainer;primaryWindowControls;dragRegion;title;leftContent;centerContent;rightContent;customMenubar;appIcon;appIconBadge;menubar;lastLayoutDimensions;actionToolBar;actionToolBarDisposable=this._register(new h);editorActionsChangeDisposable=this._register(new h);actionToolBarElement;layoutToolbarMenu;editorToolbarMenuDisposables=this._register(new h);layoutToolbarMenuDisposables=this._register(new h);activityToolbarDisposables=this._register(new h);hoverDelegate;titleDisposables=this._register(new h);titleBarStyle=Ue(this.configurationService);isInactive=!1;isAuxiliary;windowTitle;editorService;editorGroupsContainer;registerListeners(e){this._register(this.hostService.onDidChangeFocus(i=>i?this.onFocus():this.onBlur())),this._register(this.hostService.onDidChangeActiveWindow(i=>i===e?this.onFocus():this.onBlur())),this._register(this.configurationService.onDidChangeConfiguration(i=>this.onConfigurationChanged(i))),this._register(this.editorGroupService.onDidChangeEditorPartOptions(i=>this.onEditorPartConfigurationChange(i)))}onBlur(){this.isInactive=!0,this.updateStyles()}onFocus(){this.isInactive=!1,this.updateStyles()}onEditorPartConfigurationChange({oldPartOptions:e,newPartOptions:i}){(e.editorActionsLocation!==i.editorActionsLocation||e.showTabs!==i.showTabs)&&x(this.configurationService,this.titleBarStyle)&&this.actionToolBar&&(this.createActionToolBar(),this.createActionToolBarMenus({editorActions:!0}),this._onDidChange.fire(void 0))}onConfigurationChanged(e){if(!this.isAuxiliary&&!w(this.configurationService,this.titleBarStyle)&&(!l||u)&&e.affectsConfiguration("window.menuBarVisibility")&&(this.currentMenubarVisibility==="compact"?this.uninstallMenubar():this.installMenubar()),x(this.configurationService,this.titleBarStyle)&&this.actionToolBar){const i=e.affectsConfiguration(v.LAYOUT_ACTIONS),t=e.affectsConfiguration(v.ACTIVITY_BAR_LOCATION);(i||t)&&(this.createActionToolBarMenus({layoutActions:i,activityActions:t}),this._onDidChange.fire(void 0))}e.affectsConfiguration(v.COMMAND_CENTER)&&(this.createTitle(),this._onDidChange.fire(void 0))}installMenubar(){this.menubar||(this.customMenubar=this._register(this.instantiationService.createInstance(tt)),this.menubar=c(this.leftContent,s("div.menubar")),this.menubar.setAttribute("role","menubar"),this._register(this.customMenubar.onVisibilityChange(e=>this.onMenubarVisibilityChanged(e))),this.customMenubar.create(this.menubar))}uninstallMenubar(){this.customMenubar?.dispose(),this.customMenubar=void 0,this.menubar?.remove(),this.menubar=void 0,this.onMenubarVisibilityChanged(!1)}onMenubarVisibilityChanged(e){(u||Le||Be)&&(this.lastLayoutDimensions&&this.layout(this.lastLayoutDimensions.width,this.lastLayoutDimensions.height),this._onMenubarVisibilityChange.fire(e))}updateProperties(e){this.windowTitle.updateProperties(e)}registerVariables(e){this.windowTitle.registerVariables(e)}createContentArea(e){if(this.element=e,this.rootContainer=c(e,s(".titlebar-container")),this.leftContent=c(this.rootContainer,s(".titlebar-left")),this.centerContent=c(this.rootContainer,s(".titlebar-center")),this.rightContent=c(this.rootContainer,s(".titlebar-right")),!l&&!u&&!w(this.configurationService,this.titleBarStyle)&&(this.appIcon=X(this.leftContent,s("a.window-appicon")),!this.isAuxiliary&&u)){const t=this.environmentService.options?.homeIndicator;if(t){const r=Ke().getIcon(t.icon)?{id:t.icon}:Ee.code;this.appIcon.setAttribute("href",t.href),this.appIcon.classList.add(...De.asClassNameArray(r)),this.appIconBadge=document.createElement("div"),this.appIconBadge.classList.add("home-bar-icon-badge"),this.appIcon.appendChild(this.appIconBadge)}}this.dragRegion=X(this.rootContainer,s("div.titlebar-drag-region")),!this.isAuxiliary&&!w(this.configurationService,this.titleBarStyle)&&(!l||u)&&this.currentMenubarVisibility!=="compact"&&this.installMenubar(),this.title=c(this.centerContent,s("div.window-title")),this.createTitle(),x(this.configurationService,this.titleBarStyle)&&(this.actionToolBarElement=c(this.rightContent,s("div.action-toolbar-container")),this.createActionToolBar(),this.createActionToolBarMenus());let i=l?"left":"right";return l&&oe&&new Intl.Locale(_e)?.textInfo?.direction==="rtl"&&(i="right"),w(this.configurationService,this.titleBarStyle)||(this.primaryWindowControls=c(i==="left"?this.leftContent:this.rightContent,s("div.window-controls-container.primary")),c(i==="left"?this.rightContent:this.leftContent,s("div.window-controls-container.secondary"))),this._register($(this.rootContainer,J.CONTEXT_MENU,t=>{j.stop(t);let r;l&&ge(t.target)&&be(t.target,this.title)?r=C.TitleBarTitleContext:r=C.TitleBarContext,this.onContextMenu(t,r)})),l&&this._register($(this.title,J.MOUSE_DOWN,t=>{t.metaKey&&(j.stop(t,!0),this.onContextMenu(t,C.TitleBarTitleContext))},!0)),this.updateStyles(),this.element}createTitle(){if(this.titleDisposables.clear(),!this.isCommandCenterVisible)this.title.innerText=this.windowTitle.value,this.titleDisposables.add(this.windowTitle.onDidChange(()=>{this.title.innerText=this.windowTitle.value}));else{const e=this.instantiationService.createInstance(et,this.windowTitle,this.hoverDelegate);fe(this.title,e.element),this.titleDisposables.add(e)}}actionViewItemProvider(e,i){if(!this.isAuxiliary){if(e.id===ne)return this.instantiationService.createInstance(Qe,{position:()=>ee.BELOW},i);if(e.id===re)return this.instantiationService.createInstance(Xe,{position:()=>ee.BELOW},i)}const t=this.editorGroupsContainer.activeGroup?.activeEditorPane;if(t&&t instanceof $e){const r=t.getActionViewItem(e,i);if(r)return r}return Oe(this.instantiationService,e,{...i,menuAsChild:!1})}getKeybinding(e){const i=this.editorGroupsContainer.activeGroup?.activeEditorPane?.scopedContextKeyService??this.contextKeyService;return this.keybindingService.lookupKeybinding(e.id,i)}createActionToolBar(){this.actionToolBarDisposable.clear(),this.actionToolBar=this.actionToolBarDisposable.add(this.instantiationService.createInstance(Re,this.actionToolBarElement,{contextMenu:C.TitleBarContext,orientation:Te.HORIZONTAL,ariaLabel:xe("ariaLabelTitleActions","Title actions"),getKeyBinding:e=>this.getKeybinding(e),overflowBehavior:{maxItems:9,exempted:[re,ne,...ze]},anchorAlignmentProvider:()=>ye.RIGHT,telemetrySource:"titlePart",highlightToggledItems:this.editorActionsEnabled,actionViewItemProvider:(e,i)=>this.actionViewItemProvider(e,i),hoverDelegate:this.hoverDelegate})),this.editorActionsEnabled&&this.actionToolBarDisposable.add(this.editorGroupsContainer.onDidChangeActiveGroup(()=>this.createActionToolBarMenus({editorActions:!0})))}createActionToolBarMenus(e=!0){e===!0&&(e={editorActions:!0,layoutActions:!0,activityActions:!0});const i=()=>{const t={primary:[],secondary:[]};if(this.editorActionsEnabled){this.editorActionsChangeDisposable.clear();const r=this.editorGroupsContainer.activeGroup;if(r){const n=r.createEditorActions(this.editorActionsChangeDisposable);t.primary.push(...n.actions.primary),t.secondary.push(...n.actions.secondary),this.editorActionsChangeDisposable.add(n.onDidChange(()=>i()))}}this.layoutToolbarMenu&&Pe(this.layoutToolbarMenu,{},t,()=>!this.editorActionsEnabled),this.activityActionsEnabled&&(Je(this.storageService)&&t.primary.push(it),t.primary.push(ot)),this.actionToolBar.setActions(Q(t.primary),Q(t.secondary))};if(e.editorActions)if(this.editorToolbarMenuDisposables.clear(),this.editorActionsEnabled&&this.editorService.activeEditor!==void 0){const t={groupId:this.editorGroupsContainer.activeGroup.id};this.actionToolBar.actionRunner=new qe(t),this.actionToolBar.context=t,this.editorToolbarMenuDisposables.add(this.actionToolBar.actionRunner)}else this.actionToolBar.actionRunner=new Se,this.actionToolBar.context=void 0,this.editorToolbarMenuDisposables.add(this.actionToolBar.actionRunner);e.layoutActions&&(this.layoutToolbarMenuDisposables.clear(),this.layoutControlEnabled?(this.layoutToolbarMenu=this.menuService.createMenu(C.LayoutControlMenu,this.contextKeyService),this.layoutToolbarMenuDisposables.add(this.layoutToolbarMenu),this.layoutToolbarMenuDisposables.add(this.layoutToolbarMenu.onDidChange(()=>i()))):this.layoutToolbarMenu=void 0),e.activityActions&&(this.activityToolbarDisposables.clear(),this.activityActionsEnabled&&this.activityToolbarDisposables.add(this.storageService.onDidChangeValue(Ge.PROFILE,je.ACCOUNTS_VISIBILITY_PREFERENCE_KEY,this._store)(()=>i()))),i()}updateStyles(){if(super.updateStyles(),this.element){this.isInactive?this.element.classList.add("inactive"):this.element.classList.remove("inactive");const e=this.getColor(this.isInactive?ct:nt,(r,n)=>r.isOpaque()?r:r.makeOpaque(dt(n)))||"";this.element.style.backgroundColor=e,this.appIconBadge&&(this.appIconBadge.style.backgroundColor=e),e&&Me.fromHex(e).isLighter()?this.element.classList.add("light"):this.element.classList.remove("light");const i=this.getColor(this.isInactive?lt:at);this.element.style.color=i||"";const t=this.getColor(st);this.element.style.borderBottom=t?`1px solid ${t}`:""}}onContextMenu(e,i){const t=new Ie(p(this.element),e);this.contextMenuService.showContextMenu({getAnchor:()=>t,menuId:i,contextKeyService:this.contextKeyService,domForShadowRoot:l&&oe?t.target:void 0})}get currentMenubarVisibility(){return this.isAuxiliary?"hidden":Fe(this.configurationService)}get layoutControlEnabled(){return!this.isAuxiliary&&this.configurationService.getValue(v.LAYOUT_ACTIONS)!==!1}get isCommandCenterVisible(){return this.configurationService.getValue(v.COMMAND_CENTER)!==!1}get editorActionsEnabled(){return this.editorGroupService.partOptions.editorActionsLocation===se.TITLEBAR||this.editorGroupService.partOptions.editorActionsLocation===se.DEFAULT&&this.editorGroupService.partOptions.showTabs===ht.NONE}get activityActionsEnabled(){const e=this.configurationService.getValue(v.ACTIVITY_BAR_LOCATION);return!this.isAuxiliary&&(e===ae.TOP||e===ae.BOTTOM)}get hasZoomableElements(){const e=!(this.currentMenubarVisibility==="hidden"||this.currentMenubarVisibility==="compact"||!u&&l),i=this.isCommandCenterVisible,t=this.layoutControlEnabled||this.editorActionsEnabled||this.activityActionsEnabled;return e||i||t}get preventZoom(){return B(p(this.element))<1||!this.hasZoomableElements}layout(e,i){this.updateLayout(new q(e,i)),super.layoutContents(e,i)}updateLayout(e){if(this.lastLayoutDimensions=e,x(this.configurationService,this.titleBarStyle)){const i=B(p(this.element));if(this.element.style.setProperty("--zoom-factor",i.toString()),this.rootContainer.classList.toggle("counter-zoom",this.preventZoom),this.customMenubar){const t=new q(0,e.height);this.customMenubar.layout(t)}}}focus(){this.customMenubar?this.customMenubar.toggleFocus():this.element.querySelector('[tabindex]:not([tabindex="-1"])').focus()}toJSON(){return{type:ce.TITLEBAR_PART}}dispose(){this._onWillDispose.fire(),super.dispose()}};b=y([o(3,W),o(4,N),o(5,F),o(6,L),o(7,D),o(8,_),o(9,Y),o(10,H),o(11,U),o(12,K),o(13,k),o(14,R),o(15,G)],b);let A=class extends b{constructor(a,e,i,t,r,n,S,g,f,I,T,E,M){super(ce.TITLEBAR_PART,Ae,"main",a,e,i,t,r,n,S,g,f,I,T,E,M)}};A=y([o(0,W),o(1,N),o(2,F),o(3,L),o(4,D),o(5,_),o(6,Y),o(7,H),o(8,U),o(9,K),o(10,k),o(11,R),o(12,G)],A);let m=class extends b{constructor(e,i,t,r,n,S,g,f,I,T,E,M,O,P,Z,z){const le=m.COUNTER++;super(`workbench.parts.auxiliaryTitle.${le}`,p(e),i,r,n,S,g,f,I,T,E,M,O,P,Z,z);this.container=e;this.mainTitlebar=t}static COUNTER=1;get height(){return this.minimumHeight}get preventZoom(){return B(p(this.element))<1||!this.mainTitlebar.hasZoomableElements}};m=y([o(3,W),o(4,N),o(5,F),o(6,L),o(7,D),o(8,_),o(9,Y),o(10,H),o(11,U),o(12,K),o(13,k),o(14,R),o(15,G)],m);export{m as AuxiliaryBrowserTitlebarPart,V as BrowserTitleService,b as BrowserTitlebarPart,A as MainBrowserTitlebarPart};
