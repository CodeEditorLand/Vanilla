var k=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var y=(a,d,e,t)=>{for(var i=t>1?void 0:t?_(d,e):d,r=a.length-1,o;r>=0;r--)(o=a[r])&&(i=(t?o(d,e,i):o(i))||i);return t&&i&&k(d,e,i),i},n=(a,d)=>(e,t)=>d(e,t,a);import{getWindowById as R}from"../../../../base/browser/dom.js";import{RunOnceScheduler as A}from"../../../../base/common/async.js";import{Emitter as O}from"../../../../base/common/event.js";import{template as M}from"../../../../base/common/labels.js";import{Disposable as H,DisposableStore as K}from"../../../../base/common/lifecycle.js";import{Schemas as B}from"../../../../base/common/network.js";import{isMacintosh as g,isNative as Y,isWeb as w,isWindows as j}from"../../../../base/common/platform.js";import{basename as G,dirname as X}from"../../../../base/common/resources.js";import{trim as z}from"../../../../base/common/strings.js";import{isCodeEditor as q,isDiffEditor as J}from"../../../../editor/browser/editorBrowser.js";import{localize as S}from"../../../../nls.js";import{IConfigurationService as Q}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as Z}from"../../../../platform/contextkey/common/contextkey.js";import{ILabelService as ee,Verbosity as te}from"../../../../platform/label/common/label.js";import{IProductService as ie}from"../../../../platform/product/common/productService.js";import{getVirtualWorkspaceLocation as re}from"../../../../platform/workspace/common/virtualWorkspace.js";import{IWorkspaceContextService as oe,WorkbenchState as se}from"../../../../platform/workspace/common/workspace.js";import{EditorResourceAccessor as ne,SideBySideEditor as ae,Verbosity as h}from"../../../common/editor.js";import{IEditorService as de}from"../../../services/editor/common/editorService.js";import{IBrowserWorkbenchEnvironmentService as ce}from"../../../services/environment/browser/environmentService.js";import{IUserDataProfileService as le}from"../../../services/userDataProfile/common/userDataProfile.js";import{IViewsService as pe}from"../../../services/views/common/viewsService.js";var he=(e=>(e.titleSeparator="window.titleSeparator",e.title="window.title",e))(he||{});const ue=(()=>{if(g&&Y)return"${activeEditorShort}${separator}${rootName}${separator}${profileName}";const a="${dirty}${activeEditorShort}${separator}${rootName}${separator}${profileName}${separator}${appName}";return w?a+"${separator}${remoteName}":a})(),ve=g?" \u2014 ":" - ";let s=class extends H{constructor(e,t,i,r,o,c,p,u,v,I,E){super();this.configurationService=i;this.contextKeyService=r;this.environmentService=c;this.contextService=p;this.labelService=u;this.userDataProfileService=v;this.productService=I;this.viewsService=E;this.editorService=o.createScoped(t,this._store),this.windowId=e.vscodeWindowId,this.updateTitleIncludesFocusedView(),this.registerListeners()}static NLS_USER_IS_ADMIN=j?S("userIsAdmin","[Administrator]"):S("userIsSudo","[Superuser]");static NLS_EXTENSION_HOST=S("devExtensionWindowTitlePrefix","[Extension Development Host]");static TITLE_DIRTY="\u25CF ";properties={isPure:!0,isAdmin:!1,prefix:void 0};variables=new Map;activeEditorListeners=this._register(new K);titleUpdater=this._register(new A(()=>this.doUpdateTitle(),0));onDidChangeEmitter=new O;onDidChange=this.onDidChangeEmitter.event;get value(){return this.title??""}get workspaceName(){return this.labelService.getWorkspaceLabel(this.contextService.getWorkspace())}get fileName(){const e=this.editorService.activeEditor;if(!e)return;const t=e.getTitle(h.SHORT);return`${e?.isDirty()&&!e.isSaving()?s.TITLE_DIRTY:""}${t}`}title;titleIncludesFocusedView=!1;editorService;windowId;registerListeners(){this._register(this.configurationService.onDidChangeConfiguration(e=>this.onConfigurationChanged(e))),this._register(this.editorService.onDidActiveEditorChange(()=>this.onActiveEditorChange())),this._register(this.contextService.onDidChangeWorkspaceFolders(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.titleUpdater.schedule())),this._register(this.contextService.onDidChangeWorkspaceName(()=>this.titleUpdater.schedule())),this._register(this.labelService.onDidChangeFormatters(()=>this.titleUpdater.schedule())),this._register(this.userDataProfileService.onDidChangeCurrentProfile(()=>this.titleUpdater.schedule())),this._register(this.viewsService.onDidChangeFocusedView(()=>{this.titleIncludesFocusedView&&this.titleUpdater.schedule()})),this._register(this.contextKeyService.onDidChangeContext(e=>{e.affectsSome(this.variables)&&this.titleUpdater.schedule()}))}onConfigurationChanged(e){e.affectsConfiguration("window.title")&&this.updateTitleIncludesFocusedView(),(e.affectsConfiguration("window.title")||e.affectsConfiguration("window.titleSeparator"))&&this.titleUpdater.schedule()}updateTitleIncludesFocusedView(){const e=this.configurationService.getValue("window.title");this.titleIncludesFocusedView=typeof e=="string"&&e.includes("${focusedView}")}onActiveEditorChange(){this.activeEditorListeners.clear(),this.titleUpdater.schedule();const e=this.editorService.activeEditor;if(e&&(this.activeEditorListeners.add(e.onDidChangeDirty(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(e.onDidChangeLabel(()=>this.titleUpdater.schedule()))),this.titleIncludesFocusedView){const t=this.editorService.activeTextEditorControl,i=[];q(t)?i.push(t):J(t)&&i.push(t.getOriginalEditor(),t.getModifiedEditor());for(const r of i)this.activeEditorListeners.add(r.onDidBlurEditorText(()=>this.titleUpdater.schedule())),this.activeEditorListeners.add(r.onDidFocusEditorText(()=>this.titleUpdater.schedule()))}}doUpdateTitle(){const e=this.getFullWindowTitle();if(e!==this.title){let t=e;z(t)||(t=this.productService.nameLong);const i=R(this.windowId,!0).window;!i.document.title&&g&&t===this.productService.nameLong&&(i.document.title=`${this.productService.nameLong} ${s.TITLE_DIRTY}`),i.document.title=t,this.title=e,this.onDidChangeEmitter.fire()}}getFullWindowTitle(){const{prefix:e,suffix:t}=this.getTitleDecorations();let i=this.getWindowTitle()||this.productService.nameLong;return e&&(i=`${e} ${i}`),t&&(i=`${i} ${t}`),i.replace(/[^\S ]/g," ")}getTitleDecorations(){let e,t;return this.properties.prefix&&(e=this.properties.prefix),this.environmentService.isExtensionDevelopment&&(e=e?`${s.NLS_EXTENSION_HOST} - ${e}`:s.NLS_EXTENSION_HOST),this.properties.isAdmin&&(t=s.NLS_USER_IS_ADMIN),{prefix:e,suffix:t}}updateProperties(e){const t=typeof e.isAdmin=="boolean"?e.isAdmin:this.properties.isAdmin,i=typeof e.isPure=="boolean"?e.isPure:this.properties.isPure,r=typeof e.prefix=="string"?e.prefix:this.properties.prefix;(t!==this.properties.isAdmin||i!==this.properties.isPure||r!==this.properties.prefix)&&(this.properties.isAdmin=t,this.properties.isPure=i,this.properties.prefix=r,this.titleUpdater.schedule())}registerVariables(e){let t=!1;for(const{name:i,contextKey:r}of e)this.variables.has(r)||(this.variables.set(r,i),t=!0);t&&this.titleUpdater.schedule()}getWindowTitle(){const e=this.editorService.activeEditor,t=this.contextService.getWorkspace();let i;t.configuration?i=t.configuration:t.folders.length&&(i=t.folders[0].uri);const r=ne.getOriginalUri(e,{supportSideBySide:ae.PRIMARY});let o=r?X(r):void 0;o?.path==="."&&(o=void 0);let c;this.contextService.getWorkbenchState()===se.FOLDER?c=t.folders[0]:r&&(c=this.contextService.getWorkspaceFolder(r)??void 0);let p;if(this.environmentService.remoteAuthority&&!w)p=this.labelService.getHostLabel(B.vscodeRemote,this.environmentService.remoteAuthority);else{const l=re(t);l&&(p=this.labelService.getHostLabel(l.scheme,l.authority))}const u=e?e.getTitle(h.SHORT):"",v=e?e.getTitle(h.MEDIUM):u,I=e?e.getTitle(h.LONG):v,E=o?G(o):"",C=o?this.labelService.getUriLabel(o,{relative:!0}):"",x=o?this.labelService.getUriLabel(o):"",T=this.labelService.getWorkspaceLabel(t),D=this.labelService.getWorkspaceLabel(t,{verbose:te.SHORT}),L=i?this.labelService.getUriLabel(i):"",N=c?c.name:"",U=c?this.labelService.getUriLabel(c.uri):"",W=e?.isDirty()&&!e.isSaving()?s.TITLE_DIRTY:"",P=this.productService.nameLong,V=this.userDataProfileService.currentProfile.isDefault?"":this.userDataProfileService.currentProfile.name,$=this.viewsService.getFocusedViewName(),b={};for(const[l,F]of this.variables)b[F]=this.contextKeyService.getContextKeyValue(l)??"";let f=this.configurationService.getValue("window.title");typeof f!="string"&&(f=ue);let m=this.configurationService.getValue("window.titleSeparator");return typeof m!="string"&&(m=ve),M(f,{...b,activeEditorShort:u,activeEditorLong:I,activeEditorMedium:v,activeFolderShort:E,activeFolderMedium:C,activeFolderLong:x,rootName:T,rootPath:L,rootNameShort:D,folderName:N,folderPath:U,dirty:W,appName:P,remoteName:p,profileName:V,focusedView:$,separator:{label:m}})}isCustomTitleFormat(){const e=this.configurationService.inspect("window.title"),t=this.configurationService.inspect("window.titleSeparator");return e.value!==e.defaultValue||t.value!==t.defaultValue}};s=y([n(2,Q),n(3,Z),n(4,de),n(5,ce),n(6,oe),n(7,ee),n(8,le),n(9,ie),n(10,pe)],s);export{s as WindowTitle,ue as defaultWindowTitle,ve as defaultWindowTitleSeparator};
