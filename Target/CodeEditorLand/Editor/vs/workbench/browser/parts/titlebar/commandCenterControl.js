var x=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var w=(v,s,e,r)=>{for(var t=r>1?void 0:r?C(s,e):s,i=v.length-1,n;i>=0;i--)(n=v[i])&&(t=(r?n(s,e,t):n(t))||t);return r&&t&&x(s,e,t),t},c=(v,s)=>(e,r)=>s(e,r,v);import{isActiveDocument as T,reset as O}from"../../../../base/browser/dom.js";import{BaseActionViewItem as S}from"../../../../base/browser/ui/actionbar/actionViewItems.js";import{getDefaultHoverDelegate as V}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import"../../../../base/browser/ui/hover/hoverDelegate.js";import{renderIcon as W}from"../../../../base/browser/ui/iconLabel/iconLabels.js";import{SubmenuAction as N}from"../../../../base/common/actions.js";import{Codicon as y}from"../../../../base/common/codicons.js";import{Emitter as B,Event as D}from"../../../../base/common/event.js";import{DisposableStore as G}from"../../../../base/common/lifecycle.js";import{localize as u}from"../../../../nls.js";import{createActionViewItem as k}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{HiddenItemStrategy as H,MenuWorkbenchToolBar as q,WorkbenchToolBar as P}from"../../../../platform/actions/browser/toolbar.js";import{MenuId as _,MenuRegistry as K,SubmenuItemAction as Q}from"../../../../platform/actions/common/actions.js";import{IInstantiationService as L}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as F}from"../../../../platform/keybinding/common/keybinding.js";import{IQuickInputService as z}from"../../../../platform/quickinput/common/quickInput.js";import"./windowTitle.js";import{IEditorGroupsService as R}from"../../../services/editor/common/editorGroupsService.js";import{IHoverService as j}from"../../../../platform/hover/browser/hover.js";let f=class{_disposables=new G;_onDidChangeVisibility=new B;onDidChangeVisibility=this._onDidChangeVisibility.event;element=document.createElement("div");constructor(s,e,r,t){this.element.classList.add("command-center");const i=r.createInstance(q,this.element,_.CommandCenter,{contextMenu:_.TitleBarContext,hiddenItemStrategy:H.NoHide,toolbarOptions:{primaryGroup:()=>!0},telemetrySource:"commandCenter",actionViewItemProvider:(n,h)=>n instanceof Q&&n.item.submenu===_.CommandCenterCenter?r.createInstance(m,n,s,{...h,hoverDelegate:e}):k(r,n,{...h,hoverDelegate:e})});this._disposables.add(D.filter(t.onShow,()=>T(this.element),this._disposables)(this._setVisibility.bind(this,!1))),this._disposables.add(D.filter(t.onHide,()=>T(this.element),this._disposables)(this._setVisibility.bind(this,!0))),this._disposables.add(i)}_setVisibility(s){this.element.classList.toggle("hide",!s),this._onDidChangeVisibility.fire()}dispose(){this._disposables.dispose()}};f=w([c(2,L),c(3,z)],f);let m=class extends S{constructor(e,r,t,i,n,h,l){super(void 0,e.actions.find(p=>p.id==="workbench.action.quickOpenWithModes")??e.actions[0],t);this._submenu=e;this._windowTitle=r;this._hoverService=i;this._keybindingService=n;this._instaService=h;this._editorGroupService=l;this._hoverDelegate=t.hoverDelegate??V("mouse")}static _quickOpenCommandId="workbench.action.quickOpenWithModes";_hoverDelegate;render(e){super.render(e),e.classList.add("command-center-center"),e.classList.toggle("multiple",this._submenu.actions.length>1);const r=this._store.add(this._hoverService.setupManagedHover(this._hoverDelegate,e,this.getTooltip()));this._store.add(this._windowTitle.onDidChange(()=>{r.update(this.getTooltip())}));const t=[];for(const i of this._submenu.actions)i instanceof N?t.push(i.actions):t.push([i]);for(let i=0;i<t.length;i++){const n=t[i],h=this._instaService.createInstance(P,e,{hiddenItemStrategy:H.NoHide,telemetrySource:"commandCenterCenter",actionViewItemProvider:(l,p)=>{if(p={...p,hoverDelegate:this._hoverDelegate},l.id!==m._quickOpenCommandId)return k(this._instaService,l,p);const a=this;return this._instaService.createInstance(class extends S{constructor(){super(void 0,l,p)}render(d){super.render(d),d.classList.toggle("command-center-quick-pick"),d.role="button";const b=this.action,o=document.createElement("span");o.ariaHidden="true",o.className=b.class??"",o.classList.add("search-icon");const E=this._getLabel(),g=document.createElement("span");g.classList.add("search-label"),g.innerText=E,O(d,o,g);const I=this._store.add(a._hoverService.setupManagedHover(a._hoverDelegate,d,this.getTooltip()));this._store.add(a._windowTitle.onDidChange(()=>{I.update(this.getTooltip()),g.innerText=this._getLabel()})),this._store.add(a._editorGroupService.onDidChangeEditorPartOptions(({newPartOptions:A,oldPartOptions:M})=>{A.showTabs!==M.showTabs&&(I.update(this.getTooltip()),g.innerText=this._getLabel())}))}getTooltip(){return a.getTooltip()}_getLabel(){const{prefix:d,suffix:b}=a._windowTitle.getTitleDecorations();let o=a._windowTitle.workspaceName;return a._windowTitle.isCustomTitleFormat()?o=a._windowTitle.getWindowTitle():a._editorGroupService.partOptions.showTabs==="none"&&(o=a._windowTitle.fileName??o),o||(o=u("label.dfl","Search")),d&&(o=u("label1","{0} {1}",d,o)),b&&(o=u("label2","{0} {1}",o,b)),o.replaceAll(/\r\n|\r|\n/g,"\u23CE")}})}});if(h.setActions(n),this._store.add(h),i<t.length-1){const l=W(y.circleSmallFilled);l.style.padding="0 12px",l.style.height="100%",l.style.opacity="0.5",e.appendChild(l)}}}getTooltip(){const e=this._keybindingService.lookupKeybinding(this.action.id)?.getLabel();return e?u("title","Search {0} ({1}) \u2014 {2}",this._windowTitle.workspaceName,e,this._windowTitle.value):u("title2","Search {0} \u2014 {1}",this._windowTitle.workspaceName,this._windowTitle.value)}};m=w([c(3,j),c(4,F),c(5,L),c(6,R)],m),K.appendMenuItem(_.CommandCenter,{submenu:_.CommandCenterCenter,title:u("title3","Command Center"),icon:y.shield,order:101});export{f as CommandCenterControl};
