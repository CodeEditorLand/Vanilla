{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/browser/parts/editor/editorConfiguration.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { coalesce } from \"../../../../base/common/arrays.js\";\nimport { Event } from \"../../../../base/common/event.js\";\nimport type { IJSONSchemaMap } from \"../../../../base/common/jsonSchema.js\";\nimport { Disposable } from \"../../../../base/common/lifecycle.js\";\nimport { localize } from \"../../../../nls.js\";\nimport {\n\tExtensions as ConfigurationExtensions,\n\tConfigurationScope,\n\ttype IConfigurationNode,\n\ttype IConfigurationRegistry,\n} from \"../../../../platform/configuration/common/configurationRegistry.js\";\nimport {\n\tByteSize,\n\tgetLargeFileConfirmationLimit,\n} from \"../../../../platform/files/common/files.js\";\nimport { Registry } from \"../../../../platform/registry/common/platform.js\";\nimport { workbenchConfigurationNodeBase } from \"../../../common/configuration.js\";\nimport type { IWorkbenchContribution } from \"../../../common/contributions.js\";\nimport {\n\tIEditorResolverService,\n\ttype RegisteredEditorInfo,\n\tRegisteredEditorPriority,\n} from \"../../../services/editor/common/editorResolverService.js\";\nimport { IWorkbenchEnvironmentService } from \"../../../services/environment/common/environmentService.js\";\nimport { IExtensionService } from \"../../../services/extensions/common/extensions.js\";\n\nexport class DynamicEditorConfigurations\n\textends Disposable\n\timplements IWorkbenchContribution\n{\n\tstatic readonly ID = \"workbench.contrib.dynamicEditorConfigurations\";\n\n\tprivate static readonly AUTO_LOCK_DEFAULT_ENABLED = new Set<string>([\n\t\t\"terminalEditor\",\n\t\t\"mainThreadWebview-simpleBrowser.view\",\n\t\t\"mainThreadWebview-browserPreview\",\n\t]);\n\n\tprivate static readonly AUTO_LOCK_EXTRA_EDITORS: RegisteredEditorInfo[] = [\n\t\t// List some editor input identifiers that are not\n\t\t// registered yet via the editor resolver infrastructure\n\n\t\t{\n\t\t\tid: \"workbench.input.interactive\",\n\t\t\tlabel: localize(\"interactiveWindow\", \"Interactive Window\"),\n\t\t\tpriority: RegisteredEditorPriority.builtin,\n\t\t},\n\t\t{\n\t\t\tid: \"mainThreadWebview-markdown.preview\",\n\t\t\tlabel: localize(\"markdownPreview\", \"Markdown Preview\"),\n\t\t\tpriority: RegisteredEditorPriority.builtin,\n\t\t},\n\t\t{\n\t\t\tid: \"mainThreadWebview-simpleBrowser.view\",\n\t\t\tlabel: localize(\"simpleBrowser\", \"Simple Browser\"),\n\t\t\tpriority: RegisteredEditorPriority.builtin,\n\t\t},\n\t\t{\n\t\t\tid: \"mainThreadWebview-browserPreview\",\n\t\t\tlabel: localize(\"livePreview\", \"Live Preview\"),\n\t\t\tpriority: RegisteredEditorPriority.builtin,\n\t\t},\n\t];\n\n\tprivate static readonly AUTO_LOCK_REMOVE_EDITORS = new Set<string>([\n\t\t// List some editor types that the above `AUTO_LOCK_EXTRA_EDITORS`\n\t\t// already covers to avoid duplicates.\n\n\t\t\"vscode-interactive-input\",\n\t\t\"interactive\",\n\t\t\"vscode.markdown.preview.editor\",\n\t]);\n\n\tprivate readonly configurationRegistry =\n\t\tRegistry.as<IConfigurationRegistry>(\n\t\t\tConfigurationExtensions.Configuration,\n\t\t);\n\n\tprivate autoLockConfigurationNode: IConfigurationNode | undefined;\n\tprivate defaultBinaryEditorConfigurationNode:\n\t\t| IConfigurationNode\n\t\t| undefined;\n\tprivate editorAssociationsConfigurationNode: IConfigurationNode | undefined;\n\tprivate editorLargeFileConfirmationConfigurationNode:\n\t\t| IConfigurationNode\n\t\t| undefined;\n\n\tconstructor(\n\t\t@IEditorResolverService private readonly editorResolverService: IEditorResolverService,\n\t\t@IExtensionService extensionService: IExtensionService,\n\t\t@IWorkbenchEnvironmentService private readonly environmentService: IWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\t// Editor configurations are getting updated very aggressively\n\t\t// (atleast 20 times) while the extensions are getting registered.\n\t\t// As such push out the dynamic configuration until after extensions\n\t\t// are registered.\n\t\t(async () => {\n\t\t\tawait extensionService.whenInstalledExtensionsRegistered();\n\n\t\t\tthis.updateDynamicEditorConfigurations();\n\t\t\tthis.registerListeners();\n\t\t})();\n\t}\n\n\tprivate registerListeners(): void {\n\t\t// Registered editors (debounced to reduce perf overhead)\n\t\tthis._register(\n\t\t\tEvent.debounce(\n\t\t\t\tthis.editorResolverService.onDidChangeEditorRegistrations,\n\t\t\t\t(_, e) => e,\n\t\t\t)(() => this.updateDynamicEditorConfigurations()),\n\t\t);\n\t}\n\n\tprivate updateDynamicEditorConfigurations(): void {\n\t\tconst lockableEditors = [\n\t\t\t...this.editorResolverService.getEditors(),\n\t\t\t...DynamicEditorConfigurations.AUTO_LOCK_EXTRA_EDITORS,\n\t\t].filter(\n\t\t\t(e) =>\n\t\t\t\t!DynamicEditorConfigurations.AUTO_LOCK_REMOVE_EDITORS.has(e.id),\n\t\t);\n\t\tconst binaryEditorCandidates = this.editorResolverService\n\t\t\t.getEditors()\n\t\t\t.filter((e) => e.priority !== RegisteredEditorPriority.exclusive)\n\t\t\t.map((e) => e.id);\n\n\t\t// Build config from registered editors\n\t\tconst autoLockGroupConfiguration: IJSONSchemaMap = Object.create(null);\n\t\tfor (const editor of lockableEditors) {\n\t\t\tautoLockGroupConfiguration[editor.id] = {\n\t\t\t\ttype: \"boolean\",\n\t\t\t\tdefault:\n\t\t\t\t\tDynamicEditorConfigurations.AUTO_LOCK_DEFAULT_ENABLED.has(\n\t\t\t\t\t\teditor.id,\n\t\t\t\t\t),\n\t\t\t\tdescription: editor.label,\n\t\t\t};\n\t\t}\n\n\t\t// Build default config too\n\t\tconst defaultAutoLockGroupConfiguration = Object.create(null);\n\t\tfor (const editor of lockableEditors) {\n\t\t\tdefaultAutoLockGroupConfiguration[editor.id] =\n\t\t\t\tDynamicEditorConfigurations.AUTO_LOCK_DEFAULT_ENABLED.has(\n\t\t\t\t\teditor.id,\n\t\t\t\t);\n\t\t}\n\n\t\t// Register setting for auto locking groups\n\t\tconst oldAutoLockConfigurationNode = this.autoLockConfigurationNode;\n\t\tthis.autoLockConfigurationNode = {\n\t\t\t...workbenchConfigurationNodeBase,\n\t\t\tproperties: {\n\t\t\t\t\"workbench.editor.autoLockGroups\": {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tdescription: localize(\n\t\t\t\t\t\t\"workbench.editor.autoLockGroups\",\n\t\t\t\t\t\t\"If an editor matching one of the listed types is opened as the first in an editor group and more than one group is open, the group is automatically locked. Locked groups will only be used for opening editors when explicitly chosen by a user gesture (for example drag and drop), but not by default. Consequently, the active editor in a locked group is less likely to be replaced accidentally with a different editor.\",\n\t\t\t\t\t),\n\t\t\t\t\tproperties: autoLockGroupConfiguration,\n\t\t\t\t\tdefault: defaultAutoLockGroupConfiguration,\n\t\t\t\t\tadditionalProperties: false,\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\t// Registers setting for default binary editors\n\t\tconst oldDefaultBinaryEditorConfigurationNode =\n\t\t\tthis.defaultBinaryEditorConfigurationNode;\n\t\tthis.defaultBinaryEditorConfigurationNode = {\n\t\t\t...workbenchConfigurationNodeBase,\n\t\t\tproperties: {\n\t\t\t\t\"workbench.editor.defaultBinaryEditor\": {\n\t\t\t\t\ttype: \"string\",\n\t\t\t\t\tdefault: \"\",\n\t\t\t\t\t// This allows for intellisense autocompletion\n\t\t\t\t\tenum: [...binaryEditorCandidates, \"\"],\n\t\t\t\t\tdescription: localize(\n\t\t\t\t\t\t\"workbench.editor.defaultBinaryEditor\",\n\t\t\t\t\t\t\"The default editor for files detected as binary. If undefined, the user will be presented with a picker.\",\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\t// Registers setting for editorAssociations\n\t\tconst oldEditorAssociationsConfigurationNode =\n\t\t\tthis.editorAssociationsConfigurationNode;\n\t\tthis.editorAssociationsConfigurationNode = {\n\t\t\t...workbenchConfigurationNodeBase,\n\t\t\tproperties: {\n\t\t\t\t\"workbench.editorAssociations\": {\n\t\t\t\t\ttype: \"object\",\n\t\t\t\t\tmarkdownDescription: localize(\n\t\t\t\t\t\t\"editor.editorAssociations\",\n\t\t\t\t\t\t'Configure [glob patterns](https://aka.ms/vscode-glob-patterns) to editors (for example `\"*.hex\": \"hexEditor.hexedit\"`). These have precedence over the default behavior.',\n\t\t\t\t\t),\n\t\t\t\t\tpatternProperties: {\n\t\t\t\t\t\t\".*\": {\n\t\t\t\t\t\t\ttype: \"string\",\n\t\t\t\t\t\t\tenum: binaryEditorCandidates,\n\t\t\t\t\t\t},\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\t// Registers setting for large file confirmation based on environment\n\t\tconst oldEditorLargeFileConfirmationConfigurationNode =\n\t\t\tthis.editorLargeFileConfirmationConfigurationNode;\n\t\tthis.editorLargeFileConfirmationConfigurationNode = {\n\t\t\t...workbenchConfigurationNodeBase,\n\t\t\tproperties: {\n\t\t\t\t\"workbench.editorLargeFileConfirmation\": {\n\t\t\t\t\ttype: \"number\",\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tgetLargeFileConfirmationLimit(\n\t\t\t\t\t\t\tthis.environmentService.remoteAuthority,\n\t\t\t\t\t\t) / ByteSize.MB,\n\t\t\t\t\tminimum: 1,\n\t\t\t\t\tscope: ConfigurationScope.RESOURCE,\n\t\t\t\t\tmarkdownDescription: localize(\n\t\t\t\t\t\t\"editorLargeFileSizeConfirmation\",\n\t\t\t\t\t\t\"Controls the minimum size of a file in MB before asking for confirmation when opening in the editor. Note that this setting may not apply to all editor types and environments.\",\n\t\t\t\t\t),\n\t\t\t\t},\n\t\t\t},\n\t\t};\n\n\t\tthis.configurationRegistry.updateConfigurations({\n\t\t\tadd: [\n\t\t\t\tthis.autoLockConfigurationNode,\n\t\t\t\tthis.defaultBinaryEditorConfigurationNode,\n\t\t\t\tthis.editorAssociationsConfigurationNode,\n\t\t\t\tthis.editorLargeFileConfirmationConfigurationNode,\n\t\t\t],\n\t\t\tremove: coalesce([\n\t\t\t\toldAutoLockConfigurationNode,\n\t\t\t\toldDefaultBinaryEditorConfigurationNode,\n\t\t\t\toldEditorAssociationsConfigurationNode,\n\t\t\t\toldEditorLargeFileConfirmationConfigurationNode,\n\t\t\t]),\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
