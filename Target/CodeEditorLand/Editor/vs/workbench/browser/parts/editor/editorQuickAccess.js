var T=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var g=(m,i,r,t)=>{for(var e=t>1?void 0:t?x(i,r):i,o=m.length-1,a;o>=0;o--)(a=m[o])&&(e=(t?a(i,r,e):a(e))||e);return t&&e&&T(i,r,e),e},s=(m,i)=>(r,t)=>i(r,t,m);import"./media/editorquickaccess.css";import{Codicon as P}from"../../../../base/common/codicons.js";import{compareItemsByFuzzyScore as z,prepareQuery as F,scoreItemFuzzy as O}from"../../../../base/common/fuzzyScorer.js";import{ThemeIcon as b}from"../../../../base/common/themables.js";import{ILanguageService as E}from"../../../../editor/common/languages/language.js";import{getIconClasses as R}from"../../../../editor/common/services/getIconClasses.js";import{IModelService as v}from"../../../../editor/common/services/model.js";import{localize as f}from"../../../../nls.js";import{PickerQuickAccessProvider as D,TriggerAction as C}from"../../../../platform/quickinput/browser/pickerQuickAccess.js";import{quickPickItemScorerAccessor as y}from"../../../../platform/quickinput/common/quickInput.js";import{EditorResourceAccessor as M,EditorsOrder as k,SideBySideEditor as X}from"../../../common/editor.js";import{GroupsOrder as L,IEditorGroupsService as h}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as G}from"../../../services/editor/common/editorService.js";let u=class extends D{constructor(r,t,e,o,a){super(r,{canAcceptInBackground:!0,noResultsPick:{label:f("noViewResults","No matching editors"),groupId:-1}});this.editorGroupService=t;this.editorService=e;this.modelService=o;this.languageService=a}pickState=new class{scorerCache=Object.create(null);isQuickNavigating=void 0;reset(r){r||(this.scorerCache=Object.create(null)),this.isQuickNavigating=r}};provide(r,t){return this.pickState.reset(!!r.quickNavigate),super.provide(r,t)}_getPicks(r){const t=F(r),e=this.doGetEditorPickItems().filter(a=>{if(!t.normalized)return!0;const c=O(a,t,!0,y,this.pickState.scorerCache);return c.score?(a.highlights={label:c.labelMatch,description:c.descriptionMatch},!0):!1});if(t.normalized){const a=this.editorGroupService.getGroups(L.GRID_APPEARANCE).map(c=>c.id);e.sort((c,n)=>c.groupId!==n.groupId?a.indexOf(c.groupId)-a.indexOf(n.groupId):z(c,n,t,!0,y,this.pickState.scorerCache))}const o=[];if(this.editorGroupService.count>1){let a;for(const c of e){if(typeof a!="number"||a!==c.groupId){const n=this.editorGroupService.getGroup(c.groupId);n&&o.push({type:"separator",label:n.label}),a=c.groupId}o.push(c)}}else o.push(...e);return o}doGetEditorPickItems(){const r=this.doGetEditors(),t=new Map;for(const{groupId:e}of r)if(!t.has(e)){const o=this.editorGroupService.getGroup(e);o&&t.set(e,o.ariaLabel)}return this.doGetEditors().map(({editor:e,groupId:o})=>{const a=M.getOriginalUri(e,{supportSideBySide:X.PRIMARY}),c=e.isDirty()&&!e.isSaving(),n=e.getDescription(),l=n?`${e.getName()} ${n}`:e.getName();return{groupId:o,resource:a,label:e.getName(),ariaLabel:t.size>1?c?f("entryAriaLabelWithGroupDirty","{0}, unsaved changes, {1}",l,t.get(o)):f("entryAriaLabelWithGroup","{0}, {1}",l,t.get(o)):c?f("entryAriaLabelDirty","{0}, unsaved changes",l):l,description:n,iconClasses:R(this.modelService,this.languageService,a,void 0,e.getIcon()).concat(e.getLabelExtraClasses()),italic:!this.editorGroupService.getGroup(o)?.isPinned(e),buttons:[{iconClass:c?"dirty-editor "+b.asClassName(P.closeDirty):b.asClassName(P.close),tooltip:f("closeEditor","Close Editor"),alwaysVisible:c}],trigger:async()=>{const S=this.editorGroupService.getGroup(o);return S&&(await S.closeEditor(e,{preserveFocus:!0}),!S.contains(e))?C.REMOVE_ITEM:C.NO_ACTION},accept:(S,N)=>this.editorGroupService.getGroup(o)?.openEditor(e,{preserveFocus:N.inBackground})}})}};u=g([s(1,h),s(2,G),s(3,v),s(4,E)],u);let p=class extends u{static PREFIX="edt active ";constructor(i,r,t,e){super(p.PREFIX,i,r,t,e)}doGetEditors(){const i=this.editorGroupService.activeGroup;return i.getEditors(k.MOST_RECENTLY_ACTIVE).map(r=>({editor:r,groupId:i.id}))}};p=g([s(0,h),s(1,G),s(2,v),s(3,E)],p);let d=class extends u{static PREFIX="edt ";constructor(i,r,t,e){super(d.PREFIX,i,r,t,e)}doGetEditors(){const i=[];for(const r of this.editorGroupService.getGroups(L.GRID_APPEARANCE))for(const t of r.getEditors(k.SEQUENTIAL))i.push({editor:t,groupId:r.id});return i}};d=g([s(0,h),s(1,G),s(2,v),s(3,E)],d);let I=class extends u{static PREFIX="edt mru ";constructor(i,r,t,e){super(I.PREFIX,i,r,t,e)}doGetEditors(){const i=[];for(const r of this.editorService.getEditors(k.MOST_RECENTLY_ACTIVE))i.push(r);return i}};I=g([s(0,h),s(1,G),s(2,v),s(3,E)],I);export{p as ActiveGroupEditorsByMostRecentlyUsedQuickAccess,d as AllEditorsByAppearanceQuickAccess,I as AllEditorsByMostRecentlyUsedQuickAccess,u as BaseEditorQuickAccessProvider};
