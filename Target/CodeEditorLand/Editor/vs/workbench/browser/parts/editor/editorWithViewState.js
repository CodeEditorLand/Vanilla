var l=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var p=(s,o,e,t)=>{for(var i=t>1?void 0:t?v(o,e):o,d=s.length-1,a;d>=0;d--)(a=s[d])&&(i=(t?a(o,e,i):a(i))||i);return t&&i&&l(o,e,i),i},r=(s,o)=>(e,t)=>o(e,t,s);import{Event as f}from"../../../../../vs/base/common/event.js";import{MutableDisposable as h}from"../../../../../vs/base/common/lifecycle.js";import"../../../../../vs/base/common/resources.js";import"../../../../../vs/base/common/uri.js";import{ITextResourceConfigurationService as I}from"../../../../../vs/editor/common/services/textResourceConfiguration.js";import{IInstantiationService as w}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IStorageService as m}from"../../../../../vs/platform/storage/common/storage.js";import{ITelemetryService as V}from"../../../../../vs/platform/telemetry/common/telemetry.js";import{IThemeService as b}from"../../../../../vs/platform/theme/common/themeService.js";import{EditorPane as g}from"../../../../../vs/workbench/browser/parts/editor/editorPane.js";import{EditorResourceAccessor as R,SideBySideEditor as D}from"../../../../../vs/workbench/common/editor.js";import"../../../../../vs/workbench/common/editor/editorInput.js";import{IEditorGroupsService as T}from"../../../../../vs/workbench/services/editor/common/editorGroupsService.js";import{IEditorService as x}from"../../../../../vs/workbench/services/editor/common/editorService.js";let n=class extends g{constructor(e,t,i,d,a,u,c,S,C,E){super(e,t,d,S,u);this.instantiationService=a;this.textResourceConfigurationService=c;this.editorService=C;this.editorGroupService=E;this.viewState=this.getEditorMemento(E,c,i,100)}viewState;groupListener=this._register(new h);editorViewStateDisposables;setEditorVisible(e){this.groupListener.value=this.group.onWillCloseEditor(t=>this.onWillCloseEditor(t)),super.setEditorVisible(e)}onWillCloseEditor(e){const t=e.editor;t===this.input&&this.updateEditorViewState(t)}clearInput(){this.updateEditorViewState(this.input),super.clearInput()}saveState(){this.updateEditorViewState(this.input),super.saveState()}updateEditorViewState(e){if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);t&&(this.tracksDisposedEditorViewState()||(this.editorViewStateDisposables||(this.editorViewStateDisposables=new Map),this.editorViewStateDisposables.has(e)||this.editorViewStateDisposables.set(e,f.once(e.onWillDispose)(()=>{this.clearEditorViewState(t,this.group),this.editorViewStateDisposables?.delete(e)}))),e.isDisposed()&&!this.tracksDisposedEditorViewState()||!this.shouldRestoreEditorViewState(e)&&!this.group.contains(e)?this.clearEditorViewState(t,this.group):e.isDisposed()||this.saveEditorViewState(t))}shouldRestoreEditorViewState(e,t){return t?.newInGroup?this.textResourceConfigurationService.getValue(R.getOriginalUri(e,{supportSideBySide:D.PRIMARY}),"workbench.editor.restoreViewState")!==!1:!0}getViewState(){const e=this.input;if(!e||!this.tracksEditorViewState(e))return;const t=this.toEditorViewStateResource(e);if(t)return this.computeEditorViewState(t)}saveEditorViewState(e){const t=this.computeEditorViewState(e);t&&this.viewState.saveEditorState(this.group,e,t)}loadEditorViewState(e,t){if(!e||!this.tracksEditorViewState(e)||!this.shouldRestoreEditorViewState(e,t))return;const i=this.toEditorViewStateResource(e);if(i)return this.viewState.loadEditorState(this.group,i)}moveEditorViewState(e,t,i){return this.viewState.moveEditorState(e,t,i)}clearEditorViewState(e,t){this.viewState.clearEditorState(e,t)}dispose(){if(super.dispose(),this.editorViewStateDisposables){for(const[,e]of this.editorViewStateDisposables)e.dispose();this.editorViewStateDisposables=void 0}}tracksDisposedEditorViewState(){return!1}};n=p([r(3,V),r(4,w),r(5,m),r(6,I),r(7,b),r(8,x),r(9,T)],n);export{n as AbstractEditorWithViewState};
