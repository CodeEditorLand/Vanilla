var U=Object.defineProperty;var _=Object.getOwnPropertyDescriptor;var b=(I,l,t,i)=>{for(var r=i>1?void 0:i?_(l,t):l,s=I.length-1,e;s>=0;s--)(e=I[s])&&(r=(i?e(l,t,r):e(r))||r);return i&&r&&U(l,t,r),r},n=(I,l)=>(t,i)=>l(t,i,I);import{onDidChangeFullscreen as D}from"../../../../base/browser/browser.js";import{hide as C,show as P}from"../../../../base/browser/dom.js";import{Emitter as k,Event as w}from"../../../../base/common/event.js";import{DisposableStore as H}from"../../../../base/common/lifecycle.js";import{isNative as M}from"../../../../base/common/platform.js";import{IConfigurationService as V}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as N}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as E}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as Y}from"../../../../platform/instantiation/common/serviceCollection.js";import{IStorageService as F}from"../../../../platform/storage/common/storage.js";import{IThemeService as K}from"../../../../platform/theme/common/themeService.js";import{hasCustomTitlebar as $}from"../../../../platform/window/common/window.js";import"./editor.js";import{EditorPart as j}from"./editorPart.js";import"../titlebar/titlebarPart.js";import{WindowTitle as q}from"../titlebar/windowTitle.js";import{IAuxiliaryWindowService as z}from"../../../services/auxiliaryWindow/browser/auxiliaryWindowService.js";import{GroupDirection as G,GroupsOrder as A}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as W}from"../../../services/editor/common/editorService.js";import{IHostService as J}from"../../../services/host/browser/host.js";import{IWorkbenchLayoutService as x,shouldShowCustomTitleBar as L}from"../../../services/layout/browser/layoutService.js";import{ILifecycleService as Q}from"../../../services/lifecycle/common/lifecycle.js";import{IStatusbarService as O}from"../../../services/statusbar/browser/statusbar.js";import{ITitleService as X}from"../../../services/title/browser/titleService.js";let S=class{constructor(l,t,i,r,s,e,a,v,d){this.editorPartsView=l;this.instantiationService=t;this.auxiliaryWindowService=i;this.lifecycleService=r;this.configurationService=s;this.statusbarService=e;this.titleService=a;this.editorService=v;this.layoutService=d}static STATUS_BAR_VISIBILITY="workbench.statusBar.visible";async create(l,t){function i(){let o=0;return y&&(o+=p.height),c&&f&&(o+=c.height),o}function r(o){y?P(p.container):C(p.container),o&&a.layout()}function s(o){c&&(f?P(c.container):C(c.container),o&&a.layout())}const e=new H,a=e.add(await this.auxiliaryWindowService.open(t)),v=document.createElement("div");v.classList.add("part","editor"),v.setAttribute("role","main"),v.style.position="relative",a.container.appendChild(v);const d=e.add(this.instantiationService.createInstance(h,a.window.vscodeWindowId,this.editorPartsView,t?.state,l));e.add(this.editorPartsView.registerPart(d)),d.create(v);let c,f=!1;if(M&&$(this.configurationService)){c=e.add(this.titleService.createAuxiliaryTitlebarPart(a.container,d)),f=L(this.configurationService,a.window,void 0,!1);const o=()=>{const u=f;f=L(this.configurationService,a.window,void 0,!1),u!==f&&s(!0)};e.add(c.onDidChange(()=>a.layout())),e.add(this.layoutService.onDidChangePartVisibility(()=>o())),e.add(D(u=>{u===a.window.vscodeWindowId&&o()})),s(!1)}else e.add(this.instantiationService.createInstance(q,a.window,d));const p=e.add(this.statusbarService.createAuxiliaryStatusbarPart(a.container));let y=this.configurationService.getValue(S.STATUS_BAR_VISIBILITY)!==!1;e.add(this.configurationService.onDidChangeConfiguration(o=>{o.affectsConfiguration(S.STATUS_BAR_VISIBILITY)&&(y=this.configurationService.getValue(S.STATUS_BAR_VISIBILITY)!==!1,r(!0))})),r(!1);const R=e.add(w.once(d.onWillClose)(()=>a.window.close()));e.add(w.once(a.onUnload)(()=>{e.isDisposed||(R.dispose(),d.close(),e.dispose())})),e.add(w.once(this.lifecycleService.onDidShutdown)(()=>e.dispose())),e.add(a.onBeforeUnload(o=>{for(const u of d.groups)for(const m of u.editors){const T=m.canMove(u.id,this.editorPartsView.mainPart.activeGroup.id);if(typeof T=="string"){u.openEditor(m),o.veto(T);break}}})),e.add(a.onWillLayout(o=>{const u=c?.height??0;c?.layout(o.width,u,0,0);const m=o.height-i();d.layout(o.width,m,u,0),p.layout(o.width,p.height,o.height-p.height,0)})),a.layout();const B=e.add(this.instantiationService.createChild(new Y([O,this.statusbarService.createScoped(p,e)],[W,this.editorService.createScoped(d,e)])));return{part:d,instantiationService:B,disposables:e}}};S=b([n(1,E),n(2,z),n(3,Q),n(4,V),n(5,O),n(6,X),n(7,W),n(8,x)],S);let h=class extends j{constructor(t,i,r,s,e,a,v,d,c,f,g){const p=h.COUNTER++;super(i,`workbench.parts.auxiliaryEditor.${p}`,s,t,e,a,v,d,c,f,g);this.state=r}static COUNTER=1;_onWillClose=this._register(new k);onWillClose=this._onWillClose.event;removeGroup(t,i){const r=this.assertGroupView(t);this.count===1&&this.activeGroup===r?this.doRemoveLastGroup(i):super.removeGroup(t,i)}doRemoveLastGroup(t){const i=!t&&this.shouldRestoreFocus(this.container),s=this.editorPartsView.getGroups(A.MOST_RECENTLY_ACTIVE)[1];s&&(s.groupsView.activateGroup(s),i&&s.focus()),this.doClose(!1)}loadState(){return this.state}saveState(){}close(){return this.doClose(!0)}doClose(t){let i=!0;return t&&(i=this.mergeGroupsToMainPart()),this._onWillClose.fire(),i}mergeGroupsToMainPart(){if(!this.groups.some(r=>r.count>0))return!0;let t;for(const r of this.editorPartsView.mainPart.getGroups(A.MOST_RECENTLY_ACTIVE))if(!r.isLocked){t=r;break}t||(t=this.editorPartsView.mainPart.addGroup(this.editorPartsView.mainPart.activeGroup,this.partOptions.openSideBySideDirection==="right"?G.RIGHT:G.DOWN));const i=this.mergeAllGroups(t);return t.focus(),i}};h=b([n(4,E),n(5,K),n(6,V),n(7,F),n(8,x),n(9,J),n(10,N)],h);export{S as AuxiliaryEditorPart};
