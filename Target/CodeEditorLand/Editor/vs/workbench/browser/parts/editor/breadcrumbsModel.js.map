{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/browser/parts/editor/breadcrumbsModel.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationTokenSource } from '../../../../base/common/cancellation.js';\nimport { onUnexpectedError } from '../../../../base/common/errors.js';\nimport { Emitter, Event } from '../../../../base/common/event.js';\nimport { DisposableStore, MutableDisposable, toDisposable } from '../../../../base/common/lifecycle.js';\nimport { Schemas, matchesSomeScheme } from '../../../../base/common/network.js';\nimport { dirname, isEqual } from '../../../../base/common/resources.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../../platform/configuration/common/configuration.js';\nimport { FileKind } from '../../../../platform/files/common/files.js';\nimport { IWorkspaceContextService, IWorkspaceFolder, WorkbenchState } from '../../../../platform/workspace/common/workspace.js';\nimport { BreadcrumbsConfig } from './breadcrumbs.js';\nimport { IEditorPane } from '../../../common/editor.js';\nimport { IOutline, IOutlineService, OutlineTarget } from '../../../services/outline/browser/outline.js';\n\nexport class FileElement {\n\tconstructor(\n\t\treadonly uri: URI,\n\t\treadonly kind: FileKind\n\t) { }\n}\n\ntype FileInfo = { path: FileElement[]; folder?: IWorkspaceFolder };\n\nexport class OutlineElement2 {\n\tconstructor(\n\t\treadonly element: IOutline<any> | any,\n\t\treadonly outline: IOutline<any>\n\t) { }\n}\n\nexport class BreadcrumbsModel {\n\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _fileInfo: FileInfo;\n\n\tprivate readonly _cfgFilePath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\tprivate readonly _cfgSymbolPath: BreadcrumbsConfig<'on' | 'off' | 'last'>;\n\n\tprivate readonly _currentOutline = new MutableDisposable<IOutline<any>>();\n\tprivate readonly _outlineDisposables = new DisposableStore();\n\n\tprivate readonly _onDidUpdate = new Emitter<this>();\n\treadonly onDidUpdate: Event<this> = this._onDidUpdate.event;\n\n\tconstructor(\n\t\treadonly resource: URI,\n\t\teditor: IEditorPane | undefined,\n\t\t@IConfigurationService configurationService: IConfigurationService,\n\t\t@IWorkspaceContextService private readonly _workspaceService: IWorkspaceContextService,\n\t\t@IOutlineService private readonly _outlineService: IOutlineService,\n\t) {\n\t\tthis._cfgFilePath = BreadcrumbsConfig.FilePath.bindTo(configurationService);\n\t\tthis._cfgSymbolPath = BreadcrumbsConfig.SymbolPath.bindTo(configurationService);\n\n\t\tthis._disposables.add(this._cfgFilePath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._disposables.add(this._cfgSymbolPath.onDidChange(_ => this._onDidUpdate.fire(this)));\n\t\tthis._workspaceService.onDidChangeWorkspaceFolders(this._onDidChangeWorkspaceFolders, this, this._disposables);\n\t\tthis._fileInfo = this._initFilePathInfo(resource);\n\n\t\tif (editor) {\n\t\t\tthis._bindToEditor(editor);\n\t\t\tthis._disposables.add(_outlineService.onDidChange(() => this._bindToEditor(editor)));\n\t\t\tthis._disposables.add(editor.onDidChangeControl(() => this._bindToEditor(editor)));\n\t\t}\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._cfgFilePath.dispose();\n\t\tthis._cfgSymbolPath.dispose();\n\t\tthis._currentOutline.dispose();\n\t\tthis._outlineDisposables.dispose();\n\t\tthis._onDidUpdate.dispose();\n\t}\n\n\tisRelative(): boolean {\n\t\treturn Boolean(this._fileInfo.folder);\n\t}\n\n\tgetElements(): ReadonlyArray<FileElement | OutlineElement2> {\n\t\tlet result: (FileElement | OutlineElement2)[] = [];\n\n\t\t// file path elements\n\t\tif (this._cfgFilePath.getValue() === 'on') {\n\t\t\tresult = result.concat(this._fileInfo.path);\n\t\t} else if (this._cfgFilePath.getValue() === 'last' && this._fileInfo.path.length > 0) {\n\t\t\tresult = result.concat(this._fileInfo.path.slice(-1));\n\t\t}\n\n\t\tif (this._cfgSymbolPath.getValue() === 'off') {\n\t\t\treturn result;\n\t\t}\n\n\t\tif (!this._currentOutline.value) {\n\t\t\treturn result;\n\t\t}\n\n\t\tconst breadcrumbsElements = this._currentOutline.value.config.breadcrumbsDataSource.getBreadcrumbElements();\n\t\tfor (let i = this._cfgSymbolPath.getValue() === 'last' && breadcrumbsElements.length > 0 ? breadcrumbsElements.length - 1 : 0; i < breadcrumbsElements.length; i++) {\n\t\t\tresult.push(new OutlineElement2(breadcrumbsElements[i], this._currentOutline.value));\n\t\t}\n\n\t\tif (breadcrumbsElements.length === 0 && !this._currentOutline.value.isEmpty) {\n\t\t\tresult.push(new OutlineElement2(this._currentOutline.value, this._currentOutline.value));\n\t\t}\n\n\t\treturn result;\n\t}\n\n\tprivate _initFilePathInfo(uri: URI): FileInfo {\n\n\t\tif (matchesSomeScheme(uri, Schemas.untitled, Schemas.data)) {\n\t\t\treturn {\n\t\t\t\tfolder: undefined,\n\t\t\t\tpath: []\n\t\t\t};\n\t\t}\n\n\t\tconst info: FileInfo = {\n\t\t\tfolder: this._workspaceService.getWorkspaceFolder(uri) ?? undefined,\n\t\t\tpath: []\n\t\t};\n\n\t\tlet uriPrefix: URI | null = uri;\n\t\twhile (uriPrefix && uriPrefix.path !== '/') {\n\t\t\tif (info.folder && isEqual(info.folder.uri, uriPrefix)) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tinfo.path.unshift(new FileElement(uriPrefix, info.path.length === 0 ? FileKind.FILE : FileKind.FOLDER));\n\t\t\tconst prevPathLength = uriPrefix.path.length;\n\t\t\turiPrefix = dirname(uriPrefix);\n\t\t\tif (uriPrefix.path.length === prevPathLength) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\n\t\tif (info.folder && this._workspaceService.getWorkbenchState() === WorkbenchState.WORKSPACE) {\n\t\t\tinfo.path.unshift(new FileElement(info.folder.uri, FileKind.ROOT_FOLDER));\n\t\t}\n\t\treturn info;\n\t}\n\n\tprivate _onDidChangeWorkspaceFolders() {\n\t\tthis._fileInfo = this._initFilePathInfo(this.resource);\n\t\tthis._onDidUpdate.fire(this);\n\t}\n\n\tprivate _bindToEditor(editor: IEditorPane): void {\n\t\tconst newCts = new CancellationTokenSource();\n\t\tthis._currentOutline.clear();\n\t\tthis._outlineDisposables.clear();\n\t\tthis._outlineDisposables.add(toDisposable(() => newCts.dispose(true)));\n\n\t\tthis._outlineService.createOutline(editor, OutlineTarget.Breadcrumbs, newCts.token).then(outline => {\n\t\t\tif (newCts.token.isCancellationRequested) {\n\t\t\t\t// cancelled: dispose new outline and reset\n\t\t\t\toutline?.dispose();\n\t\t\t\toutline = undefined;\n\t\t\t}\n\t\t\tthis._currentOutline.value = outline;\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tif (outline) {\n\t\t\t\tthis._outlineDisposables.add(outline.onDidChange(() => this._onDidUpdate.fire(this)));\n\t\t\t}\n\n\t\t}).catch(err => {\n\t\t\tthis._onDidUpdate.fire(this);\n\t\t\tonUnexpectedError(err);\n\t\t});\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
