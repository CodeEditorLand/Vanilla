var w=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var m=(l,o,t,r)=>{for(var e=r>1?void 0:r?O(o,t):o,n=l.length-1,a;n>=0;n--)(a=l[n])&&(e=(r?a(o,t,e):a(e))||e);return r&&e&&w(o,t,e),e},i=(l,o)=>(t,r)=>o(t,r,l);import{assertIsDefined as b}from"../../../../base/common/types.js";import{EditorOption as G}from"../../../../editor/common/config/editorOptions.js";import{ScrollType as f}from"../../../../editor/common/editorCommon.js";import{ILanguageService as N}from"../../../../editor/common/languages/language.js";import{PLAINTEXT_LANGUAGE_ID as v}from"../../../../editor/common/languages/modesRegistry.js";import{ModelConstants as D}from"../../../../editor/common/model.js";import{IModelService as P}from"../../../../editor/common/services/model.js";import{ITextResourceConfigurationService as S}from"../../../../editor/common/services/textResourceConfiguration.js";import{IFileService as E}from"../../../../platform/files/common/files.js";import{IInstantiationService as C}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService as L}from"../../../../platform/storage/common/storage.js";import{ITelemetryService as h}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as y}from"../../../../platform/theme/common/themeService.js";import{isTextEditorViewState as F}from"../../../common/editor.js";import{applyTextEditorOptions as V}from"../../../common/editor/editorOptions.js";import{BaseTextEditorModel as _}from"../../../common/editor/textEditorModel.js";import{TextResourceEditorInput as j}from"../../../common/editor/textResourceEditorInput.js";import{IEditorGroupsService as T}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as x}from"../../../services/editor/common/editorService.js";import{UntitledTextEditorInput as I}from"../../../services/untitled/common/untitledTextEditorInput.js";import{AbstractTextCodeEditor as B}from"./textCodeEditor.js";let u=class extends B{constructor(o,t,r,e,n,a,s,d,p,g){super(o,t,r,e,n,a,s,p,d,g)}async setInput(o,t,r,e){await super.setInput(o,t,r,e);const n=await o.resolve();if(e.isCancellationRequested)return;if(!(n instanceof _))throw new Error("Unable to open file as text");const a=b(this.editorControl),s=n.textEditorModel;if(a.setModel(s),!F(t?.viewState)){const d=this.loadEditorViewState(o,r);d&&(t?.selection&&(d.cursorState=[]),a.restoreViewState(d))}t&&V(t,a,f.Immediate),a.updateOptions(this.getReadonlyConfiguration(n.isReadonly()))}revealLastLine(){const o=this.editorControl;if(!o)return;const t=o.getModel();if(t){const r=t.getLineCount();o.revealPosition({lineNumber:r,column:t.getLineMaxColumn(r)},f.Smooth)}}clearInput(){super.clearInput(),this.editorControl?.setModel(null)}tracksEditorViewState(o){return o instanceof I||o instanceof j}};u=m([i(2,h),i(3,C),i(4,L),i(5,S),i(6,y),i(7,T),i(8,x),i(9,E)],u);let c=class extends u{constructor(t,r,e,n,a,s,d,p,g,R,M){super(c.ID,t,r,e,n,a,s,p,d,M);this.modelService=g;this.languageService=R}static ID="workbench.editors.textResourceEditor";createEditorControl(t,r){super.createEditorControl(t,r);const e=this.editorControl;e&&this._register(e.onDidPaste(n=>this.onDidEditorPaste(n,e)))}onDidEditorPaste(t,r){if(this.input instanceof I&&this.input.hasLanguageSetExplicitly||t.range.startLineNumber!==1||t.range.startColumn!==1||r.getOption(G.readOnly))return;const e=r.getModel();if(!e||!(e.getLineCount()===t.range.endLineNumber&&e.getLineMaxColumn(t.range.endLineNumber)===t.range.endColumn)||e.getLanguageId()!==v)return;let s;if(t.languageId)s={id:t.languageId,source:"event"};else{const d=this.languageService.guessLanguageIdByFilepathOrFirstLine(e.uri,e.getLineContent(1).substr(0,D.FIRST_LINE_DETECTION_LENGTH_LIMIT))??void 0;d&&(s={id:d,source:"guess"})}if(s&&s.id!==v){this.input instanceof I&&s.source==="event"?this.input.setLanguageId(s.id):e.setLanguage(this.languageService.createById(s.id));const d=this.modelService.getCreationOptions(e.getLanguageId(),e.uri,e.isForSimpleWidget);e.detectIndentation(d.insertSpaces,d.tabSize)}}};c=m([i(1,h),i(2,C),i(3,L),i(4,S),i(5,y),i(6,x),i(7,T),i(8,P),i(9,N),i(10,E)],c);export{u as AbstractTextResourceEditor,c as TextResourceEditor};
