var Q=Object.defineProperty;var X=Object.getOwnPropertyDescriptor;var S=(i,n,e,t)=>{for(var o=t>1?void 0:t?X(n,e):n,r=i.length-1,s;r>=0;r--)(s=i[r])&&(o=(t?s(n,e,o):s(o))||o);return t&&o&&Q(n,e,o),o},a=(i,n)=>(e,t)=>n(e,t,i);import"./media/activitybarpart.css";import"./media/activityaction.css";import{localize as u,localize2 as h}from"../../../../nls.js";import{ActionsOrientation as V}from"../../../../base/browser/ui/actionbar/actionbar.js";import{Part as Z}from"../../part.js";import{ActivityBarPosition as m,IWorkbenchLayoutService as _,LayoutSettings as l,Parts as g,Position as ee}from"../../../services/layout/browser/layoutService.js";import{IInstantiationService as N}from"../../../../platform/instantiation/common/instantiation.js";import{DisposableStore as te,MutableDisposable as oe}from"../../../../base/common/lifecycle.js";import{ToggleSidebarPositionAction as k}from"../../actions/layoutActions.js";import{IThemeService as ie,registerThemingParticipant as ne}from"../../../../platform/theme/common/themeService.js";import{ACTIVITY_BAR_BACKGROUND as re,ACTIVITY_BAR_BORDER as ae,ACTIVITY_BAR_FOREGROUND as ce,ACTIVITY_BAR_ACTIVE_BORDER as x,ACTIVITY_BAR_BADGE_BACKGROUND as se,ACTIVITY_BAR_BADGE_FOREGROUND as ue,ACTIVITY_BAR_INACTIVE_FOREGROUND as me,ACTIVITY_BAR_ACTIVE_BACKGROUND as Y,ACTIVITY_BAR_DRAG_AND_DROP_BORDER as le,ACTIVITY_BAR_ACTIVE_FOCUS_BORDER as de}from"../../../common/theme.js";import{activeContrastBorder as pe,contrastBorder as ve,focusBorder as he}from"../../../../platform/theme/common/colorRegistry.js";import{addDisposableListener as R,append as Ce,EventType as O,isAncestor as Ae,$ as Be,clearNode as fe}from"../../../../base/browser/dom.js";import{assertIsDefined as H}from"../../../../base/common/types.js";import{CustomMenubarControl as be}from"../titlebar/menubarControl.js";import{IConfigurationService as I}from"../../../../platform/configuration/common/configuration.js";import{getMenuBarVisibility as E}from"../../../../platform/window/common/window.js";import{Separator as w,SubmenuAction as ge,toAction as P}from"../../../../base/common/actions.js";import{StandardKeyboardEvent as M}from"../../../../base/browser/keyboardEvent.js";import{KeyCode as v}from"../../../../base/common/keyCodes.js";import{HoverPosition as K}from"../../../../base/browser/ui/hover/hoverWidget.js";import"../../../../base/browser/touch.js";import"../paneCompositePart.js";import{PaneCompositeBar as Ie}from"../paneCompositeBar.js";import{GlobalCompositeBar as ye}from"../globalCompositeBar.js";import{IStorageService as F}from"../../../../platform/storage/common/storage.js";import{Action2 as b,IMenuService as Te,MenuId as c,MenuRegistry as L,registerAction2 as C}from"../../../../platform/actions/common/actions.js";import{ContextKeyExpr as d,IContextKeyService as we}from"../../../../platform/contextkey/common/contextkey.js";import{Categories as A}from"../../../../platform/action/common/actionCommonCategories.js";import{createAndFillInContextMenuActions as Se}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{IViewDescriptorService as Ve,ViewContainerLocation as y,ViewContainerLocationToString as q}from"../../../common/views.js";import{IPaneCompositePartService as _e}from"../../../services/panecomposite/browser/panecomposite.js";import{IExtensionService as ke}from"../../../services/extensions/common/extensions.js";import{IWorkbenchEnvironmentService as Re}from"../../../services/environment/common/environmentService.js";import{IViewsService as Oe}from"../../../services/views/common/viewsService.js";let p=class extends Z{constructor(e,t,o,r,s){super(g.ACTIVITYBAR_PART,{hasTitle:!1},r,s,o);this.paneCompositePart=e;this.instantiationService=t}static ACTION_HEIGHT=48;static pinnedViewContainersKey="workbench.activity.pinnedViewlets2";static placeholderViewContainersKey="workbench.activity.placeholderViewlets";static viewContainersWorkspaceStateKey="workbench.activity.viewletsWorkspaceState";minimumWidth=48;maximumWidth=48;minimumHeight=0;maximumHeight=Number.POSITIVE_INFINITY;compositeBar=this._register(new oe);content;createCompositeBar(){return this.instantiationService.createInstance(T,{partContainerClass:"activitybar",pinnedViewContainersKey:p.pinnedViewContainersKey,placeholderViewContainersKey:p.placeholderViewContainersKey,viewContainersWorkspaceStateKey:p.viewContainersWorkspaceStateKey,orientation:V.VERTICAL,icon:!0,iconSize:24,activityHoverOptions:{position:()=>this.layoutService.getSideBarPosition()===ee.LEFT?K.RIGHT:K.LEFT},preventLoopNavigation:!0,recomputeSizes:!1,fillExtraContextMenuActions:(e,t)=>{},compositeSize:52,colors:e=>({activeForegroundColor:e.getColor(ce),inactiveForegroundColor:e.getColor(me),activeBorderColor:e.getColor(x),activeBackground:e.getColor(Y),badgeBackground:e.getColor(se),badgeForeground:e.getColor(ue),dragAndDropBorder:e.getColor(le),activeBackgroundColor:void 0,inactiveBackgroundColor:void 0,activeBorderBottomColor:void 0}),overflowActionSize:p.ACTION_HEIGHT},g.ACTIVITYBAR_PART,this.paneCompositePart,!0)}createContentArea(e){return this.element=e,this.content=Ce(this.element,Be(".content")),this.layoutService.isVisible(g.ACTIVITYBAR_PART)&&this.show(),this.content}getPinnedPaneCompositeIds(){return this.compositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.compositeBar.value?.getVisiblePaneCompositeIds()??[]}focus(){this.compositeBar.value?.focus()}updateStyles(){super.updateStyles();const e=H(this.getContainer()),t=this.getColor(re)||"";e.style.backgroundColor=t;const o=this.getColor(ae)||this.getColor(ve)||"";e.classList.toggle("bordered",!!o),e.style.borderColor=o||""}show(e){this.content&&(this.compositeBar.value||(this.compositeBar.value=this.createCompositeBar(),this.compositeBar.value.create(this.content),this.dimension&&this.layout(this.dimension.width,this.dimension.height)),e&&this.focus())}hide(){this.compositeBar.value&&(this.compositeBar.clear(),this.content&&fe(this.content))}layout(e,t){if(super.layout(e,t,0,0),!this.compositeBar.value)return;const o=super.layoutContents(e,t).contentSize;this.compositeBar.value.layout(e,o.height)}toJSON(){return{type:g.ACTIVITYBAR_PART}}};p=S([a(1,N),a(2,_),a(3,ie),a(4,F)],p);let T=class extends Ie{constructor(e,t,o,r,s,B,W,$,U,z,j,Ee,Pe,J){super({...e,fillExtraContextMenuActions:(f,D)=>{e.fillExtraContextMenuActions(f,D),this.fillContextMenuActions(f,D)}},t,o,s,B,W,$,U,z,j,J);this.configurationService=Ee;this.menuService=Pe;r&&(this.globalCompositeBar=this._register(s.createInstance(ye,()=>this.getContextMenuActions(),f=>this.options.colors(f),this.options.activityHoverOptions))),this._register(this.configurationService.onDidChangeConfiguration(f=>{f.affectsConfiguration("window.menuBarVisibility")&&(E(this.configurationService)==="compact"?this.installMenubar():this.uninstallMenubar())}))}element;menuBar;menuBarContainer;compositeBarContainer;globalCompositeBar;keyboardNavigationDisposables=this._register(new te);fillContextMenuActions(e,t){const o=E(this.configurationService);(o==="compact"||o==="hidden"||o==="toggle")&&e.unshift(P({id:"toggleMenuVisibility",label:u("menu","Menu"),checked:o==="compact",run:()=>this.configurationService.updateValue("window.menuBarVisibility",o==="compact"?"toggle":"compact")}),new w),o==="compact"&&this.menuBarContainer&&t?.target&&Ae(t.target,this.menuBarContainer)&&e.unshift(P({id:"hideCompactMenu",label:u("hideMenu","Hide Menu"),run:()=>this.configurationService.updateValue("window.menuBarVisibility","toggle")}),new w),this.globalCompositeBar&&(e.push(new w),e.push(...this.globalCompositeBar.getContextMenuActions())),e.push(new w),e.push(...this.getActivityBarContextMenuActions())}uninstallMenubar(){this.menuBar&&(this.menuBar.dispose(),this.menuBar=void 0),this.menuBarContainer&&(this.menuBarContainer.remove(),this.menuBarContainer=void 0)}installMenubar(){if(this.menuBar)return;this.menuBarContainer=document.createElement("div"),this.menuBarContainer.classList.add("menubar"),H(this.element).prepend(this.menuBarContainer),this.menuBar=this._register(this.instantiationService.createInstance(be)),this.menuBar.create(this.menuBarContainer)}registerKeyboardNavigationListeners(){this.keyboardNavigationDisposables.clear(),this.menuBarContainer&&this.keyboardNavigationDisposables.add(R(this.menuBarContainer,O.KEY_DOWN,e=>{const t=new M(e);(t.equals(v.DownArrow)||t.equals(v.RightArrow))&&this.focus()})),this.compositeBarContainer&&this.keyboardNavigationDisposables.add(R(this.compositeBarContainer,O.KEY_DOWN,e=>{const t=new M(e);t.equals(v.DownArrow)||t.equals(v.RightArrow)?this.globalCompositeBar?.focus():(t.equals(v.UpArrow)||t.equals(v.LeftArrow))&&this.menuBar?.toggleFocus()})),this.globalCompositeBar&&this.keyboardNavigationDisposables.add(R(this.globalCompositeBar.element,O.KEY_DOWN,e=>{const t=new M(e);(t.equals(v.UpArrow)||t.equals(v.LeftArrow))&&this.focus(this.getVisiblePaneCompositeIds().length-1)}))}create(e){return this.element=e,E(this.configurationService)==="compact"&&this.installMenubar(),this.compositeBarContainer=super.create(this.element),this.globalCompositeBar&&this.globalCompositeBar.create(this.element),this.registerKeyboardNavigationListeners(),this.compositeBarContainer}layout(e,t){this.menuBarContainer&&(this.options.orientation===V.VERTICAL?t-=this.menuBarContainer.clientHeight:e-=this.menuBarContainer.clientWidth),this.globalCompositeBar&&(this.options.orientation===V.VERTICAL?t-=this.globalCompositeBar.size()*p.ACTION_HEIGHT:e-=this.globalCompositeBar.element.clientWidth),super.layout(e,t)}getActivityBarContextMenuActions(){const e=this.menuService.getMenuActions(c.ActivityBarPositionMenu,this.contextKeyService,{shouldForwardArgs:!0,renderShortTitle:!0}),t=[];return Se(e,{primary:[],secondary:t}),[new ge("workbench.action.panel.position",u("activity bar position","Activity Bar Position"),t),P({id:k.ID,label:k.getLabel(this.layoutService),run:()=>this.instantiationService.invokeFunction(o=>new k().run(o))})]}};T=S([a(4,N),a(5,F),a(6,ke),a(7,Ve),a(8,Oe),a(9,we),a(10,Re),a(11,I),a(12,Te),a(13,_)],T),C(class extends b{constructor(){super({id:"workbench.action.activityBarLocation.default",title:{...h("positionActivityBarDefault","Move Activity Bar to Side"),mnemonicTitle:u({key:"miDefaultActivityBar",comment:["&& denotes a mnemonic"]},"&&Default")},shortTitle:u("default","Default"),category:A.View,toggled:d.equals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.DEFAULT),menu:[{id:c.ActivityBarPositionMenu,order:1},{id:c.CommandPalette,when:d.notEquals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.DEFAULT)}]})}run(i){i.get(I).updateValue(l.ACTIVITY_BAR_LOCATION,m.DEFAULT)}}),C(class extends b{constructor(){super({id:"workbench.action.activityBarLocation.top",title:{...h("positionActivityBarTop","Move Activity Bar to Top"),mnemonicTitle:u({key:"miTopActivityBar",comment:["&& denotes a mnemonic"]},"&&Top")},shortTitle:u("top","Top"),category:A.View,toggled:d.equals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.TOP),menu:[{id:c.ActivityBarPositionMenu,order:2},{id:c.CommandPalette,when:d.notEquals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.TOP)}]})}run(i){i.get(I).updateValue(l.ACTIVITY_BAR_LOCATION,m.TOP)}}),C(class extends b{constructor(){super({id:"workbench.action.activityBarLocation.bottom",title:{...h("positionActivityBarBottom","Move Activity Bar to Bottom"),mnemonicTitle:u({key:"miBottomActivityBar",comment:["&& denotes a mnemonic"]},"&&Bottom")},shortTitle:u("bottom","Bottom"),category:A.View,toggled:d.equals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.BOTTOM),menu:[{id:c.ActivityBarPositionMenu,order:3},{id:c.CommandPalette,when:d.notEquals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.BOTTOM)}]})}run(i){i.get(I).updateValue(l.ACTIVITY_BAR_LOCATION,m.BOTTOM)}}),C(class extends b{constructor(){super({id:"workbench.action.activityBarLocation.hide",title:{...h("hideActivityBar","Hide Activity Bar"),mnemonicTitle:u({key:"miHideActivityBar",comment:["&& denotes a mnemonic"]},"&&Hidden")},shortTitle:u("hide","Hidden"),category:A.View,toggled:d.equals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.HIDDEN),menu:[{id:c.ActivityBarPositionMenu,order:4},{id:c.CommandPalette,when:d.notEquals(`config.${l.ACTIVITY_BAR_LOCATION}`,m.HIDDEN)}]})}run(i){i.get(I).updateValue(l.ACTIVITY_BAR_LOCATION,m.HIDDEN)}}),L.appendMenuItem(c.MenubarAppearanceMenu,{submenu:c.ActivityBarPositionMenu,title:u("positionActivituBar","Activity Bar Position"),group:"3_workbench_layout_move",order:2}),L.appendMenuItem(c.ViewContainerTitleContext,{submenu:c.ActivityBarPositionMenu,title:u("positionActivituBar","Activity Bar Position"),when:d.equals("viewContainerLocation",q(y.Sidebar)),group:"3_workbench_layout_move",order:1}),L.appendMenuItem(c.ViewTitleContext,{submenu:c.ActivityBarPositionMenu,title:u("positionActivituBar","Activity Bar Position"),when:d.equals("viewLocation",q(y.Sidebar)),group:"3_workbench_layout_move",order:1});class G extends b{constructor(e,t){super(e);this.offset=t}async run(e){const t=e.get(_e),o=t.getVisiblePaneCompositeIds(y.Sidebar),r=t.getActivePaneComposite(y.Sidebar);if(!r)return;let s;for(let B=0;B<o.length;B++)if(o[B]===r.getId()){s=o[(B+o.length+this.offset)%o.length];break}await t.openPaneComposite(s,y.Sidebar,!0)}}C(class extends G{constructor(){super({id:"workbench.action.previousSideBarView",title:h("previousSideBarView","Previous Primary Side Bar View"),category:A.View,f1:!0},-1)}}),C(class extends G{constructor(){super({id:"workbench.action.nextSideBarView",title:h("nextSideBarView","Next Primary Side Bar View"),category:A.View,f1:!0},1)}}),C(class extends b{constructor(){super({id:"workbench.action.focusActivityBar",title:h("focusActivityBar","Focus Activity Bar"),category:A.View,f1:!0})}async run(n){n.get(_).focusPart(g.ACTIVITYBAR_PART)}}),ne((i,n)=>{const e=i.getColor(x);e&&n.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator:before {
				border-left-color: ${e};
			}
		`);const t=i.getColor(de);t&&n.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus::before {
				visibility: hidden;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:focus .active-item-indicator:before {
				visibility: visible;
				border-left-color: ${t};
			}
		`);const o=i.getColor(Y);o&&n.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .active-item-indicator {
				z-index: 0;
				background-color: ${o};
			}
		`);const r=i.getColor(pe);if(r)n.addRule(`
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item .action-label::before{
				padding: 6px;
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.active:hover .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked .action-label::before,
			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item.checked:hover .action-label::before {
				outline: 1px solid ${r};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:hover .action-label::before {
				outline: 1px dashed ${r};
			}

			.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator:before {
				border-left-color: ${r};
			}
		`);else{const s=i.getColor(he);s&&n.addRule(`
				.monaco-workbench .activitybar > .content :not(.monaco-menu) > .monaco-action-bar .action-item:focus .active-item-indicator::before {
						border-left-color: ${s};
					}
				`)}});export{T as ActivityBarCompositeBar,p as ActivitybarPart};
