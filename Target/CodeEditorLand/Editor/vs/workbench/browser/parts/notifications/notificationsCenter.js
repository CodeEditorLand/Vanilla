var V=Object.defineProperty;var M=Object.getOwnPropertyDescriptor;var I=(C,d,i,e)=>{for(var t=e>1?void 0:e?M(d,i):d,n=C.length-1,o;n>=0;n--)(o=C[n])&&(t=(e?o(d,i,t):o(t))||t);return e&&t&&V(d,i,t),t},s=(C,d)=>(i,e)=>d(i,e,C);import"./media/notificationsCenter.css";import"./media/notificationsActions.css";import{Dimension as y,isAncestorOfActiveElement as N}from"../../../../base/browser/dom.js";import{ActionBar as k}from"../../../../base/browser/ui/actionbar/actionbar.js";import{DropdownMenuActionViewItem as x}from"../../../../base/browser/ui/dropdown/dropdownActionViewItem.js";import{mainWindow as D}from"../../../../base/browser/window.js";import{Separator as E,toAction as L}from"../../../../base/common/actions.js";import{Emitter as H}from"../../../../base/common/event.js";import{assertAllDefined as v,assertIsDefined as T}from"../../../../base/common/types.js";import{localize as h}from"../../../../nls.js";import{AccessibilitySignal as K,IAccessibilitySignalService as B}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{IContextKeyService as G}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as P}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as X}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as U}from"../../../../platform/keybinding/common/keybinding.js";import{INotificationService as W,NotificationsFilter as a}from"../../../../platform/notification/common/notification.js";import{widgetShadow as $}from"../../../../platform/theme/common/colorRegistry.js";import{IThemeService as z,Themable as j}from"../../../../platform/theme/common/themeService.js";import{NotificationsCenterVisibleContext as _}from"../../../common/contextkeys.js";import{NotificationChangeType as u,NotificationViewItemContentChangeKind as O}from"../../../common/notifications.js";import{NOTIFICATIONS_CENTER_BORDER as q,NOTIFICATIONS_CENTER_HEADER_BACKGROUND as J,NOTIFICATIONS_CENTER_HEADER_FOREGROUND as Q}from"../../../common/theme.js";import{IEditorGroupsService as Y}from"../../../services/editor/common/editorGroupsService.js";import{IWorkbenchLayoutService as Z,Parts as R}from"../../../services/layout/browser/layoutService.js";import{ClearAllNotificationsAction as b,ConfigureDoNotDisturbAction as m,HideNotificationsCenterAction as g,ToggleDoNotDisturbAction as w,ToggleDoNotDisturbBySourceAction as F}from"./notificationsActions.js";import{NotificationActionRunner as ii}from"./notificationsCommands.js";import{NotificationsList as ti}from"./notificationsList.js";let c=class extends j{constructor(i,e,t,n,o,f,S,r,p,l,A){super(t);this.container=i;this.model=e;this.instantiationService=n;this.layoutService=o;this.contextKeyService=f;this.editorGroupService=S;this.keybindingService=r;this.notificationService=p;this.accessibilitySignalService=l;this.contextMenuService=A;this.notificationsCenterVisibleContextKey=_.bindTo(f),this.registerListeners()}static MAX_DIMENSIONS=new y(450,400);static MAX_NOTIFICATION_SOURCES=10;_onDidChangeVisibility=this._register(new H);onDidChangeVisibility=this._onDidChangeVisibility.event;notificationsCenterContainer;notificationsCenterHeader;notificationsCenterTitle;notificationsList;_isVisible;workbenchDimensions;notificationsCenterVisibleContextKey=_.bindTo(this.contextKeyService);clearAllAction;configureDoNotDisturbAction;registerListeners(){this._register(this.model.onDidChangeNotification(i=>this.onDidChangeNotification(i))),this._register(this.layoutService.onDidLayoutMainContainer(i=>this.layout(y.lift(i)))),this._register(this.notificationService.onDidChangeFilter(()=>this.onDidChangeFilter()))}onDidChangeFilter(){this.notificationService.getFilter()===a.ERROR&&this.hide()}get isVisible(){return!!this._isVisible}show(){if(this._isVisible){const t=T(this.notificationsList);t.show(),t.focusFirst();return}this.notificationsCenterContainer||this.create(),this.updateTitle();const[i,e]=v(this.notificationsList,this.notificationsCenterContainer);this._isVisible=!0,e.classList.add("visible"),i.show(),this.layout(this.workbenchDimensions),i.updateNotificationsList(0,0,this.model.notifications),i.focusFirst(),this.updateStyles(),this.model.notifications.forEach(t=>t.updateVisibility(!0)),this.notificationsCenterVisibleContextKey.set(!0),this._onDidChangeVisibility.fire()}updateTitle(){const[i,e]=v(this.notificationsCenterTitle,this.clearAllAction);this.model.notifications.length===0?(i.textContent=h("notificationsEmpty","No new notifications"),e.enabled=!1):(i.textContent=h("notifications","Notifications"),e.enabled=this.model.notifications.some(t=>!t.hasProgress))}create(){this.notificationsCenterContainer=document.createElement("div"),this.notificationsCenterContainer.classList.add("notifications-center"),this.notificationsCenterHeader=document.createElement("div"),this.notificationsCenterHeader.classList.add("notifications-center-header"),this.notificationsCenterContainer.appendChild(this.notificationsCenterHeader),this.notificationsCenterTitle=document.createElement("span"),this.notificationsCenterTitle.classList.add("notifications-center-header-title"),this.notificationsCenterHeader.appendChild(this.notificationsCenterTitle);const i=document.createElement("div");i.classList.add("notifications-center-header-toolbar"),this.notificationsCenterHeader.appendChild(i);const e=this._register(this.instantiationService.createInstance(ii)),t=this,n=this._register(new k(i,{ariaLabel:h("notificationsToolbar","Notification Center Actions"),actionRunner:e,actionViewItemProvider:(f,S)=>{if(f.id===m.ID)return this._register(this.instantiationService.createInstance(x,f,{getActions(){const r=[L({id:w.ID,label:t.notificationService.getFilter()===a.OFF?h("turnOnNotifications","Enable Do Not Disturb Mode"):h("turnOffNotifications","Disable Do Not Disturb Mode"),run:()=>t.notificationService.setFilter(t.notificationService.getFilter()===a.OFF?a.ERROR:a.OFF)})],p=t.notificationService.getFilters().sort((l,A)=>l.label.localeCompare(A.label));for(const l of p.slice(0,c.MAX_NOTIFICATION_SOURCES))r.length===1&&r.push(new E),r.push(L({id:`${w.ID}.${l.id}`,label:l.label,checked:l.filter!==a.ERROR,run:()=>t.notificationService.setFilter({...l,filter:l.filter===a.ERROR?a.OFF:a.ERROR})}));return p.length>c.MAX_NOTIFICATION_SOURCES&&(r.push(new E),r.push(t._register(t.instantiationService.createInstance(F,F.ID,h("moreSources","More\u2026"))))),r}},this.contextMenuService,{...S,actionRunner:e,classNames:f.class,keybindingProvider:r=>this.keybindingService.lookupKeybinding(r.id)}))}}));this.clearAllAction=this._register(this.instantiationService.createInstance(b,b.ID,b.LABEL)),n.push(this.clearAllAction,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(this.clearAllAction)}),this.configureDoNotDisturbAction=this._register(this.instantiationService.createInstance(m,m.ID,m.LABEL)),n.push(this.configureDoNotDisturbAction,{icon:!0,label:!1});const o=this._register(this.instantiationService.createInstance(g,g.ID,g.LABEL));n.push(o,{icon:!0,label:!1,keybinding:this.getKeybindingLabel(o)}),this.notificationsList=this.instantiationService.createInstance(ti,this.notificationsCenterContainer,{widgetAriaLabel:h("notificationsCenterWidgetAriaLabel","Notifications Center")}),this.container.appendChild(this.notificationsCenterContainer)}getKeybindingLabel(i){const e=this.keybindingService.lookupKeybinding(i.id);return e?e.getLabel():null}onDidChangeNotification(i){if(!this._isVisible)return;let e=!1;const[t,n]=v(this.notificationsList,this.notificationsCenterContainer);switch(i.kind){case u.ADD:t.updateNotificationsList(i.index,0,[i.item]),i.item.updateVisibility(!0);break;case u.CHANGE:switch(i.detail){case O.ACTIONS:t.updateNotificationsList(i.index,1,[i.item]);break;case O.MESSAGE:i.item.expanded&&t.updateNotificationHeight(i.item);break}break;case u.EXPAND_COLLAPSE:t.updateNotificationsList(i.index,1,[i.item]);break;case u.REMOVE:e=N(n),t.updateNotificationsList(i.index,1),i.item.updateVisibility(!1);break}this.updateTitle(),this.model.notifications.length===0&&(this.hide(),e&&this.editorGroupService.activeGroup.focus())}hide(){if(!this._isVisible||!this.notificationsCenterContainer||!this.notificationsList)return;const i=N(this.notificationsCenterContainer);this._isVisible=!1,this.notificationsCenterContainer.classList.remove("visible"),this.notificationsList.hide(),this.model.notifications.forEach(e=>e.updateVisibility(!1)),this.notificationsCenterVisibleContextKey.set(!1),this._onDidChangeVisibility.fire(),i&&this.editorGroupService.activeGroup.focus()}updateStyles(){if(this.notificationsCenterContainer&&this.notificationsCenterHeader){const i=this.getColor($);this.notificationsCenterContainer.style.boxShadow=i?`0 0 8px 2px ${i}`:"";const e=this.getColor(q);this.notificationsCenterContainer.style.border=e?`1px solid ${e}`:"";const t=this.getColor(Q);this.notificationsCenterHeader.style.color=t??"";const n=this.getColor(J);this.notificationsCenterHeader.style.background=n??""}}layout(i){if(this.workbenchDimensions=i,this._isVisible&&this.notificationsCenterContainer){const e=c.MAX_DIMENSIONS.width,t=c.MAX_DIMENSIONS.height;let n=e,o=t;this.workbenchDimensions&&(n=this.workbenchDimensions.width,n-=2*8,o=this.workbenchDimensions.height-35,this.layoutService.isVisible(R.STATUSBAR_PART,D)&&(o-=22),this.layoutService.isVisible(R.TITLEBAR_PART,D)&&(o-=22),o-=2*12),T(this.notificationsList).layout(Math.min(e,n),Math.min(t,o))}}clearAll(){this.hide();for(const i of[...this.model.notifications])i.hasProgress||i.close(),this.accessibilitySignalService.playSignal(K.clear)}};c=I([s(2,z),s(3,X),s(4,Z),s(5,G),s(6,Y),s(7,U),s(8,W),s(9,B),s(10,P)],c);export{c as NotificationsCenter};
