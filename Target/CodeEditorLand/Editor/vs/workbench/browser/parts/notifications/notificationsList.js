var y=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var v=(l,o,i,t)=>{for(var n=t>1?void 0:t?L(o,i):o,e=l.length-1,s;e>=0;e--)(s=l[e])&&(n=(t?s(o,i,n):s(n))||n);return t&&n&&y(o,i,n),n},h=(l,o)=>(i,t)=>o(i,t,l);import"./media/notificationsList.css";import{localize as c}from"../../../../nls.js";import{getWindow as S,isAncestorOfActiveElement as I,trackFocus as C}from"../../../../base/browser/dom.js";import{WorkbenchList as A}from"../../../../platform/list/browser/listService.js";import{IInstantiationService as N}from"../../../../platform/instantiation/common/instantiation.js";import"../../../../base/browser/ui/list/listWidget.js";import{NOTIFICATIONS_BACKGROUND as x}from"../../../common/theme.js";import"../../../common/notifications.js";import{NotificationsListDelegate as M,NotificationRenderer as V}from"./notificationsViewer.js";import{CopyNotificationMessageAction as b}from"./notificationsActions.js";import{IContextMenuService as F}from"../../../../platform/contextview/browser/contextView.js";import{assertAllDefined as w}from"../../../../base/common/types.js";import{NotificationFocusedContext as D}from"../../../common/contextkeys.js";import{Disposable as _}from"../../../../base/common/lifecycle.js";import"../../../../base/browser/ui/aria/aria.js";import{NotificationActionRunner as H}from"./notificationsCommands.js";import{IKeybindingService as O}from"../../../../platform/keybinding/common/keybinding.js";import{IConfigurationService as k}from"../../../../platform/configuration/common/configuration.js";let u=class extends _{constructor(i,t,n,e){super();this.container=i;this.options=t;this.instantiationService=n;this.contextMenuService=e}listContainer;list;listDelegate;viewModel=[];isVisible;show(){this.isVisible||(this.list||this.createNotificationsList(),this.isVisible=!0)}createNotificationsList(){this.listContainer=document.createElement("div"),this.listContainer.classList.add("notifications-list-container");const i=this._register(this.instantiationService.createInstance(H)),t=this.instantiationService.createInstance(V,i),n=this.listDelegate=new M(this.listContainer),e=this.options,s=this.list=this._register(this.instantiationService.createInstance(A,"NotificationsList",this.listContainer,n,[t],{...e,setRowLineHeight:!1,horizontalScrolling:!1,overrideStyles:{listBackground:x},accessibilityProvider:this.instantiationService.createInstance(d,e)})),p=this._register(this.instantiationService.createInstance(b,b.ID,b.LABEL));this._register(s.onContextMenu(r=>{r.element&&this.contextMenuService.showContextMenu({getAnchor:()=>r.anchor,getActions:()=>[p],getActionsContext:()=>r.element,actionRunner:i})})),this._register(s.onMouseDblClick(r=>r.element.toggle()));const a=this._register(C(s.getHTMLElement()));this._register(a.onDidBlur(()=>{S(this.listContainer).document.hasFocus()&&s.setFocus([])})),D.bindTo(s.contextKeyService),this._register(s.onDidChangeSelection(r=>{r.indexes.length>0&&s.setSelection([])})),this.container.appendChild(this.listContainer)}updateNotificationsList(i,t,n=[]){const[e,s]=w(this.list,this.listContainer),p=I(s),a=e.getFocus()[0],r=this.viewModel[a];let m=null;if(typeof a=="number"&&(m=e.getRelativeTop(a)),this.viewModel.splice(i,t,...n),e.splice(i,t,n),e.layout(),this.viewModel.length===0)this.hide();else if(typeof a=="number"){let g=0;if(r){let f=this.viewModel.indexOf(r);f===-1&&(f=a-1),f<this.viewModel.length&&f>=0&&(g=f)}typeof m=="number"&&e.reveal(g,m),e.setFocus([g])}this.isVisible&&p&&e.domFocus()}updateNotificationHeight(i){const t=this.viewModel.indexOf(i);if(t===-1)return;const[n,e]=w(this.list,this.listDelegate);n.updateElementHeight(t,e.getHeight(i)),n.layout()}hide(){!this.isVisible||!this.list||(this.isVisible=!1,this.list.splice(0,this.viewModel.length),this.viewModel=[])}focusFirst(){this.list&&(this.list.focusFirst(),this.list.domFocus())}hasFocus(){return this.listContainer?I(this.listContainer):!1}layout(i,t){this.listContainer&&this.list&&(this.listContainer.style.width=`${i}px`,typeof t=="number"&&(this.list.getHTMLElement().style.maxHeight=`${t}px`),this.list.layout())}dispose(){this.hide(),super.dispose()}};u=v([h(2,N),h(3,F)],u);let d=class{constructor(o,i,t){this._options=o;this._keybindingService=i;this._configurationService=t}getAriaLabel(o){let i;const t=this._keybindingService.lookupKeybinding("editor.action.accessibleView")?.getAriaLabel();return this._configurationService.getValue("accessibility.verbosity.notification")&&(i=t?c("notificationAccessibleViewHint","Inspect the response in the accessible view with {0}",t):c("notificationAccessibleViewHintNoKb","Inspect the response in the accessible view via the command Open Accessible View which is currently not triggerable via keybinding")),o.source?i?c("notificationWithSourceAriaLabelHint","{0}, source: {1}, notification, {2}",o.message.raw,o.source,i):c("notificationWithSourceAriaLabel","{0}, source: {1}, notification",o.message.raw,o.source):i?c("notificationAriaLabelHint","{0}, notification, {1}",o.message.raw,i):c("notificationAriaLabel","{0}, notification",o.message.raw)}getWidgetAriaLabel(){return this._options.widgetAriaLabel??c("notificationsList","Notifications List")}getRole(){return"dialog"}};d=v([h(1,O),h(2,k)],d);export{u as NotificationsList};
