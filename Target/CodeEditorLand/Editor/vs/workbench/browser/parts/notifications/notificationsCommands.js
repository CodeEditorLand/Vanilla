var B=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var R=(c,n,r,t)=>{for(var i=t>1?void 0:t?H(n,r):n,o=c.length-1,e;o>=0;o--)(e=c[o])&&(i=(t?e(n,r,i):e(i))||i);return t&&i&&B(n,r,i),i},F=(c,n)=>(r,t)=>n(r,t,c);import{ActionRunner as Q}from"../../../../base/common/actions.js";import{hash as z}from"../../../../base/common/hash.js";import{KeyChord as X,KeyCode as a,KeyMod as C}from"../../../../base/common/keyCodes.js";import{DisposableStore as Y}from"../../../../base/common/lifecycle.js";import{localize as $,localize2 as g}from"../../../../nls.js";import{AccessibilitySignal as q,IAccessibilitySignalService as j}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{MenuId as u,MenuRegistry as I}from"../../../../platform/actions/common/actions.js";import{CommandsRegistry as y}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr as N}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as J}from"../../../../platform/instantiation/common/instantiation.js";import{KeybindingWeight as d,KeybindingsRegistry as l}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{IListService as T,WorkbenchList as Z}from"../../../../platform/list/browser/listService.js";import{INotificationService as E,NotificationPriority as v,NotificationsFilter as b}from"../../../../platform/notification/common/notification.js";import{IQuickInputService as ii}from"../../../../platform/quickinput/common/quickInput.js";import{ITelemetryService as _}from"../../../../platform/telemetry/common/telemetry.js";import{NotificationFocusedContext as f,NotificationsCenterVisibleContext as k,NotificationsToastsVisibleContext as h}from"../../../common/contextkeys.js";import{isNotificationViewItem as w}from"../../../common/notifications.js";import{notificationToMetrics as D}from"./notificationsTelemetry.js";const L="notifications.showList",x="notifications.hideList",ti="notifications.toggleList",M="notifications.hideToasts",P="notifications.focusToasts",ei="notifications.focusNextToast",oi="notifications.focusPreviousToast",ni="notifications.focusFirstToast",ri="notifications.focusLastToast",ai="notification.collapse",ci="notification.expand",K="notification.acceptPrimaryAction",si="notification.toggle",di="notification.clear",W="notifications.clearAll",U="notifications.toggleDoNotDisturbMode",G="notifications.toggleDoNotDisturbModeBySource";function A(c,n){if(w(n))return n;const r=c.lastFocusedList;if(r instanceof Z){let t=r.getFocusedElements()[0];if(w(t)||r.isDOMFocused()&&(t=r.element(0)),w(t))return t}}function vi(c,n,r){l.registerCommandAndKeybindingRule({id:L,weight:d.WorkbenchContrib,primary:X(C.CtrlCmd|a.KeyK,C.CtrlCmd|C.Shift|a.KeyN),handler:()=>{n.hide(),c.show()}}),l.registerCommandAndKeybindingRule({id:x,weight:d.WorkbenchContrib+50,when:k,primary:a.Escape,handler:i=>{const o=i.get(_);for(const e of r.notifications)e.visible&&o.publicLog2("notification:hide",D(e.message.original,e.sourceId,e.priority===v.SILENT));c.hide()}}),y.registerCommand(ti,()=>{c.isVisible?c.hide():(n.hide(),c.show())}),l.registerCommandAndKeybindingRule({id:di,weight:d.WorkbenchContrib,when:f,primary:a.Delete,mac:{primary:C.CtrlCmd|a.Backspace},handler:(i,o)=>{const e=i.get(j),p=A(i.get(T),o);p&&!p.hasProgress&&(p.close(),e.playSignal(q.clear))}}),l.registerCommandAndKeybindingRule({id:ci,weight:d.WorkbenchContrib,when:f,primary:a.RightArrow,handler:(i,o)=>{A(i.get(T),o)?.expand()}}),l.registerCommandAndKeybindingRule({id:K,weight:d.WorkbenchContrib,when:N.or(f,h),primary:C.CtrlCmd|C.Shift|a.KeyA,handler:i=>{const o=i.get(J).createInstance(S),e=A(i.get(T))||r.notifications.at(0);if(!e)return;const p=e.actions?.primary?e.actions.primary.at(0):void 0;p&&(o.run(p,e),e.close())}}),l.registerCommandAndKeybindingRule({id:ai,weight:d.WorkbenchContrib,when:f,primary:a.LeftArrow,handler:(i,o)=>{A(i.get(T),o)?.collapse()}}),l.registerCommandAndKeybindingRule({id:si,weight:d.WorkbenchContrib,when:f,primary:a.Space,secondary:[a.Enter],handler:i=>{A(i.get(T))?.toggle()}}),y.registerCommand(M,i=>{const o=i.get(_);for(const e of r.notifications)e.visible&&o.publicLog2("notification:hide",D(e.message.original,e.sourceId,e.priority===v.SILENT));n.hide()}),l.registerKeybindingRule({id:M,weight:d.WorkbenchContrib-50,when:h,primary:a.Escape}),l.registerKeybindingRule({id:M,weight:d.WorkbenchContrib+100,when:N.and(h,f),primary:a.Escape}),y.registerCommand(P,()=>n.focus()),l.registerCommandAndKeybindingRule({id:ei,weight:d.WorkbenchContrib,when:N.and(f,h),primary:a.DownArrow,handler:()=>{n.focusNext()}}),l.registerCommandAndKeybindingRule({id:oi,weight:d.WorkbenchContrib,when:N.and(f,h),primary:a.UpArrow,handler:()=>{n.focusPrevious()}}),l.registerCommandAndKeybindingRule({id:ni,weight:d.WorkbenchContrib,when:N.and(f,h),primary:a.PageUp,secondary:[a.Home],handler:()=>{n.focusFirst()}}),l.registerCommandAndKeybindingRule({id:ri,weight:d.WorkbenchContrib,when:N.and(f,h),primary:a.PageDown,secondary:[a.End],handler:()=>{n.focusLast()}}),y.registerCommand(W,()=>c.clearAll()),y.registerCommand(U,i=>{const o=i.get(E);o.setFilter(o.getFilter()===b.ERROR?b.OFF:b.ERROR)}),y.registerCommand(G,i=>{const o=i.get(E),e=i.get(ii),p=o.getFilters().sort((s,V)=>s.label.localeCompare(V.label)),O=new Y,m=O.add(e.createQuickPick());m.items=p.map(s=>({id:s.id,label:s.label,tooltip:`${s.label} (${s.id})`,filter:s.filter})),m.canSelectMany=!0,m.placeholder=$("selectSources","Select sources to enable all notifications from"),m.selectedItems=m.items.filter(s=>s.filter===b.OFF),m.show(),O.add(m.onDidAccept(async()=>{for(const s of m.items)o.setFilter({id:s.id,label:s.label,filter:m.selectedItems.includes(s)?b.OFF:b.ERROR});m.hide()})),O.add(m.onDidHide(()=>O.dispose()))});const t=g("notifications","Notifications");I.appendMenuItem(u.CommandPalette,{command:{id:L,title:g("showNotifications","Show Notifications"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:x,title:g("hideNotifications","Hide Notifications"),category:t},when:k}),I.appendMenuItem(u.CommandPalette,{command:{id:W,title:g("clearAllNotifications","Clear All Notifications"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:K,title:g("acceptNotificationPrimaryAction","Accept Notification Primary Action"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:U,title:g("toggleDoNotDisturbMode","Toggle Do Not Disturb Mode"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:G,title:g("toggleDoNotDisturbModeBySource","Toggle Do Not Disturb Mode By Source..."),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:P,title:g("focusNotificationToasts","Focus Notification Toast"),category:t},when:h})}let S=class extends Q{constructor(r,t){super();this.telemetryService=r;this.notificationService=t}async runAction(r,t){this.telemetryService.publicLog2("workbenchActionExecuted",{id:r.id,from:"message"}),w(t)&&this.telemetryService.publicLog2("notification:actionExecuted",{id:z(t.message.original.toString()).toString(),actionLabel:r.label,source:t.sourceId||"core",silent:t.priority===v.SILENT});try{await super.runAction(r,t)}catch(i){this.notificationService.error(i)}}};S=R([F(0,_),F(1,E)],S);export{K as ACCEPT_PRIMARY_ACTION_NOTIFICATION,W as CLEAR_ALL_NOTIFICATIONS,di as CLEAR_NOTIFICATION,ai as COLLAPSE_NOTIFICATION,ci as EXPAND_NOTIFICATION,x as HIDE_NOTIFICATIONS_CENTER,M as HIDE_NOTIFICATION_TOAST,S as NotificationActionRunner,L as SHOW_NOTIFICATIONS_CENTER,U as TOGGLE_DO_NOT_DISTURB_MODE,G as TOGGLE_DO_NOT_DISTURB_MODE_BY_SOURCE,A as getNotificationFromContext,vi as registerNotificationCommands};
