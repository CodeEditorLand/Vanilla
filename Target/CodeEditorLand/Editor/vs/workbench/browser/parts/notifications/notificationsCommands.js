var B=Object.defineProperty;var H=Object.getOwnPropertyDescriptor;var R=(c,n,r,t)=>{for(var i=t>1?void 0:t?H(n,r):n,o=c.length-1,e;o>=0;o--)(e=c[o])&&(i=(t?e(n,r,i):e(i))||i);return t&&i&&B(n,r,i),i},F=(c,n)=>(r,t)=>n(r,t,c);import{ActionRunner as Q}from"../../../../base/common/actions.js";import{hash as z}from"../../../../base/common/hash.js";import{KeyChord as X,KeyCode as a,KeyMod as C}from"../../../../base/common/keyCodes.js";import{DisposableStore as Y}from"../../../../base/common/lifecycle.js";import{localize as $,localize2 as p}from"../../../../nls.js";import{AccessibilitySignal as q,IAccessibilitySignalService as j}from"../../../../platform/accessibilitySignal/browser/accessibilitySignalService.js";import{MenuId as u,MenuRegistry as I}from"../../../../platform/actions/common/actions.js";import{CommandsRegistry as N}from"../../../../platform/commands/common/commands.js";import{ContextKeyExpr as b}from"../../../../platform/contextkey/common/contextkey.js";import{IInstantiationService as J}from"../../../../platform/instantiation/common/instantiation.js";import{KeybindingsRegistry as d,KeybindingWeight as l}from"../../../../platform/keybinding/common/keybindingsRegistry.js";import{IListService as T,WorkbenchList as Z}from"../../../../platform/list/browser/listService.js";import{INotificationService as E,NotificationPriority as v,NotificationsFilter as y}from"../../../../platform/notification/common/notification.js";import{IQuickInputService as ii}from"../../../../platform/quickinput/common/quickInput.js";import{ITelemetryService as _}from"../../../../platform/telemetry/common/telemetry.js";import{NotificationFocusedContext as f,NotificationsCenterVisibleContext as k,NotificationsToastsVisibleContext as h}from"../../../common/contextkeys.js";import{isNotificationViewItem as w}from"../../../common/notifications.js";import{notificationToMetrics as D}from"./notificationsTelemetry.js";const L="notifications.showList",x="notifications.hideList",ti="notifications.toggleList",M="notifications.hideToasts",P="notifications.focusToasts",ei="notifications.focusNextToast",oi="notifications.focusPreviousToast",ni="notifications.focusFirstToast",ri="notifications.focusLastToast",ai="notification.collapse",ci="notification.expand",K="notification.acceptPrimaryAction",si="notification.toggle",di="notification.clear",W="notifications.clearAll",U="notifications.toggleDoNotDisturbMode",G="notifications.toggleDoNotDisturbModeBySource";function A(c,n){if(w(n))return n;const r=c.lastFocusedList;if(r instanceof Z){let t=r.getFocusedElements()[0];if(w(t)||r.isDOMFocused()&&(t=r.element(0)),w(t))return t}}function Ki(c,n,r){d.registerCommandAndKeybindingRule({id:L,weight:l.WorkbenchContrib,primary:X(C.CtrlCmd|a.KeyK,C.CtrlCmd|C.Shift|a.KeyN),handler:()=>{n.hide(),c.show()}}),d.registerCommandAndKeybindingRule({id:x,weight:l.WorkbenchContrib+50,when:k,primary:a.Escape,handler:i=>{const o=i.get(_);for(const e of r.notifications)e.visible&&o.publicLog2("notification:hide",D(e.message.original,e.sourceId,e.priority===v.SILENT));c.hide()}}),N.registerCommand(ti,()=>{c.isVisible?c.hide():(n.hide(),c.show())}),d.registerCommandAndKeybindingRule({id:di,weight:l.WorkbenchContrib,when:f,primary:a.Delete,mac:{primary:C.CtrlCmd|a.Backspace},handler:(i,o)=>{const e=i.get(j),g=A(i.get(T),o);g&&!g.hasProgress&&(g.close(),e.playSignal(q.clear))}}),d.registerCommandAndKeybindingRule({id:ci,weight:l.WorkbenchContrib,when:f,primary:a.RightArrow,handler:(i,o)=>{A(i.get(T),o)?.expand()}}),d.registerCommandAndKeybindingRule({id:K,weight:l.WorkbenchContrib,when:b.or(f,h),primary:C.CtrlCmd|C.Shift|a.KeyA,handler:i=>{const o=i.get(J).createInstance(S),e=A(i.get(T))||r.notifications.at(0);if(!e)return;const g=e.actions?.primary?e.actions.primary.at(0):void 0;g&&(o.run(g,e),e.close())}}),d.registerCommandAndKeybindingRule({id:ai,weight:l.WorkbenchContrib,when:f,primary:a.LeftArrow,handler:(i,o)=>{A(i.get(T),o)?.collapse()}}),d.registerCommandAndKeybindingRule({id:si,weight:l.WorkbenchContrib,when:f,primary:a.Space,secondary:[a.Enter],handler:i=>{A(i.get(T))?.toggle()}}),N.registerCommand(M,i=>{const o=i.get(_);for(const e of r.notifications)e.visible&&o.publicLog2("notification:hide",D(e.message.original,e.sourceId,e.priority===v.SILENT));n.hide()}),d.registerKeybindingRule({id:M,weight:l.WorkbenchContrib-50,when:h,primary:a.Escape}),d.registerKeybindingRule({id:M,weight:l.WorkbenchContrib+100,when:b.and(h,f),primary:a.Escape}),N.registerCommand(P,()=>n.focus()),d.registerCommandAndKeybindingRule({id:ei,weight:l.WorkbenchContrib,when:b.and(f,h),primary:a.DownArrow,handler:()=>{n.focusNext()}}),d.registerCommandAndKeybindingRule({id:oi,weight:l.WorkbenchContrib,when:b.and(f,h),primary:a.UpArrow,handler:()=>{n.focusPrevious()}}),d.registerCommandAndKeybindingRule({id:ni,weight:l.WorkbenchContrib,when:b.and(f,h),primary:a.PageUp,secondary:[a.Home],handler:()=>{n.focusFirst()}}),d.registerCommandAndKeybindingRule({id:ri,weight:l.WorkbenchContrib,when:b.and(f,h),primary:a.PageDown,secondary:[a.End],handler:()=>{n.focusLast()}}),N.registerCommand(W,()=>c.clearAll()),N.registerCommand(U,i=>{const o=i.get(E);o.setFilter(o.getFilter()===y.ERROR?y.OFF:y.ERROR)}),N.registerCommand(G,i=>{const o=i.get(E),e=i.get(ii),g=o.getFilters().sort((s,V)=>s.label.localeCompare(V.label)),O=new Y,m=O.add(e.createQuickPick());m.items=g.map(s=>({id:s.id,label:s.label,tooltip:`${s.label} (${s.id})`,filter:s.filter})),m.canSelectMany=!0,m.placeholder=$("selectSources","Select sources to enable all notifications from"),m.selectedItems=m.items.filter(s=>s.filter===y.OFF),m.show(),O.add(m.onDidAccept(async()=>{for(const s of m.items)o.setFilter({id:s.id,label:s.label,filter:m.selectedItems.includes(s)?y.OFF:y.ERROR});m.hide()})),O.add(m.onDidHide(()=>O.dispose()))});const t=p("notifications","Notifications");I.appendMenuItem(u.CommandPalette,{command:{id:L,title:p("showNotifications","Show Notifications"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:x,title:p("hideNotifications","Hide Notifications"),category:t},when:k}),I.appendMenuItem(u.CommandPalette,{command:{id:W,title:p("clearAllNotifications","Clear All Notifications"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:K,title:p("acceptNotificationPrimaryAction","Accept Notification Primary Action"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:U,title:p("toggleDoNotDisturbMode","Toggle Do Not Disturb Mode"),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:G,title:p("toggleDoNotDisturbModeBySource","Toggle Do Not Disturb Mode By Source..."),category:t}}),I.appendMenuItem(u.CommandPalette,{command:{id:P,title:p("focusNotificationToasts","Focus Notification Toast"),category:t},when:h})}let S=class extends Q{constructor(r,t){super();this.telemetryService=r;this.notificationService=t}async runAction(r,t){this.telemetryService.publicLog2("workbenchActionExecuted",{id:r.id,from:"message"}),w(t)&&this.telemetryService.publicLog2("notification:actionExecuted",{id:z(t.message.original.toString()).toString(),actionLabel:r.label,source:t.sourceId||"core",silent:t.priority===v.SILENT});try{await super.runAction(r,t)}catch(i){this.notificationService.error(i)}}};S=R([F(0,_),F(1,E)],S);export{K as ACCEPT_PRIMARY_ACTION_NOTIFICATION,W as CLEAR_ALL_NOTIFICATIONS,di as CLEAR_NOTIFICATION,ai as COLLAPSE_NOTIFICATION,ci as EXPAND_NOTIFICATION,x as HIDE_NOTIFICATIONS_CENTER,M as HIDE_NOTIFICATION_TOAST,S as NotificationActionRunner,L as SHOW_NOTIFICATIONS_CENTER,U as TOGGLE_DO_NOT_DISTURB_MODE,G as TOGGLE_DO_NOT_DISTURB_MODE_BY_SOURCE,A as getNotificationFromContext,Ki as registerNotificationCommands};
