var F=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var m=(y,c,t,e)=>{for(var r=e>1?void 0:e?U(c,t):c,i=y.length-1,n;i>=0;i--)(n=y[i])&&(r=(e?n(c,t,r):n(r))||r);return e&&r&&F(c,t,r),r},o=(y,c)=>(t,e)=>c(t,e,y);import"vs/css!./media/statusbarpart";import{addDisposableListener as I,clearNode as R,createStyleSheet as W,EventHelper as N,EventType as M,getWindow as G}from"../../../../../vs/base/browser/dom.js";import{StandardMouseEvent as K}from"../../../../../vs/base/browser/mouseEvent.js";import{Gesture as $,EventType as Y}from"../../../../../vs/base/browser/touch.js";import"../../../../../vs/base/browser/ui/grid/grid.js";import{Separator as L,toAction as j}from"../../../../../vs/base/common/actions.js";import{equals as q}from"../../../../../vs/base/common/arrays.js";import{Emitter as V,Event as z}from"../../../../../vs/base/common/event.js";import{hash as J}from"../../../../../vs/base/common/hash.js";import{Disposable as X,DisposableStore as f,dispose as Q,disposeIfDisposable as Z,MutableDisposable as tt,toDisposable as w}from"../../../../../vs/base/common/lifecycle.js";import{assertIsDefined as g}from"../../../../../vs/base/common/types.js";import{localize as et}from"../../../../../vs/nls.js";import{IContextKeyService as x}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as D}from"../../../../../vs/platform/contextview/browser/contextView.js";import{WorkbenchHoverDelegate as rt}from"../../../../../vs/platform/hover/browser/hover.js";import{InstantiationType as it,registerSingleton as nt}from"../../../../../vs/platform/instantiation/common/extensions.js";import{IInstantiationService as C}from"../../../../../vs/platform/instantiation/common/instantiation.js";import{IStorageService as A}from"../../../../../vs/platform/storage/common/storage.js";import{activeContrastBorder as st,contrastBorder as at}from"../../../../../vs/platform/theme/common/colorRegistry.js";import{isHighContrast as ot}from"../../../../../vs/platform/theme/common/theme.js";import{IThemeService as T}from"../../../../../vs/platform/theme/common/themeService.js";import{IWorkspaceContextService as _,WorkbenchState as P}from"../../../../../vs/platform/workspace/common/workspace.js";import{ToggleStatusbarVisibilityAction as B}from"../../../../../vs/workbench/browser/actions/layoutActions.js";import{MultiWindowParts as dt,Part as lt}from"../../../../../vs/workbench/browser/part.js";import{HideStatusbarEntryAction as ct,ToggleStatusbarEntryVisibilityAction as ut}from"../../../../../vs/workbench/browser/parts/statusbar/statusbarActions.js";import{StatusbarEntryItem as yt}from"../../../../../vs/workbench/browser/parts/statusbar/statusbarItem.js";import{StatusbarViewModel as pt}from"../../../../../vs/workbench/browser/parts/statusbar/statusbarModel.js";import{StatusBarFocused as bt}from"../../../../../vs/workbench/common/contextkeys.js";import{STATUS_BAR_BACKGROUND as mt,STATUS_BAR_BORDER as Et,STATUS_BAR_FOCUS_BORDER as ht,STATUS_BAR_FOREGROUND as St,STATUS_BAR_ITEM_COMPACT_HOVER_BACKGROUND as vt,STATUS_BAR_ITEM_FOCUS_BORDER as It,STATUS_BAR_ITEM_HOVER_BACKGROUND as ft,STATUS_BAR_NO_FOLDER_BACKGROUND as gt,STATUS_BAR_NO_FOLDER_BORDER as Ct,STATUS_BAR_NO_FOLDER_FOREGROUND as At}from"../../../../../vs/workbench/common/theme.js";import{IWorkbenchLayoutService as O,Parts as H}from"../../../../../vs/workbench/services/layout/browser/layoutService.js";import{isStatusbarEntryLocation as Tt,isStatusbarEntryPriority as Mt,IStatusbarService as k,StatusbarAlignment as p}from"../../../../../vs/workbench/services/statusbar/browser/statusbar.js";let u=class extends lt{constructor(t,e,r,i,n,s,a,d){super(t,{hasTitle:!1},r,n,s);this.instantiationService=e;this.contextService=i;this.storageService=n;this.contextMenuService=a;this.contextKeyService=d;this.registerListeners()}static HEIGHT=22;minimumWidth=0;maximumWidth=Number.POSITIVE_INFINITY;minimumHeight=u.HEIGHT;maximumHeight=u.HEIGHT;styleElement;pendingEntries=[];viewModel=this._register(new pt(this.storageService));onDidChangeEntryVisibility=this.viewModel.onDidChangeEntryVisibility;_onWillDispose=this._register(new V);onWillDispose=this._onWillDispose.event;leftItemsContainer;rightItemsContainer;hoverDelegate=this._register(this.instantiationService.createInstance(rt,"element",!0,(t,e)=>({persistence:{hideOnKeyDown:!0,sticky:e}})));compactEntriesDisposable=this._register(new tt);styleOverrides=new Set;registerListeners(){this._register(this.onDidChangeEntryVisibility(()=>this.updateCompactEntries())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateStyles()))}addEntry(t,e,r,i=0){let n;return Mt(i)?n=i:n={primary:i,secondary:J(e)},this.element?this.doAddEntry(t,e,r,n):this.doAddPendingEntry(t,e,r,n)}doAddPendingEntry(t,e,r,i){const n={entry:t,id:e,alignment:r,priority:i};return this.pendingEntries.push(n),{update:a=>{n.accessor?n.accessor.update(a):n.entry=a},dispose:()=>{n.accessor?n.accessor.dispose():this.pendingEntries=this.pendingEntries.filter(a=>a!==n)}}}doAddEntry(t,e,r,i){const n=this.doCreateStatusItem(e,r),s=this.instantiationService.createInstance(yt,n,t,this.hoverDelegate),a=new class{id=e;alignment=r;priority=i;container=n;labelContainer=s.labelContainer;get name(){return s.name}get hasCommand(){return s.hasCommand}},{needsFullRefresh:d}=this.doAddOrRemoveModelEntry(a,!0);return d?this.appendStatusbarEntries():this.appendStatusbarEntry(a),{update:l=>{s.update(l)},dispose:()=>{const{needsFullRefresh:l}=this.doAddOrRemoveModelEntry(a,!1);l?this.appendStatusbarEntries():n.remove(),Q(s)}}}doCreateStatusItem(t,e,...r){const i=document.createElement("div");return i.id=t,i.classList.add("statusbar-item"),r&&i.classList.add(...r),e===p.RIGHT?i.classList.add("right"):i.classList.add("left"),i}doAddOrRemoveModelEntry(t,e){const r=this.viewModel.entries;e?this.viewModel.add(t):this.viewModel.remove(t);const i=this.viewModel.entries;return e?r.splice(i.indexOf(t),0,t):r.splice(r.indexOf(t),1),{needsFullRefresh:!q(r,i)}}isEntryVisible(t){return!this.viewModel.isHidden(t)}updateEntryVisibility(t,e){e?this.viewModel.show(t):this.viewModel.hide(t)}focusNextEntry(){this.viewModel.focusNextEntry()}focusPreviousEntry(){this.viewModel.focusPreviousEntry()}isEntryFocused(){return this.viewModel.isEntryFocused()}focus(t=!0){this.getContainer()?.focus();const e=this.viewModel.lastFocusedEntry;t&&e&&setTimeout(()=>e.labelContainer.focus(),0)}createContentArea(t){this.element=t;const e=this._register(this.contextKeyService.createScoped(this.element));return bt.bindTo(e).set(!0),this.leftItemsContainer=document.createElement("div"),this.leftItemsContainer.classList.add("left-items","items-container"),this.element.appendChild(this.leftItemsContainer),this.element.tabIndex=0,this.rightItemsContainer=document.createElement("div"),this.rightItemsContainer.classList.add("right-items","items-container"),this.element.appendChild(this.rightItemsContainer),this._register(I(t,M.CONTEXT_MENU,r=>this.showContextMenu(r))),this._register($.addTarget(t)),this._register(I(t,Y.Contextmenu,r=>this.showContextMenu(r))),this.createInitialStatusbarEntries(),this.element}createInitialStatusbarEntries(){for(this.appendStatusbarEntries();this.pendingEntries.length;){const t=this.pendingEntries.shift();t&&(t.accessor=this.addEntry(t.entry,t.id,t.alignment,t.priority.primary))}}appendStatusbarEntries(){const t=g(this.leftItemsContainer),e=g(this.rightItemsContainer);R(t),R(e);for(const r of[...this.viewModel.getEntries(p.LEFT),...this.viewModel.getEntries(p.RIGHT).reverse()])(r.alignment===p.LEFT?t:e).appendChild(r.container);this.updateCompactEntries()}appendStatusbarEntry(t){const e=this.viewModel.getEntries(t.alignment);t.alignment===p.RIGHT&&e.reverse();const r=g(t.alignment===p.LEFT?this.leftItemsContainer:this.rightItemsContainer),i=e.indexOf(t);i+1===e.length?r.appendChild(t.container):r.insertBefore(t.container,e[i+1].container),this.updateCompactEntries()}updateCompactEntries(){const t=this.viewModel.entries,e=new Map;for(const s of t)this.viewModel.isHidden(s.id)||e.set(s.id,s),s.container.classList.remove("compact-left","compact-right");const r=new Map;for(const s of e.values())if(Tt(s.priority.primary)&&s.priority.primary.compact){const a=s.priority.primary.id,d=e.get(a);if(!d)continue;let l=r.get(a);if(!l){for(const E of r.values())if(E.has(a)){l=E;break}l||(l=new Map,r.set(a,l))}l.set(s.id,s),l.set(d.id,d),s.priority.primary.alignment===p.LEFT?(d.container.classList.add("compact-left"),s.container.classList.add("compact-right")):(d.container.classList.add("compact-right"),s.container.classList.add("compact-left"))}const i=this.getColor(ft),n=this.getColor(vt);if(this.compactEntriesDisposable.value=new f,i&&n&&!ot(this.theme.type))for(const[,s]of r)for(const a of s.values())a.hasCommand&&(this.compactEntriesDisposable.value.add(I(a.labelContainer,M.MOUSE_OVER,()=>{s.forEach(d=>d.labelContainer.style.backgroundColor=i),a.labelContainer.style.backgroundColor=n})),this.compactEntriesDisposable.value.add(I(a.labelContainer,M.MOUSE_OUT,()=>{s.forEach(d=>d.labelContainer.style.backgroundColor="")})))}showContextMenu(t){N.stop(t,!0);const e=new K(G(this.element),t);let r;this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>(r=this.getContextMenuActions(e),r),onHide:()=>{r&&Z(r)}})}getContextMenuActions(t){const e=[];e.push(j({id:B.ID,label:et("hideStatusBar","Hide Status Bar"),run:()=>this.instantiationService.invokeFunction(n=>new B().run(n))})),e.push(new L);const r=new Set;for(const n of this.viewModel.entries)r.has(n.id)||(e.push(new ut(n.id,n.name,this.viewModel)),r.add(n.id));let i;for(let n=t.target;n;n=n.parentElement){const s=this.viewModel.findEntry(n);if(s){i=s;break}}return i&&(e.push(new L),e.push(new ct(i.id,i.name,this.viewModel))),e}updateStyles(){super.updateStyles();const t=g(this.getContainer()),e=[...this.styleOverrides].sort((d,l)=>d.priority-l.priority)[0],r=this.getColor(e?.background??(this.contextService.getWorkbenchState()!==P.EMPTY?mt:gt))||"";t.style.backgroundColor=r;const i=this.getColor(e?.foreground??(this.contextService.getWorkbenchState()!==P.EMPTY?St:At))||"";t.style.color=i;const n=this.getColor(It),s=this.getColor(e?.border??(this.contextService.getWorkbenchState()!==P.EMPTY?Et:Ct))||this.getColor(at);s?(t.classList.add("status-border-top"),t.style.setProperty("--status-border-top-color",s)):(t.classList.remove("status-border-top"),t.style.removeProperty("--status-border-top-color"));const a=this.getColor(ht);this.styleElement||(this.styleElement=W(t)),this.styleElement.textContent=`

				/* Status bar focus outline */
				.monaco-workbench .part.statusbar:focus {
					outline-color: ${a};
				}

				/* Status bar item focus outline */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item a:focus-visible {
					outline: 1px solid ${this.getColor(st)??n};
					outline-offset: ${s?"-2px":"-1px"};
				}

				/* Notification Beak */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item.has-beak > .status-bar-item-beak-container:before {
					border-bottom-color: ${r};
				}
			`}layout(t,e,r,i){super.layout(t,e,r,i),super.layoutContents(t,e)}overrideStyle(t){return this.styleOverrides.add(t),this.updateStyles(),w(()=>{this.styleOverrides.delete(t),this.updateStyles()})}toJSON(){return{type:H.STATUSBAR_PART}}dispose(){this._onWillDispose.fire(),super.dispose()}};u=m([o(1,C),o(2,T),o(3,_),o(4,A),o(5,O),o(6,D),o(7,x)],u);let h=class extends u{constructor(c,t,e,r,i,n,s){super(H.STATUSBAR_PART,c,t,e,r,i,n,s)}};h=m([o(0,C),o(1,T),o(2,_),o(3,A),o(4,O),o(5,D),o(6,x)],h);let b=class extends u{constructor(t,e,r,i,n,s,a,d){const l=b.COUNTER++;super(`workbench.parts.auxiliaryStatus.${l}`,e,r,i,n,s,a,d);this.container=t}static COUNTER=1;height=u.HEIGHT};b=m([o(1,C),o(2,T),o(3,_),o(4,A),o(5,O),o(6,D),o(7,x)],b);let S=class extends dt{constructor(t,e,r){super("workbench.statusBarService",r,e);this.instantiationService=t;this._register(this.registerPart(this.mainPart))}mainPart=this._register(this.instantiationService.createInstance(h));_onDidCreateAuxiliaryStatusbarPart=this._register(new V);onDidCreateAuxiliaryStatusbarPart=this._onDidCreateAuxiliaryStatusbarPart.event;createAuxiliaryStatusbarPart(t){const e=document.createElement("footer");e.classList.add("part","statusbar"),e.setAttribute("role","status"),e.style.position="relative",e.setAttribute("aria-live","off"),e.setAttribute("tabindex","0"),t.appendChild(e);const r=this.instantiationService.createInstance(b,e),i=this.registerPart(r);return r.create(e),z.once(r.onWillDispose)(()=>i.dispose()),this._onDidCreateAuxiliaryStatusbarPart.fire(r),r}createScoped(t,e){return e.add(this.instantiationService.createInstance(v,t))}onDidChangeEntryVisibility=this.mainPart.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return t.showInAllWindows?this.doAddEntryToAllWindows(t,e,r,i):this.mainPart.addEntry(t,e,r,i)}doAddEntryToAllWindows(t,e,r,i=0){const n=new f,s=new Set;function a(d){const l=new f;l.add(d.onWillDispose(()=>l.dispose()));const E=l.add(d.addEntry(t,e,r,i));s.add(E),l.add(w(()=>s.delete(E))),n.add(l),l.add(w(()=>n.delete(l)))}for(const d of this.parts)a(d);return n.add(this.onDidCreateAuxiliaryStatusbarPart(d=>a(d))),{update:d=>{for(const l of s)l.update(d)},dispose:()=>n.dispose()}}isEntryVisible(t){return this.mainPart.isEntryVisible(t)}updateEntryVisibility(t,e){for(const r of this.parts)r.updateEntryVisibility(t,e)}focus(t){this.activePart.focus(t)}focusNextEntry(){this.activePart.focusNextEntry()}focusPreviousEntry(){this.activePart.focusPreviousEntry()}isEntryFocused(){return this.activePart.isEntryFocused()}overrideStyle(t){const e=new f;for(const r of this.parts)e.add(r.overrideStyle(t));return e}};S=m([o(0,C),o(1,A),o(2,T)],S);let v=class extends X{constructor(t,e){super();this.statusbarEntryContainer=t;this.statusbarService=e}createAuxiliaryStatusbarPart(t){return this.statusbarService.createAuxiliaryStatusbarPart(t)}createScoped(t,e){return this.statusbarService.createScoped(t,e)}getPart(){return this.statusbarEntryContainer}onDidChangeEntryVisibility=this.statusbarEntryContainer.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return this.statusbarEntryContainer.addEntry(t,e,r,i)}isEntryVisible(t){return this.statusbarEntryContainer.isEntryVisible(t)}updateEntryVisibility(t,e){this.statusbarEntryContainer.updateEntryVisibility(t,e)}focus(t){this.statusbarEntryContainer.focus(t)}focusNextEntry(){this.statusbarEntryContainer.focusNextEntry()}focusPreviousEntry(){this.statusbarEntryContainer.focusPreviousEntry()}isEntryFocused(){return this.statusbarEntryContainer.isEntryFocused()}overrideStyle(t){return this.statusbarEntryContainer.overrideStyle(t)}};v=m([o(1,k)],v),nt(k,S,it.Eager);export{b as AuxiliaryStatusbarPart,h as MainStatusbarPart,v as ScopedStatusbarService,S as StatusbarService};
