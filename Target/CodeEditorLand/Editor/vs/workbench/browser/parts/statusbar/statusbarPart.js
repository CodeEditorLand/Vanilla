var F=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var m=(y,c,t,e)=>{for(var r=e>1?void 0:e?U(c,t):c,i=y.length-1,s;i>=0;i--)(s=y[i])&&(r=(e?s(c,t,r):s(r))||r);return e&&r&&F(c,t,r),r},o=(y,c)=>(t,e)=>c(t,e,y);import"./media/statusbarpart.css";import{EventHelper as W,EventType as M,addDisposableListener as I,clearNode as R,createStyleSheet as N,getWindow as G}from"../../../../base/browser/dom.js";import{StandardMouseEvent as K}from"../../../../base/browser/mouseEvent.js";import{Gesture as $,EventType as Y}from"../../../../base/browser/touch.js";import{Separator as L,toAction as j}from"../../../../base/common/actions.js";import{equals as q}from"../../../../base/common/arrays.js";import{Emitter as V,Event as z}from"../../../../base/common/event.js";import{hash as J}from"../../../../base/common/hash.js";import{Disposable as X,DisposableStore as g,MutableDisposable as Q,dispose as Z,disposeIfDisposable as tt,toDisposable as w}from"../../../../base/common/lifecycle.js";import{assertIsDefined as f}from"../../../../base/common/types.js";import{localize as et}from"../../../../nls.js";import{IContextKeyService as x}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as D}from"../../../../platform/contextview/browser/contextView.js";import{WorkbenchHoverDelegate as rt}from"../../../../platform/hover/browser/hover.js";import{InstantiationType as it,registerSingleton as st}from"../../../../platform/instantiation/common/extensions.js";import{IInstantiationService as C}from"../../../../platform/instantiation/common/instantiation.js";import{IStorageService as A}from"../../../../platform/storage/common/storage.js";import{activeContrastBorder as nt,contrastBorder as at}from"../../../../platform/theme/common/colorRegistry.js";import{isHighContrast as ot}from"../../../../platform/theme/common/theme.js";import{IThemeService as T}from"../../../../platform/theme/common/themeService.js";import{IWorkspaceContextService as _,WorkbenchState as P}from"../../../../platform/workspace/common/workspace.js";import{StatusBarFocused as dt}from"../../../common/contextkeys.js";import{STATUS_BAR_BACKGROUND as lt,STATUS_BAR_BORDER as ct,STATUS_BAR_FOCUS_BORDER as ut,STATUS_BAR_FOREGROUND as yt,STATUS_BAR_ITEM_COMPACT_HOVER_BACKGROUND as pt,STATUS_BAR_ITEM_FOCUS_BORDER as bt,STATUS_BAR_ITEM_HOVER_BACKGROUND as mt,STATUS_BAR_NO_FOLDER_BACKGROUND as Et,STATUS_BAR_NO_FOLDER_BORDER as ht,STATUS_BAR_NO_FOLDER_FOREGROUND as St}from"../../../common/theme.js";import{IWorkbenchLayoutService as O,Parts as B}from"../../../services/layout/browser/layoutService.js";import{IStatusbarService as H,StatusbarAlignment as p,isStatusbarEntryLocation as vt,isStatusbarEntryPriority as It}from"../../../services/statusbar/browser/statusbar.js";import{ToggleStatusbarVisibilityAction as k}from"../../actions/layoutActions.js";import{MultiWindowParts as gt,Part as ft}from"../../part.js";import{HideStatusbarEntryAction as Ct,ToggleStatusbarEntryVisibilityAction as At}from"./statusbarActions.js";import{StatusbarEntryItem as Tt}from"./statusbarItem.js";import{StatusbarViewModel as Mt}from"./statusbarModel.js";let u=class extends ft{constructor(t,e,r,i,s,n,a,d){super(t,{hasTitle:!1},r,s,n);this.instantiationService=e;this.contextService=i;this.storageService=s;this.contextMenuService=a;this.contextKeyService=d;this.registerListeners()}static HEIGHT=22;minimumWidth=0;maximumWidth=Number.POSITIVE_INFINITY;minimumHeight=u.HEIGHT;maximumHeight=u.HEIGHT;styleElement;pendingEntries=[];viewModel=this._register(new Mt(this.storageService));onDidChangeEntryVisibility=this.viewModel.onDidChangeEntryVisibility;_onWillDispose=this._register(new V);onWillDispose=this._onWillDispose.event;leftItemsContainer;rightItemsContainer;hoverDelegate=this._register(this.instantiationService.createInstance(rt,"element",!0,(t,e)=>({persistence:{hideOnKeyDown:!0,sticky:e}})));compactEntriesDisposable=this._register(new Q);styleOverrides=new Set;registerListeners(){this._register(this.onDidChangeEntryVisibility(()=>this.updateCompactEntries())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateStyles()))}addEntry(t,e,r,i=0){let s;return It(i)?s=i:s={primary:i,secondary:J(e)},this.element?this.doAddEntry(t,e,r,s):this.doAddPendingEntry(t,e,r,s)}doAddPendingEntry(t,e,r,i){const s={entry:t,id:e,alignment:r,priority:i};return this.pendingEntries.push(s),{update:a=>{s.accessor?s.accessor.update(a):s.entry=a},dispose:()=>{s.accessor?s.accessor.dispose():this.pendingEntries=this.pendingEntries.filter(a=>a!==s)}}}doAddEntry(t,e,r,i){const s=this.doCreateStatusItem(e,r),n=this.instantiationService.createInstance(Tt,s,t,this.hoverDelegate),a=new class{id=e;alignment=r;priority=i;container=s;labelContainer=n.labelContainer;get name(){return n.name}get hasCommand(){return n.hasCommand}},{needsFullRefresh:d}=this.doAddOrRemoveModelEntry(a,!0);return d?this.appendStatusbarEntries():this.appendStatusbarEntry(a),{update:l=>{n.update(l)},dispose:()=>{const{needsFullRefresh:l}=this.doAddOrRemoveModelEntry(a,!1);l?this.appendStatusbarEntries():s.remove(),Z(n)}}}doCreateStatusItem(t,e,...r){const i=document.createElement("div");return i.id=t,i.classList.add("statusbar-item"),r&&i.classList.add(...r),e===p.RIGHT?i.classList.add("right"):i.classList.add("left"),i}doAddOrRemoveModelEntry(t,e){const r=this.viewModel.entries;e?this.viewModel.add(t):this.viewModel.remove(t);const i=this.viewModel.entries;return e?r.splice(i.indexOf(t),0,t):r.splice(r.indexOf(t),1),{needsFullRefresh:!q(r,i)}}isEntryVisible(t){return!this.viewModel.isHidden(t)}updateEntryVisibility(t,e){e?this.viewModel.show(t):this.viewModel.hide(t)}focusNextEntry(){this.viewModel.focusNextEntry()}focusPreviousEntry(){this.viewModel.focusPreviousEntry()}isEntryFocused(){return this.viewModel.isEntryFocused()}focus(t=!0){this.getContainer()?.focus();const e=this.viewModel.lastFocusedEntry;t&&e&&setTimeout(()=>e.labelContainer.focus(),0)}createContentArea(t){this.element=t;const e=this._register(this.contextKeyService.createScoped(this.element));return dt.bindTo(e).set(!0),this.leftItemsContainer=document.createElement("div"),this.leftItemsContainer.classList.add("left-items","items-container"),this.element.appendChild(this.leftItemsContainer),this.element.tabIndex=0,this.rightItemsContainer=document.createElement("div"),this.rightItemsContainer.classList.add("right-items","items-container"),this.element.appendChild(this.rightItemsContainer),this._register(I(t,M.CONTEXT_MENU,r=>this.showContextMenu(r))),this._register($.addTarget(t)),this._register(I(t,Y.Contextmenu,r=>this.showContextMenu(r))),this.createInitialStatusbarEntries(),this.element}createInitialStatusbarEntries(){for(this.appendStatusbarEntries();this.pendingEntries.length;){const t=this.pendingEntries.shift();t&&(t.accessor=this.addEntry(t.entry,t.id,t.alignment,t.priority.primary))}}appendStatusbarEntries(){const t=f(this.leftItemsContainer),e=f(this.rightItemsContainer);R(t),R(e);for(const r of[...this.viewModel.getEntries(p.LEFT),...this.viewModel.getEntries(p.RIGHT).reverse()])(r.alignment===p.LEFT?t:e).appendChild(r.container);this.updateCompactEntries()}appendStatusbarEntry(t){const e=this.viewModel.getEntries(t.alignment);t.alignment===p.RIGHT&&e.reverse();const r=f(t.alignment===p.LEFT?this.leftItemsContainer:this.rightItemsContainer),i=e.indexOf(t);i+1===e.length?r.appendChild(t.container):r.insertBefore(t.container,e[i+1].container),this.updateCompactEntries()}updateCompactEntries(){const t=this.viewModel.entries,e=new Map;for(const n of t)this.viewModel.isHidden(n.id)||e.set(n.id,n),n.container.classList.remove("compact-left","compact-right");const r=new Map;for(const n of e.values())if(vt(n.priority.primary)&&n.priority.primary.compact){const a=n.priority.primary.id,d=e.get(a);if(!d)continue;let l=r.get(a);if(!l){for(const E of r.values())if(E.has(a)){l=E;break}l||(l=new Map,r.set(a,l))}l.set(n.id,n),l.set(d.id,d),n.priority.primary.alignment===p.LEFT?(d.container.classList.add("compact-left"),n.container.classList.add("compact-right")):(d.container.classList.add("compact-right"),n.container.classList.add("compact-left"))}const i=this.getColor(mt),s=this.getColor(pt);if(this.compactEntriesDisposable.value=new g,i&&s&&!ot(this.theme.type))for(const[,n]of r)for(const a of n.values())a.hasCommand&&(this.compactEntriesDisposable.value.add(I(a.labelContainer,M.MOUSE_OVER,()=>{n.forEach(d=>d.labelContainer.style.backgroundColor=i),a.labelContainer.style.backgroundColor=s})),this.compactEntriesDisposable.value.add(I(a.labelContainer,M.MOUSE_OUT,()=>{n.forEach(d=>d.labelContainer.style.backgroundColor="")})))}showContextMenu(t){W.stop(t,!0);const e=new K(G(this.element),t);let r;this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>(r=this.getContextMenuActions(e),r),onHide:()=>{r&&tt(r)}})}getContextMenuActions(t){const e=[];e.push(j({id:k.ID,label:et("hideStatusBar","Hide Status Bar"),run:()=>this.instantiationService.invokeFunction(s=>new k().run(s))})),e.push(new L);const r=new Set;for(const s of this.viewModel.entries)r.has(s.id)||(e.push(new At(s.id,s.name,this.viewModel)),r.add(s.id));let i;for(let s=t.target;s;s=s.parentElement){const n=this.viewModel.findEntry(s);if(n){i=n;break}}return i&&(e.push(new L),e.push(new Ct(i.id,i.name,this.viewModel))),e}updateStyles(){super.updateStyles();const t=f(this.getContainer()),e=[...this.styleOverrides].sort((d,l)=>d.priority-l.priority)[0],r=this.getColor(e?.background??(this.contextService.getWorkbenchState()!==P.EMPTY?lt:Et))||"";t.style.backgroundColor=r;const i=this.getColor(e?.foreground??(this.contextService.getWorkbenchState()!==P.EMPTY?yt:St))||"";t.style.color=i;const s=this.getColor(bt),n=this.getColor(e?.border??(this.contextService.getWorkbenchState()!==P.EMPTY?ct:ht))||this.getColor(at);n?(t.classList.add("status-border-top"),t.style.setProperty("--status-border-top-color",n)):(t.classList.remove("status-border-top"),t.style.removeProperty("--status-border-top-color"));const a=this.getColor(ut);this.styleElement||(this.styleElement=N(t)),this.styleElement.textContent=`

				/* Status bar focus outline */
				.monaco-workbench .part.statusbar:focus {
					outline-color: ${a};
				}

				/* Status bar item focus outline */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item a:focus-visible {
					outline: 1px solid ${this.getColor(nt)??s};
					outline-offset: ${n?"-2px":"-1px"};
				}

				/* Notification Beak */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item.has-beak > .status-bar-item-beak-container:before {
					border-bottom-color: ${r};
				}
			`}layout(t,e,r,i){super.layout(t,e,r,i),super.layoutContents(t,e)}overrideStyle(t){return this.styleOverrides.add(t),this.updateStyles(),w(()=>{this.styleOverrides.delete(t),this.updateStyles()})}toJSON(){return{type:B.STATUSBAR_PART}}dispose(){this._onWillDispose.fire(),super.dispose()}};u=m([o(1,C),o(2,T),o(3,_),o(4,A),o(5,O),o(6,D),o(7,x)],u);let h=class extends u{constructor(c,t,e,r,i,s,n){super(B.STATUSBAR_PART,c,t,e,r,i,s,n)}};h=m([o(0,C),o(1,T),o(2,_),o(3,A),o(4,O),o(5,D),o(6,x)],h);let b=class extends u{constructor(t,e,r,i,s,n,a,d){const l=b.COUNTER++;super(`workbench.parts.auxiliaryStatus.${l}`,e,r,i,s,n,a,d);this.container=t}static COUNTER=1;height=u.HEIGHT};b=m([o(1,C),o(2,T),o(3,_),o(4,A),o(5,O),o(6,D),o(7,x)],b);let S=class extends gt{constructor(t,e,r){super("workbench.statusBarService",r,e);this.instantiationService=t;this._register(this.registerPart(this.mainPart))}mainPart=this._register(this.instantiationService.createInstance(h));_onDidCreateAuxiliaryStatusbarPart=this._register(new V);onDidCreateAuxiliaryStatusbarPart=this._onDidCreateAuxiliaryStatusbarPart.event;createAuxiliaryStatusbarPart(t){const e=document.createElement("footer");e.classList.add("part","statusbar"),e.setAttribute("role","status"),e.style.position="relative",e.setAttribute("aria-live","off"),e.setAttribute("tabindex","0"),t.appendChild(e);const r=this.instantiationService.createInstance(b,e),i=this.registerPart(r);return r.create(e),z.once(r.onWillDispose)(()=>i.dispose()),this._onDidCreateAuxiliaryStatusbarPart.fire(r),r}createScoped(t,e){return e.add(this.instantiationService.createInstance(v,t))}onDidChangeEntryVisibility=this.mainPart.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return t.showInAllWindows?this.doAddEntryToAllWindows(t,e,r,i):this.mainPart.addEntry(t,e,r,i)}doAddEntryToAllWindows(t,e,r,i=0){const s=new g,n=new Set;function a(d){const l=new g;l.add(d.onWillDispose(()=>l.dispose()));const E=l.add(d.addEntry(t,e,r,i));n.add(E),l.add(w(()=>n.delete(E))),s.add(l),l.add(w(()=>s.delete(l)))}for(const d of this.parts)a(d);return s.add(this.onDidCreateAuxiliaryStatusbarPart(d=>a(d))),{update:d=>{for(const l of n)l.update(d)},dispose:()=>s.dispose()}}isEntryVisible(t){return this.mainPart.isEntryVisible(t)}updateEntryVisibility(t,e){for(const r of this.parts)r.updateEntryVisibility(t,e)}focus(t){this.activePart.focus(t)}focusNextEntry(){this.activePart.focusNextEntry()}focusPreviousEntry(){this.activePart.focusPreviousEntry()}isEntryFocused(){return this.activePart.isEntryFocused()}overrideStyle(t){const e=new g;for(const r of this.parts)e.add(r.overrideStyle(t));return e}};S=m([o(0,C),o(1,A),o(2,T)],S);let v=class extends X{constructor(t,e){super();this.statusbarEntryContainer=t;this.statusbarService=e}createAuxiliaryStatusbarPart(t){return this.statusbarService.createAuxiliaryStatusbarPart(t)}createScoped(t,e){return this.statusbarService.createScoped(t,e)}getPart(){return this.statusbarEntryContainer}onDidChangeEntryVisibility=this.statusbarEntryContainer.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return this.statusbarEntryContainer.addEntry(t,e,r,i)}isEntryVisible(t){return this.statusbarEntryContainer.isEntryVisible(t)}updateEntryVisibility(t,e){this.statusbarEntryContainer.updateEntryVisibility(t,e)}focus(t){this.statusbarEntryContainer.focus(t)}focusNextEntry(){this.statusbarEntryContainer.focusNextEntry()}focusPreviousEntry(){this.statusbarEntryContainer.focusPreviousEntry()}isEntryFocused(){return this.statusbarEntryContainer.isEntryFocused()}overrideStyle(t){return this.statusbarEntryContainer.overrideStyle(t)}};v=m([o(1,H)],v),st(H,S,it.Eager);export{b as AuxiliaryStatusbarPart,h as MainStatusbarPart,v as ScopedStatusbarService,S as StatusbarService};
