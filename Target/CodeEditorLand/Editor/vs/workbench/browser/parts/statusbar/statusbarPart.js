var F=Object.defineProperty;var U=Object.getOwnPropertyDescriptor;var m=(y,c,t,e)=>{for(var r=e>1?void 0:e?U(c,t):c,i=y.length-1,n;i>=0;i--)(n=y[i])&&(r=(e?n(c,t,r):n(r))||r);return e&&r&&F(c,t,r),r},o=(y,c)=>(t,e)=>c(t,e,y);import"./media/statusbarpart.css";import{localize as W}from"../../../../nls.js";import{Disposable as N,DisposableStore as I,dispose as G,disposeIfDisposable as K,MutableDisposable as $,toDisposable as M}from"../../../../base/common/lifecycle.js";import{MultiWindowParts as Y,Part as j}from"../../part.js";import{EventType as q,Gesture as z}from"../../../../base/browser/touch.js";import{IInstantiationService as f}from"../../../../platform/instantiation/common/instantiation.js";import{StatusbarAlignment as p,IStatusbarService as R,isStatusbarEntryLocation as J,isStatusbarEntryPriority as X}from"../../../services/statusbar/browser/statusbar.js";import{IContextMenuService as w}from"../../../../platform/contextview/browser/contextView.js";import{Separator as L,toAction as Q}from"../../../../base/common/actions.js";import{IThemeService as g}from"../../../../platform/theme/common/themeService.js";import{STATUS_BAR_BACKGROUND as Z,STATUS_BAR_FOREGROUND as tt,STATUS_BAR_NO_FOLDER_BACKGROUND as et,STATUS_BAR_ITEM_HOVER_BACKGROUND as rt,STATUS_BAR_BORDER as it,STATUS_BAR_NO_FOLDER_FOREGROUND as nt,STATUS_BAR_NO_FOLDER_BORDER as st,STATUS_BAR_ITEM_COMPACT_HOVER_BACKGROUND as at,STATUS_BAR_ITEM_FOCUS_BORDER as ot,STATUS_BAR_FOCUS_BORDER as dt}from"../../../common/theme.js";import{IWorkspaceContextService as x,WorkbenchState as D}from"../../../../platform/workspace/common/workspace.js";import{contrastBorder as lt,activeContrastBorder as ct}from"../../../../platform/theme/common/colorRegistry.js";import{EventHelper as ut,createStyleSheet as yt,addDisposableListener as C,EventType as _,clearNode as V,getWindow as pt}from"../../../../base/browser/dom.js";import{IStorageService as A}from"../../../../platform/storage/common/storage.js";import{Parts as B,IWorkbenchLayoutService as P}from"../../../services/layout/browser/layoutService.js";import{InstantiationType as bt,registerSingleton as mt}from"../../../../platform/instantiation/common/extensions.js";import{equals as Et}from"../../../../base/common/arrays.js";import{StandardMouseEvent as ht}from"../../../../base/browser/mouseEvent.js";import{ToggleStatusbarVisibilityAction as H}from"../../actions/layoutActions.js";import{assertIsDefined as T}from"../../../../base/common/types.js";import{IContextKeyService as O}from"../../../../platform/contextkey/common/contextkey.js";import{isHighContrast as St}from"../../../../platform/theme/common/theme.js";import{hash as vt}from"../../../../base/common/hash.js";import{WorkbenchHoverDelegate as It}from"../../../../platform/hover/browser/hover.js";import{HideStatusbarEntryAction as ft,ToggleStatusbarEntryVisibilityAction as gt}from"./statusbarActions.js";import{StatusbarViewModel as Ct}from"./statusbarModel.js";import{StatusbarEntryItem as At}from"./statusbarItem.js";import{StatusBarFocused as Tt}from"../../../common/contextkeys.js";import{Emitter as k,Event as Mt}from"../../../../base/common/event.js";let u=class extends j{constructor(t,e,r,i,n,s,a,d){super(t,{hasTitle:!1},r,n,s);this.instantiationService=e;this.contextService=i;this.storageService=n;this.contextMenuService=a;this.contextKeyService=d;this.registerListeners()}static HEIGHT=22;minimumWidth=0;maximumWidth=Number.POSITIVE_INFINITY;minimumHeight=u.HEIGHT;maximumHeight=u.HEIGHT;styleElement;pendingEntries=[];viewModel=this._register(new Ct(this.storageService));onDidChangeEntryVisibility=this.viewModel.onDidChangeEntryVisibility;_onWillDispose=this._register(new k);onWillDispose=this._onWillDispose.event;leftItemsContainer;rightItemsContainer;hoverDelegate=this._register(this.instantiationService.createInstance(It,"element",!0,(t,e)=>({persistence:{hideOnKeyDown:!0,sticky:e}})));compactEntriesDisposable=this._register(new $);styleOverrides=new Set;registerListeners(){this._register(this.onDidChangeEntryVisibility(()=>this.updateCompactEntries())),this._register(this.contextService.onDidChangeWorkbenchState(()=>this.updateStyles()))}addEntry(t,e,r,i=0){let n;return X(i)?n=i:n={primary:i,secondary:vt(e)},this.element?this.doAddEntry(t,e,r,n):this.doAddPendingEntry(t,e,r,n)}doAddPendingEntry(t,e,r,i){const n={entry:t,id:e,alignment:r,priority:i};return this.pendingEntries.push(n),{update:a=>{n.accessor?n.accessor.update(a):n.entry=a},dispose:()=>{n.accessor?n.accessor.dispose():this.pendingEntries=this.pendingEntries.filter(a=>a!==n)}}}doAddEntry(t,e,r,i){const n=this.doCreateStatusItem(e,r),s=this.instantiationService.createInstance(At,n,t,this.hoverDelegate),a=new class{id=e;alignment=r;priority=i;container=n;labelContainer=s.labelContainer;get name(){return s.name}get hasCommand(){return s.hasCommand}},{needsFullRefresh:d}=this.doAddOrRemoveModelEntry(a,!0);return d?this.appendStatusbarEntries():this.appendStatusbarEntry(a),{update:l=>{s.update(l)},dispose:()=>{const{needsFullRefresh:l}=this.doAddOrRemoveModelEntry(a,!1);l?this.appendStatusbarEntries():n.remove(),G(s)}}}doCreateStatusItem(t,e,...r){const i=document.createElement("div");return i.id=t,i.classList.add("statusbar-item"),r&&i.classList.add(...r),e===p.RIGHT?i.classList.add("right"):i.classList.add("left"),i}doAddOrRemoveModelEntry(t,e){const r=this.viewModel.entries;e?this.viewModel.add(t):this.viewModel.remove(t);const i=this.viewModel.entries;return e?r.splice(i.indexOf(t),0,t):r.splice(r.indexOf(t),1),{needsFullRefresh:!Et(r,i)}}isEntryVisible(t){return!this.viewModel.isHidden(t)}updateEntryVisibility(t,e){e?this.viewModel.show(t):this.viewModel.hide(t)}focusNextEntry(){this.viewModel.focusNextEntry()}focusPreviousEntry(){this.viewModel.focusPreviousEntry()}isEntryFocused(){return this.viewModel.isEntryFocused()}focus(t=!0){this.getContainer()?.focus();const e=this.viewModel.lastFocusedEntry;t&&e&&setTimeout(()=>e.labelContainer.focus(),0)}createContentArea(t){this.element=t;const e=this._register(this.contextKeyService.createScoped(this.element));return Tt.bindTo(e).set(!0),this.leftItemsContainer=document.createElement("div"),this.leftItemsContainer.classList.add("left-items","items-container"),this.element.appendChild(this.leftItemsContainer),this.element.tabIndex=0,this.rightItemsContainer=document.createElement("div"),this.rightItemsContainer.classList.add("right-items","items-container"),this.element.appendChild(this.rightItemsContainer),this._register(C(t,_.CONTEXT_MENU,r=>this.showContextMenu(r))),this._register(z.addTarget(t)),this._register(C(t,q.Contextmenu,r=>this.showContextMenu(r))),this.createInitialStatusbarEntries(),this.element}createInitialStatusbarEntries(){for(this.appendStatusbarEntries();this.pendingEntries.length;){const t=this.pendingEntries.shift();t&&(t.accessor=this.addEntry(t.entry,t.id,t.alignment,t.priority.primary))}}appendStatusbarEntries(){const t=T(this.leftItemsContainer),e=T(this.rightItemsContainer);V(t),V(e);for(const r of[...this.viewModel.getEntries(p.LEFT),...this.viewModel.getEntries(p.RIGHT).reverse()])(r.alignment===p.LEFT?t:e).appendChild(r.container);this.updateCompactEntries()}appendStatusbarEntry(t){const e=this.viewModel.getEntries(t.alignment);t.alignment===p.RIGHT&&e.reverse();const r=T(t.alignment===p.LEFT?this.leftItemsContainer:this.rightItemsContainer),i=e.indexOf(t);i+1===e.length?r.appendChild(t.container):r.insertBefore(t.container,e[i+1].container),this.updateCompactEntries()}updateCompactEntries(){const t=this.viewModel.entries,e=new Map;for(const s of t)this.viewModel.isHidden(s.id)||e.set(s.id,s),s.container.classList.remove("compact-left","compact-right");const r=new Map;for(const s of e.values())if(J(s.priority.primary)&&s.priority.primary.compact){const a=s.priority.primary.id,d=e.get(a);if(!d)continue;let l=r.get(a);if(!l){for(const E of r.values())if(E.has(a)){l=E;break}l||(l=new Map,r.set(a,l))}l.set(s.id,s),l.set(d.id,d),s.priority.primary.alignment===p.LEFT?(d.container.classList.add("compact-left"),s.container.classList.add("compact-right")):(d.container.classList.add("compact-right"),s.container.classList.add("compact-left"))}const i=this.getColor(rt),n=this.getColor(at);if(this.compactEntriesDisposable.value=new I,i&&n&&!St(this.theme.type))for(const[,s]of r)for(const a of s.values())a.hasCommand&&(this.compactEntriesDisposable.value.add(C(a.labelContainer,_.MOUSE_OVER,()=>{s.forEach(d=>d.labelContainer.style.backgroundColor=i),a.labelContainer.style.backgroundColor=n})),this.compactEntriesDisposable.value.add(C(a.labelContainer,_.MOUSE_OUT,()=>{s.forEach(d=>d.labelContainer.style.backgroundColor="")})))}showContextMenu(t){ut.stop(t,!0);const e=new ht(pt(this.element),t);let r;this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>(r=this.getContextMenuActions(e),r),onHide:()=>{r&&K(r)}})}getContextMenuActions(t){const e=[];e.push(Q({id:H.ID,label:W("hideStatusBar","Hide Status Bar"),run:()=>this.instantiationService.invokeFunction(n=>new H().run(n))})),e.push(new L);const r=new Set;for(const n of this.viewModel.entries)r.has(n.id)||(e.push(new gt(n.id,n.name,this.viewModel)),r.add(n.id));let i;for(let n=t.target;n;n=n.parentElement){const s=this.viewModel.findEntry(n);if(s){i=s;break}}return i&&(e.push(new L),e.push(new ft(i.id,i.name,this.viewModel))),e}updateStyles(){super.updateStyles();const t=T(this.getContainer()),e=[...this.styleOverrides].sort((d,l)=>d.priority-l.priority)[0],r=this.getColor(e?.background??(this.contextService.getWorkbenchState()!==D.EMPTY?Z:et))||"";t.style.backgroundColor=r;const i=this.getColor(e?.foreground??(this.contextService.getWorkbenchState()!==D.EMPTY?tt:nt))||"";t.style.color=i;const n=this.getColor(ot),s=this.getColor(e?.border??(this.contextService.getWorkbenchState()!==D.EMPTY?it:st))||this.getColor(lt);s?(t.classList.add("status-border-top"),t.style.setProperty("--status-border-top-color",s)):(t.classList.remove("status-border-top"),t.style.removeProperty("--status-border-top-color"));const a=this.getColor(dt);this.styleElement||(this.styleElement=yt(t)),this.styleElement.textContent=`

				/* Status bar focus outline */
				.monaco-workbench .part.statusbar:focus {
					outline-color: ${a};
				}

				/* Status bar item focus outline */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item a:focus-visible {
					outline: 1px solid ${this.getColor(ct)??n};
					outline-offset: ${s?"-2px":"-1px"};
				}

				/* Notification Beak */
				.monaco-workbench .part.statusbar > .items-container > .statusbar-item.has-beak > .status-bar-item-beak-container:before {
					border-bottom-color: ${r};
				}
			`}layout(t,e,r,i){super.layout(t,e,r,i),super.layoutContents(t,e)}overrideStyle(t){return this.styleOverrides.add(t),this.updateStyles(),M(()=>{this.styleOverrides.delete(t),this.updateStyles()})}toJSON(){return{type:B.STATUSBAR_PART}}dispose(){this._onWillDispose.fire(),super.dispose()}};u=m([o(1,f),o(2,g),o(3,x),o(4,A),o(5,P),o(6,w),o(7,O)],u);let h=class extends u{constructor(c,t,e,r,i,n,s){super(B.STATUSBAR_PART,c,t,e,r,i,n,s)}};h=m([o(0,f),o(1,g),o(2,x),o(3,A),o(4,P),o(5,w),o(6,O)],h);let b=class extends u{constructor(t,e,r,i,n,s,a,d){const l=b.COUNTER++;super(`workbench.parts.auxiliaryStatus.${l}`,e,r,i,n,s,a,d);this.container=t}static COUNTER=1;height=u.HEIGHT};b=m([o(1,f),o(2,g),o(3,x),o(4,A),o(5,P),o(6,w),o(7,O)],b);let S=class extends Y{constructor(t,e,r){super("workbench.statusBarService",r,e);this.instantiationService=t;this._register(this.registerPart(this.mainPart))}mainPart=this._register(this.instantiationService.createInstance(h));_onDidCreateAuxiliaryStatusbarPart=this._register(new k);onDidCreateAuxiliaryStatusbarPart=this._onDidCreateAuxiliaryStatusbarPart.event;createAuxiliaryStatusbarPart(t){const e=document.createElement("footer");e.classList.add("part","statusbar"),e.setAttribute("role","status"),e.style.position="relative",e.setAttribute("aria-live","off"),e.setAttribute("tabindex","0"),t.appendChild(e);const r=this.instantiationService.createInstance(b,e),i=this.registerPart(r);return r.create(e),Mt.once(r.onWillDispose)(()=>i.dispose()),this._onDidCreateAuxiliaryStatusbarPart.fire(r),r}createScoped(t,e){return e.add(this.instantiationService.createInstance(v,t))}onDidChangeEntryVisibility=this.mainPart.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return t.showInAllWindows?this.doAddEntryToAllWindows(t,e,r,i):this.mainPart.addEntry(t,e,r,i)}doAddEntryToAllWindows(t,e,r,i=0){const n=new I,s=new Set;function a(d){const l=new I;l.add(d.onWillDispose(()=>l.dispose()));const E=l.add(d.addEntry(t,e,r,i));s.add(E),l.add(M(()=>s.delete(E))),n.add(l),l.add(M(()=>n.delete(l)))}for(const d of this.parts)a(d);return n.add(this.onDidCreateAuxiliaryStatusbarPart(d=>a(d))),{update:d=>{for(const l of s)l.update(d)},dispose:()=>n.dispose()}}isEntryVisible(t){return this.mainPart.isEntryVisible(t)}updateEntryVisibility(t,e){for(const r of this.parts)r.updateEntryVisibility(t,e)}focus(t){this.activePart.focus(t)}focusNextEntry(){this.activePart.focusNextEntry()}focusPreviousEntry(){this.activePart.focusPreviousEntry()}isEntryFocused(){return this.activePart.isEntryFocused()}overrideStyle(t){const e=new I;for(const r of this.parts)e.add(r.overrideStyle(t));return e}};S=m([o(0,f),o(1,A),o(2,g)],S);let v=class extends N{constructor(t,e){super();this.statusbarEntryContainer=t;this.statusbarService=e}createAuxiliaryStatusbarPart(t){return this.statusbarService.createAuxiliaryStatusbarPart(t)}createScoped(t,e){return this.statusbarService.createScoped(t,e)}getPart(){return this.statusbarEntryContainer}onDidChangeEntryVisibility=this.statusbarEntryContainer.onDidChangeEntryVisibility;addEntry(t,e,r,i=0){return this.statusbarEntryContainer.addEntry(t,e,r,i)}isEntryVisible(t){return this.statusbarEntryContainer.isEntryVisible(t)}updateEntryVisibility(t,e){this.statusbarEntryContainer.updateEntryVisibility(t,e)}focus(t){this.statusbarEntryContainer.focus(t)}focusNextEntry(){this.statusbarEntryContainer.focusNextEntry()}focusPreviousEntry(){this.statusbarEntryContainer.focusPreviousEntry()}isEntryFocused(){return this.statusbarEntryContainer.isEntryFocused()}overrideStyle(t){return this.statusbarEntryContainer.overrideStyle(t)}};v=m([o(1,R)],v),mt(R,S,bt.Eager);export{b as AuxiliaryStatusbarPart,h as MainStatusbarPart,v as ScopedStatusbarService,S as StatusbarService};
