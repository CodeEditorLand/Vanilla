var N=Object.defineProperty;var W=Object.getOwnPropertyDescriptor;var y=(d,s,e,t)=>{for(var o=t>1?void 0:t?W(s,e):s,i=d.length-1,r;i>=0;i--)(r=d[i])&&(o=(t?r(s,e,o):r(o))||o);return t&&o&&N(s,e,o),o},n=(d,s)=>(e,t)=>s(e,t,d);import"vs/css!./media/paneCompositePart";import{$ as B,addDisposableListener as l,Dimension as U,EventHelper as m,EventType as b,getWindow as h,prepend as G,trackFocus as X}from"../../../../vs/base/browser/dom.js";import{StandardMouseEvent as C}from"../../../../vs/base/browser/mouseEvent.js";import{Gesture as T,EventType as D}from"../../../../vs/base/browser/touch.js";import{ActionsOrientation as Y,prepareActions as E}from"../../../../vs/base/browser/ui/actionbar/actionbar.js";import"../../../../vs/base/browser/ui/grid/grid.js";import{SubmenuAction as z}from"../../../../vs/base/common/actions.js";import{Event as Z}from"../../../../vs/base/common/event.js";import{DisposableStore as S,MutableDisposable as $}from"../../../../vs/base/common/lifecycle.js";import{localize as v}from"../../../../vs/nls.js";import{createAndFillInActionBarActions as j}from"../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{HiddenItemStrategy as q,WorkbenchToolBar as J}from"../../../../vs/platform/actions/browser/toolbar.js";import{IMenuService as Q,MenuId as P}from"../../../../vs/platform/actions/common/actions.js";import{IContextKeyService as ee}from"../../../../vs/platform/contextkey/common/contextkey.js";import{IContextMenuService as te}from"../../../../vs/platform/contextview/browser/contextView.js";import{IHoverService as oe}from"../../../../vs/platform/hover/browser/hover.js";import{IInstantiationService as ie}from"../../../../vs/platform/instantiation/common/instantiation.js";import{IKeybindingService as re}from"../../../../vs/platform/keybinding/common/keybinding.js";import{INotificationService as ne}from"../../../../vs/platform/notification/common/notification.js";import"../../../../vs/platform/progress/common/progress.js";import{Registry as se}from"../../../../vs/platform/registry/common/platform.js";import{IStorageService as ae}from"../../../../vs/platform/storage/common/storage.js";import{IThemeService as pe}from"../../../../vs/platform/theme/common/themeService.js";import{CompositeMenuActions as me}from"../../../../vs/workbench/browser/actions.js";import"../../../../vs/workbench/browser/composite.js";import{CompositeDragAndDropObserver as M,toggleDropEffect as de}from"../../../../vs/workbench/browser/dnd.js";import{Extensions as f}from"../../../../vs/workbench/browser/panecomposite.js";import"../../../../vs/workbench/browser/part.js";import{CompositePart as ce}from"../../../../vs/workbench/browser/parts/compositePart.js";import{PaneCompositeBar as le}from"../../../../vs/workbench/browser/parts/paneCompositeBar.js";import{ViewsSubMenu as he}from"../../../../vs/workbench/browser/parts/views/viewPaneContainer.js";import"../../../../vs/workbench/common/composite.js";import"../../../../vs/workbench/common/panecomposite.js";import{EDITOR_DRAG_AND_DROP_BACKGROUND as Ce}from"../../../../vs/workbench/common/theme.js";import{IViewDescriptorService as ge,ViewContainerLocation as A}from"../../../../vs/workbench/common/views.js";import{IExtensionService as ue}from"../../../../vs/workbench/services/extensions/common/extensions.js";import{IWorkbenchLayoutService as ve,Parts as I}from"../../../../vs/workbench/services/layout/browser/layoutService.js";var Pe=(t=>(t[t.TOP=0]="TOP",t[t.TITLE=1]="TITLE",t[t.BOTTOM=2]="BOTTOM",t))(Pe||{});let p=class extends ce{constructor(e,t,o,i,r,a,w,L,x,O,H,_,R,V,F,k,K,fe,Ae,Ie){let c=A.Sidebar,g=f.Viewlets,u=P.SidebarTitle;e===I.PANEL_PART?(c=A.Panel,g=f.Panels,u=P.PanelTitle):e===I.AUXILIARYBAR_PART&&(c=A.AuxiliaryBar,g=f.Auxiliary,u=P.AuxiliaryBarTitle);super(x,O,H,_,R,V,F,k,se.as(g),o,K.getDefaultViewContainer(c)?.id||"",a,w,L,e,t);this.partId=e;this.activePaneContextKey=i;this.paneFocusContextKey=r;this.viewDescriptorService=K;this.contextKeyService=fe;this.extensionService=Ae;this.menuService=Ie;this.location=c,this.globalActions=this._register(this.instantiationService.createInstance(me,u,void 0,void 0)),this.registerListeners()}static MIN_COMPOSITE_BAR_WIDTH=50;get snap(){return this.layoutService.isVisible(this.partId)||!!this.paneCompositeBar.value?.getVisiblePaneCompositeIds().length}get onDidPaneCompositeOpen(){return Z.map(this.onDidCompositeOpen.event,e=>e.composite)}onDidPaneCompositeClose=this.onDidCompositeClose.event;location;titleContainer;headerFooterCompositeBarContainer;headerFooterCompositeBarDispoables=this._register(new S);paneCompositeBarContainer;paneCompositeBar=this._register(new $);compositeBarPosition=void 0;emptyPaneMessageElement;globalToolBar;globalActions;blockOpening=!1;contentDimension;registerListeners(){this._register(this.onDidPaneCompositeOpen(e=>this.onDidOpen(e))),this._register(this.onDidPaneCompositeClose(this.onDidClose,this)),this._register(this.globalActions.onDidChange(()=>this.updateGlobalToolbarActions())),this._register(this.registry.onDidDeregister(e=>{const t=this.viewDescriptorService.getViewContainersByLocation(this.location).filter(o=>this.viewDescriptorService.getViewContainerModel(o).activeViewDescriptors.length>0);if(t.length){if(this.getActiveComposite()?.getId()===e.id){const o=this.viewDescriptorService.getDefaultViewContainer(this.location)?.id,i=t.filter(r=>r.id===o)[0]||t[0];this.doOpenPaneComposite(i.id)}}else this.layoutService.setPartHidden(!0,this.partId);this.removeComposite(e.id)})),this._register(this.extensionService.onDidRegisterExtensions(()=>{this.layoutCompositeBar()}))}onDidOpen(e){this.activePaneContextKey.set(e.getId())}onDidClose(e){const t=e.getId();this.activePaneContextKey.get()===t&&this.activePaneContextKey.reset()}showComposite(e){super.showComposite(e),this.layoutCompositeBar(),this.layoutEmptyMessage()}hideActiveComposite(){const e=super.hideActiveComposite();return this.layoutCompositeBar(),this.layoutEmptyMessage(),e}create(e){this.element=e,this.element.classList.add("pane-composite-part"),super.create(e);const t=this.getContentArea();t&&this.createEmptyPaneMessage(t),this.updateCompositeBar();const o=this._register(X(e));this._register(o.onDidFocus(()=>this.paneFocusContextKey.set(!0))),this._register(o.onDidBlur(()=>this.paneFocusContextKey.set(!1)))}createEmptyPaneMessage(e){this.emptyPaneMessageElement=document.createElement("div"),this.emptyPaneMessageElement.classList.add("empty-pane-message-area");const t=document.createElement("div");t.classList.add("empty-pane-message"),t.innerText=v("pane.emptyMessage","Drag a view here to display."),this.emptyPaneMessageElement.appendChild(t),e.appendChild(this.emptyPaneMessageElement),this._register(M.INSTANCE.registerTarget(this.emptyPaneMessageElement,{onDragOver:o=>{if(m.stop(o.eventData,!0),this.paneCompositeBar.value){const i=this.paneCompositeBar.value.dndHandler.onDragEnter(o.dragAndDropData,void 0,o.eventData);de(o.eventData.dataTransfer,"move",i)}},onDragEnter:o=>{if(m.stop(o.eventData,!0),this.paneCompositeBar.value){const i=this.paneCompositeBar.value.dndHandler.onDragEnter(o.dragAndDropData,void 0,o.eventData);this.emptyPaneMessageElement.style.backgroundColor=i&&this.theme.getColor(Ce)?.toString()||""}},onDragLeave:o=>{m.stop(o.eventData,!0),this.emptyPaneMessageElement.style.backgroundColor=""},onDragEnd:o=>{m.stop(o.eventData,!0),this.emptyPaneMessageElement.style.backgroundColor=""},onDrop:o=>{m.stop(o.eventData,!0),this.emptyPaneMessageElement.style.backgroundColor="",this.paneCompositeBar.value&&this.paneCompositeBar.value.dndHandler.drop(o.dragAndDropData,void 0,o.eventData)}}))}createTitleArea(e){const t=super.createTitleArea(e);this._register(l(t,b.CONTEXT_MENU,i=>{this.onTitleAreaContextMenu(new C(h(t),i))})),this._register(T.addTarget(t)),this._register(l(t,D.Contextmenu,i=>{this.onTitleAreaContextMenu(new C(h(t),i))}));const o=t.appendChild(B(".global-actions"));return this.globalToolBar=this._register(this.instantiationService.createInstance(J,o,{actionViewItemProvider:(i,r)=>this.actionViewItemProvider(i,r),orientation:Y.HORIZONTAL,getKeyBinding:i=>this.keybindingService.lookupKeybinding(i.id),anchorAlignmentProvider:()=>this.getTitleAreaDropDownAnchorAlignment(),toggleMenuTitle:v("moreActions","More Actions..."),hoverDelegate:this.toolbarHoverDelegate,hiddenItemStrategy:q.NoHide})),this.updateGlobalToolbarActions(),t}createTitleLabel(e){this.titleContainer=e;const t=super.createTitleLabel(e);this.titleLabelElement.draggable=!0;const o=()=>({type:"composite",id:this.getActivePaneComposite().getId()});return this._register(M.INSTANCE.registerDraggable(this.titleLabelElement,o,{})),t}updateCompositeBar(){const e=this.compositeBarPosition!==void 0,t=this.shouldShowCompositeBar(),o=this.compositeBarPosition,i=t?this.getCompositeBarPosition():void 0;if(o===i)return;if(e){const a=o===1?this.titleContainer:this.headerFooterCompositeBarContainer;if(!this.paneCompositeBarContainer||!this.paneCompositeBar.value||!a)throw new Error("Composite bar containers should exist when removing the previous composite bar");this.paneCompositeBarContainer.remove(),this.paneCompositeBarContainer=void 0,this.paneCompositeBar.value=void 0,a.classList.remove("has-composite-bar"),o===0?this.removeFooterHeaderArea(!0):o===2&&this.removeFooterHeaderArea(!1)}let r;switch(i){case 0:r=this.createHeaderArea();break;case 1:r=this.titleContainer;break;case 2:r=this.createFooterArea();break}if(t){if(this.paneCompositeBarContainer||this.paneCompositeBar.value||!r)throw new Error("Invalid composite bar state when creating the new composite bar");r.classList.add("has-composite-bar"),this.paneCompositeBarContainer=G(r,B(".composite-bar-container")),this.paneCompositeBar.value=this.createCompositeBar(),this.paneCompositeBar.value.create(this.paneCompositeBarContainer),i===0?this.setHeaderArea(r):i===2&&this.setFooterArea(r)}this.compositeBarPosition=i}createHeaderArea(){const e=super.createHeaderArea();return this.createHeaderFooterCompositeBarArea(e)}createFooterArea(){const e=super.createFooterArea();return this.createHeaderFooterCompositeBarArea(e)}createHeaderFooterCompositeBarArea(e){if(this.headerFooterCompositeBarContainer)throw new Error("Header or Footer composite bar already exists");return this.headerFooterCompositeBarContainer=e,this.headerFooterCompositeBarDispoables.add(l(e,b.CONTEXT_MENU,t=>{this.onCompositeBarAreaContextMenu(new C(h(e),t))})),this.headerFooterCompositeBarDispoables.add(T.addTarget(e)),this.headerFooterCompositeBarDispoables.add(l(e,D.Contextmenu,t=>{this.onCompositeBarAreaContextMenu(new C(h(e),t))})),e}removeFooterHeaderArea(e){this.headerFooterCompositeBarContainer=void 0,this.headerFooterCompositeBarDispoables.clear(),e?this.removeHeaderArea():this.removeFooterArea()}createCompositeBar(){return this.instantiationService.createInstance(le,this.getCompositeBarOptions(),this.partId,this)}onTitleAreaUpdate(e){super.onTitleAreaUpdate(e),this.layoutCompositeBar()}async openPaneComposite(e,t){if(typeof e=="string"&&this.getPaneComposite(e))return this.doOpenPaneComposite(e,t);if(await this.extensionService.whenInstalledExtensionsRegistered(),typeof e=="string"&&this.getPaneComposite(e))return this.doOpenPaneComposite(e,t)}doOpenPaneComposite(e,t){if(!this.blockOpening){if(!this.layoutService.isVisible(this.partId))try{this.blockOpening=!0,this.layoutService.setPartHidden(!1,this.partId)}finally{this.blockOpening=!1}return this.openComposite(e,t)}}getPaneComposite(e){return this.registry.getPaneComposite(e)}getPaneComposites(){return this.registry.getPaneComposites().sort((e,t)=>typeof e.order!="number"?1:typeof t.order!="number"?-1:e.order-t.order)}getPinnedPaneCompositeIds(){return this.paneCompositeBar.value?.getPinnedPaneCompositeIds()??[]}getVisiblePaneCompositeIds(){return this.paneCompositeBar.value?.getVisiblePaneCompositeIds()??[]}getActivePaneComposite(){return this.getActiveComposite()}getLastActivePaneCompositeId(){return this.getLastActiveCompositeId()}hideActivePaneComposite(){this.layoutService.isVisible(this.partId)&&this.layoutService.setPartHidden(!0,this.partId),this.hideActiveComposite()}focusCompositeBar(){this.paneCompositeBar.value?.focus()}layout(e,t,o,i){this.layoutService.isVisible(this.partId)&&(this.contentDimension=new U(e,t),super.layout(this.contentDimension.width,this.contentDimension.height,o,i),this.layoutCompositeBar(),this.layoutEmptyMessage())}layoutCompositeBar(){if(this.contentDimension&&this.dimension&&this.paneCompositeBar.value){const e=this.compositeBarPosition===1?16:8,t=this.partId===I.PANEL_PART?0:1;let o=this.contentDimension.width-e-t;o=Math.max(p.MIN_COMPOSITE_BAR_WIDTH,o-this.getToolbarWidth()),this.paneCompositeBar.value.layout(o,this.dimension.height)}}layoutEmptyMessage(){const e=!this.getActiveComposite();this.emptyPaneMessageElement?.classList.toggle("visible",e),e&&this.titleLabel?.updateTitle("","")}updateGlobalToolbarActions(){const e=this.globalActions.getPrimaryActions(),t=this.globalActions.getSecondaryActions();this.globalToolBar?.setActions(E(e),E(t))}getToolbarWidth(){if(!this.toolBar||this.compositeBarPosition!==1||!this.getActivePaneComposite())return 0;const t=this.toolBar.getItemsWidth()+this.toolBar.getItemsLength()*4,o=this.globalToolBar?this.globalToolBar.getItemsWidth()+this.globalToolBar.getItemsLength()*4:0;return t+o+5}onTitleAreaContextMenu(e){if(this.shouldShowCompositeBar()&&this.getCompositeBarPosition()===1)return this.onCompositeBarContextMenu(e);{const t=this.getActivePaneComposite(),o=t?t.getContextMenuActions():[];o.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>o,getActionViewItem:(i,r)=>this.actionViewItemProvider(i,r),actionRunner:t.getActionRunner(),skipTelemetry:!0})}}onCompositeBarAreaContextMenu(e){return this.onCompositeBarContextMenu(e)}onCompositeBarContextMenu(e){if(this.paneCompositeBar.value){const t=[...this.paneCompositeBar.value.getContextMenuActions()];t.length&&this.contextMenuService.showContextMenu({getAnchor:()=>e,getActions:()=>t,skipTelemetry:!0})}}getViewsSubmenuAction(){const e=this.getActivePaneComposite()?.getViewPaneContainer();if(e){const t=new S,o=[],i=t.add(this.contextKeyService.createScoped(this.element));i.createKey("viewContainer",e.viewContainer.id);const r=this.menuService.getMenuActions(he,i,{shouldForwardArgs:!0,renderShortTitle:!0});return j(r,{primary:o,secondary:[]},()=>!0),t.dispose(),o.length>1&&o.some(a=>a.enabled)?new z("views",v("views","Views"),o):void 0}}};p=y([n(8,ne),n(9,ae),n(10,te),n(11,ve),n(12,re),n(13,oe),n(14,ie),n(15,pe),n(16,ge),n(17,ee),n(18,ue),n(19,Q)],p);export{p as AbstractPaneCompositePart,Pe as CompositeBarPosition};
