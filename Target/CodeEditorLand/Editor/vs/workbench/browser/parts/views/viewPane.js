var ee=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var b=(d,i,e,t)=>{for(var n=t>1?void 0:t?te(i,e):i,r=d.length-1,o;r>=0;r--)(o=d[r])&&(n=(t?o(i,e,n):o(n))||n);return t&&n&&ee(i,e,n),n},s=(d,i)=>(e,t)=>i(e,t,d);import"./media/paneviewlet.css";import{$ as l,addDisposableListener as ie,after as ne,append as c,asCSSUrl as E,asCssValueWithDefault as oe,createCSSRule as re,Dimension as se,EventType as ae,reset as ce,trackFocus as le}from"../../../../base/browser/dom.js";import{ActionsOrientation as de,prepareActions as H}from"../../../../base/browser/ui/actionbar/actionbar.js";import{BaseActionViewItem as he}from"../../../../base/browser/ui/actionbar/actionViewItems.js";import{Button as pe}from"../../../../base/browser/ui/button/button.js";import"../../../../base/browser/ui/dropdown/dropdownActionViewItem.js";import{getDefaultHoverDelegate as _}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import"../../../../base/browser/ui/list/listWidget.js";import{ProgressBar as ve}from"../../../../base/browser/ui/progressbar/progressbar.js";import{Orientation as W}from"../../../../base/browser/ui/sash/sash.js";import{DomScrollableElement as me}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{Pane as ue}from"../../../../base/browser/ui/splitview/paneview.js";import{Action as ge}from"../../../../base/common/actions.js";import{Codicon as k}from"../../../../base/common/codicons.js";import{Emitter as w,Event as f}from"../../../../base/common/event.js";import{DisposableStore as T,toDisposable as fe}from"../../../../base/common/lifecycle.js";import{parseLinkedText as we}from"../../../../base/common/linkedText.js";import{ScrollbarVisibility as O}from"../../../../base/common/scrollable.js";import{ThemeIcon as C}from"../../../../base/common/themables.js";import{assertIsDefined as Ce}from"../../../../base/common/types.js";import{URI as R}from"../../../../base/common/uri.js";import*as D from"../../../../nls.js";import{createActionViewItem as Ie}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{WorkbenchToolBar as Se}from"../../../../platform/actions/browser/toolbar.js";import{Action2 as ye,MenuId as M,SubmenuItemAction as be}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as K}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as I}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as P}from"../../../../platform/contextview/browser/contextView.js";import{IHoverService as F}from"../../../../platform/hover/browser/hover.js";import{IInstantiationService as x}from"../../../../platform/instantiation/common/instantiation.js";import{ServiceCollection as N}from"../../../../platform/instantiation/common/serviceCollection.js";import{IKeybindingService as U}from"../../../../platform/keybinding/common/keybinding.js";import{Link as De}from"../../../../platform/opener/browser/link.js";import{IOpenerService as L}from"../../../../platform/opener/common/opener.js";import"../../../../platform/progress/common/progress.js";import{Registry as Ae}from"../../../../platform/registry/common/platform.js";import{ITelemetryService as B}from"../../../../platform/telemetry/common/telemetry.js";import{defaultButtonStyles as Ve,defaultProgressBarStyles as _e}from"../../../../platform/theme/browser/defaultStyles.js";import{asCssVariable as Te,foreground as xe}from"../../../../platform/theme/common/colorRegistry.js";import{registerIcon as $}from"../../../../platform/theme/common/iconRegistry.js";import{IThemeService as z}from"../../../../platform/theme/common/themeService.js";import{PANEL_BACKGROUND as Le,PANEL_STICKY_SCROLL_BACKGROUND as Be,PANEL_STICKY_SCROLL_BORDER as Ee,PANEL_STICKY_SCROLL_SHADOW as He,SIDE_BAR_BACKGROUND as We,SIDE_BAR_STICKY_SCROLL_BACKGROUND as ke,SIDE_BAR_STICKY_SCROLL_BORDER as Oe,SIDE_BAR_STICKY_SCROLL_SHADOW as Re}from"../../../common/theme.js";import{defaultViewIcon as Me,IViewDescriptorService as Y,Extensions as Ke,ViewContainerLocation as A,ViewContainerLocationToString as G}from"../../../common/views.js";import"../../../services/accessibility/common/accessibleViewInformationService.js";import{ILifecycleService as Pe}from"../../../services/lifecycle/common/lifecycle.js";import{AbstractProgressScope as Fe,ScopedProgressIndicator as Ne}from"../../../services/progress/browser/progressIndicator.js";import{IViewsService as Ue}from"../../../services/views/common/viewsService.js";import{CompositeMenuActions as $e}from"../../actions.js";import{FilterWidget as ze}from"./viewFilter.js";var Ye=(t=>(t[t.Default=0]="Default",t[t.WhenExpanded=1]="WhenExpanded",t[t.Always=2]="Always",t))(Ye||{});const j=new ge("viewpane.action.filter"),Ge=$("view-pane-container-expanded",k.chevronDown,D.localize("viewPaneContainerExpandedIcon","Icon for an expanded view pane container.")),je=$("view-pane-container-collapsed",k.chevronRight,D.localize("viewPaneContainerCollapsedIcon","Icon for a collapsed view pane container.")),Z=Ae.as(Ke.ViewsRegistry);let S=class{constructor(i,e,t,n,r,o,a){this.container=i;this.delegate=e;this.instantiationService=t;this.openerService=n;this.telemetryService=r;this.contextKeyService=o;this.disposables.add(f.runAndSubscribe(this.delegate.onDidChangeViewWelcomeState,()=>this.onDidChangeViewWelcomeState())),this.disposables.add(a.onWillShutdown(()=>this.dispose()))}defaultItem;items=[];get enabled(){return this._enabled}_enabled=!1;element;scrollableElement;disposables=new T;enabledDisposables=this.disposables.add(new T);renderDisposables=this.disposables.add(new T);layout(i,e){this._enabled&&(this.element.style.height=`${i}px`,this.element.style.width=`${e}px`,this.element.classList.toggle("wide",e>640),this.scrollableElement.scanDomNode())}focus(){this._enabled&&this.element.focus()}onDidChangeViewWelcomeState(){const i=this.delegate.shouldShowWelcome();if(this._enabled===i)return;if(this._enabled=i,!i){this.enabledDisposables.clear();return}this.container.classList.add("welcome");const e=c(this.container,l(".welcome-view"));this.element=l(".welcome-view-content",{tabIndex:0}),this.scrollableElement=new me(this.element,{alwaysConsumeMouseWheel:!0,horizontal:O.Hidden,vertical:O.Visible}),c(e,this.scrollableElement.getDomNode()),this.enabledDisposables.add(fe(()=>{this.container.classList.remove("welcome"),this.scrollableElement.dispose(),e.remove(),this.scrollableElement=void 0,this.element=void 0})),this.contextKeyService.onDidChangeContext(this.onDidChangeContext,this,this.enabledDisposables),f.chain(Z.onDidChangeViewWelcomeContent,t=>t.filter(n=>n===this.delegate.id))(this.onDidChangeViewWelcomeContent,this,this.enabledDisposables),this.onDidChangeViewWelcomeContent()}onDidChangeViewWelcomeContent(){const i=Z.getViewWelcomeContent(this.delegate.id);this.items=[];for(const e of i)if(e.when==="default")this.defaultItem={descriptor:e,visible:!0};else{const t=e.when?this.contextKeyService.contextMatchesRules(e.when):!0;this.items.push({descriptor:e,visible:t})}this.render()}onDidChangeContext(){let i=!1;for(const e of this.items){if(!e.descriptor.when||e.descriptor.when==="default")continue;const t=this.contextKeyService.contextMatchesRules(e.descriptor.when);e.visible!==t&&(e.visible=t,i=!0)}i&&this.render()}render(){this.renderDisposables.clear(),this.element.innerText="";const i=this.getContentDescriptors();if(i.length===0){this.container.classList.remove("welcome"),this.scrollableElement.scanDomNode();return}for(const{content:e,precondition:t}of i){const n=e.split(`
`);for(let r of n){if(r=r.trim(),!r)continue;const o=we(r);if(o.nodes.length===1&&typeof o.nodes[0]!="string"){const a=o.nodes[0],h=c(this.element,l(".button-container")),p=new pe(h,{title:a.title,supportIcons:!0,...Ve});if(p.label=a.label,p.onDidClick(v=>{this.telemetryService.publicLog2("views.welcomeAction",{viewId:this.delegate.id,uri:a.href}),this.openerService.open(a.href,{allowCommands:!0})},null,this.renderDisposables),this.renderDisposables.add(p),t){const v=()=>p.enabled=this.contextKeyService.contextMatchesRules(t);v();const u=new Set(t.keys());f.filter(this.contextKeyService.onDidChangeContext,g=>g.affectsSome(u))(v,null,this.renderDisposables)}}else{const a=c(this.element,l("p"));for(const h of o.nodes)if(typeof h=="string")c(a,document.createTextNode(h));else{const p=this.renderDisposables.add(this.instantiationService.createInstance(De,a,h,{}));if(t&&h.href.startsWith("command:")){const v=()=>p.enabled=this.contextKeyService.contextMatchesRules(t);v();const u=new Set(t.keys());f.filter(this.contextKeyService.onDidChangeContext,g=>g.affectsSome(u))(v,null,this.renderDisposables)}}}}}this.container.classList.add("welcome"),this.scrollableElement.scanDomNode()}getContentDescriptors(){const i=this.items.filter(e=>e.visible);return i.length===0&&this.defaultItem?[this.defaultItem.descriptor]:i.map(e=>e.descriptor)}dispose(){this.disposables.dispose()}};S=b([s(2,x),s(3,L),s(4,B),s(5,I),s(6,Pe)],S);let m=class extends ue{constructor(e,t,n,r,o,a,h,p,v,u,y,g){super({...e,orientation:a.getViewLocationById(e.id)===A.Panel?W.HORIZONTAL:W.VERTICAL});this.keybindingService=t;this.contextMenuService=n;this.configurationService=r;this.contextKeyService=o;this.viewDescriptorService=a;this.instantiationService=h;this.openerService=p;this.themeService=v;this.telemetryService=u;this.hoverService=y;this.accessibleViewInformationService=g;this.id=e.id,this._title=e.title,this._titleDescription=e.titleDescription,this._singleViewPaneContainerTitle=e.singleViewPaneContainerTitle,this.showActions=e.showActions??0,this.scopedContextKeyService=this._register(o.createScoped(this.element)),this.scopedContextKeyService.createKey("view",this.id);const q=this.scopedContextKeyService.createKey("viewLocation",G(a.getViewLocationById(this.id)));this._register(f.filter(a.onDidChangeLocation,Q=>Q.views.some(X=>X.id===this.id))(()=>q.set(G(a.getViewLocationById(this.id)))));const J=this._register(this.instantiationService.createChild(new N([I,this.scopedContextKeyService])));this.menuActions=this._register(J.createInstance($e,e.titleMenuId??M.ViewTitle,M.ViewTitleContext,{shouldForwardArgs:!e.donotForwardArgs,renderShortTitle:!0})),this._register(this.menuActions.onDidChange(()=>this.updateActions()))}static AlwaysShowActionsConfig="workbench.view.alwaysShowHeaderActions";_onDidFocus=this._register(new w);onDidFocus=this._onDidFocus.event;_onDidBlur=this._register(new w);onDidBlur=this._onDidBlur.event;_onDidChangeBodyVisibility=this._register(new w);onDidChangeBodyVisibility=this._onDidChangeBodyVisibility.event;_onDidChangeTitleArea=this._register(new w);onDidChangeTitleArea=this._onDidChangeTitleArea.event;_onDidChangeViewWelcomeState=this._register(new w);onDidChangeViewWelcomeState=this._onDidChangeViewWelcomeState.event;_isVisible=!1;id;_title;get title(){return this._title}_titleDescription;get titleDescription(){return this._titleDescription}_singleViewPaneContainerTitle;get singleViewPaneContainerTitle(){return this._singleViewPaneContainerTitle}menuActions;progressBar;progressIndicator;toolbar;showActions;headerContainer;titleContainer;titleContainerHover;titleDescriptionContainer;titleDescriptionContainerHover;iconContainer;iconContainerHover;twistiesContainer;viewWelcomeController;scopedContextKeyService;get headerVisible(){return super.headerVisible}set headerVisible(e){super.headerVisible=e,this.element.classList.toggle("merged-header",!e)}setVisible(e){this._isVisible!==e&&(this._isVisible=e,this.isExpanded()&&this._onDidChangeBodyVisibility.fire(e))}isVisible(){return this._isVisible}isBodyVisible(){return this._isVisible&&this.isExpanded()}setExpanded(e){const t=super.setExpanded(e);return t&&this._onDidChangeBodyVisibility.fire(e),this.updateTwistyIcon(),t}render(){super.render();const e=le(this.element);this._register(e),this._register(e.onDidFocus(()=>this._onDidFocus.fire())),this._register(e.onDidBlur(()=>this._onDidBlur.fire()))}renderHeader(e){this.headerContainer=e,this.twistiesContainer=c(e,l(`.twisty-container${C.asCSSSelector(this.getTwistyIcon(this.isExpanded()))}`)),this.renderHeaderTitle(e,this.title);const t=c(e,l(".actions"));t.classList.toggle("show-always",this.showActions===2),t.classList.toggle("show-expanded",this.showActions===1),this.toolbar=this.instantiationService.createInstance(Se,t,{orientation:de.HORIZONTAL,actionViewItemProvider:(o,a)=>this.getActionViewItem(o,a),ariaLabel:D.localize("viewToolbarAriaLabel","{0} actions",this.title),getKeyBinding:o=>this.keybindingService.lookupKeybinding(o.id),renderDropdownAsChildElement:!0,actionRunner:this.getActionRunner(),resetMenu:this.menuActions.menuId}),this._register(this.toolbar),this.setActions(),this._register(ie(t,ae.CLICK,o=>o.preventDefault()));const n=this.viewDescriptorService.getViewContainerByViewId(this.id);n?this._register(this.viewDescriptorService.getViewContainerModel(n).onDidChangeContainerInfo(({title:o})=>this.updateTitle(this.title))):console.error(`View container model not found for view ${this.id}`);const r=f.filter(this.configurationService.onDidChangeConfiguration,o=>o.affectsConfiguration(m.AlwaysShowActionsConfig));this._register(r(this.updateActionsVisibility,this)),this.updateActionsVisibility()}updateHeader(){super.updateHeader(),this.updateTwistyIcon()}updateTwistyIcon(){this.twistiesContainer&&(this.twistiesContainer.classList.remove(...C.asClassNameArray(this.getTwistyIcon(!this._expanded))),this.twistiesContainer.classList.add(...C.asClassNameArray(this.getTwistyIcon(this._expanded))))}getTwistyIcon(e){return e?Ge:je}style(e){super.style(e);const t=this.getIcon();if(this.iconContainer){const n=oe(e.headerForeground,Te(xe));R.isUri(t)?(this.iconContainer.style.backgroundColor=n,this.iconContainer.style.color=""):(this.iconContainer.style.color=n,this.iconContainer.style.backgroundColor="")}}getIcon(){return this.viewDescriptorService.getViewDescriptorById(this.id)?.containerIcon||Me}renderHeaderTitle(e,t){this.iconContainer=c(e,l(".icon",void 0));const n=this.getIcon();let r;if(R.isUri(n)){r=`view-${this.id.replace(/[\.\:]/g,"-")}`;const a=`.pane-header .icon.${r}`;re(a,`
				mask: ${E(n)} no-repeat 50% 50%;
				mask-size: 24px;
				-webkit-mask: ${E(n)} no-repeat 50% 50%;
				-webkit-mask-size: 16px;
			`)}else C.isThemeIcon(n)&&(r=C.asClassName(n));r&&this.iconContainer.classList.add(...r.split(" "));const o=this.calculateTitle(t);this.titleContainer=c(e,l("h3.title",{},o)),this.titleContainerHover=this._register(this.hoverService.setupManagedHover(_("mouse"),this.titleContainer,o)),this._titleDescription&&this.setTitleDescription(this._titleDescription),this.iconContainerHover=this._register(this.hoverService.setupManagedHover(_("mouse"),this.iconContainer,o)),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(o))}_getAriaLabel(e){const t=this.viewDescriptorService.getViewDescriptorById(this.id)?.accessibilityHelpContent,n=this.accessibleViewInformationService?.hasShownAccessibleView(this.id);return!t||n?e:D.localize("viewAccessibilityHelp","Use Alt+F1 for accessibility help {0}",e)}updateTitle(e){const t=this.calculateTitle(e);this.titleContainer&&(this.titleContainer.textContent=t,this.titleContainerHover?.update(t)),this.iconContainer&&(this.iconContainerHover?.update(t),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(t))),this._title=e,this._onDidChangeTitleArea.fire()}setTitleDescription(e){this.titleDescriptionContainer?(this.titleDescriptionContainer.textContent=e??"",this.titleDescriptionContainerHover?.update(e??"")):e&&this.titleContainer&&(this.titleDescriptionContainer=ne(this.titleContainer,l("span.description",{},e)),this.titleDescriptionContainerHover=this._register(this.hoverService.setupManagedHover(_("mouse"),this.titleDescriptionContainer,e)))}updateTitleDescription(e){this.setTitleDescription(e),this._titleDescription=e,this._onDidChangeTitleArea.fire()}calculateTitle(e){const t=this.viewDescriptorService.getViewContainerByViewId(this.id),n=this.viewDescriptorService.getViewContainerModel(t),r=this.viewDescriptorService.getViewDescriptorById(this.id);return!(this.viewDescriptorService.getDefaultContainerById(this.id)===t)&&r?.containerTitle&&n.title!==r.containerTitle?`${r.containerTitle}: ${e}`:e}renderBody(e){this.viewWelcomeController=this._register(this.instantiationService.createInstance(S,e,this))}layoutBody(e,t){this.viewWelcomeController.layout(e,t)}onDidScrollRoot(){}getProgressIndicator(){if(this.progressBar===void 0&&(this.progressBar=this._register(new ve(this.element,_e)),this.progressBar.hide()),this.progressIndicator===void 0){const e=this;this.progressIndicator=this._register(new Ne(Ce(this.progressBar),new class extends Fe{constructor(){super(e.id,e.isBodyVisible()),this._register(e.onDidChangeBodyVisibility(t=>t?this.onScopeOpened(e.id):this.onScopeClosed(e.id)))}}))}return this.progressIndicator}getProgressLocation(){return this.viewDescriptorService.getViewContainerByViewId(this.id).id}getLocationBasedColors(){return Ze(this.viewDescriptorService.getViewLocationById(this.id))}focus(){this.viewWelcomeController.enabled?this.viewWelcomeController.focus():this.element&&(this.element.focus(),this._onDidFocus.fire())}setActions(){if(this.toolbar){const e=[...this.menuActions.getPrimaryActions()];this.shouldShowFilterInHeader()&&e.unshift(j),this.toolbar.setActions(H(e),H(this.menuActions.getSecondaryActions())),this.toolbar.context=this.getActionsContext()}}updateActionsVisibility(){if(!this.headerContainer)return;const e=this.configurationService.getValue("workbench.view.alwaysShowHeaderActions");this.headerContainer.classList.toggle("actions-always-visible",e)}updateActions(){this.setActions(),this._onDidChangeTitleArea.fire()}getActionViewItem(e,t){if(e.id===j.id){const n=this;return new class extends he{constructor(){super(null,e)}setFocusable(){}get trapsArrowNavigation(){return!0}render(r){r.classList.add("viewpane-filter-container");const o=n.getFilterWidget();c(r,o.element),o.relayout()}}}return Ie(this.instantiationService,e,{...t,menuAsChild:e instanceof be})}getActionsContext(){}getActionRunner(){}getOptimalWidth(){return 0}saveState(){}shouldShowWelcome(){return!1}getFilterWidget(){}shouldShowFilterInHeader(){return!1}};m=b([s(1,U),s(2,P),s(3,K),s(4,I),s(5,Y),s(6,x),s(7,L),s(8,z),s(9,B),s(10,F)],m);let V=class extends m{filterWidget;dimension;filterContainer;constructor(i,e,t,n,r,o,a,h,p,v,u,y){super(i,e,t,n,r,o,a,h,p,v,u,y);const g=this._register(a.createChild(new N([I,this.scopedContextKeyService])));this.filterWidget=this._register(g.createInstance(ze,i.filterOptions))}getFilterWidget(){return this.filterWidget}renderBody(i){super.renderBody(i),this.filterContainer=c(i,l(".viewpane-filter-container"))}layoutBody(i,e){super.layoutBody(i,e),this.dimension=new se(e,i);const t=!this.filterContainer?.hasChildNodes(),n=this.shouldShowFilterInHeader();t!==n&&(n&&ce(this.filterContainer),this.updateActions(),n||c(this.filterContainer,this.filterWidget.element)),n||(i=i-44),this.filterWidget.layout(e),this.layoutBodyContent(i,e)}shouldShowFilterInHeader(){return!(this.dimension&&this.dimension.width<600&&this.dimension.height>100)}};V=b([s(1,U),s(2,P),s(3,K),s(4,I),s(5,Y),s(6,x),s(7,L),s(8,z),s(9,B),s(10,F)],V);function Ze(d){let i,e,t,n;switch(d){case A.Panel:i=Le,e=Be,t=Ee,n=He;break;case A.Sidebar:case A.AuxiliaryBar:default:i=We,e=ke,t=Oe,n=Re}return{background:i,listOverrideStyles:{listBackground:i,treeStickyScrollBackground:e,treeStickyScrollBorder:t,treeStickyScrollShadow:n}}}class ai extends ye{desc;constructor(i){super(i),this.desc=i}run(i,...e){const t=i.get(Ue).getActiveViewWithId(this.desc.viewId);if(t)return this.runInView(i,t,...e)}}export{V as FilterViewPane,j as VIEWPANE_FILTER_ACTION,ai as ViewAction,m as ViewPane,Ye as ViewPaneShowActions,Ze as getLocationBasedViewColors};
