var ee=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var b=(d,i,e,t)=>{for(var n=t>1?void 0:t?te(i,e):i,o=d.length-1,r;o>=0;o--)(r=d[o])&&(n=(t?r(i,e,n):r(n))||n);return t&&n&&ee(i,e,n),n},s=(d,i)=>(e,t)=>i(e,t,d);import"./media/paneviewlet.css";import*as D from"../../../../nls.js";import{Event as f,Emitter as w}from"../../../../base/common/event.js";import{asCssVariable as ie,foreground as ne}from"../../../../platform/theme/common/colorRegistry.js";import{after as oe,append as c,$ as l,trackFocus as re,EventType as se,addDisposableListener as ae,createCSSRule as ce,asCSSUrl as E,Dimension as le,reset as de,asCssValueWithDefault as he}from"../../../../base/browser/dom.js";import{DisposableStore as V,toDisposable as pe}from"../../../../base/common/lifecycle.js";import{Action as ve}from"../../../../base/common/actions.js";import{ActionsOrientation as me,prepareActions as H}from"../../../../base/browser/ui/actionbar/actionbar.js";import{Registry as ue}from"../../../../platform/registry/common/platform.js";import{IKeybindingService as R}from"../../../../platform/keybinding/common/keybinding.js";import{IContextMenuService as k}from"../../../../platform/contextview/browser/contextView.js";import{ITelemetryService as T}from"../../../../platform/telemetry/common/telemetry.js";import{IThemeService as O}from"../../../../platform/theme/common/themeService.js";import{ThemeIcon as C}from"../../../../base/common/themables.js";import{Pane as ge}from"../../../../base/browser/ui/splitview/paneview.js";import{IConfigurationService as W}from"../../../../platform/configuration/common/configuration.js";import{Extensions as fe,IViewDescriptorService as M,ViewContainerLocation as A,defaultViewIcon as we,ViewContainerLocationToString as K}from"../../../common/views.js";import{IViewsService as Ce}from"../../../services/views/common/viewsService.js";import{IContextKeyService as I}from"../../../../platform/contextkey/common/contextkey.js";import{assertIsDefined as Ie}from"../../../../base/common/types.js";import{IInstantiationService as x}from"../../../../platform/instantiation/common/instantiation.js";import{MenuId as P,Action2 as Se,SubmenuItemAction as ye}from"../../../../platform/actions/common/actions.js";import{createActionViewItem as be}from"../../../../platform/actions/browser/menuEntryActionViewItem.js";import{parseLinkedText as De}from"../../../../base/common/linkedText.js";import{IOpenerService as L}from"../../../../platform/opener/common/opener.js";import{Button as Ae}from"../../../../base/browser/ui/button/button.js";import{Link as _e}from"../../../../platform/opener/browser/link.js";import{Orientation as F}from"../../../../base/browser/ui/sash/sash.js";import{ProgressBar as Ve}from"../../../../base/browser/ui/progressbar/progressbar.js";import{AbstractProgressScope as Te,ScopedProgressIndicator as xe}from"../../../services/progress/browser/progressIndicator.js";import"../../../../platform/progress/common/progress.js";import{DomScrollableElement as Le}from"../../../../base/browser/ui/scrollbar/scrollableElement.js";import{ScrollbarVisibility as N}from"../../../../base/common/scrollable.js";import{URI as U}from"../../../../base/common/uri.js";import{registerIcon as $}from"../../../../platform/theme/common/iconRegistry.js";import{Codicon as G}from"../../../../base/common/codicons.js";import{CompositeMenuActions as Be}from"../../actions.js";import"../../../../base/browser/ui/dropdown/dropdownActionViewItem.js";import{WorkbenchToolBar as Ee}from"../../../../platform/actions/browser/toolbar.js";import{FilterWidget as He}from"./viewFilter.js";import{BaseActionViewItem as Re}from"../../../../base/browser/ui/actionbar/actionViewItems.js";import{ServiceCollection as z}from"../../../../platform/instantiation/common/serviceCollection.js";import{defaultButtonStyles as ke,defaultProgressBarStyles as Oe}from"../../../../platform/theme/browser/defaultStyles.js";import{getDefaultHoverDelegate as B}from"../../../../base/browser/ui/hover/hoverDelegateFactory.js";import{ILifecycleService as We}from"../../../services/lifecycle/common/lifecycle.js";import{IHoverService as Y}from"../../../../platform/hover/browser/hover.js";import"../../../../base/browser/ui/list/listWidget.js";import{PANEL_BACKGROUND as Me,PANEL_SECTION_DRAG_AND_DROP_BACKGROUND as Ke,PANEL_STICKY_SCROLL_BACKGROUND as Pe,PANEL_STICKY_SCROLL_BORDER as Fe,PANEL_STICKY_SCROLL_SHADOW as Ne,SIDE_BAR_BACKGROUND as Ue,SIDE_BAR_DRAG_AND_DROP_BACKGROUND as $e,SIDE_BAR_STICKY_SCROLL_BACKGROUND as Ge,SIDE_BAR_STICKY_SCROLL_BORDER as ze,SIDE_BAR_STICKY_SCROLL_SHADOW as Ye}from"../../../common/theme.js";import"../../../services/accessibility/common/accessibleViewInformationService.js";var je=(t=>(t[t.Default=0]="Default",t[t.WhenExpanded=1]="WhenExpanded",t[t.Always=2]="Always",t))(je||{});const j=new ve("viewpane.action.filter"),Ze=$("view-pane-container-expanded",G.chevronDown,D.localize("viewPaneContainerExpandedIcon","Icon for an expanded view pane container.")),qe=$("view-pane-container-collapsed",G.chevronRight,D.localize("viewPaneContainerCollapsedIcon","Icon for a collapsed view pane container.")),Z=ue.as(fe.ViewsRegistry);let S=class{constructor(i,e,t,n,o,r,a){this.container=i;this.delegate=e;this.instantiationService=t;this.openerService=n;this.telemetryService=o;this.contextKeyService=r;this.disposables.add(f.runAndSubscribe(this.delegate.onDidChangeViewWelcomeState,()=>this.onDidChangeViewWelcomeState())),this.disposables.add(a.onWillShutdown(()=>this.dispose()))}defaultItem;items=[];get enabled(){return this._enabled}_enabled=!1;element;scrollableElement;disposables=new V;enabledDisposables=this.disposables.add(new V);renderDisposables=this.disposables.add(new V);layout(i,e){this._enabled&&(this.element.style.height=`${i}px`,this.element.style.width=`${e}px`,this.element.classList.toggle("wide",e>640),this.scrollableElement.scanDomNode())}focus(){this._enabled&&this.element.focus()}onDidChangeViewWelcomeState(){const i=this.delegate.shouldShowWelcome();if(this._enabled===i)return;if(this._enabled=i,!i){this.enabledDisposables.clear();return}this.container.classList.add("welcome");const e=c(this.container,l(".welcome-view"));this.element=l(".welcome-view-content",{tabIndex:0}),this.scrollableElement=new Le(this.element,{alwaysConsumeMouseWheel:!0,horizontal:N.Hidden,vertical:N.Visible}),c(e,this.scrollableElement.getDomNode()),this.enabledDisposables.add(pe(()=>{this.container.classList.remove("welcome"),this.scrollableElement.dispose(),e.remove(),this.scrollableElement=void 0,this.element=void 0})),this.contextKeyService.onDidChangeContext(this.onDidChangeContext,this,this.enabledDisposables),f.chain(Z.onDidChangeViewWelcomeContent,t=>t.filter(n=>n===this.delegate.id))(this.onDidChangeViewWelcomeContent,this,this.enabledDisposables),this.onDidChangeViewWelcomeContent()}onDidChangeViewWelcomeContent(){const i=Z.getViewWelcomeContent(this.delegate.id);this.items=[];for(const e of i)if(e.when==="default")this.defaultItem={descriptor:e,visible:!0};else{const t=e.when?this.contextKeyService.contextMatchesRules(e.when):!0;this.items.push({descriptor:e,visible:t})}this.render()}onDidChangeContext(){let i=!1;for(const e of this.items){if(!e.descriptor.when||e.descriptor.when==="default")continue;const t=this.contextKeyService.contextMatchesRules(e.descriptor.when);e.visible!==t&&(e.visible=t,i=!0)}i&&this.render()}render(){this.renderDisposables.clear(),this.element.innerText="";const i=this.getContentDescriptors();if(i.length===0){this.container.classList.remove("welcome"),this.scrollableElement.scanDomNode();return}for(const{content:e,precondition:t}of i){const n=e.split(`
`);for(let o of n){if(o=o.trim(),!o)continue;const r=De(o);if(r.nodes.length===1&&typeof r.nodes[0]!="string"){const a=r.nodes[0],h=c(this.element,l(".button-container")),p=new Ae(h,{title:a.title,supportIcons:!0,...ke});if(p.label=a.label,p.onDidClick(v=>{this.telemetryService.publicLog2("views.welcomeAction",{viewId:this.delegate.id,uri:a.href}),this.openerService.open(a.href,{allowCommands:!0})},null,this.renderDisposables),this.renderDisposables.add(p),t){const v=()=>p.enabled=this.contextKeyService.contextMatchesRules(t);v();const u=new Set(t.keys());f.filter(this.contextKeyService.onDidChangeContext,g=>g.affectsSome(u))(v,null,this.renderDisposables)}}else{const a=c(this.element,l("p"));for(const h of r.nodes)if(typeof h=="string")c(a,document.createTextNode(h));else{const p=this.renderDisposables.add(this.instantiationService.createInstance(_e,a,h,{}));if(t&&h.href.startsWith("command:")){const v=()=>p.enabled=this.contextKeyService.contextMatchesRules(t);v();const u=new Set(t.keys());f.filter(this.contextKeyService.onDidChangeContext,g=>g.affectsSome(u))(v,null,this.renderDisposables)}}}}}this.container.classList.add("welcome"),this.scrollableElement.scanDomNode()}getContentDescriptors(){const i=this.items.filter(e=>e.visible);return i.length===0&&this.defaultItem?[this.defaultItem.descriptor]:i.map(e=>e.descriptor)}dispose(){this.disposables.dispose()}};S=b([s(2,x),s(3,L),s(4,T),s(5,I),s(6,We)],S);let m=class extends ge{constructor(e,t,n,o,r,a,h,p,v,u,y,g){super({...e,orientation:a.getViewLocationById(e.id)===A.Panel?F.HORIZONTAL:F.VERTICAL});this.keybindingService=t;this.contextMenuService=n;this.configurationService=o;this.contextKeyService=r;this.viewDescriptorService=a;this.instantiationService=h;this.openerService=p;this.themeService=v;this.telemetryService=u;this.hoverService=y;this.accessibleViewInformationService=g;this.id=e.id,this._title=e.title,this._titleDescription=e.titleDescription,this._singleViewPaneContainerTitle=e.singleViewPaneContainerTitle,this.showActions=e.showActions??0,this.scopedContextKeyService=this._register(r.createScoped(this.element)),this.scopedContextKeyService.createKey("view",this.id);const q=this.scopedContextKeyService.createKey("viewLocation",K(a.getViewLocationById(this.id)));this._register(f.filter(a.onDidChangeLocation,Q=>Q.views.some(X=>X.id===this.id))(()=>q.set(K(a.getViewLocationById(this.id)))));const J=this._register(this.instantiationService.createChild(new z([I,this.scopedContextKeyService])));this.menuActions=this._register(J.createInstance(Be,e.titleMenuId??P.ViewTitle,P.ViewTitleContext,{shouldForwardArgs:!e.donotForwardArgs,renderShortTitle:!0})),this._register(this.menuActions.onDidChange(()=>this.updateActions()))}static AlwaysShowActionsConfig="workbench.view.alwaysShowHeaderActions";_onDidFocus=this._register(new w);onDidFocus=this._onDidFocus.event;_onDidBlur=this._register(new w);onDidBlur=this._onDidBlur.event;_onDidChangeBodyVisibility=this._register(new w);onDidChangeBodyVisibility=this._onDidChangeBodyVisibility.event;_onDidChangeTitleArea=this._register(new w);onDidChangeTitleArea=this._onDidChangeTitleArea.event;_onDidChangeViewWelcomeState=this._register(new w);onDidChangeViewWelcomeState=this._onDidChangeViewWelcomeState.event;_isVisible=!1;id;_title;get title(){return this._title}_titleDescription;get titleDescription(){return this._titleDescription}_singleViewPaneContainerTitle;get singleViewPaneContainerTitle(){return this._singleViewPaneContainerTitle}menuActions;progressBar;progressIndicator;toolbar;showActions;headerContainer;titleContainer;titleContainerHover;titleDescriptionContainer;titleDescriptionContainerHover;iconContainer;iconContainerHover;twistiesContainer;viewWelcomeController;scopedContextKeyService;get headerVisible(){return super.headerVisible}set headerVisible(e){super.headerVisible=e,this.element.classList.toggle("merged-header",!e)}setVisible(e){this._isVisible!==e&&(this._isVisible=e,this.isExpanded()&&this._onDidChangeBodyVisibility.fire(e))}isVisible(){return this._isVisible}isBodyVisible(){return this._isVisible&&this.isExpanded()}setExpanded(e){const t=super.setExpanded(e);return t&&this._onDidChangeBodyVisibility.fire(e),this.updateTwistyIcon(),t}render(){super.render();const e=re(this.element);this._register(e),this._register(e.onDidFocus(()=>this._onDidFocus.fire())),this._register(e.onDidBlur(()=>this._onDidBlur.fire()))}renderHeader(e){this.headerContainer=e,this.twistiesContainer=c(e,l(`.twisty-container${C.asCSSSelector(this.getTwistyIcon(this.isExpanded()))}`)),this.renderHeaderTitle(e,this.title);const t=c(e,l(".actions"));t.classList.toggle("show-always",this.showActions===2),t.classList.toggle("show-expanded",this.showActions===1),this.toolbar=this.instantiationService.createInstance(Ee,t,{orientation:me.HORIZONTAL,actionViewItemProvider:(r,a)=>this.getActionViewItem(r,a),ariaLabel:D.localize("viewToolbarAriaLabel","{0} actions",this.title),getKeyBinding:r=>this.keybindingService.lookupKeybinding(r.id),renderDropdownAsChildElement:!0,actionRunner:this.getActionRunner(),resetMenu:this.menuActions.menuId}),this._register(this.toolbar),this.setActions(),this._register(ae(t,se.CLICK,r=>r.preventDefault()));const n=this.viewDescriptorService.getViewContainerByViewId(this.id);n&&this._register(this.viewDescriptorService.getViewContainerModel(n).onDidChangeContainerInfo(({title:r})=>this.updateTitle(this.title)));const o=f.filter(this.configurationService.onDidChangeConfiguration,r=>r.affectsConfiguration(m.AlwaysShowActionsConfig));this._register(o(this.updateActionsVisibility,this)),this.updateActionsVisibility()}updateHeader(){super.updateHeader(),this.updateTwistyIcon()}updateTwistyIcon(){this.twistiesContainer&&(this.twistiesContainer.classList.remove(...C.asClassNameArray(this.getTwistyIcon(!this._expanded))),this.twistiesContainer.classList.add(...C.asClassNameArray(this.getTwistyIcon(this._expanded))))}getTwistyIcon(e){return e?Ze:qe}style(e){super.style(e);const t=this.getIcon();if(this.iconContainer){const n=he(e.headerForeground,ie(ne));U.isUri(t)?(this.iconContainer.style.backgroundColor=n,this.iconContainer.style.color=""):(this.iconContainer.style.color=n,this.iconContainer.style.backgroundColor="")}}getIcon(){return this.viewDescriptorService.getViewDescriptorById(this.id)?.containerIcon||we}renderHeaderTitle(e,t){this.iconContainer=c(e,l(".icon",void 0));const n=this.getIcon();let o;if(U.isUri(n)){o=`view-${this.id.replace(/[\.\:]/g,"-")}`;const a=`.pane-header .icon.${o}`;ce(a,`
				mask: ${E(n)} no-repeat 50% 50%;
				mask-size: 24px;
				-webkit-mask: ${E(n)} no-repeat 50% 50%;
				-webkit-mask-size: 16px;
			`)}else C.isThemeIcon(n)&&(o=C.asClassName(n));o&&this.iconContainer.classList.add(...o.split(" "));const r=this.calculateTitle(t);this.titleContainer=c(e,l("h3.title",{},r)),this.titleContainerHover=this._register(this.hoverService.setupManagedHover(B("mouse"),this.titleContainer,r)),this._titleDescription&&this.setTitleDescription(this._titleDescription),this.iconContainerHover=this._register(this.hoverService.setupManagedHover(B("mouse"),this.iconContainer,r)),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(r))}_getAriaLabel(e){const t=this.viewDescriptorService.getViewDescriptorById(this.id)?.accessibilityHelpContent,n=this.accessibleViewInformationService?.hasShownAccessibleView(this.id);return!t||n?e:D.localize("viewAccessibilityHelp","Use Alt+F1 for accessibility help {0}",e)}updateTitle(e){const t=this.calculateTitle(e);this.titleContainer&&(this.titleContainer.textContent=t,this.titleContainerHover?.update(t)),this.iconContainer&&(this.iconContainerHover?.update(t),this.iconContainer.setAttribute("aria-label",this._getAriaLabel(t))),this._title=e,this._onDidChangeTitleArea.fire()}setTitleDescription(e){this.titleDescriptionContainer?(this.titleDescriptionContainer.textContent=e??"",this.titleDescriptionContainerHover?.update(e??"")):e&&this.titleContainer&&(this.titleDescriptionContainer=oe(this.titleContainer,l("span.description",{},e)),this.titleDescriptionContainerHover=this._register(this.hoverService.setupManagedHover(B("mouse"),this.titleDescriptionContainer,e)))}updateTitleDescription(e){this.setTitleDescription(e),this._titleDescription=e,this._onDidChangeTitleArea.fire()}calculateTitle(e){const t=this.viewDescriptorService.getViewContainerByViewId(this.id),n=this.viewDescriptorService.getViewContainerModel(t),o=this.viewDescriptorService.getViewDescriptorById(this.id);return!(this.viewDescriptorService.getDefaultContainerById(this.id)===t)&&o?.containerTitle&&n.title!==o.containerTitle?`${o.containerTitle}: ${e}`:e}renderBody(e){this.viewWelcomeController=this._register(this.instantiationService.createInstance(S,e,this))}layoutBody(e,t){this.viewWelcomeController.layout(e,t)}onDidScrollRoot(){}getProgressIndicator(){if(this.progressBar===void 0&&(this.progressBar=this._register(new Ve(this.element,Oe)),this.progressBar.hide()),this.progressIndicator===void 0){const e=this;this.progressIndicator=this._register(new xe(Ie(this.progressBar),new class extends Te{constructor(){super(e.id,e.isBodyVisible()),this._register(e.onDidChangeBodyVisibility(t=>t?this.onScopeOpened(e.id):this.onScopeClosed(e.id)))}}))}return this.progressIndicator}getProgressLocation(){return this.viewDescriptorService.getViewContainerByViewId(this.id).id}getLocationBasedColors(){return Je(this.viewDescriptorService.getViewLocationById(this.id))}focus(){this.viewWelcomeController.enabled?this.viewWelcomeController.focus():this.element&&(this.element.focus(),this._onDidFocus.fire())}setActions(){if(this.toolbar){const e=[...this.menuActions.getPrimaryActions()];this.shouldShowFilterInHeader()&&e.unshift(j),this.toolbar.setActions(H(e),H(this.menuActions.getSecondaryActions())),this.toolbar.context=this.getActionsContext()}}updateActionsVisibility(){if(!this.headerContainer)return;const e=this.configurationService.getValue("workbench.view.alwaysShowHeaderActions");this.headerContainer.classList.toggle("actions-always-visible",e)}updateActions(){this.setActions(),this._onDidChangeTitleArea.fire()}getActionViewItem(e,t){if(e.id===j.id){const n=this;return new class extends Re{constructor(){super(null,e)}setFocusable(){}get trapsArrowNavigation(){return!0}render(o){o.classList.add("viewpane-filter-container");const r=n.getFilterWidget();c(o,r.element),r.relayout()}}}return be(this.instantiationService,e,{...t,menuAsChild:e instanceof ye})}getActionsContext(){}getActionRunner(){}getOptimalWidth(){return 0}saveState(){}shouldShowWelcome(){return!1}getFilterWidget(){}shouldShowFilterInHeader(){return!1}};m=b([s(1,R),s(2,k),s(3,W),s(4,I),s(5,M),s(6,x),s(7,L),s(8,O),s(9,T),s(10,Y)],m);let _=class extends m{filterWidget;dimension;filterContainer;constructor(i,e,t,n,o,r,a,h,p,v,u,y){super(i,e,t,n,o,r,a,h,p,v,u,y);const g=this._register(a.createChild(new z([I,this.scopedContextKeyService])));this.filterWidget=this._register(g.createInstance(He,i.filterOptions))}getFilterWidget(){return this.filterWidget}renderBody(i){super.renderBody(i),this.filterContainer=c(i,l(".viewpane-filter-container"))}layoutBody(i,e){super.layoutBody(i,e),this.dimension=new le(e,i);const t=!this.filterContainer?.hasChildNodes(),n=this.shouldShowFilterInHeader();t!==n&&(n&&de(this.filterContainer),this.updateActions(),n||c(this.filterContainer,this.filterWidget.element)),n||(i=i-44),this.filterWidget.layout(e),this.layoutBodyContent(i,e)}shouldShowFilterInHeader(){return!(this.dimension&&this.dimension.width<600&&this.dimension.height>100)}};_=b([s(1,R),s(2,k),s(3,W),s(4,I),s(5,M),s(6,x),s(7,L),s(8,O),s(9,T),s(10,Y)],_);function Je(d){let i,e,t,n,o;switch(d){case A.Panel:i=Me,e=Ke,t=Pe,n=Fe,o=Ne;break;case A.Sidebar:case A.AuxiliaryBar:default:i=Ue,e=$e,t=Ge,n=ze,o=Ye}return{background:i,overlayBackground:e,listOverrideStyles:{listBackground:i,treeStickyScrollBackground:t,treeStickyScrollBorder:n,treeStickyScrollShadow:o}}}class li extends Se{desc;constructor(i){super(i),this.desc=i}run(i,...e){const t=i.get(Ce).getActiveViewWithId(this.desc.viewId);if(t)return this.runInView(i,t,...e)}}export{_ as FilterViewPane,j as VIEWPANE_FILTER_ACTION,li as ViewAction,m as ViewPane,je as ViewPaneShowActions,Je as getLocationBasedViewColors};
