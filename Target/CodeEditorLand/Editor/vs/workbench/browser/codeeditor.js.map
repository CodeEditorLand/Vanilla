{
  "version": 3,
  "sources": ["../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/browser/codeeditor.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IAction } from '../../base/common/actions.js';\nimport { Emitter } from '../../base/common/event.js';\nimport { Disposable, DisposableStore } from '../../base/common/lifecycle.js';\nimport { isEqual } from '../../base/common/resources.js';\nimport { URI } from '../../base/common/uri.js';\nimport { ICodeEditor, IOverlayWidget, IOverlayWidgetPosition, OverlayWidgetPositionPreference, isCodeEditor, isCompositeEditor } from '../../editor/browser/editorBrowser.js';\nimport { EmbeddedCodeEditorWidget } from '../../editor/browser/widget/codeEditor/embeddedCodeEditorWidget.js';\nimport { EditorOption } from '../../editor/common/config/editorOptions.js';\nimport { IRange } from '../../editor/common/core/range.js';\nimport { CursorChangeReason, ICursorPositionChangedEvent } from '../../editor/common/cursorEvents.js';\nimport { IEditorContribution } from '../../editor/common/editorCommon.js';\nimport { IModelDecorationsChangeAccessor, TrackedRangeStickiness } from '../../editor/common/model.js';\nimport { ModelDecorationOptions } from '../../editor/common/model/textModel.js';\nimport { AbstractFloatingClickMenu, FloatingClickWidget } from '../../platform/actions/browser/floatingMenu.js';\nimport { IMenuService, MenuId } from '../../platform/actions/common/actions.js';\nimport { IContextKeyService } from '../../platform/contextkey/common/contextkey.js';\nimport { IInstantiationService } from '../../platform/instantiation/common/instantiation.js';\nimport { IKeybindingService } from '../../platform/keybinding/common/keybinding.js';\nimport { IEditorService } from '../services/editor/common/editorService.js';\n\nexport interface IRangeHighlightDecoration {\n\tresource: URI;\n\trange: IRange;\n\tisWholeLine?: boolean;\n}\n\nexport class RangeHighlightDecorations extends Disposable {\n\n\tprivate readonly _onHighlightRemoved = this._register(new Emitter<void>());\n\treadonly onHighlightRemoved = this._onHighlightRemoved.event;\n\n\tprivate rangeHighlightDecorationId: string | null = null;\n\tprivate editor: ICodeEditor | null = null;\n\tprivate readonly editorDisposables = this._register(new DisposableStore());\n\n\tconstructor(@IEditorService private readonly editorService: IEditorService) {\n\t\tsuper();\n\t}\n\n\tremoveHighlightRange() {\n\t\tif (this.editor && this.rangeHighlightDecorationId) {\n\t\t\tconst decorationId = this.rangeHighlightDecorationId;\n\t\t\tthis.editor.changeDecorations((accessor) => {\n\t\t\t\taccessor.removeDecoration(decorationId);\n\t\t\t});\n\t\t\tthis._onHighlightRemoved.fire();\n\t\t}\n\n\t\tthis.rangeHighlightDecorationId = null;\n\t}\n\n\thighlightRange(range: IRangeHighlightDecoration, editor?: any) {\n\t\teditor = editor ?? this.getEditor(range);\n\t\tif (isCodeEditor(editor)) {\n\t\t\tthis.doHighlightRange(editor, range);\n\t\t} else if (isCompositeEditor(editor) && isCodeEditor(editor.activeCodeEditor)) {\n\t\t\tthis.doHighlightRange(editor.activeCodeEditor, range);\n\t\t}\n\t}\n\n\tprivate doHighlightRange(editor: ICodeEditor, selectionRange: IRangeHighlightDecoration) {\n\t\tthis.removeHighlightRange();\n\n\t\teditor.changeDecorations((changeAccessor: IModelDecorationsChangeAccessor) => {\n\t\t\tthis.rangeHighlightDecorationId = changeAccessor.addDecoration(selectionRange.range, this.createRangeHighlightDecoration(selectionRange.isWholeLine));\n\t\t});\n\n\t\tthis.setEditor(editor);\n\t}\n\n\tprivate getEditor(resourceRange: IRangeHighlightDecoration): ICodeEditor | undefined {\n\t\tconst resource = this.editorService.activeEditor?.resource;\n\t\tif (resource && isEqual(resource, resourceRange.resource) && isCodeEditor(this.editorService.activeTextEditorControl)) {\n\t\t\treturn this.editorService.activeTextEditorControl;\n\t\t}\n\n\t\treturn undefined;\n\t}\n\n\tprivate setEditor(editor: ICodeEditor) {\n\t\tif (this.editor !== editor) {\n\t\t\tthis.editorDisposables.clear();\n\t\t\tthis.editor = editor;\n\t\t\tthis.editorDisposables.add(this.editor.onDidChangeCursorPosition((e: ICursorPositionChangedEvent) => {\n\t\t\t\tif (\n\t\t\t\t\te.reason === CursorChangeReason.NotSet\n\t\t\t\t\t|| e.reason === CursorChangeReason.Explicit\n\t\t\t\t\t|| e.reason === CursorChangeReason.Undo\n\t\t\t\t\t|| e.reason === CursorChangeReason.Redo\n\t\t\t\t) {\n\t\t\t\t\tthis.removeHighlightRange();\n\t\t\t\t}\n\t\t\t}));\n\t\t\tthis.editorDisposables.add(this.editor.onDidChangeModel(() => { this.removeHighlightRange(); }));\n\t\t\tthis.editorDisposables.add(this.editor.onDidDispose(() => {\n\t\t\t\tthis.removeHighlightRange();\n\t\t\t\tthis.editor = null;\n\t\t\t}));\n\t\t}\n\t}\n\n\tprivate static readonly _WHOLE_LINE_RANGE_HIGHLIGHT = ModelDecorationOptions.register({\n\t\tdescription: 'codeeditor-range-highlight-whole',\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'rangeHighlight',\n\t\tisWholeLine: true\n\t});\n\n\tprivate static readonly _RANGE_HIGHLIGHT = ModelDecorationOptions.register({\n\t\tdescription: 'codeeditor-range-highlight',\n\t\tstickiness: TrackedRangeStickiness.NeverGrowsWhenTypingAtEdges,\n\t\tclassName: 'rangeHighlight'\n\t});\n\n\tprivate createRangeHighlightDecoration(isWholeLine: boolean = true): ModelDecorationOptions {\n\t\treturn (isWholeLine ? RangeHighlightDecorations._WHOLE_LINE_RANGE_HIGHLIGHT : RangeHighlightDecorations._RANGE_HIGHLIGHT);\n\t}\n\n\toverride dispose() {\n\t\tsuper.dispose();\n\n\t\tif (this.editor?.getModel()) {\n\t\t\tthis.removeHighlightRange();\n\t\t\tthis.editor = null;\n\t\t}\n\t}\n}\n\nexport class FloatingEditorClickWidget extends FloatingClickWidget implements IOverlayWidget {\n\n\tconstructor(\n\t\tprivate editor: ICodeEditor,\n\t\tlabel: string,\n\t\tkeyBindingAction: string | null,\n\t\t@IKeybindingService keybindingService: IKeybindingService\n\t) {\n\t\tsuper(\n\t\t\tkeyBindingAction && keybindingService.lookupKeybinding(keyBindingAction)\n\t\t\t\t? `${label} (${keybindingService.lookupKeybinding(keyBindingAction)!.getLabel()})`\n\t\t\t\t: label\n\t\t);\n\t}\n\n\tgetId(): string {\n\t\treturn 'editor.overlayWidget.floatingClickWidget';\n\t}\n\n\tgetPosition(): IOverlayWidgetPosition {\n\t\treturn {\n\t\t\tpreference: OverlayWidgetPositionPreference.BOTTOM_RIGHT_CORNER\n\t\t};\n\t}\n\n\toverride render() {\n\t\tsuper.render();\n\t\tthis.editor.addOverlayWidget(this);\n\t}\n\n\toverride dispose(): void {\n\t\tthis.editor.removeOverlayWidget(this);\n\t\tsuper.dispose();\n\t}\n\n}\n\nexport class FloatingEditorClickMenu extends AbstractFloatingClickMenu implements IEditorContribution {\n\tstatic readonly ID = 'editor.contrib.floatingClickMenu';\n\n\tconstructor(\n\t\tprivate readonly editor: ICodeEditor,\n\t\t@IInstantiationService private readonly instantiationService: IInstantiationService,\n\t\t@IMenuService menuService: IMenuService,\n\t\t@IContextKeyService contextKeyService: IContextKeyService\n\t) {\n\t\tsuper(MenuId.EditorContent, menuService, contextKeyService);\n\t\tthis.render();\n\t}\n\n\tprotected override createWidget(action: IAction): FloatingClickWidget {\n\t\treturn this.instantiationService.createInstance(FloatingEditorClickWidget, this.editor, action.label, action.id);\n\t}\n\n\tprotected override isVisible() {\n\t\treturn !(this.editor instanceof EmbeddedCodeEditorWidget) && this.editor?.hasModel() && !this.editor.getOption(EditorOption.inDiffEditor);\n\t}\n\n\tprotected override getActionArg(): unknown {\n\t\treturn this.editor.getModel()?.uri;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
