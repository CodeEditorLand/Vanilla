import{KeyChord as E,KeyCode as m,KeyMod as k}from"../../../base/common/keyCodes.js";import{localize as s,localize2 as n}from"../../../nls.js";import{Categories as v}from"../../../platform/action/common/actionCommonCategories.js";import{Action2 as i,MenuId as d,MenuRegistry as p,registerAction2 as c}from"../../../platform/actions/common/actions.js";import{ICommandService as x}from"../../../platform/commands/common/commands.js";import{ContextKeyExpr as a}from"../../../platform/contextkey/common/contextkey.js";import{IsMacNativeContext as I}from"../../../platform/contextkey/common/contextkeys.js";import{IFileDialogService as D}from"../../../platform/dialogs/common/dialogs.js";import{KeybindingWeight as f}from"../../../platform/keybinding/common/keybindingsRegistry.js";import{IWorkspaceContextService as T,WorkbenchState as K,hasWorkspaceFileExtension as V}from"../../../platform/workspace/common/workspace.js";import{IWorkspacesService as Y}from"../../../platform/workspaces/common/workspaces.js";import{EmptyWorkspaceSupportContext as P,EnterMultiRootWorkspaceSupportContext as l,OpenFolderWorkspaceSupportContext as y,WorkbenchStateContext as u,WorkspaceFolderCountContext as G}from"../../common/contextkeys.js";import{IEditorService as J}from"../../services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as j}from"../../services/environment/common/environmentService.js";import{IHostService as B}from"../../services/host/browser/host.js";import{IWorkspaceEditingService as R}from"../../services/workspaces/common/workspaceEditing.js";import{ADD_ROOT_FOLDER_COMMAND_ID as U,ADD_ROOT_FOLDER_LABEL as Q,PICK_WORKSPACE_FOLDER_COMMAND_ID as X,SET_ROOT_FOLDER_COMMAND_ID as Z}from"./workspaceCommands.js";const g=n("workspaces","Workspaces");class F extends i{static ID="workbench.action.files.openFile";constructor(){super({id:F.ID,title:n("openFile","Open File..."),category:v.File,f1:!0,keybinding:{when:I.toNegated(),weight:f.WorkbenchContrib,primary:k.CtrlCmd|m.KeyO}})}async run(e,o){return e.get(D).pickFileAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class S extends i{static ID="workbench.action.files.openFolder";constructor(){super({id:S.ID,title:n("openFolder","Open Folder..."),category:v.File,f1:!0,precondition:y,keybinding:{weight:f.WorkbenchContrib,primary:void 0,linux:{primary:E(k.CtrlCmd|m.KeyK,k.CtrlCmd|m.KeyO)},win:{primary:E(k.CtrlCmd|m.KeyK,k.CtrlCmd|m.KeyO)}}})}async run(e,o){return e.get(D).pickFolderAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class C extends i{static ID="workbench.action.files.openFolderViaWorkspace";constructor(){super({id:C.ID,title:n("openFolder","Open Folder..."),category:v.File,f1:!0,precondition:a.and(y.toNegated(),u.isEqualTo("workspace")),keybinding:{weight:f.WorkbenchContrib,primary:k.CtrlCmd|m.KeyO}})}run(e){return e.get(x).executeCommand(Z)}}class W extends i{static ID="workbench.action.files.openFileFolder";static LABEL=n("openFileFolder","Open...");constructor(){super({id:W.ID,title:W.LABEL,category:v.File,f1:!0,precondition:a.and(I,y),keybinding:{weight:f.WorkbenchContrib,primary:k.CtrlCmd|m.KeyO}})}async run(e,o){return e.get(D).pickFileFolderAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class h extends i{static ID="workbench.action.openWorkspace";constructor(){super({id:h.ID,title:n("openWorkspaceAction","Open Workspace from File..."),category:v.File,f1:!0,precondition:l})}async run(e,o){return e.get(D).pickWorkspaceAndOpen({telemetryExtraData:o})}}class w extends i{static ID="workbench.action.closeFolder";constructor(){super({id:w.ID,title:n("closeWorkspace","Close Workspace"),category:g,f1:!0,precondition:a.and(u.notEqualsTo("empty"),P),keybinding:{weight:f.WorkbenchContrib,primary:E(k.CtrlCmd|m.KeyK,m.KeyF)}})}async run(e){const o=e.get(B),r=e.get(j);return o.openWindow({forceReuseWindow:!0,remoteAuthority:r.remoteAuthority})}}class N extends i{static ID="workbench.action.openWorkspaceConfigFile";constructor(){super({id:N.ID,title:n("openWorkspaceConfigFile","Open Workspace Configuration File"),category:g,f1:!0,precondition:u.isEqualTo("workspace")})}async run(e){const o=e.get(T),r=e.get(J),t=o.getWorkspace().configuration;t&&await r.openEditor({resource:t,options:{pinned:!0}})}}class L extends i{static ID="workbench.action.addRootFolder";constructor(){super({id:L.ID,title:Q,category:g,f1:!0,precondition:a.or(l,u.isEqualTo("workspace"))})}run(e){return e.get(x).executeCommand(U)}}class _ extends i{static ID="workbench.action.removeRootFolder";constructor(){super({id:_.ID,title:n("globalRemoveFolderFromWorkspace","Remove Folder from Workspace..."),category:g,f1:!0,precondition:a.and(G.notEqualsTo("0"),a.or(l,u.isEqualTo("workspace")))})}async run(e){const o=e.get(x),r=e.get(R),t=await o.executeCommand(X);t&&await r.removeFolders([t.uri])}}class A extends i{static ID="workbench.action.saveWorkspaceAs";constructor(){super({id:A.ID,title:n("saveWorkspaceAsAction","Save Workspace As..."),category:g,f1:!0,precondition:l})}async run(e){const o=e.get(R),r=e.get(T),t=await o.pickNewWorkspacePath();if(t&&V(t))switch(r.getWorkbenchState()){case K.EMPTY:case K.FOLDER:{const M=r.getWorkspace().folders.map(O=>({uri:O.uri}));return o.createAndEnterWorkspace(M,t)}case K.WORKSPACE:return o.saveAndEnterWorkspace(t)}}}class b extends i{static ID="workbench.action.duplicateWorkspaceInNewWindow";constructor(){super({id:b.ID,title:n("duplicateWorkspaceInNewWindow","Duplicate As Workspace in New Window"),category:g,f1:!0,precondition:l})}async run(e){const o=e.get(T),r=e.get(R),t=e.get(B),M=e.get(Y),O=e.get(j),H=o.getWorkspace().folders,q=O.remoteAuthority,z=await M.createUntitledWorkspace(H,q);return await r.copyWorkspaceSettings(z),t.openWindow([{workspaceUri:z.configPath}],{forceNewWindow:!0,remoteAuthority:q})}}c(L),c(_),c(F),c(S),c(C),c(W),c(h),c(N),c(w),c(A),c(b),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:F.ID,title:s({key:"miOpenFile",comment:["&& denotes a mnemonic"]},"&&Open File...")},order:1,when:I.toNegated()}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:S.ID,title:s({key:"miOpenFolder",comment:["&& denotes a mnemonic"]},"Open &&Folder...")},order:2,when:y}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:C.ID,title:s({key:"miOpenFolder",comment:["&& denotes a mnemonic"]},"Open &&Folder...")},order:2,when:a.and(y.toNegated(),u.isEqualTo("workspace"))}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:W.ID,title:s({key:"miOpen",comment:["&& denotes a mnemonic"]},"&&Open...")},order:1,when:a.and(I,y)}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:h.ID,title:s({key:"miOpenWorkspace",comment:["&& denotes a mnemonic"]},"Open Wor&&kspace from File...")},order:3,when:l}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:U,title:s({key:"miAddFolderToWorkspace",comment:["&& denotes a mnemonic"]},"A&&dd Folder to Workspace...")},when:a.or(l,u.isEqualTo("workspace")),order:1}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:A.ID,title:s("miSaveWorkspaceAs","Save Workspace As...")},order:2,when:l}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:b.ID,title:s("duplicateWorkspace","Duplicate Workspace")},order:3,when:l}),p.appendMenuItem(d.MenubarFileMenu,{group:"6_close",command:{id:w.ID,title:s({key:"miCloseFolder",comment:["&& denotes a mnemonic"]},"Close &&Folder")},order:3,when:a.and(u.isEqualTo("folder"),P)}),p.appendMenuItem(d.MenubarFileMenu,{group:"6_close",command:{id:w.ID,title:s({key:"miCloseWorkspace",comment:["&& denotes a mnemonic"]},"Close &&Workspace")},order:3,when:a.and(u.isEqualTo("workspace"),P)});export{L as AddRootFolderAction,F as OpenFileAction,W as OpenFileFolderAction,S as OpenFolderAction,C as OpenFolderViaWorkspaceAction,_ as RemoveRootFolderAction};
