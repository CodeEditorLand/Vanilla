import{KeyChord as E,KeyCode as l,KeyMod as k}from"../../../../vs/base/common/keyCodes.js";import{localize as s,localize2 as n}from"../../../../vs/nls.js";import"../../../../vs/platform/action/common/action.js";import{Categories as v}from"../../../../vs/platform/action/common/actionCommonCategories.js";import{Action2 as i,MenuId as d,MenuRegistry as p,registerAction2 as c}from"../../../../vs/platform/actions/common/actions.js";import{ICommandService as x}from"../../../../vs/platform/commands/common/commands.js";import{ContextKeyExpr as a}from"../../../../vs/platform/contextkey/common/contextkey.js";import{IsMacNativeContext as I}from"../../../../vs/platform/contextkey/common/contextkeys.js";import{IFileDialogService as D}from"../../../../vs/platform/dialogs/common/dialogs.js";import"../../../../vs/platform/instantiation/common/instantiation.js";import{KeybindingWeight as w}from"../../../../vs/platform/keybinding/common/keybindingsRegistry.js";import"../../../../vs/platform/telemetry/common/telemetry.js";import{hasWorkspaceFileExtension as Y,IWorkspaceContextService as T,WorkbenchState as K}from"../../../../vs/platform/workspace/common/workspace.js";import{IWorkspacesService as j}from"../../../../vs/platform/workspaces/common/workspaces.js";import{ADD_ROOT_FOLDER_COMMAND_ID as B,ADD_ROOT_FOLDER_LABEL as G,PICK_WORKSPACE_FOLDER_COMMAND_ID as J,SET_ROOT_FOLDER_COMMAND_ID as Q}from"../../../../vs/workbench/browser/actions/workspaceCommands.js";import{EmptyWorkspaceSupportContext as P,EnterMultiRootWorkspaceSupportContext as m,OpenFolderWorkspaceSupportContext as g,WorkbenchStateContext as u,WorkspaceFolderCountContext as X}from"../../../../vs/workbench/common/contextkeys.js";import{IEditorService as Z}from"../../../../vs/workbench/services/editor/common/editorService.js";import{IWorkbenchEnvironmentService as U}from"../../../../vs/workbench/services/environment/common/environmentService.js";import{IHostService as H}from"../../../../vs/workbench/services/host/browser/host.js";import{IWorkspaceEditingService as R}from"../../../../vs/workbench/services/workspaces/common/workspaceEditing.js";const y=n("workspaces","Workspaces");class F extends i{static ID="workbench.action.files.openFile";constructor(){super({id:F.ID,title:n("openFile","Open File..."),category:v.File,f1:!0,keybinding:{when:I.toNegated(),weight:w.WorkbenchContrib,primary:k.CtrlCmd|l.KeyO}})}async run(e,o){return e.get(D).pickFileAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class S extends i{static ID="workbench.action.files.openFolder";constructor(){super({id:S.ID,title:n("openFolder","Open Folder..."),category:v.File,f1:!0,precondition:g,keybinding:{weight:w.WorkbenchContrib,primary:void 0,linux:{primary:E(k.CtrlCmd|l.KeyK,k.CtrlCmd|l.KeyO)},win:{primary:E(k.CtrlCmd|l.KeyK,k.CtrlCmd|l.KeyO)}}})}async run(e,o){return e.get(D).pickFolderAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class C extends i{static ID="workbench.action.files.openFolderViaWorkspace";constructor(){super({id:C.ID,title:n("openFolder","Open Folder..."),category:v.File,f1:!0,precondition:a.and(g.toNegated(),u.isEqualTo("workspace")),keybinding:{weight:w.WorkbenchContrib,primary:k.CtrlCmd|l.KeyO}})}run(e){return e.get(x).executeCommand(Q)}}class W extends i{static ID="workbench.action.files.openFileFolder";static LABEL=n("openFileFolder","Open...");constructor(){super({id:W.ID,title:W.LABEL,category:v.File,f1:!0,precondition:a.and(I,g),keybinding:{weight:w.WorkbenchContrib,primary:k.CtrlCmd|l.KeyO}})}async run(e,o){return e.get(D).pickFileFolderAndOpen({forceNewWindow:!1,telemetryExtraData:o})}}class h extends i{static ID="workbench.action.openWorkspace";constructor(){super({id:h.ID,title:n("openWorkspaceAction","Open Workspace from File..."),category:v.File,f1:!0,precondition:m})}async run(e,o){return e.get(D).pickWorkspaceAndOpen({telemetryExtraData:o})}}class f extends i{static ID="workbench.action.closeFolder";constructor(){super({id:f.ID,title:n("closeWorkspace","Close Workspace"),category:y,f1:!0,precondition:a.and(u.notEqualsTo("empty"),P),keybinding:{weight:w.WorkbenchContrib,primary:E(k.CtrlCmd|l.KeyK,l.KeyF)}})}async run(e){const o=e.get(H),r=e.get(U);return o.openWindow({forceReuseWindow:!0,remoteAuthority:r.remoteAuthority})}}class N extends i{static ID="workbench.action.openWorkspaceConfigFile";constructor(){super({id:N.ID,title:n("openWorkspaceConfigFile","Open Workspace Configuration File"),category:y,f1:!0,precondition:u.isEqualTo("workspace")})}async run(e){const o=e.get(T),r=e.get(Z),t=o.getWorkspace().configuration;t&&await r.openEditor({resource:t,options:{pinned:!0}})}}class L extends i{static ID="workbench.action.addRootFolder";constructor(){super({id:L.ID,title:G,category:y,f1:!0,precondition:a.or(m,u.isEqualTo("workspace"))})}run(e){return e.get(x).executeCommand(B)}}class _ extends i{static ID="workbench.action.removeRootFolder";constructor(){super({id:_.ID,title:n("globalRemoveFolderFromWorkspace","Remove Folder from Workspace..."),category:y,f1:!0,precondition:a.and(X.notEqualsTo("0"),a.or(m,u.isEqualTo("workspace")))})}async run(e){const o=e.get(x),r=e.get(R),t=await o.executeCommand(J);t&&await r.removeFolders([t.uri])}}class A extends i{static ID="workbench.action.saveWorkspaceAs";constructor(){super({id:A.ID,title:n("saveWorkspaceAsAction","Save Workspace As..."),category:y,f1:!0,precondition:m})}async run(e){const o=e.get(R),r=e.get(T),t=await o.pickNewWorkspacePath();if(t&&Y(t))switch(r.getWorkbenchState()){case K.EMPTY:case K.FOLDER:{const M=r.getWorkspace().folders.map(O=>({uri:O.uri}));return o.createAndEnterWorkspace(M,t)}case K.WORKSPACE:return o.saveAndEnterWorkspace(t)}}}class b extends i{static ID="workbench.action.duplicateWorkspaceInNewWindow";constructor(){super({id:b.ID,title:n("duplicateWorkspaceInNewWindow","Duplicate As Workspace in New Window"),category:y,f1:!0,precondition:m})}async run(e){const o=e.get(T),r=e.get(R),t=e.get(H),M=e.get(j),O=e.get(U),V=o.getWorkspace().folders,q=O.remoteAuthority,z=await M.createUntitledWorkspace(V,q);return await r.copyWorkspaceSettings(z),t.openWindow([{workspaceUri:z.configPath}],{forceNewWindow:!0,remoteAuthority:q})}}c(L),c(_),c(F),c(S),c(C),c(W),c(h),c(N),c(f),c(A),c(b),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:F.ID,title:s({key:"miOpenFile",comment:["&& denotes a mnemonic"]},"&&Open File...")},order:1,when:I.toNegated()}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:S.ID,title:s({key:"miOpenFolder",comment:["&& denotes a mnemonic"]},"Open &&Folder...")},order:2,when:g}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:C.ID,title:s({key:"miOpenFolder",comment:["&& denotes a mnemonic"]},"Open &&Folder...")},order:2,when:a.and(g.toNegated(),u.isEqualTo("workspace"))}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:W.ID,title:s({key:"miOpen",comment:["&& denotes a mnemonic"]},"&&Open...")},order:1,when:a.and(I,g)}),p.appendMenuItem(d.MenubarFileMenu,{group:"2_open",command:{id:h.ID,title:s({key:"miOpenWorkspace",comment:["&& denotes a mnemonic"]},"Open Wor&&kspace from File...")},order:3,when:m}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:B,title:s({key:"miAddFolderToWorkspace",comment:["&& denotes a mnemonic"]},"A&&dd Folder to Workspace...")},when:a.or(m,u.isEqualTo("workspace")),order:1}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:A.ID,title:s("miSaveWorkspaceAs","Save Workspace As...")},order:2,when:m}),p.appendMenuItem(d.MenubarFileMenu,{group:"3_workspace",command:{id:b.ID,title:s("duplicateWorkspace","Duplicate Workspace")},order:3,when:m}),p.appendMenuItem(d.MenubarFileMenu,{group:"6_close",command:{id:f.ID,title:s({key:"miCloseFolder",comment:["&& denotes a mnemonic"]},"Close &&Folder")},order:3,when:a.and(u.isEqualTo("folder"),P)}),p.appendMenuItem(d.MenubarFileMenu,{group:"6_close",command:{id:f.ID,title:s({key:"miCloseWorkspace",comment:["&& denotes a mnemonic"]},"Close &&Workspace")},order:3,when:a.and(u.isEqualTo("workspace"),P)});export{L as AddRootFolderAction,F as OpenFileAction,W as OpenFileFolderAction,S as OpenFolderAction,C as OpenFolderViaWorkspaceAction,_ as RemoveRootFolderAction};
