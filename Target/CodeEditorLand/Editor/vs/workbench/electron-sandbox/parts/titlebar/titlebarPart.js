var ie=Object.defineProperty;var te=Object.getOwnPropertyDescriptor;var b=(h,s,i,o)=>{for(var t=o>1?void 0:o?te(s,i):s,r=h.length-1,n;r>=0;r--)(n=h[r])&&(t=(o?n(s,i,t):n(t))||t);return o&&t&&ie(s,i,t),t},e=(h,s)=>(i,o)=>s(i,o,h);import{getZoomFactor as y,isWCOEnabled as re}from"../../../../base/browser/browser.js";import{$ as x,EventType as M,addDisposableListener as W,append as E,getWindow as m,getWindowId as k,hide as N,show as A}from"../../../../base/browser/dom.js";import{mainWindow as oe}from"../../../../base/browser/window.js";import{Codicon as l}from"../../../../base/common/codicons.js";import{Event as ne}from"../../../../base/common/event.js";import{isBigSurOrNewer as se,isLinux as K,isMacintosh as B,isNative as ae,isWindows as _}from"../../../../base/common/platform.js";import{ThemeIcon as u}from"../../../../base/common/themables.js";import{IMenuService as D,MenuId as ce}from"../../../../platform/actions/common/actions.js";import{IConfigurationService as O}from"../../../../platform/configuration/common/configuration.js";import{IContextKeyService as G}from"../../../../platform/contextkey/common/contextkey.js";import{IContextMenuService as U}from"../../../../platform/contextview/browser/contextView.js";import{IInstantiationService as F}from"../../../../platform/instantiation/common/instantiation.js";import{IKeybindingService as V}from"../../../../platform/keybinding/common/keybinding.js";import{INativeHostService as Z}from"../../../../platform/native/common/native.js";import{IStorageService as $}from"../../../../platform/storage/common/storage.js";import{IThemeService as P}from"../../../../platform/theme/common/themeService.js";import{DEFAULT_CUSTOM_TITLEBAR_HEIGHT as de,hasNativeTitlebar as H,useWindowControlsOverlay as Q}from"../../../../platform/window/common/window.js";import{BrowserTitleService as me,BrowserTitlebarPart as he}from"../../../browser/parts/titlebar/titlebarPart.js";import{IEditorGroupsService as X}from"../../../services/editor/common/editorGroupsService.js";import{IEditorService as Y}from"../../../services/editor/common/editorService.js";import{INativeWorkbenchEnvironmentService as j}from"../../../services/environment/electron-sandbox/environmentService.js";import{IHostService as q}from"../../../services/host/browser/host.js";import{IWorkbenchLayoutService as J,Parts as ve}from"../../../services/layout/browser/layoutService.js";import{NativeMenubarControl as le}from"./menubarControl.js";let p=class extends he{constructor(i,o,t,r,n,a,c,d,g,S,C,I,w,T,z,L,R){super(i,o,t,r,n,a,c,d,g,S,C,I,T,z,L,R);this.nativeHostService=w;this.bigSurOrNewer=se(a.os.release)}get minimumHeight(){return B?(this.isCommandCenterVisible?de:this.macTitlebarSize)/(this.preventZoom?y(m(this.element)):1):super.minimumHeight}get maximumHeight(){return this.minimumHeight}bigSurOrNewer;get macTitlebarSize(){return this.bigSurOrNewer?28:22}maxRestoreControl;resizer;cachedWindowControlStyles;cachedWindowControlHeight;onMenubarVisibilityChanged(i){(_||K)&&this.currentMenubarVisibility==="toggle"&&i&&this.dragRegion&&(N(this.dragRegion),setTimeout(()=>A(this.dragRegion),50)),super.onMenubarVisibilityChanged(i)}onConfigurationChanged(i){super.onConfigurationChanged(i),i.affectsConfiguration("window.doubleClickIconToClose")&&this.appIcon&&this.onUpdateAppIconDragBehavior()}onUpdateAppIconDragBehavior(){this.configurationService.getValue("window.doubleClickIconToClose")&&this.appIcon?this.appIcon.style["-webkit-app-region"]="no-drag":this.appIcon&&(this.appIcon.style["-webkit-app-region"]="drag")}installMenubar(){super.installMenubar(),!this.menubar&&this.customMenubar&&this._register(this.customMenubar.onFocusStateChange(i=>this.onMenubarFocusChanged(i)))}onMenubarFocusChanged(i){(_||K)&&this.currentMenubarVisibility!=="compact"&&this.dragRegion&&(i?N(this.dragRegion):A(this.dragRegion))}createContentArea(i){const o=super.createContentArea(i),t=m(i),r=k(t);if((B||H(this.configurationService))&&this._register(this.instantiationService.createInstance(le)),this.appIcon&&(this.onUpdateAppIconDragBehavior(),this._register(W(this.appIcon,M.DBLCLICK,()=>{this.nativeHostService.closeWindow({targetWindowId:r})}))),K&&!H(this.configurationService)&&!re()&&this.windowControlsContainer){const n=E(this.windowControlsContainer,x("div.window-icon.window-minimize"+u.asCSSSelector(l.chromeMinimize)));this._register(W(n,M.CLICK,()=>{this.nativeHostService.minimizeWindow({targetWindowId:r})})),this.maxRestoreControl=E(this.windowControlsContainer,x("div.window-icon.window-max-restore")),this._register(W(this.maxRestoreControl,M.CLICK,async()=>await this.nativeHostService.isMaximized({targetWindowId:r})?this.nativeHostService.unmaximizeWindow({targetWindowId:r}):this.nativeHostService.maximizeWindow({targetWindowId:r})));const a=E(this.windowControlsContainer,x("div.window-icon.window-close"+u.asCSSSelector(l.chromeClose)));this._register(W(a,M.CLICK,()=>{this.nativeHostService.closeWindow({targetWindowId:r})})),this.resizer=E(this.rootContainer,x("div.resizer")),this._register(ne.runAndSubscribe(this.layoutService.onDidChangeWindowMaximized,({windowId:c,maximized:d})=>{c===r&&this.onDidChangeWindowMaximized(d)},{windowId:r,maximized:this.layoutService.isWindowMaximized(t)}))}return _&&!H(this.configurationService)&&this._register(this.nativeHostService.onDidTriggerWindowSystemContextMenu(({windowId:n,x:a,y:c})=>{if(r!==n)return;const d=y(m(this.element));this.onContextMenu(new MouseEvent("mouseup",{clientX:a/d,clientY:c/d}),ce.TitleBarContext)})),o}onDidChangeWindowMaximized(i){this.maxRestoreControl&&(i?(this.maxRestoreControl.classList.remove(...u.asClassNameArray(l.chromeMaximize)),this.maxRestoreControl.classList.add(...u.asClassNameArray(l.chromeRestore))):(this.maxRestoreControl.classList.remove(...u.asClassNameArray(l.chromeRestore)),this.maxRestoreControl.classList.add(...u.asClassNameArray(l.chromeMaximize)))),this.resizer&&(i?N(this.resizer):A(this.resizer))}updateStyles(){super.updateStyles(),Q(this.configurationService)&&(!this.cachedWindowControlStyles||this.cachedWindowControlStyles.bgColor!==this.element.style.backgroundColor||this.cachedWindowControlStyles.fgColor!==this.element.style.color)&&this.nativeHostService.updateWindowControls({targetWindowId:k(m(this.element)),backgroundColor:this.element.style.backgroundColor,foregroundColor:this.element.style.color})}layout(i,o){if(super.layout(i,o),Q(this.configurationService)||B&&ae&&!H(this.configurationService)){const t=o>0||this.bigSurOrNewer?Math.round(o*y(m(this.element))):this.macTitlebarSize;t!==this.cachedWindowControlHeight&&(this.cachedWindowControlHeight=t,this.nativeHostService.updateWindowControls({targetWindowId:k(m(this.element)),height:t}))}}};p=b([e(3,U),e(4,O),e(5,j),e(6,F),e(7,P),e(8,$),e(9,J),e(10,G),e(11,q),e(12,Z),e(13,X),e(14,Y),e(15,D),e(16,V)],p);let f=class extends p{constructor(s,i,o,t,r,n,a,c,d,g,S,C,I,w){super(ve.TITLEBAR_PART,oe,"main",s,i,o,t,r,n,a,c,d,g,S,C,I,w)}};f=b([e(0,U),e(1,O),e(2,j),e(3,F),e(4,P),e(5,$),e(6,J),e(7,G),e(8,q),e(9,Z),e(10,X),e(11,Y),e(12,D),e(13,V)],f);let v=class extends p{constructor(i,o,t,r,n,a,c,d,g,S,C,I,w,T,z,L,R){const ee=v.COUNTER++;super(`workbench.parts.auxiliaryTitle.${ee}`,m(i),o,r,n,a,c,d,g,S,C,I,w,T,z,L,R);this.container=i;this.mainTitlebar=t}static COUNTER=1;get height(){return this.minimumHeight}get preventZoom(){return y(m(this.element))<1||!this.mainTitlebar.hasZoomableElements}};v=b([e(3,U),e(4,O),e(5,j),e(6,F),e(7,P),e(8,$),e(9,J),e(10,G),e(11,q),e(12,Z),e(13,X),e(14,Y),e(15,D),e(16,V)],v);class De extends me{createMainTitlebarPart(){return this.instantiationService.createInstance(f)}doCreateAuxiliaryTitlebarPart(s,i){return this.instantiationService.createInstance(v,s,i,this.mainPart)}}export{v as AuxiliaryNativeTitlebarPart,f as MainNativeTitlebarPart,De as NativeTitleService,p as NativeTitlebarPart};
