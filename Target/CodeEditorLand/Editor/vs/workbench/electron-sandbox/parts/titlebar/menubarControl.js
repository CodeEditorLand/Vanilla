var h=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var d=(a,c,i,t)=>{for(var n=t>1?void 0:t?y(c,i):c,e=a.length-1,o;e>=0;e--)(o=a[e])&&(n=(t?o(c,i,n):o(n))||n);return t&&n&&h(c,i,n),n},r=(a,c)=>(i,t)=>c(i,t,a);import{Separator as b}from"../../../../../vs/base/common/actions.js";import{isMacintosh as A}from"../../../../../vs/base/common/platform.js";import{IAccessibilityService as k}from"../../../../../vs/platform/accessibility/common/accessibility.js";import{isICommandActionToggleInfo as K}from"../../../../../vs/platform/action/common/action.js";import{createAndFillInContextMenuActions as L}from"../../../../../vs/platform/actions/browser/menuEntryActionViewItem.js";import{IMenuService as O,MenuItemAction as w,SubmenuItemAction as f}from"../../../../../vs/platform/actions/common/actions.js";import{ICommandService as C}from"../../../../../vs/platform/commands/common/commands.js";import{IConfigurationService as R}from"../../../../../vs/platform/configuration/common/configuration.js";import{IContextKeyService as H}from"../../../../../vs/platform/contextkey/common/contextkey.js";import{IKeybindingService as N}from"../../../../../vs/platform/keybinding/common/keybinding.js";import{ILabelService as U}from"../../../../../vs/platform/label/common/label.js";import"../../../../../vs/platform/menubar/common/menubar.js";import{IMenubarService as x}from"../../../../../vs/platform/menubar/electron-sandbox/menubar.js";import{INativeHostService as W}from"../../../../../vs/platform/native/common/native.js";import{INotificationService as D}from"../../../../../vs/platform/notification/common/notification.js";import{IStorageService as E}from"../../../../../vs/platform/storage/common/storage.js";import{IUpdateService as F}from"../../../../../vs/platform/update/common/update.js";import{IWorkspacesService as j}from"../../../../../vs/platform/workspaces/common/workspaces.js";import{OpenRecentAction as q}from"../../../../../vs/workbench/browser/actions/windowActions.js";import{MenubarControl as T}from"../../../../../vs/workbench/browser/parts/titlebar/menubarControl.js";import{INativeWorkbenchEnvironmentService as z}from"../../../../../vs/workbench/services/environment/electron-sandbox/environmentService.js";import{IHostService as B}from"../../../../../vs/workbench/services/host/browser/host.js";import{IPreferencesService as G}from"../../../../../vs/workbench/services/preferences/common/preferences.js";let m=class extends T{constructor(i,t,n,e,o,s,u,p,l,I,v,g,J,M,Q,S){super(i,t,n,e,o,s,u,p,l,I,v,g,M,S);this.menubarService=J;this.nativeHostService=Q;(async()=>(this.recentlyOpened=await this.workspacesService.getRecentlyOpened(),this.doUpdateMenubar()))(),this.registerListeners()}setupMainMenu(){super.setupMainMenu();for(const i of Object.keys(this.topLevelTitles)){const t=this.menus[i];t&&this.mainMenuDisposables.add(t.onDidChange(()=>this.updateMenubar()))}}doUpdateMenubar(){if(!this.hostService.hasFocus)return;const i={menus:{},keybindings:{}};this.getMenubarMenus(i)&&this.menubarService.updateMenubar(this.nativeHostService.windowId,i)}getMenubarMenus(i){if(!i)return!1;i.keybindings=this.getAdditionalKeybindings();for(const t of Object.keys(this.topLevelTitles)){const n=this.menus[t];if(n){const e={items:[]},o=[];if(L(n,{shouldForwardArgs:!0},o),this.populateMenuItems(o,e,i.keybindings),e.items.length===0)return!1;i.menus[t]=e}}return!0}populateMenuItems(i,t,n){for(const e of i)if(e instanceof b)t.items.push({id:"vscode.menubar.separator"});else if(e instanceof w||e instanceof f){const o=typeof e.item.title=="string"?e.item.title:e.item.title.mnemonicTitle??e.item.title.value;if(e instanceof f){const s={items:[]};if(this.populateMenuItems(e.actions,s,n),s.items.length>0){const u={id:e.id,label:o,submenu:s};t.items.push(u)}}else{if(e.id===q.ID){const u=this.getOpenRecentActions().map(this.transformOpenRecentAction);t.items.push(...u)}const s={id:e.id,label:o};K(e.item.toggled)&&(s.label=e.item.toggled.mnemonicTitle??e.item.toggled.title??o),e.checked&&(s.checked=!0),e.enabled||(s.enabled=!1),n[e.id]=this.getMenubarKeybinding(e.id),t.items.push(s)}}}transformOpenRecentAction(i){return i instanceof b?{id:"vscode.menubar.separator"}:{id:i.id,uri:i.uri,remoteAuthority:i.remoteAuthority,enabled:i.enabled,label:i.label}}getAdditionalKeybindings(){const i={};if(A){const t=this.getMenubarKeybinding("workbench.action.quit");t&&(i["workbench.action.quit"]=t)}return i}getMenubarKeybinding(i){const t=this.keybindingService.lookupKeybinding(i);if(!t)return;const n=t.getElectronAccelerator();if(n)return{label:n,userSettingsLabel:t.getUserSettingsLabel()??void 0};const e=t.getLabel();if(e)return{label:e,isNative:!1,userSettingsLabel:t.getUserSettingsLabel()??void 0}}};m=d([r(0,O),r(1,j),r(2,H),r(3,N),r(4,R),r(5,U),r(6,F),r(7,E),r(8,D),r(9,G),r(10,z),r(11,k),r(12,x),r(13,B),r(14,W),r(15,C)],m);export{m as NativeMenubarControl};
