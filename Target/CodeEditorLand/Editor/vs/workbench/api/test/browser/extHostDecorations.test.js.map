{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/test/browser/extHostDecorations.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { timeout } from '../../../../base/common/async.js';\nimport { CancellationToken } from '../../../../base/common/cancellation.js';\nimport { URI } from '../../../../base/common/uri.js';\nimport { mock } from '../../../../base/test/common/mock.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { NullLogService } from '../../../../platform/log/common/log.js';\nimport { MainThreadDecorationsShape } from '../../common/extHost.protocol.js';\nimport { ExtHostDecorations } from '../../common/extHostDecorations.js';\nimport { IExtHostRpcService } from '../../common/extHostRpcService.js';\nimport { nullExtensionDescription } from '../../../services/extensions/common/extensions.js';\n\nsuite('ExtHostDecorations', function () {\n\n\tlet mainThreadShape: MainThreadDecorationsShape;\n\tlet extHostDecorations: ExtHostDecorations;\n\tconst providers = new Set<number>();\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\tsetup(function () {\n\n\t\tproviders.clear();\n\n\t\tmainThreadShape = new class extends mock<MainThreadDecorationsShape>() {\n\t\t\toverride $registerDecorationProvider(handle: number) {\n\t\t\t\tproviders.add(handle);\n\t\t\t}\n\t\t};\n\n\t\textHostDecorations = new ExtHostDecorations(\n\t\t\tnew class extends mock<IExtHostRpcService>() {\n\t\t\t\toverride getProxy(): any {\n\t\t\t\t\treturn mainThreadShape;\n\t\t\t\t}\n\t\t\t},\n\t\t\tnew NullLogService()\n\t\t);\n\t});\n\n\ttest('SCM Decorations missing #100524', async function () {\n\n\t\tlet calledA = false;\n\t\tlet calledB = false;\n\n\t\t// never returns\n\t\textHostDecorations.registerFileDecorationProvider({\n\n\t\t\tprovideFileDecoration() {\n\t\t\t\tcalledA = true;\n\t\t\t\treturn new Promise(() => { });\n\t\t\t}\n\t\t}, nullExtensionDescription);\n\n\t\t// always returns\n\t\textHostDecorations.registerFileDecorationProvider({\n\n\t\t\tprovideFileDecoration() {\n\t\t\t\tcalledB = true;\n\t\t\t\treturn new Promise(resolve => resolve({ badge: 'H', tooltip: 'Hello' }));\n\t\t\t}\n\t\t}, nullExtensionDescription);\n\n\n\t\tconst requests = [...providers.values()].map((handle, idx) => {\n\t\t\treturn extHostDecorations.$provideDecorations(handle, [{ id: idx, uri: URI.parse('test:///file') }], CancellationToken.None);\n\t\t});\n\n\t\tassert.strictEqual(calledA, true);\n\t\tassert.strictEqual(calledB, true);\n\n\t\tassert.strictEqual(requests.length, 2);\n\t\tconst [first, second] = requests;\n\n\t\tconst firstResult = await Promise.race([first, timeout(30).then(() => false)]);\n\t\tassert.strictEqual(typeof firstResult, 'boolean'); // never finishes...\n\n\t\tconst secondResult = await Promise.race([second, timeout(30).then(() => false)]);\n\t\tassert.strictEqual(typeof secondResult, 'object');\n\n\n\t\tawait timeout(30);\n\t});\n\n});\n"],
  "mappings": "AAKA,OAAO,YAAY;AACnB,SAAS,eAAe;AACxB,SAAS,yBAAyB;AAClC,SAAS,WAAW;AACpB,SAAS,YAAY;AACrB,SAAS,+CAA+C;AACxD,SAAS,sBAAsB;AAC/B,SAAS,kCAAkC;AAC3C,SAAS,0BAA0B;AACnC,SAAS,0BAA0B;AACnC,SAAS,gCAAgC;AAEzC,MAAM,sBAAsB,WAAY;AAEvC,MAAI;AACJ,MAAI;AACJ,QAAM,YAAY,oBAAI,IAAY;AAElC,0CAAwC;AAExC,QAAM,WAAY;AAEjB,cAAU,MAAM;AAEhB,sBAAkB,IAAI,cAAc,KAAiC,EAAE;AAAA,MAC7D,4BAA4B,QAAgB;AACpD,kBAAU,IAAI,MAAM;AAAA,MACrB;AAAA,IACD;AAEA,yBAAqB,IAAI;AAAA,MACxB,IAAI,cAAc,KAAyB,EAAE;AAAA,QACnC,WAAgB;AACxB,iBAAO;AAAA,QACR;AAAA,MACD;AAAA,MACA,IAAI,eAAe;AAAA,IACpB;AAAA,EACD,CAAC;AAED,OAAK,mCAAmC,iBAAkB;AAEzD,QAAI,UAAU;AACd,QAAI,UAAU;AAGd,uBAAmB,+BAA+B;AAAA,MAEjD,wBAAwB;AACvB,kBAAU;AACV,eAAO,IAAI,QAAQ,MAAM;AAAA,QAAE,CAAC;AAAA,MAC7B;AAAA,IACD,GAAG,wBAAwB;AAG3B,uBAAmB,+BAA+B;AAAA,MAEjD,wBAAwB;AACvB,kBAAU;AACV,eAAO,IAAI,QAAQ,aAAW,QAAQ,EAAE,OAAO,KAAK,SAAS,QAAQ,CAAC,CAAC;AAAA,MACxE;AAAA,IACD,GAAG,wBAAwB;AAG3B,UAAM,WAAW,CAAC,GAAG,UAAU,OAAO,CAAC,EAAE,IAAI,CAAC,QAAQ,QAAQ;AAC7D,aAAO,mBAAmB,oBAAoB,QAAQ,CAAC,EAAE,IAAI,KAAK,KAAK,IAAI,MAAM,cAAc,EAAE,CAAC,GAAG,kBAAkB,IAAI;AAAA,IAC5H,CAAC;AAED,WAAO,YAAY,SAAS,IAAI;AAChC,WAAO,YAAY,SAAS,IAAI;AAEhC,WAAO,YAAY,SAAS,QAAQ,CAAC;AACrC,UAAM,CAAC,OAAO,MAAM,IAAI;AAExB,UAAM,cAAc,MAAM,QAAQ,KAAK,CAAC,OAAO,QAAQ,EAAE,EAAE,KAAK,MAAM,KAAK,CAAC,CAAC;AAC7E,WAAO,YAAY,OAAO,aAAa,SAAS;AAEhD,UAAM,eAAe,MAAM,QAAQ,KAAK,CAAC,QAAQ,QAAQ,EAAE,EAAE,KAAK,MAAM,KAAK,CAAC,CAAC;AAC/E,WAAO,YAAY,OAAO,cAAc,QAAQ;AAGhD,UAAM,QAAQ,EAAE;AAAA,EACjB,CAAC;AAEF,CAAC;",
  "names": []
}
