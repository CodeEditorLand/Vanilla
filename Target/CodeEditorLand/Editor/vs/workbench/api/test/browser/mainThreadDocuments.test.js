import o from"assert";import{BoundModelReferenceCollection as d}from"../../browser/mainThreadDocuments.js";import{timeout as p}from"../../../../base/common/async.js";import{URI as t}from"../../../../base/common/uri.js";import{extUri as r}from"../../../../base/common/resources.js";import{ensureNoDisposablesAreLeakedInTestSuite as a}from"../../../../base/test/common/utils.js";suite("BoundModelReferenceCollection",function(){let s;setup(function(){s=new d(r,15,75)}),teardown(function(){s.dispose()}),a(),test("max age",async function(){let e=!1;s.add(t.parse("test://farboo"),{object:{},dispose(){e=!0}}),await p(30),o.strictEqual(e,!0)}),test("max size",function(){const e=[];s.add(t.parse("test://farboo"),{object:{},dispose(){e.push(0)}},6),s.add(t.parse("test://boofar"),{object:{},dispose(){e.push(1)}},6),s.add(t.parse("test://xxxxxxx"),{object:{},dispose(){e.push(2)}},70),o.deepStrictEqual(e,[0,1])}),test("max count",function(){s.dispose(),s=new d(r,1e4,1e4,2);const e=[];s.add(t.parse("test://xxxxxxx"),{object:{},dispose(){e.push(0)}}),s.add(t.parse("test://xxxxxxx"),{object:{},dispose(){e.push(1)}}),s.add(t.parse("test://xxxxxxx"),{object:{},dispose(){e.push(2)}}),o.deepStrictEqual(e,[0])}),test("dispose uri",function(){let e=[];s.add(t.parse("test:///farboo"),{object:{},dispose(){e.push(0)}}),s.add(t.parse("test:///boofar"),{object:{},dispose(){e.push(1)}}),s.add(t.parse("test:///boo/far1"),{object:{},dispose(){e.push(2)}}),s.add(t.parse("test:///boo/far2"),{object:{},dispose(){e.push(3)}}),s.add(t.parse("test:///boo1/far"),{object:{},dispose(){e.push(4)}}),s.remove(t.parse("test:///unknown")),o.strictEqual(e.length,0),s.remove(t.parse("test:///farboo")),o.deepStrictEqual(e,[0]),e=[],s.remove(t.parse("test:///boo")),o.deepStrictEqual(e,[2,3])})});
