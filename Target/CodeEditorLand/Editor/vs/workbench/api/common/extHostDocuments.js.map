{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostDocuments.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from \"vscode\";\nimport { Emitter, type Event } from \"../../../base/common/event.js\";\nimport { DisposableStore } from \"../../../base/common/lifecycle.js\";\nimport { deepFreeze } from \"../../../base/common/objects.js\";\nimport { assertIsDefined } from \"../../../base/common/types.js\";\nimport { URI, type UriComponents } from \"../../../base/common/uri.js\";\nimport type { IModelChangedEvent } from \"../../../editor/common/model/mirrorTextModel.js\";\nimport {\n\ttype ExtHostDocumentsShape,\n\ttype IMainContext,\n\tMainContext,\n\ttype MainThreadDocumentsShape,\n} from \"./extHost.protocol.js\";\nimport {\n\ttype ExtHostDocumentData,\n\tsetWordDefinitionFor,\n} from \"./extHostDocumentData.js\";\nimport type { ExtHostDocumentsAndEditors } from \"./extHostDocumentsAndEditors.js\";\nimport * as TypeConverters from \"./extHostTypeConverters.js\";\nimport { TextDocumentChangeReason } from \"./extHostTypes.js\";\n\nexport class ExtHostDocuments implements ExtHostDocumentsShape {\n\tprivate readonly _onDidAddDocument = new Emitter<vscode.TextDocument>();\n\tprivate readonly _onDidRemoveDocument = new Emitter<vscode.TextDocument>();\n\tprivate readonly _onDidChangeDocument =\n\t\tnew Emitter<vscode.TextDocumentChangeEvent>();\n\tprivate readonly _onDidSaveDocument = new Emitter<vscode.TextDocument>();\n\n\treadonly onDidAddDocument: Event<vscode.TextDocument> =\n\t\tthis._onDidAddDocument.event;\n\treadonly onDidRemoveDocument: Event<vscode.TextDocument> =\n\t\tthis._onDidRemoveDocument.event;\n\treadonly onDidChangeDocument: Event<vscode.TextDocumentChangeEvent> =\n\t\tthis._onDidChangeDocument.event;\n\treadonly onDidSaveDocument: Event<vscode.TextDocument> =\n\t\tthis._onDidSaveDocument.event;\n\n\tprivate readonly _toDispose = new DisposableStore();\n\tprivate _proxy: MainThreadDocumentsShape;\n\tprivate _documentsAndEditors: ExtHostDocumentsAndEditors;\n\tprivate _documentLoader = new Map<string, Promise<ExtHostDocumentData>>();\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tdocumentsAndEditors: ExtHostDocumentsAndEditors,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadDocuments);\n\t\tthis._documentsAndEditors = documentsAndEditors;\n\n\t\tthis._documentsAndEditors.onDidRemoveDocuments(\n\t\t\t(documents) => {\n\t\t\t\tfor (const data of documents) {\n\t\t\t\t\tthis._onDidRemoveDocument.fire(data.document);\n\t\t\t\t}\n\t\t\t},\n\t\t\tundefined,\n\t\t\tthis._toDispose,\n\t\t);\n\t\tthis._documentsAndEditors.onDidAddDocuments(\n\t\t\t(documents) => {\n\t\t\t\tfor (const data of documents) {\n\t\t\t\t\tthis._onDidAddDocument.fire(data.document);\n\t\t\t\t}\n\t\t\t},\n\t\t\tundefined,\n\t\t\tthis._toDispose,\n\t\t);\n\t}\n\n\tpublic dispose(): void {\n\t\tthis._toDispose.dispose();\n\t}\n\n\tpublic getAllDocumentData(): ExtHostDocumentData[] {\n\t\treturn [...this._documentsAndEditors.allDocuments()];\n\t}\n\n\tpublic getDocumentData(\n\t\tresource: vscode.Uri,\n\t): ExtHostDocumentData | undefined {\n\t\tif (!resource) {\n\t\t\treturn undefined;\n\t\t}\n\t\tconst data = this._documentsAndEditors.getDocument(resource);\n\t\tif (data) {\n\t\t\treturn data;\n\t\t}\n\t\treturn undefined;\n\t}\n\n\tpublic getDocument(resource: vscode.Uri): vscode.TextDocument {\n\t\tconst data = this.getDocumentData(resource);\n\t\tif (!data?.document) {\n\t\t\tthrow new Error(\n\t\t\t\t`Unable to retrieve document from URI '${resource}'`,\n\t\t\t);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tpublic ensureDocumentData(uri: URI): Promise<ExtHostDocumentData> {\n\t\tconst cached = this._documentsAndEditors.getDocument(uri);\n\t\tif (cached) {\n\t\t\treturn Promise.resolve(cached);\n\t\t}\n\n\t\tlet promise = this._documentLoader.get(uri.toString());\n\t\tif (!promise) {\n\t\t\tpromise = this._proxy.$tryOpenDocument(uri).then(\n\t\t\t\t(uriData) => {\n\t\t\t\t\tthis._documentLoader.delete(uri.toString());\n\t\t\t\t\tconst canonicalUri = URI.revive(uriData);\n\t\t\t\t\treturn assertIsDefined(\n\t\t\t\t\t\tthis._documentsAndEditors.getDocument(canonicalUri),\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\t(err) => {\n\t\t\t\t\tthis._documentLoader.delete(uri.toString());\n\t\t\t\t\treturn Promise.reject(err);\n\t\t\t\t},\n\t\t\t);\n\t\t\tthis._documentLoader.set(uri.toString(), promise);\n\t\t}\n\n\t\treturn promise;\n\t}\n\n\tpublic createDocumentData(options?: {\n\t\tlanguage?: string;\n\t\tcontent?: string;\n\t}): Promise<URI> {\n\t\treturn this._proxy\n\t\t\t.$tryCreateDocument(options)\n\t\t\t.then((data) => URI.revive(data));\n\t}\n\n\tpublic $acceptModelLanguageChanged(\n\t\turiComponents: UriComponents,\n\t\tnewLanguageId: string,\n\t): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(\"unknown document\");\n\t\t}\n\t\t// Treat a language change as a remove + add\n\n\t\tthis._onDidRemoveDocument.fire(data.document);\n\t\tdata._acceptLanguageId(newLanguageId);\n\t\tthis._onDidAddDocument.fire(data.document);\n\t}\n\n\tpublic $acceptModelSaved(uriComponents: UriComponents): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(\"unknown document\");\n\t\t}\n\t\tthis.$acceptDirtyStateChanged(uriComponents, false);\n\t\tthis._onDidSaveDocument.fire(data.document);\n\t}\n\n\tpublic $acceptDirtyStateChanged(\n\t\turiComponents: UriComponents,\n\t\tisDirty: boolean,\n\t): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(\"unknown document\");\n\t\t}\n\t\tdata._acceptIsDirty(isDirty);\n\t\tthis._onDidChangeDocument.fire({\n\t\t\tdocument: data.document,\n\t\t\tcontentChanges: [],\n\t\t\treason: undefined,\n\t\t});\n\t}\n\n\tpublic $acceptModelChanged(\n\t\turiComponents: UriComponents,\n\t\tevents: IModelChangedEvent,\n\t\tisDirty: boolean,\n\t): void {\n\t\tconst uri = URI.revive(uriComponents);\n\t\tconst data = this._documentsAndEditors.getDocument(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(\"unknown document\");\n\t\t}\n\t\tdata._acceptIsDirty(isDirty);\n\t\tdata.onEvents(events);\n\n\t\tlet reason: vscode.TextDocumentChangeReason | undefined;\n\t\tif (events.isUndoing) {\n\t\t\treason = TextDocumentChangeReason.Undo;\n\t\t} else if (events.isRedoing) {\n\t\t\treason = TextDocumentChangeReason.Redo;\n\t\t}\n\n\t\tthis._onDidChangeDocument.fire(\n\t\t\tdeepFreeze({\n\t\t\t\tdocument: data.document,\n\t\t\t\tcontentChanges: events.changes.map((change) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\trange: TypeConverters.Range.to(change.range),\n\t\t\t\t\t\trangeOffset: change.rangeOffset,\n\t\t\t\t\t\trangeLength: change.rangeLength,\n\t\t\t\t\t\ttext: change.text,\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\treason,\n\t\t\t}),\n\t\t);\n\t}\n\n\tpublic setWordDefinitionFor(\n\t\tlanguageId: string,\n\t\twordDefinition: RegExp | undefined,\n\t): void {\n\t\tsetWordDefinitionFor(languageId, wordDefinition);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
