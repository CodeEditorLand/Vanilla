import"../../../../vs/base/common/cancellation.js";import{toDisposable as h}from"../../../../vs/base/common/lifecycle.js";import{Schemas as s}from"../../../../vs/base/common/network.js";import{URI as i}from"../../../../vs/base/common/uri.js";import"../../../../vs/editor/common/languages.js";import"../../../../vs/platform/extensions/common/extensions.js";import{MainContext as c}from"./extHost.protocol.js";class p{static supportedSchemes=new Set([s.http,s.https]);_proxy;_openers=new Map;constructor(r){this._proxy=r.getProxy(c.MainThreadUriOpeners)}registerExternalUriOpener(r,e,o,n){if(this._openers.has(e))throw new Error(`Opener with id '${e}' already registered`);const t=n.schemes.find(a=>!p.supportedSchemes.has(a));if(t)throw new Error(`Scheme '${t}' is not supported. Only http and https are currently supported.`);return this._openers.set(e,o),this._proxy.$registerUriOpener(e,n.schemes,r,n.label),h(()=>{this._openers.delete(e),this._proxy.$unregisterUriOpener(e)})}async $canOpenUri(r,e,o){const n=this._openers.get(r);if(!n)throw new Error(`Unknown opener with id: ${r}`);const t=i.revive(e);return n.canOpenExternalUri(t,o)}async $openUri(r,e,o){const n=this._openers.get(r);if(!n)throw new Error(`Unknown opener id: '${r}'`);return n.openExternalUri(i.revive(e.resolvedUri),{sourceUri:i.revive(e.sourceUri)},o)}}export{p as ExtHostUriOpeners};
