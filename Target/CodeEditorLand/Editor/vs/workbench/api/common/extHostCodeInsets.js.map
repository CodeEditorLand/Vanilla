{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostCodeInsets.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Emitter } from '../../../base/common/event.js';\nimport { DisposableStore } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostTextEditor } from './extHostTextEditor.js';\nimport { ExtHostEditors } from './extHostTextEditors.js';\nimport { asWebviewUri, webviewGenericCspSource, WebviewRemoteInfo } from '../../contrib/webview/common/webview.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostEditorInsetsShape, MainThreadEditorInsetsShape } from './extHost.protocol.js';\n\nexport class ExtHostEditorInsets implements ExtHostEditorInsetsShape {\n\n\tprivate _handlePool = 0;\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate _insets = new Map<number, { editor: vscode.TextEditor; inset: vscode.WebviewEditorInset; onDidReceiveMessage: Emitter<any> }>();\n\n\tconstructor(\n\t\tprivate readonly _proxy: MainThreadEditorInsetsShape,\n\t\tprivate readonly _editors: ExtHostEditors,\n\t\tprivate readonly _remoteInfo: WebviewRemoteInfo\n\t) {\n\n\t\t// dispose editor inset whenever the hosting editor goes away\n\t\tthis._disposables.add(_editors.onDidChangeVisibleTextEditors(() => {\n\t\t\tconst visibleEditor = _editors.getVisibleTextEditors();\n\t\t\tfor (const value of this._insets.values()) {\n\t\t\t\tif (visibleEditor.indexOf(value.editor) < 0) {\n\t\t\t\t\tvalue.inset.dispose(); // will remove from `this._insets`\n\t\t\t\t}\n\t\t\t}\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._insets.forEach(value => value.inset.dispose());\n\t\tthis._disposables.dispose();\n\t}\n\n\tcreateWebviewEditorInset(editor: vscode.TextEditor, line: number, height: number, options: vscode.WebviewOptions | undefined, extension: IExtensionDescription): vscode.WebviewEditorInset {\n\n\t\tlet apiEditor: ExtHostTextEditor | undefined;\n\t\tfor (const candidate of this._editors.getVisibleTextEditors(true)) {\n\t\t\tif (candidate.value === editor) {\n\t\t\t\tapiEditor = <ExtHostTextEditor>candidate;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!apiEditor) {\n\t\t\tthrow new Error('not a visible editor');\n\t\t}\n\n\t\tconst that = this;\n\t\tconst handle = this._handlePool++;\n\t\tconst onDidReceiveMessage = new Emitter<any>();\n\t\tconst onDidDispose = new Emitter<void>();\n\n\t\tconst webview = new class implements vscode.Webview {\n\n\t\t\tprivate _html: string = '';\n\t\t\tprivate _options: vscode.WebviewOptions = Object.create(null);\n\n\t\t\tasWebviewUri(resource: vscode.Uri): vscode.Uri {\n\t\t\t\treturn asWebviewUri(resource, that._remoteInfo);\n\t\t\t}\n\n\t\t\tget cspSource(): string {\n\t\t\t\treturn webviewGenericCspSource;\n\t\t\t}\n\n\t\t\tset options(value: vscode.WebviewOptions) {\n\t\t\t\tthis._options = value;\n\t\t\t\tthat._proxy.$setOptions(handle, value);\n\t\t\t}\n\n\t\t\tget options(): vscode.WebviewOptions {\n\t\t\t\treturn this._options;\n\t\t\t}\n\n\t\t\tset html(value: string) {\n\t\t\t\tthis._html = value;\n\t\t\t\tthat._proxy.$setHtml(handle, value);\n\t\t\t}\n\n\t\t\tget html(): string {\n\t\t\t\treturn this._html;\n\t\t\t}\n\n\t\t\tget onDidReceiveMessage(): vscode.Event<any> {\n\t\t\t\treturn onDidReceiveMessage.event;\n\t\t\t}\n\n\t\t\tpostMessage(message: any): Thenable<boolean> {\n\t\t\t\treturn that._proxy.$postMessage(handle, message);\n\t\t\t}\n\t\t};\n\n\t\tconst inset = new class implements vscode.WebviewEditorInset {\n\n\t\t\treadonly editor: vscode.TextEditor = editor;\n\t\t\treadonly line: number = line;\n\t\t\treadonly height: number = height;\n\t\t\treadonly webview: vscode.Webview = webview;\n\t\t\treadonly onDidDispose: vscode.Event<void> = onDidDispose.event;\n\n\t\t\tdispose(): void {\n\t\t\t\tif (that._insets.has(handle)) {\n\t\t\t\t\tthat._insets.delete(handle);\n\t\t\t\t\tthat._proxy.$disposeEditorInset(handle);\n\t\t\t\t\tonDidDispose.fire();\n\n\t\t\t\t\t// final cleanup\n\t\t\t\t\tonDidDispose.dispose();\n\t\t\t\t\tonDidReceiveMessage.dispose();\n\t\t\t\t}\n\t\t\t}\n\t\t};\n\n\t\tthis._proxy.$createEditorInset(handle, apiEditor.id, apiEditor.value.document.uri, line + 1, height, options || {}, extension.identifier, extension.extensionLocation);\n\t\tthis._insets.set(handle, { editor, inset, onDidReceiveMessage });\n\n\t\treturn inset;\n\t}\n\n\t$onDidDispose(handle: number): void {\n\t\tconst value = this._insets.get(handle);\n\t\tif (value) {\n\t\t\tvalue.inset.dispose();\n\t\t}\n\t}\n\n\t$onDidReceiveMessage(handle: number, message: any): void {\n\t\tconst value = this._insets.get(handle);\n\t\tvalue?.onDidReceiveMessage.fire(message);\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
