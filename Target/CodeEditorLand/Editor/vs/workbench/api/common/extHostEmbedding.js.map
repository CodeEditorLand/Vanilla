{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostEmbedding.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { CancellationToken } from '../../../base/common/cancellation.js';\nimport { Emitter, Event } from '../../../base/common/event.js';\nimport { IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { ExtHostEmbeddingsShape, IMainContext, MainContext, MainThreadEmbeddingsShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\n\n\nexport class ExtHostEmbeddings implements ExtHostEmbeddingsShape {\n\n\tprivate readonly _proxy: MainThreadEmbeddingsShape;\n\tprivate readonly _provider = new Map<number, { id: string; provider: vscode.EmbeddingsProvider }>();\n\n\tprivate readonly _onDidChange = new Emitter<void>();\n\treadonly onDidChange: Event<void> = this._onDidChange.event;\n\n\tprivate _allKnownModels = new Set<string>();\n\tprivate _handlePool: number = 0;\n\n\tconstructor(\n\t\tmainContext: IMainContext\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadEmbeddings);\n\t}\n\n\tregisterEmbeddingsProvider(_extension: IExtensionDescription, embeddingsModel: string, provider: vscode.EmbeddingsProvider): IDisposable {\n\t\tif (this._allKnownModels.has(embeddingsModel)) {\n\t\t\tthrow new Error('An embeddings provider for this model is already registered');\n\t\t}\n\n\t\tconst handle = this._handlePool++;\n\n\t\tthis._proxy.$registerEmbeddingProvider(handle, embeddingsModel);\n\t\tthis._provider.set(handle, { id: embeddingsModel, provider });\n\n\t\treturn toDisposable(() => {\n\t\t\tthis._allKnownModels.delete(embeddingsModel);\n\t\t\tthis._proxy.$unregisterEmbeddingProvider(handle);\n\t\t\tthis._provider.delete(handle);\n\t\t});\n\t}\n\n\tasync computeEmbeddings(embeddingsModel: string, input: string, token?: vscode.CancellationToken): Promise<vscode.Embedding>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[]>;\n\tasync computeEmbeddings(embeddingsModel: string, input: string | string[], token?: vscode.CancellationToken): Promise<vscode.Embedding[] | vscode.Embedding> {\n\n\t\ttoken ??= CancellationToken.None;\n\n\t\tlet returnSingle = false;\n\t\tif (typeof input === 'string') {\n\t\t\tinput = [input];\n\t\t\treturnSingle = true;\n\t\t}\n\t\tconst result = await this._proxy.$computeEmbeddings(embeddingsModel, input, token);\n\t\tif (result.length !== input.length) {\n\t\t\tthrow new Error();\n\t\t}\n\t\tif (returnSingle) {\n\t\t\tif (result.length !== 1) {\n\t\t\t\tthrow new Error();\n\t\t\t}\n\t\t\treturn result[0];\n\t\t}\n\t\treturn result;\n\n\t}\n\n\tasync $provideEmbeddings(handle: number, input: string[], token: CancellationToken): Promise<{ values: number[] }[]> {\n\t\tconst data = this._provider.get(handle);\n\t\tif (!data) {\n\t\t\treturn [];\n\t\t}\n\t\tconst result = await data.provider.provideEmbeddings(input, token);\n\t\tif (!result) {\n\t\t\treturn [];\n\t\t}\n\t\treturn result;\n\t}\n\n\tget embeddingsModels(): string[] {\n\t\treturn Array.from(this._allKnownModels);\n\t}\n\n\t$acceptEmbeddingModels(models: string[]): void {\n\t\tthis._allKnownModels = new Set(models);\n\t\tthis._onDidChange.fire();\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,yBAAyB;AAClC,SAAS,SAAS,aAAa;AAC/B,SAAS,aAAa,oBAAoB;AAC1C,SAAS,6BAA6B;AACtC,SAAS,wBAAwB,cAAc,aAAa,iCAAiC;AAItF,MAAM,kBAAoD;AAAA,EAbjE,OAaiE;AAAA;AAAA;AAAA,EAE/C;AAAA,EACA,YAAY,oBAAI,IAAiE;AAAA,EAEjF,eAAe,IAAI,QAAc;AAAA,EACzC,cAA2B,KAAK,aAAa;AAAA,EAE9C,kBAAkB,oBAAI,IAAY;AAAA,EAClC,cAAsB;AAAA,EAE9B,YACC,aACC;AACD,SAAK,SAAS,YAAY,SAAS,YAAY,oBAAoB;AAAA,EACpE;AAAA,EAEA,2BAA2B,YAAmC,iBAAyB,UAAkD;AACxI,QAAI,KAAK,gBAAgB,IAAI,eAAe,GAAG;AAC9C,YAAM,IAAI,MAAM,6DAA6D;AAAA,IAC9E;AAEA,UAAM,SAAS,KAAK;AAEpB,SAAK,OAAO,2BAA2B,QAAQ,eAAe;AAC9D,SAAK,UAAU,IAAI,QAAQ,EAAE,IAAI,iBAAiB,SAAS,CAAC;AAE5D,WAAO,aAAa,MAAM;AACzB,WAAK,gBAAgB,OAAO,eAAe;AAC3C,WAAK,OAAO,6BAA6B,MAAM;AAC/C,WAAK,UAAU,OAAO,MAAM;AAAA,IAC7B,CAAC;AAAA,EACF;AAAA,EAIA,MAAM,kBAAkB,iBAAyB,OAA0B,OAAkF;AAE5J,cAAU,kBAAkB;AAE5B,QAAI,eAAe;AACnB,QAAI,OAAO,UAAU,UAAU;AAC9B,cAAQ,CAAC,KAAK;AACd,qBAAe;AAAA,IAChB;AACA,UAAM,SAAS,MAAM,KAAK,OAAO,mBAAmB,iBAAiB,OAAO,KAAK;AACjF,QAAI,OAAO,WAAW,MAAM,QAAQ;AACnC,YAAM,IAAI,MAAM;AAAA,IACjB;AACA,QAAI,cAAc;AACjB,UAAI,OAAO,WAAW,GAAG;AACxB,cAAM,IAAI,MAAM;AAAA,MACjB;AACA,aAAO,OAAO,CAAC;AAAA,IAChB;AACA,WAAO;AAAA,EAER;AAAA,EAEA,MAAM,mBAAmB,QAAgB,OAAiB,OAA2D;AACpH,UAAM,OAAO,KAAK,UAAU,IAAI,MAAM;AACtC,QAAI,CAAC,MAAM;AACV,aAAO,CAAC;AAAA,IACT;AACA,UAAM,SAAS,MAAM,KAAK,SAAS,kBAAkB,OAAO,KAAK;AACjE,QAAI,CAAC,QAAQ;AACZ,aAAO,CAAC;AAAA,IACT;AACA,WAAO;AAAA,EACR;AAAA,EAEA,IAAI,mBAA6B;AAChC,WAAO,MAAM,KAAK,KAAK,eAAe;AAAA,EACvC;AAAA,EAEA,uBAAuB,QAAwB;AAC9C,SAAK,kBAAkB,IAAI,IAAI,MAAM;AACrC,SAAK,aAAa,KAAK;AAAA,EACxB;AACD;",
  "names": []
}
