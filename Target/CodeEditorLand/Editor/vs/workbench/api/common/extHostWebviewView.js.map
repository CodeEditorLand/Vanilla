{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostWebviewView.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from \"vscode\";\nimport type { CancellationToken } from \"../../../base/common/cancellation.js\";\nimport { Emitter } from \"../../../base/common/event.js\";\nimport { Disposable } from \"../../../base/common/lifecycle.js\";\nimport type { IExtensionDescription } from \"../../../platform/extensions/common/extensions.js\";\nimport * as extHostProtocol from \"./extHost.protocol.js\";\nimport { ViewBadge } from \"./extHostTypeConverters.js\";\nimport * as extHostTypes from \"./extHostTypes.js\";\nimport {\n\ttype ExtHostWebview,\n\ttype ExtHostWebviews,\n\tshouldSerializeBuffersForPostMessage,\n\ttoExtensionData,\n} from \"./extHostWebview.js\";\n\n/* eslint-disable local/code-no-native-private */\n\nclass ExtHostWebviewView extends Disposable implements vscode.WebviewView {\n\treadonly #handle: extHostProtocol.WebviewHandle;\n\treadonly #proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\treadonly #viewType: string;\n\treadonly #webview: ExtHostWebview;\n\n\t#isDisposed = false;\n\t#isVisible: boolean;\n\t#title: string | undefined;\n\t#description: string | undefined;\n\t#badge: vscode.ViewBadge | undefined;\n\n\tconstructor(\n\t\thandle: extHostProtocol.WebviewHandle,\n\t\tproxy: extHostProtocol.MainThreadWebviewViewsShape,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\twebview: ExtHostWebview,\n\t\tisVisible: boolean,\n\t) {\n\t\tsuper();\n\n\t\tthis.#viewType = viewType;\n\t\tthis.#title = title;\n\t\tthis.#handle = handle;\n\t\tthis.#proxy = proxy;\n\t\tthis.#webview = webview;\n\t\tthis.#isVisible = isVisible;\n\t}\n\n\tpublic override dispose() {\n\t\tif (this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isDisposed = true;\n\t\tthis.#onDidDispose.fire();\n\n\t\tthis.#webview.dispose();\n\n\t\tsuper.dispose();\n\t}\n\n\treadonly #onDidChangeVisibility = this._register(new Emitter<void>());\n\tpublic readonly onDidChangeVisibility = this.#onDidChangeVisibility.event;\n\n\treadonly #onDidDispose = this._register(new Emitter<void>());\n\tpublic readonly onDidDispose = this.#onDidDispose.event;\n\n\tpublic get title(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#title;\n\t}\n\n\tpublic set title(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#title !== value) {\n\t\t\tthis.#title = value;\n\t\t\tthis.#proxy.$setWebviewViewTitle(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get description(): string | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#description;\n\t}\n\n\tpublic set description(value: string | undefined) {\n\t\tthis.assertNotDisposed();\n\t\tif (this.#description !== value) {\n\t\t\tthis.#description = value;\n\t\t\tthis.#proxy.$setWebviewViewDescription(this.#handle, value);\n\t\t}\n\t}\n\n\tpublic get visible(): boolean {\n\t\treturn this.#isVisible;\n\t}\n\n\tpublic get webview(): vscode.Webview {\n\t\treturn this.#webview;\n\t}\n\n\tpublic get viewType(): string {\n\t\treturn this.#viewType;\n\t}\n\n\t/* internal */ _setVisible(visible: boolean) {\n\t\tif (visible === this.#isVisible || this.#isDisposed) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#isVisible = visible;\n\t\tthis.#onDidChangeVisibility.fire();\n\t}\n\n\tpublic get badge(): vscode.ViewBadge | undefined {\n\t\tthis.assertNotDisposed();\n\t\treturn this.#badge;\n\t}\n\n\tpublic set badge(badge: vscode.ViewBadge | undefined) {\n\t\tthis.assertNotDisposed();\n\n\t\tif (\n\t\t\tbadge?.value === this.#badge?.value &&\n\t\t\tbadge?.tooltip === this.#badge?.tooltip\n\t\t) {\n\t\t\treturn;\n\t\t}\n\n\t\tthis.#badge = ViewBadge.from(badge);\n\t\tthis.#proxy.$setWebviewViewBadge(this.#handle, badge);\n\t}\n\n\tpublic show(preserveFocus?: boolean): void {\n\t\tthis.assertNotDisposed();\n\t\tthis.#proxy.$show(this.#handle, !!preserveFocus);\n\t}\n\n\tprivate assertNotDisposed() {\n\t\tif (this.#isDisposed) {\n\t\t\tthrow new Error(\"Webview is disposed\");\n\t\t}\n\t}\n}\n\nexport class ExtHostWebviewViews\n\timplements extHostProtocol.ExtHostWebviewViewsShape\n{\n\tprivate readonly _proxy: extHostProtocol.MainThreadWebviewViewsShape;\n\n\tprivate readonly _viewProviders = new Map<\n\t\tstring,\n\t\t{\n\t\t\treadonly provider: vscode.WebviewViewProvider;\n\t\t\treadonly extension: IExtensionDescription;\n\t\t}\n\t>();\n\n\tprivate readonly _webviewViews = new Map<\n\t\textHostProtocol.WebviewHandle,\n\t\tExtHostWebviewView\n\t>();\n\n\tconstructor(\n\t\tmainContext: extHostProtocol.IMainContext,\n\t\tprivate readonly _extHostWebview: ExtHostWebviews,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(\n\t\t\textHostProtocol.MainContext.MainThreadWebviewViews,\n\t\t);\n\t}\n\n\tpublic registerWebviewViewProvider(\n\t\textension: IExtensionDescription,\n\t\tviewType: string,\n\t\tprovider: vscode.WebviewViewProvider,\n\t\twebviewOptions?: {\n\t\t\tretainContextWhenHidden?: boolean;\n\t\t},\n\t): vscode.Disposable {\n\t\tif (this._viewProviders.has(viewType)) {\n\t\t\tthrow new Error(\n\t\t\t\t`View provider for '${viewType}' already registered`,\n\t\t\t);\n\t\t}\n\n\t\tthis._viewProviders.set(viewType, { provider, extension });\n\t\tthis._proxy.$registerWebviewViewProvider(\n\t\t\ttoExtensionData(extension),\n\t\t\tviewType,\n\t\t\t{\n\t\t\t\tretainContextWhenHidden:\n\t\t\t\t\twebviewOptions?.retainContextWhenHidden,\n\t\t\t\tserializeBuffersForPostMessage:\n\t\t\t\t\tshouldSerializeBuffersForPostMessage(extension),\n\t\t\t},\n\t\t);\n\n\t\treturn new extHostTypes.Disposable(() => {\n\t\t\tthis._viewProviders.delete(viewType);\n\t\t\tthis._proxy.$unregisterWebviewViewProvider(viewType);\n\t\t});\n\t}\n\n\tasync $resolveWebviewView(\n\t\twebviewHandle: string,\n\t\tviewType: string,\n\t\ttitle: string | undefined,\n\t\tstate: any,\n\t\tcancellation: CancellationToken,\n\t): Promise<void> {\n\t\tconst entry = this._viewProviders.get(viewType);\n\t\tif (!entry) {\n\t\t\tthrow new Error(`No view provider found for '${viewType}'`);\n\t\t}\n\n\t\tconst { provider, extension } = entry;\n\n\t\tconst webview = this._extHostWebview.createNewWebview(\n\t\t\twebviewHandle,\n\t\t\t{\n\t\t\t\t/* todo */\n\t\t\t},\n\t\t\textension,\n\t\t);\n\t\tconst revivedView = new ExtHostWebviewView(\n\t\t\twebviewHandle,\n\t\t\tthis._proxy,\n\t\t\tviewType,\n\t\t\ttitle,\n\t\t\twebview,\n\t\t\ttrue,\n\t\t);\n\n\t\tthis._webviewViews.set(webviewHandle, revivedView);\n\n\t\tawait provider.resolveWebviewView(revivedView, { state }, cancellation);\n\t}\n\n\tasync $onDidChangeWebviewViewVisibility(\n\t\twebviewHandle: string,\n\t\tvisible: boolean,\n\t) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\twebviewView._setVisible(visible);\n\t}\n\n\tasync $disposeWebviewView(webviewHandle: string) {\n\t\tconst webviewView = this.getWebviewView(webviewHandle);\n\t\tthis._webviewViews.delete(webviewHandle);\n\t\twebviewView.dispose();\n\n\t\tthis._extHostWebview.deleteWebview(webviewHandle);\n\t}\n\n\tprivate getWebviewView(handle: string): ExtHostWebviewView {\n\t\tconst entry = this._webviewViews.get(handle);\n\t\tif (!entry) {\n\t\t\tthrow new Error(\"No webview found\");\n\t\t}\n\t\treturn entry;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
