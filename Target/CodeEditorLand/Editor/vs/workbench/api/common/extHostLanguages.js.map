{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostLanguages.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as vscode from \"vscode\";\nimport { disposableTimeout } from \"../../../base/common/async.js\";\nimport {\n\tDisposableStore,\n\ttype IDisposable,\n} from \"../../../base/common/lifecycle.js\";\nimport Severity from \"../../../base/common/severity.js\";\nimport type { IURITransformer } from \"../../../base/common/uriIpc.js\";\nimport type { IExtensionDescription } from \"../../../platform/extensions/common/extensions.js\";\nimport { checkProposedApiEnabled } from \"../../services/extensions/common/extensions.js\";\nimport {\n\ttype ExtHostLanguagesShape,\n\ttype IMainContext,\n\tMainContext,\n\ttype MainThreadLanguagesShape,\n} from \"./extHost.protocol.js\";\nimport type { CommandsConverter } from \"./extHostCommands.js\";\nimport type { ExtHostDocuments } from \"./extHostDocuments.js\";\nimport * as typeConvert from \"./extHostTypeConverters.js\";\nimport {\n\tLanguageStatusSeverity,\n\ttype Position,\n\tRange,\n\tStandardTokenType,\n} from \"./extHostTypes.js\";\n\nexport class ExtHostLanguages implements ExtHostLanguagesShape {\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\n\tprivate _languageIds: string[] = [];\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _uriTransformer: IURITransformer | undefined,\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t}\n\n\t$acceptLanguageIds(ids: string[]): void {\n\t\tthis._languageIds = ids;\n\t}\n\n\tasync getLanguages(): Promise<string[]> {\n\t\treturn this._languageIds.slice(0);\n\t}\n\n\tasync changeLanguage(\n\t\turi: vscode.Uri,\n\t\tlanguageId: string,\n\t): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString()}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(\n\t\tdocument: vscode.TextDocument,\n\t\tposition: vscode.Position,\n\t): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange:\n\t\t\t\tdocument.getWordRangeAtPosition(position) ??\n\t\t\t\tnew Range(\n\t\t\t\t\tposition.line,\n\t\t\t\t\tposition.character,\n\t\t\t\t\tposition.line,\n\t\t\t\t\tposition.character,\n\t\t\t\t),\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type),\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _handlePool = 0;\n\tprivate _ids = new Set<string>();\n\n\tcreateLanguageStatusItem(\n\t\textension: IExtensionDescription,\n\t\tid: string,\n\t\tselector: vscode.DocumentSelector,\n\t): vscode.LanguageStatusItem {\n\t\tconst handle = this._handlePool++;\n\t\tconst proxy = this._proxy;\n\t\tconst ids = this._ids;\n\n\t\t// enforce extension unique identifier\n\t\tconst fullyQualifiedId = `${extension.identifier.value}/${id}`;\n\t\tif (ids.has(fullyQualifiedId)) {\n\t\t\tthrow new Error(\n\t\t\t\t`LanguageStatusItem with id '${id}' ALREADY exists`,\n\t\t\t);\n\t\t}\n\t\tids.add(fullyQualifiedId);\n\n\t\tconst data: Omit<vscode.LanguageStatusItem, \"dispose\" | \"text2\"> = {\n\t\t\tselector,\n\t\t\tid,\n\t\t\tname: extension.displayName ?? extension.name,\n\t\t\tseverity: LanguageStatusSeverity.Information,\n\t\t\tcommand: undefined,\n\t\t\ttext: \"\",\n\t\t\tdetail: \"\",\n\t\t\tbusy: false,\n\t\t};\n\n\t\tlet soonHandle: IDisposable | undefined;\n\t\tconst commandDisposables = new DisposableStore();\n\t\tconst updateAsync = () => {\n\t\t\tsoonHandle?.dispose();\n\n\t\t\tif (!ids.has(fullyQualifiedId)) {\n\t\t\t\tconsole.warn(\n\t\t\t\t\t`LanguageStatusItem (${id}) from ${extension.identifier.value} has been disposed and CANNOT be updated anymore`,\n\t\t\t\t);\n\t\t\t\treturn; // disposed in the meantime\n\t\t\t}\n\n\t\t\tsoonHandle = disposableTimeout(() => {\n\t\t\t\tcommandDisposables.clear();\n\t\t\t\tthis._proxy.$setLanguageStatus(handle, {\n\t\t\t\t\tid: fullyQualifiedId,\n\t\t\t\t\tname: data.name ?? extension.displayName ?? extension.name,\n\t\t\t\t\tsource: extension.displayName ?? extension.name,\n\t\t\t\t\tselector: typeConvert.DocumentSelector.from(\n\t\t\t\t\t\tdata.selector,\n\t\t\t\t\t\tthis._uriTransformer,\n\t\t\t\t\t),\n\t\t\t\t\tlabel: data.text,\n\t\t\t\t\tdetail: data.detail ?? \"\",\n\t\t\t\t\tseverity:\n\t\t\t\t\t\tdata.severity === LanguageStatusSeverity.Error\n\t\t\t\t\t\t\t? Severity.Error\n\t\t\t\t\t\t\t: data.severity === LanguageStatusSeverity.Warning\n\t\t\t\t\t\t\t\t? Severity.Warning\n\t\t\t\t\t\t\t\t: Severity.Info,\n\t\t\t\t\tcommand:\n\t\t\t\t\t\tdata.command &&\n\t\t\t\t\t\tthis._commands.toInternal(\n\t\t\t\t\t\t\tdata.command,\n\t\t\t\t\t\t\tcommandDisposables,\n\t\t\t\t\t\t),\n\t\t\t\t\taccessibilityInfo: data.accessibilityInformation,\n\t\t\t\t\tbusy: data.busy,\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t};\n\n\t\tconst result: vscode.LanguageStatusItem = {\n\t\t\tdispose() {\n\t\t\t\tcommandDisposables.dispose();\n\t\t\t\tsoonHandle?.dispose();\n\t\t\t\tproxy.$removeLanguageStatus(handle);\n\t\t\t\tids.delete(fullyQualifiedId);\n\t\t\t},\n\t\t\tget id() {\n\t\t\t\treturn data.id;\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn data.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tdata.name = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget selector() {\n\t\t\t\treturn data.selector;\n\t\t\t},\n\t\t\tset selector(value) {\n\t\t\t\tdata.selector = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tset text(value) {\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tset text2(value) {\n\t\t\t\tcheckProposedApiEnabled(extension, \"languageStatusText\");\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text2() {\n\t\t\t\tcheckProposedApiEnabled(extension, \"languageStatusText\");\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tget detail() {\n\t\t\t\treturn data.detail;\n\t\t\t},\n\t\t\tset detail(value) {\n\t\t\t\tdata.detail = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget severity() {\n\t\t\t\treturn data.severity;\n\t\t\t},\n\t\t\tset severity(value) {\n\t\t\t\tdata.severity = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget accessibilityInformation() {\n\t\t\t\treturn data.accessibilityInformation;\n\t\t\t},\n\t\t\tset accessibilityInformation(value) {\n\t\t\t\tdata.accessibilityInformation = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget command() {\n\t\t\t\treturn data.command;\n\t\t\t},\n\t\t\tset command(value) {\n\t\t\t\tdata.command = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget busy() {\n\t\t\t\treturn data.busy;\n\t\t\t},\n\t\t\tset busy(value: boolean) {\n\t\t\t\tdata.busy = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t};\n\t\tupdateAsync();\n\t\treturn result;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
