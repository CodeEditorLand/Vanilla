{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/common/extHostLanguages.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { MainContext, MainThreadLanguagesShape, IMainContext, ExtHostLanguagesShape } from './extHost.protocol.js';\nimport type * as vscode from 'vscode';\nimport { ExtHostDocuments } from './extHostDocuments.js';\nimport * as typeConvert from './extHostTypeConverters.js';\nimport { StandardTokenType, Range, Position, LanguageStatusSeverity } from './extHostTypes.js';\nimport Severity from '../../../base/common/severity.js';\nimport { disposableTimeout } from '../../../base/common/async.js';\nimport { DisposableStore, IDisposable } from '../../../base/common/lifecycle.js';\nimport { IExtensionDescription } from '../../../platform/extensions/common/extensions.js';\nimport { CommandsConverter } from './extHostCommands.js';\nimport { IURITransformer } from '../../../base/common/uriIpc.js';\nimport { checkProposedApiEnabled } from '../../services/extensions/common/extensions.js';\n\nexport class ExtHostLanguages implements ExtHostLanguagesShape {\n\n\tprivate readonly _proxy: MainThreadLanguagesShape;\n\n\tprivate _languageIds: string[] = [];\n\n\tconstructor(\n\t\tmainContext: IMainContext,\n\t\tprivate readonly _documents: ExtHostDocuments,\n\t\tprivate readonly _commands: CommandsConverter,\n\t\tprivate readonly _uriTransformer: IURITransformer | undefined\n\t) {\n\t\tthis._proxy = mainContext.getProxy(MainContext.MainThreadLanguages);\n\t}\n\n\t$acceptLanguageIds(ids: string[]): void {\n\t\tthis._languageIds = ids;\n\t}\n\n\tasync getLanguages(): Promise<string[]> {\n\t\treturn this._languageIds.slice(0);\n\t}\n\n\tasync changeLanguage(uri: vscode.Uri, languageId: string): Promise<vscode.TextDocument> {\n\t\tawait this._proxy.$changeLanguage(uri, languageId);\n\t\tconst data = this._documents.getDocumentData(uri);\n\t\tif (!data) {\n\t\t\tthrow new Error(`document '${uri.toString()}' NOT found`);\n\t\t}\n\t\treturn data.document;\n\t}\n\n\tasync tokenAtPosition(document: vscode.TextDocument, position: vscode.Position): Promise<vscode.TokenInformation> {\n\t\tconst versionNow = document.version;\n\t\tconst pos = typeConvert.Position.from(position);\n\t\tconst info = await this._proxy.$tokensAtPosition(document.uri, pos);\n\t\tconst defaultRange = {\n\t\t\ttype: StandardTokenType.Other,\n\t\t\trange: document.getWordRangeAtPosition(position) ?? new Range(position.line, position.character, position.line, position.character)\n\t\t};\n\t\tif (!info) {\n\t\t\t// no result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tconst result = {\n\t\t\trange: typeConvert.Range.to(info.range),\n\t\t\ttype: typeConvert.TokenType.to(info.type)\n\t\t};\n\t\tif (!result.range.contains(<Position>position)) {\n\t\t\t// bogous result\n\t\t\treturn defaultRange;\n\t\t}\n\t\tif (versionNow !== document.version) {\n\t\t\t// concurrent change\n\t\t\treturn defaultRange;\n\t\t}\n\t\treturn result;\n\t}\n\n\tprivate _handlePool: number = 0;\n\tprivate _ids = new Set<string>();\n\n\tcreateLanguageStatusItem(extension: IExtensionDescription, id: string, selector: vscode.DocumentSelector): vscode.LanguageStatusItem {\n\n\t\tconst handle = this._handlePool++;\n\t\tconst proxy = this._proxy;\n\t\tconst ids = this._ids;\n\n\t\t// enforce extension unique identifier\n\t\tconst fullyQualifiedId = `${extension.identifier.value}/${id}`;\n\t\tif (ids.has(fullyQualifiedId)) {\n\t\t\tthrow new Error(`LanguageStatusItem with id '${id}' ALREADY exists`);\n\t\t}\n\t\tids.add(fullyQualifiedId);\n\n\t\tconst data: Omit<vscode.LanguageStatusItem, 'dispose' | 'text2'> = {\n\t\t\tselector,\n\t\t\tid,\n\t\t\tname: extension.displayName ?? extension.name,\n\t\t\tseverity: LanguageStatusSeverity.Information,\n\t\t\tcommand: undefined,\n\t\t\ttext: '',\n\t\t\tdetail: '',\n\t\t\tbusy: false\n\t\t};\n\n\n\t\tlet soonHandle: IDisposable | undefined;\n\t\tconst commandDisposables = new DisposableStore();\n\t\tconst updateAsync = () => {\n\t\t\tsoonHandle?.dispose();\n\n\t\t\tif (!ids.has(fullyQualifiedId)) {\n\t\t\t\tconsole.warn(`LanguageStatusItem (${id}) from ${extension.identifier.value} has been disposed and CANNOT be updated anymore`);\n\t\t\t\treturn; // disposed in the meantime\n\t\t\t}\n\n\t\t\tsoonHandle = disposableTimeout(() => {\n\t\t\t\tcommandDisposables.clear();\n\t\t\t\tthis._proxy.$setLanguageStatus(handle, {\n\t\t\t\t\tid: fullyQualifiedId,\n\t\t\t\t\tname: data.name ?? extension.displayName ?? extension.name,\n\t\t\t\t\tsource: extension.displayName ?? extension.name,\n\t\t\t\t\tselector: typeConvert.DocumentSelector.from(data.selector, this._uriTransformer),\n\t\t\t\t\tlabel: data.text,\n\t\t\t\t\tdetail: data.detail ?? '',\n\t\t\t\t\tseverity: data.severity === LanguageStatusSeverity.Error ? Severity.Error : data.severity === LanguageStatusSeverity.Warning ? Severity.Warning : Severity.Info,\n\t\t\t\t\tcommand: data.command && this._commands.toInternal(data.command, commandDisposables),\n\t\t\t\t\taccessibilityInfo: data.accessibilityInformation,\n\t\t\t\t\tbusy: data.busy\n\t\t\t\t});\n\t\t\t}, 0);\n\t\t};\n\n\t\tconst result: vscode.LanguageStatusItem = {\n\t\t\tdispose() {\n\t\t\t\tcommandDisposables.dispose();\n\t\t\t\tsoonHandle?.dispose();\n\t\t\t\tproxy.$removeLanguageStatus(handle);\n\t\t\t\tids.delete(fullyQualifiedId);\n\t\t\t},\n\t\t\tget id() {\n\t\t\t\treturn data.id;\n\t\t\t},\n\t\t\tget name() {\n\t\t\t\treturn data.name;\n\t\t\t},\n\t\t\tset name(value) {\n\t\t\t\tdata.name = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget selector() {\n\t\t\t\treturn data.selector;\n\t\t\t},\n\t\t\tset selector(value) {\n\t\t\t\tdata.selector = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text() {\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tset text(value) {\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tset text2(value) {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\tdata.text = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget text2() {\n\t\t\t\tcheckProposedApiEnabled(extension, 'languageStatusText');\n\t\t\t\treturn data.text;\n\t\t\t},\n\t\t\tget detail() {\n\t\t\t\treturn data.detail;\n\t\t\t},\n\t\t\tset detail(value) {\n\t\t\t\tdata.detail = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget severity() {\n\t\t\t\treturn data.severity;\n\t\t\t},\n\t\t\tset severity(value) {\n\t\t\t\tdata.severity = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget accessibilityInformation() {\n\t\t\t\treturn data.accessibilityInformation;\n\t\t\t},\n\t\t\tset accessibilityInformation(value) {\n\t\t\t\tdata.accessibilityInformation = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget command() {\n\t\t\t\treturn data.command;\n\t\t\t},\n\t\t\tset command(value) {\n\t\t\t\tdata.command = value;\n\t\t\t\tupdateAsync();\n\t\t\t},\n\t\t\tget busy() {\n\t\t\t\treturn data.busy;\n\t\t\t},\n\t\t\tset busy(value: boolean) {\n\t\t\t\tdata.busy = value;\n\t\t\t\tupdateAsync();\n\t\t\t}\n\t\t};\n\t\tupdateAsync();\n\t\treturn result;\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
