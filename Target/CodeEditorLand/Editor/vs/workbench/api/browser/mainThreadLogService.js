var p=Object.defineProperty;var a=Object.getOwnPropertyDescriptor;var l=(i,e,o,t)=>{for(var r=t>1?void 0:t?a(e,o):e,g=i.length-1,v;g>=0;g--)(v=i[g])&&(r=(t?v(e,o,r):v(r))||r);return t&&r&&p(e,o,r),r},L=(i,e)=>(o,t)=>e(o,t,i);import{extHostNamedCustomer as d}from"../../services/extensions/common/extHostCustomers.js";import{ILoggerService as c,ILogService as f,isLogLevel as h,log as S,LogLevelToString as C,parseLogLevel as x}from"../../../platform/log/common/log.js";import{DisposableStore as u}from"../../../base/common/lifecycle.js";import{ExtHostContext as I,MainContext as y}from"../common/extHost.protocol.js";import{URI as s}from"../../../base/common/uri.js";import"../../../platform/instantiation/common/instantiation.js";import{CommandsRegistry as m}from"../../../platform/commands/common/commands.js";import{IEnvironmentService as U}from"../../../platform/environment/common/environment.js";let n=class{constructor(e,o){this.loggerService=o;const t=e.getProxy(I.ExtHostLogLevelServiceShape);this.disposables.add(o.onDidChangeLogLevel(r=>{h(r)?t.$setLogLevel(r):t.$setLogLevel(r[1],r[0])}))}disposables=new u;$log(e,o){const t=this.loggerService.getLogger(s.revive(e));if(!t)throw new Error("Create the logger before logging");for(const[r,g]of o)S(t,r,g)}async $createLogger(e,o){this.loggerService.createLogger(s.revive(e),o)}async $registerLogger(e){this.loggerService.registerLogger({...e,resource:s.revive(e.resource)})}async $deregisterLogger(e){this.loggerService.deregisterLogger(s.revive(e))}async $setVisibility(e,o){this.loggerService.setVisibility(s.revive(e),o)}$flush(e){const o=this.loggerService.getLogger(s.revive(e));if(!o)throw new Error("Create the logger before flushing");o.flush()}dispose(){this.disposables.dispose()}};n=l([d(y.MainThreadLogger),L(1,c)],n),m.registerCommand("_extensionTests.setLogLevel",function(i,e){const o=i.get(c),t=i.get(U);if(t.isExtensionDevelopment&&t.extensionTestsLocationURI){const r=x(e);r!==void 0&&o.setLogLevel(r)}}),m.registerCommand("_extensionTests.getLogLevel",function(i){const e=i.get(f);return C(e.getLevel())});export{n as MainThreadLoggerService};
