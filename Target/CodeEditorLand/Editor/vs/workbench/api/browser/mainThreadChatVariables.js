var d=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var p=(s,e,r,a)=>{for(var t=a>1?void 0:a?C(e,r):e,o=s.length-1,i;o>=0;o--)(i=s[o])&&(t=(a?i(e,r,t):i(t))||t);return a&&t&&d(e,r,t),t},b=(s,e)=>(r,a)=>e(r,a,s);import{DisposableMap as m}from"../../../base/common/lifecycle.js";import{revive as h}from"../../../base/common/marshalling.js";import{IChatVariablesService as y}from"../../contrib/chat/common/chatVariables.js";import{extHostNamedCustomer as c}from"../../services/extensions/common/extHostCustomers.js";import{ExtHostContext as x,MainContext as u}from"../common/extHost.protocol.js";let l=class{constructor(e,r){this._chatVariablesService=r;this._proxy=e.getProxy(x.ExtHostChatVariables)}_proxy;_variables=new m;_pendingProgress=new Map;dispose(){this._variables.clearAndDisposeAll()}$registerVariable(e,r){const a=this._chatVariablesService.registerVariable(r,async(t,o,i,v,g)=>{const n=`${i.sessionId}-${e}`;this._pendingProgress.set(n,v);const V=h(await this._proxy.$resolveVariable(e,n,t,g));return this._pendingProgress.delete(n),V});this._variables.set(e,a)}async $handleProgressChunk(e,r){const a=h(r);this._pendingProgress.get(e)?.(a)}$unregisterVariable(e){this._variables.deleteAndDispose(e)}};l=p([c(u.MainThreadChatVariables),b(1,y)],l);export{l as MainThreadChatVariables};
