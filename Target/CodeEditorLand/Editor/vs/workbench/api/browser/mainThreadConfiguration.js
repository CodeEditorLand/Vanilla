var C=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var c=(u,i,t,e)=>{for(var n=e>1?void 0:e?d(i,t):i,o=u.length-1,r;o>=0;o--)(r=u[o])&&(n=(e?r(i,t,n):r(n))||n);return e&&n&&C(i,t,n),n},f=(u,i)=>(t,e)=>i(t,e,u);import{URI as g}from"../../../base/common/uri.js";import{ConfigurationTarget as a,IConfigurationService as m}from"../../../platform/configuration/common/configuration.js";import{Extensions as l,ConfigurationScope as p,getScopes as v}from"../../../platform/configuration/common/configurationRegistry.js";import{IEnvironmentService as I}from"../../../platform/environment/common/environment.js";import{Registry as S}from"../../../platform/registry/common/platform.js";import{IWorkspaceContextService as h,WorkbenchState as E}from"../../../platform/workspace/common/workspace.js";import{extHostNamedCustomer as _}from"../../services/extensions/common/extHostCustomers.js";import{ExtHostContext as x,MainContext as O}from"../common/extHost.protocol.js";let s=class{constructor(i,t,e,n){this._workspaceContextService=t;this.configurationService=e;this._environmentService=n;const o=i.getProxy(x.ExtHostConfiguration);o.$initializeConfiguration(this._getConfigurationData()),this._configurationListener=e.onDidChangeConfiguration(r=>{o.$acceptConfigurationChanged(this._getConfigurationData(),r.change)})}_configurationListener;_getConfigurationData(){const i={...this.configurationService.getConfigurationData(),configurationScopes:[]};return(!this._environmentService.isBuilt||this._environmentService.isExtensionDevelopment)&&(i.configurationScopes=v()),i}dispose(){this._configurationListener.dispose()}$updateConfigurationOption(i,t,e,n,o){return n={resource:n?.resource?g.revive(n.resource):void 0,overrideIdentifier:n?.overrideIdentifier},this.writeConfiguration(i,t,e,n,o)}$removeConfigurationOption(i,t,e,n){return e={resource:e?.resource?g.revive(e.resource):void 0,overrideIdentifier:e?.overrideIdentifier},this.writeConfiguration(i,t,void 0,e,n)}writeConfiguration(i,t,e,n,o){i=i??this.deriveConfigurationTarget(t,n);const r=this.configurationService.inspect(t,n);switch(i){case a.MEMORY:return this._updateValue(t,e,i,r?.memory?.override,n,o);case a.WORKSPACE_FOLDER:return this._updateValue(t,e,i,r?.workspaceFolder?.override,n,o);case a.WORKSPACE:return this._updateValue(t,e,i,r?.workspace?.override,n,o);case a.USER_REMOTE:return this._updateValue(t,e,i,r?.userRemote?.override,n,o);default:return this._updateValue(t,e,i,r?.userLocal?.override,n,o)}}_updateValue(i,t,e,n,o,r){return o=r===!0?o:r===!1?{resource:o.resource}:o.overrideIdentifier&&n!==void 0?o:{resource:o.resource},this.configurationService.updateValue(i,t,o,e,{donotNotifyError:!0})}deriveConfigurationTarget(i,t){if(t.resource&&this._workspaceContextService.getWorkbenchState()===E.WORKSPACE){const e=S.as(l.Configuration).getConfigurationProperties();if(e[i]&&(e[i].scope===p.RESOURCE||e[i].scope===p.LANGUAGE_OVERRIDABLE))return a.WORKSPACE_FOLDER}return a.WORKSPACE}};s=c([_(O.MainThreadConfiguration),f(1,h),f(2,m),f(3,I)],s);export{s as MainThreadConfiguration};
