{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadSecretState.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from '../../../base/common/lifecycle.js';\nimport { extHostNamedCustomer, IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostSecretStateShape, MainContext, MainThreadSecretStateShape } from '../common/extHost.protocol.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { SequencerByKey } from '../../../base/common/async.js';\nimport { ISecretStorageService } from '../../../platform/secrets/common/secrets.js';\nimport { IBrowserWorkbenchEnvironmentService } from '../../services/environment/browser/environmentService.js';\n\n@extHostNamedCustomer(MainContext.MainThreadSecretState)\nexport class MainThreadSecretState extends Disposable implements MainThreadSecretStateShape {\n\tprivate readonly _proxy: ExtHostSecretStateShape;\n\n\tprivate readonly _sequencer = new SequencerByKey<string>();\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ISecretStorageService private readonly secretStorageService: ISecretStorageService,\n\t\t@ILogService private readonly logService: ILogService,\n\t\t@IBrowserWorkbenchEnvironmentService environmentService: IBrowserWorkbenchEnvironmentService\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostSecretState);\n\n\t\tthis._register(this.secretStorageService.onDidChangeSecret((e: string) => {\n\t\t\ttry {\n\t\t\t\tconst { extensionId, key } = this.parseKey(e);\n\t\t\t\tif (extensionId && key) {\n\t\t\t\t\tthis._proxy.$onDidChangePassword({ extensionId, key });\n\t\t\t\t}\n\t\t\t} catch (e) {\n\t\t\t\t// Core can use non-JSON values as keys, so we may not be able to parse them.\n\t\t\t}\n\t\t}));\n\t}\n\n\t$getPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Getting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doGetPassword(extensionId, key));\n\t}\n\n\tprivate async doGetPassword(extensionId: string, key: string): Promise<string | undefined> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tconst password = await this.secretStorageService.get(fullKey);\n\t\tthis.logService.trace(`[mainThreadSecretState] ${password ? 'P' : 'No p'}assword found for: `, extensionId, key);\n\t\treturn password;\n\t}\n\n\t$setPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Setting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doSetPassword(extensionId, key, value));\n\t}\n\n\tprivate async doSetPassword(extensionId: string, key: string, value: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.set(fullKey, value);\n\t\tthis.logService.trace('[mainThreadSecretState] Password set for: ', extensionId, key);\n\t}\n\n\t$deletePassword(extensionId: string, key: string): Promise<void> {\n\t\tthis.logService.trace(`[mainThreadSecretState] Deleting password for ${extensionId} extension: `, key);\n\t\treturn this._sequencer.queue(extensionId, () => this.doDeletePassword(extensionId, key));\n\t}\n\n\tprivate async doDeletePassword(extensionId: string, key: string): Promise<void> {\n\t\tconst fullKey = this.getKey(extensionId, key);\n\t\tawait this.secretStorageService.delete(fullKey);\n\t\tthis.logService.trace('[mainThreadSecretState] Password deleted for: ', extensionId, key);\n\t}\n\n\tprivate getKey(extensionId: string, key: string): string {\n\t\treturn JSON.stringify({ extensionId, key });\n\t}\n\n\tprivate parseKey(key: string): { extensionId: string; key: string } {\n\t\treturn JSON.parse(key);\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,kBAAkB;AAC3B,SAAS,sBAAsB,uBAAuB;AACtD,SAAS,gBAAgB,yBAAyB,aAAa,kCAAkC;AACjG,SAAS,mBAAmB;AAC5B,SAAS,sBAAsB;AAC/B,SAAS,6BAA6B;AACtC,SAAS,2CAA2C;AAG7C,IAAM,wBAAN,cAAoC,WAAiD;AAAA,EAK3F,YACC,gBACwC,sBACV,YACO,oBACpC;AACD,UAAM;AAJkC;AACV;AAK9B,SAAK,SAAS,eAAe,SAAS,eAAe,kBAAkB;AAEvE,SAAK,UAAU,KAAK,qBAAqB,kBAAkB,CAAC,MAAc;AACzE,UAAI;AACH,cAAM,EAAE,aAAa,IAAI,IAAI,KAAK,SAAS,CAAC;AAC5C,YAAI,eAAe,KAAK;AACvB,eAAK,OAAO,qBAAqB,EAAE,aAAa,IAAI,CAAC;AAAA,QACtD;AAAA,MACD,SAASA,IAAG;AAAA,MAEZ;AAAA,IACD,CAAC,CAAC;AAAA,EACH;AAAA,EAxBiB;AAAA,EAEA,aAAa,IAAI,eAAuB;AAAA,EAwBzD,aAAa,aAAqB,KAA0C;AAC3E,SAAK,WAAW,MAAM,gDAAgD,WAAW,gBAAgB,GAAG;AACpG,WAAO,KAAK,WAAW,MAAM,aAAa,MAAM,KAAK,cAAc,aAAa,GAAG,CAAC;AAAA,EACrF;AAAA,EAEA,MAAc,cAAc,aAAqB,KAA0C;AAC1F,UAAM,UAAU,KAAK,OAAO,aAAa,GAAG;AAC5C,UAAM,WAAW,MAAM,KAAK,qBAAqB,IAAI,OAAO;AAC5D,SAAK,WAAW,MAAM,2BAA2B,WAAW,MAAM,MAAM,uBAAuB,aAAa,GAAG;AAC/G,WAAO;AAAA,EACR;AAAA,EAEA,aAAa,aAAqB,KAAa,OAA8B;AAC5E,SAAK,WAAW,MAAM,gDAAgD,WAAW,gBAAgB,GAAG;AACpG,WAAO,KAAK,WAAW,MAAM,aAAa,MAAM,KAAK,cAAc,aAAa,KAAK,KAAK,CAAC;AAAA,EAC5F;AAAA,EAEA,MAAc,cAAc,aAAqB,KAAa,OAA8B;AAC3F,UAAM,UAAU,KAAK,OAAO,aAAa,GAAG;AAC5C,UAAM,KAAK,qBAAqB,IAAI,SAAS,KAAK;AAClD,SAAK,WAAW,MAAM,8CAA8C,aAAa,GAAG;AAAA,EACrF;AAAA,EAEA,gBAAgB,aAAqB,KAA4B;AAChE,SAAK,WAAW,MAAM,iDAAiD,WAAW,gBAAgB,GAAG;AACrG,WAAO,KAAK,WAAW,MAAM,aAAa,MAAM,KAAK,iBAAiB,aAAa,GAAG,CAAC;AAAA,EACxF;AAAA,EAEA,MAAc,iBAAiB,aAAqB,KAA4B;AAC/E,UAAM,UAAU,KAAK,OAAO,aAAa,GAAG;AAC5C,UAAM,KAAK,qBAAqB,OAAO,OAAO;AAC9C,SAAK,WAAW,MAAM,kDAAkD,aAAa,GAAG;AAAA,EACzF;AAAA,EAEQ,OAAO,aAAqB,KAAqB;AACxD,WAAO,KAAK,UAAU,EAAE,aAAa,IAAI,CAAC;AAAA,EAC3C;AAAA,EAEQ,SAAS,KAAmD;AACnE,WAAO,KAAK,MAAM,GAAG;AAAA,EACtB;AACD;AApE4F;AAA/E,wBAAN;AAAA,EADN,qBAAqB,YAAY,qBAAqB;AAAA,EAQpD;AAAA,EACA;AAAA,EACA;AAAA,GATU;",
  "names": ["e"]
}
