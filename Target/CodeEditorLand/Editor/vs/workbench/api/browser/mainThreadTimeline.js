var v=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var a=(n,e,r,t)=>{for(var i=t>1?void 0:t?T(e,r):e,o=n.length-1,m;o>=0;o--)(m=n[o])&&(i=(t?m(e,r,i):m(i))||i);return t&&i&&v(e,r,i),i},l=(n,e)=>(r,t)=>e(r,t,n);import"../../../../vs/base/common/cancellation.js";import{Emitter as p}from"../../../../vs/base/common/event.js";import{revive as g}from"../../../../vs/base/common/marshalling.js";import"../../../../vs/base/common/uri.js";import{ILogService as c}from"../../../../vs/platform/log/common/log.js";import{ExtHostContext as h,MainContext as x}from"../../../../vs/workbench/api/common/extHost.protocol.js";import{ITimelineService as E}from"../../../../vs/workbench/contrib/timeline/common/timeline.js";import{extHostNamedCustomer as S}from"../../../../vs/workbench/services/extensions/common/extHostCustomers.js";let s=class{constructor(e,r,t){this.logService=r;this._timelineService=t;this._proxy=e.getProxy(h.ExtHostTimeline)}_proxy;_providerEmitters=new Map;$registerTimelineProvider(e){this.logService.trace(`MainThreadTimeline#registerTimelineProvider: id=${e.id}`);const r=this._proxy,t=this._providerEmitters;let i=t.get(e.id);i===void 0&&(i=new p,t.set(e.id,i)),this._timelineService.registerTimelineProvider({...e,onDidChange:i.event,async provideTimeline(o,m,d){return g(await r.$getTimeline(e.id,o,m,d))},dispose(){t.delete(e.id),i?.dispose()}})}$unregisterTimelineProvider(e){this.logService.trace(`MainThreadTimeline#unregisterTimelineProvider: id=${e}`),this._timelineService.unregisterTimelineProvider(e)}$emitTimelineChangeEvent(e){this.logService.trace(`MainThreadTimeline#emitChangeEvent: id=${e.id}, uri=${e.uri?.toString(!0)}`),this._providerEmitters.get(e.id)?.fire(e)}dispose(){}};s=a([S(x.MainThreadTimeline),l(1,c),l(2,E)],s);export{s as MainThreadTimeline};
