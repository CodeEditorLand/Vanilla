var v=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var a=(n,e,r,t)=>{for(var i=t>1?void 0:t?T(e,r):e,o=n.length-1,m;o>=0;o--)(m=n[o])&&(i=(t?m(e,r,i):m(i))||i);return t&&i&&v(e,r,i),i},l=(n,e)=>(r,t)=>e(r,t,n);import{Emitter as p}from"../../../base/common/event.js";import"../../../base/common/cancellation.js";import"../../../base/common/uri.js";import{ILogService as g}from"../../../platform/log/common/log.js";import{MainContext as c,ExtHostContext as h}from"../common/extHost.protocol.js";import{extHostNamedCustomer as x}from"../../services/extensions/common/extHostCustomers.js";import{ITimelineService as E}from"../../contrib/timeline/common/timeline.js";import{revive as S}from"../../../base/common/marshalling.js";let s=class{constructor(e,r,t){this.logService=r;this._timelineService=t;this._proxy=e.getProxy(h.ExtHostTimeline)}_proxy;_providerEmitters=new Map;$registerTimelineProvider(e){this.logService.trace(`MainThreadTimeline#registerTimelineProvider: id=${e.id}`);const r=this._proxy,t=this._providerEmitters;let i=t.get(e.id);i===void 0&&(i=new p,t.set(e.id,i)),this._timelineService.registerTimelineProvider({...e,onDidChange:i.event,async provideTimeline(o,m,d){return S(await r.$getTimeline(e.id,o,m,d))},dispose(){t.delete(e.id),i?.dispose()}})}$unregisterTimelineProvider(e){this.logService.trace(`MainThreadTimeline#unregisterTimelineProvider: id=${e}`),this._timelineService.unregisterTimelineProvider(e)}$emitTimelineChangeEvent(e){this.logService.trace(`MainThreadTimeline#emitChangeEvent: id=${e.id}, uri=${e.uri?.toString(!0)}`),this._providerEmitters.get(e.id)?.fire(e)}dispose(){}};s=a([x(c.MainThreadTimeline),l(1,g),l(2,E)],s);export{s as MainThreadTimeline};
