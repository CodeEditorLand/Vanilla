var v=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var c=(i,e,t,r)=>{for(var o=r>1?void 0:r?I(e,t):e,a=i.length-1,n;a>=0;a--)(n=i[a])&&(o=(r?n(e,t,o):n(o))||o);return r&&o&&v(e,t,o),o},p=(i,e)=>(t,r)=>e(t,r,i);import"../../../base/common/cancellation.js";import{shouldSynchronizeModel as d}from"../../../editor/common/model.js";import{localize as S}from"../../../nls.js";import{IInstantiationService as f}from"../../../platform/instantiation/common/instantiation.js";import"../../../platform/progress/common/progress.js";import{extHostCustomer as u}from"../../services/extensions/common/extHostCustomers.js";import{ITextFileService as P}from"../../services/textfile/common/textfiles.js";import{ExtHostContext as E}from"../common/extHost.protocol.js";import"../../../base/common/lifecycle.js";import{raceCancellationError as T}from"../../../base/common/async.js";class h{_proxy;constructor(e){this._proxy=e.getProxy(E.ExtHostDocumentSaveParticipant)}async participate(e,t,r,o){if(!e.textEditorModel||!d(e.textEditorModel))return;const a=new Promise((n,l)=>{setTimeout(()=>l(new Error(S("timeout.onWillSave","Aborted onWillSaveTextDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason).then(m=>{if(!m.every(x=>x))return Promise.reject(new Error("listener failed"))}).then(n,l)});return T(a,o)}}let s=class{constructor(e,t,r){this._textFileService=r;this._saveParticipantDisposable=this._textFileService.files.addSaveParticipant(t.createInstance(h,e))}_saveParticipantDisposable;dispose(){this._saveParticipantDisposable.dispose()}};s=c([u,p(1,f),p(2,P)],s);export{s as SaveParticipant};
