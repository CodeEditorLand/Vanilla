var v=Object.defineProperty;var I=Object.getOwnPropertyDescriptor;var l=(i,e,t,r)=>{for(var o=r>1?void 0:r?I(e,t):e,a=i.length-1,s;a>=0;a--)(s=i[a])&&(o=(r?s(e,t,o):s(o))||o);return r&&o&&v(e,t,o),o},p=(i,e)=>(t,r)=>e(t,r,i);import{raceCancellationError as d}from"../../../base/common/async.js";import{shouldSynchronizeModel as S}from"../../../editor/common/model.js";import{localize as f}from"../../../nls.js";import{IInstantiationService as y}from"../../../platform/instantiation/common/instantiation.js";import{extHostCustomer as u}from"../../services/extensions/common/extHostCustomers.js";import{ITextFileService as P}from"../../services/textfile/common/textfiles.js";import{ExtHostContext as E}from"../common/extHost.protocol.js";class T{_proxy;constructor(e){this._proxy=e.getProxy(E.ExtHostDocumentSaveParticipant)}async participate(e,t,r,o){if(!e.textEditorModel||!S(e.textEditorModel))return;const a=new Promise((s,c)=>{setTimeout(()=>c(new Error(f("timeout.onWillSave","Aborted onWillSaveTextDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(e.resource,t.reason).then(m=>{if(!m.every(x=>x))return Promise.reject(new Error("listener failed"))}).then(s,c)});return d(a,o)}}let n=class{constructor(e,t,r){this._textFileService=r;this._saveParticipantDisposable=this._textFileService.files.addSaveParticipant(t.createInstance(T,e))}_saveParticipantDisposable;dispose(){this._saveParticipantDisposable.dispose()}};n=l([u,p(1,y),p(2,P)],n);export{n as SaveParticipant};
