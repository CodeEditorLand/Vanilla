{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadNotebookEditors.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, dispose } from '../../../base/common/lifecycle.js';\nimport { equals } from '../../../base/common/objects.js';\nimport { URI, UriComponents } from '../../../base/common/uri.js';\nimport { IConfigurationService } from '../../../platform/configuration/common/configuration.js';\nimport { EditorActivation } from '../../../platform/editor/common/editor.js';\nimport { getNotebookEditorFromEditorPane, INotebookEditor, INotebookEditorOptions } from '../../contrib/notebook/browser/notebookBrowser.js';\nimport { INotebookEditorService } from '../../contrib/notebook/browser/services/notebookEditorService.js';\nimport { ICellRange } from '../../contrib/notebook/common/notebookRange.js';\nimport { columnToEditorGroup, editorGroupToColumn } from '../../services/editor/common/editorGroupColumn.js';\nimport { IEditorGroupsService } from '../../services/editor/common/editorGroupsService.js';\nimport { IEditorService } from '../../services/editor/common/editorService.js';\nimport { IExtHostContext } from '../../services/extensions/common/extHostCustomers.js';\nimport { ExtHostContext, ExtHostNotebookEditorsShape, INotebookDocumentShowOptions, INotebookEditorViewColumnInfo, MainThreadNotebookEditorsShape, NotebookEditorRevealType } from '../common/extHost.protocol.js';\n\nclass MainThreadNotebook {\n\n\tconstructor(\n\t\treadonly editor: INotebookEditor,\n\t\treadonly disposables: DisposableStore\n\t) { }\n\n\tdispose() {\n\t\tthis.disposables.dispose();\n\t}\n}\n\nexport class MainThreadNotebookEditors implements MainThreadNotebookEditorsShape {\n\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _proxy: ExtHostNotebookEditorsShape;\n\tprivate readonly _mainThreadEditors = new Map<string, MainThreadNotebook>();\n\n\tprivate _currentViewColumnInfo?: INotebookEditorViewColumnInfo;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorService private readonly _notebookEditorService: INotebookEditorService,\n\t\t@IEditorGroupsService private readonly _editorGroupService: IEditorGroupsService,\n\t\t@IConfigurationService private readonly _configurationService: IConfigurationService\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostNotebookEditors);\n\n\t\tthis._editorService.onDidActiveEditorChange(() => this._updateEditorViewColumns(), this, this._disposables);\n\t\tthis._editorGroupService.onDidRemoveGroup(() => this._updateEditorViewColumns(), this, this._disposables);\n\t\tthis._editorGroupService.onDidMoveGroup(() => this._updateEditorViewColumns(), this, this._disposables);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tdispose(this._mainThreadEditors.values());\n\t}\n\n\thandleEditorsAdded(editors: readonly INotebookEditor[]): void {\n\n\t\tfor (const editor of editors) {\n\n\t\t\tconst editorDisposables = new DisposableStore();\n\t\t\teditorDisposables.add(editor.onDidChangeVisibleRanges(() => {\n\t\t\t\tthis._proxy.$acceptEditorPropertiesChanged(editor.getId(), { visibleRanges: { ranges: editor.visibleRanges } });\n\t\t\t}));\n\n\t\t\teditorDisposables.add(editor.onDidChangeSelection(() => {\n\t\t\t\tthis._proxy.$acceptEditorPropertiesChanged(editor.getId(), { selections: { selections: editor.getSelections() } });\n\t\t\t}));\n\n\t\t\tconst wrapper = new MainThreadNotebook(editor, editorDisposables);\n\t\t\tthis._mainThreadEditors.set(editor.getId(), wrapper);\n\t\t}\n\t}\n\n\thandleEditorsRemoved(editorIds: readonly string[]): void {\n\t\tfor (const id of editorIds) {\n\t\t\tthis._mainThreadEditors.get(id)?.dispose();\n\t\t\tthis._mainThreadEditors.delete(id);\n\t\t}\n\t}\n\n\tprivate _updateEditorViewColumns(): void {\n\t\tconst result: INotebookEditorViewColumnInfo = Object.create(null);\n\t\tfor (const editorPane of this._editorService.visibleEditorPanes) {\n\t\t\tconst candidate = getNotebookEditorFromEditorPane(editorPane);\n\t\t\tif (candidate && this._mainThreadEditors.has(candidate.getId())) {\n\t\t\t\tresult[candidate.getId()] = editorGroupToColumn(this._editorGroupService, editorPane.group);\n\t\t\t}\n\t\t}\n\t\tif (!equals(result, this._currentViewColumnInfo)) {\n\t\t\tthis._currentViewColumnInfo = result;\n\t\t\tthis._proxy.$acceptEditorViewColumns(result);\n\t\t}\n\t}\n\n\tasync $tryShowNotebookDocument(resource: UriComponents, viewType: string, options: INotebookDocumentShowOptions): Promise<string> {\n\t\tconst editorOptions: INotebookEditorOptions = {\n\t\t\tcellSelections: options.selections,\n\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\tpinned: options.pinned,\n\t\t\t// selection: options.selection,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: options.preserveFocus ? EditorActivation.RESTORE : undefined,\n\t\t\tlabel: options.label,\n\t\t\toverride: viewType\n\t\t};\n\n\t\tconst editorPane = await this._editorService.openEditor({ resource: URI.revive(resource), options: editorOptions }, columnToEditorGroup(this._editorGroupService, this._configurationService, options.position));\n\t\tconst notebookEditor = getNotebookEditorFromEditorPane(editorPane);\n\n\t\tif (notebookEditor) {\n\t\t\treturn notebookEditor.getId();\n\t\t} else {\n\t\t\tthrow new Error(`Notebook Editor creation failure for document ${JSON.stringify(resource)}`);\n\t\t}\n\t}\n\n\tasync $tryRevealRange(id: string, range: ICellRange, revealType: NotebookEditorRevealType): Promise<void> {\n\t\tconst editor = this._notebookEditorService.getNotebookEditor(id);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\t\tconst notebookEditor = editor as INotebookEditor;\n\t\tif (!notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (range.start >= notebookEditor.getLength()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = notebookEditor.cellAt(range.start);\n\n\t\tswitch (revealType) {\n\t\t\tcase NotebookEditorRevealType.Default:\n\t\t\t\treturn notebookEditor.revealCellRangeInView(range);\n\t\t\tcase NotebookEditorRevealType.InCenter:\n\t\t\t\treturn notebookEditor.revealInCenter(cell);\n\t\t\tcase NotebookEditorRevealType.InCenterIfOutsideViewport:\n\t\t\t\treturn notebookEditor.revealInCenterIfOutsideViewport(cell);\n\t\t\tcase NotebookEditorRevealType.AtTop:\n\t\t\t\treturn notebookEditor.revealInViewAtTop(cell);\n\t\t}\n\t}\n\n\t$trySetSelections(id: string, ranges: ICellRange[]): void {\n\t\tconst editor = this._notebookEditorService.getNotebookEditor(id);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\teditor.setSelections(ranges);\n\n\t\tif (ranges.length) {\n\t\t\teditor.setFocus({ start: ranges[0].start, end: ranges[0].start + 1 });\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
