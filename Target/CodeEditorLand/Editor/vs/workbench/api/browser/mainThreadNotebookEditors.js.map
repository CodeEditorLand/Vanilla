{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadNotebookEditors.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { DisposableStore, dispose } from \"../../../base/common/lifecycle.js\";\nimport { equals } from \"../../../base/common/objects.js\";\nimport { URI, type UriComponents } from \"../../../base/common/uri.js\";\nimport { IConfigurationService } from \"../../../platform/configuration/common/configuration.js\";\nimport { EditorActivation } from \"../../../platform/editor/common/editor.js\";\nimport {\n\ttype INotebookEditor,\n\ttype INotebookEditorOptions,\n\tgetNotebookEditorFromEditorPane,\n} from \"../../contrib/notebook/browser/notebookBrowser.js\";\nimport { INotebookEditorService } from \"../../contrib/notebook/browser/services/notebookEditorService.js\";\nimport type { ICellRange } from \"../../contrib/notebook/common/notebookRange.js\";\nimport {\n\tcolumnToEditorGroup,\n\teditorGroupToColumn,\n} from \"../../services/editor/common/editorGroupColumn.js\";\nimport { IEditorGroupsService } from \"../../services/editor/common/editorGroupsService.js\";\nimport { IEditorService } from \"../../services/editor/common/editorService.js\";\nimport type { IExtHostContext } from \"../../services/extensions/common/extHostCustomers.js\";\nimport {\n\tExtHostContext,\n\ttype ExtHostNotebookEditorsShape,\n\ttype INotebookDocumentShowOptions,\n\ttype INotebookEditorViewColumnInfo,\n\ttype MainThreadNotebookEditorsShape,\n\tNotebookEditorRevealType,\n} from \"../common/extHost.protocol.js\";\n\nclass MainThreadNotebook {\n\tconstructor(\n\t\treadonly editor: INotebookEditor,\n\t\treadonly disposables: DisposableStore,\n\t) {}\n\n\tdispose() {\n\t\tthis.disposables.dispose();\n\t}\n}\n\nexport class MainThreadNotebookEditors\n\timplements MainThreadNotebookEditorsShape\n{\n\tprivate readonly _disposables = new DisposableStore();\n\n\tprivate readonly _proxy: ExtHostNotebookEditorsShape;\n\tprivate readonly _mainThreadEditors = new Map<string, MainThreadNotebook>();\n\n\tprivate _currentViewColumnInfo?: INotebookEditorViewColumnInfo;\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@IEditorService private readonly _editorService: IEditorService,\n\t\t@INotebookEditorService\n\t\tprivate readonly _notebookEditorService: INotebookEditorService,\n\t\t@IEditorGroupsService\n\t\tprivate readonly _editorGroupService: IEditorGroupsService,\n\t\t@IConfigurationService\n\t\tprivate readonly _configurationService: IConfigurationService,\n\t) {\n\t\tthis._proxy = extHostContext.getProxy(\n\t\t\tExtHostContext.ExtHostNotebookEditors,\n\t\t);\n\n\t\tthis._editorService.onDidActiveEditorChange(\n\t\t\t() => this._updateEditorViewColumns(),\n\t\t\tthis,\n\t\t\tthis._disposables,\n\t\t);\n\t\tthis._editorGroupService.onDidRemoveGroup(\n\t\t\t() => this._updateEditorViewColumns(),\n\t\t\tthis,\n\t\t\tthis._disposables,\n\t\t);\n\t\tthis._editorGroupService.onDidMoveGroup(\n\t\t\t() => this._updateEditorViewColumns(),\n\t\t\tthis,\n\t\t\tthis._disposables,\n\t\t);\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tdispose(this._mainThreadEditors.values());\n\t}\n\n\thandleEditorsAdded(editors: readonly INotebookEditor[]): void {\n\t\tfor (const editor of editors) {\n\t\t\tconst editorDisposables = new DisposableStore();\n\t\t\teditorDisposables.add(\n\t\t\t\teditor.onDidChangeVisibleRanges(() => {\n\t\t\t\t\tthis._proxy.$acceptEditorPropertiesChanged(editor.getId(), {\n\t\t\t\t\t\tvisibleRanges: { ranges: editor.visibleRanges },\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\teditorDisposables.add(\n\t\t\t\teditor.onDidChangeSelection(() => {\n\t\t\t\t\tthis._proxy.$acceptEditorPropertiesChanged(editor.getId(), {\n\t\t\t\t\t\tselections: { selections: editor.getSelections() },\n\t\t\t\t\t});\n\t\t\t\t}),\n\t\t\t);\n\n\t\t\tconst wrapper = new MainThreadNotebook(editor, editorDisposables);\n\t\t\tthis._mainThreadEditors.set(editor.getId(), wrapper);\n\t\t}\n\t}\n\n\thandleEditorsRemoved(editorIds: readonly string[]): void {\n\t\tfor (const id of editorIds) {\n\t\t\tthis._mainThreadEditors.get(id)?.dispose();\n\t\t\tthis._mainThreadEditors.delete(id);\n\t\t}\n\t}\n\n\tprivate _updateEditorViewColumns(): void {\n\t\tconst result: INotebookEditorViewColumnInfo = Object.create(null);\n\t\tfor (const editorPane of this._editorService.visibleEditorPanes) {\n\t\t\tconst candidate = getNotebookEditorFromEditorPane(editorPane);\n\t\t\tif (candidate && this._mainThreadEditors.has(candidate.getId())) {\n\t\t\t\tresult[candidate.getId()] = editorGroupToColumn(\n\t\t\t\t\tthis._editorGroupService,\n\t\t\t\t\teditorPane.group,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\tif (!equals(result, this._currentViewColumnInfo)) {\n\t\t\tthis._currentViewColumnInfo = result;\n\t\t\tthis._proxy.$acceptEditorViewColumns(result);\n\t\t}\n\t}\n\n\tasync $tryShowNotebookDocument(\n\t\tresource: UriComponents,\n\t\tviewType: string,\n\t\toptions: INotebookDocumentShowOptions,\n\t): Promise<string> {\n\t\tconst editorOptions: INotebookEditorOptions = {\n\t\t\tcellSelections: options.selections,\n\t\t\tpreserveFocus: options.preserveFocus,\n\t\t\tpinned: options.pinned,\n\t\t\t// selection: options.selection,\n\t\t\t// preserve pre 1.38 behaviour to not make group active when preserveFocus: true\n\t\t\t// but make sure to restore the editor to fix https://github.com/microsoft/vscode/issues/79633\n\t\t\tactivation: options.preserveFocus\n\t\t\t\t? EditorActivation.RESTORE\n\t\t\t\t: undefined,\n\t\t\tlabel: options.label,\n\t\t\toverride: viewType,\n\t\t};\n\n\t\tconst editorPane = await this._editorService.openEditor(\n\t\t\t{ resource: URI.revive(resource), options: editorOptions },\n\t\t\tcolumnToEditorGroup(\n\t\t\t\tthis._editorGroupService,\n\t\t\t\tthis._configurationService,\n\t\t\t\toptions.position,\n\t\t\t),\n\t\t);\n\t\tconst notebookEditor = getNotebookEditorFromEditorPane(editorPane);\n\n\t\tif (notebookEditor) {\n\t\t\treturn notebookEditor.getId();\n\t\t} else {\n\t\t\tthrow new Error(\n\t\t\t\t`Notebook Editor creation failure for document ${JSON.stringify(resource)}`,\n\t\t\t);\n\t\t}\n\t}\n\n\tasync $tryRevealRange(\n\t\tid: string,\n\t\trange: ICellRange,\n\t\trevealType: NotebookEditorRevealType,\n\t): Promise<void> {\n\t\tconst editor = this._notebookEditorService.getNotebookEditor(id);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\t\tconst notebookEditor = editor as INotebookEditor;\n\t\tif (!notebookEditor.hasModel()) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (range.start >= notebookEditor.getLength()) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst cell = notebookEditor.cellAt(range.start);\n\n\t\tswitch (revealType) {\n\t\t\tcase NotebookEditorRevealType.Default:\n\t\t\t\treturn notebookEditor.revealCellRangeInView(range);\n\t\t\tcase NotebookEditorRevealType.InCenter:\n\t\t\t\treturn notebookEditor.revealInCenter(cell);\n\t\t\tcase NotebookEditorRevealType.InCenterIfOutsideViewport:\n\t\t\t\treturn notebookEditor.revealInCenterIfOutsideViewport(cell);\n\t\t\tcase NotebookEditorRevealType.AtTop:\n\t\t\t\treturn notebookEditor.revealInViewAtTop(cell);\n\t\t}\n\t}\n\n\t$trySetSelections(id: string, ranges: ICellRange[]): void {\n\t\tconst editor = this._notebookEditorService.getNotebookEditor(id);\n\t\tif (!editor) {\n\t\t\treturn;\n\t\t}\n\n\t\teditor.setSelections(ranges);\n\n\t\tif (ranges.length) {\n\t\t\teditor.setFocus({\n\t\t\t\tstart: ranges[0].start,\n\t\t\t\tend: ranges[0].start + 1,\n\t\t\t});\n\t\t}\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,iBAAiB,eAAe;AACzC,SAAS,cAAc;AACvB,SAAS,WAA+B;AACxC,SAAS,6BAA6B;AACtC,SAAS,wBAAwB;AACjC;AAAA,EAGC;AAAA,OACM;AACP,SAAS,8BAA8B;AAEvC;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,4BAA4B;AACrC,SAAS,sBAAsB;AAE/B;AAAA,EACC;AAAA,EAKA;AAAA,OACM;AAEP,MAAM,mBAAmB;AAAA,EACxB,YACU,QACA,aACR;AAFQ;AACA;AAAA,EACP;AAAA,EArCJ,OAiCyB;AAAA;AAAA;AAAA,EAMxB,UAAU;AACT,SAAK,YAAY,QAAQ;AAAA,EAC1B;AACD;AAEO,IAAM,4BAAN,MAEP;AAAA,EAQC,YACC,gBACiC,gBAEhB,wBAEA,qBAEA,uBAChB;AAPgC;AAEhB;AAEA;AAEA;AAEjB,SAAK,SAAS,eAAe;AAAA,MAC5B,eAAe;AAAA,IAChB;AAEA,SAAK,eAAe;AAAA,MACnB,MAAM,KAAK,yBAAyB;AAAA,MACpC;AAAA,MACA,KAAK;AAAA,IACN;AACA,SAAK,oBAAoB;AAAA,MACxB,MAAM,KAAK,yBAAyB;AAAA,MACpC;AAAA,MACA,KAAK;AAAA,IACN;AACA,SAAK,oBAAoB;AAAA,MACxB,MAAM,KAAK,yBAAyB;AAAA,MACpC;AAAA,MACA,KAAK;AAAA,IACN;AAAA,EACD;AAAA,EAnFD,OA8CA;AAAA;AAAA;AAAA,EACkB,eAAe,IAAI,gBAAgB;AAAA,EAEnC;AAAA,EACA,qBAAqB,oBAAI,IAAgC;AAAA,EAElE;AAAA,EAiCR,UAAgB;AACf,SAAK,aAAa,QAAQ;AAC1B,YAAQ,KAAK,mBAAmB,OAAO,CAAC;AAAA,EACzC;AAAA,EAEA,mBAAmB,SAA2C;AAC7D,eAAW,UAAU,SAAS;AAC7B,YAAM,oBAAoB,IAAI,gBAAgB;AAC9C,wBAAkB;AAAA,QACjB,OAAO,yBAAyB,MAAM;AACrC,eAAK,OAAO,+BAA+B,OAAO,MAAM,GAAG;AAAA,YAC1D,eAAe,EAAE,QAAQ,OAAO,cAAc;AAAA,UAC/C,CAAC;AAAA,QACF,CAAC;AAAA,MACF;AAEA,wBAAkB;AAAA,QACjB,OAAO,qBAAqB,MAAM;AACjC,eAAK,OAAO,+BAA+B,OAAO,MAAM,GAAG;AAAA,YAC1D,YAAY,EAAE,YAAY,OAAO,cAAc,EAAE;AAAA,UAClD,CAAC;AAAA,QACF,CAAC;AAAA,MACF;AAEA,YAAM,UAAU,IAAI,mBAAmB,QAAQ,iBAAiB;AAChE,WAAK,mBAAmB,IAAI,OAAO,MAAM,GAAG,OAAO;AAAA,IACpD;AAAA,EACD;AAAA,EAEA,qBAAqB,WAAoC;AACxD,eAAW,MAAM,WAAW;AAC3B,WAAK,mBAAmB,IAAI,EAAE,GAAG,QAAQ;AACzC,WAAK,mBAAmB,OAAO,EAAE;AAAA,IAClC;AAAA,EACD;AAAA,EAEQ,2BAAiC;AACxC,UAAM,SAAwC,uBAAO,OAAO,IAAI;AAChE,eAAW,cAAc,KAAK,eAAe,oBAAoB;AAChE,YAAM,YAAY,gCAAgC,UAAU;AAC5D,UAAI,aAAa,KAAK,mBAAmB,IAAI,UAAU,MAAM,CAAC,GAAG;AAChE,eAAO,UAAU,MAAM,CAAC,IAAI;AAAA,UAC3B,KAAK;AAAA,UACL,WAAW;AAAA,QACZ;AAAA,MACD;AAAA,IACD;AACA,QAAI,CAAC,OAAO,QAAQ,KAAK,sBAAsB,GAAG;AACjD,WAAK,yBAAyB;AAC9B,WAAK,OAAO,yBAAyB,MAAM;AAAA,IAC5C;AAAA,EACD;AAAA,EAEA,MAAM,yBACL,UACA,UACA,SACkB;AAClB,UAAM,gBAAwC;AAAA,MAC7C,gBAAgB,QAAQ;AAAA,MACxB,eAAe,QAAQ;AAAA,MACvB,QAAQ,QAAQ;AAAA;AAAA;AAAA;AAAA,MAIhB,YAAY,QAAQ,gBACjB,iBAAiB,UACjB;AAAA,MACH,OAAO,QAAQ;AAAA,MACf,UAAU;AAAA,IACX;AAEA,UAAM,aAAa,MAAM,KAAK,eAAe;AAAA,MAC5C,EAAE,UAAU,IAAI,OAAO,QAAQ,GAAG,SAAS,cAAc;AAAA,MACzD;AAAA,QACC,KAAK;AAAA,QACL,KAAK;AAAA,QACL,QAAQ;AAAA,MACT;AAAA,IACD;AACA,UAAM,iBAAiB,gCAAgC,UAAU;AAEjE,QAAI,gBAAgB;AACnB,aAAO,eAAe,MAAM;AAAA,IAC7B,OAAO;AACN,YAAM,IAAI;AAAA,QACT,iDAAiD,KAAK,UAAU,QAAQ,CAAC;AAAA,MAC1E;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAM,gBACL,IACA,OACA,YACgB;AAChB,UAAM,SAAS,KAAK,uBAAuB,kBAAkB,EAAE;AAC/D,QAAI,CAAC,QAAQ;AACZ;AAAA,IACD;AACA,UAAM,iBAAiB;AACvB,QAAI,CAAC,eAAe,SAAS,GAAG;AAC/B;AAAA,IACD;AAEA,QAAI,MAAM,SAAS,eAAe,UAAU,GAAG;AAC9C;AAAA,IACD;AAEA,UAAM,OAAO,eAAe,OAAO,MAAM,KAAK;AAE9C,YAAQ,YAAY;AAAA,MACnB,KAAK,yBAAyB;AAC7B,eAAO,eAAe,sBAAsB,KAAK;AAAA,MAClD,KAAK,yBAAyB;AAC7B,eAAO,eAAe,eAAe,IAAI;AAAA,MAC1C,KAAK,yBAAyB;AAC7B,eAAO,eAAe,gCAAgC,IAAI;AAAA,MAC3D,KAAK,yBAAyB;AAC7B,eAAO,eAAe,kBAAkB,IAAI;AAAA,IAC9C;AAAA,EACD;AAAA,EAEA,kBAAkB,IAAY,QAA4B;AACzD,UAAM,SAAS,KAAK,uBAAuB,kBAAkB,EAAE;AAC/D,QAAI,CAAC,QAAQ;AACZ;AAAA,IACD;AAEA,WAAO,cAAc,MAAM;AAE3B,QAAI,OAAO,QAAQ;AAClB,aAAO,SAAS;AAAA,QACf,OAAO,OAAO,CAAC,EAAE;AAAA,QACjB,KAAK,OAAO,CAAC,EAAE,QAAQ;AAAA,MACxB,CAAC;AAAA,IACF;AAAA,EACD;AACD;AAnLa,4BAAN;AAAA,EAYJ;AAAA,EACA;AAAA,EAEA;AAAA,EAEA;AAAA,GAjBU;",
  "names": []
}
