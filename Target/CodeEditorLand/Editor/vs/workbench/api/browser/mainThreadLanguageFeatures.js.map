{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadLanguageFeatures.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type { VSBuffer } from \"../../../base/common/buffer.js\";\nimport type { CancellationToken } from \"../../../base/common/cancellation.js\";\nimport {\n\ttype IReadonlyVSDataTransfer,\n\tVSDataTransfer,\n\tcreateStringDataTransferItem,\n} from \"../../../base/common/dataTransfer.js\";\nimport { CancellationError } from \"../../../base/common/errors.js\";\nimport { Emitter, type Event } from \"../../../base/common/event.js\";\nimport { HierarchicalKind } from \"../../../base/common/hierarchicalKind.js\";\nimport {\n\tDisposable,\n\tDisposableMap,\n\tcombinedDisposable,\n\ttoDisposable,\n} from \"../../../base/common/lifecycle.js\";\nimport { ResourceMap } from \"../../../base/common/map.js\";\nimport { revive } from \"../../../base/common/marshalling.js\";\nimport { mixin } from \"../../../base/common/objects.js\";\nimport { URI } from \"../../../base/common/uri.js\";\nimport type { ISingleEditOperation } from \"../../../editor/common/core/editOperation.js\";\nimport type {\n\tPosition as EditorPosition,\n\tIPosition,\n} from \"../../../editor/common/core/position.js\";\nimport type {\n\tRange as EditorRange,\n\tIRange,\n} from \"../../../editor/common/core/range.js\";\nimport type { Selection } from \"../../../editor/common/core/selection.js\";\nimport * as languages from \"../../../editor/common/languages.js\";\nimport { ILanguageService } from \"../../../editor/common/languages/language.js\";\nimport type {\n\tIndentationRule,\n\tLanguageConfiguration,\n\tOnEnterRule,\n} from \"../../../editor/common/languages/languageConfiguration.js\";\nimport { ILanguageConfigurationService } from \"../../../editor/common/languages/languageConfigurationRegistry.js\";\nimport type { ITextModel } from \"../../../editor/common/model.js\";\nimport { ILanguageFeaturesService } from \"../../../editor/common/services/languageFeatures.js\";\nimport { decodeSemanticTokensDto } from \"../../../editor/common/services/semanticTokensDto.js\";\nimport type { ExtensionIdentifier } from \"../../../platform/extensions/common/extensions.js\";\nimport { IUriIdentityService } from \"../../../platform/uriIdentity/common/uriIdentity.js\";\nimport * as callh from \"../../contrib/callHierarchy/common/callHierarchy.js\";\nimport * as search from \"../../contrib/search/common/search.js\";\nimport * as typeh from \"../../contrib/typeHierarchy/common/typeHierarchy.js\";\nimport {\n\ttype IExtHostContext,\n\textHostNamedCustomer,\n} from \"../../services/extensions/common/extHostCustomers.js\";\nimport {\n\tExtHostContext,\n\ttype ExtHostLanguageFeaturesShape,\n\ttype HoverWithId,\n\ttype ICallHierarchyItemDto,\n\ttype ICodeActionDto,\n\ttype ICodeActionProviderMetadataDto,\n\ttype IDocumentDropEditDto,\n\ttype IDocumentDropEditProviderMetadata,\n\ttype IDocumentFilterDto,\n\ttype IIndentationRuleDto,\n\ttype IInlayHintDto,\n\ttype ILanguageConfigurationDto,\n\ttype ILanguageWordDefinitionDto,\n\ttype ILinkDto,\n\ttype ILocationDto,\n\ttype ILocationLinkDto,\n\ttype IOnEnterRuleDto,\n\ttype IPasteEditDto,\n\ttype IPasteEditProviderMetadataDto,\n\ttype IRegExpDto,\n\ttype ISignatureHelpProviderMetadataDto,\n\ttype ISuggestDataDto,\n\tISuggestDataDtoField,\n\tISuggestResultDtoField,\n\ttype ITypeHierarchyItemDto,\n\ttype IWorkspaceSymbolDto,\n\ttype IdentifiableInlineCompletion,\n\ttype IdentifiableInlineCompletions,\n\ttype IdentifiableInlineEdit,\n\tMainContext,\n\ttype MainThreadLanguageFeaturesShape,\n} from \"../common/extHost.protocol.js\";\nimport * as typeConvert from \"../common/extHostTypeConverters.js\";\nimport { DataTransferFileCache } from \"../common/shared/dataTransferCache.js\";\nimport { reviveWorkspaceEditDto } from \"./mainThreadBulkEdits.js\";\n\n@extHostNamedCustomer(MainContext.MainThreadLanguageFeatures)\nexport class MainThreadLanguageFeatures\n\textends Disposable\n\timplements MainThreadLanguageFeaturesShape\n{\n\tprivate readonly _proxy: ExtHostLanguageFeaturesShape;\n\tprivate readonly _registrations = this._register(\n\t\tnew DisposableMap<number>(),\n\t);\n\n\tconstructor(\n\t\textHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@ILanguageConfigurationService private readonly _languageConfigurationService: ILanguageConfigurationService,\n\t\t@ILanguageFeaturesService private readonly _languageFeaturesService: ILanguageFeaturesService,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tsuper();\n\n\t\tthis._proxy = extHostContext.getProxy(ExtHostContext.ExtHostLanguageFeatures);\n\n\t\tif (this._languageService) {\n\t\t\tconst updateAllWordDefinitions = () => {\n\t\t\t\tconst wordDefinitionDtos: ILanguageWordDefinitionDto[] = [];\n\t\t\t\tfor (const languageId of _languageService.getRegisteredLanguageIds()) {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(languageId).getWordDefinition();\n\t\t\t\t\twordDefinitionDtos.push({\n\t\t\t\t\t\tlanguageId: languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tthis._proxy.$setWordDefinitions(wordDefinitionDtos);\n\t\t\t};\n\t\t\tthis._register(this._languageConfigurationService.onDidChange((e) => {\n\t\t\t\tif (e.languageId) {\n\t\t\t\t\tconst wordDefinition = this._languageConfigurationService.getLanguageConfiguration(e.languageId).getWordDefinition();\n\t\t\t\t\tthis._proxy.$setWordDefinitions([{\n\t\t\t\t\t\tlanguageId: e.languageId,\n\t\t\t\t\t\tregexSource: wordDefinition.source,\n\t\t\t\t\t\tregexFlags: wordDefinition.flags\n\t\t\t\t\t}]);\n\t\t\t\t} else {\n\t\t\t\t\tupdateAllWordDefinitions();\n\t\t\t\t}\n\t\t\t}));\n\t\t\tupdateAllWordDefinitions();\n\t\t}\n\t}\n\n\t$unregister(handle: number): void {\n\t\tthis._registrations.deleteAndDispose(handle);\n\t}\n\n\t//#region --- revive functions\n\n\tprivate static _reviveLocationDto(data?: ILocationDto): languages.Location;\n\tprivate static _reviveLocationDto(\n\t\tdata?: ILocationDto[],\n\t): languages.Location[];\n\tprivate static _reviveLocationDto(\n\t\tdata: ILocationDto | ILocationDto[] | undefined,\n\t): languages.Location | languages.Location[] | undefined {\n\t\tif (!data) {\n\t\t\treturn data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach((l) =>\n\t\t\t\tMainThreadLanguageFeatures._reviveLocationDto(l),\n\t\t\t);\n\t\t\treturn <languages.Location[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.Location>data;\n\t\t}\n\t}\n\n\tprivate static _reviveLocationLinkDto(\n\t\tdata: ILocationLinkDto,\n\t): languages.LocationLink;\n\tprivate static _reviveLocationLinkDto(\n\t\tdata: ILocationLinkDto[],\n\t): languages.LocationLink[];\n\tprivate static _reviveLocationLinkDto(\n\t\tdata: ILocationLinkDto | ILocationLinkDto[],\n\t): languages.LocationLink | languages.LocationLink[] {\n\t\tif (!data) {\n\t\t\treturn <languages.LocationLink>data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach((l) =>\n\t\t\t\tMainThreadLanguageFeatures._reviveLocationLinkDto(l),\n\t\t\t);\n\t\t\treturn <languages.LocationLink[]>data;\n\t\t} else {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t\treturn <languages.LocationLink>data;\n\t\t}\n\t}\n\n\tprivate static _reviveWorkspaceSymbolDto(\n\t\tdata: IWorkspaceSymbolDto,\n\t): search.IWorkspaceSymbol;\n\tprivate static _reviveWorkspaceSymbolDto(\n\t\tdata: IWorkspaceSymbolDto[],\n\t): search.IWorkspaceSymbol[];\n\tprivate static _reviveWorkspaceSymbolDto(data: undefined): undefined;\n\tprivate static _reviveWorkspaceSymbolDto(\n\t\tdata: IWorkspaceSymbolDto | IWorkspaceSymbolDto[] | undefined,\n\t): search.IWorkspaceSymbol | search.IWorkspaceSymbol[] | undefined {\n\t\tif (!data) {\n\t\t\treturn <undefined>data;\n\t\t} else if (Array.isArray(data)) {\n\t\t\tdata.forEach(MainThreadLanguageFeatures._reviveWorkspaceSymbolDto);\n\t\t\treturn <search.IWorkspaceSymbol[]>data;\n\t\t} else {\n\t\t\tdata.location = MainThreadLanguageFeatures._reviveLocationDto(\n\t\t\t\tdata.location,\n\t\t\t);\n\t\t\treturn <search.IWorkspaceSymbol>data;\n\t\t}\n\t}\n\n\tprivate static _reviveCodeActionDto(\n\t\tdata: ReadonlyArray<ICodeActionDto>,\n\t\turiIdentService: IUriIdentityService,\n\t): languages.CodeAction[] {\n\t\tdata?.forEach((code) =>\n\t\t\treviveWorkspaceEditDto(code.edit, uriIdentService),\n\t\t);\n\t\treturn <languages.CodeAction[]>data;\n\t}\n\n\tprivate static _reviveLinkDTO(data: ILinkDto): languages.ILink {\n\t\tif (data.url && typeof data.url !== \"string\") {\n\t\t\tdata.url = URI.revive(data.url);\n\t\t}\n\t\treturn <languages.ILink>data;\n\t}\n\n\tprivate static _reviveCallHierarchyItemDto(\n\t\tdata: ICallHierarchyItemDto | undefined,\n\t): callh.CallHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as callh.CallHierarchyItem;\n\t}\n\n\tprivate static _reviveTypeHierarchyItemDto(\n\t\tdata: ITypeHierarchyItemDto | undefined,\n\t): typeh.TypeHierarchyItem {\n\t\tif (data) {\n\t\t\tdata.uri = URI.revive(data.uri);\n\t\t}\n\t\treturn data as typeh.TypeHierarchyItem;\n\t}\n\n\t//#endregion\n\n\t// --- outline\n\n\t$registerDocumentSymbolProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tdisplayName: string,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentSymbolProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tdisplayName,\n\t\t\t\t\tprovideDocumentSymbols: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<languages.DocumentSymbol[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideDocumentSymbols(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- code lens\n\n\t$registerCodeLensSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\teventHandle: number | undefined,\n\t): void {\n\t\tconst provider: languages.CodeLensProvider = {\n\t\t\tprovideCodeLenses: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.CodeLensList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeLenses(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tlenses: listDto.lenses,\n\t\t\t\t\tdispose: () =>\n\t\t\t\t\t\tlistDto.cacheId &&\n\t\t\t\t\t\tthis._proxy.$releaseCodeLenses(handle, listDto.cacheId),\n\t\t\t\t};\n\t\t\t},\n\t\t\tresolveCodeLens: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\tcodeLens: languages.CodeLens,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.CodeLens | undefined> => {\n\t\t\t\tconst result = await this._proxy.$resolveCodeLens(\n\t\t\t\t\thandle,\n\t\t\t\t\tcodeLens,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...result,\n\t\t\t\t\trange: model.validateRange(result.range),\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\n\t\tif (typeof eventHandle === \"number\") {\n\t\t\tconst emitter = new Emitter<languages.CodeLensProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.codeLensProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$emitCodeLensEvent(eventHandle: number, event?: any): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- declaration\n\n\t$registerDefinitionSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.definitionProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideDefinition: (\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t): Promise<languages.LocationLink[]> => {\n\t\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t\t.$provideDefinition(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLocationLinkDto,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerDeclarationSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.declarationProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideDeclaration: (model, position, token) => {\n\t\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t\t.$provideDeclaration(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLocationLinkDto,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerImplementationSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.implementationProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideImplementation: (\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t): Promise<languages.LocationLink[]> => {\n\t\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t\t.$provideImplementation(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLocationLinkDto,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerTypeDefinitionSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.typeDefinitionProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideTypeDefinition: (\n\t\t\t\t\t\tmodel,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t): Promise<languages.LocationLink[]> => {\n\t\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t\t.$provideTypeDefinition(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then(\n\t\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLocationLinkDto,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- extra info\n\n\t$registerHoverProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\t/*\n\t\tconst hoverFinalizationRegistry = new FinalizationRegistry((hoverId: number) => {\n\t\t\tthis._proxy.$releaseHover(handle, hoverId);\n\t\t});\n\t\t*/\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.hoverProvider.register(selector, {\n\t\t\t\tprovideHover: async (\n\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\tcontext?: languages.HoverContext<HoverWithId>,\n\t\t\t\t): Promise<HoverWithId | undefined> => {\n\t\t\t\t\tconst serializedContext: languages.HoverContext<{\n\t\t\t\t\t\tid: number;\n\t\t\t\t\t}> = {\n\t\t\t\t\t\tverbosityRequest: context?.verbosityRequest\n\t\t\t\t\t\t\t? {\n\t\t\t\t\t\t\t\t\tverbosityDelta:\n\t\t\t\t\t\t\t\t\t\tcontext.verbosityRequest.verbosityDelta,\n\t\t\t\t\t\t\t\t\tpreviousHover: {\n\t\t\t\t\t\t\t\t\t\tid: context.verbosityRequest\n\t\t\t\t\t\t\t\t\t\t\t.previousHover.id,\n\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t};\n\t\t\t\t\tconst hover = await this._proxy.$provideHover(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tserializedContext,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t\t// hoverFinalizationRegistry.register(hover, hover.id);\n\t\t\t\t\treturn hover;\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t// --- debug hover\n\n\t$registerEvaluatableExpressionProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.evaluatableExpressionProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideEvaluatableExpression: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<languages.EvaluatableExpression | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideEvaluatableExpression(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- inline values\n\n\t$registerInlineValuesProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\teventHandle: number | undefined,\n\t): void {\n\t\tconst provider: languages.InlineValuesProvider = {\n\t\t\tprovideInlineValues: (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\tviewPort: EditorRange,\n\t\t\t\tcontext: languages.InlineValueContext,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.InlineValue[] | undefined> => {\n\t\t\t\treturn this._proxy.$provideInlineValues(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\tviewPort,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\n\t\tif (typeof eventHandle === \"number\") {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlineValues = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.inlineValuesProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$emitInlineValuesEvent(eventHandle: number, event?: any): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// --- occurrences\n\n\t$registerDocumentHighlightProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentHighlightProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideDocumentHighlights: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<languages.DocumentHighlight[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideDocumentHighlights(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerMultiDocumentHighlightProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.multiDocumentHighlightProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tselector: selector,\n\t\t\t\t\tprovideMultiDocumentHighlights: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\totherModels: ITextModel[],\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<\n\t\t\t\t\t\tMap<URI, languages.DocumentHighlight[]> | undefined\n\t\t\t\t\t> => {\n\t\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t\t.$provideMultiDocumentHighlights(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\totherModels.map((model) => model.uri),\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t.then((dto) => {\n\t\t\t\t\t\t\t\t// dto should be non-null + non-undefined\n\t\t\t\t\t\t\t\t// dto length of 0 is valid, just no highlights, pass this through.\n\t\t\t\t\t\t\t\tif (dto === undefined || dto === null) {\n\t\t\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tconst result = new ResourceMap<\n\t\t\t\t\t\t\t\t\tlanguages.DocumentHighlight[]\n\t\t\t\t\t\t\t\t>();\n\t\t\t\t\t\t\t\tdto?.forEach((value) => {\n\t\t\t\t\t\t\t\t\t// check if the URI exists already, if so, combine the highlights, otherwise create a new entry\n\t\t\t\t\t\t\t\t\tconst uri = URI.revive(value.uri);\n\t\t\t\t\t\t\t\t\tif (result.has(uri)) {\n\t\t\t\t\t\t\t\t\t\tresult\n\t\t\t\t\t\t\t\t\t\t\t.get(uri)!\n\t\t\t\t\t\t\t\t\t\t\t.push(...value.highlights);\n\t\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\t\tresult.set(uri, value.highlights);\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t\treturn result;\n\t\t\t\t\t\t\t});\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- linked editing\n\n\t$registerLinkedEditingRangeProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.linkedEditingRangeProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideLinkedEditingRanges: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<languages.LinkedEditingRanges | undefined> => {\n\t\t\t\t\t\tconst res =\n\t\t\t\t\t\t\tawait this._proxy.$provideLinkedEditingRanges(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\tif (res) {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\tranges: res.ranges,\n\t\t\t\t\t\t\t\twordPattern: res.wordPattern\n\t\t\t\t\t\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\t\t\t\t\t\tres.wordPattern,\n\t\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- references\n\n\t$registerReferenceSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.referenceProvider.register(selector, {\n\t\t\t\tprovideReferences: (\n\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\tcontext: languages.ReferenceContext,\n\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t): Promise<languages.Location[]> => {\n\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t.$provideReferences(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.then(MainThreadLanguageFeatures._reviveLocationDto);\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t// --- code actions\n\n\t$registerCodeActionSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tmetadata: ICodeActionProviderMetadataDto,\n\t\tdisplayName: string,\n\t\textensionId: string,\n\t\tsupportsResolve: boolean,\n\t): void {\n\t\tconst provider: languages.CodeActionProvider = {\n\t\t\tprovideCodeActions: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\trangeOrSelection: EditorRange | Selection,\n\t\t\t\tcontext: languages.CodeActionContext,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.CodeActionList | undefined> => {\n\t\t\t\tconst listDto = await this._proxy.$provideCodeActions(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\trangeOrSelection,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (!listDto) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tactions: MainThreadLanguageFeatures._reviveCodeActionDto(\n\t\t\t\t\t\tlistDto.actions,\n\t\t\t\t\t\tthis._uriIdentService,\n\t\t\t\t\t),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof listDto.cacheId === \"number\") {\n\t\t\t\t\t\t\tthis._proxy.$releaseCodeActions(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tlistDto.cacheId,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t\tprovidedCodeActionKinds: metadata.providedKinds,\n\t\t\tdocumentation: metadata.documentation,\n\t\t\tdisplayName,\n\t\t\textensionId,\n\t\t};\n\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveCodeAction = async (\n\t\t\t\tcodeAction: languages.CodeAction,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.CodeAction> => {\n\t\t\t\tconst resolved = await this._proxy.$resolveCodeAction(\n\t\t\t\t\thandle,\n\t\t\t\t\t(<ICodeActionDto>codeAction).cacheId!,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (resolved.edit) {\n\t\t\t\t\tcodeAction.edit = reviveWorkspaceEditDto(\n\t\t\t\t\t\tresolved.edit,\n\t\t\t\t\t\tthis._uriIdentService,\n\t\t\t\t\t);\n\t\t\t\t}\n\n\t\t\t\tif (resolved.command) {\n\t\t\t\t\tcodeAction.command = resolved.command;\n\t\t\t\t}\n\n\t\t\t\treturn codeAction;\n\t\t\t};\n\t\t}\n\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.codeActionProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- copy paste action provider\n\n\tprivate readonly _pasteEditProviders = new Map<\n\t\tnumber,\n\t\tMainThreadPasteEditProvider\n\t>();\n\n\t$registerPasteEditProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tmetadata: IPasteEditProviderMetadataDto,\n\t): void {\n\t\tconst provider = new MainThreadPasteEditProvider(\n\t\t\thandle,\n\t\t\tthis._proxy,\n\t\t\tmetadata,\n\t\t\tthis._uriIdentService,\n\t\t);\n\t\tthis._pasteEditProviders.set(handle, provider);\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tcombinedDisposable(\n\t\t\t\tthis._languageFeaturesService.documentPasteEditProvider.register(\n\t\t\t\t\tselector,\n\t\t\t\t\tprovider,\n\t\t\t\t),\n\t\t\t\ttoDisposable(() => this._pasteEditProviders.delete(handle)),\n\t\t\t),\n\t\t);\n\t}\n\n\t$resolvePasteFileData(\n\t\thandle: number,\n\t\trequestId: number,\n\t\tdataId: string,\n\t): Promise<VSBuffer> {\n\t\tconst provider = this._pasteEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error(\"Could not find provider\");\n\t\t}\n\t\treturn provider.resolveFileData(requestId, dataId);\n\t}\n\n\t// --- formatting\n\n\t$registerDocumentFormattingSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\textensionId: ExtensionIdentifier,\n\t\tdisplayName: string,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentFormattingEditProvider.register(\n\t\t\t\tselector,\n\t\t\t\t<languages.DocumentFormattingEditProvider>{\n\t\t\t\t\textensionId,\n\t\t\t\t\tdisplayName,\n\t\t\t\t\tprovideDocumentFormattingEdits: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\toptions: languages.FormattingOptions,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<ISingleEditOperation[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideDocumentFormattingEdits(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerRangeFormattingSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\textensionId: ExtensionIdentifier,\n\t\tdisplayName: string,\n\t\tsupportsRanges: boolean,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentRangeFormattingEditProvider.register(\n\t\t\t\tselector,\n\t\t\t\t<languages.DocumentRangeFormattingEditProvider>{\n\t\t\t\t\textensionId,\n\t\t\t\t\tdisplayName,\n\t\t\t\t\tprovideDocumentRangeFormattingEdits: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\trange: EditorRange,\n\t\t\t\t\t\toptions: languages.FormattingOptions,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<ISingleEditOperation[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideDocumentRangeFormattingEdits(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t\tprovideDocumentRangesFormattingEdits: supportsRanges\n\t\t\t\t\t\t? (model, ranges, options, token) => {\n\t\t\t\t\t\t\t\treturn this._proxy.$provideDocumentRangesFormattingEdits(\n\t\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\t\tranges,\n\t\t\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t: undefined,\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerOnTypeFormattingSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tautoFormatTriggerCharacters: string[],\n\t\textensionId: ExtensionIdentifier,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.onTypeFormattingEditProvider.register(\n\t\t\t\tselector,\n\t\t\t\t<languages.OnTypeFormattingEditProvider>{\n\t\t\t\t\textensionId,\n\t\t\t\t\tautoFormatTriggerCharacters,\n\t\t\t\t\tprovideOnTypeFormattingEdits: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\tch: string,\n\t\t\t\t\t\toptions: languages.FormattingOptions,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<ISingleEditOperation[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideOnTypeFormattingEdits(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tch,\n\t\t\t\t\t\t\toptions,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- navigate type\n\n\t$registerNavigateTypeSupport(\n\t\thandle: number,\n\t\tsupportsResolve: boolean,\n\t): void {\n\t\tlet lastResultId: number | undefined;\n\n\t\tconst provider: search.IWorkspaceSymbolProvider = {\n\t\t\tprovideWorkspaceSymbols: async (\n\t\t\t\tsearch: string,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<search.IWorkspaceSymbol[]> => {\n\t\t\t\tconst result = await this._proxy.$provideWorkspaceSymbols(\n\t\t\t\t\thandle,\n\t\t\t\t\tsearch,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (lastResultId !== undefined) {\n\t\t\t\t\tthis._proxy.$releaseWorkspaceSymbols(handle, lastResultId);\n\t\t\t\t}\n\t\t\t\tlastResultId = result.cacheId;\n\t\t\t\treturn MainThreadLanguageFeatures._reviveWorkspaceSymbolDto(\n\t\t\t\t\tresult.symbols,\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveWorkspaceSymbol = async (\n\t\t\t\titem: search.IWorkspaceSymbol,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<search.IWorkspaceSymbol | undefined> => {\n\t\t\t\tconst resolvedItem = await this._proxy.$resolveWorkspaceSymbol(\n\t\t\t\t\thandle,\n\t\t\t\t\titem,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\treturn (\n\t\t\t\t\tresolvedItem &&\n\t\t\t\t\tMainThreadLanguageFeatures._reviveWorkspaceSymbolDto(\n\t\t\t\t\t\tresolvedItem,\n\t\t\t\t\t)\n\t\t\t\t);\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tsearch.WorkspaceSymbolProviderRegistry.register(provider),\n\t\t);\n\t}\n\n\t// --- rename\n\n\t$registerRenameSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tsupportResolveLocation: boolean,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.renameProvider.register(selector, {\n\t\t\t\tprovideRenameEdits: (\n\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\tnewName: string,\n\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t) => {\n\t\t\t\t\treturn this._proxy\n\t\t\t\t\t\t.$provideRenameEdits(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tnewName,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.then((data) =>\n\t\t\t\t\t\t\treviveWorkspaceEditDto(data, this._uriIdentService),\n\t\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tresolveRenameLocation: supportResolveLocation\n\t\t\t\t\t? (\n\t\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t\t): Promise<languages.RenameLocation | undefined> =>\n\t\t\t\t\t\t\tthis._proxy.$resolveRenameLocation(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t\t)\n\t\t\t\t\t: undefined,\n\t\t\t}),\n\t\t);\n\t}\n\n\t$registerNewSymbolNamesProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.newSymbolNamesProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tsupportsAutomaticNewSymbolNamesTriggerKind:\n\t\t\t\t\t\tthis._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t),\n\t\t\t\t\tprovideNewSymbolNames: (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\trange: IRange,\n\t\t\t\t\t\ttriggerKind: languages.NewSymbolNameTriggerKind,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t): Promise<languages.NewSymbolName[] | undefined> => {\n\t\t\t\t\t\treturn this._proxy.$provideNewSymbolNames(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\trange,\n\t\t\t\t\t\t\ttriggerKind,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t} satisfies languages.NewSymbolNamesProvider,\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- semantic tokens\n\n\t$registerDocumentSemanticTokensProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tlegend: languages.SemanticTokensLegend,\n\t\teventHandle: number | undefined,\n\t): void {\n\t\tlet event: Event<void> | undefined;\n\t\tif (typeof eventHandle === \"number\") {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tevent = emitter.event;\n\t\t}\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentSemanticTokensProvider.register(\n\t\t\t\tselector,\n\t\t\t\tnew MainThreadDocumentSemanticTokensProvider(\n\t\t\t\t\tthis._proxy,\n\t\t\t\t\thandle,\n\t\t\t\t\tlegend,\n\t\t\t\t\tevent,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\t$emitDocumentSemanticTokensEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t$registerDocumentRangeSemanticTokensProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tlegend: languages.SemanticTokensLegend,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.documentRangeSemanticTokensProvider.register(\n\t\t\t\tselector,\n\t\t\t\tnew MainThreadDocumentRangeSemanticTokensProvider(\n\t\t\t\t\tthis._proxy,\n\t\t\t\t\thandle,\n\t\t\t\t\tlegend,\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- suggest\n\n\tprivate static _inflateSuggestDto(\n\t\tdefaultRange: IRange | { insert: IRange; replace: IRange },\n\t\tdata: ISuggestDataDto,\n\t\textensionId: ExtensionIdentifier,\n\t): languages.CompletionItem {\n\t\tconst label = data[ISuggestDataDtoField.label];\n\t\tconst commandId = data[ISuggestDataDtoField.commandId];\n\t\tconst commandIdent = data[ISuggestDataDtoField.commandIdent];\n\t\tconst commitChars = data[ISuggestDataDtoField.commitCharacters];\n\n\t\treturn {\n\t\t\tlabel,\n\t\t\textensionId,\n\t\t\tkind:\n\t\t\t\tdata[ISuggestDataDtoField.kind] ??\n\t\t\t\tlanguages.CompletionItemKind.Property,\n\t\t\ttags: data[ISuggestDataDtoField.kindModifier],\n\t\t\tdetail: data[ISuggestDataDtoField.detail],\n\t\t\tdocumentation: data[ISuggestDataDtoField.documentation],\n\t\t\tsortText: data[ISuggestDataDtoField.sortText],\n\t\t\tfilterText: data[ISuggestDataDtoField.filterText],\n\t\t\tpreselect: data[ISuggestDataDtoField.preselect],\n\t\t\tinsertText:\n\t\t\t\tdata[ISuggestDataDtoField.insertText] ??\n\t\t\t\t(typeof label === \"string\" ? label : label.label),\n\t\t\trange: data[ISuggestDataDtoField.range] ?? defaultRange,\n\t\t\tinsertTextRules: data[ISuggestDataDtoField.insertTextRules],\n\t\t\tcommitCharacters: commitChars ? Array.from(commitChars) : undefined,\n\t\t\tadditionalTextEdits: data[ISuggestDataDtoField.additionalTextEdits],\n\t\t\tcommand: commandId\n\t\t\t\t? ({\n\t\t\t\t\t\t$ident: commandIdent,\n\t\t\t\t\t\tid: commandId,\n\t\t\t\t\t\ttitle: \"\",\n\t\t\t\t\t\targuments: commandIdent\n\t\t\t\t\t\t\t? [commandIdent]\n\t\t\t\t\t\t\t: data[ISuggestDataDtoField.commandArguments], // Automatically fill in ident as first argument\n\t\t\t\t\t} as languages.Command)\n\t\t\t\t: undefined,\n\t\t\t// not-standard\n\t\t\t_id: data.x,\n\t\t};\n\t}\n\n\t$registerCompletionsProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\ttriggerCharacters: string[],\n\t\tsupportsResolveDetails: boolean,\n\t\textensionId: ExtensionIdentifier,\n\t): void {\n\t\tconst provider: languages.CompletionItemProvider = {\n\t\t\ttriggerCharacters,\n\t\t\t_debugDisplayName: `${extensionId.value}(${triggerCharacters.join(\"\")})`,\n\t\t\tprovideCompletionItems: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\tposition: EditorPosition,\n\t\t\t\tcontext: languages.CompletionContext,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.CompletionList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideCompletionItems(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\tposition,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\tsuggestions: result[ISuggestResultDtoField.completions].map(\n\t\t\t\t\t\t(d) =>\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._inflateSuggestDto(\n\t\t\t\t\t\t\t\tresult[ISuggestResultDtoField.defaultRanges],\n\t\t\t\t\t\t\t\td,\n\t\t\t\t\t\t\t\textensionId,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t),\n\t\t\t\t\tincomplete:\n\t\t\t\t\t\tresult[ISuggestResultDtoField.isIncomplete] || false,\n\t\t\t\t\tduration: result[ISuggestResultDtoField.duration],\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (typeof result.x === \"number\") {\n\t\t\t\t\t\t\tthis._proxy.$releaseCompletionItems(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tresult.x,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\t\tif (supportsResolveDetails) {\n\t\t\tprovider.resolveCompletionItem = (suggestion, token) => {\n\t\t\t\treturn this._proxy\n\t\t\t\t\t.$resolveCompletionItem(handle, suggestion._id!, token)\n\t\t\t\t\t.then((result) => {\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\treturn suggestion;\n\t\t\t\t\t\t}\n\n\t\t\t\t\t\tconst newSuggestion =\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._inflateSuggestDto(\n\t\t\t\t\t\t\t\tsuggestion.range,\n\t\t\t\t\t\t\t\tresult,\n\t\t\t\t\t\t\t\textensionId,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\treturn mixin(suggestion, newSuggestion, true);\n\t\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.completionProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerInlineCompletionsSupport(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tsupportsHandleEvents: boolean,\n\t\textensionId: string,\n\t\tyieldsToExtensionIds: string[],\n\t): void {\n\t\tconst provider: languages.InlineCompletionsProvider<IdentifiableInlineCompletions> =\n\t\t\t{\n\t\t\t\tprovideInlineCompletions: async (\n\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\tcontext: languages.InlineCompletionContext,\n\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t): Promise<IdentifiableInlineCompletions | undefined> => {\n\t\t\t\t\treturn this._proxy.$provideInlineCompletions(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tprovideInlineEdits: async (\n\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\trange: EditorRange,\n\t\t\t\t\tcontext: languages.InlineCompletionContext,\n\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t): Promise<IdentifiableInlineCompletions | undefined> => {\n\t\t\t\t\treturn this._proxy.$provideInlineEdits(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\trange,\n\t\t\t\t\t\tcontext,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\thandleItemDidShow: async (\n\t\t\t\t\tcompletions: IdentifiableInlineCompletions,\n\t\t\t\t\titem: IdentifiableInlineCompletion,\n\t\t\t\t\tupdatedInsertText: string,\n\t\t\t\t): Promise<void> => {\n\t\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\t\tawait this._proxy.$handleInlineCompletionDidShow(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tcompletions.pid,\n\t\t\t\t\t\t\titem.idx,\n\t\t\t\t\t\t\tupdatedInsertText,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\thandlePartialAccept: async (\n\t\t\t\t\tcompletions,\n\t\t\t\t\titem,\n\t\t\t\t\tacceptedCharacters,\n\t\t\t\t\tinfo: languages.PartialAcceptInfo,\n\t\t\t\t): Promise<void> => {\n\t\t\t\t\tif (supportsHandleEvents) {\n\t\t\t\t\t\tawait this._proxy.$handleInlineCompletionPartialAccept(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tcompletions.pid,\n\t\t\t\t\t\t\titem.idx,\n\t\t\t\t\t\t\tacceptedCharacters,\n\t\t\t\t\t\t\tinfo,\n\t\t\t\t\t\t);\n\t\t\t\t\t}\n\t\t\t\t},\n\t\t\t\tfreeInlineCompletions: (\n\t\t\t\t\tcompletions: IdentifiableInlineCompletions,\n\t\t\t\t): void => {\n\t\t\t\t\tthis._proxy.$freeInlineCompletionsList(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tcompletions.pid,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tgroupId: extensionId,\n\t\t\t\tyieldsToGroupIds: yieldsToExtensionIds,\n\t\t\t\ttoString() {\n\t\t\t\t\treturn `InlineCompletionsProvider(${extensionId})`;\n\t\t\t\t},\n\t\t\t};\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.inlineCompletionsProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$registerInlineEditProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\textensionId: ExtensionIdentifier,\n\t): void {\n\t\tconst provider: languages.InlineEditProvider<IdentifiableInlineEdit> = {\n\t\t\tprovideInlineEdit: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\tcontext: languages.IInlineEditContext,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<IdentifiableInlineEdit | undefined> => {\n\t\t\t\treturn this._proxy.$provideInlineEdit(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t},\n\t\t\tfreeInlineEdit: (edit: IdentifiableInlineEdit): void => {\n\t\t\t\tthis._proxy.$freeInlineEdit(handle, edit.pid);\n\t\t\t},\n\t\t};\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.inlineEditProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- parameter hints\n\n\t$registerSignatureHelpProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tmetadata: ISignatureHelpProviderMetadataDto,\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.signatureHelpProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tsignatureHelpTriggerCharacters: metadata.triggerCharacters,\n\t\t\t\t\tsignatureHelpRetriggerCharacters:\n\t\t\t\t\t\tmetadata.retriggerCharacters,\n\n\t\t\t\t\tprovideSignatureHelp: async (\n\t\t\t\t\t\tmodel: ITextModel,\n\t\t\t\t\t\tposition: EditorPosition,\n\t\t\t\t\t\ttoken: CancellationToken,\n\t\t\t\t\t\tcontext: languages.SignatureHelpContext,\n\t\t\t\t\t): Promise<languages.SignatureHelpResult | undefined> => {\n\t\t\t\t\t\tconst result = await this._proxy.$provideSignatureHelp(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\tcontext,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t\tif (!result) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tvalue: result,\n\t\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\t\tthis._proxy.$releaseSignatureHelp(\n\t\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\t\tresult.id,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- inline hints\n\n\t$registerInlayHintsProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tsupportsResolve: boolean,\n\t\teventHandle: number | undefined,\n\t\tdisplayName: string | undefined,\n\t): void {\n\t\tconst provider: languages.InlayHintsProvider = {\n\t\t\tdisplayName,\n\t\t\tprovideInlayHints: async (\n\t\t\t\tmodel: ITextModel,\n\t\t\t\trange: EditorRange,\n\t\t\t\ttoken: CancellationToken,\n\t\t\t): Promise<languages.InlayHintList | undefined> => {\n\t\t\t\tconst result = await this._proxy.$provideInlayHints(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\trange,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\thints: revive(result.hints),\n\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\tif (result.cacheId) {\n\t\t\t\t\t\t\tthis._proxy.$releaseInlayHints(\n\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\tresult.cacheId,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t\t}\n\t\t\t\t\t},\n\t\t\t\t};\n\t\t\t},\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveInlayHint = async (hint, token) => {\n\t\t\t\tconst dto: IInlayHintDto = hint;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\tconst result = await this._proxy.$resolveInlayHint(\n\t\t\t\t\thandle,\n\t\t\t\t\tdto.cacheId,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\tthrow new CancellationError();\n\t\t\t\t}\n\t\t\t\tif (!result) {\n\t\t\t\t\treturn hint;\n\t\t\t\t}\n\t\t\t\treturn {\n\t\t\t\t\t...hint,\n\t\t\t\t\ttooltip: result.tooltip,\n\t\t\t\t\tlabel: revive<string | languages.InlayHintLabelPart[]>(\n\t\t\t\t\t\tresult.label,\n\t\t\t\t\t),\n\t\t\t\t\ttextEdits: result.textEdits,\n\t\t\t\t};\n\t\t\t};\n\t\t}\n\t\tif (typeof eventHandle === \"number\") {\n\t\t\tconst emitter = new Emitter<void>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChangeInlayHints = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.inlayHintsProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$emitInlayHintsEvent(eventHandle: number): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(undefined);\n\t\t}\n\t}\n\n\t// --- links\n\n\t$registerDocumentLinkProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tsupportsResolve: boolean,\n\t): void {\n\t\tconst provider: languages.LinkProvider = {\n\t\t\tprovideLinks: (model, token) => {\n\t\t\t\treturn this._proxy\n\t\t\t\t\t.$provideDocumentLinks(handle, model.uri, token)\n\t\t\t\t\t.then((dto) => {\n\t\t\t\t\t\tif (!dto) {\n\t\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t\t}\n\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\tlinks: dto.links.map(\n\t\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLinkDTO,\n\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\t\tif (typeof dto.cacheId === \"number\") {\n\t\t\t\t\t\t\t\t\tthis._proxy.$releaseDocumentLinks(\n\t\t\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\t\t\tdto.cacheId,\n\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t};\n\t\t\t\t\t});\n\t\t\t},\n\t\t};\n\t\tif (supportsResolve) {\n\t\t\tprovider.resolveLink = (link, token) => {\n\t\t\t\tconst dto: ILinkDto = link;\n\t\t\t\tif (!dto.cacheId) {\n\t\t\t\t\treturn link;\n\t\t\t\t}\n\t\t\t\treturn this._proxy\n\t\t\t\t\t.$resolveDocumentLink(handle, dto.cacheId, token)\n\t\t\t\t\t.then((obj) => {\n\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\tobj &&\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveLinkDTO(obj)\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t};\n\t\t}\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.linkProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- colors\n\n\t$registerDocumentColorProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tconst proxy = this._proxy;\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.colorProvider.register(selector, {\n\t\t\t\tprovideDocumentColors: (model, token) => {\n\t\t\t\t\treturn proxy\n\t\t\t\t\t\t.$provideDocumentColors(handle, model.uri, token)\n\t\t\t\t\t\t.then((documentColors) => {\n\t\t\t\t\t\t\treturn documentColors.map((documentColor) => {\n\t\t\t\t\t\t\t\tconst [red, green, blue, alpha] =\n\t\t\t\t\t\t\t\t\tdocumentColor.color;\n\t\t\t\t\t\t\t\tconst color = {\n\t\t\t\t\t\t\t\t\tred: red,\n\t\t\t\t\t\t\t\t\tgreen: green,\n\t\t\t\t\t\t\t\t\tblue: blue,\n\t\t\t\t\t\t\t\t\talpha,\n\t\t\t\t\t\t\t\t};\n\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tcolor,\n\t\t\t\t\t\t\t\t\trange: documentColor.range,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t},\n\n\t\t\t\tprovideColorPresentations: (model, colorInfo, token) => {\n\t\t\t\t\treturn proxy.$provideColorPresentations(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tcolor: [\n\t\t\t\t\t\t\t\tcolorInfo.color.red,\n\t\t\t\t\t\t\t\tcolorInfo.color.green,\n\t\t\t\t\t\t\t\tcolorInfo.color.blue,\n\t\t\t\t\t\t\t\tcolorInfo.color.alpha,\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t\trange: colorInfo.range,\n\t\t\t\t\t\t},\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t// --- folding\n\n\t$registerFoldingRangeProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\textensionId: ExtensionIdentifier,\n\t\teventHandle: number | undefined,\n\t): void {\n\t\tconst provider: languages.FoldingRangeProvider = {\n\t\t\tid: extensionId.value,\n\t\t\tprovideFoldingRanges: (model, context, token) => {\n\t\t\t\treturn this._proxy.$provideFoldingRanges(\n\t\t\t\t\thandle,\n\t\t\t\t\tmodel.uri,\n\t\t\t\t\tcontext,\n\t\t\t\t\ttoken,\n\t\t\t\t);\n\t\t\t},\n\t\t};\n\n\t\tif (typeof eventHandle === \"number\") {\n\t\t\tconst emitter = new Emitter<languages.FoldingRangeProvider>();\n\t\t\tthis._registrations.set(eventHandle, emitter);\n\t\t\tprovider.onDidChange = emitter.event;\n\t\t}\n\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.foldingRangeProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n\n\t$emitFoldingRangeEvent(eventHandle: number, event?: any): void {\n\t\tconst obj = this._registrations.get(eventHandle);\n\t\tif (obj instanceof Emitter) {\n\t\t\tobj.fire(event);\n\t\t}\n\t}\n\n\t// -- smart select\n\n\t$registerSelectionRangeProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.selectionRangeProvider.register(\n\t\t\t\tselector,\n\t\t\t\t{\n\t\t\t\t\tprovideSelectionRanges: (model, positions, token) => {\n\t\t\t\t\t\treturn this._proxy.$provideSelectionRanges(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\tmodel.uri,\n\t\t\t\t\t\t\tpositions,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\t},\n\t\t\t\t},\n\t\t\t),\n\t\t);\n\t}\n\n\t// --- call hierarchy\n\n\t$registerCallHierarchyProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tcallh.CallHierarchyProviderRegistry.register(selector, {\n\t\t\t\tprepareCallHierarchy: async (document, position, token) => {\n\t\t\t\t\tconst items = await this._proxy.$prepareCallHierarchy(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tdocument.uri,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t\tif (!items || items.length === 0) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\t\tthis._proxy.$releaseCallHierarchy(\n\t\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\troots: items.map(\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveCallHierarchyItemDto,\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tprovideOutgoingCalls: async (item, token) => {\n\t\t\t\t\tconst outgoing =\n\t\t\t\t\t\tawait this._proxy.$provideCallHierarchyOutgoingCalls(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\titem._itemId,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!outgoing) {\n\t\t\t\t\t\treturn outgoing;\n\t\t\t\t\t}\n\t\t\t\t\toutgoing.forEach((value) => {\n\t\t\t\t\t\tvalue.to =\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveCallHierarchyItemDto(\n\t\t\t\t\t\t\t\tvalue.to,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\treturn <any>outgoing;\n\t\t\t\t},\n\t\t\t\tprovideIncomingCalls: async (item, token) => {\n\t\t\t\t\tconst incoming =\n\t\t\t\t\t\tawait this._proxy.$provideCallHierarchyIncomingCalls(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\titem._itemId,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!incoming) {\n\t\t\t\t\t\treturn incoming;\n\t\t\t\t\t}\n\t\t\t\t\tincoming.forEach((value) => {\n\t\t\t\t\t\tvalue.from =\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveCallHierarchyItemDto(\n\t\t\t\t\t\t\t\tvalue.from,\n\t\t\t\t\t\t\t);\n\t\t\t\t\t});\n\t\t\t\t\treturn <any>incoming;\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t// --- configuration\n\n\tprivate static _reviveRegExp(regExp: IRegExpDto): RegExp {\n\t\treturn new RegExp(regExp.pattern, regExp.flags);\n\t}\n\n\tprivate static _reviveIndentationRule(\n\t\tindentationRule: IIndentationRuleDto,\n\t): IndentationRule {\n\t\treturn {\n\t\t\tdecreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\tindentationRule.decreaseIndentPattern,\n\t\t\t),\n\t\t\tincreaseIndentPattern: MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\tindentationRule.increaseIndentPattern,\n\t\t\t),\n\t\t\tindentNextLinePattern: indentationRule.indentNextLinePattern\n\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\tindentationRule.indentNextLinePattern,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t\tunIndentedLinePattern: indentationRule.unIndentedLinePattern\n\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\tindentationRule.unIndentedLinePattern,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRule(\n\t\tonEnterRule: IOnEnterRuleDto,\n\t): OnEnterRule {\n\t\treturn {\n\t\t\tbeforeText: MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\tonEnterRule.beforeText,\n\t\t\t),\n\t\t\tafterText: onEnterRule.afterText\n\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\tonEnterRule.afterText,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t\tpreviousLineText: onEnterRule.previousLineText\n\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\tonEnterRule.previousLineText,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t\taction: onEnterRule.action,\n\t\t};\n\t}\n\n\tprivate static _reviveOnEnterRules(\n\t\tonEnterRules: IOnEnterRuleDto[],\n\t): OnEnterRule[] {\n\t\treturn onEnterRules.map(MainThreadLanguageFeatures._reviveOnEnterRule);\n\t}\n\n\t$setLanguageConfiguration(\n\t\thandle: number,\n\t\tlanguageId: string,\n\t\t_configuration: ILanguageConfigurationDto,\n\t): void {\n\t\tconst configuration: LanguageConfiguration = {\n\t\t\tcomments: _configuration.comments,\n\t\t\tbrackets: _configuration.brackets,\n\t\t\twordPattern: _configuration.wordPattern\n\t\t\t\t? MainThreadLanguageFeatures._reviveRegExp(\n\t\t\t\t\t\t_configuration.wordPattern,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t\tindentationRules: _configuration.indentationRules\n\t\t\t\t? MainThreadLanguageFeatures._reviveIndentationRule(\n\t\t\t\t\t\t_configuration.indentationRules,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\t\t\tonEnterRules: _configuration.onEnterRules\n\t\t\t\t? MainThreadLanguageFeatures._reviveOnEnterRules(\n\t\t\t\t\t\t_configuration.onEnterRules,\n\t\t\t\t\t)\n\t\t\t\t: undefined,\n\n\t\t\tautoClosingPairs: undefined,\n\t\t\tsurroundingPairs: undefined,\n\t\t\t__electricCharacterSupport: undefined,\n\t\t};\n\n\t\tif (_configuration.autoClosingPairs) {\n\t\t\tconfiguration.autoClosingPairs = _configuration.autoClosingPairs;\n\t\t} else if (_configuration.__characterPairSupport) {\n\t\t\t// backwards compatibility\n\t\t\tconfiguration.autoClosingPairs =\n\t\t\t\t_configuration.__characterPairSupport.autoClosingPairs;\n\t\t}\n\n\t\tif (\n\t\t\t_configuration.__electricCharacterSupport &&\n\t\t\t_configuration.__electricCharacterSupport.docComment\n\t\t) {\n\t\t\tconfiguration.__electricCharacterSupport = {\n\t\t\t\tdocComment: {\n\t\t\t\t\topen: _configuration.__electricCharacterSupport.docComment\n\t\t\t\t\t\t.open,\n\t\t\t\t\tclose: _configuration.__electricCharacterSupport.docComment\n\t\t\t\t\t\t.close,\n\t\t\t\t},\n\t\t\t};\n\t\t}\n\n\t\tif (this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\tthis._registrations.set(\n\t\t\t\thandle,\n\t\t\t\tthis._languageConfigurationService.register(\n\t\t\t\t\tlanguageId,\n\t\t\t\t\tconfiguration,\n\t\t\t\t\t100,\n\t\t\t\t),\n\t\t\t);\n\t\t}\n\t}\n\n\t// --- type hierarchy\n\n\t$registerTypeHierarchyProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t): void {\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\ttypeh.TypeHierarchyProviderRegistry.register(selector, {\n\t\t\t\tprepareTypeHierarchy: async (document, position, token) => {\n\t\t\t\t\tconst items = await this._proxy.$prepareTypeHierarchy(\n\t\t\t\t\t\thandle,\n\t\t\t\t\t\tdocument.uri,\n\t\t\t\t\t\tposition,\n\t\t\t\t\t\ttoken,\n\t\t\t\t\t);\n\t\t\t\t\tif (!items) {\n\t\t\t\t\t\treturn undefined;\n\t\t\t\t\t}\n\t\t\t\t\treturn {\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tfor (const item of items) {\n\t\t\t\t\t\t\t\tthis._proxy.$releaseTypeHierarchy(\n\t\t\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t},\n\t\t\t\t\t\troots: items.map(\n\t\t\t\t\t\t\tMainThreadLanguageFeatures._reviveTypeHierarchyItemDto,\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t},\n\n\t\t\t\tprovideSupertypes: async (item, token) => {\n\t\t\t\t\tconst supertypes =\n\t\t\t\t\t\tawait this._proxy.$provideTypeHierarchySupertypes(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\titem._itemId,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!supertypes) {\n\t\t\t\t\t\treturn supertypes;\n\t\t\t\t\t}\n\t\t\t\t\treturn supertypes.map(\n\t\t\t\t\t\tMainThreadLanguageFeatures._reviveTypeHierarchyItemDto,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t\tprovideSubtypes: async (item, token) => {\n\t\t\t\t\tconst subtypes =\n\t\t\t\t\t\tawait this._proxy.$provideTypeHierarchySubtypes(\n\t\t\t\t\t\t\thandle,\n\t\t\t\t\t\t\titem._sessionId,\n\t\t\t\t\t\t\titem._itemId,\n\t\t\t\t\t\t\ttoken,\n\t\t\t\t\t\t);\n\t\t\t\t\tif (!subtypes) {\n\t\t\t\t\t\treturn subtypes;\n\t\t\t\t\t}\n\t\t\t\t\treturn subtypes.map(\n\t\t\t\t\t\tMainThreadLanguageFeatures._reviveTypeHierarchyItemDto,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t}),\n\t\t);\n\t}\n\n\t// --- document drop Edits\n\n\tprivate readonly _documentOnDropEditProviders = new Map<\n\t\tnumber,\n\t\tMainThreadDocumentOnDropEditProvider\n\t>();\n\n\t$registerDocumentOnDropEditProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tmetadata: IDocumentDropEditProviderMetadata,\n\t): void {\n\t\tconst provider = new MainThreadDocumentOnDropEditProvider(\n\t\t\thandle,\n\t\t\tthis._proxy,\n\t\t\tmetadata,\n\t\t\tthis._uriIdentService,\n\t\t);\n\t\tthis._documentOnDropEditProviders.set(handle, provider);\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tcombinedDisposable(\n\t\t\t\tthis._languageFeaturesService.documentDropEditProvider.register(\n\t\t\t\t\tselector,\n\t\t\t\t\tprovider,\n\t\t\t\t),\n\t\t\t\ttoDisposable(() =>\n\t\t\t\t\tthis._documentOnDropEditProviders.delete(handle),\n\t\t\t\t),\n\t\t\t),\n\t\t);\n\t}\n\n\tasync $resolveDocumentOnDropFileData(\n\t\thandle: number,\n\t\trequestId: number,\n\t\tdataId: string,\n\t): Promise<VSBuffer> {\n\t\tconst provider = this._documentOnDropEditProviders.get(handle);\n\t\tif (!provider) {\n\t\t\tthrow new Error(\"Could not find provider\");\n\t\t}\n\t\treturn provider.resolveDocumentOnDropFileData(requestId, dataId);\n\t}\n\n\t// --- mapped edits\n\n\t$registerMappedEditsProvider(\n\t\thandle: number,\n\t\tselector: IDocumentFilterDto[],\n\t\tdisplayName: string,\n\t): void {\n\t\tconst provider = new MainThreadMappedEditsProvider(\n\t\t\tdisplayName,\n\t\t\thandle,\n\t\t\tthis._proxy,\n\t\t\tthis._uriIdentService,\n\t\t);\n\t\tthis._registrations.set(\n\t\t\thandle,\n\t\t\tthis._languageFeaturesService.mappedEditsProvider.register(\n\t\t\t\tselector,\n\t\t\t\tprovider,\n\t\t\t),\n\t\t);\n\t}\n}\n\nclass MainThreadPasteEditProvider\n\timplements languages.DocumentPasteEditProvider\n{\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\tpublic readonly copyMimeTypes?: readonly string[];\n\tpublic readonly pasteMimeTypes?: readonly string[];\n\tpublic readonly providedPasteEditKinds?: readonly HierarchicalKind[];\n\n\treadonly prepareDocumentPaste?: languages.DocumentPasteEditProvider[\"prepareDocumentPaste\"];\n\treadonly provideDocumentPasteEdits?: languages.DocumentPasteEditProvider[\"provideDocumentPasteEdits\"];\n\treadonly resolveDocumentPasteEdit?: languages.DocumentPasteEditProvider[\"resolveDocumentPasteEdit\"];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IPasteEditProviderMetadataDto,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.copyMimeTypes = metadata.copyMimeTypes;\n\t\tthis.pasteMimeTypes = metadata.pasteMimeTypes;\n\t\tthis.providedPasteEditKinds = metadata.providedPasteEditKinds?.map(kind => new HierarchicalKind(kind));\n\n\t\tif (metadata.supportsCopy) {\n\t\t\tthis.prepareDocumentPaste = async (model: ITextModel, selections: readonly IRange[], dataTransfer: IReadonlyVSDataTransfer, token: CancellationToken): Promise<IReadonlyVSDataTransfer | undefined> => {\n\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.from(dataTransfer);\n\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst newDataTransfer = await this._proxy.$prepareDocumentPaste(_handle, model.uri, selections, dataTransferDto, token);\n\t\t\t\tif (!newDataTransfer) {\n\t\t\t\t\treturn undefined;\n\t\t\t\t}\n\n\t\t\t\tconst dataTransferOut = new VSDataTransfer();\n\t\t\t\tfor (const [type, item] of newDataTransfer.items) {\n\t\t\t\t\tdataTransferOut.replace(type, createStringDataTransferItem(item.asString));\n\t\t\t\t}\n\t\t\t\treturn dataTransferOut;\n\t\t\t};\n\t\t}\n\n\t\tif (metadata.supportsPaste) {\n\t\t\tthis.provideDocumentPasteEdits = async (model: ITextModel, selections: Selection[], dataTransfer: IReadonlyVSDataTransfer, context: languages.DocumentPasteContext, token: CancellationToken) => {\n\t\t\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\t\t\ttry {\n\t\t\t\t\tconst dataTransferDto = await typeConvert.DataTransfer.from(dataTransfer);\n\t\t\t\t\tif (token.isCancellationRequested) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst edits = await this._proxy.$providePasteEdits(this._handle, request.id, model.uri, selections, dataTransferDto, {\n\t\t\t\t\t\tonly: context.only?.value,\n\t\t\t\t\t\ttriggerKind: context.triggerKind,\n\t\t\t\t\t}, token);\n\t\t\t\t\tif (!edits) {\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\treturn {\n\t\t\t\t\t\tedits: edits.map((edit): languages.DocumentPasteEdit => {\n\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t...edit,\n\t\t\t\t\t\t\t\tkind: edit.kind ? new HierarchicalKind(edit.kind.value) : new HierarchicalKind(''),\n\t\t\t\t\t\t\t\tyieldTo: edit.yieldTo?.map(x => ({ kind: new HierarchicalKind(x) })),\n\t\t\t\t\t\t\t\tadditionalEdit: edit.additionalEdit ? reviveWorkspaceEditDto(edit.additionalEdit, this._uriIdentService, dataId => this.resolveFileData(request.id, dataId)) : undefined,\n\t\t\t\t\t\t\t};\n\t\t\t\t\t\t}),\n\t\t\t\t\t\tdispose: () => {\n\t\t\t\t\t\t\tthis._proxy.$releasePasteEdits(this._handle, request.id);\n\t\t\t\t\t\t},\n\t\t\t\t\t};\n\t\t\t\t} finally {\n\t\t\t\t\trequest.dispose();\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tif (metadata.supportsResolve) {\n\t\t\tthis.resolveDocumentPasteEdit = async (edit: languages.DocumentPasteEdit, token: CancellationToken) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IPasteEditDto>edit)._cacheId!, token);\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tresolveFileData(requestId: number, dataId: string): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nclass MainThreadDocumentOnDropEditProvider\n\timplements languages.DocumentDropEditProvider\n{\n\tprivate readonly dataTransfers = new DataTransferFileCache();\n\n\treadonly dropMimeTypes?: readonly string[];\n\n\treadonly resolveDocumentDropEdit?: languages.DocumentDropEditProvider[\"resolveDocumentDropEdit\"];\n\n\tconstructor(\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tmetadata: IDocumentDropEditProviderMetadata | undefined,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) {\n\t\tthis.dropMimeTypes = metadata?.dropMimeTypes ?? ['*/*'];\n\n\t\tif (metadata?.supportsResolve) {\n\t\t\tthis.resolveDocumentDropEdit = async (edit, token) => {\n\t\t\t\tconst resolved = await this._proxy.$resolvePasteEdit(this._handle, (<IDocumentDropEditDto>edit)._cacheId!, token);\n\t\t\t\tif (resolved.additionalEdit) {\n\t\t\t\t\tedit.additionalEdit = reviveWorkspaceEditDto(resolved.additionalEdit, this._uriIdentService);\n\t\t\t\t}\n\t\t\t\treturn edit;\n\t\t\t};\n\t\t}\n\t}\n\n\tasync provideDocumentDropEdits(\n\t\tmodel: ITextModel,\n\t\tposition: IPosition,\n\t\tdataTransfer: IReadonlyVSDataTransfer,\n\t\ttoken: CancellationToken,\n\t): Promise<languages.DocumentDropEditsSession | undefined> {\n\t\tconst request = this.dataTransfers.add(dataTransfer);\n\t\ttry {\n\t\t\tconst dataTransferDto =\n\t\t\t\tawait typeConvert.DataTransfer.from(dataTransfer);\n\t\t\tif (token.isCancellationRequested) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst edits = await this._proxy.$provideDocumentOnDropEdits(\n\t\t\t\tthis._handle,\n\t\t\t\trequest.id,\n\t\t\t\tmodel.uri,\n\t\t\t\tposition,\n\t\t\t\tdataTransferDto,\n\t\t\t\ttoken,\n\t\t\t);\n\t\t\tif (!edits) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\treturn {\n\t\t\t\tedits: edits.map((edit) => {\n\t\t\t\t\treturn {\n\t\t\t\t\t\t...edit,\n\t\t\t\t\t\tyieldTo: edit.yieldTo?.map((x) => ({\n\t\t\t\t\t\t\tkind: new HierarchicalKind(x),\n\t\t\t\t\t\t})),\n\t\t\t\t\t\tkind: edit.kind\n\t\t\t\t\t\t\t? new HierarchicalKind(edit.kind)\n\t\t\t\t\t\t\t: undefined,\n\t\t\t\t\t\tadditionalEdit: reviveWorkspaceEditDto(\n\t\t\t\t\t\t\tedit.additionalEdit,\n\t\t\t\t\t\t\tthis._uriIdentService,\n\t\t\t\t\t\t\t(dataId) =>\n\t\t\t\t\t\t\t\tthis.resolveDocumentOnDropFileData(\n\t\t\t\t\t\t\t\t\trequest.id,\n\t\t\t\t\t\t\t\t\tdataId,\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t),\n\t\t\t\t\t};\n\t\t\t\t}),\n\t\t\t\tdispose: () => {\n\t\t\t\t\tthis._proxy.$releaseDocumentOnDropEdits(\n\t\t\t\t\t\tthis._handle,\n\t\t\t\t\t\trequest.id,\n\t\t\t\t\t);\n\t\t\t\t},\n\t\t\t};\n\t\t} finally {\n\t\t\trequest.dispose();\n\t\t}\n\t}\n\n\tpublic resolveDocumentOnDropFileData(\n\t\trequestId: number,\n\t\tdataId: string,\n\t): Promise<VSBuffer> {\n\t\treturn this.dataTransfers.resolveFileData(requestId, dataId);\n\t}\n}\n\nexport class MainThreadDocumentSemanticTokensProvider\n\timplements languages.DocumentSemanticTokensProvider\n{\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t\tpublic readonly onDidChange: Event<void> | undefined,\n\t) {}\n\n\tpublic releaseDocumentSemanticTokens(resultId: string | undefined): void {\n\t\tif (resultId) {\n\t\t\tthis._proxy.$releaseDocumentSemanticTokens(\n\t\t\t\tthis._handle,\n\t\t\t\tNumber.parseInt(resultId, 10),\n\t\t\t);\n\t\t}\n\t}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentSemanticTokens(\n\t\tmodel: ITextModel,\n\t\tlastResultId: string | null,\n\t\ttoken: CancellationToken,\n\t): Promise<\n\t\tlanguages.SemanticTokens | languages.SemanticTokensEdits | null\n\t> {\n\t\tconst nLastResultId = lastResultId\n\t\t\t? Number.parseInt(lastResultId, 10)\n\t\t\t: 0;\n\t\tconst encodedDto = await this._proxy.$provideDocumentSemanticTokens(\n\t\t\tthis._handle,\n\t\t\tmodel.uri,\n\t\t\tnLastResultId,\n\t\t\ttoken,\n\t\t);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === \"full\") {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data,\n\t\t\t};\n\t\t}\n\t\treturn {\n\t\t\tresultId: String(dto.id),\n\t\t\tedits: dto.deltas,\n\t\t};\n\t}\n}\n\nexport class MainThreadDocumentRangeSemanticTokensProvider\n\timplements languages.DocumentRangeSemanticTokensProvider\n{\n\tconstructor(\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _legend: languages.SemanticTokensLegend,\n\t) {}\n\n\tpublic getLegend(): languages.SemanticTokensLegend {\n\t\treturn this._legend;\n\t}\n\n\tasync provideDocumentRangeSemanticTokens(\n\t\tmodel: ITextModel,\n\t\trange: EditorRange,\n\t\ttoken: CancellationToken,\n\t): Promise<languages.SemanticTokens | null> {\n\t\tconst encodedDto =\n\t\t\tawait this._proxy.$provideDocumentRangeSemanticTokens(\n\t\t\t\tthis._handle,\n\t\t\t\tmodel.uri,\n\t\t\t\trange,\n\t\t\t\ttoken,\n\t\t\t);\n\t\tif (!encodedDto) {\n\t\t\treturn null;\n\t\t}\n\t\tif (token.isCancellationRequested) {\n\t\t\treturn null;\n\t\t}\n\t\tconst dto = decodeSemanticTokensDto(encodedDto);\n\t\tif (dto.type === \"full\") {\n\t\t\treturn {\n\t\t\t\tresultId: String(dto.id),\n\t\t\t\tdata: dto.data,\n\t\t\t};\n\t\t}\n\t\tthrow new Error(`Unexpected`);\n\t}\n}\n\nexport class MainThreadMappedEditsProvider\n\timplements languages.MappedEditsProvider\n{\n\tconstructor(\n\t\tpublic readonly displayName: string,\n\t\tprivate readonly _handle: number,\n\t\tprivate readonly _proxy: ExtHostLanguageFeaturesShape,\n\t\tprivate readonly _uriService: IUriIdentityService,\n\t) {}\n\n\tasync provideMappedEdits(\n\t\tdocument: ITextModel,\n\t\tcodeBlocks: string[],\n\t\tcontext: languages.MappedEditsContext,\n\t\ttoken: CancellationToken,\n\t): Promise<languages.WorkspaceEdit | null> {\n\t\tconst res = await this._proxy.$provideMappedEdits(\n\t\t\tthis._handle,\n\t\t\tdocument.uri,\n\t\t\tcodeBlocks,\n\t\t\tcontext,\n\t\t\ttoken,\n\t\t);\n\t\treturn res ? reviveWorkspaceEditDto(res, this._uriService) : null;\n\t}\n}\n"],
  "mappings": "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",
  "names": ["model", "search"]
}
