var F=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var S=(y,c,e,t)=>{for(var i=t>1?void 0:t?w(c,e):c,r=y.length-1,o;r>=0;r--)(o=y[r])&&(i=(t?o(c,e,i):o(i))||i);return t&&i&&F(c,e,i),i},f=(y,c)=>(e,t)=>c(e,t,y);import{VSDataTransfer as H,createStringDataTransferItem as W}from"../../../base/common/dataTransfer.js";import{CancellationError as O}from"../../../base/common/errors.js";import{Emitter as v}from"../../../base/common/event.js";import{HierarchicalKind as D}from"../../../base/common/hierarchicalKind.js";import{Disposable as A,DisposableMap as M,combinedDisposable as k,toDisposable as T}from"../../../base/common/lifecycle.js";import{ResourceMap as N}from"../../../base/common/map.js";import{revive as $}from"../../../base/common/marshalling.js";import{mixin as V}from"../../../base/common/objects.js";import{URI as h}from"../../../base/common/uri.js";import*as j from"../../../editor/common/languages.js";import{ILanguageService as K}from"../../../editor/common/languages/language.js";import{ILanguageConfigurationService as q}from"../../../editor/common/languages/languageConfigurationRegistry.js";import{ILanguageFeaturesService as U}from"../../../editor/common/services/languageFeatures.js";import{decodeSemanticTokensDto as L}from"../../../editor/common/services/semanticTokensDto.js";import{IUriIdentityService as C}from"../../../platform/uriIdentity/common/uriIdentity.js";import*as B from"../../contrib/callHierarchy/common/callHierarchy.js";import*as z from"../../contrib/search/common/search.js";import*as G from"../../contrib/typeHierarchy/common/typeHierarchy.js";import{extHostNamedCustomer as J}from"../../services/extensions/common/extHostCustomers.js";import{ExtHostContext as Q,ISuggestDataDtoField as m,ISuggestResultDtoField as x,MainContext as X}from"../common/extHost.protocol.js";import*as b from"../common/extHostTypeConverters.js";import{DataTransferFileCache as R}from"../common/shared/dataTransferCache.js";import{reviveWorkspaceEditDto as I}from"./mainThreadBulkEdits.js";let l=class extends A{constructor(e,t,i,r,o){super();this._languageService=t;this._languageConfigurationService=i;this._languageFeaturesService=r;this._uriIdentService=o;if(this._proxy=e.getProxy(Q.ExtHostLanguageFeatures),this._languageService){const s=()=>{const n=[];for(const a of t.getRegisteredLanguageIds()){const d=this._languageConfigurationService.getLanguageConfiguration(a).getWordDefinition();n.push({languageId:a,regexSource:d.source,regexFlags:d.flags})}this._proxy.$setWordDefinitions(n)};this._register(this._languageConfigurationService.onDidChange(n=>{if(n.languageId){const a=this._languageConfigurationService.getLanguageConfiguration(n.languageId).getWordDefinition();this._proxy.$setWordDefinitions([{languageId:n.languageId,regexSource:a.source,regexFlags:a.flags}])}else s()})),s()}}_proxy;_registrations=this._register(new M);$unregister(e){this._registrations.deleteAndDispose(e)}static _reviveLocationDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>l._reviveLocationDto(t)),e):(e.uri=h.revive(e.uri),e))}static _reviveLocationLinkDto(e){return e&&(Array.isArray(e)?(e.forEach(t=>l._reviveLocationLinkDto(t)),e):(e.uri=h.revive(e.uri),e))}static _reviveWorkspaceSymbolDto(e){return e&&(Array.isArray(e)?(e.forEach(l._reviveWorkspaceSymbolDto),e):(e.location=l._reviveLocationDto(e.location),e))}static _reviveCodeActionDto(e,t){return e?.forEach(i=>I(i.edit,t)),e}static _reviveLinkDTO(e){return e.url&&typeof e.url!="string"&&(e.url=h.revive(e.url)),e}static _reviveCallHierarchyItemDto(e){return e&&(e.uri=h.revive(e.uri)),e}static _reviveTypeHierarchyItemDto(e){return e&&(e.uri=h.revive(e.uri)),e}$registerDocumentSymbolProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentSymbolProvider.register(t,{displayName:i,provideDocumentSymbols:(r,o)=>this._proxy.$provideDocumentSymbols(e,r.uri,o)}))}$registerCodeLensSupport(e,t,i){const r={provideCodeLenses:async(o,s)=>{const n=await this._proxy.$provideCodeLenses(e,o.uri,s);if(n)return{lenses:n.lenses,dispose:()=>n.cacheId&&this._proxy.$releaseCodeLenses(e,n.cacheId)}},resolveCodeLens:async(o,s,n)=>{const a=await this._proxy.$resolveCodeLens(e,s,n);if(a)return{...a,range:o.validateRange(a.range)}}};if(typeof i=="number"){const o=new v;this._registrations.set(i,o),r.onDidChange=o.event}this._registrations.set(e,this._languageFeaturesService.codeLensProvider.register(t,r))}$emitCodeLensEvent(e,t){const i=this._registrations.get(e);i instanceof v&&i.fire(t)}$registerDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.definitionProvider.register(t,{provideDefinition:(i,r,o)=>this._proxy.$provideDefinition(e,i.uri,r,o).then(l._reviveLocationLinkDto)}))}$registerDeclarationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.declarationProvider.register(t,{provideDeclaration:(i,r,o)=>this._proxy.$provideDeclaration(e,i.uri,r,o).then(l._reviveLocationLinkDto)}))}$registerImplementationSupport(e,t){this._registrations.set(e,this._languageFeaturesService.implementationProvider.register(t,{provideImplementation:(i,r,o)=>this._proxy.$provideImplementation(e,i.uri,r,o).then(l._reviveLocationLinkDto)}))}$registerTypeDefinitionSupport(e,t){this._registrations.set(e,this._languageFeaturesService.typeDefinitionProvider.register(t,{provideTypeDefinition:(i,r,o)=>this._proxy.$provideTypeDefinition(e,i.uri,r,o).then(l._reviveLocationLinkDto)}))}$registerHoverProvider(e,t){this._registrations.set(e,this._languageFeaturesService.hoverProvider.register(t,{provideHover:async(i,r,o,s)=>{const n={verbosityRequest:s?.verbosityRequest?{verbosityDelta:s.verbosityRequest.verbosityDelta,previousHover:{id:s.verbosityRequest.previousHover.id}}:void 0};return await this._proxy.$provideHover(e,i.uri,r,n,o)}}))}$registerEvaluatableExpressionProvider(e,t){this._registrations.set(e,this._languageFeaturesService.evaluatableExpressionProvider.register(t,{provideEvaluatableExpression:(i,r,o)=>this._proxy.$provideEvaluatableExpression(e,i.uri,r,o)}))}$registerInlineValuesProvider(e,t,i){const r={provideInlineValues:(o,s,n,a)=>this._proxy.$provideInlineValues(e,o.uri,s,n,a)};if(typeof i=="number"){const o=new v;this._registrations.set(i,o),r.onDidChangeInlineValues=o.event}this._registrations.set(e,this._languageFeaturesService.inlineValuesProvider.register(t,r))}$emitInlineValuesEvent(e,t){const i=this._registrations.get(e);i instanceof v&&i.fire(t)}$registerDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.documentHighlightProvider.register(t,{provideDocumentHighlights:(i,r,o)=>this._proxy.$provideDocumentHighlights(e,i.uri,r,o)}))}$registerMultiDocumentHighlightProvider(e,t){this._registrations.set(e,this._languageFeaturesService.multiDocumentHighlightProvider.register(t,{selector:t,provideMultiDocumentHighlights:(i,r,o,s)=>this._proxy.$provideMultiDocumentHighlights(e,i.uri,r,o.map(n=>n.uri),s).then(n=>{if(n==null)return;const a=new N;return n?.forEach(d=>{const u=h.revive(d.uri);a.has(u)?a.get(u).push(...d.highlights):a.set(u,d.highlights)}),a})}))}$registerLinkedEditingRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.linkedEditingRangeProvider.register(t,{provideLinkedEditingRanges:async(i,r,o)=>{const s=await this._proxy.$provideLinkedEditingRanges(e,i.uri,r,o);if(s)return{ranges:s.ranges,wordPattern:s.wordPattern?l._reviveRegExp(s.wordPattern):void 0}}}))}$registerReferenceSupport(e,t){this._registrations.set(e,this._languageFeaturesService.referenceProvider.register(t,{provideReferences:(i,r,o,s)=>this._proxy.$provideReferences(e,i.uri,r,o,s).then(l._reviveLocationDto)}))}$registerCodeActionSupport(e,t,i,r,o,s){const n={provideCodeActions:async(a,d,u,p)=>{const g=await this._proxy.$provideCodeActions(e,a.uri,d,u,p);if(g)return{actions:l._reviveCodeActionDto(g.actions,this._uriIdentService),dispose:()=>{typeof g.cacheId=="number"&&this._proxy.$releaseCodeActions(e,g.cacheId)}}},providedCodeActionKinds:i.providedKinds,documentation:i.documentation,displayName:r,extensionId:o};s&&(n.resolveCodeAction=async(a,d)=>{const u=await this._proxy.$resolveCodeAction(e,a.cacheId,d);return u.edit&&(a.edit=I(u.edit,this._uriIdentService)),u.command&&(a.command=u.command),a}),this._registrations.set(e,this._languageFeaturesService.codeActionProvider.register(t,n))}_pasteEditProviders=new Map;$registerPasteEditProvider(e,t,i){const r=new _(e,this._proxy,i,this._uriIdentService);this._pasteEditProviders.set(e,r),this._registrations.set(e,k(this._languageFeaturesService.documentPasteEditProvider.register(t,r),T(()=>this._pasteEditProviders.delete(e))))}$resolvePasteFileData(e,t,i){const r=this._pasteEditProviders.get(e);if(!r)throw new Error("Could not find provider");return r.resolveFileData(t,i)}$registerDocumentFormattingSupport(e,t,i,r){this._registrations.set(e,this._languageFeaturesService.documentFormattingEditProvider.register(t,{extensionId:i,displayName:r,provideDocumentFormattingEdits:(o,s,n)=>this._proxy.$provideDocumentFormattingEdits(e,o.uri,s,n)}))}$registerRangeFormattingSupport(e,t,i,r,o){this._registrations.set(e,this._languageFeaturesService.documentRangeFormattingEditProvider.register(t,{extensionId:i,displayName:r,provideDocumentRangeFormattingEdits:(s,n,a,d)=>this._proxy.$provideDocumentRangeFormattingEdits(e,s.uri,n,a,d),provideDocumentRangesFormattingEdits:o?(s,n,a,d)=>this._proxy.$provideDocumentRangesFormattingEdits(e,s.uri,n,a,d):void 0}))}$registerOnTypeFormattingSupport(e,t,i,r){this._registrations.set(e,this._languageFeaturesService.onTypeFormattingEditProvider.register(t,{extensionId:r,autoFormatTriggerCharacters:i,provideOnTypeFormattingEdits:(o,s,n,a,d)=>this._proxy.$provideOnTypeFormattingEdits(e,o.uri,s,n,a,d)}))}$registerNavigateTypeSupport(e,t){let i;const r={provideWorkspaceSymbols:async(o,s)=>{const n=await this._proxy.$provideWorkspaceSymbols(e,o,s);return i!==void 0&&this._proxy.$releaseWorkspaceSymbols(e,i),i=n.cacheId,l._reviveWorkspaceSymbolDto(n.symbols)}};t&&(r.resolveWorkspaceSymbol=async(o,s)=>{const n=await this._proxy.$resolveWorkspaceSymbol(e,o,s);return n&&l._reviveWorkspaceSymbolDto(n)}),this._registrations.set(e,z.WorkspaceSymbolProviderRegistry.register(r))}$registerRenameSupport(e,t,i){this._registrations.set(e,this._languageFeaturesService.renameProvider.register(t,{provideRenameEdits:(r,o,s,n)=>this._proxy.$provideRenameEdits(e,r.uri,o,s,n).then(a=>I(a,this._uriIdentService)),resolveRenameLocation:i?(r,o,s)=>this._proxy.$resolveRenameLocation(e,r.uri,o,s):void 0}))}$registerNewSymbolNamesProvider(e,t){this._registrations.set(e,this._languageFeaturesService.newSymbolNamesProvider.register(t,{supportsAutomaticNewSymbolNamesTriggerKind:this._proxy.$supportsAutomaticNewSymbolNamesTriggerKind(e),provideNewSymbolNames:(i,r,o,s)=>this._proxy.$provideNewSymbolNames(e,i.uri,r,o,s)}))}$registerDocumentSemanticTokensProvider(e,t,i,r){let o;if(typeof r=="number"){const s=new v;this._registrations.set(r,s),o=s.event}this._registrations.set(e,this._languageFeaturesService.documentSemanticTokensProvider.register(t,new Y(this._proxy,e,i,o)))}$emitDocumentSemanticTokensEvent(e){const t=this._registrations.get(e);t instanceof v&&t.fire(void 0)}$registerDocumentRangeSemanticTokensProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.documentRangeSemanticTokensProvider.register(t,new Z(this._proxy,e,i)))}static _inflateSuggestDto(e,t,i){const r=t[m.label],o=t[m.commandId],s=t[m.commandIdent],n=t[m.commitCharacters];return{label:r,extensionId:i,kind:t[m.kind]??j.CompletionItemKind.Property,tags:t[m.kindModifier],detail:t[m.detail],documentation:t[m.documentation],sortText:t[m.sortText],filterText:t[m.filterText],preselect:t[m.preselect],insertText:t[m.insertText]??(typeof r=="string"?r:r.label),range:t[m.range]??e,insertTextRules:t[m.insertTextRules],commitCharacters:n?Array.from(n):void 0,additionalTextEdits:t[m.additionalTextEdits],command:o?{$ident:s,id:o,title:"",arguments:s?[s]:t[m.commandArguments]}:void 0,_id:t.x}}$registerCompletionsProvider(e,t,i,r,o){const s={triggerCharacters:i,_debugDisplayName:`${o.value}(${i.join("")})`,provideCompletionItems:async(n,a,d,u)=>{const p=await this._proxy.$provideCompletionItems(e,n.uri,a,d,u);return p&&{suggestions:p[x.completions].map(g=>l._inflateSuggestDto(p[x.defaultRanges],g,o)),incomplete:p[x.isIncomplete]||!1,duration:p[x.duration],dispose:()=>{typeof p.x=="number"&&this._proxy.$releaseCompletionItems(e,p.x)}}}};r&&(s.resolveCompletionItem=(n,a)=>this._proxy.$resolveCompletionItem(e,n._id,a).then(d=>{if(!d)return n;const u=l._inflateSuggestDto(n.range,d,o);return V(n,u,!0)})),this._registrations.set(e,this._languageFeaturesService.completionProvider.register(t,s))}$registerInlineCompletionsSupport(e,t,i,r,o){const s={provideInlineCompletions:async(n,a,d,u)=>this._proxy.$provideInlineCompletions(e,n.uri,a,d,u),provideInlineEdits:async(n,a,d,u)=>this._proxy.$provideInlineEdits(e,n.uri,a,d,u),handleItemDidShow:async(n,a,d)=>{i&&await this._proxy.$handleInlineCompletionDidShow(e,n.pid,a.idx,d)},handlePartialAccept:async(n,a,d,u)=>{i&&await this._proxy.$handleInlineCompletionPartialAccept(e,n.pid,a.idx,d,u)},freeInlineCompletions:n=>{this._proxy.$freeInlineCompletionsList(e,n.pid)},groupId:r,yieldsToGroupIds:o,toString(){return`InlineCompletionsProvider(${r})`}};this._registrations.set(e,this._languageFeaturesService.inlineCompletionsProvider.register(t,s))}$registerInlineEditProvider(e,t,i){const r={provideInlineEdit:async(o,s,n)=>this._proxy.$provideInlineEdit(e,o.uri,s,n),freeInlineEdit:o=>{this._proxy.$freeInlineEdit(e,o.pid)}};this._registrations.set(e,this._languageFeaturesService.inlineEditProvider.register(t,r))}$registerSignatureHelpProvider(e,t,i){this._registrations.set(e,this._languageFeaturesService.signatureHelpProvider.register(t,{signatureHelpTriggerCharacters:i.triggerCharacters,signatureHelpRetriggerCharacters:i.retriggerCharacters,provideSignatureHelp:async(r,o,s,n)=>{const a=await this._proxy.$provideSignatureHelp(e,r.uri,o,n,s);if(a)return{value:a,dispose:()=>{this._proxy.$releaseSignatureHelp(e,a.id)}}}}))}$registerInlayHintsProvider(e,t,i,r,o){const s={displayName:o,provideInlayHints:async(n,a,d)=>{const u=await this._proxy.$provideInlayHints(e,n.uri,a,d);if(u)return{hints:$(u.hints),dispose:()=>{u.cacheId&&this._proxy.$releaseInlayHints(e,u.cacheId)}}}};if(i&&(s.resolveInlayHint=async(n,a)=>{const d=n;if(!d.cacheId)return n;const u=await this._proxy.$resolveInlayHint(e,d.cacheId,a);if(a.isCancellationRequested)throw new O;return u?{...n,tooltip:u.tooltip,label:$(u.label),textEdits:u.textEdits}:n}),typeof r=="number"){const n=new v;this._registrations.set(r,n),s.onDidChangeInlayHints=n.event}this._registrations.set(e,this._languageFeaturesService.inlayHintsProvider.register(t,s))}$emitInlayHintsEvent(e){const t=this._registrations.get(e);t instanceof v&&t.fire(void 0)}$registerDocumentLinkProvider(e,t,i){const r={provideLinks:(o,s)=>this._proxy.$provideDocumentLinks(e,o.uri,s).then(n=>{if(n)return{links:n.links.map(l._reviveLinkDTO),dispose:()=>{typeof n.cacheId=="number"&&this._proxy.$releaseDocumentLinks(e,n.cacheId)}}})};i&&(r.resolveLink=(o,s)=>{const n=o;return n.cacheId?this._proxy.$resolveDocumentLink(e,n.cacheId,s).then(a=>a&&l._reviveLinkDTO(a)):o}),this._registrations.set(e,this._languageFeaturesService.linkProvider.register(t,r))}$registerDocumentColorProvider(e,t){const i=this._proxy;this._registrations.set(e,this._languageFeaturesService.colorProvider.register(t,{provideDocumentColors:(r,o)=>i.$provideDocumentColors(e,r.uri,o).then(s=>s.map(n=>{const[a,d,u,p]=n.color;return{color:{red:a,green:d,blue:u,alpha:p},range:n.range}})),provideColorPresentations:(r,o,s)=>i.$provideColorPresentations(e,r.uri,{color:[o.color.red,o.color.green,o.color.blue,o.color.alpha],range:o.range},s)}))}$registerFoldingRangeProvider(e,t,i,r){const o={id:i.value,provideFoldingRanges:(s,n,a)=>this._proxy.$provideFoldingRanges(e,s.uri,n,a)};if(typeof r=="number"){const s=new v;this._registrations.set(r,s),o.onDidChange=s.event}this._registrations.set(e,this._languageFeaturesService.foldingRangeProvider.register(t,o))}$emitFoldingRangeEvent(e,t){const i=this._registrations.get(e);i instanceof v&&i.fire(t)}$registerSelectionRangeProvider(e,t){this._registrations.set(e,this._languageFeaturesService.selectionRangeProvider.register(t,{provideSelectionRanges:(i,r,o)=>this._proxy.$provideSelectionRanges(e,i.uri,r,o)}))}$registerCallHierarchyProvider(e,t){this._registrations.set(e,B.CallHierarchyProviderRegistry.register(t,{prepareCallHierarchy:async(i,r,o)=>{const s=await this._proxy.$prepareCallHierarchy(e,i.uri,r,o);if(!(!s||s.length===0))return{dispose:()=>{for(const n of s)this._proxy.$releaseCallHierarchy(e,n._sessionId)},roots:s.map(l._reviveCallHierarchyItemDto)}},provideOutgoingCalls:async(i,r)=>{const o=await this._proxy.$provideCallHierarchyOutgoingCalls(e,i._sessionId,i._itemId,r);return o&&(o.forEach(s=>{s.to=l._reviveCallHierarchyItemDto(s.to)}),o)},provideIncomingCalls:async(i,r)=>{const o=await this._proxy.$provideCallHierarchyIncomingCalls(e,i._sessionId,i._itemId,r);return o&&(o.forEach(s=>{s.from=l._reviveCallHierarchyItemDto(s.from)}),o)}}))}static _reviveRegExp(e){return new RegExp(e.pattern,e.flags)}static _reviveIndentationRule(e){return{decreaseIndentPattern:l._reviveRegExp(e.decreaseIndentPattern),increaseIndentPattern:l._reviveRegExp(e.increaseIndentPattern),indentNextLinePattern:e.indentNextLinePattern?l._reviveRegExp(e.indentNextLinePattern):void 0,unIndentedLinePattern:e.unIndentedLinePattern?l._reviveRegExp(e.unIndentedLinePattern):void 0}}static _reviveOnEnterRule(e){return{beforeText:l._reviveRegExp(e.beforeText),afterText:e.afterText?l._reviveRegExp(e.afterText):void 0,previousLineText:e.previousLineText?l._reviveRegExp(e.previousLineText):void 0,action:e.action}}static _reviveOnEnterRules(e){return e.map(l._reviveOnEnterRule)}$setLanguageConfiguration(e,t,i){const r={comments:i.comments,brackets:i.brackets,wordPattern:i.wordPattern?l._reviveRegExp(i.wordPattern):void 0,indentationRules:i.indentationRules?l._reviveIndentationRule(i.indentationRules):void 0,onEnterRules:i.onEnterRules?l._reviveOnEnterRules(i.onEnterRules):void 0,autoClosingPairs:void 0,surroundingPairs:void 0,__electricCharacterSupport:void 0};i.autoClosingPairs?r.autoClosingPairs=i.autoClosingPairs:i.__characterPairSupport&&(r.autoClosingPairs=i.__characterPairSupport.autoClosingPairs),i.__electricCharacterSupport&&i.__electricCharacterSupport.docComment&&(r.__electricCharacterSupport={docComment:{open:i.__electricCharacterSupport.docComment.open,close:i.__electricCharacterSupport.docComment.close}}),this._languageService.isRegisteredLanguageId(t)&&this._registrations.set(e,this._languageConfigurationService.register(t,r,100))}$registerTypeHierarchyProvider(e,t){this._registrations.set(e,G.TypeHierarchyProviderRegistry.register(t,{prepareTypeHierarchy:async(i,r,o)=>{const s=await this._proxy.$prepareTypeHierarchy(e,i.uri,r,o);if(s)return{dispose:()=>{for(const n of s)this._proxy.$releaseTypeHierarchy(e,n._sessionId)},roots:s.map(l._reviveTypeHierarchyItemDto)}},provideSupertypes:async(i,r)=>{const o=await this._proxy.$provideTypeHierarchySupertypes(e,i._sessionId,i._itemId,r);return o&&o.map(l._reviveTypeHierarchyItemDto)},provideSubtypes:async(i,r)=>{const o=await this._proxy.$provideTypeHierarchySubtypes(e,i._sessionId,i._itemId,r);return o&&o.map(l._reviveTypeHierarchyItemDto)}}))}_documentOnDropEditProviders=new Map;$registerDocumentOnDropEditProvider(e,t,i){const r=new P(e,this._proxy,i,this._uriIdentService);this._documentOnDropEditProviders.set(e,r),this._registrations.set(e,k(this._languageFeaturesService.documentDropEditProvider.register(t,r),T(()=>this._documentOnDropEditProviders.delete(e))))}async $resolveDocumentOnDropFileData(e,t,i){const r=this._documentOnDropEditProviders.get(e);if(!r)throw new Error("Could not find provider");return r.resolveDocumentOnDropFileData(t,i)}$registerMappedEditsProvider(e,t,i){const r=new ee(i,e,this._proxy,this._uriIdentService);this._registrations.set(e,this._languageFeaturesService.mappedEditsProvider.register(t,r))}};l=S([J(X.MainThreadLanguageFeatures),f(1,K),f(2,q),f(3,U),f(4,C)],l);let _=class{constructor(c,e,t,i){this._handle=c;this._proxy=e;this._uriIdentService=i;this.copyMimeTypes=t.copyMimeTypes,this.pasteMimeTypes=t.pasteMimeTypes,this.providedPasteEditKinds=t.providedPasteEditKinds?.map(r=>new D(r)),t.supportsCopy&&(this.prepareDocumentPaste=async(r,o,s,n)=>{const a=await b.DataTransfer.from(s);if(n.isCancellationRequested)return;const d=await this._proxy.$prepareDocumentPaste(c,r.uri,o,a,n);if(!d)return;const u=new H;for(const[p,g]of d.items)u.replace(p,W(g.asString));return u}),t.supportsPaste&&(this.provideDocumentPasteEdits=async(r,o,s,n,a)=>{const d=this.dataTransfers.add(s);try{const u=await b.DataTransfer.from(s);if(a.isCancellationRequested)return;const p=await this._proxy.$providePasteEdits(this._handle,d.id,r.uri,o,u,{only:n.only?.value,triggerKind:n.triggerKind},a);return p?{edits:p.map(g=>({...g,kind:g.kind?new D(g.kind.value):new D(""),yieldTo:g.yieldTo?.map(E=>({kind:new D(E)})),additionalEdit:g.additionalEdit?I(g.additionalEdit,this._uriIdentService,E=>this.resolveFileData(d.id,E)):void 0})),dispose:()=>{this._proxy.$releasePasteEdits(this._handle,d.id)}}:void 0}finally{d.dispose()}}),t.supportsResolve&&(this.resolveDocumentPasteEdit=async(r,o)=>{const s=await this._proxy.$resolvePasteEdit(this._handle,r._cacheId,o);return s.additionalEdit&&(r.additionalEdit=I(s.additionalEdit,this._uriIdentService)),r})}dataTransfers=new R;copyMimeTypes;pasteMimeTypes;providedPasteEditKinds;prepareDocumentPaste;provideDocumentPasteEdits;resolveDocumentPasteEdit;resolveFileData(c,e){return this.dataTransfers.resolveFileData(c,e)}};_=S([f(3,C)],_);let P=class{constructor(c,e,t,i){this._handle=c;this._proxy=e;this._uriIdentService=i;this.dropMimeTypes=t?.dropMimeTypes??["*/*"],t?.supportsResolve&&(this.resolveDocumentDropEdit=async(r,o)=>{const s=await this._proxy.$resolvePasteEdit(this._handle,r._cacheId,o);return s.additionalEdit&&(r.additionalEdit=I(s.additionalEdit,this._uriIdentService)),r})}dataTransfers=new R;dropMimeTypes;resolveDocumentDropEdit;async provideDocumentDropEdits(c,e,t,i){const r=this.dataTransfers.add(t);try{const o=await b.DataTransfer.from(t);if(i.isCancellationRequested)return;const s=await this._proxy.$provideDocumentOnDropEdits(this._handle,r.id,c.uri,e,o,i);return s?{edits:s.map(n=>({...n,yieldTo:n.yieldTo?.map(a=>({kind:new D(a)})),kind:n.kind?new D(n.kind):void 0,additionalEdit:I(n.additionalEdit,this._uriIdentService,a=>this.resolveDocumentOnDropFileData(r.id,a))})),dispose:()=>{this._proxy.$releaseDocumentOnDropEdits(this._handle,r.id)}}:void 0}finally{r.dispose()}}resolveDocumentOnDropFileData(c,e){return this.dataTransfers.resolveFileData(c,e)}};P=S([f(3,C)],P);class Y{constructor(c,e,t,i){this._proxy=c;this._handle=e;this._legend=t;this.onDidChange=i}releaseDocumentSemanticTokens(c){c&&this._proxy.$releaseDocumentSemanticTokens(this._handle,Number.parseInt(c,10))}getLegend(){return this._legend}async provideDocumentSemanticTokens(c,e,t){const i=e?Number.parseInt(e,10):0,r=await this._proxy.$provideDocumentSemanticTokens(this._handle,c.uri,i,t);if(!r||t.isCancellationRequested)return null;const o=L(r);return o.type==="full"?{resultId:String(o.id),data:o.data}:{resultId:String(o.id),edits:o.deltas}}}class Z{constructor(c,e,t){this._proxy=c;this._handle=e;this._legend=t}getLegend(){return this._legend}async provideDocumentRangeSemanticTokens(c,e,t){const i=await this._proxy.$provideDocumentRangeSemanticTokens(this._handle,c.uri,e,t);if(!i||t.isCancellationRequested)return null;const r=L(i);if(r.type==="full")return{resultId:String(r.id),data:r.data};throw new Error("Unexpected")}}class ee{constructor(c,e,t,i){this.displayName=c;this._handle=e;this._proxy=t;this._uriService=i}async provideMappedEdits(c,e,t,i){const r=await this._proxy.$provideMappedEdits(this._handle,c.uri,e,t,i);return r?I(r,this._uriService):null}}export{Z as MainThreadDocumentRangeSemanticTokensProvider,Y as MainThreadDocumentSemanticTokensProvider,l as MainThreadLanguageFeatures,ee as MainThreadMappedEditsProvider};
