var M=Object.defineProperty;var O=Object.getOwnPropertyDescriptor;var S=(o,e,n,s)=>{for(var t=s>1?void 0:s?O(e,n):e,d=o.length-1,a;d>=0;d--)(a=o[d])&&(t=(s?a(e,n,t):a(t))||t);return s&&t&&M(e,n,t),t},E=(o,e)=>(n,s)=>e(n,s,o);import{Emitter as R}from"../../../base/common/event.js";import{hash as k}from"../../../base/common/hash.js";import"../../../base/common/htmlContent.js";import{getCodiconAriaLabel as N}from"../../../base/common/iconLabels.js";import{Iterable as F}from"../../../base/common/iterator.js";import"../../../base/common/jsonSchema.js";import{DisposableStore as P,toDisposable as _}from"../../../base/common/lifecycle.js";import"../../../base/common/themables.js";import"../../../editor/common/languages.js";import{localize as r}from"../../../nls.js";import{isAccessibilityInformation as K}from"../../../platform/accessibility/common/accessibility.js";import{ExtensionIdentifier as G}from"../../../platform/extensions/common/extensions.js";import{InstantiationType as L,registerSingleton as j}from"../../../platform/instantiation/common/extensions.js";import{createDecorator as H}from"../../../platform/instantiation/common/instantiation.js";import{STATUS_BAR_ERROR_ITEM_BACKGROUND as D,STATUS_BAR_WARNING_ITEM_BACKGROUND as $}from"../../common/theme.js";import{isProposedApiEnabled as J}from"../../services/extensions/common/extensions.js";import{ExtensionsRegistry as q}from"../../services/extensions/common/extensionsRegistry.js";import{IStatusbarService as z,StatusbarAlignment as B}from"../../services/statusbar/browser/statusbar.js";import{asStatusBarItemIdentifier as W}from"../common/extHostTypes.js";const w=H("IExtensionStatusBarItemService");var Y=(n=>(n[n.DidDefine=0]="DidDefine",n[n.DidUpdate=1]="DidUpdate",n))(Y||{});let y=class{constructor(e){this._statusbarService=e}_entries=new Map;_onDidChange=new R;onDidChange=this._onDidChange.event;dispose(){this._entries.forEach(e=>e.accessor.dispose()),this._entries.clear(),this._onDidChange.dispose()}setOrUpdateEntry(e,n,s,t,d,a,i,c,u,U,m,I){let g,v;if(I)g=I.label,v=I.role;else if(g=N(d),a){const p=typeof a=="string"?a:a.value;g+=`, ${p}`}let x;switch(u?.id){case D:case $:x=u.id===D?"error":"warning",c=void 0,u=void 0}const f={name:t,text:d,tooltip:a,command:i,color:c,backgroundColor:u,ariaLabel:g,role:v,kind:x};typeof m>"u"&&(m=0);let h=U?B.LEFT:B.RIGHT;const l=this._entries.get(e);if(l&&(h=l.alignment,m=l.priority),l)return l.accessor.update(f),l.entry=f,1;{let p;typeof s=="string"?p={primary:m,secondary:k(s)}:p=m;const T=this._statusbarService.addEntry(f,n,h,p);return this._entries.set(e,{accessor:T,entry:f,alignment:h,priority:m,disposable:_(()=>{T.dispose(),this._entries.delete(e),this._onDidChange.fire({removed:e})})}),this._onDidChange.fire({added:[e,{entry:f,alignment:h,priority:m}]}),0}}unsetEntry(e){this._entries.get(e)?.disposable.dispose(),this._entries.delete(e)}getEntries(){return this._entries.entries()}};y=S([E(0,z)],y),j(w,y,L.Delayed);function Q(o){const e=o;return typeof e.id=="string"&&e.id.length>0&&typeof e.name=="string"&&typeof e.text=="string"&&(e.alignment==="left"||e.alignment==="right")&&(e.command===void 0||typeof e.command=="string")&&(e.tooltip===void 0||typeof e.tooltip=="string")&&(e.priority===void 0||typeof e.priority=="number")&&(e.accessibilityInformation===void 0||K(e.accessibilityInformation))}const A={type:"object",required:["id","text","alignment","name"],properties:{id:{type:"string",markdownDescription:r("id","The identifier of the status bar entry. Must be unique within the extension. The same value must be used when calling the `vscode.window.createStatusBarItem(id, ...)`-API")},name:{type:"string",description:r("name","The name of the entry, like 'Python Language Indicator', 'Git Status' etc. Try to keep the length of the name short, yet descriptive enough that users can understand what the status bar item is about.")},text:{type:"string",description:r("text","The text to show for the entry. You can embed icons in the text by leveraging the `$(<name>)`-syntax, like 'Hello $(globe)!'")},tooltip:{type:"string",description:r("tooltip","The tooltip text for the entry.")},command:{type:"string",description:r("command","The command to execute when the status bar entry is clicked.")},alignment:{type:"string",enum:["left","right"],description:r("alignment","The alignment of the status bar entry.")},priority:{type:"number",description:r("priority","The priority of the status bar entry. Higher value means the item should be shown more to the left.")},accessibilityInformation:{type:"object",description:r("accessibilityInformation","Defines the role and aria label to be used when the status bar entry is focused."),properties:{role:{type:"string",description:r("accessibilityInformation.role","The role of the status bar entry which defines how a screen reader interacts with it. More about aria roles can be found here https://w3c.github.io/aria/#widget_roles")},label:{type:"string",description:r("accessibilityInformation.label","The aria label of the status bar entry. Defaults to the entry's text.")}}}}},V={description:r("vscode.extension.contributes.statusBarItems","Contributes items to the status bar."),oneOf:[A,{type:"array",items:A}]},C=q.registerExtensionPoint({extensionPoint:"statusBarItems",jsonSchema:V});let b=class{constructor(e){const n=new P;C.setHandler(s=>{n.clear();for(const t of s){if(!J(t.description,"contribStatusBarItems")){t.collector.error(`The ${C.name} is proposed API`);continue}const{value:d,collector:a}=t;for(const i of F.wrap(d)){if(!Q(i)){a.error(r("invalid","Invalid status bar item contribution."));continue}const c=W(t.description.identifier,i.id);e.setOrUpdateEntry(c,c,G.toKey(t.description.identifier),i.name??t.description.displayName??t.description.name,i.text,i.tooltip,i.command?{id:i.command,title:i.name}:void 0,void 0,void 0,i.alignment==="left",i.priority,i.accessibilityInformation)===0&&n.add(_(()=>e.unsetEntry(c)))}}})}};b=S([E(0,w)],b);export{w as IExtensionStatusBarItemService,b as StatusBarItemsExtensionPoint,Y as StatusBarUpdateKind};
