{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadLanguages.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport {\n\tDisposableMap,\n\tDisposableStore,\n} from \"../../../base/common/lifecycle.js\";\nimport { URI, type UriComponents } from \"../../../base/common/uri.js\";\nimport type { IPosition } from \"../../../editor/common/core/position.js\";\nimport { type IRange, Range } from \"../../../editor/common/core/range.js\";\nimport type { StandardTokenType } from \"../../../editor/common/encodedTokenAttributes.js\";\nimport { ILanguageService } from \"../../../editor/common/languages/language.js\";\nimport { IModelService } from \"../../../editor/common/services/model.js\";\nimport { ITextModelService } from \"../../../editor/common/services/resolverService.js\";\nimport {\n\ttype IExtHostContext,\n\textHostNamedCustomer,\n} from \"../../services/extensions/common/extHostCustomers.js\";\nimport {\n\ttype ILanguageStatus,\n\tILanguageStatusService,\n} from \"../../services/languageStatus/common/languageStatusService.js\";\nimport {\n\tExtHostContext,\n\ttype ExtHostLanguagesShape,\n\tMainContext,\n\ttype MainThreadLanguagesShape,\n} from \"../common/extHost.protocol.js\";\n\n@extHostNamedCustomer(MainContext.MainThreadLanguages)\nexport class MainThreadLanguages implements MainThreadLanguagesShape {\n\tprivate readonly _disposables = new DisposableStore();\n\tprivate readonly _proxy: ExtHostLanguagesShape;\n\n\tprivate readonly _status = new DisposableMap<number>();\n\n\tconstructor(\n\t\t_extHostContext: IExtHostContext,\n\t\t@ILanguageService private readonly _languageService: ILanguageService,\n\t\t@IModelService private readonly _modelService: IModelService,\n\t\t@ITextModelService private _resolverService: ITextModelService,\n\t\t@ILanguageStatusService private readonly _languageStatusService: ILanguageStatusService,\n\t) {\n\t\tthis._proxy = _extHostContext.getProxy(ExtHostContext.ExtHostLanguages);\n\n\t\tthis._proxy.$acceptLanguageIds(_languageService.getRegisteredLanguageIds());\n\t\tthis._disposables.add(_languageService.onDidChange(_ => {\n\t\t\tthis._proxy.$acceptLanguageIds(_languageService.getRegisteredLanguageIds());\n\t\t}));\n\t}\n\n\tdispose(): void {\n\t\tthis._disposables.dispose();\n\t\tthis._status.dispose();\n\t}\n\n\tasync $changeLanguage(\n\t\tresource: UriComponents,\n\t\tlanguageId: string,\n\t): Promise<void> {\n\t\tif (!this._languageService.isRegisteredLanguageId(languageId)) {\n\t\t\treturn Promise.reject(\n\t\t\t\tnew Error(`Unknown language id: ${languageId}`),\n\t\t\t);\n\t\t}\n\n\t\tconst uri = URI.revive(resource);\n\t\tconst ref = await this._resolverService.createModelReference(uri);\n\t\ttry {\n\t\t\tref.object.textEditorModel.setLanguage(\n\t\t\t\tthis._languageService.createById(languageId),\n\t\t\t);\n\t\t} finally {\n\t\t\tref.dispose();\n\t\t}\n\t}\n\n\tasync $tokensAtPosition(\n\t\tresource: UriComponents,\n\t\tposition: IPosition,\n\t): Promise<undefined | { type: StandardTokenType; range: IRange }> {\n\t\tconst uri = URI.revive(resource);\n\t\tconst model = this._modelService.getModel(uri);\n\t\tif (!model) {\n\t\t\treturn undefined;\n\t\t}\n\t\tmodel.tokenization.tokenizeIfCheap(position.lineNumber);\n\t\tconst tokens = model.tokenization.getLineTokens(position.lineNumber);\n\t\tconst idx = tokens.findTokenIndexAtOffset(position.column - 1);\n\t\treturn {\n\t\t\ttype: tokens.getStandardTokenType(idx),\n\t\t\trange: new Range(\n\t\t\t\tposition.lineNumber,\n\t\t\t\t1 + tokens.getStartOffset(idx),\n\t\t\t\tposition.lineNumber,\n\t\t\t\t1 + tokens.getEndOffset(idx),\n\t\t\t),\n\t\t};\n\t}\n\n\t// --- language status\n\n\t$setLanguageStatus(handle: number, status: ILanguageStatus): void {\n\t\tthis._status.get(handle)?.dispose();\n\t\tthis._status.set(handle, this._languageStatusService.addStatus(status));\n\t}\n\n\t$removeLanguageStatus(handle: number): void {\n\t\tthis._status.get(handle)?.dispose();\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA;AAAA,EACC;AAAA,EACA;AAAA,OACM;AACP,SAAS,WAA+B;AAExC,SAAsB,aAAa;AAEnC,SAAS,wBAAwB;AACjC,SAAS,qBAAqB;AAC9B,SAAS,yBAAyB;AAClC;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EAEC;AAAA,OACM;AACP;AAAA,EACC;AAAA,EAEA;AAAA,OAEM;AAGA,IAAM,sBAAN,MAA8D;AAAA,EAMpE,YACC,iBACmC,kBACH,eACL,kBACc,wBACxC;AAJkC;AACH;AACL;AACc;AAEzC,SAAK,SAAS,gBAAgB,SAAS,eAAe,gBAAgB;AAEtE,SAAK,OAAO,mBAAmB,iBAAiB,yBAAyB,CAAC;AAC1E,SAAK,aAAa,IAAI,iBAAiB,YAAY,OAAK;AACvD,WAAK,OAAO,mBAAmB,iBAAiB,yBAAyB,CAAC;AAAA,IAC3E,CAAC,CAAC;AAAA,EACH;AAAA,EAlBiB,eAAe,IAAI,gBAAgB;AAAA,EACnC;AAAA,EAEA,UAAU,IAAI,cAAsB;AAAA,EAiBrD,UAAgB;AACf,SAAK,aAAa,QAAQ;AAC1B,SAAK,QAAQ,QAAQ;AAAA,EACtB;AAAA,EAEA,MAAM,gBACL,UACA,YACgB;AAChB,QAAI,CAAC,KAAK,iBAAiB,uBAAuB,UAAU,GAAG;AAC9D,aAAO,QAAQ;AAAA,QACd,IAAI,MAAM,wBAAwB,UAAU,EAAE;AAAA,MAC/C;AAAA,IACD;AAEA,UAAM,MAAM,IAAI,OAAO,QAAQ;AAC/B,UAAM,MAAM,MAAM,KAAK,iBAAiB,qBAAqB,GAAG;AAChE,QAAI;AACH,UAAI,OAAO,gBAAgB;AAAA,QAC1B,KAAK,iBAAiB,WAAW,UAAU;AAAA,MAC5C;AAAA,IACD,UAAE;AACD,UAAI,QAAQ;AAAA,IACb;AAAA,EACD;AAAA,EAEA,MAAM,kBACL,UACA,UACkE;AAClE,UAAM,MAAM,IAAI,OAAO,QAAQ;AAC/B,UAAM,QAAQ,KAAK,cAAc,SAAS,GAAG;AAC7C,QAAI,CAAC,OAAO;AACX,aAAO;AAAA,IACR;AACA,UAAM,aAAa,gBAAgB,SAAS,UAAU;AACtD,UAAM,SAAS,MAAM,aAAa,cAAc,SAAS,UAAU;AACnE,UAAM,MAAM,OAAO,uBAAuB,SAAS,SAAS,CAAC;AAC7D,WAAO;AAAA,MACN,MAAM,OAAO,qBAAqB,GAAG;AAAA,MACrC,OAAO,IAAI;AAAA,QACV,SAAS;AAAA,QACT,IAAI,OAAO,eAAe,GAAG;AAAA,QAC7B,SAAS;AAAA,QACT,IAAI,OAAO,aAAa,GAAG;AAAA,MAC5B;AAAA,IACD;AAAA,EACD;AAAA;AAAA,EAIA,mBAAmB,QAAgB,QAA+B;AACjE,SAAK,QAAQ,IAAI,MAAM,GAAG,QAAQ;AAClC,SAAK,QAAQ,IAAI,QAAQ,KAAK,uBAAuB,UAAU,MAAM,CAAC;AAAA,EACvE;AAAA,EAEA,sBAAsB,QAAsB;AAC3C,SAAK,QAAQ,IAAI,MAAM,GAAG,QAAQ;AAAA,EACnC;AACD;AAhFqE;AAAxD,sBAAN;AAAA,EADN,qBAAqB,YAAY,mBAAmB;AAAA,EASlD;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,GAXU;",
  "names": []
}
