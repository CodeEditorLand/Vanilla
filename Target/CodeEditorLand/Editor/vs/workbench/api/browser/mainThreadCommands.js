var C=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var c=(i,e,t,o)=>{for(var n=o>1?void 0:o?p(e,t):e,a=i.length-1,m;a>=0;a--)(m=i[a])&&(n=(o?m(e,t,n):m(n))||n);return o&&n&&C(e,t,n),n},d=(i,e)=>(t,o)=>e(t,o,i);import{DisposableMap as u}from"../../../base/common/lifecycle.js";import{revive as g}from"../../../base/common/marshalling.js";import{CommandsRegistry as r,ICommandService as v}from"../../../platform/commands/common/commands.js";import{extHostNamedCustomer as f}from"../../services/extensions/common/extHostCustomers.js";import{IExtensionService as l}from"../../services/extensions/common/extensions.js";import{SerializableObjectWithBuffers as h}from"../../services/extensions/common/proxyIdentifier.js";import{ExtHostContext as x,MainContext as _}from"../common/extHost.protocol.js";import{isString as y}from"../../../base/common/types.js";let s=class{constructor(e,t,o){this._commandService=t;this._extensionService=o;this._proxy=e.getProxy(x.ExtHostCommands),this._generateCommandsDocumentationRegistration=r.registerCommand("_generateCommandsDocumentation",()=>this._generateCommandsDocumentation())}_commandRegistrations=new u;_generateCommandsDocumentationRegistration;_proxy;dispose(){this._commandRegistrations.dispose(),this._generateCommandsDocumentationRegistration.dispose()}async _generateCommandsDocumentation(){const e=await this._proxy.$getContributedCommandMetadata(),t=r.getCommands();for(const[n,a]of t)a.metadata&&(e[n]=a.metadata);const o=[];for(const n in e)o.push("`"+n+"` - "+S(e[n]))}$registerCommand(e){this._commandRegistrations.set(e,r.registerCommand(e,(t,...o)=>this._proxy.$executeContributedCommand(e,...o).then(n=>g(n))))}$unregisterCommand(e){this._commandRegistrations.deleteAndDispose(e)}$fireCommandActivationEvent(e){const t=`onCommand:${e}`;this._extensionService.activationEventIsDone(t)||this._extensionService.activateByEvent(t)}async $executeCommand(e,t,o){t instanceof h&&(t=t.value);for(let n=0;n<t.length;n++)t[n]=g(t[n]);if(o&&t.length>0&&!r.getCommand(e))throw await this._extensionService.activateByEvent(`onCommand:${e}`),new Error("$executeCommand:retry");return this._commandService.executeCommand(e,...t)}$getCommands(){return Promise.resolve([...r.getCommands().keys()])}};s=c([f(_.MainThreadCommands),d(1,v),d(2,l)],s);function S(i){if(typeof i=="string")return i;{const t=[y(i.description)?i.description:i.description.original];if(t.push(`

`),i.args)for(const o of i.args)t.push(`* _${o.name}_ - ${o.description||""}
`);return i.returns&&t.push(`* _(returns)_ - ${i.returns}`),t.push(`

`),t.join("")}}export{s as MainThreadCommands};
