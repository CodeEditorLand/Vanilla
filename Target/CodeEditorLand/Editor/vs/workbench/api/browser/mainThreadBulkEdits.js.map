{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadBulkEdits.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { VSBuffer, decodeBase64 } from '../../../base/common/buffer.js';\nimport { revive } from '../../../base/common/marshalling.js';\nimport { IBulkEditService, ResourceFileEdit, ResourceTextEdit } from '../../../editor/browser/services/bulkEditService.js';\nimport { WorkspaceEdit } from '../../../editor/common/languages.js';\nimport { ILogService } from '../../../platform/log/common/log.js';\nimport { IUriIdentityService } from '../../../platform/uriIdentity/common/uriIdentity.js';\nimport { IWorkspaceCellEditDto, IWorkspaceEditDto, IWorkspaceFileEditDto, MainContext, MainThreadBulkEditsShape } from '../common/extHost.protocol.js';\nimport { ResourceNotebookCellEdit } from '../../contrib/bulkEdit/browser/bulkCellEdits.js';\nimport { CellEditType } from '../../contrib/notebook/common/notebookCommon.js';\nimport { IExtHostContext, extHostNamedCustomer } from '../../services/extensions/common/extHostCustomers.js';\nimport { SerializableObjectWithBuffers } from '../../services/extensions/common/proxyIdentifier.js';\n\n\n@extHostNamedCustomer(MainContext.MainThreadBulkEdits)\nexport class MainThreadBulkEdits implements MainThreadBulkEditsShape {\n\n\tconstructor(\n\t\t_extHostContext: IExtHostContext,\n\t\t@IBulkEditService private readonly _bulkEditService: IBulkEditService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IUriIdentityService private readonly _uriIdentService: IUriIdentityService\n\t) { }\n\n\tdispose(): void { }\n\n\t$tryApplyWorkspaceEdit(dto: SerializableObjectWithBuffers<IWorkspaceEditDto>, undoRedoGroupId?: number, isRefactoring?: boolean): Promise<boolean> {\n\t\tconst edits = reviveWorkspaceEditDto(dto.value, this._uriIdentService);\n\t\treturn this._bulkEditService.apply(edits, { undoRedoGroupId, respectAutoSaveConfig: isRefactoring }).then((res) => res.isApplied, err => {\n\t\t\tthis._logService.warn(`IGNORING workspace edit: ${err}`);\n\t\t\treturn false;\n\t\t});\n\t}\n}\n\nexport function reviveWorkspaceEditDto(data: IWorkspaceEditDto, uriIdentityService: IUriIdentityService, resolveDataTransferFile?: (id: string) => Promise<VSBuffer>): WorkspaceEdit;\nexport function reviveWorkspaceEditDto(data: IWorkspaceEditDto | undefined, uriIdentityService: IUriIdentityService, resolveDataTransferFile?: (id: string) => Promise<VSBuffer>): WorkspaceEdit | undefined;\nexport function reviveWorkspaceEditDto(data: IWorkspaceEditDto | undefined, uriIdentityService: IUriIdentityService, resolveDataTransferFile?: (id: string) => Promise<VSBuffer>): WorkspaceEdit | undefined {\n\tif (!data || !data.edits) {\n\t\treturn <WorkspaceEdit>data;\n\t}\n\tconst result = revive<WorkspaceEdit>(data);\n\tfor (const edit of result.edits) {\n\t\tif (ResourceTextEdit.is(edit)) {\n\t\t\tedit.resource = uriIdentityService.asCanonicalUri(edit.resource);\n\t\t}\n\t\tif (ResourceFileEdit.is(edit)) {\n\t\t\tif (edit.options) {\n\t\t\t\tconst inContents = (edit as IWorkspaceFileEditDto).options?.contents;\n\t\t\t\tif (inContents) {\n\t\t\t\t\tif (inContents.type === 'base64') {\n\t\t\t\t\t\tedit.options.contents = Promise.resolve(decodeBase64(inContents.value));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tif (resolveDataTransferFile) {\n\t\t\t\t\t\t\tedit.options.contents = resolveDataTransferFile(inContents.id);\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tthrow new Error('Could not revive data transfer file');\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tedit.newResource = edit.newResource && uriIdentityService.asCanonicalUri(edit.newResource);\n\t\t\tedit.oldResource = edit.oldResource && uriIdentityService.asCanonicalUri(edit.oldResource);\n\t\t}\n\t\tif (ResourceNotebookCellEdit.is(edit)) {\n\t\t\tedit.resource = uriIdentityService.asCanonicalUri(edit.resource);\n\t\t\tconst cellEdit = (edit as IWorkspaceCellEditDto).cellEdit;\n\t\t\tif (cellEdit.editType === CellEditType.Replace) {\n\t\t\t\tedit.cellEdit = {\n\t\t\t\t\t...cellEdit,\n\t\t\t\t\tcells: cellEdit.cells.map(cell => ({\n\t\t\t\t\t\t...cell,\n\t\t\t\t\t\toutputs: cell.outputs.map(output => ({\n\t\t\t\t\t\t\t...output,\n\t\t\t\t\t\t\toutputs: output.items.map(item => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tmime: item.mime,\n\t\t\t\t\t\t\t\t\tdata: item.valueBytes\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t}))\n\t\t\t\t\t}))\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\treturn <WorkspaceEdit>data;\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,UAAU,oBAAoB;AACvC,SAAS,cAAc;AACvB,SAAS,kBAAkB,kBAAkB,wBAAwB;AACrE,SAAS,qBAAqB;AAC9B,SAAS,mBAAmB;AAC5B,SAAS,2BAA2B;AACpC,SAAS,uBAAuB,mBAAmB,uBAAuB,aAAa,gCAAgC;AACvH,SAAS,gCAAgC;AACzC,SAAS,oBAAoB;AAC7B,SAAS,iBAAiB,4BAA4B;AACtD,SAAS,qCAAqC;AAIvC,IAAM,sBAAN,MAA8D;AAAA,EAEpE,YACC,iBACmC,kBACL,aACQ,kBACrC;AAHkC;AACL;AACQ;AAAA,EACnC;AAAA,EAEJ,UAAgB;AAAA,EAAE;AAAA,EAElB,uBAAuB,KAAuD,iBAA0B,eAA2C;AAClJ,UAAM,QAAQ,uBAAuB,IAAI,OAAO,KAAK,gBAAgB;AACrE,WAAO,KAAK,iBAAiB,MAAM,OAAO,EAAE,iBAAiB,uBAAuB,cAAc,CAAC,EAAE,KAAK,CAAC,QAAQ,IAAI,WAAW,SAAO;AACxI,WAAK,YAAY,KAAK,4BAA4B,GAAG,EAAE;AACvD,aAAO;AAAA,IACR,CAAC;AAAA,EACF;AACD;AAlBqE;AAAxD,sBAAN;AAAA,EADN,qBAAqB,YAAY,mBAAmB;AAAA,EAKlD;AAAA,EACA;AAAA,EACA;AAAA,GANU;AAsBN,SAAS,uBAAuB,MAAqC,oBAAyC,yBAAwF;AAC5M,MAAI,CAAC,QAAQ,CAAC,KAAK,OAAO;AACzB,WAAsB;AAAA,EACvB;AACA,QAAM,SAAS,OAAsB,IAAI;AACzC,aAAW,QAAQ,OAAO,OAAO;AAChC,QAAI,iBAAiB,GAAG,IAAI,GAAG;AAC9B,WAAK,WAAW,mBAAmB,eAAe,KAAK,QAAQ;AAAA,IAChE;AACA,QAAI,iBAAiB,GAAG,IAAI,GAAG;AAC9B,UAAI,KAAK,SAAS;AACjB,cAAM,aAAc,KAA+B,SAAS;AAC5D,YAAI,YAAY;AACf,cAAI,WAAW,SAAS,UAAU;AACjC,iBAAK,QAAQ,WAAW,QAAQ,QAAQ,aAAa,WAAW,KAAK,CAAC;AAAA,UACvE,OAAO;AACN,gBAAI,yBAAyB;AAC5B,mBAAK,QAAQ,WAAW,wBAAwB,WAAW,EAAE;AAAA,YAC9D,OAAO;AACN,oBAAM,IAAI,MAAM,qCAAqC;AAAA,YACtD;AAAA,UACD;AAAA,QACD;AAAA,MACD;AACA,WAAK,cAAc,KAAK,eAAe,mBAAmB,eAAe,KAAK,WAAW;AACzF,WAAK,cAAc,KAAK,eAAe,mBAAmB,eAAe,KAAK,WAAW;AAAA,IAC1F;AACA,QAAI,yBAAyB,GAAG,IAAI,GAAG;AACtC,WAAK,WAAW,mBAAmB,eAAe,KAAK,QAAQ;AAC/D,YAAM,WAAY,KAA+B;AACjD,UAAI,SAAS,aAAa,aAAa,SAAS;AAC/C,aAAK,WAAW;AAAA,UACf,GAAG;AAAA,UACH,OAAO,SAAS,MAAM,IAAI,WAAS;AAAA,YAClC,GAAG;AAAA,YACH,SAAS,KAAK,QAAQ,IAAI,aAAW;AAAA,cACpC,GAAG;AAAA,cACH,SAAS,OAAO,MAAM,IAAI,UAAQ;AACjC,uBAAO;AAAA,kBACN,MAAM,KAAK;AAAA,kBACX,MAAM,KAAK;AAAA,gBACZ;AAAA,cACD,CAAC;AAAA,YACF,EAAE;AAAA,UACH,EAAE;AAAA,QACH;AAAA,MACD;AAAA,IACD;AAAA,EACD;AACA,SAAsB;AACvB;AAlDgB;",
  "names": []
}
