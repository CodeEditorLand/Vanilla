{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/workbench/api/browser/mainThreadBulkEdits.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { type VSBuffer, decodeBase64 } from \"../../../base/common/buffer.js\";\nimport { revive } from \"../../../base/common/marshalling.js\";\nimport {\n\tIBulkEditService,\n\tResourceFileEdit,\n\tResourceTextEdit,\n} from \"../../../editor/browser/services/bulkEditService.js\";\nimport type { WorkspaceEdit } from \"../../../editor/common/languages.js\";\nimport { ILogService } from \"../../../platform/log/common/log.js\";\nimport { IUriIdentityService } from \"../../../platform/uriIdentity/common/uriIdentity.js\";\nimport { ResourceNotebookCellEdit } from \"../../contrib/bulkEdit/browser/bulkCellEdits.js\";\nimport { CellEditType } from \"../../contrib/notebook/common/notebookCommon.js\";\nimport {\n\ttype IExtHostContext,\n\textHostNamedCustomer,\n} from \"../../services/extensions/common/extHostCustomers.js\";\nimport type { SerializableObjectWithBuffers } from \"../../services/extensions/common/proxyIdentifier.js\";\nimport {\n\ttype IWorkspaceCellEditDto,\n\ttype IWorkspaceEditDto,\n\ttype IWorkspaceFileEditDto,\n\tMainContext,\n\ttype MainThreadBulkEditsShape,\n} from \"../common/extHost.protocol.js\";\n\n@extHostNamedCustomer(MainContext.MainThreadBulkEdits)\nexport class MainThreadBulkEdits implements MainThreadBulkEditsShape {\n\tconstructor(\n\t\t_extHostContext: IExtHostContext,\n\t\t@IBulkEditService private readonly _bulkEditService: IBulkEditService,\n\t\t@ILogService private readonly _logService: ILogService,\n\t\t@IUriIdentityService\n\t\tprivate readonly _uriIdentService: IUriIdentityService,\n\t) {}\n\n\tdispose(): void {}\n\n\t$tryApplyWorkspaceEdit(\n\t\tdto: SerializableObjectWithBuffers<IWorkspaceEditDto>,\n\t\tundoRedoGroupId?: number,\n\t\tisRefactoring?: boolean,\n\t): Promise<boolean> {\n\t\tconst edits = reviveWorkspaceEditDto(dto.value, this._uriIdentService);\n\t\treturn this._bulkEditService\n\t\t\t.apply(edits, {\n\t\t\t\tundoRedoGroupId,\n\t\t\t\trespectAutoSaveConfig: isRefactoring,\n\t\t\t})\n\t\t\t.then(\n\t\t\t\t(res) => res.isApplied,\n\t\t\t\t(err) => {\n\t\t\t\t\tthis._logService.warn(`IGNORING workspace edit: ${err}`);\n\t\t\t\t\treturn false;\n\t\t\t\t},\n\t\t\t);\n\t}\n}\n\nexport function reviveWorkspaceEditDto(\n\tdata: IWorkspaceEditDto,\n\turiIdentityService: IUriIdentityService,\n\tresolveDataTransferFile?: (id: string) => Promise<VSBuffer>,\n): WorkspaceEdit;\nexport function reviveWorkspaceEditDto(\n\tdata: IWorkspaceEditDto | undefined,\n\turiIdentityService: IUriIdentityService,\n\tresolveDataTransferFile?: (id: string) => Promise<VSBuffer>,\n): WorkspaceEdit | undefined;\nexport function reviveWorkspaceEditDto(\n\tdata: IWorkspaceEditDto | undefined,\n\turiIdentityService: IUriIdentityService,\n\tresolveDataTransferFile?: (id: string) => Promise<VSBuffer>,\n): WorkspaceEdit | undefined {\n\tif (!data || !data.edits) {\n\t\treturn <WorkspaceEdit>data;\n\t}\n\tconst result = revive<WorkspaceEdit>(data);\n\tfor (const edit of result.edits) {\n\t\tif (ResourceTextEdit.is(edit)) {\n\t\t\tedit.resource = uriIdentityService.asCanonicalUri(edit.resource);\n\t\t}\n\t\tif (ResourceFileEdit.is(edit)) {\n\t\t\tif (edit.options) {\n\t\t\t\tconst inContents = (edit as IWorkspaceFileEditDto).options\n\t\t\t\t\t?.contents;\n\t\t\t\tif (inContents) {\n\t\t\t\t\tif (inContents.type === \"base64\") {\n\t\t\t\t\t\tedit.options.contents = Promise.resolve(\n\t\t\t\t\t\t\tdecodeBase64(inContents.value),\n\t\t\t\t\t\t);\n\t\t\t\t\t} else if (resolveDataTransferFile) {\n\t\t\t\t\t\tedit.options.contents = resolveDataTransferFile(\n\t\t\t\t\t\t\tinContents.id,\n\t\t\t\t\t\t);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthrow new Error(\"Could not revive data transfer file\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tedit.newResource =\n\t\t\t\tedit.newResource &&\n\t\t\t\turiIdentityService.asCanonicalUri(edit.newResource);\n\t\t\tedit.oldResource =\n\t\t\t\tedit.oldResource &&\n\t\t\t\turiIdentityService.asCanonicalUri(edit.oldResource);\n\t\t}\n\t\tif (ResourceNotebookCellEdit.is(edit)) {\n\t\t\tedit.resource = uriIdentityService.asCanonicalUri(edit.resource);\n\t\t\tconst cellEdit = (edit as IWorkspaceCellEditDto).cellEdit;\n\t\t\tif (cellEdit.editType === CellEditType.Replace) {\n\t\t\t\tedit.cellEdit = {\n\t\t\t\t\t...cellEdit,\n\t\t\t\t\tcells: cellEdit.cells.map((cell) => ({\n\t\t\t\t\t\t...cell,\n\t\t\t\t\t\toutputs: cell.outputs.map((output) => ({\n\t\t\t\t\t\t\t...output,\n\t\t\t\t\t\t\toutputs: output.items.map((item) => {\n\t\t\t\t\t\t\t\treturn {\n\t\t\t\t\t\t\t\t\tmime: item.mime,\n\t\t\t\t\t\t\t\t\tdata: item.valueBytes,\n\t\t\t\t\t\t\t\t};\n\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t})),\n\t\t\t\t\t})),\n\t\t\t\t};\n\t\t\t}\n\t\t}\n\t}\n\treturn <WorkspaceEdit>data;\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAwB,oBAAoB;AAC5C,SAAS,cAAc;AACvB;AAAA,EACC;AAAA,EACA;AAAA,EACA;AAAA,OACM;AAEP,SAAS,mBAAmB;AAC5B,SAAS,2BAA2B;AACpC,SAAS,gCAAgC;AACzC,SAAS,oBAAoB;AAC7B;AAAA,EAEC;AAAA,OACM;AAEP;AAAA,EAIC;AAAA,OAEM;AAGA,IAAM,sBAAN,MAA8D;AAAA,EACpE,YACC,iBACmC,kBACL,aAEb,kBAChB;AAJkC;AACL;AAEb;AAAA,EACf;AAAA,EAEH,UAAgB;AAAA,EAAC;AAAA,EAEjB,uBACC,KACA,iBACA,eACmB;AACnB,UAAM,QAAQ,uBAAuB,IAAI,OAAO,KAAK,gBAAgB;AACrE,WAAO,KAAK,iBACV,MAAM,OAAO;AAAA,MACb;AAAA,MACA,uBAAuB;AAAA,IACxB,CAAC,EACA;AAAA,MACA,CAAC,QAAQ,IAAI;AAAA,MACb,CAAC,QAAQ;AACR,aAAK,YAAY,KAAK,4BAA4B,GAAG,EAAE;AACvD,eAAO;AAAA,MACR;AAAA,IACD;AAAA,EACF;AACD;AA9BqE;AAAxD,sBAAN;AAAA,EADN,qBAAqB,YAAY,mBAAmB;AAAA,EAIlD;AAAA,EACA;AAAA,EACA;AAAA,GALU;AA0CN,SAAS,uBACf,MACA,oBACA,yBAC4B;AAC5B,MAAI,CAAC,QAAQ,CAAC,KAAK,OAAO;AACzB,WAAsB;AAAA,EACvB;AACA,QAAM,SAAS,OAAsB,IAAI;AACzC,aAAW,QAAQ,OAAO,OAAO;AAChC,QAAI,iBAAiB,GAAG,IAAI,GAAG;AAC9B,WAAK,WAAW,mBAAmB,eAAe,KAAK,QAAQ;AAAA,IAChE;AACA,QAAI,iBAAiB,GAAG,IAAI,GAAG;AAC9B,UAAI,KAAK,SAAS;AACjB,cAAM,aAAc,KAA+B,SAChD;AACH,YAAI,YAAY;AACf,cAAI,WAAW,SAAS,UAAU;AACjC,iBAAK,QAAQ,WAAW,QAAQ;AAAA,cAC/B,aAAa,WAAW,KAAK;AAAA,YAC9B;AAAA,UACD,WAAW,yBAAyB;AACnC,iBAAK,QAAQ,WAAW;AAAA,cACvB,WAAW;AAAA,YACZ;AAAA,UACD,OAAO;AACN,kBAAM,IAAI,MAAM,qCAAqC;AAAA,UACtD;AAAA,QACD;AAAA,MACD;AACA,WAAK,cACJ,KAAK,eACL,mBAAmB,eAAe,KAAK,WAAW;AACnD,WAAK,cACJ,KAAK,eACL,mBAAmB,eAAe,KAAK,WAAW;AAAA,IACpD;AACA,QAAI,yBAAyB,GAAG,IAAI,GAAG;AACtC,WAAK,WAAW,mBAAmB,eAAe,KAAK,QAAQ;AAC/D,YAAM,WAAY,KAA+B;AACjD,UAAI,SAAS,aAAa,aAAa,SAAS;AAC/C,aAAK,WAAW;AAAA,UACf,GAAG;AAAA,UACH,OAAO,SAAS,MAAM,IAAI,CAAC,UAAU;AAAA,YACpC,GAAG;AAAA,YACH,SAAS,KAAK,QAAQ,IAAI,CAAC,YAAY;AAAA,cACtC,GAAG;AAAA,cACH,SAAS,OAAO,MAAM,IAAI,CAAC,SAAS;AACnC,uBAAO;AAAA,kBACN,MAAM,KAAK;AAAA,kBACX,MAAM,KAAK;AAAA,gBACZ;AAAA,cACD,CAAC;AAAA,YACF,EAAE;AAAA,UACH,EAAE;AAAA,QACH;AAAA,MACD;AAAA,IACD;AAAA,EACD;AACA,SAAsB;AACvB;AA7DgB;",
  "names": []
}
