var S=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var c=(i,o,t,r)=>{for(var e=r>1?void 0:r?d(o,t):o,n=i.length-1,a;n>=0;n--)(a=i[n])&&(e=(r?a(o,t,e):a(e))||e);return r&&e&&S(o,t,e),e},p=(i,o)=>(t,r)=>o(t,r,i);import{raceCancellationError as I}from"../../../base/common/async.js";import"../../../base/common/cancellation.js";import"../../../base/common/lifecycle.js";import{localize as v}from"../../../nls.js";import{IInstantiationService as C}from"../../../platform/instantiation/common/instantiation.js";import"../../../platform/progress/common/progress.js";import{NotebookFileWorkingCopyModel as x}from"../../contrib/notebook/common/notebookEditorModel.js";import{extHostCustomer as y}from"../../services/extensions/common/extHostCustomers.js";import"../../services/workingCopy/common/storedFileWorkingCopy.js";import{IWorkingCopyFileService as g}from"../../services/workingCopy/common/workingCopyFileService.js";import{ExtHostContext as k}from"../common/extHost.protocol.js";class u{_proxy;constructor(o){this._proxy=o.getProxy(k.ExtHostNotebookDocumentSaveParticipant)}async participate(o,t,r,e){if(!o.model||!(o.model instanceof x))return;let n;const a=new Promise((m,l)=>{n=setTimeout(()=>l(new Error(v("timeout.onWillSave","Aborted onWillSaveNotebookDocument-event after 1750ms"))),1750),this._proxy.$participateInSave(o.resource,t.reason,e).then(f=>{clearTimeout(n)}).then(m,l)});return I(a,e)}}let s=class{constructor(o,t,r){this.workingCopyFileService=r;this._saveParticipantDisposable=this.workingCopyFileService.addSaveParticipant(t.createInstance(u,o))}_saveParticipantDisposable;dispose(){this._saveParticipantDisposable.dispose()}};s=c([y,p(1,C),p(2,g)],s);export{s as SaveParticipant};
