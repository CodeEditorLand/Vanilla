{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/actionWidget/browser/actionWidget.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\nimport * as dom from '../../../base/browser/dom.js';\nimport { ActionBar } from '../../../base/browser/ui/actionbar/actionbar.js';\nimport { IAnchor } from '../../../base/browser/ui/contextview/contextview.js';\nimport { IAction } from '../../../base/common/actions.js';\nimport { KeyCode, KeyMod } from '../../../base/common/keyCodes.js';\nimport { Disposable, DisposableStore, IDisposable, MutableDisposable } from '../../../base/common/lifecycle.js';\nimport './actionWidget.css';\nimport { localize, localize2 } from '../../../nls.js';\nimport { acceptSelectedActionCommand, ActionList, IActionListDelegate, IActionListItem, previewSelectedActionCommand } from './actionList.js';\nimport { Action2, registerAction2 } from '../../actions/common/actions.js';\nimport { IContextKeyService, RawContextKey } from '../../contextkey/common/contextkey.js';\nimport { IContextViewService } from '../../contextview/browser/contextView.js';\nimport { InstantiationType, registerSingleton } from '../../instantiation/common/extensions.js';\nimport { createDecorator, IInstantiationService, ServicesAccessor } from '../../instantiation/common/instantiation.js';\nimport { KeybindingWeight } from '../../keybinding/common/keybindingsRegistry.js';\nimport { inputActiveOptionBackground, registerColor } from '../../theme/common/colorRegistry.js';\n\nregisterColor(\n\t'actionBar.toggledBackground',\n\tinputActiveOptionBackground,\n\tlocalize('actionBar.toggledBackground', 'Background color for toggled action items in action bar.')\n);\n\nconst ActionWidgetContextKeys = {\n\tVisible: new RawContextKey<boolean>('codeActionMenuVisible', false, localize('codeActionMenuVisible', \"Whether the action widget list is visible\"))\n};\n\nexport const IActionWidgetService = createDecorator<IActionWidgetService>('actionWidgetService');\n\nexport interface IActionWidgetService {\n\treadonly _serviceBrand: undefined;\n\n\tshow<T>(user: string, supportsPreview: boolean, items: readonly IActionListItem<T>[], delegate: IActionListDelegate<T>, anchor: IAnchor, container: HTMLElement | undefined, actionBarActions?: readonly IAction[]): void;\n\n\thide(didCancel?: boolean): void;\n\n\treadonly isVisible: boolean;\n}\n\nclass ActionWidgetService extends Disposable implements IActionWidgetService {\n\tdeclare readonly _serviceBrand: undefined;\n\n\tget isVisible() {\n\t\treturn ActionWidgetContextKeys.Visible.getValue(this._contextKeyService) || false;\n\t}\n\n\tprivate readonly _list = this._register(new MutableDisposable<ActionList<unknown>>());\n\n\tconstructor(\n\t\t@IContextViewService private readonly _contextViewService: IContextViewService,\n\t\t@IContextKeyService private readonly _contextKeyService: IContextKeyService,\n\t\t@IInstantiationService private readonly _instantiationService: IInstantiationService\n\t) {\n\t\tsuper();\n\t}\n\n\tshow<T>(user: string, supportsPreview: boolean, items: readonly IActionListItem<T>[], delegate: IActionListDelegate<T>, anchor: IAnchor, container: HTMLElement | undefined, actionBarActions?: readonly IAction[]): void {\n\t\tconst visibleContext = ActionWidgetContextKeys.Visible.bindTo(this._contextKeyService);\n\n\t\tconst list = this._instantiationService.createInstance(ActionList, user, supportsPreview, items, delegate);\n\t\tthis._contextViewService.showContextView({\n\t\t\tgetAnchor: () => anchor,\n\t\t\trender: (container: HTMLElement) => {\n\t\t\t\tvisibleContext.set(true);\n\t\t\t\treturn this._renderWidget(container, list, actionBarActions ?? []);\n\t\t\t},\n\t\t\tonHide: (didCancel) => {\n\t\t\t\tvisibleContext.reset();\n\t\t\t\tthis._onWidgetClosed(didCancel);\n\t\t\t},\n\t\t}, container, false);\n\t}\n\n\tacceptSelected(preview?: boolean) {\n\t\tthis._list.value?.acceptSelected(preview);\n\t}\n\n\tfocusPrevious() {\n\t\tthis._list?.value?.focusPrevious();\n\t}\n\n\tfocusNext() {\n\t\tthis._list?.value?.focusNext();\n\t}\n\n\thide(didCancel?: boolean) {\n\t\tthis._list.value?.hide(didCancel);\n\t\tthis._list.clear();\n\t}\n\n\tclear() {\n\t\tthis._list.clear();\n\t}\n\n\tprivate _renderWidget(element: HTMLElement, list: ActionList<unknown>, actionBarActions: readonly IAction[]): IDisposable {\n\t\tconst widget = document.createElement('div');\n\t\twidget.classList.add('action-widget');\n\t\telement.appendChild(widget);\n\n\t\tthis._list.value = list;\n\t\tif (this._list.value) {\n\t\t\twidget.appendChild(this._list.value.domNode);\n\t\t} else {\n\t\t\tthrow new Error('List has no value');\n\t\t}\n\t\tconst renderDisposables = new DisposableStore();\n\n\t\t// Invisible div to block mouse interaction in the rest of the UI\n\t\tconst menuBlock = document.createElement('div');\n\t\tconst block = element.appendChild(menuBlock);\n\t\tblock.classList.add('context-view-block');\n\t\trenderDisposables.add(dom.addDisposableListener(block, dom.EventType.MOUSE_DOWN, e => e.stopPropagation()));\n\n\t\t// Invisible div to block mouse interaction with the menu\n\t\tconst pointerBlockDiv = document.createElement('div');\n\t\tconst pointerBlock = element.appendChild(pointerBlockDiv);\n\t\tpointerBlock.classList.add('context-view-pointerBlock');\n\n\t\t// Removes block on click INSIDE widget or ANY mouse movement\n\t\trenderDisposables.add(dom.addDisposableListener(pointerBlock, dom.EventType.POINTER_MOVE, () => pointerBlock.remove()));\n\t\trenderDisposables.add(dom.addDisposableListener(pointerBlock, dom.EventType.MOUSE_DOWN, () => pointerBlock.remove()));\n\n\t\t// Action bar\n\t\tlet actionBarWidth = 0;\n\t\tif (actionBarActions.length) {\n\t\t\tconst actionBar = this._createActionBar('.action-widget-action-bar', actionBarActions);\n\t\t\tif (actionBar) {\n\t\t\t\twidget.appendChild(actionBar.getContainer().parentElement!);\n\t\t\t\trenderDisposables.add(actionBar);\n\t\t\t\tactionBarWidth = actionBar.getContainer().offsetWidth;\n\t\t\t}\n\t\t}\n\n\t\tconst width = this._list.value?.layout(actionBarWidth);\n\t\twidget.style.width = `${width}px`;\n\n\t\tconst focusTracker = renderDisposables.add(dom.trackFocus(element));\n\t\trenderDisposables.add(focusTracker.onDidBlur(() => this.hide(true)));\n\n\t\treturn renderDisposables;\n\t}\n\n\tprivate _createActionBar(className: string, actions: readonly IAction[]): ActionBar | undefined {\n\t\tif (!actions.length) {\n\t\t\treturn undefined;\n\t\t}\n\n\t\tconst container = dom.$(className);\n\t\tconst actionBar = new ActionBar(container);\n\t\tactionBar.push(actions, { icon: false, label: true });\n\t\treturn actionBar;\n\t}\n\n\tprivate _onWidgetClosed(didCancel?: boolean): void {\n\t\tthis._list.value?.hide(didCancel);\n\t}\n}\n\nregisterSingleton(IActionWidgetService, ActionWidgetService, InstantiationType.Delayed);\n\nconst weight = KeybindingWeight.EditorContrib + 1000;\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'hideCodeActionWidget',\n\t\t\ttitle: localize2('hideCodeActionWidget.title', \"Hide action widget\"),\n\t\t\tprecondition: ActionWidgetContextKeys.Visible,\n\t\t\tkeybinding: {\n\t\t\t\tweight,\n\t\t\t\tprimary: KeyCode.Escape,\n\t\t\t\tsecondary: [KeyMod.Shift | KeyCode.Escape]\n\t\t\t},\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\taccessor.get(IActionWidgetService).hide(true);\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'selectPrevCodeAction',\n\t\t\ttitle: localize2('selectPrevCodeAction.title', \"Select previous action\"),\n\t\t\tprecondition: ActionWidgetContextKeys.Visible,\n\t\t\tkeybinding: {\n\t\t\t\tweight,\n\t\t\t\tprimary: KeyCode.UpArrow,\n\t\t\t\tsecondary: [KeyMod.CtrlCmd | KeyCode.UpArrow],\n\t\t\t\tmac: { primary: KeyCode.UpArrow, secondary: [KeyMod.CtrlCmd | KeyCode.UpArrow, KeyMod.WinCtrl | KeyCode.KeyP] },\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tconst widgetService = accessor.get(IActionWidgetService);\n\t\tif (widgetService instanceof ActionWidgetService) {\n\t\t\twidgetService.focusPrevious();\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: 'selectNextCodeAction',\n\t\t\ttitle: localize2('selectNextCodeAction.title', \"Select next action\"),\n\t\t\tprecondition: ActionWidgetContextKeys.Visible,\n\t\t\tkeybinding: {\n\t\t\t\tweight,\n\t\t\t\tprimary: KeyCode.DownArrow,\n\t\t\t\tsecondary: [KeyMod.CtrlCmd | KeyCode.DownArrow],\n\t\t\t\tmac: { primary: KeyCode.DownArrow, secondary: [KeyMod.CtrlCmd | KeyCode.DownArrow, KeyMod.WinCtrl | KeyCode.KeyN] }\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tconst widgetService = accessor.get(IActionWidgetService);\n\t\tif (widgetService instanceof ActionWidgetService) {\n\t\t\twidgetService.focusNext();\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: acceptSelectedActionCommand,\n\t\t\ttitle: localize2('acceptSelected.title', \"Accept selected action\"),\n\t\t\tprecondition: ActionWidgetContextKeys.Visible,\n\t\t\tkeybinding: {\n\t\t\t\tweight,\n\t\t\t\tprimary: KeyCode.Enter,\n\t\t\t\tsecondary: [KeyMod.CtrlCmd | KeyCode.Period],\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tconst widgetService = accessor.get(IActionWidgetService);\n\t\tif (widgetService instanceof ActionWidgetService) {\n\t\t\twidgetService.acceptSelected();\n\t\t}\n\t}\n});\n\nregisterAction2(class extends Action2 {\n\tconstructor() {\n\t\tsuper({\n\t\t\tid: previewSelectedActionCommand,\n\t\t\ttitle: localize2('previewSelected.title', \"Preview selected action\"),\n\t\t\tprecondition: ActionWidgetContextKeys.Visible,\n\t\t\tkeybinding: {\n\t\t\t\tweight,\n\t\t\t\tprimary: KeyMod.CtrlCmd | KeyCode.Enter,\n\t\t\t}\n\t\t});\n\t}\n\n\trun(accessor: ServicesAccessor): void {\n\t\tconst widgetService = accessor.get(IActionWidgetService);\n\t\tif (widgetService instanceof ActionWidgetService) {\n\t\t\twidgetService.acceptSelected(true);\n\t\t}\n\t}\n});\n"],
  "mappings": "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",
  "names": ["container"]
}
