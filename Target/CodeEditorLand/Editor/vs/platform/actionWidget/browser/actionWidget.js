var E=Object.defineProperty;var B=Object.getOwnPropertyDescriptor;var I=(i,t,e,r)=>{for(var o=r>1?void 0:r?B(t,e):t,c=i.length-1,s;c>=0;c--)(s=i[c])&&(o=(r?s(t,e,o):s(o))||o);return r&&o&&E(t,e,o),o},C=(i,t)=>(e,r)=>t(e,r,i);import*as l from"../../../base/browser/dom.js";import{ActionBar as L}from"../../../base/browser/ui/actionbar/actionbar.js";import{KeyCode as n,KeyMod as a}from"../../../base/common/keyCodes.js";import{Disposable as k,DisposableStore as V,MutableDisposable as T}from"../../../base/common/lifecycle.js";import"./actionWidget.css";import{localize as x,localize2 as h}from"../../../nls.js";import{Action2 as y,registerAction2 as A}from"../../actions/common/actions.js";import{IContextKeyService as W,RawContextKey as K}from"../../contextkey/common/contextkey.js";import{IContextViewService as M}from"../../contextview/browser/contextView.js";import{InstantiationType as P,registerSingleton as N}from"../../instantiation/common/extensions.js";import{IInstantiationService as O,createDecorator as H}from"../../instantiation/common/instantiation.js";import{KeybindingWeight as U}from"../../keybinding/common/keybindingsRegistry.js";import{inputActiveOptionBackground as j,registerColor as z}from"../../theme/common/colorRegistry.js";import{ActionList as R,acceptSelectedActionCommand as $,previewSelectedActionCommand as F}from"./actionList.js";z("actionBar.toggledBackground",j,x("actionBar.toggledBackground","Background color for toggled action items in action bar."));const v={Visible:new K("codeActionMenuVisible",!1,x("codeActionMenuVisible","Whether the action widget list is visible"))},g=H("actionWidgetService");let d=class extends k{constructor(e,r,o){super();this._contextViewService=e;this._contextKeyService=r;this._instantiationService=o}get isVisible(){return v.Visible.getValue(this._contextKeyService)||!1}_list=this._register(new T);show(e,r,o,c,s,S,f){const b=v.Visible.bindTo(this._contextKeyService),p=this._instantiationService.createInstance(R,e,r,o,c);this._contextViewService.showContextView({getAnchor:()=>s,render:u=>(b.set(!0),this._renderWidget(u,p,f??[])),onHide:u=>{b.reset(),this._onWidgetClosed(u)}},S,!1)}acceptSelected(e){this._list.value?.acceptSelected(e)}focusPrevious(){this._list?.value?.focusPrevious()}focusNext(){this._list?.value?.focusNext()}hide(e){this._list.value?.hide(e),this._list.clear()}clear(){this._list.clear()}_renderWidget(e,r,o){const c=document.createElement("div");if(c.classList.add("action-widget"),e.appendChild(c),this._list.value=r,this._list.value)c.appendChild(this._list.value.domNode);else throw new Error("List has no value");const s=new V,S=document.createElement("div"),f=e.appendChild(S);f.classList.add("context-view-block"),s.add(l.addDisposableListener(f,l.EventType.MOUSE_DOWN,m=>m.stopPropagation()));const b=document.createElement("div"),p=e.appendChild(b);p.classList.add("context-view-pointerBlock"),s.add(l.addDisposableListener(p,l.EventType.POINTER_MOVE,()=>p.remove())),s.add(l.addDisposableListener(p,l.EventType.MOUSE_DOWN,()=>p.remove()));let u=0;if(o.length){const m=this._createActionBar(".action-widget-action-bar",o);m&&(c.appendChild(m.getContainer().parentElement),s.add(m),u=m.getContainer().offsetWidth)}const _=this._list.value?.layout(u);c.style.width=`${_}px`;const D=s.add(l.trackFocus(e));return s.add(D.onDidBlur(()=>this.hide(!0))),s}_createActionBar(e,r){if(!r.length)return;const o=l.$(e),c=new L(o);return c.push(r,{icon:!1,label:!0}),c}_onWidgetClosed(e){this._list.value?.hide(e)}};d=I([C(0,M),C(1,W),C(2,O)],d),N(g,d,P.Delayed);const w=U.EditorContrib+1e3;A(class extends y{constructor(){super({id:"hideCodeActionWidget",title:h("hideCodeActionWidget.title","Hide action widget"),precondition:v.Visible,keybinding:{weight:w,primary:n.Escape,secondary:[a.Shift|n.Escape]}})}run(i){i.get(g).hide(!0)}}),A(class extends y{constructor(){super({id:"selectPrevCodeAction",title:h("selectPrevCodeAction.title","Select previous action"),precondition:v.Visible,keybinding:{weight:w,primary:n.UpArrow,secondary:[a.CtrlCmd|n.UpArrow],mac:{primary:n.UpArrow,secondary:[a.CtrlCmd|n.UpArrow,a.WinCtrl|n.KeyP]}}})}run(i){const t=i.get(g);t instanceof d&&t.focusPrevious()}}),A(class extends y{constructor(){super({id:"selectNextCodeAction",title:h("selectNextCodeAction.title","Select next action"),precondition:v.Visible,keybinding:{weight:w,primary:n.DownArrow,secondary:[a.CtrlCmd|n.DownArrow],mac:{primary:n.DownArrow,secondary:[a.CtrlCmd|n.DownArrow,a.WinCtrl|n.KeyN]}}})}run(i){const t=i.get(g);t instanceof d&&t.focusNext()}}),A(class extends y{constructor(){super({id:$,title:h("acceptSelected.title","Accept selected action"),precondition:v.Visible,keybinding:{weight:w,primary:n.Enter,secondary:[a.CtrlCmd|n.Period]}})}run(i){const t=i.get(g);t instanceof d&&t.acceptSelected()}}),A(class extends y{constructor(){super({id:F,title:h("previewSelected.title","Preview selected action"),precondition:v.Visible,keybinding:{weight:w,primary:a.CtrlCmd|n.Enter}})}run(i){const t=i.get(g);t instanceof d&&t.acceptSelected(!0)}});export{g as IActionWidgetService};
