import e from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as p}from"../../../../base/test/common/utils.js";import{getDomainsOfRemotes as i,getRemotes as r}from"../../common/configRemotes.js";suite("Config Remotes",()=>{p();const o=["github.com","github2.com","github3.com","example.com","example2.com","example3.com","server.org","server2.org"];test("HTTPS remotes",function(){e.deepStrictEqual(i(t("https://github.com/microsoft/vscode.git"),o),["github.com"]),e.deepStrictEqual(i(t("https://git.example.com/gitproject.git"),o),["example.com"]),e.deepStrictEqual(i(t("https://username@github2.com/username/repository.git"),o),["github2.com"]),e.deepStrictEqual(i(t("https://username:password@github3.com/username/repository.git"),o),["github3.com"]),e.deepStrictEqual(i(t("https://username:password@example2.com:1234/username/repository.git"),o),["example2.com"]),e.deepStrictEqual(i(t("https://example3.com:1234/username/repository.git"),o),["example3.com"])}),test("SSH remotes",function(){e.deepStrictEqual(i(t("ssh://user@git.server.org/project.git"),o),["server.org"])}),test("SCP-like remotes",function(){e.deepStrictEqual(i(t("git@github.com:microsoft/vscode.git"),o),["github.com"]),e.deepStrictEqual(i(t("user@git.server.org:project.git"),o),["server.org"]),e.deepStrictEqual(i(t("git.server2.org:project.git"),o),["server2.org"])}),test("Local remotes",function(){e.deepStrictEqual(i(t("/opt/git/project.git"),o),[]),e.deepStrictEqual(i(t("file:///opt/git/project.git"),o),[])}),test("Multiple remotes",function(){const s=["https://github.com/microsoft/vscode.git","https://git.example.com/gitproject.git"].map(t).join("");e.deepStrictEqual(i(s,o).sort(),["example.com","github.com"])}),test("Non allowed domains are anonymized",()=>{const s=["https://github.com/microsoft/vscode.git","https://git.foobar.com/gitproject.git"].map(t).join("");e.deepStrictEqual(i(s,o).sort(),["aaaaaa.aaa","github.com"])}),test("HTTPS remotes to be hashed",function(){e.deepStrictEqual(r(t("https://github.com/microsoft/vscode.git")),["github.com/microsoft/vscode.git"]),e.deepStrictEqual(r(t("https://git.example.com/gitproject.git")),["git.example.com/gitproject.git"]),e.deepStrictEqual(r(t("https://username@github2.com/username/repository.git")),["github2.com/username/repository.git"]),e.deepStrictEqual(r(t("https://username:password@github3.com/username/repository.git")),["github3.com/username/repository.git"]),e.deepStrictEqual(r(t("https://username:password@example2.com:1234/username/repository.git")),["example2.com/username/repository.git"]),e.deepStrictEqual(r(t("https://example3.com:1234/username/repository.git")),["example3.com/username/repository.git"]),e.deepStrictEqual(r(t("https://github.com/microsoft/vscode.git"),!0),["github.com/microsoft/vscode"]),e.deepStrictEqual(r(t("https://git.example.com/gitproject.git"),!0),["git.example.com/gitproject"]),e.deepStrictEqual(r(t("https://username@github2.com/username/repository.git"),!0),["github2.com/username/repository"]),e.deepStrictEqual(r(t("https://username:password@github3.com/username/repository.git"),!0),["github3.com/username/repository"]),e.deepStrictEqual(r(t("https://username:password@example2.com:1234/username/repository.git"),!0),["example2.com/username/repository"]),e.deepStrictEqual(r(t("https://example3.com:1234/username/repository.git"),!0),["example3.com/username/repository"]),e.deepStrictEqual(r(t("https://github.com/microsoft/vscode.git"),!0),r(t("https://github.com/microsoft/vscode"))),e.deepStrictEqual(r(t("https://git.example.com/gitproject.git"),!0),r(t("https://git.example.com/gitproject"))),e.deepStrictEqual(r(t("https://username@github2.com/username/repository.git"),!0),r(t("https://username@github2.com/username/repository"))),e.deepStrictEqual(r(t("https://username:password@github3.com/username/repository.git"),!0),r(t("https://username:password@github3.com/username/repository"))),e.deepStrictEqual(r(t("https://username:password@example2.com:1234/username/repository.git"),!0),r(t("https://username:password@example2.com:1234/username/repository"))),e.deepStrictEqual(r(t("https://example3.com:1234/username/repository.git"),!0),r(t("https://example3.com:1234/username/repository")))}),test("SSH remotes to be hashed",function(){e.deepStrictEqual(r(t("ssh://user@git.server.org/project.git")),["git.server.org/project.git"]),e.deepStrictEqual(r(t("ssh://user@git.server.org/project.git"),!0),["git.server.org/project"]),e.deepStrictEqual(r(t("ssh://user@git.server.org/project.git"),!0),r(t("ssh://user@git.server.org/project")))}),test("SCP-like remotes to be hashed",function(){e.deepStrictEqual(r(t("git@github.com:microsoft/vscode.git")),["github.com/microsoft/vscode.git"]),e.deepStrictEqual(r(t("user@git.server.org:project.git")),["git.server.org/project.git"]),e.deepStrictEqual(r(t("git.server2.org:project.git")),["git.server2.org/project.git"]),e.deepStrictEqual(r(t("git@github.com:microsoft/vscode.git"),!0),["github.com/microsoft/vscode"]),e.deepStrictEqual(r(t("user@git.server.org:project.git"),!0),["git.server.org/project"]),e.deepStrictEqual(r(t("git.server2.org:project.git"),!0),["git.server2.org/project"]),e.deepStrictEqual(r(t("git@github.com:microsoft/vscode.git"),!0),r(t("git@github.com:microsoft/vscode"))),e.deepStrictEqual(r(t("user@git.server.org:project.git"),!0),r(t("user@git.server.org:project"))),e.deepStrictEqual(r(t("git.server2.org:project.git"),!0),r(t("git.server2.org:project")))}),test("Local remotes to be hashed",function(){e.deepStrictEqual(r(t("/opt/git/project.git")),[]),e.deepStrictEqual(r(t("file:///opt/git/project.git")),[])}),test("Multiple remotes to be hashed",function(){const s=["https://github.com/microsoft/vscode.git","https://git.example.com/gitproject.git"].map(t).join(" ");e.deepStrictEqual(r(s),["github.com/microsoft/vscode.git","git.example.com/gitproject.git"]),e.deepStrictEqual(r(s,!0),["github.com/microsoft/vscode","git.example.com/gitproject"]);const c=["https://github.com/microsoft/vscode","https://git.example.com/gitproject"].map(t).join(" ");e.deepStrictEqual(r(s,!0),r(c))});function t(s){return`[remote "origin"]
	url = ${s}
	fetch = +refs/heads/*:refs/remotes/origin/*
`}});
