{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/extensionManagement/node/extensionsManifestCache.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { Disposable } from \"../../../base/common/lifecycle.js\";\nimport type { URI } from \"../../../base/common/uri.js\";\nimport { USER_MANIFEST_CACHE_FILE } from \"../../extensions/common/extensions.js\";\nimport {\n\tFileOperationResult,\n\ttype IFileService,\n\ttoFileOperationResult,\n} from \"../../files/common/files.js\";\nimport type { ILogService } from \"../../log/common/log.js\";\nimport type { IUriIdentityService } from \"../../uriIdentity/common/uriIdentity.js\";\nimport type {\n\tIUserDataProfile,\n\tIUserDataProfilesService,\n} from \"../../userDataProfile/common/userDataProfile.js\";\nimport type {\n\tDidUninstallExtensionEvent,\n\tIExtensionManagementService,\n\tInstallExtensionResult,\n} from \"../common/extensionManagement.js\";\n\nexport class ExtensionsManifestCache extends Disposable {\n\tconstructor(\n\t\tprivate readonly userDataProfilesService: IUserDataProfilesService,\n\t\tprivate readonly fileService: IFileService,\n\t\tprivate readonly uriIdentityService: IUriIdentityService,\n\t\textensionsManagementService: IExtensionManagementService,\n\t\tprivate readonly logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._register(\n\t\t\textensionsManagementService.onDidInstallExtensions((e) =>\n\t\t\t\tthis.onDidInstallExtensions(e),\n\t\t\t),\n\t\t);\n\t\tthis._register(\n\t\t\textensionsManagementService.onDidUninstallExtension((e) =>\n\t\t\t\tthis.onDidUnInstallExtension(e),\n\t\t\t),\n\t\t);\n\t}\n\n\tprivate onDidInstallExtensions(\n\t\tresults: readonly InstallExtensionResult[],\n\t): void {\n\t\tfor (const r of results) {\n\t\t\tif (r.local) {\n\t\t\t\tthis.invalidate(r.profileLocation);\n\t\t\t}\n\t\t}\n\t}\n\n\tprivate onDidUnInstallExtension(e: DidUninstallExtensionEvent): void {\n\t\tif (!e.error) {\n\t\t\tthis.invalidate(e.profileLocation);\n\t\t}\n\t}\n\n\tasync invalidate(\n\t\textensionsManifestLocation: URI | undefined,\n\t): Promise<void> {\n\t\tif (extensionsManifestLocation) {\n\t\t\tfor (const profile of this.userDataProfilesService.profiles) {\n\t\t\t\tif (\n\t\t\t\t\tthis.uriIdentityService.extUri.isEqual(\n\t\t\t\t\t\tprofile.extensionsResource,\n\t\t\t\t\t\textensionsManifestLocation,\n\t\t\t\t\t)\n\t\t\t\t) {\n\t\t\t\t\tawait this.deleteUserCacheFile(profile);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tawait this.deleteUserCacheFile(\n\t\t\t\tthis.userDataProfilesService.defaultProfile,\n\t\t\t);\n\t\t}\n\t}\n\n\tprivate async deleteUserCacheFile(\n\t\tprofile: IUserDataProfile,\n\t): Promise<void> {\n\t\ttry {\n\t\t\tawait this.fileService.del(\n\t\t\t\tthis.uriIdentityService.extUri.joinPath(\n\t\t\t\t\tprofile.cacheHome,\n\t\t\t\t\tUSER_MANIFEST_CACHE_FILE,\n\t\t\t\t),\n\t\t\t);\n\t\t} catch (error) {\n\t\t\tif (\n\t\t\t\ttoFileOperationResult(error) !==\n\t\t\t\tFileOperationResult.FILE_NOT_FOUND\n\t\t\t) {\n\t\t\t\tthis.logService.error(error);\n\t\t\t}\n\t\t}\n\t}\n}\n"],
  "mappings": ";;AAKA,SAAS,kBAAkB;AAE3B,SAAS,gCAAgC;AACzC;AAAA,EACC;AAAA,EAEA;AAAA,OACM;AAaA,MAAM,gCAAgC,WAAW;AAAA,EACvD,YACkB,yBACA,aACA,oBACjB,6BACiB,YAChB;AACD,UAAM;AANW;AACA;AACA;AAEA;AAGjB,SAAK;AAAA,MACJ,4BAA4B;AAAA,QAAuB,CAAC,MACnD,KAAK,uBAAuB,CAAC;AAAA,MAC9B;AAAA,IACD;AACA,SAAK;AAAA,MACJ,4BAA4B;AAAA,QAAwB,CAAC,MACpD,KAAK,wBAAwB,CAAC;AAAA,MAC/B;AAAA,IACD;AAAA,EACD;AAAA,EA5CD,OAyBwD;AAAA;AAAA;AAAA,EAqB/C,uBACP,SACO;AACP,eAAW,KAAK,SAAS;AACxB,UAAI,EAAE,OAAO;AACZ,aAAK,WAAW,EAAE,eAAe;AAAA,MAClC;AAAA,IACD;AAAA,EACD;AAAA,EAEQ,wBAAwB,GAAqC;AACpE,QAAI,CAAC,EAAE,OAAO;AACb,WAAK,WAAW,EAAE,eAAe;AAAA,IAClC;AAAA,EACD;AAAA,EAEA,MAAM,WACL,4BACgB;AAChB,QAAI,4BAA4B;AAC/B,iBAAW,WAAW,KAAK,wBAAwB,UAAU;AAC5D,YACC,KAAK,mBAAmB,OAAO;AAAA,UAC9B,QAAQ;AAAA,UACR;AAAA,QACD,GACC;AACD,gBAAM,KAAK,oBAAoB,OAAO;AAAA,QACvC;AAAA,MACD;AAAA,IACD,OAAO;AACN,YAAM,KAAK;AAAA,QACV,KAAK,wBAAwB;AAAA,MAC9B;AAAA,IACD;AAAA,EACD;AAAA,EAEA,MAAc,oBACb,SACgB;AAChB,QAAI;AACH,YAAM,KAAK,YAAY;AAAA,QACtB,KAAK,mBAAmB,OAAO;AAAA,UAC9B,QAAQ;AAAA,UACR;AAAA,QACD;AAAA,MACD;AAAA,IACD,SAAS,OAAO;AACf,UACC,sBAAsB,KAAK,MAC3B,oBAAoB,gBACnB;AACD,aAAK,WAAW,MAAM,KAAK;AAAA,MAC5B;AAAA,IACD;AAAA,EACD;AACD;",
  "names": []
}
