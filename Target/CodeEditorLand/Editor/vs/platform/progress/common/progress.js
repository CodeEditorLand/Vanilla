var g=Object.defineProperty;var y=Object.getOwnPropertyDescriptor;var c=(i,e,t,o)=>{for(var s=o>1?void 0:o?y(e,t):e,p=i.length-1,r;p>=0;p--)(r=i[p])&&(s=(o?r(e,t,s):r(s))||s);return o&&s&&g(e,t,s),s},d=(i,e)=>(t,o)=>e(t,o,i);import{DeferredPromise as I}from"../../../base/common/async.js";import{CancellationTokenSource as h}from"../../../base/common/cancellation.js";import{Disposable as u,DisposableStore as m,toDisposable as n}from"../../../base/common/lifecycle.js";import{createDecorator as l}from"../../instantiation/common/instantiation.js";const P=l("progressService");var v=(r=>(r[r.Explorer=1]="Explorer",r[r.Scm=3]="Scm",r[r.Extensions=5]="Extensions",r[r.Window=10]="Window",r[r.Notification=15]="Notification",r[r.Dialog=20]="Dialog",r))(v||{});const S=Object.freeze({total(){},worked(){},done(){}});class w{constructor(e){this.callback=e}static None=Object.freeze({report(){}});_value;get value(){return this._value}report(e){this._value=e,this.callback(this._value)}}class T{constructor(e){this.callback=e}_value;get value(){return this._value}_asyncQueue;_processingAsyncQueue;_drainListener;report(e){this._asyncQueue?this._asyncQueue.push(e):this._asyncQueue=[e],this._processAsyncQueue()}async _processAsyncQueue(){if(!this._processingAsyncQueue)try{for(this._processingAsyncQueue=!0;this._asyncQueue&&this._asyncQueue.length;){const e=this._asyncQueue.shift();this._value=e,await this.callback(this._value)}}finally{this._processingAsyncQueue=!1;const e=this._drainListener;this._drainListener=void 0,e?.()}}drain(){return this._processingAsyncQueue?new Promise(e=>{const t=this._drainListener;this._drainListener=()=>{t?.(),e()}}):Promise.resolve()}}let a=class extends u{deferred=new I;reporter;lastStep;constructor(e,t){super(),t.withProgress(e,o=>(this.reporter=o,this.lastStep&&o.report(this.lastStep),this.deferred.p)),this._register(n(()=>this.deferred.complete()))}report(e){this.reporter?this.reporter.report(e):this.lastStep=e}};a=c([d(1,P)],a);class k extends u{constructor(t){super();this.progressIndicator=t}currentOperationId=0;currentOperationDisposables=this._register(new m);currentProgressRunner;currentProgressTimeout;start(t){this.stop();const o=++this.currentOperationId,s=new h;return this.currentProgressTimeout=setTimeout(()=>{o===this.currentOperationId&&(this.currentProgressRunner=this.progressIndicator.show(!0))},t),this.currentOperationDisposables.add(n(()=>clearTimeout(this.currentProgressTimeout))),this.currentOperationDisposables.add(n(()=>s.cancel())),this.currentOperationDisposables.add(n(()=>this.currentProgressRunner?this.currentProgressRunner.done():void 0)),{id:o,token:s.token,stop:()=>this.doStop(o),isCurrent:()=>this.currentOperationId===o}}stop(){this.doStop(this.currentOperationId)}doStop(t){this.currentOperationId===t&&this.currentOperationDisposables.clear()}}const D=l("editorProgressService");export{T as AsyncProgress,D as IEditorProgressService,P as IProgressService,k as LongRunningOperation,w as Progress,v as ProgressLocation,a as UnmanagedProgress,S as emptyProgressRunner};
