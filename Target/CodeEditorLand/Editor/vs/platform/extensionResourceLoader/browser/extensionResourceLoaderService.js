var S=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var l=(n,i,e,r)=>{for(var t=r>1?void 0:r?f(i,e):i,s=n.length-1,c;s>=0;s--)(c=n[s])&&(t=(r?c(i,e,t):c(t))||t);return r&&t&&S(i,e,t),t},o=(n,i)=>(e,r)=>i(e,r,n);import{FileAccess as v,Schemas as m}from"../../../../vs/base/common/network.js";import"../../../../vs/base/common/uri.js";import{IConfigurationService as I}from"../../../../vs/platform/configuration/common/configuration.js";import{IEnvironmentService as d}from"../../../../vs/platform/environment/common/environment.js";import{AbstractExtensionResourceLoaderService as p,IExtensionResourceLoaderService as u}from"../../../../vs/platform/extensionResourceLoader/common/extensionResourceLoader.js";import{IFileService as g}from"../../../../vs/platform/files/common/files.js";import{InstantiationType as h,registerSingleton as w}from"../../../../vs/platform/instantiation/common/extensions.js";import{ILogService as y}from"../../../../vs/platform/log/common/log.js";import{IProductService as R}from"../../../../vs/platform/product/common/productService.js";import{IStorageService as x}from"../../../../vs/platform/storage/common/storage.js";let a=class extends p{constructor(e,r,t,s,c,E){super(e,r,t,s,c);this._logService=E}async readExtensionResource(e){if(e=v.uriToBrowserUri(e),e.scheme!==m.http&&e.scheme!==m.https&&e.scheme!==m.data)return(await this._fileService.readFile(e)).value.toString();const r={};this.isExtensionGalleryResource(e)&&(r.headers=await this.getExtensionGalleryRequestHeaders(),r.mode="cors");const t=await fetch(e.toString(!0),r);if(t.status!==200)throw this._logService.info(`Request to '${e.toString(!0)}' failed with status code ${t.status}`),new Error(t.statusText);return t.text()}};a=l([o(0,g),o(1,x),o(2,R),o(3,d),o(4,I),o(5,y)],a),w(u,a,h.Delayed);
