var S=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var v=(a,o,i,e)=>{for(var t=e>1?void 0:e?u(o,i):o,n=a.length-1,l;n>=0;n--)(l=a[n])&&(t=(e?l(o,i,t):l(t))||t);return e&&t&&S(o,i,t),t},r=(a,o)=>(i,e)=>o(i,e,a);import{CancellationToken as f}from"../../../base/common/cancellation.js";import{IConfigurationService as h}from"../../configuration/common/configuration.js";import{IEnvironmentMainService as I}from"../../environment/electron-main/environmentMainService.js";import{ILifecycleMainService as y}from"../../lifecycle/electron-main/lifecycleMainService.js";import{ILogService as g}from"../../log/common/log.js";import{INativeHostMainService as U}from"../../native/electron-main/nativeHostMainService.js";import{IProductService as b}from"../../product/common/productService.js";import{IRequestService as A,asJson as M}from"../../request/common/request.js";import{ITelemetryService as w}from"../../telemetry/common/telemetry.js";import{State as s,UpdateType as d}from"../common/update.js";import{AbstractUpdateService as C,createUpdateURL as F}from"./abstractUpdateService.js";let c=class extends C{constructor(i,e,t,n,l,p,H,m){super(i,e,n,l,p,m);this.telemetryService=t;this.nativeHostMainService=H}buildUpdateFeedUrl(i){return F(`linux-${process.arch}`,i,this.productService)}doCheckForUpdates(i){this.url&&(this.setState(s.CheckingForUpdates(i)),this.requestService.request({url:this.url},f.None).then(M).then(e=>{!e||!e.url||!e.version||!e.productVersion?(this.telemetryService.publicLog2("update:notAvailable",{explicit:!!i}),this.setState(s.Idle(d.Archive))):this.setState(s.AvailableForDownload(e))}).then(void 0,e=>{this.logService.error(e);const t=i?e.message||e:void 0;this.setState(s.Idle(d.Archive,t))}))}async doDownloadUpdate(i){this.productService.downloadUrl&&this.productService.downloadUrl.length>0?this.nativeHostMainService.openExternal(void 0,this.productService.downloadUrl):i.update.url&&this.nativeHostMainService.openExternal(void 0,i.update.url),this.setState(s.Idle(d.Archive))}};c=v([r(0,y),r(1,h),r(2,w),r(3,I),r(4,A),r(5,g),r(6,U),r(7,b)],c);export{c as LinuxUpdateService};
