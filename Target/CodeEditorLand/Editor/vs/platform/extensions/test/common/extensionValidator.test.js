import r from"assert";import{ensureNoDisposablesAreLeakedInTestSuite as q}from"../../../../base/test/common/utils.js";import"../../common/extensions.js";import{areApiProposalsCompatible as x,isValidExtensionVersion as E,isValidVersion as m,isValidVersionStr as a,normalizeVersion as g,parseVersion as V}from"../../common/extensionValidator.js";suite("Extension Version Validator",()=>{q();const c="2021-05-11T21:54:30.577Z";test("isValidVersionStr",()=>{r.strictEqual(a("0.10.0-dev"),!0),r.strictEqual(a("0.10.0"),!0),r.strictEqual(a("0.10.1"),!0),r.strictEqual(a("0.10.100"),!0),r.strictEqual(a("0.11.0"),!0),r.strictEqual(a("x.x.x"),!0),r.strictEqual(a("0.x.x"),!0),r.strictEqual(a("0.10.0"),!0),r.strictEqual(a("0.10.x"),!0),r.strictEqual(a("^0.10.0"),!0),r.strictEqual(a("*"),!0),r.strictEqual(a("0.x.x.x"),!1),r.strictEqual(a("0.10"),!1),r.strictEqual(a("0.10."),!1)}),test("parseVersion",()=>{function e(u,t,s,l,f,o,n,v,i,d){const p=V(u),b={hasCaret:t,hasGreaterEquals:s,majorBase:l,majorMustEqual:f,minorBase:o,minorMustEqual:n,patchBase:v,patchMustEqual:i,preRelease:d};r.deepStrictEqual(p,b,"parseVersion for "+u)}e("0.10.0-dev",!1,!1,0,!0,10,!0,0,!0,"-dev"),e("0.10.0",!1,!1,0,!0,10,!0,0,!0,null),e("0.10.1",!1,!1,0,!0,10,!0,1,!0,null),e("0.10.100",!1,!1,0,!0,10,!0,100,!0,null),e("0.11.0",!1,!1,0,!0,11,!0,0,!0,null),e("x.x.x",!1,!1,0,!1,0,!1,0,!1,null),e("0.x.x",!1,!1,0,!0,0,!1,0,!1,null),e("0.10.x",!1,!1,0,!0,10,!0,0,!1,null),e("^0.10.0",!0,!1,0,!0,10,!0,0,!0,null),e("^0.10.2",!0,!1,0,!0,10,!0,2,!0,null),e("^1.10.2",!0,!1,1,!0,10,!0,2,!0,null),e("*",!1,!1,0,!1,0,!1,0,!1,null),e(">=0.0.1",!1,!0,0,!0,0,!0,1,!0,null),e(">=2.4.3",!1,!0,2,!0,4,!0,3,!0,null)}),test("normalizeVersion",()=>{function e(u,t,s,l,f,o,n,v,i=0){const d=g(V(u)),p={majorBase:t,majorMustEqual:s,minorBase:l,minorMustEqual:f,patchBase:o,patchMustEqual:n,isMinimum:v,notBefore:i};r.deepStrictEqual(d,p,"parseVersion for "+u)}e("0.10.0-dev",0,!0,10,!0,0,!0,!1,0),e("0.10.0-222222222",0,!0,10,!0,0,!0,!1,0),e("0.10.0-20210511",0,!0,10,!0,0,!0,!1,new Date("2021-05-11T00:00:00Z").getTime()),e("0.10.0",0,!0,10,!0,0,!0,!1),e("0.10.1",0,!0,10,!0,1,!0,!1),e("0.10.100",0,!0,10,!0,100,!0,!1),e("0.11.0",0,!0,11,!0,0,!0,!1),e("x.x.x",0,!1,0,!1,0,!1,!1),e("0.x.x",0,!0,0,!1,0,!1,!1),e("0.10.x",0,!0,10,!0,0,!1,!1),e("^0.10.0",0,!0,10,!0,0,!1,!1),e("^0.10.2",0,!0,10,!0,2,!1,!1),e("^1.10.2",1,!0,10,!1,2,!1,!1),e("*",0,!1,0,!1,0,!1,!1),e(">=0.0.1",0,!0,0,!0,1,!0,!0),e(">=2.4.3",2,!0,4,!0,3,!0,!0),e(">=2.4.3",2,!0,4,!0,3,!0,!0)}),test("isValidVersion",()=>{function e(u,t,s){const l=m(u,c,t);r.strictEqual(l,s,"extension - vscode: "+u+", desiredVersion: "+t+" should be "+s)}e("0.10.0-dev","x.x.x",!0),e("0.10.0-dev","0.x.x",!0),e("0.10.0-dev","0.10.0",!0),e("0.10.0-dev","0.10.2",!1),e("0.10.0-dev","^0.10.2",!1),e("0.10.0-dev","0.10.x",!0),e("0.10.0-dev","^0.10.0",!0),e("0.10.0-dev","*",!0),e("0.10.0-dev",">=0.0.1",!0),e("0.10.0-dev",">=0.0.10",!0),e("0.10.0-dev",">=0.10.0",!0),e("0.10.0-dev",">=0.10.1",!1),e("0.10.0-dev",">=1.0.0",!1),e("0.10.0","x.x.x",!0),e("0.10.0","0.x.x",!0),e("0.10.0","0.10.0",!0),e("0.10.0","0.10.2",!1),e("0.10.0","^0.10.2",!1),e("0.10.0","0.10.x",!0),e("0.10.0","^0.10.0",!0),e("0.10.0","*",!0),e("0.10.1","x.x.x",!0),e("0.10.1","0.x.x",!0),e("0.10.1","0.10.0",!1),e("0.10.1","0.10.2",!1),e("0.10.1","^0.10.2",!1),e("0.10.1","0.10.x",!0),e("0.10.1","^0.10.0",!0),e("0.10.1","*",!0),e("0.10.100","x.x.x",!0),e("0.10.100","0.x.x",!0),e("0.10.100","0.10.0",!1),e("0.10.100","0.10.2",!1),e("0.10.100","^0.10.2",!0),e("0.10.100","0.10.x",!0),e("0.10.100","^0.10.0",!0),e("0.10.100","*",!0),e("0.11.0","x.x.x",!0),e("0.11.0","0.x.x",!0),e("0.11.0","0.10.0",!1),e("0.11.0","0.10.2",!1),e("0.11.0","^0.10.2",!1),e("0.11.0","0.10.x",!1),e("0.11.0","^0.10.0",!1),e("0.11.0","*",!0),e("1.0.0","x.x.x",!0),e("1.0.0","0.x.x",!0),e("1.0.0","0.10.0",!1),e("1.0.0","0.10.2",!1),e("1.0.0","^0.10.2",!0),e("1.0.0","0.10.x",!0),e("1.0.0","^0.10.0",!0),e("1.0.0","1.0.0",!0),e("1.0.0","^1.0.0",!0),e("1.0.0","^2.0.0",!1),e("1.0.0","*",!0),e("1.0.0",">=0.0.1",!0),e("1.0.0",">=0.0.10",!0),e("1.0.0",">=0.10.0",!0),e("1.0.0",">=0.10.1",!0),e("1.0.0",">=1.0.0",!0),e("1.0.0",">=1.1.0",!1),e("1.0.0",">=1.0.1",!1),e("1.0.0",">=2.0.0",!1),e("1.0.100","x.x.x",!0),e("1.0.100","0.x.x",!0),e("1.0.100","0.10.0",!1),e("1.0.100","0.10.2",!1),e("1.0.100","^0.10.2",!0),e("1.0.100","0.10.x",!0),e("1.0.100","^0.10.0",!0),e("1.0.100","1.0.0",!1),e("1.0.100","^1.0.0",!0),e("1.0.100","^1.0.1",!0),e("1.0.100","^2.0.0",!1),e("1.0.100","*",!0),e("1.100.0","x.x.x",!0),e("1.100.0","0.x.x",!0),e("1.100.0","0.10.0",!1),e("1.100.0","0.10.2",!1),e("1.100.0","^0.10.2",!0),e("1.100.0","0.10.x",!0),e("1.100.0","^0.10.0",!0),e("1.100.0","1.0.0",!1),e("1.100.0","^1.0.0",!0),e("1.100.0","^1.1.0",!0),e("1.100.0","^1.100.0",!0),e("1.100.0","^2.0.0",!1),e("1.100.0","*",!0),e("1.100.0",">=1.99.0",!0),e("1.100.0",">=1.100.0",!0),e("1.100.0",">=1.101.0",!1),e("2.0.0","x.x.x",!0),e("2.0.0","0.x.x",!1),e("2.0.0","0.10.0",!1),e("2.0.0","0.10.2",!1),e("2.0.0","^0.10.2",!1),e("2.0.0","0.10.x",!1),e("2.0.0","^0.10.0",!1),e("2.0.0","1.0.0",!1),e("2.0.0","^1.0.0",!1),e("2.0.0","^1.1.0",!1),e("2.0.0","^1.100.0",!1),e("2.0.0","^2.0.0",!0),e("2.0.0","*",!0)}),test("isValidExtensionVersion",()=>{function e(l,f,o,n,v){const i={name:"test",publisher:"test",version:"0.0.0",engines:{vscode:f},main:n?"something":void 0},d=[],p=E(l,c,i,o,d);r.strictEqual(p,v,"version: "+l+", desiredVersion: "+f+", desc: "+JSON.stringify(i)+", reasons: "+JSON.stringify(d))}function u(l,f,o,n){e(l,f,o,n,!1)}function t(l,f,o,n){e(l,f,o,n,!0)}function s(l,f,o){e(l,f,!1,!0,o)}t("0.10.0-dev","*",!0,!0),t("0.10.0-dev","x.x.x",!0,!0),t("0.10.0-dev","0.x.x",!0,!0),t("0.10.0-dev","0.10.x",!0,!0),t("1.10.0-dev","1.x.x",!0,!0),t("1.10.0-dev","1.10.x",!0,!0),t("0.10.0-dev","*",!0,!1),t("0.10.0-dev","x.x.x",!0,!1),t("0.10.0-dev","0.x.x",!0,!1),t("0.10.0-dev","0.10.x",!0,!1),t("1.10.0-dev","1.x.x",!0,!1),t("1.10.0-dev","1.10.x",!0,!1),u("0.10.0-dev","*",!1,!0),u("0.10.0-dev","x.x.x",!1,!0),u("0.10.0-dev","0.x.x",!1,!0),t("0.10.0-dev","0.10.x",!1,!0),t("1.10.0-dev","1.x.x",!1,!0),t("1.10.0-dev","1.10.x",!1,!0),t("0.10.0-dev","*",!1,!1),t("0.10.0-dev","x.x.x",!1,!1),t("0.10.0-dev","0.x.x",!1,!1),t("0.10.0-dev","0.10.x",!1,!1),t("1.10.0-dev","1.x.x",!1,!1),t("1.10.0-dev","1.10.x",!1,!1),t("0.10.0-dev",">=0.9.1-pre.1",!1,!1),t("0.10.0-dev","*",!1,!1),t("0.10.0-dev","x.x.x",!1,!1),t("0.10.0-dev","0.x.x",!1,!1),t("0.10.0-dev","0.10.x",!1,!1),t("1.10.0-dev","1.x.x",!1,!1),t("1.10.0-dev","1.10.x",!1,!1),t("0.10.0-dev","*",!1,!1),t("0.10.0-dev","x.x.x",!1,!1),t("0.10.0-dev","0.x.x",!1,!1),t("0.10.0-dev","0.10.x",!1,!1),t("1.10.0-dev","1.x.x",!1,!1),t("1.10.0-dev","1.10.x",!1,!1),s("0.10.0-dev","x.x.x",!1),s("0.10.0-dev","0.x.x",!1),s("0.10.0-dev","0.10.0",!0),s("0.10.0-dev","0.10.2",!1),s("0.10.0-dev","^0.10.2",!1),s("0.10.0-dev","0.10.x",!0),s("0.10.0-dev","^0.10.0",!0),s("0.10.0-dev","*",!1),s("0.10.0","x.x.x",!1),s("0.10.0","0.x.x",!1),s("0.10.0","0.10.0",!0),s("0.10.0","0.10.2",!1),s("0.10.0","^0.10.2",!1),s("0.10.0","0.10.x",!0),s("0.10.0","^0.10.0",!0),s("0.10.0","*",!1),s("0.10.1","x.x.x",!1),s("0.10.1","0.x.x",!1),s("0.10.1","0.10.0",!1),s("0.10.1","0.10.2",!1),s("0.10.1","^0.10.2",!1),s("0.10.1","0.10.x",!0),s("0.10.1","^0.10.0",!0),s("0.10.1","*",!1),s("0.10.100","x.x.x",!1),s("0.10.100","0.x.x",!1),s("0.10.100","0.10.0",!1),s("0.10.100","0.10.2",!1),s("0.10.100","^0.10.2",!0),s("0.10.100","0.10.x",!0),s("0.10.100","^0.10.0",!0),s("0.10.100","*",!1),s("0.11.0","x.x.x",!1),s("0.11.0","0.x.x",!1),s("0.11.0","0.10.0",!1),s("0.11.0","0.10.2",!1),s("0.11.0","^0.10.2",!1),s("0.11.0","0.10.x",!1),s("0.11.0","^0.10.0",!1),s("0.11.0","*",!1),s("1.0.0","x.x.x",!1),s("1.0.0","0.x.x",!1),s("1.0.0","0.10.0",!1),s("1.0.0","0.10.2",!1),s("1.0.0","^0.10.2",!0),s("1.0.0","0.10.x",!0),s("1.0.0","^0.10.0",!0),s("1.0.0","*",!1),s("1.10.0","x.x.x",!1),s("1.10.0","1.x.x",!0),s("1.10.0","1.10.0",!0),s("1.10.0","1.10.2",!1),s("1.10.0","^1.10.2",!1),s("1.10.0","1.10.x",!0),s("1.10.0","^1.10.0",!0),s("1.10.0","*",!1),s("1.0.0","x.x.x",!1),s("1.0.0","0.x.x",!1),s("1.0.0","0.10.0",!1),s("1.0.0","0.10.2",!1),s("1.0.0","^0.10.2",!0),s("1.0.0","0.10.x",!0),s("1.0.0","^0.10.0",!0),s("1.0.0","1.0.0",!0),s("1.0.0","^1.0.0",!0),s("1.0.0","^2.0.0",!1),s("1.0.0","*",!1),s("1.0.100","x.x.x",!1),s("1.0.100","0.x.x",!1),s("1.0.100","0.10.0",!1),s("1.0.100","0.10.2",!1),s("1.0.100","^0.10.2",!0),s("1.0.100","0.10.x",!0),s("1.0.100","^0.10.0",!0),s("1.0.100","1.0.0",!1),s("1.0.100","^1.0.0",!0),s("1.0.100","^1.0.1",!0),s("1.0.100","^2.0.0",!1),s("1.0.100","*",!1),s("1.100.0","x.x.x",!1),s("1.100.0","0.x.x",!1),s("1.100.0","0.10.0",!1),s("1.100.0","0.10.2",!1),s("1.100.0","^0.10.2",!0),s("1.100.0","0.10.x",!0),s("1.100.0","^0.10.0",!0),s("1.100.0","1.0.0",!1),s("1.100.0","^1.0.0",!0),s("1.100.0","^1.1.0",!0),s("1.100.0","^1.100.0",!0),s("1.100.0","^2.0.0",!1),s("1.100.0","*",!1),s("2.0.0","x.x.x",!1),s("2.0.0","0.x.x",!1),s("2.0.0","0.10.0",!1),s("2.0.0","0.10.2",!1),s("2.0.0","^0.10.2",!1),s("2.0.0","0.10.x",!1),s("2.0.0","^0.10.0",!1),s("2.0.0","1.0.0",!1),s("2.0.0","^1.0.0",!1),s("2.0.0","^1.1.0",!1),s("2.0.0","^1.100.0",!1),s("2.0.0","^2.0.0",!0),s("2.0.0","*",!1),s("1.10.0","^1.10.0-20210511",!0),s("1.10.0","^1.10.0-20210510",!0),s("1.10.0","^1.10.0-20210512",!1),s("1.10.1","^1.10.0-20200101",!0),s("1.11.0","^1.10.0-20200101",!0)}),test("isValidExtensionVersion checks browser only extensions",()=>{const e={name:"test",publisher:"test",version:"0.0.0",engines:{vscode:"^1.45.0"},browser:"something"};r.strictEqual(E("1.44.0",void 0,e,!1,[]),!1)}),test("areApiProposalsCompatible",()=>{r.strictEqual(x([]),!0),r.strictEqual(x([],["hello"]),!0),r.strictEqual(x([],{}),!0),r.strictEqual(x(["proposal1"],{}),!0),r.strictEqual(x(["proposal1"],{proposal1:{proposal:""}}),!0),r.strictEqual(x(["proposal1"],{proposal1:{proposal:"",version:1}}),!0),r.strictEqual(x(["proposal1@1"],{proposal1:{proposal:"",version:1}}),!0),r.strictEqual(x(["proposal1"],{proposal2:{proposal:""}}),!0),r.strictEqual(x(["proposal1","proposal2"],{}),!0),r.strictEqual(x(["proposal1","proposal2"],{proposal1:{proposal:""}}),!0),r.strictEqual(x(["proposal1@1"],{proposal1:{proposal:"",version:2}}),!1),r.strictEqual(x(["proposal1@1"],{proposal1:{proposal:""}}),!1)})});
