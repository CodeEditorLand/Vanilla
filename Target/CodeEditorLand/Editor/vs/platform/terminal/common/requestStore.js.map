{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/terminal/common/requestStore.ts"],
  "sourcesContent": ["import { CancellationTokenSource } from \"../../../base/common/cancellation.js\";\nimport { Emitter } from \"../../../base/common/event.js\";\nimport {\n\tDisposable,\n\ttype IDisposable,\n\tdispose,\n\ttoDisposable,\n} from \"../../../base/common/lifecycle.js\";\nimport { ILogService } from \"../../log/common/log.js\";\n\n/**\n * A helper class to track requests that have replies. Using this it's easy to implement an event\n * that accepts a reply.\n */\nexport class RequestStore<T, RequestArgs> extends Disposable {\n\tprivate _lastRequestId = 0;\n\tprivate readonly _timeout: number;\n\tprivate _pendingRequests: Map<number, (resolved: T) => void> = new Map();\n\tprivate _pendingRequestDisposables: Map<number, IDisposable[]> = new Map();\n\n\tprivate readonly _onCreateRequest = this._register(\n\t\tnew Emitter<RequestArgs & { requestId: number }>(),\n\t);\n\treadonly onCreateRequest = this._onCreateRequest.event;\n\n\t/**\n\t * @param timeout How long in ms to allow requests to go unanswered for, undefined will use the\n\t * default (15 seconds).\n\t */\n\tconstructor(\n\t\ttimeout: number | undefined,\n\t\t@ILogService private readonly _logService: ILogService,\n\t) {\n\t\tsuper();\n\t\tthis._timeout = timeout === undefined ? 15000 : timeout;\n\t\tthis._register(\n\t\t\ttoDisposable(() => {\n\t\t\t\tfor (const d of this._pendingRequestDisposables.values()) {\n\t\t\t\t\tdispose(d);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\t/**\n\t * Creates a request.\n\t * @param args The arguments to pass to the onCreateRequest event.\n\t */\n\tcreateRequest(args: RequestArgs): Promise<T> {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tconst requestId = ++this._lastRequestId;\n\t\t\tthis._pendingRequests.set(requestId, resolve);\n\t\t\tthis._onCreateRequest.fire({ requestId, ...args });\n\t\t\tconst tokenSource = new CancellationTokenSource();\n\t\t\ttimeout(this._timeout, tokenSource.token).then(() =>\n\t\t\t\treject(`Request ${requestId} timed out (${this._timeout}ms)`),\n\t\t\t);\n\t\t\tthis._pendingRequestDisposables.set(requestId, [\n\t\t\t\ttoDisposable(() => tokenSource.cancel()),\n\t\t\t]);\n\t\t});\n\t}\n\n\t/**\n\t * Accept a reply to a request.\n\t * @param requestId The request ID originating from the onCreateRequest event.\n\t * @param data The reply data.\n\t */\n\tacceptReply(requestId: number, data: T) {\n\t\tconst resolveRequest = this._pendingRequests.get(requestId);\n\t\tif (resolveRequest) {\n\t\t\tthis._pendingRequests.delete(requestId);\n\t\t\tdispose(this._pendingRequestDisposables.get(requestId) || []);\n\t\t\tthis._pendingRequestDisposables.delete(requestId);\n\t\t\tresolveRequest(data);\n\t\t} else {\n\t\t\tthis._logService.warn(\n\t\t\t\t`RequestStore#acceptReply was called without receiving a matching request ${requestId}`,\n\t\t\t);\n\t\t}\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAAA,SAAS,+BAA+B;AACxC,SAAS,eAAe;AACxB;AAAA,EACC;AAAA,EAEA;AAAA,EACA;AAAA,OACM;AACP,SAAS,mBAAmB;AAMrB,IAAM,eAAN,cAA2C,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,EAe5D,YACCA,UAC8B,aAC7B;AACD,UAAM;AAFwB;AAG9B,SAAK,WAAWA,aAAY,SAAY,OAAQA;AAChD,SAAK;AAAA,MACJ,aAAa,MAAM;AAClB,mBAAW,KAAK,KAAK,2BAA2B,OAAO,GAAG;AACzD,kBAAQ,CAAC;AAAA,QACV;AAAA,MACD,CAAC;AAAA,IACF;AAAA,EACD;AAAA,EA1CD,OAc6D;AAAA;AAAA;AAAA,EACpD,iBAAiB;AAAA,EACR;AAAA,EACT,mBAAuD,oBAAI,IAAI;AAAA,EAC/D,6BAAyD,oBAAI,IAAI;AAAA,EAExD,mBAAmB,KAAK;AAAA,IACxC,IAAI,QAA6C;AAAA,EAClD;AAAA,EACS,kBAAkB,KAAK,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,EAyBjD,cAAc,MAA+B;AAC5C,WAAO,IAAI,QAAW,CAAC,SAAS,WAAW;AAC1C,YAAM,YAAY,EAAE,KAAK;AACzB,WAAK,iBAAiB,IAAI,WAAW,OAAO;AAC5C,WAAK,iBAAiB,KAAK,EAAE,WAAW,GAAG,KAAK,CAAC;AACjD,YAAM,cAAc,IAAI,wBAAwB;AAChD,cAAQ,KAAK,UAAU,YAAY,KAAK,EAAE;AAAA,QAAK,MAC9C,OAAO,WAAW,SAAS,eAAe,KAAK,QAAQ,KAAK;AAAA,MAC7D;AACA,WAAK,2BAA2B,IAAI,WAAW;AAAA,QAC9C,aAAa,MAAM,YAAY,OAAO,CAAC;AAAA,MACxC,CAAC;AAAA,IACF,CAAC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,WAAmB,MAAS;AACvC,UAAM,iBAAiB,KAAK,iBAAiB,IAAI,SAAS;AAC1D,QAAI,gBAAgB;AACnB,WAAK,iBAAiB,OAAO,SAAS;AACtC,cAAQ,KAAK,2BAA2B,IAAI,SAAS,KAAK,CAAC,CAAC;AAC5D,WAAK,2BAA2B,OAAO,SAAS;AAChD,qBAAe,IAAI;AAAA,IACpB,OAAO;AACN,WAAK,YAAY;AAAA,QAChB,4EAA4E,SAAS;AAAA,MACtF;AAAA,IACD;AAAA,EACD;AACD;AAnEa,eAAN;AAAA,EAiBJ;AAAA,GAjBU;",
  "names": ["timeout"]
}
