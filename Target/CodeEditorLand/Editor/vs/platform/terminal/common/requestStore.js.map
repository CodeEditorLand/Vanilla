{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/terminal/common/requestStore.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { timeout } from '../../../base/common/async.js';\nimport { CancellationTokenSource } from '../../../base/common/cancellation.js';\nimport { Emitter } from '../../../base/common/event.js';\nimport { Disposable, dispose, IDisposable, toDisposable } from '../../../base/common/lifecycle.js';\nimport { ILogService } from '../../log/common/log.js';\n\n/**\n * A helper class to track requests that have replies. Using this it's easy to implement an event\n * that accepts a reply.\n */\nexport class RequestStore<T, RequestArgs> extends Disposable {\n\tprivate _lastRequestId = 0;\n\tprivate readonly _timeout: number;\n\tprivate _pendingRequests: Map<number, (resolved: T) => void> = new Map();\n\tprivate _pendingRequestDisposables: Map<number, IDisposable[]> = new Map();\n\n\tprivate readonly _onCreateRequest = this._register(new Emitter<RequestArgs & { requestId: number }>());\n\treadonly onCreateRequest = this._onCreateRequest.event;\n\n\t/**\n\t * @param timeout How long in ms to allow requests to go unanswered for, undefined will use the\n\t * default (15 seconds).\n\t */\n\tconstructor(\n\t\ttimeout: number | undefined,\n\t\t@ILogService private readonly _logService: ILogService\n\t) {\n\t\tsuper();\n\t\tthis._timeout = timeout === undefined ? 15000 : timeout;\n\t\tthis._register(toDisposable(() => {\n\t\t\tfor (const d of this._pendingRequestDisposables.values()) {\n\t\t\t\tdispose(d);\n\t\t\t}\n\t\t}));\n\t}\n\n\t/**\n\t * Creates a request.\n\t * @param args The arguments to pass to the onCreateRequest event.\n\t */\n\tcreateRequest(args: RequestArgs): Promise<T> {\n\t\treturn new Promise<T>((resolve, reject) => {\n\t\t\tconst requestId = ++this._lastRequestId;\n\t\t\tthis._pendingRequests.set(requestId, resolve);\n\t\t\tthis._onCreateRequest.fire({ requestId, ...args });\n\t\t\tconst tokenSource = new CancellationTokenSource();\n\t\t\ttimeout(this._timeout, tokenSource.token).then(() => reject(`Request ${requestId} timed out (${this._timeout}ms)`));\n\t\t\tthis._pendingRequestDisposables.set(requestId, [toDisposable(() => tokenSource.cancel())]);\n\t\t});\n\t}\n\n\t/**\n\t * Accept a reply to a request.\n\t * @param requestId The request ID originating from the onCreateRequest event.\n\t * @param data The reply data.\n\t */\n\tacceptReply(requestId: number, data: T) {\n\t\tconst resolveRequest = this._pendingRequests.get(requestId);\n\t\tif (resolveRequest) {\n\t\t\tthis._pendingRequests.delete(requestId);\n\t\t\tdispose(this._pendingRequestDisposables.get(requestId) || []);\n\t\t\tthis._pendingRequestDisposables.delete(requestId);\n\t\t\tresolveRequest(data);\n\t\t} else {\n\t\t\tthis._logService.warn(`RequestStore#acceptReply was called without receiving a matching request ${requestId}`);\n\t\t}\n\t}\n}\n"],
  "mappings": ";;;;;;;;;;;;AAKA,SAAS,eAAe;AACxB,SAAS,+BAA+B;AACxC,SAAS,eAAe;AACxB,SAAS,YAAY,SAAS,aAAa,oBAAoB;AAC/D,SAAS,mBAAmB;AAMrB,IAAM,eAAN,cAA2C,WAAW;AAAA;AAAA;AAAA;AAAA;AAAA,EAa5D,YACCA,UAC8B,aAC7B;AACD,UAAM;AAFwB;AAG9B,SAAK,WAAWA,aAAY,SAAY,OAAQA;AAChD,SAAK,UAAU,aAAa,MAAM;AACjC,iBAAW,KAAK,KAAK,2BAA2B,OAAO,GAAG;AACzD,gBAAQ,CAAC;AAAA,MACV;AAAA,IACD,CAAC,CAAC;AAAA,EACH;AAAA,EAvCD,OAe6D;AAAA;AAAA;AAAA,EACpD,iBAAiB;AAAA,EACR;AAAA,EACT,mBAAuD,oBAAI,IAAI;AAAA,EAC/D,6BAAyD,oBAAI,IAAI;AAAA,EAExD,mBAAmB,KAAK,UAAU,IAAI,QAA6C,CAAC;AAAA,EAC5F,kBAAkB,KAAK,iBAAiB;AAAA;AAAA;AAAA;AAAA;AAAA,EAuBjD,cAAc,MAA+B;AAC5C,WAAO,IAAI,QAAW,CAAC,SAAS,WAAW;AAC1C,YAAM,YAAY,EAAE,KAAK;AACzB,WAAK,iBAAiB,IAAI,WAAW,OAAO;AAC5C,WAAK,iBAAiB,KAAK,EAAE,WAAW,GAAG,KAAK,CAAC;AACjD,YAAM,cAAc,IAAI,wBAAwB;AAChD,cAAQ,KAAK,UAAU,YAAY,KAAK,EAAE,KAAK,MAAM,OAAO,WAAW,SAAS,eAAe,KAAK,QAAQ,KAAK,CAAC;AAClH,WAAK,2BAA2B,IAAI,WAAW,CAAC,aAAa,MAAM,YAAY,OAAO,CAAC,CAAC,CAAC;AAAA,IAC1F,CAAC;AAAA,EACF;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAOA,YAAY,WAAmB,MAAS;AACvC,UAAM,iBAAiB,KAAK,iBAAiB,IAAI,SAAS;AAC1D,QAAI,gBAAgB;AACnB,WAAK,iBAAiB,OAAO,SAAS;AACtC,cAAQ,KAAK,2BAA2B,IAAI,SAAS,KAAK,CAAC,CAAC;AAC5D,WAAK,2BAA2B,OAAO,SAAS;AAChD,qBAAe,IAAI;AAAA,IACpB,OAAO;AACN,WAAK,YAAY,KAAK,4EAA4E,SAAS,EAAE;AAAA,IAC9G;AAAA,EACD;AACD;AAzDa,eAAN;AAAA,EAeJ;AAAA,GAfU;",
  "names": ["timeout"]
}
