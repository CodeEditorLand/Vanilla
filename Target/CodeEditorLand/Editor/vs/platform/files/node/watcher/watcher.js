import{Disposable as a}from"../../../../base/common/lifecycle.js";import{Emitter as o,Event as s}from"../../../../base/common/event.js";import{ParcelWatcher as n}from"./parcel/parcelWatcher.js";import{NodeJSWatcher as c}from"./nodejs/nodejsWatcher.js";import{Promises as i}from"../../../../base/common/async.js";import{computeStats as h}from"./watcherStats.js";class w extends a{recursiveWatcher=this._register(new n);nonRecursiveWatcher=this._register(new c(this.recursiveWatcher));onDidChangeFile=s.any(this.recursiveWatcher.onDidChangeFile,this.nonRecursiveWatcher.onDidChangeFile);onDidError=s.any(this.recursiveWatcher.onDidError,this.nonRecursiveWatcher.onDidError);_onDidLogMessage=this._register(new o);onDidLogMessage=s.any(this._onDidLogMessage.event,this.recursiveWatcher.onDidLogMessage,this.nonRecursiveWatcher.onDidLogMessage);requests=[];async watch(e){this.requests=e;let t;try{await this.recursiveWatcher.watch(e.filter(r=>r.recursive))}catch(r){t=r}try{await this.nonRecursiveWatcher.watch(e.filter(r=>!r.recursive))}catch(r){t||(t=r)}if(t)throw t}async setVerboseLogging(e){e&&this.requests.length>0&&this._onDidLogMessage.fire({type:"trace",message:h(this.requests,this.recursiveWatcher,this.nonRecursiveWatcher)}),await i.settled([this.recursiveWatcher.setVerboseLogging(e),this.nonRecursiveWatcher.setVerboseLogging(e)])}async stop(){await i.settled([this.recursiveWatcher.stop(),this.nonRecursiveWatcher.stop()])}}export{w as UniversalWatcher};
