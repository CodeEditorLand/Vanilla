import{Lazy as I}from"../../../base/common/lazy.js";import{Schemas as y}from"../../../base/common/network.js";import{sep as f}from"../../../base/common/path.js";import{isWeb as v}from"../../../base/common/platform.js";import{startsWithIgnoreCase as R}from"../../../base/common/strings.js";import{TernarySearchTree as u}from"../../../base/common/ternarySearchTree.js";import{isNumber as O}from"../../../base/common/types.js";import{URI as b}from"../../../base/common/uri.js";import{localize as c}from"../../../nls.js";import{createDecorator as S}from"../../instantiation/common/instantiation.js";const H=S("fileService");function K(r){return r.create===!0}var h=(n=>(n[n.Unknown=0]="Unknown",n[n.File=1]="File",n[n.Directory=2]="Directory",n[n.SymbolicLink=64]="SymbolicLink",n))(h||{}),x=(o=>(o[o.Readonly=1]="Readonly",o[o.Locked=2]="Locked",o))(x||{}),C=(t=>(t[t.UPDATED=2]="UPDATED",t[t.ADDED=4]="ADDED",t[t.DELETED=8]="DELETED",t))(C||{});function Q(r){const e=r;return!!e&&typeof e.onDidChange=="function"}var P=(i=>(i[i.None=0]="None",i[i.FileReadWrite=2]="FileReadWrite",i[i.FileOpenReadWriteClose=4]="FileOpenReadWriteClose",i[i.FileReadStream=16]="FileReadStream",i[i.FileFolderCopy=8]="FileFolderCopy",i[i.PathCaseSensitive=1024]="PathCaseSensitive",i[i.Readonly=2048]="Readonly",i[i.Trash=4096]="Trash",i[i.FileWriteUnlock=8192]="FileWriteUnlock",i[i.FileAtomicRead=16384]="FileAtomicRead",i[i.FileAtomicWrite=32768]="FileAtomicWrite",i[i.FileAtomicDelete=65536]="FileAtomicDelete",i[i.FileClone=131072]="FileClone",i))(P||{});function E(r){return!!(r.capabilities&2)}function $(r){return!!(r.capabilities&8)}function q(r){return!!(r.capabilities&131072)}function J(r){return!!(r.capabilities&4)}function Z(r){return!!(r.capabilities&16)}function z(r){return E(r)?!!(r.capabilities&16384):!1}function ee(r){return E(r)?!!(r.capabilities&32768):!1}function re(r){return!!(r.capabilities&65536)}function te(r){return!!(r.capabilities&2048)}var g=(d=>(d.FileExists="EntryExists",d.FileNotFound="EntryNotFound",d.FileNotADirectory="EntryNotADirectory",d.FileIsADirectory="EntryIsADirectory",d.FileExceedsStorageQuota="EntryExceedsStorageQuota",d.FileTooLarge="EntryTooLarge",d.FileWriteLocked="EntryWriteLocked",d.NoPermissions="NoPermissions",d.Unavailable="Unavailable",d.Unknown="Unknown",d))(g||{});class p extends Error{constructor(o,t){super(o);this.code=t}static create(o,t){const n=new p(o.toString(),t);return D(n,t),n}}function U(r,e){return p.create(r,e)}function oe(r){return r||U(c("unknownError","Unknown Error"),"Unknown")}function D(r,e){return r.name=e?`${e} (FileSystemError)`:"FileSystemError",r}function W(r){if(!r)return"Unknown";if(r instanceof p)return r.code;const e=/^(.+) \(FileSystemError\)$/.exec(r.name);if(!e)return"Unknown";switch(e[1]){case"EntryExists":return"EntryExists";case"EntryIsADirectory":return"EntryIsADirectory";case"EntryNotADirectory":return"EntryNotADirectory";case"EntryNotFound":return"EntryNotFound";case"EntryTooLarge":return"EntryTooLarge";case"EntryWriteLocked":return"EntryWriteLocked";case"NoPermissions":return"NoPermissions";case"Unavailable":return"Unavailable"}return"Unknown"}function ie(r){if(r instanceof F)return r.fileOperationResult;switch(W(r)){case"EntryNotFound":return 1;case"EntryIsADirectory":return 0;case"EntryNotADirectory":return 9;case"EntryWriteLocked":return 5;case"NoPermissions":return 6;case"EntryExists":return 4;case"EntryTooLarge":return 7;default:return 10}}var A=(l=>(l[l.CREATE=0]="CREATE",l[l.DELETE=1]="DELETE",l[l.MOVE=2]="MOVE",l[l.COPY=3]="COPY",l[l.WRITE=4]="WRITE",l))(A||{});class ne{constructor(e,o,t){this.resource=e;this.operation=o;this.target=t}isOperation(e){return this.operation===e}}var L=(t=>(t[t.UPDATED=0]="UPDATED",t[t.ADDED=1]="ADDED",t[t.DELETED=2]="DELETED",t))(L||{});class m{constructor(e,o){this.ignorePathCasing=o;for(const t of e){switch(t.type){case 1:this.rawAdded.push(t.resource);break;case 0:this.rawUpdated.push(t.resource);break;case 2:this.rawDeleted.push(t.resource);break}this.correlationId!==m.MIXED_CORRELATION&&(typeof t.cId=="number"?this.correlationId===void 0?this.correlationId=t.cId:this.correlationId!==t.cId&&(this.correlationId=m.MIXED_CORRELATION):this.correlationId!==void 0&&(this.correlationId=m.MIXED_CORRELATION))}}static MIXED_CORRELATION=null;correlationId=void 0;added=new I(()=>{const e=u.forUris(()=>this.ignorePathCasing);return e.fill(this.rawAdded.map(o=>[o,!0])),e});updated=new I(()=>{const e=u.forUris(()=>this.ignorePathCasing);return e.fill(this.rawUpdated.map(o=>[o,!0])),e});deleted=new I(()=>{const e=u.forUris(()=>this.ignorePathCasing);return e.fill(this.rawDeleted.map(o=>[o,!0])),e});contains(e,...o){return this.doContains(e,{includeChildren:!1},...o)}affects(e,...o){return this.doContains(e,{includeChildren:!0},...o)}doContains(e,o,...t){if(!e)return!1;const n=t.length>0;return!!((!n||t.includes(1))&&(this.added.value.get(e)||o.includeChildren&&this.added.value.findSuperstr(e))||(!n||t.includes(0))&&(this.updated.value.get(e)||o.includeChildren&&this.updated.value.findSuperstr(e))||(!n||t.includes(2))&&(this.deleted.value.findSubstr(e)||o.includeChildren&&this.deleted.value.findSuperstr(e)))}gotAdded(){return this.rawAdded.length>0}gotDeleted(){return this.rawDeleted.length>0}gotUpdated(){return this.rawUpdated.length>0}correlates(e){return this.correlationId===e}hasCorrelation(){return typeof this.correlationId=="number"}rawAdded=[];rawUpdated=[];rawDeleted=[]}function ae(r,e,o){return!r||!e||r===e||e.length>r.length?!1:(e.charAt(e.length-1)!==f&&(e+=f),o?R(r,e):r.indexOf(e)===0)}class F extends Error{constructor(o,t,n){super(o);this.fileOperationResult=t;this.options=n}}class se extends F{constructor(o,t,n,l){super(o,t,l);this.fileOperationResult=t;this.size=n}}class le extends F{constructor(o,t,n){super(o,2,n);this.stat=t}}var T=(a=>(a[a.FILE_IS_DIRECTORY=0]="FILE_IS_DIRECTORY",a[a.FILE_NOT_FOUND=1]="FILE_NOT_FOUND",a[a.FILE_NOT_MODIFIED_SINCE=2]="FILE_NOT_MODIFIED_SINCE",a[a.FILE_MODIFIED_SINCE=3]="FILE_MODIFIED_SINCE",a[a.FILE_MOVE_CONFLICT=4]="FILE_MOVE_CONFLICT",a[a.FILE_WRITE_LOCKED=5]="FILE_WRITE_LOCKED",a[a.FILE_PERMISSION_DENIED=6]="FILE_PERMISSION_DENIED",a[a.FILE_TOO_LARGE=7]="FILE_TOO_LARGE",a[a.FILE_INVALID_PATH=8]="FILE_INVALID_PATH",a[a.FILE_NOT_DIRECTORY=9]="FILE_NOT_DIRECTORY",a[a.FILE_OTHER_ERROR=10]="FILE_OTHER_ERROR",a))(T||{});const de={OFF:"off",AFTER_DELAY:"afterDelay",ON_FOCUS_CHANGE:"onFocusChange",ON_WINDOW_CHANGE:"onWindowChange"},ce={OFF:"off",ON_EXIT:"onExit",ON_EXIT_AND_WINDOW_CLOSE:"onExitAndWindowClose"},me="files.associations",pe="files.exclude",Ie="files.readonlyInclude",ue="files.readonlyExclude",Fe="files.readonlyFromPermissions";var N=(t=>(t[t.FILE=0]="FILE",t[t.FOLDER=1]="FOLDER",t[t.ROOT_FOLDER=2]="ROOT_FOLDER",t))(N||{});const ye="";function fe(r){if(!(typeof r.size!="number"||typeof r.mtime!="number"))return r.mtime.toString(29)+r.size.toString(31)}async function Ee(r,e){if(!e.hasProvider(b.from({scheme:r.scheme})))return new Promise(o=>{const t=e.onDidChangeFileSystemProviderRegistrations(n=>{n.scheme===r.scheme&&n.added&&(t.dispose(),o())})})}class s{static KB=1024;static MB=s.KB*s.KB;static GB=s.MB*s.KB;static TB=s.GB*s.KB;static formatSize(e){return O(e)||(e=0),e<s.KB?c("sizeB","{0}B",e.toFixed(0)):e<s.MB?c("sizeKB","{0}KB",(e/s.KB).toFixed(2)):e<s.GB?c("sizeMB","{0}MB",(e/s.MB).toFixed(2)):e<s.TB?c("sizeGB","{0}GB",(e/s.GB).toFixed(2)):c("sizeTB","{0}TB",(e/s.TB).toFixed(2))}}function ve(r){const e=typeof r=="string"||r?.scheme===y.vscodeRemote;return typeof r!="string"&&r?.scheme===y.file?1024*s.MB:e?10*s.MB:v?50*s.MB:1024*s.MB}export{de as AutoSaveConfiguration,s as ByteSize,ye as ETAG_DISABLED,me as FILES_ASSOCIATIONS_CONFIG,pe as FILES_EXCLUDE_CONFIG,ue as FILES_READONLY_EXCLUDE_CONFIG,Fe as FILES_READONLY_FROM_PERMISSIONS_CONFIG,Ie as FILES_READONLY_INCLUDE_CONFIG,C as FileChangeFilter,L as FileChangeType,m as FileChangesEvent,N as FileKind,A as FileOperation,F as FileOperationError,ne as FileOperationEvent,T as FileOperationResult,x as FilePermission,P as FileSystemProviderCapabilities,p as FileSystemProviderError,g as FileSystemProviderErrorCode,h as FileType,ce as HotExitConfiguration,H as IFileService,le as NotModifiedSinceFileOperationError,se as TooLargeFileOperationError,U as createFileSystemProviderError,oe as ensureFileSystemProviderError,fe as etag,ve as getLargeFileConfirmationLimit,re as hasFileAtomicDeleteCapability,z as hasFileAtomicReadCapability,ee as hasFileAtomicWriteCapability,q as hasFileCloneCapability,$ as hasFileFolderCopyCapability,Z as hasFileReadStreamCapability,J as hasOpenReadWriteCloseCapability,E as hasReadWriteCapability,te as hasReadonlyCapability,K as isFileOpenForWriteOptions,Q as isFileSystemWatcher,ae as isParent,D as markAsFileSystemProviderError,ie as toFileOperationResult,W as toFileSystemProviderErrorCode,Ee as whenProviderRegistered};
