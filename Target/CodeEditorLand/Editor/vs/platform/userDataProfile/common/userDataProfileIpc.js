import{Emitter as h,Event as d}from"../../../base/common/event.js";import{Disposable as P}from"../../../base/common/lifecycle.js";import{transformIncomingURIs as c,transformOutgoingURIs as a}from"../../../base/common/uriIpc.js";import{reviveProfile as o}from"./userDataProfile.js";class u{constructor(n,r){this.service=n;this.getUriTransformer=r}listen(n,r){const i=this.getUriTransformer(n);switch(r){case"onDidChangeProfiles":return d.map(this.service.onDidChangeProfiles,s=>({all:s.all.map(e=>a({...e},i)),added:s.added.map(e=>a({...e},i)),removed:s.removed.map(e=>a({...e},i)),updated:s.updated.map(e=>a({...e},i))}))}throw new Error(`Invalid listen ${r}`)}async call(n,r,i){const s=this.getUriTransformer(n);switch(r){case"createProfile":{const e=await this.service.createProfile(i[0],i[1],i[2]);return a({...e},s)}case"updateProfile":{let e=o(c(i[0],s),this.service.profilesHome.scheme);return e=await this.service.updateProfile(e,i[1]),a({...e},s)}case"removeProfile":{const e=o(c(i[0],s),this.service.profilesHome.scheme);return this.service.removeProfile(e)}}throw new Error(`Invalid call ${r}`)}}class y extends P{constructor(r,i,s){super();this.profilesHome=i;this.channel=s;this._profiles=r.map(e=>o(e,this.profilesHome.scheme)),this._register(this.channel.listen("onDidChangeProfiles")(e=>{const l=e.added.map(t=>o(t,this.profilesHome.scheme)),p=e.removed.map(t=>o(t,this.profilesHome.scheme)),m=e.updated.map(t=>o(t,this.profilesHome.scheme));this._profiles=e.all.map(t=>o(t,this.profilesHome.scheme)),this._onDidChangeProfiles.fire({added:l,removed:p,updated:m,all:this.profiles})})),this.onDidResetWorkspaces=this.channel.listen("onDidResetWorkspaces")}_serviceBrand;get defaultProfile(){return this.profiles[0]}_profiles=[];get profiles(){return this._profiles}_onDidChangeProfiles=this._register(new h);onDidChangeProfiles=this._onDidChangeProfiles.event;onDidResetWorkspaces;enabled=!0;setEnablement(r){this.enabled=r}isEnabled(){return this.enabled}async createNamedProfile(r,i,s){const e=await this.channel.call("createNamedProfile",[r,i,s]);return o(e,this.profilesHome.scheme)}async createProfile(r,i,s,e){const l=await this.channel.call("createProfile",[r,i,s,e]);return o(l,this.profilesHome.scheme)}async createTransientProfile(r){const i=await this.channel.call("createTransientProfile",[r]);return o(i,this.profilesHome.scheme)}async setProfileForWorkspace(r,i){await this.channel.call("setProfileForWorkspace",[r,i])}removeProfile(r){return this.channel.call("removeProfile",[r])}async updateProfile(r,i){const s=await this.channel.call("updateProfile",[r,i]);return o(s,this.profilesHome.scheme)}resetWorkspaces(){return this.channel.call("resetWorkspaces")}cleanUp(){return this.channel.call("cleanUp")}cleanUpTransientProfiles(){return this.channel.call("cleanUpTransientProfiles")}}export{u as RemoteUserDataProfilesServiceChannel,y as UserDataProfilesService};
