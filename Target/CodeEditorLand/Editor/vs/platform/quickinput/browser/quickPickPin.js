import{Codicon as f}from"../../../base/common/codicons.js";import{localize as u}from"../../../nls.js";import{StorageScope as Q,StorageTarget as k}from"../../storage/common/storage.js";import{ThemeIcon as C}from"../../../base/common/themables.js";import{DisposableStore as B}from"../../../base/common/lifecycle.js";const S=C.asClassName(f.pin),l=C.asClassName(f.pinned),b=[S,l];function R(e,n,t,o){const s=t.items;let i=P(n,t,e,void 0,o);const r=new B;return r.add(t.onDidTriggerItemButton(async m=>{m.button.iconClass&&b.includes(m.button.iconClass)&&(t.items=s,i=P(n,t,e,m.item,o),t.items=t.value?s:i)})),r.add(t.onDidChangeValue(async m=>{t.items===i&&m?t.items=s:t.items===s&&!m&&(t.items=i)})),t.items=t.value?s:i,t.show(),r}function P(e,n,t,o,s){const i=[];let r;o?r=N(e,o,t):r=h(e,t),r.length&&i.push({type:"separator",label:u("terminal.commands.pinned","pinned")});const m=new Set;for(const a of r){const I=n.items.find(d=>w(d,a));if(I){const d=c(I),p=Object.assign({},I);(!s||!m.has(d))&&(m.add(d),g(p,!1),i.push(p))}}for(const a of n.items)g(a,!0),i.push(a);return i}function c(e){return e.type==="separator"?"":e.id||`${e.label}${e.description}${e.detail}}`}function g(e,n){if(e.type==="separator")return;const t=e.buttons?.filter(o=>o.iconClass&&!b.includes(o.iconClass))??[];t.unshift({iconClass:n?S:l,tooltip:n?u("pinCommand","Pin command"):u("pinnedCommand","Pinned command"),alwaysVisible:!1}),e.buttons=t}function w(e,n){return c(e)===c(n)}function N(e,n,t){const o=n.buttons?.find(i=>i.iconClass===l);let s=h(e,t);return o?s=s.filter(i=>c(i)!==c(n)):s.push(n),t.store(e,JSON.stringify(s),Q.WORKSPACE,k.MACHINE),s}function h(e,n){const t=n.get(e,Q.WORKSPACE);return t?JSON.parse(t):[]}export{R as showWithPinnedItems};
