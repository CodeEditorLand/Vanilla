var B=Object.defineProperty;var V=Object.getOwnPropertyDescriptor;var E=(c,n,e,t)=>{for(var i=t>1?void 0:t?V(n,e):n,r=c.length-1,s;r>=0;r--)(s=c[r])&&(i=(t?s(n,e,i):s(i))||i);return t&&i&&B(n,e,i),i},L=(c,n)=>(e,t)=>n(e,t,c);import*as o from"../../../base/browser/dom.js";import{StandardKeyboardEvent as N}from"../../../base/browser/keyboardEvent.js";import{ActionBar as q}from"../../../base/browser/ui/actionbar/actionbar.js";import"../../../base/browser/ui/aria/aria.js";import"../../../base/browser/ui/hover/hoverDelegate.js";import{HoverPosition as W}from"../../../base/browser/ui/hover/hoverWidget.js";import{IconLabel as O}from"../../../base/browser/ui/iconLabel/iconLabel.js";import{KeybindingLabel as R}from"../../../base/browser/ui/keybindingLabel/keybindingLabel.js";import"../../../base/browser/ui/list/list.js";import"../../../base/browser/ui/list/listWidget.js";import{RenderIndentGuides as z}from"../../../base/browser/ui/tree/abstractTree.js";import{TreeVisibility as C}from"../../../base/browser/ui/tree/tree.js";import{equals as K}from"../../../base/common/arrays.js";import{ThrottledDelayer as U}from"../../../base/common/async.js";import{compareAnything as $}from"../../../base/common/comparers.js";import{memoize as w}from"../../../base/common/decorators.js";import{isCancellationError as j}from"../../../base/common/errors.js";import{Emitter as y,Event as b,EventBufferer as G}from"../../../base/common/event.js";import"../../../base/common/filters.js";import"../../../base/common/htmlContent.js";import{getCodiconAriaLabel as X,matchesFuzzyIconAware as H,parseLabelWithIcons as S}from"../../../base/common/iconLabels.js";import{KeyCode as J}from"../../../base/common/keyCodes.js";import{Lazy as Y}from"../../../base/common/lazy.js";import{Disposable as Z,DisposableStore as T}from"../../../base/common/lifecycle.js";import{observableValue as Q,observableValueOpts as ee,transaction as te}from"../../../base/common/observable.js";import{OS as ie}from"../../../base/common/platform.js";import{ltrim as re}from"../../../base/common/strings.js";import{URI as ne}from"../../../base/common/uri.js";import{localize as se}from"../../../nls.js";import{IAccessibilityService as ae}from"../../accessibility/common/accessibility.js";import{IInstantiationService as oe}from"../../instantiation/common/instantiation.js";import{WorkbenchObjectTree as le}from"../../list/browser/listService.js";import{isDark as ce}from"../../theme/common/theme.js";import{IThemeService as he}from"../../theme/common/themeService.js";import{QuickPickFocus as p}from"../common/quickInput.js";import{quickInputButtonToAction as M}from"./quickInputUtils.js";const m=o.$;class x{constructor(n,e,t){this.index=n;this.hasCheckbox=e;this._init=new Y(()=>{const i=t.label??"",r=S(i).text.trim(),s=t.ariaLabel||[i,this.saneDescription,this.saneDetail].map(l=>X(l)).filter(l=>!!l).join(", ");return{saneLabel:i,saneSortLabel:r,saneAriaLabel:s}}),this._saneDescription=t.description,this._saneTooltip=t.tooltip}_init;get saneLabel(){return this._init.value.saneLabel}get saneSortLabel(){return this._init.value.saneSortLabel}get saneAriaLabel(){return this._init.value.saneAriaLabel}_element;get element(){return this._element}set element(n){this._element=n}_hidden=!1;get hidden(){return this._hidden}set hidden(n){this._hidden=n}_saneDescription;get saneDescription(){return this._saneDescription}set saneDescription(n){this._saneDescription=n}_saneDetail;get saneDetail(){return this._saneDetail}set saneDetail(n){this._saneDetail=n}_saneTooltip;get saneTooltip(){return this._saneTooltip}set saneTooltip(n){this._saneTooltip=n}_labelHighlights;get labelHighlights(){return this._labelHighlights}set labelHighlights(n){this._labelHighlights=n}_descriptionHighlights;get descriptionHighlights(){return this._descriptionHighlights}set descriptionHighlights(n){this._descriptionHighlights=n}_detailHighlights;get detailHighlights(){return this._detailHighlights}set detailHighlights(n){this._detailHighlights=n}}class h extends x{constructor(e,t,i,r,s,l){super(e,t,s);this.fireButtonTriggered=i;this._onChecked=r;this.item=s;this._separator=l;this.onChecked=t?b.map(b.filter(this._onChecked.event,a=>a.element===this),a=>a.checked):b.None,this._saneDetail=s.detail,this._labelHighlights=s.highlights?.label,this._descriptionHighlights=s.highlights?.description,this._detailHighlights=s.highlights?.detail}onChecked;get separator(){return this._separator}set separator(e){this._separator=e}_checked=!1;get checked(){return this._checked}set checked(e){e!==this._checked&&(this._checked=e,this._onChecked.fire({element:this,checked:e}))}get checkboxDisabled(){return!!this.item.disabled}}var de=(t=>(t[t.NONE=0]="NONE",t[t.MOUSE_HOVER=1]="MOUSE_HOVER",t[t.ACTIVE_ITEM=2]="ACTIVE_ITEM",t))(de||{});class v extends x{constructor(e,t,i){super(e,!1,i);this.fireSeparatorButtonTriggered=t;this.separator=i}children=new Array;focusInsideSeparator=0}class ue{getHeight(n){return n instanceof v?30:n.saneDetail?44:22}getTemplateId(n){return n instanceof h?_.ID:D.ID}}class pe{getWidgetAriaLabel(){return se("quickInput","Quick Input")}getAriaLabel(n){return n.separator?.label?`${n.saneAriaLabel}, ${n.separator.label}`:n.saneAriaLabel}getWidgetRole(){return"listbox"}getRole(n){return n.hasCheckbox?"checkbox":"option"}isChecked(n){if(!(!n.hasCheckbox||!(n instanceof h)))return{get value(){return n.checked},onDidChange:e=>n.onChecked(()=>e())}}}class F{constructor(n){this.hoverDelegate=n}renderTemplate(n){const e=Object.create(null);e.toDisposeElement=new T,e.toDisposeTemplate=new T,e.entry=o.append(n,m(".quick-input-list-entry"));const t=o.append(e.entry,m("label.quick-input-list-label"));e.toDisposeTemplate.add(o.addStandardDisposableListener(t,o.EventType.CLICK,d=>{e.checkbox.offsetParent||d.preventDefault()})),e.checkbox=o.append(t,m("input.quick-input-list-checkbox")),e.checkbox.type="checkbox";const i=o.append(t,m(".quick-input-list-rows")),r=o.append(i,m(".quick-input-list-row")),s=o.append(i,m(".quick-input-list-row"));e.label=new O(r,{supportHighlights:!0,supportDescriptionHighlights:!0,supportIcons:!0,hoverDelegate:this.hoverDelegate}),e.toDisposeTemplate.add(e.label),e.icon=o.prepend(e.label.element,m(".quick-input-list-icon"));const l=o.append(r,m(".quick-input-list-entry-keybinding"));e.keybinding=new R(l,ie),e.toDisposeTemplate.add(e.keybinding);const a=o.append(s,m(".quick-input-list-label-meta"));return e.detail=new O(a,{supportHighlights:!0,supportIcons:!0,hoverDelegate:this.hoverDelegate}),e.toDisposeTemplate.add(e.detail),e.separator=o.append(e.entry,m(".quick-input-list-separator")),e.actionBar=new q(e.entry,this.hoverDelegate?{hoverDelegate:this.hoverDelegate}:void 0),e.actionBar.domNode.classList.add("quick-input-list-entry-action-bar"),e.toDisposeTemplate.add(e.actionBar),e}disposeTemplate(n){n.toDisposeElement.dispose(),n.toDisposeTemplate.dispose()}disposeElement(n,e,t){t.toDisposeElement.clear(),t.actionBar.clear()}}let _=class extends F{constructor(e,t){super(e);this.themeService=t}static ID="quickpickitem";_itemsWithSeparatorsFrequency=new Map;get templateId(){return _.ID}renderTemplate(e){const t=super.renderTemplate(e);return t.toDisposeTemplate.add(o.addStandardDisposableListener(t.checkbox,o.EventType.CHANGE,i=>{t.element.checked=t.checkbox.checked})),t}renderElement(e,t,i){const r=e.element;i.element=r,r.element=i.entry??void 0;const s=r.item;i.checkbox.checked=r.checked,i.toDisposeElement.add(r.onChecked(u=>i.checkbox.checked=u)),i.checkbox.disabled=r.checkboxDisabled;const{labelHighlights:l,descriptionHighlights:a,detailHighlights:d}=r;if(s.iconPath){const u=ce(this.themeService.getColorTheme().type)?s.iconPath.dark:s.iconPath.light??s.iconPath.dark,P=ne.revive(u);i.icon.className="quick-input-list-icon",i.icon.style.backgroundImage=o.asCSSUrl(P)}else i.icon.style.backgroundImage="",i.icon.className=s.iconClass?`quick-input-list-icon ${s.iconClass}`:"";let f;!r.saneTooltip&&r.saneDescription&&(f={markdown:{value:r.saneDescription,supportThemeIcons:!0},markdownNotSupportedFallback:r.saneDescription});const g={matches:l||[],descriptionTitle:f,descriptionMatches:a||[],labelEscapeNewLines:!0};if(g.extraClasses=s.iconClasses,g.italic=s.italic,g.strikethrough=s.strikethrough,i.entry.classList.remove("quick-input-list-separator-as-item"),i.label.setLabel(r.saneLabel,r.saneDescription,g),i.keybinding.set(s.keybinding),r.saneDetail){let u;r.saneTooltip||(u={markdown:{value:r.saneDetail,supportThemeIcons:!0},markdownNotSupportedFallback:r.saneDetail}),i.detail.element.style.display="",i.detail.setLabel(r.saneDetail,void 0,{matches:d,title:u,labelEscapeNewLines:!0})}else i.detail.element.style.display="none";r.separator?.label?(i.separator.textContent=r.separator.label,i.separator.style.display="",this.addItemWithSeparator(r)):i.separator.style.display="none",i.entry.classList.toggle("quick-input-list-separator-border",!!r.separator);const k=s.buttons;k&&k.length?(i.actionBar.push(k.map((u,P)=>M(u,`id-${P}`,()=>r.fireButtonTriggered({button:u,item:r.item}))),{icon:!0,label:!1}),i.entry.classList.add("has-actions")):i.entry.classList.remove("has-actions")}disposeElement(e,t,i){this.removeItemWithSeparator(e.element),super.disposeElement(e,t,i)}isItemWithSeparatorVisible(e){return this._itemsWithSeparatorsFrequency.has(e)}addItemWithSeparator(e){this._itemsWithSeparatorsFrequency.set(e,(this._itemsWithSeparatorsFrequency.get(e)||0)+1)}removeItemWithSeparator(e){const t=this._itemsWithSeparatorsFrequency.get(e)||0;t>1?this._itemsWithSeparatorsFrequency.set(e,t-1):this._itemsWithSeparatorsFrequency.delete(e)}};_=E([L(1,he)],_);class D extends F{static ID="quickpickseparator";_visibleSeparatorsFrequency=new Map;get templateId(){return D.ID}get visibleSeparators(){return[...this._visibleSeparatorsFrequency.keys()]}isSeparatorVisible(n){return this._visibleSeparatorsFrequency.has(n)}renderTemplate(n){const e=super.renderTemplate(n);return e.checkbox.style.display="none",e}renderElement(n,e,t){const i=n.element;t.element=i,i.element=t.entry??void 0,i.element.classList.toggle("focus-inside",!!i.focusInsideSeparator);const r=i.separator,{labelHighlights:s,descriptionHighlights:l,detailHighlights:a}=i;t.icon.style.backgroundImage="",t.icon.className="";let d;!i.saneTooltip&&i.saneDescription&&(d={markdown:{value:i.saneDescription,supportThemeIcons:!0},markdownNotSupportedFallback:i.saneDescription});const f={matches:s||[],descriptionTitle:d,descriptionMatches:l||[],labelEscapeNewLines:!0};if(t.entry.classList.add("quick-input-list-separator-as-item"),t.label.setLabel(i.saneLabel,i.saneDescription,f),i.saneDetail){let k;i.saneTooltip||(k={markdown:{value:i.saneDetail,supportThemeIcons:!0},markdownNotSupportedFallback:i.saneDetail}),t.detail.element.style.display="",t.detail.setLabel(i.saneDetail,void 0,{matches:a,title:k,labelEscapeNewLines:!0})}else t.detail.element.style.display="none";t.separator.style.display="none",t.entry.classList.add("quick-input-list-separator-border");const g=r.buttons;g&&g.length?(t.actionBar.push(g.map((k,u)=>M(k,`id-${u}`,()=>i.fireSeparatorButtonTriggered({button:k,separator:i.separator}))),{icon:!0,label:!1}),t.entry.classList.add("has-actions")):t.entry.classList.remove("has-actions"),this.addSeparator(i)}disposeElement(n,e,t){this.removeSeparator(n.element),this.isSeparatorVisible(n.element)||n.element.element?.classList.remove("focus-inside"),super.disposeElement(n,e,t)}addSeparator(n){this._visibleSeparatorsFrequency.set(n,(this._visibleSeparatorsFrequency.get(n)||0)+1)}removeSeparator(n){const e=this._visibleSeparatorsFrequency.get(n)||0;e>1?this._visibleSeparatorsFrequency.set(n,e-1):this._visibleSeparatorsFrequency.delete(n)}}let I=class extends Z{constructor(e,t,i,r,s,l){super();this.parent=e;this.hoverDelegate=t;this.linkOpenerDelegate=i;this.accessibilityService=l;this._container=o.append(this.parent,m(".quick-input-list")),this._separatorRenderer=new D(t),this._itemRenderer=s.createInstance(_,t),this._tree=this._register(s.createInstance(le,"QuickInput",this._container,new ue,[this._itemRenderer,this._separatorRenderer],{filter:{filter(a){return a.hidden?C.Hidden:a instanceof v?C.Recurse:C.Visible}},sorter:{compare:(a,d)=>{if(!this.sortByLabel||!this._lastQueryString)return 0;const f=this._lastQueryString.toLowerCase();return fe(a,d,f)}},accessibilityProvider:new pe,setRowLineHeight:!1,multipleSelectionSupport:!1,hideTwistiesOfChildlessElements:!0,renderIndentGuides:z.None,findWidgetEnabled:!1,indent:0,horizontalScrolling:!1,allowNonCollapsibleParents:!0,alwaysConsumeMouseWheel:!0})),this._tree.getHTMLElement().id=r,this._registerListeners()}_onKeyDown=new y;onKeyDown=this._onKeyDown.event;_onLeave=new y;onLeave=this._onLeave.event;_visibleCountObservable=Q("VisibleCount",0);onChangedVisibleCount=b.fromObservable(this._visibleCountObservable,this._store);_allVisibleCheckedObservable=Q("AllVisibleChecked",!1);onChangedAllVisibleChecked=b.fromObservable(this._allVisibleCheckedObservable,this._store);_checkedCountObservable=Q("CheckedCount",0);onChangedCheckedCount=b.fromObservable(this._checkedCountObservable,this._store);_checkedElementsObservable=ee({equalsFn:K},new Array);onChangedCheckedElements=b.fromObservable(this._checkedElementsObservable,this._store);_onButtonTriggered=new y;onButtonTriggered=this._onButtonTriggered.event;_onSeparatorButtonTriggered=new y;onSeparatorButtonTriggered=this._onSeparatorButtonTriggered.event;_elementChecked=new y;_elementCheckedEventBufferer=new G;_hasCheckboxes=!1;_container;_tree;_separatorRenderer;_itemRenderer;_inputElements=new Array;_elementTree=new Array;_itemElements=new Array;_elementDisposable=this._register(new T);_lastHover;_lastQueryString;get onDidChangeFocus(){return b.map(this._tree.onDidChangeFocus,e=>e.elements.filter(t=>t instanceof h).map(t=>t.item),this._store)}get onDidChangeSelection(){return b.map(this._tree.onDidChangeSelection,e=>({items:e.elements.filter(t=>t instanceof h).map(t=>t.item),event:e.browserEvent}),this._store)}get displayed(){return this._container.style.display!=="none"}set displayed(e){this._container.style.display=e?"":"none"}get scrollTop(){return this._tree.scrollTop}set scrollTop(e){this._tree.scrollTop=e}get ariaLabel(){return this._tree.ariaLabel}set ariaLabel(e){this._tree.ariaLabel=e??""}set enabled(e){this._tree.getHTMLElement().style.pointerEvents=e?"":"none"}_matchOnDescription=!1;get matchOnDescription(){return this._matchOnDescription}set matchOnDescription(e){this._matchOnDescription=e}_matchOnDetail=!1;get matchOnDetail(){return this._matchOnDetail}set matchOnDetail(e){this._matchOnDetail=e}_matchOnLabel=!0;get matchOnLabel(){return this._matchOnLabel}set matchOnLabel(e){this._matchOnLabel=e}_matchOnLabelMode="fuzzy";get matchOnLabelMode(){return this._matchOnLabelMode}set matchOnLabelMode(e){this._matchOnLabelMode=e}_matchOnMeta=!0;get matchOnMeta(){return this._matchOnMeta}set matchOnMeta(e){this._matchOnMeta=e}_sortByLabel=!0;get sortByLabel(){return this._sortByLabel}set sortByLabel(e){this._sortByLabel=e}_shouldLoop=!0;get shouldLoop(){return this._shouldLoop}set shouldLoop(e){this._shouldLoop=e}_registerListeners(){this._registerOnKeyDown(),this._registerOnContainerClick(),this._registerOnMouseMiddleClick(),this._registerOnTreeModelChanged(),this._registerOnElementChecked(),this._registerOnContextMenu(),this._registerHoverListeners(),this._registerSelectionChangeListener(),this._registerSeparatorActionShowingListeners()}_registerOnKeyDown(){this._register(this._tree.onKeyDown(e=>{const t=new N(e);switch(t.keyCode){case J.Space:this.toggleCheckbox();break}this._onKeyDown.fire(t)}))}_registerOnContainerClick(){this._register(o.addDisposableListener(this._container,o.EventType.CLICK,e=>{(e.x||e.y)&&this._onLeave.fire()}))}_registerOnMouseMiddleClick(){this._register(o.addDisposableListener(this._container,o.EventType.AUXCLICK,e=>{e.button===1&&this._onLeave.fire()}))}_registerOnTreeModelChanged(){this._register(this._tree.onDidChangeModel(()=>{const e=this._itemElements.filter(t=>!t.hidden).length;this._visibleCountObservable.set(e,void 0),this._hasCheckboxes&&this._updateCheckedObservables()}))}_registerOnElementChecked(){this._register(this._elementCheckedEventBufferer.wrapEvent(this._elementChecked.event,(e,t)=>t)(e=>this._updateCheckedObservables()))}_registerOnContextMenu(){this._register(this._tree.onContextMenu(e=>{e.element&&(e.browserEvent.preventDefault(),this._tree.setSelection([e.element]))}))}_registerHoverListeners(){const e=this._register(new U(this.hoverDelegate.delay));this._register(this._tree.onMouseOver(async t=>{if(o.isHTMLAnchorElement(t.browserEvent.target)){e.cancel();return}if(!(!o.isHTMLAnchorElement(t.browserEvent.relatedTarget)&&o.isAncestor(t.browserEvent.relatedTarget,t.element?.element)))try{await e.trigger(async()=>{t.element instanceof h&&this.showHover(t.element)})}catch(i){if(!j(i))throw i}})),this._register(this._tree.onMouseOut(t=>{o.isAncestor(t.browserEvent.relatedTarget,t.element?.element)||e.cancel()}))}_registerSeparatorActionShowingListeners(){this._register(this._tree.onDidChangeFocus(e=>{const t=e.elements[0]?this._tree.getParentElement(e.elements[0]):null;for(const i of this._separatorRenderer.visibleSeparators){const r=i===t;!!(i.focusInsideSeparator&2)!==r&&(r?i.focusInsideSeparator|=2:i.focusInsideSeparator&=-3,this._tree.rerender(i))}})),this._register(this._tree.onMouseOver(e=>{const t=e.element?this._tree.getParentElement(e.element):null;for(const i of this._separatorRenderer.visibleSeparators){if(i!==t)continue;!!(i.focusInsideSeparator&1)||(i.focusInsideSeparator|=1,this._tree.rerender(i))}})),this._register(this._tree.onMouseOut(e=>{const t=e.element?this._tree.getParentElement(e.element):null;for(const i of this._separatorRenderer.visibleSeparators){if(i!==t)continue;!!(i.focusInsideSeparator&1)&&(i.focusInsideSeparator&=-2,this._tree.rerender(i))}}))}_registerSelectionChangeListener(){this._register(this._tree.onDidChangeSelection(e=>{const t=e.elements.filter(i=>i instanceof h);t.length!==e.elements.length&&(e.elements.length===1&&e.elements[0]instanceof v&&(this._tree.setFocus([e.elements[0].children[0]]),this._tree.reveal(e.elements[0],0)),this._tree.setSelection(t))}))}setAllVisibleChecked(e){this._elementCheckedEventBufferer.bufferEvents(()=>{this._itemElements.forEach(t=>{!t.hidden&&!t.checkboxDisabled&&(t.checked=e)})})}setElements(e){this._elementDisposable.clear(),this._lastQueryString=void 0,this._inputElements=e,this._hasCheckboxes=this.parent.classList.contains("show-checkboxes");let t;this._itemElements=new Array,this._elementTree=e.reduce((i,r,s)=>{let l;if(r.type==="separator"){if(!r.buttons)return i;t=new v(s,a=>this._onSeparatorButtonTriggered.fire(a),r),l=t}else{const a=s>0?e[s-1]:void 0;let d;a&&a.type==="separator"&&!a.buttons&&(t=void 0,d=a);const f=new h(s,this._hasCheckboxes,g=>this._onButtonTriggered.fire(g),this._elementChecked,r,d);if(this._itemElements.push(f),t)return t.children.push(f),i;l=f}return i.push(l),i},new Array),this._setElementsToTree(this._elementTree),this.accessibilityService.isScreenReaderOptimized()&&setTimeout(()=>{const i=this._tree.getHTMLElement().querySelector(".monaco-list-row.focused"),r=i?.parentNode;if(i&&r){const s=i.nextSibling;i.remove(),r.insertBefore(i,s)}},0)}setFocusedElements(e){const t=e.map(i=>this._itemElements.find(r=>r.item===i)).filter(i=>!!i).filter(i=>!i.hidden);if(this._tree.setFocus(t),e.length>0){const i=this._tree.getFocus()[0];i&&this._tree.reveal(i)}}getActiveDescendant(){return this._tree.getHTMLElement().getAttribute("aria-activedescendant")}setSelectedElements(e){const t=e.map(i=>this._itemElements.find(r=>r.item===i)).filter(i=>!!i);this._tree.setSelection(t)}getCheckedElements(){return this._itemElements.filter(e=>e.checked).map(e=>e.item)}setCheckedElements(e){this._elementCheckedEventBufferer.bufferEvents(()=>{const t=new Set;for(const i of e)t.add(i);for(const i of this._itemElements)i.checked=t.has(i.item)})}focus(e){if(this._itemElements.length)switch(e===p.Second&&this._itemElements.length<2&&(e=p.First),e){case p.First:this._tree.scrollTop=0,this._tree.focusFirst(void 0,t=>t.element instanceof h);break;case p.Second:{this._tree.scrollTop=0;let t=!1;this._tree.focusFirst(void 0,i=>i.element instanceof h?t?!0:(t=!t,!1):!1);break}case p.Last:this._tree.scrollTop=this._tree.scrollHeight,this._tree.focusLast(void 0,t=>t.element instanceof h);break;case p.Next:{const t=this._tree.getFocus();this._tree.focusNext(void 0,this._shouldLoop,void 0,r=>r.element instanceof h?(this._tree.reveal(r.element),!0):!1);const i=this._tree.getFocus();t.length&&t[0]===i[0]&&t[0]===this._itemElements[this._itemElements.length-1]&&this._onLeave.fire();break}case p.Previous:{const t=this._tree.getFocus();this._tree.focusPrevious(void 0,this._shouldLoop,void 0,r=>{if(!(r.element instanceof h))return!1;const s=this._tree.getParentElement(r.element);return s===null||s.children[0]!==r.element?this._tree.reveal(r.element):this._tree.reveal(s),!0});const i=this._tree.getFocus();t.length&&t[0]===i[0]&&t[0]===this._itemElements[0]&&this._onLeave.fire();break}case p.NextPage:this._tree.focusNextPage(void 0,t=>t.element instanceof h?(this._tree.reveal(t.element),!0):!1);break;case p.PreviousPage:this._tree.focusPreviousPage(void 0,t=>{if(!(t.element instanceof h))return!1;const i=this._tree.getParentElement(t.element);return i===null||i.children[0]!==t.element?this._tree.reveal(t.element):this._tree.reveal(i),!0});break;case p.NextSeparator:{let t=!1;const i=this._tree.getFocus()[0];this._tree.focusNext(void 0,!0,void 0,s=>{if(t)return!0;if(s.element instanceof v)t=!0,this._separatorRenderer.isSeparatorVisible(s.element)?this._tree.reveal(s.element.children[0]):this._tree.reveal(s.element,0);else if(s.element instanceof h){if(s.element.separator)return this._itemRenderer.isItemWithSeparatorVisible(s.element)?this._tree.reveal(s.element):this._tree.reveal(s.element,0),!0;if(s.element===this._elementTree[0])return this._tree.reveal(s.element,0),!0}return!1});const r=this._tree.getFocus()[0];i===r&&(this._tree.scrollTop=this._tree.scrollHeight,this._tree.focusLast(void 0,s=>s.element instanceof h));break}case p.PreviousSeparator:{let t,i=!!this._tree.getFocus()[0]?.separator;this._tree.focusPrevious(void 0,!0,void 0,r=>{if(r.element instanceof v)i?t||(this._separatorRenderer.isSeparatorVisible(r.element)?this._tree.reveal(r.element):this._tree.reveal(r.element,0),t=r.element.children[0]):i=!0;else if(r.element instanceof h&&!t){if(r.element.separator)this._itemRenderer.isItemWithSeparatorVisible(r.element)?this._tree.reveal(r.element):this._tree.reveal(r.element,0),t=r.element;else if(r.element===this._elementTree[0])return this._tree.reveal(r.element,0),!0}return!1}),t&&this._tree.setFocus([t]);break}}}clearFocus(){this._tree.setFocus([])}domFocus(){this._tree.domFocus()}layout(e){this._tree.getHTMLElement().style.maxHeight=e?`${Math.floor(e/44)*44+6}px`:"",this._tree.layout()}filter(e){if(this._lastQueryString=e,!(this._sortByLabel||this._matchOnLabel||this._matchOnDescription||this._matchOnDetail))return this._tree.layout(),!1;const t=e;if(e=e.trim(),!e||!(this.matchOnLabel||this.matchOnDescription||this.matchOnDetail))this._itemElements.forEach(i=>{i.labelHighlights=void 0,i.descriptionHighlights=void 0,i.detailHighlights=void 0,i.hidden=!1;const r=i.index&&this._inputElements[i.index-1];i.item&&(i.separator=r&&r.type==="separator"&&!r.buttons?r:void 0)});else{let i;this._itemElements.forEach(r=>{let s;this.matchOnLabelMode==="fuzzy"?s=this.matchOnLabel?H(e,S(r.saneLabel))??void 0:void 0:s=this.matchOnLabel?me(t,S(r.saneLabel))??void 0:void 0;const l=this.matchOnDescription?H(e,S(r.saneDescription||""))??void 0:void 0,a=this.matchOnDetail?H(e,S(r.saneDetail||""))??void 0:void 0;if(s||l||a?(r.labelHighlights=s,r.descriptionHighlights=l,r.detailHighlights=a,r.hidden=!1):(r.labelHighlights=void 0,r.descriptionHighlights=void 0,r.detailHighlights=void 0,r.hidden=r.item?!r.item.alwaysShow:!0),r.item?r.separator=void 0:r.separator&&(r.hidden=!0),!this.sortByLabel){const d=r.index&&this._inputElements[r.index-1]||void 0;d?.type==="separator"&&!d.buttons&&(i=d),i&&!r.hidden&&(r.separator=i,i=void 0)}})}return this._setElementsToTree(this._sortByLabel&&e?this._itemElements:this._elementTree),this._tree.layout(),!0}toggleCheckbox(){this._elementCheckedEventBufferer.bufferEvents(()=>{const e=this._tree.getFocus().filter(i=>i instanceof h),t=this._allVisibleChecked(e);for(const i of e)i.checkboxDisabled||(i.checked=!t)})}style(e){this._tree.style(e)}toggleHover(){const e=this._tree.getFocus()[0];if(!e?.saneTooltip||!(e instanceof h))return;if(this._lastHover&&!this._lastHover.isDisposed){this._lastHover.dispose();return}this.showHover(e);const t=new T;t.add(this._tree.onDidChangeFocus(i=>{i.elements[0]instanceof h&&this.showHover(i.elements[0])})),this._lastHover&&t.add(this._lastHover),this._elementDisposable.add(t)}_setElementsToTree(e){const t=new Array;for(const i of e)i instanceof v?t.push({element:i,collapsible:!1,collapsed:!1,children:i.children.map(r=>({element:r,collapsible:!1,collapsed:!1}))}):t.push({element:i,collapsible:!1,collapsed:!1});this._tree.setChildren(null,t)}_allVisibleChecked(e,t=!0){for(let i=0,r=e.length;i<r;i++){const s=e[i];if(!s.hidden)if(s.checked)t=!0;else return!1}return t}_updateCheckedObservables(){te(e=>{this._allVisibleCheckedObservable.set(this._allVisibleChecked(this._itemElements,!1),e);const t=this._itemElements.filter(i=>i.checked).length;this._checkedCountObservable.set(t,e),this._checkedElementsObservable.set(this.getCheckedElements(),e)})}showHover(e){this._lastHover&&!this._lastHover.isDisposed&&(this.hoverDelegate.onDidHideHover?.(),this._lastHover?.dispose()),!(!e.element||!e.saneTooltip)&&(this._lastHover=this.hoverDelegate.showHover({content:e.saneTooltip,target:e.element,linkHandler:t=>{this.linkOpenerDelegate(t)},appearance:{showPointer:!0},container:this._container,position:{hoverPosition:W.RIGHT}},!1))}};E([w],I.prototype,"onDidChangeFocus",1),E([w],I.prototype,"onDidChangeSelection",1),I=E([L(4,oe),L(5,ae)],I);function me(c,n){const{text:e,iconOffsets:t}=n;if(!t||t.length===0)return A(c,e);const i=re(e," "),r=e.length-i.length,s=A(c,i);if(s)for(const l of s){const a=t[l.start+r]+r;l.start+=a,l.end+=a}return s}function A(c,n){const e=n.toLowerCase().indexOf(c.toLowerCase());return e!==-1?[{start:e,end:e+c.length}]:null}function fe(c,n,e){const t=c.labelHighlights||[],i=n.labelHighlights||[];return t.length&&!i.length?-1:!t.length&&i.length?1:t.length===0&&i.length===0?0:$(c.saneSortLabel,n.saneSortLabel,e)}export{I as QuickInputTree};
