{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/log/node/spdlogLog.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport type * as spdlog from \"@vscode/spdlog\";\nimport { ByteSize } from \"../../files/common/files.js\";\nimport {\n\tAbstractMessageLogger,\n\ttype ILogger,\n\tLogLevel,\n} from \"../common/log.js\";\n\nenum SpdLogLevel {\n\tTrace = 0,\n\tDebug = 1,\n\tInfo = 2,\n\tWarning = 3,\n\tError = 4,\n\tCritical = 5,\n\tOff = 6,\n}\n\nasync function createSpdLogLogger(\n\tname: string,\n\tlogfilePath: string,\n\tfilesize: number,\n\tfilecount: number,\n\tdonotUseFormatters: boolean,\n): Promise<spdlog.Logger | null> {\n\t// Do not crash if spdlog cannot be loaded\n\ttry {\n\t\tconst _spdlog = await import(\"@vscode/spdlog\");\n\t\t_spdlog.setFlushOn(SpdLogLevel.Trace);\n\t\tconst logger = await _spdlog.createAsyncRotatingLogger(\n\t\t\tname,\n\t\t\tlogfilePath,\n\t\t\tfilesize,\n\t\t\tfilecount,\n\t\t);\n\t\tif (donotUseFormatters) {\n\t\t\tlogger.clearFormatters();\n\t\t} else {\n\t\t\tlogger.setPattern(\"%Y-%m-%d %H:%M:%S.%e [%l] %v\");\n\t\t}\n\t\treturn logger;\n\t} catch (e) {\n\t\tconsole.error(e);\n\t}\n\treturn null;\n}\n\ninterface ILog {\n\tlevel: LogLevel;\n\tmessage: string;\n}\n\nfunction log(logger: spdlog.Logger, level: LogLevel, message: string): void {\n\tswitch (level) {\n\t\tcase LogLevel.Trace:\n\t\t\tlogger.trace(message);\n\t\t\tbreak;\n\t\tcase LogLevel.Debug:\n\t\t\tlogger.debug(message);\n\t\t\tbreak;\n\t\tcase LogLevel.Info:\n\t\t\tlogger.info(message);\n\t\t\tbreak;\n\t\tcase LogLevel.Warning:\n\t\t\tlogger.warn(message);\n\t\t\tbreak;\n\t\tcase LogLevel.Error:\n\t\t\tlogger.error(message);\n\t\t\tbreak;\n\t\tcase LogLevel.Off:\n\t\t\t/* do nothing */ break;\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid log level ${level}`);\n\t}\n}\n\nfunction setLogLevel(logger: spdlog.Logger, level: LogLevel): void {\n\tswitch (level) {\n\t\tcase LogLevel.Trace:\n\t\t\tlogger.setLevel(SpdLogLevel.Trace);\n\t\t\tbreak;\n\t\tcase LogLevel.Debug:\n\t\t\tlogger.setLevel(SpdLogLevel.Debug);\n\t\t\tbreak;\n\t\tcase LogLevel.Info:\n\t\t\tlogger.setLevel(SpdLogLevel.Info);\n\t\t\tbreak;\n\t\tcase LogLevel.Warning:\n\t\t\tlogger.setLevel(SpdLogLevel.Warning);\n\t\t\tbreak;\n\t\tcase LogLevel.Error:\n\t\t\tlogger.setLevel(SpdLogLevel.Error);\n\t\t\tbreak;\n\t\tcase LogLevel.Off:\n\t\t\tlogger.setLevel(SpdLogLevel.Off);\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error(`Invalid log level ${level}`);\n\t}\n}\n\nexport class SpdLogLogger extends AbstractMessageLogger implements ILogger {\n\tprivate buffer: ILog[] = [];\n\tprivate readonly _loggerCreationPromise: Promise<void>;\n\tprivate _logger: spdlog.Logger | undefined;\n\n\tconstructor(\n\t\tname: string,\n\t\tfilepath: string,\n\t\trotating: boolean,\n\t\tdonotUseFormatters: boolean,\n\t\tlevel: LogLevel,\n\t) {\n\t\tsuper();\n\t\tthis.setLevel(level);\n\t\tthis._loggerCreationPromise = this._createSpdLogLogger(\n\t\t\tname,\n\t\t\tfilepath,\n\t\t\trotating,\n\t\t\tdonotUseFormatters,\n\t\t);\n\t\tthis._register(\n\t\t\tthis.onDidChangeLogLevel((level) => {\n\t\t\t\tif (this._logger) {\n\t\t\t\t\tsetLogLevel(this._logger, level);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprivate async _createSpdLogLogger(\n\t\tname: string,\n\t\tfilepath: string,\n\t\trotating: boolean,\n\t\tdonotUseFormatters: boolean,\n\t): Promise<void> {\n\t\tconst filecount = rotating ? 6 : 1;\n\t\tconst filesize = (30 / filecount) * ByteSize.MB;\n\t\tconst logger = await createSpdLogLogger(\n\t\t\tname,\n\t\t\tfilepath,\n\t\t\tfilesize,\n\t\t\tfilecount,\n\t\t\tdonotUseFormatters,\n\t\t);\n\t\tif (logger) {\n\t\t\tthis._logger = logger;\n\t\t\tsetLogLevel(this._logger, this.getLevel());\n\t\t\tfor (const { level, message } of this.buffer) {\n\t\t\t\tlog(this._logger, level, message);\n\t\t\t}\n\t\t\tthis.buffer = [];\n\t\t}\n\t}\n\n\tprotected log(level: LogLevel, message: string): void {\n\t\tif (this._logger) {\n\t\t\tlog(this._logger, level, message);\n\t\t} else if (this.getLevel() <= level) {\n\t\t\tthis.buffer.push({ level, message });\n\t\t}\n\t}\n\n\toverride flush(): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.flush();\n\t\t} else {\n\t\t\tthis._loggerCreationPromise.then(() => this.flush());\n\t\t}\n\t}\n\n\toverride dispose(): void {\n\t\tif (this._logger) {\n\t\t\tthis.disposeLogger();\n\t\t} else {\n\t\t\tthis._loggerCreationPromise.then(() => this.disposeLogger());\n\t\t}\n\t\tsuper.dispose();\n\t}\n\n\tprivate disposeLogger(): void {\n\t\tif (this._logger) {\n\t\t\tthis._logger.drop();\n\t\t\tthis._logger = undefined;\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["SpdLogLevel", "level"]
}
