import*as r from"fs";import{tmpdir as p}from"os";import{Queue as m}from"../../../base/common/async.js";import{randomPath as u}from"../../../base/common/extpath.js";import{resolveTerminalEncoding as l}from"../../../base/node/terminalEncoding.js";function T(){try{return!process.stdin.isTTY}catch{}return!1}function w(e){return new Promise(n=>{const o=()=>n(!0);setTimeout(()=>{process.stdin.removeListener("data",o),n(!1)},e),process.stdin.once("data",o)})}function x(){return u(p(),"code-stdin",3)}async function b(e,n,o){let[i,s]=await Promise.all([l(n),import("@vscode/iconv-lite-umd"),r.promises.appendFile(e,"")]);s.encodingExists(i)||(i="utf8");const d=new m,a=s.getDecoder(i);process.stdin.on("data",t=>{const c=a.write(t);d.queue(()=>r.promises.appendFile(e,c))}),process.stdin.on("end",()=>{const t=a.end();d.queue(async()=>{try{typeof t=="string"&&await r.promises.appendFile(e,t)}finally{o?.()}})})}export{x as getStdinFilePath,T as hasStdinWithoutTty,b as readFromStdin,w as stdinDataListener};
