var P=Object.defineProperty;var w=Object.getOwnPropertyDescriptor;var S=(c,t,e,s)=>{for(var o=s>1?void 0:s?w(t,e):t,r=c.length-1,i;r>=0;r--)(i=c[r])&&(o=(s?i(t,e,o):i(o))||o);return s&&o&&P(t,e,o),o},b=(c,t)=>(e,s)=>t(e,s,c);import{onUnexpectedError as L}from"../../../base/common/errors.js";import{Disposable as k,isDisposable as V}from"../../../base/common/lifecycle.js";import{Schemas as D}from"../../../base/common/network.js";import F from"../../../base/common/severity.js";import"../../../base/common/uri.js";import*as l from"../../../nls.js";import{IDialogService as A}from"../../dialogs/common/dialogs.js";import{InstantiationType as T,registerSingleton as K}from"../../instantiation/common/extensions.js";import{INotificationService as z}from"../../notification/common/notification.js";import{IUndoRedoService as x,ResourceEditStackSnapshot as E,UndoRedoElementType as u,UndoRedoGroup as G,UndoRedoSource as f}from"./undoRedo.js";const h=!1;function R(c){return c.scheme===D.file?c.fsPath:c.path}let y=0;class g{id=++y;type=u.Resource;actual;label;confirmBeforeUndo;resourceLabel;strResource;resourceLabels;strResources;groupId;groupOrder;sourceId;sourceOrder;isValid;constructor(t,e,s,o,r,i,n){this.actual=t,this.label=t.label,this.confirmBeforeUndo=t.confirmBeforeUndo||!1,this.resourceLabel=e,this.strResource=s,this.resourceLabels=[this.resourceLabel],this.strResources=[this.strResource],this.groupId=o,this.groupOrder=r,this.sourceId=i,this.sourceOrder=n,this.isValid=!0}setValid(t){this.isValid=t}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.isValid?"  VALID":"INVALID"}] ${this.actual.constructor.name} - ${this.actual}`}}var B=(e=>(e[e.ExternalRemoval=0]="ExternalRemoval",e[e.NoParallelUniverses=1]="NoParallelUniverses",e))(B||{});class U{constructor(t,e){this.resourceLabel=t;this.reason=e}}class I{elements=new Map;createMessage(){const t=[],e=[];for(const[,o]of this.elements)(o.reason===0?t:e).push(o.resourceLabel);const s=[];return t.length>0&&s.push(l.localize({key:"externalRemoval",comment:["{0} is a list of filenames"]},"The following files have been closed and modified on disk: {0}.",t.join(", "))),e.length>0&&s.push(l.localize({key:"noParallelUniverses",comment:["{0} is a list of filenames"]},"The following files have been modified in an incompatible way: {0}.",e.join(", "))),s.join(`
`)}get size(){return this.elements.size}has(t){return this.elements.has(t)}set(t,e){this.elements.set(t,e)}delete(t){return this.elements.delete(t)}}class M{id=++y;type=u.Workspace;actual;label;confirmBeforeUndo;resourceLabels;strResources;groupId;groupOrder;sourceId;sourceOrder;removedResources;invalidatedResources;constructor(t,e,s,o,r,i,n){this.actual=t,this.label=t.label,this.confirmBeforeUndo=t.confirmBeforeUndo||!1,this.resourceLabels=e,this.strResources=s,this.groupId=o,this.groupOrder=r,this.sourceId=i,this.sourceOrder=n,this.removedResources=null,this.invalidatedResources=null}canSplit(){return typeof this.actual.split=="function"}removeResource(t,e,s){this.removedResources||(this.removedResources=new I),this.removedResources.has(e)||this.removedResources.set(e,new U(t,s))}setValid(t,e,s){s?this.invalidatedResources&&(this.invalidatedResources.delete(e),this.invalidatedResources.size===0&&(this.invalidatedResources=null)):(this.invalidatedResources||(this.invalidatedResources=new I),this.invalidatedResources.has(e)||this.invalidatedResources.set(e,new U(t,0)))}toString(){return`[id:${this.id}] [group:${this.groupId}] [${this.invalidatedResources?"INVALID":"  VALID"}] ${this.actual.constructor.name} - ${this.actual}`}}class W{resourceLabel;strResource;_past;_future;locked;versionId;constructor(t,e){this.resourceLabel=t,this.strResource=e,this._past=[],this._future=[],this.locked=!1,this.versionId=1}dispose(){for(const t of this._past)t.type===u.Workspace&&t.removeResource(this.resourceLabel,this.strResource,0);for(const t of this._future)t.type===u.Workspace&&t.removeResource(this.resourceLabel,this.strResource,0);this.versionId++}toString(){const t=[];t.push(`* ${this.strResource}:`);for(let e=0;e<this._past.length;e++)t.push(`   * [UNDO] ${this._past[e]}`);for(let e=this._future.length-1;e>=0;e--)t.push(`   * [REDO] ${this._future[e]}`);return t.join(`
`)}flushAllElements(){this._past=[],this._future=[],this.versionId++}setElementsIsValid(t){for(const e of this._past)e.type===u.Workspace?e.setValid(this.resourceLabel,this.strResource,t):e.setValid(t);for(const e of this._future)e.type===u.Workspace?e.setValid(this.resourceLabel,this.strResource,t):e.setValid(t)}_setElementValidFlag(t,e){t.type===u.Workspace?t.setValid(this.resourceLabel,this.strResource,e):t.setValid(e)}setElementsValidFlag(t,e){for(const s of this._past)e(s.actual)&&this._setElementValidFlag(s,t);for(const s of this._future)e(s.actual)&&this._setElementValidFlag(s,t)}pushElement(t){for(const e of this._future)e.type===u.Workspace&&e.removeResource(this.resourceLabel,this.strResource,1);this._future=[],this._past.push(t),this.versionId++}createSnapshot(t){const e=[];for(let s=0,o=this._past.length;s<o;s++)e.push(this._past[s].id);for(let s=this._future.length-1;s>=0;s--)e.push(this._future[s].id);return new E(t,e)}restoreSnapshot(t){const e=t.elements.length;let s=!0,o=0,r=-1;for(let n=0,a=this._past.length;n<a;n++,o++){const d=this._past[n];s&&(o>=e||d.id!==t.elements[o])&&(s=!1,r=0),!s&&d.type===u.Workspace&&d.removeResource(this.resourceLabel,this.strResource,0)}let i=-1;for(let n=this._future.length-1;n>=0;n--,o++){const a=this._future[n];s&&(o>=e||a.id!==t.elements[o])&&(s=!1,i=n),!s&&a.type===u.Workspace&&a.removeResource(this.resourceLabel,this.strResource,0)}r!==-1&&(this._past=this._past.slice(0,r)),i!==-1&&(this._future=this._future.slice(i+1)),this.versionId++}getElements(){const t=[],e=[];for(const s of this._past)t.push(s.actual);for(const s of this._future)e.push(s.actual);return{past:t,future:e}}getClosestPastElement(){return this._past.length===0?null:this._past[this._past.length-1]}getSecondClosestPastElement(){return this._past.length<2?null:this._past[this._past.length-2]}getClosestFutureElement(){return this._future.length===0?null:this._future[this._future.length-1]}hasPastElements(){return this._past.length>0}hasFutureElements(){return this._future.length>0}splitPastWorkspaceElement(t,e){for(let s=this._past.length-1;s>=0;s--)if(this._past[s]===t){e.has(this.strResource)?this._past[s]=e.get(this.strResource):this._past.splice(s,1);break}this.versionId++}splitFutureWorkspaceElement(t,e){for(let s=this._future.length-1;s>=0;s--)if(this._future[s]===t){e.has(this.strResource)?this._future[s]=e.get(this.strResource):this._future.splice(s,1);break}this.versionId++}moveBackward(t){this._past.pop(),this._future.push(t),this.versionId++}moveForward(t){this._future.pop(),this._past.push(t),this.versionId++}}class v{editStacks;_versionIds;constructor(t){this.editStacks=t,this._versionIds=[];for(let e=0,s=this.editStacks.length;e<s;e++)this._versionIds[e]=this.editStacks[e].versionId}isValid(){for(let t=0,e=this.editStacks.length;t<e;t++)if(this._versionIds[t]!==this.editStacks[t].versionId)return!1;return!0}}const C=new W("","");C.locked=!0;let m=class{constructor(t,e){this._dialogService=t;this._notificationService=e;this._editStacks=new Map,this._uriComparisonKeyComputers=[]}_editStacks;_uriComparisonKeyComputers;registerUriComparisonKeyComputer(t,e){return this._uriComparisonKeyComputers.push([t,e]),{dispose:()=>{for(let s=0,o=this._uriComparisonKeyComputers.length;s<o;s++)if(this._uriComparisonKeyComputers[s][1]===e){this._uriComparisonKeyComputers.splice(s,1);return}}}}getUriComparisonKey(t){for(const e of this._uriComparisonKeyComputers)if(e[0]===t.scheme)return e[1].getComparisonKey(t);return t.toString()}_print(t){const e=[];for(const s of this._editStacks)e.push(s[1].toString())}pushElement(t,e=G.None,s=f.None){if(t.type===u.Resource){const o=R(t.resource),r=this.getUriComparisonKey(t.resource);this._pushElement(new g(t,o,r,e.id,e.nextOrder(),s.id,s.nextOrder()))}else{const o=new Set,r=[],i=[];for(const n of t.resources){const a=R(n),d=this.getUriComparisonKey(n);o.has(d)||(o.add(d),r.push(a),i.push(d))}r.length===1?this._pushElement(new g(t,r[0],i[0],e.id,e.nextOrder(),s.id,s.nextOrder())):this._pushElement(new M(t,r,i,e.id,e.nextOrder(),s.id,s.nextOrder()))}h&&this._print("pushElement")}_pushElement(t){for(let e=0,s=t.strResources.length;e<s;e++){const o=t.resourceLabels[e],r=t.strResources[e];let i;this._editStacks.has(r)?i=this._editStacks.get(r):(i=new W(o,r),this._editStacks.set(r,i)),i.pushElement(t)}}getLastElement(t){const e=this.getUriComparisonKey(t);if(this._editStacks.has(e)){const s=this._editStacks.get(e);if(s.hasFutureElements())return null;const o=s.getClosestPastElement();return o?o.actual:null}return null}_splitPastWorkspaceElement(t,e){const s=t.actual.split(),o=new Map;for(const r of s){const i=R(r.resource),n=this.getUriComparisonKey(r.resource),a=new g(r,i,n,0,0,0,0);o.set(a.strResource,a)}for(const r of t.strResources){if(e&&e.has(r))continue;this._editStacks.get(r).splitPastWorkspaceElement(t,o)}}_splitFutureWorkspaceElement(t,e){const s=t.actual.split(),o=new Map;for(const r of s){const i=R(r.resource),n=this.getUriComparisonKey(r.resource),a=new g(r,i,n,0,0,0,0);o.set(a.strResource,a)}for(const r of t.strResources){if(e&&e.has(r))continue;this._editStacks.get(r).splitFutureWorkspaceElement(t,o)}}removeElements(t){const e=typeof t=="string"?t:this.getUriComparisonKey(t);this._editStacks.has(e)&&(this._editStacks.get(e).dispose(),this._editStacks.delete(e)),h&&this._print("removeElements")}setElementsValidFlag(t,e,s){const o=this.getUriComparisonKey(t);this._editStacks.has(o)&&this._editStacks.get(o).setElementsValidFlag(e,s),h&&this._print("setElementsValidFlag")}hasElements(t){const e=this.getUriComparisonKey(t);if(this._editStacks.has(e)){const s=this._editStacks.get(e);return s.hasPastElements()||s.hasFutureElements()}return!1}createSnapshot(t){const e=this.getUriComparisonKey(t);return this._editStacks.has(e)?this._editStacks.get(e).createSnapshot(t):new E(t,[])}restoreSnapshot(t){const e=this.getUriComparisonKey(t.resource);if(this._editStacks.has(e)){const s=this._editStacks.get(e);s.restoreSnapshot(t),!s.hasPastElements()&&!s.hasFutureElements()&&(s.dispose(),this._editStacks.delete(e))}h&&this._print("restoreSnapshot")}getElements(t){const e=this.getUriComparisonKey(t);return this._editStacks.has(e)?this._editStacks.get(e).getElements():{past:[],future:[]}}_findClosestUndoElementWithSource(t){if(!t)return[null,null];let e=null,s=null;for(const[o,r]of this._editStacks){const i=r.getClosestPastElement();i&&i.sourceId===t&&(!e||i.sourceOrder>e.sourceOrder)&&(e=i,s=o)}return[e,s]}canUndo(t){if(t instanceof f){const[,s]=this._findClosestUndoElementWithSource(t.id);return!!s}const e=this.getUriComparisonKey(t);return this._editStacks.has(e)?this._editStacks.get(e).hasPastElements():!1}_onError(t,e){L(t);for(const s of e.strResources)this.removeElements(s);this._notificationService.error(t)}_acquireLocks(t){for(const e of t.editStacks)if(e.locked)throw new Error("Cannot acquire edit stack lock");for(const e of t.editStacks)e.locked=!0;return()=>{for(const e of t.editStacks)e.locked=!1}}_safeInvokeWithLocks(t,e,s,o,r){const i=this._acquireLocks(s);let n;try{n=e()}catch(a){return i(),o.dispose(),this._onError(a,t)}return n?n.then(()=>(i(),o.dispose(),r()),a=>(i(),o.dispose(),this._onError(a,t))):(i(),o.dispose(),r())}async _invokeWorkspacePrepare(t){if(typeof t.actual.prepareUndoRedo>"u")return k.None;const e=t.actual.prepareUndoRedo();return typeof e>"u"?k.None:e}_invokeResourcePrepare(t,e){if(t.actual.type!==u.Workspace||typeof t.actual.prepareUndoRedo>"u")return e(k.None);const s=t.actual.prepareUndoRedo();return s?V(s)?e(s):s.then(o=>e(o)):e(k.None)}_getAffectedEditStacks(t){const e=[];for(const s of t.strResources)e.push(this._editStacks.get(s)||C);return new v(e)}_tryToSplitAndUndo(t,e,s,o){if(e.canSplit())return this._splitPastWorkspaceElement(e,s),this._notificationService.warn(o),new _(this._undo(t,0,!0));for(const r of e.strResources)this.removeElements(r);return this._notificationService.warn(o),new _}_checkWorkspaceUndo(t,e,s,o){if(e.removedResources)return this._tryToSplitAndUndo(t,e,e.removedResources,l.localize({key:"cannotWorkspaceUndo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not undo '{0}' across all files. {1}",e.label,e.removedResources.createMessage()));if(o&&e.invalidatedResources)return this._tryToSplitAndUndo(t,e,e.invalidatedResources,l.localize({key:"cannotWorkspaceUndo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not undo '{0}' across all files. {1}",e.label,e.invalidatedResources.createMessage()));const r=[];for(const n of s.editStacks)n.getClosestPastElement()!==e&&r.push(n.resourceLabel);if(r.length>0)return this._tryToSplitAndUndo(t,e,null,l.localize({key:"cannotWorkspaceUndoDueToChanges",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because changes were made to {1}",e.label,r.join(", ")));const i=[];for(const n of s.editStacks)n.locked&&i.push(n.resourceLabel);return i.length>0?this._tryToSplitAndUndo(t,e,null,l.localize({key:"cannotWorkspaceUndoDueToInProgressUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because there is already an undo or redo operation running on {1}",e.label,i.join(", "))):s.isValid()?null:this._tryToSplitAndUndo(t,e,null,l.localize({key:"cannotWorkspaceUndoDueToInMeantimeUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not undo '{0}' across all files because an undo or redo operation occurred in the meantime",e.label))}_workspaceUndo(t,e,s){const o=this._getAffectedEditStacks(e),r=this._checkWorkspaceUndo(t,e,o,!1);return r?r.returnValue:this._confirmAndExecuteWorkspaceUndo(t,e,o,s)}_isPartOfUndoGroup(t){if(!t.groupId)return!1;for(const[,e]of this._editStacks){const s=e.getClosestPastElement();if(s){if(s===t){const o=e.getSecondClosestPastElement();if(o&&o.groupId===t.groupId)return!0}if(s.groupId===t.groupId)return!0}}return!1}async _confirmAndExecuteWorkspaceUndo(t,e,s,o){if(e.canSplit()&&!this._isPartOfUndoGroup(e)){let n;(p=>(p[p.All=0]="All",p[p.This=1]="This",p[p.Cancel=2]="Cancel"))(n||={});const{result:a}=await this._dialogService.prompt({type:F.Info,message:l.localize("confirmWorkspace","Would you like to undo '{0}' across all files?",e.label),buttons:[{label:l.localize({key:"ok",comment:["{0} denotes a number that is > 1, && denotes a mnemonic"]},"&&Undo in {0} Files",s.editStacks.length),run:()=>0},{label:l.localize({key:"nok",comment:["&& denotes a mnemonic"]},"Undo this &&File"),run:()=>1}],cancelButton:{run:()=>2}});if(a===2)return;if(a===1)return this._splitPastWorkspaceElement(e,null),this._undo(t,0,!0);const d=this._checkWorkspaceUndo(t,e,s,!1);if(d)return d.returnValue;o=!0}let r;try{r=await this._invokeWorkspacePrepare(e)}catch(n){return this._onError(n,e)}const i=this._checkWorkspaceUndo(t,e,s,!0);if(i)return r.dispose(),i.returnValue;for(const n of s.editStacks)n.moveBackward(e);return this._safeInvokeWithLocks(e,()=>e.actual.undo(),s,r,()=>this._continueUndoInGroup(e.groupId,o))}_resourceUndo(t,e,s){if(!e.isValid){t.flushAllElements();return}if(t.locked){const o=l.localize({key:"cannotResourceUndoDueToInProgressUndoRedo",comment:["{0} is a label for an operation."]},"Could not undo '{0}' because there is already an undo or redo operation running.",e.label);this._notificationService.warn(o);return}return this._invokeResourcePrepare(e,o=>(t.moveBackward(e),this._safeInvokeWithLocks(e,()=>e.actual.undo(),new v([t]),o,()=>this._continueUndoInGroup(e.groupId,s))))}_findClosestUndoElementInGroup(t){if(!t)return[null,null];let e=null,s=null;for(const[o,r]of this._editStacks){const i=r.getClosestPastElement();i&&i.groupId===t&&(!e||i.groupOrder>e.groupOrder)&&(e=i,s=o)}return[e,s]}_continueUndoInGroup(t,e){if(!t)return;const[,s]=this._findClosestUndoElementInGroup(t);if(s)return this._undo(s,0,e)}undo(t){if(t instanceof f){const[,e]=this._findClosestUndoElementWithSource(t.id);return e?this._undo(e,t.id,!1):void 0}return typeof t=="string"?this._undo(t,0,!1):this._undo(this.getUriComparisonKey(t),0,!1)}_undo(t,e=0,s){if(!this._editStacks.has(t))return;const o=this._editStacks.get(t),r=o.getClosestPastElement();if(!r)return;if(r.groupId){const[n,a]=this._findClosestUndoElementInGroup(r.groupId);if(r!==n&&a)return this._undo(a,e,s)}if((r.sourceId!==e||r.confirmBeforeUndo)&&!s)return this._confirmAndContinueUndo(t,e,r);try{return r.type===u.Workspace?this._workspaceUndo(t,r,s):this._resourceUndo(o,r,s)}finally{h&&this._print("undo")}}async _confirmAndContinueUndo(t,e,s){if((await this._dialogService.confirm({message:l.localize("confirmDifferentSource","Would you like to undo '{0}'?",s.label),primaryButton:l.localize({key:"confirmDifferentSource.yes",comment:["&& denotes a mnemonic"]},"&&Yes"),cancelButton:l.localize("confirmDifferentSource.no","No")})).confirmed)return this._undo(t,e,!0)}_findClosestRedoElementWithSource(t){if(!t)return[null,null];let e=null,s=null;for(const[o,r]of this._editStacks){const i=r.getClosestFutureElement();i&&i.sourceId===t&&(!e||i.sourceOrder<e.sourceOrder)&&(e=i,s=o)}return[e,s]}canRedo(t){if(t instanceof f){const[,s]=this._findClosestRedoElementWithSource(t.id);return!!s}const e=this.getUriComparisonKey(t);return this._editStacks.has(e)?this._editStacks.get(e).hasFutureElements():!1}_tryToSplitAndRedo(t,e,s,o){if(e.canSplit())return this._splitFutureWorkspaceElement(e,s),this._notificationService.warn(o),new _(this._redo(t));for(const r of e.strResources)this.removeElements(r);return this._notificationService.warn(o),new _}_checkWorkspaceRedo(t,e,s,o){if(e.removedResources)return this._tryToSplitAndRedo(t,e,e.removedResources,l.localize({key:"cannotWorkspaceRedo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not redo '{0}' across all files. {1}",e.label,e.removedResources.createMessage()));if(o&&e.invalidatedResources)return this._tryToSplitAndRedo(t,e,e.invalidatedResources,l.localize({key:"cannotWorkspaceRedo",comment:["{0} is a label for an operation. {1} is another message."]},"Could not redo '{0}' across all files. {1}",e.label,e.invalidatedResources.createMessage()));const r=[];for(const n of s.editStacks)n.getClosestFutureElement()!==e&&r.push(n.resourceLabel);if(r.length>0)return this._tryToSplitAndRedo(t,e,null,l.localize({key:"cannotWorkspaceRedoDueToChanges",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because changes were made to {1}",e.label,r.join(", ")));const i=[];for(const n of s.editStacks)n.locked&&i.push(n.resourceLabel);return i.length>0?this._tryToSplitAndRedo(t,e,null,l.localize({key:"cannotWorkspaceRedoDueToInProgressUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because there is already an undo or redo operation running on {1}",e.label,i.join(", "))):s.isValid()?null:this._tryToSplitAndRedo(t,e,null,l.localize({key:"cannotWorkspaceRedoDueToInMeantimeUndoRedo",comment:["{0} is a label for an operation. {1} is a list of filenames."]},"Could not redo '{0}' across all files because an undo or redo operation occurred in the meantime",e.label))}_workspaceRedo(t,e){const s=this._getAffectedEditStacks(e),o=this._checkWorkspaceRedo(t,e,s,!1);return o?o.returnValue:this._executeWorkspaceRedo(t,e,s)}async _executeWorkspaceRedo(t,e,s){let o;try{o=await this._invokeWorkspacePrepare(e)}catch(i){return this._onError(i,e)}const r=this._checkWorkspaceRedo(t,e,s,!0);if(r)return o.dispose(),r.returnValue;for(const i of s.editStacks)i.moveForward(e);return this._safeInvokeWithLocks(e,()=>e.actual.redo(),s,o,()=>this._continueRedoInGroup(e.groupId))}_resourceRedo(t,e){if(!e.isValid){t.flushAllElements();return}if(t.locked){const s=l.localize({key:"cannotResourceRedoDueToInProgressUndoRedo",comment:["{0} is a label for an operation."]},"Could not redo '{0}' because there is already an undo or redo operation running.",e.label);this._notificationService.warn(s);return}return this._invokeResourcePrepare(e,s=>(t.moveForward(e),this._safeInvokeWithLocks(e,()=>e.actual.redo(),new v([t]),s,()=>this._continueRedoInGroup(e.groupId))))}_findClosestRedoElementInGroup(t){if(!t)return[null,null];let e=null,s=null;for(const[o,r]of this._editStacks){const i=r.getClosestFutureElement();i&&i.groupId===t&&(!e||i.groupOrder<e.groupOrder)&&(e=i,s=o)}return[e,s]}_continueRedoInGroup(t){if(!t)return;const[,e]=this._findClosestRedoElementInGroup(t);if(e)return this._redo(e)}redo(t){if(t instanceof f){const[,e]=this._findClosestRedoElementWithSource(t.id);return e?this._redo(e):void 0}return typeof t=="string"?this._redo(t):this._redo(this.getUriComparisonKey(t))}_redo(t){if(!this._editStacks.has(t))return;const e=this._editStacks.get(t),s=e.getClosestFutureElement();if(s){if(s.groupId){const[o,r]=this._findClosestRedoElementInGroup(s.groupId);if(s!==o&&r)return this._redo(r)}try{return s.type===u.Workspace?this._workspaceRedo(t,s):this._resourceRedo(e,s)}finally{h&&this._print("redo")}}}};m=S([b(0,A),b(1,z)],m);class _{constructor(t){this.returnValue=t}}K(x,m,T.Delayed);export{m as UndoRedoService};
