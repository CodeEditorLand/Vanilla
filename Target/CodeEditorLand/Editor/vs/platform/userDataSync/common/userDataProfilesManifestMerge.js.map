{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/userDataSync/common/userDataProfilesManifestMerge.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from \"../../../base/common/objects.js\";\nimport type {\n\tIUserDataProfile,\n\tUseDefaultProfileFlags,\n} from \"../../userDataProfile/common/userDataProfile.js\";\nimport type { ISyncUserDataProfile } from \"./userDataSync.js\";\n\ninterface IRelaxedMergeResult {\n\tlocal: {\n\t\tadded: ISyncUserDataProfile[];\n\t\tremoved: IUserDataProfile[];\n\t\tupdated: ISyncUserDataProfile[];\n\t};\n\tremote: {\n\t\tadded: IUserDataProfile[];\n\t\tremoved: ISyncUserDataProfile[];\n\t\tupdated: IUserDataProfile[];\n\t} | null;\n}\n\nexport type IMergeResult = Required<IRelaxedMergeResult>;\n\ninterface IUserDataProfileInfo {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly shortName?: string;\n\treadonly icon?: string;\n\treadonly useDefaultFlags?: UseDefaultProfileFlags;\n}\n\nexport function merge(\n\tlocal: IUserDataProfile[],\n\tremote: ISyncUserDataProfile[] | null,\n\tlastSync: ISyncUserDataProfile[] | null,\n\tignored: string[],\n): IMergeResult {\n\tconst localResult: {\n\t\tadded: ISyncUserDataProfile[];\n\t\tremoved: IUserDataProfile[];\n\t\tupdated: ISyncUserDataProfile[];\n\t} = { added: [], removed: [], updated: [] };\n\tlet remoteResult: {\n\t\tadded: IUserDataProfile[];\n\t\tremoved: ISyncUserDataProfile[];\n\t\tupdated: IUserDataProfile[];\n\t} | null = { added: [], removed: [], updated: [] };\n\n\tif (!remote) {\n\t\tconst added = local.filter(({ id }) => !ignored.includes(id));\n\t\tif (added.length) {\n\t\t\tremoteResult.added = added;\n\t\t} else {\n\t\t\tremoteResult = null;\n\t\t}\n\t\treturn {\n\t\t\tlocal: localResult,\n\t\t\tremote: remoteResult,\n\t\t};\n\t}\n\n\tconst localToRemote = compare(local, remote, ignored);\n\tif (\n\t\tlocalToRemote.added.length > 0 ||\n\t\tlocalToRemote.removed.length > 0 ||\n\t\tlocalToRemote.updated.length > 0\n\t) {\n\t\tconst baseToLocal = compare(lastSync, local, ignored);\n\t\tconst baseToRemote = compare(lastSync, remote, ignored);\n\n\t\t// Remotely removed profiles\n\t\tfor (const id of baseToRemote.removed) {\n\t\t\tconst e = local.find((profile) => profile.id === id);\n\t\t\tif (e) {\n\t\t\t\tlocalResult.removed.push(e);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely added profiles\n\t\tfor (const id of baseToRemote.added) {\n\t\t\tconst remoteProfile = remote.find((profile) => profile.id === id)!;\n\t\t\t// Got added in local\n\t\t\tif (baseToLocal.added.includes(id)) {\n\t\t\t\t// Is different from local to remote\n\t\t\t\tif (localToRemote.updated.includes(id)) {\n\t\t\t\t\t// Remote wins always\n\t\t\t\t\tlocalResult.updated.push(remoteProfile);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalResult.added.push(remoteProfile);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely updated profiles\n\t\tfor (const id of baseToRemote.updated) {\n\t\t\t// Remote wins always\n\t\t\tlocalResult.updated.push(\n\t\t\t\tremote.find((profile) => profile.id === id)!,\n\t\t\t);\n\t\t}\n\n\t\t// Locally added profiles\n\t\tfor (const id of baseToLocal.added) {\n\t\t\t// Not there in remote\n\t\t\tif (!baseToRemote.added.includes(id)) {\n\t\t\t\tremoteResult.added.push(\n\t\t\t\t\tlocal.find((profile) => profile.id === id)!,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Locally updated profiles\n\t\tfor (const id of baseToLocal.updated) {\n\t\t\t// If removed in remote\n\t\t\tif (baseToRemote.removed.includes(id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If not updated in remote\n\t\t\tif (!baseToRemote.updated.includes(id)) {\n\t\t\t\tremoteResult.updated.push(\n\t\t\t\t\tlocal.find((profile) => profile.id === id)!,\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\t// Locally removed profiles\n\t\tfor (const id of baseToLocal.removed) {\n\t\t\tconst removedProfile = remote.find((profile) => profile.id === id);\n\t\t\tif (removedProfile) {\n\t\t\t\tremoteResult.removed.push(removedProfile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (\n\t\tremoteResult.added.length === 0 &&\n\t\tremoteResult.removed.length === 0 &&\n\t\tremoteResult.updated.length === 0\n\t) {\n\t\tremoteResult = null;\n\t}\n\n\treturn { local: localResult, remote: remoteResult };\n}\n\nfunction compare(\n\tfrom: IUserDataProfileInfo[] | null,\n\tto: IUserDataProfileInfo[],\n\tignoredProfiles: string[],\n): { added: string[]; removed: string[]; updated: string[] } {\n\tfrom = from ? from.filter(({ id }) => !ignoredProfiles.includes(id)) : [];\n\tto = to.filter(({ id }) => !ignoredProfiles.includes(id));\n\tconst fromKeys = from.map(({ id }) => id);\n\tconst toKeys = to.map(({ id }) => id);\n\tconst added = toKeys.filter((key) => !fromKeys.includes(key));\n\tconst removed = fromKeys.filter((key) => !toKeys.includes(key));\n\tconst updated: string[] = [];\n\n\tfor (const { id, name, shortName, icon, useDefaultFlags } of from) {\n\t\tif (removed.includes(id)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst toProfile = to.find((p) => p.id === id);\n\t\tif (\n\t\t\t!toProfile ||\n\t\t\ttoProfile.name !== name ||\n\t\t\ttoProfile.shortName !== shortName ||\n\t\t\ttoProfile.icon !== icon ||\n\t\t\t!equals(toProfile.useDefaultFlags, useDefaultFlags)\n\t\t) {\n\t\t\tupdated.push(id);\n\t\t}\n\t}\n\n\treturn { added, removed, updated };\n}\n"],
  "mappings": "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",
  "names": []
}
