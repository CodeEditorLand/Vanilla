{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/userDataSync/common/userDataProfilesManifestMerge.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { equals } from '../../../base/common/objects.js';\nimport { IUserDataProfile, UseDefaultProfileFlags } from '../../userDataProfile/common/userDataProfile.js';\nimport { ISyncUserDataProfile } from './userDataSync.js';\n\ninterface IRelaxedMergeResult {\n\tlocal: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] };\n\tremote: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null;\n}\n\nexport type IMergeResult = Required<IRelaxedMergeResult>;\n\ninterface IUserDataProfileInfo {\n\treadonly id: string;\n\treadonly name: string;\n\treadonly shortName?: string;\n\treadonly icon?: string;\n\treadonly useDefaultFlags?: UseDefaultProfileFlags;\n}\n\nexport function merge(local: IUserDataProfile[], remote: ISyncUserDataProfile[] | null, lastSync: ISyncUserDataProfile[] | null, ignored: string[]): IMergeResult {\n\tconst localResult: { added: ISyncUserDataProfile[]; removed: IUserDataProfile[]; updated: ISyncUserDataProfile[] } = { added: [], removed: [], updated: [] };\n\tlet remoteResult: { added: IUserDataProfile[]; removed: ISyncUserDataProfile[]; updated: IUserDataProfile[] } | null = { added: [], removed: [], updated: [] };\n\n\tif (!remote) {\n\t\tconst added = local.filter(({ id }) => !ignored.includes(id));\n\t\tif (added.length) {\n\t\t\tremoteResult.added = added;\n\t\t} else {\n\t\t\tremoteResult = null;\n\t\t}\n\t\treturn {\n\t\t\tlocal: localResult,\n\t\t\tremote: remoteResult\n\t\t};\n\t}\n\n\tconst localToRemote = compare(local, remote, ignored);\n\tif (localToRemote.added.length > 0 || localToRemote.removed.length > 0 || localToRemote.updated.length > 0) {\n\n\t\tconst baseToLocal = compare(lastSync, local, ignored);\n\t\tconst baseToRemote = compare(lastSync, remote, ignored);\n\n\t\t// Remotely removed profiles\n\t\tfor (const id of baseToRemote.removed) {\n\t\t\tconst e = local.find(profile => profile.id === id);\n\t\t\tif (e) {\n\t\t\t\tlocalResult.removed.push(e);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely added profiles\n\t\tfor (const id of baseToRemote.added) {\n\t\t\tconst remoteProfile = remote.find(profile => profile.id === id)!;\n\t\t\t// Got added in local\n\t\t\tif (baseToLocal.added.includes(id)) {\n\t\t\t\t// Is different from local to remote\n\t\t\t\tif (localToRemote.updated.includes(id)) {\n\t\t\t\t\t// Remote wins always\n\t\t\t\t\tlocalResult.updated.push(remoteProfile);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tlocalResult.added.push(remoteProfile);\n\t\t\t}\n\t\t}\n\n\t\t// Remotely updated profiles\n\t\tfor (const id of baseToRemote.updated) {\n\t\t\t// Remote wins always\n\t\t\tlocalResult.updated.push(remote.find(profile => profile.id === id)!);\n\t\t}\n\n\t\t// Locally added profiles\n\t\tfor (const id of baseToLocal.added) {\n\t\t\t// Not there in remote\n\t\t\tif (!baseToRemote.added.includes(id)) {\n\t\t\t\tremoteResult.added.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally updated profiles\n\t\tfor (const id of baseToLocal.updated) {\n\t\t\t// If removed in remote\n\t\t\tif (baseToRemote.removed.includes(id)) {\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\t// If not updated in remote\n\t\t\tif (!baseToRemote.updated.includes(id)) {\n\t\t\t\tremoteResult.updated.push(local.find(profile => profile.id === id)!);\n\t\t\t}\n\t\t}\n\n\t\t// Locally removed profiles\n\t\tfor (const id of baseToLocal.removed) {\n\t\t\tconst removedProfile = remote.find(profile => profile.id === id);\n\t\t\tif (removedProfile) {\n\t\t\t\tremoteResult.removed.push(removedProfile);\n\t\t\t}\n\t\t}\n\t}\n\n\tif (remoteResult.added.length === 0 && remoteResult.removed.length === 0 && remoteResult.updated.length === 0) {\n\t\tremoteResult = null;\n\t}\n\n\treturn { local: localResult, remote: remoteResult };\n}\n\nfunction compare(from: IUserDataProfileInfo[] | null, to: IUserDataProfileInfo[], ignoredProfiles: string[]): { added: string[]; removed: string[]; updated: string[] } {\n\tfrom = from ? from.filter(({ id }) => !ignoredProfiles.includes(id)) : [];\n\tto = to.filter(({ id }) => !ignoredProfiles.includes(id));\n\tconst fromKeys = from.map(({ id }) => id);\n\tconst toKeys = to.map(({ id }) => id);\n\tconst added = toKeys.filter(key => !fromKeys.includes(key));\n\tconst removed = fromKeys.filter(key => !toKeys.includes(key));\n\tconst updated: string[] = [];\n\n\tfor (const { id, name, shortName, icon, useDefaultFlags } of from) {\n\t\tif (removed.includes(id)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst toProfile = to.find(p => p.id === id);\n\t\tif (!toProfile\n\t\t\t|| toProfile.name !== name\n\t\t\t|| toProfile.shortName !== shortName\n\t\t\t|| toProfile.icon !== icon\n\t\t\t|| !equals(toProfile.useDefaultFlags, useDefaultFlags)\n\t\t) {\n\t\t\tupdated.push(id);\n\t\t}\n\t}\n\n\treturn { added, removed, updated };\n}\n"],
  "mappings": "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",
  "names": []
}
