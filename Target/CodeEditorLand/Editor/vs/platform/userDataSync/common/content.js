var P;(o=>o.DEFAULT={allowTrailingComma:!0})(P||={});function U(n,o=!1){let e=0,t=n.length,i="",f=0,s=16,p=0;function r(l){let T=0,g=0;for(;T<l;){let u=n.charCodeAt(e);if(u>=48&&u<=57)g=g*16+u-48;else if(u>=65&&u<=70)g=g*16+u-65+10;else if(u>=97&&u<=102)g=g*16+u-97+10;else break;e++,T++}return T<l&&(g=-1),g}function a(l){e=l,i="",f=0,s=16,p=0}function c(){let l=e;if(n.charCodeAt(e)===48)e++;else for(e++;e<n.length&&O(n.charCodeAt(e));)e++;if(e<n.length&&n.charCodeAt(e)===46)if(e++,e<n.length&&O(n.charCodeAt(e)))for(e++;e<n.length&&O(n.charCodeAt(e));)e++;else return p=3,n.substring(l,e);let T=e;if(e<n.length&&(n.charCodeAt(e)===69||n.charCodeAt(e)===101))if(e++,(e<n.length&&n.charCodeAt(e)===43||n.charCodeAt(e)===45)&&e++,e<n.length&&O(n.charCodeAt(e))){for(e++;e<n.length&&O(n.charCodeAt(e));)e++;T=e}else p=3;return n.substring(l,T)}function b(){let l="",T=e;for(;;){if(e>=t){l+=n.substring(T,e),p=2;break}let g=n.charCodeAt(e);if(g===34){l+=n.substring(T,e),e++;break}if(g===92){if(l+=n.substring(T,e),e++,e>=t){p=2;break}switch(n.charCodeAt(e++)){case 34:l+='"';break;case 92:l+="\\";break;case 47:l+="/";break;case 98:l+="\b";break;case 102:l+="\f";break;case 110:l+=`
`;break;case 114:l+="\r";break;case 116:l+="	";break;case 117:{let d=r(4);d>=0?l+=String.fromCharCode(d):p=4;break}default:p=5}T=e;continue}if(g>=0&&g<=31)if(B(g)){l+=n.substring(T,e),p=2;break}else p=6;e++}return l}function m(){if(i="",p=0,f=e,e>=t)return f=t,s=17;let l=n.charCodeAt(e);if(F(l)){do e++,i+=String.fromCharCode(l),l=n.charCodeAt(e);while(F(l));return s=15}if(B(l))return e++,i+=String.fromCharCode(l),l===13&&n.charCodeAt(e)===10&&(e++,i+=`
`),s=14;switch(l){case 123:return e++,s=1;case 125:return e++,s=2;case 91:return e++,s=3;case 93:return e++,s=4;case 58:return e++,s=6;case 44:return e++,s=5;case 34:return e++,i=b(),s=10;case 47:{let T=e-1;if(n.charCodeAt(e+1)===47){for(e+=2;e<t&&!B(n.charCodeAt(e));)e++;return i=n.substring(T,e),s=12}if(n.charCodeAt(e+1)===42){e+=2;let g=t-1,u=!1;for(;e<g;){if(n.charCodeAt(e)===42&&n.charCodeAt(e+1)===47){e+=2,u=!0;break}e++}return u||(e++,p=1),i=n.substring(T,e),s=13}return i+=String.fromCharCode(l),e++,s=16}case 45:if(i+=String.fromCharCode(l),e++,e===t||!O(n.charCodeAt(e)))return s=16;case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return i+=c(),s=11;default:for(;e<t&&h(l);)e++,l=n.charCodeAt(e);if(f!==e){switch(i=n.substring(f,e),i){case"true":return s=8;case"false":return s=9;case"null":return s=7}return s=16}return i+=String.fromCharCode(l),e++,s=16}}function h(l){if(F(l)||B(l))return!1;switch(l){case 125:case 93:case 123:case 91:case 34:case 58:case 44:case 47:return!1}return!0}function k(){let l;do l=m();while(l>=12&&l<=15);return l}return{setPosition:a,getPosition:()=>e,scan:o?k:m,getToken:()=>s,getTokenValue:()=>i,getTokenOffset:()=>f,getTokenLength:()=>e-f,getTokenError:()=>p}}function F(n){return n===32||n===9||n===11||n===12||n===160||n===5760||n>=8192&&n<=8203||n===8239||n===8287||n===12288||n===65279}function B(n){return n===10||n===13||n===8232||n===8233}function O(n){return n>=48&&n<=57}function _(n,o=[],e=P.DEFAULT){let t={type:"array",offset:-1,length:-1,children:[],parent:void 0};function i(r){t.type==="property"&&(t.length=r-t.offset,t=t.parent)}function f(r){return t.children.push(r),r}z(n,{onObjectBegin:r=>{t=f({type:"object",offset:r,length:-1,parent:t,children:[]})},onObjectProperty:(r,a,c)=>{t=f({type:"property",offset:a,length:-1,parent:t,children:[]}),t.children.push({type:"string",value:r,offset:a,length:c,parent:t})},onObjectEnd:(r,a)=>{t.length=r+a-t.offset,t=t.parent,i(r+a)},onArrayBegin:(r,a)=>{t=f({type:"array",offset:r,length:-1,parent:t,children:[]})},onArrayEnd:(r,a)=>{t.length=r+a-t.offset,t=t.parent,i(r+a)},onLiteralValue:(r,a,c)=>{f({type:M(r),offset:a,length:c,parent:t,value:r}),i(a+c)},onSeparator:(r,a,c)=>{t.type==="property"&&(r===":"?t.colonOffset=a:r===","&&i(a))},onError:(r,a,c)=>{o.push({error:r,offset:a,length:c})}},e);let p=t.children[0];return p&&delete p.parent,p}function I(n,o){if(!n)return;let e=n;for(let t of o)if(typeof t=="string"){if(e.type!=="object"||!Array.isArray(e.children))return;let i=!1;for(let f of e.children)if(Array.isArray(f.children)&&f.children[0].value===t){e=f.children[1],i=!0;break}if(!i)return}else{let i=t;if(e.type!=="array"||i<0||!Array.isArray(e.children)||i>=e.children.length)return;e=e.children[i]}return e}function z(n,o,e=P.DEFAULT){let t=U(n,!1);function i(x){return x?()=>x(t.getTokenOffset(),t.getTokenLength()):()=>!0}function f(x){return x?E=>x(E,t.getTokenOffset(),t.getTokenLength()):()=>!0}let s=i(o.onObjectBegin),p=f(o.onObjectProperty),r=i(o.onObjectEnd),a=i(o.onArrayBegin),c=i(o.onArrayEnd),b=f(o.onLiteralValue),m=f(o.onSeparator),h=i(o.onComment),k=f(o.onError),l=e&&e.disallowComments,T=e&&e.allowTrailingComma;function g(){for(;;){let x=t.scan();switch(t.getTokenError()){case 4:u(14);break;case 5:u(15);break;case 3:u(13);break;case 1:l||u(11);break;case 2:u(12);break;case 6:u(16);break}switch(x){case 12:case 13:l?u(10):h();break;case 16:u(1);break;case 15:case 14:break;default:return x}}}function u(x,E=[],V=[]){if(k(x),E.length+V.length>0){let A=t.getToken();for(;A!==17;){if(E.indexOf(A)!==-1){g();break}else if(V.indexOf(A)!==-1)break;A=g()}}}function d(x){let E=t.getTokenValue();return x?b(E):p(E),g(),!0}function y(){switch(t.getToken()){case 11:{let x=0;try{x=JSON.parse(t.getTokenValue()),typeof x!="number"&&(u(2),x=0)}catch{u(2)}b(x);break}case 7:b(null);break;case 8:b(!0);break;case 9:b(!1);break;default:return!1}return g(),!0}function S(){return t.getToken()!==10?(u(3,[],[2,5]),!1):(d(!1),t.getToken()===6?(m(":"),g(),K()||u(4,[],[2,5])):u(5,[],[2,5]),!0)}function v(){s(),g();let x=!1;for(;t.getToken()!==2&&t.getToken()!==17;){if(t.getToken()===5){if(x||u(4,[],[]),m(","),g(),t.getToken()===2&&T)break}else x&&u(6,[],[]);S()||u(4,[],[2,5]),x=!0}return r(),t.getToken()!==2?u(7,[2],[]):g(),!0}function L(){a(),g();let x=!1;for(;t.getToken()!==4&&t.getToken()!==17;){if(t.getToken()===5){if(x||u(4,[],[]),m(","),g(),t.getToken()===4&&T)break}else x&&u(6,[],[]);K()||u(4,[],[4,5]),x=!0}return c(),t.getToken()!==4?u(8,[4],[]):g(),!0}function K(){switch(t.getToken()){case 3:return L();case 1:return v();case 10:return d(!0);default:return y()}}return g(),t.getToken()===17?e.allowEmptyContent?!0:(u(4,[],[]),!1):K()?(t.getToken()!==17&&u(9,[],[]),!0):(u(4,[],[]),!1)}function M(n){switch(typeof n){case"boolean":return"boolean";case"number":return"number";case"string":return"string";case"object":{if(n){if(Array.isArray(n))return"array"}else return"null";return"object"}default:return"null"}}function J(n,o,e){let t,i,f,s,p;if(o){for(s=o.offset,p=s+o.length,f=s;f>0&&!w(n,f-1);)f--;let d=p;for(;d<n.length&&!w(n,d);)d++;i=n.substring(f,d),t=R(i,e)}else i=n,t=0,f=0,s=0,p=n.length;let r=$(e,n),a=!1,c=0,b;e.insertSpaces?b=j(" ",e.tabSize||4):b="	";let m=U(i,!1),h=!1;function k(){return r+j(b,t+c)}function l(){let d=m.scan();for(a=!1;d===15||d===14;)a=a||d===14,d=m.scan();return h=d===16||m.getTokenError()!==0,d}let T=[];function g(d,y,S){!h&&y<p&&S>s&&n.substring(y,S)!==d&&T.push({offset:y,length:S-y,content:d})}let u=l();if(u!==17){let d=m.getTokenOffset()+f,y=j(b,t);g(y,f,d)}for(;u!==17;){let d=m.getTokenOffset()+m.getTokenLength()+f,y=l(),S="";for(;!a&&(y===12||y===13);){let L=m.getTokenOffset()+f;g(" ",d,L),d=m.getTokenOffset()+m.getTokenLength()+f,S=y===12?k():"",y=l()}if(y===2)u!==1&&(c--,S=k());else if(y===4)u!==3&&(c--,S=k());else{switch(u){case 3:case 1:c++,S=k();break;case 5:case 12:S=k();break;case 13:a?S=k():S=" ";break;case 6:S=" ";break;case 10:if(y===6){S="";break}case 7:case 8:case 9:case 11:case 2:case 4:y===12||y===13?S=" ":y!==5&&y!==17&&(h=!0);break;case 16:h=!0;break}a&&(y===12||y===13)&&(S=k())}let v=m.getTokenOffset()+f;g(S,d,v),u=y}return T}function j(n,o){let e="";for(let t=0;t<o;t++)e+=n;return e}function R(n,o){let e=0,t=0,i=o.tabSize||4;for(;e<n.length;){let f=n.charAt(e);if(f===" ")t++;else if(f==="	")t+=i;else break;e++}return Math.floor(t/i)}function $(n,o){for(let e=0;e<o.length;e++){let t=o.charAt(e);if(t==="\r")return e+1<o.length&&o.charAt(e+1)===`
`?`\r
`:"\r";if(t===`
`)return`
`}return n&&n.eol||`
`}function w(n,o){return`\r
`.indexOf(n.charAt(o))!==-1}function Q(n,o,e,t,i){let f=o.slice(),p=_(n,[]),r,a;for(;f.length>0&&(a=f.pop(),r=I(p,f),r===void 0&&e!==void 0);)typeof a=="string"?e={[a]:e}:e=[e];if(r)if(r.type==="object"&&typeof a=="string"&&Array.isArray(r.children)){let c=I(r,[a]);if(c!==void 0)if(e===void 0){if(!c.parent)throw new Error("Malformed AST");let b=r.children.indexOf(c.parent),m,h=c.parent.offset+c.parent.length;if(b>0){let k=r.children[b-1];m=k.offset+k.length}else m=r.offset+1,r.children.length>1&&(h=r.children[1].offset);return N(n,{offset:m,length:h-m,content:""},t)}else return N(n,{offset:c.offset,length:c.length,content:JSON.stringify(e)},t);else{if(e===void 0)return[];let b=`${JSON.stringify(a)}: ${JSON.stringify(e)}`,m=i?i(r.children.map(k=>k.children[0].value)):r.children.length,h;if(m>0){let k=r.children[m-1];h={offset:k.offset+k.length,length:0,content:","+b}}else r.children.length===0?h={offset:r.offset+1,length:0,content:b}:h={offset:r.offset+1,length:0,content:b+","};return N(n,h,t)}}else if(r.type==="array"&&typeof a=="number"&&Array.isArray(r.children))if(e!==void 0){let c=`${JSON.stringify(e)}`,b;if(r.children.length===0||a===0)b={offset:r.offset+1,length:0,content:r.children.length===0?c:c+","};else{let m=a===-1||a>r.children.length?r.children.length:a,h=r.children[m-1];b={offset:h.offset+h.length,length:0,content:","+c}}return N(n,b,t)}else{let c=a,b=r.children[c],m;if(r.children.length===1)m={offset:r.offset+1,length:r.length-2,content:""};else if(r.children.length-1===c){let h=r.children[c-1],k=h.offset+h.length,l=r.offset+r.length;m={offset:k,length:l-2-k,content:""}}else m={offset:b.offset,length:r.children[c+1].offset-b.offset,content:""};return N(n,m,t)}else throw new Error(`Can not add ${typeof a!="number"?"index":"property"} to parent of type ${r.type}`);else return e===void 0?[]:N(n,{offset:p?p.offset:0,length:p?p.length:0,content:JSON.stringify(e)},t)}function N(n,o,e){let t=D(n,o),i=o.offset,f=o.offset+o.content.length;if(o.length===0||o.content.length===0){for(;i>0&&!w(t,i-1);)i--;for(;f<t.length&&!w(t,f);)f++}let s=J(t,{offset:i,length:f-i},e);for(let r=s.length-1;r>=0;r--){let a=s[r];t=D(t,a),i=Math.min(i,a.offset),f=Math.max(f,a.offset+a.length),f+=a.content.length-a.length}let p=n.length-(t.length-f)-i;return[{offset:i,length:p,content:t.substring(i,f)}]}function D(n,o){return n.substring(0,o.offset)+o.content+n.substring(o.offset+o.length)}function ce(n,o,e,t){let i=Q(n,o,e,t)[0];return i&&(n=n.substring(0,i.offset)+i.content+n.substring(i.offset+i.length)),n}function ge(n,o,e){let t=e;for(;t>=0;){if(n.charAt(t)===o.charAt(o.length-1)&&o.length===1)return t+1;if(t--,o.length===2&&t>=0&&n.charAt(t)===o.charAt(0))return t+2}return 0}function me(n,o,e){let t=e;for(;t>=0;)if(n.charAt(t)===o.charAt(o.length-1)&&o.length===1||(t++,o.length===2&&t>=0&&n.charAt(t)===o.charAt(1)))return t;return n.length-1}export{ce as edit,me as getLineEndOffset,ge as getLineStartOffset};
