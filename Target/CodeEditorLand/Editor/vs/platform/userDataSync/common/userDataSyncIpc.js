var h=Object.defineProperty;var v=Object.getOwnPropertyDescriptor;var l=(a,n,e,t)=>{for(var r=t>1?void 0:t?v(n,e):n,c=a.length-1,u;c>=0;c--)(u=a[c])&&(r=(t?u(n,e,r):u(r))||r);return t&&r&&h(n,e,r),r},i=(a,n)=>(e,t)=>n(e,t,a);import{Emitter as S}from"../../../base/common/event.js";import{Disposable as d}from"../../../base/common/lifecycle.js";import{URI as o}from"../../../base/common/uri.js";import{IConfigurationService as y}from"../../configuration/common/configuration.js";import{IProductService as p}from"../../product/common/productService.js";import{IStorageService as D}from"../../storage/common/storage.js";import{AbstractUserDataSyncStoreManagementService as m}from"./userDataSyncStoreService.js";class P{constructor(n){this.service=n}listen(n,e){switch(e){case"onDidChangeAccount":return this.service.onDidChangeAccount;case"onTokenFailed":return this.service.onTokenFailed}throw new Error(`[UserDataSyncAccountServiceChannel] Event not found: ${e}`)}call(n,e,t){switch(e){case"_getInitialData":return Promise.resolve(this.service.account);case"updateAccount":return this.service.updateAccount(t)}throw new Error("Invalid call")}}class E extends d{constructor(e){super();this.channel=e;this.channel.call("_getInitialData").then(t=>{this._account=t,this._register(this.channel.listen("onDidChangeAccount")(r=>{this._account=r,this._onDidChangeAccount.fire(r)}))})}_account;get account(){return this._account}get onTokenFailed(){return this.channel.listen("onTokenFailed")}_onDidChangeAccount=this._register(new S);onDidChangeAccount=this._onDidChangeAccount.event;updateAccount(e){return this.channel.call("updateAccount",e)}}class x{constructor(n){this.service=n}listen(n,e){switch(e){case"onDidChangeUserDataSyncStore":return this.service.onDidChangeUserDataSyncStore}throw new Error(`[UserDataSyncStoreManagementServiceChannel] Event not found: ${e}`)}call(n,e,t){switch(e){case"switch":return this.service.switch(t[0]);case"getPreviousUserDataSyncStore":return this.service.getPreviousUserDataSyncStore()}throw new Error("Invalid call")}}let s=class extends m{constructor(e,t,r,c){super(t,r,c);this.channel=e;this._register(this.channel.listen("onDidChangeUserDataSyncStore")(()=>this.updateUserDataSyncStore()))}async switch(e){return this.channel.call("switch",[e])}async getPreviousUserDataSyncStore(){const e=await this.channel.call("getPreviousUserDataSyncStore");return this.revive(e)}revive(e){return{url:o.revive(e.url),type:e.type,defaultUrl:o.revive(e.defaultUrl),insidersUrl:o.revive(e.insidersUrl),stableUrl:o.revive(e.stableUrl),canSwitch:e.canSwitch,authenticationProviders:e.authenticationProviders}}};s=l([i(1,p),i(2,y),i(3,D)],s);export{P as UserDataSyncAccountServiceChannel,E as UserDataSyncAccountServiceChannelClient,x as UserDataSyncStoreManagementServiceChannel,s as UserDataSyncStoreManagementServiceChannelClient};
