{
  "version": 3,
  "sources": ["../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/userDataSync/common/snippetsMerge.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport { IStringDictionary } from '../../../base/common/collections.js';\n\nexport interface IMergeResult {\n\tlocal: {\n\t\tadded: IStringDictionary<string>;\n\t\tupdated: IStringDictionary<string>;\n\t\tremoved: string[];\n\t};\n\tremote: {\n\t\tadded: IStringDictionary<string>;\n\t\tupdated: IStringDictionary<string>;\n\t\tremoved: string[];\n\t};\n\tconflicts: string[];\n}\n\nexport function merge(local: IStringDictionary<string>, remote: IStringDictionary<string> | null, base: IStringDictionary<string> | null): IMergeResult {\n\tconst localAdded: IStringDictionary<string> = {};\n\tconst localUpdated: IStringDictionary<string> = {};\n\tconst localRemoved: Set<string> = new Set<string>();\n\n\tif (!remote) {\n\t\treturn {\n\t\t\tlocal: { added: localAdded, updated: localUpdated, removed: [...localRemoved.values()] },\n\t\t\tremote: { added: local, updated: {}, removed: [] },\n\t\t\tconflicts: []\n\t\t};\n\t}\n\n\tconst localToRemote = compare(local, remote);\n\tif (localToRemote.added.size === 0 && localToRemote.removed.size === 0 && localToRemote.updated.size === 0) {\n\t\t// No changes found between local and remote.\n\t\treturn {\n\t\t\tlocal: { added: localAdded, updated: localUpdated, removed: [...localRemoved.values()] },\n\t\t\tremote: { added: {}, updated: {}, removed: [] },\n\t\t\tconflicts: []\n\t\t};\n\t}\n\n\tconst baseToLocal = compare(base, local);\n\tconst baseToRemote = compare(base, remote);\n\n\tconst remoteAdded: IStringDictionary<string> = {};\n\tconst remoteUpdated: IStringDictionary<string> = {};\n\tconst remoteRemoved: Set<string> = new Set<string>();\n\n\tconst conflicts: Set<string> = new Set<string>();\n\n\t// Removed snippets in Local\n\tfor (const key of baseToLocal.removed.values()) {\n\t\t// Conflict - Got updated in remote.\n\t\tif (baseToRemote.updated.has(key)) {\n\t\t\t// Add to local\n\t\t\tlocalAdded[key] = remote[key];\n\t\t}\n\t\t// Remove it in remote\n\t\telse {\n\t\t\tremoteRemoved.add(key);\n\t\t}\n\t}\n\n\t// Removed snippets in Remote\n\tfor (const key of baseToRemote.removed.values()) {\n\t\tif (conflicts.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Conflict - Got updated in local\n\t\tif (baseToLocal.updated.has(key)) {\n\t\t\tconflicts.add(key);\n\t\t}\n\t\t// Also remove in Local\n\t\telse {\n\t\t\tlocalRemoved.add(key);\n\t\t}\n\t}\n\n\t// Updated snippets in Local\n\tfor (const key of baseToLocal.updated.values()) {\n\t\tif (conflicts.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Got updated in remote\n\t\tif (baseToRemote.updated.has(key)) {\n\t\t\t// Has different value\n\t\t\tif (localToRemote.updated.has(key)) {\n\t\t\t\tconflicts.add(key);\n\t\t\t}\n\t\t} else {\n\t\t\tremoteUpdated[key] = local[key];\n\t\t}\n\t}\n\n\t// Updated snippets in Remote\n\tfor (const key of baseToRemote.updated.values()) {\n\t\tif (conflicts.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Got updated in local\n\t\tif (baseToLocal.updated.has(key)) {\n\t\t\t// Has different value\n\t\t\tif (localToRemote.updated.has(key)) {\n\t\t\t\tconflicts.add(key);\n\t\t\t}\n\t\t} else if (local[key] !== undefined) {\n\t\t\tlocalUpdated[key] = remote[key];\n\t\t}\n\t}\n\n\t// Added snippets in Local\n\tfor (const key of baseToLocal.added.values()) {\n\t\tif (conflicts.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Got added in remote\n\t\tif (baseToRemote.added.has(key)) {\n\t\t\t// Has different value\n\t\t\tif (localToRemote.updated.has(key)) {\n\t\t\t\tconflicts.add(key);\n\t\t\t}\n\t\t} else {\n\t\t\tremoteAdded[key] = local[key];\n\t\t}\n\t}\n\n\t// Added snippets in remote\n\tfor (const key of baseToRemote.added.values()) {\n\t\tif (conflicts.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\t// Got added in local\n\t\tif (baseToLocal.added.has(key)) {\n\t\t\t// Has different value\n\t\t\tif (localToRemote.updated.has(key)) {\n\t\t\t\tconflicts.add(key);\n\t\t\t}\n\t\t} else {\n\t\t\tlocalAdded[key] = remote[key];\n\t\t}\n\t}\n\n\treturn {\n\t\tlocal: { added: localAdded, removed: [...localRemoved.values()], updated: localUpdated },\n\t\tremote: { added: remoteAdded, removed: [...remoteRemoved.values()], updated: remoteUpdated },\n\t\tconflicts: [...conflicts.values()],\n\t};\n}\n\nfunction compare(from: IStringDictionary<string> | null, to: IStringDictionary<string> | null): { added: Set<string>; removed: Set<string>; updated: Set<string> } {\n\tconst fromKeys = from ? Object.keys(from) : [];\n\tconst toKeys = to ? Object.keys(to) : [];\n\tconst added = toKeys.filter(key => !fromKeys.includes(key)).reduce((r, key) => { r.add(key); return r; }, new Set<string>());\n\tconst removed = fromKeys.filter(key => !toKeys.includes(key)).reduce((r, key) => { r.add(key); return r; }, new Set<string>());\n\tconst updated: Set<string> = new Set<string>();\n\n\tfor (const key of fromKeys) {\n\t\tif (removed.has(key)) {\n\t\t\tcontinue;\n\t\t}\n\t\tconst fromSnippet = from![key]!;\n\t\tconst toSnippet = to![key]!;\n\t\tif (fromSnippet !== toSnippet) {\n\t\t\tupdated.add(key);\n\t\t}\n\t}\n\n\treturn { added, removed, updated };\n}\n\nexport function areSame(a: IStringDictionary<string>, b: IStringDictionary<string>): boolean {\n\tconst { added, removed, updated } = compare(a, b);\n\treturn added.size === 0 && removed.size === 0 && updated.size === 0;\n}\n"],
  "mappings": "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",
  "names": []
}
