var f=Object.defineProperty;var T=Object.getOwnPropertyDescriptor;var d=(i,a,t,e)=>{for(var o=e>1?void 0:e?T(a,t):a,h=i.length-1,c;h>=0;h--)(c=i[h])&&(o=(e?c(a,t,o):c(o))||o);return e&&o&&f(a,t,o),o},l=(i,a)=>(t,e)=>a(t,e,i);import r from"electron";import{Emitter as p,Event as k}from"../../../base/common/event.js";import{Disposable as E}from"../../../base/common/lifecycle.js";import{isLinux as m,isMacintosh as _,isWindows as I}from"../../../base/common/platform.js";import{IConfigurationService as b}from"../../configuration/common/configuration.js";import{createDecorator as w}from"../../instantiation/common/instantiation.js";import{IStateService as D}from"../../state/node/state.js";import"../common/themeService.js";import"../../window/common/window.js";const F="#FFFFFF",B="#1F1F1F",u="#000000",S="#FFFFFF",C="theme",g="themeBackground",v="windowSplash";var s;(t=>(t.DETECT_COLOR_SCHEME="window.autoDetectColorScheme",t.SYSTEM_COLOR_THEME="window.systemColorTheme"))(s||={});const Y=w("themeMainService");let n=class extends E{constructor(t,e){super();this.stateService=t;this.configurationService=e;m||this._register(this.configurationService.onDidChangeConfiguration(o=>{(o.affectsConfiguration(s.SYSTEM_COLOR_THEME)||o.affectsConfiguration(s.DETECT_COLOR_SCHEME))&&this.updateSystemColorTheme()})),this.updateSystemColorTheme(),this._register(k.fromNodeEventEmitter(r.nativeTheme,"updated")(()=>this._onDidChangeColorScheme.fire(this.getColorScheme())))}_onDidChangeColorScheme=this._register(new p);onDidChangeColorScheme=this._onDidChangeColorScheme.event;updateSystemColorTheme(){if(m||this.configurationService.getValue(s.DETECT_COLOR_SCHEME))r.nativeTheme.themeSource="system";else switch(this.configurationService.getValue(s.SYSTEM_COLOR_THEME)){case"dark":r.nativeTheme.themeSource="dark";break;case"light":r.nativeTheme.themeSource="light";break;case"auto":switch(this.getBaseTheme()){case"vs":r.nativeTheme.themeSource="light";break;case"vs-dark":r.nativeTheme.themeSource="dark";break;default:r.nativeTheme.themeSource="system"}break;default:r.nativeTheme.themeSource="system";break}}getColorScheme(){if(I){if(r.nativeTheme.shouldUseHighContrastColors)return{dark:r.nativeTheme.shouldUseInvertedColorScheme,highContrast:!0}}else if(_){if(r.nativeTheme.shouldUseInvertedColorScheme||r.nativeTheme.shouldUseHighContrastColors)return{dark:r.nativeTheme.shouldUseDarkColors,highContrast:!0}}else if(m&&r.nativeTheme.shouldUseHighContrastColors)return{dark:!0,highContrast:!0};return{dark:r.nativeTheme.shouldUseDarkColors,highContrast:!1}}getBackgroundColor(){const t=this.getColorScheme();if(t.highContrast&&this.configurationService.getValue("window.autoDetectHighContrast"))return t.dark?u:S;let e=this.stateService.getItem(g,null);if(!e)switch(this.getBaseTheme()){case"vs":e=F;break;case"hc-black":e=u;break;case"hc-light":e=S;break;default:e=B}return e}getBaseTheme(){switch(this.stateService.getItem(C,"vs-dark").split(" ")[0]){case"vs":return"vs";case"hc-black":return"hc-black";case"hc-light":return"hc-light";default:return"vs-dark"}}saveWindowSplash(t,e){this.stateService.setItems([{key:C,data:e.baseTheme},{key:g,data:e.colorInfo.background},{key:v,data:e}]),typeof t=="number"&&this.updateBackgroundColor(t,e),this.updateSystemColorTheme()}updateBackgroundColor(t,e){for(const o of r.BrowserWindow.getAllWindows())if(o.id===t){o.setBackgroundColor(e.colorInfo.background);break}}getWindowSplash(){return this.stateService.getItem(v)}};n=d([l(0,D),l(1,b)],n);export{Y as IThemeMainService,n as ThemeMainService};
