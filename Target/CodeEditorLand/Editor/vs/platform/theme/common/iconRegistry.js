import{RunOnceScheduler as S}from"../../../base/common/async.js";import{Codicon as d}from"../../../base/common/codicons.js";import{getCodiconFontCharacters as C}from"../../../base/common/codiconsUtil.js";import{Emitter as D}from"../../../base/common/event.js";import"../../../base/common/jsonSchema.js";import{ThemeIcon as s}from"../../../base/common/themables.js";import{isString as h}from"../../../base/common/types.js";import{URI as b}from"../../../base/common/uri.js";import{localize as f}from"../../../nls.js";import{Extensions as x}from"../../jsonschemas/common/jsonContributionRegistry.js";import*as g from"../../registry/common/platform.js";const F={IconContribution:"base.contributions.icons"};var R;(e=>{function r(i,o){let t=i.defaults;for(;s.isThemeIcon(t);){const n=a.getIcon(t.id);if(!n)return;t=n.defaults}return t}e.getDefinition=r})(R||={});var v;(i=>{function r(o){return{weight:o.weight,style:o.style,src:o.src.map(t=>({format:t.format,location:t.location.toString()}))}}i.toJSONObject=r;function e(o){const t=n=>h(n)?n:void 0;if(o&&Array.isArray(o.src)&&o.src.every(n=>h(n.format)&&h(n.location)))return{weight:t(o.weight),style:t(o.style),src:o.src.map(n=>({format:n.format,location:b.parse(n.location)}))}}i.fromJSONObject=e})(v||={});class O{_onDidChange=new D;onDidChange=this._onDidChange.event;iconsById;iconSchema={definitions:{icons:{type:"object",properties:{fontId:{type:"string",description:f("iconDefinition.fontId","The id of the font to use. If not set, the font that is defined first is used.")},fontCharacter:{type:"string",description:f("iconDefinition.fontCharacter","The font character associated with the icon definition.")}},additionalProperties:!1,defaultSnippets:[{body:{fontCharacter:"\\\\e030"}}]}},type:"object",properties:{}};iconReferenceSchema={type:"string",pattern:`^${s.iconNameExpression}$`,enum:[],enumDescriptions:[]};iconFontsById;constructor(){this.iconsById={},this.iconFontsById={}}registerIcon(e,i,o,t){const n=this.iconsById[e];if(n){if(o&&!n.description){n.description=o,this.iconSchema.properties[e].markdownDescription=`${o} $(${e})`;const p=this.iconReferenceSchema.enum.indexOf(e);p!==-1&&(this.iconReferenceSchema.enumDescriptions[p]=o),this._onDidChange.fire()}return n}const c={id:e,description:o,defaults:i,deprecationMessage:t};this.iconsById[e]=c;const I={$ref:"#/definitions/icons"};return t&&(I.deprecationMessage=t),o&&(I.markdownDescription=`${o}: $(${e})`),this.iconSchema.properties[e]=I,this.iconReferenceSchema.enum.push(e),this.iconReferenceSchema.enumDescriptions.push(o||""),this._onDidChange.fire(),{id:e}}deregisterIcon(e){delete this.iconsById[e],delete this.iconSchema.properties[e];const i=this.iconReferenceSchema.enum.indexOf(e);i!==-1&&(this.iconReferenceSchema.enum.splice(i,1),this.iconReferenceSchema.enumDescriptions.splice(i,1)),this._onDidChange.fire()}getIcons(){return Object.keys(this.iconsById).map(e=>this.iconsById[e])}getIcon(e){return this.iconsById[e]}getIconSchema(){return this.iconSchema}getIconReferenceSchema(){return this.iconReferenceSchema}registerIconFont(e,i){const o=this.iconFontsById[e];return o||(this.iconFontsById[e]=i,this._onDidChange.fire(),i)}deregisterIconFont(e){delete this.iconFontsById[e]}getIconFont(e){return this.iconFontsById[e]}toString(){const e=(n,c)=>n.id.localeCompare(c.id),i=n=>{for(;s.isThemeIcon(n.defaults);)n=this.iconsById[n.defaults.id];return`codicon codicon-${n?n.id:""}`},o=[];o.push("| preview     | identifier                        | default codicon ID                | description"),o.push("| ----------- | --------------------------------- | --------------------------------- | --------------------------------- |");const t=Object.keys(this.iconsById).map(n=>this.iconsById[n]);for(const n of t.filter(c=>!!c.description).sort(e))o.push(`|<i class="${i(n)}"></i>|${n.id}|${s.isThemeIcon(n.defaults)?n.defaults.id:n.id}|${n.description||""}|`);o.push("| preview     | identifier                        "),o.push("| ----------- | --------------------------------- |");for(const n of t.filter(c=>!s.isThemeIcon(c.defaults)).sort(e))o.push(`|<i class="${i(n)}"></i>|${n.id}|`);return o.join(`
`)}}const a=new O;g.Registry.add(F.IconContribution,a);function u(r,e,i,o){return a.registerIcon(r,e,i,o)}function q(){return a}function w(){const r=C();for(const e in r){const i="\\"+r[e].toString(16);a.registerIcon(e,{fontCharacter:i})}}w();const m="vscode://schemas/icons",l=g.Registry.as(x.JSONContribution);l.registerSchema(m,a.getIconSchema());const y=new S(()=>l.notifySchemaChanged(m),200);a.onDidChange(()=>{y.isScheduled()||y.schedule()});const G=u("widget-close",d.close,f("widgetClose","Icon for the close action in widgets.")),H=u("goto-previous-location",d.arrowUp,f("previousChangeIcon","Icon for goto previous editor location.")),K=u("goto-next-location",d.arrowDown,f("nextChangeIcon","Icon for goto next editor location.")),Q=s.modify(d.sync,"spin"),V=s.modify(d.loading,"spin");export{F as Extensions,R as IconContribution,v as IconFontDefinition,q as getIconRegistry,K as gotoNextLocation,H as gotoPreviousLocation,m as iconsSchemaId,u as registerIcon,V as spinningLoading,Q as syncing,G as widgetClose};
