{
  "version": 3,
  "sources": ["../../../../../../../../Dependency/CodeEditorLand/Editor/Source/vs/platform/markers/test/common/markerService.test.ts"],
  "sourcesContent": ["/*---------------------------------------------------------------------------------------------\n *  Copyright (c) Microsoft Corporation. All rights reserved.\n *  Licensed under the MIT License. See License.txt in the project root for license information.\n *--------------------------------------------------------------------------------------------*/\n\nimport assert from 'assert';\nimport { URI } from '../../../../base/common/uri.js';\nimport { ensureNoDisposablesAreLeakedInTestSuite } from '../../../../base/test/common/utils.js';\nimport { IMarkerData, MarkerSeverity } from '../../common/markers.js';\nimport * as markerService from '../../common/markerService.js';\n\nfunction randomMarkerData(severity = MarkerSeverity.Error): IMarkerData {\n\treturn {\n\t\tseverity,\n\t\tmessage: Math.random().toString(16),\n\t\tstartLineNumber: 1,\n\t\tstartColumn: 1,\n\t\tendLineNumber: 1,\n\t\tendColumn: 1\n\t};\n}\n\nsuite('Marker Service', () => {\n\n\tlet service: markerService.MarkerService;\n\n\tteardown(function () {\n\t\tservice.dispose();\n\t});\n\n\tensureNoDisposablesAreLeakedInTestSuite();\n\n\ttest('query', () => {\n\n\t\tservice = new markerService.MarkerService();\n\n\t\tservice.changeAll('far', [{\n\t\t\tresource: URI.parse('file:///c/test/file.cs'),\n\t\t\tmarker: randomMarkerData(MarkerSeverity.Error)\n\t\t}]);\n\n\t\tassert.strictEqual(service.read().length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\t\tassert.strictEqual(service.read({ resource: URI.parse('file:///c/test/file.cs') }).length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'far', resource: URI.parse('file:///c/test/file.cs') }).length, 1);\n\n\n\t\tservice.changeAll('boo', [{\n\t\t\tresource: URI.parse('file:///c/test/file.cs'),\n\t\t\tmarker: randomMarkerData(MarkerSeverity.Warning)\n\t\t}]);\n\n\t\tassert.strictEqual(service.read().length, 2);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 1);\n\n\t\tassert.strictEqual(service.read({ severities: MarkerSeverity.Error }).length, 1);\n\t\tassert.strictEqual(service.read({ severities: MarkerSeverity.Warning }).length, 1);\n\t\tassert.strictEqual(service.read({ severities: MarkerSeverity.Hint }).length, 0);\n\t\tassert.strictEqual(service.read({ severities: MarkerSeverity.Error | MarkerSeverity.Warning }).length, 2);\n\n\t});\n\n\n\ttest('changeOne override', () => {\n\n\t\tservice = new markerService.MarkerService();\n\t\tservice.changeOne('far', URI.parse('file:///path/only.cs'), [randomMarkerData()]);\n\t\tassert.strictEqual(service.read().length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\n\t\tservice.changeOne('boo', URI.parse('file:///path/only.cs'), [randomMarkerData()]);\n\t\tassert.strictEqual(service.read().length, 2);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 1);\n\n\t\tservice.changeOne('far', URI.parse('file:///path/only.cs'), [randomMarkerData(), randomMarkerData()]);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 2);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 1);\n\n\t});\n\n\ttest('changeOne/All clears', () => {\n\n\t\tservice = new markerService.MarkerService();\n\t\tservice.changeOne('far', URI.parse('file:///path/only.cs'), [randomMarkerData()]);\n\t\tservice.changeOne('boo', URI.parse('file:///path/only.cs'), [randomMarkerData()]);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 1);\n\t\tassert.strictEqual(service.read().length, 2);\n\n\t\tservice.changeOne('far', URI.parse('file:///path/only.cs'), []);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 0);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 1);\n\t\tassert.strictEqual(service.read().length, 1);\n\n\t\tservice.changeAll('boo', []);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 0);\n\t\tassert.strictEqual(service.read({ owner: 'boo' }).length, 0);\n\t\tassert.strictEqual(service.read().length, 0);\n\t});\n\n\ttest('changeAll sends event for cleared', () => {\n\n\t\tservice = new markerService.MarkerService();\n\t\tservice.changeAll('far', [{\n\t\t\tresource: URI.parse('file:///d/path'),\n\t\t\tmarker: randomMarkerData()\n\t\t}, {\n\t\t\tresource: URI.parse('file:///d/path'),\n\t\t\tmarker: randomMarkerData()\n\t\t}]);\n\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 2);\n\n\t\tconst d = service.onMarkerChanged(changedResources => {\n\t\t\tassert.strictEqual(changedResources.length, 1);\n\t\t\tchangedResources.forEach(u => assert.strictEqual(u.toString(), 'file:///d/path'));\n\t\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 0);\n\t\t});\n\n\t\tservice.changeAll('far', []);\n\n\t\td.dispose();\n\t});\n\n\ttest('changeAll merges', () => {\n\t\tservice = new markerService.MarkerService();\n\n\t\tservice.changeAll('far', [{\n\t\t\tresource: URI.parse('file:///c/test/file.cs'),\n\t\t\tmarker: randomMarkerData()\n\t\t}, {\n\t\t\tresource: URI.parse('file:///c/test/file.cs'),\n\t\t\tmarker: randomMarkerData()\n\t\t}]);\n\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 2);\n\t});\n\n\ttest('changeAll must not break integrety, issue #12635', () => {\n\t\tservice = new markerService.MarkerService();\n\n\t\tservice.changeAll('far', [{\n\t\t\tresource: URI.parse('scheme:path1'),\n\t\t\tmarker: randomMarkerData()\n\t\t}, {\n\t\t\tresource: URI.parse('scheme:path2'),\n\t\t\tmarker: randomMarkerData()\n\t\t}]);\n\n\t\tservice.changeAll('boo', [{\n\t\t\tresource: URI.parse('scheme:path1'),\n\t\t\tmarker: randomMarkerData()\n\t\t}]);\n\n\t\tservice.changeAll('far', [{\n\t\t\tresource: URI.parse('scheme:path1'),\n\t\t\tmarker: randomMarkerData()\n\t\t}, {\n\t\t\tresource: URI.parse('scheme:path2'),\n\t\t\tmarker: randomMarkerData()\n\t\t}]);\n\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 2);\n\t\tassert.strictEqual(service.read({ resource: URI.parse('scheme:path1') }).length, 2);\n\t});\n\n\ttest('invalid marker data', () => {\n\n\t\tconst data = randomMarkerData();\n\t\tservice = new markerService.MarkerService();\n\n\t\tdata.message = undefined!;\n\t\tservice.changeOne('far', URI.parse('some:uri/path'), [data]);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 0);\n\n\t\tdata.message = null!;\n\t\tservice.changeOne('far', URI.parse('some:uri/path'), [data]);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 0);\n\n\t\tdata.message = 'null';\n\t\tservice.changeOne('far', URI.parse('some:uri/path'), [data]);\n\t\tassert.strictEqual(service.read({ owner: 'far' }).length, 1);\n\t});\n\n\ttest('MapMap#remove returns bad values, https://github.com/microsoft/vscode/issues/13548', () => {\n\t\tservice = new markerService.MarkerService();\n\n\t\tservice.changeOne('o', URI.parse('some:uri/1'), [randomMarkerData()]);\n\t\tservice.changeOne('o', URI.parse('some:uri/2'), []);\n\n\t});\n\n\ttest('Error code of zero in markers get removed, #31275', function () {\n\t\tconst data = <IMarkerData>{\n\t\t\tcode: '0',\n\t\t\tstartLineNumber: 1,\n\t\t\tstartColumn: 2,\n\t\t\tendLineNumber: 1,\n\t\t\tendColumn: 5,\n\t\t\tmessage: 'test',\n\t\t\tseverity: 0 as MarkerSeverity,\n\t\t\tsource: 'me'\n\t\t};\n\t\tservice = new markerService.MarkerService();\n\n\t\tservice.changeOne('far', URI.parse('some:thing'), [data]);\n\t\tconst marker = service.read({ resource: URI.parse('some:thing') });\n\n\t\tassert.strictEqual(marker.length, 1);\n\t\tassert.strictEqual(marker[0].code, '0');\n\t});\n});\n"],
  "mappings": "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",
  "names": []
}
