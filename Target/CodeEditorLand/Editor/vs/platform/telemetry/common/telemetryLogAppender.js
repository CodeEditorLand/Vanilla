var d=Object.defineProperty;var L=Object.getOwnPropertyDescriptor;var f=(g,o,r,e)=>{for(var t=e>1?void 0:e?L(o,r):o,i=g.length-1,n;i>=0;i--)(n=g[i])&&(t=(e?n(o,r,t):n(t))||t);return e&&t&&d(o,r,t),t},s=(g,o)=>(r,e)=>o(r,e,g);import{Disposable as h}from"../../../base/common/lifecycle.js";import{localize as p}from"../../../nls.js";import{IEnvironmentService as I}from"../../environment/common/environment.js";import{ILogService as y,ILoggerService as u,LogLevel as S}from"../../log/common/log.js";import{IProductService as x}from"../../product/common/productService.js";import{isLoggingOnly as P,supportsTelemetry as b,telemetryLogId as m,validateTelemetryData as D}from"./telemetryUtils.js";let l=class extends h{constructor(r,e,t,i,n=""){super();this.prefix=n;const a=e.getLogger(m);if(a)this.logger=this._register(a);else{const v=P(i,t)?" (Not Sent)":"",c=()=>b(i,t)&&r.getLevel()===S.Trace;this.logger=this._register(e.createLogger(m,{name:p("telemetryLog","Telemetry{0}",v),hidden:!c()})),this._register(r.onDidChangeLogLevel(()=>e.setVisibility(m,c()))),this.logger.info("Below are logs for every telemetry event sent from VS Code once the log level is set to trace."),this.logger.info("===========================================================")}}logger;flush(){return Promise.resolve()}log(r,e){this.logger.trace(`${this.prefix}telemetry/${r}`,D(e))}};l=f([s(0,y),s(1,u),s(2,I),s(3,x)],l);export{l as TelemetryLogAppender};
