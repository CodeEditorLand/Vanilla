import{streamToBuffer as u}from"../../../base/common/buffer.js";import{CancellationToken as p}from"../../../base/common/cancellation.js";import"../../../base/parts/request/common/request.js";import"../../request/common/request.js";import*as c from"https";import{AbstractOneDataSystemAppender as m}from"../common/1dsAppender.js";async function f(t,e){const s=await e.request(t,p.None),o=(await u(s.stream)).toString(),n=s.res.statusCode??200;return{headers:s.res.headers,statusCode:n,responseData:o}}async function h(t){const e={method:t.type,headers:t.headers};return new Promise((o,n)=>{const r=c.request(t.url??"",e,a=>{a.on("data",function(i){o({headers:a.headers,statusCode:a.statusCode??200,responseData:i.toString()})}),a.on("error",function(i){n(i)})});r.write(t.data,a=>{a&&n(a)}),r.end()})}async function g(t,e,s){const o=typeof e.data=="string"?e.data:new TextDecoder().decode(e.data),n={type:"POST",headers:{...e.headers,"Content-Type":"application/json","Content-Length":Buffer.byteLength(e.data).toString()},url:e.urlString,data:o};try{const r=t?await f(n,t):await h(n);s(r.statusCode,r.headers,r.responseData)}catch{s(0,{})}}class P extends m{constructor(e,s,o,n,r){const a={sendPOST:(i,d)=>{g(e,i,d)}};super(s,o,n,r,a)}}export{P as OneDataSystemAppender};
