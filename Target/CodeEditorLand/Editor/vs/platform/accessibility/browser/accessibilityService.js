var g=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var u=(s,n,e,i)=>{for(var t=i>1?void 0:i?p(n,e):n,o=s.length-1,r;o>=0;o--)(r=s[o])&&(t=(i?r(n,e,t):r(t))||t);return i&&t&&g(n,e,t),t},d=(s,n)=>(e,i)=>n(e,i,s);import{addDisposableListener as _}from"../../../base/browser/dom.js";import{alert as f,status as m}from"../../../base/browser/ui/aria/aria.js";import{mainWindow as y}from"../../../base/browser/window.js";import{Emitter as a}from"../../../base/common/event.js";import{Disposable as v}from"../../../base/common/lifecycle.js";import{AccessibilitySupport as h,CONTEXT_ACCESSIBILITY_MODE_ENABLED as C}from"../common/accessibility.js";import{IConfigurationService as b}from"../../configuration/common/configuration.js";import{IContextKeyService as S}from"../../contextkey/common/contextkey.js";import{ILayoutService as M}from"../../layout/browser/layoutService.js";let c=class extends v{constructor(e,i,t){super();this._contextKeyService=e;this._layoutService=i;this._configurationService=t;this._accessibilityModeEnabledContext=C.bindTo(this._contextKeyService);const o=()=>this._accessibilityModeEnabledContext.set(this.isScreenReaderOptimized());this._register(this._configurationService.onDidChangeConfiguration(l=>{l.affectsConfiguration("editor.accessibilitySupport")&&(o(),this._onDidChangeScreenReaderOptimized.fire()),l.affectsConfiguration("workbench.reduceMotion")&&(this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this._onDidChangeReducedMotion.fire())})),o(),this._register(this.onDidChangeScreenReaderOptimized(()=>o()));const r=y.matchMedia("(prefers-reduced-motion: reduce)");this._systemMotionReduced=r.matches,this._configMotionReduced=this._configurationService.getValue("workbench.reduceMotion"),this._linkUnderlinesEnabled=this._configurationService.getValue("accessibility.underlineLinks"),this.initReducedMotionListeners(r),this.initLinkUnderlineListeners()}_accessibilityModeEnabledContext;_accessibilitySupport=h.Unknown;_onDidChangeScreenReaderOptimized=new a;_configMotionReduced;_systemMotionReduced;_onDidChangeReducedMotion=new a;_linkUnderlinesEnabled;_onDidChangeLinkUnderline=new a;initReducedMotionListeners(e){this._register(_(e,"change",()=>{this._systemMotionReduced=e.matches,this._configMotionReduced==="auto"&&this._onDidChangeReducedMotion.fire()}));const i=()=>{const t=this.isMotionReduced();this._layoutService.mainContainer.classList.toggle("reduce-motion",t),this._layoutService.mainContainer.classList.toggle("enable-motion",!t)};i(),this._register(this.onDidChangeReducedMotion(()=>i()))}initLinkUnderlineListeners(){this._register(this._configurationService.onDidChangeConfiguration(i=>{if(i.affectsConfiguration("accessibility.underlineLinks")){const t=this._configurationService.getValue("accessibility.underlineLinks");this._linkUnderlinesEnabled=t,this._onDidChangeLinkUnderline.fire()}}));const e=()=>{const i=this._linkUnderlinesEnabled;this._layoutService.mainContainer.classList.toggle("underline-links",i)};e(),this._register(this.onDidChangeLinkUnderlines(()=>e()))}onDidChangeLinkUnderlines(e){return this._onDidChangeLinkUnderline.event(e)}get onDidChangeScreenReaderOptimized(){return this._onDidChangeScreenReaderOptimized.event}isScreenReaderOptimized(){const e=this._configurationService.getValue("editor.accessibilitySupport");return e==="on"||e==="auto"&&this._accessibilitySupport===h.Enabled}get onDidChangeReducedMotion(){return this._onDidChangeReducedMotion.event}isMotionReduced(){const e=this._configMotionReduced;return e==="on"||e==="auto"&&this._systemMotionReduced}alwaysUnderlineAccessKeys(){return Promise.resolve(!1)}getAccessibilitySupport(){return this._accessibilitySupport}setAccessibilitySupport(e){this._accessibilitySupport!==e&&(this._accessibilitySupport=e,this._onDidChangeScreenReaderOptimized.fire())}alert(e){f(e)}status(e){m(e)}};c=u([d(0,S),d(1,M),d(2,b)],c);export{c as AccessibilityService};
