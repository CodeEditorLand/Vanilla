var ke=Object.create;var oe=Object.defineProperty;var De=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Ne=Object.getPrototypeOf,Be=Object.prototype.hasOwnProperty;var p=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,n)=>(typeof require<"u"?require:t)[n]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+e+'" is not supported')});var O=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var Le=(e,t,n,r)=>{if(t&&typeof t=="object"||typeof t=="function")for(let o of Ie(t))!Be.call(e,o)&&o!==n&&oe(e,o,{get:()=>t[o],enumerable:!(r=De(t,o))||r.enumerable});return e};var se=(e,t,n)=>(n=e!=null?ke(Ne(e)):{},Le(t||!e||!e.__esModule?oe(n,"default",{value:e,enumerable:!0}):n,e));var ce=O((qt,ue)=>{"use strict";var D=1e3,I=D*60,N=I*60,j=N*24,$e=j*7,Ue=j*365.25;ue.exports=function(e,t){t=t||{};var n=typeof e;if(n==="string"&&e.length>0)return qe(e);if(n==="number"&&isFinite(e))return t.long?Ke(e):He(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))};function qe(e){if(e=String(e),!(e.length>100)){var t=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(t){var n=parseFloat(t[1]),r=(t[2]||"ms").toLowerCase();switch(r){case"years":case"year":case"yrs":case"yr":case"y":return n*Ue;case"weeks":case"week":case"w":return n*$e;case"days":case"day":case"d":return n*j;case"hours":case"hour":case"hrs":case"hr":case"h":return n*N;case"minutes":case"minute":case"mins":case"min":case"m":return n*I;case"seconds":case"second":case"secs":case"sec":case"s":return n*D;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}function He(e){var t=Math.abs(e);return t>=j?Math.round(e/j)+"d":t>=N?Math.round(e/N)+"h":t>=I?Math.round(e/I)+"m":t>=D?Math.round(e/D)+"s":e+"ms"}function Ke(e){var t=Math.abs(e);return t>=j?H(e,t,j,"day"):t>=N?H(e,t,N,"hour"):t>=I?H(e,t,I,"minute"):t>=D?H(e,t,D,"second"):e+" ms"}function H(e,t,n,r){var o=t>=n*1.5;return Math.round(e/n)+" "+r+(o?"s":"")}});var X=O((Ht,ae)=>{"use strict";function ze(e){n.debug=n,n.default=n,n.coerce=m,n.disable=i,n.enable=o,n.enabled=l,n.humanize=ce(),n.destroy=_,Object.keys(e).forEach(s=>{n[s]=e[s]}),n.names=[],n.skips=[],n.formatters={};function t(s){let u=0;for(let c=0;c<s.length;c++)u=(u<<5)-u+s.charCodeAt(c),u|=0;return n.colors[Math.abs(u)%n.colors.length]}n.selectColor=t;function n(s){let u,c=null,A,M;function g(...h){if(!g.enabled)return;let F=g,v=Number(new Date),R=v-(u||v);F.diff=R,F.prev=u,F.curr=v,u=v,h[0]=n.coerce(h[0]),typeof h[0]!="string"&&h.unshift("%O");let S=0;h[0]=h[0].replace(/%([a-zA-Z%])/g,(E,k)=>{if(E==="%%")return"%";S++;let re=n.formatters[k];if(typeof re=="function"){let Me=h[S];E=re.call(F,Me),h.splice(S,1),S--}return E}),n.formatArgs.call(F,h),(F.log||n.log).apply(F,h)}return g.namespace=s,g.useColors=n.useColors(),g.color=n.selectColor(s),g.extend=r,g.destroy=n.destroy,Object.defineProperty(g,"enabled",{enumerable:!0,configurable:!1,get:()=>c!==null?c:(A!==n.namespaces&&(A=n.namespaces,M=n.enabled(s)),M),set:h=>{c=h}}),typeof n.init=="function"&&n.init(g),g}function r(s,u){let c=n(this.namespace+(typeof u>"u"?":":u)+s);return c.log=this.log,c}function o(s){n.save(s),n.namespaces=s,n.names=[],n.skips=[];let u,c=(typeof s=="string"?s:"").split(/[\s,]+/),A=c.length;for(u=0;u<A;u++)c[u]&&(s=c[u].replace(/\*/g,".*?"),s[0]==="-"?n.skips.push(new RegExp("^"+s.slice(1)+"$")):n.names.push(new RegExp("^"+s+"$")))}function i(){let s=[...n.names.map(a),...n.skips.map(a).map(u=>"-"+u)].join(",");return n.enable(""),s}function l(s){if(s[s.length-1]==="*")return!0;let u,c;for(u=0,c=n.skips.length;u<c;u++)if(n.skips[u].test(s))return!1;for(u=0,c=n.names.length;u<c;u++)if(n.names[u].test(s))return!0;return!1}function a(s){return s.toString().substring(2,s.toString().length-2).replace(/\.\*\?$/,"*")}function m(s){return s instanceof Error?s.stack||s.message:s}function _(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return n.enable(n.load()),n}ae.exports=ze});var le=O((C,K)=>{"use strict";C.formatArgs=Ye;C.save=Ve;C.load=Je;C.useColors=Ge;C.storage=We();C.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})();C.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function Ge(){if(typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs))return!0;if(typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;let e;return typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&(e=navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/))&&parseInt(e[1],10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function Ye(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+K.exports.humanize(this.diff),!this.useColors)return;let t="color: "+this.color;e.splice(1,0,t,"color: inherit");let n=0,r=0;e[0].replace(/%[a-zA-Z%]/g,o=>{o!=="%%"&&(n++,o==="%c"&&(r=n))}),e.splice(r,0,t)}C.log=console.debug||console.log||(()=>{});function Ve(e){try{e?C.storage.setItem("debug",e):C.storage.removeItem("debug")}catch{}}function Je(){let e;try{e=C.storage.getItem("debug")}catch{}return!e&&typeof process<"u"&&"env"in process&&(e=process.env.DEBUG),e}function We(){try{return localStorage}catch{}}K.exports=X()(C);var{formatters:Xe}=K.exports;Xe.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}});var pe=O((Kt,fe)=>{"use strict";fe.exports=(e,t)=>{t=t||process.argv;let n=e.startsWith("-")?"":e.length===1?"-":"--",r=t.indexOf(n+e),o=t.indexOf("--");return r!==-1&&(o===-1?!0:r<o)}});var he=O((zt,de)=>{"use strict";var Ze=p("os"),x=pe(),d=process.env,B;x("no-color")||x("no-colors")||x("color=false")?B=!1:(x("color")||x("colors")||x("color=true")||x("color=always"))&&(B=!0);"FORCE_COLOR"in d&&(B=d.FORCE_COLOR.length===0||parseInt(d.FORCE_COLOR,10)!==0);function Qe(e){return e===0?!1:{level:e,hasBasic:!0,has256:e>=2,has16m:e>=3}}function et(e){if(B===!1)return 0;if(x("color=16m")||x("color=full")||x("color=truecolor"))return 3;if(x("color=256"))return 2;if(e&&!e.isTTY&&B!==!0)return 0;let t=B?1:0;if(process.platform==="win32"){let n=Ze.release().split(".");return Number(process.versions.node.split(".")[0])>=8&&Number(n[0])>=10&&Number(n[2])>=10586?Number(n[2])>=14931?3:2:1}if("CI"in d)return["TRAVIS","CIRCLECI","APPVEYOR","GITLAB_CI"].some(n=>n in d)||d.CI_NAME==="codeship"?1:t;if("TEAMCITY_VERSION"in d)return/^(9\.(0*[1-9]\d*)\.|\d{2,}\.)/.test(d.TEAMCITY_VERSION)?1:0;if(d.COLORTERM==="truecolor")return 3;if("TERM_PROGRAM"in d){let n=parseInt((d.TERM_PROGRAM_VERSION||"").split(".")[0],10);switch(d.TERM_PROGRAM){case"iTerm.app":return n>=3?3:2;case"Apple_Terminal":return 2}}return/-256(color)?$/i.test(d.TERM)?2:/^screen|^xterm|^vt100|^vt220|^rxvt|color|ansi|cygwin|linux/i.test(d.TERM)||"COLORTERM"in d?1:(d.TERM==="dumb",t)}function Z(e){let t=et(e);return Qe(t)}de.exports={supportsColor:Z,stdout:Z(process.stdout),stderr:Z(process.stderr)}});var ge=O((f,G)=>{"use strict";var tt=p("tty"),z=p("util");f.init=ct;f.log=st;f.formatArgs=rt;f.save=it;f.load=ut;f.useColors=nt;f.destroy=z.deprecate(()=>{},"Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.");f.colors=[6,2,3,4,5,1];try{let e=he();e&&(e.stderr||e).level>=2&&(f.colors=[20,21,26,27,32,33,38,39,40,41,42,43,44,45,56,57,62,63,68,69,74,75,76,77,78,79,80,81,92,93,98,99,112,113,128,129,134,135,148,149,160,161,162,163,164,165,166,167,168,169,170,171,172,173,178,179,184,185,196,197,198,199,200,201,202,203,204,205,206,207,208,209,214,215,220,221])}catch{}f.inspectOpts=Object.keys(process.env).filter(e=>/^debug_/i.test(e)).reduce((e,t)=>{let n=t.substring(6).toLowerCase().replace(/_([a-z])/g,(o,i)=>i.toUpperCase()),r=process.env[t];return/^(yes|on|true|enabled)$/i.test(r)?r=!0:/^(no|off|false|disabled)$/i.test(r)?r=!1:r==="null"?r=null:r=Number(r),e[n]=r,e},{});function nt(){return"colors"in f.inspectOpts?!!f.inspectOpts.colors:tt.isatty(process.stderr.fd)}function rt(e){let{namespace:t,useColors:n}=this;if(n){let r=this.color,o="\x1B[3"+(r<8?r:"8;5;"+r),i=`  ${o};1m${t} \x1B[0m`;e[0]=i+e[0].split(`
`).join(`
`+i),e.push(o+"m+"+G.exports.humanize(this.diff)+"\x1B[0m")}else e[0]=ot()+t+" "+e[0]}function ot(){return f.inspectOpts.hideDate?"":new Date().toISOString()+" "}function st(...e){return process.stderr.write(z.formatWithOptions(f.inspectOpts,...e)+`
`)}function it(e){e?process.env.DEBUG=e:delete process.env.DEBUG}function ut(){return process.env.DEBUG}function ct(e){e.inspectOpts={};let t=Object.keys(f.inspectOpts);for(let n=0;n<t.length;n++)e.inspectOpts[t[n]]=f.inspectOpts[t[n]]}G.exports=X()(f);var{formatters:ye}=G.exports;ye.o=function(e){return this.inspectOpts.colors=this.useColors,z.inspect(e,this.inspectOpts).split(`
`).map(t=>t.trim()).join(" ")};ye.O=function(e){return this.inspectOpts.colors=this.useColors,z.inspect(e,this.inspectOpts)}});var Y=O((Gt,Q)=>{"use strict";typeof process>"u"||process.type==="renderer"||process.browser===!0||process.__nwjs?Q.exports=le():Q.exports=ge()});var me=O(y=>{"use strict";var at=y&&y.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),lt=y&&y.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ce=y&&y.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&at(t,e,n);return lt(t,e),t};Object.defineProperty(y,"__esModule",{value:!0});y.req=y.json=y.toBuffer=void 0;var ft=Ce(p("http")),pt=Ce(p("https"));async function be(e){let t=0,n=[];for await(let r of e)t+=r.length,n.push(r);return Buffer.concat(n,t)}y.toBuffer=be;async function dt(e){let n=(await be(e)).toString("utf8");try{return JSON.parse(n)}catch(r){let o=r;throw o.message+=` (input: ${n})`,o}}y.json=dt;function ht(e,t={}){let r=((typeof e=="string"?e:e.href).startsWith("https:")?pt:ft).request(e,t),o=new Promise((i,l)=>{r.once("response",i).once("error",l).end()});return r.then=o.then.bind(o),r}y.req=ht});var te=O(b=>{"use strict";var Oe=b&&b.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),yt=b&&b.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),we=b&&b.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Oe(t,e,n);return yt(t,e),t},gt=b&&b.__exportStar||function(e,t){for(var n in e)n!=="default"&&!Object.prototype.hasOwnProperty.call(t,n)&&Oe(t,e,n)};Object.defineProperty(b,"__esModule",{value:!0});b.Agent=void 0;var Ct=we(p("net")),_e=we(p("http")),bt=p("https");gt(me(),b);var P=Symbol("AgentBaseInternalState"),ee=class extends _e.Agent{constructor(t){super(t),this[P]={}}isSecureEndpoint(t){if(t){if(typeof t.secureEndpoint=="boolean")return t.secureEndpoint;if(typeof t.protocol=="string")return t.protocol==="https:"}let{stack:n}=new Error;return typeof n!="string"?!1:n.split(`
`).some(r=>r.indexOf("(https.js:")!==-1||r.indexOf("node:https:")!==-1)}incrementSockets(t){if(this.maxSockets===1/0&&this.maxTotalSockets===1/0)return null;this.sockets[t]||(this.sockets[t]=[]);let n=new Ct.Socket({writable:!1});return this.sockets[t].push(n),this.totalSocketCount++,n}decrementSockets(t,n){if(!this.sockets[t]||n===null)return;let r=this.sockets[t],o=r.indexOf(n);o!==-1&&(r.splice(o,1),this.totalSocketCount--,r.length===0&&delete this.sockets[t])}getName(t){return(typeof t.secureEndpoint=="boolean"?t.secureEndpoint:this.isSecureEndpoint(t))?bt.Agent.prototype.getName.call(this,t):super.getName(t)}createSocket(t,n,r){let o={...n,secureEndpoint:this.isSecureEndpoint(n)},i=this.getName(o),l=this.incrementSockets(i);Promise.resolve().then(()=>this.connect(t,o)).then(a=>{if(this.decrementSockets(i,l),a instanceof _e.Agent)return a.addRequest(t,o);this[P].currentSocket=a,super.createSocket(t,n,r)},a=>{this.decrementSockets(i,l),r(a)})}createConnection(){let t=this[P].currentSocket;if(this[P].currentSocket=void 0,!t)throw new Error("No socket was returned in the `connect()` function");return t}get defaultPort(){return this[P].defaultPort??(this.protocol==="https:"?443:80)}set defaultPort(t){this[P]&&(this[P].defaultPort=t)}get protocol(){return this[P].protocol??(this.isSecureEndpoint()?"https:":"http:")}set protocol(t){this[P]&&(this[P].protocol=t)}};b.Agent=ee});var ve=O(w=>{"use strict";var mt=w&&w.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),_t=w&&w.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),xe=w&&w.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&mt(t,e,n);return _t(t,e),t},Ot=w&&w.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(w,"__esModule",{value:!0});w.HttpProxyAgent=void 0;var wt=xe(p("net")),Tt=xe(p("tls")),xt=Ot(Y()),vt=p("events"),Pt=te(),Te=p("url"),L=(0,xt.default)("http-proxy-agent"),V=class extends Pt.Agent{constructor(t,n){super(n),this.proxy=typeof t=="string"?new Te.URL(t):t,this.proxyHeaders=n?.headers??{},L("Creating new HttpProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),o=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={...n?Ft(n,"headers"):null,host:r,port:o}}addRequest(t,n){t._header=null,this.setRequestProps(t,n),super.addRequest(t,n)}setRequestProps(t,n){let{proxy:r}=this,o=n.secureEndpoint?"https:":"http:",i=t.getHeader("host")||"localhost",l=`${o}//${i}`,a=new Te.URL(t.path,l);n.port!==80&&(a.port=String(n.port)),t.path=String(a);let m=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders};if(r.username||r.password){let _=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;m["Proxy-Authorization"]=`Basic ${Buffer.from(_).toString("base64")}`}m["Proxy-Connection"]||(m["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let _ of Object.keys(m)){let s=m[_];s&&t.setHeader(_,s)}}async connect(t,n){t._header=null,t.path.includes("://")||this.setRequestProps(t,n);let r,o;L("Regenerating stored HTTP header string for request"),t._implicitHeader(),t.outputData&&t.outputData.length>0&&(L("Patching connection write() output buffer with updated header"),r=t.outputData[0].data,o=r.indexOf(`\r
\r
`)+4,t.outputData[0].data=t._header+r.substring(o),L("Output buffer: %o",t.outputData[0].data));let i;return this.proxy.protocol==="https:"?(L("Creating `tls.Socket`: %o",this.connectOpts),i=Tt.connect(this.connectOpts)):(L("Creating `net.Socket`: %o",this.connectOpts),i=wt.connect(this.connectOpts)),await(0,vt.once)(i,"connect"),i}};V.protocols=["http","https"];w.HttpProxyAgent=V;function Ft(e,...t){let n={},r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}});var Pe=O($=>{"use strict";var St=$&&$.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty($,"__esModule",{value:!0});$.parseProxyResponse=void 0;var At=St(Y()),J=(0,At.default)("https-proxy-agent:parse-proxy-response");function Rt(e){return new Promise((t,n)=>{let r=0,o=[];function i(){let s=e.read();s?_(s):e.once("readable",i)}function l(){e.removeListener("end",a),e.removeListener("error",m),e.removeListener("readable",i)}function a(){l(),J("onend"),n(new Error("Proxy connection ended before receiving CONNECT response"))}function m(s){l(),J("onerror %o",s),n(s)}function _(s){o.push(s),r+=s.length;let u=Buffer.concat(o,r),c=u.indexOf(`\r
\r
`);if(c===-1){J("have not received end of HTTP headers yet..."),i();return}let A=u.slice(0,c).toString("ascii").split(`\r
`),M=A.shift();if(!M)return e.destroy(),n(new Error("No header received from proxy CONNECT response"));let g=M.split(" "),h=+g[1],F=g.slice(2).join(" "),v={};for(let R of A){if(!R)continue;let S=R.indexOf(":");if(S===-1)return e.destroy(),n(new Error(`Invalid header from proxy CONNECT response: "${R}"`));let q=R.slice(0,S).toLowerCase(),E=R.slice(S+1).trimStart(),k=v[q];typeof k=="string"?v[q]=[k,E]:Array.isArray(k)?k.push(E):v[q]=E}J("got proxy server response: %o %o",M,v),l(),t({connect:{statusCode:h,statusText:F,headers:v},buffered:u})}e.on("error",m),e.on("end",a),i()})}$.parseProxyResponse=Rt});var Ee=O(T=>{"use strict";var Et=T&&T.__createBinding||(Object.create?function(e,t,n,r){r===void 0&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);(!o||("get"in o?!t.__esModule:o.writable||o.configurable))&&(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){r===void 0&&(r=n),e[r]=t[n]}),jt=T&&T.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Ae=T&&T.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(e!=null)for(var n in e)n!=="default"&&Object.prototype.hasOwnProperty.call(e,n)&&Et(t,e,n);return jt(t,e),t},Re=T&&T.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(T,"__esModule",{value:!0});T.HttpsProxyAgent=void 0;var ne=Ae(p("net")),Fe=Ae(p("tls")),Mt=Re(p("assert")),kt=Re(Y()),Dt=te(),It=p("url"),Nt=Pe(),U=(0,kt.default)("https-proxy-agent"),W=class extends Dt.Agent{constructor(t,n){super(n),this.options={path:void 0},this.proxy=typeof t=="string"?new It.URL(t):t,this.proxyHeaders=n?.headers??{},U("Creating new HttpsProxyAgent instance: %o",this.proxy.href);let r=(this.proxy.hostname||this.proxy.host).replace(/^\[|\]$/g,""),o=this.proxy.port?parseInt(this.proxy.port,10):this.proxy.protocol==="https:"?443:80;this.connectOpts={ALPNProtocols:["http/1.1"],...n?Se(n,"headers"):null,host:r,port:o}}async connect(t,n){let{proxy:r}=this;if(!n.host)throw new TypeError('No "host" provided');let o;if(r.protocol==="https:"){U("Creating `tls.Socket`: %o",this.connectOpts);let c=this.connectOpts.servername||this.connectOpts.host;o=Fe.connect({...this.connectOpts,servername:c})}else U("Creating `net.Socket`: %o",this.connectOpts),o=ne.connect(this.connectOpts);let i=typeof this.proxyHeaders=="function"?this.proxyHeaders():{...this.proxyHeaders},l=ne.isIPv6(n.host)?`[${n.host}]`:n.host,a=`CONNECT ${l}:${n.port} HTTP/1.1\r
`;if(r.username||r.password){let c=`${decodeURIComponent(r.username)}:${decodeURIComponent(r.password)}`;i["Proxy-Authorization"]=`Basic ${Buffer.from(c).toString("base64")}`}i.Host=`${l}:${n.port}`,i["Proxy-Connection"]||(i["Proxy-Connection"]=this.keepAlive?"Keep-Alive":"close");for(let c of Object.keys(i))a+=`${c}: ${i[c]}\r
`;let m=(0,Nt.parseProxyResponse)(o);o.write(`${a}\r
`);let{connect:_,buffered:s}=await m;if(t.emit("proxyConnect",_),this.emit("proxyConnect",_,t),_.statusCode===200){if(t.once("socket",Bt),n.secureEndpoint){U("Upgrading socket connection to TLS");let c=n.servername||n.host;return Fe.connect({...Se(n,"host","path","port"),socket:o,servername:c})}return o}o.destroy();let u=new ne.Socket({writable:!1});return u.readable=!0,t.once("socket",c=>{U("Replaying proxy buffer for failed request"),(0,Mt.default)(c.listenerCount("data")>0),c.push(s),c.push(null)}),u}};W.protocols=["http","https"];T.HttpsProxyAgent=W;function Bt(e){e.resume()}function Se(e,...t){let n={},r;for(r in e)t.includes(r)||(n[r]=e[r]);return n}});import{parse as je}from"url";function ie(e){return e===!0||e===!1}function Lt(e,t){return e.protocol==="http:"?t.HTTP_PROXY||t.http_proxy||null:e.protocol==="https:"&&(t.HTTPS_PROXY||t.https_proxy||t.HTTP_PROXY||t.http_proxy)||null}async function tn(e,t,n={}){let r=je(e),o=n.proxyUrl||Lt(r,t);if(!o)return null;let i=je(o);if(!/^https?:$/.test(i.protocol||""))return null;let l={host:i.hostname||"",port:(i.port?+i.port:0)||(i.protocol==="https"?443:80),auth:i.auth,rejectUnauthorized:ie(n.strictSSL)?n.strictSSL:!0};if(r.protocol==="http:"){let{default:a}=await Promise.resolve().then(()=>se(ve()));return new a.HttpProxyAgent(o,l)}else{let{default:a}=await Promise.resolve().then(()=>se(Ee()));return new a.HttpsProxyAgent(o,l)}}export{tn as getProxyAgent};
