import t from"assert";import{deepClone as n}from"../../../../base/common/objects.js";import{ensureNoDisposablesAreLeakedInTestSuite as l}from"../../../../base/test/common/utils.js";import"../../../action/common/action.js";import"../../../configuration/common/configurationRegistry.js";import{localizeManifest as a}from"../../common/extensionNls.js";import"../../../extensions/common/extensions.js";import{NullLogger as s}from"../../../log/common/log.js";const c={name:"test",publisher:"test",version:"1.0.0",engines:{vscode:"*"},contributes:{commands:[{command:"test.command",title:"%test.command.title%",category:"%test.command.category%"}],authentication:[{id:"test.authentication",label:"%test.authentication.label%"}],configuration:{title:"%test.configuration.title%",properties:{"test.configuration":{type:"string",description:"not important"}}}}};suite("Localize Manifest",()=>{const o=l();test("replaces template strings",function(){const e=a(o.add(new s),n(c),{"test.command.title":"Test Command","test.command.category":"Test Category","test.authentication.label":"Test Authentication","test.configuration.title":"Test Configuration"});t.strictEqual(e.contributes?.commands?.[0].title,"Test Command"),t.strictEqual(e.contributes?.commands?.[0].category,"Test Category"),t.strictEqual(e.contributes?.authentication?.[0].label,"Test Authentication"),t.strictEqual((e.contributes?.configuration).title,"Test Configuration")}),test("replaces template strings with fallback if not found in translations",function(){const e=a(o.add(new s),n(c),{},{"test.command.title":"Test Command","test.command.category":"Test Category","test.authentication.label":"Test Authentication","test.configuration.title":"Test Configuration"});t.strictEqual(e.contributes?.commands?.[0].title,"Test Command"),t.strictEqual(e.contributes?.commands?.[0].category,"Test Category"),t.strictEqual(e.contributes?.authentication?.[0].label,"Test Authentication"),t.strictEqual((e.contributes?.configuration).title,"Test Configuration")}),test("replaces template strings - command title & categories become ILocalizedString",function(){const e=a(o.add(new s),n(c),{"test.command.title":"Befehl test","test.command.category":"Testkategorie","test.authentication.label":"Testauthentifizierung","test.configuration.title":"Testkonfiguration"},{"test.command.title":"Test Command","test.command.category":"Test Category","test.authentication.label":"Test Authentication","test.configuration.title":"Test Configuration"}),i=e.contributes?.commands?.[0].title,r=e.contributes?.commands?.[0].category;t.strictEqual(i.value,"Befehl test"),t.strictEqual(i.original,"Test Command"),t.strictEqual(r.value,"Testkategorie"),t.strictEqual(r.original,"Test Category"),t.strictEqual(e.contributes?.authentication?.[0].label,"Testauthentifizierung"),t.strictEqual((e.contributes?.configuration).title,"Testkonfiguration")}),test("replaces template strings - is best effort #164630",function(){const e={name:"test",publisher:"test",version:"1.0.0",engines:{vscode:"*"},contributes:{authentication:[{id:"test.authentication",label:"%doesnotexist%"}],commands:[{command:"test.command",title:"%test.command.title%",category:"%test.command.category%"}]}},i=a(o.add(new s),n(e),{"test.command.title":"Test Command","test.command.category":"Test Category"});t.strictEqual(i.contributes?.commands?.[0].title,"Test Command"),t.strictEqual(i.contributes?.commands?.[0].category,"Test Category"),t.strictEqual(i.contributes?.authentication?.[0].label,"%doesnotexist%")})});
