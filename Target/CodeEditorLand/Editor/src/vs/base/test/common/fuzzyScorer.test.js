import t from"assert";import{compareItemsByFuzzyScore as I,pieceToQuery as z,prepareQuery as h,scoreFuzzy as v,scoreFuzzy2 as F,scoreItemFuzzy as C}from"../../common/fuzzyScorer.js";import{Schemas as j}from"../../common/network.js";import{basename as M,dirname as x,posix as k,sep as L,win32 as B}from"../../common/path.js";import{isWindows as E}from"../../common/platform.js";import{URI as l}from"../../common/uri.js";import{ensureNoDisposablesAreLeakedInTestSuite as W}from"./utils.js";class H{getItemLabel(e){return M(e.fsPath)}getItemDescription(e){return x(e.fsPath)}getItemPath(e){return e.fsPath}}const i=new H;class R{getItemLabel(e){return M(e.fsPath)}getItemDescription(e){return k.normalize(x(e.path))}getItemPath(e){return k.normalize(e.path)}}const w=new R;class P{getItemLabel(e){return M(e.fsPath)}getItemDescription(e){return B.normalize(x(e.path))}getItemPath(e){return B.normalize(e.path)}}const A=new P;class T{getItemLabel(e){}getItemDescription(e){}getItemPath(e){}}function q(r,e,c){const o=h(e);return v(r,o.normalized,o.normalizedLowercase,c??!o.expectContiguousMatch)}function f(r,e,c=0){const o=h(e);return F(r,o,0,c)}function p(r,e,c,o,s=Object.create(null)){return C(r,h(e),c,o,s)}function n(r,e,c,o,s){return I(r,e,h(c),o,s,Object.create(null))}const U=new T;suite("Fuzzy Scorer",()=>{test("score (fuzzy)",function(){const r="HelLo-World",e=[];e.push(q(r,"HelLo-World",!0)),e.push(q(r,"hello-world",!0)),e.push(q(r,"HW",!0)),e.push(q(r,"hw",!0)),e.push(q(r,"H",!0)),e.push(q(r,"h",!0)),e.push(q(r,"W",!0)),e.push(q(r,"Ld",!0)),e.push(q(r,"ld",!0)),e.push(q(r,"w",!0)),e.push(q(r,"L",!0)),e.push(q(r,"l",!0)),e.push(q(r,"4",!0));const c=e.concat().sort((o,s)=>s[0]-o[0]);t.deepStrictEqual(e,c)}),test("score (non fuzzy)",function(){const r="HelLo-World";t.ok(q(r,"HelLo-World",!1)[0]>0),t.strictEqual(q(r,"HelLo-World",!1)[1].length,11),t.ok(q(r,"hello-world",!1)[0]>0),t.strictEqual(q(r,"HW",!1)[0],0),t.ok(q(r,"h",!1)[0]>0),t.ok(q(r,"ello",!1)[0]>0),t.ok(q(r,"ld",!1)[0]>0),t.strictEqual(q(r,"eo",!1)[0],0)}),test("scoreItem - matches are proper",function(){let r=p(null,"something",!0,i);t.ok(!r.score);const e=l.file("/xyz/some/path/someFile123.txt");r=p(e,"something",!0,U),t.ok(!r.score);const c=p(e,i.getItemPath(e),!0,i);t.ok(c.score),t.strictEqual(c.descriptionMatch.length,1),t.strictEqual(c.labelMatch.length,1),t.strictEqual(c.descriptionMatch[0].start,0),t.strictEqual(c.descriptionMatch[0].end,i.getItemDescription(e).length),t.strictEqual(c.labelMatch[0].start,0),t.strictEqual(c.labelMatch[0].end,i.getItemLabel(e).length);const o=p(e,"som",!0,i);t.ok(o.score),t.ok(!o.descriptionMatch),t.strictEqual(o.labelMatch.length,1),t.strictEqual(o.labelMatch[0].start,0),t.strictEqual(o.labelMatch[0].end,3);const s=p(e,"sF",!0,i);t.ok(s.score),t.ok(!s.descriptionMatch),t.strictEqual(s.labelMatch.length,2),t.strictEqual(s.labelMatch[0].start,0),t.strictEqual(s.labelMatch[0].end,1),t.strictEqual(s.labelMatch[1].start,4),t.strictEqual(s.labelMatch[1].end,5);const a=p(e,"of",!0,i);t.ok(a.score),t.ok(!a.descriptionMatch),t.strictEqual(a.labelMatch.length,2),t.strictEqual(a.labelMatch[0].start,1),t.strictEqual(a.labelMatch[0].end,2),t.strictEqual(a.labelMatch[1].start,4),t.strictEqual(a.labelMatch[1].end,5);const u=p(e,"xyz123",!0,i);t.ok(u.score),t.ok(u.descriptionMatch),t.ok(u.labelMatch),t.strictEqual(u.labelMatch.length,1),t.strictEqual(u.labelMatch[0].start,8),t.strictEqual(u.labelMatch[0].end,11),t.strictEqual(u.descriptionMatch.length,1),t.strictEqual(u.descriptionMatch[0].start,1),t.strictEqual(u.descriptionMatch[0].end,4);const m=p(e,"987",!0,i);t.ok(!m.score),t.ok(!m.labelMatch),t.ok(!m.descriptionMatch);const d=p(e,'"sF"',!0,i);t.ok(!d.score),t.ok(!d.labelMatch),t.ok(!d.descriptionMatch),t.strictEqual(m.score,d.score),t.ok(c.score>o.score),t.ok(o.score>a.score),t.ok(a.score>u.score),t.ok(u.score>m.score)}),test("scoreItem - multiple",function(){const r=l.file("/xyz/some/path/someFile123.txt"),e=p(r,"xyz some",!0,i);t.ok(e.score),t.strictEqual(e.labelMatch?.length,1),t.strictEqual(e.labelMatch[0].start,0),t.strictEqual(e.labelMatch[0].end,4),t.strictEqual(e.descriptionMatch?.length,1),t.strictEqual(e.descriptionMatch[0].start,1),t.strictEqual(e.descriptionMatch[0].end,4);const c=p(r,"some xyz",!0,i);t.ok(c.score),t.strictEqual(e.score,c.score),t.strictEqual(c.labelMatch?.length,1),t.strictEqual(c.labelMatch[0].start,0),t.strictEqual(c.labelMatch[0].end,4),t.strictEqual(c.descriptionMatch?.length,1),t.strictEqual(c.descriptionMatch[0].start,1),t.strictEqual(c.descriptionMatch[0].end,4);const o=p(r,"some xyz file file123",!0,i);t.ok(o.score),t.ok(o.score>c.score),t.strictEqual(o.labelMatch?.length,1),t.strictEqual(o.labelMatch[0].start,0),t.strictEqual(o.labelMatch[0].end,11),t.strictEqual(o.descriptionMatch?.length,1),t.strictEqual(o.descriptionMatch[0].start,1),t.strictEqual(o.descriptionMatch[0].end,4);const s=p(r,"path z y",!0,i);t.ok(s.score),t.ok(s.score<c.score),t.strictEqual(s.labelMatch?.length,0),t.strictEqual(s.descriptionMatch?.length,2),t.strictEqual(s.descriptionMatch[0].start,2),t.strictEqual(s.descriptionMatch[0].end,4),t.strictEqual(s.descriptionMatch[1].start,10),t.strictEqual(s.descriptionMatch[1].end,14)}),test("scoreItem - multiple with cache yields different results",function(){const r=l.file("/xyz/some/path/someFile123.txt"),e={},c=p(r,"xyz sm",!0,i,e);t.ok(c.score);const o=p(r,'xyz "sm"',!0,i,e);t.ok(!o.score)}),test("scoreItem - invalid input",function(){let r=p(null,null,!0,i);t.strictEqual(r.score,0),r=p(null,"null",!0,i),t.strictEqual(r.score,0)}),test("scoreItem - optimize for file paths",function(){const r=l.file("/xyz/others/spath/some/xsp/file123.txt"),e=p(r,"xspfile123",!0,i);t.ok(e.score),t.ok(e.descriptionMatch),t.ok(e.labelMatch),t.strictEqual(e.labelMatch.length,1),t.strictEqual(e.labelMatch[0].start,0),t.strictEqual(e.labelMatch[0].end,7),t.strictEqual(e.descriptionMatch.length,1),t.strictEqual(e.descriptionMatch[0].start,23),t.strictEqual(e.descriptionMatch[0].end,26)}),test("scoreItem - avoid match scattering (bug #36119)",function(){const r=l.file("projects/ui/cula/ats/target.mk"),e=p(r,"tcltarget.mk",!0,i);t.ok(e.score),t.ok(e.descriptionMatch),t.ok(e.labelMatch),t.strictEqual(e.labelMatch.length,1),t.strictEqual(e.labelMatch[0].start,0),t.strictEqual(e.labelMatch[0].end,9)}),test("scoreItem - prefers more compact matches",function(){const r=l.file("/1a111d1/11a1d1/something.txt"),e=p(r,"ad",!0,i);t.ok(e.score),t.ok(e.descriptionMatch),t.ok(!e.labelMatch.length),t.strictEqual(e.descriptionMatch.length,2),t.strictEqual(e.descriptionMatch[0].start,11),t.strictEqual(e.descriptionMatch[0].end,12),t.strictEqual(e.descriptionMatch[1].start,13),t.strictEqual(e.descriptionMatch[1].end,14)}),test("scoreItem - proper target offset",function(){const r=l.file("etem"),e=p(r,"teem",!0,i);t.ok(!e.score)}),test("scoreItem - proper target offset #2",function(){const r=l.file("ede"),e=p(r,"de",!0,i);t.strictEqual(e.labelMatch.length,1),t.strictEqual(e.labelMatch[0].start,1),t.strictEqual(e.labelMatch[0].end,3)}),test("scoreItem - proper target offset #3",function(){const r=l.file("/src/vs/editor/browser/viewParts/lineNumbers/flipped-cursor-2x.svg"),e=p(r,"debug",!0,i);t.strictEqual(e.descriptionMatch.length,3),t.strictEqual(e.descriptionMatch[0].start,9),t.strictEqual(e.descriptionMatch[0].end,10),t.strictEqual(e.descriptionMatch[1].start,36),t.strictEqual(e.descriptionMatch[1].end,37),t.strictEqual(e.descriptionMatch[2].start,40),t.strictEqual(e.descriptionMatch[2].end,41),t.strictEqual(e.labelMatch.length,2),t.strictEqual(e.labelMatch[0].start,9),t.strictEqual(e.labelMatch[0].end,10),t.strictEqual(e.labelMatch[1].start,20),t.strictEqual(e.labelMatch[1].end,21)}),test("scoreItem - no match unless query contained in sequence",function(){const r=l.file("abcde"),e=p(r,"edcda",!0,i);t.ok(!e.score)}),test("scoreItem - match if using slash or backslash (local, remote resource)",function(){const r=l.file("abcde/super/duper"),e=l.from({scheme:j.vscodeRemote,path:"abcde/super/duper"});for(const c of[r,e]){let o=p(c,"abcde\\super\\duper",!0,i);t.ok(o.score),o=p(c,"abcde\\super\\duper",!0,w),t.ok(o.score),o=p(c,"abcde\\super\\duper",!0,A),t.ok(o.score),o=p(c,"abcde/super/duper",!0,i),t.ok(o.score),o=p(c,"abcde/super/duper",!0,w),t.ok(o.score),o=p(c,"abcde/super/duper",!0,A),t.ok(o.score)}}),test("scoreItem - ensure upper case bonus only applies on non-consecutive matches (bug #134723)",function(){const r=l.file("ASDFasdfasdf"),e=l.file("asdfasdfasdf");t.ok(p(e,"asdf",!0,i).score>p(r,"asdf",!0,i).score)}),test("compareItemsByScore - identity",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt");let o=i.getItemPath(r),s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),o=i.getItemPath(e),s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - basename prefix",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt");let o=i.getItemLabel(r),s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),o=i.getItemLabel(e),s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - basename camelcase",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt");let o="fA",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),o="fB",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - basename scores",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt");let o="fileA",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),o="fileB",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - path scores",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt");let o="pathfileA",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),o="pathfileB",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - prefer shorter basenames",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileBLonger.txt"),c=l.file("/unrelated/the/path/other/fileC.txt"),o="somepath";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c)}),test("compareFilesByScore - prefer shorter basenames (match on basename)",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileBLonger.txt"),c=l.file("/unrelated/the/path/other/fileC.txt"),o="file";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],c),t.strictEqual(s[2],e),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],c),t.strictEqual(s[2],e)}),test("compareFilesByScore - prefer shorter paths",function(){const r=l.file("/some/path/fileA.txt"),e=l.file("/some/path/other/fileB.txt"),c=l.file("/unrelated/some/path/other/fileC.txt"),o="somepath";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],e),t.strictEqual(s[2],c)}),test("compareFilesByScore - prefer shorter paths (bug #17443)",function(){const r=l.file("config/test/t1.js"),e=l.file("config/test.js"),c=l.file("config/test/t2.js"),o="co/te",s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],e),t.strictEqual(s[1],r),t.strictEqual(s[2],c)}),test("compareFilesByScore - prefer matches in label over description if scores are otherwise equal",function(){const r=l.file("parts/quick/arrow-left-dark.svg"),e=l.file("parts/quickopen/quickopen.ts"),c="partsquick",o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r)}),test("compareFilesByScore - prefer camel case matches",function(){const r=l.file("config/test/NullPointerException.java"),e=l.file("config/test/nopointerexception.java");for(const c of["npe","NPE"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}}),test("compareFilesByScore - prefer more compact camel case matches",function(){const r=l.file("config/test/openthisAnythingHandler.js"),e=l.file("config/test/openthisisnotsorelevantforthequeryAnyHand.js"),c="AH";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}),test("compareFilesByScore - prefer more compact matches (label)",function(){const r=l.file("config/test/examasdaple.js"),e=l.file("config/test/exampleasdaasd.ts"),c="xp";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}),test("compareFilesByScore - prefer more compact matches (path)",function(){const r=l.file("config/test/examasdaple/file.js"),e=l.file("config/test/exampleasdaasd/file.ts"),c="xp";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}),test("compareFilesByScore - prefer more compact matches (label and path)",function(){const r=l.file("config/example/thisfile.ts"),e=l.file("config/24234243244/example/file.js"),c="exfile";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}),test("compareFilesByScore - avoid match scattering (bug #34210)",function(){const r=l.file("node_modules1/bundle/lib/model/modules/ot1/index.js"),e=l.file("node_modules1/bundle/lib/model/modules/un1/index.js"),c=l.file("node_modules1/bundle/lib/model/modules/modu1/index.js"),o=l.file("node_modules1/bundle/lib/model/modules/oddl1/index.js");let s=E?"modu1\\index.js":"modu1/index.js",a=[r,e,c,o].sort((u,m)=>n(u,m,s,!0,i));t.strictEqual(a[0],c),a=[c,e,r,o].sort((u,m)=>n(u,m,s,!0,i)),t.strictEqual(a[0],c),s=E?"un1\\index.js":"un1/index.js",a=[r,e,c,o].sort((u,m)=>n(u,m,s,!0,i)),t.strictEqual(a[0],e),a=[c,e,r,o].sort((u,m)=>n(u,m,s,!0,i)),t.strictEqual(a[0],e)}),test("compareFilesByScore - avoid match scattering (bug #21019 1.)",function(){const r=l.file("app/containers/Services/NetworkData/ServiceDetails/ServiceLoad/index.js"),e=l.file("app/containers/Services/NetworkData/ServiceDetails/ServiceDistribution/index.js"),c=l.file("app/containers/Services/NetworkData/ServiceDetailTabs/ServiceTabs/StatVideo/index.js"),o="StatVideoindex";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],c)}),test("compareFilesByScore - avoid match scattering (bug #21019 2.)",function(){const r=l.file("src/build-helper/store/redux.ts"),e=l.file("src/repository/store/redux.ts"),c="reproreduxts";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #26649)",function(){const r=l.file("photobook/src/components/AddPagesButton/index.js"),e=l.file("photobook/src/components/ApprovalPageHeader/index.js"),c=l.file("photobook/src/canvasComponents/BookPage/index.js"),o="bookpageIndex";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],c),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],c)}),test("compareFilesByScore - avoid match scattering (bug #33247)",function(){const r=l.file("ui/src/utils/constants.js"),e=l.file("ui/src/ui/Icons/index.js"),c=E?"ui\\icons":"ui/icons";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #33247 comment)",function(){const r=l.file("ui/src/components/IDInput/index.js"),e=l.file("ui/src/ui/Input/index.js"),c=E?"ui\\input\\index":"ui/input/index";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #36166)",function(){const r=l.file("django/contrib/sites/locale/ga/LC_MESSAGES/django.mo"),e=l.file("django/core/signals.py"),c="djancosig";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #32918)",function(){const r=l.file("adsys/protected/config.php"),e=l.file("adsys/protected/framework/smarty/sysplugins/smarty_internal_config.php"),c=l.file("duowanVideo/wap/protected/config.php"),o="protectedconfig.php";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],r),t.strictEqual(s[1],c),t.strictEqual(s[2],e),s=[c,e,r].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],r),t.strictEqual(s[1],c),t.strictEqual(s[2],e)}),test("compareFilesByScore - avoid match scattering (bug #14879)",function(){const r=l.file("pkg/search/gradient/testdata/constraint_attrMatchString.yml"),e=l.file("cmd/gradient/main.go"),c="gradientmain";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #14727 1)",function(){const r=l.file("alpha-beta-cappa.txt"),e=l.file("abc.txt"),c="abc";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #14727 2)",function(){const r=l.file("xerxes-yak-zubba/index.js"),e=l.file("xyz/index.js"),c="xyz";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #18381)",function(){const r=l.file("AssymblyInfo.cs"),e=l.file("IAsynchronousTask.java"),c="async";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #35572)",function(){const r=l.file("static/app/source/angluar/-admin/-organization/-settings/layout/layout.js"),e=l.file("static/app/source/angular/-admin/-project/-settings/_settings/settings.js"),c="partisettings";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #36810)",function(){const r=l.file("Trilby.TrilbyTV.Web.Portal/Views/Systems/Index.cshtml"),e=l.file("Trilby.TrilbyTV.Web.Portal/Areas/Admins/Views/Tips/Index.cshtml"),c="tipsindex.cshtml";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - prefer shorter hit (bug #20546)",function(){const r=l.file("editor/core/components/tests/list-view-spec.js"),e=l.file("editor/core/components/list-view.js"),c="listview";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - avoid match scattering (bug #12095)",function(){const r=l.file("src/vs/workbench/contrib/files/common/explorerViewModel.ts"),e=l.file("src/vs/workbench/contrib/files/browser/views/explorerView.ts"),c=l.file("src/vs/workbench/contrib/files/browser/views/explorerViewer.ts"),o="filesexplorerview.ts";let s=[r,e,c].sort((a,u)=>n(a,u,o,!0,i));t.strictEqual(s[0],e),s=[r,c,e].sort((a,u)=>n(a,u,o,!0,i)),t.strictEqual(s[0],e)}),test("compareFilesByScore - prefer case match (bug #96122)",function(){const r=l.file("lists.php"),e=l.file("lib/Lists.php"),c="Lists.php";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e)}),test("compareFilesByScore - prefer shorter match (bug #103052) - foo bar",function(){const r=l.file("app/emails/foo.bar.js"),e=l.file("app/emails/other-footer.other-bar.js");for(const c of["foo bar","foobar"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}}),test("compareFilesByScore - prefer shorter match (bug #103052) - payment model",function(){const r=l.file("app/components/payment/payment.model.js"),e=l.file("app/components/online-payments-history/online-payments-history.model.js");for(const c of["payment model","paymentmodel"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}}),test("compareFilesByScore - prefer shorter match (bug #103052) - color",function(){const r=l.file("app/constants/color.js"),e=l.file("app/components/model/input/pick-avatar-color.js");for(const c of["color js","colorjs"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}}),test("compareFilesByScore - prefer strict case prefix",function(){const r=l.file("app/constants/color.js"),e=l.file("app/components/model/input/Color.js");let c="Color",o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r),c="color",o=[r,e].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}),test("compareFilesByScore - prefer prefix (bug #103052)",function(){const r=l.file("test/smoke/src/main.ts"),e=l.file("src/vs/editor/common/services/semantikTokensProviderStyling.ts"),c="smoke main.ts";let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],r),t.strictEqual(o[1],e),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],r),t.strictEqual(o[1],e)}),test("compareFilesByScore - boost better prefix match if multiple queries are used",function(){const r=l.file("src/vs/workbench/services/host/browser/browserHostService.ts"),e=l.file("src/vs/workbench/browser/workbench.ts");for(const c of["workbench.ts browser","browser workbench.ts","browser workbench","workbench browser"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}}),test("compareFilesByScore - boost shorter prefix match if multiple queries are used",function(){const r=l.file("src/vs/workbench/node/actions/windowActions.ts"),e=l.file("src/vs/workbench/electron-node/window.ts");for(const c of["window node","window.ts node"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}}),test("compareFilesByScore - boost shorter prefix match if multiple queries are used (#99171)",function(){const r=l.file("mesh_editor_lifetime_job.h"),e=l.file("lifetime_job.h");for(const c of["m life, life m"]){let o=[r,e].sort((s,a)=>n(s,a,c,!0,i));t.strictEqual(o[0],e),t.strictEqual(o[1],r),o=[e,r].sort((s,a)=>n(s,a,c,!0,i)),t.strictEqual(o[0],e),t.strictEqual(o[1],r)}}),test("prepareQuery",()=>{t.strictEqual(h(" f*a ").normalized,"fa"),t.strictEqual(h("model Tester.ts").original,"model Tester.ts"),t.strictEqual(h("model Tester.ts").originalLowercase,"model Tester.ts".toLowerCase()),t.strictEqual(h("model Tester.ts").normalized,"modelTester.ts"),t.strictEqual(h("model Tester.ts").expectContiguousMatch,!1),t.strictEqual(h("Model Tester.ts").normalizedLowercase,"modeltester.ts"),t.strictEqual(h("ModelTester.ts").containsPathSeparator,!1),t.strictEqual(h("Model"+L+"Tester.ts").containsPathSeparator,!0),t.strictEqual(h('"hello"').expectContiguousMatch,!0),t.strictEqual(h('"hello"').normalized,"hello");let r=h("He*llo World");t.strictEqual(r.original,"He*llo World"),t.strictEqual(r.normalized,"HelloWorld"),t.strictEqual(r.normalizedLowercase,"HelloWorld".toLowerCase()),t.strictEqual(r.values?.length,2),t.strictEqual(r.values?.[0].original,"He*llo"),t.strictEqual(r.values?.[0].normalized,"Hello"),t.strictEqual(r.values?.[0].normalizedLowercase,"Hello".toLowerCase()),t.strictEqual(r.values?.[1].original,"World"),t.strictEqual(r.values?.[1].normalized,"World"),t.strictEqual(r.values?.[1].normalizedLowercase,"World".toLowerCase());const e=z(r.values);t.strictEqual(e.original,r.original),t.strictEqual(e.values?.length,r.values?.length),t.strictEqual(e.containsPathSeparator,r.containsPathSeparator),r=h(" Hello   World  	"),t.strictEqual(r.original," Hello   World  	"),t.strictEqual(r.originalLowercase," Hello   World  	".toLowerCase()),t.strictEqual(r.normalized,"HelloWorld"),t.strictEqual(r.normalizedLowercase,"HelloWorld".toLowerCase()),t.strictEqual(r.values?.length,2),t.strictEqual(r.values?.[0].original,"Hello"),t.strictEqual(r.values?.[0].originalLowercase,"Hello".toLowerCase()),t.strictEqual(r.values?.[0].normalized,"Hello"),t.strictEqual(r.values?.[0].normalizedLowercase,"Hello".toLowerCase()),t.strictEqual(r.values?.[1].original,"World"),t.strictEqual(r.values?.[1].originalLowercase,"World".toLowerCase()),t.strictEqual(r.values?.[1].normalized,"World"),t.strictEqual(r.values?.[1].normalizedLowercase,"World".toLowerCase()),E?(t.strictEqual(h("C:\\some\\path").pathNormalized,"C:\\some\\path"),t.strictEqual(h("C:\\some\\path").normalized,"C:\\some\\path"),t.strictEqual(h("C:\\some\\path").containsPathSeparator,!0),t.strictEqual(h("C:/some/path").pathNormalized,"C:\\some\\path"),t.strictEqual(h("C:/some/path").normalized,"C:\\some\\path"),t.strictEqual(h("C:/some/path").containsPathSeparator,!0)):(t.strictEqual(h("/some/path").pathNormalized,"/some/path"),t.strictEqual(h("/some/path").normalized,"/some/path"),t.strictEqual(h("/some/path").containsPathSeparator,!0),t.strictEqual(h("\\some\\path").pathNormalized,"/some/path"),t.strictEqual(h("\\some\\path").normalized,"/some/path"),t.strictEqual(h("\\some\\path").containsPathSeparator,!0))}),test("fuzzyScore2 (matching)",function(){const r="HelLo-World";for(const e of[0,3]){let[c,o]=f(e===0?r:`123${r}`,"HelLo-World",e);t.ok(c),t.strictEqual(o.length,1),t.strictEqual(o[0].start,0+e),t.strictEqual(o[0].end,r.length+e),[c,o]=f(e===0?r:`123${r}`,"HW",e),t.ok(c),t.strictEqual(o.length,2),t.strictEqual(o[0].start,0+e),t.strictEqual(o[0].end,1+e),t.strictEqual(o[1].start,6+e),t.strictEqual(o[1].end,7+e)}}),test("fuzzyScore2 (multiple queries)",function(){const r="HelLo-World",[e,c]=f(r,"HelLo"),[o,s]=f(r,"World"),a=[...c||[],...s||[]];let[u,m]=f(r,"HelLo World");function d(){t.ok(u??0>=(e??0)+(o??0));for(let g=0;m&&g<m.length;g++){const b=m[g],y=a[g];b&&y?(t.strictEqual(b.start,y.start),t.strictEqual(b.end,y.end)):t.fail()}}function S(){t.strictEqual(u,void 0),t.strictEqual(m.length,0)}d(),[u,m]=f(r,"World HelLo"),d(),[u,m]=f(r,"World HelLo World"),d(),[u,m]=f(r,"World HelLo Nothing"),S(),[u,m]=f(r,"More Nothing"),S()}),test("fuzzyScore2 (#95716)",function(){const e=f("# \u274C Wow","\u274C");t.ok(e),t.ok(typeof e[0]=="number"),t.ok(e[1].length>0)}),test("Using quotes should expect contiguous matches match",function(){t.strictEqual(q("contiguous",'"contguous"')[0],0);const r=q("contiguous",'"contiguous"');t.strictEqual(r[0],253)}),test("Using quotes should highlight contiguous indexes",function(){const r=q("2021-7-26.md",'"26"');t.strictEqual(r[0],13),t.strictEqual(r[1][0],7),t.strictEqual(r[1][1],8)}),W()});
