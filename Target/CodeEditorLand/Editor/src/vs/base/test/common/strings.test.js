import a from"assert";import*as t from"../../common/strings.js";import{ensureNoDisposablesAreLeakedInTestSuite as f}from"./utils.js";suite("Strings",()=>{test("equalsIgnoreCase",()=>{a(t.equalsIgnoreCase("","")),a(!t.equalsIgnoreCase("","1")),a(!t.equalsIgnoreCase("1","")),a(t.equalsIgnoreCase("a","a")),a(t.equalsIgnoreCase("abc","Abc")),a(t.equalsIgnoreCase("abc","ABC")),a(t.equalsIgnoreCase("H\xF6henmeter","H\xD6henmeter")),a(t.equalsIgnoreCase("\xD6L","\xD6l"))}),test("beginsWithIgnoreCase",()=>{a(t.startsWithIgnoreCase("","")),a(!t.startsWithIgnoreCase("","1")),a(t.startsWithIgnoreCase("1","")),a(t.startsWithIgnoreCase("a","a")),a(t.startsWithIgnoreCase("abc","Abc")),a(t.startsWithIgnoreCase("abc","ABC")),a(t.startsWithIgnoreCase("H\xF6henmeter","H\xD6henmeter")),a(t.startsWithIgnoreCase("\xD6L","\xD6l")),a(t.startsWithIgnoreCase("alles klar","a")),a(t.startsWithIgnoreCase("alles klar","A")),a(t.startsWithIgnoreCase("alles klar","alles k")),a(t.startsWithIgnoreCase("alles klar","alles K")),a(t.startsWithIgnoreCase("alles klar","ALLES K")),a(t.startsWithIgnoreCase("alles klar","alles klar")),a(t.startsWithIgnoreCase("alles klar","ALLES KLAR")),a(!t.startsWithIgnoreCase("alles klar"," ALLES K")),a(!t.startsWithIgnoreCase("alles klar","ALLES K ")),a(!t.startsWithIgnoreCase("alles klar","\xF6ALLES K ")),a(!t.startsWithIgnoreCase("alles klar"," ")),a(!t.startsWithIgnoreCase("alles klar","\xF6"))}),test("compareIgnoreCase",()=>{function e(r,s,i=!0){let o=t.compareIgnoreCase(r,s);o=o>0?1:o<0?-1:o;let l=t.compare(r.toLowerCase(),s.toLowerCase());l=l>0?1:l<0?-1:l,a.strictEqual(o,l,`${r} <> ${s}`),i&&e(s,r,!1)}e("",""),e("abc","ABC"),e("abc","ABc"),e("abc","ABcd"),e("abc","abcd"),e("foo","f\xF6o"),e("Code","code"),e("Code","c\xF6de"),e("B","a"),e("a","B"),e("b","a"),e("a","b"),e("aa","ab"),e("aa","aB"),e("aa","aA"),e("a","aa"),e("ab","aA"),e("O","/")}),test("compareIgnoreCase (substring)",()=>{function e(r,s,i,o,l,n,E=!0){let c=t.compareSubstringIgnoreCase(r,s,i,o,l,n);c=c>0?1:c<0?-1:c;let u=t.compare(r.toLowerCase().substring(i,o),s.toLowerCase().substring(l,n));u=u>0?1:u<0?-1:u,a.strictEqual(c,u,`${r} <> ${s}`),E&&e(s,r,l,n,i,o,!1)}e("","",0,0,0,0),e("abc","ABC",0,1,0,1),e("abc","Aabc",0,3,1,4),e("abcABc","ABcd",3,6,0,4)}),test("format",()=>{a.strictEqual(t.format("Foo Bar"),"Foo Bar"),a.strictEqual(t.format("Foo {0} Bar"),"Foo {0} Bar"),a.strictEqual(t.format("Foo {0} Bar","yes"),"Foo yes Bar"),a.strictEqual(t.format("Foo {0} Bar {0}","yes"),"Foo yes Bar yes"),a.strictEqual(t.format("Foo {0} Bar {1}{2}","yes"),"Foo yes Bar {1}{2}"),a.strictEqual(t.format("Foo {0} Bar {1}{2}","yes",void 0),"Foo yes Bar undefined{2}"),a.strictEqual(t.format("Foo {0} Bar {1}{2}","yes",5,!1),"Foo yes Bar 5false"),a.strictEqual(t.format("Foo {0} Bar. {1}","(foo)",".test"),"Foo (foo) Bar. .test")}),test("format2",()=>{a.strictEqual(t.format2("Foo Bar",{}),"Foo Bar"),a.strictEqual(t.format2("Foo {oops} Bar",{}),"Foo {oops} Bar"),a.strictEqual(t.format2("Foo {foo} Bar",{foo:"bar"}),"Foo bar Bar"),a.strictEqual(t.format2("Foo {foo} Bar {foo}",{foo:"bar"}),"Foo bar Bar bar"),a.strictEqual(t.format2("Foo {foo} Bar {bar}{boo}",{foo:"bar"}),"Foo bar Bar {bar}{boo}"),a.strictEqual(t.format2("Foo {foo} Bar {bar}{boo}",{foo:"bar",bar:"undefined"}),"Foo bar Bar undefined{boo}"),a.strictEqual(t.format2("Foo {foo} Bar {bar}{boo}",{foo:"bar",bar:"5",boo:!1}),"Foo bar Bar 5false"),a.strictEqual(t.format2("Foo {foo} Bar. {bar}",{foo:"(foo)",bar:".test"}),"Foo (foo) Bar. .test")}),test("lcut",()=>{a.strictEqual(t.lcut("foo bar",0),""),a.strictEqual(t.lcut("foo bar",1),"bar"),a.strictEqual(t.lcut("foo bar",3),"bar"),a.strictEqual(t.lcut("foo bar",4),"bar"),a.strictEqual(t.lcut("foo bar",5),"foo bar"),a.strictEqual(t.lcut("test string 0.1.2.3",3),"2.3"),a.strictEqual(t.lcut("foo bar",0,"\u2026"),"\u2026"),a.strictEqual(t.lcut("foo bar",1,"\u2026"),"\u2026bar"),a.strictEqual(t.lcut("foo bar",3,"\u2026"),"\u2026bar"),a.strictEqual(t.lcut("foo bar",4,"\u2026"),"\u2026bar"),a.strictEqual(t.lcut("foo bar",5,"\u2026"),"foo bar"),a.strictEqual(t.lcut("test string 0.1.2.3",3,"\u2026"),"\u20262.3"),a.strictEqual(t.lcut("",10),""),a.strictEqual(t.lcut("a",10),"a"),a.strictEqual(t.lcut(" a",10),"a"),a.strictEqual(t.lcut("            a",10),"a"),a.strictEqual(t.lcut(" bbbb       a",10),"bbbb       a"),a.strictEqual(t.lcut("............a",10),"............a"),a.strictEqual(t.lcut("",10,"\u2026"),""),a.strictEqual(t.lcut("a",10,"\u2026"),"a"),a.strictEqual(t.lcut(" a",10,"\u2026"),"a"),a.strictEqual(t.lcut("            a",10,"\u2026"),"a"),a.strictEqual(t.lcut(" bbbb       a",10,"\u2026"),"bbbb       a"),a.strictEqual(t.lcut("............a",10,"\u2026"),"............a")}),test("escape",()=>{a.strictEqual(t.escape(""),""),a.strictEqual(t.escape("foo"),"foo"),a.strictEqual(t.escape("foo bar"),"foo bar"),a.strictEqual(t.escape("<foo bar>"),"&lt;foo bar&gt;"),a.strictEqual(t.escape("<foo>Hello</foo>"),"&lt;foo&gt;Hello&lt;/foo&gt;")}),test("ltrim",()=>{a.strictEqual(t.ltrim("foo","f"),"oo"),a.strictEqual(t.ltrim("foo","o"),"foo"),a.strictEqual(t.ltrim("http://www.test.de","http://"),"www.test.de"),a.strictEqual(t.ltrim("/foo/","/"),"foo/"),a.strictEqual(t.ltrim("//foo/","/"),"foo/"),a.strictEqual(t.ltrim("/",""),"/"),a.strictEqual(t.ltrim("/","/"),""),a.strictEqual(t.ltrim("///","/"),""),a.strictEqual(t.ltrim("",""),""),a.strictEqual(t.ltrim("","/"),"")}),test("rtrim",()=>{a.strictEqual(t.rtrim("foo","o"),"f"),a.strictEqual(t.rtrim("foo","f"),"foo"),a.strictEqual(t.rtrim("http://www.test.de",".de"),"http://www.test"),a.strictEqual(t.rtrim("/foo/","/"),"/foo"),a.strictEqual(t.rtrim("/foo//","/"),"/foo"),a.strictEqual(t.rtrim("/",""),"/"),a.strictEqual(t.rtrim("/","/"),""),a.strictEqual(t.rtrim("///","/"),""),a.strictEqual(t.rtrim("",""),""),a.strictEqual(t.rtrim("","/"),"")}),test("trim",()=>{a.strictEqual(t.trim(" foo "),"foo"),a.strictEqual(t.trim("  foo"),"foo"),a.strictEqual(t.trim("bar  "),"bar"),a.strictEqual(t.trim("   "),""),a.strictEqual(t.trim("foo bar","bar"),"foo ")}),test("trimWhitespace",()=>{a.strictEqual(" foo ".trim(),"foo"),a.strictEqual("	 foo	".trim(),"foo"),a.strictEqual("  foo".trim(),"foo"),a.strictEqual("bar  ".trim(),"bar"),a.strictEqual("   ".trim(),""),a.strictEqual(" 	  ".trim(),"")}),test("lastNonWhitespaceIndex",()=>{a.strictEqual(t.lastNonWhitespaceIndex("abc  	 	 "),2),a.strictEqual(t.lastNonWhitespaceIndex("abc"),2),a.strictEqual(t.lastNonWhitespaceIndex("abc	"),2),a.strictEqual(t.lastNonWhitespaceIndex("abc "),2),a.strictEqual(t.lastNonWhitespaceIndex("abc  	 	 "),2),a.strictEqual(t.lastNonWhitespaceIndex("abc  	 	 abc 	 	 "),11),a.strictEqual(t.lastNonWhitespaceIndex("abc  	 	 abc 	 	 ",8),2),a.strictEqual(t.lastNonWhitespaceIndex("  	 	 "),-1)}),test("containsRTL",()=>{a.strictEqual(t.containsRTL("a"),!1),a.strictEqual(t.containsRTL(""),!1),a.strictEqual(t.containsRTL(t.UTF8_BOM_CHARACTER+"a"),!1),a.strictEqual(t.containsRTL("hello world!"),!1),a.strictEqual(t.containsRTL("a\u{1F4DA}\u{1F4DA}b"),!1),a.strictEqual(t.containsRTL("\u0647\u0646\u0627\u0643 \u062D\u0642\u064A\u0642\u0629 \u0645\u062B\u0628\u062A\u0629 \u0645\u0646\u0630 \u0632\u0645\u0646 \u0637\u0648\u064A\u0644"),!0),a.strictEqual(t.containsRTL("\u05D6\u05D5\u05D4\u05D9 \u05E2\u05D5\u05D1\u05D3\u05D4 \u05DE\u05D1\u05D5\u05E1\u05E1\u05EA \u05E9\u05D3\u05E2\u05EA\u05D5"),!0)}),test("issue #115221: isEmojiImprecise misses \u2B50",()=>{const e=t.getNextCodePoint("\u2B50",1,0);a.strictEqual(t.isEmojiImprecise(e),!0)}),test("isBasicASCII",()=>{function e(s,i){a.strictEqual(t.isBasicASCII(s),i,s+` (${s.charCodeAt(0)})`)}e("abcdefghijklmnopqrstuvwxyz",!0),e("ABCDEFGHIJKLMNOPQRSTUVWXYZ",!0),e("1234567890",!0),e("`~!@#$%^&*()-_=+[{]}\\|;:'\",<.>/?",!0),e(" ",!0),e("	",!0),e(`
`,!0),e("\r",!0);let r=`\r	
`;for(let s=32;s<127;s++)r+=String.fromCharCode(s);e(r,!0),e("",!1),e("\x7F",!1),e("\xFC",!1),e("a\u{1F4DA}\u{1F4DA}b",!1)}),test("createRegExp",()=>{a.throws(()=>t.createRegExp("",!1)),a.strictEqual(t.createRegExp("abc",!1).source,"abc"),a.strictEqual(t.createRegExp("([^ ,.]*)",!1).source,"\\(\\[\\^ ,\\.\\]\\*\\)"),a.strictEqual(t.createRegExp("([^ ,.]*)",!0).source,"([^ ,.]*)"),a.strictEqual(t.createRegExp("abc",!1,{wholeWord:!0}).source,"\\babc\\b"),a.strictEqual(t.createRegExp("abc",!0,{wholeWord:!0}).source,"\\babc\\b"),a.strictEqual(t.createRegExp(" abc",!0,{wholeWord:!0}).source," abc\\b"),a.strictEqual(t.createRegExp("abc ",!0,{wholeWord:!0}).source,"\\babc "),a.strictEqual(t.createRegExp(" abc ",!0,{wholeWord:!0}).source," abc ");const e=t.createRegExp("abc",!0);a(!e.global),a(e.ignoreCase),a(!e.multiline);const r=t.createRegExp("abc",!0,{global:!0,matchCase:!0,multiline:!0});a(r.global),a(!r.ignoreCase),a(r.multiline)}),test("getLeadingWhitespace",()=>{a.strictEqual(t.getLeadingWhitespace("  foo"),"  "),a.strictEqual(t.getLeadingWhitespace("  foo",2),""),a.strictEqual(t.getLeadingWhitespace("  foo",1,1),""),a.strictEqual(t.getLeadingWhitespace("  foo",0,1)," "),a.strictEqual(t.getLeadingWhitespace("  "),"  "),a.strictEqual(t.getLeadingWhitespace("  ",1)," "),a.strictEqual(t.getLeadingWhitespace("  ",0,1)," "),a.strictEqual(t.getLeadingWhitespace("		function foo(){",0,1),"	"),a.strictEqual(t.getLeadingWhitespace("		function foo(){",0,2),"		")}),test("fuzzyContains",()=>{a.ok(!t.fuzzyContains(void 0,null)),a.ok(t.fuzzyContains("hello world","h")),a.ok(!t.fuzzyContains("hello world","q")),a.ok(t.fuzzyContains("hello world","hw")),a.ok(t.fuzzyContains("hello world","horl")),a.ok(t.fuzzyContains("hello world","d")),a.ok(!t.fuzzyContains("hello world","wh")),a.ok(!t.fuzzyContains("d","dd"))}),test("startsWithUTF8BOM",()=>{a(t.startsWithUTF8BOM(t.UTF8_BOM_CHARACTER)),a(t.startsWithUTF8BOM(t.UTF8_BOM_CHARACTER+"a")),a(t.startsWithUTF8BOM(t.UTF8_BOM_CHARACTER+"aaaaaaaaaa")),a(!t.startsWithUTF8BOM(" "+t.UTF8_BOM_CHARACTER)),a(!t.startsWithUTF8BOM("foo")),a(!t.startsWithUTF8BOM(""))}),test("stripUTF8BOM",()=>{a.strictEqual(t.stripUTF8BOM(t.UTF8_BOM_CHARACTER),""),a.strictEqual(t.stripUTF8BOM(t.UTF8_BOM_CHARACTER+"foobar"),"foobar"),a.strictEqual(t.stripUTF8BOM("foobar"+t.UTF8_BOM_CHARACTER),"foobar"+t.UTF8_BOM_CHARACTER),a.strictEqual(t.stripUTF8BOM("abc"),"abc"),a.strictEqual(t.stripUTF8BOM(""),"")}),test("containsUppercaseCharacter",()=>{[[null,!1],["",!1],["foo",!1],["f\xF6\xF6",!1],["\u0646\u0627\u0643",!1],["\u05DE\u05D1\u05D5\u05E1\u05E1\u05EA",!1],["\u{1F600}",!1],["(#@()*&%()@*#&09827340982374}{:\">?></'\\~`",!1],["Foo",!0],["FOO",!0],["F\xF6\xD6",!0],["F\xF6\xD6",!0],["\\Foo",!0]].forEach(([e,r])=>{a.strictEqual(t.containsUppercaseCharacter(e),r,`Wrong result for ${e}`)})}),test("containsUppercaseCharacter (ignoreEscapedChars)",()=>{[["\\Woo",!1],["f\\S\\S",!1],["foo",!1],["Foo",!0]].forEach(([e,r])=>{a.strictEqual(t.containsUppercaseCharacter(e,!0),r,`Wrong result for ${e}`)})}),test("uppercaseFirstLetter",()=>{[["",""],["foo","Foo"],["f","F"],["123","123"],[".a",".a"]].forEach(([e,r])=>{a.strictEqual(t.uppercaseFirstLetter(e),r,`Wrong result for ${e}`)})}),test("getNLines",()=>{a.strictEqual(t.getNLines("",5),""),a.strictEqual(t.getNLines("foo",5),"foo"),a.strictEqual(t.getNLines(`foo
bar`,5),`foo
bar`),a.strictEqual(t.getNLines(`foo
bar`,2),`foo
bar`),a.strictEqual(t.getNLines(`foo
bar`,1),"foo"),a.strictEqual(t.getNLines(`foo
bar`),"foo"),a.strictEqual(t.getNLines(`foo
bar
something`,2),`foo
bar`),a.strictEqual(t.getNLines("foo",0),"")}),test("getGraphemeBreakType",()=>{a.strictEqual(t.getGraphemeBreakType(3009),t.GraphemeBreakType.SpacingMark)}),test("truncate",()=>{a.strictEqual("hello world",t.truncate("hello world",100)),a.strictEqual("hello\u2026",t.truncate("hello world",5))}),test("truncateMiddle",()=>{a.strictEqual("hello world",t.truncateMiddle("hello world",100)),a.strictEqual("he\u2026ld",t.truncateMiddle("hello world",5))}),test("replaceAsync",async()=>{let e=0;a.strictEqual(await t.replaceAsync("abcabcabcabc",/b(.)/g,async(r,s)=>(a.strictEqual(r,"bc"),a.strictEqual(s,"c"),`${e++}${s}`)),"a0ca1ca2ca3c")}),test("removeAnsiEscapeCodes",()=>{const e="\x1B[",r=[`${e}42@`,`${e}42 @`,`${e}42A`,`${e}42 A`,`${e}42B`,`${e}42C`,`${e}42D`,`${e}42E`,`${e}42F`,`${e}42G`,`${e}42;42H`,`${e}42I`,`${e}42J`,`${e}?42J`,`${e}42K`,`${e}?42K`,`${e}42L`,`${e}42M`,`${e}42P`,`${e}#P`,`${e}3#P`,`${e}#Q`,`${e}3#Q`,`${e}#R`,`${e}42S`,`${e}?1;2;3S`,`${e}42T`,`${e}42;42;42;42;42T`,`${e}>3T`,`${e}42X`,`${e}42Z`,`${e}42^`,`${e}42\``,`${e}42a`,`${e}42b`,`${e}42c`,`${e}=42c`,`${e}>42c`,`${e}42d`,`${e}42e`,`${e}42;42f`,`${e}42g`,`${e}3h`,`${e}?3h`,`${e}42i`,`${e}?42i`,`${e}3l`,`${e}?3l`,`${e}3m`,`${e}>0;0m`,`${e}>0m`,`${e}?0m`,`${e}42n`,`${e}>42n`,`${e}?42n`,`${e}>42p`,`${e}!p`,`${e}0;0"p`,`${e}42$p`,`${e}?42$p`,`${e}#p`,`${e}3#p`,`${e}>42q`,`${e}42q`,`${e}42 q`,`${e}42"q`,`${e}#q`,`${e}42;42r`,`${e}?3r`,`${e}0;0;0;0;3$r`,`${e}s`,`${e}0;0s`,`${e}>42s`,`${e}?3s`,`${e}42;42;42t`,`${e}>3t`,`${e}42 t`,`${e}0;0;0;0;3$t`,`${e}u`,`${e}42 u`,`${e}0;0;0;0;0;0;0;0$v`,`${e}42$w`,`${e}0;0;0;0'w`,`${e}42x`,`${e}42*x`,`${e}0;0;0;0;0$x`,`${e}42#y`,`${e}0;0;0;0;0;0*y`,`${e}42;0'z`,`${e}0;1;2;4$z`,`${e}3'{`,`${e}#{`,`${e}3#{`,`${e}0;0;0;0\${`,`${e}0;0;0;0#|`,`${e}42$|`,`${e}42'|`,`${e}42*|`,`${e}#}`,`${e}42'}`,`${e}42$}`,`${e}42'~`,`${e}42$~`,`${e}1;31m`,`${e}105m`,`${e}48:5:128m`,`${e}48;5;128m`,`${e}38:2:0:255:255:255m`,`${e}38;2;255;255;255m`,"\x1B]633;SetMark;\x07","\x1B]633;P;Cwd=/foo\x07"];for(const s of r)a.strictEqual(t.removeAnsiEscapeCodes(`hello${s}world`),"helloworld",`expect to remove ${JSON.stringify(s)}`);for(const s of r)a.deepStrictEqual([...t.forAnsiStringParts(`hello${s}world`)],[{isCode:!1,str:"hello"},{isCode:!0,str:s},{isCode:!1,str:"world"}],`expect to forAnsiStringParts ${JSON.stringify(s)}`);a.strictEqual(t.removeAnsiEscapeCodes("localhost:\x1B[31m1234"),"localhost:1234")}),test("removeAnsiEscapeCodesFromPrompt",()=>{a.strictEqual(t.removeAnsiEscapeCodesFromPrompt("\x1B[31m$ \x1B[0m"),"$ "),a.strictEqual(t.removeAnsiEscapeCodesFromPrompt(`
\\[\x1B[01;34m\\]\\w\\[\x1B[00m\\]
\\[\x1B[1;32m\\]> \\[\x1B[0m\\]`),`
\\w
> `)}),test("count",()=>{a.strictEqual(t.count("hello world","o"),2),a.strictEqual(t.count("hello world","l"),3),a.strictEqual(t.count("hello world","z"),0),a.strictEqual(t.count("hello world","hello"),1),a.strictEqual(t.count("hello world","world"),1),a.strictEqual(t.count("hello world","hello world"),1),a.strictEqual(t.count("hello world","foo"),0)}),test("containsAmbiguousCharacter",()=>{a.strictEqual(t.AmbiguousCharacters.getInstance(new Set).containsAmbiguousCharacter("abcd"),!1),a.strictEqual(t.AmbiguousCharacters.getInstance(new Set).containsAmbiguousCharacter("\xFC\xE5"),!1),a.strictEqual(t.AmbiguousCharacters.getInstance(new Set).containsAmbiguousCharacter("(*&^)"),!1),a.strictEqual(t.AmbiguousCharacters.getInstance(new Set).containsAmbiguousCharacter("\u03BF"),!0),a.strictEqual(t.AmbiguousCharacters.getInstance(new Set).containsAmbiguousCharacter("ab\u0261c"),!0)}),test("containsInvisibleCharacter",()=>{a.strictEqual(t.InvisibleCharacters.containsInvisibleCharacter("abcd"),!1),a.strictEqual(t.InvisibleCharacters.containsInvisibleCharacter(" "),!0),a.strictEqual(t.InvisibleCharacters.containsInvisibleCharacter("a\u{E004E}b"),!0),a.strictEqual(t.InvisibleCharacters.containsInvisibleCharacter("a\u{E015A}\vb"),!0)}),f()}),test("htmlAttributeEncodeValue",()=>{a.strictEqual(t.htmlAttributeEncodeValue(""),""),a.strictEqual(t.htmlAttributeEncodeValue("abc"),"abc"),a.strictEqual(t.htmlAttributeEncodeValue('<script>alert("Hello")</script>'),"&lt;script&gt;alert(&quot;Hello&quot;)&lt;/script&gt;"),a.strictEqual(t.htmlAttributeEncodeValue("Hello & World"),"Hello &amp; World"),a.strictEqual(t.htmlAttributeEncodeValue('"Hello"'),"&quot;Hello&quot;"),a.strictEqual(t.htmlAttributeEncodeValue("'Hello'"),"&apos;Hello&apos;"),a.strictEqual(t.htmlAttributeEncodeValue(`<>&'"`),"&lt;&gt;&amp;&apos;&quot;")});
