import*as l from"path";import*as c from"fs";import{fileURLToPath as d}from"url";import{createRequire as P}from"node:module";const u=P(import.meta.url),i={exports:{}},h=l.dirname(d(import.meta.url));if(Error.stackTraceLimit=100,!process.env.VSCODE_HANDLES_SIGPIPE){let e=!1;process.on("SIGPIPE",()=>{e||(e=!0,console.error(new Error("Unexpected SIGPIPE")))})}function E(){try{typeof process.env.VSCODE_CWD!="string"&&(process.env.VSCODE_CWD=process.cwd()),process.platform==="win32"&&process.chdir(l.dirname(process.execPath))}catch(e){console.error(e)}}E(),i.exports.devInjectNodeModuleLookupPath=function(e){if(!process.env.VSCODE_DEV)return;if(!e)throw new Error("Missing injectPath");u("node:module").register("./bootstrap-import.js",{parentURL:import.meta.url,data:e})},i.exports.removeGlobalNodeJsModuleLookupPaths=function(){if(typeof process?.versions?.electron=="string")return;const e=u("module"),o=e.globalPaths,r=e._resolveLookupPaths;e._resolveLookupPaths=function(a,p){const t=r(a,p);if(Array.isArray(t)){let n=0;for(;n<t.length&&t[t.length-1-n]===o[o.length-1-n];)n++;return t.slice(0,t.length-n)}return t}},i.exports.configurePortable=function(e){const o=l.dirname(h);function r(s){return process.env.VSCODE_DEV?o:process.platform==="darwin"?s.dirname(s.dirname(s.dirname(o))):s.dirname(s.dirname(o))}function a(s){if(process.env.VSCODE_PORTABLE)return process.env.VSCODE_PORTABLE;if(process.platform==="win32"||process.platform==="linux")return s.join(r(s),"data");const f=e.portable||`${e.applicationName}-portable-data`;return s.join(s.dirname(r(s)),f)}const p=a(l),t=!("target"in e)&&c.existsSync(p),n=l.join(p,"tmp"),m=t&&c.existsSync(n);return t?process.env.VSCODE_PORTABLE=p:delete process.env.VSCODE_PORTABLE,m&&(process.platform==="win32"?(process.env.TMP=n,process.env.TEMP=n):process.env.TMPDIR=n),{portableDataPath:p,isPortable:t}},i.exports.enableASARSupport=function(){},i.exports.fileUriFromPath=function(e,o){let r=e.replace(/\\/g,"/");r.length>0&&r.charAt(0)!=="/"&&(r=`/${r}`);let a;return o.isWindows&&r.startsWith("//")?a=encodeURI(`${o.scheme||"file"}:${r}`):a=encodeURI(`${o.scheme||"file"}://${o.fallbackAuthority||""}${r}`),a.replace(/#/g,"%23")};const v=i.exports.devInjectNodeModuleLookupPath,x=i.exports.removeGlobalNodeJsModuleLookupPaths,g=i.exports.configurePortable,D=i.exports.enableASARSupport,L=i.exports.fileUriFromPath;export{g as configurePortable,v as devInjectNodeModuleLookupPath,D as enableASARSupport,L as fileUriFromPath,x as removeGlobalNodeJsModuleLookupPaths};
